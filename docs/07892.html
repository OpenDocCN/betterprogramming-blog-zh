<html>
<head>
<title>What Is a Database Transaction?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是数据库事务？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-is-a-database-transaction-df16de9d9bc1?source=collection_archive---------10-----------------------#2021-03-02">https://betterprogramming.pub/what-is-a-database-transaction-df16de9d9bc1?source=collection_archive---------10-----------------------#2021-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cba8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解高负载系统如何管理数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/804967fcc41d241d166e246515b10151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcKZe4hkZyfRbDcQlEgogw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">简·安东宁·科拉尔在<a class="ae ky" href="https://unsplash.com/s/photos/database?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="26f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据库提供有组织的数据存储。数据库最常见的操作是检索和写入。应用程序将一些数据放在那里，然后访问它们。读取和写入操作之间的比率可以变化。然而，目的是一样的。</p><p id="8e83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着越来越多的请求访问数据库，数据一致性的问题就出现了。但是如果你的解决方案遵循了ACID原则(原子性、一致性、隔离性、持久性)，这就不是问题了。</p><p id="7b4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们探索一下数据一致性及其最佳实践。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9c28" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">有什么问题？</h1><p id="3ec1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在深入探讨事务如何工作的话题之前，我们首先要理解<em class="mz">为什么</em>。我们想用数据库事务解决什么问题？</p><p id="06d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看数据库系统中的一个经典问题，叫做<em class="mz">脏读</em>。两个用户Gloria和Anna正在对数据库执行关于书籍的查询。Gloria执行两个查询来获取某本书的发行日期。同时，安娜更新了那本书的发行日期。但是她的更新失败了，更改被回滚。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/71170af2a71bbb829964c62b04555d4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XzhnFxxUI8lgitscCrZ6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">脏读问题的示例</p></figure><p id="405d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">格洛丽亚得到了什么结果？她的第一个查询将返回更新之前的发布日期(例如2020年)。第二个查询将返回2021，因为它是在Anna的更新查询之后执行的。</p><p id="59c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，Anna所做的更改没有在数据库中显示出来，因为它们被回滚了。然而，Gloria没有把握好时机，在回滚之前读取了信息。这就是脏读的情况。</p><p id="69dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">脏读取也有类似的问题，例如<em class="mz">不可重复读取</em>和<em class="mz">幻像读取</em>。我们不会关注每一个细节，但常见的情况是它们打破了隔离原则。根据这个原则，新的变化应该是完全可见的，或者根本不可见。我们必须保证请求相同数据的不同用户总是得到相同的结果。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cb0b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">解决方案</h1><p id="2c1e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">事务是避免数据一致性问题的一种方式。这是对数据库的原子操作。事务的目的是满足所有的ACID原则，而隔离属性是对其做出有价值贡献的属性。</p><p id="e795" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事务隔离的整个概念是锁定对数据库的访问，直到事务完成。这意味着几个事务将按顺序执行，而不是并行执行。监控数据库操作有不同的隔离级别。默认情况下，每个数据库管理系统不使用相同的隔离级别。</p><p id="070c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最简单和最流行的隔离级别是<em class="mz">读提交</em>。它保证脏读和<em class="mz">脏写</em>是不可能的。只有提交的数据对其他人可见。这是通过行级锁和对旧值的引用来实现的。</p><p id="061d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于行级锁，只有单个事务可以写入，而修改同一行的任何其他事务都必须等待。虽然这种方法效果很好，但也有缺点。只读事务的性能可能会受到影响。通常，只读事务的平均数量远远高于写事务。</p><p id="5874" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了改善只读事务的响应时间，系统必须保留该行的前一个值，并将其返回给每个查询。所有正在进行的写事务都不会阻止只读事务。只有当行被更新并且锁被释放时，读查询才会返回一个新值。</p><p id="4d7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，性能保持在合理的水平，脏读问题得到解决。读操作不会阻止写操作，写操作也不会阻止读操作。</p><p id="a60a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">复杂的系统可能会有更多的问题，比如<em class="mz">读偏斜</em>、<em class="mz">写偏斜</em>，以及<em class="mz">幻影读偏斜</em>。它们出现在边缘案例中，但是那些不是你想要的边缘案例。幸运的是，所有这些都被高级隔离级别所覆盖。</p><p id="8939" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">快照隔离</em>和<em class="mz">可串行化</em>属于高级隔离级别。它们看起来与<em class="mz"> Read Committed </em>相似，但有一些小的区别。</p><p id="9301" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快照隔离跟踪每个事务的行的多个版本，而不是只记住以前的值。可序列化是最强的隔离级别。它是通过严格地一个接一个地按顺序运行所有事务来实现的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9fe5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="ebf3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">数据库事务是一个强大的概念，它使数据保持一致。它有助于防止许多错误，尤其是在高负载分布式系统中。如果您了解如何应用数据库事务，您的解决方案将始终以最佳性能运行。</p></div></div>    
</body>
</html>