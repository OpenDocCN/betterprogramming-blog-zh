<html>
<head>
<title>A Step-by-Step Guide to Handling Form Validation in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中处理表单验证的分步指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-step-by-step-guide-to-handle-form-validation-in-react-83232cd52316?source=collection_archive---------6-----------------------#2020-04-29">https://betterprogramming.pub/a-step-by-step-guide-to-handle-form-validation-in-react-83232cd52316?source=collection_archive---------6-----------------------#2020-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="26dc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">使用</em> <code class="fe kg kh ki kj b"><em class="kf">formik</em></code> <em class="kf">和</em> <code class="fe kg kh ki kj b"><em class="kf">yup</em></code>在React中验证表单</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/07a52865a0397cd763f3f623664584ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4O8WY0JrA0Iq8WR3qqi7qw.png"/></div></div></figure><h1 id="3f46" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="60a5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">通常，我们发现自己处于这样一个位置，我们想要简单地创建一个有三个字段(一般来说)的登录表单:一个电子邮件、一个密码和一个复选框。</p><p id="c320" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果我们想要执行验证，以这种简单的形式处理错误可能会变得更糟糕，例如:</p><ul class=""><li id="b3e9" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">输入的电子邮件是否符合电子邮件模式(abc@example.com)？</li><li id="e485" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">密码是否至少包含8个字母？</li><li id="97fa" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">当用户点击输入字段时，它会显示错误吗？</li><li id="f83e" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">复选框是否已选中？</li><li id="ab96" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">禁用“提交”按钮，直到表单字段有效</li></ul><p id="a34a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">还有几个…</p><p id="0342" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">单独用一个React状态处理这样一个登录表单可能看起来很难看，我们可能仍然不能执行所有这样的验证。</p><p id="3ada" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们该怎么办？我们使用<code class="fe kg kh ki kj b">formik</code>和<code class="fe kg kh ki kj b">yup</code>来处理react组件中的所有表单验证。</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="af23" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">什么是福米克？</h1><p id="2274" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Formik是使用最广泛的JavaScript库，用于在React中验证表单。</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="d77a" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">什么是呀？</h1><p id="d3c6" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">可以把Yup看作是我们表单的一个模式，它保存了诸如密码字段中的最大字符数、电子邮件模式等数据。</p><p id="d04e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你不明白，不要担心；一旦我们开始编码，事情会变得更清楚。</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="6685" class="kw kx iq bd ky kz nk lb lc ld nl lf lg jw nm jx li jz nn ka lk kc no kd lm ln bi translated">入门指南</h1><p id="e205" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们通过运行以下命令将<code class="fe kg kh ki kj b">formik</code>和<code class="fe kg kh ki kj b">yup</code>安装到现有的/新的React项目中:</p><pre class="kl km kn ko gt np kj nq nr aw ns bi"><span id="98c3" class="nt kx iq kj b gy nu nv l nw nx">npm install --save formik yup</span></pre><p id="faa5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在是时候创建作为React组件登录表单了。我将创建这个组件作为一个功能组件；根据您的用例，您可以创建一个基于类的组件。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="8b82" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这是一个非常基本的形式。我们在这里做不了什么。在传统方法中，我们将输入字段的值保存在状态中，然后使用<code class="fe kg kh ki kj b">onChange</code>事件处理程序控制它。</p><p id="6c35" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但是，当我们有了<code class="fe kg kh ki kj b">formik</code>和<code class="fe kg kh ki kj b">yup</code>时，为什么还要使用组件级状态并花时间编写长的验证处理程序呢，对吗？</p><p id="f707" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">好吧！先说添加<code class="fe kg kh ki kj b">formik</code>！</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="d55d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面是我们在上面的代码中所做的:</p><ul class=""><li id="5543" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">将我们的<code class="fe kg kh ki kj b">form</code>包装在formik中，这样我们就可以访问formik的事件处理程序，比如<code class="fe kg kh ki kj b">handleSubmit</code>和<code class="fe kg kh ki kj b">handleChange</code>。</li><li id="9b90" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">formik的<code class="fe kg kh ki kj b">initialValues</code> prop作为我们表单的初始值。您可以看到，我们在第13行到第16行中指定了这一点。然后这些值被析构(第22行),这样我们就可以用它作为表单输入值。</li><li id="0399" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">formik的<code class="fe kg kh ki kj b">onSubmit</code> props在表单提交时被调用。因为我们已经将表单的<code class="fe kg kh ki kj b">handleSubmit</code>事件(第24行)附加到了它的<code class="fe kg kh ki kj b">onSubmit</code>事件上，所以formik的<code class="fe kg kh ki kj b">onSubmit</code>道具被调用到表单的<code class="fe kg kh ki kj b">onSubmit</code>事件上。</li><li id="0d88" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">最后一个对我们非常重要的功能是formik的<code class="fe kg kh ki kj b">handleChange</code>。我们将这个函数绑定到输入字段的<code class="fe kg kh ki kj b">onChange</code>事件处理程序，以便formik可以处理任何输入更改。该函数接受的第一个参数是它所附加的表单域的值。</li></ul><p id="9adb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，我们来添加<code class="fe kg kh ki kj b">yup</code>。请记住，yup用于解析我们的表单值，因此formik实际上可以对这些解析的值执行最终验证。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="a564" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们向组件添加了一个验证模式。这是表单验证最有趣的部分，通常会占用我们大部分时间。但现在不是了— <code class="fe kg kh ki kj b">yup</code>为我们完成了表单的所有值解析。只需设计表单的模式并将其附加到<code class="fe kg kh ki kj b">formik</code>。</p><p id="bc9a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">重要提示:注意第31行。</p><p id="aecc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">好吧！现在我们已经设置好了验证，让我们开始在错误发生时显示错误。对于这个特殊的用例，<code class="fe kg kh ki kj b">formik</code>为用户提供了一个非常方便的<code class="fe kg kh ki kj b">error</code>对象。如果任何输入域有错误，则<strong class="lq ir">对应的</strong>键或<code class="fe kg kh ki kj b">error</code>对象变为真。看看第23、33、41和52行。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="a43e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">接下来呢？目前，每当用户在任何字段中输入无效的表单值时，所有其他字段都会显示与其字段相对应的错误消息，而不管用户是否已经对该字段进行了“<strong class="lq ir">触摸</strong>”。这不是我们想要的。嗯，<code class="fe kg kh ki kj b">formik</code>也管这部分。向formiks <code class="fe kg kh ki kj b">touched</code>对象问好。它保留了用户是否实际触摸了某个字段的参考。</p><p id="f135" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们用<code class="fe kg kh ki kj b">touched</code>对象更新我们当前的代码库。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="9b67" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">好看吗？不错！最后一件事:如果用户输入了错误的密码，会发生什么？在这种情况下，我们希望在收到服务器的登录失败响应后更新<code class="fe kg kh ki kj b">password</code>字段的错误消息。福米克也负责这个！</p><p id="cb1e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们简单地析构传递到我们的<code class="fe kg kh ki kj b">handleSubmit</code>函数中的<code class="fe kg kh ki kj b">errors</code>对象，以将<code class="fe kg kh ki kj b">setFieldError</code>从中取出。使用<code class="fe kg kh ki kj b">setFieldError</code>，我们可以像这样设置特定表单字段的误差值。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="9fa6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，我们将添加formik的<code class="fe kg kh ki kj b">handleBlur</code>函数，该函数处理输入字段的<code class="fe kg kh ki kj b">onBlur</code>事件并执行所需的验证。</p><p id="3b5c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">女士们，先生们，我向你们展示我在React中使用<code class="fe kg kh ki kj b">formik</code>和<code class="fe kg kh ki kj b">yup</code>处理表单的方式。以下是最终代码:</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ny nz l"/></div></figure><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oa nz l"/></div></figure></div></div>    
</body>
</html>