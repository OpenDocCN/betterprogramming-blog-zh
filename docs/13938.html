<html>
<head>
<title>How To Update Rollup to Version 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将汇总更新到版本3</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-update-rollup-to-version-3-10c59139cbeb?source=collection_archive---------5-----------------------#2022-10-17">https://betterprogramming.pub/how-to-update-rollup-to-version-3-10c59139cbeb?source=collection_archive---------5-----------------------#2022-10-17</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="98db" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">一个简短的指南，节省你的时间和挫折</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/a7bed73fe51d18445c9c0c31e246168d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lqd946tRq8yNONNS"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@maxchen2k?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Max Chen </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="e32a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">前几天，<a class="ae kz" href="https://rollupjs.org/guide/en/" rel="noopener ugc nofollow" target="_blank"> Rollup </a>到了3版。我更新了我的一些项目，但这不是一个无痛的操作。代码有一些改动，还有一些插件要更新。在本文中，我报告了我遵循的步骤，希望它们也能对其他人有用。</p><p id="c2df" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我使用我的存储库<a class="ae kz" href="https://github.com/el3um4s/memento-svelte-typescript-tailwind" rel="noopener ugc nofollow" target="_blank"> MEMENTO — Svelte，Typescript &amp; TailwindCSS </a>作为例子，但是这个过程对于所有的项目都是一样的。</p><p id="3e5b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，我用这个命令检查哪些包需要更新:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="5e5d" class="mb mc iu lx b gz md me l mf mg">npx npm-check-updates</span></pre><p id="abe1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这样，我得到了要升级的包的列表。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mh"><img src="../Images/0f767647717c1b862d7aa7c2383d3e1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IakEhXfNiVwrRwaV.jpg"/></div></div></figure><p id="5472" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，我用这个命令更新包:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="4ef8" class="mb mc iu lx b gz md me l mf mg">npx npm-check-updates -u<br/>npm install</span></pre><p id="44fe" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">问题现在开始了。我得到以下错误消息:</p><ul class=""><li id="322d" class="mi mj iu lc b ld le lg lh lj mk ln ml lr mm lv mn mo mp mq bi translated"><code class="fe mr ms mt lx b">ERESOLVE overriding peer dependency</code></li><li id="d482" class="mi mj iu lc b ld mu lg mv lj mw ln mx lr my lv mn mo mp mq bi translated"><code class="fe mr ms mt lx b">peer rollup@"1 || 2" from rollup-plugin-css-only@3.1.0</code></li><li id="0bd4" class="mi mj iu lc b ld mu lg mv lj mw ln mx lr my lv mn mo mp mq bi translated"><code class="fe mr ms mt lx b">peer rollup@"^2.0.0" from rollup-plugin-terser@7.0.2</code></li></ul><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj mz"><img src="../Images/789f10cd5fe0d6f2f9499c17d1629a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/0*LuWkilI0Hrspy6za.jpg"/></div></figure><p id="31ef" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它们是链接在一起的，因为我有两个包有版本1或版本2 <code class="fe mr ms mt lx b">rollup</code>的依赖关系。为了解决这个问题，我需要更新这两个包。问题是，目前这两个资料库似乎已经过时了。我为他们两个提出了一个可能的解决方案。希望他们快点更新。</p><p id="b973" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">与此同时，我创建了两个包含两个包的forks来解决这个问题:</p><ul class=""><li id="42c2" class="mi mj iu lc b ld le lg lh lj mk ln ml lr mm lv mn mo mp mq bi translated"><a class="ae kz" href="https://www.npmjs.com/package/@el3um4s/rollup-plugin-css-only" rel="noopener ugc nofollow" target="_blank">@ el3um 4s/roll up-plugin-CSS-only</a></li><li id="adbc" class="mi mj iu lc b ld mu lg mv lj mw ln mx lr my lv mn mo mp mq bi translated"><a class="ae kz" href="https://www.npmjs.com/package/@el3um4s/rollup-plugin-terser" rel="noopener ugc nofollow" target="_blank">@ el3um 4s/roll up-plugin-terser</a></li></ul><p id="d498" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以，我卸载了两个有问题的插件:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="55de" class="mb mc iu lx b gz md me l mf mg">npm uninstall rollup-plugin-css-only rollup-plugin-terser</span></pre><p id="15f3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我把它们换成了我的叉子:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="e00d" class="mb mc iu lx b gz md me l mf mg">npm install @el3um4s/rollup-plugin-css-only @el3um4s/rollup-plugin-terser</span></pre><p id="6925" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我还需要更改<code class="fe mr ms mt lx b">rollup.config.js</code>文件中的引用:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="na nb l"/></div></figure><p id="6c30" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">代替<code class="fe mr ms mt lx b">import css from "rollup-plugin-css-only";</code>和<code class="fe mr ms mt lx b">import { terser } from "rollup-plugin-terser";</code></p><p id="61c3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，如果我尝试运行<code class="fe mr ms mt lx b">npm run dev</code>命令，我会得到另一个错误:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="a860" class="mb mc iu lx b gz md me l mf mg">[!] (plugin at position 8) ReferenceError: require is not defined<br/>ReferenceError: require is not defined</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nc"><img src="../Images/5a3592077ed8bf05594c3c0a5d3da19d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/0*k4ew_o-XP2pNSQ8z.jpg"/></div></figure><p id="b033" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这种情况下，问题与<code class="fe mr ms mt lx b">serve</code>功能有关。代码如下:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="na nb l"/></div></figure><p id="555b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我需要用<code class="fe mr ms mt lx b">import { spawn } from "child_process"</code>替换<code class="fe mr ms mt lx b">require("child_process")</code>:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="na nb l"/></div></figure><p id="8182" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">之后，我可以使用<code class="fe mr ms mt lx b">npm run dev</code>和<code class="fe mr ms mt lx b">npm run build</code>。</p><p id="7738" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">感谢阅读！敬请关注更多内容。</p></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><p id="9ef0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv"> <em class="nk">不要错过我的下一篇文章—报名我的</em> </strong> <a class="ae kz" href="https://medium.com/subscribe/@el3um4s" rel="noopener"> <strong class="lc iv"> <em class="nk">中邮箱列表</em> </strong> </a></p><div class="nl nm gq gs nn no"><a href="https://el3um4s.medium.com/membership" rel="noopener follow" target="_blank"><div class="np ab fp"><div class="nq ab nr cl cj ns"><h2 class="bd iv gz z fq nt fs ft nu fv fx it bi translated">通过我的推荐链接加入Medium—Samuele</h2><div class="nv l"><h3 class="bd b gz z fq nt fs ft nu fv fx dk translated">阅读萨缪尔的每一个故事(以及媒体上成千上万的其他作家)。不是中等会员？在这里加入一块…</h3></div><div class="nw l"><p class="bd b dl z fq nt fs ft nu fv fx dk translated">el3um4s.medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc kt no"/></div></div></a></div></div><div class="ab cl nd ne hy nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="in io ip iq ir"><p id="502b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="nk">原载于2022年10月14日https://blog.stranianelli.com</em><a class="ae kz" href="https://blog.stranianelli.com/how-to-update-rollup-to-version-3/" rel="noopener ugc nofollow" target="_blank"><em class="nk"/></a><em class="nk">。</em></p></div></div>    
</body>
</html>