<html>
<head>
<title>How to Create Your First REST API With Deno</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Deno创建你的第一个REST API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-your-first-rest-api-with-deno-296330832090?source=collection_archive---------4-----------------------#2020-05-24">https://betterprogramming.pub/how-to-create-your-first-rest-api-with-deno-296330832090?source=collection_archive---------4-----------------------#2020-05-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3bcf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Node.js的创造者，让我们一起用它来构建我们的第一个API</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/89180a0b7b9ed1ed19e744a934fb9825.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RvGQEXHTrB5WLSKQAXG1EA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Deno图标</p></figure><p id="27f8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我将逐步解释如何用Deno创建REST API。</p><p id="600c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">安装Deno 的<a class="ae lr" href="https://deno.land/#installation" rel="noopener ugc nofollow" target="_blank">步骤就不用解释了。他们在官网上描述的非常好。对于这个例子，我用的是</a><a class="ae lr" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>，为此有这个<a class="ae lr" href="https://marketplace.visualstudio.com/items?itemName=justjavac.vscode-deno" rel="noopener ugc nofollow" target="_blank">官方插件</a>存在。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="2eec" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">什么是德诺？</h1><p id="3103" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">Deno与Node非常相似，但Deno试图做的是拥有一个更安全的运行时，并纠正Node的基本错误。Deno在默认情况下是安全的。这意味着它不能访问你的硬盘，也不能访问你的网络。只有你给它，它才会有权限。另一方面，Node一旦安装，就可以访问几乎所有内容。</p><p id="c29f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，如果我们遵循官方指南并执行第一个命令，我们将看到它可以正常工作。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="71ad" class="nb ma iq mx b gy nc nd l ne nf">deno run <a class="ae lr" href="https://deno.land/std/examples/welcome.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/examples/welcome.ts</a></span></pre><p id="5f55" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是，如果我们按照下面的例子来做，我们将会遇到一个网络访问权限错误:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="835a" class="nb ma iq mx b gy nc nd l ne nf">import { serve } from "https://deno.land/std@0.52.0/http/server.ts";<br/>const s = serve({ port: 8000 });</span><span id="6d00" class="nb ma iq mx b gy ng nd l ne nf">console.log("http://localhost:8000/");<br/>for await (const req of s) {<br/>  req.respond({ body: "Hello World\n" });<br/>}</span></pre><p id="879c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">网络权限错误:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="52f9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">发生这种情况是因为第一个例子不需要任何额外的访问来工作，但是第二个例子需要访问我们的网络。Deno默认具有安全性，不允许我们这样做，除非我们授予额外的权限。</p><p id="a6a5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个例子中，您可以用<code class="fe nj nk nl mx b">— allow-net</code>参数运行它，它将会工作。</p><p id="5c32" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">文件也是如此。在这种情况下，我们需要<code class="fe nj nk nl mx b"> — allow-read</code>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="6ed3" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">用Deno创建一个API</h1><p id="440d" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">有什么比创建我们的第一个REST API更好的开始使用Deno的方式呢？</p><p id="15ca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个小教程中，我将创建一个非常简单的电影数组和五种方法来列出、搜索、创建、更新和删除元素。</p><p id="bf77" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一步是创建一个索引文件，在这里是<code class="fe nj nk nl mx b">app.ts</code>。第一件事是加载<a class="ae lr" href="https://oakserver.github.io/oak/" rel="noopener ugc nofollow" target="_blank"> Oak </a>，这是Deno的HTTP服务器的中间件框架。Oak的灵感来自Node.js的中间件Koa，看来他们延续了双关语。最终，它帮助我们更容易地编写API。</p><p id="9ed9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个相当简单的例子，几乎不言自明。服务器将监听端口4000，并加载我们将在后面看到的<code class="fe nj nk nl mx b">router.ts</code> <strong class="kx ir"> </strong>文件中定义的路由。在文件<code class="fe nj nk nl mx b">./api/controller.ts</code>中，我将为不同的端点放置函数的定义。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="97d8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">是时候在<code class="fe nj nk nl mx b">router.ts</code>文件中定义路线了。在这里，我们还将导入Oak路由器和我们将在<code class="fe nj nk nl mx b">controller.ts</code>中创建的定义。</p><p id="8858" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们实例化一个路由器，并定义五个注释路由:</p><ul class=""><li id="71b9" class="nm nn iq kx b ky kz lb lc le no li np lm nq lq nr ns nt nu bi translated"><code class="fe nj nk nl mx b">getMovies</code> — <strong class="kx ir"> </strong>返回所有电影</li><li id="87d7" class="nm nn iq kx b ky nv lb nw le nx li ny lm nz lq nr ns nt nu bi translated"><code class="fe nj nk nl mx b">getMovie </code> —返回给定ID的电影</li><li id="5692" class="nm nn iq kx b ky nv lb nw le nx li ny lm nz lq nr ns nt nu bi translated"><code class="fe nj nk nl mx b">createMovie</code> —创作一部新电影</li><li id="cb1a" class="nm nn iq kx b ky nv lb nw le nx li ny lm nz lq nr ns nt nu bi translated"><code class="fe nj nk nl mx b">updateMovie</code> —更新现有电影</li><li id="c8a4" class="nm nn iq kx b ky nv lb nw le nx li ny lm nz lq nr ns nt nu bi translated"><code class="fe nj nk nl mx b">deleteMovie </code> —删除电影</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="ce6b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在是时候创建<code class="fe nj nk nl mx b">controller.ts</code> <strong class="kx ir"> </strong>文件来定义API方法和测试数据库了。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="d545" class="nb ma iq mx b gy nc nd l ne nf">interface Movie {<br/>  id: string;<br/>  title: string;<br/>  rating: number;<br/>}</span></pre><p id="f370" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，电影阵列:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="f481" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，不同的方法，从列出所有电影的方法开始。事情就是这么简单:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="54f0" class="nb ma iq mx b gy nc nd l ne nf">/**<br/> * Returns all the movies in database<br/> */<br/>const getMovies = ({ response }: { response: any }) =&gt; {<br/>  response.body = movies;<br/>};</span></pre><p id="58ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们来看下一个，它负责从一个我们可以作为参数传递的ID返回一部电影。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="acba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们尝试用<a class="ae lr" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>发起请求，我们会看到它工作了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/aa48d885dafb8cbd483df12dfa484ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qRaqCuHawndQ38X-.png"/></div></div></figure><p id="ba19" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">轮到用<code class="fe nj nk nl mx b">createMovie</code> <strong class="kx ir"> </strong>的方法创作电影了。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="7109" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们发出测试请求，服务器将回复一条包含最近创建的电影数据的消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/1751d2262addad16e4ec4a37a445f1e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ek5zAwI_9rIKEZpl.png"/></div></div></figure><p id="d966" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们发出返回所有电影的请求，我们将看到新的电影是如何正确出现的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/30ebddf5eacf11743ec376498a2f7c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/0*o2LVS-hubBm-6RMx.png"/></div></figure><p id="c04a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">轮到<code class="fe nj nk nl mx b">updateMovie</code> <strong class="kx ir"> </strong>的方法更新电影了。代码是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="8835" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们用Postman发起相应的<code class="fe nj nk nl mx b">PUT</code> <strong class="kx ir"> </strong>请求，会得到正确的响应。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/b5f4a7796eadc4fca251cf49fa7609a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XctA0v4LAEksysMu.png"/></div></div></figure><p id="1459" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们只有<code class="fe nj nk nl mx b">deleteMovie</code> <strong class="kx ir"> </strong>方法，在本例中，它从给定的id中删除一部电影。我所做的是使用filter()来更新数组，保留所有id不同于发送的电影。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="87ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们试着和邮递员一起…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/3fdf30d57013cbca0b6ca2ed74e5c4d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kXlMkxkPZGBCIi_i.png"/></div></div></figure><p id="cf25" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">实际上id = 1的电影就消失了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/e5f7745758b1187c85b2be4e8e4b17cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lC3PMm93Xec1dQl6.png"/></div></div></figure><p id="b0b6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以从我的GitHub下载这个例子的所有源代码。</p></div></div>    
</body>
</html>