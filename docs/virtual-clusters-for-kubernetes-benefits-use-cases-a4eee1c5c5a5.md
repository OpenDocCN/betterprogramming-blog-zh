# Kubernetes 虚拟集群—优势和使用案例

> 原文：<https://betterprogramming.pub/virtual-clusters-for-kubernetes-benefits-use-cases-a4eee1c5c5a5>

## 虚拟 Kubernetes 集群可能是采用 Kubernetes 的下一个驱动因素

![](img/90c367043ba9f0a0a91887d7409aa19f.png)

在 [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上由 [Kelvin Ang](https://unsplash.com/@kelvin1987?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 拍摄的照片。

虚拟 Kubernetes 集群(vClusters)有可能将 Kubernetes 的采用提高到一个新的水平。它们运行在物理 Kubernetes 集群中，可以像普通集群一样使用，但它们仍然只是一个虚拟的构造。关于虚拟 Kubernetes 集群的详细定义和描述，[请看这篇文章](https://loft.sh/blog/introduction-into-virtual-clusters-in-kubernetes/)。

与彻底改变了物理服务器使用的虚拟机类似，虚拟 Kubernetes 集群与物理集群相比有一些优势，这使它们在某些情况下特别有用。

在本文中，我将描述虚拟 Kubernetes 集群的优势，并提供一些使用案例，在这些案例中，vClusters 比其他解决方案更具优势，例如许多单个集群或基于名称空间的多租户。

# 虚拟 Kubernetes 集群的优势

虚拟集群对 Kubernetes 的好处主要基于两个特征:

1.  共享物理集群
2.  隔离

## 集群共享/多租户

由于 v cluster 是 Kubernetes 中的一个虚拟抽象，因此可以在一个物理集群上运行多个 v cluster，这具有以下优势:

*   减少管理工作。由于只需要维护一个物理集群，虚拟集群大大减少了管理工作量。从用户的角度来看，这一点与另一个可能导致类似结果的替代方案相比变得尤为明显:不是在一个物理集群中运行虚拟集群，而是可以运行许多必须维护的物理集群，即使在中等规模的团队中，这也很快变得不可行。此外，物理集群可以通过一种非常“基本”的方式进行配置，而无需进行大量的额外安装，因为大部分工作都将在 vCluster 级别进行。
*   降低成本。除了减少管理工作从而降低成本之外，虚拟集群还可以更高效地利用计算资源，因为资源是由租户共享的。同样，通过将虚拟机引入物理服务器基础架构，也获得了类似的效率提升。虚拟集群的一次性本质进一步提高了成本效益。当不需要它们时，它们可以被“扔掉”(关闭)。或者，可以将它们“置于睡眠状态”(缩小)，这个过程甚至可以自动化(例如，使用睡眠模式)。

## 隔离/硬多租户

由于虚拟 Kubernetes 集群提供了一种更难的多租户形式(即用户彼此严格隔离)，因此它们有一些额外的好处，特别是与基于名称空间的多租户方法相比:

*   稳定的系统。使用虚拟 Kubernetes 集群不会损害系统的稳定性。即使虚拟集群出现故障，底层物理集群通常也不会受到影响。只有在某些极端情况下，虚拟集群的故障才会导致物理集群的故障，这也类似于虚拟机很少会导致底层物理机中断。这与错误的来源无关，错误可能来自集群内部(例如，工程师意外损坏了某些东西)，也可能来自集群外部(例如，对系统的恶意攻击)。这使得整个系统更具弹性，并有助于实现合理的微服务架构，真正分离各个服务的关注点。
*   充分的灵活性。虽然每个工程师或每个微服务都在同一个物理集群上工作，但他们的虚拟集群是完全独立的。这允许以非常不同的方式配置 vClusters。例如，虚拟集群可以有不同的 Kubernetes 版本或不同的 API 服务器配置。这再次使工程师能够自由工作，使用最适合其用例的东西，而不必考虑其他要求或底层物理 Kubernetes 集群。

总的来说，虚拟 Kubernetes 集群是将效率与稳定、灵活的系统相结合的唯一方法，因为它具有与 Kubernetes 本地资源的硬多租户。使用许多单独集群的替代方案只能解决隔离问题，但会造成巨大的成本负担，而基于名称空间的软多租户方法保持了合理的成本，但只能提供有限的稳定性和灵活性。因此，到目前为止，虚拟集群是那些想要两全其美的公司的唯一选择。

# 用例

由于虚拟集群的行为大多类似于常规的 Kubernetes 集群，因此它们的应用范围也同样广泛。为此，我将集中讨论三个主要用例，这些用例没有被具有名称空间或大量物理集群的备选解决方案很好地涵盖。

## CI/CD 和测试

*   需求:对于 Kubernetes 环境中的 CI/CD 和测试场景，工程师需要在任何需要的时候访问 Kubernetes。为了保持低成本，环境应该只在实际使用时才运行。工程师还应该能够修改 Kubernetes 的配置，以获得更真实的测试。
*   问题:创建 Kubernetes 集群需要一些时间，即使是在公共云中。因为计算资源是昂贵的，并且许多 CI/CD 管道是按分钟计费的，所以等待 30 分钟直到集群启动通常是不可行的。这也会减缓工程师行动的反馈循环，并中断他们的工作流程。因此，一个集群通常只是由工程师共享用于测试，如果同事同时使用它，这又会导致等待时间。这也是非常低效的，因为即使没有测试或管道在运行，这样的集群也总是在运行并耗费资金。
*   虚拟集群解决方案:虚拟集群的优势在于能够在几秒钟内启动，因此工程师可以按需创建它们。由于它们是成熟的集群，一次只能由一个工程师或应用程序使用，因此可以根据具体情况自由配置和调整。在测试或 CI/CD 过程完成后，它们也可以毫无问题地被丢弃，这使得计算资源的成本尽可能低。因此，虚拟 Kubernetes 集群非常适合 CI/CD 和测试场景。

## 云原生开发

*   要求:越来越多的公司希望[让开发者在开发期间直接访问 Kubernetes](https://loft.sh/blog/the-journey-of-adopting-cloud-native-development/) 。为此，工程师需要 Kubernetes 访问他们可以工作和试验，同时保持这些环境的低成本和低管理工作。
*   问题:每个工程师的单独集群通常是不可行的，因为这是一个昂贵的解决方案，需要一些 Kubernetes 知识，并导致大量的维护工作。为此，有时已经使用了基于名称空间的多租户。然而，缺乏强隔离会给工程师带来破坏整个系统的风险。他们通常也没有集群的管理员权限，因此在配置选项方面受到限制。
*   虚拟集群解决方案:同样，虚拟 Kubernetes 集群可以由工程师按需启动，不需要太多的 Kubernetes 先验知识。这样，工程师们就可以很好地相互隔离，在安全的开发沙箱中工作，而不用担心会影响到其他人。同时，这种方法非常经济高效，因为单个物理集群只需要很少的管理工作，可以共享资源，并且可以轻松删除虚拟集群。除了删除虚拟集群之外，还可以让它们进入睡眠模式。这允许开发人员从他们结束的地方继续他们的工作，同时不会产生计算成本。

## AI+ML 实验

*   需求:对于人工智能和机器学习应用，往往需要大量的计算资源。为了进行实验，工程师们因此需要访问一个拥有强大电力的云环境。他们还需要能够轻松地复制这些环境，以不同的参数重新运行实验，或者并行运行它们。
*   问题:由于高资源需求，成本是 AI 和 ML 实验的主要问题。因此，让实验环境一直运行是不合理的，因为即使不使用它，也会产生很高的成本。从工作流的角度来看，如果另一个实验仍在运行，共享环境会导致工程师的等待时间。单个集群也是如此，需要很长时间才能启动，因此也会中断工程师的工作流程。
*   虚拟集群解决方案:对于想要运行实验的人工智能和机器学习工程师来说，虚拟集群是一个很好的替代方案。它们可以在需要时在几秒钟内创建，并且非常具有可复制性，因此甚至可以并行运行实验，这可以加速许多工作流。尽管 vClusters 几乎可以立即使用，但它们不会闲置，因为它们可以在实验结束后轻松关闭。这些昂贵实验的成本因此被最小化。

# 存在哪些虚拟集群解决方案

虚拟 Kubernetes 集群仍然是一个非常新的话题，但是现在已经可以使用了。[多租户工作组](https://github.com/kubernetes-sigs/multi-tenancy)已经提出了这方面的实验性解决方案。Darren Shepherd 的 k3v[是开源社区中概念实现的进一步证明。](https://github.com/ibuildthecloud/k3v)

# 结论

虚拟 Kubernetes 集群的概念仍然非常新，但可能是 Kubernetes 的一大进步，与从物理服务器到虚拟机的突破性移动有着惊人的相似之处。共享集群与强隔离的结合将效率与弹性和灵活性融为一体。这也使得 Kubernetes 对于目前仍然难以实现的用例更具吸引力，例如 CI/CD、测试、云原生开发和 AI/ML 实验。因此，它可能会进一步刺激 Kubernetes 的采用。