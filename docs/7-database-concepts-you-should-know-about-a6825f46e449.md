# 你应该知道的 7 个数据库概念

> 原文：<https://betterprogramming.pub/7-database-concepts-you-should-know-about-a6825f46e449>

## 关于数据库有很多需要了解的，所以让我们从基础开始

![](img/3b1f7e42c67e59ddfc88f7d4d1f84b3b.png)

迈克尔·泽兹奇在 [Unsplash](https://unsplash.com/s/photos/server?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片。

关于数据库有很多需要了解的。它们是复杂的任务关键型应用程序，有时需要专业的主题专家来维护，但这并不意味着它们是某种神奇的黑匣子。数据库是我们应用程序的支柱，你对它们的工作原理了解得越多，你就越能更好地使用它们，根据它们编写应用程序，以及在不可避免地出错时解决问题。

因此，让我们深入了解关于数据库您应该(可能)知道的七件事情。

*注意:除非另有说明，否则我通常会谈论像 PostgreSQL 或 MySQL 这样的关系数据库，而不是 NoSQL 数据库。*

# 1.数据库存储事务—而不是状态(某种)

数据库，或者说它们的内部架构，不是很直观。您可能认为数据库只是一两个数据文件和一些管理数据文件的连接和修改的代码。在某种程度上你是对的。但实际上，在它的核心，数据库只是一个日志文件。该日志文件是已提交到数据库的事务列表，按照提交的顺序保存。

其他一切(表、行、模式等的状态。)是从该日志中记录的累积变化中产生的。每个数据库引擎以不同的方式存储该日志，但是一个部分伪日志可能如下所示:

```
...
2021-06-07 12:24:35.044513-4000 INSERT INTO 'People' "jeff" "wilson"
2021-06-07 12:25:33.232098-4000 INSERT INTO 'People' "mike" "lou"
2021-06-07 12:25:37.140013-4000 INSERT INTO 'People' "pat" "cat"
2021-06-07 12:26:11.030002-4000 INSERT INTO 'People' "mark" "wilson"
...
```

如果数据文件以某种方式损坏，数据库可以从这个日志中重建它的表、数据库、模式和所有其他东西。但是有一个非常重要的警告:一旦事务被提交或回滚，它就会从日志中删除。日志的目的是在事务完成之前暂存更改，而不是作为一种备份机制。可以从日志中恢复数据库中一些小而不重要的问题，但是任何比问题更严重的问题都需要某种外部备份来恢复。

在 PostgreSQL 和其他一些关系数据库中，这种日志被称为预写日志(WAL)。管理这个 WAL 及其各种特性是对这些数据库进行性能调优的重要部分，也是 PostgreSQL 管理复制的重要部分。写入 WAL 的任何事务也被广播给它的复制对等方，以便它们可以将该事务添加到它们的 WAL 中。

理解这种机制是理解数据库如何工作以及在出现问题时对其进行故障排除的关键。

# 2.选择正确的数据库很难

我见过许多关于“最好的”或“最差的”数据库的教条式的抨击，但事实是最好的数据库是最适合您的应用程序的数据库。没有放之四海而皆准的数据库，就像没有放之四海而皆准的编程语言或操作系统。

当开始一个新项目时，选择正确的数据库可能是您将做出的最重要的决定之一。那么应该如何选择使用哪个 DB 呢？在我为开发人员撰写的关于数据库的文章中，我列出了五个需要考虑的事项，但是让我在这里快速浏览一下。

## 什么样的数据将存储在数据库中？

您是否存储日志文件或用户帐户？

## 将要存储的数据有多复杂？

数据可以很容易地标准化吗？

## 数据的统一程度如何？

您的数据是大致遵循相同的模式，还是完全不同或嵌套过多？

## 需要多长时间读一次或写一次？

您的应用程序是读负载重还是写负载重，或者两者都是？

## 是否有环境或商业方面的考虑？

我们与供应商有现有协议吗？我需要供应商支持吗？

通过回答这些问题，你可以将你的选择范围缩小到几个候选人。一旦到了那里，测试就会告诉你哪一个最适合你的应用。

# 3.转移到正确的数据库更加困难

有时您没有选择，而数据库已经为您选择好了。无论您是在项目开始后加入项目，还是政治风向迫使您这样做，使用错误的数据库都会令人沮丧。

但是同样，如果不是更多的话，令人沮丧的是如果你有机会迁移数据库的过程。一旦你开始走一条路，就不容易中途改变路线。您不仅必须找出一种方法将数据从一个数据库复制到另一个数据库，并学习一个全新的系统，而且根据您的数据库代码与应用程序其余部分的紧密耦合程度，您还可能需要进行大量的重写。改变数据库不是一项不经考虑、辩论、测试和计划就能轻易完成的任务。有太多的方式会让事情变得非常糟糕。这就是第二点如此重要的原因:一旦你做出选择，就很难撤销。

# 4.NoSQL 并没有取代 SQL，而是补充了它

关于使用 SQL 还是 NoSQL 数据库的争论将永远持续下去。我明白了。但是在这个争论中经常忽略的一个事实是，NoSQL 数据库不会取代 SQL 数据库。他们*补充*他们。

有些事情 NoSQL 数据库做得很好，有些事情 SQL 数据库做得很好。Prometheus 非常擅长存储时间序列数据，比如指标，但你不会想用 MySQL 来做这件事。技术上可能吗？是的，但它不是为此而设计的，你不会从中获得最佳性能或开发者体验。另一方面，出于同样的原因，您不希望使用 Redis 存储高度相关的数据，如用户帐户或金融交易。当然，您可以在代码中实现它，但是当您可以使用正确的工具来完成工作时，为什么要增加复杂性和麻烦呢？

在某些领域会有一些不可避免的重叠。有一些优秀的数据库在技术上是 NoSQL，它们在存储关系数据方面做得很好(见:Couchbase)，但是还有其他外部因素影响它们的使用。客户端语言支持、操作工具、云支持等因素都是选择数据库时需要考虑的因素。

# 5.缩放是困难的

*在尝试扩展数据库时，数据库面临着独特的挑战。因为它们存储状态，因此本质上是有状态的应用程序，找到跨多个数据库实例复制该状态的方法，以一种对任何应用程序都透明的一致、安全和足够快的方式是*困难的*。这就是为什么扩展数据库——尤其是关系数据库——最常见的方式是使用*垂直扩展*。*

*让我们暂停一下，花一分钟来谈谈两种规模:垂直和水平。要正确理解每种方法需要一整篇文章(实际上，这不是一个坏主意……)，但是现在，我们可以相当简单地对其进行分解。我想我可以用一个类比来解释这个问题，所以是这样的:假设你有一个一加仑的水罐，但是上面有一个小洞，所以你需要把水转移到另一个容器。然而，你所有的都是小于一加仑的小容器。您可以使用两种方法:*

1.  *使用大量的小容器(比如水杯),将一加仑的水分配到这些容器中。*
2.  *使用少量的一夸脱容器，将水分配到几个较大的容器中。*

*使用许多更小的容器是*水平扩展，*工作负载(或水)分布在许多更小的容器上。使用几个较大的容器是*垂直扩展*，其中负载分布在少数大型容器上。使用水平扩展，当您需要添加额外的容量时，您可以添加更多的容器。通过垂直缩放，您可以增加现有的少量容器。*

*对于数据库，通常的做法是通过增加 CPU 和 RAM 容量来纵向扩展数据库实例。这避免了必须跨大量实例复制状态的问题，但仍允许您的数据库承担额外的负载。*

*一些数据库——尤其是 NoSQL 数据库——可以进行大规模的水平扩展，但是它们通常需要在一致性方面进行权衡。这些数据库趋向于*最终一致，*其中数据将*最终*在整个集群中变得一致，但是复制可能对访问该数据的任何应用程序都不透明。也就是说，从数据库节点 A 读取数据的应用程序将获得数据的一个版本，而从节点 D 读取数据的应用程序将获得另一个版本，直到群集可以更新所有节点上的数据。虽然这听起来像是一个交易破坏者，但是如果您在设计和构建应用程序时考虑到了这一点，它就不会成为一个问题。*

# *6.索引就像魔术一样，直到它们不再神奇*

*索引可以说是数据库中最重要的方面之一，但也是最容易被忽视的方面之一。简单地说，索引是在查找数据时数据库的目录。不必扫描整个列来查找单个值，索引可以告诉它该值在哪里，这样数据库引擎就可以立即跳转到该值。*

*如果你读到这里，对自己说，“嘿，这听起来像一个散列表，”那么，你没有错。索引基本上是表中给定列的一种哈希表。大多数关系数据库自动在主键上创建索引，但是您可以根据需要向任意多的列添加索引。*

*但是请不要这样做。*

*虽然索引可以显著加快读取速度，尤其是在大型数据集中，但是在向表中写入数据时，索引也是有代价的。每次更新表时，该表上的索引也需要更新，这增加了每个写事务的额外时间。这是因为*实际上是一个什么指标*。不像一本书的目录仅仅是一个指针列表，索引实际上包含必要列的第二个副本，只是以不同的顺序存储。这意味着索引使用一定比例的磁盘空间，并且在更新时需要 I/O。当只处理一个表上的几个索引时，这种权衡通常可以忽略不计，但是如果超过几个，您的事务就会开始招致写惩罚，即必须在每个事务上更新所有这些索引。*

*这就是为什么战略性地决定何时何地使用索引是非常重要的。决定是否对列进行索引的最佳方法是仔细研究一下您的应用程序，看看哪些类型的查询最常用，并以此为基础做出决定。此外，像应用程序性能监控或数据库监控这样的工具可以通过跟踪各种数据库查询的事务时间，帮助发现任何可以通过添加索引来改进的查询。*

# *7.处理*

*每当有东西与数据库交互时，它都使用一种叫做*事务*的结构。在数据库世界中，事务是一个原子工作单元——一个独立的、离散的操作，它有两种结果:提交或回滚。*

*这听起来没什么大不了的，但是它对数据库的性能和操作有着非常实际的影响——特别是对于那些符合 [ACID 的](https://en.wikipedia.org/wiki/ACID)。根据数据库中配置的事务隔离，提交事务的顺序和这些事务中处理的数据量会产生巨大的影响。我的一个朋友讲述了一个关于事务阻塞的小故事:*

> *“几年前，有人对‘数据库速度慢且超时’感到恼火，结果发现一名团队成员安排在哥斯达黎加通过慢速互联网连接工作，他们安装在笔记本电脑上的客户端应用程序对每个人使用的表执行`SELECT *`，因此每次运行时，数据库都会锁定整个表，直到将所有结果发送回哥斯达黎加，因为即使是`select`也是一个事务。”*

*这是因为当客户端从服务器接收数据时，数据库服务器必须保证数据的一致性，因此在运行查询并将数据传输回客户端的这段时间内，不能处理任何其他事务。在慢速连接、大量数据或两者兼有的情况下，这可能会给使用数据库的其他人带来一些严重的瓶颈。*

*这些限制中的一部分可以通过以下方法来克服:调整您的请求以仅获取您需要的数据，使用靠近将使用您的数据库的用户或应用程序的读取副本，调整您的事务设置以满足您的需要，或者以上所有方法。*

# *结论*

*希望这有助于填补您数据库知识中的一些空白，或者您甚至学到了一些新东西！你觉得我应该在清单上加些什么吗？请在评论中告诉我！*

**非常感谢两位优秀的爸爸/DBA，他们帮助我确保了本文信息的准确性！**