<html>
<head>
<title>Integrate YouTube’s IFrame Player API in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Angular中集成YouTube的IFrame播放器API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/integrate-youtubes-iframe-player-api-in-angular-4e87f0ec98f4?source=collection_archive---------0-----------------------#2019-06-23">https://betterprogramming.pub/integrate-youtubes-iframe-player-api-in-angular-4e87f0ec98f4?source=collection_archive---------0-----------------------#2019-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ccce" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Angular应用程序中添加YouTube IFrame播放器的简单指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/63501a8e59b4c444a10c9a2bc709f007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0GylxPM3BT136ji_twjEA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@vmxhu" rel="noopener ugc nofollow" target="_blank"> Szabo Victor </a>在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0e0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当涉及到将YouTube IFrame Player API与像<a class="ae ky" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>这样的基于组件的框架集成时，有点困难和棘手。在这里，我们将看看如何实现这一点。我将尝试讨论我在将YouTube IFrame播放器API集成到我的Angular应用程序中时所面临的所有问题和挑战。</p><p id="078d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们使用下面的命令创建一个虚拟的Angular应用程序。如果您已经有一个正在运行的应用程序，只需跳过这一步。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="adfe" class="ma mb it lw b gy mc md l me mf">ng new YTIFrameAPI-with-Angular</span></pre><p id="ec47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦应用程序准备好了，在你的模板文件中创建一个带有<code class="fe mg mh mi lw b">id="player"</code>(或者任何你想要的东西)的div，就像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="fa13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注:</strong>当然，你也可以根据自己的需求来更改模板。只要确保div有一个<code class="fe mg mh mi lw b">id</code>就行了，因为iframe(和视频播放器)将替换这个div。</p><p id="7456" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，声明一些有用的变量并创建一个<code class="fe mg mh mi lw b">init</code>函数来初始化YouTube IFrame API，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="c3ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mg mh mi lw b">init()</code>中的代码用于加载API的JavaScript代码。如上所示，当API准备好时，我们调用<code class="fe mg mh mi lw b">startVideo()</code>。该方法将定义一个全局变量<code class="fe mg mh mi lw b">"player"</code>，该变量引用您要嵌入的视频播放器，然后该函数构造视频播放器对象。</p><p id="186f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，一旦玩家准备好了，就会调用<code class="fe mg mh mi lw b">onPlayerReady()</code>。在本例中，我们只是在播放器准备好之后播放视频，就像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="18dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用API，我们可以跟踪播放器何时改变其状态。当玩家的状态改变时，API将调用<code class="fe mg mh mi lw b">onPlayerStateChange()</code>，这可能表示玩家正在播放、暂停、结束等等。如果你想在播放器改变状态时执行一些动作，这可能对你有用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="16a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:在下面的代码片段中，我们有两个额外的方法，<code class="fe mg mh mi lw b">cleanTime()</code>和<code class="fe mg mh mi lw b">onPlayerError(event)</code>。这些方法分别用于读取和计算播放器的当前时间戳以及记录错误。</p><p id="d1e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，简单地使用组件的<code class="fe mg mh mi lw b">ngOnInit()</code>方法初始化一个视频ID，并调用<code class="fe mg mh mi lw b">init()</code>方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="a604" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果您运行<code class="fe mg mh mi lw b">ng serve</code>并转到<code class="fe mg mh mi lw b">localhost</code> URL，您会看到播放器已创建，其中嵌入了一个YouTube视频。</p><p id="0453" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的例子中，它看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/bef204ca3dbdb72bff86d8aa191885ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B98Wi1xcUEoCqZwlFpIg5g.png"/></div></div></figure><p id="7b6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注:</strong>为了这个演示，我用的是来自<a class="ae ky" href="https://www.youtube.com/channel/UCktqmIbWa_nMaAgQcRfOEWg" rel="noopener ugc nofollow" target="_blank">复仇者联盟的电影剪辑YouTube频道</a>的<a class="ae ky" href="https://www.youtube.com/watch?v=EY6cOlFPkpU" rel="noopener ugc nofollow" target="_blank"> YouTube视频</a>。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="2e99" class="mt mb it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">我在整合过程中遇到的一些问题</h1><h2 id="08b0" class="ma mb it bd mu nk nl dn my nm nn dp nc li no np ne lm nq nr ng lq ns nt ni nu bi translated">HTML5 <code class="fe mg mh mi lw b">'video’ </code>元素</h2><p id="6ea9" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">某些移动浏览器(如Chrome和Safari)中的HTML5 <code class="fe mg mh mi lw b">&lt;video&gt;</code>元素只允许播放由用户交互启动的内容(如点击播放器)。以下是摘自<a class="ae ky" href="https://developer.apple.com/library/safari/#documentation/AudioVideo/Conceptual/Using_HTML5_Audio_Video/AudioandVideoTagBasics/AudioandVideoTagBasics.html" rel="noopener ugc nofollow" target="_blank">苹果文档</a>:</p><blockquote class="oa ob oc"><p id="e70f" class="kz la od lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">警告:为了防止用户付费通过蜂窝网络进行未经请求的下载，嵌入的媒体不能在iOS上的Safari中自动播放—用户总是会启动回放</p></blockquote><p id="05e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于这一限制，诸如<code class="fe mg mh mi lw b">autoplay</code>、<code class="fe mg mh mi lw b">playVideo()</code>和<code class="fe mg mh mi lw b">loadVideoById()</code>之类的功能和参数将无法在所有移动环境中工作。</p><p id="7234" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这个问题，我只是在受限设备上播放视频之前将视频静音，就像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="68de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以基本上我是在检查我的应用程序在哪个设备上运行，如果是iPhone、iPad、iPod或Android，我只是在播放前将视频静音。</p><p id="25e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong> <a class="ae ky" href="https://developers.google.com/youtube/iframe_api_reference#Mobile_considerations" rel="noopener ugc nofollow" target="_blank">这里的</a>是所有关于移动设备限制的详细内容。</p><h2 id="fa02" class="ma mb it bd mu nk nl dn my nm nn dp nc li no np ne lm nq nr ng lq ns nt ni nu bi translated">API和注册页面的问题</h2><p id="26c1" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">让我们讨论我面临的另一个问题。</p><p id="c9c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以基本上在我的应用中，一旦用户提交注册表单，一个API就会被点击。在等待API服务器的响应时，我必须为用户播放一段视频。如果我们在API上取得了成功，那就没有问题了。但是，如果在API端出现问题，我们只需将它们重定向到注册页面。现在，如果用户再次提交而不做任何更改，视频将不会显示。</p><p id="90bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为，第二次，播放器已经被创建了，但是当我们调用等待组件时，它试图再次创建播放器。所以基本上，API无法调用<code class="fe mg mh mi lw b">window['onYouTubeIframeAPIReady']</code>。</p><p id="c818" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这个问题，让我们在再次初始化YouTube IFrame播放器之前设置一个条件。如果播放器已经创建，只需播放视频。如果没有，就从YouTube播放器的初始化开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="0819" class="mt mb it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">结论</h1><p id="902f" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">这就是这篇文章的内容。我希望这有所帮助。最终代码可以在GitHub上找到。点击链接:</p><div class="oh oi gp gr oj ok"><a href="https://github.com/gouravkajal/YTIFrameAPI-with-Angular" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">gouravkajal/YTIFrameAPI-带角度</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">此项目是使用Angular CLI版本11.0.2生成的。为开发服务器运行ng serve。导航到…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">github.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div><p id="932c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="7d0e" class="mt mb it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated"><strong class="ak">参考文献</strong></h1><ul class=""><li id="f960" class="oz pa it lb b lc nv lf nw li pb lm pc lq pd lu pe pf pg ph bi translated"><a class="ae ky" href="https://developers.google.com/youtube/iframe_api_reference" rel="noopener ugc nofollow" target="_blank">“YouTube播放器iframe参考嵌入</a>”通过谷歌开发者</li><li id="47bc" class="oz pa it lb b lc pi lf pj li pk lm pl lq pm lu pe pf pg ph bi translated"><a class="ae ky" href="https://www.youtube.com/channel/UCktqmIbWa_nMaAgQcRfOEWg" rel="noopener ugc nofollow" target="_blank">复仇者联盟的电影片段YouTube频道</a></li></ul></div></div>    
</body>
</html>