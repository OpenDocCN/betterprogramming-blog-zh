<html>
<head>
<title>SceneKit Within SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI中的场景</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/scenekit-within-swiftui-5c242b040f83?source=collection_archive---------3-----------------------#2022-03-03">https://betterprogramming.pub/scenekit-within-swiftui-5c242b040f83?source=collection_archive---------3-----------------------#2022-03-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a962" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">较新的RealityKit/ARKit框架的近亲</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/23e468cd0e787cbdbc5768a5667a90f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*s8I5Ebv1CP1ECbGwx-Emmg.gif"/></div></div></figure><p id="b77c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我发表了几篇关于在SwiftUI中使用SpriteKit框架的文章。苹果为在其平台上构建游戏而整合的少数框架之一，其他框架是SceneKit、GameKit、RealityKit和ARKit，尽管后两者不仅仅是游戏还有争议——</p><p id="35f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我从未写过SceneKit、ARKit或RealityKit，这是我想在2022年解决的难题中缺失的一块。</p><p id="925e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，在我开始之前，我想说我怀疑WWDC2021没有提到SceneKit，因为许多从事这项工作的工程师已经被重新部署到ARKit和RealityKit团队。重新部署，因为他们是近亲，学习一个，你会惊讶地发现你对另一个了解了多少。对于那些说SceneKit也死了的反对者，考虑一下这个。</p><ul class=""><li id="b8bf" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">要真正使用ARKit/RealityKit，需要一个带激光雷达扫描仪的设备；大多数iOS设备还没有。</li><li id="9989" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">要真正使用ARKit/RealityKit，你需要一个内嵌多线程引擎的设备；一些关键的iOS设备也没有这样的能力。</li><li id="c498" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">ARKit在模拟器中不可用。</li></ul><h2 id="c75c" class="me mf it bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated">场景背景</h2><p id="c637" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">因此，在阅读了免责声明之后，让我们继续努力，尝试找出是什么让scene view[scene kit的SwiftUI插件]成功的。</p><p id="e5ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然在我开始写代码之前，我想提几件事情，当我开始更深入地研究这个问题时，这些事情让我很困惑，所以它们也不会让你困惑。</p><ul class=""><li id="88ad" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">该网格显示了如何配置<code class="fe nc nd ne nf b">SCNVector3</code>命令的布局。这是显而易见的，然而事实并非如此。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/14960412d708382af738024780bd98f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*2qvSh4ywreLg0-sMx0tPAA.png"/></div><p class="nh ni gj gh gi nj nk bd b be z dk translated">图片鸣谢:苹果SceneKit <a class="ae nl" href="https://developer.apple.com/library/mac/documentation/SceneKit/Reference/SceneKit_Framework/index.html" rel="noopener ugc nofollow" target="_blank">框架参考</a></p></figure><ul class=""><li id="5ed7" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><code class="fe nc nd ne nf b">SCNNodes</code>您添加到场景中的哪些元素就像UIKit或SwiftUI中的视图；相似的是，它们被安排在一个等级内。因此，后来添加到场景中的对象可能会遮挡已经存在的对象。</li><li id="a600" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">如果你用相机离一个物体太近，就像它正对着你的脸一样，那么你实际上什么也看不见。</li><li id="2b59" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">如果一个物体离相机太远，你将什么也看不见——这听起来很明显，但你会惊讶于它是如此的近却看不见。</li><li id="ab3c" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">所有使用角度旋转对象的命令都希望您使用弧度—如果您使用角度，它们不会抱怨；他们就是不会做你期待的事情！</li><li id="b2fd" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">当你开始玩这个的时候，使用平面和正方形——抵制那些性感的球体和一些教程喜欢展示的圆环。如果你这样做了，你会发现理解正在发生的事情要容易得多。</li><li id="cfce" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">在前面的注释中，默认情况下，平面是垂直添加的[不是水平的]，这可能会引起混淆。</li><li id="6ad4" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">同样的，平原实际上是2D，并且在旋转的时候是不同的，特别是，要注意，这也是令人困惑的。</li><li id="408a" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">最后，同样令人难以置信的是，你将很快遇到<a class="ae nl" href="https://www.andre-gaschler.com/rotationconverter/" rel="noopener ugc nofollow" target="_blank">欧拉角</a>，这是俯仰、滚动和偏航的数学说法。相对于您正在查看的对象位置的角度。</li></ul><h2 id="6710" class="me mf it bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated">模型</h2><p id="b37c" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">Bon，说几句关于这篇文章标题的模型，一个我从<a class="ae nl" href="https://sketchfab.com/3d-models?date=week&amp;features=downloadable&amp;sort_by=-likeCount&amp;cursor=bz0zJnA9MjE%3D" rel="noopener ugc nofollow" target="_blank">这里</a>下载的模型。一个只用了两行代码就展示出来的模型，是的——我在这里展示的只有两行。</p><pre class="kj kk kl km gt nm nf nn no aw np bi"><span id="d77c" class="me mf it nf b gy nq nr l ns nt">struct GameScene : View {<br/>  var body: some View {<br/>    let scene = SceneView(scene: SCNScene(named: "BTL-S8_K-wing_assault_starfighter.usdz"), options: [.autoenablesDefaultLighting,.allowsCameraControl])<br/>    return scene<br/>  }<br/>}</span></pre><p id="906b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我应该提到重要的一点——我只是用鼠标改变相机的位置来移动这个物体，仅此而已。</p><h1 id="3248" class="nu mf it bd mg nv nw nx mj ny nz oa mm jz ob ka mp kc oc kd ms kf od kg mv oe bi translated">通过SwiftUI控制的场景视图动画</h1><p id="216d" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">正如我在开始时说的，尽管我喜欢玩星球大战模型，但你应该专注于正方形和平面。我想让这一节看看如何建立旋转书的定义。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0c473674c96f0aeba75bc25eed26c94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8KgfxvEmZiI5Fy_eL3kzCA.gif"/></div></div></figure><p id="2f07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我来描述一下你们在这里看到的，当然是用编码语言。</p><ul class=""><li id="117a" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">我创建了一个有六个节点的场景；一个是摄像机——一个是2D广场的<code class="fe nc nd ne nf b">planeNode</code>,其余的是照明节点。我把一切都保持得很简单。</li><li id="004d" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">问题中的节点是平行的，所以相机与正方形成直角，直接看着它。</li><li id="41e2" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">四个照明节点有效地使<code class="fe nc nd ne nf b">plainNode</code>爆炸，因此没有阴影。</li><li id="25d7" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">我将一个图像映射到一些字典定义的正方形中。</li><li id="4774" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">我在动画中翻转节点八次，同时变换它十次[你能抓住所有的变换吗]。[我用iMovie编辑了实际运行]。</li><li id="7461" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">尽管这是最小的交互，场景嵌入其中的SwiftUI界面通过每2.1秒触发一次的递归例程来管理过渡的定时——需要使用<code class="fe nc nd ne nf b">@MainActor</code>来运行所述功能。</li><li id="9c07" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">每次它启动时，我在我的场景中调用一个函数，这个函数通过调用<code class="fe nc nd ne nf b">SCNTransaction</code>来运行一个转换，以在2秒内动画化所述变化。</li></ul><p id="3e25" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">进行转换的代码如下所示。</p><pre class="kj kk kl km gt nm nf nn no aw np bi"><span id="7523" class="me mf it nf b gy nq nr l ns nt">let oldTransform = planeNode.transform<br/>let rotation = SCNMatrix4MakeRotation(GLKMathDegreesToRadians(degrees), 0, 1, 0)<br/>SCNTransaction.begin()<br/>SCNTransaction.animationDuration = 2<br/>planeNode.transform = SCNMatrix4Mult(rotation, oldTransform)<br/>SCNTransaction.commit()</span></pre><p id="97dd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">获得这个序列是一个挑战，发送给它的角度是<code class="fe nc nd ne nf b">45,45,-180,-45,-45,-45,-45,360,45,45</code>。在两次大的摆动中，我用这段代码翻转图像。</p><pre class="kj kk kl km gt nm nf nn no aw np bi"><span id="12f4" class="me mf it nf b gy nq nr l ns nt">planeNode.scale = SCNVector3Make(-1,1,1)</span></pre><p id="232b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至于同样重要的整体结构，场景是在我创建的一个类中设置的，该类返回一个设置了Scene和cameraNode变量的元组。我创建了一个类，在这个类中我创建了几个函数来完成我在这里概述的转换。</p><p id="06c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我决定把它上传到bitbucket，而不是发布一个怪物代码块，你可以在这里下载<a class="ae nl" href="https://bitbucket.org/wizard1066/scenekits/src/master/" rel="noopener ugc nofollow" target="_blank">并自己使用源代码。</a></p><p id="c998" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所有这些使我结束了这篇介绍性的文章——请放心，还有更多内容要介绍，我希望以后能发布更多内容。</p></div></div>    
</body>
</html>