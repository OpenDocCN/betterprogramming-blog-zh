<html>
<head>
<title>Deploy Interactive Real-Time Data Visualizations on Flask With Bokeh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用散景在Flask上部署交互式实时数据可视化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploy-interactive-real-time-data-visualizations-on-flask-with-bokeh-311239273838?source=collection_archive---------0-----------------------#2020-10-30">https://betterprogramming.pub/deploy-interactive-real-time-data-visualizations-on-flask-with-bokeh-311239273838?source=collection_archive---------0-----------------------#2020-10-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9a3f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更好的数据可视化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/812e16054195031182057b7c76ffb414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wIu_b_gojSGpJfGgAvhA3Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="efb1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Python对函数式分析工具有极好的支持，包括NumPy、SciPy、pandas、Dask、Scikit-Learn、OpenCV等等。在Python的各种数据可视化库中，<a class="ae lu" href="https://bokeh.org/" rel="noopener ugc nofollow" target="_blank"> Bokeh </a>是功能最强大的。该库支持覆盖许多常见用例的一些接口。</p><p id="894c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Bokeh的一个很棒的特性是能够将图片导出为原始的HTML和JavaScript。这允许我们将编程创建的图形注入到一个<a class="ae lu" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>应用程序的模板中。当用户连接到您的Flask web应用程序时，散景图像会实时创建并嵌入到提供的HTML中。</p><p id="4155" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于我们的例子，我们将为电影数据创建一个交互式浏览器。我们的项目将以UI小部件(滑块，菜单)为特色，当改变时，更新显示的数据。</p><p id="fa2a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将涵盖:</p><ol class=""><li id="5e9c" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">如何创建具有五个数据点的交互式散景图</li><li id="175f" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">集成一个包含3000个数据点的免费云数据库(<a class="ae lu" href="http://easybase.io" rel="noopener ugc nofollow" target="_blank"> Easybase.io </a>)</li><li id="f2e5" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">如何将散景图注入烧瓶模板</li><li id="be7d" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">使用JavaScript回调(<code class="fe mj mk ml mm b"><a class="ae lu" href="https://docs.bokeh.org/en/latest/docs/user_guide/interaction/callbacks.html" rel="noopener ugc nofollow" target="_blank">CustomJS</a></code>)添加散景小部件来查询数据</li></ol></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="cd7b" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第一部分</h1><p id="5956" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">第一步是执行<code class="fe mj mk ml mm b">pip install bokeh</code>和<code class="fe mj mk ml mm b">pip install Flask</code>，将散景库和Flask库安装到Python实例中。创建一个名为<code class="fe mj mk ml mm b">app.py</code>的文件，从下面的代码开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="53a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">变量<code class="fe mj mk ml mm b">source</code>用于以散景元素标准化的方式表示数据。我们将把我们的数据传递给那个对象，这个对象被提供给散景图。它被构造成一个对象，将键映射到一个值数组。稍后我们将看到如何使用<code class="fe mj mk ml mm b">CustomJS</code>直接访问和操作它。</p><p id="4dd0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，<code class="fe mj mk ml mm b">fig</code>表示散景视觉组件。<code class="fe mj mk ml mm b">tooltips</code>参数设置当您将鼠标悬停在可视化中的某个点上时，显示框中显示的内容。该数组的元组被构造为<code class="fe mj mk ml mm b">("NAME TO DISPLAY", "@COLUMN_NAME_IN_SOURCE"</code>。要编辑图形上单个点的大小，您可以编辑<code class="fe mj mk ml mm b">fig.circle()</code>中的尺寸参数。保持<code class="fe mj mk ml mm b">x</code>、<code class="fe mj mk ml mm b">y</code>和<code class="fe mj mk ml mm b">color</code>参数不变，因为我们将在后面看到如何有条件地改变这些参数。</p><p id="b5cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mj mk ml mm b">axis_label</code>变量控制可视化的X轴和Y轴上显示的内容。在我们的例子中，X轴将测量电影的IMDB评级，Y轴将测量烂番茄评级。我们稍后会看到(显然)两者之间存在正相关关系。</p><p id="d5bf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们可以实现以下代码，将一些数据传递到我们的图形中，并在浏览器中显示它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="809d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第二部分之前，我们将使用一个由五个示例词典组成的数组，这些词典包含各种与电影相关的属性。我们最终将从EasyBase检索3000条实时记录。</p><p id="f5df" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe mj mk ml mm b">source.data</code>中设置的属性是散景的参考，即一个元素应该在图形中的什么位置显示，以及它应该如何显示。如前所述，这个变量的结构是一个将所有属性映射到相应数组的字典。出于这个原因，我们使用内联数组构造语法从数据中获取每个属性并将其放入数组中。</p><p id="46c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以看到这些元素在我们的散景图中的使用位置:<code class="fe mj mk ml mm b">x</code>、<code class="fe mj mk ml mm b">y</code>和<code class="fe mj mk ml mm b">color</code>被传递到<code class="fe mj mk ml mm b">fig.circle()</code>方法中，<code class="fe mj mk ml mm b">title</code>、<code class="fe mj mk ml mm b">genre</code>、<em class="nt">、</em>被传递到工具提示中(我们将在后面使用<code class="fe mj mk ml mm b">released</code>、<code class="fe mj mk ml mm b">imdbvotes</code>和<code class="fe mj mk ml mm b">genre</code>)。随意改变每个数组中的值。例如，如果你想让点的颜色符合它的类型，<code class="fe mj mk ml mm b">color = ["#FF9900" for d in currMovies]</code>就是你要做的，或者<code class="fe mj mk ml mm b">color = ["#008800" if d['genre'] == "drama" else "#FF9900" for d in curMovies]</code>。</p><p id="7f30" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，<code class="fe mj mk ml mm b">output_file</code>指向您想要保存您的后期图形的位置。<code class="fe mj mk ml mm b">show(fig)</code>将图形保存在该位置，并在浏览器中打开。</p><p id="98dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行该文件，您将看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/268bc0dafe4c1239b19e65a46e6dfcef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uHvfS7jDafqRxQBm8YmdqA.png"/></div></div></figure><p id="0991" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还不太令人兴奋，但是你可以将鼠标悬停在任何一点上来获得关于这部电影的具体信息，就像在<code class="fe mj mk ml mm b">tooltips</code>中设定的那样。此外，尝试在这个UI上平移和缩放。这个功能以后会派上用场。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="7e26" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第二部分</h1><p id="e2a9" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">这里有一个到一个<a class="ae lu" href="https://bit.ly/3lXvOnE" rel="noopener ugc nofollow" target="_blank"> CSV文件</a>的链接，该文件包含3000个与我们示例中的属性相同的电影记录。</p><p id="cb37" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们把我们的记录放在数据库中，这样我们就可以从一个合适的源异步地访问和操作它们。我打算用<a class="ae lu" href="https://easybase.io" rel="noopener ugc nofollow" target="_blank"> Easybase.io </a>因为它是免费的，你不用下载任何东西(<a class="ae lu" href="https://easybase.io/about/" rel="noopener ugc nofollow" target="_blank">在这里了解更多</a>)。此外，用CSV或JSON文件填充集合也非常容易。</p><p id="2af2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">登录EasyBase，创建一个至少包含以下各列的表(如果愿意，可以随意添加所有属性):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/2b0292615d67d07338b2e0bf4136c6c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hDw4nWKf6OPF_O0HtKeByA.png"/></div></div></figure><p id="5aea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该表打开后，单击+号并导航至“上传数据”屏幕。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/39a4e8a2997e149adca2a60609dccd71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1X6B3-CKBQhdZYDh0HDLjQ.gif"/></div></div></figure><p id="b57d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将CSV文件拖放到该对话框中。最终的集合将类似于以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/382a039f06bdca9d73ce2a81a44bfd01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFqTYnVUysKEpXuHgcw7Ww.png"/></div></div></figure><p id="2644" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请记住，您可以随时从EasyBase下载CSV或JSON格式的数据，方法是选择“全部”(在+下),然后进入“共享”</p><p id="d79b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">去整合→休息→获取。打开新的集成，在Get下添加所有的列。保存它，然后打开集成弹出窗口。我的看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/50028d4e1afb98904ea5c64a9b3a80ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*N4mjl0oiL0yVdYdF5bCGsQ.gif"/></div></div></figure><p id="f75b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请记下您的集成ID，因为这是我们从Python应用程序中检索数据的方式。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="ef4c" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第三部分</h1><p id="779a" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">现在让我们把我们的应用程序变成一个烧瓶项目。导航到与<code class="fe mj mk ml mm b">app.py</code>相同的目录。创建一个名为<code class="fe mj mk ml mm b">templates</code>的文件夹，并添加一个名为<code class="fe mj mk ml mm b">index.html</code>的文件。</p><pre class="kj kk kl km gt nz mm oa ob aw oc bi"><span id="6757" class="od mv it mm b gy oe of l og oh">project<br/>├── templates<br/>│   └── index.html<br/>└── app.py</span></pre><p id="e8bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看看<code class="fe mj mk ml mm b">app.py</code>中一个非常简单的Flask实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="98cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Mac上用<code class="fe mj mk ml mm b">export FLASK_APP=app.py &amp;&amp; flask run</code>或者在Windows上用<code class="fe mj mk ml mm b">set FLASK_APP=app.py &amp;&amp; flask run</code>运行这个程序将会创建一个本地web服务器。在web浏览器中导航到<code class="fe mj mk ml mm b">localhost:5000</code>，应用程序将返回<code class="fe mj mk ml mm b">templates/index.html</code>的内容。让我们用以下内容填充<code class="fe mj mk ml mm b">index.html</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="ed38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个非常简单的HTML网页，有四个液体属性:<code class="fe mj mk ml mm b">js_resources</code>、<code class="fe mj mk ml mm b">css_resources</code>、<code class="fe mj mk ml mm b">plot_script</code>和<code class="fe mj mk ml mm b">plot_div</code>。散景会给我们所有的变量，我们将传递到这四个属性。</p><p id="200d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们将把第一部和我们的<code class="fe mj mk ml mm b">app.py</code>结合起来。让我们从添加所有正确的导入开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="2c52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在调用<code class="fe mj mk ml mm b">return render_template("index.html")</code>之前，将<strong class="la iu">第一部分</strong>中的代码添加到<code class="fe mj mk ml mm b">index()</code>方法中。</p><p id="b3af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将用一个对EasyBase的<code class="fe mj mk ml mm b">get()</code>调用来替换我们的硬编码电影数组。如果您没有安装EasyBase Python库，请快速执行<code class="fe mj mk ml mm b">pip install easybase-python</code>。我用以下方法替换第一部分中的数组:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="be17" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mj mk ml mm b">get()</code>的第一个参数是之前的集成ID，后面是<code class="fe mj mk ml mm b">offset</code>、<code class="fe mj mk ml mm b">length</code>和<code class="fe mj mk ml mm b">authentication</code>。</p><p id="daf4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">类似于第一部分，这个方法返回一个字典数组。这些字典具有与以前相同的属性。</p><p id="e014" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们的<code class="fe mj mk ml mm b">index()</code>方法中，我们将修改当前的<code class="fe mj mk ml mm b">return render_template("index.html")</code>。将该行替换为以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="94e9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是注入到HTML模板中的内容的映射。</p><ul class=""><li id="9af6" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt oi mb mc md bi translated"><code class="fe mj mk ml mm b">plot_script</code>:特定于图形的JavaScript</li><li id="92d2" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt oi mb mc md bi translated"><code class="fe mj mk ml mm b">plot_div</code>:包装在&lt; div &gt;标签中的特定于图形的HTML</li><li id="0c59" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt oi mb mc md bi translated"><code class="fe mj mk ml mm b">js_resources</code>:一般散景所需的JavaScript</li><li id="7c28" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt oi mb mc md bi translated"><code class="fe mj mk ml mm b">css_resources</code>:普通散景所需的CSS</li></ul><p id="72cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此时<code class="fe mj mk ml mm b">app.py</code>会是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="487a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Mac上用<code class="fe mj mk ml mm b">export FLASK_APP=app.py &amp;&amp; flask run</code>或者在Windows上用<code class="fe mj mk ml mm b">set FLASK_APP=app.py &amp;&amp; flask run</code>运行这个程序。你在<code class="fe mj mk ml mm b">localhost:5000</code>的网站应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/a8dfda14ee73813b39c609562f4dd0db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RLm5wWGzyGCq5hnjZ3iExQ.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="9d02" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">第四部分</h1><p id="e65a" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">所以现在我们有了一个在Flask中展示的散景模型。我们的最终目标是添加一些用户可以与之交互来操作数据的UI小部件。</p><p id="3214" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们所有的改变都将在<code class="fe mj mk ml mm b">index()</code>方法之内。我非常努力地使下面的实现易于扩展。</p><p id="073c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们首先创建一个控件字典:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="4e42" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里我们有三个滑块和一个下拉菜单。随意编辑或添加任何自定义小部件到这个字典中。</p><p id="d3ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们需要实现一个回调，当我们的任何控件发生变化时就会发生回调。这是通过散景的<code class="fe mj mk ml mm b"><a class="ae lu" href="https://docs.bokeh.org/en/latest/docs/user_guide/interaction/callbacks.html" rel="noopener ugc nofollow" target="_blank">CustomJS</a></code>模块完成的。这一部分可能会变得很棘手，但我已经尽我所能把它分解了。我们将从创建回调变量开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="05d1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每次输入发生变化时，都会调用此<code class="fe mj mk ml mm b">code</code> <em class="nt"> </em>函数。它用可访问的参数<code class="fe mj mk ml mm b">source</code>(原始数据)和<code class="fe mj mk ml mm b">controls</code>(控制字典)来调用。这个<code class="fe mj mk ml mm b">code</code>的第一部分检查是否有一个全局JavaScript变量调用<em class="nt"> </em> <code class="fe mj mk ml mm b">full_data_save</code> <em class="nt">。由于这个函数第一次运行时并不存在，它将对我们的原始数据做一个深层拷贝，并保存到全局变量中。</em></p><p id="0d33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从这一点来看，这个变量将不会改变，所以我们总是有一个引用我们的原始数据。接下来，我们创建一个名为<code class="fe mj mk ml mm b">new_data</code>的新对象，它采用与源数据相同的形式。然后遍历所有原始数据，检查它是否满足控件的值。我们可以看到，控件的值是通过<code class="fe mj mk ml mm b">controls.<em class="nt">control_name</em>.value</code>、<em class="nt">、</em>访问的，类似于通过<code class="fe mj mk ml mm b">CustomJS</code>参数中的参数访问原始数据。因为我的<code class="fe mj mk ml mm b">released</code>属性的格式是MM-DD-YYYY，所以我只使用最后四个字符与<code class="fe mj mk ml mm b">min_year</code>和<code class="fe mj mk ml mm b">max_year</code>进行比较(第17–18行)。如果一个单独的元素满足所有的定制查询，它将被推送到<code class="fe mj mk ml mm b">new_data</code> <em class="nt"> </em>中，下面一行是:</p><pre class="kj kk kl km gt nz mm oa ob aw oc bi"><span id="86f9" class="od mv it mm b gy oe of l og oh">Object.keys(new_data).forEach(key =&gt; new_data[key].push(full_data[key][i]));</span></pre><p id="6799" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这只是将所有属性从索引<code class="fe mj mk ml mm b">i</code>处的原始完整数据推送到<code class="fe mj mk ml mm b">new_data</code>的相应数组中。</p><p id="da88" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">遍历完整数据后，将源数据指向新数据。最后，用<code class="fe mj mk ml mm b">source.change.emit()</code>发出变更。</p><p id="fbc9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我试图使其可扩展，所以添加新控件的工作流程如下:</p><ol class=""><li id="ad68" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">向<code class="fe mj mk ml mm b">controls</code>字典添加新的小部件。</li><li id="7c66" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">在<code class="fe mj mk ml mm b">CustomJS</code>中，在第15行的if语句中添加自定义条件语句。</li></ol><p id="0855" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，为了激活这个回调，我们使用一个循环来分配所有。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="e20f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后一步是将我们的控件添加到一个<code class="fe mj mk ml mm b"><a class="ae lu" href="https://docs.bokeh.org/en/latest/docs/user_guide/layout.html" rel="noopener ugc nofollow" target="_blank">layout</a></code>中。将我们之前的<code class="fe mj mk ml mm b">script, div = components(fig)</code>替换为以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="fbdf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这创建了一列名为<code class="fe mj mk ml mm b">input_controls</code>的控件，后面是一行<code class="fe mj mk ml mm b">input_controls</code>和我们的图形。现在，我们将该行传递给<code class="fe mj mk ml mm b">components()</code>方法，而不仅仅是数字。</p><p id="4513" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们运行Flask应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/81f8733fd24fcf0fd2660770cd97cec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JKFdxcuGe8gQmROvAUaXaw.gif"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="0799" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">结论</h1><p id="448c" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">我们的应用程序已经成功地将一个交互式的散景图与定制的JavaScript回调函数集成在一起。回调在我们的任何控件被编辑时运行，并允许来自多个源的交互式查询。Python使用<code class="fe mj mk ml mm b">easybase-python</code>包从Easybase.io中提取了数千条实时记录，这些技术都在本地Flask实例上成功运行。</p><p id="00c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将为用户添加一个从Flask应用程序向数据库添加数据的路径。我们的散景图像会实时更新。</p><p id="edd6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！如有任何问题，请随时回复。</p><p id="eeec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面我添加了<code class="fe mj mk ml mm b">app.py</code>的完整源代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="b022" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nt">你建了，他们就来了。</em></p></div></div>    
</body>
</html>