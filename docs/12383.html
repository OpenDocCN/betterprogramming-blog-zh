<html>
<head>
<title>Understanding the Network IO Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解网络IO模型</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/understanding-the-network-io-model-e89b169eb128?source=collection_archive---------12-----------------------#2022-06-01">https://betterprogramming.pub/understanding-the-network-io-model-e89b169eb128?source=collection_archive---------12-----------------------#2022-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="27ea" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">网络IO常见知识点</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9942ac9ed530eba900b9512b2d37fde7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x8YBdLYicd0y02Tb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@joannakosinska?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔安娜·科辛斯卡</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="d89a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在网络编程中，经常提到阻塞、非阻塞、同步和异步。</p><p id="0524" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我结合了网上的各种学习资料进行总结，辨析，加深理解。</p><p id="517e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我今天与你分享这些。</p><h1 id="2951" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">数据流</strong></h1><p id="b28e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">网络IO操作的实际过程涉及到内核和调用这个IO操作的进程。</p><p id="9364" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以<code class="fe ms mt mu mv b">read</code>为例，具体操作<code class="fe ms mt mu mv b">read</code>分为以下两部分:</p><p id="6b7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(1)内核等待数据被读取。</p><p id="9b8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(2)将内核读取的数据复制到进程中。</p><p id="19b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">详细流程如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/2249a972b29278a8a3d97bea15af5e25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mfj3qEX8IbBqEPsjI9w9wQ.png"/></div></div></figure><h1 id="b110" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">网络Io模型的详细分析</h1><p id="ea90" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">常见的IO模型包括阻塞、非阻塞、IO多路复用和异步。这四个概念用一个生动的例子来说明。</p><p id="73ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我和女朋友周末去购物了。中午我们饿了，要去吃饭。</p><p id="e47d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于是周末，人很多，吃饭需要排队。我和我的女朋友有以下选择:</p><h2 id="cfed" class="mx lw it bd lx my mz dn mb na nb dp mf li nc nd mh lm ne nf mj lq ng nh ml ni bi translated"><strong class="ak"> <em class="nj">计划一</em> </strong></h2><p id="6ec9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我和女朋友点了饭后，不知道什么时候能做好，只好坐在餐厅里等着做好，吃完就走。</p><p id="a8c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我女朋友想和我一起去逛街，但是我不知道饭什么时候能做好，所以我只能在餐馆里等着，而不是去逛街。</p><p id="634d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">吃完了才能去逛街，等着做饭浪费时间。这是典型的阻塞。</p><p id="bc47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">网络中的IO阻塞如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/c9c028fa7b987a7e64ca072415c50266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5x5IvlbsCH9I-LgM0WZ0A.png"/></div></div></figure><h2 id="4298" class="mx lw it bd lx my mz dn mb na nb dp mf li nc nd mh lm ne nf mj lq ng nh ml ni bi translated"><strong class="ak"> <em class="nj">计划二</em> </strong></h2><p id="d8e3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我的女朋友不愿意白等。她想去购物，但她担心饭什么时候能做好。</p><p id="88f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">于是我们逛了一会儿，回来问服务员饭好了没有。我们来来回回走了很多次，但我们仍然没有吃到饭，我们很累。</p><p id="ca42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是非阻塞的，需要不断的查询来查看它是否准备好了。</p><p id="afcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">网络IO非阻塞如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/4914d15e6619c020af1880f11aec776f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lqq3ZogHKB_Khjz8USQGAA.png"/></div></div></figure><h2 id="ab11" class="mx lw it bd lx my mz dn mb na nb dp mf li nc nd mh lm ne nf mj lq ng nh ml ni bi translated"><strong class="ak"> <em class="nj">计划三</em> </strong></h2><p id="ad5f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">和第二种解决方案类似，餐厅安装了电子屏显示订单状态，我和女朋友可以去逛一会儿，回来的时候不用问服务员，看着电子屏就可以了。</p><p id="9e04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，大家的饭菜好不好，可以通过看电子屏幕直接显示出来。这是典型的IO复用，比如<code class="fe ms mt mu mv b">select</code>、<code class="fe ms mt mu mv b">poll</code>、<code class="fe ms mt mu mv b">epoll</code>。</p><p id="2a0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">网络IO的具体型号如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/0603199e9657101c3e7f81af42f78c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vPdjwsUqWIiQU-wdSHgM1A.png"/></div></div></figure><h2 id="9f1b" class="mx lw it bd lx my mz dn mb na nb dp mf li nc nd mh lm ne nf mj lq ng nh ml ni bi translated"><strong class="ak"> <em class="nj">计划四</em> </strong></h2><p id="6dc0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">女朋友不想逛街，餐厅太吵，我们就回家好好休息了。</p><p id="9334" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而是点了外卖，打了个电话订餐，然后我和女朋友就可以在家好好休息了。饭菜做好后，送货员会给我们送来食物。</p><p id="2178" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是典型的异步模式。你只需要打个电话，然后你就可以做自己的事情了，饭就送来了。</p><p id="3fae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Linux提供了AIO库函数来实现异步，但很少使用。</p><p id="55af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多开源的异步IO库，比如<code class="fe ms mt mu mv b">libevent</code>、<code class="fe ms mt mu mv b">libev</code>、<code class="fe ms mt mu mv b">libuv</code>。</p><p id="fccf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">异步流程如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/e1a3fdb36ede3c1deb747e91f1aee008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YIs8UCNcGlTnh7bFaJiLDg.png"/></div></div></figure><h1 id="3cb8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">同步和异步</strong></h1><p id="8dd2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">事实上，同步和异步是为了应用程序和内核之间的交互。</p><p id="c117" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在同步过程中，该过程触发IO操作，并等待或轮询以查看IO操作是否完成。</p><p id="a16c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在异步进程中，进程触发IO操作后，直接返回，做自己的事。IO被交给内核进行处理。完成后，内核通知进程IO已经完成。</p><p id="9f52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同步和异步如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/ad4f456ddcdb4c032f49210d9099b864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HOhSjddOQoLDYufDoSemBw.png"/></div></div></figure><h1 id="0df1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">阻塞和非阻塞</strong></h1><p id="9d5c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">简单的理解就是，如果你需要做一件事，你可以马上得到回报响应。如果不能马上得到回报，需要等待，就会被屏蔽，否则可以理解为不屏蔽。</p><p id="a0e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">详细差异如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/5ee527ba4e7c413594502d1902b1465b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6L5NJw3qoHWt4FUybVONw.png"/></div></div></figure></div><div class="ab cl nq nr hx ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="im in io ip iq"><p id="5ca1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nx">感谢您阅读本文。</em></p><p id="b214" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nx">敬请期待更多。</em></p></div></div>    
</body>
</html>