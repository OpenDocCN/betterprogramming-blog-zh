<html>
<head>
<title>Dark and Light Mode: An OS Color Scheme and Theme Switcher</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">明暗模式:一个操作系统配色方案和主题切换器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/dark-and-light-mode-os-color-scheme-and-theme-switcher-8fbc7e9610f6?source=collection_archive---------13-----------------------#2019-12-30">https://betterprogramming.pub/dark-and-light-mode-os-color-scheme-and-theme-switcher-8fbc7e9610f6?source=collection_archive---------13-----------------------#2019-12-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="537a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将继承OS配色方案的主题切换器作为默认状态添加到应用程序中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d2b03205c7d2f2632eb01a5766849adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EqOsVaqdhDXCI2Vwi7YAwg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sincerelymedia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">真诚媒体</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="f1b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多关于“黑暗模式”主题的好教程，但是在我看来，很少有一个教程涵盖了在实际应用中实现这种模式的两个主要目标。它们分别让用户能够在主题之间切换，同时默认继承平台提供的操作系统配色方案，特别是谷歌和苹果都开始在产品中推出这种模式。</p><p id="3275" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我写这篇文章来分享我们在贡献者的帮助下实现的解决方案，在我们用于演示的开源web编辑器<a class="ae ky" href="https://deckdeckgo.com" rel="noopener ugc nofollow" target="_blank"> DeckDeckGo </a>中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="db6b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><p id="bf46" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了实现我们的解决方案，我们依赖于两个令人惊叹的软件:</p><ul class=""><li id="0eb0" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">idb-keyval :一个超级简单的、小型的、基于承诺的keyval存储，用IndexedDB实现，我们用它来保存用户选择。</li><li id="7e5a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">RxJS:JavaScript的反应式扩展库，我们用它来存储和传播内存中表示主题的状态。</li></ul><p id="ebd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用一个运行时值来切换主题。因此，也有可能使用<a class="ae ky" href="https://react-redux.js.org" rel="noopener ugc nofollow" target="_blank"> React Redux </a>存储状态来实现这样的解决方案。不要犹豫，平我，如果你想得到这样的例子；在我目前正在开发的另一个新应用程序中，我也准备了一个。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5452" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">单身服务</h1><p id="7eb8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了处理我们的主题状态，我们创建了一个普通的单例服务。如果您正在使用像<a class="ae ky" href="https://angular.io" rel="noopener ugc nofollow" target="_blank"> Angular </a>这样的框架，那么像往常一样创建一个根范围的服务，或者如果您喜欢使用函数和静态值，那么就这样做。重要的是，只在内存中加载和保存一个代表所有应用程序的应用主题的状态。</p><p id="0e3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的服务中，我们声明了一个布尔值<code class="fe nn no np nq b">darkTheme</code>，它被设置为<code class="fe nn no np nq b">true</code>，意味着“黑暗主题激活”，而<code class="fe nn no np nq b">false</code>表示“光明主题激活”如果有两个以上的主题可用，我们可以使用一个<code class="fe nn no np nq b">enum</code>。这种扩展的可能性是这种实现的一个很酷的资产。</p><p id="9848" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们使用了一个<code class="fe nn no np nq b">ReplaySubject&lt;1&gt;</code>，因为我们想在内存中保存一个没有值的状态，直到我们决定应用什么主题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="05d2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">观察和切换状态</h1><p id="d011" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们的服务已经准备好了，我们必须公开应用程序的状态，并为用户提供切换主题的方法。我们还必须保存选择，以便下次应用程序重新启动时加载它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f26e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">初始偏好</h1><p id="717d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在启动时，我们必须按照以下步骤加载主题:</p><ul class=""><li id="b647" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">用户是否已经有了偏好的主题集？</li><li id="a16f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我们是否无法读取此信息(是否出现错误)？</li><li id="581a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">是否应该使用平台提供的OS默认配色？</li></ul><p id="8bfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回答完这些问题后，我们创建一个实现这个逻辑的函数，并使用我们之前的<code class="fe nn no np nq b">switch</code>方法来传播主题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dbd1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将主题应用于DOM</h1><p id="da0b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们特意没有在服务中应用“图形化”主题。因此，我们现在必须决定在哪里对DOM进行修改。</p><p id="adce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的项目中，当我们用<a class="ae ky" href="https://stenciljs.com" rel="noopener ugc nofollow" target="_blank">模板</a> web组件开发应用程序时，我们已经开始在根组件(<code class="fe nn no np nq b">app-root.tsx)</code>中初始化。</p><p id="8bd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们正在观察同一个组件的变化，因为在应用程序关闭之前它不会被破坏。这样，在发出每个新状态时，我们修改DOM，更准确地说是修改<code class="fe nn no np nq b">body</code>元素，以应用或删除CSS类名(在我们的例子中是<code class="fe nn no np nq b">dark</code>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9c5a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">主题切换器</h1><p id="1941" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">到目前为止，我们的应用程序只能处理操作系统首选的配色方案，并没有给用户切换主题的能力。这就是为什么我们将创建一个新的组件，例如，它公开了一个<a class="ae ky" href="https://ionicframework.com/docs/api/toggle" rel="noopener ugc nofollow" target="_blank"> Ionic toggler </a>来在亮暗模式之间切换。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="168c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">式样</h1><p id="8a8c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你可以使用CSS变量或者仅仅是属性来设计主题。在这两种情况下，重要的是根据我们刚刚在<code class="fe nn no np nq b">body</code>元素上分别设置的类名<code class="fe nn no np nq b">dark</code>来应用主题。</p><p id="9922" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你使用Ionic，你将能够在你的<code class="fe nn no np nq b">variables.scss</code> ( <code class="fe nn no np nq b">:root</code>没有选择器作为灯光主题)中设计一个特定的背景和文本颜色:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="1772" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者另一个普通HTML/CSS的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b8c1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一起</h1><p id="dcbc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们的项目DeckDeckGo是开源的。所以，我用我们遥控器的一些GitHub参考来和大家分享一下上面的实现:</p><ul class=""><li id="6b52" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">单身服务:<a class="ae ky" href="https://github.com/deckgo/deckdeckgo/blob/master/remote/src/app/services/theme/theme.service.tsx" rel="noopener ugc nofollow" target="_blank">主题服务</a>。分时（同timesharing）</li><li id="b965" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">初始化并观察:<a class="ae ky" href="https://github.com/deckgo/deckdeckgo/blob/master/remote/src/app/app-root.tsx" rel="noopener ugc nofollow" target="_blank"> app-root.tsx </a></li><li id="6768" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">切换器的例子:<a class="ae ky" href="https://github.com/deckgo/deckdeckgo/blob/master/remote/src/app/components/settings/app-general-settings/app-general-settings.tsx" rel="noopener ugc nofollow" target="_blank"> app-general-settings.tsx </a></li><li id="bea0" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">样式:<a class="ae ky" href="https://github.com/deckgo/deckdeckgo/blob/master/remote/src/global/theme/variables.scss" rel="noopener ugc nofollow" target="_blank"> variables.scss </a></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/c3070f0461c6278f440d4981ce3379db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*KgzkIUhche5Netqi1kfSTQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在明暗主题之间切换</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="01ee" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">蛋糕上的樱桃</h1><p id="55d8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">也许您实际上对将代码分成不同的层并不感兴趣，而只是希望有一个单独的web组件来处理所有的事情。</p><p id="2208" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你猜怎么着？我们也有这样一个组件，一个我们在给开发者的文档<a class="ae ky" href="https://docs.deckdeckgo.com" rel="noopener ugc nofollow" target="_blank">中实现的组件。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e896" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">信用</h1><p id="cce8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如上所述，我们在贡献者的帮助下开发了这个功能，更准确地说是在格兰特·赫尔曼的帮助下。他甚至帮助我们在三个不同的应用程序中实现了它。</p><p id="870e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">肯定不是所有英雄都穿披风；谢谢你格兰特。</p></div></div>    
</body>
</html>