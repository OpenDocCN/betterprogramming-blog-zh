<html>
<head>
<title>Everything You Should Know About Instant Apps on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于安卓即时应用你应该知道的一切</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/everything-you-should-know-about-instant-apps-on-android-2ea83b18dc8e?source=collection_archive---------3-----------------------#2020-05-27">https://betterprogramming.pub/everything-you-should-know-about-instant-apps-on-android-2ea83b18dc8e?source=collection_archive---------3-----------------------#2020-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ce33" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">无需在手机上安装应用程序，即可提供即时应用程序体验</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/985e7944b9e51db02fd3300598e59b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6vP23xfete1DQgY0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@freestocks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">自由股票</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="9cd3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">从文章中摘录</h1><p id="7311" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本文中，您将学习如何为您的Android用户创建即时应用程序。除此之外，您还将了解如何提示用户安装完整版本的应用程序，测试即时应用程序的正确方法，如何使用带有URL的即时应用程序，等等。请继续阅读，了解它们。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="2b70" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">介绍</h1><p id="f915" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="mz">即时应用</em>是一种无需明确安装即可提供安卓应用原生体验的技术。</p><p id="2633" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">当您的Android应用程序具有即时应用程序功能时，用户将在Google Play商店的应用程序详细信息屏幕上看到“安装”旁边的“立即尝试”按钮。点击“立即尝试”按钮，一个虚拟应用程序就安装好了。</p><p id="2c1c" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">此时只会下载开发人员在清单文件中声明为即时应用的模块。这允许用户在安装整个应用程序之前简单体验应用程序。如果您的应用程序很大，此选项将提供应用程序的功能，而无需实际下载。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f4c2" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">要记住的事情</h1><p id="aa01" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在我们知道了什么是即时应用，以及它如何对用户和企业主有所帮助。尽管它提供了许多好处，但也有一些限制。</p><ol class=""><li id="e39d" class="nf ng it lt b lu na lx nb ma nh me ni mi nj mm nk nl nm nn bi translated">支持即时应用的应用捆绑包只能使用少数应用权限，如<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#ACCESS_COARSE_LOCATION" rel="noopener ugc nofollow" target="_blank">ACCESS_COARSE_LOCATION</a></code>、<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#ACCESS_FINE_LOCATION" rel="noopener ugc nofollow" target="_blank">ACCESS_FINE_LOCATION</a></code>、<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#ACCESS_NETWORK_STATE" rel="noopener ugc nofollow" target="_blank">ACCESS_NETWORK_STATE</a></code>、<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#CAMERA" rel="noopener ugc nofollow" target="_blank">CAMERA</a></code>、<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#INSTANT_APP_FOREGROUND_SERVICE" rel="noopener ugc nofollow" target="_blank">INSTANT_APP_FOREGROUND_SERVICE</a></code>、【仅在Android 8.0 (API等级26及以上)】、<em class="mz">、</em>、<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#INTERNET" rel="noopener ugc nofollow" target="_blank">INTERNET</a></code>、<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#READ_PHONE_NUMBERS" rel="noopener ugc nofollow" target="_blank">READ_PHONE_NUMBER</a></code>、<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#RECORD_AUDIO" rel="noopener ugc nofollow" target="_blank">RECORD_AUDIO</a></code>、<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#VIBRATE" rel="noopener ugc nofollow" target="_blank">VIBRATE</a></code>、<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/Manifest.permission#WAKE_LOCK" rel="noopener ugc nofollow" target="_blank">WAKE_LOCK</a></code>。</li><li id="e413" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm nk nl nm nn bi translated">默认情况下，即时应用程序无法与已安装的应用程序进行交互，除非满足以下条件之一:<br/> a .)已安装的应用程序中至少有一个活动在其清单文件中应具有标记为<code class="fe no np nq nr b">true</code>的属性<code class="fe no np nq nr b">android:visibleToInstantApps</code>。<br/>b .)<strong class="lt iu"/><strong class="lt iu"/>已安装的app包含一个<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.android.com/reference/android/content/Intent#CATEGORY_BROWSABLE" rel="noopener ugc nofollow" target="_blank">CATEGORY_BROWSABLE</a></code>意图过滤器。</li><li id="df06" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm nk nl nm nn bi translated">即时应用功能建立在Android应用捆绑包的基础上，使用Android Lollipop中引入的split APKs功能。因此，开发人员需要将他们的应用程序分发从传统的APK改为Android应用程序捆绑包，以便使用即时应用程序。</li></ol></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="bf45" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">综合</h1><p id="c94f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通过在应用程序级<code class="fe no np nq nr b">build.gradle</code>文件的依赖关系节点下添加以下代码行，将Google Play Instant API包含在您的应用程序中。</p><pre class="kj kk kl km gt nx nr ny nz aw oa bi"><span id="cc7a" class="ob la it nr b gy oc od l oe of">implementation "com.google.android.gms:<strong class="nr iu">play-services-instantapps</strong>:17.0.0"</span></pre><p id="3877" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">如果你正在使用任何以前的即时应用插件，你可以删除它们。新的即时API不需要任何插件，有了这个新的API，你可以对即时和完整版本的应用程序使用一个代码。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f678" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">实现即时体验</h1><h2 id="3b40" class="ob la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">版本代码维护</h2><p id="cece" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你的app即时体验的版本代码应该小于app的实际版本代码。这是因为当用户从即时应用程序转移到完整应用程序安装时，Google Play会将其视为应用程序更新。所以版本代码的升序是有意义的。</p><p id="62bb" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">即使用户已经安装了应用程序，他们也可以通过URL来体验即时应用程序，稍后您会看到这一点。但在此之前，你应该小心版本代码——在任何情况下，即时应用程序应该有更少的版本代码。</p><p id="a524" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">谷歌的建议是大幅增加可安装APK的版本号，比如1000，以确保有足够的空间让你的即时体验版本号增加。</p><h2 id="7cac" class="ob la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">沙盒版本</h2><p id="d032" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如我所说，即时应用程序不会安装在设备中。相反，它们将从沙盒存储中操作。为此，我们需要在清单文件中包含<code class="fe no np nq nr b">targetSandboxVersion</code>属性，如下所示:</p><pre class="kj kk kl km gt nx nr ny nz aw oa bi"><span id="821c" class="ob la it nr b gy oc od l oe of">&lt;manifest<br/>   xmlns:android="http://schemas.android.com/apk/res/android"<br/>  ...<br/>   <strong class="nr iu">android:targetSandboxVersion="2"</strong> ...&gt;</span></pre><h2 id="02eb" class="ob la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">在模块级别实现即时体验</h2><p id="2a1d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了使模块支持即时应用程序，我们只需要在清单文件中添加下面一行，如下所示。这在基础模块和打算包含在instant-app体验中的模块中是强制性的。</p><pre class="kj kk kl km gt nx nr ny nz aw oa bi"><span id="213e" class="ob la it nr b gy oc od l oe of">&lt;manifest <br/> xmlns:dist="http://schemas.android.com/apk/distribution"&gt;<br/>    &lt;<strong class="nr iu">dist:module dist:instant="true"</strong> .../&gt;<br/>    ...<br/>&lt;/manifest&gt;</span></pre><h2 id="7d1a" class="ob la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">带有即时应用程序的动态模块</h2><p id="f431" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们也可以在即时应用中使用动态功能模块。创建支持即时应用的动态功能模块的最简单方法是使用Android Studio的模块模板。</p><p id="0c15" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">要创建即时动态特征模块，导航如下:</p><p id="8270" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated"><strong class="lt iu">文件&gt;新&gt;新模块</strong></p><p id="5301" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">然后，将打开一个新窗口，其中包含与不同配置相关的不同模板。在列表中选择<strong class="lt iu">T5<em class="mz">即时动态特征模块</em>选项，点击下一步。之后，您可以给模块命名，也可以给包命名。</strong></p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="4653" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">URL映射</h1><p id="cabf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你想在一个URL加载到手机上时提供即时应用程序体验，该怎么办？这是可能的，但是您应该实现以下事情来使它工作:</p><ol class=""><li id="5100" class="nf ng it lt b lu na lx nb ma nh me ni mi nj mm nk nl nm nn bi translated">首先，您应该通过将<code class="fe no np nq nr b">autoVerify </code>设置为<code class="fe no np nq nr b">true</code>来添加第二个意图过滤器。<br/> <code class="fe no np nq nr b">&lt;intent-filter android:<strong class="lt iu">autoVerify</strong>=”true”&gt;</code></li><li id="3eeb" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm nk nl nm nn bi translated">然后，在上面创建的意图过滤器下添加以下类别和操作标志。<br/> <code class="fe no np nq nr b">&lt;action android:name="android.intent.action.VIEW" /&gt;<br/>&lt;category android:name="android.intent.category.BROWSABLE" /&gt;<br/>&lt;category android:name="android.intent.category.DEFAULT" /&gt;</code></li><li id="fe5c" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm nk nl nm nn bi translated">最后，我们需要添加URL模式，如下所示:</li></ol><pre class="kj kk kl km gt nx nr ny nz aw oa bi"><span id="c911" class="ob la it nr b gy oc od l oe of">&lt;data android:scheme="http"/&gt;<br/>&lt;data android:scheme="https"/&gt;<br/>&lt;data android:host="example.com"/&gt;<br/>&lt;data android:path="/instantapp/schedule"/&gt;</span></pre><p id="78fe" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">我们还可以指定一个默认URL，用于更轻松地启动即时体验，如下所示:</p><pre class="kj kk kl km gt nx nr ny nz aw oa bi"><span id="caae" class="ob la it nr b gy oc od l oe of">&lt;meta-data<br/>    android:name="default-url"<br/>    android:value="https://example.com/instantapp/experience"/&gt;</span></pre><p id="bd47" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">这没什么可做的，但是当你想给别人演示的时候会很有帮助。这是可选的。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="3554" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">要求用户安装完整版</h1><p id="563c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">既然我们已经配置了即时体验，下一步就是鼓励用户安装实际的应用程序。为此，首先我们需要确认用户在即时体验中。我们可以通过使用<code class="fe no np nq nr b"><a class="ae ky" href="https://developers.google.com/android/reference/com/google/android/gms/instantapps/PackageManagerCompat.html#isInstantApp%28%29" rel="noopener ugc nofollow" target="_blank">isInstantApp()</a></code>方法来确定。如果运行过程是即时体验，这个方法返回<code class="fe no np nq nr b">true</code>。</p><p id="0ef3" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">下一步是向用户显示一个提示，鼓励他们安装实际的应用程序。这可以按如下所示完成:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="5246" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">测试</h1><p id="9ee9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">无论做什么，测试都是让它稳定的核心事情之一。即时应用可以通过从Android Studio安装或使用内部测试功能从Play store下载来直接测试。</p><h2 id="f2b0" class="ob la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">在本地设备中测试</h2><p id="3607" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要直接从Android Studio安装，请执行以下步骤:</p><ol class=""><li id="fa27" class="nf ng it lt b lu na lx nb ma nh me ni mi nj mm nk nl nm nn bi translated">首先，如果设备中已经安装了该应用程序，请将其卸载。</li><li id="00b3" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm nk nl nm nn bi translated">然后，导航到安装选项上的常规选项卡。选择“部署为即时应用程序”</li><li id="6dbc" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm nk nl nm nn bi translated">然后点击运行按钮。</li></ol><h2 id="82dc" class="ob la it bd lb og oh dn lf oi oj dp lj ma ok ol ll me om on ln mi oo op lp oq bi translated">内部测试轨道</h2><p id="5f4e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你不确定从Play store下载的即时应用程序如何工作，那么这是一个使用内部测试轨道测试它的绝佳时机。</p><ol class=""><li id="68a5" class="nf ng it lt b lu na lx nb ma nh me ni mi nj mm nk nl nm nn bi translated">首先，像往常一样生成一个Android应用捆绑包。</li><li id="e193" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm nk nl nm nn bi translated">上传到内部测试轨道下，而不是发布管理中的生产下。</li><li id="5fef" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm nk nl nm nn bi translated">将您的测试人员的邮件id添加到测试列表中。</li><li id="6003" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm nk nl nm nn bi translated">现在用其中一封电子邮件登录。当您在Play store中搜索应用程序时，您会看到“立即尝试”选项。</li></ol></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="9f98" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">奖金</h1><p id="6888" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要了解有关动态交付和Android应用捆绑包的更多信息，请阅读以下文章:</p><ul class=""><li id="131e" class="nf ng it lt b lu na lx nb ma nh me ni mi nj mm ot nl nm nn bi translated"><a class="ae ky" href="https://medium.com/android-dev-hacks/dynamic-delivery-in-android-part-1-634c686d7170" rel="noopener">“Android中的动态交付—第一部分”</a></li><li id="533d" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm ot nl nm nn bi translated"><a class="ae ky" href="https://medium.com/android-dev-hacks/dynamic-delivery-in-android-part-2-b3999513bfc0" rel="noopener">“Android中的动态交付—第二部分”</a></li><li id="3197" class="nf ng it lt b lu ns lx nt ma nu me nv mi nw mm ot nl nm nn bi translated"><a class="ae ky" href="https://medium.com/android-dev-hacks/dynamic-delivery-in-android-part-3-3e1201c4955b" rel="noopener">“Android中的动态交付—第三部分”</a></li></ul><p id="150c" class="pw-post-body-paragraph lr ls it lt b lu na ju lw lx nb jx lz ma nc mc md me nd mg mh mi ne mk ml mm im bi translated">我希望你学到了有用的东西——感谢阅读。</p></div></div>    
</body>
</html>