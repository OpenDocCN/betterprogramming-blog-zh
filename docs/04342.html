<html>
<head>
<title>Kubernetes Tips: Create Pods With Imperative Commands in 1.18</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes提示:在1.18中使用命令式命令创建pod</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/kubernetes-tips-create-pods-with-imperative-commands-in-1-18-62ea6e1ceb32?source=collection_archive---------2-----------------------#2020-04-07">https://betterprogramming.pub/kubernetes-tips-create-pods-with-imperative-commands-in-1-18-62ea6e1ceb32?source=collection_archive---------2-----------------------#2020-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8e6a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解“kubectl run”在这个新版本中是如何修改的</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/a73f11cc62e053bbd705d0631876fd38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*i_Qtc48A1uGhF2GW2TK8Hg.png"/></div></figure><p id="7071" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Kubernetes 1.18于2020年3月底发布。在这个版本带来的所有变化/修复/增强中，我们将把重点放在迄今为止使用起来相当痛苦的<code class="fe lm ln lo lp b">kubectl run</code>命令上。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="3588" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">命令式与陈述式</h1><p id="f546" class="pw-post-body-paragraph kq kr it ks b kt mp ju kv kw mq jx ky kz mr lb lc ld ms lf lg lh mt lj lk ll im bi translated">在Kubernetes集群中创建资源有两种方式:命令式和声明式。</p><p id="78d4" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">声明性方法用于使用<code class="fe lm ln lo lp b">kubectl apply</code>命令从清单文件(通常在YAML)创建资源。这是生产环境中使用的方法。</p><p id="f1ec" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">命令方式用于使用几个不同的命令来管理资源，并且不需要任何清单文件。</p><p id="75b9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这绝对不是在生产中使用的方法，但是它非常方便快速地进行测试，并且它还可以帮助生成清单文件(使用<code class="fe lm ln lo lp b">--dry-run</code>和<code class="fe lm ln lo lp b">-o yaml</code>标志的组合)。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="369a" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">1.18之前</h1><p id="926f" class="pw-post-body-paragraph kq kr it ks b kt mp ju kv kw mq jx ky kz mr lb lc ld ms lf lg lh mt lj lk ll im bi translated">在1.18之前的集群中，可以使用<code class="fe lm ln lo lp b">kubectl run</code>命令运行Pod和其他资源。</p><p id="db90" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了说明这一点，我们使用kubectl 1.17.0来对抗版本1.17.2中的一个<a class="ae mu" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> K3s </a>集群。</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="ada1" class="mz ly it lp b gy na nb l nc nd"><strong class="lp iu">$ kubectl version<br/></strong>Client Version: version.Info{Major:"1", Minor:"17", GitVersion:"<strong class="lp iu">v1.17.0</strong>", GitCommit:"70132b0f130acc0bed193d9ba59dd186f0e634cf", GitTreeState:"clean", BuildDate:"2019-12-07T21:20:10Z", GoVersion:"go1.13.4", Compiler:"gc", Platform:"darwin/amd64"}<br/>Server Version: version.Info{Major:"1", Minor:"17", GitVersion:"<strong class="lp iu">v1.17.2+k3s1</strong>", GitCommit:"cdab19b09a84389ffbf57bebd33871c60b1d6b28", GitTreeState:"clean", BuildDate:"2020-01-27T18:09:26Z", GoVersion:"go1.13.6", Compiler:"gc", Platform:"linux/amd64"}</span></pre><p id="6c54" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们可以看到,<code class="fe lm ln lo lp b">kubectl run</code>命令允许我们运行一个特定的映像(阅读:创建一个Pod)以及创建其他资源(部署、作业):</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="f372" class="mz ly it lp b gy na nb l nc nd">$ kubectl run --help</span><span id="dd9f" class="mz ly it lp b gy ne nb l nc nd">Create and run a particular image, possibly replicated.<br/>Creates a deployment or job to manage the created container(s).</span></pre><p id="bd3f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这个简单的命令允许我们创建一个部署:</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="3f9a" class="mz ly it lp b gy na nb l nc nd"><strong class="lp iu">$ kubectl run www --image=nginx:1.16</strong><br/>kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.<br/><strong class="lp iu">deployment.apps/www created</strong></span></pre><p id="d7a9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们得到一条警告消息，因为<code class="fe lm ln lo lp b">--generator=deployment/apps.v1</code> <em class="nf"> </em>标志(隐式使用，因为我们不提供任何其他标志)已被否决。如果我们想创建一个Pod而不是一个部署，建议使用<code class="fe lm ln lo lp b">--generator=run-pod/v1</code> <em class="nf"> </em>标志。</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="656e" class="mz ly it lp b gy na nb l nc nd"><strong class="lp iu">$ kubectl run --generator=run-pod/v1 www-1 --image=nginx:1.16</strong><br/>pod/www-1 created</span></pre><p id="e62f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这工作得很好，但是不太方便(并且很难记住确切的语法并在第一次尝试时得到正确的选项)。从<em class="nf"> </em> <code class="fe lm ln lo lp b">kubectl run</code>命令中获取Pod的另一种方法是使用<code class="fe lm ln lo lp b">--restart=Never</code>标志:</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="f79f" class="mz ly it lp b gy na nb l nc nd"><strong class="lp iu">$ kubectl run www-2 --image=nginx:1.16 --restart=Never<br/></strong>pod/www-2 created</span></pre><p id="238d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">是否要创建作业类型的资源？使用<code class="fe lm ln lo lp b">--restart=OnFailure</code>标志或<code class="fe lm ln lo lp b">--generator=job/v1</code>T22即可。</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="35c9" class="mz ly it lp b gy na nb l nc nd"><strong class="lp iu">$ kubectl run hello --image=hello-world --restart=OnFailure</strong><br/>kubectl run --generator=job/v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.<br/><strong class="lp iu">job.batch/hello created</strong></span></pre><p id="4a74" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">正如我们在这个输出中看到的，<code class="fe lm ln lo lp b">--generator=job/v1</code>(使用<code class="fe lm ln lo lp b">--restart=OnFailure</code>标志时隐含的)也将被否决。</p><p id="2ada" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们在上述命令中得到的反对消息已经存在很长时间了。正如我们所见，使用不同的生成器和不同的<code class="fe lm ln lo lp b">--restart</code>标志值的可能性使得这个命令非常复杂。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="1ecc" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">Kubernetes 1.18中的新功能</h1><p id="2fc6" class="pw-post-body-paragraph kq kr it ks b kt mp ju kv kw mq jx ky kz mr lb lc ld ms lf lg lh mt lj lk ll im bi translated">随着1.18的发布，事情变得更加清晰，因为<code class="fe lm ln lo lp b">kubectl run</code>现在只用于创建一个Pod不再有模糊的旗帜。</p><p id="763e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了说明这一点，我们在同一个1.17.2 K3s集群上使用kubectl 1.18.0。</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="b7e6" class="mz ly it lp b gy na nb l nc nd"><strong class="lp iu">$ kubectl version<br/></strong>Client Version: version.Info{Major:”1", Minor:”18", GitVersion:”<strong class="lp iu">v1.18.0</strong>", GitCommit:”9e991415386e4cf155a24b1da15becaa390438d8", GitTreeState:”clean”, BuildDate:”2020–03–25T14:58:59Z”, GoVersion:”go1.13.8", Compiler:”gc”, Platform:”linux/amd64"}<br/>Server Version: version.Info{Major:”1", Minor:”17", GitVersion:”<strong class="lp iu">v1.17.2+k3s1</strong>", GitCommit:”cdab19b09a84389ffbf57bebd33871c60b1d6b28", GitTreeState:”clean”, BuildDate:”2020–01–27T18:09:26Z”, GoVersion:”go1.13.6", Compiler:”gc”, Platform:”linux/amd64"}</span></pre><p id="32b9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">注意:如果您还没有安装kubectl 1.18，您可以从<a class="ae mu" href="https://hub.docker.com/repository/docker/lucj/k8stools" rel="noopener ugc nofollow" target="_blank"> lucj/k8stools:1.18.0 </a>映像运行一个容器。您只需要提供一个<code class="fe lm ln lo lp b">kubeconfig</code>文件，就可以使用kubectl 1.18与1.18之前的集群进行交互。</p><p id="8f2c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这张图片还附带了一堆有用的工具，比如<a class="ae mu" href="https://github.com/ahmetb/kubectx" rel="noopener ugc nofollow" target="_blank">kube txx/kubens</a>、<a class="ae mu" href="https://github.com/jonmosco/kube-ps1" rel="noopener ugc nofollow" target="_blank"> kube-ps1 </a>、<a class="ae mu" href="https://github.com/ahmetb/kubectl-aliases" rel="noopener ugc nofollow" target="_blank"> kubectl-aliases </a>、<a class="ae mu" href="https://github.com/helm/helm/releases" rel="noopener ugc nofollow" target="_blank"> Helm </a>第2版和第3版客户端，以及伟大的<a class="ae mu" href="https://github.com/derailed/k9s" rel="noopener ugc nofollow" target="_blank"> K9s </a>界面。</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="f284" class="mz ly it lp b gy na nb l nc nd">$ docker run -ti -v $PATH_TO_KUBECONFIG:/kubeconfig lucj/k8stools:1.18.0</span></pre><p id="e69e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe lm ln lo lp b">kubectl run</code>命令的帮助页面在1.18中有一点改变:</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="ae4b" class="mz ly it lp b gy na nb l nc nd">$ kubectl run --help</span><span id="bd9c" class="mz ly it lp b gy ne nb l nc nd">Create and run a particular image in a pod.</span></pre><p id="2f4f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在更清楚了，因为该命令仅用于创建Pod。让我们运行一个简单的NGINX。</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="ec46" class="mz ly it lp b gy na nb l nc nd">$ kubectl run www --image=nginx:1.16<br/>pod/www created</span></pre><p id="7a53" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">不再有折旧消息，不再有复杂的标志来选择要创建的资源类型；事情现在非常清楚了。感谢这个改变！</p><p id="2833" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">背后的基本原理是将众所周知的<code class="fe lm ln lo lp b">docker run</code>命令与<code class="fe lm ln lo lp b">kubectl run</code>对齐。第一个创建一个容器，第二个创建一个Pod，clean！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="dd98" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">其他资源呢？</h1><p id="c2c3" class="pw-post-body-paragraph kq kr it ks b kt mp ju kv kw mq jx ky kz mr lb lc ld ms lf lg lh mt lj lk ll im bi translated">如果我们需要以强制的方式创建其他资源，我们可以使用<code class="fe lm ln lo lp b">kubectl create</code>命令。但是，在1.18版本中，这些命令没有任何变化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/1fd46928f5fee4c28df1e6e9a81f4e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bKj-EQbbMECdxWJCR0Vn2g.png"/></div></div><p class="nl nm gj gh gi nn no bd b be z dk translated">可以用“kubectl create”创建的资源</p></figure><p id="9f4b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">例如，可以使用以下命令创建基于<code class="fe lm ln lo lp b">nginx:1.16</code>的部署，每个资源都有自己的一组参数:</p><pre class="kj kk kl km gt mv lp mw mx aw my bi"><span id="5c92" class="mz ly it lp b gy na nb l nc nd">$ kubectl create deployment w3 --image=nginx:1.16<br/>deployment.apps/w3 created</span></pre><p id="f33d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果我们需要为部署生成一个基本的清单文件，那么使用<code class="fe lm ln lo lp b">--dry-run</code>和<code class="fe lm ln lo lp b">-o yaml</code>标志会非常方便，因为它显示了如何在不进行创建的情况下创建资源:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="f8b8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然后，我们可以修改规范，删除不必要的字段，使其符合我们的需求。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="31dc" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">结论</h1><p id="24f0" class="pw-post-body-paragraph kq kr it ks b kt mp ju kv kw mq jx ky kz mr lb lc ld ms lf lg lh mt lj lk ll im bi translated">我真的很高兴<code class="fe lm ln lo lp b">kubectl run</code>在这个新版本中被清理了。折旧信息已经存在很长时间了，很难真正理解不同标志和生成器背后的逻辑。</p><p id="f392" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我想知道你是否使用命令式命令，以及哪些是你最常用的。</p></div></div>    
</body>
</html>