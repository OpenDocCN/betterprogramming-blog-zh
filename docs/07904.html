<html>
<head>
<title>Implementing AsyncStorage in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React Native中实现异步存储</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implementing-asyncstorage-in-react-native-911767deba3e?source=collection_archive---------7-----------------------#2021-03-03">https://betterprogramming.pub/implementing-asyncstorage-in-react-native-911767deba3e?source=collection_archive---------7-----------------------#2021-03-03</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="dafa" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">构建智能异步应用程序</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/79c96f503a3cdc74fcc186bc33846cd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X4P2Z1t-EOGaeamS"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ferenc Almasi </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="8a1e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于构建React原生应用来说，是非常重要的一部分。你可能会问，“什么是<code class="fe lw lx ly lz b">AsyncStorage</code>？”这是一种在应用程序上全局存储数据的方式，该应用程序也可以脱机保存。如果您熟悉web开发，可以把它看作是会话的React本机版本。</p><p id="59d3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">数据通过未加密的键-值对存储在应用程序级别，允许开发人员在其中存储他们的应用程序工作所需的特定数据。最基本的例子是让用户在登录到应用程序后保持登录状态。您可以将他们的<code class="fe lw lx ly lz b">userId</code>存储在<code class="fe lw lx ly lz b">AsyncStorage</code>中，这将允许您在整个应用程序中使用该ID。</p><p id="fd9f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我将介绍如何使用它的示例，以便您可以在应用程序中利用它。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="5735" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">1.安装异步存储</h1><p id="1660" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">要在您的应用程序中使用<code class="fe lw lx ly lz b">AsyncStorage</code>，您首先需要安装它:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="f8dd" class="ni mi iu lz b gz nj nk l nl nm">npm install @react-native-async-storage/async-storage</span></pre><p id="f60e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您使用的是yarn，那么命令是:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="da4d" class="ni mi iu lz b gz nj nk l nl nm">yarn add @react-native-async-storage/async-storage</span></pre><p id="91c7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后但同样重要的是，如果您使用Expo CLI:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="92c6" class="ni mi iu lz b gz nj nk l nl nm">expo install @react-native-async-storage/async-storage</span></pre></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="d550" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">2.插入异步存储</h1><p id="7683" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">在我们用<code class="fe lw lx ly lz b">AsyncStorage</code>做任何事情之前，我们需要插入它。下面是对<code class="fe lw lx ly lz b">AsyncStorage</code>进行简单插入的语法:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">添加到异步存储</p></figure><p id="130e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的代码用于将一个键-值对插入到存储中。你不需要把它放在一个单独的函数里。相反，您可以直接调用:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="a7ae" class="ni mi iu lz b gz nj nk l nl nm">await AsyncStorage.setItem(key, value);</span></pre><p id="28dc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请记住，键和值对都必须是字符串！所以，如果你打算像上面的例子那样存储一个<code class="fe lw lx ly lz b">userId</code>，一定要把它转换成一个字符串。或者，如果您计划存储一个布尔值，则该值必须是<code class="fe lw lx ly lz b">"true"</code>或<code class="fe lw lx ly lz b">"false"</code>。</p><p id="1b4c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如上所述，一个非常常见的用例是在用户登录时存储他们的ID。这可用于为用户提取特定信息(例如显示用户名)。只要密钥存在，ID就会一直存在。只有当密钥从存储器中删除时(或当应用程序被删除时)，它才会从<code class="fe lw lx ly lz b">AsyncStorage</code>中消失。删除它的常见情况是在注销时。</p><p id="6043" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这方面的另一个用例是，如果您希望能够在用户第一次登录后保持登录状态。您可以向<code class="fe lw lx ly lz b">AsyncStorage</code>添加某种认证令牌，以便在整个应用程序中使用。您将拥有仅基于该身份验证令牌的条件呈现。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="f926" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">3.从异步存储中读取</h1><p id="b7e9" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">所以现在我们已经插入到<code class="fe lw lx ly lz b">AsyncStorage</code>中，让我们从存储器中读取。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">从异步存储中读取</p></figure><p id="a263" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">从存储器中读取可能有点棘手，因为它是一个<code class="fe lw lx ly lz b">Promise</code>。这意味着当您计划调用这个函数时，您将需要确保适当地处理它，因为您得到的值可能没有及时准备好。下面是一个呼叫的示例:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">使用_getUserId()函数。</p></figure><p id="6743" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">调用这个将处理<code class="fe lw lx ly lz b">Promise</code>并为您获取<code class="fe lw lx ly lz b">userId</code>。请记住，<code class="fe lw lx ly lz b">userId</code>可能不会完全出现在您的代码中，这取决于您如何调用它。这里应该使用正确的<code class="fe lw lx ly lz b">Promise</code>处理。关于<code class="fe lw lx ly lz b">Promises</code>的更多信息可以在文档中阅读<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="dcaf" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">4.从异步存储中删除</h1><p id="84bb" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">从<code class="fe lw lx ly lz b">AsyncStorage</code>中删除实际上相当简单。有一些方法允许您从存储中删除。</p><p id="652d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您只想从存储器中删除一个密钥，可以这样做:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">从异步存储中删除单个项目</p></figure><p id="31c6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">记住使用字符串作为键！</p><p id="1df8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果我们希望清除整个<code class="fe lw lx ly lz b">AsyncStorage</code>(例如在应用程序注销时)，那么可以这样写:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nn no l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">清除整个异步存储</p></figure><p id="475c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">与本文提供的任何其他示例一样，实际上您可以直接调用它，而不是创建额外的函数。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="450e" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">结论</h1><p id="a1da" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">对于创建任何类型的应用程序来说,<code class="fe lw lx ly lz b">AsyncStorage</code>是一个非常强大的——也可以说是必需的——组件。能够在设备上全局存储数据对于向用户提供功能至关重要。如果没有这一点，很难构建复杂的应用程序。</p><p id="8508" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您有任何问题，请随时留下评论，以便我们进行讨论。</p><p id="919a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下一集再见！</p></div></div>    
</body>
</html>