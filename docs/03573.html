<html>
<head>
<title>Create a Command-Line Tool Using Swift Package Manager</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Swift包管理器创建命令行工具</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-command-line-tool-using-swift-package-manager-c2eb0e088e69?source=collection_archive---------12-----------------------#2020-02-18">https://betterprogramming.pub/create-a-command-line-tool-using-swift-package-manager-c2eb0e088e69?source=collection_archive---------12-----------------------#2020-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8d5f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用开源的SPM实用程序框架，创建一个Swift命令行工具来自动化常见任务真的很容易</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fdca79eb1529dac4110a0dee56f3afd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UCoAIqqPUNudy-oRdp8Z-g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@freestocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">自由股票</a>在<a class="ae ky" href="https://unsplash.com/s/photos/typing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4d53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">命令行工具对于自动化常见任务来提高开发人员的工作效率非常有用。在开发iOS应用程序时，我们经常使用命令行工具，如<a class="ae ky" href="https://fastlane.tools/" rel="noopener ugc nofollow" target="_blank">浪子</a>和<a class="ae ky" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>，但很少为日常使用编写自己的命令行工具。</p><p id="8c58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Swift包管理器<a class="ae ky" href="https://swift.org/package-manager/" rel="noopener ugc nofollow" target="_blank">使得创建命令行工具变得更加容易，因为我们可以用Swift编写它们。一旦您创建了第一个命令行工具，很容易快速设置另一个工具。</a></p><p id="d1b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经创建了一个<a class="ae ky" href="https://github.com/AvdLee/Poes" rel="noopener ugc nofollow" target="_blank"> Poes </a>，一个在模拟器中测试推送通知的命令行工具，只用了几个小时！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="de59" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么时候我应该决定创建一个命令行工具？</h1><p id="5d4a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你不应该为每件事都创建一个命令行工具。但是，您经常重复的常见任务可能适合由CLI工具来代替。这至少是一种让重复的任务更容易完成的方法！</p><h2 id="6c8c" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">一个例子:创建博客文章横幅</h2><p id="cb4b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在我写完每一篇博文后，我都会创建两个博文横幅，在社交媒体上分享。我必须打开<a class="ae ky" href="https://www.sketch.com/" rel="noopener ugc nofollow" target="_blank">草图</a>，更改两个标题，将其导出到正确的文件夹，并给它起一个与之前的横幅一致的名称。</p><p id="bb5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这花了我不到五分钟的时间，但这仍然是一个容易自动化的重复任务。因此，这是一个可以用命令行工具实现自动化的完美例子。</p><p id="d3db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问自己这样一个问题:“我反复做的事情是什么？”在你的日常工作中记住这一点，并努力识别这些任务。一旦你有了一个，我要求你使用这篇博文并为它写一个命令行工具！</p><p id="c241" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了给你一点启发，这是我自己创建的两个CLI工具:</p><ul class=""><li id="9efd" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated"><a class="ae ky" href="https://github.com/AvdLee/Poes" rel="noopener ugc nofollow" target="_blank"> Poes </a>:一个快捷的工具，可以轻松地向iOS模拟器发送推送通知</li><li id="7a26" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><a class="ae ky" href="https://github.com/WeTransfer/GitBuddy" rel="noopener ugc nofollow" target="_blank"> GitBuddy </a> : <strong class="lb iu"> </strong>你管理和维护GitHub库的好伙伴。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4329" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用Swift软件包管理器创建命令行工具</h1><p id="a3cd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你对Swift包管理器不熟悉，我强烈建议你首先阅读我的博客文章，名为<a class="ae ky" href="https://www.avanderlee.com/swift/creating-swift-package-manager-framework/" rel="noopener ugc nofollow" target="_blank"> <em class="nz">在Xcode </em> </a>中创建Swift包框架。</p><p id="caa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您找到了可以自动化或用命令行工具替代的东西，就该开始创建它了。我们利用Swift包管理器初始化一个新项目。</p><p id="c609" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，我将使用名称<code class="fe oa ob oc od b">Banner</code>来创建博客文章横幅。</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="dcc6" class="mz md it od b gy oi oj l ok ol">$ mkdir Banner<br/>$ cd Banner<br/>$ swift package init --type executable</span></pre><p id="e729" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先创建一个名为<code class="fe oa ob oc od b">Banner</code>的新文件夹，将目录更改为这个新文件夹，然后初始化这个新包，将类型设置为<code class="fe oa ob oc od b">executable</code>。该命令将打印出以下几行:</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="a4dd" class="mz md it od b gy oi oj l ok ol">Creating executable package: Banner<br/>Creating Package.swift<br/>Creating README.md<br/>Creating .gitignore<br/>Creating Sources/<br/>Creating Sources/Banner/main.swift<br/>Creating Tests/<br/>Creating Tests/LinuxMain.swift<br/>Creating Tests/BannerTests/<br/>Creating Tests/BannerTests/BannerTests.swift<br/>Creating Tests/BannerTests/XCTestManifests.swift</span></pre><p id="7be9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，它自动将文件夹名作为可执行文件的名称。它还创建了测试、一个自述文件和一个为运行Swift包而调整的<code class="fe oa ob oc od b">.gitignore</code>文件。</p><p id="27d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建的代码非常简单，只包含一个“Hello，world！”打印报表。通过构建和运行代码，您可以看到这一点:</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="8c90" class="mz md it od b gy oi oj l ok ol">$ swift build<br/>$ swift run<br/>Hello, world!</span></pre><p id="f8bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们命令行工具的最基本的设置！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3067" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为用户输入添加参数</h1><p id="3362" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">下一步是添加参数以允许用户输入。在我们的例子中，我们想为博客文章的标题和横幅文件名中使用的周数添加一个参数。</p><p id="b07f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过使用SPMUtility框架来做到这一点，该框架是开源的<a class="ae ky" href="https://github.com/apple/swift-package-manager.git" rel="noopener ugc nofollow" target="_blank"> Swift Package Manager存储库</a>的一部分。SPMUtility框架增加了许多使用Swift Package Manager创建命令行工具时所需的通用功能。</p><p id="9ca4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将SPMUtility框架作为依赖项添加到我们的包文件中之后，我们就可以使用它了。打开<code class="fe oa ob oc od b">Package.swift</code>文件，这将在Xcode中打开包，并调整文件以匹配以下结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="6196" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该包将被导入Xcode，然后您可以在构建项目后在<code class="fe oa ob oc od b">main.swift</code>文件中使用它:</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="359d" class="mz md it od b gy oi oj l ok ol">import SPMUtility<br/><br/>print("Hello, world!")</span></pre><p id="c909" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们还在<code class="fe oa ob oc od b">Package.swift</code>文件中添加了一个产品。这是从终端使用我们的可执行文件作为实际命令行工具所必需的。</p><h2 id="22d6" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">使用ArgumentsParser读取用户输入</h2><p id="4f4b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">由于我们现在可以利用SPMUtility框架，我们可以开始编写代码来处理参数。</p><p id="3ebd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一切都从读取进程信息中的参数开始。我们放弃第一个参数，因为这是可执行文件的名称，在我们的例子中是:<code class="fe oa ob oc od b">banner</code>。</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="06c0" class="mz md it od b gy oi oj l ok ol">import SPMUtility<br/>import Foundation<br/><br/>// We drop the first argument as this is always the execution path. In our case: "banner"<br/>let arguments = ProcessInfo.processInfo.arguments.dropFirst()</span></pre><p id="2d40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们初始化参数解析器，并向其添加参数选项:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="7ab5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这给了参数解析器足够的上下文来处理用户输入。我们可以使用解析器实际解析参数，并读出标题和星期输入参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="48c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将所有这些加在一起，我们会得到下面几行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="9880" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以再次构建我们的可执行文件，并测试我们当前的工具:</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="0baf" class="mz md it od b gy oi oj l ok ol">$ swift run banner --title "Creating a command-line tool using the Swift Package Manager" --week 60<br/>Creating a banner for title Creating a command-line tool using the Swift Package Manager and week 60</span></pre><p id="19b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们免费得到的是向用户解释可用参数的<code class="fe oa ob oc od b">--help</code>命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="873e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是非常整洁的东西，我们不必自己构建，真棒！</p><p id="807c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，要实际创建用于生成横幅的命令行工具，还有很多工作要做。然而，这与这篇博文的上下文无关，所以我将把创建可执行文件的其余部分留给您！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8fae" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建版本并安装您的命令行工具</h1><p id="2a53" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在创建了命令行工具之后，您显然会希望安装它来真正试用一下。</p><p id="eadc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过构建发布配置来做到这一点。这将在<code class="fe oa ob oc od b">.build/release</code>文件夹中创建一个可执行文件。为了实际使用它，我们需要将它复制到<code class="fe oa ob oc od b">/usr/local/bin</code>文件夹中。</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="03a9" class="mz md it od b gy oi oj l ok ol">$ swift build --configuration release<br/>$ cp -f .build/release/banner /usr/local/bin/banner</span></pre><p id="f2b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这足以使我们的命令行工具成为真正的工具！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/053ca8ebd13c04555291aa82af2b5fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JkoNdX3ZKy84fzXd.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用Swift编写的命令行工具</p></figure><p id="1a89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是不是很牛逼？</p><p id="c53f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以从终端的任何文件夹中开始使用命令行工具。在使用它之前，您不需要构建或运行它。</p><p id="9d9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想公开你的工具，你可以看看我在<a class="ae ky" href="https://www.avanderlee.com/swift/creating-swift-package-manager-framework/" rel="noopener ugc nofollow" target="_blank"> Swift Packages上的博客文章，了解关于发布</a>Swift包的信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a653" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="1934" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">就是这样！我们利用Swift Package Manager创建了自己的命令行工具。SPMUtility框架使得处理参数变得非常容易，并且在创建了发布版本之后，我们可以在任何地方使用我们的工具！</p><p id="6ddd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢谢！</p></div></div>    
</body>
</html>