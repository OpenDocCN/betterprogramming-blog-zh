<html>
<head>
<title>Building a Telegram Bot Using Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Golang构建电报机器人</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-telegram-bot-using-golang-dictionary-bot-497f810b491f?source=collection_archive---------6-----------------------#2022-08-29">https://betterprogramming.pub/building-a-telegram-bot-using-golang-dictionary-bot-497f810b491f?source=collection_archive---------6-----------------------#2022-08-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0e7f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建一个字典机器人</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3f767842ae8714eccaa8f53976e441b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mk6Ld4SFWIWkd5LxPx8Vew.png"/></div></div></figure><p id="b345" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本教程中，您将学习如何轻松地在您的机器人和Golang程序之间进行通信。</p><h1 id="1dfa" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">目标</h1><p id="6524" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">您的机器人将处理两种用例:</p><ul class=""><li id="e8ab" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated">字典:你发送一个单词，机器人会根据这个单词的词性分类，回复不同的意思</li><li id="08b3" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm mp mq mr ms bi translated">作者信息:响应作者信息请求</li></ul><h1 id="cdbe" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">创建内部电报机器人</h1><p id="8710" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">你应该做的第一件事是在你的电报账户中创建这个机器人。要做到这一点，你需要通过聊天电话<code class="fe my mz na nb b">BotFather</code>在你的电报中搜索，并在为你的机器人选择名称后给他们发送消息<code class="fe my mz na nb b">/newbot</code>，然后你会收到一个令牌。这个令牌非常重要，它就像一个控制你的机器人的密码。</p><h1 id="9935" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">第一步</h1><p id="d7b9" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">Telegram有服务器，这些服务器作为聊天和应用程序之间的中间件，就像一个邮局，但这里没有邮政编码，而是有一个T2。在以后的另一篇教程中，我可以更深入地探讨这一点，但是现在，这是您唯一需要知道的事情。</p><p id="4bf7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你应该为你的机器人创建一个处理程序，因为他需要知道应该如何回复。因此，我们将构建一个结构来处理来自电报和处理程序的请求。</p><p id="155e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这里，您可以看到请求中包含的其他字段:<a class="ae nd" href="https://core.telegram.org/bots/api#update" rel="noopener ugc nofollow" target="_blank">https://core.telegram.org/bots/api#update</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="453f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你要把<code class="fe my mz na nb b">YOUR_TOKEN</code>换成<code class="fe my mz na nb b">BotFather</code>提供给你的令牌，所以<code class="fe my mz na nb b">“bot” + YOUR_TOKEN</code>。</p><p id="a8d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是……他会怎么做呢？</p><p id="ebb9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">很容易理解，每次处理程序被触发，这意味着，如果你在与你的机器人的聊天中发送消息(是的，你应该与你创建的机器人打开聊天)，他会回答你:Hello World。</p><h1 id="f6f1" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">部署你的“Hello World”机器人</h1><p id="14e8" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我非常感谢本教程的作者<a class="ae nd" href="https://www.sohamkamani.com/golang/telegram-bot/" rel="noopener ugc nofollow" target="_blank">https://www.sohamkamani.com/golang/telegram-bot/</a>,因为他帮助我理解了如何构建和部署一个机器人。</p><ol class=""><li id="6635" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm ng mq mr ms bi translated">从这里安装<code class="fe my mz na nb b">ngrok</code>https://ngrok.com/download<a class="ae nd" href="https://ngrok.com/download" rel="noopener ugc nofollow" target="_blank">和</a></li><li id="e518" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm ng mq mr ms bi translated">安装后，在终端上运行:</li></ol><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="d60c" class="nl lo iq nb b gy nm nn l no np">ngrok http 3000</span></pre><p id="8b22" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">3.现在，您应该能够看到您的公共IP:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/4b65c4c673242af354ecc9c68aaf8f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ElfF-vZdG2xiOHJy5bl95A.png"/></div></div></figure><p id="48d2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这种情况下是:<a class="ae nd" href="https://d860-85-245-152-103.eu.ngrok.io" rel="noopener ugc nofollow" target="_blank">https://d860-85-245-152-103 . eu . ngrok . io</a></p><p id="e520" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">4.打开一个新终端并运行:</p><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="0572" class="nl lo iq nb b gy nm nn l no np">curl -F "url=<a class="ae nd" href="https://d860-85-245-152-103.eu.ngrok.io" rel="noopener ugc nofollow" target="_blank">https://d860-85-245-152-103.eu.ngrok.io</a>"  <a class="ae nd" href="https://api.telegram.org/bot+YOUR" rel="noopener ugc nofollow" target="_blank">https://api.telegram.org/bot+YOUR</a>_TOKEN/setWebhook</span></pre><p id="351f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">(应在“bot”后添加您的私有令牌)</p><p id="a147" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行后，您应该会看到:</p><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="5eb4" class="nl lo iq nb b gy nm nn l no np">{"ok":true,"result":true,"description":"Webhook was set"}</span></pre><p id="ed83" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建一个公共IP并连接到您的本地IP 3000非常快速简单。这不是一个生产解决方案，因为<code class="fe my mz na nb b">ngrok</code>仅允许您在2小时内使用免费层拥有相同的公共IP。但无论如何，对你的发展真的很有用。</p><h1 id="2a9b" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><strong class="ak">测试你的机器人</strong></h1><p id="dc6a" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">去你的聊天机器人那里写点东西，机器人会回复你“你好”。</p><h1 id="4d81" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">字典用例</h1><p id="c0f2" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们将使用免费的字典API，<a class="ae nd" href="https://dictionaryapi.dev/" rel="noopener ugc nofollow" target="_blank">https://dictionaryapi.dev/</a>。这是一个真正完整的API，它为我们提供了关于含义、同义词、反义词、词性等信息。要使用它，我们应该创建一个对API的请求，如下例所示:</p><blockquote class="nr ns nt"><p id="c6b0" class="kr ks nc kt b ku kv jr kw kx ky ju kz nu lb lc ld nv lf lg lh nw lj lk ll lm ij bi translated">例如，要获得英语单词<code class="fe my mz na nb b">hello</code>的定义，您可以发送请求到</p><p id="9125" class="kr ks nc kt b ku kv jr kw kx ky ju kz nu lb lc ld nv lf lg lh nw lj lk ll lm ij bi translated"><code class="fe my mz na nb b"><a class="ae nd" href="https://api.dictionaryapi.dev/api/v2/entries/en/hello" rel="noopener ugc nofollow" target="_blank">https://api.dictionaryapi.dev/api/v2/entries/en/hello</a></code></p></blockquote><p id="3841" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于本教程，我决定只使用该词的含义，但我们的想法是为语音案例的每个部分获得一个定义，例如，如果我们选择单词<code class="fe my mz na nb b">TIME</code>，API会找到3个语音部分，每个部分的第一个定义是:</p><ul class=""><li id="7ac7" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated"><code class="fe my mz na nb b">noun</code>:随着现在和过去事件的过去，不可避免地向未来发展。</li><li id="2843" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm mp mq mr ms bi translated"><code class="fe my mz na nb b">verb</code>:测量或记录时间、持续时间或速率。</li><li id="571e" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm mp mq mr ms bi translated"><code class="fe my mz na nb b">interjection</code>:裁判员提醒运动员暂停后继续比赛。</li></ul><p id="955b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，在这种情况下，消息应该显示如下:</p><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="66d1" class="nl lo iq nb b gy nm nn l no np">noun : The inevitable progression into the future with the passing of present and past events.<br/>verb : To measure or record the time, duration, or rate of.<br/>interjection : Reminder by the umpire for the players to continue playing after their pause.</span></pre><p id="87fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">执行此操作的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="177a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这段代码中，我们有3个函数和1个结构，如果你看看我以前的帖子，你会看到如何从Json创建一个快速结构:</p><div class="nx ny gp gr nz oa"><a href="https://medium.com/@anv7345/json-to-golang-struct-fastest-way-3fd11774fdaf" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">JSON到GOlang结构(最快的方法)</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">将Json转换成Golang Struct，这是最快也是最简单的方法</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">medium.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kp oa"/></div></div></a></div><p id="06bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将解释这段代码的流程:</p><ol class=""><li id="2c1a" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm ng mq mr ms bi translated"><code class="fe my mz na nb b">wordsPlay(chatID int64, string_input string)</code> <strong class="kt ir"> </strong>这是这个用例的主要功能。创建请求的url。</li><li id="c2fc" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm ng mq mr ms bi translated"><code class="fe my mz na nb b">getWordData(url string)</code>接收URL并请求API，在接收到结果后从先前定义的<code class="fe my mz na nb b">Response</code> struct创建一个Struct。</li><li id="f050" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm ng mq mr ms bi translated">主函数(<code class="fe my mz na nb b">wordsPlay</code>)检查字典API的结果是否有效，如果无效，则发送一条消息。</li></ol><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="3b75" class="nl lo iq nb b gy nm nn l no np">“Meaning not found for the word: “+string_input</span></pre><p id="cb5d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果结果有效，那么调用函数来格式化输出。</p><p id="bf91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe my mz na nb b">4. formatResponse(response Response)</code>接收响应对象，然后使用找到的每个词类的含义创建一个字符串，使用下面的代码:</p><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="f71b" class="nl lo iq nb b gy nm nn l no np">for _, element := range response[0].Meanings {</span><span id="8b06" class="nl lo iq nb b gy op nn l no np">elem_str = element.PartOfSpeech + " : " + element.Definitions[0].Definition + "\n"</span><span id="04ab" class="nl lo iq nb b gy op nn l no np">str_response += elem_str</span><span id="8388" class="nl lo iq nb b gy op nn l no np">}</span></pre><p id="9305" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">5.使用<code class="fe my mz na nb b">chat_id</code>(来自请求体，在处理函数中)向机器人发送响应</p><p id="5a15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了实现这一点，我们需要更新<code class="fe my mz na nb b">Handler</code>代码，但是让我们实现<code class="fe my mz na nb b">Author</code>用例。对于这个简单的例子，我们只想回复bot作者的名字和位置。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="a7dc" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">Bot代码最终版本</h1><p id="34ec" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">为了实现这一点，我们需要为这些函数创建条目。这意味着我们需要定义什么时候我们应该调用“<code class="fe my mz na nb b">wordsPlay</code>”或“<code class="fe my mz na nb b">author</code>”，你可以检查，截图后，完整的代码。</p><div class="kg kh ki kj gt ab cb"><figure class="oq kk or os ot ou ov paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/dd7441b2256e9fb0e01cfc717a500983.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*VNR5RbBbgH8KzSfaQyJQ1A.jpeg"/></div></figure><figure class="oq kk or os ot ou ov paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/d8dd7ca2680d74dcac424323b87be7a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*zwzISKahOcZx8w5mIW-Sjg.jpeg"/></div></figure></div><h1 id="a37b" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">完整代码</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="f9fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:代码附带了一些日志，你可以删除它们，我将在另一个教程中解释我们如何为你的代码库创建漂亮简单的日志。</p><h1 id="e5ab" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">你的下一步</h1><p id="da95" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">您可以创建一个机器人来提高您的写作技能，为此，您将从该API中检索同义词，然后当您需要编写大量文本并避免过多重复时，您可以检查一些单词的同义词。</p><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="e912" class="nl lo iq nb b gy nm nn l no np"><strong class="nb ir">Want to Connect?</strong></span><span id="aa12" class="nl lo iq nb b gy op nn l no np">Github: <a class="ae nd" href="https://github.com/albertonvilas/" rel="noopener ugc nofollow" target="_blank">https://github.com/albertonvilas/</a></span><span id="e76c" class="nl lo iq nb b gy op nn l no np">Linkedin: <a class="ae nd" href="https://www.linkedin.com/in/albertovilas/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/albertovilas/</a></span></pre></div></div>    
</body>
</html>