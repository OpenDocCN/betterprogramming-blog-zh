<html>
<head>
<title>Identify Unused AWS EBS Volumes, and Get Rid of Them</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">识别未使用的AWS EBS卷，并将其删除</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/identify-unused-aws-ebs-volumes-and-get-rid-of-it-f108db2ae887?source=collection_archive---------3-----------------------#2020-01-12">https://betterprogramming.pub/identify-unused-aws-ebs-volumes-and-get-rid-of-it-f108db2ae887?source=collection_archive---------3-----------------------#2020-01-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b00f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何识别未使用的EBS卷，以及如何使用Python脚本删除它们</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/340682f3a2dea31cfe800767f704eae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RJQD5UN3C6845p-w3Wtbtw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@romankraft?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">罗马卡夫</a>在<a class="ae ky" href="https://unsplash.com/s/photos/volumes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b1a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您已经使用了<a class="ae ky" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> AWS EC2 </a>一段时间，那么您可能也已经为EC2实例使用了<a class="ae ky" href="https://aws.amazon.com/ebs/" rel="noopener ugc nofollow" target="_blank"> EBS </a>卷。</p><p id="f8c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是由于EC2实例的多次创建和终止，附加到那些被终止的实例的一些EBS卷仍然保留在那里。这些书没有任何用途，会产生费用。在本文中，我们将了解如何通过识别和删除那些未使用的卷来节省资金。该作品可分为以下几个副主题:</p><ol class=""><li id="8f8c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">为<a class="ae ky" href="http://python.org" rel="noopener ugc nofollow" target="_blank"> Python </a>脚本准备先决条件</li><li id="6c48" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">找出未使用的EBS卷</li><li id="671f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">以高效的方式删除未使用的EBS卷</li></ol><p id="358b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们一个一个地看。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="04db" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">为Python脚本准备先决条件</strong></h1><p id="6870" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">对于Python脚本，我们将使用<a class="ae ky" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank"> AWS boto3 </a>库和python-dotenv库来加载环境变量。因此，请在继续之前安装这两个库。</p><p id="ddf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们创建一个名为<code class="fe nn no np nq b">delete-unused-ebs-volumes</code>的目录，其中包含脚本和环境文件。</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="7887" class="nv mr it nq b gy nw nx l ny nz">mkdir <!-- -->delete-unused-ebs-volumes<br/>cd delete-unused-ebs-volumes</span></pre><p id="b4a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个目录中，让我们创建一个名为<code class="fe nn no np nq b">.env</code>的环境文件，其内容如下:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="a441" class="nv mr it nq b gy nw nx l ny nz">#aws credentials<br/>AWS_ACCESS_KEY_ID = &lt;your access key&gt;<br/>AWS_SECRET_ACCESS_KEY = &lt;your secret key&gt;<br/>AWS_REGION = &lt;your region&gt;</span></pre><p id="3be8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以进入下一步了。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="791a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak"> 2。找出未使用的EBS卷</strong></h1><p id="0214" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们首先在之前创建的目录中创建一个名为<code class="fe nn no np nq b">delete_unused_ebs_volumes.py</code>的Python文件。</p><p id="2883" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在那里添加下面几行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="d118" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们只是导入了所需的库，使用<code class="fe nn no np nq b">dotenv.load_dotenv()</code>加载了环境变量(默认情况下，它采用我们已经创建的<code class="fe nn no np nq b">.env</code>文件)，最后，创建了<code class="fe nn no np nq b">ec2</code>的客户端，我们将进一步需要它。</p><p id="611b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以开始研究EBS卷，找出哪些正在使用，哪些没有使用。让我们添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="4545" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们创建了一个列表<code class="fe nn no np nq b">volumes_to_delete</code>，其中存储了未使用卷的id。然后，我们调用客户端的<code class="fe nn no np nq b">describe_volumes()</code>方法，该方法将返回一个列表，其中包含给定区域中所有卷的详细信息。</p><p id="8408" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我添加了额外的日志来可视化卷列表的详细信息，但是找出未使用的卷的核心概念是:如果给定卷的附加列表为空——意味着它没有附加到任何实例，并且卷的状态是<code class="fe nn no np nq b">available </code> —那么这个特定的卷是未使用的，因此可以添加到<code class="fe nn no np nq b">volumes_to_delete</code>的列表中。</p><p id="297e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们已经得到了未使用的卷id列表。我们将进行下一步:删除。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="b56b" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak"> 3。高效删除未使用的EBS卷</strong></h1><p id="f08b" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在，我们将遍历<code class="fe nn no np nq b">volumes_to_delete</code>列表中的卷id，并使用客户端的<code class="fe nn no np nq b">delete_volume()</code>方法执行删除。</p><p id="e596" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还将使用<code class="fe nn no np nq b">waiters</code>来确保删除成功完成。</p><p id="37f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们添加更多代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="e45c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的脚本和其他相关文件可以在这个<a class="ae ky" href="https://github.com/ashutoshkarna03/delete-unused-aws-resource" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>中找到。</p><p id="f9ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将这个脚本作为一个cron作业或一个定期调度的任务来运行，这样可以节省一些钱。</p><p id="7cf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想我们已经到了这首曲子的结尾。感谢阅读，随时欢迎评论和建议。</p></div></div>    
</body>
</html>