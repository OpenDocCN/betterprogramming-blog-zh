<html>
<head>
<title>Build an API Using Go and MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Go和MySQL构建一个API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-an-api-using-go-and-mysql-1d290c681f1c?source=collection_archive---------8-----------------------#2020-07-10">https://betterprogramming.pub/build-an-api-using-go-and-mysql-1d290c681f1c?source=collection_archive---------8-----------------------#2020-07-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d519" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这比你想象的要容易</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/decae7d944024fe0d423c21bcbb626f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vsPEboIHViNi03dH.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:作者</p></figure></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><h1 id="d897" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">范围</h1><p id="dd68" class="pw-post-body-paragraph lu lv iq lw b lx ly jr lz ma mb ju mc md me mf mg mh mi mj mk ml mm mn mo mp ij bi translated">项目范围是构建一个API来管理内容帖子。您将创建一个具有三种功能的API:创建一篇文章、阅读一篇文章和列出文章。数据库是安装在localhost的MySQL。</p><p id="8ded" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">数据库库正在使用<a class="ae mv" href="https://github.com/jmoiron/sqlx" rel="noopener ugc nofollow" target="_blank">https://github.com/jmoiron/sqlx</a>。<br/>HTTP路由库正在使用<a class="ae mv" href="https://github.com/gin-gonic/gin" rel="noopener ugc nofollow" target="_blank">https://github.com/gin-gonic/gin</a>。</p><p id="fc96" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">既然Go社区已经有了一个很棒的库，那么几乎没有理由从头开始编写一切。</p></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><h1 id="b01e" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">应用设计</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/600b0240e0a62bf49eef0bcf029ade44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hA0QplsB9up_Aame.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">项目应用设计</p></figure><p id="150d" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">我们有两个套餐:<code class="fe mx my mz na b">main</code>和<code class="fe mx my mz na b">post</code>。</p><p id="fc9a" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated"><code class="fe mx my mz na b">main</code>包是Golang中运行应用程序的可执行包。它由来自包<code class="fe mx my mz na b">post</code> ( <code class="fe mx my mz na b">postClient</code>)的一个实例和三个处理路由的函数(<code class="fe mx my mz na b">listPost</code>、<code class="fe mx my mz na b">readPost</code>和<code class="fe mx my mz na b">createPost</code>)组成。</p><p id="830d" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated"><code class="fe mx my mz na b">post</code>包是与数据库交互来管理post的包。它有两种对象类型:<code class="fe mx my mz na b">Client</code>和<code class="fe mx my mz na b">Post</code>。<code class="fe mx my mz na b">Client</code>是使用软件包的界面。<code class="fe mx my mz na b">Post</code>是现实世界内容发布模型的抽象。<code class="fe mx my mz na b">Client</code>的实例有三个运行查询或插入数据库的功能。</p><p id="afea" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">这个项目的数据库结构只有一个名为“post”的表来存储包<code class="fe mx my mz na b">post</code>中的对象<code class="fe mx my mz na b">Post</code>。表格结构如下。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><h1 id="711b" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">密码</h1><h2 id="871e" class="nd ld iq bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls no bi translated">“邮寄”包裹</h2><p id="a637" class="pw-post-body-paragraph lu lv iq lw b lx ly jr lz ma mb ju mc md me mf mg mh mi mj mk ml mm mn mo mp ij bi translated">下面的代码块解释了我们如何构建需要DB输入的<code class="fe mx my mz na b">Client</code>和<code class="fe mx my mz na b">Post</code>类型以及<code class="fe mx my mz na b">NewClient</code>函数。数据库输入使用的是在包外初始化的包。这种方法的思想是包不关心谁和什么创建了<code class="fe mx my mz na b">Client</code>实例，只要它提供了一个工作的DB连接池。行内注释解释了代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="25a2" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">下一个代码块显示了<code class="fe mx my mz na b">Client</code>内部的功能。所有的功能都使用来自<code class="fe mx my mz na b">sqlx</code>的功能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="8a7b" class="nd ld iq bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls no bi translated">“主”包</h2><p id="c792" class="pw-post-body-paragraph lu lv iq lw b lx ly jr lz ma mb ju mc md me mf mg mh mi mj mk ml mm mn mo mp ij bi translated">这个包负责运行HTTP请求监听器。当请求到来时，包使用来自<code class="fe mx my mz na b">gin</code>的HTTP请求路由。在启动时，<code class="fe mx my mz na b">main</code>包启动一个数据库实例，然后传递该实例从<code class="fe mx my mz na b">Post</code>包创建一个新的<code class="fe mx my mz na b">Client</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="d6c8" class="nd ld iq bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls no bi translated">初始化数据库和HTTP路由</h2><p id="d13c" class="pw-post-body-paragraph lu lv iq lw b lx ly jr lz ma mb ju mc md me mf mg mh mi mj mk ml mm mn mo mp ij bi translated">在上面的代码中，<code class="fe mx my mz na b">r</code>通过三个用例进行路由:</p><ul class=""><li id="1857" class="np nq iq lw b lx mq ma mr md nr mh ns ml nt mp nu nv nw nx bi translated"><code class="fe mx my mz na b">/listPost</code> =获取帖子列表</li><li id="5557" class="np nq iq lw b lx ny ma nz md oa mh ob ml oc mp nu nv nw nx bi translated"><code class="fe mx my mz na b">/readPost/:id</code> =获取一篇文章，其中<code class="fe mx my mz na b">:id</code>是文章ID的动态路径</li><li id="3dda" class="np nq iq lw b lx ny ma nz md oa mh ob ml oc mp nu nv nw nx bi translated"><code class="fe mx my mz na b">/createPost</code> =创建一个新的post，这个路由使用HTTP POST方法来携带请求体</li></ul><p id="88cf" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">这三个路由使用的函数利用了在包级别定义的<code class="fe mx my mz na b">postClient</code>实例。该函数的代码如下。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="91ce" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">代码<code class="fe mx my mz na b">listPost</code>正在接收来自<code class="fe mx my mz na b">c.Query("limit")</code>的输入。该查询从HTTP请求中捕获额外的参数。带有参数的HTTP请求的一个例子是<code class="fe mx my mz na b">/listPost?limit=5</code>。使用函数中的代码，它将把<code class="fe mx my mz na b">5</code>解析为一个限制。</p><p id="13f0" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated"><code class="fe mx my mz na b">readPost</code>函数接收来自<code class="fe mx my mz na b">c.Param("id")</code>的输入，后者正在读取HTTP请求中的参数。该参数是URL请求本身的动态输入。带参数请求的一个例子是<code class="fe mx my mz na b">/readPost/1</code>。代码使用捕获路由模式<code class="fe mx my mz na b">/readPost/:id</code>，它捕获<code class="fe mx my mz na b">:id</code>作为输入。举个例子，<code class="fe mx my mz na b">id</code>就是<code class="fe mx my mz na b">1</code>。</p><p id="0e9b" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">函数<code class="fe mx my mz na b">createPost</code>正在使用HTTP POST请求。POST请求可以携带使用<code class="fe mx my mz na b">c.PostForm("content")</code>读取<code class="fe mx my mz na b">content</code>的主体数据接收的主体。</p><p id="9c3d" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">所有代码就绪后，使用以下命令运行应用程序:</p><pre class="kg kh ki kj gt od na oe of aw og bi"><span id="dfd4" class="nd ld iq na b gy oh oi l oj ok">go run main.go</span></pre></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><h1 id="efb4" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">演示</h1><h2 id="05ab" class="nd ld iq bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls no bi translated">创建新帖子</h2><p id="150f" class="pw-post-body-paragraph lu lv iq lw b lx ly jr lz ma mb ju mc md me mf mg mh mi mj mk ml mm mn mo mp ij bi translated">请求使用以下cURL创建一个内容为“hello”的新帖子:</p><pre class="kg kh ki kj gt od na oe of aw og bi"><span id="7089" class="nd ld iq na b gy oh oi l oj ok">curl -X POST 'localhost:8080/createPost' -d 'content=welcome'</span></pre><p id="ce2c" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">请求的输出是文章ID。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/bd28c054654e5ab3b7a365f8eb50e8e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y7g3U_l1A7aS7_fS.png"/></div></div></figure><h2 id="711c" class="nd ld iq bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls no bi translated">使用ID阅读帖子</h2><p id="eff6" class="pw-post-body-paragraph lu lv iq lw b lx ly jr lz ma mb ju mc md me mf mg mh mi mj mk ml mm mn mo mp ij bi translated">使用以前的ID作为请求的输入。使用以下卷曲。</p><pre class="kg kh ki kj gt od na oe of aw og bi"><span id="3359" class="nd ld iq na b gy oh oi l oj ok">curl -X GET 'localhost:8080/readPost/12'</span></pre><p id="eec0" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">请求的输出是post数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/09ff314acb3d10cb74979bd7d14591ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aO588xGdbNTCdsGf.png"/></div></div></figure><h2 id="0d6c" class="nd ld iq bd le ne nf dn li ng nh dp lm md ni nj lo mh nk nl lq ml nm nn ls no bi translated">列出帖子</h2><p id="94cd" class="pw-post-body-paragraph lu lv iq lw b lx ly jr lz ma mb ju mc md me mf mg mh mi mj mk ml mm mn mo mp ij bi translated">使用下面的cURL获取五篇最新的帖子。</p><pre class="kg kh ki kj gt od na oe of aw og bi"><span id="ae3b" class="nd ld iq na b gy oh oi l oj ok">curl -X GET 'localhost:8080/listPost?limit=5'</span></pre><p id="9518" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">输出是五篇最新文章的数据列表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/5df1a9161cf2dcdfe915909012b815ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q8QJJbEABBDoANgh.png"/></div></div></figure></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><h1 id="521a" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">摘要</h1><p id="0cf0" class="pw-post-body-paragraph lu lv iq lw b lx ly jr lz ma mb ju mc md me mf mg mh mi mj mk ml mm mn mo mp ij bi translated">Go社区中有这么多健壮的库，在Go中开发一个API很容易。你可以在这里查看完整的代码:</p><p id="2e77" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated"><a class="ae mv" href="https://github.com/purnaresa/golang/tree/master/project101" rel="noopener ugc nofollow" target="_blank">https://github.com/purnaresa/golang/tree/master/project101</a></p><p id="b20f" class="pw-post-body-paragraph lu lv iq lw b lx mq jr lz ma mr ju mc md ms mf mg mh mt mj mk ml mu mn mo mp ij bi translated">如果你想问一些关于围棋的问题或者对教程有什么疑问，请留下你的评论。下一个教程你想学什么？</p></div></div>    
</body>
</html>