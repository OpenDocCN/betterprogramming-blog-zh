<html>
<head>
<title>Angular Material Tricks — Autocomplete With Multiple Input Fields</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有角度的材料技巧—自动完成多个输入字段</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/angular-material-tricks-autocomplete-with-multiple-input-fields-adebbaae5603?source=collection_archive---------1-----------------------#2019-09-20">https://betterprogramming.pub/angular-material-tricks-autocomplete-with-multiple-input-fields-adebbaae5603?source=collection_archive---------1-----------------------#2019-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f9eb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">是的，您可以为两个输入创建一个自动完成下拉菜单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a21f56c34de85b5ea57baeb7fb9dc957.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T0M2BwN-f0uKAaD7"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@edhoradic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Edho Pratama </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="bb01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将是一篇不短的博文，讲述我如何调整Angular Material的自动完成组件，以基于两个输入框而不是一个输入框获得结果。</p><p id="4514" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我正在为医疗保健行业开发web应用程序。在我目前的任务中，我被要求提供医生搜索功能。该要求称，应用程序的用户可以通过名字和姓氏搜索医生，并支持自动完成。</p><p id="c947" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这看起来像是一个简单的任务。我们选择使用优秀的Angular Material框架，我有了一个好主意，使用素材库中的<a class="ae kv" href="https://material.angular.io/components/autocomplete" rel="noopener ugc nofollow" target="_blank">自动完成</a>组件。</p><p id="776e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我打算提供一个文本框。用户将输入医生的名字，瞧，一个自动完成的下拉菜单将显示医生列表，对吗？</p><p id="3a06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不对。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c348" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">问题是</h1><p id="95fb" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我使用了一个关系数据库，它将医生的名字存储在两列中，称为<code class="fe mw mx my mz b">First_Name</code>和<code class="fe mw mx my mz b">Last_Name</code>。需求是让我让用户同时用名字、姓氏或两者进行搜索。</p><p id="53fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于单个文本框，我无法知道输入的文本是医生的名还是姓。我可以运行一个<code class="fe mw mx my mz b">or</code>查询，但是返回的结果太多了。</p><p id="1bd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于不同的搜索组合，如果用户在文本框中输入不止一个名字，情况会变得更糟。它看起来没有希望，我有点卡住了。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="508f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">解决方案</h1><p id="5fcb" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我想到的另一个主意是将单个全名文本框一分为二。我可以从单独的名和姓文本框中检索用户输入。分隔文本框可以让我识别要查询的正确的一列或多列。</p><p id="c240" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我检查Angular Material autocomplete组件时，它看起来像是为单个输入字段设计的。甚至没有针对多个输入字段的单一引用实现，似乎没有人尝试过这样做。</p><p id="1f74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管如此，我还是决定试一试，不抱太大希望。下面是我的解决方案，奏效了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/6005a59737199047c3d541d28126348a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C8ZtWvMZX4rr48Hu.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这是最终的结果</p></figure><p id="5f1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要实现这一点，我们必须回答两个问题:</p><ol class=""><li id="3814" class="nb nc iq ky b kz la lc ld lf nd lj ne ln nf lr ng nh ni nj bi translated">如何为两个文本框显示一个为单个文本框设计的自动完成下拉框？</li><li id="67b3" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">当这些文本框中的任何一个有新值时，如何触发autocomplete事件？</li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4d91" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">为两个文本框显示单个自动完成下拉列表</h1><p id="d63e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">让我们一行一行地查看下面的Html<em class="np"/>来了解这是怎么回事。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h2 id="6994" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第一行</h2><p id="5963" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在第1行，我们有一个引导程序<code class="fe mw mx my mz b">row</code> <code class="fe mw mx my mz b">div</code>，它有一个<code class="fe mw mx my mz b">matAutocompleteOrigin</code>属性。我们还有一个名为<code class="fe mw mx my mz b">#origin</code>的模板引用变量。</p><p id="c370" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mw mx my mz b">matAutoCompleteOrigin</code>属性使<code class="fe mw mx my mz b">div</code>成为呈现我们的自动完成下拉框的候选目标。在接下来的几行中，我们将使用<code class="fe mw mx my mz b">#origin</code>变量将自动完成组件绑定到这个<code class="fe mw mx my mz b">div</code>。</p><h2 id="7f8c" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第5行</h2><p id="e948" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在第5行，我们定义了名字输入框。使用<code class="fe mw mx my mz b">[matAutocomplete]=”auto”</code>，我们将自动完成组件绑定到这个输入框。<code class="fe mw mx my mz b">[matAutocompleteConnectedTo]=”origin”</code>告诉浏览器呈现相对于我们在第1行定义的<code class="fe mw mx my mz b">div</code>的自动完成下拉列表。</p><h2 id="f506" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第6行</h2><p id="aff1" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在第6行，我们用名为<code class="fe mw mx my mz b">#auto</code>的模板引用定义了我们的自动完成组件，我们在第5行引用了它。</p><p id="f2fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还将自动完成的<code class="fe mw mx my mz b">optionSelected</code>事件绑定到<code class="fe mw mx my mz b">setFormData</code>函数，以便能够定制默认行为。我们将在第二节中讨论<code class="fe mw mx my mz b">setFormData</code>功能。</p><h2 id="8148" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第7–11行</h2><p id="9957" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">第7–11行定义了将显示在自动完成下拉列表中的选项。我们使用<code class="fe mw mx my mz b">async</code>管道在<code class="fe mw mx my mz b">physicians</code>可观察对象上循环，并显示医生的名字和姓氏。</p><h2 id="38f9" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第18–25行</h2><p id="8fb3" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">第18–25行对姓氏输入框做同样的事情，这不需要额外的解释。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="06ae" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">为两个独立的输入框触发相同的Autocomplete事件</h1><p id="d754" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在这一节中，我们将讨论如何使用来自两个不同输入框的更改来触发对同一个自动完成下拉菜单的医师搜索。</p><p id="6cd3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们一行一行地研究代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h2 id="72c3" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第18–21行</h2><p id="2656" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在第18–21行，在初始化<code class="fe mw mx my mz b">PhysicianInfoComponent</code>时，我们进行了两个函数调用<code class="fe mw mx my mz b">setupPhysicianControls()</code>和<code class="fe mw mx my mz b">setupPhysiciansObservable()</code>。</p><p id="719d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个调用用我们在模板中引用的所需的<code class="fe mw mx my mz b">FormControl</code>对象建立了反应式表单。第二个调用用于设置<code class="fe mw mx my mz b">physicians</code>可观察对象，自动完成组件使用它来显示选项列表。</p><h2 id="2f4c" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第23–41行</h2><p id="f674" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">由于设置表单控件很简单，我们的重点将放在第23到41行的<code class="fe mw mx my mz b">setupPhysiciansObservable</code>方法上。</p><p id="5a28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Angular <code class="fe mw mx my mz b">FormControl</code>对象提供了一个<code class="fe mw mx my mz b">valueChanges</code>属性，这是一个可观察的属性，每当表单控件的值发生变化时，它就会发出表单控件的值。</p><p id="26d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的例子中，我们有两个表单控件要处理，分别是名字和姓氏。每当这些表单控件中的一个值改变时，我们都必须在后端触发新的医生搜索。</p><p id="b0e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种将两个可观测量合并成一个的场景中,<code class="fe mw mx my mz b"><a class="ae kv" href="https://www.learnrxjs.io/operators/combination/merge.html" rel="noopener ugc nofollow" target="_blank">merge</a></code>操作符非常有用。</p><h2 id="bbbd" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第24行</h2><p id="5b64" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在第24行，我们使用<code class="fe mw mx my mz b">merge</code>来合并名字和姓氏<code class="fe mw mx my mz b">valueChanges</code>观察值。</p><h2 id="a160" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第26行</h2><p id="2e2f" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">第26行将新值的发射延迟300毫秒，以便在触发搜索之前给用户时间来完成他们的搜索标准。</p><h2 id="201d" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第27–32行</h2><p id="c646" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在第27–32行，我们将发出的对象从单个输入框的值更改为名和姓输入框的值。这是因为我们的要求是让用户同时搜索名和姓。</p><h2 id="5261" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第33行</h2><p id="7881" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">第33行将搜索词限制在三个字符以上。这样，我们不会触发对短于三个字母的术语的搜索。</p><h2 id="9f43" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">第35–39行</h2><p id="034c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">第35–39行发出后端请求，并将<code class="fe mw mx my mz b">response</code>对象映射到<code class="fe mw mx my mz b">response.body</code>，这是一个医师数组，它结束了我们的医师观察设置。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="def9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">setFormData方法</h1><p id="1f1b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们必须研究的第二个重要函数是我在第一节中提到的<code class="fe mw mx my mz b">setFormData</code>方法。</p><p id="ecda" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尤其是第74–75行在这个方法中非常重要，因为当从下拉菜单中选择一个选项时，它们会覆盖autocomplete组件的默认行为。</p><p id="b49a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这几行中，我们不是让autocomplete组件设置名字和姓氏表单控件的值，而是手动设置这些值。</p><p id="16c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">两行代码非常简单，但是技巧是使用<code class="fe mw mx my mz b">{emitEvent: false}</code>选项进行<code class="fe mw mx my mz b">setValue</code>调用。</p><p id="ba5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默认情况下，当值改变时，表单控件发出一个<code class="fe mw mx my mz b">valueChanges</code>事件。这与用户在表单上进行更改或者您在代码中进行更改无关。</p><p id="ee06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过使用<code class="fe mw mx my mz b">{emitEvent: false}</code>，我们防止了一个<code class="fe mw mx my mz b">valueChanges</code>事件被触发，否则这将导致通过我们的<code class="fe mw mx my mz b">physicians</code>可观察的第二个后端调用。</p><p id="12df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">帖子到此结束。我希望它对你的日常努力有所帮助。</p><p id="7ce2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div></div>    
</body>
</html>