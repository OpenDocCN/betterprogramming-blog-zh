<html>
<head>
<title>Create an App That Uses LiveData and ViewModel in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Java中创建一个使用LiveData和ViewModel的应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-an-app-that-uses-livedata-and-viewmodel-in-java-f8086ca94229?source=collection_archive---------3-----------------------#2020-03-25">https://betterprogramming.pub/create-an-app-that-uses-livedata-and-viewmodel-in-java-f8086ca94229?source=collection_archive---------3-----------------------#2020-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7bc7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Android架构组件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d49b896be6c892244fc836f8c5cc6455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E8XExMTx0SX71XDO"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安德斯·吉尔登在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片。</p></figure><p id="abcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Android Jetpack发布的众多工具中，Android架构组件、LiveData和ViewModel尤其有用。我创建这个教程是为了回应阿什顿·琼斯(Ashton Jones)的观点，他表示将这些架构组件与谷歌Firestore集成的例子非常少。</p><p id="27c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，您将学习所有这些元素如何交互，创建一个基于谷歌技术的具有后端(Firestore)和前端(Android应用)的全功能应用程序。</p><p id="c57b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第一部分中，我们将从构建Android项目开始。为了演示LiveData和ViewModel的使用，我们将创建一个模拟购物清单的应用程序。</p><p id="e997" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从我的网站下载启动项目<a class="ae ky" href="http://www.evanamargain.com/blog/wp-content/uploads/2020/05/MyShoppingList-Starter.zip" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="7f40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个简单的Android Java项目。它只包含一个<code class="fe lv lw lx ly b">MainActivity.java</code>文件和相应的布局。一旦Gradle sync完成，运行应用程序，您应该会看到一个HelloWorld屏幕，如下图1所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/bd083d6f5d2e97d33bd5e490d2652840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*XY9HiCpQwPz9M5dKpVvvFg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:应用程序的初始视图。</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="0a80" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">设置项目的架构</h1><p id="1395" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">一旦你得到这个工作，你将创建应用程序的文件夹结构。移动架构被广泛讨论，但是由于Android引入了架构组件，他们给了我们一个指向MVVM的指导方针。在项目的第一部分，您将关注视图和视图模型。</p><p id="65de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在左侧面板的Android项目视图下，创建两个新包:一个名为“view”，另一个名为“ViewModel”。然后在视图包内拖动<code class="fe lv lw lx ly b">MainActivity.java</code>。生成的项目结构应类似于下图2所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/0640cb48b49f215d7c91f4f48c0a6849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0WR9aPT04B53be-m"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:添加视图和视图模型包后的结果结构。</p></figure><p id="d5e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是创建视图模型。右键单击ViewModel包并选择New &gt; Java Class。给它起个名字，最好是带后缀ViewModel的——我将把它命名为<code class="fe lv lw lx ly b">MainActivityViewModel.java</code>。有了这两个文件，我们可以同时使用LiveData和ViewModel。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/7882787ddd72a6fdeb3a9f1e80e4aa44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGa1uhKu6pw_8-7IdRhj_A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">托马斯·格里尔迈尔在<a class="ae ky" href="https://unsplash.com/s/photos/view-model?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="b22c" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">创建视图模型</h1><p id="b607" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">首先创建您的视图模型。你需要做的第一件事是扩展<a class="ae ky" href="https://developer.android.com/topic/libraries/architecture/viewmodel" rel="noopener ugc nofollow" target="_blank"> Android架构组件视图模型库</a>。您的类定义应该如下所示:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="3a29" class="nk mi it ly b gy nl nm l nn no">public class MainActivityViewModel extends ViewModel {</span></pre><p id="da92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果它不是自动导入的，也用下面的代码行添加所需的依赖项:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="2b7c" class="nk mi it ly b gy nl nm l nn no">import androidx.lifecycle.ViewModel;</span></pre><p id="c949" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您将创建一个对象来保存购物清单。这个对象需要是一个类型为<code class="fe lv lw lx ly b">String</code>的可变数据列表，因为您的购物列表项目将只是项目的名称。</p><p id="10bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个更现实的场景中，您可能会在您的“model”包(不是我们创建的)下有一个ShoppingItem对象，并获取该项目的属性，但是我试图创建一个最小的示例。使用<code class="fe lv lw lx ly b">MainActivityViewModel</code>类中的这行代码创建列表:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="bdd9" class="nk mi it ly b gy nl nm l nn no">private MutableLiveData&lt;List&lt;String&gt;&gt; shoppingList;</span></pre><p id="f1e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述变量的目的是将所有购物清单项目保存在一个LiveData对象中。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="6d2e" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">异步获取LiveData</h1><p id="d1a9" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">在这个项目的第一部分，您将使用计时器模拟数据的异步调用。您需要做的第一件事是检索列表，然后将它添加到上一步创建的<code class="fe lv lw lx ly b">shoppingList</code>变量中。在<code class="fe lv lw lx ly b">MainActivityViewModel.java</code>类中添加该函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="a04c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码验证<code class="fe lv lw lx ly b">shoppingList</code>是否为空，如果是，它创建一个新对象并将购物清单加载到其中。</p><p id="da86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将需要另一个函数来加载列表。将其添加到<code class="fe lv lw lx ly b">getShoppingList()</code>下方，代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="589e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们单独回顾一下上面的代码，因为它有点长:</p><ol class=""><li id="a18c" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">你创建一个处理程序。这个处理程序的目的是保存函数中的代码，以便它在一段时间后执行。</li><li id="2c84" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">您在第二个参数(第6行)中告诉处理程序延迟执行秒数。</li><li id="08fd" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">在这几行中，您创建了一个示例购物清单，该清单将由第三方服务Firestore填充。</li><li id="9756" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">shuffle的目的是查看数据是否在任一点被刷新。LiveData的一个重要方面是，与其他类型的数据不同，当发生某些操作时(例如，当方向发生变化时)，它不会丢失。</li><li id="31d4" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">这行代码将“下载的”(模拟的)数据分配到<code class="fe lv lw lx ly b">MutableLiveData</code>的本地对象中。</li><li id="3095" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">如第2点所述，这是为数据“加载”设置了5k毫秒的延迟</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/e904a58bf32fe4e5d842563d2fb76a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lQg6uuQ7owqww4V_rS5wEw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@drew_saurus?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">在<a class="ae ky" href="https://unsplash.com/s/photos/view?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上画出了Saurus </a>。</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="73d2" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">解决纷争</h1><p id="f62f" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">如果您在执行上述步骤后在项目中遇到错误，请阅读本部分进行故障排除。否则，您可以跳到下一部分。</p><p id="36f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是你可能遇到的最常见的问题。</p><h2 id="c233" class="nk mi it bd mj og oh dn mn oi oj dp mr li ok ol mt lm om on mv lq oo op mx oq bi translated">项目应该设置为Java 8</h2><p id="c691" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">在第2点的<code class="fe lv lw lx ly b">loadShoppingList()</code>中，你可能会注意到我们有一个箭头(<code class="fe lv lw lx ly b">-&gt;</code>)。这被称为lambda表达式，仅在Java 8中受支持。要解决这个问题，进入文件&gt;项目结构，在源兼容性和目标兼容性字段中选择Java 1.8:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/d05b7c293f1d6b597ade8cf474862161.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S5Sc6AYIRih07tdQ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:将项目设置为Java 1.8。</p></figure><h2 id="629e" class="nk mi it bd mj og oh dn mn oi oj dp mr li ok ol mt lm om on mv lq oo op mx oq bi translated">导入不正确的依赖关系</h2><p id="3cba" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">在Android和Java中，对不同的功能有相似的依赖是很常见的。Android Studio自动导入依赖项时，有时会得到错误的依赖项。确保您的导入如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="1785" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您仍然有问题，请查看下面的ViewModel代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/e8a29060048603da3978fb788b5f200f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JmRD0IYpNLOJIlYK5ey4-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:完整的视图模型类。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/1d16dc4df15255bf1183913cd328e243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*STPPV5nzEvAk5n20G3VJ1w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马特·米尔顿在<a class="ae ky" href="https://unsplash.com/s/photos/view-model?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="65f8" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">测试应用程序</h1><p id="6ca9" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">添加上面的代码后，应用程序应该没有任何变化。它应该能够成功编译和运行，但是您仍然会看到HelloWorld空屏幕。这是因为我们只实现了ViewModel，它是模型和视图之间的通信，但我们仍然没有将它绑定到视图本身。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/837217b5f97aaa7ac00de7fdc9c6edd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*0h157cQIz-uqzAasGLkLIQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图5:添加视图模型后的应用程序。</p></figure><h2 id="42cd" class="nk mi it bd mj og oh dn mn oi oj dp mr li ok ol mt lm om on mv lq oo op mx oq bi translated">将视图连接到视图模型</h2><p id="bc2b" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">如上所述，现在您将使用视图，以便正确显示从ViewModel加载的数据。</p><h2 id="0f51" class="nk mi it bd mj og oh dn mn oi oj dp mr li ok ol mt lm om on mv lq oo op mx oq bi translated">配置视图的XML</h2><p id="5b84" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">打开位于app &gt; res &gt;布局中的<code class="fe lv lw lx ly b">activity_main.xml</code>。删除“Hello World”文本视图，并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="71db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码包含两个XML项:</p><ol class=""><li id="4313" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">进度条就是通常所说的“微调器”，只要信息延迟加载(对于我们已经编码的内容为5k毫秒)，它就会显示在屏幕上。</li><li id="9643" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">ListView，加载后将显示购物清单项目。</li></ol><p id="5640" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您此时运行应用程序，您将在屏幕上看到进度条(微调器)，但它永远不会显示列表，因为它仍然没有与<code class="fe lv lw lx ly b">MainActivity.java</code>中的视图代码配对。运行它来查看这一点，并验证您的代码正在工作。您的应用程序应该如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/79765f7de8b230373521a2ec0b6a4afe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/0*o5xq17-q2BOEd7DJ"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图6:进度条旋转的屏幕。</p></figure><h2 id="8fd0" class="nk mi it bd mj og oh dn mn oi oj dp mr li ok ol mt lm om on mv lq oo op mx oq bi translated">添加Android生命周期依赖项</h2><p id="76e7" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">为了让ViewModel工作，您需要将生命周期扩展依赖项添加到<code class="fe lv lw lx ly b">build.gradle(Module: app)</code>:</p><pre class="kj kk kl km gt ng ly nh ni aw nj bi"><span id="f9d7" class="nk mi it ly b gy nl nm l nn no">implementation 'androidx.lifecycle:lifecycle-extensions:2.0.0'</span></pre><p id="c6b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Android Studio将请求Gradle进行同步。去做，应该会成功。</p><h2 id="0742" class="nk mi it bd mj og oh dn mn oi oj dp mr li ok ol mt lm om on mv lq oo op mx oq bi translated">显示数据</h2><p id="bd16" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">现在打开<code class="fe lv lw lx ly b">MainActivity.java</code>，我们把它移到你的视图文件夹中。在<code class="fe lv lw lx ly b">setContentView()</code>行下面的<code class="fe lv lw lx ly b">onCreate</code>方法中，添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="5c9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们再次回顾每一行:</p><ol class=""><li id="8335" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">您初始化ListView并从XML中获取它。</li><li id="f0aa" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">进度条也是一样:我们初始化它并从XML中获取视图。然后将它设置为visible——在加载数据时显示。</li><li id="9070" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">接下来，使用Android Jetpack提供的<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.android.com/reference/androidx/lifecycle/ViewModelProvider" rel="noopener ugc nofollow" target="_blank">ViewModelProvider</a></code>初始化您的视图模型。简而言之，<code class="fe lv lw lx ly b">ViewModelProvider</code>是一个存储ViewModel并使其在整个应用程序中可用的类，因此所有需要它的类都可以访问这些信息。</li><li id="30c9" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">一旦有了ViewModel，就调用<code class="fe lv lw lx ly b">getShoppingList()</code>方法。您可能还记得，该方法是异步的。这需要五秒钟，然后返回数据。这就是你观察反应的原因。</li><li id="1080" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">一旦收到购物清单，您就可以创建一个数组适配器来创建列表视图。您将使用<code class="fe lv lw lx ly b">layout.simple_list_item_1</code>，它是一个<a class="ae ky" href="https://github.com/aosp-mirror/platform_frameworks_base/tree/master/core/res/res/layout" rel="noopener ugc nofollow" target="_blank">预提供的XML，用于Android操作系统</a>的ListViews。</li><li id="2ec2" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">然后，将上一步中创建的适配器分配给ListView。</li><li id="3003" class="nr ns it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated">最后，隐藏进度视图并显示数据。</li></ol><h2 id="1481" class="nk mi it bd mj og oh dn mn oi oj dp mr li ok ol mt lm om on mv lq oo op mx oq bi translated">必需的进口</h2><p id="73d4" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">这段代码需要一些导入才能工作。一些将由Android Studio自动完成，你需要手动添加其他。以下是<code class="fe lv lw lx ly b">MainActivity.java</code>应该有的全部导入:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="037c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些工作完成后，您应该能够测试应用程序，并在等待五秒钟后看到您的列表出现:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/1ac97722867d5260de3f7066dfe225ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*jFWINsIiBvW6uCESj4WlSg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图7:屏幕上显示的购物清单。</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="ccd1" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">结论</h1><p id="7573" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">太好了！我们现在有一个实现LiveData和ViewModel的应用程序。在下一部分中，我们将把Firestore集成到这个应用程序中，以便从远程数据源加载数据。如果你想看看项目完成后应该如何工作，你可以从我的网站下载完成的项目<a class="ae ky" href="http://www.evanamargain.com/blog/wp-content/uploads/2020/05/MyShoppingList-End.zip" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="243f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有任何疑问，不要犹豫，留下评论，我会尽快回复。</p><p id="953c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下次见，感谢阅读！</p></div></div>    
</body>
</html>