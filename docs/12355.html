<html>
<head>
<title>Log Machine Learning Experiments With MLflow on Azure Databricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用MLflow在Azure Databricks上进行日志机器学习实验</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/log-machine-learning-experiments-with-mlflow-on-azure-databricks-5a85955c9d3a?source=collection_archive---------19-----------------------#2022-05-30">https://betterprogramming.pub/log-machine-learning-experiments-with-mlflow-on-azure-databricks-5a85955c9d3a?source=collection_archive---------19-----------------------#2022-05-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a553" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Databricks中获取远程MLflow tracking服务器上记录的模型、指标和工件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dc5969a27ed93dc7ce5653ee2e834fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X7FUL-fMpeJuR-db"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@maxcodes?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">麦斯威尔·尼尔森</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ab34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上一篇文章中:<a class="ae ky" href="https://medium.com/@evgeniimunin47/automate-your-machine-learning-experiments-with-mlflow-8c9e42df421" rel="noopener">“用MLflow自动化你的机器学习实验”</a>我们对<a class="ae ky" href="https://www.kaggle.com/datasets/fedesoriano/spanish-wine-quality-dataset" rel="noopener ugc nofollow" target="_blank">葡萄酒价格预测数据集</a>进行了几次运行。</p><p id="dd41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经在本地跟踪服务器中记录了结果、工件和模型参数。但是，当我们在一个团队中工作，并且想要比较我们的同事在本地机器之外制作的日志时，我们应该做什么呢？</p><p id="b4cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们应该设置一个远程跟踪服务器，工件驻留在远程主机上。为此，我们将使用Azure Databricks上的实例。</p><p id="af38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们应该登录到Databricks工作区。出于演示的目的，我登录了社区云数据块，因为它为简单的ML实验免费提供了足够的功能。我们注册并填写表格来创建一个账户<a class="ae ky" href="https://databricks.com/try-databricks" rel="noopener ugc nofollow" target="_blank">https://databricks.com/try-databricks</a>。在这之后，主页应该看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/2d93e681c42e3bfa219210b23a2bff88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPfkGXL9xIvNGrn9LBZorw.png"/></div></div></figure><p id="4cab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们能够访问我们的工作区时，我们应该安装CLI工具来与远程工作区交互。为了安装CLI，我使用了Python版本3.8.8和以下pip命令:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="b637" class="mb mc it lx b gy md me l mf mg">pip install databricks-cli</span></pre><p id="4498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装CLI后，我们可以使用以下命令检查其版本</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="5028" class="mb mc it lx b gy md me l mf mg">databricks --version</span></pre><p id="1622" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么我们应该设置身份验证。有两种方法可以做到这一点</p><ul class=""><li id="9bfb" class="mh mi it lb b lc ld lf lg li mj lm mk lq ml lu mm mn mo mp bi translated">通过提供用户名和密码</li><li id="3aad" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">通过生成和提供数据块个人访问令牌。推荐使用这种方法，但是在写这篇文章的时候，我没有在用户设置中找到可用的令牌生成，可能是因为我正在使用社区云。</li></ul><p id="6fae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们将进行第一个选项。要设置身份验证，请编写以下命令</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="e5b3" class="mb mc it lx b gy md me l mf mg">databricks configure</span></pre><p id="dcae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在提示中，我们需要提供</p><ul class=""><li id="bed5" class="mh mi it lb b lc ld lf lg li mj lm mk lq ml lu mm mn mo mp bi translated">主机名。一般来说，您应该以<code class="fe mv mw mx lx b">https://&lt;instance name&gt;.cloud.databricks.com</code>的格式输入您的工作区URL。在社区云的情况下，我们进入<a class="ae ky" href="https://community.cloud.databricks.com/" rel="noopener ugc nofollow" target="_blank">https://community.cloud.databricks.com/</a>。</li><li id="49cf" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">用户名(您的电子邮件)</li><li id="35c9" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">密码</li></ul><p id="707e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成提示后，您的凭证将存储在<code class="fe mv mw mx lx b">~/.databrickscfg</code>文件中，以便您可以检查它们。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="e454" class="mb mc it lx b gy md me l mf mg">cat .databrickscfg</span></pre><p id="c0ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以检查CLI是否可以与远程工作区交互。运行以下命令查看工作区文件夹内容。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="2084" class="mb mc it lx b gy md me l mf mg">databricks workspace ls /<a class="ae ky" href="mailto:Users/munin.evgenii@gmail.com" rel="noopener ugc nofollow" target="_blank">Users/</a>&lt;your username&gt;</span></pre><p id="179d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于如何设置更多高级访问的更详细说明，如多个配置文件和命令组，您可以在<a class="ae ky" href="https://docs.databricks.com/dev-tools/cli/index.html#set-up-authentication" rel="noopener ugc nofollow" target="_blank"> Databricks CLI文档</a>中找到。</p><p id="0158" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入MLflow后，立即在Databricks工作区中设置跟踪URI和实验文件夹。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="58eb" class="mb mc it lx b gy md me l mf mg">import mlflow<br/>mlflow.set_tracking_uri("databricks")<br/>mlflow.set_experiment("/<a class="ae ky" href="mailto:Users/munin.evgenii@gmail.com" rel="noopener ugc nofollow" target="_blank">Users/</a>&lt;your username&gt;/SpanishWinePrediction")</span></pre><p id="8429" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们用逻辑回归、随机森林和KNN回归模型进行了与在<a class="ae ky" href="https://medium.com/@evgeniimunin47/automate-your-machine-learning-experiments-with-mlflow-8c9e42df421" rel="noopener">之前的文章</a>中所做的相同的实验。运行应该直接上传到远程工作区。MLflow UI主页应如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/38842370c01d2af6f56cda06521fec40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9AI23rG1xGca4OlP37R43Q.png"/></div></div></figure><p id="2c13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，我们可以对每次运行的验证指标进行并排比较。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/9d61ff1029c2b03bc2bbcbb1dd0dbb04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E3UtxR_hwJn5Jg7agfzVfA.png"/></div></div></figure><p id="b8a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们设置了远程跟踪服务器，并记录了实验运行的结果。感谢您的阅读，我将感谢您在下面评论区的反馈！</p><h2 id="9951" class="mb mc it bd mz na nb dn nc nd ne dp nf li ng nh ni lm nj nk nl lq nm nn no np bi translated">链接</h2><ul class=""><li id="b335" class="mh mi it lb b lc nq lf nr li ns lm nt lq nu lu mm mn mo mp bi translated">【https://docs.databricks.com/dev-tools/cli/index.html T4】</li><li id="17f3" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated"><a class="ae ky" href="https://github.com/databricks/databricks-cli#installation" rel="noopener ugc nofollow" target="_blank">https://github.com/databricks/databricks-cli#installation</a></li><li id="2a38" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated"><a class="ae ky" href="https://docs.databricks.com/applications/mlflow/tracking.html" rel="noopener ugc nofollow" target="_blank">https://docs . databricks . com/applications/ml flow/tracking . html</a></li></ul></div></div>    
</body>
</html>