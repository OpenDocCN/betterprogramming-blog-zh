<html>
<head>
<title>SwiftUI Advanced Animation: Morphing Shapes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI高级动画:变形形状</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swiftui-advanced-animation-morphing-shapes-239a42200181?source=collection_archive---------4-----------------------#2022-05-05">https://betterprogramming.pub/swiftui-advanced-animation-morphing-shapes-239a42200181?source=collection_archive---------4-----------------------#2022-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b6d5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我将展示如何使用带有Accelerate库的矢量算法协议来有效地激活复杂的SwiftUI视图</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2c67ae5735a5d8cdfb48ad76127b42e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACZ1D5e_5kn6GJ9WCawa0A.png"/></div></div></figure><p id="e91c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">常规的<code class="fe ln lo lp lq b">.animate()</code>函数已经提供了一种强大的视图动画方式。然而，它的使用仅限于简单的转换。</p><p id="5a63" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本指南中，我将展示如何使用带有<code class="fe ln lo lp lq b">Accelerate</code>库的<code class="fe ln lo lp lq b">VectorArithmetic</code>协议来快速计算复杂的SwiftUI视图。</p><h1 id="cada" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">灵感</h1><p id="1700" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">在本指南中，我们将制作一个受熔岩灯泡泡启发的<em class="mo">变形球体</em>动画。某种晃动的熔岩气泡。</p><blockquote class="mp mq mr"><p id="6e7a" class="kr ks mo kt b ku kv jr kw kx ky ju kz ms lb lc ld mt lf lg lh mu lj lk ll lm ij bi translated">💡所提出的技术可以用于其他更复杂的动画</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/7ab88936dff832ea009c97da93c2c189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Iovmfpi0I4iPJXgg.gif"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">摇摆气泡</p></figure><h1 id="a9fb" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">创建自定义动画</h1><p id="b7fe" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">你可能认为动画是两种状态之间的转换。而且这个过渡一定要平稳！为了显示这个平滑的过渡，SwiftUI需要知道如何在阶段之间进行绘制。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/12e11e446ad126b876ba083ca7ed268a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7pEz8EDX8DDtz1Nl.png"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">两种形状(状态)之间的平滑变化</p></figure><h2 id="633d" class="nb ls iq bd lt nc nd dn lx ne nf dp mb la ng nh md le ni nj mf li nk nl mh nm bi translated">动画向量</h2><p id="36a4" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">动画的关键思想是用可以不断变化的属性来表示对象的状态。</p><p id="5df5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，如果我们试图为一个物体的定位制作动画，而它有整数坐标，那么创建一个物体从一个坐标平滑移动到另一个坐标的中间帧是不可能的。相反，如果对象的位置由浮点变量表示，那么我们可以逐渐改变对象的坐标，直到获得新的坐标。</p><p id="6f3b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">更复杂的动画也是如此。但是通常情况下，状态不能用单个浮点变量来表示。在这种情况下，我们将使用<code class="fe ln lo lp lq b">AnimatableVector</code>。它代表一个数学向量，符合<code class="fe ln lo lp lq b">VectorArithmetic</code>协议。</p><blockquote class="mp mq mr"><p id="9938" class="kr ks mo kt b ku kv jr kw kx ky ju kz ms lb lc ld mt lf lg lh mu lj lk ll lm ij bi translated">💡如果两个动画阶段由符合<code class="fe ln lo lp lq b">VectorArithmetic</code>协议的对象表示，则SwiftUI可以计算中间向量并绘制过渡。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/fc6edd593efe9bfae1abd06316d54b45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_fc1VJdBY9bnvJvK.png"/></div></div></figure><p id="2967" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ln lo lp lq b">AnimatableVector</code>非常简单。我们存储一个坐标数组，并为它们定义基本的数学运算。在下面的代码中，Accelerate用于快速计算。</p><p id="ab05" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当向量只包含几个值时，Accelerate会引入过多的开销。所以，如果你的动画可以用几个值来表示，那么考虑重写没有加速的操作符。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="9e9f" class="nb ls iq bd lt nc nd dn lx ne nf dp mb la ng nh md le ni nj mf li nk nl mh nm bi translated">摇摆气泡</h2><p id="052f" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">所以，正如我已经说过的，我们需要用<code class="fe ln lo lp lq b">AnimatableVector</code>来定义动画的阶段，这样SwiftUI将能够神奇地绘制所有的中间帧。</p><p id="4bb6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要用一个圆做到这一点，我们首先需要设法让它能够<em class="mo">摆动。</em>这是通过曲线逼近来实现的。为了制作变形效果，我们将使用<code class="fe ln lo lp lq b">AnimatableVector</code>来修改每个特定点的半径。</p><p id="5607" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样。</p><p id="7178" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">向量的第一个坐标将表示第一个近似点的距离必须增加多少。第二个是为了第二点等等。</p><p id="5a1c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以在下面的一张gif中看到每个特定点的半径是如何变化的，SwiftUI是如何平滑变化的。还会显示曲线的控制点。\</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/56badb08c8eaa2ab4fe2aeb7a6ef1004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*K6jjS-v24zezYhVGcpRV1g.gif"/></div></figure><h1 id="e39f" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">履行</h1><p id="9d44" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">动画的概念确定了。是时候编码了！</p><p id="52de" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如我所说，主要思想是用曲线近似一个圆。有一个控制点的近似值:<code class="fe ln lo lp lq b">(4/3)*tan(pi/(2n))</code>用<code class="fe ln lo lp lq b">n</code>线段从一个圆中的一个点的距离。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/a8da9e37169b19930cb36c98f7f13d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/0*A8IChItxPeAY_2ID.png"/></div><p class="mw mx gj gh gi my mz bd b be z dk translated">https://stack overflow . com/questions/1734745/如何用贝塞尔曲线创建圆</p></figure></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="df2b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将把圆表示为符合<code class="fe ln lo lp lq b">Shape</code>协议的对象。为了让SwiftUI知道制作什么动画，您需要定义<code class="fe ln lo lp lq b">animatableData</code>属性。这就是SwiftUI将要用来制作帧间动画的东西。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="8587" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一点点线性代数和所有的点坐标都算出来了。需要对<code class="fe ln lo lp lq b">CGVector</code>和<code class="fe ln lo lp lq b">CGPoint</code>进行一些更高级的操作:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="4e48" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，实现<code class="fe ln lo lp lq b">Shape</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="48e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，我们可以在视图中使用这个形状。为了制造抖动效果，我们需要改变负责半径修改的向量。</p><p id="6c2e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这可以通过定时器来完成。</p><h2 id="9408" class="nb ls iq bd lt nc nd dn lx ne nf dp mb la ng nh md le ni nj mf li nk nl mh nm bi translated">使用计时器</h2><p id="b06b" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">我们将在计时器的回调中随机改变变形向量。此外，一次改变所有的点看起来很奇怪，所以我们将只制作其中一部分的动画。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no np l"/></div></figure><h1 id="9d81" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">结果</h1><p id="636f" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">例如，创建的气泡可以被组合和动画化以在屏幕上漂移。此外，在本指南的过程中，我们创建了您可以在项目中使用的<code class="fe ln lo lp lq b">AnimatableVector</code>结构。</p><p id="0bd4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请随意分享您的结果！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/6172a2c1ccfda37d169568c17399ea03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gxbLdRoAJ5iI3QHo.gif"/></div></div><p class="mw mx gj gh gi my mz bd b be z dk translated">更多摇摆的泡沫</p></figure><p id="e57f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看我的博客iOS部分，了解更多有用的技巧:</p><div class="nz oa gp gr ob oc"><a href="http://alexdremov.me/tag/ios/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">亚历克斯·德雷莫夫| iOS</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">我的最爱之一。这里我写的是Swift和iOS开发</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">alexdremov.me</p></div></div><div class="ol l"><div class="om l on oo op ol oq kp oc"/></div></div></a></div><h1 id="4cbe" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">参考</h1><ul class=""><li id="ec9e" class="or os iq kt b ku mj kx mk la ot le ou li ov lm ow ox oy oz bi translated"><a class="ae pa" href="https://stackoverflow.com/questions/1734745/how-to-create-circle-with-bézier-curves" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/1734745/how-to-create-circle with-bézier-curves</a></li><li id="eb10" class="or os iq kt b ku pb kx pc la pd le pe li pf lm ow ox oy oz bi translated"><a class="ae pa" href="https://developer.apple.com/documentation/swiftui/animatable/animatabledata-swift.property-6nydg" rel="noopener ugc nofollow" target="_blank">https://developer . apple . com/documentation/swift ui/animatable/animatabledata-swift . property-6 nydg</a></li></ul></div></div>    
</body>
</html>