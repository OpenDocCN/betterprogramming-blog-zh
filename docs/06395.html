<html>
<head>
<title>Django Project Best Practices to Keep Your Developers Happy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django项目最佳实践让您的开发人员满意</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/django-project-best-practices-to-keep-your-developers-happy-bcb522f3eb12?source=collection_archive---------8-----------------------#2020-09-28">https://betterprogramming.pub/django-project-best-practices-to-keep-your-developers-happy-bcb522f3eb12?source=collection_archive---------8-----------------------#2020-09-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4889" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Makefiles、预提交钩子和GitHub动作来帮助创建一个快乐的开发团队</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/c6a3de0244f1f4f5d4728516b9d68a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*NT0XR9Qpgyi-lyhi.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者插图。</p></figure><p id="5002" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你希望你的团队<em class="lq">享受</em>你的开发工作流程吗？你认为构建软件应该是有趣的和现实的吗？如果是这样，这篇<em class="lq"> </em>就是给你的文章！</p><p id="02cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我已经用Django开发了很多年，我从来没有像现在这样对我的Django项目设置感到满意。以下是我如何让和Django一起开发的一天成为我和我的工程团队最放松和愉快的经历。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="42e6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">Django项目的定制CLI工具</h1><p id="a707" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">不要键入:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="2050" class="na lz it mw b gy nb nc l nd ne">python3 -m venv env<br/>source env/bin/activate<br/>pip install -r requirements.txt<br/>python3 manage.py makemigrations<br/>python3 manage.py migrate<br/>python3 manage.py collectstatic<br/>python3 manage.py runserver</span></pre><p id="ddf3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">键入<code class="fe nf ng nh mw b">make start</code>并让这一切为你发生不是更好吗？我想是的！我们可以用一个自文档化的Makefile来实现！这里有一个我在开发Django应用程序时经常使用的例子，比如<a class="ae ni" href="https://applybyapi.com/" rel="noopener ugc nofollow" target="_blank">ApplyByAPI.com</a>:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="26e1" class="na lz it mw b gy nb nc l nd ne">SHELL := /bin/bash<br/><br/>include .env<br/><br/>.PHONY: help<br/>help: <em class="lq">## Show this help<br/></em>    @egrep -h '\s##\s' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'<br/><br/>.PHONY: venv<br/>venv: <em class="lq">## Make a new virtual environment<br/></em>    python3 -m venv $(VENV) &amp;&amp; source $(BIN)/activate<br/><br/>.PHONY: install<br/>install: venv <em class="lq">## Make venv and install requirements<br/></em>    $(BIN)/pip install -r requirements.txt<br/><br/>migrate: <em class="lq">## Make and run migrations<br/></em>    $(PYTHON) manage.py makemigrations<br/>    $(PYTHON) manage.py migrate<br/><br/>db-up: <em class="lq">## Pull and start the Docker Postgres container in the background<br/></em>    docker pull postgres<br/>    docker-compose up -d<br/><br/>db-shell: <em class="lq">## Access the Postgres Docker database interactively with psql<br/></em>    docker exec -it container_name psql -d $(DBNAME)<br/><br/>.PHONY: test<br/>test: <em class="lq">## Run tests<br/></em>    $(PYTHON) $(APP_DIR)/manage.py test application --verbosity=0 --parallel --failfast<br/><br/>.PHONY: run<br/>run: <em class="lq">## Run the Django server<br/></em>    $(PYTHON) $(APP_DIR)/manage.py runserver<br/><br/>start: install migrate run <em class="lq">## Install requirements, apply migrations, then start development server</em></span></pre><p id="cceb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您会注意到上面的线<code class="fe nf ng nh mw b">include .env</code>的存在。这确保了<code class="fe nf ng nh mw b">make</code>可以访问存储在名为<code class="fe nf ng nh mw b">.env</code>的文件中的环境变量。这允许Make在其命令中使用这些变量(例如，我的虚拟环境的名称或者传入<code class="fe nf ng nh mw b">$(DBNAME)</code>到<code class="fe nf ng nh mw b">psql</code>)。</p><p id="af2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那个奇怪的<code class="fe nf ng nh mw b">##</code>注释语法是怎么回事？这样的Makefile为您提供了一套方便的命令行别名，您可以将其签入到您的Django项目中。只要你能记住所有这些别名，它就非常有用。上面的<code class="fe nf ng nh mw b">help</code>命令是默认运行的，当您运行<code class="fe nf ng nh mw b">make</code>或<code class="fe nf ng nh mw b">make help</code>时，它会打印一个有用的可用命令列表:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="e6b0" class="na lz it mw b gy nb nc l nd ne">help                 Show this help<br/>venv                 Make a new virtual environment<br/>install              Make venv and install requirements<br/>migrate              Make and run migrations<br/>db-up                Pull and start the Docker Postgres container in the background<br/>db-shell             Access the Postgres Docker database interactively with psql<br/>test                 Run tests<br/>run                  Run the Django server<br/>start                Install requirements, apply migrations, then start development server</span></pre><p id="9413" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所有常见的Django命令都包括在内，我们有一个<code class="fe nf ng nh mw b">test</code>命令，它用我们喜欢的选项运行我们的测试。太棒了。</p><p id="b5d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以阅读我关于自文档化Makefile的文章全文，其中也包括一个使用<code class="fe nf ng nh mw b">pipenv</code>的Makefile示例。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="eb0e" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">使用预提交挂钩节省您的脑力</h1><p id="6151" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我之前写过一些技术人机工程学<a class="ae ni" href="https://victoria.dev/blog/technical-ergonomics-for-the-efficient-developer/" rel="noopener ugc nofollow" target="_blank">的文章</a>，它们可以让团队更容易开发出优秀的软件。一个显而易见的地方是在检入lint代码之前使用预提交钩子。这有助于确保您的开发人员签入的代码的质量，但最重要的是，它确保了您的团队中没有人花费时间去试图记住应该是单引号还是双引号，或者应该在哪里换行。</p><p id="20c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">令人困惑的命名为<a class="ae ni" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">的预提交框架</a>是保持钩子(不包括在克隆的仓库中)在本地环境中一致的另一种奇妙方式。这是我的Django项目的配置文件<code class="fe nf ng nh mw b">.pre-commit-config.yaml</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="8c65" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些钩子检查意外的秘密提交，使用<a class="ae ni" href="https://github.com/psf/black" rel="noopener ugc nofollow" target="_blank"> Black </a>格式化Python文件，使用<code class="fe nf ng nh mw b"><a class="ae ni" href="https://github.com/asottile/blacken-docs" rel="noopener ugc nofollow" target="_blank">blacken-docs</a></code>格式化Markdown文件中的Python片段，以及<a class="ae ni" href="https://github.com/igorshubovych/markdownlint-cli" rel="noopener ugc nofollow" target="_blank"> lint Markdown文件</a>。对于您的特定用例，可能还有更有用的挂钩。参见<a class="ae ni" href="https://pre-commit.com/hooks.html" rel="noopener ugc nofollow" target="_blank">支撑挂钩</a>进行探索。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="52d6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">有用的gitignores</h1><p id="804a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">一个不被重视的改善团队日常开发体验的方法是确保你的项目使用一个全面的<code class="fe nf ng nh mw b">.gitignore</code>文件。它可以帮助防止包含秘密的文件被提交，并且通过确保您永远不会筛选生成的文件，还可以为开发人员节省数小时的乏味时间。</p><p id="c62b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了有效地为Python和Django项目创建一个<a class="ae ni" href="https://www.toptal.com/developers/gitignore/api/python,django" rel="noopener ugc nofollow" target="_blank"> gitignore，Toptal的</a><a class="ae ni" href="https://gitignore.io" rel="noopener ugc nofollow" target="_blank"> gitignore.io </a>可以作为一个很好的资源来生成一个健壮的<code class="fe nf ng nh mw b">.gitignore</code>文件。我仍然建议您自己检查生成的结果，以确保被忽略的文件适合您的用例，并且没有您想要忽略的内容被注释掉。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="173f" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">用GitHub动作进行连续测试</h1><p id="d0cc" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">如果你的团队在GitHub上工作，建立一个带有动作的测试过程是容易实现的。在一致的环境中对每个拉请求运行测试可以帮助消除“在我的机器上工作”的难题，并确保没有人坐在那里等待测试在本地运行。</p><p id="c31e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">GitHub Actions这样的托管CI环境在运行需要使用托管服务资源的集成测试时也会有所帮助。您可以在存储库中使用<a class="ae ni" href="https://docs.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets" rel="noopener ugc nofollow" target="_blank">加密的秘密来授权Actions runner访问测试环境中的资源，而不用担心为您的每个开发人员创建测试资源和访问密钥。</a></p><p id="1256" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我在很多场合写过关于设置动作工作流的文章，包括<a class="ae ni" href="https://victoria.dev/blog/a-lightweight-tool-agnostic-ci/cd-flow-with-github-actions/" rel="noopener ugc nofollow" target="_blank">用一个来运行你的Makefile </a>和<a class="ae ni" href="https://victoria.dev/blog/publishing-github-event-data-with-github-actions-and-pages/" rel="noopener ugc nofollow" target="_blank">如何集成GitHub事件数据</a>。GitHub甚至<a class="ae ni" href="https://github.blog/2020-06-26-github-action-hero-victoria-drake/" rel="noopener ugc nofollow" target="_blank">就Actions </a>采访过我一次。</p><p id="3d5f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于Django项目，这里有一个GitHub Actions工作流，每当有人在存储库中打开一个pull请求时，它就用一致的Python版本运行测试:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="97a9" class="na lz it mw b gy nb nc l nd ne">name: Run Django tests<br/><br/>on: pull_request<br/><br/>jobs:<br/>  test:<br/><br/>    runs-on: ubuntu-latest<br/><br/>    steps:<br/>      - uses: actions/checkout@v2<br/>      - name: Set up Python<br/>        uses: actions/setup-python@v2<br/>        with:<br/>          python-version: '3.8'<br/>      - name: Install dependencies<br/>        run: make install<br/>      - name: Run tests<br/>        run: make test</span></pre><p id="1a4d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于安装和测试命令，我简单地利用了已经登记到存储库中的<a class="ae ni" href="#a-custom-cli-tool-for-your-django-project" rel="noopener ugc nofollow"> Makefile </a>。在CI测试工作流中使用Makefile命令的一个好处是，您只需要在一个地方保持它们的更新——您的Makefile！不再问“为什么这在本地有效，但在CI中无效？”头疼。</p><p id="8677" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想升级你的安全游戏，你也可以添加<a class="ae ni" href="https://github.com/victoriadrake/django-security-check" rel="noopener ugc nofollow" target="_blank"> Django安全检查</a>作为一个动作。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="9c2c" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">为成功建立您的Django项目</h1><p id="b15b" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">想让你的开发团队开心吗？用这些Django开发的最佳实践帮助他们取得成功。记住，一盎司的脑力抵得上一磅的软件！</p><p id="16e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">更多关于Django和建立一个伟大的技术团队的信息，请访问<a class="ae ni" href="https://victoria.dev/" rel="noopener ugc nofollow" target="_blank"> victoria.dev </a>或<a class="ae ni" href="https://victoria.dev/index.xml" rel="noopener ugc nofollow" target="_blank">通过RSS </a>订阅。</p></div></div>    
</body>
</html>