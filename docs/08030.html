<html>
<head>
<title>The Progressive Web Apps Guide You’ve Been Looking For</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您一直在寻找的渐进式网络应用指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-progressive-web-apps-guide-youve-been-looking-for-5ae3fa2cea83?source=collection_archive---------2-----------------------#2021-03-17">https://betterprogramming.pub/the-progressive-web-apps-guide-youve-been-looking-for-5ae3fa2cea83?source=collection_archive---------2-----------------------#2021-03-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8e3f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将你的旧无聊网站转换成PWAs</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9084c9ea25dbbb0c3578270f16f02aab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xCfSveaSkmrC8Pfw"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@laukev?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kévin et Laurianne Langlais </a>拍摄的照片</p></figure><p id="4a77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PWA，即渐进式web应用程序，是目前Web开发中最热门的话题之一。它向用户承诺了类似于原生应用的体验和功能，但仍然是用普通的HTML、CSS和JavaScript构建的(或者你可以使用任何JavaScript框架更进一步)，这多酷啊！</p><p id="c258" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">本教程假设读者具备HTML、CSS和JavaScript的中级知识。如果你完全是前端开发的新手，第一步直接进入渐进式web应用程序可能不是最好的主意——掌握基础知识，然后再回来！</em></p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="be2d" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">简介</strong></h1><p id="048a" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">在本教程中，你将学习如何将一个传统的网站转换成一个具有很多酷功能的渐进式网络应用程序。</p><p id="e94f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但首先，让我们来看一些理论。根据<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps" rel="noopener ugc nofollow" target="_blank">developer.mozilla.org</a>的说法，渐进式网络应用是使用新兴网络浏览器API和功能以及传统渐进式增强策略的网络应用，为跨平台网络应用带来类似本地应用的用户体验。</p><p id="0652" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，渐进式网络应用是典型的网络应用，使用相同的旧HTML、CSS和JavaScript构建，但具有额外的功能，如离线模式、A2HC(添加到主屏幕)、后台同步、推送通知等。它们看起来和感觉上都像是本地应用，但它们不是！</p><p id="ce85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">我想你可以说渐进式网络应用程序是类固醇上的网络应用程序。</em></p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="58fa" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">编码</h1><p id="de74" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">现在我们已经知道PWA实际上是什么，我们可以马上开始创建一个渐进式web应用程序！</p><p id="bb8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">为了简单起见，我将只介绍一些PWA功能，如离线模式和A2HC。(记住除了上面提到的，还有很多PWA能力)。</em></p><p id="a38c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经为本教程准备了一个基础项目，但如果你有任何网站，你想转换成一个进步的网络应用程序，请随意这样做。</p><div class="mx my gp gr mz na"><a href="https://github.com/aryasurya21/pwastarter/" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">aryasurya21/pwastarter</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">我关于媒体的PWA文章的开始项目。通过创建帐户，为aryasurya21/pwastarter的发展做出贡献…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">github.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no kp na"/></div></div></a></div><p id="ff9c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">在克隆基础项目之后，不要忘记运行npm install。</em></p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/1a063fc2412971637f27ec6993d22b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bwPkH3TVuIGUU-GwtHhMgw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">基地项目的主屏幕，原谅华丽的字体。</p></figure><p id="c373" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基础项目本身是一个简单的网站，用户可以在那里对任务执行CRUD操作，它是使用我们都非常喜欢的HTML、CSS和Vanilla JS构建的。</p><p id="60b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我强烈建议使用Chrome进行PWA开发，因为很多浏览器还不支持PWA。</p><p id="a881" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了将任何web应用程序转换成渐进式应用程序，我们必须满足三个主要要求。</p><h2 id="bc75" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">1.HTTPS</h2><p id="d001" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">我们的web应该运行在HTTPS连接上，这意味着我们的浏览器从web服务器发送和接收的所有内容都经过了严格的加密，因此第三方无法轻易窃听我们和/或执行恶意活动。</p><blockquote class="oc"><p id="950e" class="od oe iq bd of og oh oi oj ok ol lr dk translated">你们中的一些人可能会问自己，“我们正在localhost上开发基于HTTP协议的应用程序，我们如何在本地将其转换为PWA，因为它需要HTTPS？”嗯，这是个好问题。答案很简单，即使localhost运行在HTTP上，它的行为实际上像HTTPS——这就是为什么有些API不能在已部署的HTTP站点上工作，但可以在http://localhost上工作。</p></blockquote><h2 id="5ee7" class="nq mb iq bd mc nr om dn mg nt on dp mk lf oo nw mm lj op ny mo ln oq oa mq ob bi translated">2.拥有应用清单</h2><p id="cbbf" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">App Manifest是一个JSON文件，它告诉浏览器我们的渐进式web应用程序，以及当它安装在移动或桌面上时应该如何表现。典型的应用程序清单包含我们的应用程序的信息，如名称、描述、图标和baseURL。</p><h2 id="8040" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">3.有服务人员</h2><p id="b7f8" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">服务人员是所有PWA功能的核心。它是一个JavaScript文件，我们的浏览器在后台运行，并保持运行，即使浏览器本身是关闭的。</p><p id="a542" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于服务人员，有几点需要注意:</p><ul class=""><li id="f407" class="or os iq ky b kz la lc ld lf ot lj ou ln ov lr ow ox oy oz bi translated">它是一个<a class="ae kv" href="https://www.html5rocks.com/en/tutorials/workers/basics/" rel="noopener ugc nofollow" target="_blank"> JavaScript Worker </a>，所以它不能直接访问DOM。相反，服务工作者可以通过响应通过<code class="fe pa pb pc pd b"><a class="ae kv" href="https://html.spec.whatwg.org/multipage/workers.html#dom-worker-postmessage" rel="noopener ugc nofollow" target="_blank">postMessage</a></code>接口发送的消息来与它控制的页面进行通信，如果需要，这些页面可以操作DOM。</li><li id="c1aa" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">Service worker使用了很多承诺，因为它是一个在后台运行的脚本。它主要做的是监听浏览器上发生的事件，然后为我们感兴趣的每个事件提供一个回调。</li></ul></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="f2f0" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">应用清单</h1><p id="4a50" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">让我们通过在我们的应用程序上添加一个清单来开始我们的PWA之旅，在名为<code class="fe pa pb pc pd b">manifest.json</code> <strong class="ky ir">，</strong>的公共目录上添加一个新文件，然后编写这些JSON并根据您自己的网站属性对它们进行调整(如果您没有使用基础项目)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="ac4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是关于这些属性的一些解释:</p><ul class=""><li id="c451" class="or os iq ky b kz la lc ld lf ot lj ou ln ov lr ow ox oy oz bi translated"><code class="fe pa pb pc pd b">start_url</code> <strong class="ky ir"> </strong>是网站启动时我们想要显示的第一页的URL。在这个项目中，我使用了<code class="fe pa pb pc pd b">“/”</code>，它可以自动找到一个<code class="fe pa pb pc pd b">index.html</code>。</li><li id="1f09" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated"><code class="fe pa pb pc pd b">scope</code> <strong class="ky ir"> </strong>是您要包含在progressive web应用程序中的项目文件。例如，如果你只想包含项目中一个<code class="fe pa pb pc pd b">src</code>文件夹中的文件，你可以把它改成类似<code class="fe pa pb pc pd b">“scope”: “/src”</code>的形式</li><li id="34d6" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated"><code class="fe pa pb pc pd b">display</code> <strong class="ky ir"> </strong>是您希望应用程序使用的UI类型，您可以在其中自定义应用程序启动时显示的浏览器UI。例如，您可以隐藏地址栏</li><li id="aed1" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">我使用<strong class="ky ir"> </strong> <code class="fe pa pb pc pd b">standalone</code> <strong class="ky ir"> </strong>来使web应用程序看起来和感觉起来像一个独立的应用程序。如果你在桌面上安装应用程序，它会在自己的窗口中运行，独立于浏览器，并隐藏标准的浏览器UI元素，如地址栏。</li><li id="5f7a" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated"><code class="fe pa pb pc pd b">orientation</code> <strong class="ky ir"> </strong>定义了web app的方向。</li><li id="1986" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated"><code class="fe pa pb pc pd b">dir</code> <strong class="ky ir"> </strong>定义显示清单中支持方向的成员的基本方向。与<code class="fe pa pb pc pd b">lang</code>一起，它有助于正确显示从右向左的语言。</li><li id="ff08" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated"><code class="fe pa pb pc pd b">lang</code>成员是包含单个<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/lang" rel="noopener ugc nofollow" target="_blank">语言标签</a>的字符串。它为清单的具有方向性的成员的值指定主要语言，并与<code class="fe pa pb pc pd b">dir</code> <strong class="ky ir"> </strong>一起确定它们的方向性。</li></ul><p id="69e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们添加了我们自己的应用程序清单之后，我们接下来要做的是在我们的HTML文件中注册它，因此在index.html的标签中添加这一行。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="b34d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么我们的index.html会是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="1871" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们注册清单之后，通过在项目终端上运行npm start来启动项目。然后打开开发人员控制台，转到application选项卡，您将看到我们在清单中定义的属性现在也显示在浏览器上了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/8f3061ee6b28ad5abd13feb0ce27b080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b6Fki4pMgY8cUL94zsWHyw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">清单属性</p></figure><p id="5aaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜您，您离将您的应用程序转换为渐进式web应用程序又近了一步！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="f50b" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">服务行业人员</h1><p id="5a7c" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">接下来是渐进式网络应用最重要的部分:服务工作者。</p><p id="bb2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在public文件夹中，创建一个名为serviceWorker.js的新文件，然后导航到index.js。要添加一个函数将serviceWorker.js注册为web的服务工作器，请添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="8ecc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要忘记调用<code class="fe pa pb pc pd b">init()</code>上的函数，那么我们的index.js将如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="7e2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们开始为服务工作者本身编码之前，我们必须首先了解它的生命周期，具体如下</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pm"><img src="../Images/4d4e9ffd13fc1a0c7a9ec4057fef76f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rL5BPzlnhwsLdwDF.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:<a class="ae kv" href="https://developers.google.com/web/fundamentals/primers/service-workers" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/web/fundamentals/primers/service-workers</a></p></figure><p id="246d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">解释:</p><ul class=""><li id="3c0c" class="or os iq ky b kz la lc ld lf ot lj ou ln ov lr ow ox oy oz bi translated">安装是服务人员注册后得到的第一个事件，并且只发生一次。这是缓存一切以准备脱机模式的最佳位置。</li><li id="9585" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">一旦我们的服务人员准备好控制客户端并处理push和sync等功能事件，我们将获得一个激活的事件。这是清理旧服务人员的缓存的最佳位置，以防止新服务人员准备好时发生奇怪的事情。</li><li id="fd80" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">空闲意味着服务工作者现在准备好接收功能事件，例如推送、同步或获取。或者，如果我们不再需要服务人员，或者因为我们要安装一个新的服务人员，我们可以终止服务人员。</li></ul><p id="d757" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于以上解释，可能会想到一个问题:</p><blockquote class="oc"><p id="c464" class="od oe iq bd of og oh oi oj ok ol lr dk translated">我如何知道何时给我的服务人员更新一个新的？</p></blockquote><p id="234f" class="pw-post-body-paragraph kw kx iq ky b kz pn jr lb lc po ju le lf pp lh li lj pq ll lm ln pr lp lq lr ij bi translated">答案是，当您的服务工作者代码发生变化时，我们必须用反映新添加代码的新代码替换现有代码。</p><p id="d2e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，转到serviceWorker.js。请记住，由于serviceWorker是一个在后台运行的脚本，不能访问DOM，所以我们在那里所要做的就是“监听”上述事件。</p><p id="e6d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在serviceWorker.js里面，我们来听听<code class="fe pa pb pc pd b">install</code>和<code class="fe pa pb pc pd b">activate</code>事件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="9e9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，导航到Chrome，打开应用程序选项卡，选择“存储”，然后选择“清除站点数据”，按CTRL + SHIFT + R以硬重新加载，并强制浏览器安装我们服务人员的新版本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/c3275589342f41a7a6e6699cfe2322d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aF0Z-HkuL1c7YUBD4om5KA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ps"><img src="../Images/06fc19fd81920fd2bc235b974bdc77d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BAfgPIDwOXSgOwJUw5AS8Q.png"/></div></div></figure><p id="0c67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们在“console”选项卡上看到的，我们的服务人员已经启动并运行浏览器。</p><p id="a433" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以在应用程序选项卡上看到我们的服务人员。</p><p id="e6f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜你！我们已经实现了我们的服务人员和应用清单——我们的应用已经满足了渐进式web应用的要求！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pt"><img src="../Images/8ec2e3067148946bb28ad4ed9c69acaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z4Ew5wGuoJJsCfpU"/></div></div></figure><p id="bb83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们让我们的应用程序在用户离线时可用。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="c784" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">离线模式</h1><p id="09b2" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">当用户离线时，传统的web应用程序无法访问，它们只会在我们试图这样做时显示这只恐龙。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pu"><img src="../Images/c56bfb408cf57993f1c4dba4b976f899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WOBK1AdhL3R53OUq3pEnYA.png"/></div></div></figure><p id="e46a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于渐进式网络应用程序可以安装在桌面或移动设备上，每当用户离线时试图使用我们的应用程序，他们都不会获得良好的用户体验。这只恐龙出现了，因此我们必须借助我们每天都听说的API:缓存，让我们的应用程序在离线模式下可用。</p><p id="d16b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们之前所了解的，在服务人员生命周期中，在网站上缓存我们需要的所有内容的最佳时间是在“安装”阶段。</p><p id="1c3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在serviceWorker.js文件中添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="bfbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是解释:</p><ul class=""><li id="6dee" class="or os iq ky b kz la lc ld lf ot lj ou ln ov lr ow ox oy oz bi translated">我创建了一个<code class="fe pa pb pc pd b">STATIC_CACHE_CONTAINER</code>变量，它将作为缓存的名称。</li><li id="c545" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">然后，我创建了一个<code class="fe pa pb pc pd b">STATIC_FILES</code>数组，其中包含了我想要存储在缓存中的文件。</li><li id="069a" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">在安装回调时，我用event.waitUntil包装了缓存过程，告诉浏览器在传递给<code class="fe pa pb pc pd b">waitUntil</code>的承诺被解决或拒绝之前不要终止服务工作器。</li><li id="c32a" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">在<code class="fe pa pb pc pd b">waitUntil</code>中，我打开了一个名为<code class="fe pa pb pc pd b">STATIC_CACHE_CONTAINER</code>的缓存(如果它不存在，就创建它)。然后，我将所有想要缓存的文件路径添加到缓存存储中。</li></ul><p id="6031" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，回到Chrome，导航到应用程序选项卡，选择“存储”和“清除站点数据”，然后按CTRL + SHIFT + R强制浏览器安装我们的新服务人员。然后，当我们转到缓存部分时，我们可以看到之前添加到缓存存储中的文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ps"><img src="../Images/d30e12303716efa2fc77b8c227950f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z986s9btwnmaWqI5v8NVbw.png"/></div></div></figure><p id="c79b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但这就够了吗？答案仍然是否定的。我们已经缓存了我们的文件，但我们在离线时没有使用缓存的版本。接下来我们将监听<code class="fe pa pb pc pd b">fetch</code>事件来帮助我们处理请求。</p><p id="f37f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将以下代码添加到serviceWorker.js中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="8a37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">解释:</p><ul class=""><li id="655a" class="or os iq ky b kz la lc ld lf ot lj ou ln ov lr ow ox oy oz bi translated">我在服务工作者内部添加了一个获取事件监听器。</li><li id="95e4" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">在事件处理中，我用<code class="fe pa pb pc pd b">respondWith()</code>包装了我们的承诺，这防止了浏览器的默认获取处理，并允许我们为响应提供承诺。</li><li id="7d2f" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">对于承诺本身，我们试图找到<code class="fe pa pb pc pd b">event.request</code>是否存在于我们的缓存中。如果它存在，我们只返回存储中缓存的那个。</li></ul><p id="3fa0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在浏览器中重新安装服务人员，瞧，我们的页面可以脱机使用了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/aceffeb800aac0520ea2dfe796b21631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*lK_5nWaXVV7FbnThCdSmDw.gif"/></div></figure><p id="7085" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是你注意到什么了吗？我们华丽的字体和所有的造型都不见了！这怎么可能呢？</p><p id="9aad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是因为我们没有缓存——记住在serviceWorker.js上，我们只缓存了三个文件，index.html、index.css和index.js。但是字体来自Google Font CDN，按钮和表格样式来自Bootstrap CDN。解决这个问题的方法很简单:当服务人员处于“安装”阶段时缓存它们。</p><blockquote class="pw px py"><p id="b780" class="kw kx ls ky b kz la jr lb lc ld ju le pz lg lh li qa lk ll lm qb lo lp lq lr ij bi translated">我见过一些做法，人们把缓存容器分成两个键，一个用于静态文件，一个用于动态文件。由于在本教程中，网站充满了静态页面，我不会去动态缓存，但我会在本教程的结尾添加关于它们的进一步参考。</p><p id="79b1" class="kw kx ls ky b kz la jr lb lc ld ju le pz lg lh li qa lk ll lm qb lo lp lq lr ij bi translated">动态缓存的思想是缓存用户已经访问过的每一个页面，而不是像<code class="fe pa pb pc pd b">STATIC_FILES</code>那样一个个硬编码。</p><p id="6d13" class="kw kx ls ky b kz la jr lb lc ld ju le pz lg lh li qa lk ll lm qb lo lp lq lr ij bi translated">但是，最佳实践是缓存项目的核心资产，如字体、样式、助手库、静态页面和网站上不会改变的任何内容，并将剩余的页面存储在动态缓存中。</p></blockquote><p id="dc14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将这些样式和字体CDN添加到我们的STATIC_FILES中，因此我们的serviceWorker.js将是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pj pk l"/></div></figure><p id="7916" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们尝试重新安装新的服务人员并离线，我们的应用程序看起来就像它在线时一样！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/7c8a037016bfbec715a3dda8179a6b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*nCJuTZWuGG7Y4Y-qpaSVvw.gif"/></div></figure><p id="b9f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜你！您已使您的web应用程序脱机可用！</p><p id="d14a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们唯一要做的就是让它可以安装，我们的应用程序最终会感觉像一个原生应用程序。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="f6e2" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">A2HC(添加到主屏幕)</h1><p id="4259" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">要让我们的应用程序既可以安装在桌面上，也可以安装在移动设备上，有一些要求:</p><ul class=""><li id="1e4a" class="or os iq ky b kz la lc ld lf ot lj ou ln ov lr ow ox oy oz bi translated">在中填写了<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Add_to_home_screen#manifest" rel="noopener ugc nofollow" target="_blank">正确字段的web清单。</a></li><li id="2727" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">从安全(HTTPS)域提供服务的网站。</li><li id="bfdd" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">表示设备上应用程序的图标。</li><li id="d7f9" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated">一名<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" rel="noopener ugc nofollow" target="_blank">服务人员</a>注册，允许应用程序离线工作(目前只有Android版Chrome需要这一功能)。</li></ul><p id="966c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">惊喜，惊喜，我们已经全部实现了！这意味着我们的应用程序是可安装的！</p><p id="f1e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">导航到Chrome，在搜索栏的末尾找到这个图标:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qc"><img src="../Images/9e8032895e698765b49e1c3f6211e357.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2pmAd0Cr4PMe05uAn6C5fw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">下载图标</p></figure><p id="7fd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单击图标，它会提示我们安装web应用程序:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/9183f4b8efe7be305425803dfdf96f16.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*QWISnIuqiXTY8sbgVQJ49A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">安装提示</p></figure><p id="a520" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击安装，瞧！我们的应用有自己的窗口，与浏览器分离:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qe"><img src="../Images/59a5142461439afdb148c02fc4b230fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rN7lOYmnKxHY91FzxzMrFA.png"/></div></div></figure><p id="2469" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还在桌面主屏幕上找到了应用程序的快捷方式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qf"><img src="../Images/f7f41159d882ad4f3be03cd274f5c82f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yjqcQAC7IuVAifkLxaXGRg.png"/></div></div></figure><p id="0b99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们在我们的web应用程序上实现了A2HC特性，使它看起来更像一个本地应用程序。您也可以通过首先将网站部署到托管服务(如Netlify、Heroku或Github pages)来将网站安装到您的移动设备上——这是您的选择！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="7b00" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">结论</h1><p id="65c8" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">我们已经了解了什么是渐进式web应用程序，以及如何将传统的web应用程序转换为具有一些很酷的功能的渐进式应用程序，如离线模式和A2HC。</p><p id="5c21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击此处了解有关PWA功能的更多信息:</p><ul class=""><li id="b261" class="or os iq ky b kz la lc ld lf ot lj ou ln ov lr ow ox oy oz bi translated"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/Progressive _ Web _ apps</a></li><li id="c2b7" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated"><a class="ae kv" href="https://developers.google.com/web/updates/2015/12/getting-started-pwa" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/web/updates/2015/12/getting-started-pwa</a></li><li id="f377" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated"><a class="ae kv" href="https://developers.google.com/web/fundamentals/primers/service-workers" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/web/fundamentals/primers/service-workers</a></li><li id="dc15" class="or os iq ky b kz pe lc pf lf pg lj ph ln pi lr ow ox oy oz bi translated"><a class="ae kv" href="https://blog.galaxyweblinks.com/how-do-big-companies-build-their-pwas" rel="noopener ugc nofollow" target="_blank">https://blog . galaxy web links . com/how-do-big-companies-build-their-pwas</a>//</li></ul></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="e916" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你对这个教程有任何想法，请在下面留下你的回复。如果你想让我写其他话题，也请留言。</p><h2 id="4a6a" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">编码快乐！</h2></div></div>    
</body>
</html>