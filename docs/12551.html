<html>
<head>
<title>Serverless Puppeteer — Use Cases in 2022</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器木偶——2022年的使用案例</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/serverless-puppeteer-use-cases-in-2022-35191f3ff4cd?source=collection_archive---------8-----------------------#2022-06-13">https://betterprogramming.pub/serverless-puppeteer-use-cases-in-2022-35191f3ff4cd?source=collection_archive---------8-----------------------#2022-06-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1414" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们来看看您可以使用现代木偶戏表演的一些功能和用例。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bd2f65b01a9f9872477aadae6f932df4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8IcIPPu681mpb6yi"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@agni11?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sivani B </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="22cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之前我写过如何使用无服务器框架和AWS Lambda让<a class="ae kv" href="https://medium.com/aws-tip/serverless-puppeteer-on-aws-5162459a4c44" rel="noopener">puppeter在AWS、</a>上运行。</p><p id="00f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面我将描述一些用例，并举例说明如何实现它们。</p><h1 id="a919" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">拦截网络流量</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/5d27d15f9a9bcba0513bd69fb11fd1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-88WsClKQYaZrRGIpXftuA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从网站读取网络流量</p></figure><p id="cf98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个用例，当浏览器加载不同的脚本时，我用它来做时间测试。下面是一个简短的片段，它带有一个木偶页面对象和一个导航到的URL</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="f44a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面我们检查一个特定的URL是否被站点加载。我已经设置了一个超时功能，它将在20秒后超时，在我的情况下，这意味着我可以放心地说脚本尚未加载。</p><h1 id="2dae" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">截图</h1><p id="bf5a" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">这也是一个非常基本的用例，可以为您提供一些视觉反馈，否则是不可能得到的。这对于自动化测试或自动化来说非常有用，因此您可以向您的客户发送所需页面的屏幕截图。</p><p id="e26f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用<code class="fe ms mt mu mv b">puppeteer</code>截图极其简单:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="6670" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以对截图做什么，但在我的例子中，我将它保存在S3，并将其附加到一个Slack通道进行自动化测试。</p><h1 id="e049" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">纵观全球背景</h1><p id="3746" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">首先。这到底是什么意思？</p><p id="1d4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在网站上显示您的图像，然后打开开发工具。在控制台中，你可以写下<code class="fe ms mt mu mv b">document</code>或<code class="fe ms mt mu mv b">window</code>，一些大的物体会被打印出来。这是因为这些变量(以及许多其他变量)是特定于您所在站点的全局变量。</p><p id="f7ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您拥有一个站点，并且您的代码中有以下内容</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="c731" class="na lt iq mv b gy nb nc l nd ne">globalThis.myVaraible = 'Something i make up'</span></pre><p id="b9c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将能够在控制台中编写<code class="fe ms mt mu mv b">myVariable</code>,并获得以下内容</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/9cf717aab8304a91ce546704f0b97dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*oy_EI2_0-aKQ3EUDk5Id1Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">例子</p></figure><p id="e7f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着全局范围可以并且将包含只有该选项卡才能访问的信息。有了木偶师，我们还可以查看所有其他全局变量。实现可能看起来像这样</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="ea7b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">抓取网站</h1><p id="9779" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">这个用例很可能是使用最多的一个。</p><p id="861b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们假设你有一个网站，你想获得网站上所有图片的所有<code class="fe ms mt mu mv b">paragraphs</code>或所有源路径。在这种情况下，木偶师大放异彩。</p><p id="e06f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以在这些相对简单的用例中，指示浏览器为我们返回所有这些值。</p><p id="d5f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了检索更多的嵌套或非静态数据，不要低估创建这些脚本的工作量。</p><p id="0ae9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您依赖于特定的选择器，您可能会在每次站点更改或更新DOM或选择器id时更改您的脚本。</p><p id="5358" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当从外部网站抓取数据时，你也应该意识到这在你的国家可能是非法的，即使从技术上讲这是你自己的数据。</p><h1 id="e016" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">获取登录令牌</h1><p id="7309" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">这个用例有点争议，但我还是要提一下:)</p><p id="12ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近，我遇到了一个需要通过API进行交互的系统。<br/>这是不可能的，因为系统没有官方的API。那你是做什么的？</p><p id="c17f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我知道我可以通过导航他们的用户界面(在登录之后)来做我需要做的动作，所以我想我可以让木偶师做同样的事情。</p><p id="2dd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实证明，我能够做一些捷径，使解决方案更简单一点，也许你可以使用相同的技术。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="994f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想复制登录背后的外部UI所能做的事情，这个想法相当简单，因为UI与某种后端服务器进行通信。</p><p id="26fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.使用木偶师导航至登录页面<br/> 2。使用表单使用木偶师登录(只有在没有双因素认证的情况下有效)<br/> 3。现在，您应该直接获得一个授权令牌，或者将它存储在网站的cookies中。您需要检索这个令牌，并将其与以下请求一起发送到外部API。<br/> 4。使用授权令牌，您现在可以模拟您通常在外部UI中所做的任何事情。</p><p id="5cb9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是正在发生的事情的大概情况。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/2e988d6848597da9d9a8d3266245e736.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JTnf-d_9QCwoEDZaIEU83Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">与外部API一起使用的身份验证令牌的理论检索</p></figure><blockquote class="no np nq"><p id="44c9" class="kw kx nr ky b kz la jr lb lc ld ju le ns lg lh li nt lk ll lm nu lo lp lq lr ij bi translated">注意:这种方法并不适用于所有系统。在某些情况下，你必须有一点创造力来模仿真实用户在登录后能做什么。</p></blockquote><h1 id="e3e7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为胜利而战的木偶师！</h1><p id="85cd" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf mp lh li lj mq ll lm ln mr lp lq lr ij bi translated">还有很多很多其他的用例，但是这是为了让你知道你可以用它做什么。</p><p id="d429" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">值得注意的是，当使用木偶师时，你通常会与你很少或根本无法控制的网站互动。这意味着你的脚本应该有效地适应网站。</p><p id="3135" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果网站经常改变，这可能会变得棘手。因此，考虑让脚本更通用一点可能会节省您的时间，这样当网站将类名从<code class="fe ms mt mu mv b">id1</code>更改为<code class="fe ms mt mu mv b">id2</code>时，它们不会中断。</p><blockquote class="no np nq"><p id="a9ac" class="kw kx nr ky b kz la jr lb lc ld ju le ns lg lh li nt lk ll lm nu lo lp lq lr ij bi translated">让计算机来做这项工作！</p></blockquote><h2 id="0aa1" class="na lt iq bd lu nv nw dn ly nx ny dp mc lf nz oa me lj ob oc mg ln od oe mi of bi translated">您可能会喜欢:</h2><div class="og oh gp gr oi oj"><a href="https://medium.com/@emilhein1/convince-users-to-pay-for-your-content-56ecc689a5cf" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">说服用户为你的内容付费</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">如果你有独特的内容，我的意思是真正的独特，你应该让人们为之付费。我将提供如何…的例子</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox kp oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://medium.com/ad-tech/how-does-ad-targeting-work-in-practice-2340d99ed3ff" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">广告目标如何工作——在实践中</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">我在这里给你一个更好的理解技术上的目标是如何实现的，它…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="oy l ou ov ow os ox kp oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://medium.com/ad-tech/video-advertising-a-practical-guide-545aa107591f" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">视频广告——⚡实用指南</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">让我们来看看如何在你的网站/应用上实现不同类型的视频广告！</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="oz l ou ov ow os ox kp oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://medium.com/ad-tech/reduce-cls-impact-of-running-ads-724cfb7e3c31" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">降低广告对CLS的影响</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">我们希望在投放广告的同时减少CLS的影响。我们如何做到这一点？</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="pa l ou ov ow os ox kp oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://medium.com/ad-tech/increase-ad-quality-by-using-ad-refresh-and-lazyloading-strategies-for-publishers-and-networks-fb3983ef915a" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">针对出版商和网络，通过使用广告更新和延迟加载策略提高广告质量</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">我们究竟如何优化我们的广告单元？通过代码示例，我将展示至少一种通用的方法。</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="pb l ou ov ow os ox kp oj"/></div></div></a></div></div></div>    
</body>
</html>