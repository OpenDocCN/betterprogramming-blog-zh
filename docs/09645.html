<html>
<head>
<title>How to Perform UI Testing in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SwiftUI中执行UI测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-perform-ui-testing-in-swiftui-b24f231f4316?source=collection_archive---------7-----------------------#2021-09-21">https://betterprogramming.pub/how-to-perform-ui-testing-in-swiftui-b24f231f4316?source=collection_archive---------7-----------------------#2021-09-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="df6c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解更多关于LaunchArguments、LaunchEnvironment、使用辅助功能以及在SwiftUI中运行UITests的提示</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/61f71daaf94a97a420cab60bbbe1c564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JXxSNPXcTWwxF6bb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@aaronburden?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aaron Burden </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h2 id="4715" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是UI测试？</h2><p id="c902" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated"><a class="ae ky" href="https://developer.apple.com/documentation/xctest/user_interface_tests" rel="noopener ugc nofollow" target="_blank"> UI测试</a>是一种非凡的方法，可以保证当你添加新功能或重构应用程序的代码库时，你最基本的UI协作能够继续进行。</p><p id="100b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">编写和运行UI测试与进行单元测试有些不同，因为您实际上是在与您的应用程序协作，而不是针对API执行一些测试。</p><p id="1f73" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这是自动化重复任务的好方法，尤其是当我们处理UI逻辑的时候。例如:如果你正在重构，想要确保你的应用程序以你想要的方式浏览，测试深度链接，或者测试复杂的用户界面。</p><h2 id="00a5" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">为什么要进行UI测试？</h2><p id="5958" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">单元测试计划测试一小部分代码。单元测试可以在后台完成。您可以为您的类、结构和方法编写测试用例。单元测试不能验证我们得到的结果是否正确地显示给用户。单元测试不能验证你的应用在真实环境中的表现。这时你想进行UI测试。</p><p id="75a4" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">借助于UI的功能测试通常是扩展测试的程度和深度的最快和最好的方法，以结合协调应用程序框架的每一部分的真实世界条件。</p><p id="894e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">UI测试可能是框架测试、实践测试或确认测试的别名，在这些测试中，您一起测试整个系统，以保证它在真实场景下做它应该做的事情。</p><p id="f3a7" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">UI测试将确保我们的应用程序的用户界面在执行预期的操作时行为正确。</p><p id="c50d" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">如果你想知道单元测试和UI测试之间的区别，看看这篇文章。</p><p id="eb51" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><em class="mt">如果你是单元测试和UI测试的新手，有那么多文章解释你，但是我最喜欢</em><a class="ae ky" href="https://www.raywenderlich.com/21020457-ios-unit-testing-and-ui-testing-tutorial" rel="noopener ugc nofollow" target="_blank"><em class="mt">Raywenderlich</em></a><em class="mt">视频。</em></p><h1 id="6c4d" class="mu la it bd lb mv mw mx le my mz na lh jz nb ka ll kc nc kd lp kf nd kg lt ne bi translated">SwiftUI中的UI测试</h1><p id="bcd6" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在我们开始UI测试之前，我们必须知道:</p><ol class=""><li id="f2b0" class="nf ng it lx b ly mo mb mp li nh lm ni lq nj mn nk nl nm nn bi translated"><code class="fe no np nq nr b"><a class="ae ky" href="https://developer.apple.com/documentation/xctest/xcuiapplication/1500477-launcharguments" rel="noopener ugc nofollow" target="_blank">LaunchArguments</a></code>:启动时传递给应用程序的参数。<br/>如果没有修改，这些是Xcode将在启动时传递给应用程序的参数。可以更改、添加或删除参数。与不同，在应用程序启动后修改这些参数也是合法的。此类更改不会影响当前的启动会话，但会在下次启动应用程序时生效。</li><li id="4aa7" class="nf ng it lx b ly ns mb nt li nu lm nv lq nw mn nk nl nm nn bi translated"><code class="fe no np nq nr b"><a class="ae ky" href="https://developer.apple.com/documentation/xctest/xcuiapplication/1500427-launchenvironment" rel="noopener ugc nofollow" target="_blank">LaunchEnvironment</a></code>:启动时传递给应用程序的环境变量。如果没有修改，这些是Xcode将在启动时传递给应用程序的环境变量。可以更改、添加或删除环境变量。与不同，在应用程序启动后修改环境变量也是合法的。此类更改不会影响当前的启动会话，但会在下次启动应用程序时生效。</li></ol><p id="fd7f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><code class="fe no np nq nr b">LaunchArguments</code>和<code class="fe no np nq nr b">LaunchEnvironment</code>可以给出一个简单的方法来设置真正有价值的调试活动，这可以帮助我们提高事件和测试的速度。</p><p id="963b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">添加<code class="fe no np nq nr b">LaunchArguments</code>我们可以:</p><ul class=""><li id="4fc3" class="nf ng it lx b ly mo mb mp li nh lm ni lq nj mn nx nl nm nn bi translated">加快我们的开发工作</li><li id="faf7" class="nf ng it lx b ly ns mb nt li nu lm nv lq nw mn nx nl nm nn bi translated">我们可以完全消除手动设置自定义数据的需要</li></ul><p id="a8fb" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现在，我们将使用一个简单的例子来回顾使用上述两个概念的UI测试。</p><p id="859b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们先在SwiftUI中创建一个app。如果您没有任何UI测试目标，请通过<code class="fe no np nq nr b">Command + 6</code>或选择<code class="fe no np nq nr b">Test Navigator</code>创建一个。它应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/12fcf9333413353f32e9fa3490e69022.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/format:webp/1*aJtXQZVPn3030uotnO7xfQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建UI测试目标</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/dd1787351f6483d65ef52d3271df0cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*087A1uJkEuUNTwAr052pkg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建UI测试目标后</p></figure><p id="fb21" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现在，我有一个简单的代码，它使用<code class="fe no np nq nr b">Text</code>、<code class="fe no np nq nr b">Button</code>和<code class="fe no np nq nr b">NavigationLink</code>视图来帮助我们理解流程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/81731fc24b8ff79ea8b2b6cafe4c21b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BpgNs9HgM02GE5AcDIqViQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于测试的示例代码</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="c7ac" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">请注意，我们已经为我们的<code class="fe no np nq nr b">Button</code>使用了<code class="fe no np nq nr b">accessibilityIdentifier</code>来在我们的<code class="fe no np nq nr b">UITesting</code>中访问它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="0422" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现在，我们的应用程序有了一些UI元素，它完成了一项工作。让我们创建我们刚刚了解的<code class="fe no np nq nr b">LaunchArgument</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="79d7" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">此外，创建一个助手类来标识我们是否正在运行UI测试，如果需要，还可以帮助我们覆盖标志或者向UI元素注入模拟数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测试探测器</p></figure><p id="b766" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">让我解释一下这里发生了什么:</p><ol class=""><li id="09ac" class="nf ng it lx b ly mo mb mp li nh lm ni lq nj mn nk nl nm nn bi translated">我们创建了一个叫做<code class="fe no np nq nr b">TestDetector</code>的<code class="fe no np nq nr b">class</code></li><li id="6b99" class="nf ng it lx b ly ns mb nt li nu lm nv lq nw mn nk nl nm nn bi translated">我们有一个名为<code class="fe no np nq nr b">Keys</code>的枚举，帮助我们覆盖在<code class="fe no np nq nr b">ContentView.swift</code>中使用的按钮动作的布尔标志</li><li id="2e70" class="nf ng it lx b ly ns mb nt li nu lm nv lq nw mn nk nl nm nn bi translated"><code class="fe no np nq nr b">isRunningUITests</code>会告诉我们是否正在运行UI测试</li><li id="b35c" class="nf ng it lx b ly ns mb nt li nu lm nv lq nw mn nk nl nm nn bi translated">静态函数，帮助我们覆盖标志，使应用程序可以显示我们想要的视图。</li></ol><p id="f16c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">既然我们已经设置了UI测试所需的一切，我们得到的问题是我们将在哪里以及如何在我们的应用程序中使用<code class="fe no np nq nr b">LaunchArguments</code>。</p><p id="9679" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">以前，我们使用<code class="fe no np nq nr b">AppDeleagte</code>来处理覆盖任何标志、监听远程通知、记录等等的逻辑。现在有了新的SwftUI应用程序，它们使用一个定制的<code class="fe no np nq nr b">struct</code>来启动，这个定制的<code class="fe no np nq nr b">struct</code>符合一个叫做<code class="fe no np nq nr b">App</code>的协议。你还是可以用<code class="fe no np nq nr b">didFinishLaunchingWithOptions</code>的方法来使用我们的<code class="fe no np nq nr b">LaunchArguments</code>。</p><p id="14fc" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">为此，首先，创建一个从<code class="fe no np nq nr b">NSObject</code>继承并适应<code class="fe no np nq nr b">UIApplicationDelegate</code>协议的定制类</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="d8eb" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">你不应该忘记在<code class="fe no np nq nr b">App</code>场景中添加以下内容。SwiftUI有责任委任该代表并负责其生活:</p><pre class="kj kk kl km gt od nr oe of aw og bi"><span id="3ff5" class="kz la it nr b gy oh oi l oj ok">@UIApplicationDelegateAdaptor(AppDelegate.self) var appDelegate</span></pre><p id="5a18" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">如果您不想这样做，您仍然可以在<code class="fe no np nq nr b">App</code>场景中使用<code class="fe no np nq nr b">init()</code>，并像这样添加代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="0468" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">好了，我们把一切都安排好了。现在，让我们为我们的<code class="fe no np nq nr b">ContentView</code>写一些测试用例。</p><p id="a968" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">为简单起见，下面是我们根据业务逻辑必须涵盖的测试案例:</p><ol class=""><li id="f52a" class="nf ng it lx b ly mo mb mp li nh lm ni lq nj mn nk nl nm nn bi translated">测试默认<code class="fe no np nq nr b">Title</code>文本</li><li id="9e48" class="nf ng it lx b ly ns mb nt li nu lm nv lq nw mn nk nl nm nn bi translated">测试<code class="fe no np nq nr b">Title</code>文本是否响应更改并正确更新。</li><li id="4b04" class="nf ng it lx b ly ns mb nt li nu lm nv lq nw mn nk nl nm nn bi translated">导航至<code class="fe no np nq nr b">View1</code></li><li id="4208" class="nf ng it lx b ly ns mb nt li nu lm nv lq nw mn nk nl nm nn bi translated">导航到<code class="fe no np nq nr b">View2</code>(调整逻辑来测试)</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">示例UI测试—swift UI _ UI testing _ MediumUITests</p></figure><p id="c48c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在上面的代码中，我们必须记住的一件关键事情是，你想添加到你的<code class="fe no np nq nr b">launchArguments</code>中的任何东西都必须在应用<code class="fe no np nq nr b">launch()</code>之前完成。<br/> <code class="fe no np nq nr b">launchEnvironment</code>将帮助我们覆盖我们在应用程序中使用的任何功能标志。查看测试案例</p><pre class="kj kk kl km gt od nr oe of aw og bi"><span id="be88" class="kz la it nr b gy oh oi l oj ok">func testView2Navigation() {<br/>    app.launchEnvironment[“Override-showView2”] = “true”<br/>    app.launch()</span><span id="35e5" class="kz la it nr b gy ol oi l oj ok">    ContentViewHelper.navigateToView2()<br/>}</span></pre><p id="fc60" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">当用户点击<code class="fe no np nq nr b">ContentView.swift</code>中的按钮时，<code class="fe no np nq nr b">launchEnvironment["Override-showView2"]</code>将帮助用户导航至<code class="fe no np nq nr b">View2</code>。</p><p id="f5c9" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">此外，我们必须在测试用例中以及在<code class="fe no np nq nr b">TestDetector</code>中使用相同的键<code class="fe no np nq nr b">Override-showView2</code>。</p><p id="dffe" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">当您按下<code class="fe no np nq nr b">Command + U</code>来运行测试用例时，您将会看到神奇之处:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/2d941521edb3902fff0fc6daf827baa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nLmW7_phR_zn7lXCwlETpw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">运行UI测试</p></figure><h2 id="00b6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">重要提示</strong></h2><p id="4052" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated"><code class="fe no np nq nr b">XCTest</code>使用可访问性API获取视图层次结构中的所有UI元素。SwiftUI默认提供可访问性支持，并且非常容易使用。</p><p id="9e4e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated"><code class="fe no np nq nr b">XCUIApplication</code>可以用来查询视图层次结构中存在的任何UIElement，但是我们必须确保<code class="fe no np nq nr b">UIElement</code>的可访问性已经打开。</p><p id="62c2" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">通过添加或使用可访问性进行测试是一个很好的方法，因为你可以同时做这两项工作(添加可访问性和UI测试)</p><h2 id="b9f2" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">提示</strong></h2><ol class=""><li id="5235" class="nf ng it lx b ly lz mb mc li on lm oo lq op mn nk nl nm nn bi translated">如果你之前已经运行了测试用例，你会发现结果仍然显示。要清除测试结果，您可以执行<code class="fe no np nq nr b">Control + Option + Command + K</code>或点击Xcode工具栏上的<code class="fe no np nq nr b">Product</code>并选择<code class="fe no np nq nr b">Clean Test Results</code></li><li id="5e6e" class="nf ng it lx b ly ns mb nt li nu lm nv lq nw mn nk nl nm nn bi translated">也可以通过做<code class="fe no np nq nr b">Option + Command + R</code>添加<code class="fe no np nq nr b">launchArguments</code>，在工具栏选择<code class="fe no np nq nr b">Arguments</code>。</li></ol><p id="99f7" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">你可以在这里找到Github回购<a class="ae ky" href="https://github.com/dheerajn/SwiftUI-UITesting" rel="noopener ugc nofollow" target="_blank">。如果您有任何问题或建议，请联系我。祝你好运。</a></p><p id="de86" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">希望这对你有帮助。感谢阅读。</p></div></div>    
</body>
</html>