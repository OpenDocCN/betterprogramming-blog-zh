# 加密数据前要问的 6 个问题

> 原文：<https://betterprogramming.pub/6-questions-to-ask-before-encrypting-application-layer-data-3b9419bd5d1d>

## 为什么以及如何加密

![](img/2fe8ae4fbf6c23442a4ddb4249c176b2.png)

尼克·麦克米伦在 [Unsplash](https://unsplash.com/s/photos/question?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

在脸书数据丑闻和爱德华·斯诺登泄密的时代，数据从未像今天这样有价值。

消费者开始意识到他们的数据实际上是有价值的。企业和商业总是理解数据的价值(并从中获益)。当你拥有有价值的东西时，你会保护它。

我们拥有的保护应用层数据的最强大工具之一是加密，但评估应用层加密系统并将其集成到产品、流程和业务中是一项挑战。

根据您的客户是谁，不同的价值观推动着对数据保护的需求。在开始应用程序层数据加密之前，我们将探讨六个重点问题。

# 问题 1:为什么需要应用层数据加密？

所以，你认为有必要加密你的数据。可能有。但是为什么呢？通过加密数据，对客户或最终用户有什么附加值？

## 好答案

通常，受监管行业(如医疗保健、国防和金融)的产品需要它作为进入市场的先决条件。法规通常推动需求，如 GDPR、[、CCPA](https://medium.com/@mcla0181/the-california-consumer-privacy-act-explained-7fde8ccc84d8) 、HIPAA、FIPS、通用标准、NIST 网络安全框架等。—但并不总是如此。

当消费产品集成加密时，他们说的是数据是有价值的，值得保护。

例如，安全消息应用 Signal 坚信您的通信应该是隐私的，加密会强制实施这种隐私——最终用户甚至不必考虑这一点。

## 糟糕的答案

任何与*特定的*业务目标或具体的上市策略无关的请求都是危险信号。

例如，如果一位投资者对一位创始人说:“你的产品中加入加密技术会有更好的市场认知度，所以你应该尽快加入。”这是个糟糕的建议。它规定了一个方向，而没有扩展驱动需求的潜在价值体系。

即使这是真的，它也不能帮助创建者建立一个安全的系统，因为它无法与特定的威胁模型对话。

# 问题 2:您的具体威胁模型是什么？

仅仅加密数据解决不了任何问题。

加密数据*将*保护敏感数据的问题转化为保护加密密钥的问题。这样，您的加密数据可以安全地通过系统中不太安全和不可信的部分。

定义一个威胁模型就是识别你的系统中哪些部分是*可信的*和*不可信的*。风险只来自通过不可信部分的敏感数据。在系统的不可信部分，以下三个轴进一步隔离了风险:

1.  空间:系统某一部分的妥协不应该影响系统的任何其他部分。
2.  时间:过去的妥协不应影响未来的行动。
3.  使用:与过度使用相关的妥协应该是不可能的。

最后，你会得到这个问题的答案:“保护谁或什么？”

## 良好的威胁模型

在*信任的*和*不信任的*之间定义的界限越明确越好。

例如，也许你承诺在你的日志中保护 PII(个人身份信息)。

然后，通过在系统(您的服务器)的可信部分[加密您的日志](https://medium.com/@danielhuang37/encrypting-all-your-logs-in-2-easy-steps-using-logrotate-and-peacemakr-8ad9cbfe1b4c)来满足您的威胁模型是很简单的。现在，您可以安全地将日志卸载到系统中不受信任的部分，即日志备份解决方案。

## 不良威胁模型

系统中可信部分和不可信部分之间模糊的界限是不安全的，因为不同的解释会导致错误的沟通。

此外，如果您声明您的系统中有太多部分是“可信的”，那么您(和您的客户)就会暴露在更广泛的攻击面前。最后，如果不划分风险域，那么一个漏洞就可能危及整个系统。

# 问题 3:应用层加密的总拥有成本是多少？

总拥有成本取决于您的实施。

## 建立你自己的

*   前期成本:极高。
*   持续成本:极高。

除非你有一个完整的产品安全团队，加密团队，SRE 团队，质量保证团队，和内部红队，*和*你正在建立一个非常专注的高度专业化的系统，这种方法可能不适合你。

内部构建加密系统会招致最大的成本、风险和长期工程债务(以错误、遗留代码和非标准实现的形式)。

即使开源或第三方托管服务并不完全符合您的要求，问问自己为什么标准没有这样做也是值得的。

## 部署开源项目

*   前期成本:中等。
*   持续成本:高。

虽然使用开源加密工具可以显著降低前期成本，但开源社区很少甚至没有降低持续费用。

例如， [Hashicorp 的加密即服务](https://learn.hashicorp.com/vault/encryption-as-a-service/eaas-transit)是其开源产品的一部分。现在，除了运行您自己的一套高可用性服务之外，您还确保了他们的高可用性。

通常，这迫使您雇用一名领域专家来维护和扩展解决方案。运行一个开源项目的长期安全性如何？

为了避免新发现的安全漏洞破坏安全，您必须定期更新。最后，考虑一下您的工程师:现在，他们需要一套调试工具来调试系统的加密部分。它是作为开源项目的一部分，还是关键的工程需求没有得到满足？

## 使用第三方托管服务

前期成本:低。
持续成本:中等。

完全托管的服务非常出色，因为它们能够正常工作。初始开销很低。他们抽象掉了技术实现的所有困难。

向后兼容是可行的。至于安全更新，除了更新你的软件之外，你甚至不需要考虑它们。

那么，有什么条件呢？为什么我们仍然看到自制的加密系统？

因为在第三方托管服务中找到强威胁模型很难。例如，大多数 [KMS](https://aws.amazon.com/kms/) 解决方案要求您的密钥在云中，即他们的云中，(禁止您和您的客户使用本地密钥)。

如果你在追求医疗保健、国防和金融——小心行事，秘密很少被允许存在于云中(比如加密密钥)。即使你不在这些垂直领域，也要小心。

例如，考虑一个威胁模型，其中包括针对第三方服务的隐私，如谷歌的 [Pub/Sub](https://cloud.google.com/pubsub/docs/overview) 服务。所以，如果你用谷歌的 KMS 服务加密你的数据，然后通过谷歌的 PubSub 发送，你到底在做什么？为什么呢？

# 问题 4:它会扩展吗？

当你 10 倍，从 10K 到 100K 和 1M 的客户端，加密和解密服务会发生什么？他们能跟上吗？

## 好答案

扩展的系统倾向于将大量的加密和解密操作卸载给执行这些操作的软件。

为了实现这一点，您必须将密钥安全地分发到系统中需要它们的部分，并且安全的密钥分发机制也需要具有良好的伸缩性。

## 糟糕的答案

当许多客户端用“这是我的明文，请加密它”和“这是我的密文，请解密它”来攻击集中式服务时，这是扩展成本最高的系统类型。

扩展会增加成本，包括专用工程时间、SRE 时间和原始云计算时间(取决于加密系统的类型)。

使用集中式系统作为信任的基础，并在此基础上进行构建，这可能很有诱惑力，但现在您正在构建一个内部解决方案。

# 问题 5:它是否支持客户控制的密钥和本地密钥所有权？

本地密钥所有权来自一个威胁模型，该模型怀疑是云部署的服务。许多客户不会明确要求这样做，但大多数企业客户会期望这样做，尤其是在医疗保健、国防和金融等受监管的垂直行业。

在消费者领域，我们也看到了客户控制钥匙的激增，特别是随着加密货币钱包甚至安全通信应用的出现。

## 好答案

当您客户的威胁模型需要时，提供本地密钥所有权选项将确保您永远不会因安全性不足而被排除在市场之外。

从云中密钥所有权到本地密钥所有权的平稳、无中断和自助式过渡机制也是预期的。

## 糟糕的答案

当你试图跨越任何监管良好的垂直市场中的鸿沟时，忽视这一要求作为“好问题”将使你极难打入务实的多数市场。

即使在消费者领域，对于那些重视安全的人来说，也有向设备上密钥所有权的转变。

# 问题 6:它支持加密灵活性吗？

加密灵活性是指从一个密码套件动态切换到另一个密码套件的能力，而无需发布新软件。加密灵活性是现代应用层加密方案的一个重要方面。

例如，假设您决定在安全密钥交付机制中使用 RSA-2048，但是 RSA-2048 总有一天会过时。随着攻击的发展，构建安全的系统需要加密灵活性，以快速摆脱被破坏的加密算法和被破坏的实现。

## 好答案

一个版本完善、动态且集中的控制面板是为应用层加密提供加密灵活性的唯一途径。

具体来说，决定“这个客户端应该使用什么加密算法？”或者甚至是“客户端应该使用什么密钥来加密？”应该从集中的单一控制台进行集中和控制，而不是硬编码或由客户决定。

## 糟糕的答案

任何关于算法、操作模式或密钥长度的硬编码决策都将在您以后试图摆脱这些决策时导致巨大的伤害。

如果遗留客户端中没有版本控制机制，甚至不可能淘汰旧的算法。

# 介绍 Peacemakr

[Peacemakr](https://peacemakr.io) 是应用层数据安全平台。它在一个简单的接口后面抽象出了上述所有困难的问题。它使用专用的 SaaS 为所有集成的客户端提供集中的配置管理。

SDK 专注于最终用户的简单性和性能，因此您不需要专门的安全团队来构建和维护您产品中的安全应用层加密。

与 KMS 解决方案不同，Peacemakr 是应用层加密的全栈解决方案。它通过单一解决方案为您和您的客户提供安全的密钥交付、密钥生命周期管理、加密灵活性，甚至本地密钥派生。

更多信息，请查看 https://peacemakr.io 或我们在 [GitHub](https://github.com/peacemakr-io/peacemakr-go-sdk) 上的开源 Peacemakr Crypto SDKs。

即使你不想直接集成到你的应用程序中，也有一个开源的 [peacemakr-cli](https://github.com/peacemakr-io/peacemakr-cli) 可以加密和解密你系统中的字符串或文件。

这对于调试安全的密文尤其有用，或者，甚至只是加密你的日志。