<html>
<head>
<title>Angular 7 Series Part-2: Creating a Custom Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular 7系列第2部分:创建自定义库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/angular-7-series-part-2-create-custom-library-8d7a0494b2cc?source=collection_archive---------1-----------------------#2018-12-05">https://betterprogramming.pub/angular-7-series-part-2-create-custom-library-8d7a0494b2cc?source=collection_archive---------1-----------------------#2018-12-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="041b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于使用Angular CLI创建具有mono-repo架构的企业级应用程序的系列文章的第二篇</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8767d9d51a57bc70fb463692dff426fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DKL6z3fUzVa7nIFfWfNpQg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">角度库</p></figure><p id="247e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇文章中，我将从我在第一部分离开的地方开始。到目前为止，我已经使用<code class="fe lu lv lw lx b">angular-cli</code>用mono-repo架构建立了一个工作区。然后，在工作区内，我创建了两个应用程序:<code class="fe lu lv lw lx b">home</code>和<code class="fe lu lv lw lx b">profile</code>。如果您尚未完成第一部分，请先访问<a class="ae ly" href="https://medium.com/better-programming/angular-7-series-part-1-create-enterprise-level-application-36c84786fa27" rel="noopener"> Angular 7系列第一部分:创建企业级应用</a> <em class="lz"> </em>。源代码链接也是可用的。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="78e0" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤1:库命名约定</h1><p id="82b5" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">当构建一个应用程序时，即使只是为了学习、练习或娱乐，你也应该为变量、函数、类、数据模型/接口、库和任何其他你命名的东西保持良好的、有意义的命名约定。由于范围有限，我将在本文中仅简要解释<code class="fe lu lv lw lx b">library</code>命名约定，但在将来，我将撰写另一篇文章，介绍标准应用程序架构、数据流和命名约定。</p><p id="7b8a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于<code class="fe lu lv lw lx b">library</code>的命名惯例，我更喜欢在所有的名字上加一个前缀。前缀应该很小；它可以是您的项目名称、您的团队名称或您的平台名称。如果你的库名有多个单词，那么在中间使用破折号(<code class="fe lu lv lw lx b"><strong class="la iu">dasherize</strong></code>)。所以这个库的全名结构将是<code class="fe lu lv lw lx b">&lt;prefix&gt;-&lt;library-name&gt;</code>。在库<code class="fe lu lv lw lx b">package.json</code>中，包名结构将是<code class="fe lu lv lw lx b">@&lt;prefix&gt;/&lt;library-name&gt;</code>。对于这个项目，我将使用<code class="fe lu lv lw lx b">ng7</code>作为前缀。例如，如果我添加一个名为<code class="fe lu lv lw lx b">common</code>的库，那么完整的库名将是<code class="fe lu lv lw lx b">ng7-common</code>，而<code class="fe lu lv lw lx b">package.json</code>中的包名将是<code class="fe lu lv lw lx b">@ng7/common</code>。</p><p id="6fff" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果在库中创建任何组件，使用完整的库名作为选择器前缀，例如在<code class="fe lu lv lw lx b">FooterComponent</code>中，选择器将是<code class="fe lu lv lw lx b">ng7-common-footer</code>。一旦您从该库中导入任何模块或组件，您的导入引用将是<code class="fe lu lv lw lx b">@ng7/common</code>。</p><p id="38e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="lz">注</em> </strong> <em class="lz">:我们应该避免在任何名称中使用数字，只是为了系列名称我在前缀中使用了数字。在你的情况下，请避免数字。</em></p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="2b86" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤2:确定所需的应用程序</h1><p id="3ecc" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">在这个系列中，我将创建一个具有顶部导航、页脚、用户登录、用户配置文件、web表单的项目。我会尽可能使用有棱角的材料组件。</p><p id="af40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了协调所有这些，我计划添加两个应用程序:<code class="fe lu lv lw lx b">home</code>和<code class="fe lu lv lw lx b">profile</code>。我已经在本系列的第一部分<strong class="la iu"> </strong>中创建了这些应用程序。在<code class="fe lu lv lw lx b">home</code>应用程序中，我将添加几个<code class="fe lu lv lw lx b">components</code>，它们将是公开可访问的，这意味着任何人都可以在没有<code class="fe lu lv lw lx b">authentication</code>的情况下访问。<code class="fe lu lv lw lx b">profile</code>应用程序还会有一些<code class="fe lu lv lw lx b">components</code>来显示<code class="fe lu lv lw lx b">authenticated</code>用户配置文件。</p><p id="6d9b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我喜欢将<code class="fe lu lv lw lx b">home</code>和<code class="fe lu lv lw lx b">profile</code>分开的原因是<code class="fe lu lv lw lx b">home</code>应用程序将具有公共的特性，内容将主要是静态的，并且它与用户配置文件没有任何直接的依赖关系，而<code class="fe lu lv lw lx b">profile</code>应用程序将具有更多带有动态数据的动态特性，将会发生大量的用户交互，并且我们还需要维护用户状态。很明显，与<code class="fe lu lv lw lx b">home</code>相比，<code class="fe lu lv lw lx b">profile</code>应用需要更频繁的发布。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="2be6" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤3:确定所需的库</h1><p id="2474" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">在我创建任何库之前，我们需要思考并尝试确定这个项目需要多少个库。让我们来找出答案:</p><ol class=""><li id="b2d9" class="ne nf it la b lb lc le lf lh ng ll nh lp ni lt nj nk nl nm bi translated">对于顶部导航、页脚、任何共享数据模型或接口等常见组件，我将创建一个名为<code class="fe lu lv lw lx b">common</code>的库。</li><li id="2e1e" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">我更喜欢将所有服务分开，所以我将添加一个<code class="fe lu lv lw lx b">service</code>库。</li><li id="bc32" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">对于<code class="fe lu lv lw lx b">jwt</code>基于令牌的认证，我将添加一个名为<code class="fe lu lv lw lx b">oauth</code>的库。这个库将有<code class="fe lu lv lw lx b">ngrx</code>特性<code class="fe lu lv lw lx b">store</code>实现。</li><li id="5d2b" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">对于反应式表单处理，我将添加一个<code class="fe lu lv lw lx b">form</code>库。</li><li id="9005" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">我会添加一个<code class="fe lu lv lw lx b">router</code>库来使用<code class="fe lu lv lw lx b">ngrx</code>特性<code class="fe lu lv lw lx b">store</code>访问序列化的<code class="fe lu lv lw lx b">RouterStateSnapshot</code>，它将用于标识当前路由器<code class="fe lu lv lw lx b">state</code>和<code class="fe lu lv lw lx b">params</code>。</li><li id="6986" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">为了支持主题化，我将添加一个<code class="fe lu lv lw lx b">theme</code>库。</li><li id="02f1" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">我还将添加一个<code class="fe lu lv lw lx b">material</code>库来保持angular material模块单独导入。</li></ol><p id="2770" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着我们继续本系列的其他部分，我可能需要添加更多的库。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="fdfd" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤4:创建一个新的分支</h1><p id="265a" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">基于我们最初的计划，我正在为这篇文章创建一个<a class="ae ly" href="http://part-2/create-libraries" rel="noopener ugc nofollow" target="_blank">新分支。但是我仍然会为新读者保留第一部</a>中的<a class="ae ly" href="http://part-1/enterprise-level-application" rel="noopener ugc nofollow" target="_blank">分支。你总能在</a><a class="ae ly" href="https://github.com/mkhan004/angular7-series" rel="noopener ugc nofollow" target="_blank">主</a>分支上找到最新的代码。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="c604" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤5:创建库</h1><p id="5d12" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">现在我将创建一个<code class="fe lu lv lw lx b">common</code>库，全名为<code class="fe lu lv lw lx b">ng7-common</code>，使用以下命令:</p><p id="0e81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">ng g library ng7-common --prefix=ng7-common</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/ef40592493bcdefb89de80411174eeb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lGiBV20x1557ToyuwJy7iA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建ng7-公共库</p></figure><p id="f35e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将在<code class="fe lu lv lw lx b">projects</code>目录中创建<code class="fe lu lv lw lx b">ng7-common</code>库，其中包含<code class="fe lu lv lw lx b">src/lib</code>中的<code class="fe lu lv lw lx b">ng7-common.module.ts</code>、<code class="fe lu lv lw lx b">ng7-common.component.ts</code>、<code class="fe lu lv lw lx b">ng7-common.service.ts</code>文件，以及<code class="fe lu lv lw lx b">public_api.ts</code>作为<code class="fe lu lv lw lx b">src</code>目录中的入口文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/eb8bff536c70946ff9681e011c6222cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xd5Xu_PaS4CDwGOy9zGXA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ng7-公共图书馆</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="11ec" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第六步:清理图书馆</h1><p id="4a9e" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">如果你看一下我们的图书馆目录，很少有像<code class="fe lu lv lw lx b">ng7-common.component.ts</code>、<code class="fe lu lv lw lx b">ng7-common.component.spec.ts</code>、<code class="fe lu lv lw lx b">ng7-common.service.ts</code>、<code class="fe lu lv lw lx b">ng7-common.service.spec.ts</code>这样的文件，我们不需要。您可以安全地删除这些文件，并确保从<code class="fe lu lv lw lx b">public_api.ts</code>和<code class="fe lu lv lw lx b">ng7-common.module.ts</code>中清除导入/导出语句。这是<code class="fe lu lv lw lx b">public_api.ts</code>文件在清理前的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="ce17" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">ng7-common.module.ts</code>文件清理前:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="bedd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">文件清理后，我们的库将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/af483f431c9e1bb74f71129eeee11657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDygMRlXFeJ7ltIylzBW7A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ng7-公共图书馆</p></figure><p id="ba46" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">清理后的<code class="fe lu lv lw lx b">ng7-common.module.ts</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="e079" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以及清理后的<code class="fe lu lv lw lx b">public_api.ts</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="43de" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第7步:配置样式文本</h1><p id="b7f1" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">现在如果你看一下<code class="fe lu lv lw lx b">angular.json</code>文件，你会看到没有为这个库指定<code class="fe lu lv lw lx b">styleext</code>示意图，这意味着如果我们在这个库中默认创建任何组件<code class="fe lu lv lw lx b">angular-cli</code>将创建一个<code class="fe lu lv lw lx b">.css</code>文件作为样式表。不幸的是，<code class="fe lu lv lw lx b">library</code>原理图不支持<code class="fe lu lv lw lx b">--style=scss</code>特性，正如它不支持<code class="fe lu lv lw lx b">application</code>原理图一样。但是当然，您可以在每次创建新组件时指定<code class="fe lu lv lw lx b">--style=scss</code>，我不喜欢这样做。我希望<code class="fe lu lv lw lx b">angular-cli</code>团队会考虑在<code class="fe lu lv lw lx b">library</code>示意图中添加该属性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="5710" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为解决方法，我将在<code class="fe lu lv lw lx b">angular.json</code>中添加该设置。它可以像这样手动配置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="5b55" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第8步:构建一个库</h1><p id="91b5" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">现在我们准备用这个命令来构建我们的<code class="fe lu lv lw lx b">ng7-common</code>库:</p><p id="111d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">ng build ng7-common</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/92822d5b467077bf3b9adbee8e45b321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PbI8JDCM-jbSLP9YO9y94Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">成功构建:ng7-常见</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="8200" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第9步:向库中添加组件</h1><p id="1852" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">在我们开始使用<code class="fe lu lv lw lx b">ng7-common</code>库之前，我需要添加一个组件。我正在使用来自项目根的这个命令添加一个<code class="fe lu lv lw lx b">footer</code>组件:</p><p id="2785" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">ng g component footer --project=ng7-common</code></p><p id="d6c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如下图所示，它已经在<code class="fe lu lv lw lx b">ng7-common</code>库中创建了<code class="fe lu lv lw lx b">footer</code>组件，包括一个<code class="fe lu lv lw lx b">.scss</code>文件作为样式表。它还在<code class="fe lu lv lw lx b">ng7-common.module.ts</code>中包含了导入语句和组件声明。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/48a9531527c1999f5c69ae5cf6172b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xk7bDSEKhDJX1sisQcKnuw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">页脚组件</p></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="85fc" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第10步:从库中导出组件</h1><p id="f43f" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">如果我们想从库中导出任何组件，那么作为第一步，我们必须在<code class="fe lu lv lw lx b">@NgModule</code>的<code class="fe lu lv lw lx b">exports: []</code>部分注册该组件名称。例如:如果我想从<code class="fe lu lv lw lx b">ng7-common</code>库中导出<code class="fe lu lv lw lx b">FooterComponent</code>，我必须在<code class="fe lu lv lw lx b">ng7-common.module.ts</code>中进行如下更新:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="eae5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后作为第二步，我们需要从<code class="fe lu lv lw lx b">public_api.ts</code>中的组件文件导出所有内容，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><blockquote class="nz oa ob"><p id="5753" class="ky kz lz la b lb lc ju ld le lf jx lg oc li lj lk od lm ln lo oe lq lr ls lt im bi translated">注意:对于从库中导出任何组件、服务、接口或任何数据模型，我们应该通过<code class="fe lu lv lw lx b">public_api.ts</code>来导出它们。如果我们这样做了，我们的进口申报就会非常干净，</p></blockquote><pre class="kj kk kl km gt of lx og oh aw oi bi"><span id="14b2" class="oj mi it lx b gy ok ol l om on">import { FooterComponent, Ng7CommonModule } from '@<!-- -->ng7/common<!-- -->';</span></pre><p id="aeac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">否则就会变成这样(这是你不想做的)，</p><pre class="kj kk kl km gt of lx og oh aw oi bi"><span id="13eb" class="oj mi it lx b gy ok ol l om on">import { Ng7CommonModule } from '@<!-- -->ng7/common/src/lib/ng7-common.module<!-- -->';<br/>import { FooterComponent } from '@<!-- -->ng7/common/src/lib/footer/footer.component<!-- -->';</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="add7" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤11:更新包名</h1><p id="ac34" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">如果你在<code class="fe lu lv lw lx b">ng7-common</code>图书馆里面找<code class="fe lu lv lw lx b">package.json</code>，我们的包名是<code class="fe lu lv lw lx b">"name": "ng7-common"</code>。你可以保持现在的样子，它不会有任何问题。但是我喜欢遵循我在第一步中解释的命名约定，所以我将包名更新如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="28c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在让我们重新构建库，以验证一切正常工作。是的，有效！！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/8e486e34a0ebd679357d62bcab32a2fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSDb4KLGX8hjjRMjR6gRUQ.png"/></div></div></figure><p id="0f93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完美！，现在让我们验证<code class="fe lu lv lw lx b">./dist/ng7-common</code>目录中的<code class="fe lu lv lw lx b">package.json</code>。正如所料，库包名是<code class="fe lu lv lw lx b">@ng7/common</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="ee04" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤12:安装库</h1><p id="d8bb" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">现在是时候安装新创建的库<code class="fe lu lv lw lx b">ng7-common</code>并准备将<code class="fe lu lv lw lx b">footer</code>组件导入到我们的应用程序中了。我们可以通过以下方式安装<code class="fe lu lv lw lx b">ng7-common</code>库</p><blockquote class="nz oa ob"><p id="3b50" class="ky kz lz la b lb lc ju ld le lf jx lg oc li lj lk od lm ln lo oe lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">npm install dist/ng7-common</code></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/2c338d458ae0abf6045392baf6d054ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LezIo7TeklbHRpassPjEyg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">成功安装</p></figure><p id="6c5f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在项目级别<code class="fe lu lv lw lx b">package.json</code>中，它添加了一个新的<code class="fe lu lv lw lx b">dev</code>依赖项</p><pre class="kj kk kl km gt of lx og oh aw oi bi"><span id="b184" class="oj mi it lx b gy ok ol l om on">"@ng7/common": "file:dist/ng7-common",</span></pre><p id="3adb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们准备将<code class="fe lu lv lw lx b">footer</code>组件导入到<code class="fe lu lv lw lx b">home</code>和<code class="fe lu lv lw lx b">profile</code>应用程序中。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="f4d9" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤13:修复安装问题</h1><p id="4c97" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">但是在我们变得非常兴奋之前，我想强调一下我们马上要面对的一个问题。如果我们需要移除<code class="fe lu lv lw lx b">node_modules</code>和<code class="fe lu lv lw lx b">dist</code>并重新安装，那我们就完了。现在我们不能运行<code class="fe lu lv lw lx b">npm install</code>，因为<code class="fe lu lv lw lx b">file:dist/ng7-common</code>不存在。不幸的是，我们不能建造图书馆，因为T21不见了。</p><p id="66b2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们现在能做什么？以及第一个选项:</p><ol class=""><li id="6ed4" class="ne nf it la b lb lc le lf lh ng ll nh lp ni lt nj nk nl nm bi translated">从<code class="fe lu lv lw lx b">package.json</code>开发依赖项中删除库引用。</li><li id="14ca" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">运行<code class="fe lu lv lw lx b">npm install</code></li><li id="e2f0" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">构建库<code class="fe lu lv lw lx b">ng build <strong class="la iu">ng7-common</strong></code></li><li id="93be" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">然后再装回库<code class="fe lu lv lw lx b">npm install <strong class="la iu">dist/ng7-common</strong></code></li></ol><p id="f7f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是可行的，但是一遍又一遍地执行所有这些步骤是非常烦人的。</p><p id="62c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为第二种选择，我们可以将我们的库安装为可选的依赖项，而不是<code class="fe lu lv lw lx b">dev</code>依赖项。例如，要安装<code class="fe lu lv lw lx b">ng7-common</code>库，我们需要运行以下命令:</p><blockquote class="nz oa ob"><p id="bffa" class="ky kz lz la b lb lc ju ld le lf jx lg oc li lj lk od lm ln lo oe lq lr ls lt im bi translated"><code class="fe lu lv lw lx b"><em class="it">npm install </em><strong class="la iu"><em class="it">dist/ng7-common</em></strong><em class="it"> --save-optional</em></code></p></blockquote><pre class="kj kk kl km gt of lx og oh aw oi bi"><span id="4cf4" class="oj mi it lx b gy ok ol l om on">{<br/>  "name": "angular7-series",<br/>  "version": "0.0.0",<br/>  ...<br/>  ...<br/><strong class="lx iu">  "optionalDependencies": {</strong>                      &lt;--------<br/><strong class="lx iu">    "</strong><a class="ae ly" href="http://twitter.com/ng7/common" rel="noopener ugc nofollow" target="_blank"><strong class="lx iu">@ng7/common</strong></a><strong class="lx iu">": "file:dist/ng7-common"</strong><br/><strong class="lx iu">  }</strong><br/>}</span></pre><p id="ad03" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，对于任何全新安装，我们只需运行以下命令:</p><ol class=""><li id="4a8f" class="ne nf it la b lb lc le lf lh ng ll nh lp ni lt nj nk nl nm bi translated">运行<code class="fe lu lv lw lx b">npm install --no-optional</code></li><li id="eeec" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">然后建图书馆<code class="fe lu lv lw lx b">ng build <strong class="la iu">ng7-common</strong></code></li><li id="7c47" class="ne nf it la b lb nn le no lh np ll nq lp nr lt nj nk nl nm bi translated">最后，运行<code class="fe lu lv lw lx b">npm install</code>，这将安装在1中跳过的可选依赖项。</li></ol><p id="2916" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">比起第一个选择，我更喜欢第二个选择。因此，对于所有的库安装，我将遵循第二个选项。这意味着我在第12步中安装库的方式不是我以后要遵循的方式。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="7977" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤14:将组件导入应用程序</h1><p id="5d21" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">现在我将把<code class="fe lu lv lw lx b">footer</code>组件导入到<code class="fe lu lv lw lx b">home</code>应用程序中。为此，我需要将<code class="fe lu lv lw lx b">Ng7CommonModule</code>导入到<code class="fe lu lv lw lx b">home</code>应用程序的<code class="fe lu lv lw lx b">app.module.ts</code>中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="7d83" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后在<code class="fe lu lv lw lx b">app.component.html</code>内添加<code class="fe lu lv lw lx b">footer</code>组件选择器，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c4e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，是编译和运行<code class="fe lu lv lw lx b">home</code>应用程序的时候了:</p><p id="a86f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe lu lv lw lx b">npm run home:client</code></p><p id="25a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它会编译我们的<code class="fe lu lv lw lx b">home</code> app，并在<code class="fe lu lv lw lx b">http://localhost:3000/</code>打开。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/6e95cd8afd52ff5bb42c449040873ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2AsHiwk9y0A6ZBTO3kX5XQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">主页应用程序呈现页脚组件</p></figure><h1 id="b1cc" class="mh mi it bd mj mk or mm mn mo os mq mr jz ot ka mt kc ou kd mv kf ov kg mx my bi translated">步骤15:库的npm脚本</h1><p id="897a" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">我将下面的脚本添加到<code class="fe lu lv lw lx b">ng7-common</code>库的项目级别<code class="fe lu lv lw lx b">package.json</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="6212" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤16: npm发布库</h1><p id="fdc0" class="pw-post-body-paragraph ky kz it la b lb mz ju ld le na jx lg lh nb lj lk ll nc ln lo lp nd lr ls lt im bi translated">如果你需要在<code class="fe lu lv lw lx b">npm</code>出版你的图书馆，那么你可以关注<a class="ow ox ep" href="https://medium.com/u/11477bb8a02e?source=post_page-----8d7a0494b2cc--------------------------------" rel="noopener" target="_blank">托德·帕尔</a>的这篇伟大的文章<a class="ae ly" href="https://medium.com/p/ce24bb673275" rel="noopener"> <strong class="la iu">《棱角图书馆系列——出版</strong> </a> <strong class="la iu"> </strong>。谢谢托德。</p><h1 id="ac8b" class="mh mi it bd mj mk or mm mn mo os mq mr jz ot ka mt kc ou kd mv kf ov kg mx my bi translated">一些棘手问题:</h1><ul class=""><li id="f0fc" class="ne nf it la b lb mz le na lh oy ll oz lp pa lt pb nk nl nm bi translated"><strong class="la iu">循环依赖:</strong>如果你有多个库，那么从库-a如果你导入一些东西到库-b，那么你永远不能从库-b导入任何东西到库-a。如果你这样做，那么将得到循环依赖错误。因此，您需要提前计划哪个库将被哪个库使用，并确保它们有一个方向的流动。</li><li id="461e" class="ne nf it la b lb nn le no lh np ll nq lp nr lt pb nk nl nm bi translated"><strong class="la iu">外部模块:</strong>一旦你将一个库模块导入另一个库模块并创建一个构建，你可能会看到这样的警告</li></ul><pre class="kj kk kl km gt of lx og oh aw oi bi"><span id="7107" class="oj mi it lx b gy ok ol l om on">No name was provided for external module '<a class="ae ly" href="http://twitter.com/fusion/pipe" rel="noopener ugc nofollow" target="_blank">@fusion/c</a>ommon' in output.globals – guessing 'common'</span></pre><p id="7a6b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要解决这个问题，您需要更新<code class="fe lu lv lw lx b">ng-package.json</code></p><pre class="kj kk kl km gt of lx og oh aw oi bi"><span id="9bb7" class="oj mi it lx b gy ok ol l om on">{<br/>  "$schema": "../../node_modules/ng-packagr/ng-package.schema.json",<br/>  "dest": "../../dist/fusion-service",<br/>  "lib": {<br/>    ...<br/>    "umdModuleIds": {                      &lt;----------<br/><strong class="lx iu">      "@fusion/common": "@fusion/common"</strong>   &lt;----------<br/>    }                                      &lt;----------<br/>  }<br/>}</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="7423" class="oj mi it bd mj pc pd dn mn pe pf dp mr lh pg ph mt ll pi pj mv lp pk pl mx pm bi translated">资源</h2><ul class=""><li id="c7b7" class="ne nf it la b lb mz le na lh oy ll oz lp pa lt pb nk nl nm bi translated"><a class="ae ly" href="https://github.com/mkhan004/angular7-series/tree/part-2/create-libraries" rel="noopener ugc nofollow" target="_blank">这一块的源代码</a>。</li><li id="ff11" class="ne nf it la b lb nn le no lh np ll nq lp nr lt pb nk nl nm bi translated">要了解有关CLI命令、别名和参数的更多信息，请访问<a class="ae ly" href="https://angular.io/cli" rel="noopener ugc nofollow" target="_blank"> angular cli </a>。</li></ul><h1 id="c75a" class="mh mi it bd mj mk or mm mn mo os mq mr jz ot ka mt kc ou kd mv kf ov kg mx my bi translated">其他文章</h1><ul class=""><li id="fabc" class="ne nf it la b lb mz le na lh oy ll oz lp pa lt pb nk nl nm bi translated"><a class="ae ly" href="https://medium.com/better-programming/angular-7-series-part-1-create-enterprise-level-application-36c84786fa27" rel="noopener"> Angular 7系列第1部分:创建企业级应用</a></li><li id="57f3" class="ne nf it la b lb nn le no lh np ll nq lp nr lt pb nk nl nm bi translated"><a class="ae ly" href="https://medium.com/better-programming/angular-8-series-part-3-upgrade-to-angular-8-c08745131cb6" rel="noopener"> Angular 8系列第3部分:升级至Angular 8 </a></li><li id="0efc" class="ne nf it la b lb nn le no lh np ll nq lp nr lt pb nk nl nm bi translated"><a class="ae ly" href="https://medium.com/better-programming/angular-8-series-part-4-add-angular-material-6501e91041d8" rel="noopener">角度8系列第4部分:添加角度材料</a></li></ul></div></div>    
</body>
</html>