<html>
<head>
<title>Build a Simple CRM With Django and HTMX — Project Setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Django和HTMX构建简单的CRM项目设置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-simple-crm-with-django-and-htmx-project-setup-ea84f900e273?source=collection_archive---------0-----------------------#2022-07-15">https://betterprogramming.pub/build-a-simple-crm-with-django-and-htmx-project-setup-ea84f900e273?source=collection_archive---------0-----------------------#2022-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="92f3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">后端开发简介</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b47b7043ffbd01eea04c001cb319b50a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ah3sCycuXwqOmXl44m9aaQ.png"/></div></div></figure><p id="2dec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我的上一篇文章中，我写到<a class="ae ln" href="https://medium.com/@john1galiszewski/how-to-handle-full-page-reloads-with-django-and-htmx-a9a7ef2e4b1c?source=friends_link&amp;sk=db50c2a682e62dbdf53a3948049fa033" rel="noopener">使用mixins/中间件处理htmx页面重载</a>。在本文中，我们将使用上一篇教程中的最后一个选项，或者您可以使用我整理的包，<code class="fe lo lp lq lr b">django-htmx-refresh</code>。</p><h2 id="6ed8" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated">目标</h2><p id="3299" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">本系列的目标是教您如何使用Django和htmx创建动态CRUD应用程序来跟踪客户及其联系信息。</p><h1 id="a7a1" class="mq lt iq bd lu mr ms mt lx mu mv mw ma jw mx jx md jz my ka mg kc mz kd mj na bi translated">先决条件</h1><p id="f4f9" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">我将使用以下软件:</p><ul class=""><li id="f1de" class="nb nc iq kt b ku kv kx ky la nd le ne li nf lm ng nh ni nj bi translated">Python 3 . 10 . 4</li><li id="ab4a" class="nb nc iq kt b ku nk kx nl la nm le nn li no lm ng nh ni nj bi translated">姜戈</li><li id="7d84" class="nb nc iq kt b ku nk kx nl la nm le nn li no lm ng nh ni nj bi translated">HTMX  1.8.0</li><li id="891e" class="nb nc iq kt b ku nk kx nl la nm le nn li no lm ng nh ni nj bi translated">助推器<a class="ae ln" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank">5 . 1 . 3</a></li></ul><p id="53d2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以及一些额外的Django包:</p><ul class=""><li id="ce58" class="nb nc iq kt b ku kv kx ky la nd le ne li nf lm ng nh ni nj bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://django-htmx.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">django-htmx</a> 1.12.0</code></li><li id="0bab" class="nb nc iq kt b ku nk kx nl la nm le nn li no lm ng nh ni nj bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://github.com/JohnGWebDev/django-htmx-refresh" rel="noopener ugc nofollow" target="_blank">django-htmx-refresh</a> 0.0.7</code></li></ul><p id="21f4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不要忘记创建一个虚拟环境，并在那里安装这些需求。我不会在这篇文章中讨论如何创建一个虚拟环境。</p><p id="a251" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注意:</strong>我将从CDN加载htmx和Bootstrap文档，但是这两个文档都建议您在生产期间在本地安装它们。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="02c7" class="mq lt iq bd lu mr nw mt lx mu nx mw ma jw ny jx md jz nz ka mg kc oa kd mj na bi translated">项目设置</h1><p id="70bf" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">让我们从创建Django项目开始。</p><pre class="kg kh ki kj gt ob lr oc od aw oe bi"><span id="c880" class="ls lt iq lr b gy of og l oh oi">python3 -m django startproject simple_crm</span></pre><p id="2eab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在项目目录中，有另一个包含项目设置的同名目录；重命名此目录<strong class="kt ir">核心</strong>以避免任何混淆。之后，我们需要更改一些设置以使我们的项目正常工作。</p><p id="356a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<strong class="kt ir"> asgi.py </strong>、<strong class="kt ir"> wsgi.py </strong>和<strong class="kt ir"> manage.py </strong>中修改下面一行:</p><pre class="kg kh ki kj gt ob lr oc od aw oe bi"><span id="cf10" class="ls lt iq lr b gy of og l oh oi">os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'simple_crm.settings')</span></pre><p id="0699" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">收件人:</p><pre class="kg kh ki kj gt ob lr oc od aw oe bi"><span id="9694" class="ls lt iq lr b gy of og l oh oi">os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')</span></pre><p id="2934" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们可以在<code class="fe lo lp lq lr b">settings.py</code>中添加我们需要的所有设置:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="29f3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您将注意到的一个新配置是<code class="fe lo lp lq lr b">HTMX_APPS</code>；由<code class="fe lo lp lq lr b">django_htmx_refresh</code>应用程序使用。它确保<code class="fe lo lp lq lr b"><a class="ae ln" rel="noopener ugc nofollow" target="_blank" href="/how-to-handle-full-page-reloads-with-django-and-htmx-a9a7ef2e4b1c?source=friends_link&amp;sk=db50c2a682e62dbdf53a3948049fa033">HtmxResponseMiddleware</a></code>只影响我们明确定义的应用，防止默认Django管理或其他第三方应用出错。它还需要一个应用名称空间，我们将在后面的<strong class="kt ir"> core/urls.py </strong>中定义。</p><p id="d2f5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们将在项目目录中创建模板目录。</p><pre class="kg kh ki kj gt ob lr oc od aw oe bi"><span id="4a86" class="ls lt iq lr b gy of og l oh oi">cd simple_crm<br/>mkdir templates</span></pre><p id="3611" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们就可以启动<code class="fe lo lp lq lr b">client_relationship_manager</code>应用了。</p><pre class="kg kh ki kj gt ob lr oc od aw oe bi"><span id="d4bf" class="ls lt iq lr b gy of og l oh oi">python3 manage.py startapp client_relationship_manager</span></pre><p id="c4d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此时，您的项目目录将如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/a7bafeaa5ba683306a98a8771c2ecf22.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*XP1es_uyFSe5rPtFyAqsxw.png"/></div></figure></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="12d3" class="mq lt iq bd lu mr nw mt lx mu nx mw ma jw ny jx md jz nz ka mg kc oa kd mj na bi translated">创建后端</h1><p id="141f" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">当开始一个新的应用程序时，我喜欢先写模型；当我们看到这些观点时，这给了我们一些东西来联系我们的观点。这里我们将创建一个名为<code class="fe lo lp lq lr b">Client</code>的模型，它将存储客户的联系信息。</p><h2 id="d7e1" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated">模型</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h2 id="0446" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated">资源定位符</h2><p id="1654" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">接下来，我们将建立我们的应用程序需要的URL。在<strong class="kt ir"> core/urls.py、</strong>中，我们将快速包含我们新应用的<strong class="kt ir"> urls.py </strong>文件，这是我们接下来要创建的。不要忘记添加一个<a class="ae ln" href="https://docs.djangoproject.com/en/4.0/topics/http/urls/#url-namespaces" rel="noopener ugc nofollow" target="_blank">应用名称空间</a>供<code class="fe lo lp lq lr b">django_htmx_refresh</code>应用使用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="fc9d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们创建了<strong class="kt ir">client _ relationship _ manager/URLs . py</strong>文件，并将路径添加到我们的基本CRUD视图中。我们还将<a class="ae ln" href="https://docs.djangoproject.com/en/4.0/topics/http/urls/#naming-url-patterns" rel="noopener ugc nofollow" target="_blank">向我们的URL模式</a>添加名称，以执行URL反转。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h2 id="d3bb" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated">视图</h2><p id="779c" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">现在我们可以创建我们的视图。我们将为我们的主页和搜索结果页面继承<code class="fe lo lp lq lr b">ListView</code>。其余的将是通用的CRUD视图。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="8418" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意每个视图是如何定义一个<code class="fe lo lp lq lr b">template_name</code>的。<code class="fe lo lp lq lr b"><a class="ae ln" href="https://github.com/JohnGWebDev/django-htmx-refresh" rel="noopener ugc nofollow" target="_blank">HtmxResponseMiddleware</a></code>截取<code class="fe lo lp lq lr b">template_name</code>属性，然后确定响应是否附加了htmx实例，并返回适当的模板。我们还将把一个<code class="fe lo lp lq lr b">form_class</code>传递给<code class="fe lo lp lq lr b">CreateClientView</code>和<code class="fe lo lp lq lr b">UpdateClientView</code></p><p id="b934" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，在<code class="fe lo lp lq lr b">SearchResultsView</code>中，我们将覆盖<code class="fe lo lp lq lr b">get_queryset</code>方法。在该方法中，我们将从请求中获取查询，通过给定的搜索查询过滤所有的<code class="fe lo lp lq lr b">Client</code>对象，并返回结果。</p><p id="9389" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，在创建、更新和删除视图中覆盖<code class="fe lo lp lq lr b">get_success_url</code>。他们需要返回一条成功消息，并呈现正确的URL。</p><h2 id="f8e5" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated">形式</h2><p id="0274" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">我们创建定制的表单类来为每个表单元素添加类选择器，而无需手动写出表单。它还允许我们在将来选择扩展表单功能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h2 id="5bcf" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated">启动服务器</h2><p id="9f1c" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">让我们现在启动服务器，从进行必要的迁移开始。</p><pre class="kg kh ki kj gt ob lr oc od aw oe bi"><span id="50ea" class="ls lt iq lr b gy of og l oh oi">python3 manage.py makemigrations<br/>python3 manage.py migrate</span></pre><p id="d00d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后通过运行下面的命令并按照终端中的提示创建一个超级用户。</p><pre class="kg kh ki kj gt ob lr oc od aw oe bi"><span id="cd28" class="ls lt iq lr b gy of og l oh oi">python3 manage.py createsuperuser</span></pre><p id="bb71" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，通过运行以下命令启动服务器:</p><pre class="kg kh ki kj gt ob lr oc od aw oe bi"><span id="4ce3" class="ls lt iq lr b gy of og l oh oi">python3 manage.py runserver</span></pre><p id="6ece" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，在您的网络浏览器中访问<a class="ae ln" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000/ </a>。您将看到一个类似于下图的<code class="fe lo lp lq lr b">TemplateDoesNotExist</code>错误:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/530231cf934b913e54e98d41c788c4b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*05wvv2SYMFByzC9MEZBFnA.png"/></div></figure><p id="6ee3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保Django正在检查<code class="fe lo lp lq lr b">templates/crm</code>中的<code class="fe lo lp lq lr b">index.html</code>文件，如上图所示。如果不是，这意味着<code class="fe lo lp lq lr b">HtmxResponseMiddleware</code>不知道<code class="fe lo lp lq lr b">client_relationship_manager</code>应用程序，你需要检查<code class="fe lo lp lq lr b">HTMX_APPS</code>的设置。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="4e0e" class="mq lt iq bd lu mr nw mt lx mu nx mw ma jw ny jx md jz nz ka mg kc oa kd mj na bi translated">结论</h1><p id="ba8a" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">后端已经准备好了。在本系列的第二部分中，我们将构建模板，并开始接触htmx。如果你想了解更多关于我们今天在这里使用的<code class="fe lo lp lq lr b">HtmxResponseMiddleware</code>的信息，我推荐你阅读我的第一篇文章。</p><p id="e5f7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">更新:</strong>让我们在<a class="ae ln" rel="noopener ugc nofollow" target="_blank" href="/build-a-simple-crm-with-django-and-htmx-project-setup-ea84f900e273?source=friends_link&amp;sk=3f45126adb16cd3a5a8d93b7b8c99bb3">第二部</a>完成这个app吧！</p><h1 id="9736" class="mq lt iq bd lu mr ms mt lx mu mv mw ma jw mx jx md jz my ka mg kc mz kd mj na bi translated"><strong class="ak">资源</strong></h1><ul class=""><li id="b462" class="nb nc iq kt b ku ml kx mm la on le oo li op lm ng nh ni nj bi translated"><a class="ae ln" rel="noopener ugc nofollow" target="_blank" href="/how-to-handle-full-page-reloads-with-django-and-htmx-a9a7ef2e4b1c?source=friends_link&amp;sk=db50c2a682e62dbdf53a3948049fa033"> HtmxResponseMiddleware </a></li><li id="3373" class="nb nc iq kt b ku nk kx nl la nm le nn li no lm ng nh ni nj bi translated"><a class="ae ln" href="https://docs.djangoproject.com/en/4.0/topics/http/urls/#url-namespaces" rel="noopener ugc nofollow" target="_blank"> Django URL名称空间</a></li><li id="f42e" class="nb nc iq kt b ku nk kx nl la nm le nn li no lm ng nh ni nj bi translated"><a class="ae ln" href="https://docs.djangoproject.com/en/4.0/topics/http/urls/#naming-url-patterns" rel="noopener ugc nofollow" target="_blank"> Django命名的URL模式</a></li><li id="7870" class="nb nc iq kt b ku nk kx nl la nm le nn li no lm ng nh ni nj bi translated"><a class="ae ln" href="https://docs.djangoproject.com/en/4.0/ref/forms/widgets/" rel="noopener ugc nofollow" target="_blank"> Django表单小部件</a></li></ul></div></div>    
</body>
</html>