<html>
<head>
<title>Injecting JavaScript in iOS WebViews</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS网络视图中注入JavaScript</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/injecting-javascript-in-ios-webviews-7bc664668bd2?source=collection_archive---------12-----------------------#2022-01-12">https://betterprogramming.pub/injecting-javascript-in-ios-webviews-7bc664668bd2?source=collection_archive---------12-----------------------#2022-01-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6e0d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">WKWebView的一个鲜为人知但超级强大的功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/102c1cb30983d08f36746eb141496d06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jdzXIP81k86WqH3AtJVNQA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://undraw.co/search" rel="noopener ugc nofollow" target="_blank">未绘制</a></p></figure><p id="9e83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用web视图显示一些频繁更新的内容，如FAQ，这是大多数iOS开发人员非常常用的策略。通过这样做，开发人员可以轻松更新web视图内容，而无需经过App Store审核流程。另一方面，用户将能够在不离开应用程序的情况下查看在线内容。</p><p id="a6d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这种策略时，我们可能会遇到一些非常常见的问题，如web视图内容的样式与应用程序的设计不匹配，或者内容在移动设备中不能正确缩放。</p><p id="b7f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，让我们通过使用一种叫做“<strong class="lb iu"> JavaScript注入</strong>”的技术来解决这两个问题。下面是您将从本文中学到的一些东西:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/ad1e73117b1bf621e3faa1ac73dd4033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I7yErQDNGgSqDDjs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用JavaScript注入在web视图中样式化HTML</p></figure><p id="e777" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看着有意思？让我们开始吧！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f748" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">为注入准备CSS和JavaScript</h1><p id="ec43" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">对于这篇文章，我们将对我之前准备的这个HTML进行样式化。为了设计HTML的样式，我们必须首先创建定义我们想要的样式的CSS。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="00a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设你有一些基本的CSS知识，上面的代码是不言自明的。但是，我想提醒您注意<code class="fe nc nd ne nf b">font-family</code>属性。请注意我是如何将其设置为<code class="fe nc nd ne nf b">-apple-system</code>的，这样web视图将使用iOS系统字体呈现HTML。</p><blockquote class="ng nh ni"><p id="7193" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated"><strong class="lb iu">亲提示:</strong></p><p id="9c8c" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated">如果您的样式需要长而复杂的CSS，建议从CSS文件中读取CSS。</p></blockquote><p id="71c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们编写一些JavaScript来加载我们刚刚编写的CSS。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4db5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，在将CSS与JavaScript结合之前，将CSS放入一个单独的liner中是很重要的，否则注入将不起作用。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1bf5" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">JavaScript注入</h1><p id="4d62" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这就是奇迹发生的地方！我们将使用<code class="fe nc nd ne nf b"><a class="ae ky" href="https://developer.apple.com/documentation/webkit/wkuserscript/1537750-init" rel="noopener ugc nofollow" target="_blank">WKUserScript</a></code>类将JavaScript注入到我们的web视图中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="22f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们使用刚刚创建的JavaScript初始化了<code class="fe nc nd ne nf b">WKUserScript</code>实例，并要求它在HTML文档完成加载后注入JavaScript(使用<code class="fe nc nd ne nf b">.atDocumentEnd</code>)。这非常重要，因为如果在此之前进行注入，JavaScript将无法运行。</p><p id="bf87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户脚本就绪后，我们可以继续将用户脚本加载到web视图中，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1062" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">缩放HTML内容</h1><p id="fe91" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在，如果我们继续加载我之前准备的HTML，</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="5fc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们会看到这样的情况:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/3153ff60a51b98694314d4965a5a39dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/0*xaNvBbgG_Xl5z6RP"/></div></figure><p id="8839" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发生这种情况的原因是我们的HTML缺少了<code class="fe nc nd ne nf b">&lt;meta&gt;</code>标签。因此，web视图不知道如何正确缩放HTML。这个问题的解决方案非常简单，我们所需要做的就是在HTML前添加下面的<code class="fe nc nd ne nf b">&lt;meta&gt;</code> <a class="ae ky" href="https://www.w3schools.com/css/css_rwd_viewport.asp" rel="noopener ugc nofollow" target="_blank">视窗</a>元素。</p><pre class="kj kk kl km gt no nf np nq aw nr bi"><span id="f79e" class="ns me it nf b gy nt nu l nv nw">&lt;meta name=\"viewport\" content=\"user-scalable=no, width=device-width\"&gt;</span></pre><p id="d48f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记住这一点，我们现在可以像这样更新示例代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="65ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！如果您尝试执行示例代码，您应该能够看到HTML在web视图中被很好地呈现。</p><p id="a0fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里获得完整的示例代码<a class="ae ky" href="https://gist.github.com/LeeKahSeng/d4fc890871e13627ccc511d2b227adef" rel="noopener ugc nofollow" target="_blank">并尝试一下。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4a45" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">包扎</h1><p id="23f9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">对HTML进行样式化只是JavaScript注入的用例之一。你还能想到其他什么用例？请在<a class="ae ky" href="https://twitter.com/Lee_Kah_Seng" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上与我分享你的想法，我真的很想听到你的声音！</p><p id="267f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div></div>    
</body>
</html>