<html>
<head>
<title>Mobile Test Automation Using AWS Device Farm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS设备群的移动测试自动化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/mobile-test-automation-using-aws-device-farm-6bcf825fa27d?source=collection_archive---------3-----------------------#2019-05-07">https://betterprogramming.pub/mobile-test-automation-using-aws-device-farm-6bcf825fa27d?source=collection_archive---------3-----------------------#2019-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6565" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用Java SDK将AWS设备群有效地集成到CI管道中。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/b9a52c59a3c5147e75af447b402b39ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*AVS6Rka9TxjkgtUZ.png"/></div></figure><p id="49d8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi lm translated">在我们的移动测试自动化之旅中，我们大多数人都会考虑迁移到云平台。其优势听起来很有希望:设备种类繁多，无需维护，伸缩灵活。现实稍微复杂一些，我们必须在向这些供应商购买计划之前了解我们的确切需求。虽然在某些情况下，在内部建立设备实验室可能是一种有效的解决方案，但云提供商是一种令人兴奋的有用工具，可以将任何移动测试自动化提升到一个新的水平。</p><p id="f6d7" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在本文中，我们描述了如何利用AWS Device Farm的公共云，以便我们可以轻松地集成到CI管道中。对于这个例子，我们使用Java、Cucumber和Appium，但是这些概念也适用于其他技术。</p><h1 id="13db" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">服务器端执行模型</h1><p id="fa36" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">当执行测试时，AWS(至少在他们的公共云中)使用一种我称之为<em class="ms">服务器端执行</em>的方法。这意味着测试代码完全在他们的基础设施上运行。另一种选择是像Browserstack或Saucelabs这样的提供商所使用的，测试代码在用户的机器上运行，称为<em class="ms">客户端执行，</em>，并通过web服务与云服务交互。一般来说，客户端执行更容易实现；如果您已经知道如何在本地执行测试，那么您需要做的配置更改是最小的。</p><p id="ff72" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">AWS的方法有点棘手，因为它需要几个额外的步骤，即打包和上传运行测试所需的所有东西到他们的服务器上。这带来了一些挑战和陷阱，我将在本文中介绍。</p><h1 id="4ed1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">通过web控制台执行测试</h1><p id="0a53" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">在AWS设备群上开始运行测试的最简单方法是通过他们的web控制台。如果您需要经常这样做，这将是一个乏味的过程(我们稍后将讨论如何使用他们的API)，但是浏览web控制台是我们熟悉这个过程中不同步骤的一个很好的方式。</p><p id="8d40" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">首先，让我们登录AWS并打开设备场控制面板:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mt"><img src="../Images/db16a6222eaf31588c5c0486e6195aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5zTaupz-C5RI18vuq7lkxg.png"/></div></div></figure><p id="d333" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然后我们创建一个新项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi my"><img src="../Images/d5c96f6d230f03a11c49bcf28547a860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_u16ZZdwVe3Na2lM7_7xdw.png"/></div></div></figure><p id="bd03" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">创建我们的第一次运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mz"><img src="../Images/d9d0fd10224ecaf96c5a0ee594b25dda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kEu1xnkkg-r0ELAICrL2iQ.png"/></div></div></figure><p id="edfe" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">由于我们正在测试一个原生Android应用程序(StackOverflow)，我们的第一步是上传它的<a class="ae na" href="https://apkpure.com/stackoverflow/apps.ali.stackoverflow/download" rel="noopener ugc nofollow" target="_blank"> APK文件</a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nb"><img src="../Images/463196e940f6a252d1e91033cd3508db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0d7SZJwr6D9lNdxsv4YoQ.png"/></div></div></figure><p id="0fe9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">接下来，我们需要选择测试的类型。我们使用<em class="ms"> Appium Java JUnit </em>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nc"><img src="../Images/43b9529f0d8d23eb3475196f2cfc8810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOOocOV2GgNMhiTQX1r41w.png"/></div></div></figure><p id="59f9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">使用Maven，我们可以按照文档中的步骤创建一个zip文件形式的测试包。不要被只支持Java 8的说法所迷惑。我们将在后面处理这个问题(当然用Java 12代替)。</p><p id="399d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这个演示中，我们使用了<a class="ae na" href="https://github.com/martinschneider/justtestlah" rel="noopener ugc nofollow" target="_blank"> JustTestLah！</a>使用Java、Cucumber和Appium测试框架(声明:我是作者😉).</p><p id="7a78" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您可以从这个链接上传测试包<a class="ae na" href="https://mega.nz/#!WVhwHKrY!3_lMWkLEXg8RKweqhokG2iLpvRALZizsriir_sydWFQ" rel="noopener ugc nofollow" target="_blank">，或者使用Maven自己构建演示(zip文件将在<code class="fe nd ne nf ng b">justtestlah-demos/target</code>中生成):</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="7377" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦你将zip上传到AWS，你将被询问是使用<em class="ms">标准环境</em>还是创建<a class="ae na" href="https://docs.aws.amazon.com/devicefarm/latest/developerguide/custom-test-environments.html" rel="noopener ugc nofollow" target="_blank"> <em class="ms">自定义环境</em> </a> <em class="ms">，</em>我们选择后者。测试规范是一个YAML文件，列出了在测试执行的各个阶段要执行的一组shell命令。这让我们对在AWS上执行测试的方式有了一些控制。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nj"><img src="../Images/f305f535af30cfd1eada26cb83c2b9ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hkgj2832jA2tkE_533-n8g.png"/></div></div></figure><p id="8ed4" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，用以下内容替换默认规范:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="aa11" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我将在本文的后面解释这个配置的细节，现在，让我们保存它并继续设备选择:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nk"><img src="../Images/3c2b709e9350c825efcd25952a3369c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uMgf4tSthK1pOUmxrRHVWQ.png"/></div></div></figure><p id="4826" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">AWS使用一个称为设备池的概念。每个测试执行将在池中的所有设备上运行所有的测试。我们只需要一台设备，因此我们用一个Google Pixel创建了一个新的设备池:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nl"><img src="../Images/f406731848c652a114d355f4f58e3528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GfrZyu6a1YbG7CK4KA8S5A.png"/></div></div></figure><p id="a4e9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">接下来，有一个步骤叫做<em class="ms">指定设备状态</em>，我们现在跳过它(保留默认值)。在最后一页，我们可以回顾这次跑步。让我们缩短超时时间，以免在出现问题时耗尽宝贵的设备时间:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nm"><img src="../Images/10ee00035962cb7ed2ec73a09d847950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pb_YzsXExPfgfJ8jw33gaw.png"/></div></div></figure><p id="2d62" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最后，我们可以触发测试执行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nn"><img src="../Images/37396eccb4099c557b896ab9428183e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l4zXdjVCl9OUOOkKnRk10g.png"/></div></div></figure><p id="6ff5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">你可以在仪表板上看到跑步。点击它并选择我们的测试设备(Google Pixel)以查看设备的实时日志和实时流(设置需要几分钟时间):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi no"><img src="../Images/9c23d2c193b055fe24c38e0d4ad02544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aO_dQGEdLWIZ9gfycjz7VA.png"/></div></div></figure><p id="1f03" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这是我们正在测试的场景:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="3cfa" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果一切顺利，您将在测试结果页面上收到一条成功消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi np"><img src="../Images/cf5707d5202e37fbba91ab4c597c5802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXX5DHYooOxpVNbEnF5r5Q.png"/></div></div></figure><p id="f5f6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">旁注:记录测试执行的持续时间。在计划您的测试执行时，您需要考虑设置和拆除设备的相当大的开销(以及来自执行测试规范和初始化WebDriver的更多开销)。由于这种开销，AWS通常更适合在单次执行中运行大型测试套件，而不是在多次运行中运行小型测试套件。在某种程度上，这适用于所有的云解决方案，但是这种开销对于不同的供应商是不同的，因此是一个重要的选择标准。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nq"><img src="../Images/9b283517000042e1b2898a71232df9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xps-GZnXpE6AgoUsDvFXrA.png"/></div></div></figure><h1 id="184c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">接下来呢？</h1><p id="f909" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">恭喜你！您成功地在AWS设备场上执行了第一次Appium测试。让我们来看看一些挑战，看看使用一个定制的测试规范是如何让我们的生活变得更容易的。然后，我们将展示如何使用他们的API来自动化安排测试的过程。</p><ol class=""><li id="f20a" class="nr ns it ks b kt ku kw kx kz nt ld nu lh nv ll nw nx ny nz bi translated"><strong class="ks iu">每次更改后重新上传测试包</strong></li></ol><p id="c854" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您可以重复使用先前上传到AWS设备场的测试包。如果有变化，您只需要重新打包并上传它们。这在理论上听起来没问题，但是，因为这些包包含了运行测试所必需的<em class="ms">一切</em>，不仅包括框架或其依赖关系的变化，还包括测试、测试数据或测试配置的变化。更改单个参数(例如，指定运行哪些测试)总是需要一个新的测试包。</p><p id="5e88" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">假设您的测试套件包含100个测试，您希望将它们分布在10个设备上，以减少总的执行时间。AWS和大多数其他云提供商不支持开箱即用。</p><p id="ff85" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在Device Farm上解决这个问题的简单方法是为每个测试子集创建10个测试包，每个测试包被配置为执行10个不同的测试。然而，这需要打包和上传多个大的、几乎相同的zip文件。现在假设下一次您想要将您的测试分布在20个设备上，或者您想要执行一组稍微不同的测试。您总是需要重新创建和上传新的测试包。</p><p id="f42b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这就是我们在引入定制环境之前第一次使用Device Farm的方式，这相当痛苦。不断构建和上传100多MB的zip文件会使CI管道变得更加麻烦。</p><h2 id="474f" class="oa lw it bd lx ob oc dn mb od oe dp mf kz of og mh ld oh oi mj lh oj ok ml ol bi translated">救援的定制环境</h2><p id="8b06" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">如果您再看一下上面的定制环境规范，您会看到我们如何利用这个特性来消除这个限制。<a class="ae na" href="http://www.utilities-online.info/base64/?save=f42c054b-5e0f-458e-9be9-2767aa9b7b27-base64" rel="noopener ugc nofollow" target="_blank"> base64编码信息</a>包括我们的测试配置。这允许我们通过上传一个相对较小的YAML文件(测试规范)来定制测试运行，而不是重新创建大得多的测试包。我们在创建测试规范的过程中对配置进行编码。当它被执行时，我们把它解码成一个文件，然后作为参数传递给执行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="66a2" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于少数几个参数来说，这可能是多余的，但是对于一组更大的配置值来说，base64编码的字符串被证明是一种非常健壮和优雅的方式(它也使我们免去了在YAML中转义特殊字符的麻烦)。</p><p id="ea14" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><a class="ae na" href="https://github.com/martinschneider/justtestlah" rel="noopener ugc nofollow" target="_blank"> JustTestLah！</a>使用Cucumber，因此，例如，我们可以通过传递单独的Cucumber标记来运行不同的场景:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="9d0f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">或者</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="1045" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于每一次运行，测试包可以是相同的，只有测试规范发生了变化。</p><h2 id="78fa" class="oa lw it bd lx ob oc dn mb od oe dp mf kz of og mh ld oh oi mj lh oj ok ml ol bi translated">进一步的改进</h2><p id="8475" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">我们可以进一步采用这种方法，完全消除对测试包的需求。相反，我们配置定制环境，从外部来源获取必要的代码和配置，并完全在AWS实例上构建它。</p><p id="19f5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这允许我们将测试代码与框架代码分开。后者应该相当稳定，只有测试本身会更频繁地变化(我们在测试规范执行期间获取它们)。如果没有对测试规范的巧妙使用，这样的场景将很难实现。</p><p id="1260" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu"> 2。控制执行环境</strong></p><p id="5228" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果您在您的基础设施上执行测试，您可以完全控制您所使用的工具及其版本。有了AWS Device Farm，就没那么简单了。</p><p id="e7e3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">默认环境仍然使用Java 8(比当前的JDK 12版本落后四个主要版本)。其他库可能有类似的问题，但是对于Java，有一个简单的修复方法，可以通过在环境配置中添加几行代码来下载和安装:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="0e78" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">但是，这是一种变通方法，而不是解决方案。从执行开始起，您就为设备的分钟数付费，从长远来看，测试规范中任何额外的、耗时的步骤都会增加。</p><h1 id="cdd5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">通过API执行测试</h1><p id="fe3e" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">现在我们已经完成了手动创建测试执行的步骤，让我们看看如何使用<em class="ms">优秀的</em> AWS Java SDK(也有其他编程语言的SDK)来自动化这个过程。</p><p id="7aee" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为此，您需要<a class="ae na" href="https://docs.aws.amazon.com/devicefarm/latest/developerguide/setting-up.html" rel="noopener ugc nofollow" target="_blank">创建一个能够访问设备群</a>的AWS用户，并且<a class="ae na" href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys" rel="noopener ugc nofollow" target="_blank">生成一个访问密钥和一个秘密密钥</a>。我建议也设置<a class="ae na" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>，并通过调用以下命令进行配置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="67eb" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这将要求您提供之前生成的访问密钥和秘密密钥。作为区域，设置<code class="fe nd ne nf ng b">us-west-2</code>。您的密钥将存储在您的用户家中(在<code class="fe nd ne nf ng b">~/.aws/credentials</code>下), SDK中使用的默认凭证提供者将从那里获取它们。注意<a class="ae na" href="https://github.com/awslabs/git-secrets" rel="noopener ugc nofollow" target="_blank">让它们尽可能远离你的源代码</a>。</p><p id="01d3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">完成后，让我们来看看一些JAVA代码。完整的源代码可以在<a class="ae na" href="https://github.com/martinschneider/justtestlah" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。对于这个演示，我们从JUnit runner类内部调用AWS(有趣的部分在<code class="fe nd ne nf ng b">run</code>方法内部)。请注意，我们使用一个称为设备过滤器的概念来确定要使用的测试设备，而不是设备池。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="39dd" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，即使测试在AWS的基础设施上运行，我们也可以将它们包装在本地JUnit执行中(有一些限制)，并以与本地Appium测试相同的方式执行它们，或者使用云提供商在客户端执行。</p><p id="ca3f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你拉<a class="ae na" href="https://github.com/martinschneider/justtestlah" rel="noopener ugc nofollow" target="_blank"> JustTestLah！</a>并通过调用<code class="fe nd ne nf ng b">mvn install -DskipTests=true</code>将其安装到您的本地Maven存储库中。您可以通过调用以下命令来触发我们之前通过web控制台安排的相同测试:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="499e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您需要在<code class="fe nd ne nf ng b">stackoverflow_aws.properties</code>中设置的唯一值是您的设备农场项目的ARN (Amazon资源名称)。使用AWS CLI可以很容易地找到这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="de13" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">请注意，到<code class="fe nd ne nf ng b">justtestlah.properties</code>的路径必须是绝对的(请随意贡献给<a class="ae na" href="https://github.com/martinschneider/justtestlah" rel="noopener ugc nofollow" target="_blank"> JustTestLah！</a>改善这一点)。您可以在<code class="fe nd ne nf ng b">justtestlah-demos/demos</code>下找到演示配置。使用一个符号链接<code class="fe nd ne nf ng b">ln -s justtestlah-demos/demos /demos</code>所有的命令都如图所示工作。或者，根据需要修改路径。</p><p id="bda3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">通过在属性文件中指定现有应用程序包或测试包的ARN，您可以轻松跳过上传新的应用程序包或测试包:</p><pre class="kj kk kl km gt om ng on oo aw op bi"><span id="27f0" class="oa lw it ng b gy oq or l os ot">cloudprovider=aws<br/>aws.projectArn=xxx<br/>aws.appPackageArn=yyy<br/>aws.testPackageArn=zzz</span></pre><p id="8e56" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果您想在Browserstack上运行相同的测试，您只需传递一个不同的配置(在<code class="fe nd ne nf ng b">stackoverflow_browserstack.properties</code>中设置您的Browserstack电子邮件和访问密钥):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="b374" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于本地执行(确保Appium正在运行，并且您至少有一部连接的Android手机或运行模拟器)，您可以调用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="a497" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如您所见，使用这种技术，执行测试的云提供商只不过是一个配置值。您可以在本地执行、AWS设备场和Browserstack之间无缝切换。封装的下一个层次将是跨多个平台维护不同的设备，并让框架处理所有其他事情，即，为每个测试选择能够提供所请求的设备(并且能够最快完成)的云提供商。</p><p id="8bda" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你对这种设置有任何经验或者想尝试一下<a class="ae na" href="mailto:mart.schneider@gmail.com" rel="noopener ugc nofollow" target="_blank">，请给我写信</a>。</p><h1 id="d828" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">配置</h1><p id="b3fb" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">除了设备过滤器，您还可以为AWS测试执行定义一些额外的配置(这些是我们在web控制台上的<em class="ms">指定设备状态</em>期间跳过的设置):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="2608" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Maven集成</h1><p id="e34f" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">对于集成AWS Device Farm的稍微不同的方式(但使用相同的Java SDK)，您可以看看我的<a class="ae na" href="https://github.com/martinschneider/aws-devicefarm-maven-plugin" rel="noopener ugc nofollow" target="_blank"> Maven插件</a>。它提供了每个步骤的目标(上传应用程序包、上传测试包、计划运行等)。)允许您将它们分开。例如，您可以在每次有新版本时上传一个新的应用程序包，并在每次测试代码发生变化时上传一个新的测试包。然后，测试执行本身可以独立于这两者，只需重用最新的(或任何特定的)应用程序和测试包。</p><h1 id="87c9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Jenkins插件</h1><p id="7a19" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">AWS Device Farm 也有一个<a class="ae na" href="https://docs.aws.amazon.com/devicefarm/latest/developerguide/continuous-integration-jenkins-plugin.html" rel="noopener ugc nofollow" target="_blank"> Jenkins插件，但是它没有本文描述的解决方案灵活。</a></p><h1 id="a68b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">摘要</h1><p id="baa9" class="pw-post-body-paragraph kq kr it ks b kt mn ju kv kw mo jx ky kz mp lb lc ld mq lf lg lh mr lj lk ll im bi translated">在这篇文章中，我们展示了一个PoC风格的演示，展示了如何在AWS Device Farm上运行测试，其方式与在本地或在Browserstack等客户端执行平台上运行测试几乎相同。让您的测试在AWS Device Farm上运行，特别是以有效的方式将它们集成到构建过程中，这并不是一个简单的过程(除了最基本的需求之外)，我希望这些例子可以帮助面临类似挑战的其他人。</p><p id="3635" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦事情开始运行，AWS就是一个可靠的移动自动化云提供商，因此坚持下去并根据您的需求定制东西是值得的。</p><p id="332d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果您有任何问题或意见，请随时<a class="ae na" href="mailto:mart.schneider@gmail.com" rel="noopener ugc nofollow" target="_blank">联系我</a>。</p></div></div>    
</body>
</html>