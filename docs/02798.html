<html>
<head>
<title>How I Build Robust, Scalable Go Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何构建健壮、可伸缩的Go应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-build-robust-scalable-go-applications-192a0df32d1?source=collection_archive---------5-----------------------#2020-01-02">https://betterprogramming.pub/how-i-build-robust-scalable-go-applications-192a0df32d1?source=collection_archive---------5-----------------------#2020-01-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="df2e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我如何使用接口来保持我的Go应用程序模块化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1b34754ea5a6384e570ae13f873b1e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oB5vkmczZrrsqUDIvWni7Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构建经得起时间考验的代码——照片由<a class="ae ky" href="https://unsplash.com/@cedericx?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Cederic X </a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="2775" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设客户要求您在<a class="ae ky" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go </a>中创建一个后端应用程序。在这个场景中，客户端只有一个请求:他希望能够存储和查询用户。</p><p id="b539" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将展示如何建立这样一个项目。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5489" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">仓库</h1><p id="7fb9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在Go中，我通常为资源创建存储库。存储库负责保存和检索资源。在这种情况下，资源将是一个用户对象。</p><p id="4e56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我创建了一个<code class="fe mz na nb nc b">userrepo</code>包和一个文件<code class="fe mz na nb nc b">api.go</code>。API文件将保存所有导出的函数。</p><p id="0c76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，就有了一个定义其他包如何与<code class="fe mz na nb nc b">userrepo</code>包交互的中心位置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="cf86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我定义了<code class="fe mz na nb nc b">UserRepository</code>接口。目前，我们只有两个简单的方法，一个用于存储用户，一个用于查找用户。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="175c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">履行</h1><p id="5d54" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我已经定义了一个接口，现在是时候实现这个接口了。让我们从一个<code class="fe mz na nb nc b">mockUserRepo</code>实现开始。</p><p id="63a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">顾名思义，这个除了<em class="nf">模仿</em>的所有功能之外什么也不会做。</p><p id="f0cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在<code class="fe mz na nb nc b">userrepo</code>包中创建了一个文件<code class="fe mz na nb nc b">mock.go</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="2179" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">mockUserRepo</code>实现了<code class="fe mz na nb nc b">UserRepository</code>接口，对于每个函数，它只打印一条消息。</p><p id="a313" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们回到<code class="fe mz na nb nc b">api.go</code>文件，添加一个<code class="fe mz na nb nc b">New()</code>函数。这将返回一个<code class="fe mz na nb nc b">UserRepository</code>接口的实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ce11" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么要使用接口？</h1><p id="cf2c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">因为我们已经定义了一个<code class="fe mz na nb nc b">UserRepository</code>接口，所以我们可以有多个实现。</p><p id="a6d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很久以前，当我刚开始软件开发时，我总是在看界面时挠头，心想:“那又怎样，我只需要一个实现。”</p><p id="3180" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于小型的个人项目来说，这可能是真的，但是在更大的真实世界的应用程序中，您通常有多个实现。</p><p id="a787" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您可以添加一个连接到Google云数据库的<code class="fe mz na nb nc b">cloudUserRepository</code>。</p><p id="52c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在生产环境中使用它是有意义的。但是，在您的本地环境中，添加SQLite数据库可能会更容易。</p><p id="6320" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过创建一个实现<code class="fe mz na nb nc b">UserRepository</code>接口的<code class="fe mz na nb nc b">sqliteUserRepository</code>,您可以轻松地完成这个任务，而不必重写很大一部分代码。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="85a2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一个例子</h1><p id="3fe3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">好的，我将展示一个例子来让你相信界面真的很棒。</p><p id="42a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在<code class="fe mz na nb nc b">userrepo</code>包中创建一个<code class="fe mz na nb nc b">sqlite.go</code>文件。这个文件将包含<code class="fe mz na nb nc b">UserRepository</code>包的SQLite实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="24af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，让我们在<code class="fe mz na nb nc b">userrepo</code>包中创建一个<code class="fe mz na nb nc b">cloud.go</code>文件，它将包含Google Cloud实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="43b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，现在我只是打印一条调试消息，实现实际的接口超出了本文的范围。</p><p id="d511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我更新了<code class="fe mz na nb nc b">api.go</code>文件的<code class="fe mz na nb nc b">New()</code>函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="430e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将环境传递给<code class="fe mz na nb nc b">New()</code>函数，它将基于这个环境返回<code class="fe mz na nb nc b">UserRepository</code>的正确实现——太棒了！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c2ae" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将这一切结合在一起</h1><p id="bedd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们创建主程序。</p><p id="cf4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在新的包<code class="fe mz na nb nc b">main</code>中，我创建了一个<code class="fe mz na nb nc b">run.go</code>文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="2037" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我使用<code class="fe mz na nb nc b">userRepo.New()</code>函数来获得基于环境的<code class="fe mz na nb nc b">UserRepository</code>的实现。</p><p id="38e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我需要在一个环境中交换用户库，我只需要改变<code class="fe mz na nb nc b">userrepo.New()</code>函数，这太棒了。</p><p id="de15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过运行以下命令来测试它:</p><pre class="kj kk kl km gt ng nc nh ni aw nj bi"><span id="d92c" class="nk md it nc b gy nl nm l nn no">go run main/run.go</span></pre><p id="7c49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它输出以下内容:</p><pre class="kj kk kl km gt ng nc nh ni aw nj bi"><span id="a0a6" class="nk md it nc b gy nl nm l nn no">cloudUserRepo: mocking the StoreUser func</span></pre><p id="b80d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，创建了<code class="fe mz na nb nc b">UserRepository</code>接口的正确实现。</p><p id="4a40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个我经常使用的设计模式，并且被证明非常有用。希望你和我一样发现这个模式很棒！</p><p id="155f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在<a class="ae ky" href="https://github.com/Dirk94/go-interface-example" rel="noopener ugc nofollow" target="_blank"> GitHub上找到这个库。</a></p></div></div>    
</body>
</html>