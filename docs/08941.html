<html>
<head>
<title>How to Implement Filtering, Sorting, and Pagination in Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Flask中实现过滤、排序和分页</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-implement-filtering-sorting-and-pagination-in-flask-c4def1ca004a?source=collection_archive---------1-----------------------#2021-06-29">https://betterprogramming.pub/how-to-implement-filtering-sorting-and-pagination-in-flask-c4def1ca004a?source=collection_archive---------1-----------------------#2021-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="881f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建Python web应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/400bf6882d5a6146059be8375a05d185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpyrgqwMjfclV2oN1U2VIA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@lukechesser?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卢克·切瑟</a>在<a class="ae ky" href="https://unsplash.com/s/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="f5e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据是当今世界的一个基本概念。无论你是在网上搜索还是使用你最喜欢的应用程序，你每一秒都在消耗数据。这些数据必须采用正确的格式才能有意义。在本教程中，我们将了解如何使用Flask微框架在Python中执行数据过滤、排序和分页。</p><h1 id="4fb4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">什么是烧瓶？</strong></h1><p id="10fb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Flask是用<a class="ae ky" href="https://en.wikipedia.org/wiki/Python_(programming_language)" rel="noopener ugc nofollow" target="_blank"> Python </a>编写的微框架。由于它不需要特殊的工具或库，所以设置起来很简单。它没有数据库抽象层、表单验证或其他组件。Flask的目标是保持核心简单但可扩展。</p><h1 id="7779" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">创建一个基本的烧瓶应用程序</strong></h1><p id="3731" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将从创建一个电影API服务器开始。API服务器将能够执行以下操作:</p><ul class=""><li id="8c67" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">基于搜索词从服务器检索记录</li><li id="5069" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">每页最多分页五条记录</li><li id="0378" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">根据最佳评级对电影进行分类</li></ul><p id="9aef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建项目目录并设置虚拟环境。您必须安装了<code class="fe ng nh ni nj b">virtualenv</code>。虚拟环境有助于分离项目依赖性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="e67c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">激活虚拟环境。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7f0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在电影文件夹中，创建一个文件<code class="fe ng nh ni nj b">app.py</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="2d38" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">使用Pip </strong>安装烧瓶</h1><p id="bbdc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">运行以下命令安装Flask:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="1454" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切顺利，您应该会看到以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7539" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还需要安装Flask SQLAChemy。根据文件:</p><blockquote class="nm nn no"><p id="1f2a" class="kz la np lb b lc ld ju le lf lg jx lh nq lj lk ll nr ln lo lp ns lr ls lt lu im bi translated">Flask-SQLAlchemy是对<a class="ae ky" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a>的扩展，为您的应用程序增加了对<a class="ae ky" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank"> SQLAlchemy </a>的支持。它旨在通过提供有用的缺省值和额外的帮助器来简化SQLAlchemy与Flask的使用，从而更容易完成常见的任务。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="2c6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们在app.py文件中配置一个基本的flask应用程序。首先，导入Flask并实例化一个Flask app，如下图所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="308d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">将应用程序连接到数据库</strong></h1><p id="4335" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，让我们用pip安装<code class="fe ng nh ni nj b">psycopg2</code>。<code class="fe ng nh ni nj b">psycopg2</code>是Python的数据库适配器，它允许我们将数据库连接到我们的程序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="e9b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是向我们的应用程序添加数据库配置。但是首先，使用PostgreSQL创建一个本地数据库。您应该已经安装了PostgreSQL。如果您还没有，请查看这些适用于各种平台的安装指南<a class="ae ky" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c577" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个数据库。</p><p id="cd13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PostgreSQL自带一个名为<code class="fe ng nh ni nj b">psql</code>的命令行客户端程序，用于登录服务器。</p><p id="2e08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录PostgreSQL并创建一个新数据库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="73a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在database musica上创建一个具有密码权限的用户:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="c2c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到app.py，导入顶部的<code class="fe ng nh ni nj b">flasksqlachemy</code>库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="298f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，使用<code class="fe ng nh ni nj b">SQLAchemy</code>类将一个数据库实例链接到我们的应用程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="559c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">db</code>允许我们为数据库创建模型类，并在数据库上执行事务。</p><p id="6348" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们通过设置一个配置变量从flask应用程序连接到我们的数据库。Flask期望一个数据库URI作为它的配置变量。</p><p id="bbd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据库URI采用以下格式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/f3ebb40958fa5deefe3588ee0845b753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*caR3HfF8-N8C0gBeDUFDvA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">URI数据库</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="d347" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">创建数据库表</strong></h1><p id="00d0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们的电影应用程序将定义一个保存电影信息的电影表，比如名称、类型和分级。</p><p id="7cae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续创建我们的模型类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="5a35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ng nh ni nj b">db.create_all()</code>如果我们运行flask应用程序，检测模型并为它们创建表格。让我们运行应用程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="9353" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，转到<code class="fe ng nh ni nj b">PostgreSQL</code>客户端，您应该看到已经创建了电影表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7802" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在上面看到的，已经创建了电影表，现在我们可以与数据库进行交互了。</p><p id="8732" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在表格中添加一些数据。您可以使用交互式shell提示符添加数据，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="b8e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先启用<code class="fe ng nh ni nj b">python3</code>交互式shell提示符，然后从app文件导入<code class="fe ng nh ni nj b">db</code>实例和<code class="fe ng nh ni nj b">Movie</code>模型。</p><p id="5217" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后继续创建一个电影实例，将其添加到<code class="fe ng nh ni nj b">db</code>会话中，并提交到数据库中。</p><h1 id="a46c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">分页</strong></h1><p id="a4ec" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">不建议一次发送大量数据，因为这会降低客户端的速度，因为它必须等待服务器检索所有数据。解决这个问题的最好方法是使用请求参数对数据进行分页，并且只向用户发送他们需要的信息——即成批的信息。</p><p id="6487" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将首先检索数据库中的所有电影，然后分页并只显示几个条目。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="c739" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码显示了一个简单的路径，它获取数据库中的所有电影，并以JSON格式显示它们。现在，如果您运行服务器并导航到<a class="ae ky" href="http://127.0.0.1:5000/movies" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:5000/movies</a>，您应该会看到页面总共显示了22部电影:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/5ed8ab4423195134ca5cc02abaa0feea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLiZfmdKQEY9CRu-XyP3yw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">所有电影</p></figure><p id="2b05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管我们数据库中的电影数量并不多，但假设我们的数据库中有一千多部电影，在这种情况下，检索所有数据会降低服务器的速度，导致用户体验不佳。</p><p id="2322" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决这个问题的方法是对电影列表进行分页。幸运的是，Flask附带了<code class="fe ng nh ni nj b">paginate()</code>查询方法，我们将使用它来检索有限的电影。</p><p id="8c48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分页查询的语法如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="5365" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它从<code class="fe ng nh ni nj b">page</code>返回<code class="fe ng nh ni nj b">per_page</code>个项目。</p><p id="30d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在flask应用程序中实现分页。我们希望每页只检索五个条目。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="30fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/d86e4ed57dbc4353fd4ce1a9a65c288a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HP04-gRhOmCbWe3jVFvQKg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分页电影</p></figure><h1 id="c473" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">过滤</strong></h1><p id="f432" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">过滤允许用户通过传递某些查询参数只获取他们需要的信息。</p><p id="f59d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们想要获得数据库中所有的恐怖电影。让我们来实现它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="a1a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们使用属性<code class="fe ng nh ni nj b">ilike</code>来确保查询不区分大小写，也就是说,“horror”和“HORROR”都会给出正确的结果。</p><p id="595a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/c6541e1af8a28dab2adee8d9733f3210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNmmf8jARpmBiFKJy15ECw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">烧瓶中过滤器</p></figure><h1 id="5139" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">排序</strong></h1><p id="1db1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">排序是将查询数据整理成特定数据以便您可以更有效地分析它的过程。您可以在以下位置对数据进行排序:</p><ul class=""><li id="639a" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">字母顺序</li><li id="3e99" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">流水号</li><li id="6965" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">如年份等类别</li></ul><p id="1469" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们根据高评分的电影对我们的电影进行排序。以下代码显示了五部收视率最高的电影的列表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="4e32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是排名前五的电影的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/a32cda0e03debb96aaaaae33654abf4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wALOwzUHnSHRb4oxx77XQw.png"/></div></div></figure><h1 id="e356" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">结论</strong></h1><p id="4668" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">本教程介绍了如何制作一个连接到PostgreSQL数据库的简单Flask应用程序。它还介绍了分页、过滤和排序的概念。我希望你喜欢它！</p><blockquote class="nm nn no"><p id="8f70" class="kz la np lb b lc ld ju le lf lg jx lh nq lj lk ll nr ln lo lp ns lr ls lt lu im bi translated">嘿，朋友，如果你想阅读更多的教程，可以考虑注册成为一名灵媒来支持我的工作。每月只需5美元，你就可以无限制地使用Medium。</p></blockquote></div></div>    
</body>
</html>