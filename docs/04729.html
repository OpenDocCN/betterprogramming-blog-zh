<html>
<head>
<title>A Powerful and Practical Way to Load Test APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加载测试API的强大而实用的方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-powerful-and-practical-way-to-load-test-apis-48128ecf1bd?source=collection_archive---------10-----------------------#2020-05-04">https://betterprogramming.pub/a-powerful-and-practical-way-to-load-test-apis-48128ecf1bd?source=collection_archive---------10-----------------------#2020-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3714" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Apache JMeter、Taurus和您最喜欢的DevOps平台</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6ff7d21fc385cf89541a6a5b4013d60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xr-U__7B27EHSoBP5trAEQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">埃里克·麦克林在<a class="ae ky" href="https://unsplash.com/s/photos/gauge?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="751e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据维基百科，</p><blockquote class="lv lw lx"><p id="de64" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“持续测试是执行<a class="ae ky" href="https://en.wikipedia.org/wiki/Test_automation" rel="noopener ugc nofollow" target="_blank">自动化测试</a>的过程，作为软件交付管道的一部分，以获得与软件发布候选相关的业务风险的即时反馈。”</p></blockquote><p id="8fe8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我之前的<a class="ae ky" href="https://medium.com/better-programming/automate-your-api-testing-with-ci-pipelines-ee6b8d133114" rel="noopener">文章</a>中，我写了如何使用Postman/Newman执行API的功能测试，并将其集成到DevOps平台中。自动化测试的另一个重要方面是负载测试，它帮助我们分析应用程序在压力下的行为。</p><p id="c41f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">市场上有各种工具可以帮助我们执行负载测试。<a class="ae ky" href="https://jmeter.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache JMeter </a>是这个领域中使用最广泛的开源工具之一。</p><p id="6243" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文期望您对REST APIs、Apache JMeter和持续测试有一个基本的了解。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="2db1" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">阿帕奇JMeter</h1><p id="8bb4" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Apache JMeter帮助我们在各种应用程序上执行负载测试，例如:</p><ul class=""><li id="f11e" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">SOAP/REST API</li><li id="cf9e" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">文件传送协议</li><li id="10c6" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">通过JDBC的数据库</li><li id="63a4" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">轻量级目录访问协议</li><li id="6520" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">通过JMS的面向消息的中间件(MOM)</li><li id="d21a" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">邮件— SMTP、POP3和IMAP</li><li id="d273" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">本机命令或shell脚本</li><li id="518c" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">传输控制协议（Transmission Control Protocol）</li><li id="fd9f" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">Java对象</li></ul><p id="9a12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它为我们提供了一个很好的GUI，可以用来创建测试计划。它还为我们提供了一个命令行工具，帮助我们将负载测试作为一个无头流程来运行。这个特性帮助我们将JMeter集成到各种自动化工具中。</p><p id="c43d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我使用了一个非常简单的来自dummy.restapiexample.com的REST API。</p><p id="b6c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用JMeter，我将在Get All Employees API上运行负载测试。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="7dcd" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">准备并执行测试计划</h1><p id="0fa5" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">使用JMeter GUI，您可以很容易地创建一个调用API的测试计划，并准备一个总结报告，如下面的屏幕截图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/bc032d48352b336560909a011d54e68e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCCFpreNulbJLIDJryw85w.png"/></div></div></figure><p id="7009" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行之后，您可以在摘要报告部分检查结果，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/024a4b493da3cf0c867f2e1a26f70d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_jCqcm8i2vSNe4F6Wlf1Vw.png"/></div></div></figure><p id="98e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得详细的报告，您可以使用JMeter命令行工具运行测试计划:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="15b0" class="ob mk it nx b gy oc od l oe of">jmeter -n -t APITestPlan.jmx -l result.txt -e -o reports/</span></pre><p id="076b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的<code class="fe og oh oi nx b">APITestPlan.jmx</code>是我在上一步中创建的测试计划。<code class="fe og oh oi nx b">result.txt</code>是存储测试结果的文件，<code class="fe og oh oi nx b">reports</code>是创建HTML报告的文件夹。如果你打开<code class="fe og oh oi nx b">reports/index.html</code>页面，你会看到非常直观的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/7213d5fe4b8aa4db088d7aa5e9389802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WubaRJCmg8CxQ6GKdsh2_g.png"/></div></div></figure><p id="591a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以根据业务需求增加测试的复杂性。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="0e5f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">金牛星座</h1><p id="91ee" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Taurus是一个开源自动化框架，用于运行各种开源负载测试工具和功能测试工具。对于常规的自动化测试运行，您只需要坚持使用Apache JMeter。但是如果您计划进行连续测试，那么您需要使用像Taurus这样的工具来运行负载测试，并以一种通用的格式生成结果，如JUnit results。</p><p id="43f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装金牛座很容易。可以在<a class="ae ky" href="https://gettaurus.org/install/Installation/" rel="noopener ugc nofollow" target="_blank">安装页面</a>查看详情。</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="de05" class="ob mk it nx b gy oc od l oe of">pip install --upgrade pip wheel<br/>pip install bzt</span></pre><p id="acd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完成后，您需要创建一个配置文件<code class="fe og oh oi nx b">taurus-config.yml</code>，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/6724b7c1e4decee9951ea05279b06dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ERv2DmEbb0f7eBURn9sB_Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://gist.github.com/deshpandetanmay/436cf345667057ad5aead351a03b76d1" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/deshpendanmay/436 cf 345667057 ad 5 aead 351 a 03 b 76d 1</a></p></figure><p id="5f3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的脚本中，您需要给出JMeter测试计划的路径。这里您需要JUnit格式的报告，这样您就可以使用测试结果并将它们上传到DevOps平台。金牛座还提供其他报告选项<a class="ae ky" href="https://gettaurus.org/kb/Reporting/" rel="noopener ugc nofollow" target="_blank">和</a>，您可能想探索一下。</p><p id="295a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要检查一切是否正常，您可以运行Taurus命令行，如下所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="e227" class="ob mk it nx b gy oc od l oe of">bzt taurus-config.yml</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/66158238992f074dc9ef79a6f746037f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vrFqW8tXlc-as_m2mt5tFA.png"/></div></div></figure><p id="ff7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行后，您将能够在命令行上看到详细的报告，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/77df10b434e0c92231347831737b0df1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEzYYBSNirQTwT8GvTH7zA.png"/></div></div></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="f415" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">与Azure DevOps集成</h1><p id="8d98" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">既然您已经能够在您的PC/笔记本电脑上执行测试，那么是时候将这些集成到持续测试管道中了。</p><p id="227e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，您需要将Taurus配置文件以及Apache JMeter测试计划文件提交给Git repo。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/7cfe648b1401907ae366fe07ce91d95c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JPN-69wBEzKwvYQGRZHFxQ.png"/></div></div></figure><p id="e5f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您需要创建一个管道，它由以下步骤组成:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/a51f86bb16e867fcc3cee5f481a0a5c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*laDPEvgvY50gNcbjo25p5g.png"/></div></div></figure><p id="75b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我使用Azure DevOps托管代理。如果您使用自己的代理，那么您不需要在每个管道运行时安装先决条件。</p><ol class=""><li id="5bda" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu op nm nn no bi translated">使用Python-在此步骤中，您告诉代理我们需要使用Python 3.x。</li><li id="39c5" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu op nm nn no bi translated">安装工具-在这一步中，您将安装对安装其他工具有用的Python工具。</li></ol><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="4265" class="ob mk it nx b gy oc od l oe of">python -m pip install --upgrade pip setuptools wheel</span></pre><p id="d1ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.安装BZT——在这一步中，您将安装Taurus工具。</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="640c" class="ob mk it nx b gy oc od l oe of">pip install bzt</span></pre><p id="df7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.运行负载测试—在这一步中，您将运行实际的负载测试并收集结果。</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="7231" class="ob mk it nx b gy oc od l oe of">bzt loadtests/taurus-config.yml</span></pre><p id="8bd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果运行成功，步骤4将生成一个JUnit格式的XML文件。</p><p id="154c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，如果还没有安装，Taurus会下载Apache JMeter二进制文件。</p><p id="8dba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.发布测试结果—在这一步，您将测试结果发布到Azure DevOps测试计划。这里您需要给出用于以JUnit格式记录结果的文件名。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="2d1e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">运行管道</h1><p id="ce08" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">完成上述步骤后，您需要运行管道。在成功执行时，你会得到管道的结果，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/125da9f217399d38dcb0b0ff8c9a4b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B64odlqtXEnTWCccAdL3vg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/2ef91d5894c15cd37c173c0390157f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Twa9-EfLUoHCwTQNMhZsOA.png"/></div></div></figure><p id="56cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为最后一步的结果，测试结果也将发布在Azure DevOps测试计划中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/48e1035cfe3aff2070db44f80c5e836f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mNitgwCQUKgJz7SgGbAXIQ.png"/></div></div></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="fe1d" class="ob mk it nx b gy oc od l oe of">Hey, if you enjoyed this story, check out <a class="ae ky" href="https://deshpandetanmay.medium.com/membership" rel="noopener">Medium Membership</a>! Just $5/month!</span><span id="f0ce" class="ob mk it nx b gy ot od l oe of"><em class="ly">Your membership fee directly supports me and other writers you read. You’ll also get full access to every story on Medium.</em></span></pre></div></div>    
</body>
</html>