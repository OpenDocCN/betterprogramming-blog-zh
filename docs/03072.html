<html>
<head>
<title>Build an OpenLDAP Docker Image That’s Populated With Users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个由用户填充的OpenLDAP Docker映像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ldap-docker-image-with-populated-users-3a5b4d090aa4?source=collection_archive---------0-----------------------#2020-01-19">https://betterprogramming.pub/ldap-docker-image-with-populated-users-3a5b4d090aa4?source=collection_archive---------0-----------------------#2020-01-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0b15" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">具有预定义对象资源的Docker图像</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b8a05de75030b3200a5db700d61780f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dpyQB-zmtewrJCqf"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@hishahadat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沙哈达特·拉赫曼</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b21c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在过去的几个月里，我一直在使用一些服务和应用程序，这些服务和应用程序通过LDAP服务器对用户进行身份验证。这意味着在我的本地机器上多次部署LDAP服务器，并且每次都填充用户。我需要部署LDAP服务器来登录并在我的开发环境中使用我的服务。</p><blockquote class="lv lw lx"><p id="927f" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">LDAP是一种轻量级目录访问协议，它是一种成熟、灵活、支持良好的基于标准的机制，用于与目录服务器进行交互。它通常用于鉴定和存储有关用户、组和应用程序的信息，但是LDAP目录服务器是一个相当通用的数据存储，可以用于各种各样的应用程序。</p><p id="64bf" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><a class="ae ky" href="https://ldap.com/" rel="noopener ugc nofollow" target="_blank">https://ldap.com/</a></p></blockquote><p id="a285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">LDAP协议有几种常用的实现，包括ApacheDS、OpenLDAP、OpenDJ和Active Directory。</p><p id="254d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">填充数据和用户是一个耗时的过程。它还取决于需要填充的数据量。但是，即使是非常简单的数据，也不得不多次手动做同样的事情，这促使我自动化这个过程，从而减少完成工作所需的工作量。</p><p id="6127" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我开始寻找一种方法来帮助我用填充的数据部署LDAP服务器。经过一番挖掘，我发现LDAP Docker映像<code class="fe mc md me mf b"><a class="ae ky" href="https://github.com/osixia/docker-openldap" rel="noopener ugc nofollow" target="_blank">osixia/openldap</a></code>支持用现有的LDAP数据引导LDAP服务器。下面是使用docker映像<code class="fe mc md me mf b">osixia/openldap</code>实现<code class="fe mc md me mf b">LDAP</code>引导的步骤:</p><ul class=""><li id="f5c9" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">准备一个引导文件。创建一个引导文件<code class="fe mc md me mf b">ldif</code>，其中包含启动后需要导入到LDAP服务器的所有数据。</li><li id="6ea7" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">在自定义Docker映像<code class="fe mc md me mf b">/container/service/sldap/assets/config/bootstrap/ldif/</code>中的以下路径下添加引导文件。</li><li id="c20b" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">建立Docker形象。</li><li id="04ff" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">使用自定义Docker映像部署<code class="fe mc md me mf b">LDAP</code>服务器。</li></ul></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><div class="kj kk kl km gt nb"><a rel="noopener  ugc nofollow" target="_blank" href="/manage-github-permissions-with-ldap-7aa80d2bace7"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">使用LDAP管理GitHub权限</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">将LDAP数据同步到GitHub帐户以管理用户访问权限</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">better编程. pub</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ks nb"/></div></div></a></div><h1 id="dd6f" class="nq nr it bd ns nt nu nv nw nx ny nz oa jz ob ka oc kc od kd oe kf of kg og oh bi translated"><strong class="ak">引导文件的内容</strong></h1><p id="e9fd" class="pw-post-body-paragraph kz la it lb b lc oi ju le lf oj jx lh li ok lk ll lm ol lo lp lq om ls lt lu im bi translated">引导文件的内容可以包括任何有效的LDAP对象，例如，<code class="fe mc md me mf b">inetOrgPerson</code>、<code class="fe mc md me mf b">organizationalUnit</code>、<code class="fe mc md me mf b">groupOfUniqueNames</code>和<code class="fe mc md me mf b">groupOfNames</code>。为了简单起见，我将使用<code class="fe mc md me mf b">ldif</code>来说明我们如何定义LDAP用户和组。</p><p id="7aed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们将在LDAP服务器中拥有<code class="fe mc md me mf b">Users</code>和<code class="fe mc md me mf b">Groups</code>对象，所以将这些对象组织在不同的类别或单元中是有意义的。LDAP为此提供了一个名为<code class="fe mc md me mf b">organizationalUnit</code>的对象类型。</p><p id="d348" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码片段将在LDAP服务器中创建两个组织单元——一个用于用户，一个用于组(如果您需要更多的单元，您可以复制下面的代码并修改<code class="fe mc md me mf b">dn</code>和<code class="fe mc md me mf b">ou</code>字段以满足您的需要)。</p><p id="dbdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样重要的是，必须将<code class="fe mc md me mf b">changetype: add</code>作为每个条目的第二个属性，否则，引导过程将失败，并且<code class="fe mc md me mf b">LDAP server</code>将关闭(这适用于引导文件中的所有条目)。</p><pre class="kj kk kl km gt on mf oo op aw oq bi"><span id="bf6e" class="or nr it mf b gy os ot l ou ov">dn: ou=Groups,dc=shihadeh,dc=intern<br/>changetype: add<br/>objectclass: organizationalUnit<br/>ou: Groups</span><span id="bf5e" class="or nr it mf b gy ow ot l ou ov">dn: ou=Users,dc=shihadeh,dc=intern<br/>changetype: add<br/>objectclass: organizationalUnit<br/>ou: Users</span></pre><p id="2fa3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是开始定义<code class="fe mc md me mf b">LDAP</code>用户。下面的代码片段可用于定义LDAP用户—复制它并修改属性值以创建多个用户。用户<code class="fe mc md me mf b">objectclass</code>应该保持不变(<code class="fe mc md me mf b">inetOrgPerson</code>)对于所有创建的用户，其他字段可以根据您的需要进行更改。</p><pre class="kj kk kl km gt on mf oo op aw oq bi"><span id="79e9" class="or nr it mf b gy os ot l ou ov">dn: cn=developer,dc=shihadeh,dc=intern<br/>changetype: add<br/>objectclass: inetOrgPerson<br/>cn: developer<br/>givenname: developer<br/>sn: Developer<br/>displayname: Developer User<br/>mail: <a class="ae ky" href="mailto:developer@gmail.com" rel="noopener ugc nofollow" target="_blank">developer@gmail.com</a><br/>userpassword: developer_pass</span></pre><p id="f48b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是定义LDAP组并将用户分配给这些组。要定义组，我们可以使用LDAP对象类<code class="fe mc md me mf b">groupsofUniqueNames</code>或对象类<code class="fe mc md me mf b">groupsofNames</code>。下面的代码片段定义了两个LDAP组，并为每个组分配了不同的LDAP用户。</p><pre class="kj kk kl km gt on mf oo op aw oq bi"><span id="6fd5" class="or nr it mf b gy os ot l ou ov">dn: cn=Admins,ou=Groups,dc=shihadeh,dc=intern<br/>changetype: add<br/>cn: Admins<br/>objectclass: groupOfUniqueNames<br/>uniqueMember: cn=admin_gh,dc=shihadeh,dc=intern</span><span id="e516" class="or nr it mf b gy ow ot l ou ov">dn: cn=Maintaners,ou=Groups,dc=shihadeh,dc=intern<br/>changetype: add<br/>cn: Maintaners<br/>objectclass: groupOfUniqueNames<br/>uniqueMember: cn=maintainer,dc=shihadeh,dc=intern<br/>uniqueMember: cn=developer,dc=shihadeh,dc=intern</span></pre><p id="31eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生成引导文件的另一种方法是从LDAP用户界面创建<code class="fe mc md me mf b">LDAP</code>对象，然后导出LDAP数据。一旦引导文件准备好了，我们需要将它保存在一个名为<code class="fe mc md me mf b">bootstrap.ldif</code>的<code class="fe mc md me mf b">ldif</code>文件中。完整的文件可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="9556" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是创建用于构建定制Docker映像的<code class="fe mc md me mf b">Dockerfile</code>。最重要的操作是将引导文件复制到正确的路径。下面的docker文件可用于构建LDAP定制Docker映像，包括将在<code class="fe mc md me mf b">LDAP</code>服务器启动时使用的引导文件。</p><pre class="kj kk kl km gt on mf oo op aw oq bi"><span id="1ae9" class="or nr it mf b gy os ot l ou ov">FROM osixia/openldap</span><span id="9d09" class="or nr it mf b gy ow ot l ou ov">LABEL maintainer="wshihadeh.devx@gmail.com"</span><span id="f2ae" class="or nr it mf b gy ow ot l ou ov">ENV LDAP_ORGANISATION="Al-waleed Test Org" \     LDAP_DOMAIN="shihadeh.intern"</span><span id="f75e" class="or nr it mf b gy ow ot l ou ov">COPY bootstrap.ldif /container/service/slapd/assets/config/bootstrap/ldif/50-bootstrap.ldif</span></pre><p id="4264" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一步是部署LDAP服务器并测试是否已经创建了用户。我们可以通过使用命令<code class="fe mc md me mf b">docker-compose up -d</code>部署下面的<code class="fe mc md me mf b">docker-compose</code>文件来实现这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="e9ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">部署服务后，LDAP服务器将在以下URL上可用:<code class="fe mc md me mf b"><a class="ae ky" href="http://127.0.0.1:389." rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:389</a></code>。</p><p id="16ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，您将能够浏览LDAP服务器，查看其资源，并通过连接到以下URL <code class="fe mc md me mf b"><a class="ae ky" href="http://127.0.0.1:389." rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:</a>8090</code>创建新的资源。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="6b13" class="nq nr it bd ns nt oz nv nw nx pa nz oa jz pb ka oc kc pc kd oe kf pd kg og oh bi translated"><strong class="ak">结论</strong></h1><p id="8d23" class="pw-post-body-paragraph kz la it lb b lc oi ju le lf oj jx lh li ok lk ll lm ol lo lp lq om ls lt lu im bi translated">使用填充的数据部署LDAP服务器是一个节省时间的好主意，特别是对于开发和测试环境。这可以通过向<code class="fe mc md me mf b">LDAP</code> docker映像添加一个包含所需数据的引导文件来实现。<a class="ae ky" href="https://github.com/wshihadeh/ldap_server" rel="noopener ugc nofollow" target="_blank">在这里</a>你可以找到完整的实现。</p></div></div>    
</body>
</html>