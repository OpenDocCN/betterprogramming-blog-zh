<html>
<head>
<title>Promissory Notes As Smart Contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为智能合同的本票</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/promissory-notes-as-smart-contracts-8bb10c59f55c?source=collection_archive---------2-----------------------#2022-10-02">https://betterprogramming.pub/promissory-notes-as-smart-contracts-8bb10c59f55c?source=collection_archive---------2-----------------------#2022-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e424" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">智能合同的法律应用—第1部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5b53d6a0a686a5a7750c97fa9b5669cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ur2AUqUySHFrxqZHwlmlYw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="2d48" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文是我尝试将法律工具应用到代码中的系列文章的第一篇。</p><p id="3d2f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我将解释马耳他法律中的概念，然后解释如何将它们应用到智能合同中。本解释将使用伪代码来解释自然语言中的编码概念。在此基础上，我将尝试将这些概念发展成一个Solidity smart契约，然后为每篇文章提供一个到GitHub repo的链接。</p><p id="394f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些文章将假设读者对区块链技术有一个基本的工作知识，但是，所有的概念将尽可能解释清楚。</p><blockquote class="lr ls lt"><p id="062f" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated"><strong class="kx ir">关于语言选择的说明</strong></p><p id="05a6" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">我选择使用坚实作为选择的语言，纯粹是因为我用它最舒服。智能合约可以用其他语言编码，这取决于它们操作的区块链，比如索拉纳区块链的Rust语言。</p></blockquote><h1 id="87a8" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">马耳他法律下的本票</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/dd5248ec1ab112033362705eb1fba11e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TpvSU2UVIan9r9IG"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae mr" href="https://unsplash.com/@adeolueletu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Adeolu Eletu </a>在<a class="ae mr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5b3f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本票是一种书面付款命令，一方承诺根据要求或在预定日期向另一方支付一笔固定金额的款项。简单来说就是一张欠条。它创造了一种自成一格的执行所有权，这种所有权不同于汇票，因为它“不被任何中间方支取”(<a class="ae mr" href="https://www.inter-lawyer.com/lex-e-scripta/articles/e-finance1.htm#_ftn2" rel="noopener ugc nofollow" target="_blank"> Tsakatoura，2002 </a>)。</p><p id="fb8a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这意味着它管理的关系是两方之间的关系:承诺付款的人和被承诺付款的人。为了赋予本票行政所有权，必须提交一份司法信函(<a class="ae mr" href="https://www.um.edu.mt/library/oar/handle/123456789/2582" rel="noopener ugc nofollow" target="_blank">马斯喀特，2010 </a>)。<a class="ae mr" href="https://legislation.mt/eli/cap/13/eng/pdf" rel="noopener ugc nofollow" target="_blank">商业法典</a>第七篇(第13章。《马耳他法》第102条)对本票作出了规定，该条将适用于汇票的大部分规定适用于本票。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/b79e407a91d388432b581e037b913940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*memfzLdqyo8gjst4gRKW9A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">《商法》第260条</p></figure><h1 id="6bc0" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">使用案例</h1><p id="604c" class="pw-post-body-paragraph kv kw iq kx b ky mt jr la lb mu ju ld le mv lg lh li mw lk ll lm mx lo lp lq ij bi translated">早在2010年，马斯喀特就在考虑本票采用数字形式的可能性，认为本票必须是“书面的”和“签名的”，才能有效。克利福德·钱斯·LLP(2021)研究了这一概念，质疑智能合同是否能满足这些标准。然而，<a class="ae mr" href="https://s3-eu-west-2.amazonaws.com/lawcom-prod-storage-11jsxou24uy7q/uploads/2021/11/6.7776_LC_Smart_Legal_Contracts_2021_Final.pdf" rel="noopener ugc nofollow" target="_blank">英格兰和威尔士法律委员会(2021) </a>得出结论，智能合同确实可以被视为具有法律约束力。</p><p id="45e7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae mr" href="https://www.academia.edu/41182825/Blockchain_based_Smart_Contracts_Legal_Enforceability_in_Malta_and_the_UK_A_Square_Peg_in_a_Round_Hole" rel="noopener ugc nofollow" target="_blank"> Camilleri (2019) </a>认为智能合同可以满足马耳他合同法的要求，只要“双方确保协议的目的和原因始终合法。”然而，也有人指出，身份核实面临问题，因为这是确立有效同意的重要前提(Camilleri，2019年)。</p><p id="c2cf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本票的效率是它最好的特点之一。利用技术支持这些特征可能非常有用，而无法识别本票的数字版本可能是有害的。正如Muscat (2010年)所引用的，Tsakatoura (2002年)认为:</p><blockquote class="lr ls lt"><p id="be04" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">“为了使汇票和本票形式的流通票据在第三个千年保持其在国际贸易中的便利性，它们必须被承认为电子形式的有效票据。”</p></blockquote><p id="4c89" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae mr" href="https://www.gov.pl/attachment/e3ff4c9d-72f0-4ae4-89ac-f952f8ea666f" rel="noopener ugc nofollow" target="_blank">波兰数字事务部(2018) </a>也审查了区块链技术在本票上的应用，认为:</p><blockquote class="lr ls lt"><p id="2375" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">“[……]区块链技术使我们能够以这样一种方式模拟物质世界，即我们可以创建数字等同物来移交文件、进行注释、删除其条款，甚至完全销毁它。”</p></blockquote><p id="dc38" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本票提供了一个干净、简单的协议，在检查智能合同对法律工具的使用时进行测试。它通常不包含很多可移动的部分，这使得它更容易以智能合同的形式实现，例如，与成熟的20页合同相比。那么，如何才能做到呢？</p><h1 id="dd5a" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">建立本票智能合同</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6c0c4dc938c6cb10797f6365a9e9b744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YluMSOh1JKgbVvWWZT7VOw.png"/></div></div></figure><p id="cdb8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个实验基于几个假设，即:</p><ul class=""><li id="7e51" class="my mz iq kx b ky kz lb lc le na li nb lm nc lq nd ne nf ng bi translated">用于身份验证和数字许可捕获的方法是可用的，并且是合法接受的</li><li id="9483" class="my mz iq kx b ky nh lb ni le nj li nk lm nl lq nd ne nf ng bi translated">法院愿意接受智能合同的有效性</li><li id="d2b7" class="my mz iq kx b ky nh lb ni le nj li nk lm nl lq nd ne nf ng bi translated">双方都有足够的知识来利用智能合同</li></ul><p id="fe34" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据商业代码，智能合同将收集或生成以下信息:</p><p id="347c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据第261条:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/a01c80c2304cdeeff06ccfb619f09927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mleDWjuvT9nkcZM28cqz7A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">《商法》第261条</p></figure><ul class=""><li id="cdb4" class="my mz iq kx b ky kz lb lc le na li nb lm nc lq nd ne nf ng bi translated">双方的身份识别——使用他们的姓名和钱包地址</li><li id="ef6e" class="my mz iq kx b ky nh lb ni le nj li nk lm nl lq nd ne nf ng bi translated">与票据本身相关的信息，即输入日期(自动生成)、要支付的金额、如何给出价值、到期日期、在哪里开具以及应该在哪里支付</li><li id="5221" class="my mz iq kx b ky nh lb ni le nj li nk lm nl lq nd ne nf ng bi translated">双方的同意，以及同意的日期</li></ul><p id="1fb3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">可以肯定的是:</p><ul class=""><li id="87b6" class="my mz iq kx b ky kz lb lc le na li nb lm nc lq nd ne nf ng bi translated">笔记的自然语言版本的URL</li></ul><p id="172e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些被存储在一个叫做注释的“数据结构”中，该结构存储这些信息的变量，并遵循<code class="fe nn no np nq b">noteInfo</code>模板。这可以在下面的伪代码中看到:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">名为noteInfo的数据结构模板的伪代码，并基于它初始化一个名为note的数据结构。</p></figure><p id="c951" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你想更多地了解所使用的变量类型，你可以在这里查阅Solidity语言文档。</p><h1 id="4bd0" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">合同结构和流程</h1><p id="d30b" class="pw-post-body-paragraph kv kw iq kx b ky mt jr la lb mu ju ld le mv lg lh li mw lk ll lm mx lo lp lq ij bi translated">智能合约将按如下方式工作:</p><ol class=""><li id="4b7d" class="my mz iq kx b ky kz lb lc le na li nb lm nc lq nt ne nf ng bi translated">智能合同由<code class="fe nn no np nq b">Holder</code>发起，他提供他们的名字。</li><li id="7f5e" class="my mz iq kx b ky nh lb ni le nj li nk lm nl lq nt ne nf ng bi translated"><code class="fe nn no np nq b">Holder</code>通过<code class="fe nn no np nq b">setDetails </code>功能输入纸币信息。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于初始化契约和通过setDetails()函数设置细节的伪代码</p></figure><p id="647d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">3.合同然后记录<code class="fe nn no np nq b">Holder</code>和<code class="fe nn no np nq b">Drawer</code>的同意，记录给予同意的日期。</p><p id="f62e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">4.如果双方都同意，则生成票据的输入日期，即票据被开具的时间。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于记录同意和同意日期的伪代码。如果双方都同意，则设置日期</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/d55bdee5fe90510be38539796a05d7fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EieKPtiVcpWeOWx8xB7zhQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建本票的合同第一部分的流程图</p></figure><p id="33e7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">5.然后，契约具有函数<code class="fe nn no np nq b">payNote</code>，该函数允许<code class="fe nn no np nq b">Drawer</code>将金额支付到智能契约中，前提是该金额是正确的金额。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/9759ca49e279c06489bc8800a616eacc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q45xm5rEMKJW_dGyf97wBA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">payNote()函数的流程图</p></figure><p id="8014" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">6.一旦金额被存入,<code class="fe nn no np nq b">Holder</code>可以接受付款，这将金额发送到他们的钱包并终止合同。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/c3bc78ae92a3cc72e5cdcc14488760f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pPgtMlXJuPnje3jpzva8LA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">acceptPayment()函数流程图</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于将票据支付到智能合约、接受支付、转移到持有人以及合约终止的伪代码</p></figure><h2 id="a975" class="nx lz iq bd ma ny nz dn me oa ob dp mi le oc od mk li oe of mm lm og oh mo oi bi translated">合同代码</h2><p id="8153" class="pw-post-body-paragraph kv kw iq kx b ky mt jr la lb mu ju ld le mv lg lh li mw lk ll lm mx lo lp lq ij bi translated">既然合同的基本框架已经建立，我试图将它转化为一个可靠的智能合同。我绝不是可靠性方面的专家，我仍在不断增强使用它的信心——所以欢迎任何反馈！这是我写的合同代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">本票智能合同的可靠性代码</p></figure><p id="17fc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如您所见，我还引入了函数‘kill’，它自毁契约，以及函数<code class="fe nn no np nq b">getInfo</code>，它以元组的形式返回注释中的信息。然而，这种查看信息的格式并不理想。我仍在努力寻找一种方法将它翻译成JSON元数据文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/0b3481b3d0e8b10699c9f955354eb573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmePWM0UecHNy9KFlcdiOQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">当前getInfo()函数的结果</p></figure><p id="b55d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在筹码深度上也做了相当大的努力。由于合同接受了很多变量，而以太坊虚拟机的堆栈大小只有16个变量，所以我不得不多次修改合同以使其正确。如你所见，在最后，我有几个修饰语——这些只是基于检查一个语句是否为真来实现if/then逻辑的一种更干净的方式。如果你想深入研究，你可以在这里查看GitHub回购<a class="ae mr" href="https://github.com/matteoalessandro-eth/legal-smart-contract/tree/main/promissory-notes" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="a204" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">如何让它变得更好？</h1><p id="6b32" class="pw-post-body-paragraph kv kw iq kx b ky mt jr la lb mu ju ld le mv lg lh li mw lk ll lm mx lo lp lq ij bi translated">有许多方法可以改进这份合同，其中有几个我太没有经验而没有注意到。但是，以下是我将要做的工作，因为我相信它们可以提供更高水平的确定性和功能性:</p><ol class=""><li id="5829" class="my mz iq kx b ky kz lb lc le na li nb lm nc lq nt ne nf ng bi translated">第一个主要改进是开发了一个铸造NFT的函数，该函数具有链上元数据，表示在注释中找到的信息。然后，这个NFT被发送给<code class="fe nn no np nq b">Holder</code>，T1将其作为本票的“令牌”保留。一旦付款被接受，这个代币就可以自动烧录。用JSON文件——人类可读的语言——表示信息也将使它更容易解释。这个文件的例子可以在<a class="ae mr" href="https://github.com/matteoalessandro-eth/legal-smart-contract/blob/main/promissory-notes/metadata/example.json" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</li><li id="81d3" class="my mz iq kx b ky nh lb ni le nj li nk lm nl lq nt ne nf ng bi translated">第二是开发一个脚本和界面，可以与智能合同的功能进行交互，以使其对用户友好。</li><li id="86b8" class="my mz iq kx b ky nh lb ni le nj li nk lm nl lq nt ne nf ng bi translated">第三是将合同拆分成更小的分包合同，提高效率。我也强烈建议确保合同的安全性符合标准。Wohrer等人在2018年提出了许多设计模式，以在以太坊区块链上实现更好的智能合约，这是一个GitHub回购协议，提供模板，可以在这里找到<a class="ae mr" href="https://github.com/maxwoe/solidity_patterns" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="cb33" class="my mz iq kx b ky nh lb ni le nj li nk lm nl lq nt ne nf ng bi translated">最后一步是对数据进行加密，使当事人的个人信息和笔记信息只对当事人可见，以及他们选择显示给谁看。</li></ol><p id="0e33" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就对了。通过智能合约实现本票的相对简单的方法。这只是一个概念的证明，还远远不能用于实际的商业应用。在接下来的文章中，本系列将重点讨论这些潜在的应用程序，比如文档验证、租赁协议和在线身份验证。</p></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><p id="7fcc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢阅读。敬请关注更多内容。</p></div></div>    
</body>
</html>