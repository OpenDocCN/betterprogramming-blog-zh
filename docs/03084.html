<html>
<head>
<title>Save Time With Regular Expressions in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift中使用正则表达式节省时间</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/saving-time-with-regular-expressions-f48e6c632521?source=collection_archive---------12-----------------------#2020-01-19">https://betterprogramming.pub/saving-time-with-regular-expressions-f48e6c632521?source=collection_archive---------12-----------------------#2020-01-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a230" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用R.swift清理NSLocalizedString和UIImage引用</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/490b95061d1ff3218e8cd20b90aebf32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nPmRN_qeK5vnVINd"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@bradneathery?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布拉德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上整理</a></p></figure><p id="e414" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我最近接到一个任务，要实现一个奇妙的库，名为<a class="ae kv" href="https://github.com/mac-cain13/R.swift" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> R.swift </em> </a> <em class="ls">，</em>，它会清理项目中的所有资源，并允许它们被轻松引用。</p><p id="a255" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章不会详细介绍这个库。相反，我想向您展示Xcode的“用正则表达式查找和替换”功能有多有用，以及它如何帮助我节省了大量时间，而我本来是要花大量时间不厌其烦地逐一修复数百行代码的。</p><p id="cead" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">任务是使用R.swift获取资源的方式替换我们所有的<code class="fe lt lu lv lw b">NSLocalizedString</code>和<strong class="ky ir"> </strong> <code class="fe lt lu lv lw b">UIImage</code>引用。</p><p id="c8ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，获取如下本地化字符串:</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="065a" class="mb mc iq lw b gy md me l mf mg">NSLocalizedString("common_cancel", comment: "Cancel")</span></pre><p id="ed47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">必须替换为以下内容:</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="43f2" class="mb mc iq lw b gy md me l mf mg">R.string.localizable.common_cancel()</span></pre><p id="31ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于我们的应用程序中有超过1，000个本地化的字符串和图像资源，一次替换一个引用将是一项非常耗时的任务。幸运的是，我发现了一个非常棒的Xcode特性，这正是我所需要的。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="ea6c" class="mo mc iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">使用正则表达式查找和替换</h1><p id="6ca7" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">正则表达式，或称<em class="ls"> regex </em>，允许您使用特殊的语法定义一个搜索模式，匹配您可能正在寻找的任何文本。它还允许您捕获部分文本以供重用。</p><p id="644c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您还没有使用过这个Xcode特性，您可以在项目导航器中找到这个选项。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/99b42756c028b0c56d90173b90be4f72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*Ph7clQ0_pM6ZSe8bwc8tvg.png"/></div></figure><p id="f7d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击“查找”，切换到“替换”。点击“文本”，切换到“正则表达式”。</p><p id="5e17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑这个表达式:</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="2810" class="mb mc iq lw b gy md me l mf mg">NSLocalizedString\("(.*)",(?:.*)</span></pre><p id="1088" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它的作用是查找任何以<code class="fe lt lu lv lw b">NSLocalizedString</code>开头的文本，并存储第一个参数的引号内容。因为这是我需要捕捉的全部内容，所以我忽略了第一个参数之后的每个字符。</p><p id="a722" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们把这个表达式再分解一下。</p><p id="cb2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">NSLocalizedString</code>后面的反斜杠需要用来转义左括号字符。</p><p id="3c79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，特殊字符需要使用反斜杠进行转义。如果遇到表达式不起作用的问题，请确保对特殊字符进行了转义。</p><p id="f3c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">(.*)</code> <strong class="ky ir"> </strong>括号内创建一个编号的捕捉组。这允许您存储与表达式匹配的字符串的一部分，以便以后提取。</p><p id="fa83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">点</em>表示任何字符，而<code class="fe lt lu lv lw b">asterisk</code>表示前面的正则表达式标记的零个或多个实例。因此，无论括号中的内容是什么。</p><p id="9a98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的例子中，它将捕获<code class="fe lt lu lv lw b">common_cancel</code>，这是我的本地化字符串资源的名称。这是我关心的文本部分，也是我的字符串替换所需要的。</p><p id="20de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">(?:.*)</code> <strong class="ky ir"> </strong>带问号和冒号的括号创建一个非捕获组。其中的内容被丢弃。由于括号中包含另一个点和星号，它忽略了我的代码行中的其余字符。</p><p id="2320" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，现在我的正则表达式匹配了项目中所有的<code class="fe lt lu lv lw b">NSLocalizedString</code>实例，我准备用下面一行替换它们:</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="d9d9" class="mb mc iq lw b gy md me l mf mg">R.string.localizable.$1()</span></pre><p id="2dd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe lt lu lv lw b">$1</code> <strong class="ky ir"> </strong>是包含我捕获的文本的编号引用。如果我点击替换，我就能得到我想要的。</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="d072" class="mb mc iq lw b gy md me l mf mg">R.string.localizable.common_cancel()</span></pre><p id="3f9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太神奇了！表达式匹配的所有数百个实例都立即被替换为我需要的新代码行。节省了大量的时间。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="9137" class="mo mc iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">更新图像资源</h1><p id="05fb" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我必须做的下一个更新与上一个例子非常相似。该资源在我的项目中每次被<code class="fe lt lu lv lw b">UIImage</code> <strong class="ky ir"> </strong>引用。</p><p id="c7d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">得到这样的图像:</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="b0c6" class="mb mc iq lw b gy md me l mf mg">UIImage(named: "menuIcon")</span></pre><p id="9220" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不得不由R.swift <strong class="ky ir"> </strong>引用图像的方式代替:</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="bb96" class="mb mc iq lw b gy md me l mf mg">R.image.menuIcon()</span></pre><p id="3780" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，唯一需要捕获的是图像的名称。在这个例子中，它是<code class="fe lt lu lv lw b">menuIcon</code>。</p><p id="4800" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我使用的正则表达式:</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="23ce" class="mb mc iq lw b gy md me l mf mg">UIImage\(named: "(.*)"\)</span></pre><p id="52cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它匹配了我所有的<code class="fe lt lu lv lw b">UIImage</code>引用，并存储了我需要的图像名称。与上一个示例类似，我用下面这行代码替换了所有的引用:</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="1b16" class="mb mc iq lw b gy md me l mf mg">R.image.$1()</span></pre><p id="bbe1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">导致以下结果:</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="ee13" class="mb mc iq lw b gy md me l mf mg">R.image.menuIcon()</span></pre><p id="dc87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">至此，我完成了。本来要花我几个小时的事情，现在只花了我几分钟。</p><p id="5e7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您遇到类似的技术债务任务，尝试看看是否可以利用正则表达式查找和替换。在从事这项工作时，我是一个完全的正则表达式初学者，所以这对我来说是一个很好的成就。当我让一切都运转起来时，我非常激动。</p><p id="d7db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望这篇文章对你们有些人有所帮助。最后，看看r .斯威夫特。这是一个非常棒的工具，我强烈推荐，并将在我未来所有的iOS项目中使用。</p></div></div>    
</body>
</html>