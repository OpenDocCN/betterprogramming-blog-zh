# 让我们停止谈论无服务器冷启动

> 原文：<https://betterprogramming.pub/lets-stop-talking-about-serverless-cold-starts-38e4c1fda963>

## 每当我们谈论无服务器时，总会有一个人提起冷启动

![](img/714d6326ca2c8d79b17256856aa54171.png)

图片由 FreePik 的 [user18526052](https://www.freepik.com/free-photo/bearded-guy-with-sleeping-mask-forehead-looking-aside-being-wrapped-blanket-copy-space-advertisement-promotion-text_9014238.htm#query=cold&position=48&from_view=search) 提供

前几天我和家人一起吃晚饭。我四岁的女儿看着她的盘子，对我说，“我不想要这只鸡。”

很自然地，我问她为什么，她回答说，“上面有调味汁。”

你看，几个月前，我们吃了一顿饭，上面有一层她…讨厌的釉料。从那以后，任何看起来像酱汁的东西对她来说都是不可能的。如果不是固体，就是酱，她会排斥。

作为家长超级讨厌😒。

她抓住了一个想法，概括了它，现在太激动了，不想尝试任何相关的东西。

听起来熟悉吗？

我在无服务器上做的每一次演示，都有人提到冷启动。他们在几年前就听说过这种产品，并且已经意识到，只要它们存在，无服务器产品对他们来说就不可能成功。

所以我在推特上问了一个试探性的问题:

谁能给我举个例子，说明#lambda 函数冷启动在生产中给你带来的合法问题？

我收到了各种各样的回答，但最常见的回答是，“我*这不是生产中的真正问题。”*

当然，也有例外，但是大多数例外都有有效的解决方法。让我们开始吧，看看我们能否一劳永逸地结束这场争论。

# 什么是冷启动？

冷启动发生在第一次请求调用函数时，或者当 Lambda 运行时环境忙于处理业务逻辑时。

Lambda 必须初始化一个新容器来执行您的代码；初始化需要时间，因此，冷启动。

当用户当天开始登录您的应用程序时，或者当突发流量通过时，就会发生这种情况。流量突发指的是一天中使用率最低的点，随后是流量的大峰值。这导致冷启动，因为[λ开始缩放](https://aws.amazon.com/blogs/compute/understanding-aws-lambda-scaling-and-throughput/)以匹配增加的需求。

考虑到这一点，有些应用比其他应用更容易冷启动。一旦 Lambda 扩展到适当数量的并发执行环境，全天持续使用的应用程序将会看到更少的冷启动。

# 什么原因导致感冒开始缓慢？

有几件事会直接影响冷启动的持续时间:

*   运行时—您正在使用的编程语言。
*   包大小—运行代码所需加载的数据量。这包括层！
*   启动逻辑—在函数的主处理程序之外定义的连接和初始化。

## 运行时间

如果 Java 是您的运行时选择，我有一个坏消息。这是冷启动的[最慢运行时间。根据来自](https://blog.thundra.io/fastest-runtime-for-aws-lambda-functions#sub_3)[桑德拉](https://www.thundra.io/)的研究，Java 的冷启动持续时间最慢，是第二慢的. NET 的 7 倍

> 像 Java 和。与 Python、Go 和 Node 等解释型语言相比，NET 的冷启动速度较慢。

一旦函数容器预热，编译语言和解释语言之间的性能收敛到大致相同的持续时间。

## 包装尺寸

[Lumigo](https://lumigo.io/) 围绕冷启动对[封装尺寸和依赖项导入](https://lumigo.io/blog/this-is-all-you-need-to-know-about-lambda-cold-starts/)的影响进行了一个很好的案例研究。他们发现，随着功能包大小的增加，冷启动持续时间也会增加，即使没有消耗额外的依赖项！

![](img/e9cb50ea1c204359be91a0cf1881c253.png)

*包装尺寸的冷启动比较。来源:* [*Lumigo*](https://lumigo.io/)

当您向函数添加更多导入时，运行时必须解析依赖项，这会增加冷启动时间。所以在导入整个包而不是您需要的特定组件时要小心。

如果您发现自己在单个函数中导入了越来越多的资源，那么可能是时候重新评估和评价使用[而不是](/lambda-vs-step-functions-the-battle-of-cost-and-performance-5f008045e2ab)来协调您的工作流了。

## 启动逻辑

在 Lambda 函数中全局定义 SDK 客户端和可缓存变量被认为是最佳实践。这允许函数在后续运行中重用它已经建立的任何连接。

另一方面，它增加了您的冷启动时间，因为它们是在函数容器初始化阶段设置的。

这是公认的无服务器折衷方案之一，你无法对其进行优化。全局声明背后的思想过程是，在函数容器的整个生命周期中，初始化代码只需要执行一次。如果客户机是在主处理程序中定义的，那么每次执行函数时，无论函数是否热，性能都会受到影响。

# 冷启动真的是个问题吗？

回到我在推特上最初的问题。是否存在功能冷启动成为问题的实际生产用例？

对于解释型语言，你的平均冷启动时间不到 500 毫秒，而编译型语言会更长一点(Java 大约 5 秒)。当考虑 500 毫秒的额外延迟时，冷启动不会严重影响大多数生产用例。

当您的应用程序开始扩展时，您会看到延迟，但这真的是一个阻碍吗？

它可能用于一些需要瞬间更新的应用程序，如股票市场交易应用程序或紧急 CAD(计算机辅助调度)系统。但是对于其他一切，这似乎是 Lambda 的可伸缩性、可靠性和可用性的一个简单的折衷。

就像我四岁的女儿和她对“酱”的厌恶一样，拒绝无服务器的人通常会抓住这个短语不放，甚至不会去尝试。当我们谈到导致无服务器项目无法启动的无服务器冷启动时，会有一种恐惧和模糊感。

这必须改变。

无论您是减少您的包大小、增加分配的内存，还是[向您的函数添加供应的并发性](https://aws.amazon.com/blogs/compute/operating-lambda-performance-optimization-part-1/),您都可以选择最大限度地减少冷启动的风险。

通过遵循[无服务器最佳实践](/7-aws-serverless-design-principles-for-solutions-architects-2be22717713b)，您可以轻松避免同步请求等待多个 Lambda 函数冷启动并返回响应的情况。您甚至可以在基础设施的每一层实现[缓存，以简化查找。](https://theburningmonk.com/2019/10/all-you-need-to-know-about-caching-for-serverless-applications/)

所有这些都说明，如果你担心冷启动，有办法减轻它们。由于冷启动倾向于影响同步调用，就像 API 请求一样，您可以采用一种[存储优先的方法](/build-better-serverless-apis-by-going-storage-first-597784f8f399)，这种方法可以减轻调用者等待冷启动的负担。

# 结论

冷启动在无服务器的世界中是非常真实的，但在大多数情况下它们不是问题。不要再隐藏那些已经被大肆宣传的事情了。承认 AWS 从我们这里抽象出来的困难，拥抱最小延迟(相对于它正在解决的问题)。

没有理由害怕冷启动。选择一个解释的运行时和适当的包管理将使您的冷启动时间缩短到几乎可以忽略的程度。如果改变编程语言不是一个选项，这是许多公司的情况，考虑添加供应的并发性来保持同步功能。

当谈到无服务器时，我们该结束“*但是冷启动*怎么办”的评论了。是的，他们是真实的，但是他们是一个真实的问题吗？不再是了。

编码快乐！