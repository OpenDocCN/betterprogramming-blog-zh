<html>
<head>
<title>Build a Real Time Webcam With Speech Recognition in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python构建一个带语音识别的实时网络摄像头</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-real-time-webcam-with-speech-recognition-in-python-b073acd3cd4f?source=collection_archive---------6-----------------------#2021-12-09">https://betterprogramming.pub/build-a-real-time-webcam-with-speech-recognition-in-python-b073acd3cd4f?source=collection_archive---------6-----------------------#2021-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b523" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">实时传输您的音频数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6f3ab9032d0cdbc8d530b13129ad28a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0IiUBSUjNEKUWXsUop_byg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">托马斯·勒在Unsplash<a class="ae ky" href="https://unsplash.com/s/photos/voice?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></p></figure><p id="4b61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以前，我曾经写过一篇关于<a class="ae ky" href="https://levelup.gitconnected.com/how-to-transcribe-audio-files-to-text-1ed7cf6d8c08" rel="noopener ugc nofollow" target="_blank">如何将音频文件转录为文本</a>的文章，它通过AssemblyAI提供的<a class="ae ky" href="https://app.assemblyai.com/" rel="noopener ugc nofollow" target="_blank">语音到文本API </a>转录一个音频记录文件。</p><p id="e57b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将探索另一个版本，它将你的音频数据实时传输到一个<a class="ae ky" href="https://docs.assemblyai.com/overview/real-time-transcription" rel="noopener ugc nofollow" target="_blank"> WebSocket API </a>中。</p><p id="1703" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，您应该能够用Python创建一个带有语音识别功能的实时网络摄像头应用程序。最终结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/aa89e4c83e4d704e991f3a6f63fd9de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nQScJXbsbhoR3PjeazXsYw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者Gif</p></figure><p id="fb0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续下一部分，开始安装必要的模块。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="45ca" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">设置</h1><h2 id="56ab" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">Python包</h2><p id="c2a0" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">强烈建议您在继续之前创建一个新的虚拟环境。逐一运行以下命令来安装所有依赖项:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="da4d" class="mv me it nn b gy nr ns l nt nu">pip install websocket<br/>pip install opencv-python<br/>pip install pipwin<br/>pipwin install pyaudio</span></pre><h2 id="c87e" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">WebSocket API</h2><p id="a02a" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">为了开始，请在此注册一个<a class="ae ky" href="https://app.assemblyai.com/signup" rel="noopener ugc nofollow" target="_blank">新的免费试用账户。试用帐户每月有3个小时的转录，每个帐户都有一个唯一的API密钥。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/e297c8d6c2d179739f8fea8800cad5f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7ry5f1PbsDDmBfw-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3eff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，WebSocket API仅适用于升级后的帐户。您可以通过在您的<a class="ae ky" href="https://app.assemblyai.com/" rel="noopener ugc nofollow" target="_blank">仪表盘</a>中添加一张卡来轻松升级您的帐户。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a6e7" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">履行</h1><p id="9707" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">创建一个名为main.py的新Python文件，作为本教程的主应用程序。</p><h2 id="15ee" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">导入</h2><p id="9ad7" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">在文件顶部添加以下导入语句:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="1fe5" class="mv me it nn b gy nr ns l nt nu">import pyaudio<br/>import websockets<br/>import asyncio<br/>import base64<br/>import json<br/>import logging<br/>import cv2</span></pre><h2 id="9664" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">初始化</h2><p id="6964" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">接下来，初始化以下变量:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="be10" class="mv me it nn b gy nr ns l nt nu">FRAMES_PER_BUFFER = 3200<br/>FORMAT = pyaudio.paInt16<br/>CHANNELS = 1<br/>RATE = 16000<br/>p = pyaudio.PyAudio()</span><span id="8483" class="mv me it nn b gy nw ns l nt nu"># starts recording<br/>stream = p.open(<br/> format=FORMAT,<br/> channels=CHANNELS,<br/> rate=RATE,<br/> input=True,<br/> frames_per_buffer=FRAMES_PER_BUFFER<br/>)</span><span id="a309" class="mv me it nn b gy nw ns l nt nu"># the AssemblyAI endpoint we’re going to hit<br/>URL = “wss://api.assemblyai.com/v2/realtime/ws?sample_rate=16000”<br/>auth_key = “xxxxxx”<br/>text = “”</span><span id="a6c1" class="mv me it nn b gy nw ns l nt nu"># image<br/>cap = cv2.VideoCapture(0)<br/>font = cv2.FONT_HERSHEY_SIMPLEX</span><span id="d05a" class="mv me it nn b gy nw ns l nt nu">webcamIsOn = True</span></pre><p id="5d76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe nx ny nz nn b">auth_key</code>变量替换为您帐户的API密钥。</p><h2 id="7627" class="mv me it bd mf mw mx dn mj my mz dp mn li na nb mp lm nc nd mr lq ne nf mt ng bi translated">WebSocket</h2><p id="d011" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">完成后，让我们看看如何使用下面的代码片段创建一个新的WebSocket连接:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="3bf4" class="mv me it nn b gy nr ns l nt nu">async with websockets.connect(URL, extra_headers=((“Authorization”, auth_key),), ping_interval=5, ping_timeout=20) as _ws:<br/>   await asyncio.sleep(0.1)<br/>   print(“Receiving SessionBegins …”)<br/>   session_begins = await _ws.recv()<br/>   print(session_begins)<br/>   print(“Sending messages …”)</span><span id="58b4" class="mv me it nn b gy nw ns l nt nu">   …</span></pre><p id="367e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您需要在上下文管理器中实现以下异步子函数:</p><ul class=""><li id="8578" class="oa ob it lb b lc ld lf lg li oc lm od lq oe lu of og oh oi bi translated"><strong class="lb iu">发送</strong> —向WebSocket服务器发送base64编码的音频数据</li><li id="7f6b" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated"><strong class="lb iu">接收</strong> —从WebSocket服务器接收JSON数据，并将相应的文本赋给全局变量text</li><li id="4db3" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated"><strong class="lb iu">网络摄像头</strong> —从网络摄像头读取数据并显示图像。此外，它将在图像上呈现转录文本</li></ul><p id="9800" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">send函数的代码片段如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="fc29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，接收函数要简单得多。只需定义全局文本变量并在循环中实现代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="51b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随后，使用以下代码实现网络摄像头功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="ec34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它使用opencv从您机器上的第一个网络摄像头设备捕获所有帧。此外，它会将转录文本呈现为每个框架顶部的覆盖图。</p><p id="9d9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，调用<code class="fe nx ny nz nn b">asyncio.gather</code>函数来并行运行所有的子函数:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="394d" class="mv me it nn b gy nr ns l nt nu">send_result, receive_result, webcam_result = await asyncio.gather(send(), receive(), webcam())</span></pre><p id="36ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们将代码片段包装在一个函数调用<code class="fe nx ny nz nn b">send_receive</code>中，触发器如下:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="beef" class="mv me it nn b gy nr ns l nt nu">asyncio.run(send_receive())</span></pre><p id="68d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在下面的<a class="ae ky" href="https://gist.github.com/wfng92/8ba1aae0df5abc0d6b0061d68d341fcb" rel="noopener ugc nofollow" target="_blank"> GitHub gist </a>找到完整的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="b431" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">试验</h1><p id="395a" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">保存文件并在终端上运行以下命令:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="2865" class="mv me it nn b gy nr ns l nt nu">python main.py</span></pre><p id="ce0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将运行一个应用程序，从你的摄像头捕捉图像。您应该在终端上看到以下输出:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="07a3" class="mv me it nn b gy nr ns l nt nu">Connecting websocket to url $wss://api.assemblyai.com/v2/realtime/ws?sample_rate=16000<br/>Receiving SessionBegins …<br/>{“message_type”: “SessionBegins”, “session_id”: “0c72be27-ced6–4859-a0a6–1ef47d22ff46”, “expires_at”: “2021–12–07T14:26:28.844782”}<br/>Sending messages …</span></pre><p id="57d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将您的麦克风连接到您的机器上，并使用它说话。转录文本将呈现在每一帧上，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/b7725dc42f654bd0179994960d719a33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E-aXowkmxk_l89ye"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6e71" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="e764" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">让我们回顾一下你今天所学的内容。</p><p id="6dcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文从一个简单的问题陈述和带有语音识别应用程序的实时网络摄像头的最终结果开始。</p><p id="6f5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，通过<code class="fe nx ny nz nn b">pip install</code>和<code class="fe nx ny nz nn b">pipwin</code>进入封装安装。</p><p id="3024" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随后，它讲述了向WebSocket服务器发送音频数据、从服务器接收JSON结果以及呈现网络摄像头输出的实现代码。</p><p id="8365" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，通过运行Python文件实现了一个具有语音识别功能的实时网络摄像头应用程序。</p><p id="9dbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢你阅读这篇文章。祝你有美好的一天！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e4c7" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">参考</h1><ol class=""><li id="86d0" class="oa ob it lb b lc nh lf ni li or lm os lq ot lu ou og oh oi bi translated"><a class="ae ky" href="https://docs.assemblyai.com/overview/real-time-transcription" rel="noopener ugc nofollow" target="_blank"> AssemblyAI —实时流式转录</a></li><li id="614a" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu ou og oh oi bi translated"><a class="ae ky" href="https://www.assemblyai.com/blog/real-time-speech-recognition-with-python/" rel="noopener ugc nofollow" target="_blank">使用Python进行实时语音识别</a></li></ol></div></div>    
</body>
</html>