<html>
<head>
<title>Optimize Build Speed in webpack 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优化webpack 4的构建速度</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/optimize-buid-time-with-webpack-4-9bd503952145?source=collection_archive---------7-----------------------#2019-10-06">https://betterprogramming.pub/optimize-buid-time-with-webpack-4-9bd503952145?source=collection_archive---------7-----------------------#2019-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d0ef" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">因为功能很棒，但速度就是一切</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/afca3170d1c621ba2015b54d41f9d3fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tpuseLkcqxFxEO-IBE5cEw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Marc Sendra Martorell 在<a class="ae ky" href="https://unsplash.com/s/photos/speed?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="fe03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，我研究了如何优化webpack 4的构建时间。这篇文章展示了我所验证的结果。</p><h2 id="784f" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">目录</h2><ul class=""><li id="33e3" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated"><a class="ae ky" href="#6bb8" rel="noopener ugc nofollow">不同版本节点的速度验证</a></li><li id="0bf8" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="#0755" rel="noopener ugc nofollow">多核速度验证</a></li><li id="530b" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><a class="ae ky" href="#9b87" rel="noopener ugc nofollow">应用缓存的速度验证</a></li></ul><p id="93ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，确保你的webpack和Node版本是最新的。以下是我的环境:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/aa1e0b98a9c1888e4ec271b47201a1a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*GZCy6DGxOs9uSwXIhNrL-g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">环境</p></figure></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="6bb8" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">不同版本节点的速度验证</h1><p id="c208" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">Node.js在每次版本更新时都越来越优化。最新版本是12.11.1，LTS是10.16.3。我测量了每个节点版本的构建时间。</p><h2 id="911a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结果</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/2d610de60c33fab7c6384936a2c40b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*LIRqajjjpgvrstZ-q8MhyA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按节点版本的结果</p></figure><h2 id="458e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak">结论</strong></h2><p id="29c6" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">虽然在v8和v9之间有一个降级的版本，但是随着版本的升级，构建时间已经减少了。令人惊讶的是，版本间编译后的文件大小<em class="ob">没有</em>变化。所有的文件大小都一样。只有构建时间不同。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="0755" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">多核速度验证</h1><p id="b798" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">官方webpack页面上的文件压缩插件<a class="ae ky" href="https://www.npmjs.com/package/uglifyjs-webpack-plugin/v/1.3.0" rel="noopener ugc nofollow" target="_blank"> uglyfy-webpack-plugin </a>支持多CPU内核构建。这个插件在v1.0.0中默认应该包含在webpack中，但是现在需要通过npm手动安装。</p><p id="31c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oc od oe of b">npm install --save-dev uglifyjs-webpack-plugin</code></p><p id="f18b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">插件引用具有以下注释:</p><blockquote class="og oh oi"><p id="f5ec" class="kz la ob lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">并行化可以显著加快构建速度，因此强烈推荐。</p></blockquote><p id="0b9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">强烈建议提高构建速度。为了在构建过程中应用多核，需要启用并行属性或指定核的数量。代码如下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="f420" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结果</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/bddec0b102e05d41d3cdf78f71fe1772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g95IKLbz6QCAVCxF8tRvew.png"/></div></div></figure><h2 id="db5c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><p id="fd8a" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">就获得更快的构建速度而言，为多核进程设置并行属性是有效的。尤其是构建大型项目时，这个功能超级有帮助。</p><p id="307d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我的笔记本电脑没有配备四核，但我试图将内核数量设置为四个并进行测量。结果似乎比双核略快，但由于我的笔记本电脑不支持四核，所以肯定一直是用双核测的。双核和四核在构建时间上的差异可能是公差范围。</p><p id="eceb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">的确，在webpack这边，下面的代码中使用了内核数量的设置，看起来要使用的内核数量是看OS的内核数量决定的。</p><p id="bf87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oc od oe of b">os.cpus().length — 1</code></p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="9b87" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">应用缓存的速度验证</h1><p id="f8ae" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">UglifyJsPlugin有一个缓存属性设置(<code class="fe oc od oe of b">default: false</code>)。如果启用，将在<code class="fe oc od oe of b">node_modules/.cache/uglifyjs-webpack-plugin</code>中创建一个缓存，从下一次开始引用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="65df" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结果</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/9e4c0f1be7920f197dccd103fae22682.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*5iWZhJpVZZI9f9ZwUsPXnw.png"/></div></figure><p id="ff38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用缓存后，构建时间显著减少。此外，我尝试测量多核对应的构建时间。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/4759117b7f070744d7b995ddd4235b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*OOBywbdwD1AKddHvZqj9gA.png"/></div></figure><h2 id="2a79" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak">结论</strong></h2><p id="28cb" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">因为需要在缓存中进行累积，所以第一次构建时间没有变化。但是，一旦在第一次构建完成后创建了缓存，第二次构建后的构建时间就会大大减少。</p><p id="0376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">小心改装。如果在创建缓存后再次修改文件，这将是正常的构建时间。尽管如此，它似乎是有效的，因为通过不变的文件，构建速度仍然变得更快。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="fd84" class="nm lw it bd lx nn no np ma nq nr ns md jz nt ka mg kc nu kd mj kf nv kg mm nw bi translated">全部的</h1><p id="e2dc" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">由于Node版本的不同，构建时间会更快。尤其是自从Node at <strong class="lb iu"> </strong>版本8有了相当大的改进，只需升级节点版本就有效了。</p><p id="37c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，当将cache属性设置为enabled时，由于文件自第二次以来没有更改，因此生成时间会减少。因此，如果要构建多个项目，并且项目中的某些文件不必更改，那么总的构建时间将会减少。</p><p id="1571" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在这种情况下，最好对目标文件进行转义。如果应用了缓存属性，并且允许使用多核，构建时间将会进一步缩短。</p><p id="e18c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我最后一个<code class="fe oc od oe of b">webpack.config.js</code>例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">优化代码</p></figure></div></div>    
</body>
</html>