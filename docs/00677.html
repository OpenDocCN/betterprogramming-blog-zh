<html>
<head>
<title>Testing React List Using axios and React Testing Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用axios和React测试库测试React列表</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/testing-react-list-using-axios-and-react-testing-library-d000eebf3413?source=collection_archive---------1-----------------------#2019-06-29">https://betterprogramming.pub/testing-react-list-using-axios-and-react-testing-library-d000eebf3413?source=collection_archive---------1-----------------------#2019-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f967" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">看看我们如何测试一个异步列表</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b1124e79e13510aec46b7dbda0382850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iYVhKNnBZwh14HuvdnLDAQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杰西卡·刘易斯在<a class="ae ky" href="https://unsplash.com/s/photos/list?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="1bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">典型的web应用程序肯定会有一个要呈现的列表。它可以是笔记本电脑、汽车、电影、财产、用户等的列表。今天，我们将看看如何测试一个异步列表。</p><p id="65db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用<a class="ae ky" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> Create React App </a>启动了一个回购，下面是我用来做这项工作的三个额外的包:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="b895" class="ma mb it lw b gy mc md l me mf">"@testing-library/react": "^8.0.4"</span><span id="a819" class="ma mb it lw b gy mg md l me mf">"axios": "^0.19.0"</span><span id="f5d5" class="ma mb it lw b gy mg md l me mf">"jest-dom": "^3.5.0"</span></pre><p id="4c30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们有这个组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="b732" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它只是调用一个API，获取数据，并将用户的名字呈现给页面。当它正在抓取时，我们显示“正在加载…”</p><p id="f0fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须设置<a class="ae ky" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>来嘲弄<a class="ae ky" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>。只需在src目录中创建一个文件夹<code class="fe mj mk ml lw b">__mocks__</code>，我们用下面的代码将文件命名为<code class="fe mj mk ml lw b">axios.js</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="04b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们必须用Jest设置<code class="fe mj mk ml lw b">afterEach</code>清理，这样我们就不必在每个测试文件中重复这个步骤。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1f1e" class="ma mb it lw b gy mc md l me mf">afterEach(cleanup)</span></pre><p id="8eba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://testing-library.com/docs/react-testing-library/setup#cleanup" rel="noopener ugc nofollow" target="_blank">文档</a>中阅读更多关于<code class="fe mj mk ml lw b">afterEach</code>清理的信息。</p><p id="cd6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，在应用程序目录的第一层创建一个名为<code class="fe mj mk ml lw b">jest.config.js</code>的文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="f046" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们处于测试阶段。创建一个名为<code class="fe mj mk ml lw b">Users.spec.js</code>(或<code class="fe mj mk ml lw b">Users.test.js</code>)的文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="ff76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试涵盖了我们的两个需求。在获取数据时检查加载器是否存在，并检查呈现的列表是否正确。</p><p id="cbd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们有更多的需求，例如，我们需要一个排序列表，用户的点击行为，等等。，最好把上面的测试拆分成多个测试块。</p><p id="e4a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我们需要确保我们使用<a class="ae ky" href="https://jestjs.io/docs/en/mock-function-api.html#mockfnmockclear" rel="noopener ugc nofollow" target="_blank"> mockClear </a>重置了模拟，这样API就不会被调用一次以上。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="236d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在测试中看到行动或继续玩设置，这里的<a class="ae ky" href="https://github.com/eldyvoon/react-testing-library-axios-react-hooks/" rel="noopener ugc nofollow" target="_blank">回购</a>。</p><p id="333b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试愉快！</p></div></div>    
</body>
</html>