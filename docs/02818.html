<html>
<head>
<title>Implement a VIPER Architecture in Swift 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift 5中实施VIPER架构</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-implement-viper-architecture-in-your-ios-app-rest-api-and-kingfisher-f494a0891c43?source=collection_archive---------1-----------------------#2020-01-03">https://betterprogramming.pub/how-to-implement-viper-architecture-in-your-ios-app-rest-api-and-kingfisher-f494a0891c43?source=collection_archive---------1-----------------------#2020-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2694" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用单一责任原则</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c11a27e4b85b4ace5ed6efcd9c7ac80a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YiAfngs2WIBIVx0t"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@killerfvith?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Alex wong </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="dc3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将学习如何在Swift 5中实现VIPER架构模式。</p><p id="5822" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经创建了一个演示应用程序，使用<a class="ae ky" href="https://thesimpsonsquoteapi.glitch.me" rel="noopener ugc nofollow" target="_blank">辛普森引用API </a>从“辛普森一家”中获取引用、字符和图像URL。</p><p id="09f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<a class="ae ky" href="https://github.com/onevcat/Kingfisher" rel="noopener ugc nofollow" target="_blank">翠鸟</a>获得实际图像。</p><p id="6484" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于代码生成，我创建了自己的<a class="ae ky" href="https://github.com/zafarivaev/VIPER-Template" rel="noopener ugc nofollow" target="_blank"> VIPER Xcode模板</a>。</p><p id="fc67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该项目的源代码可在<a class="ae ky" href="https://github.com/zafarivaev/VIPER-Demo-App" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="dc41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意</strong> : <a class="ae ky" href="https://thesimpsonsquoteapi.glitch.me" rel="noopener ugc nofollow" target="_blank">辛普森引用API </a>是在免费平台上发布的，所以如果过于频繁地使用网络请求，有可能会出现400错误。尽量不要发送垃圾请求，否则您将不得不等待一段时间，直到API再次可用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/b522872ecd6d10ee0b5a69593dcd0206.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9cz0mBgxH8tFDP_bPVQnpg.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bd9d" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">辛普森一家语录</h1><div class="kj kk kl km gt ab cb"><figure class="mv kn mw mx my mz na paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/4e728fe9f092d7aa698ea64927146bf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*J-Ly9IRk-gkL9VC2TF2jsQ.png"/></div></figure><figure class="mv kn mw mx my mz na paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/cd33e10b4d8e0c231202e47ad51efb28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*CPhAvMVJu8JEvZE3HX_Q2g.png"/></div></figure></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6373" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">项目结构</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/9c87c815e16093518aad203b31c1a743.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*jvmSBs8CDZ2VMg8VVSydtA.png"/></div></figure><p id="aa68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">项目的根分为三个文件夹:类、资源和支持文件。Resources文件夹包含<code class="fe nc nd ne nf b">Assets.xcassets</code>、<em class="ng">、</em>，Supporting Files文件夹包含<code class="fe nc nd ne nf b">LaunchScreen.storyboard</code>和<code class="fe nc nd ne nf b">Info.plist</code>。</p><p id="9977" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，在课堂上，我们有以下文件夹:</p><ul class=""><li id="6d2c" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu"> App </strong>包含<code class="fe nc nd ne nf b">AppDelegate.swift</code></li><li id="a1e6" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><strong class="lb iu">模块</strong>有两个定义的模块:报价和报价明细</li><li id="25b9" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><strong class="lb iu">公共</strong>包含REST API端点和实体【又名<em class="ng">模型</em>在MV(X)中】</li><li id="9e81" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><strong class="lb iu">管理器</strong>包含了帮助我们使用REST API的类</li><li id="2f25" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><strong class="lb iu">服务</strong>包含QuoteService(从REST API检索报价实体)、ImageDataService(将数据转换成UIImages)和KingfisherService(使用来自报价实体的图像URL获取图像数据)</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0352" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">让我们定义一个VIPER模块</h1><p id="cead" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">一个典型的毒蛇模块由五个组件组成:<code class="fe nc nd ne nf b">View</code>、<code class="fe nc nd ne nf b">Interactor</code>、<code class="fe nc nd ne nf b">Presenter</code>、<code class="fe nc nd ne nf b">Entity</code>和<code class="fe nc nd ne nf b">Router</code>。下面是对每个组件功能的简短描述:</p><ul class=""><li id="79fa" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><code class="fe nc nd ne nf b">View</code> <strong class="lb iu"> </strong>是被动的，自己做不了多少事。它唯一的职责是向演示者发送事件消息并显示UI元素。</li><li id="f777" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nc nd ne nf b">Interactor</code> <strong class="lb iu"> </strong>是独立于UIKit的组件，执行所有的业务逻辑。例如，在我们的应用程序中，它使用服务与REST API通信，以便从URL获取图像数据。</li><li id="a356" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nc nd ne nf b">Presenter</code>也是独立于UIKit的。它接收来自视图的消息，并决定是将消息发送给交互器还是路由器。它还接收来自交互器的数据，并为视图准备以合适的格式显示。</li><li id="f9b1" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nc nd ne nf b">Entity</code>是交互器使用的简单模型</li><li id="6adf" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">在我们的应用程序中，<code class="fe nc nd ne nf b">Router</code>、<strong class="lb iu">、</strong>负责创建特定的模块，并从一个模块导航到另一个模块</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="93a7" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">到我们的应用程序:报价模块</h1><p id="4326" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">首先，我们应该根据VIPER组件之间的交互来定义契约(在我们的例子中是五个协议)。</p><h2 id="6ba5" class="oa me it bd mf ob oc dn mj od oe dp mn li of og mp lm oh oi mr lq oj ok mt ol bi translated"><strong class="ak">报价合同网</strong></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="714d" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">查看输入</strong> ( <code class="fe nc nd ne nf b">ViewToPresenterQuotesProtocol</code> ) <strong class="lb iu"> : </strong>演示者应符合该协议。演示者从视图接收消息，并告诉交互者应该做什么。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="7976" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">视图输出</strong>(<code class="fe nc nd ne nf b">PresenterToViewQuotesProtocol</code>)<strong class="lb iu">:</strong>View controller应符合该协议。视图接收来自演示者的操作结果，并根据其逻辑进行相应的操作:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="7310" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">交互器输入</strong> ( <code class="fe nc nd ne nf b">PresenterToInteractorQuotesProtocol</code>):交互器应符合该协议。下面是工作流程:在视图中，我们通知演示者发生了一些事件(例如，<code class="fe nc nd ne nf b">viewDidLoad</code>)。展示者按照它的顺序，告诉交互者它应该执行某个任务(例如<code class="fe nc nd ne nf b">loadQuotes</code>)。任务完成后，交互器将结果转发回presenter。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="653e" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">交互器输出</strong> ( <code class="fe nc nd ne nf b">InteractorToPresenterQuotesProtocol</code>):演示者应遵守该协议。在交互器完成其任务后，在交互器输入中调用这些方法(如上所示)。在从交互器接收到一个任务后，呈现器以视图可显示的格式准备接收到的数据，并向它发送消息。上面的视图输出显示了视图在这些结果方法(<code class="fe nc nd ne nf b">onFetchQuotesSuccess</code>、<code class="fe nc nd ne nf b">onFetchQuotesFailure</code>)中做了什么。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><ul class=""><li id="c984" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><strong class="lb iu">路由器输入</strong> ( <code class="fe nc nd ne nf b">PresenterToRouterQuotesProtocol</code>):路由器符合该协议。路由器创建引用模块并配置依赖关系。它等待来自演示者的命令以导航到另一个屏幕，将所选报价作为参数传递:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="23b1" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">报价详细模块</h1><p id="8577" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">在QuoteDetail中，工作流程是相同的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="630c" class="oa me it bd mf ob oc dn mj od oe dp mn li of og mp lm oh oi mr lq oj ok mt ol bi translated"><strong class="ak">工作流程</strong></h2><ol class=""><li id="6e01" class="nh ni it lb b lc nv lf nw li oo lm op lq oq lu or nn no np bi translated">视图告诉演示者它已经被加载了:</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="94da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.<strong class="lb iu"> </strong>演示者告诉交互者获取图像数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="536d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.<strong class="lb iu"> </strong>交互器使用KingfisherService从报价的URL加载图像，并将结果发送回演示者:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="3f3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.presenter从interactor接收结果，将数据准备为正确的可显示格式，并将结果发送给视图:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="4482" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.最后，视图从presenter获取结果，并显示/更新其UI元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a8af" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak">包装</strong></h1><p id="2887" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">你可能已经注意到VIPER是如何明确划分其五个核心组件之间的职责的:<code class="fe nc nd ne nf b">View</code>、<code class="fe nc nd ne nf b">Interactor</code>、<code class="fe nc nd ne nf b">Presenter</code>、<code class="fe nc nd ne nf b">Entity</code>和<code class="fe nc nd ne nf b">Router</code>。事实上，VIPER是基于单一责任原则(S from SOLID)。</p><p id="35f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对其他的建筑模式感兴趣，可以看看我的一些相关作品:</p><div class="os ot gp gr ou ov"><a href="https://medium.com/better-programming/this-is-how-you-implement-mvc-architecture-in-2020-b39d65b4212f" rel="noopener follow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">新MVC:单一责任原则和委托</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">苹果的模型视图控制器，终于做对了</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">medium.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj ks ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://medium.com/better-programming/reactive-mvvm-and-the-coordinator-pattern-done-right-88248baf8ca5" rel="noopener follow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">反应式MVVM和协调模式做对了</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">使用Swift 5、RxSwift和RxDataSources</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">medium.com</p></div></div><div class="pe l"><div class="pk l pg ph pi pe pj ks ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://medium.com/better-programming/implement-a-model-view-presenter-architecture-in-swift-5-dfa21bbb8e0b" rel="noopener follow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">在Swift 5中实施模型-视图-演示者架构</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">使用领域数据库作为业务逻辑层</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">medium.com</p></div></div><div class="pe l"><div class="pl l pg ph pi pe pj ks ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://medium.com/better-programming/implement-a-service-oriented-architecture-in-swift-5-fc70b8117616" rel="noopener follow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">在Swift 5中实施面向服务的架构</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">为什么只用MVC/MVVM/蝰蛇还不够</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">medium.com</p></div></div><div class="pe l"><div class="pm l pg ph pi pe pj ks ov"/></div></div></a></div><p id="4717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢您的阅读！</p></div></div>    
</body>
</html>