<html>
<head>
<title>How to Customize MapKit Annotations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何自定义地图工具包注释</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-customize-mapkit-annotations-baad32487a7?source=collection_archive---------3-----------------------#2020-08-21">https://betterprogramming.pub/how-to-customize-mapkit-annotations-baad32487a7?source=collection_archive---------3-----------------------#2020-08-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5123" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">自定义注释的简单方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d90071ac8e6829bd0757966166d740fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gk4e2IAnEVkcKwH2"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安妮·斯普拉特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="7f80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我是户外探险追踪应用<a class="ae ky" href="https://apps.apple.com/app/id1489423707" rel="noopener ugc nofollow" target="_blank"> Outdoorist </a>的创始人。我最近花了很多时间使用MapKit，并想分享我发现的自定义MapKit注释的最简单的方法。我的目标是让一切简单明了，这样对任何人都有用。</p><p id="e0d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e059" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><p id="731f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们首先创建一个新的单视图应用程序Xcode项目。唯一需要注意的是，我们将使用Storyboard用户界面，而不是SwiftUI。我将把我的项目命名为<code class="fe mz na nb nc b">customMapAnnotations</code>，尽管你可以使用任何你喜欢的名字。</p><p id="0fba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<code class="fe mz na nb nc b">Main.storyboard</code> <strong class="lb iu"> </strong>文件，拖动<code class="fe mz na nb nc b">MapKitView</code> <strong class="lb iu"> </strong>到屏幕中央。通过选择<em class="nd">添加新约束</em>按钮<em class="nd">和</em>将视图的所有边约束为0，为视图添加一些约束。在点击<em class="nd">添加约束</em>按钮之前，取消勾选<em class="nd">约束至页边距</em>按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/1aa37fd7cbbdff3618c24e43c4fa2e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*piVatqzDDtCNkjP7mNvUGQ.png"/></div></figure><p id="5a56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们给<code class="fe mz na nb nc b">ViewController</code>添加一个连接:</p><ul class=""><li id="cff2" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">使用Xcode中的拆分视图打开当前打开的故事板旁边的<code class="fe mz na nb nc b">ViewController.swift</code>文件。</li><li id="1cbc" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">按住Control键从<code class="fe mz na nb nc b">MKMapView</code>文件拖动到<code class="fe mz na nb nc b">ViewController</code>文件，创建一个<code class="fe mz na nb nc b">IBOutlet</code> <strong class="lb iu"> </strong>连接。在随后的模式中，将连接命名为<code class="fe mz na nb nc b">mapView</code>并点击<em class="nd">连接</em>按钮。</li></ul><p id="97f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在一切都连接好了，我们可以开始创建地图视图了！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e34c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">配置地图视图</h1><ul class=""><li id="b87c" class="nf ng it lb b lc mu lf mv li nt lm nu lq nv lu nk nl nm nn bi translated">通过将<code class="fe mz na nb nc b">import MapKit</code>添加到<code class="fe mz na nb nc b">ViewController.Swift</code>的顶部(在<code class="fe mz na nb nc b">import UIKit</code>的正下方)，将MapKit依赖项添加到项目中。</li><li id="2323" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">添加子类<code class="fe mz na nb nc b">MKMapViewDelegate</code>使<code class="fe mz na nb nc b">ViewController</code>成为我们地图视图的代表。这使我们能够完全控制地图的行为，这将在以后广泛使用。</li><li id="df1e" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">在<code class="fe mz na nb nc b">super.viewDidLoad()</code>下，添加一行<code class="fe mz na nb nc b">mapView.delegate = self</code>。这一行将<code class="fe mz na nb nc b">ViewController</code>指定为地图视图的代表。本质上，这仅仅意味着我们告诉<code class="fe mz na nb nc b">MapView</code>我们想从这个类中控制它。</li></ul><p id="95ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在的<code class="fe mz na nb nc b">ViewController.swift</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="0c89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在添加注释之前，我们需要首先设置地图视图的区域。该区域控制地图中心的位置以及地图所需的缩放级别。我将在下面提供它的代码，然后开始研究:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="e2ca" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">该函数的第一行指定了我们希望作为地图视图中心的坐标。在这个例子中，地图的中心是华盛顿广场拱门。</li><li id="d259" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第二行设置地图视图的范围，这只是一个包含多少地图的规范(即缩放级别)。</li><li id="8862" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">第三行和第四行使用中心坐标和跨度创建一个<code class="fe mz na nb nc b">MKCoordinateRegion</code>对象，然后将其设置为地图视图使用的区域。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0b2c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">向地图添加注记</h1><p id="2396" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们给地图添加四个注释。首先，创建一个<code class="fe mz na nb nc b">MKPointAnnotation</code>的实例，然后给它一个坐标和标题，最后给<code class="fe mz na nb nc b">mapView</code>添加注释。我将在下面的代码中提供这个例子的坐标和标题。让我们在一个名为<code class="fe mz na nb nc b">placePins</code>的新函数中实现这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="8d1f" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">前两行设置了我们想要绘制的每个位置的坐标和标题。</li><li id="ec87" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">在<code class="fe mz na nb nc b">for</code>循环中，首先要做的是创建一个<code class="fe mz na nb nc b">MKPointAnnotation</code> <em class="nd"> </em>的新实例，并根据我们创建的变量指定它的坐标和标题。最后，该注记被添加到地图视图中。</li></ul><p id="88dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在地图已经可以使用了，通过在<code class="fe mz na nb nc b">viewDidLoad()</code>的末尾添加下面两行来添加对我们刚刚创建的两个方法的调用:</p><pre class="kj kk kl km gt ny nc nz oa aw ob bi"><span id="8094" class="oc md it nc b gy od oe l of og">self.configureMap()<br/>self.placePins()</span></pre><p id="94a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，地图视图将在应用程序启动时打开并添加注释，您将能够看到所有四个注释:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/3c14d8a387591420e03edb18e8f20c38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVcRiwo6f2mzC4WJ_oWwhQ.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="838a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">自定义注释颜色</h1><p id="607d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可能希望进行的最常见的样式更改是更改大头针的背景颜色。让我们从改变所有四个大头针的背景颜色开始。这可以通过指定由子类化<code class="fe mz na nb nc b">MKMapViewDelegate</code>提供的<code class="fe mz na nb nc b">viewFor</code>方法来实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="1f7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，<code class="fe mz na nb nc b">annotationView</code>被创建为一个新的注释视图，它的色调被更改为我们自定义的蓝色值。然后它会返回到地图视图。这将设置所有的引脚为蓝色:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/239b59ecbba7555494de8e835255499f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9813ckmACUAoOgtuXTgSig.png"/></div></div></figure><p id="60c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这很简洁，但我们可能不希望每个标记都是相同的颜色或相同的图标。定制每个大头针的一个简单方法是利用标记的标题来区分它们。</p><p id="7628" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了做到这一点，让我们为每个注释添加自定义颜色。我们将使用注释标题和一个<code class="fe mz na nb nc b">switch</code>语句来轻松区分注释。如果您不熟悉Swift中的<code class="fe mz na nb nc b">switch</code>声明，请参阅<a class="ae ky" href="https://docs.swift.org/swift-book/LanguageGuide/ControlFlow.html#ID129" rel="noopener ugc nofollow" target="_blank">官方文档</a>以了解所有相关信息。</p><p id="d30f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们定制这里的代码，通过用包含每个标记的<code class="fe mz na nb nc b">switch</code>语句替换行<code class="fe mz na nb nc b">annotationView.markerTintColor = UIColor.blue</code>,为所有标记添加自定义颜色:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="08e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们已经成功定制了每枚胸针的颜色:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/0a8e06a6c9d9c748d61a8c9170e11571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2U_y-Ds-rW8R6Z2xFpXfg.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="80b9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">自定义注释图标</h1><p id="fa63" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我最喜欢用注释定制的东西之一是字形图标。我通常在<a class="ae ky" href="https://icons8.com/" rel="noopener ugc nofollow" target="_blank">图标8 </a>或<a class="ae ky" href="https://www.flaticon.com/" rel="noopener ugc nofollow" target="_blank">平面图标</a>上找到图标，在这个例子中我将使用平面图标中的图标。我会在最后添加每个图标的创作者的信用。</p><p id="b7f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了保持简洁，我为您提取了图标，并将它们与源代码一起放在最后。在flaticon上找到我喜欢的图标后，我的工作流程是下载64px PNG版本，并添加创建者姓名的注释，以便我以后使用它时可以适当地给图标添加属性。</p><p id="6a81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将图标添加到资产文件夹后，我们要做的就是添加行<code class="fe mz na nb nc b">annotationView.glyphImage = UIImage(named: “{image-name}”)</code>。</p><p id="f0d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们已经有了一个<code class="fe mz na nb nc b">switch</code>语句，所以最简单的方法就是给每种情况添加适当的图像规范。我将在下面包含更新后的<code class="fe mz na nb nc b">switch</code>语句的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="3f11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，每个注释都有了自己的自定义图标。让我们看看这个是什么样子的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/5027aa9b654cac5889ce11a710192ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zhzn4cihpm9h9_amWcmUAQ.png"/></div></div></figure><p id="be0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以看到每个注释都有自己的自定义背景颜色和图标。好多了！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="55d0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">其他定制选项</h1><p id="4481" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">虽然颜色和图标是最常见的定制，你还可以改变更多！我将列出一些您可以轻松更改的其他有用内容:</p><ul class=""><li id="0c48" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">批注内图标的颜色是可定制的。默认情况下，图标是根据批注的背景颜色自动设置的。但是，如果您想改变它的默认颜色，您可以通过将<code class="fe mz na nb nc b">glyphTintColor</code>属性设置为任意颜色来实现。</li><li id="d38a" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">可以通过相应地编辑<code class="fe mz na nb nc b">titleVisibility</code>和<code class="fe mz na nb nc b">subtitleVisibility</code>属性来定制标题和副标题的可见性设置。</li><li id="7ea3" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">无论何时选择，注释都可以显示不同的图标。这可以通过为<code class="fe mz na nb nc b">selectedGlyphImage</code>属性指定一个图像来实现。</li></ul><p id="10ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要查看可以用注释定制的所有内容的详尽列表，请查看<a class="ae ky" href="https://developer.apple.com/documentation/mapkit/mkmarkerannotationview" rel="noopener ugc nofollow" target="_blank">苹果开发者文档</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f33c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">包扎</h1><p id="4de3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢阅读！我希望这对你有帮助。如果您有任何问题，请随时发表评论。另外，请在评论中让我知道你最常用的注释样式定制！</p><p id="9e0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将这个项目的所有内容存储在GitHub仓库中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9b05" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">信用</h1><ul class=""><li id="0e84" class="nf ng it lb b lc mu lf mv li nt lm nu lq nv lu nk nl nm nn bi translated">布鲁克林大桥图标由来自<a class="ae ky" href="http://www.flaticon.com" rel="noopener ugc nofollow" target="_blank"> flaticon </a>的<a class="ae ky" href="https://www.flaticon.com/authors/freepik" rel="noopener ugc nofollow" target="_blank"> Freepik </a>制作。</li><li id="5d27" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">由<a class="ae ky" href="https://www.flaticon.com/authors/eucalyp" rel="noopener ugc nofollow" target="_blank">桉树</a>制成的中央公园图标来自<a class="ae ky" href="http://www.flaticon.com" rel="noopener ugc nofollow" target="_blank">扁平图标</a>。</li><li id="2be9" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">帝国大厦图标由来自<a class="ae ky" href="http://www.flaticon.com" rel="noopener ugc nofollow" target="_blank"> flaticon </a>的<a class="ae ky" href="https://www.flaticon.com/authors/freepik" rel="noopener ugc nofollow" target="_blank"> Freepik </a>制作。</li><li id="adb8" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">来自<a class="ae ky" href="http://www.flaticon.com" rel="noopener ugc nofollow" target="_blank"> flaticon </a>的<a class="ae ky" href="https://www.flaticon.com/authors/nikita-golubev" rel="noopener ugc nofollow" target="_blank"> Nikita Golubev </a>制作的自由女神像图标。</li></ul></div></div>    
</body>
</html>