<html>
<head>
<title>Cohort Analysis with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python进行队列分析</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/cohort-analysis-with-python-e81d9d740a9b?source=collection_archive---------1-----------------------#2019-08-18">https://betterprogramming.pub/cohort-analysis-with-python-e81d9d740a9b?source=collection_archive---------1-----------------------#2019-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="520e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">或者如何可视化您的客户保持——代码指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c9dacc0931440dba2f39e72f07fde4ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5wFumdeVZRq7SnxZ_tMkA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">样品保留矩阵—跟随并了解如何创建您自己的矩阵</p></figure><p id="b325" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我经常面临的一个问题是，“我们的同伴是什么样子的？”投资者用这个问题的答案来更好地理解他们客户的终身价值。管理层使用它来识别表现良好的群体及其共同特征，以便他们可以专注于这些客户。金融也可以用它，在一定程度上，进行预测。</p><p id="f0b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">你将从这篇文章中学到什么:</strong></p><ul class=""><li id="40c7" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">什么是群组？</li><li id="7d5d" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">队列是什么样子的？</li><li id="2b1e" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">如何生成虚拟数据？</li><li id="4f21" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">如何构建将生成群组的函数？</li><li id="0863" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">一些值得注意的Python技术</li></ul><p id="0cbc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">先决条件:</strong></p><p id="d96c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文旨在作为一篇代码文章，因此您应该拥有:</p><ul class=""><li id="4139" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">对Python的基本理解</li><li id="d73d" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">开发环境(我推荐Jupyter笔记本/实验室)</li></ul></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="fd44" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated"><strong class="ak">什么是群组？</strong></h1><p id="a782" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh nj lj lk ll nk ln lo lp nl lr ls lt im bi translated">在谈论它们看起来如何之前，我们应该花一些时间来了解什么是群组。</p><blockquote class="nm nn no"><p id="19f2" class="ky kz np la b lb lc ju ld le lf jx lg nq li lj lk nr lm ln lo ns lq lr ls lt im bi translated"><a class="ae nt" href="https://en.wikipedia.org/wiki/Cohort_(statistics)" rel="noopener ugc nofollow" target="_blank">在统计学、市场营销和人口统计学中，群组是具有共同定义特征的一组受试者(通常是在选定时间段内经历了共同事件的受试者，如出生或毕业)。</a></p></blockquote><p id="c624" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在商业环境中，群组通常是在给定时间间隔内(通常是几个月，但这取决于你的商业模式)第一次购买的一组客户。</p><p id="19f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">群组有助于理解特定客户群在其生命周期中是如何发展的。群组可能回答的问题有:</p><ul class=""><li id="9915" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">是否存在高流失率？(后续预订/购买的数量较低就表明了这一点。)</li><li id="6279" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">随着时间的推移，客户会变得更加投入吗？(这可能表现在客户与您在一起的时间越长，预订/购买就越频繁。)</li></ul></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="0cfd" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated"><strong class="ak">队列是什么样子的？</strong></h1><p id="27a8" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh nj lj lk ll nk ln lo lp nl lr ls lt im bi translated">我喜欢用保留矩阵来表示团队的发展。左侧显示了该群组中新客户的数量，右侧显示了该群组中重复订单的百分比，在中间，我们找到了所选指标的保留矩阵。请注意，有多种可视化群组发展的方式，但这种方式对我很有效。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c9dacc0931440dba2f39e72f07fde4ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5wFumdeVZRq7SnxZ_tMkA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">样品保留矩阵(使用python函数生成，样品数据)</p></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="454e" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated"><strong class="ak">如何生成</strong> <strong class="ak">虚拟数据</strong>？</h1><ol class=""><li id="e053" class="lu lv it la b lb nh le ni lh nu ll nv lp nw lt nx ma mb mc bi translated">让我们从Python导入开始。这些是我们稍后将使用的包。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="3cd0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你很可能必须通过运行<a class="ae nt" href="https://pypi.org/project/names/" rel="noopener ugc nofollow" target="_blank">来安装</a>和<a class="ae nt" href="https://seaborn.pydata.org/installing.html" rel="noopener ugc nofollow" target="_blank"> seaborn </a>(在你的笔记本上)。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="a29e" class="of mq it ob b gy og oh l oi oj">!pip install seaborn<br/>!pip install names</span></pre><p id="c605" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.设置一些种子数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="2548" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe ok ol om ob b">ADJECTIVES</code>、<code class="fe ok ol om ob b">PEOPLE</code>、<code class="fe ok ol om ob b">PRODUCTS</code>都是大写的。在Python中，这种符号通常用于静态变量和/或模块设置。</p><p id="a003" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意对于<code class="fe ok ol om ob b">PEOPLE</code>，我们使用了所谓的<a class="ae nt" href="https://medium.com/better-programming/list-comprehension-in-python-8895a785550b" rel="noopener">列表理解</a>，这是Python中一个非常强大的概念。在我们的例子中，我们调用函数<code class="fe ok ol om ob b">names.get_first_name()</code> 10，000次，并将唯一的结果放入<code class="fe ok ol om ob b">PEOPLE</code>列表中。</p><p id="ab23" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.构建一些辅助函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="cf09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.构建虚拟数据函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="5fd3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.生成虚拟数据帧。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="f6c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该函数基于<code class="fe ok ol om ob b">dummy_products</code>和<code class="fe ok ol om ob b">dummy_customers</code>生成一个样本熊猫数据帧。还有一些额外的参数可以设置，但不是必须设置(比如<code class="fe ok ol om ob b">data_points</code>，它指定了结果数据帧中的行数)。同样，我们利用列表理解。</p><p id="64b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们创建虚拟数据帧:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="6187" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们的虚拟数据具有以下形式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/be25fce1b7c0375160fa64ad0b390a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*YEuIZ4IUTxjv1gUPkeh-dg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由“generate_dummy_data”生成的DF的前几行的屏幕截图</p></figure><p id="8e6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">6.用订单类型和首次订单的时间充实虚拟数据</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="8b76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们现在已经完成了样本数据的生成。通过更改参数并再次运行数据，您可以随意使用这些函数。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="0c0a" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated"><strong class="ak">如何构建将生成群组的函数</strong></h1><p id="79b3" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh nj lj lk ll nk ln lo lp nl lr ls lt im bi translated">我们确实需要一些辅助函数来进行群组分析；以下两个函数以下划线为前缀。在Python中，这意味着该函数供内部使用。在我们的例子中，这些函数被我们的实际函数<code class="fe ok ol om ob b">generate_cohort_analysis</code>调用，以使所述函数更具可读性。</p><p id="849f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，将下面的代码块复制粘贴到Jupyter笔记本中，并运行该单元。这些功能变得可用，但暂时忽略它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="206d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下函数生成群组可视化:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="203d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以用不同的参数运行它(见下面的例子)。我会在示例后解释参数。要创建群组分析，您只需运行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1c7a71e0ee8c409edda6cbbffe98ef32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kiv0s__T4IuOrtyqsjSQfQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">generate_cohort_analysis(df=df，metric= '订单数量')</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c9a707247172a266dce1e94033ee6d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xnSar7EShtUodvIvQaCgdg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">generate_cohort_analysis(df=df，metric= '订单数量'，period_agg= '每月')</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/16be6ef78e53690cc8e32ed4398ebebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vaUwBYQAQ_6uxVZ3FijdRw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">generate_cohort_analysis(df=df，metric = ' number _ of _ items _ built ')</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/37300a7b30e20ac008ec28977608d8c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h45UFi300eCzGVigpSM7ow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">generate_cohort_analysis(df=df，metric = ' number _ of _ items _ buyed '，<br/> record_type='private ')</p></figure><p id="132a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了理解细节，让我们稍微分解一下。</p><h2 id="90cd" class="of mq it bd mr op oq dn mv or os dp mz lh ot ou nb ll ov ow nd lp ox oy nf oz bi translated">generate_ <code class="fe ok ol om ob b">cohort_anlysis</code>是如何工作的？</h2><p id="264b" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh nj lj lk ll nk ln lo lp nl lr ls lt im bi translated">它使用:</p><ul class=""><li id="5191" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">一个<code class="fe ok ol om ob b"><strong class="la iu">df</strong></code> <strong class="la iu"> </strong>参数<strong class="la iu"> </strong>(这只是我们之前创建的哑数据)，</li><li id="e674" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">一个<code class="fe ok ol om ob b"><strong class="la iu">metric</strong></code> <strong class="la iu"> </strong>参数<strong class="la iu"> </strong>(表示您感兴趣的度量，在我们的例子中:<code class="fe ok ol om ob b">number_of_orders</code>、<code class="fe ok ol om ob b">number_of_items_bought</code>或<code class="fe ok ol om ob b">total_order_value</code>)</li><li id="8e64" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">一个(可选的)<code class="fe ok ol om ob b">record_type</code>参数，default= <code class="fe ok ol om ob b">all</code>(它允许您细分我们的样本数据，并且只查看特定的组，在我们的示例中是:<code class="fe ok ol om ob b">all</code>、<code class="fe ok ol om ob b">private</code>、<code class="fe ok ol om ob b">company</code>或<code class="fe ok ol om ob b">government</code>)</li><li id="889b" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">an(可选)<code class="fe ok ol om ob b">period_agg parameter</code>，default= <em class="np"> </em> <code class="fe ok ol om ob b">quarterly</code>(让您选择<code class="fe ok ol om ob b">monthly</code>或<code class="fe ok ol om ob b">quarterly</code>作为群组)</li><li id="c5c7" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">一个(可选)<code class="fe ok ol om ob b">fig</code>参数，默认= <code class="fe ok ol om ob b">True</code>(定义是否应该产生一个图形或实际数据)</li><li id="d1bc" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">一个(可选)<code class="fe ok ol om ob b">save_fig</code>参数，默认= <code class="fe ok ol om ob b">True</code>(定义结果图是否应该保存在磁盘上)</li><li id="7d12" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><code class="fe ok ol om ob b">size</code>参数(可选)，默认= <code class="fe ok ol om ob b">10</code> <strong class="la iu"> </strong>(该参数定义了标注的大小)</li></ul><p id="b979" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用丰富的样本数据运行该函数，并选择一个可用的指标，您将看到新客户的可视化效果、该指标的保留矩阵以及每个群组的返回率。</p><p id="c4de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想在交互式笔记本中测试代码，点击<a class="ae nt" href="https://mybinder.org/v2/gh/FBosler/Cohorts/master" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>