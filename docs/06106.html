<html>
<head>
<title>How to Add Core Image Filters in SwiftUI VideoPlayer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SwiftUI VideoPlayer中添加核心图像滤镜</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swiftui-video-player-real-time-processing-with-core-image-ef0688745c57?source=collection_archive---------11-----------------------#2020-09-02">https://betterprogramming.pub/swiftui-video-player-real-time-processing-with-core-image-ef0688745c57?source=collection_archive---------11-----------------------#2020-09-02</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="faca" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">纯SwiftUI视频播放器应用程序中的实时图像处理。</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/2da8a97f6d41600c3a26ab4765c95aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pScxZaryKYXuqu1RIkcTfA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图片来源:作者</p></figure><p id="238d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">iOS 14中的SwiftUI引入了播放电影文件的原生支持。新的<code class="fe lv lw lx ly b">VideoPlayer</code>控件允许你从URL或本地资源播放电影文件。</p><p id="6bdd" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">你需要做的就是<code class="fe lv lw lx ly b">import AVKit</code>并传递<code class="fe lv lw lx ly b">AVPlayer</code>的实例，如下所示:</p><pre class="kk kl km kn gu lz ly ma mb aw mc bi"><span id="4033" class="md me iu ly b gz mf mg l mh mi">VideoPlayer(player: AVPlayer(url: enter_url_here)</span></pre><p id="db8f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe lv lw lx ly b">VideoPlayer</code>在设备上运行良好，但可能会导致模拟器出现问题，尤其是从web URL加载时。</p><p id="5bb4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您还可以在视频播放器上添加自定义叠加SwiftUI视图。在撰写本文时，不可能摆脱默认的回放控制。</p><p id="23fe" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">值得注意的是，YouTube的网址在<code class="fe lv lw lx ly b">AVPlayer</code>无法使用，因为它们完全是电影文件。</p><p id="5c97" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe lv lw lx ly b">VideoPlayer</code>打开了在纯SwiftUI应用中进行视频处理的大门。这意味着你可以用不到50行代码编写一个智能的基于人工智能的视频播放器。</p><p id="a95d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在接下来的章节中，我们将看到如何对<code class="fe lv lw lx ly b">VideoPlayer</code>应用过滤器，并将实现一组核心图像过滤器来实时运行电影文件。</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="1bdb" class="mq me iu bd mr ms mt mu mv mw mx my mz ka na kb nb kd nc ke nd kg ne kh nf ng bi translated">如何在SwiftUI VideoPlayer中访问视频帧</h1><p id="9a35" class="pw-post-body-paragraph kz la iu lb b lc nh jv le lf ni jy lh li nj lk ll lm nk lo lp lq nl ls lt lu in bi translated">从AV播放器获取视频帧的最常见方式是使用<code class="fe lv lw lx ly b">AVPlayerItemVideoOutput</code>。为此，我们通常会使用<code class="fe lv lw lx ly b">CADisplayLink</code>计时器在特定时间间隔后获取帧。</p><p id="2896" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">但是<code class="fe lv lw lx ly b">CADisplayLink</code>在SwiftUI中不支持原生监听器。如果没有UIKit，监听变化的选择器就无法工作。</p><p id="7079" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">因此，我们会选择另一个选项，即<code class="fe lv lw lx ly b">AVVideoComposition</code>。</p><p id="54ee" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe lv lw lx ly b">AVVideoComposition</code>包含每帧的像素缓冲区。通过在<code class="fe lv lw lx ly b">AVPlayerItem</code>属性上设置它，我们可以检索帧并应用<code class="fe lv lw lx ly b">CIFilter</code>给视频一个完全不同的外观。</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="5212" class="mq me iu bd mr ms mt mu mv mw mx my mz ka na kb nb kd nc ke nd kg ne kh nf ng bi translated">在SwiftUI中对视频流应用CIFilter</h1><p id="1fe5" class="pw-post-body-paragraph kz la iu lb b lc nh jv le lf ni jy lh li nj lk ll lm nk lo lp lq nl ls lt lu in bi translated">让我们创建一个新的SwiftUI项目，并向其中添加以下内容:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div></figure><p id="d44d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">上面的代码中主要发生了两件事:</p><ul class=""><li id="801d" class="no np iu lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated"><code class="fe lv lw lx ly b">AVPlayerItem</code>包含<code class="fe lv lw lx ly b">videoComposition</code>属性，我们将在其上设置<code class="fe lv lw lx ly b">AVVideoComposition</code>的实例。在<code class="fe lv lw lx ly b">AVVideoComposition</code>内部，我们传递类型为<code class="fe lv lw lx ly b">AVAsset</code>的<code class="fe lv lw lx ly b">media</code>属性。</li><li id="0155" class="no np iu lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><code class="fe lv lw lx ly b">applyingCIFiltersWithHandler</code>是对每一帧进行图像处理的地方。我们正在设置将<code class="fe lv lw lx ly b">sourceImage</code>传递到当前选择的<code class="fe lv lw lx ly b">CIFilter</code>(从<code class="fe lv lw lx ly b">SegmentedControl</code>中选择)。</li></ul><p id="dde7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们在一个本地视频上运行了上面的应用程序，用四个<code class="fe lv lw lx ly b">CIFilters</code>得到了下面的结果:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oc"><img src="../Images/14e817b2bb387e8fa5108d71d23f9948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-EjT1PiUSAK9IrQ0K_caCQ.gif"/></div></div></figure><p id="934c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您可以添加更多滤镜，并设置滑块控制以使用不同的强度。添加远程视频URL几乎与使用本地视频URL一样流畅(如果网络连接良好)。</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="6f6b" class="mq me iu bd mr ms mt mu mv mw mx my mz ka na kb nb kd nc ke nd kg ne kh nf ng bi translated">结论</h1><p id="6905" class="pw-post-body-paragraph kz la iu lb b lc nh jv le lf ni jy lh li nj lk ll lm nk lo lp lq nl ls lt lu in bi translated">SwiftUI应用程序的完整源代码可以在<a class="ae od" href="https://github.com/anupamchugh/iOS14-Resources/tree/master/SwiftUIVideoPlayerCoreImage" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>中找到。</p><p id="a226" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">SwiftUI <code class="fe lv lw lx ly b">VideoPlayer</code>开启了许多惊人效果的大门，比如应用风格转移。</p><p id="eb4b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这一次到此为止。感谢阅读。</p></div></div>    
</body>
</html>