<html>
<head>
<title>HTTP/3 Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTTP/3解释</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/http-3-explained-4bc4e7d31c26?source=collection_archive---------7-----------------------#2022-08-30">https://betterprogramming.pub/http-3-explained-4bc4e7d31c26?source=collection_archive---------7-----------------------#2022-08-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d761" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">它是什么，有何不同，以及它的发展方向</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/df50660359f2c9721ebedc329289eba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6uulT6fl_iA8cw1_3QjRpg.jpeg"/></div></div></figure><p id="f0d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">今天我们将学习HTTP/3——我们从何而来，它与以前的协议有何不同，以及它的发展方向。我从curl的发明者Daniel Stenberg的<a class="ae ln" href="https://www.youtube.com/watch?v=ai8cf0hZ9cQ" rel="noopener ugc nofollow" target="_blank">精彩演讲</a>中学到了大部分信息。这个<a class="ae ln" href="https://www.youtube.com/watch?v=ai8cf0hZ9cQ" rel="noopener ugc nofollow" target="_blank">高性能编程视频</a>更新了我对一些最新HTTP/3的知识。</p><p id="cf61" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">主要的收获是HTTP/3在一个新的传输层(QUIC)上运行，因此在几个基本方面改进了传统的HTTP。它应该更快、更安全、更可靠。</p><h1 id="b47b" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">它从哪里来的？</h1><p id="500d" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">在我们讨论HTTP/3如何改进以前的版本之前，我们应该了解该协议的历史。</p><p id="6ce5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最初的HTTP于1991年问世，没有版本(现在称为HTTP/0.9)。它非常简单——没有标题，响应是一个HTML文件，唯一的方法是<code class="fe ml mm mn mo b">GET</code>。</p><p id="144e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">HTTP/1.0于1996年问世，以使协议更具可扩展性。它带来了版本信息、状态代码和传输元数据的头。它还扩展了简单的HTML文件返回，增加了我们今天都知道和喜欢的<code class="fe ml mm mn mo b">Content-Type</code>头。</p><p id="fe06" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，HTTP/1.0还有一些需要改进的地方。客户端和服务器之间的每个请求/响应都需要一个唯一的TCP连接，这会显著增加页面加载的延迟，尤其是在需要多个资源时。</p><p id="8d21" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">客户端通过并行使用多个TCP连接来解决这个问题，但是这是资源密集型的。从必须在客户端和服务器之间进行TLS握手开始，每个连接仍然有很长的等待时间。</p><p id="665c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">HTTP/1.1于第二年问世，具有使用许多并行TCP连接的能力。连接也可以重用(避免了在HTTP/1.0中必须不断关闭和重新打开这些连接的开销)，并且添加了管道和分块来进一步提高性能。</p><p id="3d7b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，这带来了一个行首(HOL)阻塞味道。随着网站变得越来越复杂，客户端很快用完了可用的TCP连接。因此，新的请求/响应周期必须等待现有请求完成，然后才能使用连接。</p><p id="5a65" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">HTTP/2是2015年为了提高性能而出来的。它从传输文本转变为发送二进制文件，并引入了流的概念来提高并行请求的性能。通过多路复用一个TCP连接，客户机可以发送许多并行请求，而不会耗尽连接，也不会面临来自HTTP/1.1的HOL阻塞。然而，HOL阻塞仍然是一个问题。它刚刚从应用层转移到传输层。</p><p id="07f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果数据在TCP上丢失，协议将重新发送丢失数据的数据包。因此，TCP连接上的其他数据(读:其他流)必须等待这些数据包被成功传递。由于流是在单个TCP连接上复用的，因此如果一个流丢失数据，所有流都必须暂停，等待数据重新传输。在有损耗的网络上，这可能会导致真正的问题。</p><h1 id="1a80" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">我们为什么要升级？</h1><p id="ebd6" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">HTTP/2总体上为我们提供了很好的服务，但是由于HTTPS TLS握手，它遭受了行首阻塞和相当大的开销。这导致了延迟或网站响应不及时的感觉。随着越来越多的软件转移到web上，向用户提供一个响应迅速、几乎像本地应用程序一样的体验变得越来越重要。</p><p id="c4fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，这些问题在有损耗的网络或客户端和服务器之间的长距离的任何地方都会加剧。有损网络将丢失更多的数据，需要更多的数据包重新传送，加剧了HOL问题。长时间的通信跳跃延迟了HTTPS所要求的来回握手。</p><p id="b3be" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最重要的是，我们是人。我们对建设、改进和进步有着永不满足的需求。</p><h1 id="c2f4" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">HTTP/3有什么不同？</h1><p id="62b1" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">HTTP/3将TCP/TLS替换为传输层，并用QUIC(“快速UDP互联网连接”)取而代之。QUIC“免费”给我们流(它是传输层的一部分，而不是应用层)，它允许我们在上面构建任何协议(HTTP是第一个例子)。HTTP请求/响应流通常是相同的，但是网络上的传输是不同的。它是基于多路复用QUIC的二进制(建立在UDP之上)，而以前，我们是基于TCP的二进制多路复用。</p><p id="94dd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">也让HTTP/3快了很多！握手要快得多，客户端可以比以前更快地开始发送请求和接收响应。这大大减少了启动延迟，并使网页感觉更敏感。默认情况下提供加密和身份验证，建立连接需要一次往返，而不是多次往返。</p><p id="dc20" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为HTTP/3现在是“多路复用QUIC上的二进制”，所以流是相互独立的。这在很大程度上缓解了行首阻塞问题，因为如果单个流遭受分组丢失，它不会延迟其他流。如果一个流丢失了数据，丢失的包将只在该流中恢复。QUIC可以做到这一点，因为它是建立在UDP之上的，UDP不强制在协议层重新发送数据包。</p><p id="e4d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，QUIC可以更智能地选择重新发送数据的方式和时间。这也允许将来的改进，比如在同一个连接上有损和无损的独立流！</p><p id="3da8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这结合了理想网络条件下的可靠性能改进和折衷情况下的巨大改进。接下来的基准测试显示了当前的性能改进如何随着网站规模/复杂性和客户端/服务器距离而扩展。</p><p id="7951" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">测试是在一个小型网站(“小型”)、一个内容丰富的网站(“中型”)和一个单页面应用程序(“大型”)上进行的(更多细节请参见上面的链接)。它们是在三个距离上完成的:“短”是纽约到明尼苏达州，“中”是纽约到英国伦敦，“长”是纽约到印度班加罗尔。下面是从HTTP/2 -&gt; HTTP/3迁移而来的速度提升:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="4c0c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">随着客户机/服务器距离的增加，减速带会变得非常大。我们还可以看到，内容丰富的网站(可以说比“小”网站更能代表现代网络)受益最大。</p><h1 id="6ec0" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">HTTP/3面临的挑战</h1><p id="85fa" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">HTTP/3并非没有挑战，我们将在这里简单讨论一下。请注意，其中一些问题可能已经解决，因为这些信息主要来自丹尼尔2019年的演讲。</p><h2 id="32d3" class="mr lp iq bd lq ms mt dn lu mu mv dp ly la mw mx ma le my mz mc li na nb me nc bi translated">一些QUIC请求失败</h2><p id="3765" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">这主要是由于各种实体阻止了UDP流量。由于QUIC在幕后使用UDP，这看起来像是拒绝服务(DOS)攻击，许多网络管理员会阻止这种攻击。这在高度警惕的企业网络上可能会更糟，以避免DDOS(分布式DOS)攻击。</p><h2 id="d871" class="mr lp iq bd lq ms mt dn lu mu mv dp ly la mw mx ma le my mz mc li na nb me nc bi translated">客户端必须能够依靠以前的HTTP版本</h2><p id="3cd4" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">QUIC拒绝可能是基于位置的——在家里可能不是问题，但当地的咖啡店可能会阻止UDP流量。因此，客户端必须能够依靠旧版本的HTTP才能成功通信。</p><h2 id="fe5a" class="mr lp iq bd lq ms mt dn lu mu mv dp ly la mw mx ma le my mz mc li na nb me nc bi translated">HTTP/3是CPU密集型的</h2><p id="911c" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">截至2019年，HTTP/3将消耗2–3倍的CPU来提供与以前协议相同的流量。这部分是因为网络库不太适合UDP(他们花了几十年的时间来微调TCP)，部分是因为缺乏专用硬件(想想ASICs)。</p><h2 id="e49d" class="mr lp iq bd lq ms mt dn lu mu mv dp ly la mw mx ma le my mz mc li na nb me nc bi translated">UDP堆栈未经优化</h2><p id="53ac" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">这是前面提到的CPU利用率增加的部分原因。没有人为UDP优化软件和硬件堆栈的力度与他们为TCP优化的力度相同。这将随着时间的推移而改善！</p><h2 id="63e3" class="mr lp iq bd lq ms mt dn lu mu mv dp ly la mw mx ma le my mz mc li na nb me nc bi translated">“有趣的”TLS层</h2><p id="a3cc" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我们需要更新所有相关的TLS库来支持新标准和新API。自2019年以来，这可能取得了重大进展，但这不是一项容易的任务。</p><h2 id="e97e" class="mr lp iq bd lq ms mt dn lu mu mv dp ly la mw mx ma le my mz mc li na nb me nc bi translated">所有QUIC堆栈都是用户土地</h2><p id="c6f0" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">QUIC建立在UDP之上，这意味着所有的数据包都被复制到用户空间。这种复制的增加伴随着资源利用率的增加。也许它可以集成到内核中(理解为:多个内核，无处不在)，但这可能非常困难。</p><h1 id="1571" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">缺少工具</h1><p id="af47" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">Wireshark对此了如指掌，但我们还需要其他工具。我们已经习惯了分段数字和特定的窗口大小，所有这些都被QUIC机制所取代。</p><h1 id="e736" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">那么，我们今天在哪里？</h1><p id="a45e" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">据<a class="ae ln" href="https://caniuse.com/http3" rel="noopener ugc nofollow" target="_blank">can use</a>介绍，Firefox、Edge、Chrome默认都支持HTTP/3。Safari还没有，但是可以在实验功能中启用。同样，在Android上，各种浏览器默认支持它，在iOS上，它在一个功能标志后面。目前，<a class="ae ln" href="https://w3techs.com/technologies/details/ce-http3" rel="noopener ugc nofollow" target="_blank">大约有四分之一的网站支持HTTP/3 </a>，我们可以看到这一趋势正在上升。</p><p id="d320" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">HTTP/3已经产生了现实世界中人类可以察觉的差异，随着UDP栈的优化，这种差异可能会得到改善。它带来了性能、可靠性和安全性的升级，但并非没有挑战。现在还为时尚早，但我对一个更安全、性能更好、对有损耗的网络更有弹性的互联网感到兴奋。我也很高兴看到QUIC的发展方向以及基于它的未来应用。</p><p id="b5d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nd">感谢阅读。敬请关注更多内容！</em></p></div></div>    
</body>
</html>