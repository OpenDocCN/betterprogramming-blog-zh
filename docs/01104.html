<html>
<head>
<title>Simple Git Hooks with Create React App, ESLint, and Husky</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Create React App、ESLint和Husky的简单Git挂钩</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/simple-git-hooks-with-create-react-app-eslint-and-husky-6983806dba5c?source=collection_archive---------2-----------------------#2019-08-14">https://betterprogramming.pub/simple-git-hooks-with-create-react-app-eslint-and-husky-6983806dba5c?source=collection_archive---------2-----------------------#2019-08-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e3cf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的Git挂钩自动运行您的测试和lint代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/90057ea98e69a0ded04729d0e99a1ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IvYk-x47FUOOBcq5eji5pQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@brookanderson" rel="noopener ugc nofollow" target="_blank">布鲁克·安德森</a>在<a class="ae ky" href="https://unsplash.com/photos/gTQbZXL417Q" rel="noopener ugc nofollow" target="_blank">上拍摄的照片</a></p></figure><p id="28fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Git挂钩是Git在提交、推送等事件之前或之后执行的脚本。在Git允许您签入代码之前，这是一种非常酷且快速的验证代码的方式。</p><p id="9e4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看一个使用Husky库在React应用程序上实现Git挂钩的简单示例。然后，我们将创建一个Git挂钩，通过在每次提交之前针对您的代码调用ESLint来验证您的更改。</p><p id="2d5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">惟一的先决条件是在您的机器上安装了Node (well和Git)。我将假设您知道如何创建Git存储库。将您的存储库放入您计划放置React应用程序的目录中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1d10" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><p id="c5e4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">先说React app。网上有很多用React创建应用程序的模板，但最流行的是脸书自己的Create React应用程序。</p><p id="9ad4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Create React App不需要任何配置，只需一个命令即可创建一个非常简单的React应用程序:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a5f5" class="ne md it na b gy nf ng l nh ni">npx create-react-app my-app-name</span></pre><p id="aa74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您应该有了React应用程序。如果您想验证一切正常，您可以从您的终端运行<code class="fe nj nk nl na b">`npm run start`</code>并导航到<a class="ae ky" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b6ca" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置ESLint和Husky</h1><p id="2917" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">好了，现在是有趣的部分。让我们设置ESLint和Husky。</p><p id="a85a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过从您的终端运行<code class="fe nj nk nl na b">“npm install -g eslint”</code>在您的机器上全局安装ESLint。</p><p id="7bcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，导航到您的React应用程序的根目录；这是<code class="fe nj nk nl na b">package.json</code>文件所在的地方。从你的终端启动ESLint。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b2b5" class="ne md it na b gy nf ng l nh ni">eslint --init</span></pre><p id="87b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回答关于你的ESLint用法的问题，比如你正在使用的框架，你的代码风格等等。随着ESLint的发展，这组问题也在不断变化，所以我不打算在这里发布。毕竟，再过几个月，它们可能就过时了。</p><p id="564c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请确保为您的框架选择React。</p><p id="a1ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，你会问这样一个问题，“你想如何为你的项目定义一种风格？”选择:“使用流行的风格指南。”</p><p id="7aaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会得到一个后续的问题，“你想遵循哪个风格指南？”选择:<a class="ae ky" href="https://github.com/standard/standard" rel="noopener ugc nofollow" target="_blank">标准</a></p><p id="7ff8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您现在通过从终端运行<code class="fe nj nk nl na b">“eslint src/**/*.js”</code>来运行ESLint，您会看到相当多的错误和警告(可能超过50个)。</p><p id="5231" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们修理他们！</p><p id="0954" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数错误(90%)可以由ESLint自己修复，所以运行ESLint时要有一个修复标志:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="80b0" class="ne md it na b gy nf ng l nh ni">eslint --fix src/**/*.js</span></pre><p id="1f49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该只剩下一些错误，它们应该是这样的:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="718d" class="ne md it na b gy nf ng l nh ni">1:8 error ‘React’ is defined but never used no-unused-vars</span><span id="94d6" class="ne md it na b gy nm ng l nh ni">3:8 error ‘App’ is defined but never used no-unused-vars</span><span id="ccba" class="ne md it na b gy nm ng l nh ni">5:1 error ‘it’ is not defined no-undef</span></pre><p id="942d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了修复这些错误，我们必须告诉ESLint考虑到我们的应用程序正在Create React应用程序上运行，并且我们正在使用Jest作为测试运行程序。</p><p id="00a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开您的ESLint配置文件，可能名为<code class="fe nj nk nl na b">.eslintrc</code>。根据您选择的配置格式，您的文件名可能会有所不同。我推荐JSON格式。</p><p id="9ece" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要在<code class="fe nj nk nl na b">.eslintrc</code>文件中做一些定制</p><p id="9daf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nj nk nl na b">“env”:</code>部分，添加<code class="fe nj nk nl na b">jest</code>。不添加<code class="fe nj nk nl na b">jest</code>会使ESLint错误出现在Jest特有的函数上，如<code class="fe nj nk nl na b">describe</code>和<code class="fe nj nk nl na b">it</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="484c" class="ne md it na b gy nf ng l nh ni">"env": {</span><span id="3b1d" class="ne md it na b gy nm ng l nh ni">  "browser": true,</span><span id="ed55" class="ne md it na b gy nm ng l nh ni">  "es6": true,</span><span id="f109" class="ne md it na b gy nm ng l nh ni">  "jest": true<br/>}</span></pre><p id="46bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nj nk nl na b">“extends”:</code>部分，添加<code class="fe nj nk nl na b">“plugin:react/recommended”</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1d98" class="ne md it na b gy nf ng l nh ni">"extends": [</span><span id="1a7a" class="ne md it na b gy nm ng l nh ni">  "standard",</span><span id="7e70" class="ne md it na b gy nm ng l nh ni">  "plugin:react/recommended"</span><span id="dacf" class="ne md it na b gy nm ng l nh ni">]</span></pre><p id="7757" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你都准备好了。如果您现在尝试运行ESLint，它将会无错误地通过。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6fe8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一些额外的定制</h1><p id="8db2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您真的不想总是从终端手动运行linter，请添加运行linter的npm脚本:</p><p id="b432" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<code class="fe nj nk nl na b">package.json</code>文件。在<code class="fe nj nk nl na b">“scripts”:</code>部分，添加新的ESLint脚本。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="39a8" class="ne md it na b gy nf ng l nh ni">“scripts”: {<br/>  ...</span><span id="3e0f" class="ne md it na b gy nm ng l nh ni">“lint”: “eslint src/**/*.js”,</span><span id="ee0a" class="ne md it na b gy nm ng l nh ni">“lint:fix”: “eslint --fix src/**/*.js”</span><span id="7e6f" class="ne md it na b gy nm ng l nh ni">},</span></pre><p id="5375" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过调用以下命令使用npm运行这些脚本:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="163a" class="ne md it na b gy nf ng l nh ni">npm run lint</span><span id="cd83" class="ne md it na b gy nm ng l nh ni">npm run lint:fix</span></pre><p id="a079" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，您应该已经准备好使用ESLint了。现在使用Husky设置Git挂钩真的很容易。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ed80" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置Husky</h1><p id="0ff6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后一部分，我们最后来设置哈士奇吧！</p><p id="bec2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导航到根目录安装Husky(这是<code class="fe nj nk nl na b">package.json</code>所在的目录)。打开终端并运行:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ff08" class="ne md it na b gy nf ng l nh ni">npm install husky --save-dev</span></pre><p id="a36a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功安装后，将您的<code class="fe nj nk nl na b">“husky”:</code>部分添加到您的<code class="fe nj nk nl na b">package.json</code>文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="9e87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了用于提交和推送操作的Git挂钩。</p><p id="8012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每次运行Git commit时，Husky都会运行一个预提交脚本(<code class="fe nj nk nl na b">“npm run lint:fix”</code>)，并且只在验证通过时才允许您提交更改。这与Git推送的方式类似。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3ac5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最后一件事</h1><p id="5608" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果我们想在提交前和推送前运行测试和lint脚本(或任何其他更复杂的脚本)，该怎么办？</p><p id="e60e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过在<code class="fe nj nk nl na b">package.json</code>中添加一个新脚本来实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="acec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置<code class="fe nj nk nl na b">CI=true</code>是为了确保Jest只运行一次测试，并且不会在监视模式下运行测试，因为监视模式对Git挂钩没有意义。</p><p id="28d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">顺便说一下，上面的语法是针对Windows的。在Mac上，应该是这样的:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6fca" class="ne md it na b gy nf ng l nh ni">“test:all”: “CI=true react-scripts-ts test &amp;&amp; npm run lint”</span></pre><p id="171f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要做的就是为预提交或预推送挂钩使用一个新的脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="6f5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你！现在您有了Git挂钩，它将在您每次提交代码时自动运行您的测试并lint您的代码。</p><p id="d880" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很方便，是吧？</p></div></div>    
</body>
</html>