<html>
<head>
<title>How to Add Flow Types to Objects in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中向对象添加流类型</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/javascript-type-checking-with-flow-objects-1eb7fca4032e?source=collection_archive---------24-----------------------#2020-02-04">https://betterprogramming.pub/javascript-type-checking-with-flow-objects-1eb7fca4032e?source=collection_archive---------24-----------------------#2020-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ff91" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从脸书之流开始</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/500846d9d5b15b004293749b374b21a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9wAE3a6_XQ2CSTI0ICXEUQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@tribeshk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> tribesh kayastha </a>在<a class="ae ky" href="https://unsplash.com/s/photos/workflow?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9374" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://flow.org/" rel="noopener ugc nofollow" target="_blank"> Flow </a>是脸书制作的一个类型检查器，用于检查JavaScript数据类型。它有许多内置的数据类型，我们可以用它们来注释变量和函数参数的类型。</p><p id="3bd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看看如何向对象添加流类型。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9931" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">句法</h1><p id="0306" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为对象创建类型的语法与在JavaScript中创建对象文字的语法很接近。</p><p id="b9ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过编写以下代码来创建一个简单的类型化对象:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8647" class="ne md it na b gy nf ng l nh ni">let obj: { bar: boolean } = { bar: true };</span></pre><p id="93a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，<code class="fe nj nk nl na b">{ bar: boolean }</code>是<code class="fe nj nk nl na b">obj</code>的类型。这意味着<code class="fe nj nk nl na b">obj</code>对象必须至少拥有<code class="fe nj nk nl na b">bar</code>属性。除了<code class="fe nj nk nl na b">bar</code>属性之外，我们还可以添加其他属性。</p><p id="d43a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们用逗号分隔多个键值对:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="594d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">可选属性</h1><p id="52c4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了使属性可选，我们可以在属性名后添加一个问号。</p><p id="df9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以写:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="690c" class="ne md it na b gy nf ng l nh ni">let obj:  { name?: string } = {<br/>  name: 'Joe'<br/>};</span></pre><p id="d624" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl na b">name</code>属性是可选的，所以我们可以省略它或者将其设置为<code class="fe nj nk nl na b">undefined</code>。</p><p id="b63b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以写:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8408" class="ne md it na b gy nf ng l nh ni">let obj:  { name?: string } = { name: undefined };<br/>let obj2:  { name?: string } = { };</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a852" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">密封物体</h1><p id="dbb0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当我们创建一个已经设置了属性和值的对象时，Flow将认为对象<em class="no">是密封的</em>，这意味着我们不能添加属性或从中删除属性。</p><p id="c5e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们有以下对象:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="202d" class="ne md it na b gy nf ng l nh ni">let obj: { a: number, b: number, c: number } = { a: 1, b:2, c:3 };</span></pre><p id="7981" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么下面的代码将给出错误:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fbba" class="ne md it na b gy nf ng l nh ni">obj.d = 1;<br/>delete obj.a;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="60d7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">未密封的对象</h1><p id="1996" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果我们创建一个没有任何属性的对象，Flow会认为它是一个未密封的对象，这意味着我们可以对它做任何事情。</p><p id="c66a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们有:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c053" class="ne md it na b gy nf ng l nh ni">let obj = {};</span></pre><p id="0a36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以写:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="09b5" class="ne md it na b gy nf ng l nh ni">obj.d = 1;<br/>delete obj.a;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8020" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">分配未密封的对象属性</h1><p id="5d7e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Flow将为被赋予对象属性值的变量提供属性值可以采用的所有可能类型。</p><p id="e157" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们有以下对象定义:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="e8b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么<code class="fe nj nk nl na b">foo</code>属性将具有<code class="fe nj nk nl na b">number|string</code>类型。这意味着我们可以编写下面的代码将<code class="fe nj nk nl na b">obj.foo</code>的值赋给一个新变量:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3aad" class="ne md it na b gy nf ng l nh ni">let foo: number|string = obj.foo;</span></pre><p id="6e2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不能写:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="4e43" class="ne md it na b gy nf ng l nh ni">let foo: number = obj.foo;</span></pre><p id="fd8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d1b2" class="ne md it na b gy nf ng l nh ni">let foo: string = obj.foo;</span></pre><p id="6c20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为<code class="fe nj nk nl na b">obj.foo</code>不总是数字或字符串。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/f9a46fd59b3a0a5a9f7ecea3d764488d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6tQQzThS62tDiDA5"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Amy Asher 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3123" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">具有未定义属性值的未密封对象</h1><p id="8545" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">不检查具有未定义属性值的未密封对象的属性的类型。</p><p id="122b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们有以下对象:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9ce5" class="ne md it na b gy nf ng l nh ni">let obj = {};<br/>obj.foo;</span></pre><p id="6750" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将它赋给任何类型的变量，如下所示:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0f81" class="ne md it na b gy nf ng l nh ni">let foo: number = obj.foo;<br/>let bar: string = obj.foo;<br/>let baz: boolean = obj.foo;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="489b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">精确的对象类型</h1><p id="8791" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以为给定类型的对象添加额外的属性。例如，如果我们有以下类型:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="49b9" class="ne md it na b gy nf ng l nh ni">{ foo: string }</span></pre><p id="b856" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以这样写:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="caba" class="ne md it na b gy nf ng l nh ni">let obj: { foo: string } = { foo: 'bar', baz: 1 };</span></pre><p id="6fbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要我们将<code class="fe nj nk nl na b">foo</code>属性设置为一个值，我们就可以向<code class="fe nj nk nl na b">obj</code>添加任何我们想要的东西。</p><p id="59c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用确切的属性数来设置类型，方法是:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c76c" class="ne md it na b gy nf ng l nh ni">{| foo: <!-- -->number <!-- -->|}</span></pre><p id="8f18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl na b">|</code>符号指定该类型的对象只能有<code class="fe nj nk nl na b">foo</code>属性，因此下面的赋值将会失败:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3b18" class="ne md it na b gy nf ng l nh ni">let foo: {| foo: number |} = { foo: 1, bar: 2 };</span></pre><p id="e1ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过移除额外的<code class="fe nj nk nl na b">bar</code>属性来修复它:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9d30" class="ne md it na b gy nf ng l nh ni">let foo: {| foo: number |} = { foo: 1 };</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6915" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">作为地图的对象</h1><p id="2a8e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要将对象用作映射，我们可以创建具有动态属性名称的类型。例如，我们可以编写以下代码来创建具有动态字符串属性的对象类型:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e5d4" class="ne md it na b gy nf ng l nh ni">let obj: { [prop: string]: number } = {};</span></pre><p id="662d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，<code class="fe nj nk nl na b">{ [prop: string]: number }</code>指定<code class="fe nj nk nl na b">obj</code>可以拥有带有字符串属性名和数字属性值的动态属性。</p><p id="42e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以将以下内容分配给<code class="fe nj nk nl na b">obj</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e717" class="ne md it na b gy nf ng l nh ni">obj['foo'] = 1;<br/>obj['bar'] = 2;</span></pre><p id="826f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">属性标识符也可以是数字。如果我们有:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1922" class="ne md it na b gy nf ng l nh ni">let obj: { [prop: number]: number } = {};</span></pre><p id="e411" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以写:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a176" class="ne md it na b gy nf ng l nh ni">obj[0] = 1;<br/>obj[1] = 2;</span></pre><p id="d422" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于具有数字属性的对象类型，每个值都被假定为具有我们在对象类型中定义的类型。例如，如果我们有:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d5b9" class="ne md it na b gy nf ng l nh ni">let obj: { [prop: number]: number } = {};<br/>obj[0] = 1;<br/>obj[1] = 2;</span></pre><p id="5d7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么<code class="fe nj nk nl na b">obj</code>的所有索引都假设为一个数，那么我们可以写成:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="95be" class="ne md it na b gy nf ng l nh ni">obj[100].toString();</span></pre><p id="6bb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不管它是否存在。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9d36" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><code class="fe nj nk nl na b">Object</code>类型</h1><p id="313c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在Flow的未来版本中将删除<code class="fe nj nk nl na b">Object</code>类型。对于可以拥有任何东西的对象，我们应该使用<code class="fe nj nk nl na b">any</code>或<code class="fe nj nk nl na b">{ [key: string]: any}</code>。</p><p id="299a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以写:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2c07" class="ne md it na b gy nf ng l nh ni">let obj: Object = {};<br/>obj['foo'] = 1;<br/>obj[1] = 2;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="16f0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="5acd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Flow用于检查JavaScript对象类型的类型系统相当全面。我们可以设置属性和对象的类型。</p><p id="d88a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">已经设置了属性和值的对象被认为是密封的，这意味着我们不能添加或删除它们的属性。空对象被认为是未密封的，这意味着我们可以对它们做任何事情。</p><p id="6ca9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以用带有<code class="fe nj nk nl na b">|</code>符号的提取结构来定义对象类型。另一方面，我们也可以用括号为属性名定义动态对象类型。</p></div></div>    
</body>
</html>