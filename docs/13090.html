<html>
<head>
<title>WWDC 22: How to Use the SwiftUI PhotosPicker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WWDC 22:如何使用swift ui picker</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/wwdc-22-how-to-use-the-swiftui-photospicker-db00077de75d?source=collection_archive---------7-----------------------#2022-07-27">https://betterprogramming.pub/wwdc-22-how-to-use-the-swiftui-photospicker-db00077de75d?source=collection_archive---------7-----------------------#2022-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="aa80" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不再使用UIViewControllerRepresentable和PHPickerViewController</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c3a60a1f43d6922b5f736efb4959fbce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xN5ivU371YeefrkOy0aC8w.png"/></div></div></figure><p id="df66" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在今年的WWDC上，苹果带来了对SwiftUI的大量改进，其中一个特别引起我注意的是<code class="fe lq lr ls lt b">PhotosPicker</code>视图。是的，你是对的！SwiftUI终于在iOS 16中获得了自己的原生照片拾取器视图。</p><p id="6d50" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">PhotosPicker</code>视图支持<code class="fe lq lr ls lt b">PHPickerViewController</code>拥有的所有常见功能。单选和多选、资产类型过滤和相册切换等功能都包括在内。</p><p id="db1a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用<code class="fe lq lr ls lt b">PhotosPicker</code>视图的方式实际上非常简单。让我告诉你怎么做。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="6ac4" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">使用照片拾取器视图</h1><p id="dddb" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">首先，让我们先导入<code class="fe lq lr ls lt b">SwiftUI</code>和<code class="fe lq lr ls lt b">PhotosUI</code>模块。之后，定义一个名为<code class="fe lq lr ls lt b">selectedItem</code>的状态，类型为<code class="fe lq lr ls lt b">PhotosPickerItem</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5eaa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了更好的存储效率，用户选择的资产将以<code class="fe lq lr ls lt b">PhotosPickerItem</code>的形式交给我们。稍后我们将使用它来检索底层资产。</p><p id="0de4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记住这一点，我们可以将<code class="fe lq lr ls lt b">PhotosPicker</code>视图添加到内容视图的主体中，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="22ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了简单起见，我已经配置了<code class="fe lq lr ls lt b">PhotosPicker</code>视图来显示一个只显示图像的单选照片选择器。请随意查阅<a class="ae na" href="https://developer.apple.com/documentation/photokit/photospicker" rel="noopener ugc nofollow" target="_blank">官方文档</a>了解更多配置选项。</p><p id="9ecd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据我的个人经验，我注意到在初始化<code class="fe lq lr ls lt b">PhotosPicker</code>视图时，必须将<code class="fe lq lr ls lt b">photoLibrary</code>设置为<code class="fe lq lr ls lt b">.shared()</code>。如果省略的话，<code class="fe lq lr ls lt b">$selectedItem</code>的绑定就不起作用了。我不确定为什么会这样，也许这是测试版中的一个错误，将在不久的将来修复。如果有人知道背后的原因，请在推特上给我打电话。</p><p id="117c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，如果您继续运行示例代码，您将在屏幕中央看到标签为“<em class="nb">选择一张照片</em>”的<code class="fe lq lr ls lt b">PhotosPicker</code>视图。点击它会弹出iOS原生照片选择器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/9436771e455ea51c1b2683266a8eb109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WMlsCthtZjddB0Ou"/></div></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="1fbb" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">处理资产选择</h1><p id="32db" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">我们将以<code class="fe lq lr ls lt b">Data</code>的形式检索用户选择的资产。因此，让我们继续为其定义状态:</p><pre class="kj kk kl km gt nd lt ne nf aw ng bi"><span id="d6ba" class="nh mc it lt b gy ni nj l nk nl">@State private var selectedImageData: Data? = nil</span></pre><p id="29f3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">处理资产选择的方法非常简单。这个概念是使用<code class="fe lq lr ls lt b">PhotosPicker</code>视图的<code class="fe lq lr ls lt b">onChange()</code>修改器来检测<code class="fe lq lr ls lt b">selectedItem</code>的变化。之后，我们将使用<code class="fe lq lr ls lt b">selectedItem</code>的<code class="fe lq lr ls lt b">loadTransferable()</code>方法获得基础资产。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="6c14" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，让我们在<code class="fe lq lr ls lt b">PhotosPicker</code>视图的正下方显示选中的图像。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="e799" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是处理资产选择的方法。再次运行示例代码，查看运行中的一切。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/790c4c1c4a3f6ee09b9df71b2605a4a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fHtZP_cUxeiPr-y_"/></div></div></figure><p id="d266" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是完整的示例代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="fcef" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">警告</h1><p id="8117" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">如果您已经观看了关于 <code class="fe lq lr ls lt b"><a class="ae na" href="https://developer.apple.com/videos/play/wwdc2022/10023/?time=469" rel="noopener ugc nofollow" target="_blank">PhotosPicker</a></code> <a class="ae na" href="https://developer.apple.com/videos/play/wwdc2022/10023/?time=469" rel="noopener ugc nofollow" target="_blank">视图</a>的<a class="ae na" href="https://developer.apple.com/videos/play/wwdc2022/10023/?time=469" rel="noopener ugc nofollow" target="_blank"> WWDC会议，您会注意到我们检索所选图像的方式与我们在视频中看到的略有不同。我们不是以<code class="fe lq lr ls lt b">Image</code>的形式加载，而是以<code class="fe lq lr ls lt b">Data</code>的形式加载。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/b00b2d067fcefcbb42f78df2ea21c6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QyVZoY-jivFAC5-I"/></div></div></figure><p id="151f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如本<a class="ae na" href="https://developer.apple.com/forums/thread/709764?answerId=719540022#719540022" rel="noopener ugc nofollow" target="_blank">论坛帖子</a>所述，<code class="fe lq lr ls lt b">Image</code>类型仅支持<code class="fe lq lr ls lt b">public.png</code>作为其内容类型。如果照片拾取器包含除<code class="fe lq lr ls lt b">png</code>之外类型的资产，例如<code class="fe lq lr ls lt b">jpeg</code>或<code class="fe lq lr ls lt b">heic</code>，我们将无法检索它。在Apple为<code class="fe lq lr ls lt b">Image</code>添加更多内容类型支持之前，从照片拾取器中检索图像时仍然建议使用<code class="fe lq lr ls lt b">Data</code>。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="6160" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">包扎</h1><p id="28f1" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">在整篇文章中，我一直在iOS上运行示例代码，但实际上，示例代码在macOS、iPadOS和watchOS上完全可以运行。</p><p id="6b90" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">据苹果公司称，照片选择器将根据平台和可用的屏幕空间自动选择最佳布局。对于那些需要支持多个平台的人来说，这肯定会非常方便。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><p id="7f52" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你喜欢读这篇文章，请随意查看我的其他iOS开发相关的<a class="ae na" href="https://swiftsenpai.com/tag/ios/" rel="noopener ugc nofollow" target="_blank">文章</a>。也可以在<a class="ae na" href="https://twitter.com/Lee_Kah_Seng" rel="noopener ugc nofollow" target="_blank">推特</a>关注我。</p><p id="2cbc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。</p></div></div>    
</body>
</html>