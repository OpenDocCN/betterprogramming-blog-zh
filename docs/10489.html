<html>
<head>
<title>Jetpack Glance for Compose App Widgets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于编写应用程序小部件的Jetpack Glance</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/jetpack-glance-for-compose-app-widgets-5beb4d30ec51?source=collection_archive---------18-----------------------#2022-01-10">https://betterprogramming.pub/jetpack-glance-for-compose-app-widgets-5beb4d30ec51?source=collection_archive---------18-----------------------#2022-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c110" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Android中创建漂亮的部件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/57077d582aad359911c64b071001b0a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LFwa_xGKHC1SNY1i4ST7Gg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图为<a class="ae kv" href="https://unsplash.com/@vork?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">在<a class="ae kv" href="https://unsplash.com/s/photos/android?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">凸起</a>上标记凸台</a></p></figure><p id="975d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将谈论一个叫做Jetpack Glance的新框架，它刚刚在Alpha中发布。</p><p id="62ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本上，它是一个框架，您可以使用Jetpack Compose来构建应用程序小部件。那真的很实用！为了便于识别，微件是可以添加到设备主屏幕上的小形状。有了Jetpack Glance，您现在就可以使用Jetpack Compose来创建它们。</p><p id="bb1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，它不能与Jetpack Compose完全互操作。我的意思是，如果你的项目中有一些组件，你就不能在你的项目中使用它们。Jetpack Glance的工作方式有一点不同，它有自己的一种组合，我们称之为“Glanceables”。</p><p id="5f3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您仍然可以使用相同的可组合函数，但是它们有一些特殊的修饰符。您不能将现有的可组合组件放到应用程序小部件中，但是您可以使用普通类型的组合设计来创建您的应用程序小部件。</p><p id="9719" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来看看它是如何工作的:</p><p id="8176" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，您需要实现如下两个依赖项:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="ea18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还希望确保您拥有这个maven存储库:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="5d10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以开始创建我们自己的<code class="fe lu lv lw lx b">MessageWidget</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="8ced" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们的主屏幕部件。它只是显示一个“窗口小部件消息试用”文本，但是正如你所看到的，它继承了需要实现的<code class="fe lu lv lw lx b">Content</code>功能的<code class="fe lu lv lw lx b">GlanceAppWidget</code>。</p><p id="ca87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还需要用Composable来注释<code class="fe lu lv lw lx b">Content</code>函数。所以在那之后，你可以在<code class="fe lu lv lw lx b">Content()</code>中使用你的可组合函数。</p><p id="7093" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，正如我所说的，它不能与Jetpack Compose互操作，您不能使用您现有的组件。需要用特殊的<code class="fe lu lv lw lx b">GlanceModifier</code>。</p><p id="5784" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还创建了继承自<code class="fe lu lv lw lx b">GlanceAppWidgetReceiver</code>的<code class="fe lu lv lw lx b">MessageWidgetReceiver</code>。实际上它相当于<code class="fe lu lv lw lx b">broadcastReceiver</code>，它只是服务于这样的目的，如果用户与你的小工具交互，这个接收器将被触发。显然，你的应用程序并不是一直都是活跃的，但是用户可以随时与你的小部件交互。</p><p id="ac09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您需要覆盖<code class="fe lu lv lw lx b">glanceAppWidget</code>，并返回您创建的小部件— &gt;和<code class="fe lu lv lw lx b">MessageWidget</code>。</p><p id="a5f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，您需要在<code class="fe lu lv lw lx b">res</code>下创建一个XML文件夹，并为您的小部件创建一个XML文件。如果您想使用XML创建小部件，也需要做同样的事情</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/20ce71e0b5308c0700715daf472ea703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*NMppV35NN-CbPQg-0LWRdQ.png"/></div></figure><p id="3c37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个XML中，您需要定义<code class="fe lu lv lw lx b">appwidget-provider</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="74bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以定义一个<code class="fe lu lv lw lx b">previewImage</code>——我的是一个安卓机器人图标。我们应该为初始布局创建一个XML:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="abf3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们不会看到这一点，因为在我们的情况下没有延迟。之后，我们需要去声明和登记广播接收器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="b154" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们看看它在我的设备上是什么样子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lz"><img src="../Images/5ae68ad008aaed50e6f35a49639344ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*n1Ai580dkuD9r9Hx4fByjg.gif"/></div></div></figure><p id="39b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们停留在主屏幕上时，我们进入widgets，看到所有支持widgets的应用程序。</p><p id="ed2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们抓住应用程序的图标，我们可以把它拖到主屏幕上。</p><p id="d2ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还有我们的“小部件消息试用”文本！</p><p id="8466" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以调整它的大小，但它只会填满它真正需要的空间。</p><p id="0e8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个例子显示了Jetpack Glance的基本规则。</p><p id="ff64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇文章能帮助你理解Jetpack Glance的基本功能，它只是一个初级版本，但是随着版本的稳定，我们会做进一步的研究。</p><p id="ce6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div></div>    
</body>
</html>