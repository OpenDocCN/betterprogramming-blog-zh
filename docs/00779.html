<html>
<head>
<title>Making a Real-World Application With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI制作真实世界的应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/making-a-real-world-application-with-swiftui-ba9e9682889c?source=collection_archive---------1-----------------------#2019-07-12">https://betterprogramming.pub/making-a-real-world-application-with-swiftui-ba9e9682889c?source=collection_archive---------1-----------------------#2019-07-12</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="b41b" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">第二部分:异步数据和远程映像</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/cb5311243892011eca809cd083ff5bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r7N6C6GD0C7I5Uk_VytfwA@2x.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">黑客帝国，更多的黑客帝国，黑客帝国海报，还有黑客帝国的家伙，实际上是疾速追杀扮演的山谬·里维</p></figure><p id="0cb8" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这是我的关于仅使用SwiftUI制作真实应用程序的系列文章的第二部分。第1部分是对数据流和Redux的介绍，以及对应用程序的概述——如果你想完全理解这篇文章，这是一篇重要的阅读材料。</p><p id="0a1b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这篇文章详细介绍了如何从API获取数据，并在SwiftUI中显示远程图像。</p><p id="c8e4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">由于<a class="ae lv" href="https://github.com/Dimillian/MovieSwiftUI" rel="noopener ugc nofollow" target="_blank"> MovieSwiftUI </a>依赖于<a class="ae lv" href="https://developers.themoviedb.org/3" rel="noopener ugc nofollow" target="_blank"> TMDb API </a>来显示关于电影的信息，因此获取远程数据是一个关键点。而用户的自定义电影列表、愿望列表和在线列表、设置等。在本地处理和保存，其他信息则远程获取。</p><h1 id="84ce" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">异步数据</h1><p id="17eb" class="pw-post-body-paragraph kz la iu lb b lc mo jv le lf mp jy lh li mq lk ll lm mr lo lp lq ms ls lt lu in bi translated">由于我使用的是Redux模式，所以这一部分没有太多关于SwiftUI的内容。提取的数据基本上减少到我的应用程序状态，然后状态被发布，因此视图用新数据更新。但是这到底是怎么回事呢？让我们来看看。</p><p id="83f9" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我制作了一个非常简单的APIService类，它使用<a class="ae lv" href="https://developer.apple.com/documentation/foundation/urlsession" rel="noopener ugc nofollow" target="_blank"> URLSession </a>来发出请求。我的所有模型都符合<a class="ae lv" href="https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types" rel="noopener ugc nofollow" target="_blank"> Codable </a>，并且几乎是来自TMDb API的模型的一对一表示。这样我就不需要定制的解码器或者视图的瞬态模型。在应用程序中有几个地方我使用了纯视图模型，但是在大多数情况下，响应在应用程序状态中由reducers以一种逻辑方式(如果您愿意，可以像内存中的数据库一样)序列化。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mt mu l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">从我的非常基本的HTTP客户端提取，MovieSwiftUI存储库上的全部代码。</p></figure><p id="38e5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">然后我有一个AsyncAction，它是Redux动作，您可以像往常一样调度，但是它们没有被reducer减少(例如，它们可以提供加载状态)，而是由中间件执行，以触发它们在execute()函数中实现的请求。一旦请求完成，它们就链接另一个动作，根据响应中包含的数据更新状态。</p><p id="fa5a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">行动:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mt mu l"/></div></figure><p id="6f9c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">中间件由我的<a class="ae lv" href="https://github.com/Dimillian/SwiftUIFlux" rel="noopener ugc nofollow" target="_blank"> SwiftUIFlux </a> Swift包提供。调度时从AsyncAction中触发execute函数。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mt mu l"/></div></figure><p id="0fdb" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">最后，reducer将电影添加到状态电影属性中。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mt mu l"/></div></figure><p id="2fbc" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">那么景色怎么样呢？让我们来看看我的电影细节:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mt mu l"/></div></figure><p id="7097" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我使用environment object-accessible检索我的存储，因为它是在我的应用程序的根视图中注入的。然后，当。视图的onAppear()被触发(<a class="mv mw ep" href="https://medium.com/u/285040680274?source=post_page-----ba9e9682889c--------------------------------" rel="noopener" target="_blank"> Chris Eidhof </a>有另一个<a class="ae lv" href="https://gist.github.com/chriseidhof/e56128e4421ab59504153fb5f575fd0b" rel="noopener ugc nofollow" target="_blank">方法</a>，当SwiftUI订阅他的ObservableObject时，他触发资源加载)。因为我将属性从我的状态映射到视图计算属性，所以由AsyncAction更新的电影对象中的任何内容都将在我的MovieDetail视图及其各种组件中更新。</p><p id="753a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我希望这一部分清楚地概述了我是如何进行API调用和将远程数据加载到SwiftUI应用程序中的。现在，我们将更深入地研究SwiftUI，使用Apple提供的图像组件，以及如何使其与远程图像无缝协作。</p></div><div class="ab cl mx my hy mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="in io ip iq ir"><h1 id="7c7a" class="lw lx iu bd ly lz ne mb mc md nf mf mg ka ng kb mi kd nh ke mk kg ni kh mm mn bi translated">远程图像</h1><p id="f1cb" class="pw-post-body-paragraph kz la iu lb b lc mo jv le lf mp jy lh li mq lk ll lm mr lo lp lq ms ls lt lu in bi translated">苹果公司的<a class="ae lv" href="https://developer.apple.com/documentation/swiftui/image" rel="noopener ugc nofollow" target="_blank">图像</a>组件非常好——它支持一系列的输入格式，如数据、UIImage和<a class="ae lv" href="https://developer.apple.com/design/human-interface-guidelines/sf-symbols/overview/" rel="noopener ugc nofollow" target="_blank"> SF符号</a>。但是，它不支持URL为<em class="nj"> </em>的init(还没有？我已经向苹果提供了反馈，希望它能在9月发布前或未来发布时添加进来。)</p><p id="28bf" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">要显示从远程位置获取的图像，就像UIImageView一样，您需要创建自己的系统。由于ObservableObject和@ObservedObject属性包装器，这变得很容易。</p><p id="7c19" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">类似于网络调用，我做了一个ImageService。(与本帖不太相关，所以<a class="ae lv" href="https://github.com/Dimillian/MovieSwiftUI/blob/master/MovieSwift/MovieSwift/services/ImageService.swift" rel="noopener ugc nofollow" target="_blank">下面不包含代码</a>)。这是一个基本的管理器，它从URL异步下载数据，并使用Combine框架将其发布给任何订阅者。</p><p id="12c0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">有趣的部分是它如何与SwiftUI集成。为此，我创建了一个符合ObservableObject协议的ImageLoader类，这样SwiftUI就可以得到任何@Published属性更改的通知。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mt mu l"/></div></figure><p id="f088" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">你用一个路径，一个大小来实例化它，它将调用ImageService从互联网上获取图像。然后，它将在ImageLoader image (UIImage)属性上本地设置它，这将向订阅它的任何人发布它的更改。又能订阅什么呢？一个观点！</p><p id="5a82" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">上面我也有一个ImageLoaderCache，它将缓存我的ImageLoader实例，因为它们可能被销毁，因为没有被任何SwiftUI重载视图体引用。它还避免多次下载相同的图像，并允许重复使用。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mt mu l"/></div></figure><p id="2b9e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">下面是一个视图的具体实现，您可以在任何SwiftUI应用程序中直接使用它。它使用ImageLoader，image loader使用ImageService显示图像。它甚至提供了一个占位符，一旦图像加载了基本的淡入动画，就可以平滑地替换它。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nk"><img src="../Images/beaf42608030a14a347a14d48018e3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*eHq1lBjeAXEw7G2GIzorMg.gif"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">下面是一个列表中的例子，图像被顺利下载并显示为行出现。</p></figure><p id="396e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">它触发图像加载器。loadImage()调用。SwiftUI框架中的onAppear()函数。</p><p id="e664" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">需要注意的是，只有List组件的行为类似于UITableView。这意味着当您滚动时，列表中的视图会入队和出列/重用。所以。onAppear()只会在视图实际出现在屏幕上时被调用(当你滚动时)。这正是我们想要的行为。</p><p id="386e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">对于任何其他组件(如HStack、VStack、ScrollView ),只要显示了父视图，所有视图都将出现在屏幕上。即使您必须滚动到内容的深处，正文也会被加载。onAppear()将被调用。一旦父视图出现在屏幕上，它将开始加载您的所有图像。更糟糕的是，在ScrollView案例中。onAppear()调用顺序将从层次结构中最远的视图调用到第一个视图。换句话说，视图底部或尾部的图像将首先加载。</p></div><div class="ab cl mx my hy mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="in io ip iq ir"><p id="2d5f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">Xcode Beta 3还没有解决办法，但我希望苹果会对它做出一些改变。也许我们会得到与ScrollView中的List相同的行为，或者也许我们会得到一种HList/VList或aGrid组件，它将在它的主体中对视图进行排队和重用。或者他们会打电话给。onAppear()的正确顺序。</p><p id="2b8b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我希望你对这篇文章感兴趣，如果你有任何问题或反馈，我就在这里。</p><div class="nl nm gq gs nn no"><a href="https://medium.com/@dimillian/making-a-real-world-application-with-swiftui-3b643ddfae22" rel="noopener follow" target="_blank"><div class="np ab fp"><div class="nq ab nr cl cj ns"><h2 class="bd iv gz z fq nt fs ft nu fv fx it bi translated">使用SwiftUI制作真实世界的应用程序</h2><div class="nv l"><h3 class="bd b gz z fq nt fs ft nu fv fx dk translated">第三部分:导航和演示</h3></div><div class="nw l"><p class="bd b dl z fq nt fs ft nu fv fx dk translated">medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc kt no"/></div></div></a></div></div></div>    
</body>
</html>