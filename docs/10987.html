<html>
<head>
<title>Data Collection With API — For Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用API收集数据——适用于初学者</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/data-collection-with-api-for-beginners-52b02e571944?source=collection_archive---------2-----------------------#2022-02-09">https://betterprogramming.pub/data-collection-with-api-for-beginners-52b02e571944?source=collection_archive---------2-----------------------#2022-02-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3f39" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python利用API获取数据的简单指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/be61b02d73bc1e5c6bc016255cb7acca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bZZVHF7ffgzROts2"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">道格拉斯·洛佩斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="7978" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用编程接口(API)已经成为我们已经习惯使用的许多产品和服务的核心组件。</p><p id="cc53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它能够加强公司和客户之间的关系。对于公司来说，这是一种向客户推广自己业务的便捷方式，同时确保了后端系统的安全性。对于客户来说，API提供了访问数据的方法，这些数据可以用来推动他们的研究或产品开发。</p><p id="27db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我将简要概述API，并演示如何使用Python将这一资源用于您自己的数据收集。</p><h1 id="7de4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">数据收集的形式</h1><p id="2edc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在讨论API之前，让我们快速回顾一下获取数据时的选项。</p><h2 id="9348" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">1.收集您自己的数据</h2><p id="8d2b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这一个似乎是显而易见的；如果你想要一些数据，为什么不自己收集呢？毕竟没有人比你自己更了解你的要求。所以，只要出去就可以开始收集，对吗？</p><p id="8beb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不对。</p><p id="f2c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在大多数情况下，收集自己的数据是一个荒谬的想法。获得所需数量和质量的信息需要相当多的时间、金钱、人力和资源。</p><p id="9430" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一项不可行(如果不是不可能的话)的事业。</p><h2 id="e4f2" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">2.使用现成的数据集</h2><p id="dfbf" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">当您可以使用其他人的预处理数据集时，为什么要经历收集和处理数据的麻烦呢？</p><p id="21b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现成的数据集可能很有吸引力，因为有人已经为你做了制作它们的所有艰苦工作。毫无疑问，你在Kaggle.com和Data.gov这样的网站上遇到过很多。</p><p id="0335" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，这种方法的便利性是以灵活性和控制为代价的。当您使用现成的数据集时，您会受到在上传之前对该数据集执行的预处理的限制。</p><p id="25d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些可能对您有用的记录或特性可能被源丢弃了。</p><p id="e994" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些数据源当然有它们的优点，但是它们的局限性会给任何后续的分析或建模增加约束，并且会妨碍项目的成功。</p><h2 id="397a" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">3.网页抓取</h2><p id="d961" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">网络搜集在某种程度上是介于收集你自己的数据和使用别人的数据之间的中间地带。</p><p id="82da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以访问其他人的网站，选择你想要收集的部分，从而获取他们的数据。</p><p id="ae6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从理论上讲，这似乎是一笔不错的交易，但是网络抓取有它自己的注意事项。</p><p id="12e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，通过抓取从网站中提取数据可能具有挑战性。Selenium等Web抓取工具需要对HTML和XML路径语言(XPath)有很强的掌握。此外，浏览网站和获取所需信息所需的脚本可能很长，可能需要大量时间来编写。</p><p id="3944" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，网络抓取有时是不道德的，甚至是非法的。虽然一些网站对抓取没有疑虑，但其他网站可能就不那么宽容了。网站上传受版权保护的数据或设置条款规定抓取条件的情况并不少见。</p><p id="b56f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有足够的谨慎和关心的网络抓取可能会给你带来麻烦。</p><h2 id="303f" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">API的优势</h2><p id="b254" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">API提供了一种获取所需数据的方法，同时避免了上述数据收集方法的缺点。</p><p id="8324" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它免去了您自己收集数据的麻烦，因为您可以直接从另一个实体获取数据。你可以自由地选择你想处理的原始数据。</p><p id="bbe2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也不需要担心任何法律后果。在允许你访问他们的API之前，公司要求你拥有一个名为<strong class="lb iu"> API密钥</strong>的标识符。您可以通过直接申请获得API密钥。API密匙作为进入的屏障，确保只有经过公司批准的客户才能从API中获益。</p><p id="e7f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，这个资源最好的部分是它可以用几行代码简化数据提取！</p><h1 id="ecda" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">API的作用简单来说就是</h1><p id="eb93" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">那么，在您从外部来源收集数据的过程中，API扮演了什么角色呢？要回答这个，首先要介绍一点术语。</p><p id="565d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当一个客户想要从一个外国服务器访问某些数据时，他们向那个服务器发出一个<strong class="lb iu">请求</strong>。</p><p id="5b51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当服务器收到请求时，它生成一个<strong class="lb iu">响应</strong>，并将其发送回客户端。</p><p id="fcc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API在这种交换中扮演了中间人的角色。它负责将您的请求传递给服务器，然后将相应的响应传递回给您。</p><h1 id="cf08" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用API</h1><p id="55f5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">不幸的是，处理API没有一种通用的方法。</p><p id="66e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不同来源的API在可访问性和实现方面有所不同。</p><p id="acd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数网站对请求都有自己独特的要求，并为其响应设置了独特的格式。它们在限制方面也不同。例如，一些API会限制一天中可以发出的请求数量。</p><p id="b747" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，要理解一个特定的API，你需要阅读他们的文档。</p><h2 id="15d8" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">个案研究</h2><p id="33e4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">尽管API使用起来很简单，但一开始可能很难理解。让我们演示一下如何使用它们来收集数据。</p><p id="de1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用来自纽约时报的API，名为<a class="ae ky" href="https://developer.nytimes.com/docs/articlesearch-product/1/overview" rel="noopener ugc nofollow" target="_blank">文章搜索API </a>。这个API允许您通过查询来搜索文章。</p><p id="58e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们的文档清楚地解释了如何为请求创建URIs。您可以自定义URI来请求特定的文章。例如，您可以指定文章的发布日期并应用其他过滤器。</p><p id="570b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们在Python中创建一个函数，该函数在给定查询、排序顺序、页码和API键的情况下为API生成一个URI。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="9196" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:这里，变量API_KEY将API键存储为一个字符串。你可以通过<a class="ae ky" href="https://developer.nytimes.com/" rel="noopener ugc nofollow" target="_blank">纽约时报开发者账号</a>申请一个API密匙。</p><p id="19a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，假设我们希望获得与冬季奥运会相关的最后1000篇文章。我们可以通过使用函数获得请求的URI。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e754" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用Python发出请求是一个简单的“请求”包任务。一旦发出请求并收到来自服务器的响应，就必须解析响应，它是JSON格式的(对于本例)。</p><p id="dbad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些都在下面的代码中执行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c8b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有多简单？</p><p id="c143" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们来看看回应。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/1ccdcca5c2623c819d89e81a9a9dca46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NURlfcIHsZQ3lPekoBpskw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="798e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很罗嗦，对吧？这是你通常能从回应中期待的。</p><p id="5ff0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，API以嵌套JSON对象的形式返回数据。</p><p id="d72b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了提高可读性，我们可以将这些数据显示为数据框。这似乎很困难，因为嵌套的JSON对象很难解包。</p><p id="4b3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，Pandas函数<code class="fe nh ni nj nk b">json_normalize</code>允许我们轻松处理嵌套的JSON对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="73be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是前5篇文章的标题和发表日期:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/a89bd6444514c3ac6a1a1d2decb84cb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*KUJH9gb6Ya6e1kVnewtQSw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="e83d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API文档中包含了响应中提供的所有信息的详细信息。</p><p id="3f68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看从回复中获得了多少文章:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/5ed1b7b4a72827f241e64fa1c2205250.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*EzLxhYlZHzxrCSCCg8H8_w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="a3ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所看到的，数据框只有10条记录，没有达到我们希望收集的1000篇文章。这是怎么回事？</p><p id="f23b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很简单，真的。《纽约时报》API对每个请求保持10篇文章的限制。</p><p id="22c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">获取1000篇文章很容易；我们简单地发出多个请求(每个请求中有不同的页码),直到我们收到所需数量的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="b35a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:第26行中的<code class="fe nh ni nj nk b">time.sleep(6)</code>命令用于增加每个请求之间的时间间隔。添加这一行是因为纽约时报API对一分钟内可以发出的请求数量进行了限制。</p><p id="4429" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看新数据框中存储了多少文章。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/d346b39c278d7d5c23136221222ff941.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*C9DnogjB-B8DmzEi_8CITQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="35d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。我们已经获得了《纽约时报》发表的最近1000篇关于冬奥会的文章。</p><h1 id="332b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/3d8eebd08497a9626dcd6dfda4c55c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ciwV5r5AJlntrUg5"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@prateekkatyal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Prateek Katyal </a>拍摄</p></figure><p id="b8fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总而言之，对于那些希望构建应用程序或进行数据驱动研究的人来说，API是一个无价的资源。</p><p id="9aef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然它们确实有一个学习曲线，但是一旦您习惯于阅读API文档、向服务器发出请求并将后续响应转换为可用格式，就很容易克服。</p><p id="a304" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我祝你在数据科学的努力中好运！</p></div></div>    
</body>
</html>