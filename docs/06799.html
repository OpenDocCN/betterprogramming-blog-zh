<html>
<head>
<title>How to Get Elasticsearch to Ingest Python Pandas DataFrames</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何让Elasticsearch获取Python熊猫数据帧</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-get-elasticsearch-to-ingest-pandas-dataframes-836fe006209c?source=collection_archive---------7-----------------------#2020-11-05">https://betterprogramming.pub/how-to-get-elasticsearch-to-ingest-pandas-dataframes-836fe006209c?source=collection_archive---------7-----------------------#2020-11-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ccb1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">和pdf。简单的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/501f135bac64ccc26e353c4b30f961ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TMEdl1h1y_IU38n0mQx0Qg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="a4c9" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">什么是Elasticsearch？</h1><p id="7e33" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated"><a class="ae mt" href="https://www.elastic.co/elasticsearch/" rel="noopener ugc nofollow" target="_blank"> Elasticsearch </a>是一款惊人的搜索引擎工具，能以闪电般的速度产生搜索结果。它是基于Apache的Lucene库构建的。它有一个HTTP web界面，并提供全文搜索引擎功能。它是分布式的，因为一个文档被分成多个部分或<em class="mu">碎片</em>并存储在不同的节点中。它也是容错的，这意味着它为用户提供了创建和存储他们希望存储的文档副本的选项。</p><p id="4b22" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">Elasticsearch以JSON文件的形式存储文档，这是无模式的，类似于NoSQL系统。Elasticsearch虽然是用Java编写的，但也提供了一个<a class="ae mt" href="https://elasticsearch-py.readthedocs.io/en/7.10.0a2/" rel="noopener ugc nofollow" target="_blank"> Python客户端</a>库。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="8c34" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">如何摄取数据帧</h1><p id="aef0" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">我发现Elasticsearch是最多产的聊天机器人平台之一。这些平台接收包含问题和答案的文档。用户提出的任何问题都将通过在相关问答文档中执行搜索来回答。</p><p id="f79f" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">事实上，Elasticsearch有自己的相关性计算器，基于Tf-IDf(词频，逆文档频率)方法。由于这不是本文的目的，我鼓励你学习更多关于<a class="ae mt" href="https://monkeylearn.com/blog/what-is-tf-idf/" rel="noopener ugc nofollow" target="_blank"> Tf-IDf方法</a>的知识。</p><p id="25c2" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">按照第一种方法，聊天机器人开发者提供包含FAQ的文档。这个文档可以是Word文档、富文本文件、标记文本文件、JSON甚至PDF的形式。但Elasticsearch并不支持所有格式。PDF是需要使用其他方式输入的格式之一。</p><p id="2eb4" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">此外，许多研究这些智能系统的数据科学家处理基于Python的数据结构，最突出的是数据帧。不幸的是，Elasticsearch本身并不支持数据框架。</p><p id="05fe" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">我想到了一箭双雕。首先，我将向您展示如何将PDF文件转换成数据帧，然后如何将数据帧编入Elasticsearch。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="0a52" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">但是首先，PDF！</h1><p id="941b" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">PDF文件可以有多个页面。它们可能包含也可能不包含图像。为了这篇文章，让我们假设他们没有图像；都是文字。我们首先需要提取PDF文件中每一页的所有文本。我创建了一个数据框架，存储书名和书中每一页的内容。因此，数据帧中的每一行都是在相应的名称列中提到的书中的一页。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从PDF文件中提取文本的示例代码</p></figure><p id="c7ad" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">我的源文件夹有五个PDF文件。我从每本书里提取页面，然后创建一个数据框架。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/c0cf7117514104d7b910ce01089dd50c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oI9oUi6OQZba42TYVGvDEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的源文件夹中的pdf</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/a2970ba82433e16f7fd704e4ce295b0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6aOxm56U7d3hoPBXCNPzQg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">每行是“名称”列中相应标题的一页</p></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h1 id="4a73" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">弹性搜索库</h1><p id="104d" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf mg mh mi mj mk ml mm mn mo mp mq mr ms im bi translated">Elasticsearch有自己的Python客户端库，名为elasticsearch-py。它非常容易使用，并有助于索引，更新，删除和阅读弹性搜索索引的行动。默认情况下，它将监听localhost:9200，但是如果您想要更改主机地址，您需要将它作为参数传递给<code class="fe ne nf ng nh b">Elasticsearch()</code>方法。</p><p id="3f4f" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">要创建一个Elasticsearch会话，调用<code class="fe ne nf ng nh b">Elasticsearch()</code>方法:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="eb72" class="nm lg it nh b gy nn no l np nq">from elasticsearch import Elasticsearch</span><span id="7d4b" class="nm lg it nh b gy nr no l np nq">es = Elasticsearch()</span></pre><p id="7557" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">要确保您的Elasticsearch会话处于活动状态，请在您的web浏览器中访问http://localhost:9200/。如果您的会话处于活动状态，您应该能够在网页上看到以下消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/f9faae2058abc3a67ade2116a015bba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ajmtbm7UfwXsi9KHLO-85w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您的弹性搜索会话已激活</p></figure><p id="e36d" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">好的。既然会话是活动的，我们可以开始索引我们的数据。下面是一个示例，我在其中索引了数据帧中的前两条记录:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="5c50" class="nm lg it nh b gy nn no l np nq">es.index(index=”example”, doc_type=”sample_text", id=42, body={“name”:db.iloc[:2][‘name’],”content”:db.iloc[:2][‘content’]})</span></pre><p id="9682" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">这将产生如下输出:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="8177" class="nm lg it nh b gy nn no l np nq">{'_index': 'example',<br/> '_type': 'sample_text',<br/> '_id': '42',<br/> '_version': 1,<br/> 'result': 'created',<br/> '_shards': {'total': 2, 'successful': 1, 'failed': 0},<br/> '_seq_no': 0,<br/> '_primary_term': 1}</span></pre><p id="ed75" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">让我们看看我们的数据是否已被正确索引。为此，我们使用了<code class="fe ne nf ng nh b">get()</code>方法:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="7fe5" class="nm lg it nh b gy nn no l np nq">es.get(index=”example”, doc_type=”sample_text", id=42)[‘_source’]</span></pre><p id="8702" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">您必须能够看到数据帧的前两条记录:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="2589" class="nm lg it nh b gy nn no l np nq">{'name': ['Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf','Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf'],'content': ['','Algorithms\nFOURTH EDITION\nhttp://avaxhome.ws/blogs/ChrisRedfield\n']}</span></pre><p id="e28b" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">我们做到了！我们已经能够将我们的数据框架的一部分放入Elasticsearch。</p><p id="de47" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">要获取整个数据帧，我们可以执行以下操作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="665a" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">要检查是否正确索引了数据，请再次使用<code class="fe ne nf ng nh b">get()</code>方法:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="a33f" class="nm lg it nh b gy nn no l np nq">es.get(index=”index”, doc_type=”index123",id=173)[‘_source’]</span></pre><p id="5291" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">您将获得以下内容:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="6aa6" class="nm lg it nh b gy nn no l np nq">{'name': ['Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',<br/>  'Algorithhms 4th Edition by Robert Sedgewick, Kevin Wayne.pdf',....],<br/>'content': ['',<br/>  'Algorithms\nFOURTH EDITION\nhttp://avaxhome.ws/blogs/ChrisRedfield\n',<br/>  'Algorithms\nFOURTH EDITION\nhttp://avaxhome.ws/blogs/ChrisRedfield\nThis page intentionally left blank ',<br/>  'Algorithms\nFOURTH EDITION\nhttp://avaxhome.ws/blogs/ChrisRedfield\nThis page intentionally left blank Algorithms\nRobert Sedgewick\nandKevin Wayne\nPrinceton University\nFOURTH EDITION\nUpper Saddle River, NJ \n† Boston † Indianapolis † San Francisco\nNew York † Toronto † Montreal † London † Munich † Paris † Madrid\nCapetown † Sydney † Tokyo † Singapore † Mexico City\n',<br/>  'Algorithms\nFOURTH EDITION\nhttp://avaxhome.ws/blogs/ChrisRedfield\nThis page intentionally left blank Algorithms\nRobert Sedgewick\nandKevin Wayne\nPrinceton University\nFOURTH EDITION\nUpper Saddle River, NJ \n† Boston † Indianapolis † San Francisco\nNew York † Toronto † Montreal † London † Munich † Paris † Madrid\nCapetown † Sydney † Tokyo † Singapore † Mexico City\nMany of the designations used by manufacturers and sellers to distinguish their products are claimed as \ntrademarks. Where those designations appear in this book, and the publisher was aware of a trademark \nclaim, the designations have been printed with initial capital letters or in all capitals. \nThe authors and publisher have taken care in the preparation of this book, but make no expressed or im-\nplied warranty of any kind and assume no responsibility for errors or omissions. No liability is assumed \nfor incidental or consequential damages in connection with or arising out of the use of the information or \nprograms contained herein. \nThe publ....]}</span></pre><p id="a530" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">这意味着你已经成功地获得了你的数据！恭喜你！</p><p id="747c" class="pw-post-body-paragraph lx ly it lz b ma mv ju mc md mw jx mf mg mx mi mj mk my mm mn mo mz mq mr ms im bi translated">关于将各种数据格式编入Elasticsearch的更多细节，请浏览<a class="ae mt" href="https://elasticsearch-py.readthedocs.io/en/7.9.1/" rel="noopener ugc nofollow" target="_blank">详细文档</a>。</p></div></div>    
</body>
</html>