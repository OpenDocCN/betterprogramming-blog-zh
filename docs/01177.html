<html>
<head>
<title>How I Whatsapp Myself with Motivational Quotes Every Morning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我每天早上是如何用励志名言来激励自己的</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-develop-api-and-automate-sending-a-quote-of-the-day-via-whatsapp-583eef089f6e?source=collection_archive---------9-----------------------#2019-08-20">https://betterprogramming.pub/how-i-develop-api-and-automate-sending-a-quote-of-the-day-via-whatsapp-583eef089f6e?source=collection_archive---------9-----------------------#2019-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bc77" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">受Kartik <a class="ae ki" href="https://medium.com/@kkstrack?source=post_page-----5d203c3b36c1----------------------" rel="noopener"> Nighania </a>的启发<a class="ae ki" href="https://medium.com/better-programming/i-wrote-a-script-to-whatsapp-my-parents-every-morning-in-just-20-lines-of-python-code-5d203c3b36c1" rel="noopener">将20行Python代码交给Whatsapp他的父母</a></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/4b2300724599816554a82738c6265a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ekViwGbsn1oGjcak"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae ki" href="https://unsplash.com/@darpandodiya?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">达尔潘多迪亚</a>在<a class="ae ki" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="9da9" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">1.0简介</h1><p id="1296" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在我之前的文章中，我构建了一个微服务项目，从互联网上搜集报价。本文是该项目的延续。以下是与微服务项目相关的文章列表。声明:它们是会员故事。</p><ol class=""><li id="377e" class="mu mv it ma b mb mw me mx mh my ml mz mp na mt nb nc nd ne bi translated"><a class="ae ki" href="https://medium.com/better-programming/a-step-by-step-guide-to-building-event-driven-microservices-with-rabbitmq-deeb85b3031c" rel="noopener">使用RabbitMQ构建事件驱动的微服务的分步指南</a>(微服务，后端相关)</li><li id="0486" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated"><a class="ae ki" href="https://medium.com/better-programming/how-i-deploy-microservice-to-heroku-with-rabbitmq-876499c797cc" rel="noopener">我如何用RabbitMQ将微服务部署到Heroku</a>(部署，Heroku)</li><li id="dad0" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated"><a class="ae ki" href="https://medium.com/better-programming/how-i-developed-a-real-time-web-app-using-server-sent-events-488cc280c2e1" rel="noopener">我如何使用服务器发送的事件开发实时Web应用</a>(实时)</li></ol><p id="11ab" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">尽管这些文章是关于同一个项目的，但是每一篇都讨论了编程和软件工程中的不同领域。所以这次就来说说WhatsApp的整合吧。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="ad2b" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">2.0项目背景</h1><p id="e64f" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这篇名为<a class="ae ki" href="https://medium.com/better-programming/i-wrote-a-script-to-whatsapp-my-parents-every-morning-in-just-20-lines-of-python-code-5d203c3b36c1" rel="noopener">我每天早上用20行Python代码给WhatsApp我的父母写了一个脚本</a>的文章启发我做了这个增强，那就是每天早上8点用一句激励性的话给WhatsApp我自己。这是我们在这篇文章中想要达到的最终目标。</p><p id="baf7" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">此外，作为这个项目的开发人员和用户，我不会每天都去我的网站查看激励性报价，这将是一个麻烦。为了有一个更好的UX，传达报价的经验应该是无缝的。</p><p id="0620" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">在这种情况下，使用短信、电子邮件甚至WhatsApp将是一个不错的选择。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="e5c0" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">3.0解决方案设计</h1><p id="e85e" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">为了实现上面提到的特性，让我们做一些计划和思考练习来成功地达到目标。在我们开始后端编码之前，有几个先决条件/设置我们必须做。</p><h2 id="489f" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">3.1设置</h2><ul class=""><li id="24b1" class="mu mv it ma b mb mc me mf mh nz ml oa mp ob mt oc nc nd ne bi translated">注册一个Twilio沙盒帐户。</li><li id="5a45" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt oc nc nd ne bi translated">将我的电话号码注册到Twilio Sandbox，这样我就可以接收来自Twilio的WhatsApp消息。</li></ul><h2 id="6102" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">3.2后端</h2><ul class=""><li id="d63b" class="mu mv it ma b mb mc me mf mh nz ml oa mp ob mt oc nc nd ne bi translated">创建一个Heroku调度程序(cron job)来调度每天早上8点触发<code class="fe od oe of og b">SendQuoteToSubscriber</code>函数调用。</li><li id="2ad1" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt oc nc nd ne bi translated">创建一个API端点，它将把搜集到的报价广播给订阅者。当这个API被调用时，它将执行以下任务。<br/> -从网上获取报价。<br/> - WhatsApp对订阅者的报价。</li><li id="e467" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt oc nc nd ne bi translated">创建一个名为<code class="fe od oe of og b">twilioService.js</code>的服务组件。该组件负责Twilio的所有相关功能。你要么希望它发送短信，WhatsApp消息等。</li></ul><p id="a1ed" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">这是我们必须开发的任务的分解列表。在下一个实现部分，我们将讨论后端编码。对于与Twilio安装相关的指南，我在1.0项目背景中提到的文章很好地讨论了安装指南。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3cd7" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">4.0实施</h1><p id="aaa1" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">让我们从创建<code class="fe od oe of og b">twilioService</code>组件开始。</p><h2 id="2cea" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">4.1 Twilio服务</h2><p id="90db" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">该服务组件必须实现这一目标。</p><ul class=""><li id="d04f" class="mu mv it ma b mb mw me mx mh my ml mz mp na mt oc nc nd ne bi translated">通知Twilio向报价订阅者发送WhatsApp消息。</li></ul><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oh oi l"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">twilioService.js要点</p></figure><p id="729f" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">根据要点，我们有两个功能。他们是<code class="fe od oe of og b">initClient</code>和<code class="fe od oe of og b">sendWhatsappMessage</code>。</p><ul class=""><li id="7495" class="mu mv it ma b mb mw me mx mh my ml mz mp na mt oc nc nd ne bi translated"><code class="fe od oe of og b">initClient</code>。这是为了创建一个与Twilio的客户端连接，以便请求其他操作。我们正在使用<a class="ae ki" href="https://github.com/twilio/twilio-node" rel="noopener ugc nofollow" target="_blank"> Twilio节点助手库</a>来使事情变得更加简单和方便。此外，我们还需要<code class="fe od oe of og b">accountSid</code>和<code class="fe od oe of og b">authToken</code>，你应该可以通过你的<a class="ae ki" href="https://www.twilio.com/console/" rel="noopener ugc nofollow" target="_blank"> Twilio控制台</a>取回。</li><li id="3700" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt oc nc nd ne bi translated"><code class="fe od oe of og b">sendWhatsappMessage</code>。该函数接收一个包含<code class="fe od oe of og b">mobileNo</code>和<code class="fe od oe of og b">quote</code>的对象。然后，我们利用助手库的<code class="fe od oe of og b">client.messages.create</code>函数通知Twilio发送WhatsApp消息。但是，你必须告诉Twilio你想从哪里发送，发送给谁，内容是什么。这就是我们将<code class="fe od oe of og b">from</code>、<code class="fe od oe of og b">to</code>和<code class="fe od oe of og b">body</code>传入函数的地方。</li></ul><h2 id="4bd3" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">4.2创建WhatsApp报价API端点</h2><p id="6575" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">现在我们有了一个可以发送WhatsApp消息的工作平台<code class="fe od oe of og b">twilioService</code>。下一个任务是决定我们什么时候应该执行这个函数？现在，我们创建一个API端点来完成这项工作。这样，我们的Heroku调度程序就可以简单地对WhatsApp报价的端点执行HTTP调用。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="e757" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated"><code class="fe od oe of og b">server.js</code>创建基本的express应用程序和一个POST <code class="fe od oe of og b">/whatsappQuote</code>端点。每当调用这个API端点时，它都会执行<code class="fe od oe of og b">sendQuoteViaWhatsapp</code>函数。现在，让我们看看我们在这个函数中要做什么。</p><p id="6d2a" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated"><code class="fe od oe of og b">sendQuoteViaWhatsapp</code>详解:</p><ol class=""><li id="62da" class="mu mv it ma b mb mw me mx mh my ml mz mp na mt nb nc nd ne bi translated">首先，它需要一个带有<code class="fe od oe of og b">mobileNo</code>键的JSON主体。</li><li id="9310" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">然后，我们将通过<code class="fe od oe of og b">scrapQuoteOfTheDay</code>功能从网上抓取报价。</li><li id="b9ba" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">当我们得到报价时，我们执行之前编写的<code class="fe od oe of og b">sendWhatMessage</code>函数，将WhatsApp发送到我们的手机。</li><li id="9379" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt nb nc nd ne bi translated">现在，如果你试图启动API，你会在WhatsApp上收到报价信息。参考下面的截图，看看我收到了什么报价。</li></ol><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oj"><img src="../Images/e2ba7c595fac79c3148fc7844cc58748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fLwydJcocWvVuROi03eT9g.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">WhatsApp接收报价截图</p></figure><h2 id="3909" class="nn lh it bd li no np dn lm nq nr dp lq mh ns nt ls ml nu nv lu mp nw nx lw ny bi translated">4.3创建一个Heroku调度程序(cron作业)</h2><p id="7a6e" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">由于我的微服务项目部署在Heroku上，我正在探索Heroku实现我想要的而不是另一个平台的可能性。请随意使用您喜欢或熟悉的任何平台。</p><p id="336c" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">创建Heroku调度程序比你想象的要容易。以下是指南:</p><ol class=""><li id="77ed" class="mu mv it ma b mb mw me mx mh my ml mz mp na mt nb nc nd ne bi translated">转到您的Heroku应用仪表板。在附加输入字段中搜索<em class="ok"> Heroku Scheduler </em>。</li></ol><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ol"><img src="../Images/6f364ce246b27a22540403058fe811c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bs2shgL9t4FacQTDWe7c4g.png"/></div></div></figure><p id="9a99" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">2.选择<em class="ok"> Heroku Scheduler </em>并设置。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ol"><img src="../Images/6e30a8bab90e206b488d07be3450a737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7C-LAP0GI0yCYtT7PKkBoA.png"/></div></div></figure><p id="d6ee" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">3.现在你有一个工作的Heroku调度程序。那么我们需要自动化什么呢？我们只需每隔24小时在早上8点自动调用WhatsApp Quote API。我们只需对我们的API端点执行一个<code class="fe od oe of og b">curl</code>命令即可。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ol"><img src="../Images/71631ac6992db7302f35752d441e67b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qho6trGUaakDOYM_oiBN4w.png"/></div></div></figure><p id="63a6" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">下面是curl命令的例子。如果使用的话，你可以在<a class="ae ki" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>中轻松生成<code class="fe od oe of og b">curl</code>命令，如果你对<code class="fe od oe of og b">curl</code>命令不是很熟悉的话，这可以省去你很多麻烦。</p><pre class="kk kl km kn gt om og on oo aw op bi"><span id="c45a" class="nn lh it og b gy oq or l os ot">curl -X POST \<br/>  <a class="ae ki" href="http://127.0.0.1:8083/whatsappQuote" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8083/whatsappQuote</a> \<br/>  -H 'Accept: */*' \<br/>  -H 'Accept-Encoding: gzip, deflate' \<br/>  -H 'Cache-Control: no-cache' \<br/>  -H 'Connection: keep-alive' \<br/>  -H 'Content-Length: 34' \<br/>  -H 'Content-Type: application/json' \<br/>  -H 'Host: 127.0.0.1:8083' \<br/>  -H 'Postman-Token: f7be2ed4-da7f-4b31-9ead-a78820272fc9,91d8c930-6e69-42fc-8eaf-913b695aa386' \<br/>  -H 'User-Agent: PostmanRuntime/7.15.2' \<br/>  -H 'cache-control: no-cache' \<br/>  -d '{<br/>    "mobileNo": "YOUR_MOBILE_NO_REGISTERED_IN_TWILIO_SANDBOX"<br/>}'</span></pre><p id="9ac0" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">4.现在只需保存工作，并期待明天的激励报价发送到您的WhatsApp。我希望这一天的报价给你的生活带来价值。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="eac7" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="6c20" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Twilio集成非常简单，我相信您可以很快开发出来。然而，使用Twilio沙盒有几个缺点:</p><ul class=""><li id="e380" class="mu mv it ma b mb mw me mx mh my ml mz mp na mt oc nc nd ne bi translated">您只能在Twilio Sandbox中使用预定义的模板消息。</li><li id="fb1e" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt oc nc nd ne bi translated">Twilio Sandbox的试用积分有限，这意味着一旦积分用完，你可能最终无法使用Twilio WhatsApp。然而，如果你愿意支付，这将是一个非常好的解决方案。</li></ul><p id="7d1e" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">最后，我将分享开发这个项目时想到的一些想法:</p><ul class=""><li id="a9e1" class="mu mv it ma b mb mw me mx mh my ml mz mp na mt oc nc nd ne bi translated"><strong class="ma iu"> API认证和授权。</strong>目前，API对公众开放，这是相当冒险的。</li><li id="a39b" class="mu mv it ma b mb nf me ng mh nh ml ni mp nj mt oc nc nd ne bi translated"><strong class="ma iu">电子邮件集成。</strong>虽然发送WhatsApp信息很棒，但很多人不会轻易透露自己的手机号码。因此，电子邮件集成似乎是一个更有前途的解决方案，可以吸引更多的用户。</li></ul><p id="9d06" class="pw-post-body-paragraph ly lz it ma b mb mw ju md me mx jx mg mh nk mj mk ml nl mn mo mp nm mr ms mt im bi translated">自从我开始这个项目以来，还有很多东西需要探索。快乐发展，感谢您的阅读。</p></div></div>    
</body>
</html>