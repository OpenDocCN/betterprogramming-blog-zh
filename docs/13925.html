<html>
<head>
<title>How To Change Any iOS Setting in Control Centre During a UI Test</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在UI测试期间更改控制中心中的任何iOS设置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-change-any-setting-in-control-centre-during-a-ui-test-ea6377a31fd6?source=collection_archive---------6-----------------------#2022-10-14">https://betterprogramming.pub/how-to-change-any-setting-in-control-centre-during-a-ui-test-ea6377a31fd6?source=collection_archive---------6-----------------------#2022-10-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="2963" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">无需离开应用程序即可自动点击超过15个按钮</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/fd8dc9dac7a3705b077a7c8254318c55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XHkLaBoH74xTU_WUd-BCmA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@charlesdeluvio?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> charlesdeluvio </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="06d1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">控制中心允许你在不离开应用程序的情况下更改许多系统设置，这在自动化UI测试中非常有用。</p><p id="41bb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这包括更改设备的互联网连接，无论是通过禁用WiFi还是蜂窝数据。这使得我可以看到我的应用程序如何实时响应连接故障，让我可以确保用户得到通知，并且API请求不会白白发送。</p><p id="c480" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我称它为“控制中心”，而不是“控制中心”，因为我来自英国。</p><p id="a106" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你喜欢用美国的方式做事，请随意替换我代码中的英国拼写。</p><p id="3594" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我将从向我的应用程序添加一个UI测试目标开始。为此，我在Xcode的左侧面板中选择Test navigator，并选择New UI Test Target。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj lw"><img src="../Images/2b3dda0ef828275bf0caf3b20648bd06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/0*Vz6n4guWqIa-qt5h.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者图片</p></figure><p id="abae" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我的应用程序被恰当地命名为<code class="fe lx ly lz ma b">MyApp</code>，所以我的测试目标的默认名称是<code class="fe lx ly lz ma b">MyAppUITests</code>。</p><p id="30c4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您的应用程序或UI测试目标被称为什么并不重要，因为它不会以任何方式影响功能。</p><p id="5bcd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">新创建的测试类将带有一些样板代码，但是您可以删除所提供的内容。我将从我认为的UI测试的最低要求开始:一个存储视图层次结构最高级别的<code class="fe lx ly lz ma b">app</code>属性，我可以在设置过程中调用这个属性的<code class="fe lx ly lz ma b">launch()</code>。</p><p id="77d2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">得知<code class="fe lx ly lz ma b">continueAfterFailure</code>的默认值为true，我觉得很有意思，但是苹果的模板UI测试类总是手动将其设置为false，这就提出了为什么一开始就默认为true的问题。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mb mc l"/></div></figure><p id="364c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">除了创建一个不做任何事情的非常基本的UI测试类，我还扩展了<code class="fe lx ly lz ma b">XCUIApplication</code>来给自己一些有用的功能。</p><p id="34e1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，有一个简单的方法来访问跳板，iOS系统应用程序负责主屏幕和其他事情。</p><p id="0d3d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">纪录片《跳板》讲述的是Visorphone Handspring，这是一款早期智能手机，对行业产生了巨大影响。我不知道它的命名是否是为了承认苹果公司受到Handspring的启发，但它肯定符合他们将自己受到启发的想法的名称融入其中的趋势。Sherlocking这个词来源于苹果抄袭了现有的沃森软件，称他们的版本为夏洛克。</p><p id="6791" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">控制中心是跳板应用程序的一部分，所以如果我想找到任何按钮，我需要访问它。</p><p id="7776" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">被称为<code class="fe lx ly lz ma b">app,</code>的<code class="fe lx ly lz ma b">XCUIApplication</code>的实例引用了当前正在测试的应用程序。它不能查询另一个应用程序的层次结构。</p><p id="8a8a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在那下面我有<code class="fe lx ly lz ma b">controlCentre(open: Bool)</code>、<code class="fe lx ly lz ma b">tapControlCentreButton(label: String)</code>和<code class="fe lx ly lz ma b">toggleControlCentreSwitch(identifier: String)</code>。</p><p id="9a3f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为什么开关用标识符，按钮用标签？</p><p id="a776" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我发现标签的变化是为了指定状态。比如WiFi，没有连接。标识符始终保持不变，从而更容易在两个方向切换设置，而不必指定不同的标签。一个例外是黑暗模式，由于某种原因，它只有一个标签，没有标识符。</p><p id="e17c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然常规按钮没有变化的状态，但是我发现控制中心的一些按钮只有一个标签，它们的标识符是空白的。</p><p id="e3b7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因为它永远不会改变，所以使用标签来访问按钮是没问题的。</p><p id="9167" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我可以开始实际测试我的应用程序了。代码如下:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mb mc l"/></div></figure><p id="992e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可能想知道我是如何找到这些元素的标识符和标签的。当控制中心打开时，打印<code class="fe lx ly lz ma b">XCUIApplication.springboard.switches </code>或<code class="fe lx ly lz ma b">XCUIApplication.springboard.buttons</code>告诉我一切。你可能需要这样做，如果你添加自定义控制中心按钮，因为我试图坚持在这里的默认值。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mb mc l"/></div></figure><p id="03f1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我现在可以在控制中心修改13种不同的设置，但是为什么要止步于此呢？</p><p id="aabf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">相反，我将做一些更复杂的事情，这将需要另一个<code class="fe lx ly lz ma b">XCUIApplication</code>的扩展。当控制中心被打开时，媒体控制在一个小部件中。轻按此按钮会显示一个更大的版本，这对于UI测试能够轻按AirPlay图标非常有用。</p><p id="ab48" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个按钮的标签是AirPlay audio，但苹果忘记给它一个标识符。</p><p id="a68e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这意味着当您选择了一个输出设备(如AirPods或HomePod)时，标签会改变以反映新图标。为了不让我的测试在选择输出设备时失败，我决定只选择媒体控件中包含的最后一个按钮。</p><p id="b2a0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这似乎总是AirPlay按钮，不管其他正在进行的事情。</p><p id="61e8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，有必要调用两次<code class="fe lx ly lz ma b">controlCentre(open: false)</code>，因为第一次点击会在控制中心本身被解除之前解除扩展的媒体控制。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mb mc l"/></div></figure><p id="f177" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">测试AirPlay时，我会打开控制中心，然后打开AirPlay菜单。我正在获取所有的设备，每个设备都是<code class="fe lx ly lz ma b">staticText</code>。唯一的另一个<code class="fe lx ly lz ma b">staticText</code>在扬声器和电视按钮下面，所以我把它从数组中过滤掉了。</p><p id="2ef1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我还打印了可用的AirPlay设备，主要是为了演示如果您有特定的想法，可以从这个数组中选择一个选项。</p><p id="2f2b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，<code class="fe lx ly lz ma b">testAudioControls</code>一次按下一个媒体控件，与AirPlay按钮不同的是，这不需要首先展开小部件。</p><pre class="kk kl km kn gu md ma me mf aw mg bi"><span id="a15d" class="mh mi iu ma b gz mj mk l ml mm"><strong class="ma iv">Want Daily Coding Tips like these?</strong></span><span id="d5a8" class="mh mi iu ma b gz mn mk l ml mm">This tutorial previously appeared in my newsletter <a class="ae kz" href="https://typesafely.substack.com/" rel="noopener ugc nofollow" target="_blank">Type Safely</a>.</span></pre></div></div>    
</body>
</html>