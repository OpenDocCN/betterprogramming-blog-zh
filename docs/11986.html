<html>
<head>
<title>4 Ways Big Query Metadata Can Help You</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大型查询元数据可以帮助您的4种方式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-ways-big-query-metadata-can-help-you-2cdf3b899fbc?source=collection_archive---------15-----------------------#2022-05-02">https://betterprogramming.pub/4-ways-big-query-metadata-can-help-you-2cdf3b899fbc?source=collection_archive---------15-----------------------#2022-05-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3417" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">获取有关表、作业等的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/026ef4907cb77b9eb62309e5428390cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MI15lWHDuPB6HqJn"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@hharritt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亨特·哈里特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="c45d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义元数据的一种常见方式是“关于数据的数据”。在Big Query中，元数据非常有用和方便，因为它被组织在一系列名为<code class="fe lv lw lx ly b">INFORMATION_SCHEMA</code> <strong class="lb iu">的视图中。</strong></p><p id="3f11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是如何使用大查询元数据的四个例子。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d916" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">1.重新创建表格</h1><p id="5a88" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">您是否曾经连续创建了10个表，然后意识到在其中的每一个表中都错误地命名了一列？幸运的是，<code class="fe lv lw lx ly b">TABLES</code>元数据视图可以提供帮助。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="9828" class="nh mh it ly b gy ni nj l nk nl">SELECT table_name, ddl <br/>FROM the_look.INFORMATION_SCHEMA.TABLES</span></pre><p id="2b1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个请求将为您提供用于创建表的DDL(<strong class="lb iu">D</strong>ATA<strong class="lb iu">D</strong>definition<strong class="lb iu">L</strong>anguage)查询。然后，您可以复制粘贴DDL语句并对其进行编辑，以重新创建您的表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/ffad3a3491517083bc21218a93ce432b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cq5MQlqsPZabDx6aDqaw-A.png"/></div></div></figure><h1 id="f3aa" class="mg mh it bd mi mj nn ml mm mn no mp mq jz np ka ms kc nq kd mu kf nr kg mw mx bi translated">2.访问历史</h1><p id="68be" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">“历史记录”选项卡仅允许您访问上周执行的作业。幸运的是，您可以通过使用<code class="fe lv lw lx ly b">JOBS</code>视图来跨越这些限制。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="01e9" class="nh mh it ly b gy ni nj l nk nl">SELECT job_type, query<br/>FROM `region-us`.INFORMATION_SCHEMA.JOBS_BY_PROJECT<br/>WHERE DATE(creation_time) = "2022-04-26"</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/afe5be4240d2b9ee0050af3d4a4478b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z4aAL2bJNbffOzWICN6t9Q.png"/></div></div></figure><h1 id="6ae7" class="mg mh it bd mi mj nn ml mm mn no mp mq jz np ka ms kc nq kd mu kf nr kg mw mx bi translated">3.动态选择列</h1><p id="4c00" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">假设您只想从表中选择字符串列。不幸的是，标准SQL不允许动态选择列。这就是<code class="fe lv lw lx ly b">COLUMNS</code>视图派上用场的地方。</p><p id="f097" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过查询视图，我们可以获得所需列的概述:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="82b9" class="nh mh it ly b gy ni nj l nk nl">SELECT *<br/>FROM the_look.INFORMATION_SCHEMA.COLUMNS<br/>WHERE table_name = "orders_analysed_table" AND data_type = "STRING"</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/5bf60e41cab161033d5228e7b3c9a2e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uz4PnWMotm01QwAX6iMMBQ.jpeg"/></div></div></figure><p id="3f2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以使用脚本铭文将列名存储到一个变量中，并显示动态查询的结果:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="bf6f" class="nh mh it ly b gy ni nj l nk nl"><br/>DECLARE select_query STRING;<br/>EXECUTE IMMEDIATE<br/>"""SELECT STRING_AGG(column_name, ",")<br/>FROM the_look.INFORMATION_SCHEMA.COLUMNS<br/>WHERE table_name = "orders_analysed_table" AND data_type = "STRING"<br/>"""<br/>INTO select_query;<br/>EXECUTE IMMEDIATE FORMAT("""<br/>SELECT %s<br/>FROM the_look.orders_analysed_table<br/>""", select_query)</span></pre><p id="4ce6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个查询的作用是:</p><ul class=""><li id="7929" class="nu nv it lb b lc ld lf lg li nw lm nx lq ny lu nz oa ob oc bi translated">声明一个字符串类型的变量</li><li id="b5ea" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated">执行查询以获取表中的字符串列，并将其存储在前面的变量中</li><li id="38ab" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated">用变量格式化选择查询并执行它</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/08fa8f6014165cbbcb9b55ae04c029a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W-rGuF6HXkPomCq2XMN5xg.jpeg"/></div></div></figure><h1 id="994c" class="mg mh it bd mi mj nn ml mm mn no mp mq jz np ka ms kc nq kd mu kf nr kg mw mx bi translated">4.监控您的成本</h1><p id="3b5c" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">当试图监控您的成本时，元数据也可以派上用场。你可以使用<code class="fe lv lw lx ly b">JOBS_TIMELINE</code>视图来检查你支出的变化。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="9287" class="nh mh it ly b gy ni nj l nk nl">SELECT DATE(job_creation_time) AS date, SUM(total_bytes_billed) AS total_bytes_billed<br/>FROM `region-us`.INFORMATION_SCHEMA.JOBS_TIMELINE_BY_PROJECT<br/>WHERE DATE(job_creation_time) &gt;= "2022-04-01"<br/>GROUP BY 1<br/>ORDER BY 1</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/c6b70bc91a0b890d1af292fbba186a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*jpPDLJRahrkPDG9kWd5vRw.jpeg"/></div></figure><p id="1708" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想更进一步？为什么不使用大型查询时间序列模型来预测下个月的账单字节数呢？</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="85c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想了解更多关于BQ元数据的信息，您可以查看<a class="ae ky" href="https://cloud.google.com/bigquery/docs/information-schema-intro" rel="noopener ugc nofollow" target="_blank"> INFORMATION_SCHEMA文档</a>以获得更多信息。</p></div></div>    
</body>
</html>