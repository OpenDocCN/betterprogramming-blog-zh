<html>
<head>
<title>How to Deploy a Web Application to Cloud Run Automatically</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Web应用程序部署到自动运行的云</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-deploy-a-web-application-to-cloud-run-automatically-6967d7c7d42a?source=collection_archive---------13-----------------------#2022-04-27">https://betterprogramming.pub/how-to-deploy-a-web-application-to-cloud-run-automatically-6967d7c7d42a?source=collection_archive---------13-----------------------#2022-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c5c5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将CI/CD应用于您的web应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d65a0fef84b195ea279e61490caab0b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bT14___rw9A1pjyq.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由Pixabay的<a class="ae ky" href="https://pixabay.com/illustrations/cloud-computer-hosting-3406627/" rel="noopener ugc nofollow" target="_blank"> kreatikar </a>拍摄</p></figure><p id="7062" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用一些web Python web框架，如Flask、Django或FastAPI，可以很容易地用Python开发API或web应用程序。作为一个Python开发者，这些框架都是原生的，很容易上手，因为你不需要学习JavaScript这样的全新前端语言加上它的React、Angular、Vue等框架。</p><p id="160c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文不是关于如何用Python框架开发API或web应用程序。然而，它关注的是如何将web应用程序部署到持续运行的云上。之所以选择Flask框架，是因为它使用简单，并且有一个很大的社区。这篇文章中介绍的过程适用于所有Python框架。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="105d" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">本地安装烧瓶</h2><p id="1f4d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在生产环境中将我们的代码部署到云中之前，我们需要在本地开发它，并做好一切准备。</p><p id="3396" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是在你的计算机上安装框架。建议在虚拟环境中安装Flask，这样它就不会干扰系统库。此外，您可以在不同的虚拟环境中安装不同版本的Flask。</p><p id="96b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用Python native <code class="fe na nb nc nd b">venv</code>库来管理您的虚拟环境。或者，你可以使用<a class="ae ky" href="https://docs.conda.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> conda </a>，因为你可以方便地用conda安装不同版本的Python。此外，您可以从任何地方激活虚拟环境，无需担心虚拟环境的元数据。如果您想了解更多关于康达的信息，请点击此处的<a class="ae ky" href="https://lynn-kwong.medium.com/how-to-create-virtual-environments-with-venv-and-conda-in-python-31814c0a8ec2" rel="noopener">。</a></p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="7b63" class="mc md it nd b gy ni nj l nk nl">(base)$ <strong class="nd iu">conda create --name flask python=3.10<br/></strong>(base)$<strong class="nd iu"> conda activate flask<br/></strong>(flask)$ <strong class="nd iu">pip install Flask==2.1.1</strong></span></pre><p id="9b8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了Flask之外，Flask需要的几个依赖项是自动安装的。现在我们可以开始在本地创建一个Flask应用程序。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="3612" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">在本地准备烧瓶应用程序</h2><p id="7dd6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们将创建一个超级简单的“Hello World！”Flask应用程序，因为重点是即将推出的持续部署(CD)配置。</p><p id="a9b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个名为<code class="fe na nb nc nd b">my_app</code>的文件夹，并导航到其中。然后创建一个名为<code class="fe na nb nc nd b">app.py</code>的文件。你可以给它起任何你喜欢的名字，但是通常把它命名为<code class="fe na nb nc nd b">app.py</code>或者<code class="fe na nb nc nd b">wsgi.py</code>，这样一些本地的网络服务器可以很容易地找到它。将以下代码添加到<code class="fe na nb nc nd b">app.py</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="065a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们从环境变量中读取应用程序的名称，所以让我们先设置它:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="53f1" class="mc md it nd b gy ni nj l nk nl">$ <strong class="nd iu">export APP_NAME='My fun flask App'</strong></span></pre><p id="347e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">稍后我们将看到如何在云运行中设置环境。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="4249" class="mc md it nd b gy ni nj l nk nl">$ <strong class="nd iu">python app.py</strong></span><span id="374f" class="mc md it nd b gy no nj l nk nl"># OR</span><span id="cd71" class="mc md it nd b gy no nj l nk nl">$ <strong class="nd iu">export FLASK_ENV=development</strong><br/>$ <strong class="nd iu">flask run -p 5000</strong></span></pre><p id="c73f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果使用端口5000，如果需要，您可以找到并停止当前应用程序:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="56cf" class="mc md it nd b gy ni nj l nk nl">$ <strong class="nd iu">sudo lsof -i -P -n | grep -ie '\b5000\b'<br/></strong>$<strong class="nd iu"> kill &lt;PID&gt;</strong></span></pre><p id="1a88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以为<code class="fe na nb nc nd b">app.run</code>或<code class="fe na nb nc nd b">flask run</code>指定不同的端口，如上所示。当Flask运行时，您可以在控制台中看到以下信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="811a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您访问<a class="ae ky" href="http://127.0.0.1:5000," rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000，</a>您将看到来自我们应用程序的问候:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/b9530067c0a97f26e6bee31b7ef88298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*ZK5nEWRX-XhVKKYITQe1ew.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="e133" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">本地测试gunicorn</h2><p id="77bc" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">因为我们稍后将使用<code class="fe na nb nc nd b"><a class="ae ky" href="https://gunicorn.org/" rel="noopener ugc nofollow" target="_blank">gunicorn</a></code>在云运行中服务我们的Flask应用程序，所以让我们在本地安装它，并确保应用程序可以由<code class="fe na nb nc nd b">gunicorn</code>服务。</p><p id="6e0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">gunicorn</code>可以在您的虚拟环境中安装pip:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="f8cf" class="mc md it nd b gy ni nj l nk nl">$ <strong class="nd iu">pip install gunicorn==20.1.0</strong></span></pre><p id="341e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用<code class="fe na nb nc nd b">gunicorn</code>为应用程序提供服务:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="0fe1" class="mc md it nd b gy ni nj l nk nl">$ <strong class="nd iu">gunicorn --bind :5001 app:app</strong></span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2e46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您没有停止上面运行的Flask应用程序，您需要在这里指定一个不同的端口。<code class="fe na nb nc nd b">--bind</code>选项采用<strong class="lb iu"> IP:port </strong>的形式。请注意，IP可以省略，但冒号必须存在。如果IP被省略，那么<code class="fe na nb nc nd b">gunicorn</code>被绑定到127.0.0.1。</p><p id="7a90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，应用程序以<code class="fe na nb nc nd b">APP_MODULE:APP_INSTANCE_NAME</code>的形式指定。在我们的应用程序中，模块和应用程序实例都被命名为<code class="fe na nb nc nd b">app</code>，但是在您的应用程序中它们可以是不同的。特别是，如果您通过应用程序工厂创建应用程序实例，如<a class="ae ky" href="https://flask.palletsprojects.com/en/2.1.x/tutorial/factory/" rel="noopener ugc nofollow" target="_blank"> Flask教程</a>所示，您将需要以<code class="fe na nb nc nd b">APP_MODULE:APP_FACTORY_FUNC()</code>的形式启动应用程序，也就是说，您需要显式调用应用程序工厂来创建应用程序实例。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="5bfb" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建需求. txt</h2><p id="e6f3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们已经在本地虚拟环境中安装了一些库。这些库也需要安装在Cloud Run中，这样Flask才能在那里正常工作。为此，我们需要将所有需要的库放在一个名为<code class="fe na nb nc nd b">requirements.txt</code>的文件中，这是Python指定库依赖关系所需的标准文件。</p><p id="c240" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要将烧瓶和<code class="fe na nb nc nd b">gunicorn</code>放入<code class="fe na nb nc nd b">requirements.txt</code>:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="73f5" class="mc md it nd b gy ni nj l nk nl"># requirments.txt<br/>Flask==2.1.1<br/>gunicorn==20.1.0</span></pre><p id="7b4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的应用程序需要其他库，也应该添加它们。此外，如果您需要在本地虚拟环境(如mypy和pylint)中安装一些助手库，但不想在生产环境<code class="fe na nb nc nd b">requriements.txt</code>中安装它们，您可以创建一个名为<code class="fe na nb nc nd b">requirements-dev.txt</code>的附加文件并将它们放在那里。这个文件的名字并不重要，但是<code class="fe na nb nc nd b">requirements-dev.txt</code>是一个常用的名字。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="a9fa" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建Dockerfile文件</h2><p id="8a83" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Cloud Run与<a class="ae ky" href="https://lynn-kwong.medium.com/build-a-docker-image-with-cloud-build-in-google-cloud-platform-5f6840af2c05" rel="noopener"> Cloud Build </a>紧密合作，后者从你的GitHub库自动构建Docker映像。Cloud Run使用Cloud Build构建的Docker映像来加速您的应用程序。因此，要使用云运行，您还应该启用云构建API。</p><p id="5b30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cloud Run的<a class="ae ky" href="https://cloud.google.com/run/docs/quickstarts/build-and-deploy/deploy-python-service" rel="noopener ugc nofollow" target="_blank">官方文档</a>提供的Dockerfile就是一个很好的例子，在大多数情况下都可以这样工作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="6347" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个Dockerfile文件有很好的文档，并且简单易懂。尤其是<strong class="lb iu">端口</strong>虚拟环境会被云运行自动传入，我们很快就会看到我们设置云运行的时候。</p><p id="20da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，指定一个<code class="fe na nb nc nd b">.dockerignore</code>文件从Docker映像中排除一些元数据或临时文件也很有帮助。可以让你的形象变小，看起来更干净。一个样本<code class="fe na nb nc nd b">.dockerignore</code>文件可以包含以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="2698" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">部署到云运行</h2><p id="1ee6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">您可以使用以下命令在本地部署Flask应用程序:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="54c2" class="mc md it nd b gy ni nj l nk nl">$ <strong class="nd iu">gcloud run deploy</strong></span></pre><p id="c56b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需按照说明逐步部署您的应用程序。</p><p id="bb83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您想对部署过程有更多的控制，最好使用GCP控制台。如果您想建立一个连续部署(CD)管道，在控制台中完成会简单得多。</p><p id="6497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，让我们前往GCP控制台中的云运行页面。你可以在左侧导航栏找到Cloud Run，也可以直接在顶部搜索框搜索。然后点击“创建服务”以创建新的云运行服务:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/4f19656b8c9cd1bce60dbb124572b0f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bwrKTa29L4xAQ9L7R4rmdw.png"/></div></div></figure><p id="336e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在打开的页面上，由于我们想要设置一个连续的部署管道，点击第二个选项“从一个源存储库中连续地部署新的修订”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/4af10ba31d68f9f32da35ae4963ea566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*VaEWSC1dhN0Fn5iRWBWrvw.png"/></div></figure><p id="ed3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后点击“使用云构建设置”来为云运行选择GitHub存储库。这个存储库将包含构建和部署应用程序的源代码和配置。</p><p id="5576" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想继续，你可以把这个库的<a class="ae ky" href="https://github.com/lynnkwong/flask-cloud-run-app" rel="noopener ugc nofollow" target="_blank">分支到你的GitHub账户，然后继续下面的步骤。或者，您可以将如上所示的Dockerfile文件添加到您自己的存储库中。</a></p><p id="f8c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果是第一次从GitHub仓库部署云运行服务，您需要在GitHub仓库中安装“Google Cloud Build”工具:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/edbca6b88a9656185e3a3e74a01e1489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*DaEeNjNHE0Ya95l7XccNuA.png"/></div></figure><p id="b7ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你点击“安装Google Cloud Build”时，会打开一个新窗口，提示你在你所有的GitHub库或者一个特定的库中安装“GOOGLE CLOUD BUILD”。选择您想要的，然后单击“安装”进行安装:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/445678b6adba0a4a53e653a1f4240ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*2Z307jKroiTkaZyngB0lBQ.png"/></div></figure><p id="39b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将被要求验证您的GitHub帐户。之后，您将能够在Cloud Build中看到您的GitHub存储库。选择它并接受在GCP项目中使用GitHub库的协议:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/c99ba60555fa6f64a176376242c7c4d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*6RCN2_YxGXB2PzuuOpbYiw.png"/></div></figure><p id="4c2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“下一步”指定“构建配置”。您需要选择运行云构建的分支。此外，您需要指定一个构建类型。我们将使用docker文件来构建我们的应用程序。在大多数情况下，这两个选项都可以保留为默认值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/99f42e47d25e3f30f389a4f8e95b6ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*ai7KLs1wMOHmbsLJtsJgpw.png"/></div></figure><p id="536f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“保存”保存云构建的配置。</p><p id="b4cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后需要指定一些云运行的基本配置。同样，默认配置在大多数情况下已经足够:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/790adb3cf35623524d83bbe11d70ff6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*P02mvue8p9h873bgPx8TZg.png"/></div></figure><p id="2648" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些选项是不言自明的，也有有用的提示。这就是为什么推荐部署控制台的原因，尤其是对于初学者。你可以对你正在做的事情有更多的理解和更多的控制，而不是把它当作一个黑箱。</p><p id="55b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尤其是“CPU分配和定价”选项会大幅增加账单。如果您选择默认的可选“CPU仅在请求处理期间分配”，那么通常情况下，如果您没有很多流量，您就不必为此付费。然而，如果你选择“CPU总是被分配”，你将需要每月支付相当多的费用。请务必查看<a class="ae ky" href="https://cloud.google.com/products/calculator" rel="noopener ugc nofollow" target="_blank">谷歌云定价计算器</a>了解更多详情。</p><p id="55c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能还记得，我们在Flask应用程序中读取了一个环境变量<code class="fe na nb nc nd b">APP_NAME</code>。让我们为它设置一个值，看看这个值是否能被Cloud Run读取。为此，展开“容器、变量&amp;机密、连接、安全”并单击“变量&amp;机密”选项卡。添加一个你喜欢的值的环境<code class="fe na nb nc nd b">APP_NAME</code>，说“我的第一个云运行服务”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/fac6bd6a97f37bff64d73a9fa5aad702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*R_0bkdqpgItt_5A4DcL0tQ.png"/></div></figure><p id="5ecf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后点击“创建”来创建您的服务。Cloud Build将在不到一分钟的时间内构建您的Docker容器，然后才能在您的云运行服务中使用它。</p><p id="9b2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">部署完成后，您将进入如下所示的页面。您可以在此页面上检查指标、日志、修订等。如果您的服务有问题，日志总是第一个检查的地方。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/6f1380123fb9a1c88f9d7bf54ae3d3be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7vTTWps6IuVzntCnnR8vaQ.png"/></div></div></figure><p id="9bce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果您点击该页面上的URL，您应该能够打开由Flask构建的简单网站:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/7651c6bb7bac56f72d4f7addbb56b0e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*FyGwmoM45HycHOi3cnP0EA.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="4a45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你！Flask web应用程序的CI/CD管道已经构建在云运行中。现在如果你在主分支上做了一些改动，把代码推送到GitHub上，一个新的Docker镜像会自动构建，一个新版本的Cloud Run会自动为你部署。</p></div></div>    
</body>
</html>