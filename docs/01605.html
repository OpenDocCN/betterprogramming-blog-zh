<html>
<head>
<title>Python Project — Bob the Twitter Bot 2.0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python项目——Bob the Twitter Bot 2.0</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/python-project-bob-the-twitter-bot-2-0-f7dc6f7c48ba?source=collection_archive---------4-----------------------#2019-09-27">https://betterprogramming.pub/python-project-bob-the-twitter-bot-2-0-f7dc6f7c48ba?source=collection_archive---------4-----------------------#2019-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="6f48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">给我的Twitter机器人升级，帮助我找到免费的机器学习资源</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/155acc74396020e7fbe74ce7eca3f7b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dQ-T47IHT-fcrDm9k4hFGA.jpeg"/></div></div></figure></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="76c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为我的第一个Python项目之一，我创建了Bob，一个在我的Twitter上发布励志名言的Ywitter机器人。</p><p id="9a62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">鲍勃每天早上8点都会引用theysaidso.com的话，给我推特上的每个人以灵感。</p><p id="ee7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在过去的几个月里，我一直在自学机器学习和数据科学，努力成为一名数据科学家。旅程非常有趣，我非常喜欢。</p><p id="bd2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，由于我一直在处理不同的数据科学项目，我意识到我需要学习更多关于Pythonic代码的知识，以便有效地遍历和操作数据集。因此，在接下来的一个月里，我将阅读《流畅的Python》，同时阅读一本关于统计学的书，为自己进入机器学习算法的高速运转做准备。</p><p id="813b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">项目对于学习来说很重要，我决定我的机器人应该升级了，因为我在7月份就完成了。</p><p id="97b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">回头看看代码，我很震惊——到处都是创建的函数。现在我对Python面向对象的本质有了更多的了解，我认为这是一个很好的机会来重构我的机器人，并使用它来使我的生活变得更容易。互联网巨大，免费资源那么多。我觉得用Bob在Twitter上搜索免费的机器学习资源，然后把链接发给我会是一个有趣的想法。</p><p id="6fc0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Bob 1.0和2.0的完整代码可以在我的<a class="ae lh" href="https://github.com/Kristian-Roopnarine/Bob-the-Twitter-bot" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中找到:</p><div class="li lj gp gr lk ll"><a href="https://github.com/Kristian-Roopnarine/Bob-the-Twitter-bot" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd iu gy z fp lq fr fs lr fu fw is bi translated">克里斯蒂安-鲁普那林/鲍勃-推特-机器人</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">github.co</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz ky ll"/></div></div></a></div></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="085c" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">鲍勃是如何升级的？</h1><p id="b563" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">一般来说，创建类有助于保持代码的整洁和可读性，因为它有助于关注点的分离。</p><p id="be03" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以创建一个类来存储数据，然后创建方法来处理这些数据，这样就可以在一个地方找到所有内容。</p><p id="36ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了重构这段代码，我认为创建一个<code class="fe nd ne nf ng b">‘TwitterAccount’</code>类是个好主意，所有与Twitter账户相关的方法都将放在这个类中。</p><p id="b9f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于这个特定的机器人，我需要一个方法来通过Tweepy访问我的Twitter帐户，发布鼓舞人心的报价，然后创建一个新的方法来搜索关于免费机器学习资源的推文。我们需要一种初始化该类的方法和一种访问Twitter帐户的方法。</p><pre class="kp kq kr ks gt nh ng ni nj aw nk bi"><span id="207d" class="nl mb it ng b gy nm nn l no np">class TwitterAccount:    <br/> <br/>def__init__(self,consumer_key,consumer_secret,access_token,access_token_secret):        <br/>    self.consumer_key = consumer_key        <br/>    self.consumer_secret= consumer_secret        <br/>    self.access_token =access_token        <br/>    self.access_token_secret = access_token_secret   </span><span id="c09a" class="nl mb it ng b gy nq nn l no np">     <br/>def access(self):        <br/>    auth =       tweepy.OAuthHandler(self.consumer_key,self.consumer_secret)             auth.set_access_token(self.access_token,self.access_token_secret)            return tweepy.API(auth) # returns api object</span></pre><p id="51be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我用访问帐户所需的信息创建了一个<code class="fe nd ne nf ng b">TwitterAccount</code>类:访问和消费者密钥。</p><p id="f6f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">access方法返回一个API对象，该对象用于通过使用这些键与Twitter帐户进行通信。</p><p id="3f1c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们需要更多的方法来发布报价，然后通过推文进行搜索。发布报价非常简单，因为它只是我们之前为Bob 1.0编写的代码的扩展:</p><pre class="kp kq kr ks gt nh ng ni nj aw nk bi"><span id="d42c" class="nl mb it ng b gy nm nn l no np">def post(quote_details):<br/>      self.access().update_status('"%s." \n-%s \n\n Daily   Inpsiration From Bob the Twitter Bot' % (quote_details))</span></pre><p id="794e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">和以前一样，报价细节将是一个向theysaidso.com发出当天报价请求的函数，并从相应的JSON中提取报价信息。</p><pre class="kp kq kr ks gt nh ng ni nj aw nk bi"><span id="c8cb" class="nl mb it ng b gy nm nn l no np">def get_quote(url):    <br/>    response = requests.get(url)    <br/>    quote_info =   json.loads(response.content).get('contents').get('quotes')[0]                                         quote = quote_info.get('quote')    <br/>    author = quote_info.get('author')    <br/>    return quote,author</span></pre><p id="7dfb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面的函数将返回我们将输入到<code class="fe nd ne nf ng b">TwitterAccount.post()</code>方法中的<code class="fe nd ne nf ng b">quote_details</code>。现在我们要做的就是找出如何在Twitter上搜索特定的推文，然后在一天中的特定时间把这些推文发给自己。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="31d0" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">使用Python发送文本消息</h1><p id="d468" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">我认为下一个重要的部分是弄清楚如何使用Python来发送文本消息。弄清楚这一点后，我可以阅读关于使用Tweepy搜索Twitter的文档。</p><p id="0860" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我去YouTube上找了一些如何使用Python发送短信的视频，亚马逊网络服务有一个简单的通知服务(SNS)，你可以在那里发送短信。</p><p id="5df9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您创建一个帐户(您可以获得长达12个月的免费服务)，并为SNS注册一个用户。</p><p id="4c25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后安装AWS CLI来设置您的凭证，当您运行脚本时，程序将能够使用这些凭证发送消息。</p><p id="621d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们用来发送这些消息的模块是Boto 3，所以你需要从命令行安装它。设置好凭证后，导入Boto 3。发送消息的代码只有两行。</p><pre class="kp kq kr ks gt nh ng ni nj aw nk bi"><span id="1aee" class="nl mb it ng b gy nm nn l no np">import boto3</span><span id="8a29" class="nl mb it ng b gy nq nn l no np">client = boto3.client('sns',region_name='us-east-1')</span><span id="4cb6" class="nl mb it ng b gy nq nn l no np">client.publish(PhoneNumber='', Message='')</span></pre><p id="52de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以根据发送消息的目的地选择一个区域，并将其存储在客户端变量中。然后，您只需应用publish方法向相应的电话号码发送SMS文本。既然我们已经解决了这个问题，让我们看看如何使用Tweepy搜索Twitter。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="f299" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">使用Tweepy搜索推文</h1><p id="3c24" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">Tweepy有很多方法可以让你和你的Twitter账户互动。有一些允许你关注用户，检查你的时间表，搜索标签，等等。</p><p id="8771" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在编写代码之前，我在Twitter网站上做了一些测试，只是为了了解搜索各种主题时的输出。</p><p id="395a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我注意到，当我搜索像“机器学习”或“数据科学”这样的词时，我会得到所有包含这些词的推文(当然)。然后我试着搜索标签，结果更符合我的要求。主要是专业人士发布关于趋势和资源的信息。</p><p id="7233" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们已经有了搜索项，所以让我们来看看如何使用Tweepy进行搜索。<code class="fe nd ne nf ng b">tweepy.Cursor</code>通常用于使用不同的搜索查询来搜索Twitter。它将返回一个cursor对象，我们只需从这些对象中提取文本来获取我们的tweets。</p><p id="87e0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为这是我们在Twitter账户上要做的事情，所以把它作为一个方法添加到我们的<code class="fe nd ne nf ng b">TwitterAccount</code>类中是合适的。</p><pre class="kp kq kr ks gt nh ng ni nj aw nk bi"><span id="2392" class="nl mb it ng b gy nm nn l no np">def search_hashtags(self,hashtags):</span><span id="828f" class="nl mb it ng b gy nq nn l no np">    #returns a cursor object</span><span id="fc63" class="nl mb it ng b gy nq nn l no np">    tweets =   tweepy.Cursor(self.access().search,q=hashtags,result_type='recent'). items(100)</span><span id="6def" class="nl mb it ng b gy nq nn l no np">    tweet_info = [tweet.text for tweet in tweets]</span><span id="85b8" class="nl mb it ng b gy nq nn l no np">    return tweet_info</span></pre><p id="238a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的<code class="fe nd ne nf ng b">tweepy.Cursor</code>有几个参数——第一个是我们希望机器人做的动作，即搜索Twitter。</p><p id="20a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe nd ne nf ng b">q</code> <em class="nr"> </em>参数是搜索项，我们可以通过最近的100篇文章过滤搜索。</p><p id="4971" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我们执行列表理解，从光标对象中的每条tweets中提取文本。</p><p id="010a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我不想要所有这100条推文，所以我将根据一些关键词过滤这些推文，这些关键词将帮助我找到免费的机器学习资源。为此，我认为我们应该给<code class="fe nd ne nf ng b">TwitterAccount</code>类添加另一个方法。</p><pre class="kp kq kr ks gt nh ng ni nj aw nk bi"><span id="b769" class="nl mb it ng b gy nm nn l no np">def filter_feed(self):</span><span id="a1ba" class="nl mb it ng b gy nq nn l no np">    search_word = '#MachineLearning -filter:retweets'</span><span id="a2c1" class="nl mb it ng b gy nq nn l no np">    filter_words = ['free','course','book','eBook']</span><span id="94ba" class="nl mb it ng b gy nq nn l no np">    cs_tweets = self.search_hashtags(search_word)</span><span id="605e" class="nl mb it ng b gy nq nn l no np">    text_tweets =[]</span><span id="989a" class="nl mb it ng b gy nq nn l no np">    for filters in filter_words:</span><span id="00da" class="nl mb it ng b gy nq nn l no np">        for tweets in cs_tweets:</span><span id="b491" class="nl mb it ng b gy nq nn l no np">            if filters in tweets:</span><span id="60ce" class="nl mb it ng b gy nq nn l no np">            text_tweets.append(tweets)</span><span id="f6e5" class="nl mb it ng b gy nq nn l no np">return text_tweets[:5]</span></pre><p id="33a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们有自己的搜索词，即#MachineLearning，我们将过滤掉所有的转发，这样我们就不会返回重复的帖子。我主要想搜索免费的资源，要么是一本书，要么是一些课程。</p><p id="9381" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用嵌套的for循环来循环每个tweet上的每个过滤词，并只返回包含这些过滤词的tweet。我肯定有更有效的方法来检查推文中的这些过滤词，但这是我目前想到的解决方案。鲍勃肯定会再次升级！</p><p id="cd4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们最多返回五条推文，我们将使用这个列表来发送短信。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="d3cd" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">Bob 2.0的收尾工作！</h1><p id="f22e" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">我们已经有了升级Bob所需的一切，现在我们只需要把拼图的碎片补上。首先，我们需要稍微改变一下之前的算法，算出发送这些短信的时间。</p><p id="9036" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">新算法看起来像:</p><pre class="kp kq kr ks gt nh ng ni nj aw nk bi"><span id="8cba" class="nl mb it ng b gy nm nn l no np">TwitterAccount = TwitterAccount(consumer_key,consumer_secret,access_token,access_token_secret)</span><span id="505a" class="nl mb it ng b gy nq nn l no np">while True:</span><span id="f751" class="nl mb it ng b gy nq nn l no np">    t = check_time()</span><span id="379e" class="nl mb it ng b gy nq nn l no np">    if t == '08:00 AM' or t == '08:01 AM':</span><span id="11fd" class="nl mb it ng b gy nq nn l no np">        print(t,flush=True)</span><span id="f366" class="nl mb it ng b gy nq nn l no np">        TwitterAccount.post(get_quote(url))</span><span id="a8f8" class="nl mb it ng b gy nq nn l no np">        time.sleep(61)</span><span id="e18c" class="nl mb it ng b gy nq nn l no np">    elif t == '17:00 PM' or t =='17:01 PM':</span><span id="10d9" class="nl mb it ng b gy nq nn l no np">        text_tweets = TwitterAccount.filter_feed()</span><span id="12cc" class="nl mb it ng b gy nq nn l no np">        for tweets in text_tweets:</span><span id="497e" class="nl mb it ng b gy nq nn l no np">             client = boto3.client('sns',region_name='us-east-1')</span><span id="e70f" class="nl mb it ng b gy nq nn l no np">             client.publish(PhoneNumber='', Message=tweets)</span><span id="9532" class="nl mb it ng b gy nq nn l no np">        time.sleep(61)</span><span id="3361" class="nl mb it ng b gy nq nn l no np">    else:</span><span id="307b" class="nl mb it ng b gy nq nn l no np">        t = check_time()</span><span id="9a22" class="nl mb it ng b gy nq nn l no np">        print(t,flush=True)</span><span id="cda2" class="nl mb it ng b gy nq nn l no np">        print('It\'s not time yet',flush=True)</span><span id="e6d9" class="nl mb it ng b gy nq nn l no np">        time.sleep(50)</span></pre><p id="40a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们初始化一个Twitter帐户类，并创建一个无限循环，因为这个程序将永远运行。</p><p id="c3af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它会每隔50秒检查一次时间，如果是早上8点，它会在我的Twitter上发布一段引文。如果是下午5点，它会搜索Twitter，把免费资源发给我。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="efcb" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">后续步骤</h1><p id="0e5a" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">下个月，我将带着这个去真正地学习机器学习和数据科学的统计原理。</p><p id="23ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我的主要精力将放在改进我的Python上，我相信这反过来将有助于创建高效的代码来执行数据分析。我仍然会做我的机器学习项目，但现在速度会慢一些。</p><p id="b8e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请继续关注我们的下一个Python项目。</p></div></div>    
</body>
</html>