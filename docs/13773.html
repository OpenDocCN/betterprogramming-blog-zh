<html>
<head>
<title>Painless Objective-C and Swift Interoperability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">轻松的Objective-C和Swift互操作性</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/painless-objective-c-and-swift-interoperability-d60318ef0d2e?source=collection_archive---------9-----------------------#2022-09-26">https://betterprogramming.pub/painless-objective-c-and-swift-interoperability-d60318ef0d2e?source=collection_archive---------9-----------------------#2022-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0810" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解向Objective-C公开Swift代码的最佳实践</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/de79e981b415347fbdd26c1ebefc651c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dsHLLDvBWkscvzS9"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/es/@medbadrc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Med Badr Chemmaoui </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="8284" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目标C活得好好的。许多科技公司的iOS产品中仍然有很大一部分是Objective-C。老实说，这让我不再去这些地方采访，纯粹是因为固执。在我的iOS职业生涯中，90%的时间都在与Swift合作，我为什么要倒退呢？</p><p id="6040" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，在你的iOS之路中碰到Objective-C是不可避免的。在本帖中，我们将介绍一些如何尽可能简单地将Swift功能集成到Objective-C中的最佳实践。</p><h1 id="ef59" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是目标Swift互操作性</h1><p id="88f2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这意味着让Swift和Objective-C无缝地协同工作。本帖将重点关注向Objective-C公开Swift代码。</p><h1 id="e349" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么还有人用Objective-C？</h1><p id="0753" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">人们有理由解释为什么他们的应用程序仍然使用Objective-C:</p><ul class=""><li id="f2c6" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">没有足够的理由将应用程序迁移到Swift</li><li id="b86c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">这个应用依赖于一个C++库，你需要Objective-C来使用这个库</li><li id="52df" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">遗留项目需要继续下去，等等。</li></ul><p id="868f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本上，Objective-C将仍然存在，直到它被弃用。事实上，苹果至今仍在使用Objective-C。</p><h1 id="e998" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">成功实现目标C和Swift互操作性的最佳实践</h1><p id="876c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我用Objective-C语言创建了一个示例iOS应用程序。要通过控制台查看这些最佳实践，您可以在这里查看<a class="ae kv" href="https://github.com/fmustafa17/TestObjectiveC" rel="noopener ugc nofollow" target="_blank">我的GitHub repo】。</a></p><h2 id="8343" class="nd lt iq bd lu ne nf dn ly ng nh dp mc lf ni nj me lj nk nl mg ln nm nn mi no bi translated">导入Swift桥接文件</h2><p id="b95c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果您尝试在您的实现文件中使用Swift函数而不导入，那么Xcode将生成一个构建错误，如下所示:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="1432" class="nd lt iq nq b gy nu nv l nw nx">❌ Receiver ‘ViewModel’ for instance message is a forward declaration</span></pre><p id="251c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个错误消息一点帮助都没有。因此，如果我们需要在Objective-C类中调用Swift函数，导入Swift桥接文件是绝对必要的。没有这个，Obj-C不会承认你的Swift函数的存在。您可以从您的实现文件内部的类或结构中使用Swift函数。导入Swift桥接文件的格式如下:</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="3d6b" class="nd lt iq nq b gy nu nv l nw nx">#import &lt;YourProjectTarget-Swift.h&gt;</span></pre><p id="174a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">幸运的是，XCode使用Objective-C生成自动完成。当您开始键入导入时，Swift桥接文件应该会显示为一个选项。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/4771d384b4ab33806366c836224fc0c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eqjEm6zi4ZfBXGokZ-elYg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">自动完成为我的目标生成Swift桥接文件</p></figure><p id="8882" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请确保使用右尖括号关闭此导入。</p><p id="34ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要使用用Swift编写的第三方库，您可以遵循相同的模式在您的实现中导入Swift代码(假设他们已经将Objective-C支持添加到他们的公共类中)。</p><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="1168" class="nd lt iq nq b gy nu nv l nw nx">#import &lt;ThirdPartyTarget/ThirdPartyTarget-Swift.h&gt;</span></pre><h2 id="0a9e" class="nd lt iq bd lu ne nf dn ly ng nh dp mc lf ni nj me lj nk nl mg ln nm nn mi no bi translated">为您的函数添加Objective-C支持</h2><p id="718f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果您想向Objective-C公开一个或多个特定的函数，请在这些函数前面加上属性<code class="fe nz oa ob nq b">@objc</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="ba1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Swift类应该继承自<code class="fe nz oa ob nq b">NSObject</code>。不幸的是，如果不遵守这个协议，您将会看到我们前面讨论过的同样无用的错误消息。</p><p id="b15f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是我们如何在实现文件中使用这个函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="6b86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果<code class="fe nz oa ob nq b">ViewModel</code>类有没有<code class="fe nz oa ob nq b">@objc</code>属性的附加函数，我将不能在<code class="fe nz oa ob nq b">ViewController.m</code>内部使用它们。</p><h2 id="4f4f" class="nd lt iq bd lu ne nf dn ly ng nh dp mc lf ni nj me lj nk nl mg ln nm nn mi no bi translated">向您的类添加Objective-C支持</h2><p id="a339" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果您需要使用的函数数量很少，那么<code class="fe nz oa ob nq b">@objc</code>属性非常适合。但是随着需求的变化和业务逻辑的增长，不断重复这个属性可能会很麻烦。为了向Objective-C公开一个类中的所有函数，在声明你的类之前加上前缀<code class="fe nz oa ob nq b">@objcMembers</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="d88c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你的类也应该继承自<code class="fe nz oa ob nq b">NSObject</code>。</p><h2 id="9080" class="nd lt iq bd lu ne nf dn ly ng nh dp mc lf ni nj me lj nk nl mg ln nm nn mi no bi translated">用Swift扩展Objective-C文件</h2><p id="3372" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">将Swift添加到您的项目中的一个好方法是扩展现有的Objective-C类。这样做的缺点是不能在扩展文件中添加全局属性。所以这个做法就看你自己的判断了。如果您的用例很简单，请使用扩展。</p><p id="9fbf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了成功地扩展您的实现文件，在您的<code class="fe nz oa ob nq b">Bridging-Header</code>文件中导入类头文件。</p><p id="1c10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要实现这一点，在Swift中创建一个新文件，并适当命名。然后开始实现扩展。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="9ac9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您还没有一个桥接头，如果它不能自动生成，请创建一个。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/893e75569f73e7576d85383e44427130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MGuQpUDnxH5IF9UeoklPzQ.png"/></div></div></figure><p id="b92c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，导入类头文件。如果没有这一步，您的扩展文件将无法被识别。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="92ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构建并运行您的应用程序，您已经成功地在Swift中扩展了您的实施文件！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/100720d39795ef0cfac87904ed0d4e96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LgD4kJPdaT3WhrsULbSBQ.png"/></div></div></figure><p id="2872" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！更多iOS开发内容，一定要关注我的Medium。</p><h1 id="c408" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><ul class=""><li id="9101" class="mp mq iq ky b kz mk lc ml lf og lj oh ln oi lr mu mv mw mx bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/swift/importing-swift-into-objective-c" rel="noopener ugc nofollow" target="_blank">苹果文档:将Swift导入Objective-C </a></li><li id="808e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><a class="ae kv" href="https://www.hackingwithswift.com/store/objective-c-for-swift-developers" rel="noopener ugc nofollow" target="_blank">利用Swift进行黑客攻击:针对Swift开发人员的Objective-C</a></li></ul></div></div>    
</body>
</html>