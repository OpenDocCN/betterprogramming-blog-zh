<html>
<head>
<title>Django Annotations and Aggregations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django注释和聚合</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/django-annotations-and-aggregations-48685994d149?source=collection_archive---------5-----------------------#2019-08-12">https://betterprogramming.pub/django-annotations-and-aggregations-48685994d149?source=collection_archive---------5-----------------------#2019-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0b47" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们修改我们的注释和聚合知识</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7380917bdebc763ad3e4da61eb33537b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s3Dg4qWoLce7kLqI"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@adeolueletu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Adeolu Eletu </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="b395" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">议程</h1><p id="beaa" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Django执行SQL <code class="fe mk ml mm mn b">group by</code>的机制是通过<code class="fe mk ml mm mn b">annotate</code>和<code class="fe mk ml mm mn b">aggregate</code>。</p><p id="53d5" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在这篇文章中，让我们复习我们的注释和汇总知识。</p><p id="6455" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">这篇文章是初学者友好的，即使你以前没有使用过Django注释，你也应该能够理解。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="bb01" class="kw kx iq bd ky kz na lb lc ld nb lf lg jw nc jx li jz nd ka lk kc ne kd lm ln bi translated">模型</h1><p id="db8d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们考虑本教程的以下模型:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">模型</p></figure><p id="d7e4" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">我们计划在这一块计算以下内容:</p><ul class=""><li id="4862" class="nh ni iq lq b lr mo lu mp lx nj mb nk mf nl mj nm nn no np bi translated">问题数量</li><li id="5fc7" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">多个选项</li><li id="6c19" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">每个问题的选择数量</li><li id="3f80" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">根据question_text过滤后每个问题的选择数量</li><li id="e054" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">每个问题的投票数</li><li id="3c4e" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">最高票数的问题</li><li id="2270" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">最低票数的问题</li><li id="99e6" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">没有选择的问题</li><li id="c0b9" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">投票总数</li><li id="aec3" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">每个选项的平均投票数</li><li id="3621" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">每个问题的平均投票数</li><li id="4a5c" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">每个<code class="fe mk ml mm mn b">question_text</code>的问题数量</li><li id="194f" class="nh ni iq lq b lr nq lu nr lx ns mb nt mf nu mj nm nn no np bi translated">每个<code class="fe mk ml mm mn b">question_text</code>的选择数量</li></ul></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="4d2f" class="kw kx iq bd ky kz na lb lc ld nb lf lg jw nc jx li jz nd ka lk kc ne kd lm ln bi translated">聚合和注释</h1><p id="857e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们可以通过运行以下命令来查找问题的数量:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">问题数量</p></figure><p id="65f1" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">要计算选项的数量:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">多个选项</p></figure><p id="23df" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">要计算每个问题的选项数量:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每个问题的选择数量</p></figure><p id="0a87" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">现在每个问题都有一个属性叫做<code class="fe mk ml mm mn b">choice_count</code>。</p><p id="7d3c" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">现在让我们在<code class="fe mk ml mm mn b">question_text</code>上过滤后应用分组:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">过滤问题后每个问题的选择数量</p></figure><p id="af23" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">要计算每个问题的投票数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每个问题的投票数</p></figure><p id="45da" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">这将对每个问题的所有选项进行分组，然后对每组的投票进行求和。</p><p id="2f36" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">让我们找出最高票数的问题:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">得票最多的问题</p></figure><p id="b131" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在<code class="fe mk ml mm mn b">num_votes__isnull=False</code>上过滤很重要。我们过滤掉没有任何选择的问题，因为它们也出现在<code class="fe mk ml mm mn b">Question.objects.annotate(num_votes=Sum('choice__votes'))</code>的结果中。</p><p id="1086" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">让我们找出票数最少的问题:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最低票数的问题</p></figure><p id="eac0" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">要找到没有任何选择的问题:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">没有选择的问题</p></figure><p id="9252" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">要计算投票总数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">投票总数</p></figure><p id="879d" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">要计算每个选项的平均投票数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每个选项的平均投票数</p></figure><p id="585a" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">要获得每个问题的平均投票数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每个问题的平均投票数</p></figure><p id="e7eb" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">我们可以用同一个<code class="fe mk ml mm mn b">question_text</code>提出多个问题。让我们按<code class="fe mk ml mm mn b">question_text</code>对问题进行分组，并找出每个<code class="fe mk ml mm mn b">question_text</code>的问题数量:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">每个问题的问题数量_text</p></figure></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="9b1d" class="kw kx iq bd ky kz na lb lc ld nb lf lg jw nc jx li jz nd ka lk kc ne kd lm ln bi translated">签署</h1><p id="1b0f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">感谢阅读！请继续关注更多Django的帖子。</p><p id="132a" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在<a class="ae kv" href="https://twitter.com/_akshar" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上与我联系，我<a class="ae kv" href="https://twitter.com/_akshar" rel="noopener ugc nofollow" target="_blank">在Twitter上发布</a>关于信息丰富且有价值的编程文章和建议。</p></div></div>    
</body>
</html>