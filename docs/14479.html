<html>
<head>
<title>How to Bridge Blockchain Networks Using Truffle L2 Boxes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用松露L2盒子桥接区块链网络</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-truffle-l2-boxes-to-bridge-blockchain-networks-23fbbfe4c7b8?source=collection_archive---------8-----------------------#2022-12-21">https://betterprogramming.pub/using-truffle-l2-boxes-to-bridge-blockchain-networks-23fbbfe4c7b8?source=collection_archive---------8-----------------------#2022-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9c77" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建L1和L2之间互操作的dapps可能很困难。让我们看看使用乐观桥松露盒作为一种简单的方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3f2f6a9d1fb7fe341b185a340b3f7d3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jFf035Q9SMeDUMkA1FOW6A.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">pixabay.com</p></figure><p id="0f65" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">众所周知，许多区块链都有可扩展性和拥塞问题。这些问题具有广泛的影响，从缓慢的交易时间到增加的交易费用和降低的用户体验。</p><p id="311d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一个解决方案是使用<a class="ae lr" href="https://ethereum.org/en/layer-2/" rel="noopener ugc nofollow" target="_blank"> L2 </a>(第二层)链使web3成为多链。以太坊L2，如<a class="ae lr" href="https://www.optimism.io/" rel="noopener ugc nofollow" target="_blank">乐观</a>、<a class="ae lr" href="https://portal.arbitrum.one/" rel="noopener ugc nofollow" target="_blank">仲裁</a>和<a class="ae lr" href="https://polygon.technology/" rel="noopener ugc nofollow" target="_blank">多边形</a>，建立在以太坊网络之上，但比以太坊更快更便宜。然而，作为一种权衡，它们通常不如以太坊安全。这就是为什么L2处理日常的用户活动，同时仍然依赖以太坊L1作为安全和分散的结算和数据可用性层的幕后基础。</p><p id="5eee" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个很好的解决方案——然而，仅以太坊上就有许多L2，每一个都是独立的网络，有其自身的细微差别和体验。对于用户和开发者来说，构建和使用在这些网络和以太坊L1之间互操作和移动的dapps可能是乏味的、困难的和糟糕的体验。</p><p id="eb5b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要web3成为一个多链体验，消费者不需要知道他们使用的是哪一个链(坦率地说，也不在乎)，开发者可以依赖最能支持他们的dapps需求的任何网络。通过转移到区块链的多链互联网，web3对每个参与者来说都是更好的体验。</p><p id="926b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不幸的是，允许dapps在链之间移动是一个困难的技术挑战。在本文中，我们将关注一个解决方案——使用Infura RPC端点和Truffle Boxes无缝地构建和桥接这些网络。具体来说，我们将使用<a class="ae lr" href="https://trufflesuite.com/boxes/optimism-bridge/" rel="noopener ugc nofollow" target="_blank">乐观桥松露盒</a>在以太坊Goerli测试网和乐观桥Goerli上创建一个项目。</p><h1 id="7716" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">使用Infura和块菌盒运行多链Dapp</strong></h1><h2 id="a9ba" class="mk lt iq bd lu ml mm dn ly mn mo dp mc le mp mq me li mr ms mg lm mt mu mi mv bi translated"><strong class="ak">松露盒</strong></h2><p id="9048" class="pw-post-body-paragraph kv kw iq kx b ky mw jr la lb mx ju ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">作为我们的示例解决方案的核心，我们将依赖于来自ConsenSys的<a class="ae lr" href="https://trufflesuite.com/boxes/" rel="noopener ugc nofollow" target="_blank">Truffle box</a>——“快捷”样板(如合同、库、模块，甚至全功能的dapp)，您可以使用它们来构建您的dapp。对于多链解决方案，他们构建在许多L2网络的<a class="ae lr" href="https://www.infura.io/networks" rel="noopener ugc nofollow" target="_blank"> Infura RPC节点</a>之上。</p><p id="cad1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如上所述，我们将依靠<a class="ae lr" href="https://trufflesuite.com/boxes/optimism-bridge/" rel="noopener ugc nofollow" target="_blank">乐观桥松露盒</a>。这个盒子有与来自L1和L2的乐观桥交互所需的所有合同，以及一组用于部署、调用函数和在层间传递消息/值的迁移。它甚至有一个助手脚本，可以做我们需要的一切来看这一切。我们需要拆箱来得到我们需要的一切！包装盒包括以下内容:</p><ul class=""><li id="dda2" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated">一份在乐观桥上传递信息的L1合同</li><li id="d4bd" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">从以太坊向乐观主义传递信息的迁移</li><li id="bdbb" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">一份在乐观桥上传递信息的L2合同</li><li id="cd76" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">从乐观主义向以太坊传递信息的迁移</li><li id="24d1" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">自动编译合同、运行迁移和发送消息的脚本</li><li id="77cc" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">一个自动发送ETH和DAO通过桥的脚本</li></ul><p id="b90a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意:网桥是一种工具，它允许独立的区块链互相通信并发送令牌、NFT等。</p><h2 id="3e55" class="mk lt iq bd lu ml mm dn ly mn mo dp mc le mp mq me li mr ms mg lm mt mu mi mv bi translated"><strong class="ak">先决条件</strong></h2><p id="46be" class="pw-post-body-paragraph kv kw iq kx b ky mw jr la lb mx ju ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">在开始之前，我们需要以下先决条件:</p><ul class=""><li id="7f3b" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated"><a class="ae lr" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>及其包管理器NPM。</li><li id="4338" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">使用以下终端命令验证我们是否安装了Node.js:</li></ul><p id="dbc0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe np nq nr ns b">node -v &amp;&amp; npm -v</code></p><ul class=""><li id="c812" class="nb nc iq kx b ky kz lb lc le nd li ne lm nf lq ng nh ni nj bi translated"><a class="ae lr" href="https://docs.infura.io/infura/getting-started" rel="noopener ugc nofollow" target="_blank">一个虚假账户</a></li><li id="a968" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">一个<a class="ae lr" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank">元掩码</a>账户</li><li id="a443" class="nb nc iq kx b ky nk lb nl le nm li nn lm no lq ng nh ni nj bi translated">对JavaScript和Solidity有基本的了解</li></ul><h1 id="e800" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第一步。创建一个Infura帐户来访问网络</h1><p id="61bf" class="pw-post-body-paragraph kv kw iq kx b ky mw jr la lb mx ju ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">一旦具备先决条件，访问Infura网站<a class="ae lr" href="https://infura.io/login" rel="noopener ugc nofollow" target="_blank">登录</a>(或<a class="ae lr" href="https://infura.io/register" rel="noopener ugc nofollow" target="_blank">注册</a>新账号)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/9dd4bff9f9d947df32125d219b659c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8_-JJjjfjbFeNO58bcXKQ.png"/></div></div></figure><p id="033c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">成功注册后，页面重定向到Infura仪表板，在这里我们可以创建一个新的API密钥，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/794fcfb762e7803f0e350cb502c5086b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LLcbQhrkES9pJYyRK_Ku3Q.png"/></div></div></figure><p id="b95f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击“创建新密钥”按钮，并填写所需信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/12e34855a1aab30862941f894991983f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bRB4LOfaSKXgwPIIVTYozg.png"/></div></div></figure><p id="1768" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在创建您的API密钥之后，您的项目ID将在您的仪表板上的API密钥部分下可见，如下所示。复制并保存在某个地方；在本教程的后面，您将需要它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/b01488014954fecd368436990c11a918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYe1IEnlIjF-qLwITz6uGQ.png"/></div></div></figure><h1 id="7c79" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">第二步。设置和安装</strong></h1><p id="27bb" class="pw-post-body-paragraph kv kw iq kx b ky mw jr la lb mx ju ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">接下来，我们将设置一个松露乐观桥盒。我们可以使用下面的命令在您选择的任何目录中运行unbox命令。</p><pre class="kg kh ki kj gt nu ns nv bn nw nx bi"><span id="4840" class="ny lt iq ns b be nz oa l ob oc">npx truffle unbox optimism-bridge &lt;DIRECTORY_NAME&gt;</span></pre><p id="7ccc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用您选择的目录名替换<directory_name>。或者，您可以全局安装Truffle并运行unbox命令。</directory_name></p><pre class="kg kh ki kj gt nu ns nv bn nw nx bi"><span id="7a8a" class="ny lt iq ns b be nz oa l ob oc">npm install -g truffle<br/>truffle unbox optimism-bridge &lt;DIRECTORY_NAME&gt;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/20cc7b220d9073858d637447ac2ce61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o11lnfQoznOIkikIINrWsQ.png"/></div></div></figure><p id="852f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该命令应该下载并运行npm install，作为拆箱过程的一部分。</p><p id="f54a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，运行以下命令将目录更改为我们刚刚创建的新目录。</p><pre class="kg kh ki kj gt nu ns nv bn nw nx bi"><span id="1b58" class="ny lt iq ns b be nz oa l ob oc">cd truffle-bridge-demo</span></pre><p id="95da" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="od">注意:truffle-bridge-demo是我们创建的目录的名称。</em></p><p id="80af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们应该看到类似于下面的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/2cb4668188c0f6753a51068ea9711f3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*2dQqAnl7p9y541Qrhjye-A.png"/></div></figure><p id="3187" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">的。npm软件包已经安装，但是我们需要添加一些信息到。拆箱后创建的env文件。<code class="fe np nq nr ns b">truffle-config.ovm.js</code>文件期望一个<code class="fe np nq nr ns b">GOERLI_MNEMONIC</code>值存在于。用于在以太坊Goerli和乐观Goerli测试网上运行命令的env文件，以及一个用于连接网络的<code class="fe np nq nr ns b">INFURA_KEY</code>。</p><pre class="kg kh ki kj gt nu ns nv bn nw nx bi"><span id="2d7a" class="ny lt iq ns b be nz oa l ob oc">GOERLI_MNEMONIC="&lt;your-wallet-mnemonic&gt;"<br/>INFURA_KEY="&lt;your-infura-key&gt;"</span></pre><p id="16d4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用我们之前从Infura仪表板上获得的信息替换<your-infura-key>。(<strong class="kx ir">注意</strong>:千万不要和任何人分享你的私钥(助记符)，要保管好。并将&lt;你的钱包助记符&gt;替换为你的助记符，如下所示:</your-infura-key></p><p id="4ef3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要从元掩码中检索助记符，请单击元掩码上的以下图标:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/c59b28183d75559c2eff5bcc70d8a3e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NayJHpEx_C17kincdmjIZw.png"/></div></div></figure><p id="80ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，单击导出私钥按钮复制助记符。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/89802b07c3ae694fd008d3991e2fc60a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c9Mrof_I4eodAE8P3FDrEQ.png"/></div></div></figure><p id="a451" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Git忽略了。env文件来帮助保护您的私有数据。避免向GitHub公开您的私钥是一个很好的安全实践。</p><h1 id="9240" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第三步。使用松露L2盒桥接</h1><p id="5033" class="pw-post-body-paragraph kv kw iq kx b ky mw jr la lb mx ju ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">当我们取消项目装箱时，我们项目的所有必要契约和脚本都为我们创建好了。在下一步中，让我们浏览一下各个合同和迁移，以了解网络之间的桥接和交互是如何发生的。</p><p id="52cd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">合同<code class="fe np nq nr ns b">contract/ethereum/GreeterL1.sol</code>告诉你如何通过乐观桥从L1向L2传递信息。</p><pre class="kg kh ki kj gt nu ns nv bn nw nx bi"><span id="eb67" class="ny lt iq ns b be nz oa l ob oc">//SPDX-License-Identifier: Unlicense<br/>// This contract runs on L1, and controls a Greeter on L2.<br/>pragma solidity ^0.8.0;<br/><br/>import { ICrossDomainMessenger } from<br/>    "@eth-optimism/contracts/libraries/bridge/ICrossDomainMessenger.sol";<br/><br/>contract GreeterL1 {<br/>    address crossDomainMessengerAddr = 0x5086d1eEF304eb5284A0f6720f79403b4e9bE294;<br/><br/><br/>    address greeterL2Addr = 0xC0836cCc8FBa87637e782Dde6e6572aD624fb984;<br/><br/><br/>    function setGreeting(string calldata _greeting) public {<br/>        bytes memory message;<br/><br/><br/>        message = abi.encodeWithSignature("setGreeting(string)",<br/>            _greeting);<br/><br/><br/>        ICrossDomainMessenger(crossDomainMessengerAddr).sendMessage(<br/>            greeterL2Addr,<br/>            message,<br/>            1000000   // within the free gas limit amount<br/>        );<br/>    }      // function setGreeting<br/><br/><br/>}          // contract GreeterL1</span></pre><p id="4afb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">迁移<code class="fe np nq nr ns b">migrations/3_set_L2_greeting.js</code>使用上述契约从以太坊向乐观派发送消息。</p><pre class="kg kh ki kj gt nu ns nv bn nw nx bi"><span id="4577" class="ny lt iq ns b be nz oa l ob oc">var Greeter = artifacts.require("GreeterL1");<br/><br/><br/>/**<br/> * Set L2 Greeting<br/> * Run this migration on L1 to update the L1 greeting.<br/> */<br/>module.exports = async function (deployer) {<br/>  console.log("Updating the L2 Greetings contract from L1! 👋👋");<br/><br/><br/>  const instance = await Greeter.deployed();<br/>  const tx = await instance.setGreeting("👋 Greetings from Truffle!");<br/><br/><br/>  console.log(`🙌 Greeter txn confirmed on L1! ${tx.receipt.transactionHash}`);<br/>  console.log(`🛣️  Bridging message to L2 Greeter contract...`);<br/>  console.log(<br/>    `🕐 In about 1 minute, check the Greeter contract "read" function: https://goerli-optimism.etherscan.io/address/0xC0836cCc8FBa87637e782Dde6e6572aD624fb984#readContract`<br/>  );<br/>};</span></pre><p id="e151" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，<code class="fe np nq nr ns b">contracts/optimism/GreeterL2.sol</code>合约通过乐观桥向另一个方向(L2- &gt; L1)传递了一个信息。</p><pre class="kg kh ki kj gt nu ns nv bn nw nx bi"><span id="134c" class="ny lt iq ns b be nz oa l ob oc">//SPDX-License-Identifier: Unlicense<br/>// This contract runs on L2, and controls a Greeter on L1.<br/>pragma solidity ^0.8.0;<br/><br/><br/>import { ICrossDomainMessenger } from<br/>    "@eth-optimism/contracts/libraries/bridge/ICrossDomainMessenger.sol";<br/><br/><br/>contract GreeterL2 {<br/>    address crossDomainMessengerAddr = 0x4200000000000000000000000000000000000007;<br/><br/>    address greeterL1Addr = 0x7fA4D972bB15B71358da2D937E4A830A9084cf2e;<br/><br/><br/>    function setGreeting(string calldata _greeting) public {<br/>        bytes memory message;<br/><br/><br/><br/>        message = abi.encodeWithSignature("setGreeting(string)",<br/>            _greeting);<br/><br/><br/>        ICrossDomainMessenger(crossDomainMessengerAddr).sendMessage(<br/>            greeterL1Addr,<br/>            message,<br/>            1000000   // irrelevant here<br/>        );<br/>    }      // function setGreeting<br/><br/><br/>}          // contract GreeterL2</span></pre><p id="f815" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">迁移<code class="fe np nq nr ns b">migrations/4_set_L1_greeting.js</code>使用上述契约从乐观主义向以太坊发送消息。</p><pre class="kg kh ki kj gt nu ns nv bn nw nx bi"><span id="97cd" class="ny lt iq ns b be nz oa l ob oc">require("dotenv").config();<br/>const sdk = require("@eth-optimism/sdk");<br/>const ethers = require("ethers");<br/>const Greeter = artifacts.require("GreeterL2");<br/>const goerliMnemonic = process.env["GOERLI_MNEMONIC"];<br/>const infuraKey = process.env["INFURA_KEY"];<br/><br/>const sleep = (milliseconds) =&gt; {<br/>  return new Promise((resolve) =&gt; setTimeout(resolve, milliseconds));<br/>};<br/><br/><br/>/**<br/> * Set L1 Greeting<br/> * Run this migration on L1 to update the L1 greeting.<br/> */<br/>module.exports = async function (deployer) {<br/>  const newGreeting = "👋 Greetings from Truffle!"; //&lt;---- CHANGE THIS VALUE TO YOUR NAME!!!<br/>  const instance = await Greeter.deployed();<br/><br/><br/>  console.log("Updating the L1 Greetings contract from L2! 👋");<br/><br/>  const tx = await instance.setGreeting(newGreeting);<br/>  const txHash = tx.receipt.transactionHash;<br/><br/><br/><br/>  console.log(`🙌🙌 Greeter txn confirmed on L2! ${txHash}`);<br/>  console.log(<br/>    `🛣️  Bridging message to L1 Greeter contract.\n 🕐 This will take at least 1-5 min...`<br/>  );<br/><br/><br/>  // Set providers for Optimism sdk<br/>  const l1Provider = new ethers.providers.JsonRpcProvider(<br/>    "https://goerli.infura.io/v3/" + infuraKey<br/>  );<br/>  const l2Provider = new ethers.providers.JsonRpcProvider(<br/>    "https://optimism-goerli.infura.io/v3/" + infuraKey<br/>  );<br/><br/><br/>  // Connect an L1 signer<br/>  const wallet = ethers.Wallet.fromMnemonic(goerliMnemonic);<br/>  const l1Signer = wallet.connect(l1Provider);<br/><br/><br/>  // Initialize sdk messenger<br/>  const crossChainMessenger = new sdk.CrossChainMessenger({<br/>    l1ChainId: 5,<br/>    l2ChainId: 420,<br/>    l1SignerOrProvider: l1Signer,<br/>    l2SignerOrProvider: l2Provider,<br/>  });<br/><br/>  let statusReady = false;<br/><br/>  // Sleep for 1 min during L2 -&gt; L1 bridging<br/>  await sleep(60000); // 60 seconds<br/><br/>  // Poll the L1 msg status<br/>  while (!statusReady) {<br/>    let status = null;<br/>    status = await crossChainMessenger.getMessageStatus(txHash);<br/>    statusReady = status == sdk.MessageStatus.READY_FOR_RELAY;<br/>    if (!statusReady) {<br/>      console.log(<br/>        "Message not yet received on L1.\n 🕐 Retrying in 10 seconds..."<br/>      );<br/>      await sleep(10000); // 10 seconds<br/>    }<br/>  }<br/><br/><br/><br/>  console.log("📬 Message received! Finalizing...");<br/><br/>  // Open the message on L1<br/>  finalize = await crossChainMessenger.finalizeMessage(txHash);<br/>  console.log(<br/>    `🎉 Message finalized. Check the L1 Greeter contract "read" function: https://goerli.etherscan.io/address/0x7fA4D972bB15B71358da2D937E4A830A9084cf2e#readContract`<br/>  );<br/>};</span></pre><p id="3ad4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在脚本目录中，我们还有<code class="fe np nq nr ns b">goerli_bridge_message.mjs</code>和<code class="fe np nq nr ns b">goerli_bridge_value.js</code>来自动化编译合同、运行迁移和发送消息的过程。</p><h1 id="4fc0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第四步。完成以太坊歌尔利和乐观歌尔利之间契约的编译、迁移和桥接</h1><p id="36c6" class="pw-post-body-paragraph kv kw iq kx b ky mw jr la lb mx ju ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">接下来，我们将把我们的合同部署到Goerli。助手<a class="ae lr" href="https://trufflesuite.com/scripts/deploy.mjs" rel="noopener ugc nofollow" target="_blank">脚本</a>促进以太坊Goerli和乐观主义Goerli之间消息的编译、迁移和桥接。在这些网络上，我们需要testnet ETH来使用它。要接收一些，使用<a class="ae lr" href="https://community.optimism.io/docs/useful-tools/faucets/" rel="noopener ugc nofollow" target="_blank">水龙头</a>。我们还需要<a class="ae lr" href="https://blog.infura.io/post/infura-launches-support-for-optimistic-ethereum" rel="noopener ugc nofollow" target="_blank">将乐观附加软件</a>添加到您的Infura账户。</p><p id="4219" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将运行以下命令来启动项目:</p><pre class="kg kh ki kj gt nu ns nv bn nw nx bi"><span id="25f9" class="ny lt iq ns b be nz oa l ob oc">npm run deploy</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/8c491b0b0585a378cbb1781128a82c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4msqZb2uBVhgddTBCOtaHA.png"/></div></div></figure><p id="2acc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是一个URL，用于在完成迁移后确认(通过以太扫描)桥接的消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/23ff7067731ce559a7e1159e34de1222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*khxukkGqc09re-vIWIqffw.png"/></div></div></figure><p id="a0ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第四次迁移完成后，将提供通过以太网扫描确认桥接消息的链接。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/307256378808d4d4a7cf5ae96beb77c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z65cytMTjebiM9KugroZpA.png"/></div></div></figure><h1 id="49a1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第五步。使用<a class="ae lr" href="https://goerli-optimism.etherscan.io/" rel="noopener ugc nofollow" target="_blank">块浏览</a>验证项目是否成功进入Goerli测试网</h1><p id="dea9" class="pw-post-body-paragraph kv kw iq kx b ky mw jr la lb mx ju ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">我们已经成功地设置、安装、构建、部署并完成了之前拆箱的项目。接下来，我们将在Goerli以太坊测试网上验证该项目。</p><p id="e687" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">前往<a class="ae lr" href="https://goerli-optimism.etherscan.io/" rel="noopener ugc nofollow" target="_blank">goer Li ethers can</a>block explorer并粘贴部署时显示在我们CLI上的事务地址<code class="fe np nq nr ns b">0xbcc1746a9ebbfcfb71665225c1a353a8c8dc9a1aa528a3babcb5b046d615a353</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/2508cb6191e2baf3a6071c445cca59a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sDPv6S-2AYW8IJgmRulRyQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/65c094d3c35583a3198ea6f9f1d29b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VHZ05G9xBZorLDFRCtA-Xw.png"/></div></div></figure><div class="oh oi gp gr oj ok"><a href="https://goerli-optimism.etherscan.io/tx/0xbcc1746a9ebbfcfb71665225c1a353a8c8dc9a1aa528a3babcb5b046d615a353" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">乐观Goerli事务哈希(Txhash)详细信息|乐观</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">乐观for txhash的详细交易信息…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">goer Li-乐观主义</p></div></div></div></a></div><h1 id="d154" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="3035" class="pw-post-body-paragraph kv kw iq kx b ky mw jr la lb mx ju ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">如果我们想改善用户和开发者的体验，多链web3世界是至关重要的。为了实现这一点，我们需要dapps能够在链之间快速无缝地通信。希望我们使用乐观桥松露盒的例子向您展示了一种相对容易和快速的开始方式。要了解更多信息，请查看官方文档。</p><p id="a79d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">祝你今天过得愉快！</p></div></div>    
</body>
</html>