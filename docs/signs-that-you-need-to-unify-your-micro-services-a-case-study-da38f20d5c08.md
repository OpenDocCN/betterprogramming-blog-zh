# 您需要统一微服务的迹象

> 原文：<https://betterprogramming.pub/signs-that-you-need-to-unify-your-micro-services-a-case-study-da38f20d5c08>

## 案例研究

![](img/1f41686457191523e39ca03358639fa4.png)

Wylly Suhendra 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片。

本文讨论了我在 Here Mobility 工作时遇到的一个具体案例研究。它描述了为什么我们最初分离我们的两个服务，以及为什么我们决定将它们统一起来。我相信它演示了当你应该考虑统一两个微服务时，我希望它能帮助其他人为未来的产品做出好的设计。

这是系列文章的第一篇。在下一篇文章中，我将分享我们在继续为客户服务的同时如何统一服务的计划。

# 背景

我们开发的产品叫做移动派遣。移动调度帮助出租车公司轻松管理司机、乘车和乘客。它通过直观的管理面板实现骑手和驾驶员的匹配，包括车队和骑行状态的实时可见性和跟踪。该产品包括一个 web 应用程序和一个移动应用程序。出于本文的目的，我将重点介绍游乐设备创建的具体特性。用户可以创建两种类型的乘坐:即时乘坐(发送给司机立即开始)和预订乘坐(未来到期-从现在起我们将它们称为*预订* )。

我们决定创建单独的服务来管理乘车和预订——分别是乘车服务和日历服务。我们做出这一决定是因为以下产品特性和基础架构环境:

1.  实时地图上的活动乘坐显示了所有车辆的当前位置，帮助值班经理随时了解他们车队的位置。这意味着会有大量来自客户端的调用——移动应用程序报告当前位置，而 web 应用程序轮询更新的位置。因此，有一个专门的服务来处理负载是有意义的。
2.  预订被放在一个只有预订的桌子上，这样值班经理就可以在一个地方看到所有未来的游乐设施。这强化了预订和乘坐实际上是不同的逻辑实体的感觉。
3.  与现有预订相冲突的新创建的预订向 web 用户发送了通知。因此，我们需要一个针对预订的约束管理器。游乐设施不需要这样的东西。这是对乘坐和预订是不同的逻辑实体这一概念的又一次强化。
4.  预订概念是在我们已经支持即时乘车服务并已经有了现场乘车服务之后引入的。乘车服务是一种过时的服务，使用定制的状态机进行即时乘车。我们认为拥有一个干净的服务来支持新的功能将需要更少的开发时间。

# 问题是

分离服务架构为我们服务了大约一年。在那一年中，我们遇到了几个困难，这让我们对设计产生了疑问:

1.  对 API 的更改需要更改两个服务的代码库。如果我们添加一个像`getAllRidesByAWhiteVehicle,` 这样的调用，我们需要在两个服务中实现它，这使得添加新代码变得麻烦和耗时。这实际上表明，乘车和预订并不像我们最初认为的那样是异化的实体。
2.  两个服务之间的来回网络调用。尽管在开始时，乘车服务和日历服务之间似乎有明确的分离，但我们遇到了许多服务需要通信的情况。最简单的例子是游乐设备的审计历史。
3.  服务有相似的代码库。乘坐和预订的数据模型是相似的——两者都有相似的乘坐限制，如乘客数量、轮椅选择等。此外，这两种服务都使用状态机和调度程序，它们可以类似地实现。
4.  最后一根稻草:新的商业逻辑。我们的产品提交了编辑活动游乐设备的要求，因此它成为了预订，反之亦然。这打破了乘车和预订是分离的实体的假设，让它们在单独的服务中管理并保存在不同的数据库中不再有意义。

上面的前三个问题让我们渴望有机会统一这两个服务。添加新的业务逻辑是我们改进设计所需要的机会，因为我们可以利用基础设施变更中添加的新功能。

我认为这个研究案例指出了微服务架构中一些微妙的细微差别。当添加新的功能时，我们应该质疑我们的架构是否仍然证明自己是正确的。在这种情况下，开始时，似乎乘车和预订有权作为独立的实体存在，因此有独立的服务和数据库。随着更多需求和特性的出现，服务的分离显然会导致繁琐。