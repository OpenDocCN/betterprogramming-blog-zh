<html>
<head>
<title>Getting Started with the AWS Websockets API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Websockets API入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-aws-websockets-api-4a585eb1e12d?source=collection_archive---------4-----------------------#2019-05-23">https://betterprogramming.pub/getting-started-aws-websockets-api-4a585eb1e12d?source=collection_archive---------4-----------------------#2019-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="90d5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">介绍AWS Lambda支持的实时AWS WebSocket API的强大功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ba67d8cf17efeefc86bd18607bcefb46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckUQpy4qgOO60sVIW9pyoA.png"/></div></div></figure><h1 id="0733" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">简要概述</h1><p id="5b8c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">2018年12月18日，亚马逊Web服务正式发布API Gateway对WebSocket APIs的支持。这是巨大的，因为我们现在终于可以利用AWS Lambda的无服务器架构进行WebSocket连接了！这项新服务有三大部分:路由、消息连接客户端和授权者。我试图提供我在自己的项目中使用的许多工作示例，以便让您了解如何利用这项服务。让我们跳进来吧！</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="a149" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">路线</h1><p id="5281" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">路线是您可以将AWS Lambda函数附加到API的地方。默认情况下，AWS提供了三种您可能想要实现的路由— $connect、$disconnect和$default。您还可以实现遵循给定路线选择表达式的自定义路线。这个表达式只是告诉AWS在哪里寻找路由名。例如，它可能类似于:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="c0d9" class="mz kv it mv b gy na nb l nc nd">$request.body.action</span></pre><h2 id="b0c6" class="mz kv it bd kw ne nf dn la ng nh dp le lv ni nj lg lz nk nl li md nm nn lk no bi translated">$connect</h2><p id="bdfd" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">当客户端连接到您的API时，会使用这个路由。您将(很可能)希望为这个函数附加一个授权器，以便可以存储连接id和任何给定的授权客户信息。这可能是这样的</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h2 id="59a9" class="mz kv it bd kw ne nf dn la ng nh dp le lv ni nj lg lz nk nl li md nm nn lk no bi translated">$断开连接</h2><p id="6fd9" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">当客户端与您的API断开连接时，将使用此路由。根据我自己的经验，这是非常不可靠的，因为您经常需要手动检测客户端连接是否过时。在这篇文章的<strong class="lo iu">消息客户端</strong>中，我给出了一个例子。</p><h2 id="5a8d" class="mz kv it bd kw ne nf dn la ng nh dp le lv ni nj lg lz nk nl li md nm nn lk no bi translated">$默认</h2><p id="fb95" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">当模式与您的任何自定义模式都不匹配时，将使用此路线，并将其作为一个总括模式。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="ee11" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">消息客户端</h1><p id="3bcc" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">向连接的客户端发送消息实际上非常简单。您只需要确保将客户端的连接id存储在某个地方(数据库或缓存)，您可以使用类似下面的代码来实现这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="45a9" class="pw-post-body-paragraph lm ln it lo b lp nr ju lr ls ns jx lu lv nt lx ly lz nu mb mc md nv mf mg mh im bi translated">您需要注意两个特定的错误代码，410和504。</p><ul class=""><li id="d14f" class="nw nx it lo b lp nr ls ns lv ny lz nz md oa mh ob oc od oe bi translated">410 —表示客户端不再可用。</li><li id="7b27" class="nw nx it lo b lp of ls og lv oh lz oi md oj mh ob oc od oe bi translated">504 —请求超时(通常在30秒后)，根据我的经验，这通常表明我们无法与客户端通信。</li></ul></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="8bf1" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">授权人</h1><p id="c6b7" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><em class="ok">不幸的是，与API Gateway中的传统REST API不同，您不能附加一个AWS Cognito池来自动为您处理这些。</em></p><p id="db14" class="pw-post-body-paragraph lm ln it lo b lp nr ju lr ls ns jx lu lv nt lx ly lz nu mb mc md nv mf mg mh im bi translated">在撰写本文时，授权WebSocket连接的唯一方法是提供一个定制的authorizer lambda函数。将授权人附加到您的API时，您将收到该表单的提示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/500d4618d9d301a5990053ab9ccb316e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KaZt6kSIJPNlGZrYSukTQQ.png"/></div></div></figure><p id="e6a1" class="pw-post-body-paragraph lm ln it lo b lp nr ju lr ls ns jx lu lv nt lx ly lz nu mb mc md nv mf mg mh im bi translated">该自定义授权者应规定是否应根据给定的身份源对请求进行身份验证。本质上，您只需选择传递身份验证方式的方法(例如，AWS Cognito ID令牌、JWT访问令牌等)。)在<strong class="lo iu">中每个请求</strong>到你的WebSocket API。</p><p id="301d" class="pw-post-body-paragraph lm ln it lo b lp nr ju lr ls ns jx lu lv nt lx ly lz nu mb mc md nv mf mg mh im bi translated">您只能对整个API使用<strong class="lo iu">一个</strong>授权函数，并将其附加到您的<strong class="lo iu"> $connect </strong>路径。相同的授权者功能也将用于其他路由的所有其他请求。</p><p id="6930" class="pw-post-body-paragraph lm ln it lo b lp nr ju lr ls ns jx lu lv nt lx ly lz nu mb mc md nv mf mg mh im bi translated">使用AWS Cognito的授权者功能示例如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="ab29" class="pw-post-body-paragraph lm ln it lo b lp nr ju lr ls ns jx lu lv nt lx ly lz nu mb mc md nv mf mg mh im bi translated">我希望one-day AWS将添加对使用AWS Cognito进行授权的自动支持，因为如果我们拥有与REST APIs相同的支持，这将会消除许多难看的代码。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="975e" class="pw-post-body-paragraph lm ln it lo b lp nr ju lr ls ns jx lu lv nt lx ly lz nu mb mc md nv mf mg mh im bi translated"><em class="ok">感谢您的阅读，祝您的项目好运！如果你有任何问题，请留言或给我。</em></p></div></div>    
</body>
</html>