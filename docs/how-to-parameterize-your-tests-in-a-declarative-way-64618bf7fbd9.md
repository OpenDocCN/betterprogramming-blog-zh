# 如何以声明的方式参数化您的测试

> 原文：<https://betterprogramming.pub/how-to-parameterize-your-tests-in-a-declarative-way-64618bf7fbd9>

## TDD 和声明式编程是如何结合在一起的？

![](img/bf6b034d77e2f75f3a89e9ed51207728.png)

Jaz King 在 [Unsplash](https://unsplash.com/s/photos/books?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片。

作为软件工程师，我们都同意测试是我们创建的每一个软件的一个非常重要的部分。我们编写测试的方法是一个完全不同的话题。我们中的一些人喜欢 TDD，而另一些人通常在一个特性实现后编写测试。

在本文中，我将只关注参数化测试，因为我相信这种编写测试的方式有时会更简单，可读性更好。

# 你将从这篇文章中得到什么？

*   简单看一下什么是声明式编程，什么不是。
*   如何用 JavaScript 编写参数化测试？
*   确定使用这些测试的正确时间。
*   编写参数化测试的利弊。

# 声明性—有什么大不了的？

当我开始在 React 中写作时，我说服自己使用声明性范式，但这有什么大不了的呢？

声明性范式通常被比作命令性范式。在命令式编程中，我们关注的是如何实现我们的目标。另一方面，声明式编程更多的是关于我们想要达到的目标。泰勒·麦金尼斯在[关于这个话题的文章](https://tylermcginnis.com/imperative-vs-declarative-programming/)中提供了一个很好的例子:

> “我就在沃尔玛旁边。从这里怎么去你家？”
> 
> **命令式响应**:出停车场北口左转。沿 15 号州际公路向北行驶，直到您到达第 12 街出口。在出口处右转，就像去宜家一样。直走，在第一个红绿灯右转。继续穿过下一个红绿灯，然后在下一个路口左转。我的房子是 298 号。
> 
> 陈述性回答:我的地址是犹他州艾登市西不变巷 298 号，邮编 84310

# 如何编写参数化测试

我已经用一些用 JavaScript 编写的样板代码准备好了 [GitHub 库](https://github.com/kwdowik/declarative-tests)。首先，让我们看看当所有参数都在测试中指定时，测试将会是什么样子:

这些测试是以命令的方式编写的。在每次测试中，我都遵循相同的步骤:

*   创作一本书。
*   检查这本书是否有效。
*   将结果赋给一个变量。
*   检查结果是否和我们预期的一样。

现在让我们看看如何将每个测试中的参数从测试逻辑中分离出来:

如您所见，我们只留下了检查创建的图书是否有效的测试逻辑，但是所有参数都在不同的 JSON 文件中:

因为我们将参数移动到了不同的文件中，所以我们可以很容易地添加新的测试用例。

有很多允许我们编写参数化测试的库(例如 [jest-each](https://www.npmjs.com/package/jest-each) ) *。使用这个特殊的库非常容易。您可以通过数组的数组来指定测试用例，其中每个数组都是一个新的测试用例，数组中的每个元素都是测试函数的另一个参数:*

或者使用模板字符串代替数组的数组:

这种解决方案对于简单的情况似乎是完美的，但是对于更复杂的测试，我们需要注入一些服务或者存储库，最好使用一个 JSON 文件，在那里指定测试用例，因为分离和增加可读性。

# 何时使用参数化测试

## **使用**

当然，要看情况。你没想到会有不同的答案，是吗？这类测试的最佳场景是一个测试有很多测试用例的情况——就像上面的例子，我们测试了某本书对不同数据的验证。另一个例子可以是一个存储库，在这里我们想要检查不同数据集的每个 CRUD 方法，以确保我们接触到每个案例。

## **不要使用**

另一方面，您不应该在测试一组数据的情况下使用参数化测试。将数据从测试中分离出来会有些矫枉过正。

# 参数化测试的利与弊

## **优点**

*   创建一次测试，然后只添加新的测试用例。
*   测试逻辑从测试用例中分离出来。
*   包含测试用例的 JSON 文件可以很容易地与其他团队成员共享，而不用担心任何人会破坏您的测试。
*   使用 JSON 模式验证，测试可以与技术不太熟练的团队成员共享(例如，手工测试人员)。
*   他们遵循干燥原则。

## 骗局

*   将测试逻辑从测试参数中分离出来需要额外的工作。
*   对只有几个病例要检查的测试来说是过度的。
*   带有测试用例的附加文件(不需要)。

# 结论

本文的目的是说明在某些情况下，编写这些类型的测试可能是一种简单而干净的替代方法。这只是参数化测试和我的方法的一个简单例子。如果你想了解更多，我推荐[查看我的库](https://github.com/kwdowik/declarative-tests)以获得完整的应用程序。

我希望这篇短文实现了我在开始时的承诺。

感谢阅读！

推特: [*k_wdowik*](https://twitter.com/k_wdowik)