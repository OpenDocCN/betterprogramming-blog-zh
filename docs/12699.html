<html>
<head>
<title>Create a Popover In Svelte</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个苗条的Popover</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-popover-in-svelte-fe7dd2eeebb1?source=collection_archive---------7-----------------------#2022-06-23">https://betterprogramming.pub/create-a-popover-in-svelte-fe7dd2eeebb1?source=collection_archive---------7-----------------------#2022-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ced" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在没有任何其他库或依赖项的情况下创建一个popover。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6532db112ef356d4e34e79ed28ad006d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7fX6Ojn4lPRXVlXu"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jannerboy62?utm_source=Papyrs&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">缺口缺口</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">缺口</a>上拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="f502" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我已经实现了我上一个项目<a class="ae ky" href="https://papy.rs/" rel="noopener ugc nofollow" target="_blank"> Papyrs </a>的UI组件，没有任何第三方设计系统库——也就是说，我从头开始创建所有组件。我这样做是为了获得对我固执己见的布局中的各种砖块的完全控制和灵活性。</p><p id="78fd" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在这篇博文中，我分享了如何在<a class="ae ky" href="https://svelte.dev/" rel="noopener ugc nofollow" target="_blank">svelet</a>中开发popover组件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/c9d99fe69af452f7b1e44bf628152505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*d43Pb3xU1a3yeqIs0liy0g.gif"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="b5fb" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">骨骼</h1><p id="c14c" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">popover是一个浮动容器，它呈现在锚(通常是一个按钮)旁边的内容上，启动它的显示。为了提高覆盖图的视觉焦点，通常使用背景来部分模糊其背后的视图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/f04a568ecccb6a1828e0366fb6bd0af9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/0*MsjQuhNr-ifgJL0D"/></div></figure><p id="dc07" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们可以通过在名为<code class="fe nb nc nd ne b">Popover.svelte</code>的组件中复制上述框架来开始实现，该组件包含一个<code class="fe nb nc nd ne b">button</code>和<code class="fe nb nc nd ne b">div</code>。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="850e" class="nj me it ne b gy nk nl l nm nn">&lt;button&gt;Open&lt;/button&gt;<br/><br/>&lt;div<br/>    role="dialog"<br/>    aria-labelledby="Title"<br/>    aria-describedby="Description"<br/>    aria-orientation="vertical"<br/>&gt;<br/>    &lt;div&gt;Backdrop&lt;/div&gt;<br/>    &lt;div&gt;Content&lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="1260" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为了提高可访问性，我们可以设置<code class="fe nb nc nd ne b">dialog</code>角色并提供一些<code class="fe nb nc nd ne b">aria</code>信息(更多细节参见<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles/dialog_role" rel="noopener ugc nofollow" target="_blank"> MDN文档</a>)。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="4d6e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">动画</h1><p id="9614" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">我们创建一个<code class="fe nb nc nd ne b">boolean</code>状态— <code class="fe nb nc nd ne b">visible</code> —来显示或关闭弹出窗口。当点击<code class="fe nb nc nd ne b">button</code>时，状态被设置为<code class="fe nb nc nd ne b">true</code>，覆盖图被渲染。相反，当背景被点击时，它转向<code class="fe nb nc nd ne b">false</code>并关闭。</p><p id="7f10" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">此外，我们在popover上添加了一个click监听器，它除了停止事件传播之外什么也不做。当用户与其内容交互时，这有助于避免关闭覆盖图。</p><p id="1da1" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">多亏了<a class="ae ky" href="https://svelte.dev/tutorial/transition" rel="noopener ugc nofollow" target="_blank">过渡指令</a>——也被称为“苗条的黑魔法”,我们还可以让覆盖图优雅地出现和消失😁。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="579f" class="nj me it ne b gy nk nl l nm nn">&lt;script lang="ts"&gt;<br/>  import { fade, scale } from 'svelte/transition';<br/>  import { quintOut } from 'svelte/easing';<br/><br/>  let visible = false;<br/>&lt;/script&gt;<br/><br/>&lt;button on:click={() =&gt; (visible = true)}&gt;Open&lt;/button&gt;<br/><br/>{#if visible}<br/>  &lt;div<br/>    role="dialog"<br/>    aria-labelledby="Title"<br/>    aria-describedby="Description"<br/>    aria-orientation="vertical"<br/>    transition:fade<br/>    on:click|stopPropagation<br/>  &gt;<br/>    &lt;div<br/>      on:click|stopPropagation={() =&gt; (visible = false)}<br/>      transition:scale={{ delay: 25, duration: 150, easing: quintOut }}<br/>    &gt;<br/>      Backdrop<br/>    &lt;/div&gt;<br/>    &lt;div&gt;Content&lt;/div&gt;<br/>  &lt;/div&gt;<br/>{/if}</span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="7dd2" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">定位在内容上</h1><p id="37b2" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">无论页面是否滚动，弹出窗口都应该呈现在所有内容上。因此，我们可以使用<code class="fe nb nc nd ne b">fixed</code>位置作为起点。它的内容和背景都设置为<code class="fe nb nc nd ne b">absolute</code>位置。背景也应该覆盖屏幕，但它是覆盖层的子层，因此是“绝对的”，内容应该放在锚点旁边。</p><p id="3856" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们添加到解决方案中的其余CSS代码是宽度、高度或颜色的最小样式设置。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="bd58" class="nj me it ne b gy nk nl l nm nn">&lt;script lang="ts"&gt;<br/>  import { fade, scale } from 'svelte/transition';<br/>  import { quintOut } from 'svelte/easing';<br/><br/>  let visible = false;<br/>&lt;/script&gt;<br/><br/>&lt;button on:click={() =&gt; (visible = true)}&gt;Open&lt;/button&gt;<br/><br/>{#if visible}<br/>  &lt;div<br/>    role="dialog"<br/>    aria-labelledby="Title"<br/>    aria-describedby="Description"<br/>    aria-orientation="vertical"<br/>    transition:fade<br/>    class="popover"<br/>    on:click|stopPropagation<br/>  &gt;<br/>    &lt;div<br/>      on:click|stopPropagation={() =&gt; (visible = false)}<br/>      transition:scale={{ delay: 25, duration: 150, easing: quintOut }}<br/>      class="backdrop"<br/>    /&gt;<br/>    &lt;div class="wrapper"&gt;Content&lt;/div&gt;<br/>  &lt;/div&gt;<br/>{/if}<br/><br/>&lt;style&gt;<br/>  .popover {<br/>    position: fixed;<br/>    inset: 0;<br/><br/>    z-index: 997;<br/>  }<br/><br/>  .backdrop {<br/>    position: absolute;<br/>    inset: 0;<br/><br/>    background: rgba(0, 0, 0, 0.3);<br/>  }<br/><br/>  .wrapper {<br/>    position: absolute;<br/><br/>    min-width: 200px;<br/>    max-width: 200px;<br/><br/>    min-height: 100px;<br/><br/>    width: fit-content;<br/>    height: auto;<br/><br/>    overflow: hidden;<br/><br/>    display: flex;<br/>    flex-direction: column;<br/>    align-items: flex-start;<br/><br/>    background: white;<br/>    color: black;<br/>  }<br/>&lt;/style&gt;</span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="35eb" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">锚旁边的位置</h1><p id="5a6d" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">要设置按钮旁边的覆盖，我们必须获得该元素的引用，以找到它在视口中的位置。为此我们可以<code class="fe nb nc nd ne b">bind</code>锚。</p><p id="546a" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">当引用准备好或者窗口被调整大小时(如果用户调整浏览器的大小，位置可能会改变)，我们使用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect" rel="noopener ugc nofollow" target="_blank"> getBoundingClientRect() </a>方法来查询关于位置的信息。</p><p id="0815" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们最终将这些JavaScript信息翻译成CSS变量，以便在我们想要设置的确切位置呈现popover的内容。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="2550" class="nj me it ne b gy nk nl l nm nn">&lt;script lang="ts"&gt;<br/>  // ...<br/>  <br/>  let anchor: HTMLButtonElement | undefined = undefined;<br/><br/>  let bottom: number;<br/>  let left: number;<br/><br/>  const initPosition = () =&gt;<br/>    ({ bottom, left } = anchor?.getBoundingClientRect() ?? { bottom: 0, left: 0 });<br/><br/>  $: anchor, initPosition();<br/>&lt;/script&gt;<br/><br/>&lt;svelte:window on:resize={initPosition} /&gt;<br/><br/>&lt;button on:click={() =&gt; (visible = true)} bind:this={anchor}&gt;Open&lt;/button&gt;<br/><br/>{#if visible}<br/>  &lt;div<br/>    role="dialog"<br/>    aria-labelledby="Title"<br/>    aria-describedby="Description"<br/>    aria-orientation="vertical"<br/>    transition:fade<br/>    class="popover"<br/>    on:click|stopPropagation<br/>    style="--popover-top: {`${bottom}px`}; --popover-left: {`${left}px`}"<br/>  &gt;<br/>    &lt;!-- ... --&gt;<br/>  &lt;/div&gt;<br/>{/if}<br/><br/>&lt;style&gt;<br/>  /** ... */<br/><br/>  .wrapper {<br/>    position: absolute;<br/><br/>    top: calc(var(--popover-top) + 10px);<br/>    left: var(--popover-left);<br/><br/>    /** ... */<br/>  }<br/>&lt;/style&gt;</span></pre><p id="1b70" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">上面的代码片段被修剪成只展示与本章相关的内容。总的来说，该组件的代码如下:</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="203e" class="nj me it ne b gy nk nl l nm nn">&lt;script lang="ts"&gt;<br/>  import { fade, scale } from 'svelte/transition';<br/>  import { quintOut } from 'svelte/easing';<br/><br/>  let visible = false;<br/>  let anchor: HTMLButtonElement | undefined = undefined;<br/><br/>  let bottom: number;<br/>  let left: number;<br/><br/>  const initPosition = () =&gt;<br/>    ({ bottom, left } = anchor?.getBoundingClientRect() ?? { bottom: 0, left: 0 });<br/><br/>  $: anchor, initPosition();<br/>&lt;/script&gt;<br/><br/>&lt;svelte:window on:resize={initPosition} /&gt;<br/><br/>&lt;button on:click={() =&gt; (visible = true)} bind:this={anchor}&gt;Open&lt;/button&gt;<br/><br/>{#if visible}<br/>  &lt;div<br/>    role="dialog"<br/>    aria-labelledby="Title"<br/>    aria-describedby="Description"<br/>    aria-orientation="vertical"<br/>    transition:fade<br/>    class="popover"<br/>    on:click|stopPropagation<br/>    style="--popover-top: {`${bottom}px`}; --popover-left: {`${left}px`}"<br/>  &gt;<br/>    &lt;div<br/>      on:click|stopPropagation={() =&gt; (visible = false)}<br/>      transition:scale={{ delay: 25, duration: 150, easing: quintOut }}<br/>      class="backdrop"<br/>    /&gt;<br/>    &lt;div class="wrapper"&gt;Content&lt;/div&gt;<br/>  &lt;/div&gt;<br/>{/if}<br/><br/>&lt;style&gt;<br/>  .popover {<br/>    position: fixed;<br/>    inset: 0;<br/><br/>    z-index: 997;<br/>  }<br/><br/>  .backdrop {<br/>    position: absolute;<br/>    inset: 0;<br/><br/>    background: rgba(0, 0, 0, 0.3);<br/>  }<br/><br/>  .wrapper {<br/>    position: absolute;<br/><br/>    top: calc(var(--popover-top) + 10px);<br/>    left: var(--popover-left);<br/><br/>    min-width: 200px;<br/>    max-width: 200px;<br/><br/>    min-height: 100px;<br/><br/>    width: fit-content;<br/>    height: auto;<br/><br/>    overflow: hidden;<br/><br/>    display: flex;<br/>    flex-direction: column;<br/>    align-items: flex-start;<br/><br/>    background: white;<br/>    color: black;<br/>  }<br/>&lt;/style&gt;</span></pre><p id="fd38" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">还有…就是这样！我们已经实现了一个最小的自定义弹出窗口，可以在任何苗条的应用程序中使用，没有任何依赖性。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8f48" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="567f" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">我们没有美化解决方案，因此结果在视觉上仍然很粗糙，但是popover像预期的那样工作。</p><p id="3c8b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为了从那里开始迭代，实现更多的选项或者让它变得闪亮，你可以在<a class="ae ky" href="https://github.com/papyrs/papyrs" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上查看<a class="ae ky" href="https://papy.rs/" rel="noopener ugc nofollow" target="_blank"> Papyrs </a>的开源代码🤗。</p><p id="8d0c" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">通向无限和更远的地方</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/61360e70fe174db0ce168c9a0a4e3d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*eth8UohB1g-TeamISklW_A.gif"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="8f22" class="nj me it ne b gy nk nl l nm nn"><strong class="ne iu">Want to Connect?</strong></span><span id="3698" class="nj me it ne b gy no nl l nm nn">For more adventures, follow me on <a class="ae ky" href="https://twitter.com/daviddalbusco" rel="noopener ugc nofollow" target="_blank">Twitter</a></span></pre></div></div>    
</body>
</html>