<html>
<head>
<title>Run S3 Locally With MinIO for the DVC Machine Learning Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MinIO在本地运行DVC机器学习管道的S3</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/run-s3-locally-with-minio-for-dvc-machine-learning-pipeline-7fa3d240d3ab?source=collection_archive---------1-----------------------#2022-07-30">https://betterprogramming.pub/run-s3-locally-with-minio-for-dvc-machine-learning-pipeline-7fa3d240d3ab?source=collection_archive---------1-----------------------#2022-07-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1b87" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">开始使用对象存储的最便宜和最快的方法。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/413546ae26e412d9e3335d306bcf5cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Dq7R6Gon0UfGiKxt"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ricaros?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丹尼尔·伊德里</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ac1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对象存储是文件系统之上的抽象层，有助于通过API处理数据。最广为人知的工具是AWS S3，但是还有许多其他的解决方案允许它在私有网络上运行。在本文中，我们将介绍一种叫做MinIO的工具。</p><p id="284b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我看来，MinIO是开始使用对象存储的最便宜和最快的方法。它与S3兼容，易于部署、本地管理，并且可以根据需要进行升级。如果你的项目处于早期阶段，MinIO可能会派上用场。</p><h1 id="7a48" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装MinIO服务器</h1><p id="b1b4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本文中，我们将部署MinIO并在其上执行一些简单的任务。现在有很多不同的方式来运行它，但我们更喜欢建立一个Docker容器并在其上运行MinIO。</p><p id="fc4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了构建容器，我们将使用docker-compose。在这里，我受到了一个优秀的回购<a class="ae ky" href="https://github.com/github-ismail-chafai/kafka-to-s3" rel="noopener ugc nofollow" target="_blank"> kafka-to-s3 </a>的启发，其中MinIO被用来嘲笑s3从Kafka Connect接收的数据。<code class="fe ms mt mu mv b">docker-compose.yml</code>文件定义如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9c2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们定义了两个服务:<code class="fe ms mt mu mv b">minio</code>和<code class="fe ms mt mu mv b">aws</code>。在<code class="fe ms mt mu mv b">minio</code>中，我们定义要安装的发布版本和运行服务器的命令，这允许我们通过暴露的端口<code class="fe ms mt mu mv b">9000</code>访问MinIO UI。我们还定义了<code class="fe ms mt mu mv b">aws-cli</code>映像来在本地构建S3存储。我们用URL <code class="fe ms mt mu mv b">http://minio:9000</code>访问MinIO并定义区域<code class="fe ms mt mu mv b">eu-west-1</code>。我们还定义了运行服务器后登录UI的密钥。</p><p id="9afd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保存清单后，我们在同一个目录中运行<code class="fe ms mt mu mv b">docker-compose up</code>。下载并构建映像后，我们会看到消息称<code class="fe ms mt mu mv b">minio</code>已启动并运行，已连接到S3。通过访问URL <code class="fe ms mt mu mv b">http://localhost:9000</code>，使用之前创建的登录名和密码，我们可以访问UI。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/78a587b3e985693151c6aa27e1169c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sIOUllU2O6YGdT7ARoY-xw.png"/></div></div></figure><h2 id="1d7f" class="mz lw it bd lx na nb dn mb nc nd dp mf li ne nf mh lm ng nh mj lq ni nj ml nk bi translated">链接MinIO服务器作为DVC远程存储</h2><p id="d219" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们回到我们在<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/build-production-ready-ml-workflow-with-dvc-and-s3-cdd9c95bf19">上一篇文章</a>中描述的例子。</p><p id="4d8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但这一次，我们将设置我们的提升MinIO服务器作为DVC的远程存储。首先，我们需要创建一个名为<code class="fe ms mt mu mv b">dvc-art</code>的桶来推送数据。这个桶类似于AWS S3的那个。但是在MinIO的情况下，我们需要在DVC的配置文件中明确地对它进行认证。让我们设置DVC遥控器。首先，添加名为<code class="fe ms mt mu mv b">dvc-art</code>的新遥控器。</p><pre class="kj kk kl km gt nl mv nm nn aw no bi"><span id="9e4d" class="mz lw it mv b gy np nq l nr ns">dvc init<br/>dvc remote add -d minio s3://dvc-art</span></pre><p id="3bfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加有关存储URL和凭据的信息以访问MinIO服务器。</p><pre class="kj kk kl km gt nl mv nm nn aw no bi"><span id="f179" class="mz lw it mv b gy np nq l nr ns">dvc remote modify minio endpointurl <a class="ae ky" href="http://127.0.0.1:9000" rel="noopener ugc nofollow" target="_blank">http://localhost:9000/minio/</a><br/>dvc remote modify minio2 access_key_id minioadmin<br/>dvc remote modify minio2 secret_access_key minioadmin</span></pre><p id="c5f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置好遥控器后，我们将能够在<code class="fe ms mt mu mv b">.dvc/config</code>文件中看到这些修改。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="5b55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的项目和MinIO储物件已经准备就绪。我们将运行在上一篇文章中构建的ML管道来生成带有中间特征化数据集的文件。</p><pre class="kj kk kl km gt nl mv nm nn aw no bi"><span id="0e1a" class="mz lw it mv b gy np nq l nr ns">dvc repro</span></pre><p id="d562" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以将创建的数据文件推送到模拟的S3存储器。</p><pre class="kj kk kl km gt nl mv nm nn aw no bi"><span id="933c" class="mz lw it mv b gy np nq l nr ns">git add .<br/>git commit -m "run pipeline"<br/>dvc push -r minio2 data/*</span></pre><p id="a836" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">推送的数据应该以下列格式出现在MinIO UI中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/ee0fe3f8c89537092dca21e87355c9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C6Wx7dcbT6awUPO5WXgidw.png"/></div></div></figure><p id="dff1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也可以使用以下命令从远程位置提取存储的数据来进行访问:</p><pre class="kj kk kl km gt nl mv nm nn aw no bi"><span id="c935" class="mz lw it mv b gy np nq l nr ns">dvc pull -r minio2 data/*</span></pre><h1 id="f48c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最后的想法</h1><p id="251c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本文中，我们通过提升MinIO对象存储服务器在本地模拟了S3存储。我们还将其定义为DVC管道的远程存储，并从机器学习项目中推送/拉出数据。</p><p id="efbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读这篇文章。</p><h1 id="136b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><ul class=""><li id="680a" class="nu nv it lb b lc mn lf mo li nw lm nx lq ny lu nz oa ob oc bi translated"><a class="ae ky" href="https://docs.min.io/docs/deploy-minio-on-docker-compose" rel="noopener ugc nofollow" target="_blank">https://docs.min.io/docs/deploy-minio-on-docker-compose</a></li><li id="b72a" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><a class="ae ky" href="https://docs.min.io/docs/minio-docker-quickstart-guide.html" rel="noopener ugc nofollow" target="_blank">https://docs.min.io/docs/minio-docker-quickstart-guide.html</a></li><li id="8bca" class="nu nv it lb b lc od lf oe li of lm og lq oh lu nz oa ob oc bi translated"><a class="ae ky" href="https://thedatabaseme.de/2022/03/20/i-do-it-on-my-own-then-self-hosted-s3-object-storage-with-minio-and-docker/" rel="noopener ugc nofollow" target="_blank">https://the database me . de/2022/03/20/I-do-it-on-my-own-then-self-hosted-S3-object-storage-with-minio-and-docker/</a></li></ul></div></div>    
</body>
</html>