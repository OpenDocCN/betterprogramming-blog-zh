<html>
<head>
<title>Authentication and JSON Web Token in the MEAN Stack, From Angular to Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MEAN堆栈中的身份验证和JSON Web Token，从Angular到Node.js</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/jwt-json-web-token-in-the-mean-stack-b17c729ac3de?source=collection_archive---------8-----------------------#2019-07-10">https://betterprogramming.pub/jwt-json-web-token-in-the-mean-stack-b17c729ac3de?source=collection_archive---------8-----------------------#2019-07-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/99dbc35cf81e7714ea19173072f7a874.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a_5hvbJHlADjh_fKLASXkg.jpeg"/></div></div></figure><p id="f9ae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"> JSON Web Token </a>是在<a class="ae kz" href="http://meanjs.org/" rel="noopener ugc nofollow" target="_blank"> MEAN </a>栈中实现认证模式的最佳标准。</p><p id="02c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">编写服务器端和客户端逻辑非常容易，但是当您的目标是拥有完整的RBAC(基于角色的访问控制)身份验证模式时，这可能会有点棘手，因为我们希望保护路由不被不合格的角色访问。</p><p id="a2cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> JWT是认真的</strong>。它不是最佳实践，也不是建议，更不是口碑。它是真正的RFC标准，由IETF: RFC 7519 定义。</p><p id="7ede" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">JWT实现需要服务器端逻辑来签名和生成令牌，客户端逻辑来存储令牌并将其附加到从客户端到web服务器的每次通信(通常是Ajax)中。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h2 id="4ec3" class="lh li it bd lj lk ll dn lm ln lo dp lp km lq lr ls kq lt lu lv ku lw lx ly lz bi translated">什么是JSON Web令牌？</h2><p id="0472" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky im bi translated">它是一个普通的字符串，仅此而已，由以下内容组成:</p><ol class=""><li id="fb58" class="mf mg it kd b ke kf ki kj km mh kq mi ku mj ky mk ml mm mn bi translated"><strong class="kd iu">一个头</strong>，它保存了关于用于签名的算法(HMAC SHA256或RSA)和其他元的信息。</li><li id="b068" class="mf mg it kd b ke mo ki mp km mq kq mr ku ms ky mk ml mm mn bi translated"><strong class="kd iu">一个有效载荷</strong>，通常是有趣的部分，它包含我们想要存储在令牌中的信息。</li><li id="2775" class="mf mg it kd b ke mo ki mp km mq kq mr ku ms ky mk ml mm mn bi translated"><strong class="kd iu">摘要</strong>，这是JWT的最后一部分，使其安全且防篡改。</li></ol><figure class="mu mv mw mx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/2d42900f4c0c842c3fa321d5f261754a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7xHs7_khbj1LPEzSTbY_NQ.png"/></div></div><p class="my mz gj gh gi na nb bd b be z dk translated">JSON Web令牌示例:头(红色)、有效负载(紫色)和摘要(青色)</p></figure><p id="15af" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，JWT没有加密，它只是被签名以防止摘要被篡改，因此它总是可以被客户端和服务器端读取(甚至被入侵者读取……)。<strong class="kd iu">切勿</strong>在令牌中存储敏感数据。</p><p id="c66b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">没有真正的设计模式来实现JWT，只有网络上关于如何编码的好主意。这就是为什么我不会花时间在线上评论如何实现它，我只会显示代码片段来签名并通过它进行交流。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="feb7" class="nc li it bd lj nd ne nf lm ng nh ni lp nj nk nl ls nm nn no lv np nq nr ly ns bi translated">服务器端部分:创建一个JWT</h1><figure class="mu mv mw mx gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="94c2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里是一个JWT创建和签名实现的<a class="ae kz" href="https://github.com/auth0/node-jsonwebtoken" rel="noopener ugc nofollow" target="_blank">片段，使用Node.js和<code class="fe nv nw nx ny b">auth0</code>节点模块</a></p><p id="3a40" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">“sign”方法的第一个参数是需要放入有效载荷(然后放入令牌本身)的信息。</p><p id="b031" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第二个参数是用于创建摘要的密钥。</p><p id="8b32" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第三是期权表示。在本例中，我将令牌的到期日期设置为七天。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="8975" class="nc li it bd lj nd ne nf lm ng nh ni lp nj nk nl ls nm nn no lv np nq nr ly ns bi translated">服务器端部分:检查和验证JWT</h1><figure class="mu mv mw mx gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="8cc1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里是另一个Node.js片段，用<a class="ae kz" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a>中间件实现，它拦截所有请求并检查JWT的存在。</p><p id="e224" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们正在使用一个常见的实现，它期望将JWT传递到HTTP头“authorization”键中。</p><p id="545d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">作为验证例程的结果，如果令牌过期，我们将发送HTTP 401 Unauthorized，如果报头中缺少令牌，我们将发送HTTP 400 Bad请求。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="db20" class="nc li it bd lj nd ne nf lm ng nh ni lp nj nk nl ls nm nn no lv np nq nr ly ns bi translated">客户端部分:通过AJAX通信，使用角度拦截器添加JWT</h1><figure class="mu mv mw mx gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="7ccb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个代码片段中，我们使用了一个<a class="ae kz" href="https://angular.io/api/common/http/HttpInterceptor" rel="noopener ugc nofollow" target="_blank">角度拦截器</a>，这是一个将令牌附加到每个HTTP请求的好方法。</p><p id="530c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有一些关于如何使用拦截器的注释，所有的注释都是依赖于应用程序上下文的，所以把这个片段看作是一个关于如何添加它的例子。</p><p id="1532" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如您所见，我们使用了带有“Bearer”前缀的名为“authorization”的HTTP头，正如服务器所期望的那样。</p><p id="3883" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本例中，我们在本地存储中存储和读取令牌。像以前一样，这只是一个想法，你可能更喜欢一个<code class="fe nv nw nx ny b">SessionStorage</code>或其他东西。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="5757" class="nc li it bd lj nd ne nf lm ng nh ni lp nj nk nl ls nm nn no lv np nq nr ly ns bi translated">结论</h1><p id="6259" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky im bi translated">JSON Web Token得到了很好的支持。在官方网站的<a class="ae kz" href="https://jwt.io" rel="noopener ugc nofollow" target="_blank">上，你可以找到几乎任何语言的库和工具来使用它，从</a><a class="ae kz" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>到。NET apps，以及<a class="ae kz" href="https://www.java.com/" rel="noopener ugc nofollow" target="_blank"> Java </a>到Node.js。</p><p id="f2e3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您将需要几个小时来实现一个健壮的身份验证方法，但这绝对是值得的。</p></div></div>    
</body>
</html>