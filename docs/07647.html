<html>
<head>
<title>Integrating Combine in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SwiftUI中集成联合收割机</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/integrating-combine-in-swiftui-f3ffa2e170ba?source=collection_archive---------9-----------------------#2021-02-04">https://betterprogramming.pub/integrating-combine-in-swiftui-f3ffa2e170ba?source=collection_archive---------9-----------------------#2021-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c432" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在SwiftUI代码中直接使用消费者和操作者</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d5dacdbe1f0bb540d5e16578cf9bb146.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*a8reyojf-HKhG0wMAsblvg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者GIF。</p></figure><p id="3f7b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当苹果推出SwiftUI时，他们还加入了第二个没有得到太多关注的框架:Combine，苹果将该框架描述为“一个统一的、声明式的API，用于随时间处理值”</p><p id="0b3b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">也就是说，声明式编码进入Swift已经有一段时间了。这方面的一个很好的例子是2018年的一个演示，它仍然是近年来WWDCs中最好的通用演示之一。在这次演讲中，戴夫·亚伯拉罕斯向我们讲述了拥抱算法。</p><div class="lv lw gp gr lx ly"><a href="https://marklucking.medium.com/the-best-apple-wwdc-talk-ever-16d613815f86" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">有史以来最好的苹果WWDC演讲</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">回顾我认为是最好的WWDC会谈之一</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">marklucking.medium.com</p></div></div></div></a></div><p id="eb64" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是等等，这不是一个关于反应式编码的演示，对吗？不，这是一个关于使用正确算法的演示。在本例中，Dave的目标是对一组形状进行排序。他回顾了他用代码解决问题的步骤。最终导致他使用反应式编码的修正，就像我们今天要讨论的那样。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="68dd" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated"><strong class="ak">组合框架</strong></h1><p id="6dd8" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">让我们来关注一下联合收割机。它包含发布者、订阅者和操作者。发布者发送数据，订阅者消费数据，运营商是中间人。虽然您可以通过观察和发布的对象将这些集成到SwiftUI中，但是您也可以使用一个名为subjects的功能。</p><p id="87ae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">主题在全局中很重要，因为它们发布了运营商可以使用并最终传递给订户的数据。在Combine框架中，有两种类型的主题:</p><ul class=""><li id="02ba" class="nl nm it la b lb lc le lf lh nn ll no lp np lt nq nr ns nt bi translated"><code class="fe nu nv nw nx b">PassthroughSubject</code> <strong class="la iu"> </strong> — <strong class="la iu"> </strong>一个空的管道，可以通过它发送数据。</li><li id="93b1" class="nl nm it la b lb ny le nz lh oa ll ob lp oc lt nq nr ns nt bi translated"><code class="fe nu nv nw nx b">CurrentValueSubject</code><strong class="la iu"/>——<strong class="la iu"/>同一个东西有一个默认值。</li></ul><p id="11e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用<code class="fe nu nv nw nx b">.onreceive</code>视图修饰符在SwiftUI中捕获主题发送的数据，除此之外，您还可以使用许多操作符来处理数据，然后将其传递给订户。如果你有系统背景，这个想法可能会开始变得熟悉。在系统编程中，您使用管道字符始终将数据从一个实用程序发送到下一个实用程序。Combine框架使用相同的原理。</p><p id="efa2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">se已经写了一些关于使用新框架的书。这里有很多东西需要消化——对于一篇单独的文章来说实在太多了——所以这里有十几个用代码详细描述的操作。我在最后分享了我的研究，如果你现在想知道更多的话。如果你能等的话，我打算以后再发表几篇关于这个主题的文章。</p><p id="753d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们开始吧。</p><p id="62ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里显示的<code class="fe nu nv nw nx b">"sink”</code>操作符消耗数据和任何错误。当它这样做时，我打印出它获得的数据(在本例中是<code class="fe nu nv nw nx b">“foobar”</code>):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="2997" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nu nv nw nx b">"last”</code>操作符读取我们的行星列表，并返回最后发送的一个。在这种情况下，它将返回<code class="fe nu nv nw nx b">“mercury”</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="f85c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nu nv nw nx b">“collect”</code>操作符接受来自发布者的数据，直到它得到这里显示的数字(<code class="fe nu nv nw nx b">4</code>)。然后将它传递给订户。在这种情况下，订阅者得到(<code class="fe nu nv nw nx b">0,1,2,3</code>)，然后是(<code class="fe nu nv nw nx b">4,5,6,7</code>)，最后是(<code class="fe nu nv nw nx b">8</code>)。这是该运算符的几个选项之一。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="b3f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能以前见过<code class="fe nu nv nw nx b">“map”</code>。这将发布的数据类型转换为新的指定类型。这很重要，因为数据和错误的类型必须与发布者和订阅者相匹配。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="4b53" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nu nv nw nx b">“scan”</code>操作符接受数据，在我们的例子中，在将它们传递给订阅者之前，将最后两个接收到的数据加在一起。所以结果就是序列<code class="fe nu nv nw nx b">0 1 3 6 10 15 21 28</code>。<strong class="la iu"> </strong>走过这个，你得到<code class="fe nu nv nw nx b">0, 0</code> + <code class="fe nu nv nw nx b">1, 1</code> + <code class="fe nu nv nw nx b">2, 3</code> + <code class="fe nu nv nw nx b">3, 6</code> + <code class="fe nu nv nw nx b">4</code>等等。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="e097" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nu nv nw nx b">“output”</code>运算符返回代码中指定位置的元素。在这种情况下，我们得到<code class="fe nu nv nw nx b">“2416”</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="1798" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nu nv nw nx b">“reduce”</code>运算符返回一个字符串(在本例中为<code class="fe nu nv nw nx b">“abcdef”</code>)。基本上，它将所有数据作为一个单元返回:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="94c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nu nv nw nx b">“first”</code>操作符很像我已经提到过的它的表亲<code class="fe nu nv nw nx b">“last”</code>。它将返回流中发送的第一个元素，并丢弃其他元素。在这种情况下，我们得到<code class="fe nu nv nw nx b">“mars”</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="e8b2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nu nv nw nx b">“event”</code>操作符有点不寻常，因为我们忽略了这里的数据，只是在它安静下来时通知订户。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="6e13" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nu nv nw nx b">“compact”</code>操作符将测试传入的数据(这里，我们寻找整数),只传递那些通过验证的数据，丢弃其他的。在这种情况下，我们得到<code class="fe nu nv nw nx b">[1,2,4,8]</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="10d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nu nv nw nx b">removeDuplicates()</code>操作符基本上删除了发布者发送的相邻重复项。在这种情况下，我们得到了<code class="fe nu nv nw nx b">1</code>、<code class="fe nu nv nw nx b">2</code>、<code class="fe nu nv nw nx b">3</code>、<code class="fe nu nv nw nx b">4</code>、<code class="fe nu nv nw nx b">8</code>、<code class="fe nu nv nw nx b">9</code>和<code class="fe nu nv nw nx b">10</code>。如果您发送相同的值，但顺序不同(例如，如果您在<code class="fe nu nv nw nx b">3</code>和<code class="fe nu nv nw nx b">4</code>之间发送一个<code class="fe nu nv nw nx b">1</code>，则值通过。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="77b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意，这个操作符对于那些使用subjectss的人来说非常有用，subject有时会神秘地触发多次。</p><p id="a8b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在这里要提到的最后一个运算符<code class="fe nu nv nw nx b">“filter”</code>，超级有用。在这个例子中，我在寻找包含字母<code class="fe nu nv nw nx b">“a”</code>的行星。所以我们得到了一个结果<code class="fe nu nv nw nx b">“Earth”</code>、<code class="fe nu nv nw nx b">“Mars”</code>、<code class="fe nu nv nw nx b">“Saturn”</code>和<code class="fe nu nv nw nx b">“Uranus”</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="fc36" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就把我带到了这篇相当长的文章的结尾。我相信你可以看到一种模式正在形成。我在几乎所有的例子中都使用了<code class="fe nu nv nw nx b">sink</code>来消费数据，使用<code class="fe nu nv nw nx b">store</code>来通知订阅。</p><p id="71fe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关于这个主题的进一步阅读，我推荐Joe Heck的这篇文章。还有蒂博尔·博德斯的<a class="ae lu" href="https://theswiftdev.com/the-ultimate-combine-framework-tutorial-in-swift/" rel="noopener ugc nofollow" target="_blank">一篇更长的文章</a>和另一位媒体作家<a class="ae lu" href="https://medium.com/@ahmednasser_43518?source=post_page-----2a4d770a138c--------------------------------" rel="noopener">艾哈迈德·纳赛尔</a>的<a class="ae lu" href="https://medium.com/swlh/integrating-apple-combine-framework-into-an-exciting-ios-project-2a4d770a138c" rel="noopener">另一篇</a>。</p><p id="6644" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">保持冷静，继续编码。</p></div></div>    
</body>
</html>