# 作为一名 Java 开发人员，我为什么不做 TDD

> 原文：<https://betterprogramming.pub/why-i-dont-do-tdd-as-a-java-developer-e95def707e39>

## 好的，坏的，更坏的

![](img/1ab8d26ee40dd1b398d506674db9da11.png)

我最近为伦敦 Java 社区做了一个关于调试的演讲。在演讲的问答部分，有人问我关于测试驱动开发的方法。过去，我以更积极的态度看待这种做法。编写大量的测试。这有什么不好？

但是随着时间的推移，我对它有了不同的看法。我认为它是一个非常有限的工具，有非常具体的用例。它不适合我构建的项目类型，并且经常阻碍它应该促进的流畅过程。但是让我们回顾一下。我非常喜欢[这篇文章](https://buttondown.email/hillelwayne/archive/i-have-complicated-feelings-about-tdd-8403/)，它将 TDD 中的类型和问题分开。但是让我们简化一点，让我们明确一点，每个 PR 都要有好的覆盖率。这不是 TDD。只是好的编程。

TDD 不止于此。在其中，我们需要定义约束，然后解决问题。这种方法是否优于解决问题，然后验证约束是否正确？这是 TDD 的核心前提，而不仅仅是编写好的测试覆盖率。

# 好人

TDD 是一种有趣的方法。这在处理松散类型的语言时特别有用。在这些情况下，TDD 非常好，因为它扮演了严格编译器和 linter 的角色。

还有其他一些情况也说得通。当我们在构建一个有明确输入和输出的系统时。我在构建课程和材料时遇到过很多这样的案例。当处理真实世界的数据时，如果我们有处理数据并以预定义格式输出数据的中间件，这种情况有时会发生。

这个想法是用中间的隐藏变量来构造方程。那么编码就变成了等式中的填充。在这种情况下非常方便。编码变成了填空。

# 坏事

> *“测试驱动开发*就是*复式记账。同样的纪律。同样的道理。一样的结果。”—鲍伯·马丁叔叔*

我认为测试有点像复式记账。是的，我们应该进行测试。问题是我们应该基于测试来构建我们的代码，还是相反？这里的答案并不简单。

如果我们有一个预先存在的测试系统，那么 TDD 在这个世界上是有意义的。但是测试一个尚未建成的系统。在某些情况下，这是有意义的，但并不像人们想象的那样频繁。

TDD 最大的优势在于“它的设计”。测试实际上是系统设计，然后我们实现这个设计。这样的问题是我们也不能调试一个设计。过去，我为一家日本大公司做项目。这家公司有一套最大、最详细的附属设计书籍。基于这些设计规范，该公司建立了数以千计的测试。我们应该通过大量的系统测试。请注意，大多数甚至不是自动的。

测试有缺陷。有许多竞争的实现，但是没有一个在测试中发现错误。为什么？他们都使用相同的参考实现源代码。我们是第一个跳过这一步，进行洁净室实施的团队。它延续了代码中的这些错误，其中一些是严重的性能错误，影响了所有以前的版本。

但真正的问题是进展缓慢。公司无法快速前进。TDD 的支持者会很快评论说，TDD 项目更容易重构，因为测试给了我们不会有回归的保证。但是这适用于事后进行测试的项目。

# 越糟

TDD 非常关注快速单元测试。在 TDD 系统上运行缓慢的集成测试或者可以通宵运行的长期测试是不切实际的。您如何验证规模以及与主要系统的集成？

在一个理想的世界里，所有的东西都会像乐高积木一样自动就位。我没有生活在这样的世界里，集成测试失败得很惨。这些是最糟糕的失败，有最难追踪的错误。我宁愿单元测试失败，这就是为什么我有它们。它们很容易修复。但是即使有完美的覆盖，他们也不能正确地测试互连。我们需要集成测试，他们发现了最可怕的错误。

结果，TDD 过度强调“最好有”单元测试，而不是基本的集成测试。是的，你应该两者兼得。但是我必须参加综合测试。这些并不完全适合 TDD 过程。

# 右驱动测试

我根据具体情况选择测试方式。如果我有提前测试是自然的情况，我会使用它。但是在大多数情况下，首先编写代码对我来说似乎更自然。当编写测试时，回顾覆盖率是非常有帮助的，这是我在事后做的事情。

正如我之前提到的，我只检查集成测试的覆盖率。我喜欢单元测试并监控那里的覆盖率，因为我也希望那里有好的覆盖率。但是对于质量来说，只有集成测试才是重要的。一个公关需要单元测试，我不在乎我们是否在实现之前写了它们。我们应该判断结果。

# 糟糕的自动化

当特斯拉建造他们的 Model 3 工厂时，他们进入了生产地狱。问题的根源是他们试图自动化一切。帕累托法则完全适用于自动化。有些事情非常抗拒自动化，使整个过程变得更糟。

真正失败的一点是在 UI 测试中。硒等溶液。在测试 web 前端方面取得了巨大的进步。然而，复杂性是巨大的，测试是非常脆弱的。我们最终会得到难以维护的测试。更糟糕的是，我们发现 UI 更难重构，因为我们不想重写测试。

我们可能会跨越 80%的测试功能，但是自动化会有一个收益递减点。在那些环境中，TDD 是有问题的。功能很简单，但是构建测试变得不可行。

# 最后

我不反对 TDD，但是我不推荐它，实际上我也不使用它。当从测试开始有意义时，我可能会这样做，但那不是真正的 TDD。我根据结果判断代码。TDD 可以提供很好的结果，但是它经常过分强调单元测试。从长远来看，集成测试对质量更重要。

自动化很棒。直到它停止。在某种程度上，自动化测试毫无意义。接受这一点并把我们的努力集中在有成效的方向上会节省我们很多时间和精力。

这是我作为一个喜欢类型安全、严格语言的 Java 开发人员的偏见。像 JavaScript 和 Python 这样的语言由于其灵活性，可以从大量的测试中获益。因此 TDD 在那些环境中更有意义。

总之，测试是好的。尽管 TDD 并不能做出更好的测试。如果对你有用，这是一个有趣的方法。在某些情况下，它是巨大的。但是 TDD 是必不可少的，或者它将显著地改进最终代码的想法是没有意义的。