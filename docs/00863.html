<html>
<head>
<title>How To Take a Screenshot of a Website in the Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在云端截屏一个网站</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-take-a-screenshot-of-a-website-in-the-cloud-27f08dcbe9c1?source=collection_archive---------12-----------------------#2019-07-22">https://betterprogramming.pub/how-to-take-a-screenshot-of-a-website-in-the-cloud-27f08dcbe9c1?source=collection_archive---------12-----------------------#2019-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ff7d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为Firebase函数写一个Google函数</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/823dc1dbd39ddce1f137892bb87543c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0cBVakg6yb906eFR0VLm8Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@samsomfotos?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> samsommer </a>拍摄的照片</p></figure><p id="6f16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们目前正在<a class="ae ky" href="https://medium.com/hackernoon/we-are-developing-an-open-source-editor-for-presentations-9cfc69571133" rel="noopener">开发一个叫做<a class="ae ky" href="https://deckdeckgo.com" rel="noopener ugc nofollow" target="_blank"> DeckDeckGo </a>的用于演示的开源网页编辑器</a>，我们希望能在夏天结束时发布beta版。</p><p id="b9ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么我允许自己在开场白中如此大胆？好了，我们开始吧:我很高兴地正式宣布，它不仅是一个编辑器，还是一个在线平台，一个可以分享演示文稿的地方，最终，如果我让自己梦想一下未来，它会根据你的兴趣被索引，甚至可以被讨论。</p><p id="f126" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们拥有这样的应用和社区之前，我们还有很长的路要走——但这并不意味着我们不能有一点梦想，尤其是因为这是一个兼职项目；为了好玩，我们在晚上和周末实施。</p><p id="0b78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，我们决定在测试版中实现这个想法的第一部分。主屏幕，我称之为“feed ”,将显示所有将要用我们的工具编辑和发布(作为独立的渐进式Web应用程序……但那是另一个故事)。为此，就像他们的社交卡片一样，我们决定在云端捕捉这些卡片的第一张幻灯片的截图。</p><p id="0067" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇博客文章中，我将展示如何为Firebase 创建一个<a class="ae ky" href="https://firebase.google.com/docs/functions" rel="noopener ugc nofollow" target="_blank"> Google函数来抓取云中的一个网站的截图。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/183daee6e6459b77921a33eab5e75db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*UhdAPdzil3pwgFMecgqfJw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">先睹为快，看看我们的测试演示</p></figure><h1 id="79ac" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">解决方案介绍</h1><p id="ea84" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">对于这个解决方案，我们将为Firebase编写一个新的Google函数，以便在云中运行我们的流程。我们将使用<a class="ae ky" href="https://github.com/GoogleChrome/puppeteer" rel="noopener ugc nofollow" target="_blank">木偶师</a>运行一个无头Chrome，在那里我们将加载网站，并截取屏幕截图。最后，我们将把结果写入<a class="ae ky" href="https://firebase.google.com/docs/storage" rel="noopener ugc nofollow" target="_blank"> Google Firebase存储</a>。</p><h1 id="1744" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">开始之前</h1><p id="9120" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">诚然，谷歌在2018年8月发表了一篇很好的文章，介绍了云功能中的<a class="ae ky" href="https://cloud.google.com/blog/products/gcp/introducing-headless-chrome-support-in-cloud-functions-and-app-engine" rel="noopener ugc nofollow" target="_blank"> headless Chrome支持和应用引擎</a>，并精确描述了如何截图。然而，我的帖子介绍了存储，但也改进了截图的方法。所以，我希望你仍然认为这个作品值得你花时间！</p><p id="974c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mt">在本教程中，我将跳过设置和使用</em> <a class="ae ky" href="https://firebase.google.com/docs/functions" rel="noopener ugc nofollow" target="_blank"> <em class="mt"> Google Firebase功能</em> </a> <em class="mt">或存储的部分。有许多关于它的文档和教程，Google Firebase控制台甚至有向导带你完成这个过程。你还会注意到，我使用</em><a class="ae ky" href="https://firebase.google.com/docs/functions/typescript" rel="noopener ugc nofollow" target="_blank"><em class="mt">TypeScript</em></a><em class="mt">来编写函数，我们将在主文件</em> <code class="fe mu mv mw mx b">src/index.ts</code> <em class="mt">中编写所有代码。</em></p><h1 id="f379" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">入门指南</h1><p id="6c96" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">出于本文的目的，我们将创建一个<a class="ae ky" href="https://firebase.google.com/docs/functions/http-events" rel="noopener ugc nofollow" target="_blank"> HTTP函数</a>，它显然可以通过HTTP调用。对于DeckDeckGo，我们使用一个<a class="ae ky" href="https://firebase.google.com/docs/functions/database-events" rel="noopener ugc nofollow" target="_blank">实时数据库触发器</a>来触发这个过程。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="9b47" class="nc lx it mx b gy nd ne l nf ng">import * as functions from 'firebase-functions';<br/><br/>export const takeScreenshot =<br/>             functions.https.onRequest(takeScreenShotOnRequest);<br/><br/>async function takeScreenShotOnRequest(request, response) {<br/><em class="mt">    </em>// 1. Generate screenshot<br/>    // 2. Save to the storage<br/>}</span></pre><h1 id="8a5b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">截图吧</h1><p id="55e0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如上所述，我们将使用木偶师来捕捉截图。因此，首先我们必须为typescript安装依赖项及其类型定义:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="5f0d" class="nc lx it mx b gy nd ne l nf ng">$ npm install puppeteer --save<br/>$ npm install @types/puppeteer --save-dev</span></pre><p id="166c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完成后，我们修改之前的代码并实现以下功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="6788" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那里发生了什么事？我们告诉木偶师运行一个无头Chrome，它在一个特定大小的页面上访问我们的网站——屏幕截图的大小(宽度和高度)。我们还禁用了服务工作器(“无缓存=总是更新数据”)，并在截图之前等待加载特定的元素。如果你的目标是从一个静态网站上截取一个截图，你可以跳过最后一步。最后，我们告诉Puppeteer截取一个截图，并返回图像缓冲区作为函数的结果。</p><h1 id="37f9" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">特别信贷</h1><p id="72a9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我不是靠自己想出这个巧妙的解决方案的。这是他在<a class="ae ky" href="https://stencil-worldwide.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> StencilJS Slack </a>频道上与<a class="ae ky" href="https://www.bitflower.net" rel="noopener ugc nofollow" target="_blank"> bitflower </a>的首席执行官马蒂亚斯·马克斯(Matthias Max)交流的结果。向他致敬，如果他没有分享他的想法和代码，我不会想到要禁用服务人员。非常感谢马蒂亚斯！</p><h1 id="ccff" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">提示和技巧</h1><p id="e4ab" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果您需要更多的内存来运行您的云函数(我们的项目就是这种情况)，您可以扩展上面的声明，例如，使用1GB的内存和2分钟的超时。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="0680" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">保存到存储</h1><p id="bf7a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">将图像缓冲区保存到存储实际上真的很容易(虽然我不知道为什么我仍然对Google Firebase的简单感到惊讶！)使用Firebase Admin，我们只需引用默认的bucket，创建一个文件对象并保存它。</p><p id="5185" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:不需要检查或创建特定的文件夹和子文件夹，库会为您处理一切。此外，如果您多次运行该过程，默认情况下，存储中的结果文件将被覆盖。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="6609" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样——我们实现了一个谷歌云功能来获取并保存我们网站的截图。</p><h1 id="363d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">尝试一下</h1><p id="345c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">就像我上面说的，我就不去赘述与Firebase的交互细节了。也就是说，您可以在终端中运行以下命令来部署您的函数:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="279f" class="nc lx it mx b gy nd ne l nf ng">$ firebase deploy</span></pre><p id="61bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以在您的终端中运行下面的<a class="ae ky" href="https://github.com/curl/curl" rel="noopener ugc nofollow" target="_blank"> curl </a>命令来尝试一下:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="4070" class="nc lx it mx b gy nd ne l nf ng"><em class="mt">$ curl </em>-i -H "Accept: application/json" -X GET  https://us-central1-your-cool-app.cloudfunctions.net/takeScreenshot</span></pre><p id="a946" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mt">用您的应用程序/功能URL替换</em> <code class="fe mu mv mw mx b"><a class="ae ky" href="https://us-central1-your-app.cloundfuntions.net" rel="noopener ugc nofollow" target="_blank"><em class="mt">https://us-central1-your-cool-app.cloundfuntions.net</em></a></code> <em class="mt">。</em></p><h1 id="e94b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">蛋糕上的樱桃🍒🎂</h1><p id="a3cd" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们的项目是开源的，我们试图鼓励其他人也这样做，这就是为什么我们在GNU Affero通用公共许可证下在monorepo中发布了这个特殊的功能。因此，如果你的项目很酷，请成为我们的客人并克隆<code class="fe mu mv mw mx b">https://github.com/deckgo/deckdeckgo/tree/master/cloud</code>。</p><p id="494e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到无限和更远的地方！</p><p id="af6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大卫</p></div></div>    
</body>
</html>