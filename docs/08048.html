<html>
<head>
<title>How To Create Review Apps on Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Heroku上创建评论应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-review-apps-on-heroku-799f548fcc5e?source=collection_archive---------9-----------------------#2021-03-18">https://betterprogramming.pub/how-to-create-review-apps-on-heroku-799f548fcc5e?source=collection_archive---------9-----------------------#2021-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="35de" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建和部署评审应用程序，以实现更好的代码评审</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2dc4384ae54963933920bb664c30e44c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5BNAnBXn4rl-SUBGzeL0MQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Heroku审查应用程序和AutoIdle演示应用程序。作者照片。</p></figure><p id="000a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">几乎每个软件公司都为他们代码的不同阶段使用不同的环境——本地、开发、试运行、评审和生产，等等。</p><p id="52e9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，当您进行最后一次抽查或对其运行测试套件时，您可以使用一个暂存环境来托管您将要部署到生产环境中的应用程序。或者您可以使用评审应用程序作为代码评审过程的一部分，这样评审人员就可以很容易地确认应用程序在处理包含在pull请求中的变更时工作正常。</p><p id="60f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">试运行和审查环境与生产环境的不同之处在于，它们是临时的非面向客户的环境，仅当它们处于活跃使用状态时才需要。例如，当开发人员准备将他们的代码合并到主分支中时，审查应用程序可能存在于拉请求的生命周期中。如果拉动请求持续三天未完成，审核应用程序将在同一时间段内运行，即使工程师在审核期间可能只使用审核应用程序几分钟。</p><p id="ff31" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">托管您的应用程序需要资金，让这些暂存和审查环境在不使用时运行就相当于把钱扔进了下水道。对于像Heroku这样的IaaS和PaaS提供商来说尤其如此，资源成本是按比例分配给第二个提供商的。如果这些资源的成本变得令人望而却步，资金紧张的公司甚至可能选择不使用评估应用程序，以试图节省一些资金。这很可能是任何给定的工程组织选择不使用评审应用作为他们代码评审过程的一部分的主要原因。</p><p id="87f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就引出了下面的问题:有没有一种方法可以让我们在使用点评应用的同时，确保我们不会为不需要的资源付费？</p><p id="25c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将看看如何配置一个Heroku项目来使用review apps。然后，我们将添加<a class="ae lu" href="https://autoidle.com/" rel="noopener ugc nofollow" target="_blank"> AutoIdle </a> Heroku附加组件来演示我们如何削减成本。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7bdc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建新的Heroku应用程序</h1><p id="53c3" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">首先，我们将克隆一个GitHub repo，安装它的依赖项，并在本地启动应用程序。你可以在GitHub 上找到<a class="ae lu" href="https://github.com/thawkin3/heroku-review-apps-and-autoidle" rel="noopener ugc nofollow" target="_blank">的样本回购。</a></p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="02cf" class="ne md it na b gy nf ng l nh ni">git clone https://github.com/thawkin3/heroku-review-apps-and-autoidle.git</span><span id="15fb" class="ne md it na b gy nj ng l nh ni">cd heroku-review-apps-and-autoidle</span><span id="4046" class="ne md it na b gy nj ng l nh ni">npm install</span><span id="f9a0" class="ne md it na b gy nj ng l nh ni">npm start</span></pre><p id="5250" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将通过登录Heroku CLI，创建应用程序，将其部署到Heroku，并在我们的浏览器中打开它，将此项目转换为Heroku应用程序。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6aac" class="ne md it na b gy nf ng l nh ni">heroku login</span><span id="8554" class="ne md it na b gy nj ng l nh ni">heroku create # or `heroku create &lt;app name here&gt;`</span><span id="93cb" class="ne md it na b gy nj ng l nh ni">git push heroku master</span><span id="8fcd" class="ne md it na b gy nj ng l nh ni">heroku open</span></pre><p id="0a57" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是目前为止这个应用程序的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/608d7bc62134d6fe9d90537995e7c601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bChn9kcuejnY-Pd9"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">演示应用程序初始内容</p></figure><p id="e6c6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以<a class="ae lu" href="https://review-apps-and-autoidle.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">在这里</a>查看Heroku上托管的应用。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="14d7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建Heroku管道</h1><p id="71da" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在我们有了Heroku应用程序，让我们<a class="ae lu" href="https://devcenter.heroku.com/articles/pipelines" rel="noopener ugc nofollow" target="_blank">创建一个Heroku管道</a>。在我们的Heroku仪表板中，我们可以单击“New”按钮，然后从下拉菜单中选择“Create new pipeline”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/c23cb9272440e3978928cddf13ccce8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mv2dNpR52AF5TIFr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Heroku建立新的管道</p></figure><p id="1aa8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将为管道命名，将其连接到GitHub repo，然后单击“创建新管道”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/8bb9e5c1aa24c0a9f1bfb77bd8b4760c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qVXxefxiHU6pkmY-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Heroku配置我们的管道</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="db26" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为我们的渠道启用审核应用</h1><p id="2245" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">随着我们的管道到位，我们现在准备好<a class="ae lu" href="https://devcenter.heroku.com/articles/github-integration-review-apps" rel="noopener ugc nofollow" target="_blank">为它启用审核应用</a>。我们只需点击“启用审核应用”按钮即可开始。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3ffd66868b44e3713c027700042fd825.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SwNEeoPtiJaC22dK"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为我们的渠道启用审核应用</p></figure><p id="7602" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将看到一个屏幕，允许我们配置审核应用程序设置。让我们选择在GitHub repo上为每个新的pull请求自动创建新的审核应用程序。让我们也选择自动销毁任何打开超过五天的评论应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/732c180c7a6ec9c72fdd2b5fe0c16052.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k60XxGpGX-AlZwpJ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查看应用程序配置设置</p></figure><p id="38ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成审核应用程序设置的配置后，我们将点击屏幕底部的“启用审核应用程序”按钮来完成设置。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="57f7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建我们的第一个拉动式请求和审查应用程序</h1><p id="39cf" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">是时候提出我们的第一个拉动请求了。让我们创建一个新的分支，向我们的<code class="fe nn no np na b">index.html</code>文件添加更多的内容，提交更改，并推送到我们的分支。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="274e" class="ne md it na b gy nf ng l nh ni">git checkout -b feature/steps</span><span id="6245" class="ne md it na b gy nj ng l nh ni"><em class="nq"># make changes to the `index.html` file</em></span><span id="b20a" class="ne md it na b gy nj ng l nh ni">git add .</span><span id="e205" class="ne md it na b gy nj ng l nh ni">git commit -m "feat: adds steps for creating a review app"</span><span id="4fc7" class="ne md it na b gy nj ng l nh ni">git push --set-upstream origin feature/steps</span></pre><p id="a284" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们可以导航到GitHub repo来创建一个pull请求，将我们的功能分支合并到主分支中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bc227a5217939e532f3a1c16e5e41d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3-o7CgK1y-C3VbiU"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在GitHub中创建拉请求</p></figure><p id="b4a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">填写完pull请求后，我们将看到一条注释，显示一个新的review app部署正在等待。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/08367d4307917b5e6078aea42986c92f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V1DV0Y0yIusqZtmW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub pull请求中显示的待审核应用程序部署</p></figure><p id="4735" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">多刺激啊！如果我们导航到我们的Heroku pipeline仪表板，我们可以看到成功部署后产生的审核应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/004eac718dd999699fee4d67d9a22144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mGG8IFeoinDEppQd"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Heroku点评app创建成功！</p></figure><p id="c2e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以使用“打开应用程序”按钮从Heroku pipeline页面打开review应用程序，或者我们可以在GitHub中导航回我们的pull请求，找到“查看部署”按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/341092d7deee736400b084f3dd3e1d4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pTVoCZvJixri1UfY"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub中的“查看部署”按钮可查看查看应用程序</p></figure><p id="7c7c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">单击任一按钮都会将我们带到包含新更改预览的审核应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a8fb2852dfefa1a5e73a2a3395ae1ac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JLwdimU2lfeLuqiG"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Heroku review应用程序显示我们未完成的拉动式请求的更改</p></figure><p id="8cb6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在确保我们的应用程序看起来不错之后，我们可以合并拉请求。合并代码导致review应用程序被销毁，现在只剩下我们的常规生产应用程序。</p><p id="e39c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点评app是个很奇妙的东西！</p><p id="c885" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在将我们的代码合并到主分支之后，我们现在可以从终端使用<code class="fe nn no np na b">git push heroku master</code>命令将这些代码发布到产品中。或者，对于一个更现实的场景，我们可能将我们的代码提升到一个阶段环境中，或者在合并后自动将代码部署到生产环境中。但是，出于本文的目的，我们不会考虑这些工作流设置。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7be8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">进退两难</h1><p id="2008" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在，当谈到成本时，记住几件事很重要。首先，审核应用保持活动状态，直到“拉”请求被合并或关闭，或者我们在审核应用设置中指定的最大时间段过去(您应该还记得，我们将审核应用配置为五天后自动销毁)。此外，你需要为评论应用付费，就像任何其他Heroku资源一样——按秒按比例计算。</p><p id="a79b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">想象一下，一个开发人员在一个星期五的下午创建了一个拉请求。这启动了新的审核应用程序部署。然后每个人都回家过周末，而孤独的评论应用程序却闲置不用。周一，另一个开发人员看到拉请求，审查代码，手动测试审查应用程序，批准拉请求，然后合并它。</p><p id="3be0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，review应用程序在整个周末都处于活动状态，这意味着您需要为它使用的资源付费，尽管在那段时间里并不真正需要review应用程序。实际上，在代码评审期间，评审应用程序只在短短几分钟内是必要的。</p><p id="ebb7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果这听起来很糟糕，想象一下这个场景乘以数百个回购和数百个开发者。根据公司的规模，这些成本会很快增加！</p><p id="65fa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们可以在不使用评论应用程序时让它们休眠，那不是很好吗？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="68db" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">自动驾驶到救援</h1><p id="1e63" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated"><a class="ae lu" href="https://autoidle.com/" rel="noopener ugc nofollow" target="_blank"> AutoIdle </a>是一个Heroku插件，它可以在30分钟不活动后自动将你的staging和review应用程序置于睡眠状态。当最终收到HTTP请求时，AutoIdle会重新激活该应用程序。这非常适合那些不需要一直保持活跃的临时应用。</p><p id="b1ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，生产应用程序确实需要在任何给定的时间可用，所以AutoIdle不应该用于您的生产环境！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1d3a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">安装AutoIdle</h1><p id="8923" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们可以通过在终端中运行以下命令将AutoIdle添加到我们的应用程序中:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="90c6" class="ne md it na b gy nf ng l nh ni">heroku addons:create autoidle</span></pre><p id="d8a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有…就是这样！没有更多的步骤。AutoIdle现在已经安装好了，可以帮你省钱了。</p><p id="d438" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，需要注意的是，上面的命令将AutoIdle添加到您的实际应用程序中，而不是您的审核应用程序。所以如果这个app是面向客户的生产app，就不要在这里添加AutoIdle！不过，这个命令非常适合将AutoIdle添加到staging应用程序或其他非面向客户的应用程序中，这些应用程序在不活动时可以休眠。</p><p id="d361" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您需要删除AutoIdle插件，您可以随时使用以下命令:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="db10" class="ne md it na b gy nf ng l nh ni">heroku addons:destroy autoidle</span></pre><p id="adf6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为在我们的例子中，我们只想将AutoIdle添加到我们的审查应用程序中，所以我们将在repo的根级别的<code class="fe nn no np na b">app.json</code>文件中指定我们的附加组件。下面的JSON片段指定，对于我们的<code class="fe nn no np na b">“review”</code>环境，我们想要使用<code class="fe nn no np na b">“autoidle:hobby”</code>附加组件。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8c19" class="ne md it na b gy nf ng l nh ni">"environments": {<br/>  "review": {<br/>    "addons": ["autoidle:hobby"]<br/>  }<br/>}</span></pre><p id="2f5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Heroku 上可以找到<a class="ae lu" href="https://elements.heroku.com/addons/autoidle" rel="noopener ugc nofollow" target="_blank"> AutoIdle计划类型的完整列表。</a></p><p id="7e86" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们已经为我们的审核应用程序配置了AutoIdle，让我们像以前一样创建另一个拉请求。一旦我们创建了拉动请求，我们的审核应用程序将自动部署。</p><p id="ab00" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们可以通过在终端中运行以下命令来查看AutoIdle仪表板:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5e4f" class="ne md it na b gy nf ng l nh ni">heroku addons:open autoidle</span></pre><p id="9fde" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们的仪表板最初看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9dd9963db2f2bfa356fc2e2c024e8597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qti7JqIcTgHgeGs6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在为我们的点评应用配置AutoIdle几分钟后，AutoIdle仪表盘就出现了</p></figure><p id="74dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们的点评应用刚刚创建，因此目前正在运行。让我们等待至少30分钟，不要与我们的评论应用程序交互，看看AutoIdle如何发挥它的魔力。</p><p id="00f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">30分钟后…我们的应用程序已被停止。不错！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1f65a6bbf90715cede94d0a143c4bf8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X47oAjEjXfS2k1RC"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AutoIdle已停止不活动的点评应用程序。</p></figure><p id="f009" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在让我们再等几个小时，这样我们就可以开始看到AutoIdle将为我们带来的节约。我在深夜创建了这个回顾应用程序，所以让我们来看看第二天早上我检查仪表板时它是什么样子的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/209a04c67e3ffbc48a323c2e2760b600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VP9av6d7EPlwvevk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用AutoIdle节省一些钱</p></figure><p id="28a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如你所看到的，我们的应用程序90%的时间都是停止的(它运行了一个小时，然后在一夜之间停止了九个小时)。我们目前估计每月节省4.30美元。但请记住，这只是针对一个我们使用不到一天的Hobby dyno review应用程序。</p><p id="471a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">想象一下，如果我们有100个评论应用。现在，我们预计每月可以节省430美元！很高兴知道当我们不使用我们的应用程序时，我们不会为所有这些停机时间付费！</p><p id="f6f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们现在试图在<code class="fe nn no np na b">herokuapp</code>域查看我们的点评应用，我们会看到一个错误屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/03cb879768fd46d3a0f75b235b71c0a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QG7ZYY7LVMazjBDW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尝试查看睡眠应用程序时出现应用程序错误</p></figure><p id="4924" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是因为我们的点评app还在休眠。在第一次请求后，应用程序通常需要大约5-10秒钟才能唤醒。这段时间过后，我们可以刷新屏幕，看到我们的应用程序再次正常工作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/646a215856dfe2c34fd878211a207de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ll16fsM_bSlYw9Ww"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的点评应用再次苏醒并活跃起来</p></figure><p id="5706" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">避免这个初始错误页面的一个方法是在我们的应用程序中使用<code class="fe nn no np na b">autoidleapp</code>域，而不是<code class="fe nn no np na b">herokuapp</code>域。在我们的例子中，我们可以访问<code class="fe nn no np na b">https://autoidle-dem-feature-re-zifkor.autoidleapp.com</code>，而不是访问<code class="fe nn no np na b">https://autoidle-dem-feature-re-zifkor.herokuapp.com</code>。这是同一个应用程序，但现在没有首页加载问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1dac2c07312cf0315d11e3b60c9fa972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CaeNpP6JIGR1flGj"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用autoidleapp.com域来避免睡眠应用的首页加载错误</p></figure><p id="eef9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">既然我们的审核应用程序再次激活，如果我们检查AutoIdle仪表板，我们会看到我们的审核应用程序不再休眠。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c618" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="7613" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">审查应用程序对于在拉式请求代码审查期间验证变更非常有用。但是让它们长时间运行会花费你很多钱。</p><p id="3743" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们的例子中，我们有一个应用程序和一个拉请求。我们还使用了一个较低层次的爱好动态。在我们的情况下，我们的成本会相对较低。但是想象一下在一家企业软件公司使用评论应用程序。数百名工程师、拉式请求和审查应用程序都使用大型dynos和额外的Heroku附加组件，成本真的会增加。</p><p id="e5c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过使用AutoIdle，你可以只在必要的时候保持你的应用程序运行，这将大大减少你的Heroku账单。</p></div></div>    
</body>
</html>