<html>
<head>
<title>10 Useful Swift String Extensions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">10个有用的Swift字符串扩展</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/10-useful-swift-string-extensions-e4280e55a554?source=collection_archive---------4-----------------------#2020-03-03">https://betterprogramming.pub/10-useful-swift-string-extensions-e4280e55a554?source=collection_archive---------4-----------------------#2020-03-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ec03" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">电子邮件验证、类型转换等等</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/09761fbb20b2f8af1041e7e387715d37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ze2Sv8fYvv0xI2XO"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@zanilic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Zan </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="efb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">string</code>是所有编程语言中最基本的数据类型之一。这是编码的一个基本部分，无论是对于一个控制台应用程序，web服务，基于GUI的应用程序，还是一个游戏。Swift有类<code class="fe lv lw lx ly b">String</code>，它处理大多数常见的文本操作——大部分但不是全部。</p><p id="e474" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我从2014年开始在Swift写代码，我几乎不记得有哪个项目没有<code class="fe lv lw lx ly b">String</code>扩展。这里我分享一下我用的最多的扩展。有些是我写的。其他的，我借用了不同的开放网络资源。所有的例子都适用于Swift 5，但其中大多数也兼容旧版本。</p><p id="a926" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lz">如果你也是Android开发者，你可能会对我的文章</em> <a class="ae ky" href="https://medium.com/better-programming/10-useful-kotlin-string-extensions-46772b653f71" rel="noopener"> <em class="lz"> 10个有用的Kotlin字符串扩展</em> </a> <em class="lz">感兴趣。</em></p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/8c5c71fc2ae9cd20aceb45d98996cac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qEX9Byoh_PjXrmpt"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="eecc" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">1.MD5哈希计算器</h1><p id="4a09" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">第一个有用的扩展是计算字符串的MD5散列。当您使用web服务或检查文件是否正确时，它会很有用。该扩展不使用任何外部依赖项，而是使用本机CommonCrypto框架，因此它需要一个桥接头。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MD5-桥接-标头. h</p></figure><p id="8472" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">扩展本身相当简单。我假设您希望MD5作为一个字符串(例如，将其作为一个参数传递给服务器)。如果需要获取数据，可以少走一步，直接返回hash变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">字符串+md5.swift</p></figure><p id="abb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想把它添加到一个外部框架中，在<code class="fe lv lw lx ly b">var</code>之前添加<code class="fe lv lw lx ly b">public</code>。</p><h2 id="ae88" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">如何使用它</h2><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="2982" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">guard</strong> <strong class="ly iu">let</strong> passwordMD5 = password.md5 <strong class="ly iu">else</strong> {<br/>    showError("Can't calculate MD5 of your password")<br/>    <strong class="ly iu">return<br/></strong>}</span></pre><p id="460b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于在本例中您不太可能得到<code class="fe lv lw lx ly b">nil</code>，这种用法也是有意义的:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="d549" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">let</strong> passwordMD5 = password.md5!</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/682feda71658af50ceabbeec840033a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*isl28qR6AjYk6PDY"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@lemonvlad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">弗拉季斯拉夫·克拉平</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="d011" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">2.本地化字符串</h1><p id="a57d" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">如果你开发一个多语言应用程序，你可能需要在代码中嵌入一些文本字符串，这些字符串将以用户语言显示在屏幕上。编辑故事板或XIB文件不需要任何编码，但动态字符串需要。</p><p id="f558" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原生方式是使用函数<code class="fe lv lw lx ly b">NSLocalizedString</code>。例如:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="06da" class="nh mj it ly b gy nx ny l nz oa">NSLocalizedString("string_id", comment: "")</span></pre><p id="2eda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它总是工作，通常不会产生任何问题，但它看起来有点丑。这个扩展是一种句法糖。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">String+localized.swift</p></figure><h2 id="e50f" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">如何使用它</h2><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="c57e" class="nh mj it ly b gy nx ny l nz oa">"string_id".localized</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/681b003aced005fa3d1c07aa1d77f43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aB_oL__q7BwwOhzr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@neryfabiola_?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Nery Montenegro </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="2f0d" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">3.整数下标</h1><p id="034c" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">在任何编程语言中，对字符串的典型操作都涉及到获取它的一部分——或者像程序员所说的，一个<em class="lz">片段。</em>可以是前几个字符，也可以是后几个字符，也可以是字符串中间的某个部分。</p><p id="8f69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对我来说，Swift中最令人惊讶的事情之一是获取子字符串(和数组切片——但那是另一个话题)总是有困难。你不能像在许多语言中那样只写一些类似于<code class="fe lv lw lx ly b">"Hello, world"[0...4]</code>的东西。但是会很舒服，对吧？</p><p id="cd1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么我们想要什么？</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="7207" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">let</strong> str = "Hello, world"<br/>print(str[...4]) // "Hello"<br/>print(str[..&lt;5]) // "Hello"<br/>print(str[7...]) // "world"<br/>print(str[3...4] + str[2]) // "lol"</span></pre><p id="8eb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码看起来简单易懂。但是如果你试图编译它，你会得到几个错误:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="f733" class="nh mj it ly b gy nx ny l nz oa">'subscript(_:)' is unavailable: cannot subscript String with an integer range, see the documentation comment for discussion</span></pre><p id="9861" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">传统上，它有一个解决方案，我们的解决方案是一个<code class="fe lv lw lx ly b">String</code>类扩展。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="46c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它的工作方式几乎和上面的例子完全一样，除了它需要一些类型转换。自然，子字符串返回的是<code class="fe lv lw lx ly b">Substring</code>的实例，而不是<code class="fe lv lw lx ly b">String</code>。当你索引一个字符时，它返回一个<code class="fe lv lw lx ly b">Character</code>的实例。两个都可以投<code class="fe lv lw lx ly b">String</code>:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="a852" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">let</strong> str = "Hello, world"<br/><strong class="ly iu">let</strong> strHello = String(str[...4])<br/><strong class="ly iu">let</strong> strWorld = String(str[7...])</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/ed60a3bcc9dc5a5d77f9192cfa899c44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eMP8T9KfV-dP_AvP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Mick Haupt 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="0345" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">4.检查里面有什么</h1><p id="aecd" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">很多时候我需要检查一个<code class="fe lv lw lx ly b">String</code>是否只有数字。或者只有数字。例如，用户名通常只包含数字和字母，但密码应该包含更多的字符类型。名或姓只包含字母。</p><p id="69ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将输入数据提交给服务器之前，几个助手函数(包装在扩展中)对于输入数据的验证非常有帮助。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="7e90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该文件包含三种常见的扩展名，但是您可以根据自己的需求为其他字符集编写类似的扩展名。一般规则是获得一个包含所有允许字符的字符集(或几个字符集的联合)。然后反转这个字符集，并检查字符串是否包含其中的任何符号。</p><h2 id="3471" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">如何使用它</h2><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="7426" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">let</strong> a1 = "12345".containsOnlyDigits // true<br/><strong class="ly iu">let</strong> a2 = "a12345".containsOnlyDigits // false<br/><strong class="ly iu">let</strong> b1 = "abcde".containsOnlyLetters // true<br/><strong class="ly iu">let</strong> b2 = "abcde1".containsOnlyLetters // false<br/><strong class="ly iu">let</strong> c1 = "abcde12345".isAlphanumeric // true<br/><strong class="ly iu">let</strong> c2 = "abcde.12345".isAlphanumeric // false</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e5fee5d47b46b341b0cc2ade0bc63f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eJKE6SkUWZiTWz0v"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@konkarampelas?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kon Karampelas </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="a56c" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">5.检查字符串是否是有效的电子邮件地址</h1><p id="00d6" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">谈到输入数据验证，我们不能避免检查电子邮件地址。大多数应用程序要求用户提供电子邮件地址，以进行身份验证、订阅、发送收据和许多其他目的。</p><p id="03f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在网上找到了很多解决方法。它们背后的思想都是一样的:我们创建一个正则表达式，并计算包含(或不包含)电子邮件地址的字符串。区别在于正则表达式本身。</p><p id="16f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">电子邮件地址总是包含两个部分:<code class="fe lv lw lx ly b">left@right</code>，其中<em class="lz">左边的</em>是您的标识符(例如名称)，而<em class="lz">右边的</em>是完整的域名。哪个域名是允许的是一个选择的问题。例如，不清楚是否允许使用像<code class="fe lv lw lx ly b">user@localhost</code>这样的电子邮件。对于大多数用例来说，它不是，但是如果您编写一个供本地使用的控制台应用程序，它可以是一个有效的地址。</p><p id="f511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种解决方案适用于大多数情况:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="6900" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">备选版本(<em class="lz">建议由</em> <a class="oc od ep" href="https://medium.com/u/398b5cc9e4a3?source=post_page-----e4280e55a554--------------------------------" rel="noopener" target="_blank"> <em class="lz"> Tromgy </em> </a>):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="f6f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个解决方案的优点是它简化了正则表达式的工作。两个选项都有效。</p><h2 id="1f2d" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">如何使用它</h2><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="946b" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">let</strong> approved = "test@test.com".isValidEmail // true<br/><strong class="ly iu">let</strong> rejected = "12345".isValidEmail // false</span></pre><p id="8632" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">电话号码也可以用同样的方式验证，但是它需要一个外部库——例如，<a class="ae ky" href="https://github.com/marmelroy/PhoneNumberKit" rel="noopener ugc nofollow" target="_blank">this</a>。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/e1e5b32cf09fa1fe2eb05316d29f3ae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rbDFQEIOfwKgDC7-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@rimakruciene?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">里玛·克鲁西内</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="28d9" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">6.存储和检索本地设置</h1><p id="154e" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我们经常需要在不创建文件的情况下存储一些数据——例如，用户名或用户ID。保存和加载数据的典型方式是通过<code class="fe lv lw lx ly b">UserDefaults</code>类，以前是<code class="fe lv lw lx ly b">NSUserDefaults</code>。</p><p id="90e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要知道的是:</p><ul class=""><li id="8d9d" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu ok ol om on bi translated">当应用程序重新启动时，存储在<code class="fe lv lw lx ly b">UserDefaults</code>中的数据会持续存在</li><li id="f0e6" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">卸载应用会清除<code class="fe lv lw lx ly b">UserDefaults</code></li><li id="973e" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">你可以在任何时候从任何线程中从<code class="fe lv lw lx ly b">UserDefaults</code>读取数据</li><li id="cb32" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated">将数据保存到<code class="fe lv lw lx ly b">UserDefaults</code>后，要调用<code class="fe lv lw lx ly b">synchronize()</code>(仅限iOS 11及更早版本)</li></ul><p id="38de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">UserDefaults</code>的典型用法:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="2476" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">let</strong> value: String? = UserDefaults.standard.string(forKey: "key")</span></pre><p id="008c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果键<code class="fe lv lw lx ly b">key</code>有值，你得到它；如果没有，你得到<code class="fe lv lw lx ly b">nil</code>。</p><p id="5fd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">储蓄稍微复杂一点:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="e980" class="nh mj it ly b gy nx ny l nz oa">UserDefaults.standard.set("value", forKey: "key")<br/>UserDefaults.standard.synchronize() // iOS 11 and earlier</span></pre><p id="23ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和清除:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="8b77" class="nh mj it ly b gy nx ny l nz oa">UserDefaults.standard.removeObject(forKey: "key")<br/>UserDefaults.standard.synchronize() // iOS 11 and earlier</span></pre><p id="6b01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用Swift extensions简化流程。这些扩展有两个目标:</p><ol class=""><li id="23bc" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu ot ol om on bi translated">它应该缩短代码，使其更加清晰</li><li id="714f" class="of og it lb b lc oo lf op li oq lm or lq os lu ot ol om on bi translated">如果值没有保存，它应该返回<code class="fe lv lw lx ly b">null</code></li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="e2ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">UserDefaults</code>支持几种类型，但是任何可序列化的类型都可以类似地扩展。</p><h2 id="5040" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">如何使用它</h2><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="a4b9" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">let</strong> age = 25<br/>age.store(key: "age")<br/>print(Int(key: "age")) // Optional(25)<br/>print(Float(key: "age")) // Optional(25.0)<br/>print(String(key: "age")) // Optional("25")<br/>print(String(key: "age1")) // nil</span><span id="20c2" class="nh mj it ly b gy ou ny l nz oa"><strong class="ly iu">let</strong> dict: [String: Any] = [<br/>  "name": "John",<br/>  "surname": "Doe",<br/>  "occupation": "Swift developer",<br/>  "experienceYears": 5,<br/>  "age": 32<br/>]</span><span id="9953" class="nh mj it ly b gy ou ny l nz oa">dict.store(key: "employee")<br/>print(Dictionary(key: "employee"))<br/>// Optional(["name": John, "occupation": Swift developer, "age": 32, "experienceYears": 5, "surname": Doe])</span></pre><p id="ba95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，如果有必要，它会自动转换类型。</p><p id="109c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我必须指出这些扩展有一个缺点。它们在你每次调用<code class="fe lv lw lx ly b">store</code>时保存更改，这将对磁盘或闪存进行不必要的写入。另一方面，您永远不会忘记同步更改。是否使用这些扩展取决于您。</p><h2 id="5f94" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">注意</h2><p id="1031" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated"><code class="fe lv lw lx ly b">UserDefaults.standard.synchronize()</code>是iOS 12以来也没有要求过的<em class="lz">(注由</em> <a class="oc od ep" href="https://medium.com/u/2851eb8b7dc0?source=post_page-----e4280e55a554--------------------------------" rel="noopener" target="_blank"> <em class="lz">大卫这样的</em> </a> <em class="lz">)。</em></p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/6dd83fa41b04b87465a5bad77caa50c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CJRowYjC-OMaD0B0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="f597" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">7.从字符串解析JSON</h1><p id="cd33" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">JavaScript对象符号(JSON)格式变得如此流行，以至于没有多少Swift应用程序避免使用它。即使你不直接做，一些框架也是在幕后做的。</p><p id="493c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JSON源码只不过是一个字符串。所以我们可以编写一个<code class="fe lv lw lx ly b">String</code>类的扩展来解析它，并把它变成一个<code class="fe lv lw lx ly b">[String: Any]</code>类型的字典。</p><p id="4f4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Swift有一个用于JSON解析的标准类— <code class="fe lv lw lx ly b">JSONSerialization</code>。它用的是<code class="fe lv lw lx ly b">Data</code>，不是<code class="fe lv lw lx ly b">String</code>。这就是为什么我们将创建两个扩展:<code class="fe lv lw lx ly b">Data</code>和<code class="fe lv lw lx ly b">String</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="53ee" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">如何使用它</h2><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="6092" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">let</strong> dict: [String: Any] = [<br/>  "name": "John",<br/>  "surname": "Doe",<br/>  "age": 31<br/>]<br/>print(dict)<br/>// ["surname": "Doe", "name": "John", "age": 31]</span><span id="a9f8" class="nh mj it ly b gy ou ny l nz oa"><strong class="ly iu">let</strong> json = String(json: dict)<br/>print(json)<br/><strong class="ly iu">// </strong>Optional("{\"surname\":\"Doe\",\"name\":\"John\",\"age\":31}")</span><span id="2592" class="nh mj it ly b gy ou ny l nz oa"><strong class="ly iu">let</strong> restoredDict = json?.jsonToDictionary()<br/>print(restoredDict)<br/><strong class="ly iu">// </strong>Optional(["name": John, "surname": Doe, "age": 31])</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/5382e4cf2d5978593d3eab45d89c5775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j7sn2zBK0Wv3A8zj"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">苏珊·d·威廉姆斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="6f88" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">8.转换策略</h1><p id="90de" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">Swift转换本身相当容易，但有时以扩展的形式呈现会更方便。比如从Kotlin (Android到iOS)转换代码，可能会看到类似<code class="fe lv lw lx ly b">toIntOrNull()</code>的功能。让我们用Swift写它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="df59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的逻辑很简单。该扩展非常短，但如果您需要将大量Android代码转换到iOS，它会非常有用。同样，你可以添加类似于<code class="fe lv lw lx ly b">toDouble()</code>、<code class="fe lv lw lx ly b">toString()</code>等扩展名。</p><h2 id="ec4d" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">如何使用它</h2><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="243a" class="nh mj it ly b gy nx ny l nz oa">print("10".toInt())<br/>// 10</span><span id="ab92" class="nh mj it ly b gy ou ny l nz oa">print("15".toIntOrNull())<br/>// Optional(15)</span><span id="3551" class="nh mj it ly b gy ou ny l nz oa">print("5.5".toInt())<br/>// CRASH!</span><span id="72c7" class="nh mj it ly b gy ou ny l nz oa">print("5a".toInt())<br/>// CRASH!</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/4b12a1ac8776bc019d5e7d8c514b7fcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MDDyKE0pSJn20H31"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">罗伯特·卡茨基在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="6db5" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">9.字符串中的颜色</h1><p id="442a" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">Swift没有一个漂亮的方法把十六进制代码的字符串变成一种颜色，所以显然我们用扩展来做。</p><p id="fca9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，颜色在iOS和Mac中的表现方式不同。<code class="fe lv lw lx ly b">UIKit</code>提供<code class="fe lv lw lx ly b">UIColor</code>级，<code class="fe lv lw lx ly b">Cocoa</code>有几乎相同的<code class="fe lv lw lx ly b">NSColor</code>。为了使代码通用，我们将引入一个别名<code class="fe lv lw lx ly b">UniColor</code>。</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="38d6" class="nh mj it ly b gy nx ny l nz oa">#if os(iOS) || os(tvOS)<br/><strong class="ly iu">import</strong> UIKit<br/><strong class="ly iu">typealias</strong> UniColor = UIColor<br/>#else<br/><strong class="ly iu">import</strong> Cocoa<br/><strong class="ly iu">typealias</strong> UniColor = NSColor<br/>#endif</span></pre><p id="a2bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有工作都将在<code class="fe lv lw lx ly b">UniColor</code>扩展内完成。<code class="fe lv lw lx ly b">String</code>扩展会调用它。标签(#)符号是可选的。颜色可以用三个或六个符号来表示，例如，<code class="fe lv lw lx ly b">#ff0000</code>、<code class="fe lv lw lx ly b">#f00</code>、<code class="fe lv lw lx ly b">ff0000</code>和<code class="fe lv lw lx ly b">f00</code>是相同的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="a886" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">如何使用它</h2><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="2b16" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">let</strong> strColor = "#ff0000" // Red color<br/><strong class="ly iu">let</strong> color = strColor.toColor()<br/><strong class="ly iu">var</strong> red: CGFloat = 0.0<br/><strong class="ly iu">var</strong> green: CGFloat = 0.0<br/><strong class="ly iu">var</strong> blue: CGFloat = 0.0<br/><strong class="ly iu">var</strong> alpha: CGFloat = 0.0<br/>color?.getRed(&amp;red, green: &amp;green, blue: &amp;blue, alpha: &amp;alpha)</span><span id="8ff9" class="nh mj it ly b gy ou ny l nz oa">print(red, green, blue, alpha)<br/>// 1.0 0.0 0.0 1.0</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c940798b25e96f63b0790c2d6c706f92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zcgGrnq2_vi2KMRd"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼克·希利尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="cf62" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">10.将字符分成组</h1><p id="7fcf" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">目前最后一个扩展有助于格式化银行卡号和其他需要分组的数据。它也可以用来对大数字进行分组，但是它有一个特殊的类。其他可能的用途是将固定宽度的电子表格转换成逗号分隔的电子表格、游戏机游戏以及许多其他应用。</p><p id="3644" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种扩展的思想是在原始字符串的每个<em class="lz"> n </em>字符后插入一些字符或字符串。比如我们得到了卡号<code class="fe lv lw lx ly b">1234567890123456</code>，通常要显示为<code class="fe lv lw lx ly b">1234 5678 9012 3456</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="87ff" class="nh mj it bd mk ni nj dn mo nk nl dp ms li nm nn mu lm no np mw lq nq nr my ns bi translated">如何使用它</h2><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="d44f" class="nh mj it ly b gy nx ny l nz oa"><strong class="ly iu">var</strong> cardNumber = "1234567890123456"<br/>cardNumber.insert(separator: " ", every: 4)<br/>print(cardNumber)<br/>// 1234 5678 9012 3456</span><span id="a71c" class="nh mj it ly b gy ou ny l nz oa"><strong class="ly iu">let</strong> pin = "7690"<br/><strong class="ly iu">let</strong> pinWithDashes = pin.inserting(separator: "-", every: 1)<br/>print(pinWithDashes)<br/>// 7-6-9-0</span></pre></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="753e" class="mi mj it bd mk ml ox mn mo mp oy mr ms jz oz ka mu kc pa kd mw kf pb kg my mz bi translated">结论</h1><p id="8c5c" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我希望这些扩展能节省您的时间，并帮助您使代码更短更好。</p><p id="bd4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下次见。编码快乐！</p></div></div>    
</body>
</html>