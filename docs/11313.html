<html>
<head>
<title>Accessing Java Classes in Python Using Pyjnius</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pyjnius访问Python中的Java类</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/accessing-java-classes-in-python-using-pyjnius-6122bcaad49a?source=collection_archive---------8-----------------------#2022-03-08">https://betterprogramming.pub/accessing-java-classes-in-python-using-pyjnius-6122bcaad49a?source=collection_archive---------8-----------------------#2022-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a909" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">建立一个强大的Python到Java的桥</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6d0adff789e036489429ee667b0058a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OK1HqkWmrrCAHHJD"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@altumcode" rel="noopener ugc nofollow" target="_blank"> AltumCode </a>拍照。</p></figure><h1 id="31be" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">什么是桥接？</h1><p id="9f13" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">桥接意味着在不同的运行时环境中使用一个运行时环境的行为和数据类型。</p><p id="69c9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">换句话说，就是在不同的语言(比如Python)中使用最初用一种语言(比如Java)编写的类、方法、函数和数据字段。</p><p id="3ae5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在我们的例子中，我们将用Java创建一个简单的代码，然后我们将编写一个Python程序，在运行时使用Java代码。</p><h1 id="c033" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">为什么？</h1><p id="d93a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">理想情况下，我们希望所有的东西都只使用一种编程语言，但是ideal并不总是可用的。</p><p id="d4be" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">很多时候，我们可能会为一个不是用我们选择的语言编写的问题找到一个很好的解决方案。</p><p id="a5a0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">一个解决方案是部署一个服务器，用API调用来“服务”这些实现。</p><p id="0053" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但是维护一台服务器可能成本很高。</p><p id="898a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这不仅需要开发服务器端应用程序并公开所需的行为和API，还需要托管和部署服务器，这是有成本的。</p><p id="e46c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，如果所需的行为拥有某种内部状态，那么服务器现在必须为每个特定的消费者维护该状态。这可能是极其错误和不稳定的。</p><p id="a152" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">因此，在某些情况下，在本地桥接这些行为会是一个更好的选择。</p><h1 id="6472" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">从简单开始</h1><p id="b7b5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">下面是一个简单的Java应用程序:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="99a9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这个类有两个方法:一个是计算一组数字的简单平均值，另一个是有状态方法。</p><p id="31b2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">状态是每次调用<code class="fe mr ms mt mu b">calculateFactoredMean</code>时递增的因子，平均值乘以因子。</p><p id="dcca" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">因此，典型的主应用程序如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="64c7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">很直白。main方法实例化<code class="fe mr ms mt mu b">Calculator</code>类，初始因子为1，步长增量为2，然后调用<code class="fe mr ms mt mu b">calculateFactoredMean</code>三次。</p><p id="446b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">该应用程序的输出将是:</p><pre class="kg kh ki kj gt mv mu mw mx aw my bi"><span id="4fab" class="mz kx iq mu b gy na nb l nc nd">Mean of list is: 5.50<br/>Mean of list is: 16.50<br/>Mean of list is: 27.50</span></pre><p id="81d3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，让我们将这段代码应用到Python应用程序中。</p><h1 id="684c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍pyjnius</h1><p id="f00f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><code class="fe mr ms mt mu b"><a class="ae kv" href="https://pyjnius.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">Pyjnius</a></code>基于Java原生接口和反射将Java类提供给Python运行时。</p><h2 id="c37b" class="mz kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">先决条件</h2><ul class=""><li id="513c" class="np nq iq lq b lr ls lu lv lx nr mb ns mf nt mj nu nv nw nx bi translated">您必须安装Java。在我的例子中，我使用的是openJDK 11。</li><li id="9e92" class="np nq iq lq b lr ny lu nz lx oa mb ob mf oc mj nu nv nw nx bi translated">您还需要安装Javac(例如，<code class="fe mr ms mt mu b">apt-get install openjdk-11-jdk-headless</code>)。</li></ul><h2 id="33dd" class="mz kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">安装pyjinus</h2><pre class="kg kh ki kj gt mv mu mw mx aw my bi"><span id="1035" class="mz kx iq mu b gy na nb l nc nd">pip install pyjnius==1.4.1</span></pre><h2 id="eeec" class="mz kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">你好世界</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="9384" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这段代码生成一个对Java <code class="fe mr ms mt mu b">System </code>类的引用，然后使用输入“Hello world”调用<code class="fe mr ms mt mu b">out.println</code>静态方法。</p><p id="bdf9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们使用以下命令来运行它:</p><pre class="kg kh ki kj gt mv mu mw mx aw my bi"><span id="76ab" class="mz kx iq mu b gy na nb l nc nd">python simple.py</span></pre><p id="4840" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">以下是输出结果:</p><pre class="kg kh ki kj gt mv mu mw mx aw my bi"><span id="e3a1" class="mz kx iq mu b gy na nb l nc nd">Hello world</span></pre><p id="4008" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">酷毙了。</p><h2 id="6400" class="mz kx iq bd ky ne nf dn lc ng nh dp lg lx ni nj li mb nk nl lk mf nm nn lm no bi translated">盛装图书馆</h2><p id="5039" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了使用我们定制的库，我们首先需要将Java代码编译成一个Jar文件。</p><p id="1aa1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">使用maven很容易做到这一点，可以使用以下命令安装maven:</p><pre class="kg kh ki kj gt mv mu mw mx aw my bi"><span id="d23f" class="mz kx iq mu b gy na nb l nc nd">mvn clean install</span></pre><p id="d550" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Jar将位于<code class="fe mr ms mt mu b">target</code>目录中。</p><p id="6b48" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，在我们的Python代码中，我们应该将jar文件添加到Java类路径中，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="2c81" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">首先，我们推断jar文件在哪里，然后使用<code class="fe mr ms mt mu b">jnius_config.set_classpath</code>将它添加到Java类路径中。</p><p id="80ba" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，我们的main部分做了与Java中的main方法完全相同的事情。</p><p id="f456" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">它实例化了一个从1到10的整数列表。</p><p id="0ea1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">注意:</strong>这是一个Java列表；Java类不能接受Python数据类型！</p><p id="13a4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后它得到一个对<code class="fe mr ms mt mu b">Calculator</code>类的引用，然后用它实例化一个对象。记住，Python中的类也是对象！</p><p id="c3e3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后它使用了<code class="fe mr ms mt mu b">calculateFactoredMean</code>行为，三次调用列表中的方法。</p><p id="575b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们使用以下命令来运行它:</p><pre class="kg kh ki kj gt mv mu mw mx aw my bi"><span id="eaf8" class="mz kx iq mu b gy na nb l nc nd">python some-python-app</span></pre><p id="e272" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">以下是输出结果:</p><pre class="kg kh ki kj gt mv mu mw mx aw my bi"><span id="8095" class="mz kx iq mu b gy na nb l nc nd">Mean of list is: 5.5<br/>Mean of list is: 16.5<br/>Mean of list is: 27.5</span></pre><p id="310c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">厉害！</p><h1 id="6411" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">桥接的注意事项</h1><p id="f469" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">语言之间的桥接可能涉及进程间的通信，这对于某些应用程序来说是很昂贵的。</p><p id="ee7a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">它要求对母语和桥接语言都有很好的了解。</p><p id="68c3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">建立项目可能会很困难，对进入设置障碍，用桥运行应用程序可能会增加依赖性，这可能会使它难以执行。</p></div></div>    
</body>
</html>