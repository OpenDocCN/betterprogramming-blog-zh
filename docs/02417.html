<html>
<head>
<title>Adding Haptics to Your App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向您的应用程序添加触觉</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/adding-haptics-to-your-app-57439c358e8e?source=collection_archive---------14-----------------------#2019-11-28">https://betterprogramming.pub/adding-haptics-to-your-app-57439c358e8e?source=collection_archive---------14-----------------------#2019-11-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b69d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过触觉反馈增强用户体验</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/17f59c77469606ba6be9e2c3e22baff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f8WGLVa3FfYH7T02kNpOyg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@frankvex?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">弗兰克·维克斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/touch?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="bf2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">iOS 13的一个更微妙但令人惊讶的有趣和强大的框架是<code class="fe lv lw lx ly b">CoreHaptics</code>。有了这个框架，你可以给你的应用添加触觉反馈。</p><p id="5beb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当正确实施时，这种反馈会让你的用户感到高兴和惊讶。它会让你的应用程序感觉活灵活现——就像它对用户的触摸输入做出物理响应一样。</p><p id="f392" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想看看触觉反馈在真实应用中的感觉，请查看CocoaHub应用。当你在应用程序中切换标签时，它会使用触觉反馈，在我看来，这感觉真的很好。</p><p id="249a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，您将了解以下内容:</p><p id="04d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">-了解不同类型的触觉反馈<br/> -将触觉反馈添加到您的应用<br/> -使用AHAP文件定义您的触觉</p><p id="0194" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到本文结束时，您应该能够将漂亮、优雅的触觉体验添加到您的应用程序中，让您的用户感到自然和兴奋。</p><p id="3e16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为，当正确实施时，触觉真的可以将任何触摸带到下一个水平。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="9a0c" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">理解不同类型的触觉反馈</h1><p id="9271" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">自从iPhone 6S以来，我们已经能够为应用程序添加触觉。触觉反馈被认为是当有事发生时，你从手机上得到的微小的轻推或轻拍。这几乎就像一个非常短的振动，除了它似乎有多一点点的力量。</p><p id="8a19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在iPhone 6S和更高版本中发现的相同类型的技术可以在Apple Watch和Apple的trackpads中找到。如果你有一台MacBook Pro，你点击触控板，实际上没有点击。这是触觉引擎给你触觉反馈。</p><p id="375a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">iOS 12和MacBook触控板上的触觉功能相当有限，你无法用它们做什么。在iOS 13中，苹果对我们拥有的触觉功能进行了巨大的改变。</p><p id="907e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们几乎可以通过触觉让用户感受到声音，而不是非常简单的触觉，它不能表达比点击感觉更多的东西。这都是通过<code class="fe lv lw lx ly b">CoreHaptics</code>框架实现的。</p><p id="4b32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个框架中，我们有两种关键类型的触觉反馈:连续的和瞬时的。瞬时触觉反馈类似于点击或轻推，通常在你点击按钮时使用，当你需要用户的注意时，或者如果你想用一些漂亮的触觉反馈来丰富两个物体碰撞的视觉体验时使用。</p><p id="e79d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这种触觉反馈，您可以配置其强度，以指定点击的强度和清晰度。对于用户来说，尖锐的触觉会感觉更紧急，而不太尖锐的触觉会感觉非常平静。如果这听起来抽象或奇怪，我建议您在使用触觉学一点之后再回到这一节。你会意识到<em class="nd">尖锐</em>和<em class="nd">强烈</em>实际上是描述某种触觉反馈感觉的非常巧妙的方式。</p><p id="eddb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">连续的触觉反馈更像是一种振动模式。它仍然有典型的触觉点击感觉——除了有许多快速连续的感觉。对于连续事件，您可以为瞬时反馈指定完全相同的可用参数，但您也可以设定事件的持续时间，以确定触觉反馈应该持续多长时间。</p><p id="b3ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还可以定义触觉事件的某些特征应该如何随时间变化。例如，要创建一个增加然后减少的连续触觉，您可以定义一个单一的触觉事件，并应用动态参数或参数曲线，使触觉随时间淡入淡出。我将在下一节展示动态参数和参数曲线的例子。</p><p id="d0ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了触觉反馈，<code class="fe lv lw lx ly b">CoreHaptics</code>还具有特殊的音频-触觉事件类型。音频触觉可以是播放的自定义音频文件，也可以是配置类似于触觉事件的生成波形，只是它是作为音频而不是触觉脉冲播放的。您可以配置音频的音高、音量和衰减等参数，以创建一些非常有趣的音频效果来伴随您的触觉体验。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="f288" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">向您的应用程序添加触觉</h1><p id="7db9" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">所有由<code class="fe lv lw lx ly b">CoreHaptics</code>创建的触觉反馈都是通过<code class="fe lv lw lx ly b">CHHapticEngine</code>的实例来播放的。您可以创建触觉引擎的实例，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c40e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，您应该在某个地方定义触觉引擎，只要您需要，实例就会一直存在。你应该避免每次想要播放触觉反馈时都创建一个引擎。相反，让它成为对象的一个属性，最终管理你的haptics实现，这样它就可以存在更长的时间。</p><p id="e2f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你还应该设置引擎的<code class="fe lv lw lx ly b">stoppedHandler</code>和它的<code class="fe lv lw lx ly b">resetHandler</code>。如果触觉引擎由于外部因素而停止，或者如果它完成了播放您的触觉事件，则调用<code class="fe lv lw lx ly b">stoppedHandler</code>。如果出现故障，发动机必须重置，则调用<code class="fe lv lw lx ly b">resetHandler</code>。在重置处理程序中，您通常希望立即再次启动引擎。</p><p id="cc97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在播放触觉反馈之前，您必须通过调用其<code class="fe lv lw lx ly b">start</code>方法来启动触觉引擎:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="2535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦引擎准备好播放触觉，我们就可以定义我们的触觉模式。要求触觉引擎创建一个<code class="fe lv lw lx ly b">CHHapticPatternPlayer</code>的实例，然后播放触觉。让我们创建一个简单的瞬时触觉事件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e531" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码定义了一个触觉事件。触觉事件是可以用来定义触觉模式的构件。</p><p id="8400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们有一个只包含单个触觉事件的模式。例如，有可能首先播放瞬时触觉事件，然后播放一秒钟的连续触觉事件，然后播放另一个瞬时触觉事件。</p><p id="f4b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用<code class="fe lv lw lx ly b">CHHapticEvent</code>初始化器上的<code class="fe lv lw lx ly b">relativeTime</code>参数为每个事件指定一个偏移量。因此，如果你想连续播放几个触觉点击，你可以使用<code class="fe lv lw lx ly b">relativeTime</code>来确保每个触觉在需要时启动，而不是一次播放整个模式。</p><p id="5170" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦定义了模式，我们就可以创建一个<code class="fe lv lw lx ly b">CHHapticPattern</code>的实例。模式初始化器中的<code class="fe lv lw lx ly b">parameters</code>属性是一个由<code class="fe lv lw lx ly b">CHHapticDynamicParameter</code>项组成的数组，这些项定义了触觉模式的强度、锐度和其他特性应该如何随时间进行操作。我很快会给你看一个例子。</p><p id="c218" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦模式被创建，我们可以向触觉引擎请求播放器，然后我们可以在设备上播放我们的触觉模式。如果需要，您可以指定播放器开始时间的延迟。我们在这个例子中使用了<code class="fe lv lw lx ly b">CHHapticTimeImmediate</code>，但是你可以指定任何你想要的<code class="fe lv lw lx ly b">TimeInterval</code>(或者<code class="fe lv lw lx ly b">Double</code>)。相当简单，对吧？</p><p id="86d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我将只展示创建<code class="fe lv lw lx ly b">CHHapticPattern</code>的步骤。涉及获得和启动播放器的所有步骤对于所有触觉模式都是相同的。让我们看一个构建触觉模式的例子，如前所述，我们有一个瞬态事件，然后是一个连续事件，然后是另一个瞬态事件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e3bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，第二个触觉事件，连续事件，定义了它的持续时间，而瞬态事件没有。这是因为瞬时触觉事件是没有持续时间的单个事件。如果你尝试在一个设备上运行这个模式，你会感觉到一个短暂的点击，然后是一个尖锐的嗡嗡声，然后是另一个短暂的点击。很酷，对吧？</p><p id="31fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何使用参数来创建一个有趣的连续触觉模式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="7acb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，动态参数的<code class="fe lv lw lx ly b">value</code>属性被用作它所操作的参数上指定的<code class="fe lv lw lx ly b">value</code>的乘数。因此，在这种情况下，在动态模式上设置值<code class="fe lv lw lx ly b">1</code>等于强度<code class="fe lv lw lx ly b">0.8</code>。值0.5等于强度0.4，依此类推。</p><p id="b39c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你播放这个，你会注意到动态参数的变化非常突然。一秒钟后，我们跳到更高的强度。一秒钟后，图案跳到一个较低的强度…等等。</p><p id="dd51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想应用更流畅的过渡，我们可以用<code class="fe lv lw lx ly b">CHHapticParameterCurve</code>代替<code class="fe lv lw lx ly b">CHHapticDynamicParameter</code>。让我们看看如何:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="5815" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了我们定义了一个数组<code class="fe lv lw lx ly b">CHHapticParameterCurve</code>而不是<code class="fe lv lw lx ly b">CHHapticDynamicParameter</code>之外，一切看起来都非常相似。</p><p id="82df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意在<code class="fe lv lw lx ly b">CHHapticParameterCurve</code>初始化器上有一个<code class="fe lv lw lx ly b">controlPoints</code>参数。这是我们指定希望我们的模式如何随时间变化的地方。我们创建<code class="fe lv lw lx ly b">CHHapticParameterCurve.ControlPoint</code>的实例来定义值如何随时间变化。注意，我使用<code class="fe lv lw lx ly b">.init</code>作为简写，因为真正的类型名对于键入来说有点长。如果你在一个设备上运行这个模式，你会发现动画更加流畅。</p><p id="774d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们了解如何将AHAP文件用于触觉之前，让我们快速定义一个自定义音频触觉:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a393" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建音频触觉的过程非常类似于创建触觉触觉。试着在你的设备上运行这个，你应该会听到一个短促的蜂鸣声。将此与中等强度的尖锐触觉相结合，会产生非常有趣的效果。</p><p id="b39b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">试着结合声音和触觉来创造让你的用户高兴的反馈。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d7cf" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用AHAP文件来定义你的触觉</h1><p id="84fa" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在这个已经相当长的快速技巧中，我想涵盖的最后一件事是使用AHAP文件来定义文件中的触觉。让我们看一个AHAP文件内容的简短示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="3095" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能会注意到模式本身看起来非常类似于我们在代码中定义的模式。最大的不同是我们现在有了一个类似JSON的文件，叫做AHAP文件，我们可以在应用程序之外编辑和更新。我们甚至可以从远程服务器获取这些AHAP文件来动态更新应用程序中的触觉。让我们看看如何在你的应用程序中播放AHAP的文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6fab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要播放AHAP文件，我们需要做的就是从包中加载它，并将其传递给触觉引擎。然后，它将读取文件，创建播放器，并播放您的文件中指定的模式。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1ef7" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">概括起来</h1><p id="bc72" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">首先，我很抱歉让这个快速提示比我预期的要长。你可以用触觉做很多很酷的事情，我想确保你拥有在自己的应用中开始使用触觉所需的所有工具。如果你需要更多的灵感，一定要看看2019年的WWDC视频<a class="ae ky" href="https://developer.apple.com/videos/play/wwdc2019/810" rel="noopener ugc nofollow" target="_blank">——它有许多关于触觉如何改善用户体验的美丽例子。</a></p><p id="eba8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，请务必查看<a class="ae ky" href="https://developer.apple.com/documentation/corehaptics" rel="noopener ugc nofollow" target="_blank">核心触觉框架</a>的文档。有很多有用的信息，甚至有几个示例应用程序可以帮助你探索触觉，并有希望激发你在应用程序中集成令人敬畏的触觉体验。</p></div></div>    
</body>
</html>