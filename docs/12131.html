<html>
<head>
<title>How to Deploy a WebSocket App to Amazon Lightsail</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将WebSocket应用部署到Amazon Lightsail</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-deploy-a-websocket-app-to-amazon-lightsail-63ec29edd2e0?source=collection_archive---------12-----------------------#2022-05-13">https://betterprogramming.pub/how-to-deploy-a-websocket-app-to-amazon-lightsail-63ec29edd2e0?source=collection_archive---------12-----------------------#2022-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="66b2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将WebSocket应用程序部署到云中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0060493a28234005aa8b2f14606d0b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gEnvTEgyp80llWqxwGbzDg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@maximevalcarce" rel="noopener ugc nofollow" target="_blank"> Maxime VALCARCE </a>在<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="bcb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">亚马逊Lightsail提供轻量级虚拟服务器，易于使用，价格非常划算，并自动配置网络和安全环境。</p><p id="e303" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用案例可能包括:</p><ul class=""><li id="790a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">一个简单的web应用程序</li><li id="3aad" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">测试环境</li><li id="9ecf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">个人项目，如作品集或博客</li></ul><p id="9828" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Amazon Lightsail也适用于WebSocket应用程序。其他云服务器也支持WebSocket，如Heroku和Google App Engine，以实现灵活的环境(非标准)。但是Heroku for a free plan在性能方面是不够的。从成本角度来看，Google App Engine对于小项目来说可能很贵。亚马逊Lightsail提供起价为7美元的容器计划，服务器规格也足够了。我使用Golang和GraphQL构建了一个<a class="ae ky" href="https://project-management-demo.manatoworks.me/" rel="noopener ugc nofollow" target="_blank">应用程序</a>，并将其部署在一个微型容器中。这个使用WebSocket进行实时通信，性能足够好。</p><p id="c440" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章将指导你使用AWS CLI部署Lightsail。</p><h1 id="ae99" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">先决条件</h1><p id="9e0a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">下载WebSocket应用程序以部署到AWS Lightsail。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="7296" class="nl mk it nh b gy nm nn l no np">$ git clone <a class="ae ky" href="https://github.com/manakuro/golang-websockets-example" rel="noopener ugc nofollow" target="_blank">https://github.com/manakuro/golang-websockets-example</a></span></pre><p id="1603" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想知道WebSocket是如何工作的，可以看看<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/implementing-websocket-with-go-and-react-b3ee976770ab">之前的帖子</a>。</p><h1 id="fa4b" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">示例存储库</h1><p id="7a06" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这是GitHub 的最终代码库</p><h1 id="b6be" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">概观</h1><ul class=""><li id="c565" class="lv lw it lb b lc nb lf nc li nq lm nr lq ns lu ma mb mc md bi translated">配置AWS CLI</li><li id="6fe5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">创建Lightsail服务</li><li id="8e6c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">创建Docker图像</li><li id="dede" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">推动容器</li><li id="eede" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">部署</li></ul><h1 id="044c" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">配置AWS CLI</h1><p id="d25b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">首先，安装AWS CLI。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="3816" class="nl mk it nh b gy nm nn l no np">$ brew install awscli</span></pre><p id="7573" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以按照<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" rel="noopener ugc nofollow" target="_blank"> AWS说明</a>进行安装。</p><h2 id="12f2" class="nl mk it bd ml nt nu dn mp nv nw dp mt li nx ny mv lm nz oa mx lq ob oc mz od bi translated">创建策略</h2><p id="d182" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">要从<code class="fe oe of og nh b">awscli</code>访问Lightsail，请创建一个策略。</p><p id="4cc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">进入左侧导航中的<a class="ae ky" href="https://console.aws.amazon.com/iam/" rel="noopener ugc nofollow" target="_blank"> IAM控制台</a>和<code class="fe oe of og nh b">Policies</code>。单击创建策略按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/3a76855da54928e570717162dff3839a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-ivSud87sGkkG7pBK1bOA.png"/></div></div></figure><p id="30df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在创建策略中，单击JSON选项卡，然后越过它:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="011a" class="nl mk it nh b gy nm nn l no np">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "lightsail:*"<br/>            ],<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}</span></pre><p id="1d20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该策略授予对所有Lightsail操作和资源的访问权限。</p><h2 id="c5e5" class="nl mk it bd ml nt nu dn mp nv nw dp mt li nx ny mv lm nz oa mx lq ob oc mz od bi translated">添加用户</h2><p id="354d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">接下来，转到左侧导航栏中的<code class="fe oe of og nh b">Users</code>，点击<code class="fe oe of og nh b">Add Users</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/132dd07c174626148a8b8b9b47356dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KU47jBxYrzOLKAPLDiuw7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户</p></figure><p id="990b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并填写用户名和勾选<code class="fe oe of og nh b">Access key</code>像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/220acc1b03d39aa3d1909995d1b53628.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCvC2rmPRejawqCQS5aIhw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加用户</p></figure><p id="8493" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，像这样附加Lightsail策略:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/5c4b411073dd5d93490ae814e294f745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8EssJ4B36MF61iEX2G38Mg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加用户</p></figure><p id="1a42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，创建用户并记下访问密钥ID和秘密访问密钥。我们稍后会用到它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/e5efd8be338d65870b4cff988594822e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QaASPj9avG-v5htW4Yuqpw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加用户</p></figure><h2 id="08da" class="nl mk it bd ml nt nu dn mp nv nw dp mt li nx ny mv lm nz oa mx lq ob oc mz od bi translated">配置awscli</h2><p id="b321" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">设置上面的用户，使其能够从命令行访问您的AWS帐户。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="a4a2" class="nl mk it nh b gy nm nn l no np">$ <!-- -->aws configure --profile deploy-lightsail<br/></span><span id="0a74" class="nl mk it nh b gy ok nn l no np">AWS Access Key ID [None]: xxxxx</span><span id="da95" class="nl mk it nh b gy ok nn l no np">AWS Secret Access Key [None]: xxxxx</span><span id="57d1" class="nl mk it nh b gy ok nn l no np">Default region name [None]: ap-northeast-1</span><span id="cd85" class="nl mk it nh b gy ok nn l no np">Default output format [None]:</span></pre><p id="f8d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置完成后，凭据文件应该如下所示:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="9493" class="nl mk it nh b gy nm nn l no np">cat ~/.aws/credentials                                                                                                                                                                       </span><span id="1cc4" class="nl mk it nh b gy ok nn l no np">[default]</span><span id="7a0e" class="nl mk it nh b gy ok nn l no np">aws_access_key_id = xxx</span><span id="812f" class="nl mk it nh b gy ok nn l no np">aws_secret_access_key = xxx</span><span id="34fe" class="nl mk it nh b gy ok nn l no np">[deploy-lightsail]</span><span id="6f04" class="nl mk it nh b gy ok nn l no np">aws_access_key_id = xxx</span><span id="b87b" class="nl mk it nh b gy ok nn l no np">aws_secret_access_key = xxx</span></pre><h2 id="d4f1" class="nl mk it bd ml nt nu dn mp nv nw dp mt li nx ny mv lm nz oa mx lq ob oc mz od bi translated">安装Lightsail插件</h2><p id="200d" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">接下来，安装Lightsail插件，以便能够推送Docker的容器图像。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="84cc" class="nl mk it nh b gy nm nn l no np">$ <!-- -->brew install aws/tap/lightsailctl</span></pre><h1 id="6690" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">创建Lightsail服务</h1><p id="6d0a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">现在我们已经准备好从命令行访问AWS Lightsail了。</p><p id="8c36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本帖中，我们将创建一个每月花费10美元但包含三个月免费的微容器服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/ad700e7b7a6b815b41a36bb7cf3cfd76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-h8ioeAelnxMExr_EWQkw.png"/></div></div></figure><p id="9105" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从命令创建一个微型容器。这里的服务名是<code class="fe oe of og nh b">websocket-lightsail</code>。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="2647" class="nl mk it nh b gy nm nn l no np">$ aws lightsail create-container-service --service-name project- websocket-lightsail --power micro --scale 1</span></pre><h1 id="1945" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Docker图像</h1><p id="35a2" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们现在可以将容器图像推送到Lightsail。接下来，创建一个docker文件来部署我们的应用程序。</p><p id="bca6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在根目录下创建<code class="fe oe of og nh b">Dockerfile</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="cb04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，构建名为app的映像:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="ab2f" class="nl mk it nh b gy nm nn l no np">$ docker build . -t app</span></pre><p id="5101" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Docker图像应该是这样的:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="f158" class="nl mk it nh b gy nm nn l no np">$ docker images -a <br/>                                                                                                                        <br/>REPOSITORY                TAG       IMAGE ID       CREATED         SIZE<br/>app   latest    87961c0073de   5 seconds ago   14.5MB</span></pre><h1 id="469e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">推动容器</h1><p id="c699" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我们已经创建了docker图像<code class="fe oe of og nh b">app</code>，将图像推送到容器中。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="157f" class="nl mk it nh b gy nm nn l no np">$ aws lightsail push-container-image --service-name websocket-lightsail --label app --image app</span></pre><p id="95fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于一个容器服务可以有多个容器，我们通过添加<code class="fe oe of og nh b">--label app</code>来标记它，并通过在最后添加<code class="fe oe of og nh b">--image app</code>来指定要推送的图像。</p><p id="9861" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建后，响应显示的内容是这样的。图像名称将用于拉动Lightsail中的容器。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="9dd3" class="nl mk it nh b gy nm nn l no np">Refer to this image as ":websocket-lightsail.app.1" in deployments.</span></pre><h1 id="b028" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">部署</h1><p id="1f02" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">要部署我们的应用程序，告诉Lightsail应该通过配置运行哪个容器。</p><p id="03a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了发送配置选项，我们创建了一个json文件。</p><p id="ff0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以首先，安装jq。jq是一个灵活的命令行JSON处理器。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="e985" class="nl mk it nh b gy nm nn l no np">$ brew install jq</span></pre><p id="3c4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，像这样创建一个模板文件<code class="fe oe of og nh b">conatiner.tmpl.json</code>:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="d78c" class="nl mk it nh b gy nm nn l no np">{<br/>  "containers": {<br/>    "app": {<br/>      "image": "",<br/>      "ports": {<br/>        "8080": "HTTP"<br/>      }<br/>    }<br/>  },<br/>  "publicEndpoint": {<br/>    "containerName": "app",<br/>    "containerPort": 8080,<br/>    "healthCheck": {<br/>      "healthyThreshold": 2,<br/>      "unhealthyThreshold": 2,<br/>      "timeoutSeconds": 5,<br/>      "intervalSeconds": 10,<br/>      "path": "/",<br/>      "successCodes": "200"<br/>    }<br/>  }<br/>}</span></pre><p id="0419" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oe of og nh b">app.image</code>应该是被推送的容器图像的名称。为了动态获取名称，我们可以像这样使用<code class="fe oe of og nh b">get-container-image</code>命令。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="35e2" class="nl mk it nh b gy nm nn l no np">$ aws lightsail get-container-images --service-name websocket-lightsail | jq -r '.containerImages[0].image'<br/></span><span id="3009" class="nl mk it nh b gy ok nn l no np">:websocket-lightsail.app.1</span></pre><p id="1b06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后创建一个由这个运行的<code class="fe oe of og nh b">container.json</code>:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="dcb9" class="nl mk it nh b gy nm nn l no np">$ jq --arg image `aws lightsail get-container-images --service-name websocket-lightsail| jq -r '.containerImages[0].image'` '.containers.app.image = $image' container.tmpl.json &gt; ./container.json</span></pre><p id="e95f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生成的文件应该如下所示:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="82bd" class="nl mk it nh b gy nm nn l no np">{<br/>  "containers": {<br/>    "app": {<br/>      "image": ":websocket-lightsail.app.1",<br/>      "ports": {<br/>        "8080": "HTTP"<br/>      }<br/>    }<br/>  },<br/>  "publicEndpoint": {<br/>    "containerName": "app",<br/>    "containerPort": 8080,<br/>    "healthCheck": {<br/>      "healthyThreshold": 2,<br/>      "unhealthyThreshold": 2,<br/>      "timeoutSeconds": 5,<br/>      "intervalSeconds": 10,<br/>      "path": "/",<br/>      "successCodes": "200"<br/>    }<br/>  }<br/>}</span></pre><p id="afa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，通过像这样运行<code class="fe oe of og nh b">create-container-service-deployment</code>来部署我们的应用程序:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="eeb5" class="nl mk it nh b gy nm nn l no np">$ aws lightsail create-container-service-deployment --service-name websocket-lightsail --cli-input-json file://$(pwd)/container.json</span></pre><p id="9410" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行该命令后，响应将打印到控制台，如下所示。您现在可以访问该URL。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="07fa" class="nl mk it nh b gy nm nn l no np">{<br/>    "containerService": {<br/>        "containerServiceName": "websocket-lightsail",<br/>        "url": "https://xxxx.xxxx.ap-northeast-1.cs.amazonlightsail.com/"<br/>    }<br/>}</span></pre><p id="d15e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要自动部署最新的映像，创建一个<code class="fe oe of og nh b">Makefile</code>并放入如下脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="e31c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以通过运行以下命令来部署新版本的应用程序:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="dad8" class="nl mk it nh b gy nm nn l no np">$ make build push deploy</span></pre><p id="7298" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了通过WebSocket连接到服务器，使用<code class="fe oe of og nh b">wss</code>协议，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h1 id="be40" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="e10c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在这篇文章中，我们已经介绍了如何部署和连接Amazon Lightsail。要点如下:</p><ul class=""><li id="bbae" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">构建Docker映像</li><li id="83e9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">推送容器图像</li><li id="81b7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">部署它</li></ul><p id="57ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。非常简单易用。</p></div></div>    
</body>
</html>