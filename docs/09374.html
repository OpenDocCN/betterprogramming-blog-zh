<html>
<head>
<title>Build a SwiftUI App For Tracking Your Cryptocurrency Trades</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建SwiftUI应用程序来跟踪您的加密货币交易</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-swiftui-app-for-tracking-your-cryptocurrency-trades-f81e4c83ad38?source=collection_archive---------10-----------------------#2021-08-16">https://betterprogramming.pub/build-a-swiftui-app-for-tracking-your-cryptocurrency-trades-f81e4c83ad38?source=collection_archive---------10-----------------------#2021-08-16</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="de61" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">创建一个DCA计算器应用程序来跟踪您的投资组合</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/e81c88511a0b798b71d2aff1de5b2b7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-XIaaXM3FW_pI2E7sIYvDA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">图片来自<a class="ae kz" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1015125" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="3951" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们将首先创建一个保存单笔交易数据的结构。</p><p id="d0d6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一笔交易由一个<code class="fe lw lx ly lz b">amount</code>、一个<code class="fe lw lx ly lz b">price</code>和一个<code class="fe lw lx ly lz b">value</code>组成。所有的交易都存储在<code class="fe lw lx ly lz b">TradesModel</code>中，这将进行DCA(美元成本平均)所需的所有计算。</p><p id="4754" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用了<code class="fe lw lx ly lz b">didSet</code>属性观察器，以便当用户想要增加显示的交易数量时，给<code class="fe lw lx ly lz b">trades</code>数组一个新的空交易。</p><p id="e059" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这使数组的大小与我们期望在屏幕上看到的数字保持一致，消除了索引超出范围错误的可能性。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ma mb l"/></div></figure><h1 id="e8ad" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">构建用户界面</h1><p id="ff2b" class="pw-post-body-paragraph la lb iu lc b ld mu jv lf lg mv jy li lj mw ll lm ln mx lp lq lr my lt lu lv in bi translated">该界面将采用表格的形式，包含三列:金额、价格和价值。这些与交易的属性相对应，每个属性都将使用自定义的<code class="fe lw lx ly lz b">TextField</code>来设置，这个自定义的<code class="fe lw lx ly lz b">TextField</code>将被称为<code class="fe lw lx ly lz b">NumberTextField</code>。</p><p id="3437" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在开始之前，我们需要创建一个简单的标题行，为每一列提供一个标题。如果我们不能清楚地看出哪一个是哪一个，就没有别的办法来区分数量和价格或价值。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ma mb l"/></div></figure><p id="a5d1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可能会注意到上面的整个HStack将<code class="fe lw lx ly lz b">disabled</code>修改器设置为<code class="fe lw lx ly lz b">true</code>。这使得每个<code class="fe lw lx ly lz b">TextField</code>和应用程序中的其他标题具有相同的外观，但是用户不能随意编辑这些标题。</p><h1 id="f14d" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">创建自定义文本字段</h1><p id="1a2b" class="pw-post-body-paragraph la lb iu lc b ld mu jv lf lg mv jy li lj mw ll lm ln mx lp lq lr my lt lu lv in bi translated"><code class="fe lw lx ly lz b">NumberTextField</code>在使用<code class="fe lw lx ly lz b">String</code>输入的<code class="fe lw lx ly lz b">TextField</code>和我们想要的数据格式<code class="fe lw lx ly lz b">Double</code>之间架起了桥梁。</p><p id="155d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">TextField</code>有一个十进制键盘，因此传统的字母数字键盘将不会显示。这极大地减少了可能的字符数量，但是仍然没有任何东西阻止用户输入多个点。这不会成功转换成<code class="fe lw lx ly lz b">Double</code>，所以我们不希望这成为可能。</p><p id="8bd3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">String</code>的扩展提供了一个计算属性，允许您轻松地检查是否有多个点，这存储在<code class="fe lw lx ly lz b">valid</code>属性中。</p><p id="f486" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当输入无效时，<code class="fe lw lx ly lz b">TextField</code>会将输入显示为红色，不会尝试将值转换为<code class="fe lw lx ly lz b">Double</code>。如果有效，该值将被设置并发送回<code class="fe lw lx ly lz b">Binding</code>。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ma mb l"/></div></figure><h1 id="fa8a" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">选择交易数量并显示计算结果</h1><p id="6fda" class="pw-post-body-paragraph la lb iu lc b ld mu jv lf lg mv jy li lj mw ll lm ln mx lp lq lr my lt lu lv in bi translated"><code class="fe lw lx ly lz b">TotalRowView</code>计算所有交易金额的总和，这样你就可以看到你拥有多少。这里还计算并显示了总成本。介于两者之间的是美元平均成本，其计算方法是将总价值除以总金额。这些值中的每一个都显示为一个不可编辑的<code class="fe lw lx ly lz b">TextField</code>中的常量字符串，因此它们与应用程序的其余部分具有相同的样式。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ma mb l"/></div></figure><p id="5082" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">TradeQuantityView</code>允许您控制行数。因为每一行代表一个交易，你需要在交易的时候添加新的交易。这一行只是一个显示交易数量的<code class="fe lw lx ly lz b">Stepper</code>。</p><p id="4b89" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">不幸的是<code class="fe lw lx ly lz b">Stepper</code>需要一个封闭的可能值范围，所以交易的最大数量必须硬编码。这个最大值可以是您想要的任何值，但是指定一个没有最大值的范围是不可能的。</p><h1 id="4418" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">允许您设置单笔交易值的行</h1><p id="29db" class="pw-post-body-paragraph la lb iu lc b ld mu jv lf lg mv jy li lj mw ll lm ln mx lp lq lr my lt lu lv in bi translated">在某些方面，这是最重要的视图，因为它允许您输入数据，以便进行平均成本计算。当金额或价格<code class="fe lw lx ly lz b">TextField</code>被编辑时，<code class="fe lw lx ly lz b">onChange</code>闭包调用<code class="fe lw lx ly lz b">setValue</code>函数。</p><p id="71d0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这将再次计算值，这只是另外两个数字的乘法。然后在trades数组中更新交易，该数组作为一个<code class="fe lw lx ly lz b">@Binding</code>属性传入。进行检查以确保预期的索引存在于数组中，防止索引超出范围错误。</p><p id="5564" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，由于更新数组中不存在的交易是一种意外行为，我仍然添加了一个<code class="fe lw lx ly lz b">fatalError</code>来解释为什么这是一种失败状态。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ma mb l"/></div></figure><h1 id="0356" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">将这一切结合在一起</h1><p id="37b0" class="pw-post-body-paragraph la lb iu lc b ld mu jv lf lg mv jy li lj mw ll lm ln mx lp lq lr my lt lu lv in bi translated">主应用程序只是迄今为止在SwiftUI <code class="fe lw lx ly lz b">Form</code>中创建的所有行的组合。这使它的外观很像iOS的设置应用程序，当屏幕上有太多行时，它会自动填充任何设备的屏幕并滚动。</p><p id="0b40" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">视图只传递它们需要的信息，比如<code class="fe lw lx ly lz b">TradeQuantityView</code>的交易总数和<code class="fe lw lx ly lz b">TotalRowView</code>的总金额和值。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ma mb l"/></div></figure><p id="6062" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一个<code class="fe lw lx ly lz b">ForEach</code>用于显示每个数字的一个交易，直到由<code class="fe lw lx ly lz b">TradeQuantityView</code>选择的交易总数，并且索引被传入，以便当发生变化时可以更新数组。</p><p id="2770" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它应该是这样的:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mz"><img src="../Images/9162d12db0ebb28d447c22bda42da258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zYQn-oJS1ok14gh9g_HfA.png"/></div></div></figure></div><div class="ab cl na nb hy nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="in io ip iq ir"><p id="432e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这一次到此为止。感谢阅读。</p></div></div>    
</body>
</html>