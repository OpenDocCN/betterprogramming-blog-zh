<html>
<head>
<title>Dealing With Dates and Times in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在R中处理日期和时间</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/dealing-with-dates-and-times-in-r-891bd1675d74?source=collection_archive---------13-----------------------#2022-03-24">https://betterprogramming.pub/dealing-with-dates-and-times-in-r-891bd1675d74?source=collection_archive---------13-----------------------#2022-03-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8ae1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">是时候掌握时间了</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ec41410b2052d73796775caeb5a26a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ihkYBVsT_c6LqGGF"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@ertelier?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">巴鲁·埃尔特尔</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="69c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦你花了足够的时间做数据工程师，你就会知道两种最难处理的数据类型是时间和日期。对于新手来说，情况更加困难。</p><p id="49bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇博客文章中，我们将发现base R为我们提供的所有实用程序，加上lubridate，一颗来自Hadleyverse星系的闪亮脉冲星。</p><h1 id="26ec" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">POSIXct和POSIXlt</h1><p id="e1cf" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在继续之前，我们先解释R中的两个基本日期时间类:POSIXct和POSIXlt。“ct”和“lt”分别表示日历时间和列表时间。当我们希望在一个变量中存储一个特定的日期时间时，使用POSIXct，而POSIXlt将一个日期时间对象的不同部分存储为一个列表的组件，只有当我们希望分别实现这些组件时，它才是有用的。从现在开始，当我们说日期和时间时，我们只是指POSIXct对象，因为它是更常见的对象。</p><p id="0c3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们演示这两个类的用法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="fdbc" class="mw lt iq ms b gy mx my l mz na">## [1] "2022-03-24 04:55:44 +03"</span><span id="2bd7" class="mw lt iq ms b gy nb my l mz na">## [1] "POSIXct" "POSIXt"</span></pre><p id="a7b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是r中典型的日期时间的样子。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="ef45" class="mw lt iq ms b gy mx my l mz na">now_lt &lt;- as.POSIXlt(now_ct)<br/>now_lt</span><span id="d26d" class="mw lt iq ms b gy nb my l mz na">## [1] "2022-03-24 04:55:44 +03"</span></pre><p id="36bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么你可以把它当作一个常规列表。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="922f" class="mw lt iq ms b gy mx my l mz na">## [1] 44.88857</span><span id="329d" class="mw lt iq ms b gy nb my l mz na">## [1] 24</span><span id="49fd" class="mw lt iq ms b gy nb my l mz na">## [1] 4</span></pre><p id="3ff8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有趣的事实:如果你试图解开一个POSIXct对象，它会返回从1970年1月1日起过去的秒数。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="2130" class="mw lt iq ms b gy mx my l mz na">unclass(now_ct)</span><span id="e7f8" class="mw lt iq ms b gy nb my l mz na">## [1] 1648086945</span></pre><h1 id="f761" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">从性格到立场。</h1><p id="572b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我在文章开头提到的困难是遇到以各种可笑的形状存储为字符和数字的日期和时间，并且不能将它们转换成正确的日期-时间对象。为了这项单调乏味的任务，我们配备了一堆工具。你最熟悉的应该是<code class="fe nc nd ne ms b">strptime()</code>。它的主要工作是将字符转换成日期时间。</p><p id="38b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">等等，没那么容易。因为字符可以包含各种形式的日期和时间，所以需要通过格式参数告诉<code class="fe nc nd ne ms b">strptime()</code>如何理解给定的字符，以便它可以正确地从该字符中提取日期和时间部分。因此，我们使用占位符来表示任何给定字符中的日期和时间信息。下面是这些占位符的详细列表。</p><ul class=""><li id="693f" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">%一个缩写的工作日，</li><li id="d23f" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%一个工作日</li><li id="35fc" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%b缩写月份</li><li id="2bda" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%B个月</li><li id="c0ca" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%c区域设置日期和时间</li><li id="7af8" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%d个十进制日期</li><li id="0a8e" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%H小时(24小时制)</li><li id="a0e5" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%I小时(12小时)</li><li id="bd07" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">一年中的%j天</li><li id="cdf1" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%m个月</li><li id="7ef8" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%M分钟</li><li id="b81b" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%p区域设置上午-下午</li><li id="dfaa" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%S秒</li><li id="0978" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">一年中的%U周(从星期日开始)</li><li id="f801" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%w工作日(从周日开始)</li><li id="75d1" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">一年中的%W周(从星期一开始)</li><li id="5da2" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%x区域特定日期</li><li id="7b69" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%X区域特定时间</li><li id="9a4b" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%y两位数年份</li><li id="6a4c" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%Y四位数年份</li><li id="5248" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">从GMT偏移%z</li><li id="be91" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">%Z时区</li></ul><p id="9360" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要那么容易被那些占位符吓到。你不需要记住它们。你可以随时打开它查看。</p><p id="499f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了例子，你会更好理解。我希望你能原谅我的土耳其月份名。(由于某种原因，我的电脑现在很顽固，不能转换成英语)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="15dc" class="mw lt iq ms b gy mx my l mz na">## [1] "2019-06-02 +03"</span><span id="ca74" class="mw lt iq ms b gy nb my l mz na">## [1] "2015-04-15 EEST"</span><span id="9f21" class="mw lt iq ms b gy nb my l mz na">## [1] "1996-12-23 07:45:00 EET"</span><span id="792f" class="mw lt iq ms b gy nb my l mz na">## [1] "2022-03-24 20:34:00 +03"</span></pre><h1 id="4392" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">从POSIXct到character。</h1><p id="d683" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">虽然它可能不如将字符串转换为日期-时间那样频繁，但我们可能会遇到必须提取日期-时间的一部分并在字符串中使用的情况。在这些情况下，我们应用<code class="fe nc nd ne ms b">strftime()</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="6e3b" class="mw lt iq ms b gy mx my l mz na">## [1] "It's 04:55 on Perşembe 24 Mart, 2022."<!-- --> </span><span id="0eb9" class="mw lt iq ms b gy nb my l mz na">## [1] "I was born in 1996. At 07:45"</span><span id="01e5" class="mw lt iq ms b gy nb my l mz na">## [1] "The exam is on the 15th of Haziran"</span></pre><h1 id="b893" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">时区</h1><p id="bd50" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当然，我们不能跳过日期时间教程而不谈时区。<code class="fe nc nd ne ms b">strptime()</code>和<code class="fe nc nd ne ms b">strptime()</code>的“tz”参数以可接受的方式接受时区信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="1a89" class="mw lt iq ms b gy mx my l mz na">## [1] "2022-03-23 18:55:45"<!-- --> </span><span id="d1b9" class="mw lt iq ms b gy nb my l mz na">## [1] "2022-03-24 04:55:45"</span><span id="7cde" class="mw lt iq ms b gy nb my l mz na">## [1] "2022-03-24 05:55:45"</span><span id="b945" class="mw lt iq ms b gy nb my l mz na">## [1] "2022-03-23 22:55:45"</span></pre><h1 id="ca7e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">seq()和difftime()</h1><p id="3dcb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们可以用这两个函数做以下操作。它们对于时间计算非常有用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="2590" class="mw lt iq ms b gy mx my l mz na">## Time difference of 796608000 secs</span><span id="65fa" class="mw lt iq ms b gy nb my l mz na">## Time difference of 13276800 mins</span><span id="0c07" class="mw lt iq ms b gy nb my l mz na">## Time difference of 9220 days</span></pre><p id="fa28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下代码块的输出没有显示，因为它占用了太多空间。你可以自己试试。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="e376" class="mw lt iq ms b gy mx my l mz na">start &lt;- as.Date('1996/12/23')<br/>end &lt;- as.Date('2022-03-22') </span><span id="949d" class="mw lt iq ms b gy nb my l mz na">seq(start , end , by = 1)<br/>seq(start , end , by = '1 year')<br/>seq(start , end , by = '500 days')<br/>seq(start , end , by = '3 weeks')</span></pre><h1 id="f27d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">更多内容请参见base R</h1><p id="67dd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">要查看我们在这里没有涉及的所有内容，您可以运行下面这段代码，查看您拥有的所有选项。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="c486" class="mw lt iq ms b gy mx my l mz na">methods(class = 'Date')<br/>methods(class = 'POSIXt')</span></pre><h1 id="39f3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">还有润滑剂！</h1><p id="caf7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你没有听说过Hadley Wickham这个名字，你可能没有花太多时间学习R语言。他是包括lubridate在内的几个R库的创建者，这使得处理日期和时间变得非常非常容易。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="6f93" class="mw lt iq ms b gy mx my l mz na"><strong class="ms ir">library</strong>(lubridate)</span></pre><p id="7384" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nc nd ne ms b">lubridate</code>用一组非常直观的功能取代了<code class="fe nc nd ne ms b">strptime()</code>。要开始将字符串转换为日期，您只需要知道相应时间概念的第一个字母。我们已经有了完美的例子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="6d28" class="mw lt iq ms b gy mx my l mz na">## [1] "1978-08-24"<br/>## [1] "1923-10-29"<!-- --> <br/>## [1] "1920-04-23"<!-- --> <br/>## [1] "1996-12-23"<br/>## [1] "23H 45M 12S"<br/>## [1] "1923-10-29 09:59:00 UTC"<br/>## [1] "1996-12-23 15:15:32 UTC"</span></pre><p id="2060" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看到了吗？这是难以置信的容易。此外，lubridate附带了许多实用程序，使时间计算变得容易得多。参见下面的例子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="1bfe" class="mw lt iq ms b gy mx my l mz na">##  [1] "2023-03-24" "2024-03-24" "2025-03-24" "2026-03-24" "2027-03-24"<br/> <br/>##  [1] "2022-03-24 01:00:00 UTC" "2022-03-24 02:00:00 UTC"<br/>##  [3] "2022-03-24 03:00:00 UTC" "2022-03-24 04:00:00 UTC"<br/>##  [5] "2022-03-24 05:00:00 UTC" "2022-03-24 06:00:00 UTC"<br/> <br/>##  [1] "2022-03-24 00:00:01 UTC" "2022-03-24 00:00:02 UTC"<br/>##  [3] "2022-03-24 00:00:03 UTC" "2022-03-24 00:00:04 UTC"<br/>##  [5] "2022-03-24 00:00:05 UTC" "2022-03-24 00:00:06 UTC"</span></pre><p id="0384" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇文章能对所有数据爱好者有所帮助。</p></div></div>    
</body>
</html>