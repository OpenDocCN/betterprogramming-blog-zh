<html>
<head>
<title>The Ghost of Source Code Past</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">源代码过去的幽灵</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-ghost-of-source-code-past-f7b27166880a?source=collection_archive---------20-----------------------#2019-10-21">https://betterprogramming.pub/the-ghost-of-source-code-past-f7b27166880a?source=collection_archive---------20-----------------------#2019-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="492e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何重构代码僵尸</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/44119fb45228a1358fbd86e841dfa694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6u1mVXPkFNPM2fkfyxU9rw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">尼尔·凯利通过<a class="ae ky" href="https://www.pexels.com/photo/night-of-the-train-photo-751091/" rel="noopener ugc nofollow" target="_blank">像素</a>拍摄的照片</p></figure><p id="b69e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在软件工程领域工作过一段时间，你可能会遇到至少一个这样的例子:没人想碰的可怕代码。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a5dc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么我必须杀死这条龙？</h1><p id="2e15" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为什么一些代码需要重构，有一个非常简单的原因。</p><p id="7ca6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">维持现状太痛苦了。没有人知道代码是做什么的。如果您试图从头开始重写代码，您可能会错过几个大家都已经忘记的重要(但模糊的)边缘情况。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="79b1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">简而言之就是重构</h1><p id="f471" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">整个重构过程如下所示:</p><ol class=""><li id="6a0a" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">做一个简单的改变。</li><li id="0172" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">确保你没有打碎任何东西。</li><li id="8d55" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">重复一遍。</li></ol><p id="c3ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们深入这些步骤。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1f63" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.做一个简单的改变</h1><p id="53d5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">因为你在一个可怕的代码库中工作，你需要找到方法来限制你所冒的风险。</p><p id="53b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">做些浅显易懂的小改动相对安全。避免做出大的、彻底的改变，这可能会带来一些不正确的假设。</p><p id="a10a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些简单变化的例子:</p><ul class=""><li id="0754" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu nn nf ng nh bi translated">重命名变量。</li><li id="a31a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">将一个函数从一个类移到另一个类。</li><li id="c13f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">将几行代码放入它们自己的函数中。</li><li id="6e4c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">移除依赖项(假设您已经移除了对该代码的所有调用)。</li><li id="9bff" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">创建新的空包或二进制文件。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b2df" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.确保你没有打碎任何东西</h1><p id="16cc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">根据您正在工作的代码库，这可能是一项重要的任务。</p><p id="27c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你重构代码之前添加测试覆盖<em class="no">。这样，您可以确保每个重构步骤之前和之后的行为是相同的。使用代码覆盖工具来确保您的测试运行所有的代码路径。</em></p><p id="ecbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你运气不好，你正在处理的代码要么很难要么不可能自动测试。很抱歉，您必须手动测试您的更改。</p><p id="e290" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这足够痛苦，你可能会想出一些创造性的方法来摆脱这种困境。有什么变通方法吗？测试代码的非常规方法？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e510" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.重复</h1><p id="8a0f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">理想情况下，在每个重构步骤之后，您将提交到您的本地分支。在实践中，您可能会将几个更改捆绑在一起。</p><p id="1588" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一个单独的重构步骤触及了许多文件，我通常会尽可能快地将那个变更签入到主分支中。您更改的文件越多，如果您在签入之前等待，遇到合并冲突的可能性就越大。</p><p id="7652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">包含50多个文件的代码评审可能会让团队成员感到厌烦。如果您所做的只是重命名一个函数，因此所有50多个文件都以完全相同的方式进行了更改，那么代码审查将变得非常简单和快速。</p><p id="4d4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在一个可怕的代码库中工作，你希望避免不必要的风险。大而复杂的代码更改不是一个好主意。确保你的队友很容易理解你所做的所有改变。</p><p id="cc98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">小心下一次部署:避免在部署到生产之间积累巨大的变化。同时投入生产的变更越多，风险就越大。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4186" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么重构是一种享受，而不是技巧</h1><p id="848e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我如此喜欢重构的一个关键原因是它的不可预测性。</p><p id="b701" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会发现秘密的关系和隐藏的宝石。有些代码会让你发笑。其他代码会让你内心哭泣。你可以从别人的错误中吸取教训，编制一份“不要做什么”的心理清单。</p><p id="4480" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你的重构之旅中，有许多创造性的途径可供你选择。随着你获得更多的经验，你会有更好的预感，知道哪条路能最快地带你到达目标。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5e93" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">被困在迷宫里</h1><p id="57f7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我总是不知道我应该从哪里开始。所以，我就选了一个地方，尝试了一些东西。</p><p id="a1f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我感到特别困难，我会简单地更新代码，使其符合我团队的编码标准(描述“干净的代码”在你的团队中是什么样子的规则)。随着我清理工作的进展，我开始意识到我想改变的其他事情。</p><p id="8580" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时候，我最终会意识到我走错了方向。但是即使发生了这种情况，我也已经了解了一些关于我所工作的代码库的重要事情。不是白费力气。</p><p id="738c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有人试图告诉你下一步总是显而易见的，他们要么没有经验，不知何故知道别人不知道的事情，要么他们在骗你。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8b03" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">你已经驯服了这个怪物</h1><p id="1c2c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">恭喜你！趁现在好好享受吧。</p></div></div>    
</body>
</html>