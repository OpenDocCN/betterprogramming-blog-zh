<html>
<head>
<title>Fetch the Data From Multiple Tables Using PostgreSQL and Sequelize</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PostgreSQL和Sequelize从多个表中获取数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/fetch-the-data-from-multiple-tables-using-postgresql-and-sequelize-dc9ea69a34?source=collection_archive---------3-----------------------#2020-03-21">https://betterprogramming.pub/fetch-the-data-from-multiple-tables-using-postgresql-and-sequelize-dc9ea69a34?source=collection_archive---------3-----------------------#2020-03-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bdb2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从postgreSQL中的多个模型获取记录</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/3aaa7d32d04ff96c58059d99d43e9f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*_0gcbRFqCvy6Mo3X-jYl7A.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">来源:google.com</p></figure><p id="b621" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我正在开发一个基于Angular和Node.js的财务应用程序，我使用的数据库是PostgreSQL和<a class="ae lq" href="https://sequelize.org/" rel="noopener ugc nofollow" target="_blank"> Sequelize </a>。</p><p id="7931" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在工作期间，我觉得PostgreSQL和Sequelize从多个模型中获取数据有点复杂，所以我想我应该写这篇文章。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="68e5" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">让我们开始吧</h1><p id="f0b1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在本文中，我们将使用两个模型(表),并尝试使用一个查询从两个模型中获取数据——就像MongoDB中的<code class="fe mv mw mx my b">populate</code>和SQL中的<code class="fe mv mw mx my b">join</code>。但是在这里，在PostgresSQL中，不像在MongoDB中那么简单。我们需要在模型文件中添加一些东西。</p><p id="a722" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这里，我创建了两个模型:<code class="fe mv mw mx my b">UserModel</code>和<code class="fe mv mw mx my b">OrderModel</code>。<strong class="kw iu"> </strong>让我们来看看每个模型文件:</p><h2 id="f5ac" class="mz lz it bd ma na nb dn me nc nd dp mi ld ne nf mk lh ng nh mm ll ni nj mo nk bi translated"><strong class="ak"> UserModel.js </strong></h2><pre class="kj kk kl km gt nl my nm nn aw no bi"><span id="e979" class="mz lz it my b gy np nq l nr ns">'use strict';<br/>module.exports = function (Sequelize, DataTypes) {<br/> const <strong class="my iu">Users</strong> = Sequelize.define('Users', {<br/>  id: {<br/>    allowNull: false,<br/>    type: DataTypes.INTEGER,<br/>    autoIncrement: true,<br/>    primaryKey: true<br/>  },</span><span id="ea64" class="mz lz it my b gy nt nq l nr ns"> fName: {<br/>   allowNull: false,<br/>   type: DataTypes.STRING<br/> },</span><span id="bd3a" class="mz lz it my b gy nt nq l nr ns"> lName: {<br/>   allowNull: false,<br/>   type: DataTypes.STRING<br/> },</span><span id="53b8" class="mz lz it my b gy nt nq l nr ns"> orders:{<br/>   allowNull: true,<br/>   type:DataTypes.INTEGER<br/> }<br/> }, </span><span id="b738" class="mz lz it my b gy nt nq l nr ns"> {<br/>  timestamps: true,<br/>  classMethods: {<br/>  associate: function (models) {<br/>        Users.belongsTo(models.Orders, { foreignKey : ‘orders’ });<br/>  }<br/> }<br/>});</span><span id="d559" class="mz lz it my b gy nt nq l nr ns">return <strong class="my iu">Users</strong>;<br/>};</span></pre><p id="7069" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要定义一个<code class="fe mv mw mx my b">associate</code>函数，其中我们需要定义我们的关联模型(这里我们有<code class="fe mv mw mx my b">Users</code>和<code class="fe mv mw mx my b">Orders</code>模型)，我们需要提供<code class="fe mv mw mx my b">foreignKey</code>。</p><p id="dd8e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看看我们的<code class="fe mv mw mx my b">OrderModel.js</code>文件。</p><h2 id="921a" class="mz lz it bd ma na nb dn me nc nd dp mi ld ne nf mk lh ng nh mm ll ni nj mo nk bi translated"><strong class="ak"> OrderModel.js </strong></h2><pre class="kj kk kl km gt nl my nm nn aw no bi"><span id="d99f" class="mz lz it my b gy np nq l nr ns">'use strict';<br/>module.exports = function (Sequelize, DataTypes) {<br/> const <strong class="my iu">Orders</strong> = Sequelize.define('Orders', {<br/>  id: {<br/>   allowNull: false,<br/>   type: DataTypes.INTEGER,<br/>   autoIncrement: true,<br/>   primaryKey: true<br/>  },<br/>  user: {<br/>   allowNull: false,<br/>   type: DataTypes.INTEGER<br/>  },</span><span id="0ecb" class="mz lz it my b gy nt nq l nr ns">  category: {<br/>   allowNull: false,<br/>   type: DataTypes.STRING<br/>   },<br/>  price: {<br/>   allowNull: false,<br/>   type: DataTypes.INTEGER<br/>  }<br/> }, {<br/>   timestamps: true,<br/>   classMethods: {<br/>    associate: function (models) {<br/>     Orders.hasMany(models.Users, { as: ‘orders’, foreignKey : ‘orders’ });<br/>    }<br/>   }<br/>  });<br/> return <strong class="my iu">Orders</strong>;<br/>};</span></pre><p id="0b70" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mv mw mx my b">Users</code>型号有以下记录:</p><pre class="kj kk kl km gt nl my nm nn aw no bi"><span id="7883" class="mz lz it my b gy np nq l nr ns">id  fName     lName    orders</span><span id="8a96" class="mz lz it my b gy nt nq l nr ns">1   Shubham   Verma     1<br/>2   Anish     Chand     2</span></pre><p id="2ed8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mv mw mx my b">Orders</code>型号有以下记录<strong class="kw iu"> : </strong></p><pre class="kj kk kl km gt nl my nm nn aw no bi"><span id="49de" class="mz lz it my b gy np nq l nr ns">Id   userId    price     category</span><span id="0008" class="mz lz it my b gy nt nq l nr ns">1    1         1000      ONLINE<br/>2    2         2000      CASH</span></pre><p id="ff24" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我想从上述两个模型中获取组合记录，如下所示:</p><pre class="kj kk kl km gt nl my nm nn aw no bi"><span id="f30d" class="mz lz it my b gy np nq l nr ns">[{<br/>"id": "1",<br/>"fName": "Shubham",<br/>"lName": "Verma",<br/>"orders":{<br/>            "id": 1,<br/>            "userId": 1,<br/>            "price": 1000,<br/>            "category": "ONLINE"<br/>         }<br/> },<br/> {<br/>"id": 2,<br/>"fName": "Anish",<br/>"lName": "Chand",<br/>"orders": {<br/>            "id": 2,<br/>            "userId": 2,<br/>            "price": 2000,<br/>            "category": "CASH"<br/>          }<br/> }]</span></pre><p id="6fb9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在两个模型中都有所有的模型和数据。现在，我们需要进行查询来获得合并的结果。</p><p id="67a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以我们的查询应该是这样的:</p><pre class="kj kk kl km gt nl my nm nn aw no bi"><span id="14b1" class="mz lz it my b gy np nq l nr ns"><br/>Models.Users.findAll({<br/>  where: {},<br/>  include: [{<br/>      model: Models.Orders,<br/>      where: {}<br/>  }]<br/>}).then((data) =&gt; {<br/>      <br/>      console.log("*********************\n\n\n\n\n",data);</span><span id="5556" class="mz lz it my b gy nt nq l nr ns">});</span></pre><p id="9c74" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的查询中，我们包含了带有<code class="fe mv mw mx my b">where</code>条件的模型<code class="fe mv mw mx my b">Orders</code> ( <code class="fe mv mw mx my b">Model.Orders</code>)。您可以添加一个条件来从<code class="fe mv mw mx my b">Orders</code>模型中获取特定的记录。</p><p id="9903" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据上面的查询，我们会得到以下结果:</p><pre class="kj kk kl km gt nl my nm nn aw no bi"><span id="7692" class="mz lz it my b gy np nq l nr ns">[{<br/>"id": "1",<br/>"fName": "Shubham",<br/>"lName": "Verma",<br/>"orders":{<br/>            "id": 1,<br/>            "userId": 1,<br/>            "price": 1000,<br/>            "category": "ONLINE"<br/>         }<br/> },<br/> {<br/>"id": 2,<br/>"fName": "Anish",<br/>"lName": "Chand",<br/>"orders": {<br/>            "id": 2,<br/>            "userId": 2,<br/>            "price": 2000,<br/>            "category": "CASH"<br/>          }<br/> }]</span></pre><p id="5cf0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这里，我们达到了预期的结果。</p><h1 id="fa58" class="ly lz it bd ma mb nu md me mf nv mh mi jz nw ka mk kc nx kd mm kf ny kg mo mp bi translated">结论:</h1><p id="d766" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在本文中，我们学习了以下内容:<br/> *如何使用PostgreSQL和Sequelize从多个表中获取数据？<br/> *如何使用PostgreSQL和Sequelize创建模型？<br/> *如何用PostgreSQL和Sequelize编写查询？</p><p id="e93a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。如果你对Node.js或者JavaScript感兴趣，那么<a class="ae lq" href="https://medium.com/@svsh227/every-nodejs-developer-should-read-these-articles-f29032441a31" rel="noopener">这个链接</a>会有帮助。</p></div></div>    
</body>
</html>