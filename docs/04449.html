<html>
<head>
<title>How to Build a Slack Bot in 2020</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在2020年打造一个Slack Bot</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-a-slack-bot-in-2020-592ac92066d8?source=collection_archive---------5-----------------------#2020-04-14">https://betterprogramming.pub/how-to-build-a-slack-bot-in-2020-592ac92066d8?source=collection_archive---------5-----------------------#2020-04-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="cf7c" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用Node.js、Botkit、Botkit CMS和LUIS构建一个Slack bot</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/99f8d292a0556277c8c044571bac834a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4CygFCYtS0tjaNlmxKqaQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">电影《战争游戏》(1983)的截图</p></figure><p id="ccba" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">自从我听到电脑W.O.P.R .问马修·布罗德里克想不想玩游戏，我就迷上了和电脑聊天。W.O.P.R .是电影Wargames中的美国军用超级计算机。</p><p id="8f1c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我记得我试图在我的Commodore 64上创建一个BASIC程序。这个程序模拟了W.O.P.R。它从命令行读取一个字符串，并在屏幕上的文本中生成一个响应。我像孔雀一样骄傲。</p><p id="c4e8" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">快进了将近40年。目前，开发一个能让你与电脑对话的应用程序从未如此简单。</p><p id="4e04" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在本文中，我将解释如何使用Botkit、Botkit C.M.S .和L.U.I.S .在Node.js中创建高级Slack Bot。</p><p id="fd76" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我将从一个简单的请求-响应机器人开始。然后添加与Botkit CMS的对话，最后使用L.U.I.S集成机器学习。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="e5ce" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">用例，报告工作时间</h1><p id="0c0c" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">我在一个大约八人的scrum团队中工作。我们使用故事和故事点来分配工作和跟踪进度。</p><p id="d740" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">为了跟踪每个故事的实际时间，我们使用一个叫做<a class="ae mz" href="https://standuply.com/" rel="noopener ugc nofollow" target="_blank"> Standuply </a>的商业Slack机器人。这个机器人每天询问每个开发人员他们在哪个故事上工作了多少小时。</p><p id="5e82" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">Standuply会生成一份报告，供我们在回顾时使用。该报告包含每个故事的估计时间和实际时间。</p><p id="6691" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我对机器人没有意见，但有时我就是忘了回答。此外，这些信息可以通过我们的scrum板以数字形式获得。我刚刚读了新版的<a class="ae mz" href="https://medium.com/better-programming/the-pragmatic-programmer-20th-anniversary-edition-15e19ca76e40" rel="noopener">实用程序员</a>，其中Andrew Thomas和Andy Hunt说:</p><blockquote class="na nb nc"><p id="88db" class="kz la nd lb b lc ld jv le lf lg jy lh ne lj lk ll nf ln lo lp ng lr ls lt lu in bi translated">确保一致性和准确性的一个好方法是自动化团队所做的一切。</p></blockquote><p id="9740" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">所以，我想自动向Standuply报告我的工作时间。我打算通过创建一个自动回答Standuply的个人Slack机器人来做到这一点。它应该通过报告来自我们的数字scrum板的信息来回应来自Standuply的问题。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="9497" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">创建和配置Slack Bot</h1><p id="fade" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">您可以从头开始构建Slack Bot，但是使用Bot开发工具包要容易得多。我使用开源的<a class="ae mz" href="https://botkit.ai/" rel="noopener ugc nofollow" target="_blank">僵尸工具</a>框架。你可以使用僵尸工具在各种平台上创建僵尸工具，比如Slack和脸书。</p><p id="e4a6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">最简单的开始方式是使用下面的命令安装Botkit starter kit和Yeoman。</p><p id="9262" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe nh ni nj nk b">npm install -g yo generator-botkit</code></p><p id="e011" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">然后使用Yeoman生成一个标准的机器人，使用如下命令。</p><p id="c632" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe nh ni nj nk b">yo botkit</code></p><p id="3379" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">约曼问了很多关于你想创建的机器人的名字和类型的问题。我选择一个松弛的机器人。</p><p id="2791" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果您在启动Yeoman之前没有创建Slack应用程序，则无法回答所有问题。这不是问题，因为您可以稍后使用<code class="fe nh ni nj nk b">.env</code>文件添加这些信息。</p><h2 id="09b1" class="nl md iu bd me nm nn dn mi no np dp mm li nq nr mo lm ns nt mq lq nu nv ms nw bi translated">创建Slack应用程序</h2><p id="903b" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">为了能够将Slack机器人连接到Slack，我们需要通过Slack网站创建一个Slack应用程序。转到<a class="ae mz" href="https://api.slack.com/" rel="noopener ugc nofollow" target="_blank"> Slack API站点</a>并创建一个新的应用。该站点显示了一个对话框，您可以在其中输入Slack Bot的名称，并将其连接到一个工作区。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nx"><img src="../Images/73963941a980ea45366278bd9c1b4956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ylhSW1GVpDZlEZp284qDkQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">通过Slack API网站创建一个新的Slack应用</p></figure><p id="fa4e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">创建Slack应用程序后，我们可以配置Slack Bot。</p><h2 id="a08a" class="nl md iu bd me nm nn dn mi no np dp mm li nq nr mo lm ns nt mq lq nu nv ms nw bi translated">配置Slack Bot</h2><p id="5c50" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">Slack Bot的配置有点棘手。生成器生成了一个包含几个空条目的<code class="fe nh ni nj nk b">.env</code>文件。您必须用Slack API网站上的信息填充这些条目。</p><p id="4ee0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe nh ni nj nk b">CLIENT_SIGNING_SECRET</code>和<code class="fe nh ni nj nk b">BOT_TOKEN</code>是让机器人运行起来最重要的。</p><p id="4cc4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您可以从Slack API站点获取<code class="fe nh ni nj nk b">CLIENT_SIGNING_SECRET</code>。它在“设置”选项卡下的“基本信息”中。该站点显示以下屏幕。</p><p id="750f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您需要将签名密码复制到您的<code class="fe nh ni nj nk b">.env</code>文件中。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ny"><img src="../Images/d1f5b01184943c5bc115e33d6a3234c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_nIQtLoNHcmiz_BYB_M3Ag.jpeg"/></div></div></figure><p id="4bef" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在您可以查看<code class="fe nh ni nj nk b">BOT_TOKEN</code>之前，您必须添加一个OAuth范围。OAuth范围可以在<strong class="lb iv"> OAuth &amp;权限</strong>选项卡上的<strong class="lb iv">功能</strong>下找到。使用OAuth作用域，您可以确定bot的功能。</p><p id="a7e0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在下面的屏幕中，我给了机器人发送消息的权限。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nz"><img src="../Images/040bd2627c8f254fbdae64bc97e48358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZzZw2mzSJcdErNikjO4cqg.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">添加Bot令牌作用域</p></figure><p id="403e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果一切顺利，您现在可以访问OAuth令牌中的<code class="fe nh ni nj nk b">BOT_TOKEN</code>重定向URL，参见下面的屏幕。复制以xoxb开头的Bot用户OAuth访问令牌字段的值，并将其粘贴到您的<code class="fe nh ni nj nk b">.env</code>文件中。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oa"><img src="../Images/8e4fef4997260cdfc096bb3eaf4d2981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LMmZnCSih7BfyV56A-9XuA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">中使用的访问令牌。环境文件</p></figure><p id="200b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">完成所有配置后，我们可以开始运行Slack Bot了。</p><h2 id="96f3" class="nl md iu bd me nm nn dn mi no np dp mm li nq nr mo lm ns nt mq lq nu nv ms nw bi translated">在本地运行Slack Bot</h2><p id="d53c" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">Slack Bot是一个Node.js应用程序，需要在某个地方运行，Slack应该能够连接到它。在开发过程中，你可以使用<a class="ae mz" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>来建立一个本地连接。Ngrok通过安全隧道将您的本地bot暴露给公共互联网。</p><p id="bb2a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">当您启动Slack bot时，它将监听端口3000上的消息。要通过ngrok公开Slack Bot，我们可以使用以下命令。</p><p id="bedb" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe nh ni nj nk b">ngrok http 3000</code></p><p id="beca" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这将启动ngrok并创建一个可以用来访问Slack Bot的代理互联网地址。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ob"><img src="../Images/0c53dde9e4d215a6d6bb145b070b02e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T8oEBZn32bXsEcxhANhsHQ.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">ngrok正在运行</p></figure><p id="87a3" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">生成的代理UR，<code class="fe nh ni nj nk b"><a class="ae mz" href="https://96355a86.ngrok.io" rel="noopener ugc nofollow" target="_blank">https://96355a86.ngrok.io</a></code>应该在Slack API网站上配置</p><p id="6a4d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在Slack API站点上，在Event Subscriptions选项卡上设置<em class="nd">请求URL </em>字段。一旦保存了请求URL，请确保ngrok正在运行，因为Slack会直接验证它。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oc"><img src="../Images/7ef41961c4697e6eaf8e009f5052f9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o4915vBCPVBCdOCLKhkKfQ.jpeg"/></div></div></figure><p id="6103" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果一切顺利，你的Slack机器人正在运行，你应该能够发送一个直接的消息，机器人将作出回应。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj od"><img src="../Images/e1087bc877857b8bd5214fcb60b34fbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GMyagXvjeK9GrckUFLOO3g.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">向Slack Bot发送第一条消息</p></figure><p id="2a3d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">需要记住的一点是，当您停止并重新启动ngrok时，它会生成一个不同的代理URL。这意味着您必须在Slack API网站上重新配置请求URL。Nrgok也有一个商业服务，让你保持一个固定的网址。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="5d88" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">阅读和回复邮件</h1><p id="6879" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">您可以在控制器上使用<code class="fe nh ni nj nk b">hears()</code>方法来指定bot在收到消息后应该做什么。</p><p id="7aed" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在下面第五行的例子中，我指定了当机器人收到消息<code class="fe nh ni nj nk b">'Which story did you work on today?'</code>时应该做什么。<code class="fe nh ni nj nk b">hears</code>的第二个参数指定了它应该对哪种类型的消息做出反应。在这种情况下，<code class="fe nh ni nj nk b">'message,direct_message'</code>告诉机器人对通道中的任何消息或直接发送给机器人的消息做出反应。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oe of l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">当机器人听到“哪个故事……”时，它会回复正在进行的故事</p></figure><p id="7afa" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果消息匹配，它将执行一个查询来搜索正在进行的故事。当它返回故事时，它用故事中的信息生成一个字符串。我最后用<code class="fe nh ni nj nk b">bot.reply</code>发送回复信息。</p><h2 id="e5c2" class="nl md iu bd me nm nn dn mi no np dp mm li nq nr mo lm ns nt mq lq nu nv ms nw bi translated">正则表达式</h2><p id="42aa" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">控制器上的<code class="fe nh ni nj nk b">hears</code>方法也接受正则表达式。正则表达式使得匹配输入短语更加灵活。例如，请参见下面使用的正则表达式。</p><pre class="kk kl km kn gu og nk oh oi aw oj bi"><span id="d127" class="nl md iu nk b gz ok ol l om on">controller.hears(new RegExp(/^What story did(.*?)$/i), ‘message,direct_message’, async (bot, message) =&gt; {</span></pre><p id="cca9" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这个控制器对类似于<strong class="lb iv">“你在写什么故事？”</strong>还要问<strong class="lb iv">“你今天在写什么故事？”</strong>。</p><h2 id="a045" class="nl md iu bd me nm nn dn mi no np dp mm li nq nr mo lm ns nt mq lq nu nv ms nw bi translated">对话</h2><p id="6525" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">僵尸工具有一个定义对话框或对话的功能。通过创建一个<code class="fe nh ni nj nk b">BotkitConversation</code>实例并向其添加消息和问题来定义一个对话框。下面是一个对话的例子。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oe of l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在Node.js中定义僵尸工具对话</p></figure><p id="dfc6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在第五行，我添加了一个问题，询问用户是否有什么要报告的。根据答案，我使用<code class="fe nh ni nj nk b">convo.gotoThread</code>跳转到下一条消息。</p><p id="5f67" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe nh ni nj nk b">addMessage</code>的第二个参数指定应该在哪个线程上显示消息。因此，如果用户回答“<em class="nd">否”</em>，它继续线程<code class="fe nh ni nj nk b">has_no_hours</code>并显示消息<em class="nd">“谢谢”</em>。</p><p id="c3c6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><code class="fe nh ni nj nk b">reportHoursDialog.addMessage(‘Thank you’, ‘has_no_hours’);</code></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oo"><img src="../Images/266c59577b1f4814a68970512ee71526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vFVromfgwUhExxKokWearw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">轻松的谈话</p></figure><p id="c9d2" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您已经看到了用代码定义对话是可能的。还有一种不同的可能性，使用僵尸工具CMS以可视化的方式定义对话。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="ba63" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">使用僵尸工具CMS实现对话</h1><p id="21f4" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">Botkit CMS是一个实现交互式对话系统的可视化工具。它是开源的，可以在您的工作站上本地运行。查看<a class="ae mz" href="https://github.com/howdyai/botkit-cms" rel="noopener ugc nofollow" target="_blank"> Github库</a>了解如何安装僵尸工具CMS的信息。</p><p id="a263" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">使用该工具，您可以定义希望用户与您的机器人进行的交互。在下面的例子中，我创建了一个简单的对话。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj op"><img src="../Images/071c8317623bb71c2463336fb53b58fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eTBuckY6Nf6ZiyetuJQ05A.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在僵尸工具CMS中建立对话模型</p></figure><p id="3a1b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">对话以一个触发器开始——在这种情况下，当你说“你好”或以“嗨”开头的信息时机器人会问:“你好吗？”。根据你的回答，机器人会有不同的反应。</p><p id="61c7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您可以将Botkit Node.js bot连接到Botkit CMS。这意味着您可以在bot运行时添加或更改对话，这对于开发和测试非常理想。</p><p id="e1a1" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您可以将以下两个变量添加到。env文件并重新启动您的机器人。Yomen已经生成了将您的bot连接到Botkit CMS的源代码。</p><pre class="kk kl km kn gu og nk oh oi aw oj bi"><span id="1db7" class="nl md iu nk b gz ok ol l om on">CMS_URI=http://localhost:4000/<br/>CMS_TOKEN=your token</span></pre><p id="f2e6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">为了让你的机器人更加智能，你可以通过添加LUIS来添加自然语言机器学习。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="6946" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">路易斯(语言理解)</h1><p id="87af" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">LUIS 是一个机器学习服务，将自然语言构建到你的机器人中。LUIS与普通僵尸工具或僵尸工具CMS的主要区别在于，它使用意图和意图得分。</p><p id="a6ab" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">LUIS是微软的一项商业服务。你每月可以免费获得10，000次查询。以上，每1000个问题支付1.50美元。每月10，000次免费查询对我的助手机器人来说绰绰有余。</p><p id="cd46" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">你通过创建你想要你的机器人执行LUIS站点的所有意图来开始LUIS。对于我的机器人，我使用一个名为<strong class="lb iv"> ReportWorkHours </strong>的意图。创建意图后，您必须添加用户可能会就此意图提出的问题。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/aa46712779d818d7d753558f85016454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-O49vi3BzjlgkPSrZ7VZA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在LUIS中为您的意图添加示例</p></figure><p id="9e7d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在您定义了可能的问题之后，您必须训练您的模型并发布结果。发布的结果将是一个LUIS URL。通过向这个URL发送一个HTTP GET，您可以提出您的问题。LUIS会用几十个被认可的意图来回应。请参见下面的回复示例。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oe of l"/></div></figure><p id="6d10" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">为了将LUIS连接到您的机器人，您安装了由Steven Ickman创建的用于机器人工具包的LUIS中间件。可以用<code class="fe nh ni nj nk b">npm install botkit-middleware-luis</code>安装。安装后，添加以下代码来配置连接。</p><pre class="kk kl km kn gu og nk oh oi aw oj bi"><span id="6298" class="nl md iu nk b gz ok ol l om on">const luis = require(‘botkit-middleware-luis’);<br/>const luisOptions = { serviceUri: process.env.LUIS_SERVICE_URI };</span><span id="0d8d" class="nl md iu nk b gz or ol l om on">controller.middleware.receive.use(luis.middleware.receive(luisOptions));</span></pre><p id="e1c9" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在您的<code class="fe nh ni nj nk b">.env</code>文件中，您必须定义<code class="fe nh ni nj nk b">LUIS_SERVICE_URI</code>并将其设置为您的LUIS URL，该URL可以在您的LUIS仪表板中找到。</p><p id="5439" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">从那时起，机器人收到的每条信息都会发送给路易斯。识别的意图和分数将添加到您在控制器上的<code class="fe nh ni nj nk b">hears</code>中收到的消息中。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oe of l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在僵尸工具控制器中使用LUIS中间件</p></figure><p id="99dd" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我使用正则表达式<strong class="lb iv">，而不是监听特定的请求。* </strong>在一号线上。结果是我在控制器中接收所有消息。</p><p id="215f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在第五行，我使用了<code class="fe nh ni nj nk b">message.topIntent</code>，它是由LUIS用公认的意图填充的。我检查这是否是ReportWorkHours的意图。此外，在第七行，我验证分数是否高于0.7。这决定了它是否是<code class="fe nh ni nj nk b">ReportWorkHours</code>的意图。如果是这样，我会检索正在进行的任务并对它们做出响应。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj os"><img src="../Images/53545921a298ceb44cb8680cd48444b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McHPJ-CciDqZaZzWYyYX0Q.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">接收的消息和计算的分数</p></figure><p id="796d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">美妙的是，你可以在路易斯的意图中添加它不理解的短语。然后你可以训练和重新发布，而不必改变或重启你的机器人。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="c55a" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">结论</h1><p id="60a2" class="pw-post-body-paragraph kz la iu lb b lc mu jv le lf mv jy lh li mw lk ll lm mx lo lp lq my ls lt lu in bi translated">有了目前可用的所有bot工具和框架，创建一个复杂的bot变得很容易。考虑如何创建和使用机器人来自动化开发工作流程的一部分。</p><p id="cac2" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在本文中，我解释了如何使用BotKit实现一个现代SlackBot。我使用Botkit CMS为机器人添加了更复杂的对话框，并最终使用LUIS集成了自然语言机器学习。</p><p id="f659" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">该源代码可在<a class="ae mz" href="https://github.com/PatrickKalkman/developer-assistant" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得</p><p id="8bf6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>