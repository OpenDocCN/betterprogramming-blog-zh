<html>
<head>
<title>Avoiding “Massive AppDelegates” in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">避免iOS中的“大量AppDelegates”</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/avoiding-massive-appdelegates-df59dd9b8a2d?source=collection_archive---------11-----------------------#2022-01-25">https://betterprogramming.pub/avoiding-massive-appdelegates-df59dd9b8a2d?source=collection_archive---------11-----------------------#2022-01-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0627" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在AppDelegate中下单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/47568c62232cf624d0f03ab21f2ad5e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rxQgJbSQMEorJGo-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">塞萨尔·卡里瓦里诺·阿拉贡在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="8997" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="af72" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我写的是如何组织你的iOS项目。并且得到了很多问题来阐述如何避免出现“海量AppDelegate”。</p><p id="f4c1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您已经参与了几个项目，那么您很有可能遇到了“大规模视图控制器”问题。</p><p id="8f7e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了解决这个问题，你可以使用<code class="fe ms mt mu mv b">extension</code>来提取一些逻辑，使用子视图控制器，或者使用一些架构模式，比如MVP、MVVM、VIPER、CleanVIP等等。</p><p id="e63a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">相反，很多有组织的项目仍然有巨大的<code class="fe ms mt mu mv b">AppDelegates</code>。在这篇文章中，我将尝试提出我最喜欢的解决这个问题的方法。</p><h1 id="09bc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">问题是</h1><p id="9c26" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">几乎所有的在线第三方SDK集成教程都展示了它们的基本实现以及如何初始化它们——比如Firebase、Realm、AppFlyer、Alamofire等。你在<code class="fe ms mt mu mv b">AppDelegate</code>中集成并初始化它们。</p><p id="8ea6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后<em class="mw">产品所有者</em>基于推送通知、位置、核心数据等要求新的特性。</p><p id="4496" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你把他们也加到<code class="fe ms mt mu mv b">AppDelegate</code>里。此时<code class="fe ms mt mu mv b">AppDelegate</code> <code class="fe ms mt mu mv b">application(_:didFinishLaunchingWithOptions:)</code>已经有了一堆代码，逻辑上应该有一些分离。这只是一种方法。甚至不会走得更远。我们称之为“大规模AppDelegate”。</p><p id="d780" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">不过不用担心<a class="ae ky" href="https://en.wikipedia.org/wiki/Composite_pattern" rel="noopener ugc nofollow" target="_blank">复合设计图案</a> <strong class="lt iu"> </strong>能够救驾。</p><h1 id="f9bc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">设计自定义AppDelegate</h1><p id="2f4d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们开始使用<code class="fe ms mt mu mv b">AppDelegate</code>之前。我想介绍一个不错的组织/文件夹结构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/17dcd59ec0a73981a7cdb344ffa7e20a.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*B-EUtVHAxjT5Wj4jYTUXug.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分层架构中的应用层和自定义AppDelegate</p></figure><p id="26e6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如你所看到的，所有属于应用层的东西都被分开了，包括<code class="fe ms mt mu mv b">AppDelegate</code>和<code class="fe ms mt mu mv b">Custom AppDelegates</code>以及<em class="mw">支持文件</em>(如Info.plist、Assets、Configs等。).<br/>对于每个逻辑组件，如通知或Firebase Crashlytics，我们将创建一个<code class="fe ms mt mu mv b">Custom AppDelegate</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/a7ecf809e556f6c9b25a8e10f833a5d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvXCxT81PlI2Lm0YY4HM5w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基于逻辑的复合设计模式在AppDelegate和Group中的应用</p></figure><p id="dda2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如你从上图中看到的，只需要整合使用过的方法。</p><p id="5801" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ms mt mu mv b">NotificationAppDelegate</code>有<code class="fe ms mt mu mv b">application(_:didFinishLaunchingWithOptions:)</code>和<code class="fe ms mt mu mv b">application(_:didRegisterForRemoteNotificationsWithDeviceToken:).</code></p><p id="c157" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你仔细看看，<code class="fe ms mt mu mv b">AppDelegate</code>类符合<code class="fe ms mt mu mv b">UIApplicationDelegate</code>协议。这给了我们类似于<code class="fe ms mt mu mv b"> application(_:didFinishLaunchingWithOptions:)</code>的可选方法。</p><h1 id="ae16" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">准备应用程序委托</h1><p id="431a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们一步一步地解释下面的代码。</p><ul class=""><li id="efd2" class="mz na it lt b lu mn lx mo ma nb me nc mi nd mm ne nf ng nh bi translated"><strong class="lt iu">第一步。</strong> <strong class="lt iu"> — </strong>我们需要创建类型为<code class="fe ms mt mu mv b">UIApplicationDelegate</code> <em class="mw">(第10行)</em>的<code class="fe ms mt mu mv b">CustomAppDelegates</code> <strong class="lt iu"> </strong>列表</li><li id="12c1" class="mz na it lt b lu ni lx nj ma nk me nl mi nm mm ne nf ng nh bi translated"><strong class="lt iu">第二步。— </strong>将每个新创建的<code class="fe ms mt mu mv b">CustomAppDelegates</code> <strong class="lt iu"> </strong>添加到列表中，例如:like <code class="fe ms mt mu mv b">NotificationAppDelegate</code> <strong class="lt iu"> </strong> <em class="mw">(第16行)</em></li><li id="47a6" class="mz na it lt b lu ni lx nj ma nk me nl mi nm mm ne nf ng nh bi translated"><strong class="lt iu">步骤三。— </strong>在<strong class="lt iu"> </strong>中，每一个<code class="fe ms mt mu mv b">AppDelegate</code>方法都添加类似(<em class="mw">例如:第33行</em>)的东西</li></ul><pre class="kj kk kl km gt nn mv no np aw nq bi"><span id="0bfd" class="nr la it mv b gy ns nt l nu nv">appDelegates.forEach { _ = $0.application?(application, didFinishLaunchingWithOptions: launchOptions) }</span></pre><p id="b308" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这将确保每个<code class="fe ms mt mu mv b">CustomAppDelegate</code> <strong class="lt iu"> </strong>方法都会被调用。</p><p id="a498" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">仅此而已。未来的<code class="fe ms mt mu mv b">AppDelegate</code>，大多不需要有大的改动。如果遗留代码有问题，这也是重构现有<code class="fe ms mt mu mv b">AppDelegate</code>的一种便捷方式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">干净整洁的AppDelegate代码示例</p></figure><h1 id="5e70" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">CustomAppDelegate实现</h1><p id="6ded" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您已经正确设置了<code class="fe ms mt mu mv b">AppDelegate</code>，这里您几乎没有什么工作要做。</p><ul class=""><li id="7435" class="mz na it lt b lu mn lx mo ma nb me nc mi nd mm ne nf ng nh bi translated">第一步。—确保您的<code class="fe ms mt mu mv b">CustomAppDelegate</code>符合<code class="fe ms mt mu mv b">UIApplicationDelegate</code>。</li><li id="5332" class="mz na it lt b lu ni lx nj ma nk me nl mi nm mm ne nf ng nh bi translated">第二步。—开始键入您需要的方法，自动完成应该会建议与常规<code class="fe ms mt mu mv b">AppDelegate</code>相同的方法。</li><li id="1047" class="mz na it lt b lu ni lx nj ma nk me nl mi nm mm ne nf ng nh bi translated">第三步。—基于第三方SDK方法的文档集成这些方法。</li></ul><p id="a187" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">仅此而已。你有逻辑分离的组件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CustomAppDelegate的示例</p></figure><p id="ba8e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果我们开始代码，那么我们可以看到所有实现的方法将被一个接一个地触发。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/0fbbf9c54751445a0a5342e59f940b59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*1-NJX_9lx7KXAO9YiambIw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CustomAppDelegates应用程序启动中的生命周期</p></figure><p id="c4ba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果应用程序在后台<strong class="lt iu">，</strong> <code class="fe ms mt mu mv b">PersistenceAppDelegate</code>想要监听<code class="fe ms mt mu mv b">applicationWillResignActive(_:)</code>事件以进行最后的保存。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/d1b5028ba9041fa93d5e16f91d347037.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*6qdgPpIRBrfbjqBjInaYiQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用程序中的CustomAppDelegates生命周期将转到后台</p></figure><p id="fb21" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们可以看到只有<code class="fe ms mt mu mv b">PersistenceAppDelegate</code>事件被触发。其余的<em class="mw"> CustomAppDelegates </em>没有兴趣听这个事件。</p><p id="fce0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这个<a class="ae ky" href="https://github.com/skyspirit86/MassiveAppDelegate" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>上可以获得整个代码库。</p><h1 id="4f24" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">概述</h1><p id="37bc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你开始这个项目，马上组织起来并不难。</p><p id="3378" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你有一个正在进行的项目，这是一个快速、轻松重构的简单方法。</p><p id="1fd0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你有<code class="fe ms mt mu mv b">SceneDelegate</code>，这个逻辑也可以很容易地应用。</p><p id="59da" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你到了这一步，感谢你的阅读。你应该得到一杯咖啡☕️.🙂如果你喜欢的内容，请👏，分享，还有<a class="ae ky" href="https://varga-zolt.medium.com/" rel="noopener">跟着</a>，对我来说就是a的意思。如果您有一些建议或问题，请随时发表评论。</p><p id="0643" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">想连线？</strong> <br/>你可以在<a class="ae ky" href="https://www.linkedin.com/in/varga-zolt/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae ky" href="https://twitter.com/skyspirit86" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae ky" href="https://skyspiritlabs.com/" rel="noopener ugc nofollow" target="_blank">https://skyspiritlabs.com/</a>与我联系。还有更多文章和教程。</p></div></div>    
</body>
</html>