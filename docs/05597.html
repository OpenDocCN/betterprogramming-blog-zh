<html>
<head>
<title>The Easiest Way to Perform GraphQL Queries in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS中执行GraphQL查询的最简单方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-easy-way-to-perform-graphql-queries-in-ios-47b11ea2508e?source=collection_archive---------9-----------------------#2020-07-21">https://betterprogramming.pub/the-easy-way-to-perform-graphql-queries-in-ios-47b11ea2508e?source=collection_archive---------9-----------------------#2020-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5a9f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用原始的HTTP请求很容易进行GraphQL查询</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/99e60075ec1b88f4d6afffdbb62e89dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dLW0zkKIsvyJL-PA"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Joshua Sortino 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="216e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在iOS应用程序中与GraphQL服务器通信，有一些第三方库，如Apollo iOS客户端和AWS AppSync。但是它们也给你的项目引入了不必要的代码。</p><p id="98b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，Apollo iOS客户端通过使用SQLite数据库来规范化查询结果以构建客户端缓存。AWS AppSync用一些额外的特性包装了Apollo客户端，以处理AWS身份验证。</p><p id="68a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我的项目与第三方库绑定时，我总是感到犹豫。一些问题是:</p><ul class=""><li id="254c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">图书馆的安全性如何？</li><li id="f8ba" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果维护者停止维护库怎么办？</li><li id="9cd7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">维护人员修复一个问题并发布补丁版本需要多长时间？</li><li id="b8ce" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">你会告诉你的客户因为第三方的原因你不能解决问题吗？</li></ul><p id="b6ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，有一种简单、轻量级的方法可以通过使用原始HTTP请求来执行GraphQL。</p><p id="b562" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文演示了如何针对<a class="ae ky" href="https://swapi.graph.cool" rel="noopener ugc nofollow" target="_blank">星球大战GraphQL API </a>逐步构建它。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3881" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">1.查询操作</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/8467ab70988ab556831fa24db59c65f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Uv5wHz0Vh1fUq-OH"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@melindapack?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">梅尔</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0246" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有三种类型的GraphQL操作:<code class="fe nj nk nl nm b">query</code>、<code class="fe nj nk nl nm b">mutation</code>和<code class="fe nj nk nl nm b">subscription.</code></p><p id="fabb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl nm b">query</code>操作是从API中检索数据。根据GraphQL API的不同，可以通过<code class="fe nj nk nl nm b">GET</code>或<code class="fe nj nk nl nm b">POST</code> HTTP方法来执行。</p><p id="ed25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于本文消耗的<a class="ae ky" href="https://swapi.graph.cool" rel="noopener ugc nofollow" target="_blank">星球大战GraphQL API </a>，使用的是<code class="fe nj nk nl nm b">POST</code>方法。</p><p id="4308" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是标准GraphQL POST请求的示例表单。该请求使用<code class="fe nj nk nl nm b">application/json</code>作为<code class="fe nj nk nl nm b">Content-type</code>。表单是它的JSON编码的主体。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杨梦的GraphQL POST请求的JSON编码的正文格式</p></figure><p id="e468" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从<code class="fe nj nk nl nm b">query</code>字符串开始。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/6f81e6ecd11b8fb00a4ccf47316d81f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KYJzxJqZoJ2ARRlq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@maartendeckers?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马腾·德克斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="9bde" class="mq mr it bd ms mt nq mv mw mx nr mz na jz ns ka nc kc nt kd ne kf nu kg ng nh bi translated">2.查询字符串</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由杨梦查询正文字符串</p></figure><ul class=""><li id="e69c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">它通过使用过滤器定义查询字符串来获取电影。</li><li id="4ab8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">字符串中的关键字<code class="fe nj nk nl nm b">query</code>定义了您打算做的操作类型。</li><li id="41c6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nj nk nl nm b">allFilms</code>是操作名称。这不是必需的，但是有意义且明确的名称可以帮助您识别操作。</li><li id="11e2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nj nk nl nm b">$filter</code>是查询接受的变量之一，后面是类型<code class="fe nj nk nl nm b">Filter</code>。我们可以传递一个不同的变量，而不是在查询中构造它。</li><li id="7a27" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nj nk nl nm b">fields</code>块描述了我们正在询问的特定字段，其形状与我们从GraphQL API中得到的相同。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/ba397289f433f1aa12d7a72406773d4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yg1CcFEgik3yjqaN"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">吉尔·海耶在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="0732" class="mq mr it bd ms mt nq mv mw mx nr mz na jz ns ka nc kc nt kd ne kf nu kg ng nh bi translated">3.可编码变量</h1><p id="65fa" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">作为<a class="ae ky" href="https://swapi.graph.cool" rel="noopener ugc nofollow" target="_blank">星球大战GraphQL API </a>状态的文档，查询<code class="fe nj nk nl nm b">allFilms</code>的扩展是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">星球大战图表API查询所有电影</p></figure><p id="6724" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们都是可选的。出于演示的目的，我们在这里使用<code class="fe nj nk nl nm b">Filter</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杨梦的《身体的变量》</p></figure><p id="d198" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有一些<code class="fe nj nk nl nm b">Filter</code>的可选属性。我们只挑选<code class="fe nj nk nl nm b">director</code>来简化演示代码。</p><p id="be82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl nm b">Filter</code>和<code class="fe nj nk nl nm b">Variable</code>结构采用<code class="fe nj nk nl nm b">Encodable</code>协议来准备JSON编码的主体。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/f8d411fe5405285713bbc6e522509398.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2Mj6VB3RVPTGBy8d"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@srosinger3997?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">萨曼莎·加德斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="c8a9" class="mq mr it bd ms mt nq mv mw mx nr mz na jz ns ka nc kc nt kd ne kf nu kg ng nh bi translated">4.构建HTTP请求</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="425e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们打破这一点:</p><ul class=""><li id="1b1f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">结构<code class="fe nj nk nl nm b">Payload</code>包含<code class="fe nj nk nl nm b">variables</code>和<code class="fe nj nk nl nm b">query</code>。它也采用<code class="fe nj nk nl nm b">Encodable</code>协议。</li><li id="db37" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nj nk nl nm b">request</code>是用星球大战API URL构建的<code class="fe nj nk nl nm b">URLRequest</code>的实例:<a class="ae ky" href="https://swapi.graph.cool" rel="noopener ugc nofollow" target="_blank">https://swapi . graph . cool</a>。</li><li id="063d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nj nk nl nm b">payload</code>是JSON编码的，并被添加到<code class="fe nj nk nl nm b">request</code>的主体中。</li><li id="8ee8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nj nk nl nm b">POST</code>星球大战GraphQL API要求的方法被使用。</li><li id="4dfb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们使用<code class="fe nj nk nl nm b">application/json</code>作为Http头字段<code class="fe nj nk nl nm b">Content-Type</code>和<code class="fe nj nk nl nm b">Accept</code>的值。</li><li id="0b52" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe nj nk nl nm b">request </code>只是用<code class="fe nj nk nl nm b">URLSession</code>的共享实例触发。</li><li id="a4b6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">响应的数据是JSON格式的，可以使用<code class="fe nj nk nl nm b">JSONSerialization</code>进行反序列化。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/ae844a6a623ebdd728aa1735242ec61b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f7or5uDc6950qO9h"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Anton Sukhinov 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="3b27" class="mq mr it bd ms mt nq mv mw mx nr mz na jz ns ka nc kc nt kd ne kf nu kg ng nh bi translated">结论</h1><p id="b895" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">本文描述了与GraphQL服务进行通信的更轻量级的方法。通过使用原始HTTP请求，不需要与任何第三方库耦合。干净快捷的代码可以完全在开发者的控制之下。</p><p id="5507" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一篇文章中，我将向您展示如何使用原始HTTP请求执行GraphQL变异。敬请期待！</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/b3a84da3ccff2a459e489e20d7a1b4d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JCiTZZcW9YBZB8yX"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@musicfox?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> MusicFox Fx </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="c6b1" class="mq mr it bd ms mt nq mv mw mx nr mz na jz ns ka nc kc nt kd ne kf nu kg ng nh bi translated">资源:</h1><p id="81cb" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">所有第三方库、GraphQL APIs和样本Swift代码均可在以下链接中找到:</p><ul class=""><li id="b198" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://shopify.dev/concepts/shopify-introduction" rel="noopener ugc nofollow" target="_blank"> Shopify GraphQL API </a></li><li id="a057" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.yelp.com/login?return_url=%2Fdevelopers%2Fgraphiql" rel="noopener ugc nofollow" target="_blank"> Yelp GraphQL API </a></li><li id="6739" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://github.com/apollographql/apollo-ios" rel="noopener ugc nofollow" target="_blank">阿波罗-iOS </a></li><li id="6ecc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://github.com/awslabs/aws-mobile-appsync-sdk-ios/" rel="noopener ugc nofollow" target="_blank"> AWS AppSync SDK iOS </a></li><li id="a308" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://gist.github.com/ericleiyang/96c631134a1ccd161f5d32ffb895e2a6" rel="noopener ugc nofollow" target="_blank"> GraphQL查询操场</a></li></ul></div></div>    
</body>
</html>