<html>
<head>
<title>Protractor Is Dead, Long Live Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">量角器死了，柏树万岁</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/protractor-is-dead-long-live-cypress-3f0c6bdd62e6?source=collection_archive---------3-----------------------#2021-07-29">https://betterprogramming.pub/protractor-is-dead-long-live-cypress-3f0c6bdd62e6?source=collection_archive---------3-----------------------#2021-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4e00" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">E2E框架的前景正在发生变化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9a39da31819d766632f3b34bc5e1cd2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2qfGXH2wCRxwIYhc.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ea4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4月24日，Angular宣布放弃他们的端到端(E2E)测试工具，量角器。目前还不清楚Angular是否会有一个继任者，或者是否会将这一任务委托给它的用户。在撰写本文时，WebDriver。IO、TestCafé和Cypress已经提出了Angular CLI的原理图。</p><p id="a8c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我将简要概述各种E2E框架之间的区别，并解释为什么应该使用Cypress。在这篇文章的后续文章中，我将帮助您开始使用Cypress。</p><p id="dd0f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢看而不喜欢读，那么我这篇演讲的录音是给你的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a641" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">E2E测试框架的前景</h1><h2 id="2c9d" class="mu md it bd me mv mw dn mi mx my dp mm lh mz na mo ll nb nc mq lp nd ne ms nf bi translated">基于web驱动程序</h2><p id="46f7" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">我们可以将可用的工具大致分为两组:基于WebDriver的工具和基于Chrome DevTools协议(CDP)的工具。</p><p id="2343" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Selenium于2004年发布。它与一个叫做WebDriver的类似工具合并了。硒仍然是一个主要的玩家，量角器或多或少是它的包装。</p><p id="26b1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了Selenium/WebDriver，开发人员就有了一个通用的API来自动化浏览器。每个受支持的浏览器都提供了一个驱动程序，WebDriver使用它来使这些框架能够跨浏览器。这意味着您可以在Safari、Chrome、移动浏览器等上运行相同的测试。</p><p id="6ec3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着时间的推移，Selenium中的核心技术WebDriver成为了W3C标准，这为其他供应商基于WebDriver创建自己的框架打开了大门。</p><p id="2cca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不幸的是，基于WebDriver的测试名声不佳。如果在相同的情况下多次运行测试，它们可能会失败，也可能会成功。这对测试框架来说是非常糟糕的。你花了相当多的时间来构建应该保证应用程序稳定性的测试，然后你甚至不能相信测试的结果。</p><h2 id="4f04" class="mu md it bd me mv mw dn mi mx my dp mm lh mz na mo ll nb nc mq lp nd ne ms nf bi translated">Chrome DevTools协议</h2><p id="88c9" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">两个相当受欢迎的选择是木偶师和剧作家。它们不依赖于WebDriver，而是通过Chrome DevTools协议(CDP)直接与浏览器对话。这给了他们更好的控制，从而导致更稳定的测试。</p><p id="73a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">CDP绑定到基于Chrome的浏览器，包括Chrome和Edge。尽管Firefox也支持CDP，但WebDriver支持的那种跨浏览器测试是不可能的。</p><p id="80e4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">剧作家背后有一些木偶剧的原创开发者。因此，人们可以把剧作家看作是木偶戏的改写。它也使用CDP，但也支持Safari，因为它带有补丁浏览器。</p><p id="ff97" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">WebdriverIO是一个混合框架；它提供了对CDP和WebDriver的访问。</p><p id="1788" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">柏树属于哪一类？Cypress依赖于CDP，但是与木偶师不同，Cypress只使用CDP来管理测试。测试本身根本不使用CDP，而是直接在浏览器中运行。测试和浏览器之间不再有任何层。您的测试代码可以直接访问DOM，而不是通过CDP或WebDriver间接访问，所以测试和应用程序代码是一体的。</p><p id="e872" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">碰巧的是，这与Selenium在与WebDriver合并之前采用的方法相同。看来历史重演了。</p><h2 id="c33d" class="mu md it bd me mv mw dn mi mx my dp mm lh mz na mo ll nb nc mq lp nd ne ms nf bi translated">片状与跨浏览器</h2><p id="8bc0" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">从一个非常高层次的角度来看，我们的测试和浏览器之间的抽象越多，测试就越容易变得古怪。另一方面，抽象使得跨浏览器测试变得更加容易。我们离浏览器越近，测试就越稳定。然而，我们必须承认，我们只能在一种特定的浏览器技术上运行测试，即Chromium。</p><p id="06a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在未来，所有的浏览器都可能支持CDP，或者即将到来的WebDriver BiDi将为WebDriver世界带来稳定性，但事情仍在发展。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/642858d34aee23ef398fb8c9b1c85d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BcCMjnC7vBezBktQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">E2E框架的景观。图片作者。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7dfb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么你应该使用柏树</h1><p id="6601" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">首先，Cypress不使用WebDriver，而是直接在浏览器中运行测试。这些使得测试稳定可靠——这正是我们最初想要的。</p><p id="9db9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个原因是开发经验(DX)。Cypress的作者投入了大量的精力使其尽可能易于使用。这不仅仅意味着API易于使用。工具、社区工作，尤其是文档都棒极了。</p><p id="ba14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，所以柏树比量角器好。你为什么要选择赛普拉斯而不是其他E2E图书馆呢？</p><p id="2202" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为Angular开发人员，我们总是赞赏我们得到了一个“固执己见的框架”,它为我们预先选择了各种工具。虽然看起来Angular给E2E留下了空缺，但还有另一个大玩家:Nx。Nx多年来一直为角度应用提供最好的工具。</p><p id="a53a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Nx是CLI的包装器。它最初是作为MonoRepositories的候选，但是多年来变得越来越像一个Angular CLI++。事实上，如果我开始一个新的角度应用，我个人会选择Nx。没有锁定，也没有开销。我只是得到了更好的工具，可以继续使用Angular CLI。</p><p id="aba8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你猜怎么着？Nx用Cypress代替了量角器。所以Nx很注意Angular和Cypress的配合。</p><p id="4964" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后一个争论是Cypress在Angular开发者中的使用。在公开反对之前，Angular做了一项调查。他们询问用户他们使用的是什么E2E。那次调查显示64%的人选择了柏树；你可以称之为政治上的压倒性胜利。请记住，那是量角器还是官方工具的时候！量角器最终只有19%。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/4ef8096507de5a93a3ebae051ddbf494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qXUCiL8QU4nyv_JZ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:https://github.com/angular/protractor/issues/5502</p></figure><h1 id="d1d5" class="mc md it bd me mf nm mh mi mj nn ml mm jz no ka mo kc np kd mq kf nq kg ms mt bi translated">为什么你不应该使用柏树</h1><p id="5e39" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">根据您的使用情况，Cypress可能不符合您的需求:</p><ul class=""><li id="193d" class="nr ns it la b lb lc le lf lh nt ll nu lp nv lt nw nx ny nz bi translated">没有跨浏览器测试:如果你需要在Safari、其他浏览器甚至移动设备上运行你的E2E测试，你需要使用另一个工具。柏树绝对是错误的选择。</li><li id="0e29" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated">在一个测试中切换域:如果您的应用程序跨越多个域，您也不会喜欢Cypress。</li><li id="a019" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated">切换标签:也不可能。</li></ul><p id="de40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想一想Cypress是如何工作的，这只是一个合乎逻辑的结果。测试在浏览器内部运行，如果你改变了URL或者标签，测试就会消失。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="acc3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="5999" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">Cypress为您提供了稳定性和出色的开发体验。大多数Angular开发者已经在使用它了。</p><p id="8f68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您正在量角器中运行E2E，现在是迁移的时候了！如果你到现在还没有写过《E2E 》,看看《赛普拉斯》。你会惊讶它是多么容易。</p><p id="bacb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">切换到Cypress意味着重写您的E2E测试。你可以用一种渐进的方式来做。柏树和量角器并不互相排斥；它们可以在同一个角度项目中运行。</p><p id="6d53" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，Cypress可能不符合您的需求。如果跨浏览器支持是绝对必须的，你应该看看像WebDriverIO和上面提到的其他浏览器。</p><h1 id="148f" class="mc md it bd me mf nm mh mi mj nn ml mm jz no ka mo kc np kd mq kf nq kg ms mt bi translated">进一步阅读</h1><ul class=""><li id="15dd" class="nr ns it la b lb ng le nh lh of ll og lp oh lt nw nx ny nz bi translated"><a class="ae lu" href="https://wiki.mozilla.org/WebDriver/RemoteProtocol" rel="noopener ugc nofollow" target="_blank">网络驱动/远程协议</a></li><li id="0a1c" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><a class="ae lu" href="https://w3c.github.io/webdriver/webdriver-spec.html" rel="noopener ugc nofollow" target="_blank"> W3C网络驱动协议</a></li><li id="43f5" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><a class="ae lu" href="https://github.com/angular/protractor/issues/5502" rel="noopener ugc nofollow" target="_blank">角度E2E的未来&amp;量角器计划发行#5502角度/量角器</a></li><li id="d44b" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><a class="ae lu" href="https://webdriver.io/docs/automationProtocols" rel="noopener ugc nofollow" target="_blank">自动化协议</a></li><li id="963c" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><a class="ae lu" href="https://blog.logrocket.com/playwright-vs-puppeteer/" rel="noopener ugc nofollow" target="_blank">剧作家与木偶师</a></li><li id="0d2c" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><a class="ae lu" href="https://blog.logrocket.com/cypress-io-the-selenium-killer" rel="noopener ugc nofollow" target="_blank">柏树与硒:为什么柏树是更好的选择</a></li><li id="572e" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><a class="ae lu" href="https://www.browserstack.com/guide/selenium-rc-tutorial" rel="noopener ugc nofollow" target="_blank">什么是Selenium RC:与Webdriver的区别</a></li><li id="3875" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><a class="ae lu" href="https://nightwatchjs.org/gettingstarted/" rel="noopener ugc nofollow" target="_blank"> Nightwatch.js </a></li><li id="1cbe" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated"><a class="ae lu" href="https://glebbahmutov.com/blog/cypress-vs-other-test-runners/" rel="noopener ugc nofollow" target="_blank">赛普拉斯与其他参赛选手</a></li><li id="e0f9" class="nr ns it la b lb oa le ob lh oc ll od lp oe lt nw nx ny nz bi translated">书:学习硒测试工具—第三版，Raghavendra Prasad MG</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="b9c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="oi">原载于2021年6月2日</em>www.rainerhahnekamp.com<a class="ae lu" href="https://www.rainerhahnekamp.com/en/angular-e2e-testing-protractor-is-dead-long-live-cypress/" rel="noopener ugc nofollow" target="_blank"><em class="oi"/></a><em class="oi"/></p></div></div>    
</body>
</html>