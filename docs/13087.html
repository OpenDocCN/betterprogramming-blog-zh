<html>
<head>
<title>Automate Posts From Salesforce to Slack in 3 Easy Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过3个简单的步骤自动完成从Salesforce到Slack的发布</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/post-from-salesforce-to-slack-in-3-easy-steps-1d615162e0d0?source=collection_archive---------4-----------------------#2022-07-27">https://betterprogramming.pub/post-from-salesforce-to-slack-in-3-easy-steps-1d615162e0d0?source=collection_archive---------4-----------------------#2022-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8dab" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">快速从Salesforce发布到Slack</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/347f22bd4d602ed73f0717d9668351fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T5Bd3nmf2ZFZ8oSR"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">斯蒂芬·菲利普斯-Hostreviews.co.uk在Unsplash<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></p></figure><p id="fcb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只需三个简单的步骤，您就可以开始以编程方式从Salesforce Flows、Process Builders或Apex向您喜爱的松弛渠道发送消息！下面的框架将为您提供开始构建Salesforce to Slack bot所需的更多内容，它可以让您的团队了解最新的记录更新。</p><ol class=""><li id="b79a" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><strong class="ky ir">创建一个宽松的工作流程。</strong>创建从salesforce接收更新的工作流，并将消息发布到您选择的渠道！</li><li id="1426" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">将以下apex上传到您的组织。</strong>将以下代码保存到您的组织将为您的流程构建者和流程提供一个Apex操作，该操作将打包您的变量，并将它们发送到您在上面创建的工作流。</li><li id="bc01" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">自动化！</strong>用你最喜欢的Process Builder或者Flow给slack发消息！</li></ol><h1 id="c62f" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">为什么？</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/8eb9c983240288af12cdb12de7e77f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBUXuahKStcSehE1lB0kkg.png"/></div></div></figure><p id="ef41" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您和我一样，当您的Salesforce组织中的记录数据发生变化时，您觉得有必要向Slack发送消息。而且，如果你真的像我一样，你可能没有一个强有力的案例来呈现给你的管理员，为什么你的应用程序需要访问传入的网络钩子。幸运的是，有一种轻量级的方法可以通过编程将消息发布到Slack，而不需要请求访问。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="91dc" class="mg mh iq bd mi mj ng ml mm mn nh mp mq jw ni jx ms jz nj ka mu kc nk kd mw mx bi translated">它是如何工作的</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/ffc71e4997c363aaa37feba1c8d561ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZg1QHIyFSsBsyffwpsaMA.png"/></div></div></figure><ul class=""><li id="3a8c" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nm ly lz ma bi translated">3个组件:</li><li id="360c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nm ly lz ma bi translated">Salesforce流程/流程构建器</li><li id="dc92" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nm ly lz ma bi translated">Salesforce可调用方法</li><li id="860b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nm ly lz ma bi translated">带有Webhook的松弛工作流</li></ul><p id="be0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面我们有一个流程中的Apex动作的例子，它让我们定义4个变量发送到Slack，加上发送到的端点的URL。通过将流中的apex操作与非常简单的Slack工作流相结合，我们可以向Slack发送包含来自源系统的数据片段的自动化消息。</p><p id="329e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于该工具包中的时差变量是通用文本变量，您可以非常有创造性地使用Salesforce公式字段。下面是一个流程构建器的例子，它在团队达到x点时向团队表示祝贺。您可以在公式中看到，我们向Slack传递了3个变量；<strong class="ky ir">端点</strong>，它告诉我们要引用哪个工作流；和<strong class="ky ir"> Var1 </strong>，它连接几个记录变量的字符串；<strong class="ky ir"> Var2 </strong>，(不在视野内)发出行动号召。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/662dade7b9eded32827b4dd36fdc6315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4znALBm1IsbuwzJX-SK9LQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/38a578b502db2b098ad0052b0695db44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dG9ND3KoNtWPIkzS-KpbHA.png"/></div></div></figure></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="7d06" class="mg mh iq bd mi mj ng ml mm mn nh mp mq jw ni jx ms jz nj ka mu kc nk kd mw mx bi translated">自己试试吧！</h1><h2 id="55f0" class="np mh iq bd mi nq nr dn mm ns nt dp mq lf nu nv ms lj nw nx mu ln ny nz mw oa bi translated">创建宽松的工作流程</h2><p id="d0a7" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">首先在Slack中创建一个工作流。您可以通过在任何聊天界面中键入<code class="fe og oh oi oj b">/workflow</code>来访问工作流构建器。创建新工作流程时，选择<strong class="ky ir"> Webhook </strong>选项。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/5588fef8e737517ca8ff66509c58f32f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_LzJH7yQTh9vDpEQwfg24w.png"/></div></div></figure><h2 id="fb26" class="np mh iq bd mi nq nr dn mm ns nt dp mq lf nu nv ms lj nw nx mu ln ny nz mw oa bi translated">生成Webhook</h2><p id="7a16" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">一旦你创建了你的Webhook工作流，是时候添加一些变量了。创建4个名为Var1 — Var4的变量。点击<strong class="ky ir">保存</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/71d86239b20af098a5bdaf100b2f97e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*okQRfKgsbNbqcIv5ZORV4Q.png"/></div></div></figure><p id="4e0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在<strong class="ky ir">发布</strong>你的流量。一旦您发布了您的流量，您将可以选择复制Webhook URL。这是Salesforce将用来识别其向哪个流发送消息的端点。</p><p id="2759" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此URL是您创建的工作流的开放端点，这意味着任何具有该URL的人都可以发布到您的工作流。保存此URL以供以后参考。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/b0e9e7f8201eafbb5d70d7a1ddf16184.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qbpko_qdqlsobUffzWqQ9A.png"/></div></div></figure><p id="026e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加将消息发布到松弛通道的步骤。将变量插入消息并保存。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/f9ec974d2126b36a1e75faa04ea8fff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M8zyhMa7fQgUoE3aA8TJbg.png"/></div></div></figure><h1 id="4aa2" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">插图的编号</h1><p id="56c0" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated"><code class="fe og oh oi oj b">SlackWorkflowCallout</code>类将获取您在流程中分配的变量，将它们放入一个JSON字符串中，并将它们发送到我们上面创建的端点。将以下代码复制到您的org和<code class="fe og oh oi oj b">save</code>中。</p><pre class="kg kh ki kj gt oo oj op oq aw or bi"><span id="5995" class="np mh iq oj b gy os ot l ou ov">global class SlackWorkflowCallout{<br/>    @future(callout=true)<br/>    global static void makePostCallout(String Endpoint,String Var1,String Var2,String Var3,String Var4) {<br/>        Http http = new Http();<br/>        HttpRequest request = new HttpRequest();<br/>        // Set the endpoint of the Slack Work Order Webhook<br/>        request.setEndpoint(Endpoint);<br/>        request.setMethod('POST');<br/>        request.setHeader('Content-Type', 'application/json;charset=UTF-8');<br/>    <br/>        // Set the body as a JSON object<br/>        request.setBody('{"Var1": "'+Var1+'","Var2": "'+Var2+'","Var3": "'+Var3+'","Var4": "'+Var4+'"}');<br/>        HttpResponse response = http.send(request);</span><span id="9137" class="np mh iq oj b gy ow ot l ou ov">        // Parse the JSON response<br/>        if (response.getStatusCode() != 201) {<br/>             System.debug('The status code returned was not expected: ' +<br/>        response.getStatusCode() + ' ' + response.getStatus());<br/>        } else {<br/>            System.debug(response.getBody());<br/>        }<br/>    }<br/>}<br/>//gegu</span></pre><h1 id="185d" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">可调用方法</h1><p id="edfe" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">以下代码将创建一个可以在您的流程中使用的Apex操作。</p><p id="4d99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe og oh oi oj b">PostToSlackWorkflow</code>类正在创建一个可以在您的流中引用的<code class="fe og oh oi oj b">invocableMethod</code>和<code class="fe og oh oi oj b">InvocableVariables</code>。</p><p id="9520" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个类将获取变量，并将它们放入上面引用的JSON字符串中。将以下代码复制到您的组织并保存。</p><pre class="kg kh ki kj gt oo oj op oq aw or bi"><span id="74f7" class="np mh iq oj b gy os ot l ou ov">public class PostToSlackWorkflow {</span><span id="ba71" class="np mh iq oj b gy ow ot l ou ov">    // define the variables that you will access from the flow. <br/>    public class Message {<br/>        @InvocableVariable(label='Endpoint' description='Slack Flow Webhook URL')<br/>        public String Endpoint;<br/>        @InvocableVariable(label='Var1' description='Var1')<br/>        public String Var1;<br/>        @InvocableVariable(label='Var2' description='Var2')<br/>        public String Var2;<br/>        @InvocableVariable(label='Var3' description='Var3')<br/>        public String Var3;<br/>        @InvocableVariable(label='Var4' description='Var4')<br/>        public String Var4;</span><span id="81d4" class="np mh iq oj b gy ow ot l ou ov">    }<br/>    // pass the variables to the callout class / method. You break the variables and the callout into <br/>    // separate classes so the callout can run asynchronously... there's probably a better way. <br/>    @InvocableMethod(label='Post Message to Slack Channel')<br/>    public static void PostSlackMessage(List&lt;Message&gt; messageList) {<br/>        for(Message m : messageList) {            <br/>            if(Limits.getFutureCalls() &gt;= Limits.getLimitFutureCalls()) {<br/>                System.debug(LoggingLevel.ERROR, 'Future callout limit exceeded. Skipping records.');<br/>            } else {<br/>                SlackWorkflowCallout.makePostCallout(m.Endpoint, m.Var1, m.Var2, m.Var3, m.Var4); //gegu<br/>            }<br/>        }<br/>    }<br/>}</span></pre><h1 id="894c" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">流动</h1><p id="7346" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">将<strong class="ky ir">posttoslackflow</strong>操作添加到您的流程中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/0a1da9ac0a59d6e6f2e733a9d206fb7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*QyrO7naZuExDK77GewWfMg.png"/></div></figure><p id="d085" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将<strong class="ky ir">端点URL </strong>添加到<strong class="ky ir">端点</strong>变量中。在var 1-var 4字段中添加您想要在消息中显示的任何输入，然后<strong class="ky ir">保存。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/747ff45d549d9f81073316723a84304a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FLdiO7558VHVqrrAyDtAqQ.png"/></div></div></figure><p id="e753" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！借助Salesforce流程的强大功能和灵活性，您现在可以向您最喜欢的Slack频道发帖。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/374a3741c9fd503c87572a5fcffb4042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IOpPJutS9kYEKEluofhHXw.png"/></div></div></figure><h1 id="6372" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated"><strong class="ak">补充阅读</strong></h1><p id="2a67" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated"><a class="ae kv" href="https://slack.com/help/articles/360041352714-Create-more-advanced-workflows-using-webhooks" rel="noopener ugc nofollow" target="_blank"> Slack Webhook开发者指南</a></p></div></div>    
</body>
</html>