<html>
<head>
<title>How To Make Your WordPress Site Safe and Fast With Amazon CloudFront</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Amazon CloudFront让你的WordPress站点安全快速</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-your-wordpress-site-safe-and-fast-with-amazon-cloudfront-444c2c7df50e?source=collection_archive---------13-----------------------#2022-08-29">https://betterprogramming.pub/how-to-make-your-wordpress-site-safe-and-fast-with-amazon-cloudfront-444c2c7df50e?source=collection_archive---------13-----------------------#2022-08-29</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="008f" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">这个强烈推荐的程序的简要指南</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/eea3c5fcaf8102cda8661c43b7a5c225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YmSeavMXXrI1eXSep-an1A.jpeg"/></div></div><p class="ks kt gk gi gj ku kv bd b be z dk translated">来源:<a class="ae kw" href="https://pixabay.com/hu/photos/wordpress-k%c3%a9z-embl%c3%a9ma-h%c3%a1tt%c3%a9rk%c3%a9p-589121/" rel="noopener ugc nofollow" target="_blank">https://pix abay . com/Hu/photos/WordPress-k % C3 % a9z-embl % C3 % a9ma-h % C3 % a1tt % C3 % a9rk % C3 % a9p-589121/</a></p></figure><p id="1125" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><a class="ae kw" href="https://wordpress.org/" rel="noopener ugc nofollow" target="_blank"> WordPress </a>是最流行的内容管理系统之一。安装简单，使用方便，还有成千上万的插件和模板，让网站开发超级容易，超级快。但它的优点也是缺点，因为页面生成需要大量资源，WordPress不仅是最流行的系统之一，也是最容易受到攻击的系统之一。</p><p id="7fe1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在很多情况下，一个简单的静态网页就足够了，但是WordPress是一个更方便的解决方案。博客或产品网站就是一个很好的例子。你必须选择一个模板，设置颜色和其他一些东西，上传内容，瞧，你有一个功能齐全的网站，有一些工作时间。在这些情况下，CloudFront可以成为一个优秀的解决方案，让您的网站变得快速、可伸缩和安全。</p><p id="db62" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><a class="ae kw" href="https://aws.amazon.com/cloudfront/" rel="noopener ugc nofollow" target="_blank">亚马逊CloudFront </a>是一个<a class="ae kw" href="https://en.wikipedia.org/wiki/Content_delivery_network" rel="noopener ugc nofollow" target="_blank">内容交付网络</a>。全球分布式缓存系统。当用户试图通过CloudFront访问你的内容时，系统会将请求路由到最近的边缘服务器，如果内容存在，边缘服务器会提供内容，或者从你的WordPress服务器请求内容。</p><p id="d803" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在这种情况下，WordPress就像一个静态页面生成器，生成CloudFront服务的页面。你的站点的资源消耗将会非常低，因为CloudFront只请求一次内容，如果需要的话，它会提供上百万次。你可以通过仅仅使用你的WordPress的一个微实例来处理数百万用户的极高流量！</p><p id="1e55" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这个系统的另一个优点是只有CloudFront部分是公开的。你的WordPress对外界是隐藏的，所以没有人能攻击或黑掉它。在云锋后面，你的原点是最安全的。</p><p id="ad2b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">要将CloudFront添加到你的WordPress站点，在AWS控制台上设置一个CloudFront发行版。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj lt"><img src="../Images/cad35743de2be8aa2bee00876aa9c64b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XTCklXgXhsL2KeL8Zay3Bw.png"/></div></div></figure><p id="a19f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">将源域设置为你当前WordPress站点的URL，并给你的发布命名。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj lt"><img src="../Images/b6aada3080635d79a01e5f92bf190bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QPiogLq0-ObmaD0kJXHPEg.png"/></div></div></figure><p id="3ecb" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在“设置”块中选择一个备用域。这将是一个新的域名，你可以通过CloudFront访问你的WordPress站点。</p><p id="4065" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果部署完成，复制CloudFront域名，并为其创建一个CNAME记录。例如，如果您的备用域是www.example.com，CloudFront域是d3qu6ceheilwux.cloudfront.net，那么添加一个</p><pre class="kh ki kj kk gu lu lv lw lx aw ly bi"><span id="1e49" class="lz ma ir lv b gz mb mc l md me">www.example.com CNAME d3qu6ceheilwux.cloudfront.net</span></pre><p id="e6c8" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">记录到您的DNS区域文件。</p><p id="21ff" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果一切顺利，你会在<a class="ae kw" href="http://www.example.com/?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank">www.example.com</a>看到你的网站。点击新网站上的链接会回到原来的WordPress网站。为了防止这种情况，请将这两行代码添加到wp-config.php的开头:</p><pre class="kh ki kj kk gu lu lv lw lx aw ly bi"><span id="69d5" class="lz ma ir lv b gz mb mc l md me">if($_SERVER['HTTP_USER_AGENT'] == 'Amazon CloudFront') {<br/>    define( 'WP_HOME', '... new site URL …' );<br/>    define( 'WP_SITEURL', '... new site URL …' );<br/>} else {<br/>    define( 'WP_HOME', '... original site URL …' );<br/>    define( 'WP_SITEURL', '... original site URL …' );<br/>}</span></pre><p id="799d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">CloudFront的用户代理是“Amazon CloudFront”，所以当CloudFront读取网站内容时，它会获得新的URL，但当我们访问它进行管理时，它会使用原来的URL。修改之后，链接将指向CloudFront URLs(例如:www.example.com)。</p><p id="1ddd" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">恭喜你！你已经为你的WordPress站点设置了CloudFront。我们差不多完成了，但是我保证会提高安全性，我们的原始站点仍然是公开的。防止对原始站点进行攻击的最简单方法是使用强密码添加HTTP身份验证。</p><p id="57f7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果使用Nginx，可以使用htpasswd实用程序生成密码文件:</p><pre class="kh ki kj kk gu lu lv lw lx aw ly bi"><span id="77b9" class="lz ma ir lv b gz mb mc l md me">htpasswd -c /etc/nginx/htpasswd wordpress</span></pre><p id="b37c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">可以添加到您的配置中的:</p><pre class="kh ki kj kk gu lu lv lw lx aw ly bi"><span id="f16d" class="lz ma ir lv b gz mb mc l md me">auth_basic           "Password protected content";<br/>auth_basic_user_file /etc/nginx/htpasswd;</span></pre><p id="4a89" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">CloudFront可以在访问源时发送HTTP头，这样您就可以将auth头添加到它的配置中。auth头看起来像这样:</p><pre class="kh ki kj kk gu lu lv lw lx aw ly bi"><span id="4198" class="lz ma ir lv b gz mb mc l md me">Authorization: Basic {base64encode({user}:{password})}</span></pre><p id="c0b0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">因此，如果您的用户名是abc，密码是123，那么auth头将是:</p><pre class="kh ki kj kk gu lu lv lw lx aw ly bi"><span id="bc9c" class="lz ma ir lv b gz mb mc l md me">Authorization: Basic YWJjOjEyMw==</span></pre><p id="a372" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">可以使用任何一个<a class="ae kw" href="https://www.base64encode.org/" rel="noopener ugc nofollow" target="_blank">在线base64编码器</a>生成报头。如果您生成了标题，请将其添加到您的源配置中。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj lt"><img src="../Images/4820d7df33b0d5b90edd55911f46ce7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*heyu-5qd9DU8mCwOnv936Q.png"/></div></div></figure><p id="7e14" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">部署完成后，CloudFront将通过CloudFront公开访问您的站点，但原始站点将受到密码保护。为了保护你的网站，你可以每月更改密码，并设置<a class="ae kw" href="https://www.fail2ban.org" rel="noopener ugc nofollow" target="_blank"> fail2ban </a>来防止暴力攻击。</p><p id="4667" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我想说的最后一件事是无效。CloudFront的默认行为是每天只刷新一次内容，所以如果你改变了什么，不想等一天，就必须删除缓存。CloudFront使用失效来实现这一点。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj lt"><img src="../Images/590187efb8a9e8414f9715c2ec85e07f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nfHFsVxx8SnCctr-26l5Nw.png"/></div></div></figure><p id="2e94" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果您想从缓存中删除一个或多个文件，您必须创建一个失效。无效是向边缘服务器广播消息，以删除给定内容。失效参数是可以包含* <em class="mf">的文件路径列表。</em>如果要完全删除缓存，使用“/*”。</p><p id="a16e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如你所见，CloudFront是一个完美的解决方案来扩展你的WordPress站点并使其安全。通过使用它，您的站点可以服务数百万用户，并且您只需要在CloudFront后面有一个微实例。这个解决方案不是WordPress特有的。您可以将它用于任何不使用服务器端交互的站点。</p><p id="f51e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在某些情况下，它需要一点点不同的思维。例如，你必须使用托管评论服务，如Disqus或脸书评论，或者如果你在你的网站上有一个网店，你必须将它组织到另一个域作为一个单独的服务。但我认为，对于安全性和无缝、快速、可扩展的内容服务来说，这是一个非常低的价格。</p></div></div>    
</body>
</html>