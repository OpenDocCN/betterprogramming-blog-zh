<html>
<head>
<title>How To Add a Sticky Column by Using iOS 13 Compositional Layout</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用iOS 13合成布局添加粘性栏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-add-sticky-column-by-using-compositional-layout-in-ios-6cb67f8f7458?source=collection_archive---------9-----------------------#2021-04-06">https://betterprogramming.pub/how-to-add-sticky-column-by-using-compositional-layout-in-ios-6cb67f8f7458?source=collection_archive---------9-----------------------#2021-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="208e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建带有粘性栏的电子表格式现代收藏视图</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c911bf71c07080ab96ad3a252ae43fcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nsmk36gSPNYrdThr7IIzrA.gif"/></div></div></figure><p id="bb9c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">实现spreadsheetlike类集合视图的老方法是通过继承定制<code class="fe lq lr ls lt b">UICollectionViewFlowLayout</code>。你可以循环每个条目来计算<code class="fe lq lr ls lt b">UICollectionViewLayoutAttributes</code>，但是滚动容易出错而且复杂。</p><p id="5727" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">UICollectionViewCompositionalLayout</code>，已经推出一段时间了，是配置现代收藏视图的方式。我一直很好奇如何在一个高度可配置的布局中制作这种类似spread的收藏视图。先从一个粘性的专栏开始发掘它的潜力吧！</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="b9e7" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">作为Swift包的可重用代码</h1><p id="3b2b" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">完成的代码已被制成一个Swift包，可以在您的项目中轻松集成和重用。它可以在这里找到:</p><div class="my mz gp gr na nb"><a href="https://github.com/ericleiyang/CompositionalLayoutSpreadsheet" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">ericleiyang/composition layout spreadsheet</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">要运行示例项目，克隆repo，并从示例中运行compositionallayoutspreadsheetexample . xcode proj…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ks nb"/></div></div></a></div></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/96f96cdb6f6d7e87b9ad7a07f8358c59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*aEmcIk92-SupiEiLiW9gqQ.png"/></div></figure><h1 id="b5a5" class="mb mc it bd md me nr mg mh mi ns mk ml jz nt ka mn kc nu kd mp kf nv kg mr ms bi translated">1.补充视图坚持在左侧</h1><p id="50f2" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">我们可以使用不同的对齐方式在该部分添加<code class="fe lq lr ls lt b">NSCollectionLayoutBoundarySupplementaryItem</code>。为了粘在左边的部分，我们选择了<code class="fe lq lr ls lt b">.leading</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="8ddf" class="ny nz it kw b kx ky la lb ld oa lh ob ll oc lp od oe of og bi translated">粘性列被固定在可见边界上，成为粘性列</li><li id="cda4" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">设置补充视图的<code class="fe lq lr ls lt b">zIndex</code>，使其在滚动时可见</li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="0bf6" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">2.可水平滚动的部分</h1><p id="0e5a" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">该部分应该是水平可滚动的，因此我们将该部分的正交滚动行为设置为<code class="fe lq lr ls lt b">.continuous</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="3a2a" class="ny nz it kw b kx ky la lb ld oa lh ob ll oc lp od oe of og bi translated">将<code class="fe lq lr ls lt b">orthogonalScrollingBehavior</code>设置为<code class="fe lq lr ls lt b">.continue</code>以启用水平滚动</li><li id="bf65" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">在该部分的<code class="fe lq lr ls lt b">boundarySupplementaryItem</code>处增加了补充视图</li><li id="3917" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">部分内容插图设置为在左侧显示粘性栏</li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="1a6b" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">3.在粘性栏中累积视图</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d53208b36c68576f99260ab6de0e9f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*c15j1kRh2IEFuJ7yAy4NlA.png"/></div></figure><p id="f4fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们创建了具有相同高度的值单元格的<code class="fe lq lr ls lt b">StickCellView</code>,并将实例一个接一个地累积起来，形成粘性列。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="54b2" class="ny nz it kw b kx ky la lb ld oa lh ob ll oc lp od oe of og bi translated">sticky-cell视图只包含一个用于显示列值的<code class="fe lq lr ls lt b">UILable</code>。以后可以定制。</li><li id="a0e8" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">每个单元格的样式由配置功能设置</li><li id="6ff5" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">默认情况下，文本居中对齐</li><li id="43c5" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">传入的文本可归因于所需的颜色和/或字体</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="d792" class="ny nz it kw b kx ky la lb ld oa lh ob ll oc lp od oe of og bi translated"><code class="fe lq lr ls lt b">StickyColumnView</code>根据传入的数据排列每个<code class="fe lq lr ls lt b">StickCellView</code></li><li id="06e5" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">每个<code class="fe lq lr ls lt b">StickCellView</code>的<em class="om"> y </em>位置按照数据数组的顺序计算</li><li id="c879" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">根据数据编号在<code class="fe lq lr ls lt b">UICollectionViewCompositionalLayout</code>处计算出<code class="fe lq lr ls lt b">StickyColumnView</code>的高度。</li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="ecaf" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">4.水平滚动部分的层次结构</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/8e1ae3028e2352f83aa34b798adc0438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*dqGzj95AFSggC2_--BWaTA.png"/></div></figure><p id="ff8e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">节的层次从<code class="fe lq lr ls lt b">ValueCell</code>开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="19f8" class="ny nz it kw b kx ky la lb ld oa lh ob ll oc lp od oe of og bi translated">每个单元格只包含一个<code class="fe lq lr ls lt b">UILable</code>来显示值</li><li id="8831" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">该值作为<code class="fe lq lr ls lt b">NSAttributedString</code>被传入，以定制文本颜色和字体</li><li id="70e8" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">默认情况下，文本居中对齐</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="833c" class="ny nz it kw b kx ky la lb ld oa lh ob ll oc lp od oe of og bi translated">在<code class="fe lq lr ls lt b">NSCollectionLayoutGroup</code>添加水平布局的项目</li><li id="3dd9" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">水平组根据行数添加到垂直<code class="fe lq lr ls lt b">NSCollectionLayoutGroup</code></li><li id="29e0" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">垂直组的高度是根据行数和每行的高度计算的</li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="8c86" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">5.粘性列的数据</h1><p id="87db" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">虽然sticky列的单元格是垂直对齐的，但它们可以由一维数组表示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="b278" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">6.截面数据</h1><p id="d621" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">对于电子表格，通常按行组织数据。但是，组合布局的垂直组表示列中的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="18ca" class="ny nz it kw b kx ky la lb ld oa lh ob ll oc lp od oe of og bi translated">我们需要旋转二维数组以适应垂直组，从而实现所需的表示顺序</li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="c472" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">7.用法示例</h1><p id="6980" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated"><a class="ae on" href="https://github.com/ericleiyang/CompositionalLayoutSpreadsheet" rel="noopener ugc nofollow" target="_blank">完成的电子表格布局</a>被包装成一个Swift包，以便在不同的项目中重用。</p><p id="28a3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要使用Swift包，我们只需使用Xcode的Swift包管理器来添加它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/f47f80edd7beea749be4cb70e401b3d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iXnLHEWnUHOaaDhihU5-aQ.png"/></div></div></figure><p id="7aef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在示例项目中，我们初始化<code class="fe lq lr ls lt b">CompositionalLayoutSpreadsheet</code>，然后使用<code class="fe lq lr ls lt b">configureHierarchy</code>函数将电子表格添加到视图控制器中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="f387" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">示例数据如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><ul class=""><li id="bf06" class="ny nz it kw b kx ky la lb ld oa lh ob ll oc lp od oe of og bi translated">它包含50行数据</li><li id="7bc5" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">用<code class="fe lq lr ls lt b">row</code>和行的顺序创建粘性单元</li><li id="4121" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">有20列数据</li><li id="384c" class="ny nz it kw b kx oh la oi ld oj lh ok ll ol lp od oe of og bi translated">数值单元格是用<code class="fe lq lr ls lt b">data</code>和行与列的索引创建的</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/d9b66dc1190a1e56d0696dd33fb100b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*0mGenooewdHSKZAgfSzvdQ.png"/></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="9b9f" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">8.结论</h1><p id="e060" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">我们使用了一个复合布局来制作一个spreadsheetlike样的集合视图，在左边有一个粘性列。比传统的使用方式<code class="fe lq lr ls lt b">UICollectionViewFlowLayout</code>干净多了。集合视图的组件易于配置和调整。</p><p id="190b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">带有使用示例的可重用布局可在以下Swift包中找到:</p><div class="my mz gp gr na nb"><a href="https://github.com/ericleiyang/CompositionalLayoutSpreadsheet" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">ericleiyang/composition layout spreadsheet</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">要运行示例项目，克隆repo，并从示例中运行compositionallayoutspreadsheetexample . xcode proj…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ks nb"/></div></div></a></div><p id="674c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我希望你喜欢这篇文章。我很想听听你们的想法，回答你们可能有的任何问题！</p></div></div>    
</body>
</html>