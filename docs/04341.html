<html>
<head>
<title>How to Run Windows on Linux Using Xen</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Xen在Linux上运行Windows</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-run-windows-on-linux-using-xen-12e046f86348?source=collection_archive---------1-----------------------#2020-04-07">https://betterprogramming.pub/how-to-run-windows-on-linux-using-xen-12e046f86348?source=collection_archive---------1-----------------------#2020-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="93b4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">比双引导更好</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/41923b607f032b5cc8b3800b5403f438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y2OUCbjIc6Cs4QshfCWqUA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Xen熊猫</p></figure><p id="5fb0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">警告 : <strong class="kx ir"> </strong>我绝不是这方面的专家。我只是顽固不化，顽固到足以成功地让这样的设置为自己工作。</p><p id="679b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个涉及到真正挖掘你的硬盘驱动器的底层，并有可能真正破坏东西的话题。</p><p id="7e39" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我写这篇文章是因为我真的找不到任何关于这方面的可靠文档，我认为这是双引导的一个很好的替代方案，比一般的虚拟机设置好得多。继续进行，后果自负！</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="5284" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">介绍</h1><p id="d4e5" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">假设你刚刚得到一台崭新的笔记本电脑。恭喜你！你需要摆脱那个老怪物，并期待着你的新机器有一个光明的未来。</p><p id="3525" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，如果你正在读这篇标题的文章，你的新机器可能装有视窗系统，或者根本没有操作系统。你知道你真的想在你的机器上运行Linux，因为你非常酷(因为它不太容易监视你或感染病毒，因为如果你是一名开发人员，一旦你习惯了它，就很难回头，但现在让我们坚持完全酷)。</p><p id="6db7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，你不确定你已经准备好完全摆脱Windows。可能有一些程序在Linux上很难运行。(<a class="ae mv" href="https://www.winehq.org/" rel="noopener ugc nofollow" target="_blank">葡萄酒</a>可以涵盖其中一些，但正如他们的数据库显示，肯定不是全部。)</p><p id="f0ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">也许是怀旧，安慰，或者是未确诊的受虐狂。无论如何，让我们谈谈你的选择:</p><ul class=""><li id="028b" class="mw mx iq kx b ky kz lb lc le my li mz lm na lq nb nc nd ne bi translated">独立的Linux和Windows机器。</li><li id="9611" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">Linux和Windows的双重引导。</li><li id="e3c4" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">在虚拟机中运行Windows。</li></ul><p id="f1a6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">即使你买得起第一个，我也不确定。你将被分成两台机器。你打算每天都带着它们去上班，插上电源，把它们放在办公桌上，然后在键盘之间切换吗？如果你想的话，当然可以，但是我们继续找吧。</p><p id="5576" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从很多方面来说，双引导都是经典的答案。对于那些不知道的人来说，这意味着计算机可以识别两种不同的操作系统，并在启动时让你选择使用哪一种。</p><p id="5e83" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一般来说，有一个是优先的，如果五到十秒钟后没有选择，计算机将默认为优先。您可以从您的计算机BIOS/UEFI菜单中选择哪个具有优先级，您可以在启动时通过按enter、F1、F2或某些其他按钮(取决于您的计算机制造商)来输入。</p><p id="a39a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这里，你可以在同一台机器上运行Windows和Linux，一切似乎都很好，对吗？不过，我想我们还是可以期待更好的结果。</p><p id="ff5c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，这两个操作系统根本不能相互通信。例如，如果你想把一个文件从Windows转移到Linux，在我看来，最简单的方法是启动到任何一个有这个文件的操作系统，把它复制到一个USB上，或者通过邮件/信息发给你自己，然后重新启动到另一个操作系统，然后把它从USB上拉回来或者下载它。</p><p id="f5ea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，似乎还有一个与操作系统更新有关的问题。当你对双引导进行分区时，本质上你告诉每个操作系统:“嘿，你不能占用这台计算机上的所有空间，只能占用这两个地址之间的空间，”然后把地址分发给每个操作系统，这样它们就不会互相覆盖。</p><p id="87d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当操作系统更新(尤其是Linux GRUB更新)时，它似乎有时会忘记您的初始请求，并开始越过它应该能够访问的地址向磁盘写入数据。这可能会开始覆盖Windows的随机部分。坏消息。</p><p id="c6cd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我有一次双开机，过了某个点就再也登录不了Windows了。它会识别正确的密码，然后把我直接转到登录屏幕上。GRUB意外覆盖Windows可能是罪魁祸首。</p><p id="531e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你仍然真的想进行双引导，请继续阅读。我认为Xen也可能有助于缓解这个问题。</p><p id="c448" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们可以在需要的时候启动Linux并简单地打开它上面的Windows，那不是很好吗？这就是虚拟机试图解决的问题。</p><p id="d337" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虚拟机是一个巧妙的小魔术。它们是一个程序，可以对操作系统说:“嘿，对你来说我看起来像一台硬件计算机，对吗？”并且在你的计算机上的程序中运行操作系统。</p><p id="0317" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些工具已经变得非常好了，你应该能够拖放文件，还有其他功能。</p><p id="b0d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不过，这也有不好的一面。假设你保留Windows的主要原因是你最喜欢的图形渲染器或AAA游戏。你已经有了强大的内存和专用的GPU。</p><p id="91e1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">记住，虚拟机是一个程序，并不真正访问你的硬件。你会运行这些程序，就好像你根本没有这些程序一样。(说实话，你也许可以给你的VM分配RAM，但我不认为大多数常见的VM选项允许GPU通过。)</p><p id="48d5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果有一个像虚拟机一样工作的东西，允许我们在Linux上随意启动它，但允许访问计算机上的底层硬件，这不是很好吗？</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="7e89" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">输入Xen</h1><p id="04cb" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">裸机虚拟机管理程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/33307ff556ce8ca42efde948f025d5da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*d87pU-Xvf5_vOnMwm4G2kw.jpeg"/></div></div></figure><p id="df34" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我认为每篇文章中都有一个必不可少的图表，看起来像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/d97b82a8f7dd8623b0ccfbf5653b0420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ecxAfx5sGXtp3MJSjgRNA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图表来自<a class="ae mv" href="https://about.gitlab.com/blog/2017/11/30/containers-kubernetes-basics/" rel="noopener ugc nofollow" target="_blank"> GitLab，</a>，经知识共享许可协议许可，在此复制</p></figure><p id="a77a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">它证明了这正是Xen努力要做的。如果当你看到“1型管理程序”这样的短语时，你的眼睛开始流泪，不要担心。第1类虚拟机管理程序是一种“裸机”虚拟机管理程序，我们将解释这意味着什么。</p><p id="abb6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="nm">裸机</em>意味着您创建的虚拟机将在您的硬件上运行，而<em class="nm">虚拟机管理程序</em>(在本例中)意味着它通过在引导过程中添加一个步骤来实现这一点。您的计算机不是直接引导到Linux，而是首先引导到Xen，然后Xen启动您的主操作系统(当然是Linux)。</p><p id="3e19" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我之前说过，如果你有一个双引导设置，我认为Xen甚至可能是一个帮助。这就是虚拟机管理程序的原因。如果你有一个双引导并且在Linux上安装了Xen，它也会识别Windows引导加载程序。(屡试不爽。)</p><p id="638f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本质上，你不仅仅是告诉这两个操作系统应该坐在内存地址表的哪一边，你甚至雇佣了Xen来确保它们友好地工作。</p><p id="c114" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我不能保证这是对操作系统更新覆盖他们不幸室友的完整解决方案，但它是合理的。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="8005" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">本教程的目标</h1><p id="a42c" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">我们假设你有一台Windows电脑，你想把它变成一台<a class="ae mv" href="https://www.debian.org/" rel="noopener ugc nofollow" target="_blank"> Debian </a>机器，可以使用Xen随意启动Windows。</p><p id="aecc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在列出基本步骤。如果你不理解这些术语，不要担心。我们将尽可能清晰地浏览所有内容。他们在这里:</p><ul class=""><li id="77f9" class="mw mx iq kx b ky kz lb lc le my li mz lm na lq nb nc nd ne bi translated">在Windows中，提取产品密钥并对大部分硬盘进行分区。</li><li id="bee9" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">安装Debian(你需要一个新的/一次性的USB驱动器)。</li><li id="a9d4" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">从Windows或Debian中分离出另一个块。</li><li id="b92c" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">在Linux上安装LVM，并使用它创建一个卷组。</li><li id="2630" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">安装Xen并下载或提取Windows映像。</li><li id="00a5" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">使用Xen启动Windows。</li><li id="8020" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated">一旦Xen工作，扩展Windows分区来使用所有旧的Windows安装。</li></ul><p id="e536" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">需要明确的是，如果你有一个GPU，你将需要工作一个passthrough out以便在VM内部利用这个卡。这个<em class="nm">可以</em>实现的事实非常酷，但是我不打算在这里讨论它，因为我自己还没有尝试过这样做，而且看起来这是一个高级的话题。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="f795" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">几个注意事项</h1><p id="3c3d" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">首先，此过程将覆盖您的原始Windows安装。如果你在Windows中有程序、文件、链接等等，在线或外部备份它们。否则，它们将被覆盖。</p><p id="c0ac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，这就有点流程了。我当然不会认为这是一个容易的项目，即使它是一个可怕的项目。很可能你会在某个地方卡住。不幸的是，Xen的文档在这一点上很难导航。很难说什么是过时的，什么将解决具体问题。</p><p id="83ec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你的两个最佳选择很可能是Xen IRC或者T2 Xen subreddit。我们经历所有这些步骤的原因之一是，你应该始终拥有一个正常运行的Windows版本，以防中途出现问题。</p><p id="b1e8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，本教程是根据我使用英特尔芯片的计算机的经验编写的，我怀疑下面的内容不适用于运行AMD CPUs的计算机(不过AMD GPUs应该没问题)。</p><p id="a122" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Xen的文档谈到了在英特尔和AMD上运行的一些差异，但不幸的是，我对此没有任何经验。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="cfdd" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">千伏计（kilovoltmeter的缩写）</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/514e24d11f23c38dc06f746d5d0788a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*n__IO3FfQxj_lljL6-MUbw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">BY o . t . s . u .——【https://commons.wikimedia.org/w/index.php?curid=24109871】http://openvirtualizationalliance . org/downloads/KVM-logo _ 300 dpi . png，CC BY-SA 3.0，<a class="ae mv" href="https://commons.wikimedia.org/w/index.php?curid=24109871" rel="noopener ugc nofollow" target="_blank">T7】</a></p></figure><p id="708d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">除了Xen之外的另一个选择是KVM。我没有技术上的理由选择Xen而不是KVM。我只是碰巧先发现了Xen。</p><p id="042f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你有兴趣尝试使用KVM，一个简单的<a class="ae mv" href="https://duckduckgo.com/?q=kvm+windows+10+vm&amp;t=ffab&amp;ia=web" rel="noopener ugc nofollow" target="_blank">搜索</a>会出现大量结果。我想特别提一下我在这个网站上找到的一篇文章，这篇文章深入介绍了如何在KVM <a class="ae mv" href="https://heiko-sieger.info/running-windows-10-on-linux-using-kvm-with-vga-passthrough/" rel="noopener ugc nofollow" target="_blank">上进行GPU直通。</a></p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="4bdc" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">Qubes</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/b1af858e6fec401d969a0f76c108834e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HicdAyuJbIcfR_fY_UvWxw.png"/></div></div></figure><p id="fd46" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我没有提到Qubes OS，我会感到失职。Qubes是一个Linux发行版(一个Linux操作系统),基于基于Xen集成的Fedora。安装它为使用Xen提供了一个很好的界面，他们有很好的文档，他们的IRC也很活跃。</p><p id="eee8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在他们的社区中接触过的大多数人都非常乐于助人。如果你对在Qubes上运行Windows感兴趣，那就想尽一切办法。</p><p id="bf7d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你所需要做的就是从Windows获得产品密钥(下面详细介绍)，制作一个安装USB(下面详细介绍Debian，只需使用Qubes的安装说明)，然后覆盖整个磁盘。之后，按照Qubes自己的教程设置一个Windows HVM。</p><p id="4374" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">出于几个原因，我在本教程中没有使用量子。一个是Debian(和Ubuntu，它是Debian的一个分支)是非常受欢迎的发行版，我不认为仅仅因为我这么说或者因为他们可以在上面运行Windows就假设Debian或Ubuntu的粉丝会安装一个基于Fedora的发行版是合理的。</p><p id="1c26" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">的确，一旦你玩了一点Qubes，你就会明白你真的不需要花时间在Dom0上，它是系统中唯一必须是Fedora的部分，你可以花所有的时间在Debian VMs上，但我觉得谈论Debian更主流。</p><p id="b5de" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另一个原因与性能有关。Qubes的目标是增强隐私和安全性。因此，将GPU连接到虚拟机非常困难。如果你想在Linux上获得最佳性能的Windows，那么Qubes可能不适合你。</p><p id="94a5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">好吧！介绍到此为止！</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="423e" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">我们去兔子洞！</h1><h2 id="b619" class="np lz iq bd ma nq nr dn me ns nt dp mi le nu nv mk li nw nx mm lm ny nz mo oa bi translated">部门窗口</h2><p id="0310" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">定期引导进入Windows。打开<em class="nm">开始</em>菜单，输入“分区”这个词。搜索应该会给你提供一个叫做“分区工具”的选项。点击它。</p><p id="9921" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将打开Windows的分区管理器。分区基本上是硬盘的保留部分。硬盘中的内存有地址，分区表基本上是这样写的:“嘿，Windows，你在分区表中的位置在地址<code class="fe ob oc od oe b">0x00000001</code>和<code class="fe ob oc od oe b">0x2fffffff</code>之间”。</p><p id="71d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你按下<em class="nm">开始</em>按钮并输入“分区”，你将得到打开分区管理器的选项。你应该会看到<code class="fe ob oc od oe b">C/:</code>分区几乎占据了整个电脑，还剩下一点给默认的Windows恢复驱动器。</p><p id="39a9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你右击它，应该有一个选项来调整它的大小。</p><p id="2ede" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">警告</strong>:本教程假设这是全新安装。如果您已经使用此安装有一段时间了，您可能会因调整大小而丢失数据，因此请确保您首先备份所有内容。</p><p id="4a98" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为Windows留出足够的空间来运行您需要它运行的内容。现在很可能没有必要吝啬给Windows留出空间，我们应该能够在本教程的末尾为将在Xen上运行的新Windows安装收回所有空间。</p><p id="ebd5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可能希望在此基础上再留出50GB左右的空间，我们稍后将在新的Windows安装中使用它。或者，在Debian安装过程中，您可以选择不占用所有可用空间，保留50GB不分区，或者稍后从Debian内部进行分区。</p><p id="f59e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我建议现在不要这样做，稍后再从Debian内部将它分割出来，尽管这看起来比一开始就不分配要多得多。这是我将详细介绍的唯一选项。</p><p id="2e4b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您需要做的另一件事是提取您的Windows产品密钥。稍后您将需要它来注册新安装的Windows。</p><p id="5294" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">警告</strong>:我假设这是合法的，Windows安装似乎也暗示了这一点。你有一个合法运行的Windows，只是以不同的方式运行相同的软件，甚至是在同一台机器上。如果有任何问题，请联系我。</p><p id="7a1e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以管理员身份打开命令提示符。您可以通过右键单击<em class="nm">开始菜单</em>图标，或按下<code class="fe ob oc od oe b">Windows Key + X</code>并选择它来完成此操作。(我好像记得PowerShell和admin的工作方式完全一样。)类型:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="80ce" class="np lz iq oe b gy oj ok l ol om">wmic path SoftwareLicensingService get OA3xOriginalProductKey</span></pre><p id="c473" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">记下输出。</p><p id="9b05" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">好了，现在Windows就到此为止。但是不要关闭。我们仍然需要下载Debian来安装它。</p><h2 id="98c2" class="np lz iq bd ma nq nr dn me ns nt dp mi le nu nv mk li nw nx mm lm ny nz mo oa bi translated">安装Debian</h2><p id="252d" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">安装操作系统的一般方法包括创建一个可从启动的USB驱动器(“活动USB”)。我们将下载一个工具，然后您将创建一个Debian驱动器。</p><p id="609b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">当心</strong>！这将删除闪存盘上的所有内容。不仅如此，它很可能会使驱动器无法(可靠地)存储任何东西。这应该被视为你的拇指驱动器的单程旅行，永远降级为Debian安装介质。</p><p id="8b67" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，您也许可以对该驱动器进行重新分区，但即使这样做，它也很有可能不稳定。</p><p id="f8ad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我推荐用鲁弗斯。去<a class="ae mv" href="https://rufus.ie/" rel="noopener ugc nofollow" target="_blank">他们的网站</a>下载程序。</p><p id="3913" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在是时候下载Debian的图像了。Debian网站在不同的页面上提供了许多不同的下载选项。我推荐<a class="ae mv" href="https://www.debian.org/CD/live/" rel="noopener ugc nofollow" target="_blank">这个页面</a>，它会给你两个选项来下载一个实时安装的镜像(我一会儿会解释的):torrent和regular。</p><p id="275a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你熟悉torrenting，这可能是最好的选择，因为它是一个大的安装，如果它停止了，你将能够恢复。无论哪种方式，你最有可能是在寻找图像的amd64版本。</p><p id="fa83" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尽管如此，还是有许多不同的选择(由于不同的桌面环境)；我们将在这里使用GNOME的选项。您正在寻找一个以扩展名<code class="fe ob oc od oe b">.iso</code>结尾的文件。</p><p id="f290" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，Debian 10.3(带Gnome)的amd64实时图像的HTTP下载是<code class="fe ob oc od oe b"><a class="ae mv" href="https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/debian-live-10.3.0-amd64-gnome.iso" rel="noopener ugc nofollow" target="_blank">https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/debian-live-10.3.0-amd64-gnome.iso</a></code>。</p><p id="838e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">什么是实时安装映像？基本上，这意味着你实际上可以从写有操作系统的USB驱动器上启动操作系统。这只是一个额外的小好处，这意味着如果安装中出现问题，您可以从活动USB启动并尝试排除故障。</p><p id="c80f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下载完图像后，使用Rufus将其写入USB。同样，这个USB将永远是一个安装USB。即使您删除了安装媒体(并对其重新分区)，它也很有可能会出现故障。</p><p id="d228" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦你把Debian写到USB上，你可以把它留在里面。你马上就能启动它了。</p><p id="c4be" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">太好了！我们现在准备重启并安装Debian。这是不用说的，但是以防万一:如果你在你将要关闭的窗口中阅读这篇文章，确保你在不同的屏幕中打开它，打印它，或者确保你知道下一步该做什么。</p><p id="2f03" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你需要用USB重启。有些计算机会自动完成这项工作。其他人可能会给你一个引导选择菜单；一个应该是类似“Debian live media installation”的东西。其他的可能会让你进入BIOS/UEFI菜单。</p><p id="86ee" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当电脑启动时，你需要在通常很短的时间内按下某个按钮。许多打开的屏幕都很友好地告诉你是哪个按钮(称之为“高级选项”、“引导选项”、“正常设置中断”或类似的东西)。<code class="fe ob oc od oe b">F1</code>、<code class="fe ob oc od oe b">F2</code>、<code class="fe ob oc od oe b">Esc</code>、<code class="fe ob oc od oe b">Enter</code>都是常见选项。</p><p id="1487" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你真的卡住了，你可能可以在网上查一下——只要搜索你的电脑品牌，然后“进入BIOS”，我想你会找到的。</p><p id="62ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦你进入，应该会有一个启动优先级的菜单或者类似的东西。应该有一个类似“Debian live media”的选项，确保它是顶部的选项，然后确保保存更改(通常在退出BIOS菜单时完成)。这将引导你进入USB，并启动Debian安装程序。</p><p id="b187" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Debian的安装非常简单，所以我不打算详述。我要指出的唯一一点是，你会看到选择占用所有空闲内存(通常是默认的)，覆盖整个磁盘，或者指定你希望Debian安装占用多少空间。</p><p id="938b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我不推荐它，但是因为我们稍后将需要50GB来安装Xen Windows，如果你愿意的话，现在你可以在任何东西上免费安装Debian减去50GB。</p><p id="dd87" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">或者，你可以以后把它从旧的Windows上刮下来，或者从Debian中分离出来。我推荐最后一个选项，只是在所有空闲空间安装，这是我将详细解释的选项。</p><p id="5507" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您选择在整个磁盘上安装，它将覆盖Windows。如果我没弄错的话，你可能仍然可以引导到Windows，但是它的一部分可以在任何时候被Debian任意改写，所以如果你仍然对使用旧的Windows系统感兴趣的话，现在不推荐这样做。</p><p id="9658" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">安装完成后，系统应该会重新启动。当它打开时，你应该拔出u盘。如果你的电脑自动启动到实时USB，它会重新加载Debian安装程序，如果你不这样做。</p><p id="ab76" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">重启时你可能需要在Debian和Windows之间做出选择，Windows可能是默认的。</p><p id="7a5e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您在旧的Windows中留下了额外的50GB，现在是启动到Windows并再分区50GB的好时机。之后，启动Debian。</p><h2 id="7065" class="np lz iq bd ma nq nr dn me ns nt dp mi le nu nv mk li nw nx mm lm ny nz mo oa bi translated">在Debian上设置Xen</h2><p id="c3c7" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">(我打算掩饰一下Debian的设置。如果你对Debian完全陌生，你应该知道默认情况下它没有默认用户的<code class="fe ob oc od oe b">sudo</code>。</p><p id="d820" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关于如何将你的用户添加到<code class="fe ob oc od oe b">sudo</code>中，网上有很多好的指南(如下)，我们假设你已经这样做了。最坏的情况是，你可以输入<code class="fe ob oc od oe b">su</code>进入超级用户模式，这就像在每个命令前输入<code class="fe ob oc od oe b">sudo</code>。)</p><ul class=""><li id="804d" class="mw mx iq kx b ky kz lb lc le my li mz lm na lq nb nc nd ne bi translated"><a class="ae mv" href="https://linoxide.com/linux-how-to/add-user-to-sudoers-on-debian/" rel="noopener ugc nofollow" target="_blank">如何在Debian上给Sudoers添加用户</a></li><li id="5144" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><a class="ae mv" href="https://linuxize.com/post/how-to-add-user-to-sudoers-in-debian/" rel="noopener ugc nofollow" target="_blank">如何在Debian中添加用户到Sudoers</a></li><li id="f058" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><a class="ae mv" href="https://devconnected.com/how-to-add-a-user-to-sudoers-on-debian-10-buster/" rel="noopener ugc nofollow" target="_blank">如何在Debian 10 Buster上给Sudoers添加用户</a></li><li id="e219" class="mw mx iq kx b ky nf lb ng le nh li ni lm nj lq nb nc nd ne bi translated"><a class="ae mv" href="https://www.digitalocean.com/community/tutorials/how-to-add-delete-and-grant-sudo-privileges-to-users-on-a-debian-vps" rel="noopener ugc nofollow" target="_blank">如何在Debian VPS上添加、删除和授予用户Sudo权限</a></li></ul><p id="a948" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在需要在Debian上做一些分区工作。如果你没有剩下50GB，我们需要把它从Debian中分离出来。不管怎样，我们都要将这50GB变成一个<em class="nm">卷组</em>。</p><p id="d555" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(我真希望我做这个的时候笔记做得更好。我正在尽力重建它。)</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="7416" class="np lz iq oe b gy oj ok l ol om">sudo apt install lvm2</span></pre><p id="98eb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(可能已经安装了。)</p><p id="169b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用<code class="fe ob oc od oe b">sudo fdisk -l</code>列出电脑上的各个分区。注意哪一个安装了Debian。在本教程中我们称之为<code class="fe ob oc od oe b">/dev/sda4</code>。不管是什么，前面都应该有<code class="fe ob oc od oe b">/dev/</code>。</p><p id="be07" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">如果您没有50GB的未分配空间</strong></p><p id="9439" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ob oc od oe b">sudo fdisk /dev/sda4</code>应该会把你带入一个特殊的<code class="fe ob oc od oe b">fdisk</code>菜单。键入<code class="fe ob oc od oe b">n</code>创建一个新的分区。您正在寻找一个主分区，我强烈建议您使用默认分区，除非您真的知道自己在做什么。</p><p id="e55c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要使这个分区为50GB，在出现提示的地方输入<code class="fe ob oc od oe b">+50G</code>，可能是在<code class="fe ob oc od oe b">Last sector</code>行。当您回到<code class="fe ob oc od oe b">fdisk</code>命令行时，键入<code class="fe ob oc od oe b">p</code>进行打印，您应该会看到一个新的50GB分区。</p><p id="2926" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">记住它在哪里，我们在这里用<code class="fe ob oc od oe b">sda6</code>。在<code class="fe ob oc od oe b">fdisk</code>命令行上，键入<code class="fe ob oc od oe b">w</code>。您所做的一切都不会被保存(当然也不会被执行)，直到您用<code class="fe ob oc od oe b">w</code>将更改写到磁盘，这也应该会让您退出到常规命令行。(如果需要不保存退出，使用<code class="fe ob oc od oe b">q</code>。)</p><p id="0f13" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">如果您有50GB的未分配空间</strong></p><p id="0b2f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我不打算详细讨论这个，但是你需要一个像<code class="fe ob oc od oe b">parted</code>或<code class="fe ob oc od oe b">cfdisk</code>这样的资源来对它进行分区。从现在开始，我们将这个新分区称为<code class="fe ob oc od oe b">sda6</code>，尽管它在您的系统中可能有不同的名称。</p><p id="e6ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不管怎样，一旦有了新的分区:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="d8eb" class="np lz iq oe b gy oj ok l ol om">sudo pvcreate /dev/sda6</span></pre><p id="ddff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(其中<code class="fe ob oc od oe b">sda6</code>是新的分区。)</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="c687" class="np lz iq oe b gy oj ok l ol om">sudo vgcreate vg0 /dev/sda6</span></pre><p id="53ba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将创建一个名为<code class="fe ob oc od oe b">vg0</code>的卷组。(如果你愿意，你可以用你喜欢的任何名字来代替。)接下来，使用LVM创建一个逻辑卷:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="1753" class="np lz iq oe b gy oj ok l ol om">sudo lvcreate -n win -L 49G vg0</span></pre><p id="e342" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这意味着在<code class="fe ob oc od oe b">vg0</code>上创建一个名为<code class="fe ob oc od oe b">win</code>的逻辑卷，大小为49GB。</p><p id="d018" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(我认为使用全部50GB是不明智的，尽管我并不确定。你也许可以把它刮得更小:当你谈论空闲空间时，1GB是一个很大的空间。)</p><h2 id="918c" class="np lz iq bd ma nq nr dn me ns nt dp mi le nu nv mk li nw nx mm lm ny nz mo oa bi translated">设置Windows HVM</h2><p id="0bcd" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">Xen中有不同种类的虚拟机。</p><p id="bd5e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于Windows，我们将需要一个HVM(硬件虚拟机)，不仅仅是因为它将让我们像GPU一样访问硬件，还因为Windows与众不同，其他类型的虚拟机无法与Windows一起工作(至少据我所知)。</p><p id="fdf4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，从微软下载一个Windows映像。这可能需要一段时间，因为下载量很大。(我找了一下，没有找到一个官方的种子，我对使用其他未经验证的种子非常谨慎，这是由于合法性和额外的恶意软件的机会。)</p><p id="d3ca" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">或者，有一种方法可以从现有的Windows安装中生成映像。你需要一个USB来移动它。在Windows中，打开<em class="nm">设置</em>，进入“系统和安全”，点击“文件历史”。</p><p id="ca40" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">应该有一个名为“系统映像备份”的选项，它将允许您使用当前安装创建一个<code class="fe ob oc od oe b">.iso</code>。这甚至应该能够保存用户和其他信息，虽然我没有尝试过这一点，不能告诉你到底保存了什么和如何保存，所以请不要依赖我，做你自己的研究。</p><p id="56e4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你需要把它转移到USB上，这样你就可以把它转移到你的Debian(或其他)安装上。</p><p id="553b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你只需要Windows来测试应用开发、安全研究之类的，微软其实有限时限量的Windows下载可以免费使用。</p><p id="5450" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我没记错的话，它三个月后就过期了，而且没有Windows的全部功能，但如果它符合你的目的，那就去买吧。</p><p id="c4ad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将Windows安装放在您的主目录中。你可能也想给它起个更方便的名字。下面将从<em class="nm">下载</em>中取出文件，放在您的主目录中，并将其重命名为<code class="fe ob oc od oe b">win.iso</code>。</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="a6c4" class="np lz iq oe b gy oj ok l ol om">mv ~/Downloads/&lt;something like Win10_1909_English_x64.iso&gt; ~/win.iso</span></pre><p id="b717" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要为Xen创建一个配置文件。</p><p id="08ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打开一个终端，输入<code class="fe ob oc od oe b">nano xenwin.cfg</code>。如果没有<a class="ae mv" href="https://www.nano-editor.org/" rel="noopener ugc nofollow" target="_blank"> Nano </a> ( <code class="fe ob oc od oe b">bash: command nano not recognized</code>，可以用<code class="fe ob oc od oe b">sudo apt install nano</code>安装。您也可以使用任何您喜欢的文本编辑器——我只是建议将Nano作为一个简单的选项。</p><p id="354c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我要坦白一件事。这个配置文件中有很多我不知道的东西。我写这篇文章的原因之一是因为我在寻找可靠的、最新的信息时遇到了极大的困难，并且我认为这将是通用的，即使我并不完全理解。</p><p id="ff18" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我将尽力解释一下，这样您可能会知道如何进行故障诊断，但不幸的是，我自己并不完全了解，甚至可能有些东西需要进行不同的配置。顾客小心上当。键入以下内容:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="abbb" class="np lz iq oe b gy oj ok l ol om">builder=’hvm’</span><span id="d879" class="np lz iq oe b gy on ok l ol om">memory=4096</span><span id="5b77" class="np lz iq oe b gy on ok l ol om">vcpus=4</span><span id="417e" class="np lz iq oe b gy on ok l ol om">name=”win”</span><span id="c5ab" class="np lz iq oe b gy on ok l ol om">vif=[‘bridge=xenbr0’]</span><span id="2de7" class="np lz iq oe b gy on ok l ol om">disk=[‘phy:/dev/vg0/win,hda,rw’, ‘<a class="ae mv" href="/~/win.iso,hdc:cdrom,r" rel="noopener ugc nofollow" target="_blank">file:~/win.iso,hdc:cdrom,r</a>’]</span><span id="835c" class="np lz iq oe b gy on ok l ol om">boot=”d”</span><span id="ab88" class="np lz iq oe b gy on ok l ol om">sdl=0</span><span id="7235" class="np lz iq oe b gy on ok l ol om">serial=’pty’</span><span id="2752" class="np lz iq oe b gy on ok l ol om">vnc=1</span><span id="07ee" class="np lz iq oe b gy on ok l ol om">vnclisten=”0.0.0.0”</span><span id="31aa" class="np lz iq oe b gy on ok l ol om">vncpasswd=”foo”</span></pre><p id="f01c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你在Nano上，按<code class="fe ob oc od oe b">CTRL+X</code>保存并退出。(保存到当前缓冲区意味着保存文件。)</p><p id="4f66" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您在Windows虚拟机中的目标分辨率大于800x600，您可能需要添加:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="1afd" class="np lz iq oe b gy oj ok l ol om">videoram=16</span></pre><p id="d77a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果它大于1280x1024，则保持不变，但还要加上:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="2df8" class="np lz iq oe b gy oj ok l ol om">stdvga=1</span></pre><p id="8fa9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(再次，<code class="fe ob oc od oe b">CTRL + X</code>在Nano中调出保存并退出。)</p><p id="1651" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是详细情况，至少我认为我知道的是这样。</p><p id="782d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">指定Xen应该构建什么样的虚拟机。有几个不同的选项，但是对于Windows，你需要一个HVM，而且以我微薄的理解，这可能是你想要的。</p><p id="12f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ob oc od oe b">memory</code>是应该给虚拟机分配多少内存。我指定了4GB，我不认为您应该低于这个数字，但是如果您有一台强大的机器，请随意增加这个数字(作为快速参考，8192和16384是2的下两个幂)。</p><p id="0e48" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ob oc od oe b">vcpus</code>是虚拟CPU的数量，4是一个猜测。有人警告我，最好从低开始，然后添加。您也可以在安装后增加内存和VCPUs的数量；就像升级你的硬件一样。</p><p id="ef13" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ob oc od oe b">name</code>是您的虚拟机的名称。我选择了<code class="fe ob oc od oe b">win</code>，但是你可以根据自己的喜好定制。</p><p id="14bb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ob oc od oe b">vif</code>与网络有关，稍后我们会详细介绍。</p><p id="c4f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ob oc od oe b">disk</code>解释了<code class="fe ob oc od oe b">.iso</code>应该安装到哪里(以及从哪里运行)，以及安装文件在哪里。再细分一下，<code class="fe ob oc od oe b">'phy:/dev/vg0/win,hda,rw'</code>说虚拟机的物理位置应该在<code class="fe ob oc od oe b">/dev/vg0/win</code>。</p><p id="4a21" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我理解正确的话，<code class="fe ob oc od oe b">hda</code>指的是VM的内部架构，入口挂载点在哪里。我知道如果<code class="fe ob oc od oe b">hda</code>不起作用，你可以试试<code class="fe ob oc od oe b">xvda</code>(在<code class="fe ob oc od oe b">file:</code>部分用<code class="fe ob oc od oe b">xvdc</code>代替<code class="fe ob oc od oe b">hdc</code>)。</p><p id="75cb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ob oc od oe b">rw</code>表示读写，即Xen也可以写修改。我觉得这是默认，但是明确写出来也无妨。</p><p id="77f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ob oc od oe b">'file:~/win.iso,hdc:cdrom,r'</code>表示安装文件在您的主目录中(<code class="fe ob oc od oe b">~</code>是<code class="fe ob oc od oe b">/home/your-username</code>的快捷方式)，它应该出现在虚拟机中标有<code class="fe ob oc od oe b">hdc</code>的虚拟驱动器上，该驱动器应该像cd驱动器一样工作，并且是只读的。</p><p id="1ddb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后三个条目是关于VNC的。您将需要一个VNC播放器来“播放”您正在运行的VM，以便在屏幕上看到它并与之交互。您可能不需要设置密码，但是如果我不设置，就会遇到问题。您可以将密码设置为您喜欢的任何值。</p><h2 id="f435" class="np lz iq bd ma nq nr dn me ns nt dp mi le nu nv mk li nw nx mm lm ny nz mo oa bi translated">运行Windows</h2><p id="897f" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">我们之前提到过VNC球员。任何VNC播放器都可以，但是，在玩了一会儿之后，我将使用内置的远程桌面查看器(<a class="ae mv" href="https://github.com/GNOME/vinagre" rel="noopener ugc nofollow" target="_blank"> Vinagre </a>)，如果你在Debian上使用GNOME，你应该已经有了。</p><p id="a273" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是我们期待已久的时刻:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="3492" class="np lz iq oe b gy oj ok l ol om">sudo xl create xenwin.cfg</span></pre><p id="bab9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果一切顺利，Windows应该会启动。尽管你看不到它。进入应用程序菜单(窗口或超级按钮)，并搜索远程桌面。</p><p id="f91c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你应该有一个名为“远程桌面浏览器”的选项。打开它。单击“连接”，并选择VNC作为协议。键入<code class="fe ob oc od oe b">localhost</code>作为主机，然后点击连接。</p><p id="0c72" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您在配置文件中列出了密码(上面的模板使用了“foo”)，请键入您的密码，然后按enter键。如果一切进展顺利，您应该有一个窗口显示Windows启动和开始安装。</p><p id="e7f2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请注意，您还没有运行到虚拟机的互联网连接，因此在安装期间选择不连接到网络。(我在安装之前亲自设置了网络连接，所以如果这导致了生成VM的问题，请跳到下面关于网络的部分。)</p><p id="2846" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">只需注意:当您启动Vinagre时，您的光标(鼠标、指针等)现在是VM中的光标。如果你想离开VM，回到Debian-land，按下<code class="fe ob oc od oe b">CTRL+ALT</code>。</p><p id="50e1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">厉害！</p><p id="0c8a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当然，一些调整是可能的；很有可能这在第一次运行时不起作用。您可能会发现一个有用的命令是<code class="fe ob oc od oe b">sudo xl dmesg</code>，它会将日志从Xen输出到终端。仅仅阅读错误信息就可以让你知道问题出在哪里。</p><p id="7f7f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我想强调的一个特殊问题经常出现在配有英特尔集成显卡的计算机上。</p><p id="8e3d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你有这个问题，你的<code class="fe ob oc od oe b">xl dmesg</code>日志将会充满关于<code class="fe ob oc od oe b">IOMMU</code>的错误。虽然我怀疑有更优雅的解决方案也能提供更好的图形，但有一种方法可以解决这个问题:</p><p id="9d48" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，找到你的<code class="fe ob oc od oe b">xen.cfg</code>文件。它可能在<code class="fe ob oc od oe b">/etc/default/grub.d/xen.cfg</code>中，但如果不是，您可以:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="8618" class="np lz iq oe b gy oj ok l ol om">sudo find / -name xen.cfg</span></pre><p id="6f89" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用你最喜欢的编辑器打开<code class="fe ob oc od oe b">xen.cfg</code>。应该有一个注释掉的行以<code class="fe ob oc od oe b">#GRUB_CMDLINE_XEN_DEFAULT=""</code>开始。删除注释掉该行的<code class="fe ob oc od oe b">#</code>，并在引号中写上<code class="fe ob oc od oe b">iommu=no-igfx</code>。</p><p id="ac8b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您需要运行<code class="fe ob oc od oe b">sudo update-grub</code>以使更改生效，然后重启。(仅仅重启是不够的——你必须告诉Linux更新GRUB。)</p><p id="3ec7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果一切看起来都应该正常工作，但事实并非如此，那么您的<code class="fe ob oc od oe b">.iso</code>可能已经损坏。你可以尝试获得一个干净的副本(我知道，下载需要很长时间)。</p><p id="1222" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您应该能够使用旧Windows安装中的密钥注册新的Xen Windows安装。如果你没有旧的Windows系统，可以在网上购买。</p><p id="4269" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你只需要这个Windows进行app开发，我上面提到微软有一个免费限时的Windows下载专门针对这个。如果这是您使用的Windows映像，它应该不需要注册。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="2809" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">后续步骤(联网，VNC)</h1><h2 id="ffe8" class="np lz iq bd ma nq nr dn me ns nt dp mi le nu nv mk li nw nx mm lm ny nz mo oa bi translated"><em class="oo">联网</em></h2><p id="7005" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">目前，Windows没有任何网络连接。我假设你希望你的窗户有互联网连接，所以让我们来解决这个问题。在命令行中键入<code class="fe ob oc od oe b">ip a</code>。您将得到一个输出，其中列出了连接到互联网的设备。</p><p id="1dae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一个大概是<code class="fe ob oc od oe b">lo</code>。忽略那个。接下来的两个可能是你的以太网卡和WiFi，如果你有的话。复制以太网设备的设备名，应该以<code class="fe ob oc od oe b">e</code>开头。这里我用<code class="fe ob oc od oe b">enp4s0</code>。</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="4662" class="np lz iq oe b gy oj ok l ol om">sudo apt install bridge-utils<br/>sudo nano /etc/network/interfaces</span></pre><p id="ecbc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">默认情况下，该文件可能如下所示(忽略注释):</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="236e" class="np lz iq oe b gy oj ok l ol om">auto lo</span><span id="73b7" class="np lz iq oe b gy on ok l ol om">iface lo inet loopback</span></pre><p id="4f7a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">直接在下面添加以下内容:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="ff6b" class="np lz iq oe b gy oj ok l ol om">enp4s0 inet manual</span><span id="f865" class="np lz iq oe b gy on ok l ol om">auto xenbr0</span><span id="f6d2" class="np lz iq oe b gy on ok l ol om">    iface xenbr0 inet dhcp</span><span id="81a3" class="np lz iq oe b gy on ok l ol om">    bridge_ports enp4s0</span></pre><p id="f81a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ob oc od oe b">Ctrl+X</code>和<code class="fe ob oc od oe b">enter</code>保存。我们需要重新启动网络服务以使更改生效。</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="f5a5" class="np lz iq oe b gy oj ok l ol om">sudo systemctl restart networking</span></pre><p id="210c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此设置仅连接电脑的以太网(有线连接)。添加无线网卡(无论是<code class="fe ob oc od oe b">ip a</code>还是<code class="fe ob oc od oe b">sudo iwconfig</code>都会告诉你它叫什么)需要更多技巧。</p><p id="a45c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我还没能让它工作，不过如果你想做自己的研究，只需搜索“Debian wireless bridge”。这些问题围绕着如何通过网桥与虚拟机建立无线连接。</p><h2 id="ed92" class="np lz iq bd ma nq nr dn me ns nt dp mi le nu nv mk li nw nx mm lm ny nz mo oa bi translated"><em class="oo"> VNC </em></h2><p id="072a" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">我在获得屏幕尺寸和光标时遇到了一些问题。你可能也想尝试一些其他的程序。</p><p id="3a32" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Debian自带<code class="fe ob oc od oe b">gvncviewer</code>，而<a class="ae mv" href="https://tigervnc.org/" rel="noopener ugc nofollow" target="_blank"> TigerVNC </a>似乎很受欢迎。要运行前者，键入<code class="fe ob oc od oe b">gvncviewer localhost</code>，Tiger有一个贵由可以从菜单中启动。你可能需要在它们之间轮换一段时间，直到找到适合你的设置。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="4888" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">接下来呢？</h1><p id="f4b9" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">我想做的还有很多。Windows仍然有点滞后，我想再摆弄一下屏幕。我也希望互联网可以在无线网络上工作。</p><p id="92db" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我个人的下一步研究可能是看看我是否正确配置了我的CPU，无论是在Xen还是在Windows VM中。</p><p id="5a30" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里有很多可以探究的东西，但是我们已经触及了我个人经验的边缘。我只想先报道一件事…</p><h2 id="d9bb" class="np lz iq bd ma nq nr dn me ns nt dp mi le nu nv mk li nw nx mm lm ny nz mo oa bi translated">覆盖旧的Windows安装</h2><p id="2c6e" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">Windows目前只有50GB，这对Windows来说真的不算多。不过，我们仍然有一个结实的旧Windows分区，我们可以覆盖它，为新的、更酷的Windows腾出空间。</p><p id="0c21" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您应该能够使用<code class="fe ob oc od oe b">fdisk</code>(例如:<code class="fe ob oc od oe b">sudo fdisk /dev/sda3</code>)来完成这个任务，并键入<code class="fe ob oc od oe b">d</code>来删除那个分区。</p><p id="9dba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您有兴趣删除其他Windows分区，您可以通过再次按下<code class="fe ob oc od oe b">d</code>并选择正确的分区来实现，尽管这样做的回报有限，因为其他分区(如recovery)可能连一个GB都没有。</p><p id="a06f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">记下您要删除的分区。<em class="nm"> </em> <strong class="kx ir">不要删除你的EFI分区</strong>。</p><p id="9b02" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">可能有一些方法可以扩展您现有的分区来消耗这个新的空闲空间，这在分区行话中被称为，但是我们可以利用我们已经创建的LVM设置来创建一个新的LVM分区，并将其添加到我们的Windows卷组中。</p><p id="e850" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe ob oc od oe b">fdisk</code>中输入<code class="fe ob oc od oe b">n</code>，默认设置会提示您在刚刚释放的空间中创建一个新的分区。它将询问您要创建的分区的类型，您在这里寻找Linux LVM作为您的选择。</p><p id="64a6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我的机器上，它是选项31，但你应该检查列表，而不是盲目地使用这个数字——<code class="fe ob oc od oe b">L</code>应该列出你的选项，<code class="fe ob oc od oe b">spacebar</code>将逐页浏览它们。</p><p id="d6eb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦你删除了旧的分区，并在其位置上创建了新的LVM，点击<code class="fe ob oc od oe b">w</code>保存并退出<code class="fe ob oc od oe b">fdisk</code>。此时您可能需要重新启动，所以如果下面的方法不起作用，假设您需要重新启动。</p><p id="7224" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们已经准备好使用类似的命令，就像我们第一次为Windows虚拟机准备卷组时一样。在我们的例子中，我们将假设新的LVM分区是<code class="fe ob oc od oe b">/dev/sda3</code>，尽管在您的机器上可能会有所不同。</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="dff9" class="np lz iq oe b gy oj ok l ol om">sudo pvcreate /dev/sda3</span><span id="387d" class="np lz iq oe b gy on ok l ol om">sudo vgextend vg0 /dev/sda3</span></pre><p id="af32" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这应该会将旧的Windows空间添加到卷组中。您仍然需要将其添加到虚拟机使用的逻辑卷中:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="002c" class="np lz iq oe b gy oj ok l ol om">sudo lvextend -L +&lt;amount of hard drive to add&gt; /dev/vg0/win</span></pre><p id="08e4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在加号后面，输入您添加的大小，使用后缀<code class="fe ob oc od oe b">g</code>表示千兆字节(或<code class="fe ob oc od oe b">t</code>表示兆兆字节)。例如，如果您要向<code class="fe ob oc od oe b">win</code> LVM添加750GB:</p><pre class="kg kh ki kj gt of oe og oh aw oi bi"><span id="699e" class="np lz iq oe b gy oj ok l ol om">sudo lvextend -L +750g /dev/vg0/win</span></pre><p id="5d2e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，现在卷组中应该有了更多的空间，可供Windows虚拟机使用。</p><h2 id="3ddb" class="np lz iq bd ma nq nr dn me ns nt dp mi le nu nv mk li nw nx mm lm ny nz mo oa bi translated">GPU直通</h2><p id="06dd" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">Xen的一个论点是，即使通过虚拟机运行Windows，也能保持强大的图形设置(读:GPU)。不过，默认情况下这不会发生。</p><p id="cd6c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个有点高深的话题，我自己还没有尝试过。可以在网上搜索“Xen GPU passthrough”。将来我可能会鼓起勇气。</p><p id="08f9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你喜欢这篇文章，并且对在GPU passthrough上看到另一篇文章很感兴趣，请告诉我。这肯定会激励我更多地去尝试。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="5042" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">结论</h1><p id="6b1a" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">那里！你做到了！(我希望。)现在，您拥有了在同一台机器上运行Linux和Windows的最酷的设置。</p><p id="0b2a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当然，现在您可能已经掌握了在Xen中设置虚拟机的诀窍。如果你想尝试一个新的发行版，或者OSX，或者其他什么，你可以像设置你的Windows虚拟机一样设置它们。</p><p id="63ad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(你可能不需要/不想为此获得HVM奖，但我会把它留给你自己研究。)</p><p id="0d5c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你已经走了这么远，你可能已经意识到了这一点，或者即使你没有，但这被认为是一个相当困难的任务，这使你无论走了多远都非常棒。</p><p id="391b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我希望教程使它更容易，我希望你喜欢这个可怕的新设置！</p></div></div>    
</body>
</html>