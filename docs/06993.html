<html>
<head>
<title>What I Didn’t Know About the Rails Generate Command</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于Rails生成命令，我所不知道的是</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-i-didnt-know-about-the-rails-generate-command-52935ef9a3ad?source=collection_archive---------11-----------------------#2020-11-24">https://betterprogramming.pub/what-i-didnt-know-about-the-rails-generate-command-52935ef9a3ad?source=collection_archive---------11-----------------------#2020-11-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0e2c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">理解“rails生成”背后的一些魔力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0a36f4dc8e963253a33bbefe63801029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3IPUnu_szAVo3pJDJe3qGg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">📷杰里米·毕晓普</p></figure><p id="47eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在学习Ruby和Rails的过程中，我一直觉得有很多小概念我并没有真正理解。我习惯于写东西来学习它们，所以这里有一系列关于我不知道的东西的短文。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="108d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">发电机</h1><p id="8338" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">著名的<code class="fe mw mx my mz b">rails generate</code>命令是rails生成器的一部分。</p><p id="5ba7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Rails默认包含了很多生成器，其中最著名的是<code class="fe mw mx my mz b">rails new</code>，它允许我们创建新的rails应用程序。</p><p id="bad7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以通过进入一个rails应用程序并输入<code class="fe mw mx my mz b">rails generate</code>来访问所有默认生成器的列表。您会看到下面的23个发生器分为3类:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="f279" class="ne ma iq mz b gy nf ng l nh ni">Rails:<br/>  application_record<br/>  assets<br/>  channel<br/>  controller<br/>  generator<br/>  helper<br/>  integration_test<br/>  jbuilder<br/>  job<br/>  mailbox<br/>  mailer<br/>  migration<br/>  model<br/>  resource<br/>  scaffold<br/>  scaffold_controller<br/>  system_test<br/>  task</span><span id="4b3f" class="ne ma iq mz b gy nj ng l nh ni">ActiveRecord:<br/>  active_record:application_record</span><span id="c961" class="ne ma iq mz b gy nj ng l nh ni">TestUnit:<br/>  test_unit:channel<br/>  test_unit:generator<br/>  test_unit:mailbox<br/>  test_unit:plugin</span></pre><p id="7723" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要获得关于生成器功能的更多信息，只需输入<code class="fe mw mx my mz b">rails generate my_generator_name --help</code>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="7a9f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">它是如何工作的？</h1><p id="06a6" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在rails存储库中，您可以在<code class="fe mw mx my mz b"><a class="ae kv" href="https://github.com/rails/rails/tree/5cfd58bbfb8425ab1931c618d98b649bab059ce6/railties/lib/rails/generators" rel="noopener ugc nofollow" target="_blank">rails/generators</a></code>文件夹下找到负责Rails生成器的代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/fcfddbcd6ef631818e0a945ef2e26e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dioM5TIuWmk1nvCn545uTw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">rails <a class="ae kv" href="https://github.com/rails/rails" rel="noopener ugc nofollow" target="_blank">库</a>的截图</p></figure><p id="b4b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你还记得上面几段中的生成器列表吗？有一个由18个生成器组成的Rails组，如果你打开屏幕截图上的<code class="fe mw mx my mz b">rails</code>文件，你可以检查这些生成器的代码(模型、控制器、脚手架等)。).</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/a0eb3e179a6c3eca5a2904fbeecb04ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P4CHwqnk8gbfAgdorXwDNw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">rails <a class="ae kv" href="https://github.com/rails/rails" rel="noopener ugc nofollow" target="_blank">库</a>的截图</p></figure><p id="50c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们不会解释每个发电机是如何工作的，它们都是不同的，但我们可以注意到一些事情:</p><ul class=""><li id="9e9b" class="nl nm iq ky b kz la lc ld lf nn lj no ln np lr nq nr ns nt bi translated">正如<a class="ae kv" href="https://guides.rubyonrails.org/generators.html" rel="noopener ugc nofollow" target="_blank"> rails文档</a>所说，当一个生成器被调用时，生成器中的每个公共方法按照它被定义的顺序依次执行。</li><li id="0df2" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">发电机是用<a class="ae kv" href="https://github.com/erikhuda/thor" rel="noopener ugc nofollow" target="_blank">或</a>建造的。如果你看一下<code class="fe mw mx my mz b"><a class="ae kv" href="https://github.com/rails/rails/blob/master/railties/lib/rails/generators/base.rb" rel="noopener ugc nofollow" target="_blank">base.rb</a></code>类，你会看到这个类继承自Thor。rails <a class="ae kv" href="https://guides.rubyonrails.org/generators.html" rel="noopener ugc nofollow" target="_blank">文档</a>注意到Thor提供了强大的解析选项和操作文件的API。</li><li id="d44d" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">我们可以创建自己的定制生成器——我们将在下一部分看到如何实现。</li><li id="6968" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">您可以通过进入<code class="fe mw mx my mz b">config/application.rb</code>并在<code class="fe mw mx my mz b">config.generators</code>块中添加选项来禁用任何生成器的默认行为。例如:</li></ul><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="2eb8" class="ne ma iq mz b gy nf ng l nh ni"># This will disable the generation of the stylesheets files<br/>config.generators do<!-- --> <!-- -->|g|<br/>  g.scaffold_stylesheet false<br/>end</span></pre><ul class=""><li id="79eb" class="nl nm iq ky b kz la lc ld lf nn lj no ln np lr nq nr ns nt bi translated">如您所知，<code class="fe mw mx my mz b">rails g scaffold</code>命令使用了scaffold generator，但是这里需要注意的一点是，scaffold generator只使用其他生成器来工作和创建您需要的文件。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c934" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">您可以创建自定发生器</h1><p id="64bc" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果默认的rails生成器对您来说还不够，您可以创建自己的生成器。例如，创建新的服务<code class="fe mw mx my mz b">rails g service</code>或者创建新的初始化器<code class="fe mw mx my mz b">rails g initializer</code>等等。</p><h2 id="ebdb" class="ne ma iq bd mb nz oa dn mf ob oc dp mj lf od oe ml lj of og mn ln oh oi mp oj bi translated">轨道发电发电机</h2><p id="1271" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">还记得我们在文章开头看到的这个生成器列表吗？查看Rails组内部，您会看到<code class="fe mw mx my mz b">generator</code>。</p><p id="1995" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是的，Rails有一个默认的生成器，允许您创建自己的生成器！</p><h2 id="4cc2" class="ne ma iq bd mb nz oa dn mf ob oc dp mj lf od oe ml lj of og mn ln oh oi mp oj bi translated">生成初始化式生成器？</h2><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="09e1" class="ne ma iq mz b gy nf ng l nh ni">rails generate generator initializer<br/>  <!-- -->create  lib/generators/initializer<br/>  create  lib/generators/initializer/initializer_generator.rb<br/>  create  lib/generators/initializer/USAGE<br/>  create  lib/generators/initializer/templates<br/>  invoke  test_unit<br/>  create    test/lib/generators/initializer_generator_test.rb</span></pre><ul class=""><li id="3a42" class="nl nm iq ky b kz la lc ld lf nn lj no ln np lr nq nr ns nt bi translated">创建<code class="fe mw mx my mz b">lib/generators/initializer</code>文件夹。</li><li id="1367" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">创建继承自<code class="fe mw mx my mz b">Rails::Generators::NamedBase</code>的<code class="fe mw mx my mz b">initializer_generator.rb</code>文件。正如Rails <a class="ae kv" href="https://guides.rubyonrails.org/generators.html" rel="noopener ugc nofollow" target="_blank">文档</a>所说，这意味着我们的生成器至少需要一个参数，这个参数将是初始化器的名称，并且可以在我们的代码变量<code class="fe mw mx my mz b">name</code>中找到。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/01366f4b1fc1e17c886aa52a5c723717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dVhKGFkAZ427HHBYcfAdhQ.png"/></div></div></figure><p id="096b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mw mx my mz b">source_root</code>方法指向我们的生成器模板将被放置的位置。</p><p id="0457" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个<code class="fe mw mx my mz b">USAGE</code>文件，它实际上是您的定制生成器文档:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/2c2b508defc03e97dd243eee0fd299ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YQiQ_kjZpj3wX24cp5yPZA.png"/></div></div></figure><p id="e384" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经为这个例子编辑了这个文件。当我在终端中输入<code class="fe mw mx my mz b">rails generate initializer --help</code>时，我现在看到以下内容:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="fcc1" class="ne ma iq mz b gy nf ng l nh ni">Usage:<br/>  rails generate initializer NAME [options]</span><span id="c59d" class="ne ma iq mz b gy nj ng l nh ni">Options:<br/>  [--skip-namespace], [--no-skip-namespace]  # Skip namespace (affects only isolated applications)</span><span id="1b95" class="ne ma iq mz b gy nj ng l nh ni">Runtime options:<br/>  -f, [--force]                    # Overwrite files that already exist<br/>  -p, [--pretend], [--no-pretend]  # Run but do not make any changes<br/>  -q, [--quiet], [--no-quiet]      # Suppress status output<br/>  -s, [--skip], [--no-skip]        # Skip files that already exist</span><span id="624f" class="ne ma iq mz b gy nj ng l nh ni">Description:<br/>    Explain the generator</span><span id="a4b8" class="ne ma iq mz b gy nj ng l nh ni">Example:<br/>    Hello from the initializer doc</span><span id="dd15" class="ne ma iq mz b gy nj ng l nh ni">This will create:<br/>        a/new/initializer</span></pre><p id="881e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建<code class="fe mw mx my mz b">lib/generators/initializer/templates</code>文件夹。这个文件夹将包含你的自定义初始化生成器的基本模板。</p><p id="d4e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，为我们的测试生成<code class="fe mw mx my mz b">initializer_generator_test.rb</code>文件。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="15db" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">最后一句话</h1><p id="a13d" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果你想知道更多关于如何创建你的定制生成器，你可以浏览一下<a class="ae kv" href="https://arsfutura.com/magazine/diy-create-your-own-rails-generator/" rel="noopener ugc nofollow" target="_blank">本教程</a>和官方Rails <a class="ae kv" href="https://guides.rubyonrails.org/generators.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="f0c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你学到了一些东西。请随时向我发送您的反馈，我很乐意提高这篇文章的质量！</p></div></div>    
</body>
</html>