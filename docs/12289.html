<html>
<head>
<title>A Complete Guide to Designing and Shipping a Blockchain Solution for a Business</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为企业设计和运输区块链解决方案的完整指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-design-a-real-world-blockchain-solution-91463b8e31a6?source=collection_archive---------12-----------------------#2022-05-25">https://betterprogramming.pub/how-to-design-a-real-world-blockchain-solution-91463b8e31a6?source=collection_archive---------12-----------------------#2022-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d5eb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过为物流公司创建专业的区块链网络解决方案来学习。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6a85be490f600400f815f300b9517a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*08O6vy24MCu27GkBbEBn-w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:<a class="ae kv" href="https://unsplash.com/@axelahoi" rel="noopener ugc nofollow" target="_blank">阿克塞尔·阿霍伊</a></p></figure><p id="67f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于物流和供应链的复杂性，很难准确、实时地了解货物的状态，因为物流和供应链通常涉及多个参与者(如商品消费者、零售商、分销商、制造商、供应商和经纪人)，每个参与者都有自己的交易记录。这些记录往往不同步，因此很难全面了解情况。然而，以区块链为基地的供应链网络可以提供更大的可见性和透明度，提高效率和增加价值。</p><h1 id="5978" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">贸易融资和物流术语</h1><p id="3e47" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">贸易融资和物流中使用的许多术语可能会让行业新人感到困惑。以下术语指的是在我们的交易场景中使用的某些工具和人工制品。我们将在本文中构建的应用程序使用这些工具的简化形式:</p><p id="9735" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">信用证:信用证基本上是银行的一种说法，“我们承诺向这个人支付他们运送的货物，只要他们能向我们证明他们确实运送了货物。”这是一份相当重要的文件，进口商的银行会应其客户——进口商——的要求签发一份。</p><p id="a96c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">信用证概述了证明货物已经装运的文件、需要支付的金额以及谁将得到这笔钱(在我们的案例中，是出口商)。信用证样本如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/196aaf8e1ac6e7fa3f01b752f7186e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_mVCAVfR8i1pMq5Z4oqPw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">信用证</p></figure><p id="f606" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出口许可证:出口许可证是监管机构对装运特定货物的批准。在这个博客中，我们将简称为E/L。下面的截图展示了一份E/L样本:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/9c0daedd37d1a0d886264da796fe5a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*52D5r2bkb3UhKQu_HrRVSg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">出口许可证</p></figure><p id="659f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">提单:提单是证明承运人已经占有货物的文件。它还充当承运人和出口商之间的合同，证明出口商拥有货物。</p><ul class=""><li id="4e28" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">发货收据</li><li id="1ecd" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">承运人同意将货物运输到指定目的地并收取费用的合同</li><li id="4bb7" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">货物的所有权</li></ul><p id="e1e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">提单也列在信用证中，并作为将自动触发支付结算的装运证明。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/f77a5c0a4ffb10941afad0f2279f0dd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WNxYnTFTKqRhhtCrVi6bLA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">提单</p></figure><h1 id="cd0a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">流程工作流程</strong></h1><p id="5f99" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们的工作流程包括将交易分解为更简单的步骤，以使流程更高效、更易于遵循。通过将不同实体集合之间的交互分解成更小、更易管理的部分，我们可以简化测试过程，并使其更有效。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/bee250d05d3cba8eaae79ceb4e1f0840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AdzdAuiNGNmi3XIWnil6OA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">交易工作流程</p></figure><ol class=""><li id="6d8e" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr nh mx my mz bi translated">进口商向出口商要求货物以换取金钱</li><li id="3f15" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">出口商接受交易</li><li id="2cad" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">进口商要求其银行开立以出口商为受益人的信用证</li><li id="0193" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">进口商的银行向出口商提供信用证，并向后者的银行付款</li><li id="1a63" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">出口商的银行代表出口商接受信用证</li><li id="bbd0" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">出口商向监管机构申请信用证</li><li id="4cae" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">监管机构向出口商提供信用证</li><li id="18ad" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">出口商准备好货物，并将其交给承运人</li><li id="5c48" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">承运人在确认E/L后接受货物，然后向出口商提供提单</li><li id="b37d" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">出口商银行要求进口商银行支付一半的货款</li><li id="63f4" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">进口商的银行将一半的金额转到出口商的银行</li><li id="0a31" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">承运人将货物运送到目的地</li><li id="4d96" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">进口商银行向出口商银行支付剩余金额</li></ol><h1 id="39fa" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">共享资产和数据</h1><p id="42e7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">先前工作流中的参与者必须共享一些信息，以便所有各方在任何给定时刻都了解贸易安排及其进展。这包括共享资产，如单据和货币资产，如下表所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/640306226f23175050d082360de40359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k432dI3_oR4MZKIx6J0eIQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">资产类型和属性</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/137776965cab5940832686200ecdaf06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XoiNUJoc_gQ0nkFfbSyb4Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据类型和属性</p></figure><h1 id="779a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参与者的角色和能力</h1><p id="58e2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在我们的例子中，有6种类型的参与者:出口商、进口商、出口商银行、进口商银行、航运公司和一些监管机构。每个人都有不同的能力和局限性，列举如下:</p><ul class=""><li id="b569" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">只有进口商可以申请信用证</li><li id="2be0" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">只有进口商的银行可以提供信用证</li><li id="a2b9" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">只有出口商的银行可以接受信用证</li><li id="9888" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">只有出口商可以申请信用证</li><li id="5ee3" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">只有监管机构可以提供信用证</li><li id="2600" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">只有出口商可以准备装运</li><li id="e947" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">只有承运人可以提供提单</li><li id="e3fb" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">只有承运人可以更新装运地点</li><li id="7bcc" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">只有进口商的银行可以汇款，只有出口商的银行可以收款</li></ul><h1 id="94b6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">设置环境</h1><h2 id="9d8d" class="nk lt iq bd lu nl nm dn ly nn no dp mc lf np nq me lj nr ns mg ln nt nu mi nv bi translated"><strong class="ak">安装先决条件</strong></h2><p id="d997" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在我们已经设计好了网络，让我们安装必备工具:</p><ol class=""><li id="2890" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr nh mx my mz bi translated">使用https://docs.docker.com/install/的<a class="ae kv" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank">和https://docs.docker.com/compose/install/的</a>确保你有最新版本的Docker和Docker-Compose</li><li id="ae37" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">安装商业网络所需的软件示例:<a class="ae kv" href="https:// hyperledger.github.io/composer/latest/installing/" rel="noopener ugc nofollow" target="_blank">https://hyperledger.github.io/composer/latest/installing/</a>安装-先决条件。</li><li id="ad3b" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">Fabric是使用Go编程语言实现的。注意，Go的语法类似于C++。我们还将使用Go来编写我们的链码。Go可以通过链接<a class="ae kv" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank">https://golang.org/</a>进行安装。</li><li id="e098" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">设置我们的环境变量。<code class="fe nw nx ny nz b">GOPATH</code>指向<code class="fe nw nx ny nz b">go</code>源代码的工作区，例如:</li></ol><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="8bcb" class="nk lt iq nz b gy oe of l og oh">$ export GOPATH=$HOME/go</span></pre><p id="bd2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nw nx ny nz b">PATH</code>需要包含Go <code class="fe nw nx ny nz b">bin</code>目录来存储库和可执行文件。这可以在下面的代码片段中看到:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="38ff" class="nk lt iq nz b gy oe of l og oh">$ export PATH=$PATH:$GOPATH/bin</span></pre><p id="4ff5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">6.检查你是否需要在你的系统上安装<code class="fe nw nx ny nz b">make</code>。在Debian/Ubuntu系统上，你可以使用<code class="fe nw nx ny nz b">sudo apt-get install make</code>来安装它。</p><h1 id="febb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">分叉和克隆贸易-金融-物流知识库</h1><p id="ef40" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">重要的是，我们首先在GitHub上派生出库，这样我们就有了原始源代码的副本。然后，我们可以按照以下步骤将源代码克隆到本地机器目录中:</p><ul class=""><li id="f52f" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">在GitHub中，导航到以下存储库:<a class="ae kv" href="https://github.com/HyperledgerHandsOn/trade-finance-logistics.git" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/hyperledger handson/trade-finance-logistics . git</a></li></ul><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="0253" class="nk lt iq nz b gy oe of l og oh">$ cd $GOPATH/src<br/>$ git clone <a class="ae kv" href="https://github.com/YOUR-USERNAME/trade-finance-logistics" rel="noopener ugc nofollow" target="_blank">https://github.com/YOUR-USERNAME/trade-finance-logistics</a></span></pre><p id="5c75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在有了所有贸易-金融-物流教程材料的本地副本。</p><h1 id="c9cc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">准备网络</h1><p id="9493" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">要构建<code class="fe nw nx ny nz b">Fabric</code>和<code class="fe nw nx ny nz b">Fabric-CA</code>，可能需要先安装一些依赖项，比如<code class="fe nw nx ny nz b">gcc</code>、<code class="fe nw nx ny nz b">libtool</code>和<code class="fe nw nx ny nz b">ltdl</code>库。(在Ubuntu系统上，您可以通过运行<code class="fe nw nx ny nz b">sudo apt install libltdl-dev</code>来安装所有必要的先决条件，在mac上，您可以通过运行<code class="fe nw nx ny nz b">brew install libtool</code>来安装)。在生成网络加密材料之前，我们需要执行以下步骤:</p><ol class=""><li id="b3b9" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr nh mx my mz bi translated">通过添加参数<code class="fe nw nx ny nz b">-b release-1.1</code>克隆Fabric(<a class="ae kv" href="https://github.com/hyperledger/fabric/tree/release-1.1" rel="noopener ugc nofollow" target="_blank">https://github.com/hyperledger/fabric/tree/release-1.1</a>)源代码库。确保克隆的fabric文件夹在<code class="fe nw nx ny nz b">$GOPATH/src/github.com/hyperledger/</code>中存在或象征性链接。这是必要的，以便当您尝试构建Fabric时，它会在此路径中查找所需的库。</li><li id="b43e" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">运行<code class="fe nw nx ny nz b">make docker</code>为对等方和订购方构建Docker映像</li><li id="1642" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">运行<code class="fe nw nx ny nz b">make configtxgen cryptogen</code>生成必要的工具来运行本节描述的网络创建命令</li><li id="1ce7" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">从<a class="ae kv" href="https://github.com/hyperledger/fabric-ca/tree/release-1.1" rel="noopener ugc nofollow" target="_blank">https://github.com/hyperledger/fabric-ca/tree/release-1.1</a>克隆Fabric-CA。确保克隆的<code class="fe nw nx ny nz b">fabric-ca</code>文件夹在<code class="fe nw nx ny nz b">$GOPATH/src/github.com/hyperledger/</code>中存在或被象征性链接。这是必要的，以便当您尝试构建Fabric-CA时，它会在此路径中查找所需的库。</li><li id="a20a" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr nh mx my mz bi translated">运行<code class="fe nw nx ny nz b">make docker</code>为托管服务提供商(MSP)构建Docker映像。</li></ol><h1 id="927b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">生成网络加密材料</h1><p id="e3cc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">网络配置的第一步包括为每个对等方和订购方组织的MSP以及基于TLS的通信创建证书和签名密钥。我们还需要为每个对等节点和订购节点创建证书和密钥，以便能够相互通信以及与它们各自的MSP通信。</p><p id="baa3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个设置必须在我们代码库的网络文件夹中的<code class="fe nw nx ny nz b">crypto-config.yaml</code>中进行标识。例如，看一下文件中进口商组织的定义:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="9b37" class="nk lt iq nz b gy oe of l og oh">PeerOrgs:<br/>- Name: ImporterOrg<br/>  Domain: importerorg.trade.com<br/>  EnableNodeOUs: true<br/>  Template:<br/>    Count: 1<br/>  Users:<br/>    Count: 2</span></pre><p id="57ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个配置表明<code class="fe nw nx ny nz b">ImporterOrg</code>组织将有一个对等体。此外，还将创建两个非管理员用户。还定义了对等体可以使用的组织域名。</p><p id="bc39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要为所有组织创建加密材料，运行<code class="fe nw nx ny nz b">cryptogen</code>命令，如下所示:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="0f3c" class="nk lt iq nz b gy oe of l og oh">cryptogen generate --config=./crypto-config.yaml</span></pre><p id="9900" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输出保存在<code class="fe nw nx ny nz b">crypto-config</code>文件夹中。</p><h1 id="3350" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">生成通道伪像</h1><p id="40c0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">要建立一个准确反映组织结构的网络，建立一个渠道，需要以下材料:</p><ul class=""><li id="fcbc" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">起源块包含初始化结构区块链的特定于组织的证书。</li><li id="04ec" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">通道配置信息</li><li id="25ca" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">每个组织的锚定对等配置确保区块链得到适当维护。</li></ul><p id="67a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nw nx ny nz b"><a class="ae kv" href="https://github.com/HyperledgerHandsOn/trade-finance-logistics/blob/master/network/crypto-config.yaml" rel="noopener ugc nofollow" target="_blank">crypto-config.yaml</a></code>文件包含渠道属性，而<code class="fe nw nx ny nz b">configtx.yaml</code>文件位于网络文件夹中，定义了我们贸易网络的高级结构，如<code class="fe nw nx ny nz b">Profiles</code>部分所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="6724" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，我们将要创建的通道被命名为<code class="fe nw nx ny nz b">FourOrgsTradeChannel,</code>，它是在概要文件中定义的。参与该通道的4个组织被标记为<code class="fe nw nx ny nz b">ExporterOrg</code>、<code class="fe nw nx ny nz b">ImporterOrg</code>、<code class="fe nw nx ny nz b">CarrierOrg</code>和<code class="fe nw nx ny nz b">RegulatorOrg</code>，每个组织指的是在<code class="fe nw nx ny nz b">Organisations</code>部分中定义的一个子部分。订购者属于自己的组织<code class="fe nw nx ny nz b">TradeOrdererOrg</code>。</p><p id="d874" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面列出的每个组织都包含有关其MSP (ID以及加密材料的位置，如密钥和证书)的信息，以及其锚定对等体的主机名和端口信息。例如，<code class="fe nw nx ny nz b">ExporterOrg</code>部分包含以下内容:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="78c5" class="nk lt iq nz b gy oe of l og oh">- &amp;ExporterOrg<br/>  Name: ExporterOrgMSP<br/>  ID: ExporterOrgMSP<br/>  MSPDir: crypto-config/peerOrganizations/exporterorg.trade.com/msp<br/>  AnchorPeers:<br/>    - Host: peer0.exporterorg.trade.com <br/>    Port: 7051</span></pre><p id="0362" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，本规范中的<code class="fe nw nx ny nz b">MSPDir</code>变量(代表一个文件夹)引用了我们之前使用<code class="fe nw nx ny nz b">cryptogen</code>工具生成的加密材料。</p><p id="04a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nw nx ny nz b">configtxgen</code>工具用于生成通道伪像。要生成genesis块，从<code class="fe nw nx ny nz b">network</code>文件夹运行以下命令:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="3e5d" class="nk lt iq nz b gy oe of l og oh">configtxgen -profile FourOrgsTradeOrdererGenesis -outputBlock ./channel-artifacts/genesis.block</span></pre><p id="d303" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nw nx ny nz b">FourOrgsTradeOrdererGenesis</code>关键字对应于<code class="fe nw nx ny nz b">Profiles</code>部分中的配置文件名。genesis块将保存在<code class="fe nw nx ny nz b">channel-artifacts</code>文件夹的<code class="fe nw nx ny nz b">genesis.block</code>文件中。若要生成通道配置，请运行以下代码:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="2bbf" class="nk lt iq nz b gy oe of l og oh">configtxgen -profile FourOrgsTradeChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID tradechannel</span></pre><p id="013d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将创建的通道命名为<code class="fe nw nx ny nz b">tradechannel</code>，其配置存储在<code class="fe nw nx ny nz b">channel-artifacts/channel.tx</code>中。要为导出者组织生成锚点对等配置，请运行:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="337a" class="nk lt iq nz b gy oe of l og oh">configtxgen -profile FourOrgsTradeChannel -outputAnchorPeersUpdate ./channel-artifacts/ExporterOrgMSPanchors.tx -channelID tra</span></pre><p id="a425" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在前面的命令中更改组织名称时，应该对其他三个组织重复相同的过程。</p><blockquote class="ok ol om"><p id="3cd5" class="kw kx on ky b kz la jr lb lc ld ju le oo lg lh li op lk ll lm oq lo lp lq lr ij bi translated">您需要将环境变量<code class="fe nw nx ny nz b"><em class="iq">FABRIC_CFG_PATH</em></code>设置为包含<code class="fe nw nx ny nz b"><em class="iq">configtx.yaml</em></code>文件的文件夹，以便<code class="fe nw nx ny nz b"><em class="iq">configtxgen</em></code>工具工作。脚本文件<code class="fe nw nx ny nz b"><em class="iq">trade.sh</em></code>有一行确保<code class="fe nw nx ny nz b"><em class="iq">YAML</em></code>文件是从运行命令的文件夹中加载的:<code class="fe nw nx ny nz b"><em class="iq">export FABRIC_CFG_PATH=${PWD}</em></code></p></blockquote><h1 id="8824" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在一个操作中生成配置</h1><p id="364f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe nw nx ny nz b">trade.sh</code>脚本被配置为使用前面描述的命令和配置文件生成通道工件和加密材料。为此，只需在<code class="fe nw nx ny nz b">network</code>文件夹中运行以下命令:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="58f7" class="nk lt iq nz b gy oe of l og oh">./trade.sh generate -c tradechannel</span></pre><p id="d78f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管您可以在这里随意命名任何通道，但需要注意的是，本文后面用于开发中间件的配置将取决于该名称。</p><blockquote class="ok ol om"><p id="7c45" class="kw kx on ky b kz la jr lb lc ld ju le oo lg lh li op lk ll lm oq lo lp lq lr ij bi translated"><em class="iq">将运行对等体的容器中的</em> <code class="fe nw nx ny nz b">GOPATH</code> <em class="iq">变量设置为</em> <code class="fe nw nx ny nz b">/opt/gopath</code> <em class="iq">。</em></p></blockquote><h1 id="7b02" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">构建一个示例贸易网络</h1><p id="ffeb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">前面的命令还创建了一个网络配置文件<code class="fe nw nx ny nz b">docker-compose-e2e.yaml</code>，可以使用docker-compose工具将它作为一组Docker容器来启动网络。该文件基于静态配置文件<code class="fe nw nx ny nz b">base/peer-base.yaml</code>和<code class="fe nw nx ny nz b">base/docker-compose-base.yaml</code>。</p><p id="a534" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些文件一起工作来指定服务及其属性，这允许我们在Docker容器中运行我们需要的所有服务。这与必须在一台或多台机器上手动运行每个单独的服务相反。我们需要运行的服务有:</p><ul class=""><li id="6d17" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">一个<code class="fe nw nx ny nz b">Fabric</code>对等体的四个实例，每个组织一个</li><li id="9c5e" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">一个<code class="fe nw nx ny nz b">Fabric</code>订购的实例</li><li id="d1d5" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">一个<code class="fe nw nx ny nz b">Fabric CA</code>的五个实例，对应每个组织的MSP</li></ul><p id="b197" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个组件的Docker图片可以在Docker Hub(<a class="ae kv" href="https://hub.docker.com/u/hyperledger/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/u/hyperledger/</a>)的Hyperledger项目中找到。对于对等方、订购方和认证机构(ca)，图像分别为<code class="fe nw nx ny nz b">hyperledger/fabric-peer</code>、<code class="fe nw nx ny nz b">hyperledger/fabric-orderer</code>、<code class="fe nw nx ny nz b">hyperledger/fabric-ca</code>。</p><p id="3701" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对等体的基本配置如下(见<code class="fe nw nx ny nz b">base/peer-base.yaml</code>):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="6f65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在这里配置fabric设置，但是如果您为<code class="fe nw nx ny nz b">fabric-peer</code>使用预构建的Docker映像，默认设置通常足以运行一个对等服务。启动对等服务的命令通常在配置的最后一行指定为<code class="fe nw nx ny nz b">peer node start</code>。此外，确保使用<code class="fe nw nx ny nz b">CORE_LOGGING_LEVEL</code>变量配置日志记录级别。</p><p id="72b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的配置中，变量被设置为<code class="fe nw nx ny nz b">INFO</code>，这意味着只记录信息性、警告性和错误性消息。但是，如果您希望调试一个对等体并需要更广泛的日志记录，您可以将这个变量设置为<code class="fe nw nx ny nz b">DEBUG</code>。</p><blockquote class="ok ol om"><p id="bbeb" class="kw kx on ky b kz la jr lb lc ld ju le oo lg lh li op lk ll lm oq lo lp lq lr ij bi translated">在<code class="fe nw nx ny nz b"><em class="iq">network</em></code>文件夹的<code class="fe nw nx ny nz b"><em class="iq">.env</em></code>文件中，变量<code class="fe nw nx ny nz b"><em class="iq">IMAGE_TAG</em></code>被设置为“最新的”,但是如果你想提取旧的图像，你可以设置一个特定的标签。</p></blockquote><p id="5707" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们必须为每个对等体配置主机名和端口，并将生成的加密材料(使用<code class="fe nw nx ny nz b">cryptogen</code>)同步到容器文件系统。在<code class="fe nw nx ny nz b">base/docker-compose-base.yaml</code>中，导出方组织中的对等方配置如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="4e55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如<code class="fe nw nx ny nz b">extends</code>参数所指定的，该配置继承自基本配置。请注意，ID ( <code class="fe nw nx ny nz b">CORE_PEER_ID</code>)与<code class="fe nw nx ny nz b">configtx.yaml</code>中指定的对等方ID相对应。这个身份将被用作在导出组织中运行的对等体的主机名，并将在本文后面的中间件代码中被引用。</p><p id="9aa6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">volumes部分建立了将在<code class="fe nw nx ny nz b">crypto-config</code>文件夹中生成的加密材料复制到容器中的协议。对等服务本身监听端口<code class="fe nw nx ny nz b">7051</code>，客户端可以用来订阅事件的端口被指定为<code class="fe nw nx ny nz b">7053</code>。</p><blockquote class="ok ol om"><p id="ffad" class="kw kx on ky b kz la jr lb lc ld ju le oo lg lh li op lk ll lm oq lo lp lq lr ij bi translated">在这个文件中，您会注意到容器内端口在所有对等体中都是相同的。但是，它们被映射到主机上的不同端口。此外，请注意此处指定的MSP ID与<code class="fe nw nx ny nz b">configtx.yaml</code>中的对应。</p></blockquote><p id="309e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">订购者服务的配置类似于下面来自<code class="fe nw nx ny nz b">base/docker-compose-base.yaml</code>的片段:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="7580" class="nk lt iq nz b gy oe of l og oh">orderer.trade.com:<br/>  container_name: orderer.trade.com<br/>  image: hyperledger/fabric-orderer:$IMAGE_TAG <br/>  environment:<br/>    - ORDERER_GENERAL_LOGLEVEL=INFO <br/>  ……</span><span id="284e" class="nk lt iq nz b gy or of l og oh">  command: orderer <br/>  ……</span></pre><p id="d029" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如代码所示，启动订购者的命令很简单<code class="fe nw nx ny nz b">orderer</code>。可以使用<code class="fe nw nx ny nz b">ORDERER_GENERAL_LOGLEVEL</code>变量定制日志记录级别，并在我们的配置中设置为<code class="fe nw nx ny nz b">INFO</code>。</p><p id="173b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用的网络配置基于一个名为<code class="fe nw nx ny nz b">docker-compose-e2e.yaml</code>的文件。该文件不在存储库中，而是由命令<code class="fe nw nx ny nz b">./trade.sh generate -c tradechannel</code>生成的，我们之前运行该命令来生成通道和加密材料。这个文件使用了<code class="fe nw nx ny nz b">base/docker-compose-base.yaml</code>(间接使用了<code class="fe nw nx ny nz b">base/peer-base.yaml</code>)，通过检查文件内容可以看到这一点。</p><p id="337e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它是从一个名为<code class="fe nw nx ny nz b">docker-compose-e2e-template.yaml</code>的YAML模板文件生成的，这个文件可以在网络文件夹中找到。模板文件包含变量，当生成<code class="fe nw nx ny nz b">docker-compose-e2e.yaml</code>时，这些变量被替换为<code class="fe nw nx ny nz b">crypto-config</code>文件夹中的实际文件名。</p><p id="5328" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，考虑<code class="fe nw nx ny nz b">docker-compose-e2e-template.yaml</code>中的exporter-ca部分:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="e18d" class="nk lt iq nz b gy oe of l og oh">exporter-ca:<br/> image: hyperledger/fabric-ca:$IMAGE_TAG <br/> environment:<br/>   ……</span><span id="d6a3" class="nk lt iq nz b gy or of l og oh">   - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/EXPORTER_CA_PRIVATE_KEY <br/> ……</span><span id="1eb1" class="nk lt iq nz b gy or of l og oh"> command: sh -c ‘fabric-ca-server start — ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.exporterorg.trade.com-cert.pem</span></pre><p id="06a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，看看生成的文件<code class="fe nw nx ny nz b">docker-compose-e2e.yaml</code>中的相同部分:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="2eb8" class="nk lt iq nz b gy oe of l og oh">exporter-ca:<br/> image: hyperledger/fabric-ca:$IMAGE_TAG <br/> environment:<br/>   ……<br/>   - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/ cc58284b6af2c33812cfaef9e40b8c911dbbefb83ca2e7564 <br/> ……</span><span id="f199" class="nk lt iq nz b gy or of l og oh"> command: sh -c ‘fabric-ca-server start — ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.exporterorg.trade.com-cert.pem</span></pre><p id="356e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，变量<code class="fe nw nx ny nz b">EXPORTER_CA_PRIVATE_KEY</code>已经被替换为<code class="fe nw nx ny nz b">cc58284b6af2c33812cfaef9e40b8c911dbbefb83ca2e7564e8fbf5e7039c22e_sk</code>，在env和命令中都是如此。如果您现在检查<code class="fe nw nx ny nz b">crypto-config</code>文件夹的内容，您会注意到在文件夹<code class="fe nw nx ny nz b">crypto- config/peerOrganizations/exporterorg.trade.com/ca/</code>中有一个名为<code class="fe nw nx ny nz b">cc58284b6af2c33812cfaef9e40b8c911dbbefb83ca2e7564e8fbf5e7039c22e_sk</code>的文件。该文件包含导出组织的MSP私有(秘密)签名密钥。</p><blockquote class="ok ol om"><p id="8af7" class="kw kx on ky b kz la jr lb lc ld ju le oo lg lh li op lk ll lm oq lo lp lq lr ij bi translated">之前的代码片段包含了测试运行的结果。每次运行加密工具时，主文件名都会不同。</p></blockquote><p id="70f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，更详细地查看MSP的配置，以出口组织MSP为例，如<code class="fe nw nx ny nz b">docker-compose-e2e.yaml</code>中所述:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="16f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将在MSP中运行的服务是<code class="fe nw nx ny nz b">fabric-ca-server</code>，它侦听端口<code class="fe nw nx ny nz b">7054</code>，使用使用<code class="fe nw nx ny nz b">cryptogen</code>创建的证书和密钥进行引导，并使用在fabric-ca映像中配置的默认登录和密码(分别为<code class="fe nw nx ny nz b">admin</code>和<code class="fe nw nx ny nz b">adminpw</code>)。启动<code class="fe nw nx ny nz b">Fabric CA</code>服务器实例的命令是<code class="fe nw nx ny nz b">fabric-ca-server start</code>，正如您在前面的代码中看到的。</p><p id="b912" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前面的配置所示，对等体和ca被配置为基于TLS的通信。读者必须注意，如果TLS在一个中被禁用，那么它在另一个中也必须被禁用。</p><p id="b157" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，通过检查<code class="fe nw nx ny nz b">docker-compose-e2e.yaml</code>可以观察到，我们没有为订购者的组织创建<code class="fe nw nx ny nz b">Fabric CA</code>服务器(和容器)。对于我们将在本书中完成的练习，为订购者静态创建的管理员用户和凭证就足够了；我们不会动态注册新的订购者组织用户，所以不需要<code class="fe nw nx ny nz b">Fabric CA</code>服务器。</p><h1 id="f52b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">网络组件的配置文件</h1><p id="bb83" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们已经演示了如何在docker-compose YAML文件中配置对等方、订购方和ca。但是这种配置意味着覆盖已经在组件各自的图像中默认进行的设置。虽然对这些配置的详细描述超出了本书的范围，但我们将列出各自的文件，并提到用户如何对它们进行更改。</p><p id="b8a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于对等体来说，<code class="fe nw nx ny nz b"><a class="ae kv" href="https://github.com/hyperledger/fabric/blob/release-1.1/sampleconfig/core.yaml" rel="noopener ugc nofollow" target="_blank">core.yaml</a></code>文件包含所有重要的运行时设置，包括但不限于地址、端口号、安全性和隐私以及gossip协议。您可以创建自己的文件，并使用定制的docker文件将其同步到容器，而不是默认情况下由<code class="fe nw nx ny nz b">hyperledger/fabric-peer</code>图像使用的文件。如果您登录到一个正在运行的对等容器(让我们从我们刚刚启动的网络中取出出口组织的对等容器):</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="2071" class="nk lt iq nz b gy oe of l og oh">docker exec -it f86e50e6fc76 bash</span></pre><p id="9248" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后你会在文件夹<code class="fe nw nx ny nz b">/etc/hyperledger/fabric/</code>中找到<code class="fe nw nx ny nz b">core.yaml</code>文件。</p><p id="9897" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">类似地，订购者的默认配置位于<code class="fe nw nx ny nz b"><a class="ae kv" href="https://github.com/hyperledger/fabric/blob/release-1.1/sampleconfig/orderer.yaml" rel="noopener ugc nofollow" target="_blank">orderer.yaml</a></code>中，它也同步到运行<code class="fe nw nx ny nz b">hyperledger/fabric-orderer</code>映像的容器上的<code class="fe nw nx ny nz b">/etc/hyperledger/fabric/</code>。请记住，<code class="fe nw nx ny nz b">core.yaml</code>和<code class="fe nw nx ny nz b">orderer.yaml</code>文件都被同步到对等容器和订购者容器，因此如果您希望创建定制文件，您将需要将这些YAML文件同步到这两个容器。</p><p id="6722" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个<code class="fe nw nx ny nz b">Fabric CA</code>服务器也有一个名为<code class="fe nw nx ny nz b"><a class="ae kv" href="https://hyperledger-fabric-ca.readthedocs.io/en/latest/serverconfig.html" rel="noopener ugc nofollow" target="_blank">fabric-ca-server-config.yaml</a></code>的配置文件，它被同步到运行<code class="fe nw nx ny nz b">hyperledger/fabric-ca</code>映像的容器上的<code class="fe nw nx ny nz b">/etc/hyperledger/fabric-ca-server/</code>。您可以创建和同步定制配置，就像您为对等方或订购方所做的那样。</p><h1 id="0886" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">启动一个样本贸易网络</h1><p id="3f1d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">因此，现在我们已经有了网络的所有配置，以及运行网络所需的通道工件和加密材料，我们需要做的就是使用<code class="fe nw nx ny nz b">docker-compose</code>命令启动网络，如下所示:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="7db9" class="nk lt iq nz b gy oe of l og oh">docker-compose -f docker-compose-e2e.yaml up</span></pre><p id="4d42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您愿意，可以将它作为后台进程运行，并将标准输出重定向到日志文件。否则，您将在控制台上看到各种容器的启动和日志显示。</p><blockquote class="ok ol om"><p id="d57c" class="kw kx on ky b kz la jr lb lc ld ju le oo lg lh li op lk ll lm oq lo lp lq lr ij bi translated"><em class="iq">在某些操作系统配置上，设置</em> <code class="fe nw nx ny nz b"><em class="iq">Fabri</em></code> <em class="iq"> c可能会比较棘手。如果遇到问题，请查阅文档。在</em><a class="ae kv" href="https://hyperledger-fabric.readthedocs.io/en/release-1.1/samples.html" rel="noopener ugc nofollow" target="_blank">https://hyperledger-Fabric . readthedocs . io/en/release-1.1/samples . html</a>中提供了关于如何安装光纤网络的详细说明和示例。</p></blockquote><p id="30e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也可以使用我们的<code class="fe nw nx ny nz b">trade.sh</code>脚本在后台启动网络。只需运行以下命令:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="73be" class="nk lt iq nz b gy oe of l og oh">./trade.sh up</span></pre><p id="1317" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从不同的终端窗口，如果您运行<code class="fe nw nx ny nz b">docker ps -a</code>，您将看到如下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/c9d0afd51adf87480228bfae91b72cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKWFTxcHruW4JFq3WVQdfw.png"/></div></div></figure><p id="153b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有四个对等体、四个MSP和一个订购者运行在不同的容器中。我们的贸易网络已经准备好运行我们的应用程序了！</p><p id="449f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要查看给定容器的运行日志，请记下容器ID(前面列表中的第一列),只需运行:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="c4d9" class="nk lt iq nz b gy oe of l og oh">docker logs &lt;container-ID&gt;</span></pre><blockquote class="ok ol om"><p id="718d" class="kw kx on ky b kz la jr lb lc ld ju le oo lg lh li op lk ll lm oq lo lp lq lr ij bi translated"><em class="iq">要关闭网络，您可以使用docker-compose命令:</em> <code class="fe nw nx ny nz b">docker-compose -f docker-compose-e2e.yaml down</code> <em class="iq">或我们的trade.sh脚本:</em> <code class="fe nw nx ny nz b">./trade.sh down</code> <em class="iq">。</em></p></blockquote><h1 id="56ef" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">总结</strong></h1><p id="aa23" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本文中，我们介绍了业务用例。我们还部署了第一个Hyperledger结构网络，现在已经从理论过渡到实践。干得好！</p></div></div>    
</body>
</html>