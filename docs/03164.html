<html>
<head>
<title>iOS Lifecycle When Dismissing a Modal View With .pageSheet in iOS 13</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用关闭模式视图时的iOS生命周期。iOS 13中的页面表</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-lifecycle-and-control-when-dismissing-a-modal-view-with-pagesheet-in-ios-13-4bbd1e3e1ec7?source=collection_archive---------0-----------------------#2020-01-25">https://betterprogramming.pub/the-lifecycle-and-control-when-dismissing-a-modal-view-with-pagesheet-in-ios-13-4bbd1e3e1ec7?source=collection_archive---------0-----------------------#2020-01-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7c2e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">新模态视图被取消时的两个关键行为点</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dedcf77d6957f001663e59ef77163e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d26tzb_dk3rZ4P-S1WPqKQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@disguise_truth?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">安娜斯塔西娅·杰尼娜</a>在<a class="ae kv" href="https://unsplash.com/s/photos/page-sheet?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="62d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从iOS 13开始，你已经可以默认实现半模态行为作为屏幕过渡，并通过向下滑动关闭模态视图。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ccfa" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><code class="fe mr ms mt mu b">UIAdaptivePresentationControllerDelegate</code>的新实例方法</h1><ul class=""><li id="9aee" class="mv mw iq ky b kz mx lc my lf mz lj na ln nb lr nc nd ne nf bi translated"><code class="fe mr ms mt mu b">presentationControllerDidAttemptToDismiss(_:)</code></li><li id="e143" class="mv mw iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe mr ms mt mu b">presentationControllerShouldDismiss(_;)</code></li><li id="67d3" class="mv mw iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe mr ms mt mu b">presentationControllerWillDismiss(_;)</code></li><li id="7ca6" class="mv mw iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe mr ms mt mu b">presentationControllerDidDismiss(_;)</code></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/97212d89e5f29e9e02a82ea6c0a9c879.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*OTVdjUrBLT8Pq1DesHsE5w.png"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1b1a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">使用关闭模式视图时的生命周期。通过滑动获取页面</h1><p id="7851" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">当您使用委托方法时，您必须在消除模态视图时了解生命周期。你看看<a class="ae kv" href="https://devstreaming-cdn.apple.com/videos/wwdc/2019/224xnuourakjstfak/224/224_modernizing_your_ui_for_ios_13.pdf?dl=1" rel="noopener ugc nofollow" target="_blank">一些WWDC19的幻灯片</a>就很容易理解了。</p><ul class=""><li id="a1be" class="mv mw iq ky b kz la lc ld lf np lj nq ln nr lr nc nd ne nf bi translated">如果<code class="fe mr ms mt mu b">isModalPresentation</code>为<code class="fe mr ms mt mu b">true</code>，则调用<code class="fe mr ms mt mu b">DidAttemptToDismiss</code>。</li><li id="3b59" class="mv mw iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">如果<code class="fe mr ms mt mu b">isModalPresentation</code>为<code class="fe mr ms mt mu b">false</code>或未配置，则依次调用以下方法:<code class="fe mr ms mt mu b">ShouldDismiss</code>-&gt;-<code class="fe mr ms mt mu b">WillDismiss</code>-&gt;-<code class="fe mr ms mt mu b">DidDismiss</code>。</li></ul><h2 id="df71" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">什么是isModalPresentation？</h2><p id="35e5" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated"><code class="fe mr ms mt mu b">isModalPresentation</code>是iOS 13新增的<code class="fe mr ms mt mu b">UIViewController</code>属性。</p><p id="bd5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果该属性为<code class="fe mr ms mt mu b">true</code>，则显示在屏幕上的视图会被阻止关闭。换句话说，当属性为<code class="fe mr ms mt mu b">true</code>时，不能通过向下滑动来关闭模态视图。</p><p id="4396" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，使用<code class="fe mr ms mt mu b">DidAttemptToDismiss</code>是有益的。向下滑动时触发的事件调用的委托方法，<code class="fe mr ms mt mu b">isModalPresentation</code>为<code class="fe mr ms mt mu b">true</code>。</p><p id="ed38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您可以在方便的时候运行<code class="fe mr ms mt mu b">dismiss(animate: true)</code>，在delegate方法中处理诸如显示对话框之类的事情。</p><blockquote class="oe of og"><p id="d677" class="kw kx oh ky b kz la jr lb lc ld ju le oi lg lh li oj lk ll lm ok lo lp lq lr ij bi translated">"这个属性的默认值是false。当您将其设置为true时，UIKit会忽略视图控制器边界之外的事件，并防止视图控制器在屏幕上时以交互方式关闭。— <a class="ae kv" href="https://developer.apple.com/documentation/uikit/uiviewcontroller/3229894-ismodalinpresentation" rel="noopener ugc nofollow" target="_blank">苹果开发者文档</a></p></blockquote></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0f9a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">使用向下滑动模态视图时的两种控制模式。页面</h1><p id="0235" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">当用<code class="fe mr ms mt mu b">.pageSheet</code>向下滑动模态视图时，由于<code class="fe mr ms mt mu b">viewWillAppear</code>永远不会在父视图控制器上被调用，所以当您想要将值、事件等传递给父视图控制器时，您必须使用前面提到的委托方法。</p><p id="0e19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是实现的两种一般模式。</p><h2 id="43e1" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated">模式1:用<em class="ol">关闭模态视图时不控制行为。页面表</em></h2><p id="ef2e" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">当您将<code class="fe mr ms mt mu b">.isModalPresentation</code>设置为false或nothing时，由于可以调用委托方法<code class="fe mr ms mt mu b">ShouldDismiss</code>-&gt;-<code class="fe mr ms mt mu b">WillDismiss</code>-&gt;-<code class="fe mr ms mt mu b">DidDismiss</code>，您可以通过委托或使用<code class="fe mr ms mt mu b">WillDismiss</code>或<code class="fe mr ms mt mu b">DidDismiss</code>的闭包方法来传递事件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="om on l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="7f01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加:<strong class="ky ir"> </strong>我注意到上面的实现有一个问题。委托方法是在模式视图完全关闭后调用的，因此，根据后面的处理，可能会有一点延迟。</p><p id="dccf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果是这样，你最好在<code class="fe mr ms mt mu b">DidAttemptToDismiss</code>中调用<code class="fe mr ms mt mu b">dismiss</code>并通过委托方法或闭包传递事件，因为性能会稍微快一些(大约0.5秒)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="8905" class="ns ma iq bd mb nt nu dn mf nv nw dp mj lf nx ny ml lj nz oa mn ln ob oc mp od bi translated"><strong class="ak">模式2:用。pageSheet(引自苹果示例代码)</strong></h2><p id="4635" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/uikit/view_controllers/disabling_pulling_down_a_sheet" rel="noopener ugc nofollow" target="_blank">苹果样本代码</a>设置<code class="fe mr ms mt mu b">isModalPresentation</code>为真并使用<code class="fe mr ms mt mu b">presentationControllerDidAttemptToDismiss(_:)</code>。</p><p id="4368" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它是如何工作的？</p><ol class=""><li id="bc4c" class="mv mw iq ky b kz la lc ld lf np lj nq ln nr lr oo nd ne nf bi translated">如果您在模式视图中编辑文本，然后向下滑动，应用程序会显示一个对话框，确认您是要保存还是放弃更改。</li><li id="7e6e" class="mv mw iq ky b kz ng lc nh lf ni lj nj ln nk lr oo nd ne nf bi translated">当您在对话框中选择一个动作时，应用程序运行<code class="fe mr ms mt mu b">dismiss(animated: true)</code>。向父视图控制器传递值和传播事件也同时发生。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="om on l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="63b2" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">包扎</h1><p id="be45" class="pw-post-body-paragraph kw kx iq ky b kz mx jr lb lc my ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">在新模态视图被驳回时的行为中，您必须掌握以下关键点。</p><ul class=""><li id="5684" class="mv mw iq ky b kz la lc ld lf np lj nq ln nr lr nc nd ne nf bi translated">根据<code class="fe mr ms mt mu b">isModalPresentation</code>，生命周期会发生显著变化。</li><li id="ca72" class="mv mw iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">在关闭模态视图时，不会在父视图控制器上调用<code class="fe mr ms mt mu b">viewWillAppear</code>。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ec42" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">资源</h1><ul class=""><li id="6542" class="mv mw iq ky b kz mx lc my lf mz lj na ln nb lr nc nd ne nf bi translated"><a class="ae kv" href="https://qiita.com/hirothings/items/554288583d581a8a929c" rel="noopener ugc nofollow" target="_blank">本文由@hirothings </a>原创日文文章</li><li id="3a5b" class="mv mw iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><a class="ae kv" href="https://developer.apple.com/videos/play/wwdc2019/224" rel="noopener ugc nofollow" target="_blank">为iOS 13更新您的用户界面(WWDC19) </a></li><li id="9d30" class="mv mw iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/uikit/view_controllers/disabling_pulling_down_a_sheet" rel="noopener ugc nofollow" target="_blank">禁止下拉表单(示例代码)</a></li></ul></div></div>    
</body>
</html>