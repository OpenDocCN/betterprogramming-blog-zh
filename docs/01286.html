<html>
<head>
<title>Using GraphQL in iOS with Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Swift在iOS中使用GraphQL</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-graphql-in-ios-using-swift-d2144ed54e89?source=collection_archive---------2-----------------------#2019-08-29">https://betterprogramming.pub/using-graphql-in-ios-using-swift-d2144ed54e89?source=collection_archive---------2-----------------------#2019-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5665" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在您的Swift应用中使用GraphQL</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/10154e7747f3d022e1b3cb3c45229d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xv8X9df2wojULtL4Gx9sg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/photos/xrVDYZRGdw4" rel="noopener ugc nofollow" target="_blank">埃米尔·佩龙</a>在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="5600" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GraphQL是常用的REST API方法的替代方案。当使用<a class="ae ky" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a>时，您只能获得服务器的一个端点。通过该端点，您需要指定您需要的确切数据。它由脸书于2012年创建，并于2015年开源。</p><p id="0031" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Swift应用程序中使用GraphQL并不难。最简单的方法就是使用<a class="ae ky" href="https://github.com/apollographql/apollo-ios" rel="noopener ugc nofollow" target="_blank"> Apollo iOS </a>客户端，最近有很多很棒的改进和bug修复。Apollo iOS是一个强类型的缓存GraphQL客户端，适用于iOS、macOS、iPadOS、watchOS和tvOS。它是用Swift编程语言写的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2f8d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">GraphQL与REST</h1><p id="9f4e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">REST API为每种特定类型的信息公开一个端点。例如:</p><ul class=""><li id="d2b1" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">/visitors</code> —所有访客列表</li><li id="44e1" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">/visitors/ID/</code> —带ID的具体访客详细信息</li></ul><p id="7753" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想象一下，你想让一个访问者说出他们的名字。首先，你需要得到访客名单，按名字搜索。一旦找到特定的访问者ID，就可以从另一个端点获得其余的访问者详细信息。</p><p id="346d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您使用GraphQL时，只需向服务器发出一个请求就可以做到这一点。您只需要指定您希望在声明性GraphQL语法中获得哪种数据:</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="388b" class="nv md it nl b gy nw nx l ny nz">{<br/>    allVisitors(name: "John Appleseed") {<br/>      id<br/>      name<br/>      reasonOfVisit<br/>      isServed<br/>      signInTime<br/>      feeedback<br/>      ...<br/>    } <br/>  }</span></pre><p id="dc5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是一个简单的例子。实际上，只需对服务器进行一次调用，就可以获得多种级别的数据。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6f90" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在iOS中使用Swift设置GraphQL</h1><p id="24c5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以在iOS、iPadOS、macOS、watchOS和tvOS应用程序中使用GraphQL。最简单的方法是使用<a class="ae ky" href="https://github.com/apollographql/apollo-ios" rel="noopener ugc nofollow" target="_blank"> Apollo iOS SDK </a>，这是一个用Swift编程语言编写的强类型缓存GraphQL客户端。</p><h2 id="d244" class="nv md it bd me oa ob dn mi oc od dp mm li oe of mo lm og oh mq lq oi oj ms ok bi translated">装置</h2><p id="40ba" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要设置Apollo客户端，您需要<a class="ae ky" href="https://www.apollographql.com/docs/ios/installation/#installing-the-apollo-framework" rel="noopener ugc nofollow" target="_blank">安装Apollo框架</a>并<a class="ae ky" href="https://www.apollographql.com/docs/ios/installation/#adding-a-schema-file-to-your-target-directory" rel="noopener ugc nofollow" target="_blank">生成一个模式文件</a>。该文件描述了如何从服务器获取信息并将其添加到Xcode应用程序目标。</p><p id="f99b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您<a class="ae ky" href="https://www.apollographql.com/docs/ios/installation/#creating-graphql-files-with-your-queries-or-mutations" rel="noopener ugc nofollow" target="_blank">可以创建</a> <code class="fe ni nj nk nl b">.graphql</code>文件，其中包含您希望如何从服务器获取或更改数据的查询或变更。之后，您需要在Xcode构建过程中添加<a class="ae ky" href="https://www.apollographql.com/docs/ios/installation/#adding-a-code-generation-build-step" rel="noopener ugc nofollow" target="_blank">代码生成</a>构建步骤，以生成类型安全的Swift代码，用于与您的服务器通信。</p><p id="0d0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建您的Xcode应用程序目标，然后<a class="ae ky" href="https://www.apollographql.com/docs/ios/installation/#adding-the-generated-api-file-to-your-target" rel="noopener ugc nofollow" target="_blank">添加一个生成的</a> API文件来使用它。</p><h2 id="1735" class="nv md it bd me oa ob dn mi oc od dp mm li oe of mo lm og oh mq lq oi oj ms ok bi translated">与服务器通信</h2><p id="d7bd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一旦安装过程完成，您就可以设置<code class="fe ni nj nk nl b">ApolloClient</code>实例并指向您的GraphQL服务器。</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="dc9e" class="nv md it nl b gy nw nx l ny nz">import Apollo</span><span id="8846" class="nv md it nl b gy ol nx l ny nz">  let graphQLClient = ApolloClient(url: URL(string: "http://localhost:8080/graphql")!)</span></pre><p id="a509" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以使用<code class="fe ni nj nk nl b">graphQLClient</code>获取数据并处理查询结果。</p><pre class="kj kk kl km gt nr nl ns nt aw nu bi"><span id="c202" class="nv md it nl b gy nw nx l ny nz">let allVisitorsQuery = AllVisitorsQuery(name: "John")<br/>  graphQLClient.fetch(query: allVisitorsQuery) { result in<br/>    switch result {<br/>    case .failure(let error):<br/>      print("Something bad happened \(error)")<br/>    case .success(let graphQLResult):<br/>      guard let john = graphQLResult.data?.visitor else {<br/>        return<br/>      }<br/>      <br/>      print(john)  <br/>  }</span></pre><p id="448b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是一个简单的例子。在接下来的一些帖子中，我们将研究如何改变数据，甚至使用Websockets订阅。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9195" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">GraphQL的利与弊</h1><p id="2805" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">每种技术都有其优点和缺点。您需要理解是否值得放弃REST API。</p><h2 id="1c58" class="nv md it bd me oa ob dn mi oc od dp mm li oe of mo lm og oh mq lq oi oj ms ok bi translated">赞成的意见</h2><p id="7e71" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">GraphQL使实现、更改和维护您的应用程序变得更快。您不需要与后端沟通每个更小的细节，甚至不需要创建新的端点。</p><p id="2180" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您在Swift应用程序中使用GraphQL时，使用Apollo iOS框架很有帮助。它支持iOS、iPadOS、watchOS、macOS和tvOS。您可以使用Swift类型安全和其他强大的功能，包括结果类型等等。</p><p id="c6d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，Apollo iOS框架出现了许多重大更新，更多的bug正在修复。越来越多的公司不仅在web上，而且在他们的移动应用程序上转向GraphQL。</p><h2 id="7780" class="nv md it bd me oa ob dn mi oc od dp mm li oe of mo lm og oh mq lq oi oj ms ok bi translated">骗局</h2><p id="207e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用GraphQL并不那么简单，尤其是如果您习惯了REST API方法。转换你的思维和适应一个新的过程需要一些时间。它还在服务器和您的应用程序之间添加了一个额外的层，您需要在未来维护它。</p><p id="9dbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Apollo iOS SDK，您需要非常小心地使用<a class="ae ky" href="https://www.apollographql.com/docs/ios/watching-queries/" rel="noopener ugc nofollow" target="_blank">缓存</a>。有几种方法可以处理缓存以及何时根本不缓存。只是为了确保在安装之前查看官方文档，或者如果您遇到任何数据不一致的问题。</p><p id="57c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Apollo在Swift中使用GraphQL时帮助很大，但是有一个缺点是可选性。如果您可以自由地决定想要从服务器获得什么样的数据，这就带来了可选性的权衡。这是一个小问题，但是当您构建模型并从服务器获取数据时，您需要处理这个问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c11a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">总结</h1><p id="ee75" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">GraphQL是一种与服务器通信的现代方式。它可以取代常用的REST API方法。使用GraphQL，您可以使用声明性语法通过一个端点与后端进行通信。</p><p id="b26b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">借助Apollo框架，在iOS、iPadOS、watchOS、macOS和tvOS的Swift应用程序中使用GraphQL非常简单。它得到了GraphQL社区的官方支持，最近，它得到了很好的维护和支持。</p><h2 id="5439" class="nv md it bd me oa ob dn mi oc od dp mm li oe of mo lm og oh mq lq oi oj ms ok bi translated">链接</h2><ul class=""><li id="9938" class="mz na it lb b lc mu lf mv li om lm on lq oo lu ne nf ng nh bi translated">官方iOS GraphQL <a class="ae ky" href="https://www.apollographql.com/docs/ios/" rel="noopener ugc nofollow" target="_blank">文档</a>和<a class="ae ky" href="https://github.com/apollographql/apollo-ios" rel="noopener ugc nofollow" target="_blank">库</a></li><li id="470d" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><a class="ae ky" href="https://troubled.pro/2019/02/graphql.html" rel="noopener ugc nofollow" target="_blank">博文</a></li><li id="bb03" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated">大书呆子牧场系列文章。<a class="ae ky" href="https://www.bignerdranch.com/blog/using-graphql-in-production-ios-applications-part-1/" rel="noopener ugc nofollow" target="_blank">第一部分</a>、<a class="ae ky" href="https://www.bignerdranch.com/blog/using-graphql-in-production-ios-applications-part-2/" rel="noopener ugc nofollow" target="_blank">第二部分</a>和<a class="ae ky" href="https://www.bignerdranch.com/blog/using-graphql-in-production-ios-applications-part-3/" rel="noopener ugc nofollow" target="_blank">第三部分</a></li><li id="3602" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated">斯德哥尔摩<a class="ae ky" href="https://www.youtube.com/watch?v=ArMgdV-VwJ8" rel="noopener ugc nofollow" target="_blank">演讲</a></li><li id="6b05" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated">Swift峰会<a class="ae ky" href="https://www.skilled.io/u/swiftsummit/interfacing-with-graphql-in-swift" rel="noopener ugc nofollow" target="_blank">演讲</a></li></ul></div></div>    
</body>
</html>