<html>
<head>
<title>How to Upload Files in Ionic/Angular Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Ionic/Angular应用程序中上传文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/upload-files-in-ionic-angular-apps-784f0c382eb0?source=collection_archive---------0-----------------------#2020-02-29">https://betterprogramming.pub/upload-files-in-ionic-angular-apps-784f0c382eb0?source=collection_archive---------0-----------------------#2020-02-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="996f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这涵盖了一种相当受支持的将本地文件加载到Ionic应用程序的跨浏览器方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dabee9ee45549989bc333c3496f9b1db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sfCFldXj3Bse_Wv6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@kelli_mcclintock?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯利·麦克林托克</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="bd7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当使用设备的文件系统时，方法的选择通常取决于您的用例。</p><p id="c8f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果您需要“写入”用户文件系统的能力，您肯定希望利用一种具有有效用户权限的方法来做到这一点，对于<a class="ae ky" href="https://ionicframework.com/" rel="noopener ugc nofollow" target="_blank"> Ionic </a>应用程序，这将意味着<a class="ae ky" href="https://cordova.apache.org/" rel="noopener ugc nofollow" target="_blank"> Cordova </a>或<a class="ae ky" href="https://capacitor.ionicframework.com/docs/plugins/" rel="noopener ugc nofollow" target="_blank"> Capacitor </a>插件以及为其设置的请求访问用户文件系统的有效权限。</p><p id="aa6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Ionic framework网站上列出的至少有六个<a class="ae ky" href="https://ionicframework.com/docs/native/file-chooser" rel="noopener ugc nofollow" target="_blank">插件可供选择。哪个才是真正符合你需求的？</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/d44950b87da765e0fc8fd4c73d885da6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KQLOn-suAtjCMiGoAt_KzQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">https://www.ionicframework.com</p></figure><p id="bc64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，我们通常只需要对用户的文件系统有“读取”权限，并允许他们上传文件(比如图片)。</p><p id="7f69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个特定的用例中，我们可以依赖web标准并利用浏览器的文件阅读器API，它最近在所有现代浏览器中获得了相当好的支持。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="616b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">模板代码</h1><p id="91a7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">让我们创建一个标准的<code class="fe na nb nc nd b">&lt;ion-button&gt;</code>并将类型为<code class="fe na nb nc nd b">“file”</code>的<code class="fe na nb nc nd b">&lt;input&gt;</code>元素添加到其中。我们还可以利用<code class="fe na nb nc nd b">accept</code>属性来声明我们允许用户上传哪些<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types" rel="noopener ugc nofollow" target="_blank"> MIME类型</a>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">模板端实现</p></figure><p id="ad0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们还向input元素添加了一个(change)事件监听器，而不是按钮本身的(click)监听器。</p><p id="0cf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">ion-button</code>将被点击，除非我们阻止用户事件的传播，否则我们的input元素将捕获它，因此我们可以在下面的TypeScript代码中处理它。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a259" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">打字稿代码</h1><p id="ef19" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">让我们创建一个方法，使用文件读取器来获取作为“blobs”的文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="252d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们的应用程序获得了blob，我们可以创建一个内部对象URL，并使用它通过<code class="fe na nb nc nd b">&lt;img&gt;</code>或<code class="fe na nb nc nd b">&lt;ion-img&gt;</code>元素来呈现图像(请注意，您需要使用Angular 中的<a class="ae ky" href="https://angular.io/api/platform-browser/DomSanitizer" rel="noopener ugc nofollow" target="_blank"> DOMSanitizer来“净化”这样的URL)。</a></p><p id="8b72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件阅读器也支持<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL" rel="noopener ugc nofollow" target="_blank">数据URL </a>，我们可以这样重新编写方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6146" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用上面的代码是有益的，因为每个平台(Android、Safari、Windows)都有自己的“原生”UX，供用户指向要上传的文件。</p><p id="db82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同时，对于这个“读取”用例，我们不必引入和处理任何外部插件。</p><p id="6faf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>