<html>
<head>
<title>Simplify AWS Lambda Dependencies Using Layers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用层简化AWS Lambda依赖关系</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/simplify-aws-lambda-dependencies-using-layers-763a5a9448a4?source=collection_archive---------2-----------------------#2019-07-14">https://betterprogramming.pub/simplify-aws-lambda-dependencies-using-layers-763a5a9448a4?source=collection_archive---------2-----------------------#2019-07-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e92a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为Lambda函数提供依赖关系的简单方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0a8a1cf7bf10527caee57e12cb48ab71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pEIqyKHWfJzuajMRgluHAw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sebastianalvarez?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">塞巴斯蒂安·阿尔瓦雷斯</a>在<a class="ae ky" href="https://unsplash.com/search/photos/layers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="c3b5" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">什么是层？</h1><p id="d596" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">随着无服务器技术变得越来越流行，AWS继续向其无服务器计算服务添加新功能。这些新功能之一是<em class="mu">层</em>。</p><p id="4093" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">层使得用定制的运行时代码运行Lambda函数成为可能。层给Lambda带来的最令人兴奋的好处之一是能够在任何编程语言中运行Lambda函数。</p><p id="91c3" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">然而，层带来的另一个好处是简化了Lambda函数中的依赖关系。在层之前，部署具有依赖性的Lambda函数，在Lambda中启动和运行时增加了额外的复杂性。</p><p id="75bb" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">简而言之:Lambda层提供了一种简单的方式来为你的Lambda函数提供依赖关系。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0b90" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">问题是</h1><p id="7a92" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">今天我们将在Python中创建一个简单的Lambda。</p><p id="1a4b" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">我们的Lambda函数将接收一个多维数组作为输入，并输出该数组的维度。很简单，对吧！</p><p id="9d22" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">好吧，让我们从一些样板文件开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4c9f" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">这定义了我们的Lambda处理程序来获取一个名为<code class="fe nc nd ne nf b">array</code>的输入事件，并返回<code class="fe nc nd ne nf b">array</code>中的维数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/6b8ec4a049b353cd6eb0b495e92ce7df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MG-ErUrSogdy2wJYyFWq6Q.png"/></div></div></figure><p id="9c08" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">相当琐碎。让我们用Lambda运行这段代码吧！</p><p id="5ec4" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">转到AWS控制台，创建一个新的Lambda函数。确保选择Python 3.7作为您的运行时。</p><p id="2d80" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">首先，您可能会尝试将Lambda函数复制并粘贴到AWS控制台中。这很简单，你只是想测试一下你写的这个函数。</p><p id="f73a" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">但是，如果您尝试这样做，将会收到以下错误:</p><pre class="kj kk kl km gt nh nf ni nj aw nk bi"><span id="b08b" class="nl lh it nf b gy nm nn l no np">{<br/>  "errorMessage": "Unable to import module 'lambda_function': No module named 'numpy'",<br/>  "errorType": "Runtime.ImportModuleError"<br/>}</span></pre><p id="e9f0" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">此时，您正在搜索如何将<a class="ae ky" href="https://www.numpy.org/" rel="noopener ugc nofollow" target="_blank"> NumPy </a>依赖项添加到Lambda函数中。</p><p id="7a89" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">您很可能会收到从pip下载NumPy并使用NumPy压缩Python函数的建议。</p><p id="af26" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">首先创建一个名为<code class="fe nc nd ne nf b">lambda_handler.py</code>的文件，如果你还没有的话，然后粘贴你的Lambda代码。</p><p id="37c3" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">然后运行以下命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="ac86" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">这将从pip下载NumPy并用您的<code class="fe nc nd ne nf b">lambda_handler</code>功能将其压缩。</p><p id="e218" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">返回到AWS控制台中的Lambda函数，并在<code class="fe nc nd ne nf b">Code entry type</code>下拉列表中选择<code class="fe nc nd ne nf b">Upload a .zip file</code>。从出现的文件选择器中选择<code class="fe nc nd ne nf b">package.zip</code>文件。</p><p id="9c07" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">如果您能够顺利通过这一步，那么恭喜您！然而，如果你像我一样，你会得到这个错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/aa7419521591925af81c4d3498bb2b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*7QAFNWloXMP2Vu3iBpi1jA.png"/></div></figure><p id="eccc" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">(请注意，我正在处理的项目与我上传的代码并不完全匹配，我包含了三个依赖项<code class="fe nc nd ne nf b">scipy, pandas, and numpy</code>，这增加了包的大小)</p><p id="d3f0" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">现在怎么办？亚马逊给我们提供了一个建议:把功能上传到S3。这是一个完全有效的选择，也是唯一的选择，直到亚马逊创建了Lambda layers。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="7b8f" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">层</h1><p id="dc0c" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">要添加一个层到你的Lambda函数，点击Lambda函数上的<code class="fe nc nd ne nf b">layers</code>按钮。</p><p id="8140" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">从这里，选择名称下拉菜单，您应该会看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/753c0c4afcd10069ab12c2c04ef025eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*h_rrz027scxO2xs8TlQIQg.png"/></div></figure><p id="0a19" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">这一层将让我们访问到SciPy和NumPy。</p><p id="a09f" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">添加后，回到你的项目。您可能需要再次保存。此时，您应该可以点击<code class="fe nc nd ne nf b">Test</code>并成功运行您的功能。</p><p id="c114" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">恭喜你！您刚刚成功地用Python编写了一个带有依赖项的Lambda函数。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="9d44" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">后续步骤</h1><p id="0090" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Lambda layers简化了为我们的函数添加依赖项的过程。</p><p id="8109" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">但是除了SciPy和NumPy之外的依赖关系呢？</p><p id="ffc4" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">Lambda层提供了创建自己的层来满足这些需求的选项。此外，一个Lambda函数最多可以添加五个层，所以一定要根据Lambda函数的需要来组合层。</p><p id="7167" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">本页列出了许多最受欢迎的Lambda图层:<a class="ae ky" href="https://github.com/mthenw/awesome-layers" rel="noopener ugc nofollow" target="_blank">https://github.com/mthenw/awesome-layers</a></p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="ac9d" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="9036" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Lambda层使得依赖于依赖关系的Lambda函数的部署更加容易。对于像NumPy这样的标准依赖项来说尤其如此。</p><p id="fc47" class="pw-post-body-paragraph ly lz it ma b mb mv ju md me mw jx mg mh mx mj mk ml my mn mo mp mz mr ms mt im bi translated">层的另一个有趣的方面是，它们允许你在定制的运行时环境中运行Lambda函数；我将在以后的文章中谈到这一点。</p></div></div>    
</body>
</html>