<html>
<head>
<title>The Imperfect ‘Send Email’ Action in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安卓系统中不完善的“发送邮件”功能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-imperfect-android-send-email-action-59610dfd1c2d?source=collection_archive---------10-----------------------#2019-11-04">https://betterprogramming.pub/the-imperfect-android-send-email-action-59610dfd1c2d?source=collection_archive---------10-----------------------#2019-11-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b904" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用创建电子邮件意图查看设备间的问题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7e5766b9e858bdc80b952fe6a1f03bd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GAJsp6JsLYyGS38oKvTDKg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://unsplash.com/@yogasdesign" rel="noopener ugc nofollow" target="_blank"> Yogas Design </a>在<a class="ae ky" href="https://unsplash.com/photos/J6Qn9sE4aKM" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="cd70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发送电子邮件是任何应用程序的重要组成部分。即使在最简单的应用程序中，发送电子邮件也可以用来提供对应用程序的反馈。Android提供了使用意图动作的能力。</p><p id="22e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在创建电子邮件意图中提供的各种方法在不同的设备上具有不同的问题。如果我们想要一个完美的应用程序，这些问题并不令人讨厌。了解它们可以帮助我们了解如何减轻它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="babd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试场景</h1><p id="9da7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在继续之前，下面是我的测试场景。</p><h2 id="ecbc" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">设备变体</h2><ol class=""><li id="fd41" class="nl nm it lb b lc mu lf mv li nn lm no lq np lu nq nr ns nt bi translated">Pixel 2 SDK 8.1 —首次发布</li><li id="b1a4" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">Pixel 2 SDK 8.1 —电子邮件应用程序的背景/前景(不保持活动)</li><li id="e8c5" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">三星Galaxy S7 Edge SDK 7.0 —首次发布</li><li id="8995" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">三星Galaxy S7 Edge SDK 7.0 —电子邮件应用程序的后台/前台(不保持活动)</li></ol><h2 id="aa5f" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">使用的内容</h2><p id="3e55" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于前三种方法，我使用下面的文字。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="ffcf" class="mz md it oa b gy oe of l og oh">val addresses = <em class="oi">listOf</em>(<br/>    "fake@address.com", "some@add.com").<em class="oi">toTypedArray</em>()<br/>val subject = "Some title"<br/>val text = "Some message\n\nNew Line\n\n"</span></pre><p id="c33a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于最后一种方法，我使用下面的文本。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="3106" class="mz md it oa b gy oe of l og oh">val addresses = <em class="oi">listOf</em>(<br/>    "fake@address.com", "some@add.com").<em class="oi">toTypedArray</em>()<br/>val subject = "Some title"<br/>val text = "Some message&lt;br&gt;&lt;br&gt;New Line&lt;br&gt;&lt;br&gt;"</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b419" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">方法1。意向数据+额外数据</h1><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="24ab" class="mz md it oa b gy oe of l og oh">private fun mailtoTypeEmailCreation(<br/>    addresses: Array&lt;String&gt;, subject: String, text: String) {</span><span id="ac64" class="mz md it oa b gy oj of l og oh">    val intent = Intent(Intent.<em class="oi">ACTION_SENDTO</em>).<em class="oi">apply </em><strong class="oa iu">{<br/>        </strong>val mailto = "mailto:" + addresses.<em class="oi">joinToString</em>(",")<br/>        <em class="oi">data </em>= Uri.parse(mailto)<br/>        putExtra(Intent.<em class="oi">EXTRA_SUBJECT</em>, subject)<br/>        putExtra(Intent.<em class="oi">EXTRA_TEXT</em>, text)<br/>    <strong class="oa iu">}</strong></span><span id="806e" class="mz md it oa b gy oj of l og oh"><strong class="oa iu">    </strong>if (intent.resolveActivity(<em class="oi">packageManager</em>) != null) {<br/>        startActivity(intent)<br/>    }<br/>}</span></pre><p id="ddc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种方法中，我们将<code class="fe ok ol om oa b">intent.data</code>中的<code class="fe ok ol om oa b">mailto</code>与电子邮件一起使用。内容使用<code class="fe ok ol om oa b">EXTRA_SUBJECT</code>和<code class="fe ok ol om oa b">EXTRA_TEXT</code>。</p><p id="6666" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只适用于Pixel的首次电子邮件发布。使用onRestore时不起作用。对三星根本不管用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/ffa623100a5e05e7e477f58bdc3a52a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B4gyMlt6SzU_0xmgmorofA.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7f42" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">方法二。所有额外意图</h1><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="8797" class="mz md it oa b gy oe of l og oh">private fun latestExampleEmailCreation(<br/>    addresses: Array&lt;String&gt;, subject: String, text: String) {<br/>    val intent = Intent(Intent.<em class="oi">ACTION_SENDTO</em>).<em class="oi">apply </em><strong class="oa iu">{<br/>        </strong><em class="oi">data </em>= Uri.parse("mailto:")<br/>        putExtra(Intent.<em class="oi">EXTRA_EMAIL</em>, addresses)<br/>        putExtra(Intent.<em class="oi">EXTRA_SUBJECT</em>, subject)<br/>        putExtra(Intent.<em class="oi">EXTRA_TEXT</em>, text)<br/>    <strong class="oa iu">}<br/>    </strong>if (intent.resolveActivity(<em class="oi">packageManager</em>) != null) {<br/>        startActivity(intent)<br/>    }<br/>}</span></pre><p id="4cd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是Android开发者指南中分享的<a class="ae ky" href="https://developer.android.com/guide/components/intents-common" rel="noopener ugc nofollow" target="_blank">官方方法</a>。</p><p id="a8eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这看起来只对Pixel和三星首次推出都好。onRestore为三星工作。但在Pixel Gmail onRestore上，主题和邮件不见了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/4744972f7d8585ed4a2dc2c969fc133c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kpbjQx-DaEiBM6zePBbo9w.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="60be" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">方法三。所有意向数据</h1><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="00a1" class="mz md it oa b gy oe of l og oh">private fun intentDataEmailCreation(<br/>    addresses: Array&lt;String&gt;, subject: String, text: String) {<br/>    val intent = Intent(Intent.<em class="oi">ACTION_SENDTO</em>).<em class="oi">apply </em><strong class="oa iu">{<br/>        </strong><em class="oi">type </em>= "message/rfc822"<br/>        val uriText = String.<em class="oi">format</em>("mailto:%s?subject=%s&amp;body=%s",<br/>            addresses.<em class="oi">joinToString</em>(","), subject, text)<br/>        <em class="oi">data </em>= Uri.parse(uriText)<br/>    <strong class="oa iu">}<br/>    </strong>if (intent.resolveActivity(<em class="oi">packageManager</em>) != null) {<br/>        startActivity(intent)<br/>    }<br/>}</span></pre><p id="ff26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这充分利用了Mailto的语法，根据<a class="ae ky" href="https://www.labnol.org/internet/email/learn-mailto-syntax/6748/" rel="noopener ugc nofollow" target="_blank">https://www . lab nol . org/internet/email/learn-Mailto-syntax/6748/</a></p><p id="3d64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Pixel上，这是完美的，因为first launch和onRestore都可以工作。但它在三星的Gmail上不起作用，因为<code class="fe ok ol om oa b">/n</code>被忽略了</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/a5d382db02bb40bb009e0b070981a92e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gNBrmTz-2phkIPlg4svGjQ.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2fbc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">方法4。所有带有/n的意图数据被替换为<br/></h1><p id="4013" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这与方法3相同。，除了使用HTML格式的语法(即将<code class="fe ok ol om oa b">/n</code>替换为<code class="fe ok ol om oa b">&lt;br&gt;</code>)。</p><p id="8324" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这种方法，它在三星上运行良好。然而，在像素上,<code class="fe ok ol om oa b">&lt;br&gt;</code>被保留并且不产生新的行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/75f7102f5fcbfa530c1cf1fa44ae739a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8QWZjzqWR8M-MuPFWgcGeQ.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="a517" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以正如你在上面看到的，没有完美的解决方案。最好的方法是方法2。唯一的问题是Pixel email onRestore不能保存主题和信息。这可能是Gmail应用程序的问题，所以让Gmail来解决它。</p><p id="0b2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以在<a class="ae ky" href="https://github.com/elye/demo_android_email_action_intent" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获取代码。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="bb84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div></div>    
</body>
</html>