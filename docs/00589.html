<html>
<head>
<title>Writing Siri Shortcuts in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript编写Siri快捷方式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/writing-siri-shortcuts-in-javascript-scriptable-5169f9aeb29b?source=collection_archive---------4-----------------------#2019-06-15">https://betterprogramming.pub/writing-siri-shortcuts-in-javascript-scriptable-5169f9aeb29b?source=collection_archive---------4-----------------------#2019-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5478" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Scriptable和Siri获取当前的冲浪条件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c1454dd135473e20815fe3388bba5a3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fTzXKQfZERVna6rfhciGmw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@casparrubin" rel="noopener ugc nofollow" target="_blank">卡斯珀·卡米尔·鲁宾</a>在<a class="ae kv" href="https://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b2fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我遇到<a class="ae kv" href="https://scriptable.app" rel="noopener ugc nofollow" target="_blank"> Scriptable </a>时，我很兴奋能够在iPhone上用JavaScript编写自动化脚本。这些脚本可以在应用程序中运行，也可以导出为Siri快捷方式。这使得我们可以通过说出带有快捷方式名称的神奇短语来使用语音执行它们。</p><h2 id="d579" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">冲浪怎么样？</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/9b4dca12e22325269ee5fc537fd6e893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*v3QNvtLENvnqaSHZUqFZMg.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">信用:<a class="ae kv" href="https://www.behance.net/JohnnyChiu" rel="noopener ugc nofollow" target="_blank">https://www.behance.net/JohnnyChiu</a></p></figure><p id="baf6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我创建了一个名为<em class="mm">的快捷方式，冲浪怎么样？</em>它报告加利福尼亚州Pacifica的海流、冲浪高度和天气，Pacifica是海湾地区一个受欢迎的冲浪地点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/04d11b79f07684c82036d189990296de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*_Nmwt9AYbnL0H8-fU5o-eA.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">iOS上的Siri屏幕</p></figure><p id="5e68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该快捷方式由Scriptable中的JavaScript文件提供支持，该文件解析冲浪数据并将响应传递给Siri。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/81a4a71377bac4d8dd1fd8294070817a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*I1nshcqneHVC50X2f3Sclg.jpeg"/></div></figure><h2 id="1e48" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">数据和脚本</h2><p id="2ce7" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">为了获得冲浪数据，我正在抓取<a class="ae kv" href="https://www.surfline.com" rel="noopener ugc nofollow" target="_blank"> Surfline </a>的Pacifica surf report URL。使用JavaScript，我将带有<code class="fe mt mu mv mw b">surf height</code>和<code class="fe mt mu mv mw b">weather</code>信息的元素作为目标，提取<code class="fe mt mu mv mw b">innerText</code>并生成一个<code class="fe mt mu mv mw b">response</code>字符串。然后它作为一个参数传递给Scriptable的<code class="fe mt mu mv mw b">Speech</code>对象的<code class="fe mt mu mv mw b">speak()</code>方法。这是Siri在快捷方式被调用时的回应。</p><p id="3840" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是可编写脚本的文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">HTML解析</p></figure><h2 id="f24b" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">创建快捷方式</h2><p id="af0a" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">可以从脚本视图的左上角访问<code class="fe mt mu mv mw b">Settings</code>菜单。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/a74c2865f4100c5f00d13d6babb85e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*cw1ymirB-gFCSRJdWRRhHQ.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">设置图标</p></figure><p id="39de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它提供了一些选项，包括更改名称、图标和创建Siri快捷方式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/967ef86bea952d68c43b63d01f9131d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*p3dDgLy-tlc196HCd_LvWA.jpeg"/></div></figure><h2 id="a55c" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">问题</h2><ul class=""><li id="8034" class="nb nc iq ky b kz mo lc mp lf nd lj ne ln nf lr ng nh ni nj bi translated">解析Surfline的HTML来挑选数据是不可靠的，因为他们可以通过改变他们网站的URL或DOM结构来破坏我们的脚本</li><li id="eb26" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">由于计算量很大，这个脚本也很慢</li></ul><h2 id="c438" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">更好的解决方案</h2><p id="1bc2" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">我们可以使用由<a class="ae kv" href="http://www.spitcast.com/api/docs/" rel="noopener ugc nofollow" target="_blank"> Spitcast </a>和<a class="ae kv" href="https://magicseaweed.com/developer/api" rel="noopener ugc nofollow" target="_blank"> Magicseaweed </a>提供的API来获得JSON格式的冲浪高度和天气。Surfline也有一个<code class="fe mt mu mv mw b">services</code>端点，可以公开访问并提供这些信息。</p><pre class="kg kh ki kj gt np mw nq nr aw ns bi"><span id="21f7" class="ls lt iq mw b gy nt nu l nv nw">https://services.surfline.com/kbyg/spots/forecasts/{type}?{params}</span></pre><p id="af17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">斯特凡·弗罗贝尔的优秀GitHub <a class="ae kv" href="https://github.com/swrobel/meta-surf-forecast" rel="noopener ugc nofollow" target="_blank"> repo </a>中有更多关于不同API的细节。</p><p id="4e83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我使用Surfline的服务API更新了我的脚本，看到快捷方式的性能有了显著的提高。<strong class="ky ir">不像以前的解析脚本，Siri平均需要五秒钟才能响应，新脚本在一秒钟内就完成了！</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mx my l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Surfline API</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/7a09189bbe5e7c54ceda15de922b47df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*XG015r3w5u_nWXmI_C_4oA.jpeg"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">稍微改变了一下语言</p></figure><p id="37c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要注意一些事情:</p><ul class=""><li id="0d64" class="nb nc iq ky b kz la lc ld lf nx lj ny ln nz lr ng nh ni nj bi translated">Surfline的API没有得到官方支持，所以没有文档，API URL方案将来可能会改变</li><li id="3155" class="nb nc iq ky b kz nk lc nl lf nm lj nn ln no lr ng nh ni nj bi translated">我用最基本的方法来计算冲浪高度和天气数据，这不如Surfline的网站准确</li></ul><h2 id="c611" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">剧本拿走！</h2><p id="4a2c" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">我希望这篇文章能激发其他人利用JavaScript的力量来编写iOS脚本。希望听到您关于自动化项目的所有信息。</p></div></div>    
</body>
</html>