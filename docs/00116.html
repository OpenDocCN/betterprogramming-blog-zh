<html>
<head>
<title>Customize your MySQL Database in Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Docker中定制你的MySQL数据库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/customize-your-mysql-database-in-docker-723ffd59d8fb?source=collection_archive---------2-----------------------#2018-03-30">https://betterprogramming.pub/customize-your-mysql-database-in-docker-723ffd59d8fb?source=collection_archive---------2-----------------------#2018-03-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="640e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建Docker映像并使用绑定挂载来自定义您的MySQL数据库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/5c9a2c844eed79f21d1ead196f58fc84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*fqwE_Sk2pCO5orZTRoivgg.png"/></div></figure><p id="f9d3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">许多开发人员使用Docker来构建本地数据库。这使得测试他们的代码和编写数据变得容易，而不需要安装和配置很多工具。在这篇文章中，我将解释如何定制Docker数据库。虽然我将解释MySQL的步骤，但它同样适用于PostgreSQL！<br/>继续，让我们创建一个包含您想要的表和数据的自定义MySQL。</p><h1 id="b573" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">创建SQL脚本</h1><p id="d2c7" class="pw-post-body-paragraph kq kr it ks b kt me ju kv kw mf jx ky kz mg lb lc ld mh lf lg lh mi lj lk ll im bi translated">我们将创建SQL脚本，其中包含我们希望在数据库上执行的SQL语句。创建一个我们将在其中工作的目录。此外，创建一个子目录，我们将在其中存储我们的<code class="fe mj mk ml mm b">.sql</code>脚本。</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="c702" class="mr ln it mm b gy ms mt l mu mv">$ mkdir -p ~/my-mysql/sql-scripts<br/>$ cd ~/my-mysql/sql-scripts</span></pre><p id="e384" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我想用一个名为employees的表定制我的数据库。该表需要包含一个雇员行(名、姓、部门和电子邮件)。</p><p id="dc02" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">写个<code class="fe mj mk ml mm b">CreateTable.sql</code>。该文件包含创建名为employees的表的SQL语句。我们将在表中添加四列</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="192a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">写一个<code class="fe mj mk ml mm b">InsertData.sql</code>。这个文件包含我们在表‘employees’中插入数据的语句。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="a77c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">执行<code class="fe mj mk ml mm b">tree</code>命令来验证您的两个脚本存在并且保存在正确的目录中。</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="f8ff" class="mr ln it mm b gy ms mt l mu mv">$ cd ~/my-mysql<br/>$ tree<br/>└── sql-scripts<br/>    ├── CreateTable.sql<br/>    └── InsertData.sql</span></pre><h1 id="bcb1" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">为定制的MySQL数据库创建Docker映像</h1><p id="bac7" class="pw-post-body-paragraph kq kr it ks b kt me ju kv kw mf jx ky kz mg lb lc ld mh lf lg lh mi lj lk ll im bi translated">现在脚本已经准备好了，我们可以编写一个Docker文件来创建我们自己的Docker映像(基于MySQL 的<a class="ae my" href="https://hub.docker.com/_/mysql/" rel="noopener ugc nofollow" target="_blank">官方映像)。</a></p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="a862" class="mr ln it mm b gy ms mt l mu mv">$ cd ~/my-mysql/<br/>$ vi Dockerfile</span></pre><p id="7e31" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Dockerfile文件的内容:</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="92a3" class="mr ln it mm b gy ms mt l mu mv"># Derived from official mysql image (our base image)<br/>FROM mysql</span><span id="7228" class="mr ln it mm b gy mz mt l mu mv"># Add a database<br/>ENV <!-- -->MYSQL_DATABASE company</span><span id="f63b" class="mr ln it mm b gy mz mt l mu mv"># Add the content of the sql-scripts/ directory to your image<br/># All scripts in docker-entrypoint-initdb.d/ are automatically<br/># executed during container startup<br/>COPY ./sql-scripts/ /docker-entrypoint-initdb.d/</span></pre><p id="75d1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">创建您的Docker图像:</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="3d47" class="mr ln it mm b gy ms mt l mu mv">$ cd ~/my-mysql/<br/>$ docker build -t my-mysql .<br/>Sending build context to Docker daemon  4.608kB<br/>Step 1/2 : FROM mysql<br/>latest: Pulling from library/mysql<br/>Digest: sha256:691c55aabb3c4e3b89b953dd2f022f7ea845e5443954767d321d5f5fa394e28c<br/>Status: Downloaded newer image for mysql:latest<br/> ---&gt; 5195076672a7<br/>Step 2/2 : ADD sql-scripts/ /docker-entrypoint-initdb.d/<br/> ---&gt; 25065c3d93c0<br/>Successfully built 25065c3d93c0<br/>Successfully tagged my-mysql:latest</span></pre><p id="f99c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">并从映像启动您的MySQL容器:</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="97c0" class="mr ln it mm b gy ms mt l mu mv">$ docker run -d -p 3306:3306 --name my-mysql \<br/>-e MYSQL_ROOT_PASSWORD=supersecret my-mysql</span></pre><p id="f85e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在我们可以验证。我们将<code class="fe mj mk ml mm b">exec</code>放入集装箱内:</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="5f7d" class="mr ln it mm b gy ms mt l mu mv">$ docker exec -it my-mysql bash<br/>root@c86ff80d7524:/# mysql -uroot -p<br/>Enter password: (supersecret)<br/>mysql&gt; show databases;<br/>+--------------------+<br/>| Database           |<br/>+--------------------+<br/>| information_schema |<br/>| company            |<br/>| mysql              |<br/>| performance_schema |<br/>| sys                |<br/>+--------------------+<br/>5 rows in set (0.00 sec)</span><span id="37b6" class="mr ln it mm b gy mz mt l mu mv">mysql&gt; use company;<br/>Reading table information for completion of table and column names<br/>You can turn off this feature to get a quicker startup with -A</span><span id="c306" class="mr ln it mm b gy mz mt l mu mv">Database changed<br/>mysql&gt; show tables;<br/>+-------------------+<br/>| Tables_in_company |<br/>+-------------------+<br/>| employees         |<br/>+-------------------+<br/>1 row in set (0.00 sec)</span><span id="6ada" class="mr ln it mm b gy mz mt l mu mv">mysql&gt; show columns from employees;<br/>+------------+-------------+------+-----+---------+-------+<br/>| Field      | Type        | Null | Key | Default | Extra |<br/>+------------+-------------+------+-----+---------+-------+<br/>| first_name | varchar(25) | YES  |     | NULL    |       |<br/>| last_name  | varchar(25) | YES  |     | NULL    |       |<br/>| department | varchar(15) | YES  |     | NULL    |       |<br/>| email      | varchar(50) | YES  |     | NULL    |       |<br/>+------------+-------------+------+-----+---------+-------+<br/>4 rows in set (0.00 sec)</span><span id="cc83" class="mr ln it mm b gy mz mt l mu mv">mysql&gt; select * from employees;<br/>+------------+-----------+------------+-------------------+<br/>| first_name | last_name | department | email             |<br/>+------------+-----------+------------+-------------------+<br/>| Lorenz     | Vanthillo | IT         | <a class="ae my" href="mailto:lvthillo@mail.com" rel="noopener ugc nofollow" target="_blank">lvthillo@mail.com</a> |<br/>+------------+-----------+------------+-------------------+<br/>1 row in set (0.01 sec)</span></pre><p id="4c2c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">有用！我们有我们定制的MySQL数据库Docker图像！对于多个开发者之间的本地开发来说，这是一个很好的解决方案。通过共享Docker映像，每个开发人员都可以通过从映像启动一个容器来使用数据库。</p><p id="7d5b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">但是，需要注意的是，这并不总是最佳解决方案:</p><ul class=""><li id="b099" class="na nb it ks b kt ku kw kx kz nc ld nd lh ne ll nf ng nh ni bi translated">如果您插入大量数据，您的图像大小将会显著增加</li><li id="aaf7" class="na nb it ks b kt nj kw nk kz nl ld nm lh nn ll nf ng nh ni bi translated">当您想要更新数据时，需要构建新的映像</li></ul><p id="c8a8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这就是为什么有另一种方法来定制你的Docker MySQL。</p><h1 id="0460" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">使用绑定挂载在Docker中定制您的MySQL数据库</h1><p id="eb5a" class="pw-post-body-paragraph kq kr it ks b kt me ju kv kw mf jx ky kz mg lb lc ld mh lf lg lh mi lj lk ll im bi translated">在最后一节中，我们将简单地在官方的MySQL Docker容器中安装脚本。</p><pre class="kj kk kl km gt mn mm mo mp aw mq bi"><span id="45d4" class="mr ln it mm b gy ms mt l mu mv">$ docker run -d -p 3306:3306 --name my-mysql \<br/>-v ~/my-mysql/sql-scripts:/docker-entrypoint-initdb.d/ \<br/>-e MYSQL_ROOT_PASSWORD=supersecret \<br/>-e MYSQL_DATABASE=company \<br/>mysql</span></pre><p id="1469" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们可以再次验证！使用与我们之前相同的步骤:<code class="fe mj mk ml mm b">exec</code>在容器中检查表和数据是否存在！</p><p id="ee5f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这种方法更加灵活，但是在开发人员之间分发会有点困难。他们都需要将脚本存储在本地机器上的某个目录中，并且在执行<code class="fe mj mk ml mm b">docker run </code>命令时需要指向该目录。</p><h1 id="aef0" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">结论</h1><p id="45e6" class="pw-post-body-paragraph kq kr it ks b kt me ju kv kw mf jx ky kz mg lb lc ld mh lf lg lh mi lj lk ll im bi translated">在这篇文章中，我描述了如何在Docker中创建自定义的MySQL数据库。我们探讨了两种方法:</p><ul class=""><li id="e699" class="na nb it ks b kt ku kw kx kz nc ld nd lh ne ll nf ng nh ni bi translated">自定义MySQL Docker图像</li><li id="65b1" class="na nb it ks b kt nj kw nk kz nl ld nm lh nn ll nf ng nh ni bi translated">将装载绑定到容器中的装载脚本</li></ul><p id="009b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们还讨论了每种方法的优缺点。</p><p id="7c47" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们希望你喜欢它！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://www.buymeacoffee.com/dZb8fLN"><div class="gh gi no"><img src="../Images/83dc7212ef8502659c81086ad58b8d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*bk_C8Um34KavCkO2yzMCZg.png"/></div></a><p class="np nq gj gh gi nr ns bd b be z dk translated">如果真的对你有帮助…:)</p></figure></div></div>    
</body>
</html>