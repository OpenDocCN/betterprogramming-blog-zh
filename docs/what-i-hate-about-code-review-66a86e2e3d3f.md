# 关于代码评审，我最不喜欢的 5 件事

> 原文：<https://betterprogramming.pub/what-i-hate-about-code-review-66a86e2e3d3f>

## 固执己见的评论，双重标准，等等

![](img/1c08008aa017d01486eb49c027f609a6.png)

安德烈·亨特在 [Unsplash](https://unsplash.com/s/photos/angry-face?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片。

首先，我想澄清一下标题。当代码评审做得正确时，我不讨厌它。事实上，我喜欢审查代码和被审查。代码评审对于作者和评审者来说都是一次愉快的学习经历，有一个支持性的环境和一致的标准。适当的代码审查减少了错误并保持了代码库的质量。

但在现实中，这往往是一项压力很大的运动。来自评论者的恶意评论会引起持续的争论。在某些情况下，它会导致团队沟通的中断。那是我(以及我认识的许多开发人员)讨厌代码审查的时候。

以下是我最不喜欢代码审查的几件事。

# 1.来自“我总是对的”评论者的固执己见的评论

在我过去的工作经验中，许多团队至少有一个过度自负和/或傲慢的高级开发人员。这个人很容易通过代码评审毒害团队环境。

一个傲慢的评审者会试图通过代码评审来证明他们比其他人更好。这些评论者倾向于在没有正当理由或解释的情况下不断添加固执己见的评论。很多时候，这些问题属于个人偏好的范畴。

我见过代码审查者沉迷于命名约定或者迂腐地过度工程化。他们强迫其他开发人员根据评审者的个人偏好更改他们的代码，即使代码符合团队的编码标准。

由于审查者的权威和通过 PR 的时间压力，其他开发人员通常会让步并做出更改。这是浪费时间和精力，而且会让其他开发人员感到没有动力。通常，由于评审而导致的不必要的最后一分钟的更改会导致新的错误。

根据 GitLab 的最佳实践:

> “接受许多编程决策都是观点。讨论你喜欢的权衡，并迅速达成解决方案。”

简单明了。我相信每个开发者都会同意这是常识。

# 2.双重标准还是不断变化的标准

在一些项目中，没有正式的书面代码评审标准。不幸的是，经常有一两个大声而傲慢的高级开发人员在做所有的代码审查。这就是代码审查成为权力游戏而不是必要的质量保证的时候。

一个症状是代码审查者将根据 PR 的作者应用不同的标准。我见过新的或初级的开发人员被单独投入到一项复杂的任务中，然后在代码审查中遵循比通常更高的标准。因此，PR 被阻止并要求重写。这造成了不必要的挫折和延误。与此同时，其他人的 PRs 未经适当审查就被迅速批准。

唯一比双重标准更糟糕的是不断变化的标准。

软件设计是一门艺术，艺术没有固定的规则，相反，我们有许多可以解释的原则。当您根据评审者的反馈进行代码更改时，标准会发生变化，但他们会不断移动目标。结果是显而易见的:严重的延误和与不讲道理的人无休止的讨论。

从我的经验来看，双重标准给其他开发者带来了巨大的焦虑。他们会觉得受到了侮辱，失去了动力，最终会开始寻找其他机会。

# 3.对同一琐碎问题的重复评论，但他们错过了核心的设计/结构问题

一个常见的问题是代码评审有一种“更多的评论意味着更好的评审”的心态

不用花时间去理解公关的背景，增加评论数量最简单的方法就是挑选一个次要的风格问题，并为每个事件添加一条评论。这没有帮助，因为样式问题通常可以通过在 IDE 中应用一个额外的/缺少的设置来修复。真正有帮助的是添加一个信息性的注释，并带有样式指南或设置指南的链接。

对风格和琐碎问题的狭隘看法导致对现实问题的盲目。

很多时候，主要的结构或设计问题通过评审，是因为评审者缺乏时间和上下文。鉴于审查者通常是高级和/或长期任职的工作人员，如果他们的关注点在正确的地方，他们可能会注意到这些问题。

# 4.超出范围的评论

一些代码评审员习惯于做出这样的评论:“我知道这不是你的代码，但是既然你接触了它，请重构它。”

每个公关都有一个范围。好的公关都有小的。它要么修复一个 bug，要么增加一个特性。代码评审的范围应该适当。它不应该仅仅因为 PR 碰巧接触到同一个文件就要求作者进行重构，从而扩大 PR 的范围。这样做可能会导致其他开发人员在时间压力下匆忙做出不正确的更改。将两个不相关的变更混合到一个 PR 中不是好的做法。

除非重构很小，并且与公关直接相关，否则最好创建一个单独的问题/标签，让另一个公关来完成。

# 5.审核和响应缓慢

代码审查应该及时。我们都知道等待是痛苦的，在交付压力下等待代码评审反馈更痛苦。

在我参与的大多数项目中，没有关于代码审查时间的 SLA。要看有多少审稿人有空，有多忙。当代码审查仅限于团队中的一两个高级开发人员时，情况会变得更糟。因为代码评审员通常是资深的，他们将有多重责任。这让等待变得更加漫长。

代码审查成为瓶颈并不罕见，尤其是在敏捷环境中，每个 sprint 都需要一个可交付的产品。

虽然没有代码审查速度的标准，但是谷歌的指南可能是一个很好的参考:

> “如果你不是在一个集中的任务中，你应该在它进来后不久做一个代码审查。
> 
> 一个工作日是响应代码评审请求的最长时间(即第二天早上的第一件事)。"

# 最后的想法

以上是我在代码评审中遇到的常见问题。这是*而不是*代码审查本身的错误。

事实很简单，审查不是由正确的人或以正确的方式进行的。

你可能会想，“我们应该如何处理这些问题？”不会有简单的答案。我可能会在另一篇文章中与你分享我的想法。如果你有类似的经历和/或有什么可以分享的，请留下评论。我很想收到你的来信。

最后，我想分享一段摘录自[谷歌的代码审查开发者指南](https://slab.com/library/examples/google-code-review/):

> 一般来说，一旦一个 CL 确实改善了正在工作的系统的整体代码健康状态，评审者应该赞成批准它，即使这个 CL 并不完美

复习愉快！

*如果您还不是 Medium 的付费会员，* [***您可以访问此链接***](https://sunnysun-5694.medium.com/membership) *。你可以无限制地阅读媒体上的所有报道。我会收你一部分会员费作为介绍费。*