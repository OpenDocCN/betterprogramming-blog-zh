<html>
<head>
<title>A Tale of Two Engineers Discovering the Crystal Programming Language</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">两个工程师发现水晶编程语言的故事</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-tale-of-two-engineers-discovering-the-crystal-programming-language-104b1fdbe525?source=collection_archive---------4-----------------------#2022-01-26">https://betterprogramming.pub/a-tale-of-two-engineers-discovering-the-crystal-programming-language-104b1fdbe525?source=collection_archive---------4-----------------------#2022-01-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f7cf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">开始使用Crystal lang</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/29f9fddd8c6b2e5b2af13c221b5a3759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56Cc6k5BmhBe49oPB2q7VQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来源:维基百科</p></figure><p id="6ad9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">听说过务实的程序员吗？这是一本由戴维·托马斯和安德鲁·亨特写的名著。两位作者都就如何提高开发人员的技能和编写更好的程序给出了建议。</p><p id="743f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对我来说，这是最好的编程书籍之一，还有<a class="ae lr" href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882/ref=sr_1_1?crid=Y3NN1ZBX3POV&amp;keywords=CLean+code&amp;qid=1643015153&amp;sprefix=clean+code%2Caps%2C137&amp;sr=8-1" rel="noopener ugc nofollow" target="_blank">干净的代码:敏捷软件工艺手册</a>和<a class="ae lr" href="https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612/ref=sr_1_1?crid=3AMM2FGIFDE3K&amp;keywords=Design+patterns&amp;qid=1643015171&amp;sprefix=design+pattern%2Caps%2C130&amp;sr=8-1" rel="noopener ugc nofollow" target="_blank">设计模式:可重用面向对象软件的元素</a>。</p><p id="f1f9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其中一条建议特别引起了我的注意:“<em class="ls">不断学习</em>”。根据作者所说，你应该每年学习一门新的编程语言。</p><p id="add5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">比如你是前端开发人员，没有后端开发的知识，那就去学Go或者Python。或者，如果你已经知道一种后端编程语言，你可以转向Rust或Elm。学习它并不意味着你会每天使用它，只是你会学到解决常见问题的新方法和新概念，例如，函数式编程语言和面向对象编程语言。</p><p id="a3d8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我就是这样学习了Swift、Python、Rust以及最近的Crystal等编程语言。几周前，我的一位同事马修·埃尔米特带着一个问题来找我。他想在Datadog中的一个类似谷歌地图的应用程序上显示标记。每个标记都需要在地图上显示纬度和经度，这些数据是根据用户的IP地址收集的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lt"><img src="../Images/29411badea7a4a9b1934918435106ff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dSq4nbmTzlezWYznv6I86Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这就是你在第二篇博文的结尾会得到的。</p></figure><p id="9223" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一系列博客文章的第一篇，在这些文章中，你会读到关于Crystal的内容。第二个是关于如何创建一个定制的Datadog小部件，显示一个带有定制标记的OpenStreetMap。你可以在GitHub 上找到<a class="ae lr" href="https://github.com/DataDog/apps" rel="noopener ugc nofollow" target="_blank">该项目的源代码。</a></p><p id="f0af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">不需要晶体的先验知识</strong>。我们将涵盖所有基本的和更高级的概念。但是，您应该至少掌握一门编程语言的基本知识。例如，我不会讨论什么是函数或变量，而是讨论这些部分在Crystal中是如何实现的。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="b8d4" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">选择Crystal而不是另一种编程语言</h1><p id="f304" class="pw-post-body-paragraph kv kw iq kx b ky mt jr la lb mu ju ld le mv lg lh li mw lk ll lm mx lo lp lq ij bi translated">当我向我的开发者朋友展示这个项目时，他们都有第一个相同的问题:为什么是Crystal？你为什么选择Crystal而不是另一种更流行的编程语言？Crystal提供了其他现有编程语言没有的东西吗？是不是更灵活，更快，更容易使用等。比围棋，JavaScript，还是Python？</p><p id="e38c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">"<em class="ls">快如C，滑如红宝石</em>":是我发现水晶时读到的。Crystal确实非常注重性能。它提供了C/C++的性能和Ruby的语法。因此，您不必在性能和可读性之间做出选择，您可以创建兼顾两者的应用程序。</p><p id="b747" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用Crystal还有很多其他优势，我建议你看看<a class="ae lr" href="https://crystal-lang.org/" rel="noopener ugc nofollow" target="_blank">的官方文档</a>。我特别喜欢文档让您构建的两个示例项目:一个小型HTTP服务器和一个CLI。这是一个完美的起点，使用真实世界的用例/场景，而不是无聊无用的“你好，世界”。是的，我总是会在开始的时候打印一个“Hello，World ”,但这只是第一步。</p><p id="a66e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Crystal的语法真的很棒。正如该项目的主页所说:如果你知道并喜欢Ruby语法，你会喜欢用Crystal编码。还介绍了静态类型和面向对象的概念。我还没有尝过，但是下次我一定会尝一尝。</p><p id="ae51" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">2017年，Crystal受到空前的欢迎，在TIOBE指数中排名第32位。我在写这篇文章之前看了一下，我找不到水晶。似乎没有2017/2018年那么受欢迎了。这种受欢迎程度的下降伴随着其他潜在的问题。</p><p id="8c97" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我也很难找到示例项目或代码库。StackOverflow上常见问题的答案也是如此。对我来说，这是一个很大的缺点。如果你将它与任何其他编程语言进行比较，甚至与Rust进行比较，你会找到更多解决你的问题的答案。例如，我很难找到如何在Crystal中创建函数，甚至到今天，我仍然不确定在哪里可以找到这些信息。</p><p id="ab4a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Crystal中的依赖项或<em class="ls">碎片</em>也有同样的问题。有一些非常有趣的碎片，我甚至发现了一些数据狗的碎片。但是它们没有得到真正的维护，而且数量太少。我知道这是一种赢/赢或输/输的情况:你越受欢迎，人们就会建立更多的碎片。</p><p id="a58c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">无论如何，即使水晶也许不像几年前那样受欢迎，但这并不意味着我们不应该使用它。正如我在文章开头告诉你的，学习一门新的语言总是有趣和令人兴奋的。这就像学习一种新的乐器，但是是用你从以前的尝试中获得的所有知识。现在，您对项目的背景有了更多的了解，是时候深入项目本身了！</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="bcde" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">检索与IP地址相关的地理位置信息</h1><p id="510c" class="pw-post-body-paragraph kv kw iq kx b ky mt jr la lb mu ju ld le mv lg lh li mw lk ll lm mx lo lp lq ij bi translated">当你开始阅读这篇文章时，我提到了Matthieu项目，我决定在Crystal中构建一个简单的代理服务器。这个代理将与IfConfig.co通信，并将IP地址传递给它。然后会返回一个带有纬度和经度的响应，我们会将它发送回客户端。</p><p id="2c81" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是它在一个图像中的工作原理:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/6cef862e79eb647ea70d7aca518ba38b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTf8as5iUiRwykZr84DXLw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们的Crystal-api充当客户端和ifconfig之间的代理</p></figure><p id="67ab" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦我们从ifconfig得到响应，我们就把它传递给web浏览器。就这么简单！</p><p id="118b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在查看应用程序代码之前，先简单介绍一下ifconfig.co。这是一种网络服务，可以让你找到你的IP地址和相关信息。你可以得到很多信息，例如，国家，地区，城市，纬度和经度，用户代理等。请注意，源代码和文档可以在<a class="ae lr" href="https://github.com/mpolden/echoip" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上公开获得。</p><p id="69d0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你想运行这个项目，你可以在这个GitHub库上找到<a class="ae lr" href="https://github.com/DataDog/apps" rel="noopener ugc nofollow" target="_blank">的源代码。克隆它，然后转到<code class="fe my mz na nb b">examples/geomap</code>文件夹。有三个文件夹，但我们将只使用<code class="fe my mz na nb b">crystal-api</code>文件夹中的内容。我们还将使用<code class="fe my mz na nb b">docker-compose-api.yml</code>文件。如果你想知道其他两个文件夹里有什么，这些将在第二篇博文中讨论。</a></p><p id="90cd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果要在您的计算机上启动项目，请运行以下命令:</p><ul class=""><li id="c17d" class="nd ne iq kx b ky kz lb lc le nf li ng lm nh lq ni nj nk nl bi translated"><code class="fe my mz na nb b">docker-compose -f docker-compose-api.yml build</code>:它提取水晶图像，通过创建二进制文件来构建整个项目。</li><li id="ef8c" class="nd ne iq kx b ky nm lb nn le no li np lm nq lq ni nj nk nl bi translated"><code class="fe my mz na nb b">docker-compose -f docker-compose-api.yml up</code>:运行容器，即代理服务器，在端口8080公开。然后，您将不得不打开您的web浏览器到以下地址:<a class="ae lr" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>。</li></ul></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="8ad9" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">编写Crystal应用程序</h1><p id="4307" class="pw-post-body-paragraph kv kw iq kx b ky mt jr la lb mu ju ld le mv lg lh li mw lk ll lm mx lo lp lq ij bi translated">先说如何在你的机器上安装Crystal！根据您的操作系统，您可以用不同的方式安装Crystal。您可以在文档中查看<a class="ae lr" href="https://crystal-lang.org/install/" rel="noopener ugc nofollow" target="_blank">的安装步骤。</a></p><p id="e07f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，我认为这是主要问题之一:Crystal编译器不能在Windows上本地运行。2018年已经如此，今天依然如此。Linux可以用Windows子系统，但是我觉得你需要Windows 10或者11。</p><p id="a147" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">或者你可以用开发者最好的朋友之一:Docker。Docker图片有不同的<a class="ae lr" href="https://hub.docker.com/r/crystallang/crystal/" rel="noopener ugc nofollow" target="_blank">版本，包括阿尔卑斯山的</a>。然而，我发现DockerHub上的文档有点少，尤其是与<a class="ae lr" href="https://hub.docker.com/_/python" rel="noopener ugc nofollow" target="_blank"> Python </a>或<a class="ae lr" href="https://hub.docker.com/_/node" rel="noopener ugc nofollow" target="_blank"> NodeJS </a>图片相比。获得更多关于不同类型图像的信息和指导可能会很有趣。</p><p id="a454" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们分解我们的<code class="fe my mz na nb b">main.cr</code>文件中的代码，并逐个元素地检查它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="c824" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下是如何在Crystal中导入或要求一个文件或库。<code class="fe my mz na nb b">http/server</code>和<code class="fe my mz na nb b">json</code>是内置库，不需要安装。但是，如果需要安装一个依赖项，就需要更新<code class="fe my mz na nb b">shard.yml</code>文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="956a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦完成，运行<code class="fe my mz na nb b">shards install</code>命令。它不仅会安装依赖项，而且，你知道的，依赖项的依赖项，它还会生成一个“shard . lock”。<a class="ae lr" href="https://shards.info/" rel="noopener ugc nofollow" target="_blank">shards . info</a>网站包含一个存储库列表，包括最近的和流行的存储库。如果你想知道更多关于所有shards命令的信息，<a class="ae lr" href="https://crystal-lang.org/reference/1.3/the_shards_command/index.html#shards-commands" rel="noopener ugc nofollow" target="_blank">这里是参考</a>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="3893" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以创建局部或全局变量，而不必指定它们的类型。局部变量以小写字母开头。它们的类型是从它们的使用中推断出来的，而不仅仅是它们的初始化器。在上面的代码片段中，我们在寻找环境变量。如果它们被定义，我们使用它，否则我们设置默认值。这些环境变量在<code class="fe my mz na nb b">docker-compose-api.yml</code>文件的环境属性中定义。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="89c4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建一个函数或方法与在Ruby中是一样的:必须在函数的开头使用<code class="fe my mz na nb b">def</code>关键字，在函数的结尾使用<code class="fe my mz na nb b">end</code>。还要注意，关键字<code class="fe my mz na nb b">return</code>是存在的，但它不是必需的，如果你愿意，你可以省略它。你可以在官方文档中了解更多关于方法<a class="ae lr" href="https://crystal-lang.org/reference/1.3/syntax_and_semantics/the_program.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="92f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上面的代码示例中，我们通过使用点符号来访问对象中的属性和方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="6df0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">整个项目包括创建一个代理服务器，将与ifconfig.co通信。要在Crystal中创建web服务器，首先需要导入<code class="fe my mz na nb b">http/server</code>依赖项，然后初始化它，绑定一个端口，最后用<code class="fe my mz na nb b">server.listen</code>启动它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="f8d6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">能够在程序中编写控制流，或<code class="fe my mz na nb b">if</code>、<code class="fe my mz na nb b">else if</code>和<code class="fe my mz na nb b">else</code>，是我们通常要学习的第一件事。在Crystal中，测试条件时不需要括号。开关操作符被称为<code class="fe my mz na nb b">case</code>，其中<code class="fe my mz na nb b">until</code>只是一个<code class="fe my mz na nb b">while</code>条件的语法。文档包含了很多关于控制表达式的信息，你可以在这里找到<a class="ae lr" href="https://crystal-lang.org/reference/1.3/syntax_and_semantics/control_expressions.html" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="992d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你想用<code class="fe my mz na nb b">try...catch</code>块捕捉代码中的错误，我们将不得不使用<code class="fe my mz na nb b">begin...rescue</code>语法。和Ruby里的一样。该项目用它来解析JSON数据。如果你想了解更多关于异常处理的知识，你可以在这里查看文档<a class="ae lr" href="https://crystal-lang.org/reference/1.3/syntax_and_semantics/exception_handling.html" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="c6fc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，在我们进入更高级的概念之前，如果您想知道如何记录信息，如Python中的<code class="fe my mz na nb b">print</code>或JavaScript中的<code class="fe my mz na nb b">console.log</code>，您可以使用关键字<code class="fe my mz na nb b">puts</code>。<code class="fe my mz na nb b">"puts "My variable is #{my_variable}"”</code>允许您添加记录语句。然而，我不知道如何在Crystal中创建正确的日志。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="1140" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">还有更多</h1><p id="5dd3" class="pw-post-body-paragraph kv kw iq kx b ky mt jr la lb mu ju ld le mv lg lh li mw lk ll lm mx lo lp lq ij bi translated">还有一些东西没有在这篇文章中涉及到。例如，Crystal是一种面向对象的编程语言，我们在这篇博文中没有涉及到。框架和库也是如此。Matthieu和我目前正在Crystal中进行其他项目，我们将继续在这个系列中添加内容。</p><p id="d1fc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">同时，如果你已经渴望更多，这里有一个教程，它将解释如何在Crystal中创建一个简单的静态文件服务器。<a class="ae lr" href="https://crystal-lang.org/reference/1.3/getting_started/index.html" rel="noopener ugc nofollow" target="_blank">入门教程</a>也在Crystal中提供了两个有趣的小项目。</p><p id="4634" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你有任何问题，不要犹豫问他们，我将非常乐意与你讨论！下次见，感谢阅读，再见！</p></div></div>    
</body>
</html>