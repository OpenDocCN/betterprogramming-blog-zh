<html>
<head>
<title>Becoming Root Through Misconfigured SUDO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过错误配置的SUDO成为Root</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/becoming-root-through-misconfigured-sudo-7b68e731d1f5?source=collection_archive---------4-----------------------#2020-11-09">https://betterprogramming.pub/becoming-root-through-misconfigured-sudo-7b68e731d1f5?source=collection_archive---------4-----------------------#2020-11-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="92fa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用SUDO权限提升Linux权限</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/96cd5ac6f6d19635cc7d683d14380de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yuNj89fAOdeWs9DW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@yogipurnama?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">瑜伽士普尔纳马</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="e3fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">欢迎回到Linux安全系列！在本系列中，我们将讨论影响Linux系统的安全问题以及导致这些问题的常见错误配置。我们开始吧！</p><p id="dd79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">权限提升是攻击者提升系统权限的一种方式。例如，假设一个攻击者已经获得了对您的web服务器的访问权，但只是作为一个低特权用户。他们不能读写敏感文件、执行脚本或更改系统配置。他们如何危害您的服务器并保持对服务器的访问？</p><p id="927d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果他们可以找到一种方法来欺骗系统，使其认为自己是根用户，攻击者就可以进行更强大的攻击，如读写敏感文件和在系统中插入永久性后门。这就是特权升级的由来。</p><p id="e45d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我们来谈谈攻击者如何利用错误配置的SUDO权限来提升他们的特权。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7e1f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是SUDO？</h1><p id="cb48" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">SUDO代表“超级用户”这是一种特殊权限，允许用户以另一个用户(通常是根用户)的安全权限运行程序。</p><p id="ca98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管理员授予用户SUDO访问权限，以便他们可以作为根用户运行某些命令。如果管理员已经将命令的SUDO权限授予某个用户，该用户可以通过在实际命令前键入<code class="fe mz na nb nc b">sudo</code>命令，然后输入他们的密码，以root权限运行该命令。例如，要以root用户身份运行<code class="fe mz na nb nc b">whoami</code>命令，拥有SUDO权限的用户可以运行以下命令:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="4d0d" class="nh md it nc b gy ni nj l nk nl">$ whoami</span><span id="790f" class="nh md it nc b gy nm nj l nk nl">vickieli</span><span id="9cd4" class="nh md it nc b gy nm nj l nk nl">$ sudo whoami</span><span id="276a" class="nh md it nc b gy nm nj l nk nl">root</span></pre><p id="175c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数情况下，管理员只会授予用户对少数命令的SUDO权限。但即使这样，这些SUDO权限也会带来权限升级问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cffb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">SUDO权限升级</h1><p id="c2ea" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">那么，攻击者如何利用他们的SUDO权限以根用户身份执行任意命令呢？</p><p id="bbfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果攻击者对允许在系统上执行命令或任意写入文件的程序拥有SUDO权限，攻击者就可以利用临时超级用户访问权限在系统上以超级用户身份执行代码。您可以通过以下命令找到当前用户可以使用SUDO运行的命令:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="c8fe" class="nh md it nc b gy ni nj l nk nl">sudo -l</span></pre><p id="3680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，假设普通用户可以使用SUDO运行命令<code class="fe mz na nb nc b">find</code>，这样他们就可以搜索系统中的所有文件。<code class="fe mz na nb nc b">find</code>命令通常用于定位文件，通常具有SUDO权限，允许用户在系统中查找文件。但是<code class="fe mz na nb nc b">find</code>允许通过<code class="fe mz na nb nc b">-exec</code>标志执行系统命令！例如，要从<code class="fe mz na nb nc b">find</code>命令中运行<code class="fe mz na nb nc b">ls</code>命令，您可以使用命令<code class="fe mz na nb nc b">find . -exec ls \;</code>。因此，如果用户可以以SUDO身份运行<code class="fe mz na nb nc b">find</code>命令，他们就可以以root身份执行系统命令！</p><p id="4a0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些错误配置使得权限提升变得微不足道。例如，攻击者可以使用以根用户身份执行命令的能力，并将自己作为根用户添加到<code class="fe mz na nb nc b">/etc/passwd</code>文件中。该命令将完成以下任务:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="08ed" class="nh md it nc b gy ni nj l nk nl">find . -exec echo “vickie::0:0:System Administrator:/root/root:/bin/bash” &gt;&gt; /etc/passwd \;</span></pre><p id="98ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令使用用户名<code class="fe mz na nb nc b">vickie</code>和空密码添加一个根用户。由于<code class="fe mz na nb nc b">0</code>是root用户的UID，添加一个UID为<code class="fe mz na nb nc b">0</code>的用户将赋予该用户root权限。普通用户无法使用该命令，因为只有特权用户才能修改系统关键文件，如<code class="fe mz na nb nc b">/etc/password</code>文件。</p><p id="efc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很多程序都赋予用户执行系统命令的能力，<code class="fe mz na nb nc b">find</code>只是其中之一。其他例子包括<code class="fe mz na nb nc b">vim</code>、<code class="fe mz na nb nc b">python</code>、<code class="fe mz na nb nc b">less</code>和<code class="fe mz na nb nc b">more</code>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4c0e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更多的SUDO危险</h1><p id="f586" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用SUDO运行时导致权限提升的程序不仅限于允许执行任意系统代码的程序。任何允许对系统文件进行任意写入的程序在使用SUDO运行时都会导致权限提升。</p><p id="b6e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果文件编辑器Nano可以与SUDO一起运行，攻击者可以使用Nano的root权限打开<code class="fe mz na nb nc b">/etc/passwd</code>文件，并直接在文件编辑器中将自己添加为root用户！</p><p id="03fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并且系统实用程序cp用于复制和重写文件。如果它可以与SUDO一起运行，攻击者可以篡改系统上的任何文件，用其根权限覆盖原始文件！例如，攻击者可以在他们拥有的文件中创建原始文件<code class="fe mz na nb nc b">/etc/password</code>的副本。然后，他们可以通过编辑<code class="fe mz na nb nc b">passwd</code>文件的副本将自己添加为root用户。最后，他们使用<code class="fe mz na nb nc b">cp</code>命令用修改后的文件覆盖原来的<code class="fe mz na nb nc b">/etc/password</code>文件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ade1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">小心点！</h1><p id="e155" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">应该谨慎授予SUDO权利。当然，有些程序需要它，因为它们需要root权限才能正常运行。但是，如果您向允许用户执行系统命令或写入随机系统文件的程序授予SUDO权限，就会在您的系统中引入权限提升漏洞。</p><p id="acd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！下一次，我们将深入探讨攻击者可以用来危害您的系统的更多特权提升技术。</p></div></div>    
</body>
</html>