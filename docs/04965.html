<html>
<head>
<title>JavaScript Internals: What Actually Happens When You Call Console.log?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript内部:调用Console.log时实际会发生什么？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/javascript-internals-what-actually-happens-when-you-call-console-log-60a4949704f8?source=collection_archive---------11-----------------------#2020-05-26">https://betterprogramming.pub/javascript-internals-what-actually-happens-when-you-call-console-log-60a4949704f8?source=collection_archive---------11-----------------------#2020-05-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="af77" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">深入了解我们每天习以为常的功能</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/abd48e32dec680667415abc943c94b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_B9fk4OLex0SizoDAUC3w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Irvan Smith 在<a class="ae kv" href="https://unsplash.com/s/photos/javascript?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="b1e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们都知道JavaScript只是基于ECMAScript的一种方言。ECMAScript是关于语法和代码应该如何运行的规范。它可以用任何语言实现，就像任何其他标准一样。<br/> V8是用谷歌Chrome使用的C++写的，火狐的JavaScript引擎(SpiderMonkey和现在的TraceMonkey)也是用C++写的，Rhino是用Java写的。你会惊讶地发现，JavaScript也可以完全用JavaScript编写，就像Project水仙所做的那样。这将让您明白JavaScript可以用任何语言编写。它只是一个标准。</p><p id="40ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JavaScript的大多数实现显示的行为显然是由使用指针和ByRef参数传递引起的，这通常指向C或C++的使用。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8bbd" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">调用console.log时会发生什么？</h1><p id="c43c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">记住我们站在巨人的肩膀上工作总是好的，即使在调用最基本的代码行时也是如此。因此，让我们以V8——用C++编写的支持Chrome和Node.js的JavaScript运行时和WebAssembly引擎——为例进行深入研究。</p><h2 id="6f79" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">它将首先调用一个实用函数WriteToFile</h2><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="c25e" class="mw ma iq nj b gy nn no l np nq"><strong class="nj ir">void</strong> D8Console::Log(<strong class="nj ir">const</strong> debug::ConsoleCallArguments&amp; args,<br/>                   <strong class="nj ir">const </strong>v8::debug::ConsoleContext&amp;) {<br/>    <em class="nr">WriteToFile</em>(nullptr, stdout, isolate_, args);<br/>}</span><span id="2946" class="mw ma iq nj b gy ns no l np nq"><a class="ae kv" href="https://github.com/v8/v8/blob/4b9b23521e/src/d8-console.cc#L52-L55" rel="noopener ugc nofollow" target="_blank"><em class="nr">https://github.com/v8/v8/blob/4b9b23521e/src/d8-console.cc#L52-L55</em></a></span></pre><h2 id="42b6" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">经过内部预处理后，JavaScript值将调用fwrite</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="8a07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">函数<code class="fe nv nw nx nj b">fwrite</code>是<code class="fe nv nw nx nj b">libc</code>的一部分，按照ANSI C标准的规定，T1是C编程语言的标准库。众所周知，C标准库在不同平台上有几种实现。让我们以<code class="fe nv nw nx nj b">musl</code>为例，这是一个在Linux平台上用C语言编写的著名实现:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="6ae8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它将在内部调用一个实用函数(<code class="fe nv nw nx nj b">__stdio_write</code> ) <strong class="ky ir"> </strong>)经过一点间接调用，然后调用操作系统调用(<code class="fe nv nw nx nj b">writev</code>):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="1869" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nv nw nx nj b">syscall</code>符号是一个宏，经过大量预处理后会扩展到<code class="fe nv nw nx nj b">__syscall3</code>。操作系统之间的系统调用不同，处理器架构之间执行系统调用的方式也不同。它通常需要您编写(或生成)一点汇编。在x86–64上，<code class="fe nv nw nx nj b">musl</code>对<code class="fe nv nw nx nj b">__syscall3</code>的定义如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="e4ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将设置系统调用号和参数。在x86–64上，进行系统调用的指令称为<code class="fe nv nw nx nj b">syscall</code>。</p><p id="d4ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在进行syscall之后，控制权转移到内核(在本例中是Linux)。但那是另外一个故事了…</p><p id="93f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">系统调用将陷入内核。内核将保存大量关于进程和系统调用上下文的信息。在最简单的情况下，内核会将该进程放在一个等待处理的进程队列中，然后继续处理另一个等待处理的进程(例如，其他发出系统调用或硬件中断的进程)。然后，内核将继续服务最高优先级的请求/进程，最终返回到我们调用<code class="fe nv nw nx nj b">console.log</code>的进程。内核将会看到这个进程被阻塞并等待syswrite。它将获取之前存储的参数和其他数据，并通过特定于内核的实现写入文件。然后，它会将进程标记为“就绪”，并将其返回到就绪队列，以便在轮到运行时将控制权返回到调用进程。</p><p id="95a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">他们在系统调用之后停止了，因为很难说之后会发生什么。它完全依赖于操作系统内核及其实现细节。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="ba3e" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">别忘了给我们你的👏！</h2><p id="0f32" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">此外，关注与科技相关的出版物<a class="ae kv" href="https://medium.com/better-programming" rel="noopener">更好的编程</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/2c9c73c410c025ffffffa8dfee10dbce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OBAJEpu9Izgs6ThKjUvTeA.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">拍手！拍手！拍手！</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="4262" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请关注作者，定期获取未来文章的更新。</p><div class="nz oa gp gr ob oc"><a href="https://medium.com/@singhjp" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">贾尚·普里特·辛格——中等</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">阅读Jashan Preet Singh在媒体上的文章。全栈Web开发人员。每天，贾尚·普里特·辛格和成千上万的…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq kp oc"/></div></div></a></div><p id="207c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随时通过Linkedin联系:</p><div class="nz oa gp gr ob oc"><a href="https://www.linkedin.com/in/singhjp006/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">jashan Preet Singh——软件工程师——Chai Point | LinkedIn</h2><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">SDE | |热情_火山| |科技_漫游癖| |新_风险投资_领导力@麻省理工学院</p></div></div><div class="ol l"><div class="or l on oo op ol oq kp oc"/></div></div></a></div></div></div>    
</body>
</html>