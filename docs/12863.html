<html>
<head>
<title>6 Essential SSH Commands To Manage Remote Machines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理远程机器的6个基本SSH命令</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/essential-ssh-commands-new-developers-should-know-52e2e72703c8?source=collection_archive---------2-----------------------#2022-07-07">https://betterprogramming.pub/essential-ssh-commands-new-developers-should-know-52e2e72703c8?source=collection_archive---------2-----------------------#2022-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1589" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">带着你的钥匙</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/67d71d626d7f1d645824069ee81c00ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7vIBFZL5Z33LD9cqaTcmw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/es/@sickhews?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">韦斯·希克斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/computers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="114c" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在您的本地机器上构建应用程序是非常好的，直到需要研究生产中的实例。把你的头埋在沙子里不是一个选择，摸索随机的SSH标志会耗费太多的时间。如果您需要排除故障或者只是检查正在运行的服务，能够有效地连接到远程机器是一项必需的技能。</p><p id="586b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在本文中，我们将探索您希望在第一天就熟悉的基本SSH命令。这些能让你快速进出机器，而不会弄坏东西或拔头发。他们还将帮助您在出现问题时快速连接和排除故障。</p><h1 id="6657" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.选择多个私钥文件</h1><p id="7bd5" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">当您只有一个SSH密钥时，事情就相当简单了。很有可能你<a class="ae ky" href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" rel="noopener ugc nofollow" target="_blank">使用默认设置</a>生成了它，并将其保留为<code class="fe mz na nb nc b">id_rsa</code>。这是在您执行<code class="fe mz na nb nc b">ssh-add</code>时自动导入的，通常会默认出现在您添加的身份中。</p><p id="0090" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">当你管理一堆不同的密钥对时会发生什么？你有几个选择。您可以将它添加到现有的ssh-agent中，如下所示:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="ebae" class="nh md it nc b gy ni nj l nk nl">ssh-add ~/.ssh/&lt;private_key_file&gt;</span></pre><p id="2745" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">或者您可以在连接到主机时在SSH命令中手动指定它:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="7ddc" class="nh md it nc b gy ni nj l nk nl">ssh -i ~/.ssh/&lt;private_key_file&gt; user@host.com</span></pre><p id="930a" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这两个选项都可以，但后者更简单，可以避免您必须运行两个单独的命令来将身份加载到代理中。如果你只是想连接到一个你很少访问的主机，使用<code class="fe mz na nb nc b">-i</code>传递密钥肯定是更快的方法。</p><h1 id="c80d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.管理SSH代理身份</h1><p id="cb12" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">如果你经常在你的代理中使用许多不同的密钥对，这会变得有点混乱。当事情变得模糊不清，你不记得什么对什么的时候，确切地知道你的经纪人已经有什么，以及如何把它冲洗出来是非常有帮助的。</p><p id="7329" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果要查看添加到代理中的现有密钥，可以运行以下命令来列出它们:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="6a88" class="nh md it nc b gy ni nj l nk nl">ssh-add -l</span></pre><p id="747d" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这将向您显示所有当前加载的身份列表。如果您注意到一个不应该存在的密钥(可能是过期的密钥)，您可以通过传递以下命令来删除它:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="5f9f" class="nh md it nc b gy ni nj l nk nl">ssh-add -d ~/.ssh/&lt;private_or_public_key_file&gt;</span></pre><p id="ab08" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这要求您仍然拥有原始密钥文件来删除它。如果您不再拥有它们，或者您想要清除所有键并重新开始，您可以执行:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="6285" class="nh md it nc b gy ni nj l nk nl">ssh-add -D</span></pre><p id="555e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这将删除所有已加载的身份，您可以再次开始逐个添加内容。</p><h1 id="fca6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.跳过已知主机检查</h1><p id="bd77" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">连接到新的外国机器总是会产生一些额外的输出。如果您以前从未连接过，您会收到一个提示，要求您批准连接，因为您以前从未与该主机交谈过，并且它不在您的<code class="fe mz na nb nc b">known_hosts</code>文件中。如果您想绕过这一点，避免这种不断的纠缠，您可以通过传递:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="3ee6" class="nh md it nc b gy ni nj l nk nl">ssh -o StrictHostKeyChecking=no user@host.com</span></pre><p id="529a" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这将阻止提示，并且下次您连接到同一主机时，它将自动在<code class="fe mz na nb nc b">known_hosts</code>文件中有一个条目。</p><h1 id="af20" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.带着你的钥匙</h1><p id="0ba7" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">如果您希望使用自己的密钥对从一个主机跳到另一个主机，那么您可能会发现最初效果不太好。如果你连接到第一个主机，然后注意到一旦你试图跳转到另一个你得到一个<code class="fe mz na nb nc b">Permission denied</code>错误，这是因为你没有转发你的代理。</p><p id="0559" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为了转发您的SSH代理并随身携带您的密钥，您必须向SSH传递另一个标志:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="7207" class="nh md it nc b gy ni nj l nk nl">ssh -A user@host.com</span></pre><p id="ee6f" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这个简单的开关使SSH能够将您正在运行的<code class="fe mz na nb nc b">ssh-agent</code>副本转发到远程主机，此时您可以使用它跳转到另一台主机。这假设相同的密钥可以在多个主机上使用。</p><h1 id="7fe3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.通过SSH执行命令</h1><p id="7210" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">您可能希望在多台不同的主机上快速运行命令。也许您正在运行一个脚本并调用SSH，或者只是一个快速的命令行程序来获取一些关键信息。在这种情况下，根据命令的不同，您可能需要分配一个伪终端。</p><p id="a37c" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果您将要执行的特定命令传递给SSH，默认情况下，它不会提供交互式会话。分配一个伪终端允许您远程对主机运行脚本和其他“交互式”命令。如果您收到一个关于终端未被分配的警告，您可能需要在连接时传递<code class="fe mz na nb nc b">-t</code>标志:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="23e7" class="nh md it nc b gy ni nj l nk nl">ssh -t user@host.com top</span></pre><p id="0562" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这将启用伪终端分配，并允许您成功执行命令。</p><h1 id="008e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">6.为连接故障排除启用详细输出</h1><p id="7090" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">当你确信你使用了正确的键时，连接到主机并得到可怕的<code class="fe mz na nb nc b">Permission denied</code>可能会令人抓狂。很有可能幕后还有其他事情在进行。如果您正在寻找您的公钥被拒绝的原因，您可能希望在SSH中启用调试模式来深入研究。</p><p id="4971" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">要启用调试模式，只需在连接到主机时将<code class="fe mz na nb nc b">-v</code>参数传递给SSH，如下所示:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="edec" class="nh md it nc b gy ni nj l nk nl">ssh -v user@host.com</span></pre><p id="41f5" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这将增加控制台输出的冗长性，并向您显示SSH尝试使用的认证方法的细目。这对于确保您假设正在使用的认证方法实际上正在使用<em class="nm">是非常方便的。</em></p><p id="eff3" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">下面是启用详细模式并使用公钥连接到服务器的示例。在输出中，您可以清楚地看到我们是如何尝试身份认证的，以及使用了哪些凭据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/2b0d0a6902d51e191c570ae677e66134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VvOH4r-CHnq7eX2NuORqVA.png"/></div></div></figure><p id="7a8a" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">您可以传递多达三个连续的<code class="fe mz na nb nc b">-v</code>标志，以进一步提高日志输出的详细程度。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="226d" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">有更多我错过的SSH技巧和窍门吗？让我了解他们！如果你想知道更多宋承宪的精彩，也可以看看我的其他文章:</p><ul class=""><li id="265f" class="no np it li b lj lk lm ln lp nq lt nr lx ns mb nt nu nv nw bi translated"><a class="ae ky" href="https://medium.com/better-programming/simple-ssh-tweaks-for-remote-developers-4392a1409c33" rel="noopener"> <em class="nm">针对远程开发者的简单SSH调整</em> </a></li><li id="dd2b" class="no np it li b lj nx lm ny lp nz lt oa lx ob mb nt nu nv nw bi translated"><a class="ae ky" href="https://medium.com/better-programming/how-to-run-ssh-commands-with-python-8111ee8ab405" rel="noopener"> <em class="nm">如何在Python中抽象SSH命令</em> </a></li></ul></div></div>    
</body>
</html>