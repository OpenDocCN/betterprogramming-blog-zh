# 我在 2020 年学到的 20 个软件工程指南

> 原文：<https://betterprogramming.pub/20-software-engineering-guidelines-i-learned-in-2020-8106d03d953b>

## #13:不要将测试代码视为二等公民

![](img/f369b53276cdca8e844f1b8ce4195150.png)

照片由 [CHUTTERSNAP](https://unsplash.com/@chuttersnap?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

2020 年是我作为软件工程师工作的第一年，也是我在旧金山生活的第一年。多亏了疫情，我在一个令人兴奋的新城市的探索比我预想的少了很多，而有了更多的烘烤和观看虎王的时间。唯一的希望是，我可以花一些呆在家里的时间阅读和处理个人项目，因此我学到了比平常一年更多的软件工程最佳实践。以下是我最有价值的 20 条经验。

# 20 大准则

## **1。优化代码可读性**

开发人员将大部分生产时间用于阅读代码，而不是编写代码:调试、检查他人提交的代码、学习新的库等等。这意味着您的代码应该易于理解，即使这意味着更长的名称、更多的代码行和更少的“聪明”

例如，将变量命名为`timeInMillis`而不是`time`需要一点额外的输入，但是可以让开发人员不必查看代码库来判断变量使用的是哪个时间单位。

另一个例子是 LeetCode 讨论中发布的所有一行程序解决方案。这个[回文数的解法](https://leetcode.com/problems/palindrome-number/discuss/1014749/Python3%3A-2-line-simple-pythonic-code-with-95.93-faster-runtime)很巧妙:

```
**def isPalindrome(self, x: int) -> bool:
        a=list(str(x))
        return a==a[::-1]**
```

但是它比更冗长的解决方案更难理解。想出一行程序可能是一个有趣的挑战——只要确保您没有将它添加到有多个贡献者的代码库中。

## **2。有些重构比其他重构更有价值**

只有在重构能帮助你和你的团队节省更多时间的情况下，你才应该在重构上投入时间。将您的精力集中在频繁读写的代码库部分。

考虑使用不紧急的重构作为新员工的入职任务——这样，它们仍然是一个有价值的学习机会。

## **3。把科技债务想象成金融债务——少量的科技债务没关系**

有时，更早地(例如，在竞争对手发布类似的特性之前)获得有价值的特性的商业利益使得发布不完美的代码是值得的，只要有计划在太多的“兴趣”积累之前很快改进代码。如果你积累技术债务的速度快于你偿还它的速度，并且代码库变得越来越难处理，那么技术债务就会成为一个问题。

例如，如果时间紧迫，在完成测试之前发布一个特性，然后在之后添加测试可能是正确的商业决策。但是如果你拖延添加测试，新的代码开始依赖于你的未测试的代码，并且其他功能也是在没有测试的情况下发布的，那么偿还债务和回到维护良好的代码库将会越来越难。

## **4。避免意外**

您的团队成员会根据常见的模式对您的代码做出假设，因此您不应该因为偏离模式而让他们感到惊讶。

例如，如果你写了一个`isButtonEnabled()`函数，你的队友可能会认为它检查了一些东西并返回一个布尔值，而没有执行任何副作用，因为大多数以`is-`开头的函数都是这样。如果它确实产生了副作用，函数名应该清楚地表明这一点。

## **5。名称长度应该与作用域的长度相关**

例如，像`i`和`j`这样的变量名对于一个小的 For 循环来说是很好的，但是全局常量的名字应该对它的预期用途非常精确。

## **6。功能也是为了可读性，而不仅仅是为了避免重复**

除了“做同样的事情 3x”代码的味道，我还发现了另外两个有用的味道:1)当我添加注释来解释一段代码做什么的时候，以及 2)当嵌套超过三层的时候。

例如，假设我有以下 UI 设置函数:

```
**fun setupViews() {**
    *// set up textView*
    **textView.isVisible = …
    textView.text = …
    …more textView setup…**
    *// set up imageView*
 **imageView.image = …
    imageView.backgroundColor = …
    …more imageView setup…
}**
```

我会将`setupTextView()`和`setupImageView()`放入它们自己的函数中，即使它们不包含重复的代码。这样，代码更加自文档化，如果有人需要更改或调试`imageView`，他们可以直接进入`setupImageView()`，而不是通读所有的设置代码。

另一个常见的启发是当一个函数长于 *x* 行时，我见过有人把 *x* 放在 5 到 100 范围内的任何地方。我个人开始寻找提取函数的方法，一旦我不滚动就不能阅读整个函数。

## **7。重复可以以多种形式出现**

[不要重复自己](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself)(干)是软件工程最广为人知的原则之一。最明显的重复是看起来完全一样的代码行，但也有不太明显的形式，如实现的重复。

例如，给定以下类:

```
**class TreeNode {
    val value: String
    var children: List<TreeNode>
    val isLeaf: Boolean** **fun addChild(node: TreeNode) {
        children.add(node)
        isLeaf = false
    }** **fun removeChild(node: TreeNode) {
        children.remove(node)
        if (children.isEmpty()) isLeaf = true
    }
}**
```

您可以添加`fun isLeaf() = children.isEmpty()`，而不是让`isLeaf`成为一个布尔字段，每次更新一个孩子时您都必须设置它，这意味着当您对类进行更改时，您不必检查`isLeaf`是否仍在正确更新。

## **8。不重复别人**

在实现某个东西之前，检查代码库中是否已经存在一个实现。

例如，如果您正在处理时间，一个`SECONDS_PER_MINUTE`常量可能已经存在，您可以重用它，而不是在整个代码库中有它的多个定义。

## **9。学习并遵循项目的编码风格指南**

一套统一的指导方针使团队成员更容易理解彼此的代码和接纳新成员。通常情况下，实际的规则并不重要，重要的是确保它得到执行。例如，我见过一些 Kotlin 项目，其中包含扩展函数的文件都以`-Ext`结尾，而其他项目则使用`-s`结尾。实际的选择并不重要，重要的是始终如一地使用选择，这样程序员就知道是在`FooExt.kt`还是`Foos.kt`中的`Foo`上找到扩展函数。

## **10。为清洁器代码添加 lint 规则**

您的项目可能已经使用了 lint 工具。如果您发现自己多次手动进行相同的格式改进，或者在代码评审中反复看到挑剔的地方，那么可以考虑添加一个新的 lint 规则。

## **11。花些时间了解你的 IDE**

现代的 ide 像 Android Studio 和 VSCode 都很强大。熟悉它的工具(例如调试器)和键盘快捷键需要一些前期的时间投入，但是从长远来看会节省你很多时间。您还应该自定义设置和键盘快捷键，以便针对您的工作流程进行优化。例如，JetBrains IDEs 默认没有“拆分编辑器标签页”快捷方式(你必须单击窗口→编辑器标签页→垂直拆分)，但我为它添加了一个自定义快捷方式，因为我一直在使用它。

## **12。评论应该是关于为什么，而不是如何**

理想情况下，代码是自解释的，不需要注释。程序员在进行代码修改时，往往会忽略更新注释，所以随着时间的推移，注释会变得不准确，或者与他们描述的代码分离。当你准备写一个注释来解释你的代码是如何工作的时候，看看你是否可以重构代码，使其不言自明。

然而，代码本身并不总是足以解释为什么你选择了一种方法而不是一种相似的方法。在这些情况下，注释有助于提供上下文，例如，如果有产品需求、系统限制或效率考虑推动您的决策。

## 13。不要把测试代码当成二等公民

当处理生产代码时，您可能会花一些时间来计划它，并确保它在发布之前写得很好，但是程序员通常会发布测试代码，只要它能工作。然而，测试代码也需要维护，当代码很难理解时，这要痛苦得多。

问题的一部分是测试代码经常没有得到严格的审查。我意识到我把大部分的代码审查工作花在了生产代码上，我假设测试代码是好的，因为测试通过了。我也是最近才开始仔细审查测试代码的。

## **14。** [**表驱动测试**](https://www.codetips.co.uk/table-driven-tests/)

几个月前我发现了 [JUnit 的参数化测试](https://www.tutorialspoint.com/junit/junit_parameterized_test.htm)，它们帮助我编写了更加全面的测试。

常规的单元测试通常每个输入都有一个测试函数。您最终会得到许多重复代码的函数，并且很容易遗漏一些输入。表驱动测试有一个单一的测试函数和一个包含所有可能的输入及其预期输出的表，这个测试函数在每个输入上都重复。

## **15。跳上新图书馆的宣传列车是有风险的**

如果一个库处于 1.0 之前的阶段，很可能会有突破性的变化。

在新发布的库中，测试的容易性可能是次要的考虑因素——如果您想在一个大项目中采用它，请验证它是否与您的测试代码以及生产代码配合良好。

在社区广泛采用之前，当你遇到库的问题时，很难找到资源。而且总有这样的可能性:广泛的采用永远不会发生，项目会被维护者忽略(看看你，[数据绑定](https://developer.android.com/topic/libraries/data-binding))。

似乎每个人都已经在使用这个库了，但是他们是在真正的项目中使用它还是仅仅在他们的演示笔记应用中使用它呢？

## 16。当向队友寻求帮助时，关注他们的过程，而不仅仅是他们的解决方案

记住他们使用了哪些资源和工具，这样如果你将来遇到类似的问题，你就能更好地自己解决它。我发现这对发现新的文档资源、Git 命令、键盘快捷键等很有价值。

## **17。被您的变更弄糊涂或弄错的代码审查者是** [**代码气味**](https://martinfowler.com/bliki/CodeSmell.html)

除了回应他们的评审意见，考虑重构或者添加一个清晰的评论。这样，任何人在将来阅读该代码时都不会遇到同样的困惑。

## **18。阅读代码评审**

当你理解一段代码有困难时，做一个 [Git 责备](https://www.atlassian.com/git/tutorials/inspecting-a-repository/git-blame#:~:text=The%20git%20blame%20command%20is%20used%20to%20examine%20the%20contents,author%20of%20the%20modifications%20was.&text=git%20blame%20and%20git%20log,history%20of%20a%20file's%20contents.)并通读添加该代码的 pull 请求的代码审查是有帮助的。代码审查显示了代码库的哪些其他部分同时被更改，因此可能是有价值的，并且可能包含解释代码背后的决策的对话。

如果您正在实现一个已经存在类似特性的特性，阅读类似特性的代码评审可以帮助您计划实现。例如，如果我正在添加一个已经在 iOS 或网络上存在的 Android 功能，我经常发现了解其他平台是如何处理它的会很有帮助。

## **19。学习你喜欢的学习方式——不一定是兼职项目**

在大学里，你可能知道课外项目和黑客马拉松是课外学习和求职时脱颖而出的主要方式。但是当你在找第二份工作的时候，你的工作项目可能会比你的副业项目更复杂、更有趣。

如果副业是你喜欢做的，那就坚持做下去！但如果没有，还有很多其他的学习方法:阅读博客、观看讲座、参加在线课程、听播客等。弄清楚哪些是你最喜欢的，或者你是否更愿意把你的空闲时间完全花在其他爱好上。

## **20。学习资源质量参差不齐**

任何人都可以在网上发表技术博文(比如我！).如果你试图通过博客来学习一些东西，但没有意义，可能是因为写得不好；与其放弃这个话题，不如尝试不同的资源。

第一方资源/教程通常是一个很好的起点。会议讨论和公司技术博客也往往质量更高，因为它们有更严格的审查程序。

# 最终注释

说到学习资源，以下是我今年学到最多的资源，也是这些指导原则背后的资源:

*   重构大师(Refactoring Guru)——一个涵盖编写和重构干净代码的网站
*   [Clean Code](https://www.goodreads.com/book/show/3735293-clean-code) —一本经典的软件工程书籍。有些内容感觉过时了，和《重构大师》有一点重叠，但它仍然是一本有价值的读物。
*   [马丁·福勒的网站](https://martinfowler.com/architecture/) —他写了几本关于软件开发的书，他的网站有很多关于软件架构和重构的好内容。
*   Android 每周简讯——每周简讯，包含精选的技术文章、播客和演讲。它是 Android 特有的，但大多数其他平台也有类似的每周简讯。我真的很喜欢它，因为它能让我站在新的 Android 事物的顶端。
*   Yelp Android school——GitHub 对优秀技术演讲的回购。其中大约一半是针对 Android 的，一半是关于软件工程的。