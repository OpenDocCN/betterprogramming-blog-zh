<html>
<head>
<title>React Testing: Get Started With Cypress.io</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React测试:Cypress.io入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-testing-get-started-with-cypress-io-a19b6eb6332a?source=collection_archive---------17-----------------------#2020-02-17">https://betterprogramming.pub/react-testing-get-started-with-cypress-io-a19b6eb6332a?source=collection_archive---------17-----------------------#2020-02-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2651" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用最少的努力编写有意义的端到端测试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b7546ee969e61d5137e7aba932398540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KkA0-ia3Gd_VrGdl"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@vishnurnair?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">毗湿奴·R·奈尔</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="60f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开发人员讨厌编写测试。这需要时间，并且最终不会为客户提供额外的价值。此外，它往往是无聊的。</p><p id="ef59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了Cypress，我发现了一个全新的测试视角。它更容易理解，更有效，也更有趣。</p><p id="b8f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将向您展示Cypress在React应用程序中的实现，您可以从<a class="ae kv" href="https://github.com/Dromediansk/countries-app-blog/tree/react-router-implementation" rel="noopener ugc nofollow" target="_blank">这个Github repo </a>中克隆它。我们的目标是测试应用程序的主要功能——这意味着编写导航链接、API请求和过滤器功能的测试。</p><p id="0fa9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:如果你有兴趣从头开始构建整个应用程序，你可以从故事<a class="ae kv" href="https://medium.com/better-programming/some-best-practices-for-building-a-react-app-with-hooks-d6157494f5c1" rel="noopener">开始用钩子构建React应用程序的一些最佳实践</a>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="09c4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">关于赛普拉斯你应该知道什么</h1><p id="664f" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这是一个E2E测试工具，它简化了编写测试的过程。这些测试的目的是演练一个完整的类似生产的场景。这意味着我们能够模拟用户行为并涵盖所有需要的功能。</p><p id="7061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Cypress有一个很好的GUI，你可以看到单独的测试，以及它在你的应用程序中的样子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/88776cf1ef3f7a85d7a476f985775637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZQGS9eJdVU-2ncY1MfYGzA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Cypress测试跑步者示例</p></figure><p id="a061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是使用Cypress时的亮点:</p><ul class=""><li id="e017" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">测试易于阅读和编写(类似于简单英语)。</li><li id="daa0" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">测试运行程序使用web浏览器，因此您可以实时看到测试了什么功能。</li><li id="a1e1" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">您可以在测试运行的同时开发您的应用程序。</li><li id="9b8d" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">可读的错误信息有助于快速调试。</li><li id="cf26" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><a class="ae kv" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank">精心编制的文件</a>。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="7653" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">安装Cypress</h1><p id="b63f" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在，让我们把重点放在实际的部分。您可以使用以下命令克隆Github repo<a class="ae kv" href="https://github.com/Dromediansk/countries-app-blog/tree/react-router-implementation" rel="noopener ugc nofollow" target="_blank">并安装Cypress:</a></p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="4d97" class="nq ma iq nm b gy nr ns l nt nu">npm install cypress --save-dev</span></pre><p id="1555" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">过一会儿，它会在根目录下添加一个新的<code class="fe nv nw nx nm b">cypress.json</code>文件和<code class="fe nv nw nx nm b">cypress</code>文件夹。我们将在<code class="fe nv nw nx nm b">cypress/integration/examples</code>存储我们所有的测试。</p><p id="6e86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以用这个打开柏树:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="a2cf" class="nq ma iq nm b gy nr ns l nt nu">./node_modules/.bin/cypress open</span></pre><p id="1872" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我知道，这是一个可怕的方式每次推出赛普拉斯。我会立刻忘记这个命令。幸运的是，您可以通过在<code class="fe nv nw nx nm b">package.json</code>中添加以下npm脚本来简化它:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="c276" class="nq ma iq nm b gy nr ns l nt nu">"scripts": {     <br/>    "cypress": "cypress open"   <br/>}</span></pre><p id="d7f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后只需要<code class="fe nv nw nx nm b">npm run cypress</code>就可以开柏树了。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b18c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">告诉赛普拉斯访问网站</h1><p id="6737" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在我们编写测试之前，我们需要命令Cypress访问我们的网站。首先，让我们定义一下<code class="fe nv nw nx nm b">cypress.json</code>中的<code class="fe nv nw nx nm b">baseUrl</code>:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="ea6c" class="nq ma iq nm b gy nr ns l nt nu">{<br/>    "baseUrl": "http://localhost:3000"<br/>}</span></pre><p id="e041" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nv nw nx nm b">baseUrl</code>是用作<code class="fe nv nw nx nm b"><a class="ae kv" href="https://docs.cypress.io/api/commands/visit.html" rel="noopener ugc nofollow" target="_blank">cy.visit()</a></code>或<code class="fe nv nw nx nm b"><a class="ae kv" href="https://docs.cypress.io/api/commands/request.html" rel="noopener ugc nofollow" target="_blank">cy.request()</a></code>命令URL前缀的URL。存储我们的基本URL是一个很好的实践，这样它在我们所有的测试中都是可访问的。</p><p id="d509" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们可以告诉赛普拉斯访问网站。在<code class="fe nv nw nx nm b">/cypress/integration/examples</code>中，我们可以创建一个新的规范文件，将其命名为<code class="fe nv nw nx nm b">routeNavigation.spec.js</code>，并编写以下命令:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="929a" class="nq ma iq nm b gy nr ns l nt nu">cy.visit("/");</span></pre><p id="ef61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Cypress的所有功能都在全局<code class="fe nv nw nx nm b">cy</code>对象下可用。试着运行这个测试看看结果。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1b08" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">测试导航链接</h1><p id="c424" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果用户想使用我们的应用程序，导航链接是必须工作的核心功能之一。开始时编写简单的测试并了解语法也是合适的。</p><p id="6ce0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以让我们在<code class="fe nv nw nx nm b">routeNavigation.spec.js</code>中编写测试:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><ul class=""><li id="8743" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">在第2行的<code class="fe nv nw nx nm b">before()</code>中，我们可以实现在任何测试运行之前执行的代码——在我们的例子中是访问网站的默认路径。</li><li id="85d7" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe nv nw nx nm b"><a class="ae kv" href="https://docs.cypress.io/api/commands/get.html#Syntax" rel="noopener ugc nofollow" target="_blank">cy.get()</a></code>用于选择合适的元素。我们正在搜索<code class="fe nv nw nx nm b">a</code>元素，它是类<code class="fe nv nw nx nm b">nav-list-item</code>的子类。</li><li id="9717" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe nv nw nx nm b">eq(1)</code>代表选择第二个元素。计数从零开始。</li><li id="5c3a" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">我们正在模拟所选元素上的点击事件。</li><li id="b555" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">最后，使用<code class="fe nv nw nx nm b"><a class="ae kv" href="https://docs.cypress.io/api/commands/location.html#Syntax" rel="noopener ugc nofollow" target="_blank">cy.location</a></code>，我们检查<code class="fe nv nw nx nm b">pathname</code>是否在地址栏中包含<code class="fe nv nw nx nm b">/data</code>。</li><li id="a56a" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe nv nw nx nm b">timeout</code>是一个可选设置，您可以通过它来确定等待解决的时间。我很确定99%的用户会在等待一分钟后离开网站。</li></ul><p id="2013" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以类似的方式，您可以为每一条其他的路线编写测试。你可以自己尝试，到处玩。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="cf77" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">对API的测试请求</h1><p id="e3a3" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们的目标是检查我们是否得到状态为200的响应，以及是否收到带有国家数据的响应。</p><p id="dbc8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般来说，测试请求可以用<code class="fe nv nw nx nm b"><a class="ae kv" href="https://docs.cypress.io/api/commands/request.html#Syntax" rel="noopener ugc nofollow" target="_blank">cy.request()</a></code>方法来执行。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="3a27" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">测试输入的焦点</h1><p id="6827" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">该测试的目标是检查当用户访问页面时，按国家搜索的输入是否被聚焦。</p><p id="8211" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，确认带有占位符<code class="fe nv nw nx nm b">country</code>的输入已经在<code class="fe nv nw nx nm b">AdvancedFilter.js</code>中设置了道具<code class="fe nv nw nx nm b">autofocus</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="178c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以编写一个测试来检查它是否工作。因为我们正在测试另一个功能，所以让我们为此创建一个新文件，并将其命名为<code class="fe nv nw nx nm b">filtering.spec.js</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><ul class=""><li id="8621" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">与前面的测试文件类似，我们首先告诉Cypress访问所需的路线。</li><li id="62d1" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">在测试中，我们通过<code class="fe nv nw nx nm b">name</code> prop选择输入，并检查它是否在焦点上。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5705" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">测试过滤器功能</h1><p id="0806" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我会考虑过滤我们应用程序的一个重要部分。如果它没有功能，应用程序的目的就失去了。因此，我们应该首先测试按国家搜索是否有效。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按国家测试搜索</p></figure><p id="7b02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该测试的目标是检查当用户输入一些文本(例如“us”)时，值是否会改变。在此之后，我们还期望过滤后的国家与值(8)相匹配。</p><p id="2081" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，关于如何增强这个测试，有许多选项，所以可以随意尝试。此外，您可以自己为其他输入编写测试。</p><p id="ff21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是GitHub repo的最终版本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/80d244155219fb28d43cb4ade940e862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzvsCpkKn8qJDUby46oSdg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">最终版</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="6f9a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">最后的话</h1><p id="077a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我希望你至少和我一样对柏树感到惊讶。这是一个非常棒的E2E测试工具，适用于各种技术——不仅仅是React。它很快，测试很容易阅读，并且有很棒的文档。</p><p id="c1ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，一个好的开发者应该学会<em class="ob">如何</em>和<em class="ob">在应用中测试什么</em>。如果你写的测试增加了代码覆盖率，但没有测试真正的功能，这只是浪费时间。</p><p id="9330" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，如果你想做适当的测试，你必须学习相应的语法，匹配器等。，这当然需要更多的时间。因此，在开始花时间编写测试之前，明智的做法是考虑测试的整体范围。</p><p id="f079" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>