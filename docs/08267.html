<html>
<head>
<title>8 Pieces of Advice I Wish Someone Gave Me When I Started Working On a tvOS App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当我开始开发tvOS应用程序时，我希望有人给我8条建议</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/8-pieces-of-advice-i-wish-someone-gave-me-when-i-started-working-on-a-tvos-app-fe3075525782?source=collection_archive---------7-----------------------#2021-04-12">https://betterprogramming.pub/8-pieces-of-advice-i-wish-someone-gave-me-when-i-started-working-on-a-tvos-app-fe3075525782?source=collection_archive---------7-----------------------#2021-04-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="40d7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">过渡到tvOS并不难。然而，有些事情制造了障碍</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b934aeb3ca4b1232f48c648dad198850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DlzeN5s9JzPX6HKGB-zZIA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@kellysikkema?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">凯利·西克玛</a>在<a class="ae kv" href="https://unsplash.com/s/photos/apple-tv?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b262" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">七年前，我开始从事iOS开发工作。直到今年2月，iOS是我开发app的唯一平台。过渡到tvOS并不难。但是，有些事情造成了问题，浪费了时间。以下是我希望有人在我开始做tvOS时给我的八条建议。</p><p id="3a47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里没有特别的顺序。根据你从事的项目，有些信息对你来说会更重要。而且，这些提示并不是高级功能；这些是你交付tvOS项目所需要的基础。</p><p id="aa53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">继续阅读前的重要提示</strong>。对于其中的许多技巧，有人可以写一整篇博文。不幸的是，你在这里找不到完整的操作方法。然而，如果关于这个话题还有更多要说的，我会留下对我有帮助的链接。如果您想了解更多信息，请查看这些内容。</p><h1 id="7bcc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">UIFocus指南</h1><p id="58b4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">理解苹果的focus引擎非常简单。您可以使用Apple TV的遥控器来移动可聚焦的对象。你可以上，下，左，右。这将覆盖你的tvOS应用中95%以上的用例。</p><p id="7c70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，有些情况下我们需要一些帮助。让我们看看这个例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/1298d4401f015ddff253362608a6c49e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rp1Ws0qc9POhNaLsxrBZ7g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Xcode截图</p></figure><p id="c0ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您有水平的项目集合和它们下面的两个按钮。如果你的焦点在最后一项5上，然后你向下移动，你的焦点就不会在按钮上。要实现这样的行为，您需要使用UIFocus指南。</p><p id="0fa9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">UIFocus guide是一个库，它允许我们通过创建自定义规则将焦点重定向到任何屏幕元素。使用它非常简单。你只需要定义起点和终点以及方向。下面是一些帮助您的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="c095" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于这个话题还有更多要说的。幸运的是，这些家伙已经做到了。它帮助我理解了UIFocus指南是如何工作的，并在项目中实现了它。上面的addFocusGuide方法是从那些指南中继承过来的。</p><h1 id="2b8e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">自定义焦点</h1><p id="d076" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">首先，你需要知道任何东西都可以通过覆盖<code class="fe ms mt mu mv b">canBecomeFocusedProperty</code>来聚焦。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="c9ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，如果您希望在关注视图时获得一些特殊效果，则必须重写didUpdateFocus方法。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="e40c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ms mt mu mv b">UIFocusUpdateContext</code>是从一个视图到另一个视图提供与特定焦点更新相关的信息的对象。使用它，我们可以确定我们是要聚焦我们的视图还是将焦点从它转移到其他地方。以下代码将有所帮助:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="0b3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe ms mt mu mv b">focusedStyle</code>和<code class="fe ms mt mu mv b">notFocusedStyle</code>方法中，您将添加适当的代码。你也可以在这里添加动画。对于更高级的动画，你将使用<code class="fe ms mt mu mv b">UIFocusAnimationCoordinator</code>。</p><p id="8239" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要找到更多关于这个话题的信息和学习更先进的东西，请查看<a class="ae kv" href="https://www.bignerdranch.com/blog/10-tips-for-mastering-the-focus-engine-on-tvos/" rel="noopener ugc nofollow" target="_blank">这个来自大书呆子牧场的博客帖子。</a></p><h1 id="8b10" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">安全区域</h1><p id="0588" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这将是简短的，但内容丰富。与iOS设备不同，tvOS安全区域的边缘在所有四个边上都有插图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/db0fc9fd82296c8071e0e8ae033c782b.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*cqQJejBTFFTpHbSoRV3QiA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://developer.apple.com/design/human-interface-guidelines/tvos/visual-design/layout/" rel="noopener ugc nofollow" target="_blank">苹果的人机界面指南</a>提供</p></figure><p id="8b44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可能会导致表和集合的内容出现问题。如果滚动视图的内容需要移动到边缘，您必须忽略安全区域。</p><h1 id="5e6e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">收藏视图组合布局</h1><p id="737e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这项技术并不新鲜。不过，我到现在都没用过。为我感到羞耻，因为我没有更快适应它。</p><p id="92b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我开始开发tvOS应用程序时，第一批任务之一就是创建一个典型的tvOS布局——你可以垂直和水平滚动的内容。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/45b60af5447958266c395c2549a354fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*NzNzPUG8E_u2q652BkUXxQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://developer.apple.com/design/human-interface-guidelines/tvos/visual-design/layout/" rel="noopener ugc nofollow" target="_blank">苹果的人机界面指南</a></p></figure><p id="77f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我开始将它实现为一个表格视图，其单元格包含一个集合视图。这种方法导致了安全区域的问题。出于某种原因，桌子没有理睬他们。在修复之前，我的一个同事让我注意到了集合视图的组合布局。</p><blockquote class="mx my mz"><p id="8d2b" class="kw kx na ky b kz la jr lb lc ld ju le nb lg lh li nc lk ll lm nd lo lp lq lr ij bi translated">集合视图<em class="iq">布局</em>定义了集合中内容的视觉排列。布局被设计得非常灵活，允许你为你的内容创建任何类型的安排，从简单到复杂。</p></blockquote><p id="d34d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的垂直收藏视图将有水平部分。每组只包含一个项目。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="f830" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用它我们不必处理多个数据源，代码也更少。要了解更多关于组合布局的信息，请看这篇博文。在那里，你会找到关于这个话题你需要知道的一切。</p><p id="b2ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">组合布局的另一个好处是一些优秀的特性是现成的。如果你想聚焦在像网飞这样的项目上(聚焦总是在卷轴的第一个项目上)，这是相当容易的。您需要将部分的<code class="fe ms mt mu mv b">orthogonalScrollingBehavior</code>设置为<code class="fe ms mt mu mv b">groupPaging</code>——就这样。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="b21b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，为了解决安全区域的问题，我们已经在上一节讨论过了，你的<code class="fe ms mt mu mv b">UICollectionViewCompositionalLayoutConfiguration</code>的<code class="fe ms mt mu mv b">contentInsetsReference</code>的值必须是‘none’。'</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="960d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">远程控制和装载机</h1><p id="975e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我很少为应用程序定制加载器。从我开始做iOS开发者开始，我就用<a class="ae kv" href="https://github.com/jdg/MBProgressHUD" rel="noopener ugc nofollow" target="_blank"> MBProgressHud </a>。所以我决定把它用在当前的项目上。我不知道的是，当你展示加载器时，你阻止了对屏幕的触摸，而不是遥控器。现在，当我们显示加载程序时，我们也关闭了视图的用户交互。下面是实现这一点的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="5a55" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">截屏</h1><p id="9042" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你在一个真实的设备上构建你的应用程序，并且想要截屏，去你的Xcode，Window/Devices，和模拟器。在那里你可以选择截图。这个特性很方便，尤其是对你的QA团队来说。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/f1a41b26a094fea9240556b318d3a562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9M7XzCCtO1FbqFDiuqxKjw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Xcode截图</p></figure><h1 id="c3d1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">记住上次聚焦的索引路径</h1><p id="0b55" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><code class="fe ms mt mu mv b">UICollectionViews</code>和<code class="fe ms mt mu mv b">UITableViews</code>都有这个好用的功能。<code class="fe ms mt mu mv b">RemembersLastFocusedIndexPath</code>是一个布尔值，它指示集合视图是否自动将焦点分配给最后一个获得焦点的索引路径上的项目。换句话说，如果您在从控制器导航之前关注某个单元格，那么当您返回时，该单元格也会被关注。</p><p id="9f56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，这里有一个问题。如果您在向后导航时重新加载表格或集合，此功能将不起作用。我们无法关闭重新加载，因为该单元格包含需要更新的进度条。解决方案是只重新加载单元格。在视图模型中，我们将为重载准备一个条目和索引路径。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="233d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并且在视图控制器中，我们会绑定<code class="fe ms mt mu mv b">indexPathsToReload</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="769d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我也尝试过重新加载正确的部分。那没用。因此，如果您必须重新加载并记住最后聚焦的索引路径，您应该这样做。</p><h1 id="c938" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">斯威夫特伊</h1><p id="0b8b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">短篇，不用了。还没准备好。</p><p id="6893" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">说来话长，我们在这里看到了机会。tvOS应用程序相对简单，非常适合测试swiftUI。我们利用这项技术启动了tvOS项目。然而，它有如此多的问题。使用swiftUI与其说是编程，不如说是黑客。像UIFocus指南这样的一些基本功能仍然不存在。然而，这还不是最大的问题。创建大网格是。</p><p id="cba8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们看了苹果所有关于swiftUI的视频，几乎复制了他们的做法。我们已经使用lazyVStask和lazyHStack实现了网格。用户体验很糟糕。由于一个未知的原因，在网格中滚动时有很多延迟。同样的代码在iOS上运行良好。也许有一个解决问题的方法，但是日程安排迫使我们回到UIKit。</p><p id="6c3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我非常失望，因为我们不得不放弃swiftUI。这是学习新技术并在产品代码中使用它的绝佳机会。然而，稳定压倒了好奇。</p><h1 id="f96e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="e50e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你是一个优秀的iOS开发者，你就不会有tvOS应用的问题。我希望这些建议能帮助你从iOS过渡到tvOS。如果你理解了这些，你就可以开始开发更复杂的特性了。</p><h1 id="8d03" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">作者的奖金</h1><p id="5092" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这里有一篇关于如何学习<a class="ae kv" href="https://medium.com/flawless-app-stories/beautiful-code-principles-39420873eff8" rel="noopener">漂亮代码原则</a>的好文章。</p><p id="9195" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div></div>    
</body>
</html>