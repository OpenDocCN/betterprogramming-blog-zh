<html>
<head>
<title>Backend Data Validations and Why You Need Them</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">后端数据验证以及为什么需要它们</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/back-end-data-validations-73ea9004c6d7?source=collection_archive---------7-----------------------#2020-01-27">https://betterprogramming.pub/back-end-data-validations-73ea9004c6d7?source=collection_archive---------7-----------------------#2020-01-27</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="e8b1" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">你永远不知道有人会如何操纵你的前端代码</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/eeb6a1ff6e188f0c9135ee7c58ba1076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*si7s_OsNokzr7Z6H"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="1894" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">众所周知，全球市值最大的100家公司名单中有很多科技公司。尤其是软件公司。</p><p id="9ba7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">苹果、微软、亚马逊、Alphabet、脸书和阿里巴巴占据了前七名中的六个位置，毫无疑问地证明了软件统治世界。但是，如果说今天软件无处不在，那么软件缺陷也无处不在。</p><p id="9195" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我们将讨论可能导致灾难性后果的最常见的错误之一。我们将看到这样的错误是如何在您的代码中表现出来的，并学习一种简单的方法来避免它。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="a169" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">永远不要相信你的用户</h1><p id="c010" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">“永远不要相信你的用户”是那些陈词滥调之一，如果你已经写了几个月的软件，你可能会听到。换句话说:永远不要相信用户提交的任何信息。谁先说这话，谁就绝对正确！</p><p id="0fd7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当运行你开发的前端代码时，用户的浏览器会发生什么是你无法控制的。从本质上来说，浏览器是一个黑匣子，在用户与你的代码交互之后，<em class="na">可能会</em>给你发回一些数据。您如何能够<em class="na">无条件地确定</em>这些数据是作为您的可信代码的执行结果而生成的呢？你不能。</p><p id="7424" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们看一个例子。你会亲眼看到为什么信任用户数据是一个坏主意。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="9178" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">恶意数据提交</h1><p id="90a8" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">让我们想象一个允许用户将资金从一个账户转移到另一个账户的银行应用程序:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nb"><img src="../Images/b285625c06dee1f58be28f90bae38380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*CsASTLNZzwYlWBklnK7a3w.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">一个虚构的银行应用程序(图片由作者提供)</p></figure><p id="a3ca" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在上面的场景中，当用户点击<code class="fe nc nd ne nf b">Transfer</code>按钮时，您的前端数据验证代码开始生效。它会检查您的帐户中是否有足够的资金让您继续转账，如果没有，它会以错误消息通知您:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ng"><img src="../Images/163e67f861337c7e45415ec9ef48df7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i0ZOF2CYeSoTQXKtT07Wzg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">前端数据验证场景示例(图片由作者提供)</p></figure><p id="cc02" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您的项目中有一个类似的数据验证场景，但没有适当的后端检查作为支持，那么这里会出现很多问题。</p><h2 id="91d4" class="nh me iu bd mf ni nj dn mj nk nl dp mn lj nm nn mp ln no np mr lr nq nr mt ns bi translated">禁用JavaScript</h2><p id="fb5e" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">用户可以简单地在浏览器中禁用JavaScript:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nt"><img src="../Images/c78ebeb64c3fe7618b116b087168ec52.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*C800IF4ZMUrqC327KqYwmQ.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在Chrome中禁用JavaScript(图片来自作者)</p></figure><p id="3991" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这种情况下，验证逻辑不会运行。如果您的应用程序在禁用JavaScript的情况下仍能工作，转账请求将被提交，在一个只有100美元余额的帐户上执行150美元的转账。</p><h2 id="ea05" class="nh me iu bd mf ni nj dn mj nk nl dp mn lj nm nn mp ln no np mr lr nq nr mt ns bi translated">修改来源</h2><p id="8d45" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">页面的源代码和底层JavaScript代码可以很容易地被恶意用户利用来做任何事情:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nu"><img src="../Images/c417f8cda2e79850fc12d0f27d80f2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5t8xC8P0MBZEowHvu1WqNg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">操纵页面的源来显示任何东西——这不是Photoshopped处理的(图片由作者提供)</p></figure><p id="009c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">类似地，验证余额和要转移的金额的JavaScript代码可以被完全注释掉或更改，以允许各种错误的转移。</p><h2 id="3c93" class="nh me iu bd mf ni nj dn mj nk nl dp mn lj nm nn mp ln no np mr lr nq nr mt ns bi translated">请求捕获、修改和重放</h2><p id="9c12" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">最后，实际的数据提交请求可以被截取、捕获、更改和重放。在重放过程中，恶意用户可以更改请求的主体，只提交他们想要的任何数据。如果你对如何捕获和重放<code class="fe nc nd ne nf b">REST</code>请求感兴趣，你可以看看我以前的一篇文章:</p><div class="nv nw gq gs nx ny"><a href="https://medium.com/better-programming/the-4-levels-of-rest-debugging-e35269e9da18" rel="noopener follow" target="_blank"><div class="nz ab fp"><div class="oa ab ob cl cj oc"><h2 class="bd iv gz z fq od fs ft oe fv fx it bi translated">如何调试REST请求</h2><div class="of l"><h3 class="bd b gz z fq od fs ft oe fv fx dk translated">通过以四种不同的方式监视正在交换的数据来找到那个烦人的bug</h3></div><div class="og l"><p class="bd b dl z fq od fs ft oe fv fx dk translated">medium.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om kt ny"/></div></div></a></div><p id="6e24" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">那么，如何减轻这种威胁，或者——甚至更好——完全消除这种威胁呢？</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="784a" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">后端验证</h1><p id="3a48" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">不管前端技术和框架如何，您的后端最终都会收到数据请求。重要的是你如何对待请求的内容。</p><p id="ee5c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">快速回顾一下:永远不要相信用户提交的数据。</p><p id="7354" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">用户提交的每一点数据都必须在后端进行验证。丢弃通过查询底层数据源可以获得的任何信息，只保留正在处理的实际请求所固有的信息。以下是验证上述恶意请求的方法:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/23fad4f6ea0e429da24ca7b0bf776ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*itYyrDd9a3vTf-LzR2djsg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">后端验证流程(图片由作者提供)</p></figure><p id="f9e4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">后端验证代码不仅独立于前端检查用户是否有足够的资金，还验证用户的真实系统ID(使用与请求一起传递的安全令牌/报头)以及该用户的相应源帐户。只有当所有独立检查的条件都满足时，转让才最终被允许。</p><p id="3e9e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当然，真正的银行软件系统可能需要执行比上面显示的更复杂的数据验证。然而，像这样的基本验证检查应该始终是后端代码的一部分。</p><p id="8f5d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">实现后端验证检查保证了任何类型的恶意请求都有机会在您控制的环境中被重新检查。这是确保您，作为开发人员，对某件事情是否应该执行有最终决定权的唯一方法。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="303e" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="ea49" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">如果你是一名初级开发人员，正在阅读这篇文章，我希望你有机会学到一些东西，并且下次你实现数据提交功能时，你也会想到后端验证。如果你是一名中高级开发人员，你可能会轻轻叹口气点点头——这些错误你已经见过太多次了。希望您有机会在代码审查中发现它们，而不是prod！</p><p id="cbc8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">总之，永远不要相信你的用户，总是执行后端数据验证检查。</p><p id="058e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">感谢您阅读这篇文章。我希望下一次能见到你。</p></div></div>    
</body>
</html>