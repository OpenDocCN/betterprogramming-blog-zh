<html>
<head>
<title>Flutter Tips: Build Debug and Release Android With the Same Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤动提示:用相同的代码构建调试并发布Android</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/flutter-tips-build-debug-and-release-android-with-the-same-code-968b8056c46?source=collection_archive---------8-----------------------#2020-04-03">https://betterprogramming.pub/flutter-tips-build-debug-and-release-android-with-the-same-code-968b8056c46?source=collection_archive---------8-----------------------#2020-04-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5ad0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让你的Flutter项目对外部贡献者友好</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bfde476891fd9283b182d355ae7a92ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ta6-_J7hcMl0cDZcWzRHAg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@bdchu614?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布伦丹·丘奇</a>在<a class="ae ky" href="https://unsplash.com/s/photos/direction?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="c956" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Android市场通常需要代码签名</h1><p id="9730" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">包括谷歌Play商店在内的大多数移动应用市场在提交应用时都需要代码签名。</p><p id="2145" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">代码签名增加了额外的安全层(在你的开发者帐户密码之上),以防止黑客将恶意内容偷偷带入应用程序。</p><p id="11b3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">根据官方的Flutter文档，要给Android添加代码签名，我们需要给<code class="fe ms mt mu mv b">android/app/build.gradle</code>添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="4138" class="kz la it bd lb lc nf le lf lg ng li lj jz nh ka ll kc ni kd ln kf nj kg lp lq bi translated">代码签名后Android调试版本中断</h1><p id="8ffa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">看着上面的代码，有些人可能已经嗅到了危险:如果<code class="fe ms mt mu mv b">keystorePropertyFile</code>不存在，脚本就会中断。</p><p id="d12d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">不幸的是，这可能发生，因为<code class="fe ms mt mu mv b">key.properties</code>不应该在版本控制中。此外，代码签名凭据不应对外部参与者可见，因此如果不注释掉代码签名脚本，他们将无法在本地调试应用程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="1e78" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，这是不方便和危险的(有人可能会忘记恢复并将其推入版本控制)。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="1dc2" class="kz la it bd lb lc nf le lf lg ng li lj jz nh ka ll kc ni kd ln kf nj kg lp lq bi translated">解决方案:使用ENV来控制调试/发布</h1><p id="fb6e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当我们想在不修改代码的情况下在几个配置之间切换时，使用环境变量是更好的选择。</p><p id="690b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在我们的例子中，我们可以使用环境变量<code class="fe ms mt mu mv b">ANDROID_DEBUG</code>在调试和发布Android版本之间切换。</p><h2 id="4cc7" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">步骤1:从Gradle文件中检索环境变量</h2><p id="4952" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在<code class="fe ms mt mu mv b">android/app/build.gradle</code>中，我们可以用<code class="fe ms mt mu mv b">System.getenv('ANDROID_DEBUG')</code>检索<code class="fe ms mt mu mv b">ANDROID_DEBUG</code>环境变量。</p><h2 id="9c04" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">步骤2:有条件地绕过凭据文件</h2><p id="3806" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于构建脚本具有区分调试和发布的信息，当<code class="fe ms mt mu mv b">ANDROID_DEBUG</code>出现以下情况时，我们可以绕过代码签名凭证的检索:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h2 id="97c0" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">步骤3:有条件地在调试版本和发布版本之间切换</h2><p id="23fe" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">类似地，我们也可以使用环境变量在调试和发布签名配置之间切换:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="2efb" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">第四步:试一试！</h2><p id="b08a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">修改完成后，我们现在可以用<code class="fe ms mt mu mv b">ANDROID_DEBUG=true flutter run</code>在调试模式下启动Android Flutter应用，用<code class="fe ms mt mu mv b">flutter run</code>在发布模式下启动。</p><p id="7bc4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">由于调试和发布之间的切换只是一个命令行选项，我们可以轻松地与其他贡献者协作，而不会拿我们的证书冒险。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><p id="acf6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意:我从<a class="ae ky" href="https://medium.com/minidonkey101" rel="noopener"> Mini Donkey </a>那里借来了脚本，这是一个加密的隐写应用程序，用于保护社交媒体上的隐私。要查看它是如何工作的(或者在CI/CD中)，请查看<a class="ae ky" href="https://github.com/tianhaoz95/photochat" rel="noopener ugc nofollow" target="_blank">库</a>。</p></div></div>    
</body>
</html>