<html>
<head>
<title>Understanding the Intersection Observer API in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解JavaScript中的交叉点观察器API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/understanding-intersection-observer-api-in-javascript-bb1bf04b8081?source=collection_archive---------5-----------------------#2019-05-07">https://betterprogramming.pub/understanding-intersection-observer-api-in-javascript-bb1bf04b8081?source=collection_archive---------5-----------------------#2019-05-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9994" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">只用几行字，你就可以极大地改善UX</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9023c67729f8b92c4f473f6b8bfdcea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FCcwyns7IJvFnXj295vGZA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">奇迹发生在十字路口。<a class="ae kv" href="https://unsplash.com/@dnevozhai?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Denys Nevozhai </a>在<a class="ae kv" href="https://unsplash.com/search/photos/intersection?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="dfcc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在学习<a class="ae kv" href="https://www.gatsbyjs.org/" rel="noopener ugc nofollow" target="_blank"> Gatsby </a>如何预取链接以给出惊人快速导航的外观时，我遇到了<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" rel="noopener ugc nofollow" target="_blank">十字路口观察者API </a>。我推迟了几个月去调查这件事，但最后还是在上周末一头扎了进去。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="a710" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">什么是交叉点观察器API？</h1><p id="e30c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">简而言之，它使您能够检测元素的可见性，即它是否在当前视窗中，以及两个元素之间的相对可见性。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="88e8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">用例</h1><ul class=""><li id="a598" class="mw mx iq ky b kz mr lc ms lf my lj mz ln na lr nb nc nd ne bi translated">图像的延迟加载。</li><li id="0db2" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">无限卷轴。</li><li id="e309" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">当链接出现在屏幕上时预取链接(Gatsby就是这样做的)。</li><li id="a031" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">检测广告是否被浏览(更多跟踪)。</li><li id="f380" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">确定用户是否阅读了一篇文章以及阅读到什么程度(想想中等浏览和阅读统计)。</li><li id="c379" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">仅在屏幕上可见时运行昂贵的渲染和动画。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5cf0" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">技术方面的东西</h1><p id="e286" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">像往常一样，MDN 上的<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" rel="noopener ugc nofollow" target="_blank">文档很棒，但是我在弄清楚一些事情时遇到了一些麻烦，因此我在这里分享我的笔记。</a></p><p id="5033" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">交叉点观察器API的核心是下面两行:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="5432" class="np ma iq nl b gy nq nr l ns nt">var observer = new IntersectionObserver(callback, options);<br/>observer.observe(target);</span></pre><ol class=""><li id="d97d" class="mw mx iq ky b kz la lc ld lf nu lj nv ln nw lr nx nc nd ne bi translated">首先，用一些<code class="fe ny nz oa nl b">options</code>创建一个<code class="fe ny nz oa nl b">Observer</code>。</li><li id="e0f7" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nx nc nd ne bi translated">然后，你让<code class="fe ny nz oa nl b">Observer</code>启动<code class="fe ny nz oa nl b">observing</code>一个<code class="fe ny nz oa nl b">target</code>。</li><li id="0985" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nx nc nd ne bi translated">当期望的<code class="fe ny nz oa nl b">intersection</code>发生时，您的<code class="fe ny nz oa nl b">callback</code>函数被调用。</li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4759" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">选项</h1><p id="f061" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这是很难理解的部分。在浏览选项中的设置之前，您应该牢牢掌握以下内容:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="0365" class="np ma iq nl b gy nq nr l ns nt"><strong class="nl ir">Intersection Observer API</strong> lets you do something in the <strong class="nl ir">callback function</strong> when it <strong class="nl ir">observes </strong>an <strong class="nl ir">intersection </strong>(beyond a certain <strong class="nl ir">threshold</strong>) between the <strong class="nl ir">root</strong> element and the <strong class="nl ir">target</strong> element.</span></pre><ol class=""><li id="59a2" class="mw mx iq ky b kz la lc ld lf nu lj nv ln nw lr nx nc nd ne bi translated">把<code class="fe ny nz oa nl b">root</code>想象成外部的矩形，或者你想观察相交的矩形。</li><li id="c992" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nx nc nd ne bi translated"><code class="fe ny nz oa nl b">target</code>是你正在观察的元素。</li><li id="62f9" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nx nc nd ne bi translated"><code class="fe ny nz oa nl b">threshold</code>给出重叠发生的程度。</li><li id="c519" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nx nc nd ne bi translated"><code class="fe ny nz oa nl b">rootMargin</code>是在计算相交范围之前应用于根的余量。</li></ol></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="afa7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">经验法则</h1><ol class=""><li id="b89e" class="mw mx iq ky b kz mr lc ms lf my lj mz ln na lr nx nc nd ne bi translated">API是异步的，所以当交集发生时，使用<code class="fe ny nz oa nl b">callback</code>函数做一些事情。</li><li id="b821" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nx nc nd ne bi translated">使用CSS选择器可以决定<code class="fe ny nz oa nl b">root</code>元素。</li><li id="8826" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nx nc nd ne bi translated">如果指定<code class="fe ny nz oa nl b">root: document.querySelector(‘null’)</code>，用户的当前视口将是<code class="fe ny nz oa nl b">root</code>元素。</li><li id="a9af" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nx nc nd ne bi translated">摆弄<code class="fe ny nz oa nl b">threshold</code>和<code class="fe ny nz oa nl b">rootMargin</code>以获得您期望的确切行为。</li></ol><p id="b4c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这几乎是交叉点观察器API的核心概念。更多阅读请参见<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" rel="noopener ugc nofollow" target="_blank"> MDN的文档</a>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="af6b" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">学习输出</h1><p id="89e7" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在学习这个API的时候，我想看看我是否能创造一些有用的东西。所以，我只写了几行，创建了一个Chrome扩展。该扩展用屏幕上可见的最新部分的ID来更新URL。</p><p id="d4dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，当您与朋友分享更新后的网址时，他们可以直接转到您正在阅读的部分。不到一个小时就写了几行，很酷吧？</p><div class="ob oc gp gr od oe"><a href="https://chrome.google.com/webstore/detail/microcontext/jichdnfbbcfidobafaolhcefednocbgn" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">微上下文</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">共享特定内容部分的链接</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">chrome.google.com</p></div></div><div class="on l"><div class="oo l op oq or on os kp oe"/></div></div></a></div></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="3923" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">完整代码</h1><p id="2904" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这个扩展的代码不到30行。</p><p id="1b88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想使用它，就叉上<a class="ae kv" href="https://github.com/learning-paths-io/microcontext#js-flash-container" rel="noopener ugc nofollow" target="_blank"> GitHub代码</a>或者给我发一个pull请求。</p></div></div>    
</body>
</html>