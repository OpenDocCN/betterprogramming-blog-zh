<html>
<head>
<title>How to Version Your Docker Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对Docker图像进行版本控制</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-version-your-docker-images-1d5c577ebf54?source=collection_archive---------3-----------------------#2016-10-03">https://betterprogramming.pub/how-to-version-your-docker-images-1d5c577ebf54?source=collection_archive---------3-----------------------#2016-10-03</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="d37e" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">有一千种方法来版本化Docker图像——这里有一个简单的方法</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/5fe4b99231c4caf6260257d0ef6ed9ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRcI2Y7WBKbSTsEuqVLPyg.jpeg"/></div></div></figure><p id="7dfd" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">虽然可能有一千种方法来版本化你的Docker图像，但是我将向你展示一个非常简单的方法，使用已经变得相当普遍的方法。它将确保您的映像版本与您的Git版本标签相匹配，因此您可以确切地知道哪个代码在映像中。</p><p id="9b39" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><em class="lr">更新:我最近写的一篇关于版本控制的文章是</em> <a class="ae ls" href="https://medium.com/better-programming/how-to-version-your-code-in-2020-60bdd221278b" rel="noopener"> <em class="lr">，这里有</em> </a> <em class="lr">。</em></p><p id="8f6d" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">本教程假设您已经有了一个构建映像的docker文件。</p><h2 id="4f8d" class="lt lu iu bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">版本文件</h2><p id="e9ee" class="pw-post-body-paragraph kv kw iu kx b ky mm jv la lb mn jy ld le mo lg lh li mp lk ll lm mq lo lp lq in bi translated">首先，创建一个<em class="lr">版本</em>文件，其中除了版本号之外什么也没有:</p><pre class="kk kl km kn gu mr ms mt mu aw mv bi"><span id="a603" class="lt lu iu ms b gz mw mx l my mz">0.0.1</span></pre><p id="9b2c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">为了完整起见，您希望将这个版本文件存储在映像中(因为您的程序可以使用它来显示版本)，所以将以下内容添加到docker文件中:</p><pre class="kk kl km kn gu mr ms mt mu aw mv bi"><span id="be1c" class="lt lu iu ms b gz mw mx l my mz">ADD VERSION .</span></pre><p id="9c78" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这将把版本文件添加到您的工作目录中。</p><h2 id="95f9" class="lt lu iu bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">构建脚本</h2><p id="8f84" class="pw-post-body-paragraph kv kw iu kx b ky mm jv la lb mn jy ld le mo lg lh li mp lk ll lm mq lo lp lq in bi translated">如果您还没有构建脚本，创建一个并将其命名为<em class="lr"> build.sh. </em>最简单的形式就是运行您的docker构建:</p><pre class="kk kl km kn gu mr ms mt mu aw mv bi"><span id="ce97" class="lt lu iu ms b gz mw mx l my mz">set -ex</span><span id="155d" class="lt lu iu ms b gz na mx l my mz"># SET THE FOLLOWING VARIABLES<br/># docker hub username<br/>USERNAME=treeder<br/># image name<br/>IMAGE=helloworld</span><span id="0b7b" class="lt lu iu ms b gz na mx l my mz">docker build -t $USERNAME/$IMAGE:latest .</span></pre><p id="0461" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您可能需要一些额外的构建步骤，所以继续添加它们。或者您可能有自己的构建脚本，在这种情况下，您可以忽略该脚本，只需更改下面脚本中的行来运行您的构建。确保<em class="lr"> chmod a+x ./build.sh </em>以便运行它。</p><h2 id="42ad" class="lt lu iu bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk ml bi translated">发布脚本</h2><p id="1934" class="pw-post-body-paragraph kv kw iu kx b ky mm jv la lb mn jy ld le mo lg lh li mp lk ll lm mq lo lp lq in bi translated">现在，让我们创建一个名为<em class="lr"> release.sh </em>的简单发布脚本，它将撞击版本，运行构建脚本，设置git标签，将标签推送到GitHub，构建映像，最后将映像推送到Docker Hub。您可以复制并粘贴下面的脚本，只需确保更改顶部的值以匹配您的Docker Hub信息:</p><pre class="kk kl km kn gu mr ms mt mu aw mv bi"><span id="65cc" class="lt lu iu ms b gz mw mx l my mz">set -ex</span><span id="5bd9" class="lt lu iu ms b gz na mx l my mz"># SET THE FOLLOWING VARIABLES<br/># docker hub username<br/>USERNAME=treeder<br/># image name<br/>IMAGE=helloworld</span><span id="482c" class="lt lu iu ms b gz na mx l my mz"># ensure we're up to date<br/>git pull</span><span id="1d59" class="lt lu iu ms b gz na mx l my mz"># bump version<br/>docker run --rm -v "$PWD":/app treeder/bump patch<br/>version=`cat VERSION`<br/>echo "version: $version"</span><span id="1fd1" class="lt lu iu ms b gz na mx l my mz"># run build<br/>./build.sh</span><span id="64fd" class="lt lu iu ms b gz na mx l my mz"># tag it<br/>git add -A<br/>git commit -m "version $version"<br/>git tag -a "$version" -m "version $version"<br/>git push<br/>git push --tags</span><span id="339e" class="lt lu iu ms b gz na mx l my mz">docker tag $USERNAME/$IMAGE:latest $USERNAME/$IMAGE:$version</span><span id="330a" class="lt lu iu ms b gz na mx l my mz"># push it<br/>docker push $USERNAME/$IMAGE:latest<br/>docker push $USERNAME/$IMAGE:$version</span></pre><p id="9fe2" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">用<em class="lr"> chmod a+x ./release.sh </em>使其可执行，然后用<em class="lr">运行。/release.sh </em>。</p><p id="a5a7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这就是了。每次发布时，只需运行<em class="lr">。/release.sh </em>你将拥有与你的源代码相匹配的版本化图像！</p></div></div>    
</body>
</html>