<html>
<head>
<title>Hacking CocoaPods With cocoapods-catalyst-support</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用cocoapods-catalyst-support攻击CocoaPods</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/hacking-cocoapods-with-cocoapods-catalyst-support-eb2d7097e08b?source=collection_archive---------9-----------------------#2021-03-17">https://betterprogramming.pub/hacking-cocoapods-with-cocoapods-catalyst-support-eb2d7097e08b?source=collection_archive---------9-----------------------#2021-03-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ae9d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">快速配置您的pod，使其仅在Mac Catalyst或iOS上运行，并且仍然使用一个主要目标</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e5b5523a8b10e17faafdb20ab77b5a2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I2ZN933ZpeItswZVngaw8w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片来自<a class="ae ky" href="https://www.csoonline.com/article/3040408/hacking-back-will-only-get-you-in-more-trouble.html" rel="noopener ugc nofollow" target="_blank"> CSO </a>。</p></figure><p id="4331" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.apple.com/documentation/uikit/mac_catalyst" rel="noopener ugc nofollow" target="_blank"> Mac Catalyst </a>在WWDC19上发布，这是一场激动人心的盛会，苹果也在会上展示了SwiftUI和Combine的早期版本。一个事件的大量公告。</p><p id="faaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Mac Catalyst的发布为iOS开发者提供了一种轻松进入macOS世界并将我们的应用移植到Mac设备家族的方式。这看起来很容易，也很简单。然而，没有人说大量的核心Cocoa框架不支持这种架构。因此，许多知名且广泛使用的第三方库也没有依赖于它们(如<code class="fe lv lw lx ly b">Firebase/Analytics</code>)。</p><p id="83f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然有几种方法可以解决这一问题，但大多数方法都依赖于创建新的目标或使用Swift Package Manager。这种方法有一些缺点:</p><ul class=""><li id="c175" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">新目标:目标很难维护，你需要处理新的签名问题，新的测试模式，你很可能会复制构建设置<em class="mi"> </em>和项目配置，等等。重复从来都不是一个好兆头，而且会在未来困扰你。</li><li id="75b0" class="lz ma it lb b lc mj lf mk li ml lm mm lq mn lu me mf mg mh bi translated">迁移到Swift包管理器:<strong class="lb iu"> </strong> SPM允许您选择依赖项可用于哪个SDK。然而，迁移是有风险的，并且伴随着许多未知因素。这个依赖关系管理器还很年轻，缺少其他依赖关系管理器(如<a class="ae ky" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>)提供的大量功能，原因很简单，它们已经运行了很多年。另外，您可能使用的一些依赖项很可能不支持SPM。</li></ul><p id="6d7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那你能做什么？我在这里提出另一个解决方案，可能会非常方便，易于使用，并会顺利地让你摆脱困境。你仍然可以使用CocoaPods <em class="mi">，</em>避免考虑痛苦的迁移，并使用你的应用的目标来支持这两个SDK。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="4613" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">椰子-催化剂-载体</h1><p id="330b" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><code class="fe lv lw lx ly b">cocoapods-catalyst-support</code>是我不久前创建的开源CocoaPods插件:</p><div class="ns nt gp gr nu nv"><a href="https://github.com/fermoya/cocoapods-catalyst-support/" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">fermoya/椰子-催化剂-载体</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">gem安装cocoapods-catalyst-support注意:如果您使用fastlane的cocoapods操作，请确保包含gem…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj ks nv"/></div></div></a></div><p id="82f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个红宝石<em class="mi"> </em>宝石附带了一些<code class="fe lv lw lx ly b">cocoapods</code>宝石的扩展。通过一个类似于您已经在Podfile中使用的简单语法，您将能够将某些依赖项或pods定义为“仅catalyst”或“仅iOS”，以便它们仅可用于该SDK。你可以快速轻松地一劳永逸地解决这个问题。</p><h2 id="8e7f" class="ok mw it bd mx ol om dn nb on oo dp nf li op oq nh lm or os nj lq ot ou nl ov bi translated">初始化</h2><p id="5faf" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">开始使用<code class="fe lv lw lx ly b">cocoapods-catalyst-support</code>极其简单。作为公共gem，您可以从您的终端将其安装到您的机器中:</p><pre class="kj kk kl km gt ow ly ox oy aw oz bi"><span id="32e3" class="ok mw it ly b gy pa pb l pc pd">gem install cocoapods-catalyst-support</span></pre><p id="4356" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦安装完毕，你只需要在你的项目文件夹中运行<code class="fe lv lw lx ly b">pod catalyst init</code>来初始化你的Catalyst配置。该命令会自动将下列行添加到您的Podfile <em class="mi">中:</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="d2f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是什么意思？</p><ol class=""><li id="8877" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu pg mf mg mh bi translated">“导入”宝石以在您的Podfile中使用它。</li><li id="b49e" class="lz ma it lb b lc mj lf mk li ml lm mm lq mn lu pg mf mg mh bi translated">限制您的pod只能在一个SDK中使用。例如，<code class="fe lv lw lx ly b">macos 'AppCenter/Analytics'</code>将使<code class="fe lv lw lx ly b">AppCenter/Analytics</code>只适用于你的Mac Catalyst应用。如果你正在寻找相反的东西，用<code class="fe lv lw lx ly b">ios</code>代替<code class="fe lv lw lx ly b">macos</code>(例如，一个只适用于iOS的pod)。请注意，不在此块内的任何pod都将被视为多平台(iOS和Mac Catalyst)。</li><li id="547f" class="lz ma it lb b lc mj lf mk li ml lm mm lq mn lu pg mf mg mh bi translated">配置您的应用程序依赖项。</li></ol><h2 id="8129" class="ok mw it bd mx ol om dn nb on oo dp nf li op oq nh lm or os nj lq ot ou nl ov bi translated">使用</h2><p id="b4b9" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">一旦您的依赖项按照您的意愿进行了配置，您就可以通过快速运行<code class="fe lv lw lx ly b">pod catalyst validate</code>来检查您的配置。这将让您知道您的配置中是否有任何意外。</p><p id="9709" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个命令将捕获的一个常见错误是安装一个与您正在配置的依赖项不同的依赖项。例如，安装<code class="fe lv lw lx ly b">pod 'Firebase/Analytics'</code>然后配置<code class="fe lv lw lx ly b">iOS 'FirebaseAnalytics</code>。注意丢失的<code class="fe lv lw lx ly b">/</code>。这可能看起来无关紧要，但是它显著地改变了CocoaPods如何配置您的pod的项目设置。</p><p id="9347" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果验证成功，您只需运行<code class="fe lv lw lx ly b">pod catalyst run</code>或简单的<code class="fe lv lw lx ly b">pod catalyst</code>。这是一个键盘命令，它将在您的设置中执行魔法，并按照您的意愿配置您的项目。</p><h2 id="1af4" class="ok mw it bd mx ol om dn nb on oo dp nf li op oq nh lm or os nj lq ot ou nl ov bi translated">之后会发生什么？</h2><p id="c36d" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">到目前为止，您的依赖项已经过配置，它们是:</p><ul class=""><li id="d395" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">仅为选定的SDK (Mac Catalyst或iOS)内置编译时。</li><li id="f7ed" class="lz ma it lb b lc mj lf mk li ml lm mm lq mn lu me mf mg mh bi translated">仅针对选定的SDK (Mac Catalyst或iOS)在运行时链接。</li><li id="2b15" class="lz ma it lb b lc mj lf mk li ml lm mm lq mn lu me mf mg mh bi translated">从你的最终档案中剥离，连同他们的资源。这适用于未选择的SDK。</li></ul><p id="fc50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你只需要分叉你的代码来为Mac Catalyst和iOS使用不同的解决方案。例如，在处理分析时，您可能会对iOS使用<code class="fe lv lw lx ly b">Firebase/Analytics</code>，对Mac Catalyst使用<code class="fe lv lw lx ly b">AppCenter/Analytics</code>。在这种情况下，您需要执行类似于以下代码片段的操作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="eb18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我可以给你的一个建议是将这个功能提取到一个组件中，并定义两个不同的实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="1f87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在下面找到更多信息:</p><div class="ns nt gp gr nu nv"><a rel="noopener  ugc nofollow" target="_blank" href="/why-dont-my-pods-compile-with-mac-catalyst-and-how-can-i-solve-it-ffc3fbec824e"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">为什么我的Pods不能用Mac Catalyst编译，如何解决？</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">如何在您的iOS中使用Mac Catalyst解决“for architecture x86 _ 64c lang:error:linker command failed with exit”</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">better编程. pub</p></div></div><div class="oe l"><div class="ph l og oh oi oe oj ks nv"/></div></div></a></div></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="8b64" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">最后的想法</h1><p id="0b15" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated"><code class="fe lv lw lx ly b">cocoapods-catalyst-support</code>是一种变通方法，在您的项目中继续使用CocoaPods，同时能够在您的主要目标中支持Mac Catalyst。它易于安装和配置。一旦设置好，<code class="fe lv lw lx ly b">cocoapods-catalyst-support</code>将在您每次运行<code class="fe lv lw lx ly b">pod install</code>或<code class="fe lv lw lx ly b">pod update</code>时自动调用。</p><p id="9a31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，这是一种变通办法。Swift Package Manager是未来，没有人会告诉你不是这样。尽管如此，在有些情况下，您不会对SPM现在所提供的感到满意。您不希望冒迁移的风险，因为未知或某些依赖项不支持此依赖项管理器。在这些场景中，CocoaPods很可能是您的首选，在这种情况下，如果您决定支持Mac Catalyst，这个插件可能会派上用场。</p></div></div>    
</body>
</html>