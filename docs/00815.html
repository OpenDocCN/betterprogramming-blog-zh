<html>
<head>
<title>How To Make Search Fields Dynamic in the Django REST Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Django REST框架中使搜索字段动态化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-search-fields-dynamic-in-django-rest-framework-72922bfa1543?source=collection_archive---------0-----------------------#2019-07-17">https://betterprogramming.pub/how-to-make-search-fields-dynamic-in-django-rest-framework-72922bfa1543?source=collection_archive---------0-----------------------#2019-07-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d744" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用查询参数设置搜索字段</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/cc9ebe8a7fb564d6ef23c6a2db32a32b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*N5Iep1wJY1iXgMzpHxzE8w.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">DRF的动态搜索字段</p></figure><p id="ffb7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">T21 Django REST框架提供了现成的搜索功能。</p><p id="1ada" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">搜索可以通过以下三个步骤完成:</p><ul class=""><li id="dc16" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">在类中设置<code class="fe ma mb mc md b">search_fields</code></li><li id="d90d" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated">在类中设置<code class="fe ma mb mc md b">filter_backends</code></li><li id="f1b7" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated">发送<code class="fe ma mb mc md b">search</code>请求中的查询参数</li></ul><p id="5fb1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ma mb mc md b">search</code>指定需要匹配的图案。<code class="fe ma mb mc md b">search_fields</code>指定模式需要匹配的数据库列。</p><p id="8a35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">DRF默认行为与静态<code class="fe ma mb mc md b">search_fields</code>一起工作。</p><p id="43f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这篇文章中，我们将讨论静态<code class="fe ma mb mc md b">search_fields</code>的局限性以及如何使<code class="fe ma mb mc md b">search_fields</code>动态化。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="41b2" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">有用</h1><p id="af64" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">后端的动态搜索能力将允许用户执行更精细的搜索。</p><p id="53cd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在您的前端列出模型的所有字段/列，并允许用户选择模式应该匹配的字段的场景中，这将非常方便。</p><p id="8f3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用户还可以选择匹配的类型。用户可以选择<code class="fe ma mb mc md b">LIKE</code>匹配、<code class="fe ma mb mc md b">exact</code>匹配或<code class="fe ma mb mc md b">starts with</code>匹配。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="fb10" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">设置</h1><p id="491d" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">在本文中，我们将使用以下模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="208f" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">静态搜索</h1><p id="02fc" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">让我们首先在静态字段上应用搜索，然后我们将使搜索字段动态化。</p><p id="0f65" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们添加视图、序列化程序和URL模式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="6ef9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了这个，我们应该可以得到所有的问题。搜索功能还没有添加。</p><p id="af5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">尝试发送一个模式，比如说<code class="fe ma mb mc md b">Samsung</code>，作为搜索查询参数。<code class="fe ma mb mc md b">search</code>查询参数对返回的响应没有任何影响。没有模式<code class="fe ma mb mc md b">Samsung</code>的问题也会在响应中返回。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi np"><img src="../Images/1e1ffcb35226bccf9ff33a866ec01726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jkhPMwZgQ8WVs4fK5klLYg.png"/></div></div></figure><p id="f2a6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们为视图添加搜索功能。</p><p id="5be6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当我们在<code class="fe ma mb mc md b">GET</code>查询参数中发送一个模式时，我们希望该术语与<code class="fe ma mb mc md b">question_text</code>列匹配。我们需要添加<code class="fe ma mb mc md b">search_fields</code>和<code class="fe ma mb mc md b">filter_backends</code>来实现这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="27f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们再提一次要求。我们只会得到在<code class="fe ma mb mc md b">question_text</code>中有<code class="fe ma mb mc md b">Samsung</code>的问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi nu"><img src="../Images/d368ced8e7e992bd920cc2870aebdfad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXZPpaK_iJnSpXizrBoQQg.png"/></div></div></figure><p id="3770" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本问题由<code class="fe ma mb mc md b">charles</code>执笔。</p><p id="e7cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们在一个<code class="fe ma mb mc md b">GET</code>请求中将<code class="fe ma mb mc md b">charles</code>作为一个搜索模式发送，看看我们是否得到相同的响应。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi nv"><img src="../Images/163c5cd0a6005dca3fa62709d0246996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZybsTsaPqmI9TabdAoUZA.png"/></div></div></figure><p id="9f3f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们没有得到预期的问题响应，因为我们还没有配置我们的视图来匹配<code class="fe ma mb mc md b">author</code>列的模式。</p><p id="8099" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以通过在<code class="fe ma mb mc md b">search_fields</code>中添加<code class="fe ma mb mc md b">author</code>来实现这一点。</p><pre class="kj kk kl km gt nw md nx ny aw nz bi"><span id="9fde" class="oa mr it md b gy ob oc l od oe">search_fields = ['question_text', 'author']</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="112d" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">这种方法的问题</h1><p id="f7c1" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">我们在<code class="fe ma mb mc md b">search_fields</code>中增加了<code class="fe ma mb mc md b">question_text</code>和<code class="fe ma mb mc md b">author</code>。</p><p id="80eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们想搜索由<code class="fe ma mb mc md b">charles</code>撰写的问题。假设有一个由<code class="fe ma mb mc md b">tolkien</code>创作的问题，其文本为:“<code class="fe ma mb mc md b">Do you love charles novels?</code>”</p><p id="8c64" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这种情况下，当我们搜索模式<code class="fe ma mb mc md b">charles</code>时，即使这个问题不是由<code class="fe ma mb mc md b">charles</code>编写的，也会出现。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi of"><img src="../Images/f2f1f271e61adb2a08138ba9a3787c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MK8jKzhzO34lMbMINtAFUA.png"/></div></div></figure><p id="583b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">提出这个问题是因为术语<code class="fe ma mb mc md b">charles</code>出现在<code class="fe ma mb mc md b">question_text</code>中。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="aacc" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">更好的方法</h1><p id="5e81" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">更好的方法是允许最终用户指定他们希望模式匹配的字段。我们本质上想让场充满活力。</p><p id="9e9c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要创建一个自定义的过滤器后端来实现这一点。这个后端将从DRF <code class="fe ma mb mc md b">SearchFilter</code>扩展，并将覆盖方法<code class="fe ma mb mc md b">get_search_fields()</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="1614" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们将这个过滤器后端设置为视图的<code class="fe ma mb mc md b">filter_backends</code>，并从视图中移除静态的<code class="fe ma mb mc md b">search_fields</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="2bd3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在可以使用模式<code class="fe ma mb mc md b">charles</code>和<code class="fe ma mb mc md b">search_fields</code>作为<code class="fe ma mb mc md b">author</code>来发出请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi og"><img src="../Images/00329d99529bbc9a36e41c0c2ea2af8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e95YvHU5mPOHyQ3o7-0yZw.png"/></div></div></figure><p id="85d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们用的是姜戈的<code class="fe ma mb mc md b">getlist()</code>。这使我们能够指定多个字段作为<code class="fe ma mb mc md b">search_fields</code>查询参数。</p><p id="7164" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们希望<code class="fe ma mb mc md b">charles</code>在<code class="fe ma mb mc md b">author</code>和<code class="fe ma mb mc md b">question_text</code>列中都被查找到。让我们在<code class="fe ma mb mc md b">search_fields</code>查询参数中发送<code class="fe ma mb mc md b">question_text</code>和<code class="fe ma mb mc md b">author</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi oh"><img src="../Images/308cfb896d9e506017608cea4e00a205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4VoDb8L3KX_Q8tGpDahiNw.png"/></div></div></figure><h1 id="99cc" class="mq mr it bd ms mt oi mv mw mx oj mz na jz ok ka nc kc ol kd ne kf om kg ng nh bi translated">我的其他帖子</h1><p id="0ecd" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">以下是一些你可能会发现非常有用的帖子:</p><p id="74ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">DRF</p><ul class=""><li id="fb2d" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">在DRF搜索:<a class="ae lq" href="https://medium.com/swlh/searching-in-django-rest-framework-45aad62e7782" rel="noopener">https://medium . com/swlh/searching-in-django-rest-framework-45 aad 62e 7782</a></li><li id="1cc1" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated">从DRF序列化程序中获得更多:<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-drf-serializers-effectively-dc58edc73998">https://better programming . pub/how-to-use-drf-serializer-effectively-DC 58 EDC 73998</a></li><li id="1c9b" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated">在写操作过程中有效使用DRF序列化器:<a class="ae lq" href="https://medium.com/@raaj.akshar/how-to-effectively-use-django-rest-framework-serializers-during-write-operations-dd73b62c26b5" rel="noopener">https://medium . com/@ raaj . AK shar/how-to-effectively-use-django-rest-framework-serializer-during-write-operations-DD 73 b 62 c 26 b 5</a></li></ul><p id="b4cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">姜戈</p><ul class=""><li id="39d0" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">django annotations and aggregations cookbook:<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/django-annotations-and-aggregations-48685994d149">https://better programming . pub/django-annotations-and-aggregations-48685994 d149</a></li><li id="d7f9" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated">在Django应用程序中引入Pytest:<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/testing-a-django-application-with-pytest-3615df7e81f8">https://better programming . pub/testing-a-Django-application-with-Pytest-3615 df 7 e 81 f 8</a></li></ul><p id="edc2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">熊猫</p><ul class=""><li id="fa9b" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">建立对熊猫系列的坚实了解:<a class="ae lq" href="https://towardsdatascience.com/gaining-a-solid-understanding-of-pandas-series-893fb8f785aa" rel="noopener" target="_blank">https://towards data science . com/gaing-a-solid-understanding-of-Pandas-series-893 fb8f 785 aa</a></li></ul><p id="2451" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">数据库</p><ul class=""><li id="bc88" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">关于数据库死锁的推理:<a class="ae lq" href="https://levelup.gitconnected.com/understanding-why-a-database-deadlock-occurs-8bbd32be8026" rel="noopener ugc nofollow" target="_blank">https://level up . git connected . com/understanding-why-a-database-deadlock-occurs-8 bbd 32 be 8026</a></li><li id="a8e3" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated">关系数据库的ACID保证实例:<a class="ae lq" href="https://levelup.gitconnected.com/understanding-acid-guarantees-through-practical-example-3fe806628580" rel="noopener ugc nofollow" target="_blank">https://level up . git connected . com/understanding-ACID-guarantees-through-practical-example-3fe 806628580</a></li><li id="c177" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated">MySQL数据库的存储容量规划:<a class="ae lq" href="https://medium.com/@raaj.akshar/mysql-disk-usage-analysis-cbf7597b2836" rel="noopener">https://medium . com/@ raaj . AK shar/MySQL-disk-usage-analysis-CBF 7597 b 2836</a></li></ul><p id="e2cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！</p></div></div>    
</body>
</html>