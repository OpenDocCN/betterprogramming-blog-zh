<html>
<head>
<title>Purpose-Driven Microservice Design</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">目的驱动的微服务设计</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/purpose-driven-microservice-design-c25fa2a3ad0e?source=collection_archive---------3-----------------------#2022-06-30">https://betterprogramming.pub/purpose-driven-microservice-design-c25fa2a3ad0e?source=collection_archive---------3-----------------------#2022-06-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b6cf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建目的驱动的微服务应该永远是一个目标。了解渲染蓝图如何提供可重复的策略。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d7d5ec576a94510f86382a1af20b15f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7R2NOCBdvFvhi-8m5KQF0w.jpeg"/></div></div></figure><p id="362b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我开始我的职业生涯时，流行语并不是我所期望的。在那些日子里，大多数技术新闻都是通过纸质的周刊，如《信息周刊》和《网络世界》来发布的。我记得我对自己说，“伙计，他们每个星期都在一遍又一遍地使用这些相同的词。”</p><p id="38bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">也就是说，人们一直在使用流行语。那时候，我最喜欢的两个词是把互联网称为“万维网”和“信息高速公路”。我总是想知道在某个时候是否会有一条超级高速公路。</p><p id="53f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，最近，我注意到流行语被用作占位符，在它们不太有意义的地方。微服务、事件驱动架构、人工智能和ML等术语在上下文中使用，这让我得出结论，许多人不太理解这些术语。我也没想到会这样…</p><p id="c967" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">想象一下与一个被误解的问题相关的简单对话:</p><p id="0a6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你的航班什么时候起飞？</p><p id="41af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">人物2 </strong>:今年晚些时候。</p><p id="c083" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">虽然2号人物提供了一个正确的答案，但是这个回答并没有真正给1号人物的询问带来任何价值。</p><p id="79db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">同样，迁移到微服务的探索也经历了类似的挑战。我经常与客户和公司合作，他们的“微服务”设计产生了单一服务。基本上，一个单一的应用程序被一个真正大的RESTful API所取代。</p><p id="0161" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于本出版物，我认为通过正确的方式创建一个目的驱动的微服务设计的例子会很有趣。</p><h1 id="5dd8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">目的驱动的微服务设计</h1><p id="4e5f" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">目的驱动的微服务是一种可以独立存在的服务，它可以在需要时包含一个专用的持久性存储。通过目的驱动，微服务将提供一组集中的信息，并成为相关API中管理的数据的记录系统。</p><p id="2fbb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过采用目的驱动的微服务方法，用户可以添加额外的节点并缩减现有节点，以满足该时间点的API需求。</p><p id="e497" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，专注于所得税某个方面的目的驱动的微服务可能在上半年使用量最高，而在下半年需要运行的实例较少。</p><p id="c3bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们通过一个非常简单的例子来关注目的驱动的微服务设计的创建。</p><h1 id="c959" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">创建基于Docker的微服务</h1><p id="07dd" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated"><a class="ae mk" href="https://www.thebump.com/chinese-gender-chart" rel="noopener ugc nofollow" target="_blank">中国性别预测器</a>是一个网格系统，用于预测出生婴儿的性别。这是通过提供受孕月份和母亲在受孕时的当前年龄来完成的。</p><p id="1c3e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有传言说，清朝皇室依靠同样的网格来选择儿子的性别，他们更喜欢为家庭提供工作和金钱，以及延续家族血统。</p><p id="cf48" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是中国性别预测网格的图示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mm"><img src="../Images/7a1b7fe7d9c2c43969b4f4ec1591723d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*boU8hXND22rqE3eBaOwXag.png"/></div></div></figure><p id="cea1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">举个例子，一个18岁的母亲在一月份怀孕，将会生下一个女婴。</p><p id="65a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于本出版物，我们将创建一个目的驱动的微服务，该服务基于相同的标准返回性别预测。上面示例的最终有效负载如下所示:</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="73ee" class="ms lo iq mo b gy mt mu l mv mw">{<br/>    "month": 1,<br/>    "age": 18,<br/>    "gender": "female",<br/>    "errorMessage": <strong class="mo ir">null</strong><br/>}</span></pre><p id="72e7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">微服务将利用Java和Spring Boot，并采用多级Docker文件来编译服务，并构建一个可以托管出生预测API的Docker映像。</p><p id="3693" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该服务的代码可在GitLab上找到，地址如下:</p><p id="82dd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">https://gitlab.com/johnjvester/birth-predictor<a class="ae mk" href="https://gitlab.com/johnjvester/birth-predictor" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="55f4" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">使用渲染蓝图创建可再现的图案</h1><p id="b1eb" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我在以下出版物中写过关于<a class="ae mk" href="https://render.com/" rel="noopener ugc nofollow" target="_blank">渲染</a>平台的文章:</p><ul class=""><li id="fc89" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated"><a class="ae mk" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-a-web-service-using-render-and-go-75d211421a00">第一次使用Render and Go</a></li><li id="ef53" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae mk" rel="noopener ugc nofollow" target="_blank" href="/render-unified-cloud-under-the-hood-940d097cede8">引擎盖下:渲染统一云</a></li></ul><p id="7bf1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于我在Render上运行的个人实例，我使用了Go编程语言、静态站点和Postgres实例。这一次，我用Java/Spring Boot编写了服务。虽然对Java的原生支持尚不存在，但Render平台确实支持在Docker容器中运行的任何东西。</p><p id="fcd1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于出生预测服务包括一个多阶段Docker文件，我想看看在渲染平台上部署一个基于Docker的服务有多容易。然而，我注意到了<a class="ae mk" href="https://render.com/docs/infrastructure-as-code" rel="noopener ugc nofollow" target="_blank">蓝图规范</a>，也想看看它是如何工作的。</p><h2 id="6963" class="ms lo iq bd lp nl nm dn lt nn no dp lx la np nq lz le nr ns mb li nt nu md nv bi translated">什么是蓝图？</h2><p id="a0e7" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">蓝图是Render的基础设施即代码(IaC)实现。IaC也是我归类到一个更大的概念中的东西，叫做“*作为代码”。需要管理多个服务的部署或服务需要大量选项的组织可以将其渲染基础架构(服务、数据库和环境组)定义为render.yaml文件中的代码。</p><h2 id="ed36" class="ms lo iq bd lp nl nm dn lt nn no dp lx la np nq lz le nr ns mb li nt nu md nv bi translated">使用渲染蓝图</h2><p id="b4e1" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">基于此处<a class="ae mk" href="https://render.com/docs/blueprint-spec#sample-blueprint-spec" rel="noopener ugc nofollow" target="_blank">提供的蓝图示例</a>，我能够通过Docker容器快速创建我的Spring Boot服务的蓝图:</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="5eb0" class="ms lo iq mo b gy mt mu l mv mw">services:<br/>  - type: web<br/>    name: restful-api-spring-boot<br/>    env: docker<br/>    region: ohio # optional (defaults to oregon)<br/>    plan: free # optional (defaults to starter)<br/>    branch: master # optional (uses repo default)<br/>    numInstances: 1 # optional (defaults to 1)<br/>    healthCheckPath: /actuator/health<br/>    envVars:<br/>      - key: SERVER_PORT<br/>        value: 443</span></pre><p id="4566" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在那里，我为birth-predictor服务定制了YAML数据，以更新<strong class="kt ir"> name </strong>属性并添加一个<strong class="kt ir"> repo </strong>属性，如下所示:</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="1325" class="ms lo iq mo b gy mt mu l mv mw">services:<br/>  - type: web<br/>    name: birth-predictor<br/>    env: docker<br/>    repo: https://gitlab.com/johnjvester/birth-predictor<br/>    region: ohio # optional (defaults to oregon)<br/>    plan: free # optional (defaults to starter)<br/>    branch: master # optional (uses repo default)<br/>    numInstances: 1 # optional (defaults to 1)<br/>    healthCheckPath: /actuator/health<br/>    envVars:<br/>      - key: SERVER_PORT<br/>        value: 443</span></pre><p id="05d4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这些信息存储在出生预测器存储库的根目录下，一个名为render.yaml的文件中。提交并合并此更改后，服务就可以部署在渲染平台上了。</p><p id="2cf6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从渲染面板中，我选择了<strong class="kt ir">新建|蓝图</strong>选项:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/e76425b7468c7bd86cf35707fa24999c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yAyqM9L0pFndEA749QFOGQ.png"/></div></div></figure><p id="19c6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我选择了出生预测库，我使用这里的指令<a class="ae mk" href="https://render.com/docs/gitlab" rel="noopener ugc nofollow" target="_blank">将它连接到我的GitLab账户。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/a12244fbe3bdeb277556fd8d87e42067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pEaj4J-CxYybKXq89khqQw.png"/></div></div></figure><p id="f313" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为我使用的是蓝图，所以我所要做的就是为我的新服务提供一个服务组名称:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/8fa31589ceafdd0fb7c1d67f9ded0f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0k1-jxMK0UVgtBq_ZAudQ.png"/></div></div></figure><p id="b893" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">按下<strong class="kt ir">应用</strong>按钮后，展开过程开始:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/229654904213571340b37557416adbf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2SKAzi8ozvMlZDH-TR4iw.png"/></div></div></figure><p id="91b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">几分钟后，服务部署完毕，没有出现任何问题:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/cfb674e78b8611ffc85dfe214dea4a57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gaXIfwx2tUMAS3UF0QAsOA.png"/></div></div></figure><h1 id="8bb6" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">运行中的出生预测器</h1><p id="0558" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">随着birth-predictor服务的运行，我可以发出以下cURL命令来获得新的预测:</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="399e" class="ms lo iq mo b gy mt mu l mv mw">curl --location --request POST 'https://birth-predictor.onrender.com/predict' \<br/>--header 'Content-Type: application/json' \<br/>--data-raw '{<br/>    "conceptionMonth" : 11,<br/>    "conceptionAge" : 43<br/>}'</span></pre><p id="e2bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">产生的响应负载如下所示:</p><pre class="kg kh ki kj gt mn mo mp mq aw mr bi"><span id="880c" class="ms lo iq mo b gy mt mu l mv mw">{<br/>    "month": 11,<br/>    "age": 43,<br/>    "gender": "male",<br/>    "errorMessage": <strong class="mo ir">null</strong><br/>}</span></pre><p id="92f3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这些信息恰好与我妻子怀上我们的儿子(芬尼)的月份和年龄相吻合。2017年8月，他到了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/62b3c56171c39b41d65c079442362a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7iYEuDOdFNatrTGBVTtAA.jpeg"/></div></div></figure><p id="f678" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就像他们在清朝所做的那样，我们能够依靠中国的性别预测器成功地预测我们孩子的性别。</p><h1 id="371a" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结论</h1><p id="afa3" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">自2021年以来，我一直试图按照以下使命宣言生活，我觉得这可以适用于任何IT专业人士:</p><blockquote class="oc od oe"><p id="0729" class="kr ks ml kt b ku kv jr kw kx ky ju kz of lb lc ld og lf lg lh oh lj lk ll lm ij bi translated"><em class="iq">“将您的时间集中在提供扩展您知识产权价值的特性/功能上。将框架、产品和服务用于其他一切。”</em></p><p id="f0be" class="kr ks ml kt b ku kv jr kw kx ky ju kz of lb lc ld og lf lg lh oh lj lk ll lm ij bi translated"><em class="iq"> - J. Vester </em></p></blockquote><p id="e7af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Render的蓝图规范坚持我的使命声明，允许功能和服务团队专注于实现既定的目标，而不用担心任何与DevOps相关的事情。</p><p id="1383" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦服务、组件或应用程序准备就绪，团队只需将render.yaml文件包含在其存储库的根目录中，然后使用Blueprint选项在render平台上创建一个新服务。今后，对连接的存储库的任何更新都将在将代码提交到指定的分支几分钟后自动部署。</p><p id="fc46" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Render平台以Zero DevOps的心态生存，这在Blueprint概念的起源中显而易见。特性和服务开发人员希望——也应该——专注于提供更新和功能，为他们的利益相关者提供最大的价值。Render真正理解这个现实。</p><p id="2144" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我确信，流行语将永远是技术空间的一部分。然而，我希望技术人员能够理解并采纳这些流行词汇背后的真实意图。</p><p id="9021" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您对本出版物的源代码感兴趣，可以在GitLab上找到，地址如下:</p><p id="51b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae mk" href="https://gitlab.com/johnjvester/birth-predictor" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/johnjvester/birth-predictor</a></p><p id="3ed6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">祝你今天过得愉快！</p></div></div>    
</body>
</html>