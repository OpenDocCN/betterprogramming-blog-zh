<html>
<head>
<title>Scheduling AWS Lambdas Using Amazon EventBridge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Amazon EventBridge计划AWS Lambdas</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/scheduling-aws-lambdas-using-amazon-eventbridge-7440c6270c15?source=collection_archive---------2-----------------------#2022-12-08">https://betterprogramming.pub/scheduling-aws-lambdas-using-amazon-eventbridge-7440c6270c15?source=collection_archive---------2-----------------------#2022-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e726" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">需要时运行功能，无需额外开销</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9bafba61d1c976016a8e9496e884ebc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o7vOjAkkDqMgfOTFVYlnVg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢卡斯·布拉塞克在<a class="ae ky" href="https://unsplash.com/s/photos/schedule?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="1386" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">你有没有想过安排一个Lambda定期运行，却发现没有一个内置的方法来？令人惊讶的是，这个特性并不是AWS Lambda产品的标准部分。令人遗憾的是，最初的产品中没有一个简单的cron风格的调度程序，甚至没有一个基本的任务运行程序。</p><p id="b129" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这迫使我们许多人从其他地方运行调度程序，甚至可能是其他Lambda函数。这不仅使工作量增加了一倍，也使一切变得更加脆弱。如果您必须在某个地方运行另一个持久调度服务，这并不完全是无服务器的。</p><p id="e942" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">好消息是，亚马逊最近给<a class="ae ky" href="https://aws.amazon.com/eventbridge/" rel="noopener ugc nofollow" target="_blank"> EventBridge </a>增加了一个新功能，叫做“<a class="ae ky" href="https://aws.amazon.com/eventbridge/scheduler/" rel="noopener ugc nofollow" target="_blank">调度器</a>”。此功能允许您设置重复的cron样式计划。每个时间表都能够启动许多AWS目录服务，包括Lambda。</p><p id="a3e8" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在本文中，我们将探索如何设置EventBridge来定期运行Lambda函数。现在你的时间表可以像你的Lambda函数一样简单。</p><h1 id="6de3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先决条件</h1><p id="909e" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">EventBridge的一个特点是调度程序只能在特定区域设置。您将无法在其他地区锁定Lambdas。当你设置Lambda和Scheduler时，确保它们在同一个区域。</p><p id="90af" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">以下是当前支持的EventBridge调度程序区域列表:</p><ul class=""><li id="1732" class="mz na it li b lj lk lm ln lp nb lt nc lx nd mb ne nf ng nh bi translated"><em class="ni">美国东部-1 </em></li><li id="be94" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><em class="ni">美国东部-2 </em></li><li id="ef3e" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><em class="ni">美国西部-2 </em></li><li id="8fe9" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><em class="ni">AP-东南-1 </em></li><li id="fb1e" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><em class="ni">美联社-东南-2 </em></li><li id="e61c" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><em class="ni">AP-东北-1 </em></li><li id="6dfe" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><em class="ni">欧盟-中欧-1 </em></li><li id="2c2a" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><em class="ni">欧盟-西方-1 </em></li><li id="6b93" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><em class="ni">欧盟-北方-1 </em></li></ul><p id="36af" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">查看<a class="ae ky" href="https://aws.amazon.com/eventbridge/scheduler/" rel="noopener ugc nofollow" target="_blank">官方调度文档</a>以获取对该列表的任何更新或修改。</p><h1 id="c300" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置Lambda</h1><p id="e213" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">对于这个例子，让我们构建一个简单的Python Lambda函数，它只打印一些输出:</p><pre class="kj kk kl km gt no np nq bn nr ns bi"><span id="00f3" class="nt md it np b be nu nv l nw nx">def lambda_handler(event, context):<br/>    print('hello!')</span></pre><p id="59a3" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这非常简单，但给了我们一个函数来运行并确认我们的时间表确实在正确的时间启动。对于您自己的功能，您可能要控制EC2实例，运行常规的备份脚本，甚至拍摄对象的快照。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/6118f069cc6ccf05a1c67d0d2bfa08ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V8igXc5PyZ83Mcey-woU7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构建基本的Python Lambda。</p></figure><p id="1460" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">继续部署这个简单的功能，并确认它正常运行。现在，我们不需要对函数本身做太多其他的事情。</p><h1 id="347d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置EventBridge调度程序</h1><p id="273a" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">现在我们有一个Lambda可以使用，我们可以开始设置我们的时间表。一开始这可能有点令人生畏，因为有很多选项，但实际上非常简单。反正你可能不需要很多。</p><p id="b959" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">创建新的EventBridge计划，并提供基本名称和其他描述性信息。在模式部分，您可以创建一次性计划或重复计划。循环调度将使用cron样式的模式来触发事件，就像普通的crontab一样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/5e9e512970b109c3035efa891f9ed569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dse-YhTkkEsRG5eNAsdYag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建EventBridge调度程序模式。</p></figure><p id="5882" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，您需要做的就是提供您希望调度运行的cron表达式。如果你需要帮助选择正确的模式，你可以使用Crontab Guru。这个网站帮助分解cron表达式，使它们更容易组合。</p><p id="6d27" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在让我们为这个时间表设定目标。</p><h1 id="d8c8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">瞄准λ</h1><p id="bc35" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">在下一页，您可以选择一个目标。此部分允许您从AWS目录的大部分内容中进行选择:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/58d98ced85c63afcd19959c812d16d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fSKGkW7wh0kDzyXpB69FEA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">选择AWS Lambda作为EventBridge计划的目标。</p></figure><p id="3c30" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">从下拉列表中选择AWS Lambda API、您的函数，然后设置所需的有效负载以传递给您的函数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/7e0f1d59886cde12990c617a262fa676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZgjrlTTCFG7uOmbiOeH1g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为Lambda设置有效载荷。</p></figure><p id="1843" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这里我们只是在有效载荷中传递一些测试数据，因为我们的函数不使用它。如果你正在部署一个真正的函数，你可以在不同的调度中使用不同的负载来操作同一个Lambda。这使得将一个功能用于多个时间表变得很容易。</p><p id="dfb1" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">接下来，我们将看看剩下的几个配置选项。</p><h1 id="498d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">处理错误</h1><p id="cbef" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">在下一页，您可以设置重试逻辑和未送达事件的队列。这对于高容量事件可能会被丢弃的其他服务尤其有用，但对于我们定期安排的功能就不那么有用了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/31049f4c6d634b0da89b9ccaef414c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0zbem1TdpCU0vZALdSlyjg.png"/></div></div></figure><p id="5695" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，我们可以不管重试逻辑，或者完全关闭它。在某些情况下，如果事件没有被传递，重试事件可能没有意义。</p><p id="17da" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">无论你制定了什么样的时间表，你都有可能在第一次尝试时错过一个重要的窗口，而延迟交付可能会导致服务中断或其他不良副作用。如果函数被快速连续调用多次，请确保您知道该函数的行为。或者，使函数幂等，这样它就不会因重复运行而出错。</p><h1 id="114f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">许可</h1><p id="2358" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">在同一页的末尾，你会发现权限部分。在大多数情况下，简单地自动创建一个新角色就可以了。这将为EventBridge设置默认权限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/293b496feb40ff571de089c6398eb008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*weZAkf8iEZ5G8v-zjR3NCg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为计划程序设置权限。</p></figure><p id="3e0a" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果您在目标Lambda上遇到了更多限制性权限的问题，您可能需要调整这里列出的策略，或者给它分配一个新的策略。</p><h1 id="7fb6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最终确定时间表</h1><p id="c90f" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">在最后一页，您可以查看整个计划配置。这个页面还有一个非常方便的cron表达式回顾部分。此部分显示输入计划的下10个触发日期。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/bdb4925ff457cc0975f5cf7f3473cad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8apC08PqnzxJivGvSV4vxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在最后一个调度程序设置页面上确认cron调度。</p></figure><p id="6c0a" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这有助于确认，并在必要时调整cron表达式。此外，一定要记住，触发日期上列出的日期和时间实际上是初始cron表达式配置页面上列出的本地时区。</p><p id="9351" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果您注意到任何与触发日期不一致的地方(如时区)，只需返回到计划设置并调整表达式或时区。</p><p id="5af7" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">一旦一切正常，保存时间表，享受Lambda函数的好处。</p><h1 id="b3fa" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="d1f1" class="pw-post-body-paragraph lg lh it li b lj mu ju ll lm mv jx lo lp mw lr ls lt mx lv lw lx my lz ma mb im bi translated">使用EventBridge Scheduler来触发Lambda函数是健壮的循环任务设置中缺少的部分。设置只需几分钟，更改时间表也同样简单。</p><p id="0e57" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">没有代码提交，没有自己管理cron，只是相同的无服务器简单性。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="b115" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果你想寻找更多的内容，可以看看我下面的一些帖子:</p><ul class=""><li id="3dcb" class="mz na it li b lj lk lm ln lp nb lt nc lx nd mb ne nf ng nh bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/6-more-unique-linux-utilities-you-forgot-about-1215ac0c58da"> <em class="ni"> 6更独特的Linux实用程序你忘了</em> </a></li><li id="36f7" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/5-python-modules-that-make-building-apis-easier-a8d39911f6a8"> <em class="ni"> 5个让构建API更简单的Python模块</em> </a></li><li id="b719" class="mz na it li b lj nj lm nk lp nl lt nm lx nn mb ne nf ng nh bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/clean-up-your-kubernetes-deployments-using-ansible-10a000db313b"> <em class="ni">使用Ansible </em> </a>清理您的Kubernetes部署</li></ul></div></div>    
</body>
</html>