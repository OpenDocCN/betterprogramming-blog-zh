<html>
<head>
<title>Reducing JavaScript Bundle Size</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">减小JavaScript包的大小</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/reducing-js-bundle-size-a6533c183296?source=collection_archive---------3-----------------------#2019-07-01">https://betterprogramming.pub/reducing-js-bundle-size-a6533c183296?source=collection_archive---------3-----------------------#2019-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="55f8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">第二部分:精简和死码消除</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c87506f8d018b02ec282182978a71349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9AhKd3VVSqvLVCa6Xv9yg.png"/></div></div></figure><p id="ac99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">随着2011年左右像<a class="ae lq" href="https://en.wikipedia.org/wiki/AngularJS" rel="noopener ugc nofollow" target="_blank"> AngularJS </a>这样的框架的出现和<a class="ae lq" href="https://en.wikipedia.org/wiki/Single-page_application" rel="noopener ugc nofollow" target="_blank">单页面应用</a>的普及，JavaScript的使用在前端已经爆炸式增长。仅2010年一年，网络应用的平均规模<a class="ae lq" href="https://www.keycdn.com/support/the-growth-of-web-page-size" rel="noopener ugc nofollow" target="_blank">就超过三倍。由于JavaScript库和框架广泛用于开发这些web应用程序，缩小JavaScript包的能力变得前所未有的重要。</a></p><p id="6627" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本系列的第二部分中，我们将深入探讨缩减和死代码消除。我们将重点介绍的主题有:</p><ul class=""><li id="288f" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">缩小和DCE的历史</li><li id="03a0" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">什么是缩小</li><li id="fdf0" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">什么是死代码消除</li><li id="49bd" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">我们如何使用工具在我们的代码上运行这些过程呢？</li><li id="48a1" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">让它自动化！</li></ul><p id="dd6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您错过了<a class="ae lq" href="https://medium.com/better-programming/reducing-js-bundle-size-58dc39c10f9c" rel="noopener">第一部分</a>，请随意先阅读一下关于捆绑的背景知识。</p><p id="33c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们开始吧！</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="fd61" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">缩小，一段历史</h1><p id="9d05" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">首先，让我们回顾一下历史。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/2849fa6d11326d8c12b1695871b04bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*J5m_UiWPFPndBWM8QC8KRA.png"/></div><p class="nk nl gj gh gi nm nn bd b be z dk translated">古老的遗址</p></figure><p id="abf1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">网站大小和请求加载时间多年来一直是一个问题，只是加载时间慢的罪魁祸首已经转移了。静态网站通常更关心HTML的数量，最重要的是，图像的大小，而不是它们收缩包的能力，因为JavaScript在当时的使用更多的是补充性的！</p><p id="5a92" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">随着JavaScript的使用随着像<a class="ae lq" href="https://mootools.net/" rel="noopener ugc nofollow" target="_blank"> Moo-Tools </a>和<a class="ae lq" href="https://jquery.com/" rel="noopener ugc nofollow" target="_blank"> JQuery </a>这样的工具的增加，缩小工具被开发来减少CSS和JavaScript的占用空间，从而减少初始请求加载时间。此外，我们将把JQuery这样的大型常用JavaScript工具转移到CDN上，以实现更快的内容交付。生产站点会指向这些库的缩小版本。</p><p id="ddfd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们更进一步之前，什么是代码精简？我们在<a class="ae lq" href="https://dennyscott.io/reduce-js-bundle-part-one" rel="noopener ugc nofollow" target="_blank">第一部分</a>中提到过，但是当我们缩小和丑化我们的代码时，我们会删除所有不需要的数据，比如创建一个更小的函数和变量名，删除换行符、注释、分隔符和字符间的空格，合并文件，可能还会优化调用。在我们下面的第一个例子中，我们将在任何死代码消除之前使用缩小，所以你将能够自己看到！</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="5478" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">使用Terser</h1><p id="aaf3" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">由于JavaScript是一种动态脚本语言，它可能缺少静态编程语言中常见的许多工具。其中一个工具是使用静态分析来消除<a class="ae lq" href="https://en.wikipedia.org/wiki/Dead_code_elimination" rel="noopener ugc nofollow" target="_blank">死代码</a>。死代码消除通常是指删除我们代码库中不用的代码。为了更好地理解它，让我们看一个例子，并尝试消除死代码。</p><p id="39d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="no">注:本文使用的所有代码示例都可以在</em> <a class="ae lq" href="https://github.com/DennyScott/minification-dce-blog" rel="noopener ugc nofollow" target="_blank"> <em class="no"> Github </em> </a>上找到</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="2d74" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们假设<code class="fe nr ns nt nu b">selectClothes</code>在我们的应用程序中从不同的模块执行。在我们的例子中，不可能得到<code class="fe nr ns nt nu b">Hat</code>对象作为我们的返回值。也许它曾被包含在内，也许这是一次重构，无意中留下了这段代码，或者有人认为用户不能购买帽子。剩下的就是所谓的“死代码”尽管这些代码很少，但是这些零碎的部分肯定会累积起来，并且它们会增加我们的包的大小。正如我们所知，增加的包大小会导致更长的加载时间，并需要更多的网络数据。</p><p id="65e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">许多精简工具，如<a class="ae lq" href="https://github.com/terser-js/terser" rel="noopener ugc nofollow" target="_blank"> Terser </a>，已经包含了死代码消除。它会发现任何从未执行过的代码，并自动将其从代码库中删除。让我们尝试通过Terser传递我们的代码示例，以便更好地理解库本身。</p><p id="1d7a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="no">注意:Terser将自己描述为“用于ES6+的JavaScript解析器和处理器/压缩器工具包”。</em></p><p id="dbab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，为此项目创建一个文件夹:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="5618" class="nz mn it nu b gy oa ob l oc od">mkdir dce-example<br/>cd dce-example</span></pre><p id="391c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将上面的<code class="fe nr ns nt nu b">selectClothes</code>代码添加到一个<code class="fe nr ns nt nu b">dce-example/index.js</code>中。</p><p id="9aaa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，让我们创建一个<code class="fe nr ns nt nu b">npm</code>包:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="9a58" class="nz mn it nu b gy oa ob l oc od">npm init</span></pre><p id="1c2a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">初始化之后，我们可以添加Terser:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="6566" class="nz mn it nu b gy oa ob l oc od">npm i terser — save-dev</span></pre><p id="7472" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们用Terser运行第一遍:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="a66c" class="nz mn it nu b gy oa ob l oc od">npx terser index.js</span></pre><p id="38a3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">输出应该如下所示:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="71f5" class="nz mn it nu b gy oa ob l oc od">function selectClothes(type){if(type===”shirt”){return{type:”shirt”,amount:”$10"}}else{return{type:”pants”,amount:”$12"}}return{type:”hat”,amount:”$5"}}selectClothes(“shirt”);</span></pre><p id="bf51" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的代码被缩减了，但是死代码并没有从包中删除。怎么回事？我们一会儿就会谈到这一点，但是让我们先检查一下简化的代码。注意到所有的空白都被删除了吗？删除该空间会减小文件的大小。但是变量名/函数名呢，它们仍然是普通的名字，我们不是说过它们应该被缩小到尽可能小的尺寸吗？</p><p id="1ac4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Terser-CLI知道我们可能会使用它并在我们的终端中查看它。当变量和函数被“破坏”时，阅读和理解我们的代码是非常困难的，所以默认情况下就不要去管它了。大多数web应用程序使用一个实际的模块捆绑系统来自动完成这项工作，因此它们永远也不需要阅读这些混乱的代码。不过，为了便于学习，我们应该先看一下它的样子，所以这次让我们用Terser再抛出几个命令:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="fdd6" class="nz mn it nu b gy oa ob l oc od">npx terser — toplevel — mangle — mangle-props — index.js</span></pre><p id="5335" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将为我们提供混乱的代码:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="426e" class="nz mn it nu b gy oa ob l oc od">function t(t){if(t===”shirt”){return{type:”shirt”,t:”$10"}}else{return{type:”pants”,t:”$12"}}return{type:”hat”,t:”$5"}}t(“shirt”);</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="a1eb" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">死代码消除</h1><p id="1051" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">好吧，让我们回到我们之前的问题。为什么我们的死代码没有被淘汰？Terser的默认选项不包括压缩，这是消除死代码的地方。所以让我们通过给它<code class="fe nr ns nt nu b">-c</code>命令来添加它。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="5e52" class="nz mn it nu b gy oa ob l oc od">npx terser index.js -c</span></pre><p id="6420" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的结果应该是这样的:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="1459" class="nz mn it nu b gy oa ob l oc od">function selectClothes(type){return”shirt”===type?{type:”shirt”,amount:”$10"}:{type:”pants”,amount:”$12"}}selectClothes(“shirt”);</span></pre><p id="315e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看它变小了多少！它不仅删除了死代码(注意<code class="fe nr ns nt nu b">hat</code>完全消失了)，还通过将<code class="fe nr ns nt nu b">if</code>流改为三元流优化了我们的模块！</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="a971" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">使用Webpack实现自动化！</h1><p id="66ea" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">在将我们的应用程序发布到网络上之前，我们曾经不得不通过像triangular这样的工具来传递我们的代码。但从那以后，像<a class="ae lq" href="https://github.com/rollup/rollup" rel="noopener ugc nofollow" target="_blank"> Rollup </a>和<a class="ae lq" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>这样的捆绑工具接管了前端社区。这些捆绑工具通常很容易用像Terser这样的插件来扩展。在我们的例子中，我们将使用Webpack并添加Terser插件。</p><p id="c8fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="no">注意:还有其他web应用捆绑包，所以不要认为这是一个令人疲惫的列表。这些只是现在用的主要的。</em> <a class="ae lq" href="https://parceljs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="no">包裹</em> </a> <em class="no">比较新，但是很刺激！</em></p><p id="4716" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，让我们将<code class="fe nr ns nt nu b">Webpack</code>和<code class="fe nr ns nt nu b">Webpack-CLI</code>添加到我们的项目中:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="a37c" class="nz mn it nu b gy oa ob l oc od">npm i webpack webpack-cli — save-dev</span></pre><p id="a98e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将在这里添加和移动几个文件。首先，我们将添加一个名为<code class="fe nr ns nt nu b">dist</code>和<code class="fe nr ns nt nu b">src</code>的文件夹:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="c94e" class="nz mn it nu b gy oa ob l oc od">mkdir dist<br/>mkdir src</span></pre><p id="226e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe nr ns nt nu b">dist</code>内部，我们将添加<code class="fe nr ns nt nu b">index.html</code>文件:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="4af1" class="nz mn it nu b gy oa ob l oc od"><br/> &lt;!doctype html&gt;<br/> &lt;html&gt;<br/>   &lt;head&gt;<br/>    &lt;title&gt;Getting Started&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;script src=”main.js”&gt;&lt;/script&gt;<br/>   &lt;/body&gt;<br/> &lt;/html&gt;</span></pre><p id="36ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们将导航到项目根目录下的<code class="fe nr ns nt nu b">/src</code>文件夹，并将<code class="fe nr ns nt nu b">index.js</code>移动到其中:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="b1a0" class="nz mn it nu b gy oa ob l oc od">mv index.js src/</span></pre><p id="56ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们需要进入我们的<code class="fe nr ns nt nu b">package.json</code>，删除<code class="fe nr ns nt nu b">main</code>属性，改为添加<code class="fe nr ns nt nu b">private: true</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="35c0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的项目已经设置好了，所以我们将返回到项目的根目录，并运行<code class="fe nr ns nt nu b">webpack-CLI</code>工具。</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="d192" class="nz mn it nu b gy oa ob l oc od">npx webpack</span></pre><p id="8570" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，我们可以打开<code class="fe nr ns nt nu b">/dist/main.js</code>来查看我们新捆绑的JavaScript文件。请记住，这是在我们的应用程序中添加一个捆绑系统，所以会有相当多的样板文件附加到文件中。对于只有一个JavaScript文件来说，这是一个很大的过度。但是随着我们的web应用变得越来越丰富，这种样板文件变成了微不足道的代码量。</p><p id="33ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们来看看这个包！</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="14d0" class="nz mn it nu b gy oa ob l oc od">!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){“undefined”!=typeof Symbol&amp;&amp;Symbol.toStringTag&amp;&amp;Object.defineProperty(e,Symbol.toStringTag,{value:”Module”}),Object.defineProperty(e,”__esModule”,{value:!0})},r.t=function(e,t){if(1&amp;t&amp;&amp;(e=r(e)),8&amp;t)return e;if(4&amp;t&amp;&amp;”object”==typeof e&amp;&amp;e&amp;&amp;e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,”default”,{enumerable:!0,value:e}),2&amp;t&amp;&amp;”string”!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&amp;&amp;e.__esModule?function(){return e.default}:function(){return e};return r.d(t,”a”,t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=””,r(r.s=0)}([function(e,t){}]);</span></pre><p id="7287" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可能有几个问题。首先，我们已经讨论过添加Terser插件，但是这个插件已经被缩小和压缩了。嗯，那是因为Webpack自动添加了用于缩小的Terser插件。此外，当我们运行Webpack时，您可能已经注意到了控制台中的警告。因为我们没有指定环境，所以它假定是生产环境。当环境设置为生产时，它将为我们执行缩小和压缩。</p><p id="9653" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">也许一个更关键的问题是，我们写的代码在哪里？嗯，最新版本的Webpack用<code class="fe nr ns nt nu b"><a class="ae lq" href="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/" rel="noopener ugc nofollow" target="_blank">esmodules</a></code>包装你的文件，所以它可以对你的模块做更多的静态分析。它决定了我们写的代码对我们的代码库没有影响。该函数从未被外部调用(第三部分将详细介绍)，也从未执行过任何非纯路径。因此，整个文件都是死代码。这是正确的！我们从未在实际的前端中使用该代码。解决这个问题最简单的方法是添加一个控制台日志。所以让我们在<code class="fe nr ns nt nu b">index.js</code>中这样做。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="8ac9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，当我们再次运行webpack CLI时:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="7084" class="nz mn it nu b gy oa ob l oc od">!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){“undefined”!=typeof Symbol&amp;&amp;Symbol.toStringTag&amp;&amp;Object.defineProperty(e,Symbol.toStringTag,{value:”Module”}),Object.defineProperty(e,”__esModule”,{value:!0})},n.t=function(e,t){if(1&amp;t&amp;&amp;(e=n(e)),8&amp;t)return e;if(4&amp;t&amp;&amp;”object”==typeof e&amp;&amp;e&amp;&amp;e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,”default”,{enumerable:!0,value:e}),2&amp;t&amp;&amp;”string”!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&amp;&amp;e.__esModule?function(){return e.default}:function(){return e};return n.d(t,”a”,t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=””,n(n.s=0)}([function(e,t){const n=”shirt”===”shirt”?{type:”shirt”,amount:”$10"}:{type:”pants”,amount:”$12"};console.log(n)}]);</span></pre><p id="6c79" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的代码现在存在于主包中。还要注意，就像以前一样，我们想要的死代码被删除了！让我们试着再抽象一点。在我们的<code class="fe nr ns nt nu b">index.js</code>中，让我们将代码更新为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="607d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在的结果是:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="8703" class="nz mn it nu b gy oa ob l oc od">!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){“undefined”!=typeof Symbol&amp;&amp;Symbol.toStringTag&amp;&amp;Object.defineProperty(e,Symbol.toStringTag,{value:”Module”}),Object.defineProperty(e,”__esModule”,{value:!0})},n.t=function(e,t){if(1&amp;t&amp;&amp;(e=n(e)),8&amp;t)return e;if(4&amp;t&amp;&amp;”object”==typeof e&amp;&amp;e&amp;&amp;e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,”default”,{enumerable:!0,value:e}),2&amp;t&amp;&amp;”string”!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&amp;&amp;e.__esModule?function(){return e.default}:function(){return e};return n.d(t,”a”,t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=””,n(n.s=0)}([function(e,t){const n=()=&gt;({type:”pants”,amount:”$12"});const r=”shirt”===”shirt”?(()=&gt;({type:”shirt”,amount:”$10"}))():n();console.log(r)}]);</span></pre><p id="cad8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意，不仅对<code class="fe nr ns nt nu b">buyHat</code>的调用被移除，实际的函数也被移除。Webpack注意到该请求没有在任何地方使用，并删除了不可访问的代码。如果您只通过Terser运行同一个模块，而不使用Webpack，您将得到以下输出:</p><pre class="kj kk kl km gt nv nu nw nx aw ny bi"><span id="5273" class="nz mn it nu b gy oa ob l oc od">const buyShirt=()=&gt;({type:”shirt”,amount:”$10"}),buyPants=()=&gt;({type:”pants”,amount:”$12"}),buyHat=()=&gt;({type:”hat”,amount:”$5"});function selectClothes(type){return”shirt”===type?buyShirt():buyPants()}const clothes=selectClothes(“shirt”);console.log(clothes);</span></pre><p id="d744" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以Webpack去掉了不用的功能，而Terser却做不到这一点，那是为什么呢？</p><p id="b2ee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是因为Webpack可以假设我们正在使用<code class="fe nr ns nt nu b">esmodule</code>系统。从Webpack 4开始，这是使用的默认模块系统。由于<code class="fe nr ns nt nu b">buyHat</code>函数不是<code class="fe nr ns nt nu b">exported</code>(稍后将详细介绍)，Webpack知道在代码中唯一使用它的地方是我们的<code class="fe nr ns nt nu b">selectClothes</code>函数。一旦Terser从那里删除了死代码，Webpack就知道它在代码库中的任何地方都不再被使用，并且可以安全地删除。这是<a class="ae lq" href="https://webpack.js.org/guides/tree-shaking/" rel="noopener ugc nofollow" target="_blank">摇树</a>的早期演示。</p><p id="e6cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://medium.com/better-programming/introduction-to-tree-shaking-e94e57db081e" rel="noopener"> <em class="no">在这里阅读我的后续文章</em> </a></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="1787" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">结束语</h1><p id="5127" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">干得好！我们完成了消除死代码的第一步。如果这是你第一次遇到像死代码消除这样的东西，并且你在理解它的时候有一点困难，我会在下面给你一些链接。不要担心第一次会有一点棘手，学习JavaScript代码本身是如何被分析和编译的会让人望而生畏。我们通常认为我们的系统更元。</p><p id="88ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一方面，一旦你有了感觉，这实际上是一个非常简单的过程！这是一个关键的过程。我们将在下一部分进入摇树，这在很大程度上依赖于这个过程作为一个构建模块，所以我鼓励你用Terser做一点实验，并查看更多的细节。所以下次加入我们来学习现代JavaScript树摇动吧！</p><p id="11cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你有兴趣在这个博客上看到什么，或者你认为我应该看看，一定要联系我<a class="ae lq" href="http://twitter.com/gitinbit" rel="noopener ugc nofollow" target="_blank"> @gitinbit </a>。这里的所有代码都可以在Github 上找到。干杯！</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="0407" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">参考资料和进一步阅读</h1><p id="95b5" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated"><a class="ae lq" href="https://dennyscott.io/reduce-js-bundle-part-one" rel="noopener ugc nofollow" target="_blank">https://dennyscott.io/reduce-js-bundle-part-one</a></p><p id="738b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://mootools.net/" rel="noopener ugc nofollow" target="_blank">https://mootools.net/</a></p><p id="9f1e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://en.wikipedia.org/wiki/AngularJS" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/AngularJS</a></p><p id="7550" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://jquery.com/" rel="noopener ugc nofollow" target="_blank">https://jquery.com/</a></p><p id="1ec7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://www.cloudflare.com/learning/cdn/what-is-a-cdn/" rel="noopener ugc nofollow" target="_blank">https://www.cloudflare.com/learning/cdn/what-is-a-cdn/</a></p><p id="f12e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://en.wikipedia.org/wiki/Single-page_application" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Single-page_application</a></p><p id="2b77" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">https://www.keycdn.com/support/the-growth-of-web-page-size<a class="ae lq" href="https://www.keycdn.com/support/the-growth-of-web-page-size" rel="noopener ugc nofollow" target="_blank"/></p><p id="859d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">【https://en.wikipedia.org/wiki/Dead_code_elimination T4】</p><p id="3fc1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/terser-js/terser" rel="noopener ugc nofollow" target="_blank">https://github.com/terser-js/terser</a></p><p id="41d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/rollup/rollup" rel="noopener ugc nofollow" target="_blank">https://github.com/rollup/rollup</a></p><p id="cc3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank">https://webpack.js.org/</a></p><p id="1164" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://webpack.js.org/guides/tree-shaking/" rel="noopener ugc nofollow" target="_blank">https://webpack.js.org/guides/tree-shaking/</a></p><p id="fd0b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/" rel="noopener ugc nofollow" target="_blank">https://hacks . Mozilla . org/2018/03/es-modules-a-卡通-深潜/ </a></p><p id="0973" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://developers.google.com/web/fundamentals/performance/optimizing-javascript/tree-shaking/" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/web/fundamentals/performance/optimizing-JavaScript/tree-shaking/</a></p></div></div>    
</body>
</html>