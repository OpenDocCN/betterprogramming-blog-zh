<html>
<head>
<title>Set Up Automated Deployments for Multiple Apps Under a Single Github Repository in Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Heroku的一个Github存储库下为多个应用程序设置自动部署</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/set-up-automated-deployments-for-multiple-apps-under-a-single-github-repository-in-heroku-42f887f49a0a?source=collection_archive---------9-----------------------#2021-12-01">https://betterprogramming.pub/set-up-automated-deployments-for-multiple-apps-under-a-single-github-repository-in-heroku-42f887f49a0a?source=collection_archive---------9-----------------------#2021-12-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4441" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">加快您的部署速度</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/efa65335c64e3aa8961c36549fa038dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LfZRich_WdvRRhj1KGUZnQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a70d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本教程中，我们将看到如何在Heroku的一个GitHub存储库下设置多个应用程序的自动化部署。如果您想将GitHub repo中的子目录部署到Heroku，这也会很有帮助。</p><h1 id="58f0" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">介绍</h1><p id="f6ee" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">最近，我在尝试部署应用程序时遇到了一些问题。这是一个全栈应用程序，有一个单独的文件夹存放所有的React内容，另一个文件夹存放Flask API。</p><p id="e2ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们的应用程序是这样设置的——必须部署flask API，并且在React应用程序中调用部署的API的URL。在本教程中，我将讨论我的解决方案。</p><h1 id="fe68" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">你会学到什么？</h1><ul class=""><li id="4a28" class="mr ms it la b lb mm le mn lh mt ll mu lp mv lt mw mx my mz bi translated">如果你的应用程序在子目录中，也就是说，它不在根目录中，你将学习如何将应用程序部署到Heroku。假设您有一个包含多个API的GitHub Repo，并且希望单独部署其中的每一个API。</li><li id="23ea" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated">您将了解如何使用不同的构建包部署多个应用程序。在本教程中，我将有一个React+Flask应用程序。然而，如果您使用不同的技术堆栈，本教程仍然会有所帮助</li><li id="c49e" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated">每当你推送到“部署”分支时，你的前端和API将自动部署到Heroku</li></ul><h1 id="9ac2" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">我的文件夹结构</h1><p id="b63b" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">你可以在这里找到GitHub回购<a class="ae nf" href="https://github.com/rahulbanerjee26/Heroku_Deploy" rel="noopener ugc nofollow" target="_blank"/></p><p id="812c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是应用程序的文件夹结构的截图</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/8390d9dd27dfd9b876fa994273417ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xcXded_FNBrsbFD-.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">回购结构</p></figure><p id="84b4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在根文件夹中，有三个文件。</p><ul class=""><li id="cc93" class="mr ms it la b lb lc le lf lh nh ll ni lp nj lt mw mx my mz bi translated">一个名为API的文件夹。它包含flask API，必须作为一个单独的项目部署在Heroku上</li><li id="51ea" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated">一个叫做前端的文件夹。这个文件夹有另一个名为hello-world的文件夹，这是一个简单的react应用程序，使用“create-react-app”创建</li><li id="ff6e" class="mr ms it la b lb na le nb lh nc ll nd lp ne lt mw mx my mz bi translated">答。gitignore文件</li></ul><h1 id="d29d" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">部署React应用程序</h1><p id="52df" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在移动之前，确保你所有的文件都被推送到GitHub repo。我的回购的名称是“Heroku_Deploy”</p><p id="dd3e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Heroku 上创建一个<a class="ae nf" href="https://dashboard.heroku.com/new-app" rel="noopener ugc nofollow" target="_blank">新项目</a></p><p id="e347" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于部署方法，选择第二个选项“连接到GitHub”。搜索您的回购，然后单击“连接”按钮</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/8b120719fbc088bc735d4ab7cff18994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rbD4GkkeRPS4RI15.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新项目的屏幕截图</p></figure><p id="98f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">选择要部署的分支，然后单击“启用自动部署”。每当您向分支推送任何更改时，React应用程序都会被重新部署。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/daa7483f473090516d5219edecb8fc8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XAe65I6J9Kt0o0HT.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分行截图</p></figure><p id="1fc5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，向上滚动并进入设置。转到“BuildPacks”并单击“Add Buildpacks”按钮。添加以下内容<code class="fe nk nl nm nn b">buildpack</code>:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="a928" class="ns lv it nn b gy nt nu l nv nw"><a class="ae nf" href="https://github.com/timanovsky/subdir-heroku-buildpack" rel="noopener ugc nofollow" target="_blank">https://github.com/timanovsky/subdir-heroku-buildpack</a></span></pre><p id="bbed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成后，为您的应用添加<code class="fe nk nl nm nn b">buildpack</code>。在我的例子中，由于它是一个React应用程序，我将添加Node.js buildpack。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/81e98ee295279a995fcde5beb0284975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z3nzhzBWrQxTNab_.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构建包的屏幕截图</p></figure><blockquote class="nx ny nz"><p id="d867" class="ky kz oa la b lb lc ju ld le lf jx lg ob li lj lk oc lm ln lo od lq lr ls lt im bi translated"><em class="it">确保subdir-heroku-buildpack位于其他构建包的顶部。</em></p></blockquote><p id="cba3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在转到Config Vars设置，添加以下配置变量。键是<code class="fe nk nl nm nn b">PROJECT_PATH</code>，值是应用程序的路径。在我的例子中，react-app位于文件夹<code class="fe nk nl nm nn b">hello-world</code>中，而文件夹<code class="fe nk nl nm nn b">hello-world</code>位于文件夹<code class="fe nk nl nm nn b">FrontEnd</code>中</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="08bd" class="ns lv it nn b gy nt nu l nv nw">FrontEnd&gt;hello-world&gt;react-app</span></pre><p id="8681" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的例子中，配置变量如下所示</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/1d2ecdefd0ecade16ec2f89bc6e0dd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*In1aG2D5KdprccQp.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">配置变量的屏幕截图</p></figure><p id="459c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，向上滚动并转到“部署”部分。单击“部署分支”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/5d3d9bde6e5274c97e3b2bce6d3dc506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z7K5Y1Spdsa4dXs7.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分行截图</p></figure><blockquote class="nx ny nz"><p id="194a" class="ky kz oa la b lb lc ju ld le lf jx lg ob li lj lk oc lm ln lo od lq lr ls lt im bi translated"><em class="it">一切就绪。每当您向您的分支推送任何更改时，heroku将自动重新部署您在</em> <code class="fe nk nl nm nn b"><em class="it">PROJECT_PATH</em></code>中指定的应用</p></blockquote><h1 id="d221" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">部署Flask API</h1><p id="c944" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">这是一个与上面类似的过程。</p><p id="74bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Heroku上创建一个新项目<a class="ae nf" href="https://dashboard.heroku.com/new-app" rel="noopener ugc nofollow" target="_blank"/></p><p id="2feb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于部署方法，选择第二个选项“连接到GitHub”。搜索您的回购，然后单击“连接”按钮</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/27bfe4d115dde3d52bf1933796b08bea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C3bcM4j3G8V5t3kY.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新项目的屏幕截图</p></figure><p id="ebef" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">选择要部署的分支，然后单击“启用自动部署”。每当您将任何更改推送到分支时，Flask API将被重新部署。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/6edf3012fe8925ac14179d92b2bae7e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2JMZgO5CZPl-o3WT.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分行截图</p></figure><p id="e2e4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，向上滚动并进入设置。转到“BuildPacks”并单击“Add Buildpacks”按钮。添加以下<code class="fe nk nl nm nn b">buildpack</code></p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="f31b" class="ns lv it nn b gy nt nu l nv nw"><a class="ae nf" href="https://github.com/timanovsky/subdir-heroku-buildpack" rel="noopener ugc nofollow" target="_blank">https://github.com/timanovsky/subdir-heroku-buildpack</a></span></pre><p id="ccb7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成后，为您的应用添加<code class="fe nk nl nm nn b">buildpack</code>。在我的例子中，因为它是一个Flask API，所以我将添加Python <code class="fe nk nl nm nn b">buildpack</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/059ad58b77c36b35497e99ab825c501a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QLywCBgOI8ngUpWe.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构建包的屏幕截图</p></figure><blockquote class="nx ny nz"><p id="febb" class="ky kz oa la b lb lc ju ld le lf jx lg ob li lj lk oc lm ln lo od lq lr ls lt im bi translated"><em class="it">确保subdir-heroku-buildpack位于其他构建包的顶部。</em></p></blockquote><p id="416e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在转到<code class="fe nk nl nm nn b">Config</code>变量设置，添加下面的<code class="fe nk nl nm nn b">Config</code>变量。键是<code class="fe nk nl nm nn b">PROJECT_PATH</code>，值是你的应用程序的路径。在我的例子中，Flask应用程序位于一个名为“API”的文件夹中，所以我的配置变量如下所示</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/f89b0b09d776eecc281af9225b8241bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gSTW7_k_3pAOuc9n.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">配置变量的屏幕截图</p></figure><p id="3f93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，向上滚动并转到“部署”部分。单击“部署分支”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/668a5dad9f55f24aa2818e0dba2098ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bi1dzr35tyP7jl99.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">分行截图</p></figure><blockquote class="nx ny nz"><p id="faac" class="ky kz oa la b lb lc ju ld le lf jx lg ob li lj lk oc lm ln lo od lq lr ls lt im bi translated">你已经准备好了。每当你对你的分支进行任何修改，heroku将自动重新部署你在T10】中指定的应用</p></blockquote><h1 id="5722" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">测试</h1><p id="c850" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在我的例子中，我让Heroku跟踪两个项目中的主分支。因此，每当我将任何更改推送到主分支时，它都会自动构建并重新部署React应用程序和Flask API。我用<a class="ae nf" href="https://github.com/rahulbanerjee26/Heroku_Deploy/commit/2713a4981d9b75b25014bfe2bca36d7d367d7251" rel="noopener ugc nofollow" target="_blank">这个commit </a>测试了它，它自动重新部署了<a class="ae nf" href="https://front-end1212.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> React App </a>和<a class="ae nf" href="https://api1212.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> Flask API </a>。</p><h1 id="960c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">结论</h1><p id="62ab" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我希望这篇文章能让你免去我花几个小时设置Heroku在同一个repo中自动部署多个应用程序的麻烦。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="8802" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="oa">这个故事最初发表于</em><a class="ae nf" href="https://www.realpythonproject.com/how-to-setup-automated-deployment-for-multiple-apps-under-a-single-github-repository-in-heroku/" rel="noopener ugc nofollow" target="_blank"><em class="oa">realpythonproject.com</em></a><em class="oa">。</em></p></div></div>    
</body>
</html>