<html>
<head>
<title>How to Retrieve Price Data in Smart Contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在智能合约中检索价格数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-retrieve-price-data-in-smart-contracts-9e0467dfd280?source=collection_archive---------2-----------------------#2020-07-30">https://betterprogramming.pub/how-to-retrieve-price-data-in-smart-contracts-9e0467dfd280?source=collection_archive---------2-----------------------#2020-07-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="06a7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在单个函数调用中获取加密价格</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/020b869cb94fe6b9da9e7770144994f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VCjJyxzcK6j_YjuXFqWPMA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">米洛斯拉夫·hamřík在<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3990806" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上的照片。</p></figure><p id="ca23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在过去的一个月里，链接令牌的价格几乎翻了一番，在很短的时间内从稳定的4美元涨到了惊人的8美元。这在很大程度上要归功于Chainlink Oracle network，它提供了一个平台，可以从智能合约中调用<a class="ae ky" href="https://medium.com/better-programming/how-to-call-apis-from-ethereum-smart-contracts-e2f1500198c7" rel="noopener">任何外部API，以及一个</a><a class="ae ky" href="https://medium.com/coinmonks/how-to-generate-random-numbers-on-ethereum-using-vrf-8250839dd9e2" rel="noopener">可验证的随机函数</a>以确保可靠性。</p><p id="df93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这两个产品都是非常强大的工具，但是它们遵循<em class="lv">请求&amp;接收</em>周期，这不是瞬时的。这意味着任何使用它们的智能契约都必须在一个事务中请求数据，然后在另一个事务中等待接收响应。</p><p id="e52c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很好，<strong class="lb iu"> </strong>但是有一种更快的方法可以在单个事务中检索链外数据。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4a32" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">对速度的需求</h1><p id="d5df" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在撰写本文时，<a class="ae ky" href="https://defipulse.com/" rel="noopener ugc nofollow" target="_blank"> DeFi生态系统锁定的价值超过30亿美元</a>。但是对于我们这些不熟悉经济学的人来说，“锁定价值”意味着什么呢？</p><p id="1950" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本质上，它代表了其他资产的抵押品，如稳定的硬币。任何分散稳定的硬币都有其他资产支持，所以如果有人想以公允价值赎回硬币，他们可以这么做。</p><h2 id="02aa" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">如何印钞票</h2><p id="e91d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">让我们看一下SAI的例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/43fbe8769b96f4eb93b0728f7112a3b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/0*oCJuQiwb2XxAFYag.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">日本短剑</p></figure><p id="8fd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SAI由ETH支持。这意味着如果你想获得SAI，你需要将ETH存放到MakerDAO协议中。一旦存款，协议将根据ETH的价格和您存款的金额，为您铸造等值的SAI。</p><p id="67d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如:如果当时ETH值200美元，而您存入2个ETH，则协议会生成400 SAI。</p><p id="37d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">存款1 ETH，铸币200 SAI。</p><p id="a1ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果ETH的价格发生变化，铸造的SAI数量也会发生变化。因此，如果ETH值100美元，而你存了1 ETH，它只能铸造100 SAI。</p><p id="bfa3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于协议取决于ETH的价格，因此必须有可靠的数据源来实时跟踪价格，以保持系统的平衡。<em class="lv">请求和接收</em>周期可能没问题，但是因为它不在单个交易中检索价格，所以它不能成为铸造函数的一部分。它要么必须由一些其他功能来跟踪(这意味着当铸造SAI时，协议对ETH价格的了解可能稍微过时)，要么铸造过程需要跨越多个交易(这意味着存款人必须等待接收他们的SAI)。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0e6f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">填补空白</h1><p id="1736" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">幸运的是，有一个解决方案，它以<a class="ae ky" href="https://docs.chain.link/docs/using-chainlink-reference-contracts" rel="noopener ugc nofollow" target="_blank"> Chainlink Price Feeds </a>的形式出现。</p><p id="4af7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">价格提要是包含价格数据的链上资源，这些数据是从多个独立的来源汇总的。它们快速、可靠、在单个事务中执行，并且比迄今为止讨论的任何其他Oracle解决方案都更容易实现。</p><h2 id="62a1" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">如何使用价格源</h2><p id="3df6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这些提要是专门为DeFi空间策划的，当前可用的所有提要的完整列表可以在<a class="ae ky" href="https://docs.chain.link/docs/reference-contracts" rel="noopener ugc nofollow" target="_blank"> Chainlink开发者文档</a>中找到。</p><p id="d991" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于本例，我们将使用Kovan testnet上的ETH/USD价格源:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PriceConsumer.sol</p></figure><p id="8bfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们浏览一下这段代码:</p><ul class=""><li id="21b7" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">第3行:Chainlink在其契约库中提供了许多有用的契约，我们正在导入<code class="fe ny nz oa ob b">AggregatorInterface</code>。这个契约定义了一些函数，使我们的契约能够向它请求信息。<strong class="lb iu">(注:截止2020年8月，</strong> <code class="fe ny nz oa ob b"><strong class="lb iu">AggregatorInterface</strong></code> <strong class="lb iu">已弃用。请使用</strong> <code class="fe ny nz oa ob b"><a class="ae ky" href="https://docs.chain.link/docs/get-the-latest-price" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">AggregatorV3Interface</strong></a></code> <strong class="lb iu">。)</strong></li><li id="57ec" class="np nq it lb b lc oc lf od li oe lm of lq og lu nu nv nw nx bi translated">第14-16行:在构造函数中，我们用一个新的<code class="fe ny nz oa ob b">AggregatorInterface</code>和我们想要使用的提要地址初始化我们的<code class="fe ny nz oa ob b">priceFeed</code>状态变量。在这种情况下，它是Kovan testnet上的ETH/USD提要。</li><li id="6da0" class="np nq it lb b lc oc lf od li oe lm of lq og lu nu nv nw nx bi translated">第21-23行:这里，我们通过调用<code class="fe ny nz oa ob b">priceFeed.latestAnswer()</code>获得最新价格。它返回从多个来源汇总的最新价格。</li><li id="0dfa" class="np nq it lb b lc oc lf od li oe lm of lq og lu nu nv nw nx bi translated">第28-30行:我们还可以获得聚合器中最后一次更新价格的时间戳。</li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2114" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="edbd" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Chainlink价格馈送非常容易使用，在我看来，目前在以太坊空间中没有得到充分利用。它们提供了您的智能合约可以访问的最快、最简单、最可靠的价格数据。</p><p id="0970" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从官方Chainlink博客文章中了解更多信息:</p><div class="oh oi gp gr oj ok"><a href="https://blog.chain.link/fetch-current-crypto-price-data-solidity/" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">获取以太坊、比特币和加密的价格</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">将价格数据提取到Solidity智能合约中是DeFi应用程序的常见要求。要获得当前…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">博客.连锁.链接</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="d72b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">进一步阅读</h1><p id="99a1" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你对区块链开发感兴趣，我会写一些教程、演练、提示以及如何开始和建立投资组合的技巧。查看以下资源:</p><div class="oh oi gp gr oj ok"><a href="https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">Medium上最好的区块链开发资源</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">学习区块链、以太坊和DApp开发的资源列表</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">medium.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy ks ok"/></div></div></a></div></div></div>    
</body>
</html>