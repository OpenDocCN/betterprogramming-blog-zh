<html>
<head>
<title>Jetpack Compose: How to Build a Messaging App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jetpack Compose:如何构建消息应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/jetpack-compose-how-to-build-a-messaging-app-e2cdc828c00f?source=collection_archive---------5-----------------------#2020-06-15">https://betterprogramming.pub/jetpack-compose-how-to-build-a-messaging-app-e2cdc828c00f?source=collection_archive---------5-----------------------#2020-06-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e8a1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何创建没有任何XML文件的用户界面</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bba7dcc6c2233373f9479c2e87d9da32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KkLUDmrxrwFrW9gOzED8sQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><h1 id="c60c" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">介绍</h1><blockquote class="lq lr ls"><p id="74b8" class="lt lu lv lw b lx ly ju lz ma mb jx mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">“Jetpack Compose是一个用于构建原生Android UI的现代工具包。Jetpack Compose以更少的代码、强大的工具和直观的Kotlin APIs简化并加速了Android上的UI开发。— <a class="ae mq" href="https://developer.android.com/jetpack/compose/tutorial" rel="noopener ugc nofollow" target="_blank">安卓开发者</a></p></blockquote><p id="139a" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">自从我们上次讨论Jetpack Compose以来，已经有了一些有趣的发展。4月29日发布了Compose 0.1.0-dev010和Compose UI 0.1.0-dev10。由于它们仍处于开发阶段，很难理解错误，所以请确保您使用的是最新版本，以获得流畅的体验。</p><p id="2170" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">在我过去的两篇关于Compose的文章中，我主要关注基础知识和Compose是如何发展的。在本文中，我们将使用Kotlin和Compose构建一个消息应用程序，通过它我们将学习如何使用像<code class="fe mu mv mw mx b">adapterview</code>、<code class="fe mu mv mw mx b">image</code>、<code class="fe mu mv mw mx b">Modifiers</code>等组件。</p><p id="586d" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">接下来，我假设您熟悉Jetpack Compose的基础知识。如果没有，参考<a class="ae mq" href="https://medium.com/better-programming/jetpack-compose-a-new-and-simple-way-to-create-material-ui-in-android-f49c6fcb448b" rel="noopener">这篇文章</a>。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="7c12" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">我们想要建立什么？</h1><p id="b055" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">作为Android用户和开发者，我们非常熟悉原生消息应用。在本文中，我们将探讨如何使用Jetpack Compose构建聊天列表屏幕和对话屏幕。为了清楚起见，请看以下内容。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="9ad8" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">应用模型</h1><p id="f072" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">在我们开始构建ui之前，让我们先来看看消息和对话列表的模型类:分别是<code class="fe mu mv mw mx b"> Message</code>和<code class="fe mu mv mw mx b">ChatMessage</code>。两者都是数据类。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用模型</p></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="7ffd" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">主屏幕</h1><p id="2bba" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">在主屏幕上，我们有一个带有标题的顶栏和两个可操作的菜单项:搜索和更多选项。然后我们有消息列表，最后是FAB图标。请参见下图，鸟瞰一下设计主屏幕的Compose UI。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/4cf06fca9ac62e59c646da5f2712285c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GX1rwKG71pPCUX-7cwA5mw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在顶层为主屏幕编写用户界面</p></figure><p id="a771" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">现在，我们来看一下每一部分。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="c88e" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">顶栏和FAB设计</h1><h2 id="e9e3" class="ns kz it bd la nt nu dn le nv nw dp li mr nx ny lk ms nz oa lm mt ob oc lo od bi translated">脚手架</h2><p id="568e" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">脚手架实现了基本的材料设计视觉布局结构。该组件提供了API，通过确保适当的布局策略将UI组件结合在一起。</p><h2 id="5f50" class="ns kz it bd la nt nu dn le nv nw dp li mr nx ny lk ms nz oa lm mt ob oc lo od bi translated">TopAppBar</h2><p id="ed95" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated"><code class="fe mu mv mw mx b">topAppBar</code>是脚手架中的一个参数，用来显示屏幕的一个顶栏。对于这个参数，我们必须传递一个可组合的函数<code class="fe mu mv mw mx b">messagesListTopBar</code>，它具有实际的topbar设计。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">消息列表顶部栏撰写功能</p></figure><p id="18b8" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated"><code class="fe mu mv mw mx b">TopAppBar</code>是一个UI组件，显示与当前屏幕相关的信息，比如标题、动作、搜索和更多选项。它被放置在屏幕的顶部。</p><p id="d5df" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">在这里，我们使用了<code class="fe mu mv mw mx b">tex</code> t组件来显示<code class="fe mu mv mw mx b">TopAppBar</code>的标题，然后使用它的组件来样式化它。<code class="fe mu mv mw mx b">actions</code>是<code class="fe mu mv mw mx b">TopAppBar</code>中的另一个参数，用于显示可操作的项目。最后我们为<code class="fe mu mv mw mx b">TopAppBar</code>设置背景色。</p><h2 id="f07c" class="ns kz it bd la nt nu dn le nv nw dp li mr nx ny lk ms nz oa lm mt ob oc lo od bi translated">修饰语</h2><p id="2875" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated"><code class="fe mu mv mw mx b">Modifier</code>默认为空伴随对象。我们可以使用<code class="fe mu mv mw mx b">Modifier</code>为视图设置动画、填充和其他样式相关的东西。</p><h2 id="2a7c" class="ns kz it bd la nt nu dn le nv nw dp li mr nx ny lk ms nz oa lm mt ob oc lo od bi translated">浮动操作按钮</h2><p id="eb04" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">使用<code class="fe mu mv mw mx b">FloatingActionButton</code> UI组件，我们可以很容易地在UI中实现FAB按钮。使用<code class="fe mu mv mw mx b">onclick</code>和<code class="fe mu mv mw mx b">icon</code>参数，我们可以为FAB按钮设置点击监听器和可绘制资产。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="6dc7" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">这里我们使用了高阶函数来调用FAB和messages项目点击。要了解更多关于Kotlin中高阶函数的特性，请参考本文。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="e0e0" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">邮件列表项目</h1><p id="51bd" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">在消息项中，我们有三个文本，分别表示发送者姓名、消息截图描述和接收时间。所有这三个视图都是使用<code class="fe mu mv mw mx b">Text UI</code>组件设计的。然后我们有发送者图标，它是使用<code class="fe mu mv mw mx b">Icon</code> UI组件设计的。将这些部分集合在一起，我们将有一个可组合的函数，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/8aad660d5d454e6c4afe3fb54cacec9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0JldpaiDT6d02preF4Dg0Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">撰写邮件列表项的用户界面</p></figure><p id="d8f4" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">让我们从发件人图标开始，一个一个地研究它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">邮件列表项中发件人图标的代码</p></figure><p id="3bdd" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">发送者图标是使用<code class="fe mu mv mw mx b">Icon</code>组件设计的，该组件使用<code class="fe mu mv mw mx b">tint</code>绘制<code class="fe mu mv mw mx b">asset</code>。它有三个参数:</p><ul class=""><li id="a24e" class="oe of it lw b lx ly ma mb mr og ms oh mt oi mp oj ok ol om bi translated"><code class="fe mu mv mw mx b">asset</code>:我们可以使用这个属性给图标分配一个矢量资产。</li><li id="279d" class="oe of it lw b lx on ma oo mr op ms oq mt or mp oj ok ol om bi translated"><code class="fe mu mv mw mx b">modifier</code>:用于填充等装饰目的</li><li id="2fc8" class="oe of it lw b lx on ma oo mr op ms oq mt or mp oj ok ol om bi translated"><code class="fe mu mv mw mx b">tint</code>:图标颜色代码</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">发件人姓名代码</p></figure><p id="0cda" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">为了显示发送者姓名，我们使用了<code class="fe mu mv mw mx b">Text</code> UI组件。<code class="fe mu mv mw mx b">style</code>是<code class="fe mu mv mw mx b">text</code>中用来修饰它的属性，类似于XML设计中的<code class="fe mu mv mw mx b">style</code>属性。然后我们有典型的属性，像<code class="fe mu mv mw mx b">overflow</code>、<code class="fe mu mv mw mx b">maxlines</code>，还有更多处理UI的东西。</p><p id="c7e6" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">消息列表项的时间和简短描述也是使用具有相同属性的<code class="fe mu mv mw mx b">Text</code> UI组件实现的。更多细节参见<a class="ae mq" href="https://github.com/SG-K/JetPackComposeMessagesApp" rel="noopener ugc nofollow" target="_blank"> GitHub样本</a>(主分支)。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="8b03" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">消息列表</h1><p id="d51e" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">现在，是时候设计列表了。<code class="fe mu mv mw mx b">AdapterList</code>是Compose中用于设计列表的新UI组件。它有三个参数:</p><ul class=""><li id="b3c1" class="oe of it lw b lx ly ma mb mr og ms oh mt oi mp oj ok ol om bi translated"><code class="fe mu mv mw mx b">data</code>:要显示的项目列表。</li><li id="907e" class="oe of it lw b lx on ma oo mr op ms oq mt or mp oj ok ol om bi translated"><code class="fe mu mv mw mx b">modifier</code>:造型配套对象</li><li id="9ea6" class="oe of it lw b lx on ma oo mr op ms oq mt or mp oj ok ol om bi translated"><code class="fe mu mv mw mx b">ItemCallback</code>:点击列表项实现。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设计消息列表的适配器列表</p></figure><p id="413f" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">至此，我们已经使用Jetpack Compose构建了整个messages应用程序主屏幕。下一步是设计对话屏幕。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="ff70" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">对话屏幕</h1><p id="db3f" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">构建对话屏幕类似于构建主屏幕。我们可以通过改变标题来重用消息列表中的组件，如<code class="fe mu mv mw mx b">TopAppBar</code>。来到对话列表，我们必须使用相同的<code class="fe mu mv mw mx b">adapterlist</code>。唯一的变化是对话列表项的设计。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/56003ede9020c04d7658c0586cc4a5bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGB1RPRzNzLapIOoZWoaPA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">撰写对话屏幕的用户界面</p></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="1115" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">聊天消息列表项目</h1><p id="f514" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">在聊天消息列表项中，我们有一个类似于消息列表项的发送者图标，因此我们可以重用<code class="fe mu mv mw mx b">SenderIcon</code>可组合函数。我们可以从聊天消息项目中学到的新东西是如何创建一个自定义颜色和圆角半径的背景。</p><p id="7531" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">在顶层，我们有一个可点击的组件来调用列表项上的点击。然后我们有<code class="fe mu mv mw mx b">Row</code>来水平对齐视图。我们使用了一个新的属性<code class="fe mu mv mw mx b">verticalGravity</code>，将用户图标与消息的底部对齐。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="dd87" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">使用<code class="fe mu mv mw mx b">Modifier</code>，我们创建了16dp的填充和带有圆角半径和自定义颜色的背景——这是<code class="fe mu mv mw mx b">Modifier</code>的众多强大功能之一。然后再来聊天消息，没什么新东西可学；它只是一个带有一些填充和文本属性的<code class="fe mu mv mw mx b">Text</code>组件。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="137a" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">结论</h1><p id="ee6a" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">今天，我们已经学习了许多与Jetpack Compose相关的东西，如修饰符、重力、<code class="fe mu mv mw mx b">Icon</code>、可操作项、<code class="fe mu mv mw mx b">Adapterlists</code>、如何重用编写函数等等。您可以在上面提到的GitHub链接上随意使用这个示例。在我下一篇关于Compose的文章中，我们将学习如何使用Compose构建服务器驱动的UI。</p><p id="28ca" class="pw-post-body-paragraph lt lu it lw b lx ly ju lz ma mb jx mc mr me mf mg ms mi mj mk mt mm mn mo mp im bi translated">希望你学到有用的东西，感谢阅读。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="f193" class="ky kz it bd la lb nf ld le lf ng lh li jz nh ka lk kc ni kd lm kf nj kg lo lp bi translated">资源</h1><p id="025e" class="pw-post-body-paragraph lt lu it lw b lx nk ju lz ma nl jx mc mr nm mf mg ms nn mj mk mt no mn mo mp im bi translated">要了解关于JetPack Compose和服务器驱动UI的更多信息，请查看以下文章。</p><ul class=""><li id="89e3" class="oe of it lw b lx ly ma mb mr og ms oh mt oi mp oj ok ol om bi translated"><a class="ae mq" href="https://medium.com/better-programming/exploring-server-driven-ui-cf67b3da919" rel="noopener">“探索服务器驱动的用户界面”</a></li><li id="9ea8" class="oe of it lw b lx on ma oo mr op ms oq mt or mp oj ok ol om bi translated"><a class="ae mq" href="https://medium.com/better-programming/jetpack-compose-a-new-and-simple-way-to-create-material-ui-in-android-f49c6fcb448b" rel="noopener">“Jetpack Compose——一种在Android中创建素材UI的简单新方法”</a></li><li id="37f4" class="oe of it lw b lx on ma oo mr op ms oq mt or mp oj ok ol om bi translated"><a class="ae mq" href="https://medium.com/better-programming/deep-dive-into-jetpack-compose-b09713760019" rel="noopener">“深入研究Jetpack Compose”</a></li><li id="3122" class="oe of it lw b lx on ma oo mr op ms oq mt or mp oj ok ol om bi translated"><a class="ae mq" href="https://medium.com/better-programming/interesting-updates-from-jetpack-compose-48b79e7d2d8a" rel="noopener">“来自Jetpack Compose的有趣更新”</a></li></ul></div></div>    
</body>
</html>