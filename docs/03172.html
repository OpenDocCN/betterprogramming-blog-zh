<html>
<head>
<title>How to Build a Custom Classifier Android App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建自定义分类器Android应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-a-custom-classifier-android-app-452b68a89150?source=collection_archive---------5-----------------------#2020-01-26">https://betterprogramming.pub/how-to-build-a-custom-classifier-android-app-452b68a89150?source=collection_archive---------5-----------------------#2020-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="63c9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用颤振和自动视觉边缘</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e365b1e577861389cc7cb8e7e1c12b56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0OxdITJL-QImESttxBZmAg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查尔斯在<a class="ae ky" href="https://unsplash.com/s/photos/machine-learning?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9a3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，你想建立一个分类器，而且你想快速完成。也许你有一个分类器可能有用的爱好，或者你已经有了一组图像，你想把它们变成一个应用程序，或者你只是想尝试构建一些新的东西——有许多不同的原因。</p><p id="d7fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章将指导你使用谷歌的<a class="ae ky" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank"> Flutter </a> <strong class="lb iu"> </strong>和<a class="ae ky" href="https://firebase.google.com/docs/ml-kit/automl-image-labeling" rel="noopener ugc nofollow" target="_blank"> AutoML Vision Edge </a>服务为Android设备构建一个分类器应用程序。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="219a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么颤动？</h1><p id="c3a6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">用自己的<a class="ae ky" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank">话说</a>:</p><blockquote class="mz"><p id="f5d6" class="na nb it bd nc nd ne nf ng nh ni lu dk translated">“Flutter是Google的UI工具包，用于从单个代码库为移动、web和桌面构建漂亮的本地编译应用程序。”</p></blockquote><p id="da60" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">Flutter使用的是<a class="ae ky" href="https://dart.dev/" rel="noopener ugc nofollow" target="_blank"> Dart </a>，这是一种快速、直观、有些罕见的语言。然而，作为一个更习惯于Java而不是JavaScript的人，我感觉就像在家里一样，并且能够很快提高。</p><p id="b2dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了它的热重载特性，迭代UI变得轻而易举。这个快速发展的社区充满了乐于助人的人和资源。</p><p id="8ee4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想在尽可能多的平台上尽可能快地推出你的应用，包括移动和PWA，Flutter是正确的选择。Flutter web正在迅速获得牵引力，谷歌似乎致力于定期改进和更新它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="63ce" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么选择AutoML Vision Edge？</h1><p id="cbcc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">谷歌的AutoML Vision Edge服务可以通过Firebase访问，有很多好处。它允许你创建没有任何编码的分类ML模型。</p><p id="d10e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你所需要做的就是提供训练数据，然后谷歌将在此基础上训练一个模型。您可以从模型的三个优化中选择一个:延迟、准确性或这两者之间的平衡。</p><p id="0575" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以指定模型应该训练的小时数，它会立即开始工作。请注意，训练可能比选择的小时数更快完成，因为Google将训练时间分布在多台机器上。</p><p id="bba4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">训练完成后，您可以下载模型，发布它(使它可供您的应用程序使用)，查看平均精度等评估统计数据，并测试它。</p><p id="3809" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这项服务的另一个好处在于，你的新机型可以直接在edge <strong class="lb iu"> </strong>设备上运行。这有两个主要优点:</p><ul class=""><li id="8de0" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">您的应用程序不需要互联网连接来进行分类。</li><li id="b5e5" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">分类非常快(不到0.1秒)。</li></ul><p id="9da4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两点结合起来，就可以让你的app随时随地进行分类！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bdb4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据收集</h1><p id="0eb1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如何获取训练数据因您希望构建的分类器类型而异，这超出了本文的范围。</p><p id="008b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也许你已经有了一个带标签的数据集，或者你已经建立了一个自动下载和标记图像的web scraper。无论如何，为了让你的模型相当准确，你需要每个标签至少有100张图片。少于这个数字，你的模型就有不可靠的风险。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="14cb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">构建用户界面</h1><p id="f880" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有几种方法可以将这个模型集成到你的应用程序中(下面会详细介绍)。因为在这篇文章中，你的目标是构建一个Android应用程序，所以我们将使用一些原生Java代码。</p><p id="f78c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让Flutter与本机组件对话，您需要在有状态分类小部件中指定一个通道和一些方法名。将以下内容添加到您的<code class="fe oc od oe of b">.dart</code>文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">做一些常数</p></figure><p id="2f73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您需要实现一种方法，让用户选择一个图像来提供给您的模型。</p><p id="bf9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现这一点，一个很好的选择是<a class="ae ky" href="https://pub.dev/packages/image_picker" rel="noopener ugc nofollow" target="_blank">抖动图像拾取器</a>包。将它添加到您的<code class="fe oc od oe of b">pubspec.yaml</code>文件的<code class="fe oc od oe of b">dependencies</code>部分，就像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加图像拾取器依赖项</p></figure><p id="63c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记得要<code class="fe oc od oe of b">flutter pub get</code>。接下来，实现图像拾取器的异步<code class="fe oc od oe of b">pickImage()</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户可以拍摄或选择一张图片</p></figure><p id="0077" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，这些方法可以注册为您创建的按钮的处理程序。如何向用户呈现这些选项取决于您。</p><p id="139f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您需要将图像文件传递给模型，该模型在您的本地组件中运行。为此，请使用前面定义的通道和方法名称:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将选择的图像发送到本机组件</p></figure><p id="aeee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在对图像进行分类时，您可能希望显示一个微调器。但是，在大多数情况下，分类执行得如此之快，以至于微调器不可见。</p><p id="1f21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过，根据您的实现，该应用程序可能会使用远程模型，或者检查本地模型的更新并下载最新版本，如果您的版本已经过时。</p><p id="c45c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，旋转器可能有助于覆盖这段短暂的时间(2到4秒，取决于设备的互联网连接和模型的大小)。</p><p id="be73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，当模型完成对图像的分类时，需要一个回调，所以接下来添加这个回调。为了方便起见，这个例子存储结果是一个<code class="fe oc od oe of b">SplayTreeMap</code>，将结果标签映射到以降序排序的置信度值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">处理分类结果</p></figure><p id="d31b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过将结果存储在一个排序的地图中，您可以很容易地用前三个结果更新您的UI:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">仅显示前3项</p></figure><p id="4d43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些基本的UI就这样了！接下来，您需要整合模型。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a805" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">整合模型</h1><p id="96e1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当您下载您的模型时，您应该得到三个文件:</p><ul class=""><li id="4240" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated"><code class="fe oc od oe of b">dict.txt</code> —列出模型的标签。</li><li id="b9ee" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><code class="fe oc od oe of b">manifest.json</code> —包含一些元数据。</li><li id="2194" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><code class="fe oc od oe of b">model.tflite</code>——是实际的模型。</li></ul><p id="0e6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要把它们放在一个<code class="fe oc od oe of b">android/add/assets</code>子目录中的某个地方，比如<code class="fe oc od oe of b">&lt;PROJECT_ROOT&gt;/android/app/assets/ml-model</code>。</p><p id="178c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关如何配置项目级和应用级<code class="fe oc od oe of b">build.gradle</code>文件的更详细概述，请查看<a class="ae ky" href="https://firebase.google.com/docs/ml-kit/android/label-images-with-automl" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="f199" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦设置完成，打开<code class="fe oc od oe of b">android/app/src/main/java/your/package/name</code>中的<code class="fe oc od oe of b">MainActivity.java</code>。</p><p id="29cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于模型的加载，您有一大堆选项可以选择，比如什么时候使用本地模型还是托管模型，什么时候更新本地模型，等等。</p><p id="b487" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在任何情况下，您都需要在您的<code class="fe oc od oe of b">.dart</code>文件中定义的通道和方法名称，以及您的模型名称。这些必须完全匹配。</p><p id="421e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能还希望定义一个最小置信度阈值，低于该阈值则不会返回任何结果，这由您来定义本机代码应该承担多少责任:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">再做同样的常数，加上一些其他的</p></figure><p id="47d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你读到这篇文章的时候，下面的具体实现可能已经改变了，因为Flutter正在不断改进它与原生平台的集成。</p><p id="4838" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，在编写本文时，由Dart代码调用的函数将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">获取传递的图像数据</p></figure><p id="7235" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，初始化Firebase:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">初始化Firebase</p></figure><p id="3d4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，您可以使用远程模型，使用本地模型，或者检查本地模型是否需要更新。</p><p id="342c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你想让这个初始化部分变得多复杂取决于你自己。为了简洁起见，这个例子只使用了之前添加的本地模型，它也需要初始化:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">建立模型</p></figure><p id="fcaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您需要准备您的图像:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">准备图像</p></figure><p id="574a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让模型对图像进行分类，并将结果返回给Flutter:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将图像分类</p></figure><p id="ebb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！您现在应该有一个功能性的Flutter应用程序，它可以拍摄或选择图像，使用本地模型对其进行分类，并显示结果。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7aaf" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="de51" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Flutter和AutoML Vision Edge使您能够在非常短的时间内制作快速、准确(取决于您的训练数据)且独立于互联网连接的分类器应用程序，而无需了解任何ML理论或编写任何ML代码。</p><p id="5cae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以将节省下来的所有时间用于构建额外的功能和令人惊叹的UI。编码快乐！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dd7a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">资源</h1><ul class=""><li id="639f" class="no np it lb b lc mu lf mv li oi lm oj lq ok lu nt nu nv nw bi translated"><a class="ae ky" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank">颤动</a></li><li id="5eaa" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><a class="ae ky" href="https://pub.dev/packages/image_picker" rel="noopener ugc nofollow" target="_blank">颤动图像拾取器</a></li><li id="1f10" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">谷歌<a class="ae ky" href="https://firebase.google.com/docs/ml-kit/automl-image-labeling" rel="noopener ugc nofollow" target="_blank"> AutoML视觉边缘</a></li></ul></div></div>    
</body>
</html>