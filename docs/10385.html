<html>
<head>
<title>Turn Raw Data Into Objects With the JavaScript Constructor Pattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript构造器模式将原始数据转换成对象</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/turn-raw-data-into-objects-with-the-javascript-constructor-pattern-dbb84fef2049?source=collection_archive---------16-----------------------#2022-01-03">https://betterprogramming.pub/turn-raw-data-into-objects-with-the-javascript-constructor-pattern-dbb84fef2049?source=collection_archive---------16-----------------------#2022-01-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6161" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用JavaScript实现你的第一个设计模式——构造器模式</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e68530463c56122ade3217a46dad2697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A60IUK0QPmjl5klc"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Elena Mozhvilo 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5990" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2021年，我为一家名为OpenClassrooms的法国网校写了几门课程。其中，一个致力于用JavaScript设计模式。</p><p id="4c5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在写它的时候，我得到了很多乐趣。这是一个非常有趣的话题，尽管你可以在网上和书中找到和阅读很多资料，但大多数时候，这些资源要么已经过时，要么没有给出具体的例子和问题解决方案。</p><p id="e436" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，<em class="ls">学习JavaScript设计模式:JavaScript和jQuery开发人员指南</em>是一本非常有趣的书，可以帮助学习不同种类的设计模式。然而，这似乎有点过时了:它谈到了jQuery，你只会看到ES5的JavaScript代码。我仍然认为你应该读这本书，如果你想的话，但是我不认为这是一本你应该买的书。</p><p id="7908" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为什么我不让你去上我写的课程？首先，因为它是法语的，目前没有翻译计划。我还想更进一步，介绍一下我在课程中没有介绍的设计模式。</p><p id="42a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始之前还有最后一件事:您应该对JavaScript和面向对象编程有所了解。我会尽可能的完整，但是我不会回到JavaScript的基础。也就是说，也许有一天，我会写一些关于基础的文章，特别是关于JavaScript中原型是如何工作的。现在，我们可以开始了！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="59a7" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">你曾经开发过不断发展的API吗？</h1><p id="938b" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">我曾经为一家初创公司工作，该公司为当地企业(如餐馆或食品卡车)创建收银机。我的任务之一是创建一个移动应用程序，我们可以在其中显示活动信息。想想每天、每周和每月的客户数量，当前的营业额以及它们与去年的不同之处，等等..</p><p id="0baa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我开始开发这个应用程序时，我将要处理的数据还不可用:API还没有准备好。所以我做了一些非常平常的事情:我将数据模拟成一个普通的JSON文件，并伪造HTTP调用。这样我就可以继续在应用程序上工作，一旦数据准备好了，我只需要修改我的HTTP调用，一切就都正常了。</p><p id="0734" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个计划中，它是完美的，如果让我再做一次，我肯定会做同样的事情。然而，有一件事我没有考虑到:数据格式。当我收到来自API的数据的第一个版本时，我大吃一惊:它与我在原始JSON文件中编写的数据完全不同。所以，我重写了所有使用这些数据的代码部分，这花了我将近一周的时间。然后，数据格式又一次改变了。为什么？因为API仍然处于alpha开发模式，后端工程师正在做一些突破性的改变。</p><p id="e57d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是时候看看一个项目的具体例子并开始编码了！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="41fd" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">从API获取用户数据，然后格式化并显示它</h1><p id="0078" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">首先，<a class="ae kv" href="https://github.com/tdimnet/the-javascript-constructor-pattern" rel="noopener ugc nofollow" target="_blank">转到这个GitHub库</a>并克隆它。它包含一个小的React应用程序，显示10名雇员的列表。每个员工都有名字、姓氏、电子邮件、照片和注册日期。当您启动React应用程序时，它获取JSON文件中的雇员数据。此文件位于公共文件夹:<code class="fe mx my mz na b">public/users.json</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/b404b6a36ba8edea279064a979ce013e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zb91skHAtJYk4v37J1dR1Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">该项目显示10名员工的列表</p></figure><p id="b51a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个React应用程序的基础设施非常标准。有三个主要文件夹:</p><ul class=""><li id="d2ad" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated"><code class="fe mx my mz na b">components</code>文件夹包含传统组件，例如日期和电子邮件组件，以及布局组件，例如标题和主包装器。</li><li id="1a89" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><code class="fe mx my mz na b">pages</code>文件夹包含了Home组件。在一个更大的项目中，我们将有许多页面组件。</li><li id="814e" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><code class="fe mx my mz na b">services</code>文件夹向JSON模拟文件和<code class="fe mx my mz na b">randomuser</code> API发出HTTP请求。</li><li id="7c0c" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><code class="fe mx my mz na b">App.js</code>文件使用了<code class="fe mx my mz na b">pages/Home</code>组件和React查询设置。</li></ul><p id="3622" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">React-query用于该项目的数据同步部分。这个库的灵感来自于<code class="fe mx my mz na b">react-apollo</code>库(我们在GraphQL APIs中使用它们),它允许你以声明的方式创建HTTP请求。我不认为文档总是清晰的，但它确实是方便的和可读的。</p><p id="908f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要使它工作，您必须用<code class="fe mx my mz na b">QueryClientProvider</code>组件包装整个React应用程序:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="79d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，您可以使用<code class="fe mx my mz na b">useQuery</code>挂钩，就像这里的<code class="fe mx my mz na b">pages/Home</code>组件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9078" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦承诺得到解决，数据就会显示在<code class="fe mx my mz na b">UserCard</code>组件中。该组件代表自己使用其他几个组件。例如，它用<code class="fe mx my mz na b">Image</code>组件显示用户照片，用<code class="fe mx my mz na b">Name</code>组件显示用户名(名字和姓氏),用<code class="fe mx my mz na b">Email</code>组件显示用户电子邮件地址。我们使用钻孔道具将数据从顶部传递到底部组件</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="6788" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目前，我们的应用程序使用public文件夹中包含的JSON文件，它工作得很好。但是现在是时候让事情变得复杂一点了:我们将使用<a class="ae kv" href="https://randomuser.me/" rel="noopener ugc nofollow" target="_blank">随机用户生成器API </a>来代替JSON文件。将<code class="fe mx my mz na b">services/Api/index.js</code>文件中get函数内的<code class="fe mx my mz na b">getMockData</code>更改为<code class="fe mx my mz na b">getApiData</code>并刷新应用程序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="12f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用程序现在坏了，如果你想让它工作，你需要改变所有的道具。在一页的应用程序中，这可能是可以接受的，你可以这样做，但是想象一下你需要在十页或二十页的应用程序中这样做:这一点都不好玩。你将什么也学不到，而且你可能会添加一些错误。这就是构造器模式派上用场的地方。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="cdc8" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">用构造器模式为我们的用户数据创建一个模型</h1><p id="66b4" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">构造器模式通常是我向初级开发人员介绍的第一个设计模式。它可以直接应用，并且不太依赖抽象:这是对设计模式的一个很好的介绍。很好理解，前端就可以做，也很好用。</p><p id="a50a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我第一次听说它是在我学习Java的时候，然后是Php。如果您也熟悉这些语言，您可能也已经了解了这个概念。波乔或POPO这个名字对你有什么意义吗？POJO指的是普通老式Java对象和POPO普通老式Php对象。我们有时也称它们为实体。大多数时候，我们可以用它们来封装和存储数据。</p><p id="6a16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是POPO的一个示例，其中界面对于创建对象的平面图非常有用:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="df57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在JavaScript中，事情有时与其他编程语言不同。这是因为JavaScript是一种原型面向对象语言，而不是基于类的语言，也因为JavaScript不是一种完全面向对象的语言。例如，枚举和接口在JavaScript中并不存在。我们可以通过使用<code class="fe mx my mz na b">Object.freeze</code>来模拟枚举，但是这与使用<code class="fe mx my mz na b">enum</code>关键字是不同的。</p><p id="a42b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到构造器模式本身:创建一个有两种选择:用函数或者用类/原型。关键字class和prototype可以互换使用，因为当您使用class关键字时，在后面，您会创建一个原型。</p><p id="d814" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个类:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="ef53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9edb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大多数时候，我更喜欢使用class关键字:我认为它更容易阅读和理解。仔细观察，我们已经知道了类的getters和setters是什么。您可以随意使用它们中的任何一个，但是在本文的其余部分，我将使用类版本。</p><p id="3b80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我最喜欢构造器模式的一点是它能够存储原始数据和解析数据。例如，假设您从一个API收到一个时间戳日期，您需要以两种版本显示它:“YYYY-MM-DD”和“DD-MM-YYYY”。下面是如何使用构造器模式的方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="6d83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顺便说一句，构造器模式并不局限于格式化对象:您可以将它用于您可能必须做的所有对象创建。例如，许多jQuery效果使用构造函数模式。</p><p id="22a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们开始实现解决方案之前，要知道这种模式的主要缺点:它可能会消耗内存。尽管我们现在的电脑和手机有大量的内存，但记住我们的软件和应用程序需要优化是很重要的。我建议你只在需要的时候创建构造器模式。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="f741" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">从模拟数据转换到API数据，没有任何麻烦</h1><p id="8605" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">您现在可以将当前分支更改为<code class="fe mx my mz na b">with-constructor-pattern</code>分支。这个分支包含两个构造器模式:<code class="fe mx my mz na b">src/models/MockedUser.js</code>和<code class="fe mx my mz na b">src/models/ApiUser.js</code>。第一个使用硬编码的JSON数据，第二个使用来自<a class="ae kv" href="https://randomuser.me/" rel="noopener ugc nofollow" target="_blank">随机用户生成器API </a>的数据。显示的数据目前来自JSON文件。</p><p id="7061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是<code class="fe mx my mz na b">MockedUser</code>物体的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="c241" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个简单的JavaScript类，包含用户所需的所有属性:我们有一封电子邮件、一张照片和一个注册日期。现在，我们不再使用原始的JSON数据，而是在代码中处处使用这个模板。它给了我们唯一的真理来源。如果我们想要添加一个新的属性，或者如果数据发生变化，例如，上次登录，我们可以在这里添加或更改它。</p><p id="5484" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管有这两个新对象，代码中唯一的变化是在<code class="fe mx my mz na b">src/pages/Home/index.js</code>中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="969c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在使用存储在<code class="fe mx my mz na b">MockedUser</code>对象中的数据，而不是使用原始的JSON数据。现在假设我们想要使用来自<code class="fe mx my mz na b">RandomUser</code> Api的数据。我们只需要做两个改变。首先，改变<code class="fe mx my mz na b">src/services/Api/index.js</code>中的get函数。我们现在将使用真实数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="ae17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后用<code class="fe mx my mz na b">ApiUser</code>构造函数替换<code class="fe mx my mz na b">MockedUser</code>构造函数，并重新加载浏览器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="56f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只做了两处修改，现在您使用API数据而不是JSON数据，项目仍然在运行！此外，您还知道用户数据需要什么属性，并且可以非常容易地添加新属性或修改现有属性！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="1999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你喜欢这篇关于JavaScript设计模式的第一篇文章。如果这是你第一次读它，我很高兴成为你的向导。下次我们来看看工厂的模式！</p><p id="9d2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你有任何问题，请随意提问。下次见！</p></div></div>    
</body>
</html>