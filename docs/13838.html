<html>
<head>
<title>How to Create a Public Notion Integration Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python创建公共概念集成</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-public-notion-integration-70af2e8921b9?source=collection_archive---------3-----------------------#2022-10-02">https://betterprogramming.pub/how-to-create-a-public-notion-integration-70af2e8921b9?source=collection_archive---------3-----------------------#2022-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0ebb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">努力创建公共概念集成并访问其他用户的概念数据库？这是一个Python实现</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d22d9a0b398a1c3a09b6cd49575d9325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTIkwPInulbcYqG0mlYBYQ.png"/></div></div></figure><p id="606a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过此演练，您将能够对用户进行身份验证，获取他们的访问令牌，并将数据添加到他们与您的公共概念集成共享的数据库中。</p><p id="5293" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是我们将使用的:</p><ol class=""><li id="d4b9" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">计算机编程语言</li><li id="94d1" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">概念API</li></ol></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="502e" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">步伐</h1><ol class=""><li id="413c" class="ln lo iq kt b ku na kx nb la nc le nd li ne lm ls lt lu lv bi translated">创建公共概念整合</li><li id="d0ca" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">创建要共享的表</li><li id="c2ba" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">创建概念授权2.0授权流</li><li id="57dc" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">向授权表中添加数据</li></ol><p id="d640" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们走吧。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="f884" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">1.创建公共概念整合</h1><p id="711a" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nf lc ld le ng lg lh li nh lk ll lm ij bi translated">让我们从创建公共概念集成开始。</p><p id="3dba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">登录你的概念账户，进入<a class="ae ni" href="https://www.notion.so/my-integrations" rel="noopener ugc nofollow" target="_blank">https://www.notion.so/my-integrations</a>，点击<strong class="kt ir"> +新集成</strong>按钮，开始创建一个集成。</p><p id="495a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为您的集成命名，并选择要安装该集成的工作区。稍后我们将升级集成以使用OAuth。</p><p id="f7f4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后选择集成将具有的功能。最后，点击<strong class="kt ir">提交</strong>创建集成:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/5307b72fa8b0571553bf3c76b258cb39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O27tOc3Tjdyq0imG.png"/></div></div></figure><p id="0118" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">保存集成后，向下滚动到<strong class="kt ir">集成类型</strong>并点击<strong class="kt ir">公共集成</strong>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/8d9c993eb4002fd1c485e2e99a7bd675.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7TAKt7FvIysxb2oR.gif"/></div></div></figure><p id="2d93" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将添加一个新的部分，<strong class="kt ir"> OAuth域&amp; URIs </strong>，要求您提供更多关于您的公共集成的数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/3f91f34866ae482c8ca7a19c5d2a028c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-yKi0lu4zffQLJZx.png"/></div></div></figure><p id="9ad4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们继续添加所有需要的数据，从<strong class="kt ir">重定向URIs </strong>开始。正如它在《观念》中所说:</p><blockquote class="nm nn no"><p id="cbd4" class="kr ks np kt b ku kv jr kw kx ky ju kz nq lb lc ld nr lf lg lh ns lj lk ll lm ij bi translated"><em class="iq">在OAuth流程中，用户通过idea认证后，将被重定向到该路径。该路径将附加用于访问的授权码，并且必须具有协议。它不能包含URL片段、相对路径或通配符，也不能是公共IP地址。它也必须包含在令牌请求中。</em></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/4e0d1261b0bbf8a257f7911fbd3ef579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R6r-jmKIZR75xfuD.png"/></div></div></figure><p id="350b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了便于学习，本教程将直接从浏览器URL复制授权代码。但是对于您的生产应用程序，您需要提供一个重定向URL，在那里您可以从您的用户提取授权代码。</p><p id="8acc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">继续添加您的<strong class="kt ir">公司名称</strong>和您的<strong class="kt ir">网站或主页</strong> —该网站/主页将用于您的整合页面，如idea所述:</p><blockquote class="nm nn no"><p id="eee9" class="kr ks np kt b ku kv jr kw kx ky ju kz nq lb lc ld nr lf lg lh ns lj lk ll lm ij bi translated"><em class="iq">用于在您的集成页面和认证屏幕中链接到您的集成网站或主页。</em></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/55664917612413c4c8d6d24572e5044d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GDUA6yShHUf9xb5P.png"/></div></div></figure><p id="4ec7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，填写一个<strong class="kt ir">标语</strong>并继续添加链接到一个<strong class="kt ir">隐私政策</strong>、<strong class="kt ir">使用条款</strong>，最后是一个<strong class="kt ir">支持电子邮件</strong>。所有这些字段都是必需的，因为您将创建一个对所有idea用户都可用的公共集成。</p><p id="3c9b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">填写完所有字段后，点击<strong class="kt ir">提交</strong>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/2f5436a8cf7d8870caeb758515b31d2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qhXXfK7i5oY4weBr.png"/></div></div></figure><p id="34c6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保保存好<strong class="kt ir"> OAuth客户端ID </strong>、<strong class="kt ir"> OAuth客户端机密</strong>和<strong class="kt ir">授权URL </strong>，以备后续步骤使用。请记住，您只能泄露<strong class="kt ir"> OAuth客户端秘密</strong>一次，因此请确保将其保存在某个地方以供下一步使用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/ed5828f64993146b843e3238c99985d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5v5n82hV19Skz0Sf.png"/></div></div></figure><p id="9eb6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是第一步。让我们继续创建一个新的数据库，稍后与我们的集成共享。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="c778" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">2.创建要共享的表</h1><p id="8010" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nf lc ld le ng lg lh li nh lk ll lm ij bi translated">这一步是创建一个新的数据库，我们将授权我们的公共集成访问它。</p><p id="c0d2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们创建一个有两列的表，<strong class="kt ir">句柄</strong>和<strong class="kt ir"> tweet </strong>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/5d3f123507ee80c31c1e37e64a710fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_Z8_By1UhQ7Ao23J.png"/></div></div></figure><p id="3a72" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">选择<strong class="kt ir">文本</strong>作为<strong class="kt ir">推文</strong>栏的类型。正如你可能猜到的，这是一个我们稍后将使用tweets填充的表，作为一个用例示例。</p><p id="5b6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是我们对这个数据库的所有需求。让我们进入下一部分，在这里我们将为用户创建概念2.0授权流。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="fbf2" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">3.创建概念授权2.0授权流</h1><p id="f88a" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nf lc ld le ng lg lh li nh lk ll lm ij bi translated">在这一节中，我们将编写生成</p><ol class=""><li id="d983" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><strong class="kt ir">授予您对所选数据库/页面和</strong>的公共集成访问权限的URL</li><li id="4b40" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt ir">我们将在授权重定向中收到的代码中的访问令牌</strong></li></ol><p id="269f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先导入所有的库，并为我们在<strong class="kt ir">步骤1 </strong>中收到的API键创建变量:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/c52386c4c5026e70245eaa9e7693b052.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9nSA2Rw5xsl8l0fY.png"/></div></div></figure><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="ea36" class="od mj iq nz b gy oe of l og oh">import base64<br/>import json<br/>import os<br/>import requests<br/>import urllib.parse</span><span id="922b" class="od mj iq nz b gy oi of l og oh">oauth_client_id = "YOUR_OAUTH_CLIENT_ID"<br/>oauth_client_secret = "YOUR_OAUTH_CLIENT_SECRET"<br/>redirect_uri = "YOUR_REDIRECT_URL"</span></pre><p id="7fad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">解析您的重定向URL:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="0a45" class="od mj iq nz b gy oe of l og oh">parsed_redirect_uri = urllib.parse.quote_plus(redirect_uri)</span></pre><p id="f9dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下一步是创建授权URL，授权您对用户页面/数据库的公共集成访问:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="d9ae" class="od mj iq nz b gy oe of l og oh">auth_url = f"https://api.notion.com/v1/oauth/authorize?owner=user&amp;client_id={oauth_client_id}&amp;redirect_uri={parsed_redirect_uri}&amp;response_type=code"</span><span id="ed01" class="od mj iq nz b gy oi of l og oh">print(auth_url)</span></pre><p id="e5b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此链接将提示用户授权您的公共集成，并允许您访问他们选择的概念页面和数据库。</p><p id="a023" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点击链接，然后<strong class="kt ir">选择页面</strong>。以下是您和用户在访问您的URL时看到的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/7d4c7cf43d4e07d600a6d331690ca925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7C1g2vkI_y-0M8Ru.png"/></div></div></figure><p id="5881" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果用户授予访问权限，将向他们显示一个页面，他们可以在该页面中搜索并选择希望与您的集成共享的页面和数据库。</p><p id="61b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在选择我们之前创建的概念数据库，它应该被称为<strong class="kt ir"> Twitter </strong>，这是您应该看到的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/ed16572d54a3bb20f3ad3f01fbdf7692.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uP5LilwhXi0Row37.png"/></div></div></figure><p id="8b7c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点击<strong class="kt ir">允许访问</strong>，您将被重定向至您的<code class="fe ol om on nz b">redirect_uri</code>。</p><p id="9553" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果用户允许访问，他们也会通过临时授权<code class="fe ol om on nz b">code</code>被重定向到您的<code class="fe ol om on nz b">redirect_uri</code>。它看起来会像这样:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="9b16" class="od mj iq nz b gy oe of l og oh">https://YOUR_REDIRECT_URL/?code=9ac813er-34ad-4ba9-a5a0-52u6&amp;state= <br/>|--- Your redirect URL --| |--- temp authorization code ---|</span></pre><p id="9bd2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在允许授权后，保存您刚刚重定向到的整个URL:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="6108" class="od mj iq nz b gy oe of l og oh">redirect_url_response = "THE_URL_YOU_GOT_REDIRECTED_TO_AFTER_AUTHORIZATION"</span></pre><p id="c96c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后提取并保存您在重定向URL中收到的代码:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="21f5" class="od mj iq nz b gy oe of l og oh">auth_code = redirect_url_response.split('code=')[-1].split('&amp;state=')[0]</span><span id="e971" class="od mj iq nz b gy oi of l og oh">auth_code</span></pre><p id="be13" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在用户授予访问权后，我们需要通过发送一个<code class="fe ol om on nz b">HTTP POST request</code>到观念的令牌<code class="fe ol om on nz b">URL</code> <code class="fe ol om on nz b"><a class="ae ni" href="https://api.notion.com/v1/oauth/token." rel="noopener ugc nofollow" target="_blank">https://api.notion.com/v1/oauth/token</a></code> <a class="ae ni" href="https://api.notion.com/v1/oauth/token." rel="noopener ugc nofollow" target="_blank">来交换访问令牌的授权码。</a></p><p id="1a5d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该请求由<strong class="kt ir"> HTTP基本认证</strong>授权，因此您需要首先对您的集成凭证进行base64编码:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="4ec4" class="od mj iq nz b gy oe of l og oh">key_secret = '{}:{}'.format(oauth_client_id, oauth_client_secret).encode('ascii')<br/>b64_encoded_key = base64.b64encode(key_secret)<br/>b64_encoded_key = b64_encoded_key.decode('ascii')</span></pre><p id="76eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个授权流程的最后一步是将<code class="fe ol om on nz b">temporary code</code>换成<code class="fe ol om on nz b">access token</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="58b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">概念将用一个访问令牌和一些附加信息来响应请求。</p><p id="00a4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是回应的样子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/a3f08ee8a8827539e48155b230eafc51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SWq529jME9vsYthH.png"/></div></div></figure><p id="c13a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用访问令牌存储您的集成接收的所有信息。现在，您可以使用这个访问令牌来访问用户授权访问的所有页面和数据库。</p><p id="2e97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先搜索用户有权访问的数据库:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="1154" class="od mj iq nz b gy oe of l og oh">url = "https://api.notion.com/v1/search"<br/><br/>payload = {"page_size": 100}<br/>headers = {<br/>    "accept": "application/json",<br/>    "Notion-Version": "2022-06-28",<br/>    "content-type": "application/json",<br/>    "authorization": f"Bearer {access_token}"<br/>}<br/><br/>response = requests.post(url, json=payload, headers=headers)</span></pre><p id="1fa3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是回应的样子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/cb09beb77ed43bf6ce11e2b89aa485bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_HUO6Rg7s-uAnAFQ.png"/></div></div></figure><p id="9a68" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">保存数据库id，以便在下一步中添加数据时使用:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="fe6a" class="od mj iq nz b gy oe of l og oh">database_data = response.json()['results']<br/>notion_database_id = database_data[0]['id']</span></pre><p id="00d0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">太好了，现在我们有了所有的逻辑来请求用户授予对他们的页面和数据库的访问权。最后一步是向用户允许您访问的表中添加数据。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="0156" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">4.向授权表中添加数据</h1><p id="6cb9" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nf lc ld le ng lg lh li nh lk ll lm ij bi translated">首先创建一些示例/虚拟数据:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="a759" class="od mj iq nz b gy oe of l og oh">example_data = {<br/>    "handle": "@SomeHandle",<br/>    "tweet": "Here is a tweet"<br/>}</span></pre><p id="f94e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后将数据添加到授权概念数据库:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="8734" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们回到我们在<strong class="kt ir">步骤2 </strong>中创建的概念数据库，您会看到我们刚刚添加到数据库中的输入:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/be4750df2994210f3e84c3dc394f1ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6YGsy5hzgE8Jpzz5.png"/></div></div></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="3df4" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">摘要</h1><ul class=""><li id="5db1" class="ln lo iq kt b ku na kx nb la nc le nd li ne lm ot lt lu lv bi translated"><strong class="kt ir">创建公共概念集成</strong> —我们从创建公共概念集成开始，并保存了所有OAuth凭证</li><li id="7bf7" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ot lt lu lv bi translated"><strong class="kt ir">创建一个共享表</strong> —继续创建一个我们将授予访问权限的表。</li><li id="2fe9" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ot lt lu lv bi translated"><strong class="kt ir">创建Auth 2.0授权流</strong> —最后，我们为用户创建了OAuth流，允许用户访问他们的页面和数据库。</li><li id="2ad3" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ot lt lu lv bi translated"><strong class="kt ir">向授权表添加数据</strong> —最后，我们使用当用户授予我们对其页面和数据库的集成访问权时收到的访问令牌添加数据。</li></ul><p id="6354" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里有一个Jupyter笔记本的<a class="ae ni" href="https://github.com/norahsakal/create-public-notion-integration" rel="noopener ugc nofollow" target="_blank"> repo </a>和所有的源代码，如果你想自己实现的话。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="a16c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="np">原载于</em><a class="ae ni" href="https://norahsakal.com/blog/create-public-notion-integration" rel="noopener ugc nofollow" target="_blank"><em class="np">https://norahsakal . com/blog/create-public-idea-integration</em></a></p></div></div>    
</body>
</html>