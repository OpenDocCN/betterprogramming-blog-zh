<html>
<head>
<title>Custom Gradle Tasks: Build and Send Your APK to Telegram</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义梯度任务:建立和发送您的APK电报</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/custom-gradle-tasks-build-and-send-your-apk-to-telegram-42f7741cd27e?source=collection_archive---------6-----------------------#2022-08-10">https://betterprogramming.pub/custom-gradle-tasks-build-and-send-your-apk-to-telegram-42f7741cd27e?source=collection_archive---------6-----------------------#2022-08-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ef4f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用这个小应用程序节省时间和精力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d4182957a7caa98541ab60d835da23dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bno-aaxE9-rzjhIwUtGjOg.png"/></div></div></figure><p id="46f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，最近我在开发一个Android应用程序，有多个利益相关者参与其中，他们希望测试APK并不断提供反馈。最初，我习惯手动构建应用程序，并将其发送给一个电报组。我体内的dev不赞成这种劳动密集型的方式。因此，我必须找到一种方法来自动化这个过程。这就是自定义Gradle任务发挥作用的地方！</p><h1 id="e867" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">梯度任务介绍</h1><p id="9329" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">如果你曾经接触过Android开发，你肯定会遇到Gradle。</p><blockquote class="mk ml mm"><p id="ebac" class="kr ks mn kt b ku kv jr kw kx ky ju kz mo lb lc ld mp lf lg lh mq lj lk ll lm ij bi translated">Gradle是一个开源的<a class="ae mr" href="https://en.wikipedia.org/wiki/Build_automation" rel="noopener ugc nofollow" target="_blank">构建自动化</a>工具，其设计足够灵活，可以构建几乎任何类型的软件。</p></blockquote><p id="02f7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">简单来说，Gradle运行Android Gradle插件提供的所有花哨任务。它构建您的项目并将其转换成您需要的可分发包(apk、bundles等)。).要了解更多Android应用构建流程和Gradle，可以参考这个:<a class="ae mr" href="https://developer.android.com/studio/build" rel="noopener ugc nofollow" target="_blank">配置你的构建| Android开发者</a>。</p><p id="19b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，梯度任务，他们是什么？Gradle由项目和任务组成。每个构建可以有多个项目，每个项目可以有多个任务。让我们来看看android-gradle插件为我们提供的一些任务！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/1927005accff9a20b8b73f5f4f433548.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*7rdW49tR1m577a1vuJBqSA.png"/></div></figure><p id="3dc9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们现在知道什么是Gradle任务，所以让我们开始了解海关任务。我们都见过的一个自定义任务是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/f118900c524c9de330727ebb023e5a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*BtN4VTns28GEmcko5WnilA.png"/></div></figure><p id="2d4c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该任务存在于项目级<code class="fe mu mv mw mx b">build.gradle</code>文件中。清理任务是不言自明的。它删除了我们项目的构建目录。</p><h1 id="55a8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">编写我们自己的自定义梯度任务</h1><p id="3348" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">有没有可能不从hello world的例子开始？我们去app级<code class="fe mu mv mw mx b">build.gradle</code>文件开始吧。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="3718" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">同样，这是不言自明的。在上面的片段中，只有一件事很突出。为什么我们在<code class="fe mu mv mw mx b">doLast</code>区块内有<code class="fe mu mv mw mx b">println</code>？这是因为当Gradle配置任务时，函数中的任何代码都会执行。为了避免这种情况，我们将它放在了<code class="fe mu mv mw mx b">doLast</code>块中，因为这将确保我们的核心功能在Gradle配置完任务后发生。</p><h1 id="dc66" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">自动化的时间到了:构建和交付APK</h1><p id="391e" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">下面是我们将如何进行的流程:</p><ol class=""><li id="364c" class="na nb iq kt b ku kv kx ky la nc le nd li ne lm nf ng nh ni bi translated">构建调试APK(您也可以签署并构建一个发布APK，但是为了简单起见，我只构建调试版本)</li><li id="cdf1" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">获得访问APK文件的路径和秘密</li><li id="1c82" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">使用电报机器人API来传递文件</li></ol><h2 id="8b6f" class="no lo iq bd lp np nq dn lt nr ns dp lx la nt nu lz le nv nw mb li nx ny md nz bi translated">步骤0:配置电报机器人</h2><p id="63d6" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">由于我不想偏离主题太多(Gradle任务)，我不会涵盖机器人的设置。您可以在这里找到设置它所需的一切:<a class="ae mr" href="https://core.telegram.org/bots" rel="noopener ugc nofollow" target="_blank">机器人:开发者入门(telegram.org)</a></p><p id="1c3d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦bot设置好了，您就应该访问Bot令牌和ChatID(这个ID指的是您想要将消息/文件发送到的通道的ID)。</p><p id="954f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为我们不想泄露这些凭证，所以我们将bot令牌和聊天id存储在一个<code class="fe mu mv mw mx b">secret.properties</code>文件中，我们可以将它添加到我们的。gitignore，这样它就不会被推进VCS。</p><p id="046e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在根目录下创建一个名为<code class="fe mu mv mw mx b">secret.properties</code>的新文件，并像这样添加凭证</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="8ea4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们访问我们的<em class="mn"> build.gradle (app level) </em>文件中的这些变量</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="2c71" class="no lo iq bd lp np nq dn lt nr ns dp lx la nt nu lz le nv nw mb li nx ny md nz bi translated">步骤1:构建调试apk</h2><p id="ea72" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">让我们创建自定义任务。它必须首先构建调试APK。负责做这件事的Gradle任务叫做<code class="fe mu mv mw mx b">assembleDebug</code>。我们的职能有赖于此。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="4a86" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mu mv mw mx b">dependsOn</code>关键字将运行指定的任务，并确保只有在任务成功执行后才向前移动。</p><h2 id="d2a4" class="no lo iq bd lp np nq dn lt nr ns dp lx la nt nu lz le nv nw mb li nx ny md nz bi translated">步骤2:获取APK文件的路径和秘密</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="12c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">凭证是从我们之前创建的<code class="fe mu mv mw mx b">secretProperties</code>实例中获取的。为了获取文件路径，我们首先获取对<code class="fe mu mv mw mx b">app-debug.apk</code>文件的引用，然后获取文件的路径。</p><h2 id="d008" class="no lo iq bd lp np nq dn lt nr ns dp lx la nt nu lz le nv nw mb li nx ny md nz bi translated">步骤3:使用电报机器人API来传递文件</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="6ef7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是奇迹发生的地方！</p><p id="d43b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">到现在为止，您应该已经观察到我们已经将这个函数的类型指定为<code class="fe mu mv mw mx b">Exec</code>。这是因为该任务的核心功能是执行命令。我们执行一个<code class="fe mu mv mw mx b">curl</code>命令，该命令将使用Telegram Bot REST API请求上传路径指定的文件，并将其发送到指定的chat。(关于API的更多信息可以在这里找到:<a class="ae mr" href="https://core.telegram.org/bots/api" rel="noopener ugc nofollow" target="_blank">电报机器人API </a>)</p><p id="1771" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">瞧，我们已经自动化了构建APK并将其发送到电报聊天的过程。</p><p id="b57f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是完整的<code class="fe mu mv mw mx b">build.gradle</code>文件供您参考:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="abec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望这篇文章能让你深入了解如何编写定制的Gradle任务！尽管我使用了一个自动化构建和发送APK到Telegram的任务的例子，但是您可以使用Gradle任务自动化的事情是无限的。</p><p id="25ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您的阅读！</p><pre class="kg kh ki kj gt oa mx ob oc aw od bi"><span id="4347" class="no lo iq mx b gy oe of l og oh"><strong class="mx ir">Want to Connect?</strong></span><span id="990b" class="no lo iq mx b gy oi of l og oh">If there is anything you’d like to discuss, feel free to connect with me on LinkedIn: <a class="ae mr" href="https://www.linkedin.com/in/rithik-jain-710b3a199/" rel="noopener ugc nofollow" target="_blank">Rithik Jain | LinkedIn</a></span></pre></div></div>    
</body>
</html>