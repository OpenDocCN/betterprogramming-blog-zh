<html>
<head>
<title>ArchUnit: Test Software Architecture Easily</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ArchUnit:轻松测试软件架构</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/archunit-test-software-architecture-easily-a874c54bda1e?source=collection_archive---------10-----------------------#2022-07-18">https://betterprogramming.pub/archunit-test-software-architecture-easily-a874c54bda1e?source=collection_archive---------10-----------------------#2022-07-18</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8550" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">如何使用ArchUnit验证Java项目中的架构约束</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/9c1bb3ab4bca6582f381831d58a8ba45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3ojyp_LVDmLa-SrR"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@andrewtneel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">安德鲁·尼尔</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><h1 id="738a" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">为什么我们要测试架构</h1><p id="9760" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">随着项目的增长，架构变得更加复杂。每个项目都有开发人员需要遵循的标准规则。如果新同事加入项目，他们可能会在不知道的情况下违反架构约束。如果每个人都在他们认为合适的地方添加新代码，代码库将变得混乱。</p><p id="a17b" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">这导致了代码维护的费力，并为错误打开了大门。当然，可能会有一位资深开发人员已经在这个项目上工作了多年。他们定期检查新代码，并让其他人知道他们是否应该修复任何东西。</p><p id="a2b9" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">问题是这需要人工干预，有时人类不能发现所有的问题。保护软件架构不受侵犯的最好方法是拥有一个自动化的过程。</p></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><p id="d222" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">在本文中，我将展示解决此类问题的<a class="ae kz" href="https://www.archunit.org/" rel="noopener ugc nofollow" target="_blank"> ArchUnit </a>框架。您将看到典型的实际例子来理解如何将这个工具集成到您的项目中。</p><p id="0424" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">让我们开始吧！</p><h1 id="2bf4" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">什么是建筑单位</h1><p id="638c" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">ArchUnit用于Java项目架构的单元测试。它验证了架构约束。通常，架构师或首席开发人员会建立通用模式。他们在人类可读的单元测试中编写规则，可以用任何单元测试工具如<a class="ae kz" href="http://junit.org/" rel="noopener ugc nofollow" target="_blank"> JUnit </a>进行评估。</p><p id="5952" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">当有人违反规则时，测试就会失败。开发人员将看到关于该问题的信息。它确保代码库保持完整，每个人都遵循指导方针。</p><p id="ad1a" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">这种测试艺术对于新加入者理解项目结构特别有益。</p><h1 id="eb6a" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">ArchUnit演示</h1><p id="3003" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">我假设您已经有了一个用于测试的Java项目，例如SpringBoot项目。</p><p id="270f" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">首先，将ArchUnit maven依赖项添加到您的<code class="fe na nb nc nd b">pom.xml</code>:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="492b" class="ni lb iu nd b gz nj nk l nl nm">&lt;dependency&gt;<br/>    &lt;groupId&gt;com.tngtech.archunit&lt;/groupId&gt;<br/>    &lt;artifactId&gt;archunit&lt;/artifactId&gt;<br/>    &lt;version&gt;0.23.1&lt;/version&gt;<br/>    &lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;</span></pre><p id="3393" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">现在，让我们来看看一些常见的使用案例。</p><p id="3112" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">创建一个新的Java类，例如<code class="fe na nb nc nd b">ArchUnitTest.java</code>。为了简单起见，我们将所有的测试都放在那里。</p><h2 id="351a" class="ni lb iu bd lc nn no dn lg np nq dp lk mb nr ns lm mf nt nu lo mj nv nw lq nx bi translated">命名约定测试</h2><p id="6386" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">如果您有多个模块，您可以使用注释<code class="fe na nb nc nd b">AnalyzeClasses</code>来指出要扫描哪个包。</p><p id="df5a" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">例如，您可能希望在所有SpringBoot项目中保持一致，应用程序类名应该是“MainApp”:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div></figure><p id="9787" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">如您所见，代码是不言自明的。您只需要提供ArchUnit需要验证的注释，验证是开箱即用的。</p><p id="a524" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">您可以检查是否所有控制器类都有后缀“Controller”:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">控制器应该是带后缀的测试用例</p></figure><p id="0332" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">注意，如果给定的项目不包含控制器，<code class="fe na nb nc nd b">allowEmptyShould(true) </code>选项允许测试失败。</p><h2 id="c82c" class="ni lb iu bd lc nn no dn lg np nq dp lk mb nr ns lm mf nt nu lo mj nv nw lq nx bi translated">包装位置测试</h2><p id="d731" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">您可能想要检查实体是否位于“模型”包中:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div></figure><p id="bc8d" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">请注意，您可能具有以下结构:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oa"><img src="../Images/1fe772b03a7aba318e00d8c08df433ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/format:webp/1*OrzeB7V7jfSd5vg9VS1KOw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">模型和子包</p></figure><p id="c30e" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">测试将是有效的，因为实体位于“模型”包下的“实体”中。</p><p id="ebd5" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">类似地，您可以检查配置类是否位于“config”包中:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">配置文件应该位于配置包测试用例中</p></figure><p id="88ec" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">请注意，如果您需要使规则更加复杂，您可以轻松地将多个条件链接起来。</p><p id="7cf7" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">如果您想要验证扩展父类的所有类，可以通过以下方式实现:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">xml请求应该位于请求包测试用例中</p></figure><p id="98f1" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">在这个例子中，所有扩展了<code class="fe na nb nc nd b">SoapRequest.class</code>的类都将被验证。</p><h2 id="c215" class="ni lb iu bd lc nn no dn lg np nq dp lk mb nr ns lm mf nt nu lo mj nv nw lq nx bi translated">注释测试</h2><p id="022e" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">以下示例说明了对有效批注的检查:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">配置应该是带注释的测试用例</p></figure><p id="0084" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">所有的配置类都应该有一个想要的注释。</p><h2 id="78f7" class="ni lb iu bd lc nn no dn lg np nq dp lk mb nr ns lm mf nt nu lo mj nv nw lq nx bi translated">软件设计模式测试</h2><p id="ff18" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">假设您的项目应该遵循<a class="ae kz" href="https://en.everybodywiki.com/Onion_Architecture" rel="noopener ugc nofollow" target="_blank">洋葱架构</a>风格:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">洋葱架构模式测试用例</p></figure><h2 id="eecc" class="ni lb iu bd lc nn no dn lg np nq dp lk mb nr ns lm mf nt nu lo mj nv nw lq nx bi translated">测试排除</h2><p id="e098" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">有时候你不想执行某些类的规则。通常，对于JUnit测试。</p><p id="f575" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">这可以通过以下方式轻松实现:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">测试排除选项</p></figure><p id="1229" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">或者你有一个你想忽略的类，因为规则不适用于它。创建一个自定义规则并导入它，如上例所示。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">特定测试排除选项</p></figure><h1 id="e540" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">结论</h1><p id="c317" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">恭喜你！您现在知道为什么测试架构是必要的了。</p><p id="f4c4" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">您了解了如何将ArchUnit测试框架集成到您的Java项目中。您还熟悉了可以在您的架构指南中应用的常用规则。</p><p id="fd48" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">查看下面的参考资料部分，了解更多的规则示例。</p><p id="2040" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">希望这篇教程有所帮助。如果您想阅读更多关于软件架构最佳实践的内容，您可能会喜欢我的另一篇文章:</p><div class="ob oc gq gs od oe"><a rel="noopener  ugc nofollow" target="_blank" href="/use-fitness-functions-for-evolving-architecture-a4d6c3f6fda2"><div class="of ab fp"><div class="og ab oh cl cj oi"><h2 class="bd iv gz z fq oj fs ft ok fv fx it bi translated">使用适应度函数进化建筑</h2><div class="ol l"><h3 class="bd b gz z fq oj fs ft ok fv fx dk translated">用简单的例子介绍适应度函数概念</h3></div><div class="om l"><p class="bd b dl z fq oj fs ft ok fv fx dk translated">better编程. pub</p></div></div><div class="on l"><div class="oo l op oq or on os kt oe"/></div></div></a></div><p id="b3ce" class="pw-post-body-paragraph ls lt iu lu b lv mo jv lx ly mp jy ma mb mq md me mf mr mh mi mj ms ml mm mn in bi translated">感谢您的阅读，祝您编码愉快！</p><h1 id="c20f" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">参考</h1><ul class=""><li id="05fa" class="ot ou iu lu b lv lw ly lz mb ov mf ow mj ox mn oy oz pa pb bi translated"><a class="ae kz" href="https://github.com/TNG/ArchUnit-Examples/tree/main/example-junit5/src/test/java/com/tngtech/archunit/exampletest/junit5" rel="noopener ugc nofollow" target="_blank"> ArchUnit GitHub示例</a></li></ul></div></div>    
</body>
</html>