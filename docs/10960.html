<html>
<head>
<title>Build a Placeholder API With the New ASP.NET Core Minimal API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用新的ASP.NET核心最小API构建占位符API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-placeholder-api-with-the-new-asp-net-core-minimal-api-4f27d2388589?source=collection_archive---------11-----------------------#2022-02-07">https://betterprogramming.pub/build-a-placeholder-api-with-the-new-asp-net-core-minimal-api-4f27d2388589?source=collection_archive---------11-----------------------#2022-02-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0746" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">并将其部署到Azure</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f5c40253980bf7b59d942bc463875990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_jsruKPBeCTPA1sz"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯利·西克玛</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="763c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你正在开始一个新项目，在互联网上建造下一个大东西。首先，构建客户机——一个全新的单页面应用程序。但是…你需要它与API交互来获取数据。并且您还没有准备好构建一个完整的API。</p><p id="c248" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有许多占位符API，但它们通常有两个问题:</p><ul class=""><li id="e6f7" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">数据与您的数据模型不匹配。</li><li id="e9d7" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">CRUD操作不是真实的(数据不是真的<em class="mg">CRUD</em>)。</li></ul><p id="f803" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将向您展示如何构建您自己的占位符API，大约只需要花同样的时间来搜索合适的东西。API将使用您自己的数据模型，并且它将允许您执行真正的CRUD操作，其中的更改是持久化的——至少在您重新启动API之前是这样。它是可扩展的，因此数据模型可以随着应用程序的增长而增长。</p><p id="abeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，您需要安装<a class="ae kv" href="https://visualstudio.microsoft.com/vs/community/" rel="noopener ugc nofollow" target="_blank"> Visual Studio 2022 </a>。它将使用<em class="mg">ASP.NET核心最小API。这需要10分钟或更少的时间(至少在你读完这篇文章后)。完成的代码可以在<a class="ae kv" href="https://github.com/tmj-code/placeholder-api" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</em></p><h1 id="6e71" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">准备好了吗？开始了。</h1><p id="a238" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">打开Visual Studio 2022，并创建一个新项目。选择<strong class="ky ir">ASP.NET核心Web API </strong>。我们可以给我们的新API起任何名字，但是这个名字很傻，所以我们把它命名为PostAPI。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/bcd8bbf1305392f7e533f11d17f9455d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jNTUtWAQCK4LCjVObsPG7Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择ASP.NET核心Web API模板</p></figure><p id="65cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保您<strong class="ky ir">取消选中</strong><em class="mg">使用控制器(取消选中以使用最小API) </em>复选框。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/924d1423c9a2a39ca1674ec1103e31f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*luY4YlS_4sCG4dZxIbguYQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">确保取消选中使用控制器(…)选项以生成最小API</p></figure><p id="b55e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建项目后，打开<em class="mg"> Program.cs </em>文件，删除WeatherForecast示例api，但保留常规设置(包括Swagger)。</p><p id="2548" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还需要启用<em class="mg"> CORS </em>，因为我们可能要从浏览器客户端访问它。我们的程序文件应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="80ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们向项目添加一个json文件来保存我们的初始占位符数据；姑且称之为<code class="fe ni nj nk nl b">posts.json</code>。确保它将被复制到输出文件夹。然后在其中添加以下数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="d434" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无耻的自我推销，我知道。</p><p id="cbae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">复制JSON内容，然后将光标放在<em class="mg">程序</em>文件的底部。我们将让Visual Studio生成我们的数据类:转到编辑&gt;选择性粘贴&gt;将JSON粘贴为类。这将为我们生成一些类。</p><p id="4838" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们不需要<code class="fe ni nj nk nl b">RootObject</code>，所以删除它。然后将<code class="fe ni nj nk nl b">Class1</code> <em class="mg"> </em>改名为<code class="fe ni nj nk nl b">Post</code>。</p><p id="4d0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将来自<code class="fe ni nj nk nl b">posts.json</code>的数据加载到一个局部变量中，然后我们可以在我们的端点中使用它(马上)。所以添加下面几行:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="f5c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们实现端点。在本例中，我们添加了五个标准CRUD端点:</p><ul class=""><li id="5906" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">获取所有帖子(获取/帖子)</li><li id="cc77" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">按ID获取(GET /posts/{id})</li><li id="37cb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">创建一个新帖子</li><li id="b6c1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">更新帖子(上传/帖子/{id})</li><li id="43b3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">删除帖子(删除/帖子/{id})</li></ul><p id="290e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果提供了未知ID，我们希望<em class="mg"> Get by ID </em>和<em class="mg"> Update </em>返回<em class="mg"> NotFound </em>，否则一切都应该是<em class="mg"> OK </em>。其他API可能有不同的需求。总之，在<code class="fe ni nj nk nl b">posts</code> <em class="mg"> </em>和<code class="fe ni nj nk nl b">app.Run()</code>的初始化之间添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="bfc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">搞定了。现在，您可以运行应用程序了，您的API会打开一个大页面。尝试不同的端点。</p><h1 id="a662" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">好处:部署到Azure</h1><p id="4cf9" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">你可以在Azure中创建一个免费的网站/应用服务。然后你可以在Visual Studio中右击你的API项目，选择<em class="mg"> Publish… </em>。现在团队的其他成员可以访问您令人惊叹的占位符API了。</p><p id="d037" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，一个免费的Azure应用程序服务在20分钟不活动后就会关闭。这将重置数据，数据在初始加载后仅保存在内存中。如果您不想等待20分钟——或者您是一个不断使用API的大型团队，因此需要保持其活力——您可能需要实现一个<em class="mg"> /reset </em>端点来重新加载数据。我将把它作为一个练习。</p><p id="f5ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，您可以将其添加到(非免费)标准层应用服务计划中，打开<em class="mg"> Keepalive </em>，然后您可以在更长的时间内使用相同的数据。</p><h1 id="aba3" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">总之</h1><p id="0762" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">用新的<em class="mg">ASP.NET核心最小API </em>构建一个占位符API相当容易。您可以在几分钟内完成，并且可以根据应用程序的特定需求进行调整。</p><p id="b9eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在接下来的一篇文章中，我将展示如何使用<em class="mg">ASP.NET核心最小API </em>作为各种规模的应用程序的精简而灵活的接口。</p></div></div>    
</body>
</html>