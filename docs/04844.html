<html>
<head>
<title>How to Upload a File Attachment From a REST API Post Request</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从REST API Post请求上传文件附件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-download-a-file-attachment-from-a-rest-api-post-request-27d53e3de17c?source=collection_archive---------1-----------------------#2020-05-15">https://betterprogramming.pub/how-to-download-a-file-attachment-from-a-rest-api-post-request-27d53e3de17c?source=collection_archive---------1-----------------------#2020-05-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f1dc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">提示:在Java代码中使用多部分格式数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d579f4ff9e087e9318c741f8d3decffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbulcE1QpkR7w9ZdRekjXg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@outdoor_junkiez?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">德鲁·法威尔</a>在<a class="ae ky" href="https://unsplash.com/s/photos/send?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="aa3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在花了数小时寻找从API POST请求中下载文件附件的方法后，我终于将不同堆栈溢出和博客帖子的零碎内容放在一起，让它正常工作。</p><p id="c53d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这应该没那么难。老实说，不是的。</p><p id="7170" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在我的Spring项目中使用了这个，但是在其他类型的Java项目中，逻辑仍然是相同的。</p><p id="4d2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还将向您展示如何使用Postman测试端点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7b74" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">目标</h1><p id="8102" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">目标是下载从API POST请求发送的文件附件。</p><p id="a072" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想跟进，我建议使用以下工具:</p><ul class=""><li id="1822" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">代码编辑器/IDE的<a class="ae ky" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>、<a class="ae ky" href="https://www.jetbrains.com/idea/" rel="noopener ugc nofollow" target="_blank"> IntelliJ </a>或<a class="ae ky" href="https://www.eclipse.org/ide/" rel="noopener ugc nofollow" target="_blank"> Eclipse </a></li><li id="adbe" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><a class="ae ky" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a></li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8c6b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建您的REST端点</h1><p id="262d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们首先要设置我们的REST端点。这是一个简单的<code class="fe nn no np nq b">PostMapping</code>，它将驻留在我们的<code class="fe nn no np nq b">Controller.java</code>类中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="0ab5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来说说这堂课的每一句台词。</p><ul class=""><li id="1ce2" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">第21行:返回类型将是一个<code class="fe nn no np nq b">ResponseEntity</code>。这可以是任何东西。我希望看到成功的请求返回一个带有<code class="fe nn no np nq b">200</code>状态代码的“好样的”。</li><li id="d1f9" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第21行(续)):<code class="fe nn no np nq b">@RequestPart(“file”)</code>负责我们的表单数据体。“文件”是我们在发送请求时用于文件的标签。在使用Postman进行测试时，您将会看到这一点。</li><li id="4871" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第21行(续)):<code class="fe nn no np nq b">MultipartFile</code>是在多部分请求中接收的上传文件的表示。这是我们将用于文件的数据类型。</li><li id="528c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第22–23行:如果文件没有被正确读取(意味着它是<code class="fe nn no np nq b">null</code>)，我们应该返回一个<code class="fe nn no np nq b">HttpStatus.BAD_REQUEST</code>。</li><li id="fc6b" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第25行:我们将把它包装在一个<code class="fe nn no np nq b">try-catch</code>块中，因为有些方法会抛出一个<code class="fe nn no np nq b">IOException</code>。这是我们处理这些异常的方式。</li><li id="bba8" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第26行:这一行是关键。我们将把文件的内容存储在一个字节数组中。为了从原始文件中检索这些字节，我们使用了<code class="fe nn no np nq b">getBytes()</code>方法。</li><li id="93cb" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第27行:要找到存储在内存中或临时存储在磁盘上的文件，我们需要指定文件名。<code class="fe nn no np nq b">Path</code>对象帮助我们实现这一点。</li><li id="59cb" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第28行:接下来，我们将把文件写到我们指定的位置。你可以把它放在任何你想放的地方以备将来使用。</li><li id="90e0" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第29行:只是一个简单的控制台输出来验证我们正在读取正确的文件。</li><li id="a72c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第30–32行:如果I/O有问题，这些行处理<code class="fe nn no np nq b">IOException</code>。</li><li id="b8aa" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">第33行:在一个成功的请求上返回“好样的”。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fc5f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用邮递员测试</h1><p id="2b73" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们现在将向端点发送一个文件附件。</p><p id="1144" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个请求将是一个发送到<code class="fe nn no np nq b">localhost:8080/api</code>的<code class="fe nn no np nq b">POST</code>请求，它只是我们的本地服务器。</p><p id="2745" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要附加文件，必须将其作为表单数据包含在正文中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/3000ed3849fe7c36894675a9a4767deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*h-y7GfXby6mdP2R_N13gaQ.png"/></div></figure><p id="a5f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦进入正文→表单数据字段，您必须输入一个<code class="fe nn no np nq b">KEY</code>。这应该是“文件”或您在<code class="fe nn no np nq b">@RequestPart(“[value]”)</code>中指定的任何值。</p><p id="b107" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，会出现一个下拉菜单，让您选择文本或文件。选择“文件”选项。</p><p id="3831" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后点击发送。下面是整个请求和响应的样子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/44e71d17491d5cf7d0fbe9bce7b1b2a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yuIFPTWTmya8pvJFfOVmyg.png"/></div></div></figure><p id="36c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Spring端，您会看到文件名打印到我们的控制台，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/65a51b62575ffa86ea59651b9455fe3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0OoInbc2Hzh_Frud3wdcQ.png"/></div></div></figure><p id="f20e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在最后一行看到的，我的文件名是<code class="fe nn no np nq b">Getting started with OneDrive.docx</code>。</p><p id="0794" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是全部了。就这么简单。</p><p id="ecd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有任何问题、意见或顾虑，请随时回复。</p></div></div>    
</body>
</html>