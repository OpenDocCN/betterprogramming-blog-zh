# 我如何通过写自己的博客平台一年省下 360 美元

> 原文：<https://betterprogramming.pub/how-i-saved-360-a-year-writing-my-own-blogging-platform-sorry-ghost-io-9720de0733e3>

## 抱歉幽灵

![](img/49c7477678000a0825994f533de23c89.png)

这是一台电脑。你还期望什么？

在这篇文章中，我将向你展示我是如何用自己的 CI/CD 管道创建自己的博客平台的。听起来很疯狂？有点，但也很有趣。

# 语境

我有一个[博客](https://showpy.tech/)(就是你现在正在看的那个！)直到几天前，它还被托管在 [ghost.io](https://ghost.org/) 上。现在它托管在 AWS 中我自己的 EC2 实例上，使用 [CloudFront](https://aws.amazon.com/cloudfront/) 作为 CDN。有些人会说这就像向苍蝇开炮，但事实是我已经有了这个实例，因为我正在使用的另一个工具就在那里。它是一个简单的工具，可以用更简单的 CLI 在云中存储代码片段，因为我真的很喜欢使用控制台。因此，除了 CloudFront 发行版(但这是小菜一碟)，整个设置都已就绪。

我只缺少了一部分——博客引擎——但我是一名程序员，所以决定编写自己的简单博客平台来满足我的需求，老实说，这非常简单。

# 我为什么要这么做？

嗯，这没什么好奇怪的，我有一个几乎死气沉沉的博客。自 2017 年 10 月以来，我没有写过任何新东西，但我仍然每月支付 29 美元的订阅费。这种情况时有发生——我没有时间，除了满足我的自我和努力成为一个技术博客和“有影响力的人”之外，我还在做更有趣的事情。但是我喜欢拥有一个博客的想法——我非常喜欢它，我每年为这个域名支付大约 50 美元，我认为这很棒。

当我决定一个博客平台时，我真的很喜欢用 markdown 标记写文章的想法。我真的很喜欢这种格式和它周围的环境——例如，使用 Pandoc 和 LaTeX，你可以非常容易地从 markdown 生成 PDF 或 epub 文件，看起来非常专业。考虑到这一点，我决定复制这个功能，并向您描述我的平台是如何工作的。

# 我的工作流程现在是什么样子

我是一名程序员——这意味着我主要做两件事:人和文本。我坐在我的 IDE(集成开发环境)中，使用控制台，或者只是阅读文档，处理大量的文本。我肯定不是唯一的一个，但我只通过终端使用 git 我不断地拒绝所有围绕它构建的 UI(要么它构建在你的 IDE 中，要么它是一个单独的应用)。

对于育儿博客来说，这可能是一个惊喜，但是我在 PyCharm IDE 中以 markdown 文件的形式写我的帖子(目前的这篇),我对此感到非常舒服。

我在左边有一个`content`目录，如下所示:

```
├── 2019
│   └── 07
│       └── 04
│           └── how-i-saved-360-dollars-a-years-sorry-ghost.md
```

我需要手动创建上述文件，并将其放在正确的目录结构下(当前日期)。这是一项工作，但需要 30 秒钟。现在我已经把我的内容组织好了，而且可能更重要的是，我把它放在了存储库中，这意味着我不能丢失它。所有内容都属于我，不需要手动导入/导出/什么的。

上面呈现的文件正是我现在使用 markdown 标记编写的文件。

当我完成的时候会发生什么？

我需要更新帖子`database`——这是一个简单的 [JSON](https://en.wikipedia.org/wiki/JSON) 文件。帖子的元数据将如下所示:

*注意:这部分相当专业，所以如果你不感兴趣，可以跳过。*

所以我使用 git 创建一个 commit，稍后将它推送到主分支，并等待 [CI](https://en.wikipedia.org/wiki/Continuous_integration) / [CD](https://en.wikipedia.org/wiki/Continuous_delivery) 来完成这项工作。对于我的 CI/CD，我使用的是[位桶管道](https://bitbucket.org/product/features/pipelines)。每次我做了更改，新的 docker 映像就会建立起来。然后将它推送到 docker 容器注册中心(AWS 中的私有注册中心— ECR)。稍后，自动化管道运行 [ansible](https://www.ansible.com/) 脚本，这些脚本负责更新博客的`production`版本，并使 CloudFront 缓存中的一些路径无效。

所以，是的，你可以说这对于一个博客来说太多了，但是我只花了几个小时就把它整理好了，而且它工作起来很有魅力。当然，我需要改进一些东西，比如:

*   资源缓存(图像和其他文件)
*   部署不是零停机，但考虑到 CDN，几乎不可能获得 502
*   可能需要改变一些自定义资源的处理方式和位置。

就像这个迷因:“这不多，但这是诚实的工作。”

基本上就是这样。

# 技术堆栈和代码概述

技术堆栈是围绕 Python 构建的:

*   sanic — OMG。使用`sanic`来服务静态文件——是的，为什么不呢:)
*   [jinja2](https://github.com/pallets/jinja) —模板引擎，下面会详细介绍。
*   [markdown](https://github.com/Python-Markdown/markdown) —将 markdown 转换为 HTML 的工具。

那么，当写入完成时，markdown 文件会发生什么情况呢？

在`app.py`中，有一个处理程序来处理帖子:

正如你所看到的——它将使用`post.html`作为基础，`jinja2`将内容帖子注入模板:

没错，就是整个`post` HTML 模板。帖子是哪里来的？让我们看看`content_cache`的对象:

`ContentCache`是一个简单的 Python 类，它将 markdown 文件转换成 HTML 后缓存在内存中。这没什么大不了的——因为现在它可能只有几十 KB。也许以后我会对此进行优化。

此外，我应该修复`NotFound`错误并返回正确的`HTTP`状态——但这对博客的运行并不重要，所以决定现在跳过这一步。

这就是博客平台背后的魔力！

# 抱歉幽灵

你真的做得很好，我很高兴使用你的服务。不是你，是我。因为我的懒惰(两年来我一篇帖子都没写)——我已经白花钱了，最后气疯了，决定为此做点什么。

然而，我确实意识到，当你是一名软件开发人员时，你可以为自己做很多服务，并削减订阅费用。嗯，接下来是什么？也许是网飞？；)

# 想用还是玩？

我在 Github 上创建了一个公共库——这是一个[平台样板](https://github.com/opalczynski/simple-blog-platform)——如果你愿意，你可以使用它。

如果你熟悉 Python，一点 HTML/CSS，和模板渲染(`jinja2`)，你应该可以直接使用它。

感谢阅读。