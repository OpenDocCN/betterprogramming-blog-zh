<html>
<head>
<title>Build an API to Count GitHub Profile Views With Rust, Actix, and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Rust、Actix和MongoDB构建一个API来统计GitHub概要视图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-an-api-to-count-github-profile-views-with-rust-actix-and-mongodb-5a6532b6d2eb?source=collection_archive---------6-----------------------#2022-08-07">https://betterprogramming.pub/build-an-api-to-count-github-profile-views-with-rust-actix-and-mongodb-5a6532b6d2eb?source=collection_archive---------6-----------------------#2022-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="10e9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">调用API端点并创建您自己的徽章来显示视图统计。</h2></div><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="gh gi gj"><img src="../Images/e6711d455a76d76eb161ec87bb40ec85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DA4NuS6wqXrgK_fPGH-HHA.jpeg"/></div></div></figure><p id="7a3d" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">在这篇文章中，我们将学习如何使用Rust、Actix和MongoDB构建一个简单的API来计算GitHub上的概要视图。您可以将它视为如何从头开始一个典型的HTTP API项目的教程。</p><p id="61d0" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">收集视图计数的想法很简单。我们需要嵌入一个跟踪图像到github页面，用户可以查看和显示收集的统计数据。为了显示收集的统计数据，我们将使用<a class="ae lm" href="https://shields.io/endpoint" rel="noopener ugc nofollow" target="_blank"> shields </a>项目，该项目允许使用自定义数据提供者创建徽章。</p><h1 id="58c2" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">先决条件</h1><p id="8e54" class="pw-post-body-paragraph kq kr iq ks b kt mf jr kv kw mg ju ky kz mh lb lc ld mi lf lg lh mj lj lk ll ij bi translated">首先你需要设置合适的工具来开始开发。以下是最简单的列表:</p><ul class=""><li id="d48b" class="mk ml iq ks b kt ku kw kx kz mm ld mn lh mo ll mp mq mr ms bi translated"><a class="ae lm" href="https://www.rust-lang.org/tools/install" rel="noopener ugc nofollow" target="_blank"> Rust语言</a> —构建和运行应用程序的Rust SDK</li><li id="db30" class="mk ml iq ks b kt mt kw mu kz mv ld mw lh mx ll mp mq mr ms bi translated"><a class="ae lm" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VSCode </a> —用于修改应用源代码的编辑器</li><li id="fa98" class="mk ml iq ks b kt mt kw mu kz mv ld mw lh mx ll mp mq mr ms bi translated"><a class="ae lm" href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer" rel="noopener ugc nofollow" target="_blank"> Rust Analyzer </a> —一个VSCode扩展，为Rust开发提供了更好的体验</li><li id="bd40" class="mk ml iq ks b kt mt kw mu kz mv ld mw lh mx ll mp mq mr ms bi translated"><a class="ae lm" href="https://www.docker.com/get-started/" rel="noopener ugc nofollow" target="_blank"> Docker桌面</a> —构建或使用Docker图像</li></ul><p id="6ee2" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">Docker对于在本地开发应用程序也很有用，以防您需要一个数据库实例，而不需要在操作系统中安装它。</p><h1 id="b7a7" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">设置项目</h1><p id="9129" class="pw-post-body-paragraph kq kr iq ks b kt mf jr kv kw mg ju ky kz mh lb lc ld mi lf lg lh mj lj lk ll ij bi translated">让我们用这个cargo命令创建一个Rust项目:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="89cd" class="nd lo iq mz b gy ne nf l ng nh">cargo new counter</span></pre><p id="bc73" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">现在您可以在<code class="fe ni nj nk mz b">VSCode</code>中打开项目文件夹，并添加开发HTTP API所需的依赖项。在这个项目中，依赖关系将是:</p><ul class=""><li id="a890" class="mk ml iq ks b kt ku kw kx kz mm ld mn lh mo ll mp mq mr ms bi translated">Actix——一个流行的Rust web框架</li><li id="ad5e" class="mk ml iq ks b kt mt kw mu kz mv ld mw lh mx ll mp mq mr ms bi translated">MongoDB的Rust驱动程序</li><li id="1271" class="mk ml iq ks b kt mt kw mu kz mv ld mw lh mx ll mp mq mr ms bi translated">Serde  —一个用于JSON序列化/反序列化的Rust库</li></ul><p id="1106" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">你可以编辑<code class="fe ni nj nk mz b">Cargo.toml</code>文件或者在项目目录下使用这个命令:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="0ca6" class="nd lo iq mz b gy ne nf l ng nh">cargo add actix-web mongodb serde</span></pre><p id="cee1" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">您还需要修改<code class="fe ni nj nk mz b">serde</code>特性标志，以允许使用<code class="fe ni nj nk mz b">derive</code>宏来实现更具声明性的序列化。</p><p id="7c6e" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">因此，依赖项部分将如下所示:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="cda8" class="nd lo iq mz b gy ne nf l ng nh">[dependencies]<br/>actix-web = "4.1.0"<br/>mongodb = "2.3.0"<br/>serde = { version = "1.0.140", features = ["derive"] }</span></pre><h1 id="12cd" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">数据库ˌ资料库</h1><p id="b088" class="pw-post-body-paragraph kq kr iq ks b kt mf jr kv kw mg ju ky kz mh lb lc ld mi lf lg lh mj lj lk ll ij bi translated">在我们开始编码之前，我们需要一个<code class="fe ni nj nk mz b">MongoDB</code>实例来存储应用程序数据。我们将使用DockerHub注册表中的官方Docker图像来制作。</p><p id="1226" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">让我们为本地开发创建一个Docker容器:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="eb91" class="nd lo iq mz b gy ne nf l ng nh">docker run -d --name local-mongo \<br/>    -p 27017:27017 \<br/>    -e MONGO_INITDB_ROOT_USERNAME=admin \<br/>    -e MONGO_INITDB_ROOT_PASSWORD=pass \<br/>    mongo:latest</span></pre><p id="642a" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">一旦完成，您就可以用这个连接字符串<code class="fe ni nj nk mz b">mongodb://admin:pass@localhost:27017</code>连接到您的本地MongoDB。</p><p id="419b" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">为了允许应用程序访问数据库，您必须将连接字符串添加到项目的<code class="fe ni nj nk mz b">.cargo</code>目录中的<code class="fe ni nj nk mz b">config.toml</code>文件中:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="692d" class="nd lo iq mz b gy ne nf l ng nh">[env]<br/>DATABASE_URL = "mongodb://admin:pass@localhost:27017"</span></pre><p id="5f46" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">您可能还需要这个命令来(重新)启动MongoDB容器:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="15c9" class="nd lo iq mz b gy ne nf l ng nh">docker restart local-mongo</span></pre><h1 id="b48d" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">项目结构</h1><p id="6992" class="pw-post-body-paragraph kq kr iq ks b kt mf jr kv kw mg ju ky kz mh lb lc ld mi lf lg lh mj lj lk ll ij bi translated">在这个项目中，我们将有两层来组织代码。第一层将代表一个数据服务，我们将使用它与MongoDB集合一起添加和统计GitHub概要视图。第二层将公开API端点，用于跟踪视图和检索收集的统计数据。</p><p id="60d1" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">让我们使用上面描述的两个功能来创建数据服务:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6012" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我们API的端点层:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="9c60" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">让我们一起总结一下:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="d33e" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">要运行web服务器，只需构建并启动应用程序:</p><pre class="kf kg kh ki gt my mz na nb aw nc bi"><span id="3526" class="nd lo iq mz b gy ne nf l ng nh">cargo run</span></pre><h1 id="8e99" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结论</h1><p id="d074" class="pw-post-body-paragraph kq kr iq ks b kt mf jr kv kw mg ju ky kz mh lb lc ld mi lf lg lh mj lj lk ll ij bi translated">因此，现在您可以调用API端点并创建自己的徽章来显示视图统计信息。</p><p id="4ec8" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">材料:</p><ul class=""><li id="e02d" class="mk ml iq ks b kt ku kw kx kz mm ld mn lh mo ll mp mq mr ms bi translated">示例如何收集和显示一个<a class="ae lm" href="https://github.com/shadeglare" rel="noopener ugc nofollow" target="_blank"> GitHub概要文件</a>的视图。</li><li id="44d6" class="mk ml iq ks b kt mt kw mu kz mv ld mw lh mx ll mp mq mr ms bi translated">完整的源代码可以在<a class="ae lm" href="https://github.com/hexarc-software/hexarc-counter" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</li></ul><p id="5b97" class="pw-post-body-paragraph kq kr iq ks b kt ku jr kv kw kx ju ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">希望这篇教程对你有所帮助。</p></div></div>    
</body>
</html>