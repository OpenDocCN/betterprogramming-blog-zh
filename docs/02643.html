<html>
<head>
<title>ScrollCounter: An Open-Source Pod for Robinhood’s Number Animation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">scroll counter:robin hood数字动画的开源Pod</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/scrollcounter-an-ios-solution-to-the-robinhood-number-animation-bbcbd8c90355?source=collection_archive---------9-----------------------#2019-12-14">https://betterprogramming.pub/scrollcounter-an-ios-solution-to-the-robinhood-number-animation-bbcbd8c90355?source=collection_archive---------9-----------------------#2019-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d9c1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">ScrollCounter将Robinhood整洁的滚动过渡动画带到了iOS和CocoaPods</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/47f31599c47ec0fa5bed4518058f1031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ryYeCPZmKHp2uchDGRWdzQ.jpeg"/></div></div></figure><p id="01d8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Robinhood是app store中制作最好的金融应用之一。这不仅仅是我的观点；他们的iOS应用程序有罕见的“编辑选择”徽章，这是为应用程序商店中最好看和感觉最好的应用程序保留的。</p><p id="9cdd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">他们的iOS应用程序有许多很酷的用户界面功能，我最喜欢的是它们在数字之间转换的动画方式。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lo lp l"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">Robinhood整洁的滚动动画，用于数字之间的转换。</p></figure><p id="6bd0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Robinhood的动画不是开源的，所以我为iOS创建了<a class="ae ln" href="https://github.com/stokatyan/ScrollCounter" rel="noopener ugc nofollow" target="_blank"> ScrollCounter框架</a>，并通过<a class="ae ln" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>提供。</p><p id="1643" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文将从较高的层次来看看ScrollCounter的幕后发生了什么。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="09c9" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">它是如何工作的</h1><h2 id="e5ba" class="mt mc iq bd md mu mv dn mh mw mx dp ml la my mz mn le na nb mp li nc nd mr ne bi translated">这些碎片</h2><p id="530a" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">ScrollCounter框架有三个对象:</p><ol class=""><li id="551b" class="nk nl iq kt b ku kv kx ky la nm le nn li no lm np nq nr ns bi translated"><code class="fe nt nu nv nw b">ScrollableCounter</code>:<strong class="kt ir"/><code class="fe nt nu nv nw b">UIView</code>的一个子类，给出了一个有序的视图数组，可以在其中滚动。</li><li id="29d5" class="nk nl iq kt b ku nx kx ny la nz le oa li ob lm np nq nr ns bi translated"><code class="fe nt nu nv nw b">DigitScrollCounter</code>:是<code class="fe nt nu nv nw b">ScrollableCounter</code>的一个子类，用于滚动一系列数字。</li><li id="69ab" class="nk nl iq kt b ku nx kx ny la nz le oa li ob lm np nq nr ns bi translated"><code class="fe nt nu nv nw b">NumberScrollCounter</code>:管理<code class="fe nt nu nv nw b">DigitScrollCounters</code>集合和标点符号的任何附加视图的<code class="fe nt nu nv nw b">UIView</code>的子类。</li></ol><h2 id="1726" class="mt mc iq bd md mu mv dn mh mw mx dp ml la my mz mn le na nb mp li nc nd mr ne bi translated">ScrollableCounter和DigitScrollCounter</h2><p id="1ee3" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">用一个视图数组初始化一个<code class="fe nt nu nv nw b">ScrollableCounter</code>来滚动，并使用给定数组中每个元素的索引来管理滚动动画。</p><p id="6a66" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从这里开始，我们将视图阵列称为<code class="fe nt nu nv nw b">items</code>。<code class="fe nt nu nv nw b">items</code>的元素可以是任意的<code class="fe nt nu nv nw b">UIView</code>。<code class="fe nt nu nv nw b">DigitScrollCounter</code>是<code class="fe nt nu nv nw b">ScrollableCounter</code>的子类，它使得将<code class="fe nt nu nv nw b">items</code>的元素设置为一个数字范围变得更加容易。</p><p id="1c2b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了在<code class="fe nt nu nv nw b">items</code>中的元素之间制作动画，当前可见的元素用于计算需要“滚动”哪些元素才能到达所需索引处的元素。</p><p id="d076" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">需要滚动的<code class="fe nt nu nv nw b">items</code>中的每个元素都是垂直堆叠的，所有的元素都会立刻动画化。查看<code class="fe nt nu nv nw b">ScrollableCounter</code>中的<code class="fe nt nu nv nw b">setupItemsToAnimate(_:_:)</code>以了解实现细节。</p><p id="02d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">动画在一个方向上(向上或向下),以便滚动最少数量的元素到达其目标。</p><p id="ab72" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，从零滚动到九和从九滚动到零将导致不同方向的动画。在<code class="fe nt nu nv nw b">ScrollableCounter</code>的<code class="fe nt nu nv nw b">calculateDirection(toIndex: Int)</code>查看实现细节。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc lp l"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">左边的DigitScrollCounter显示了动画如何在一个镜头中移动垂直堆叠的视图。当动画中断时，需要制作动画的视图会相对于最可见的视图重新堆叠。</p></figure><p id="16fd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后一步是处理滚动动画的中断。</p><p id="e8bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当一个动画需要停止以允许一个新的动画时，我们认为它是“中断的”。当<code class="fe nt nu nv nw b">ScrollableCounter</code>在没有完成当前播放动画的情况下被更新时，就会发生这种情况。</p><p id="36d0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当动画中断时，需要确定<em class="od">最可见元素</em>的索引。一旦确定了索引，要滚动的新元素相对于当前元素进行堆叠(“当前元素”是项目中与最可见的元素相对应的元素)。</p><h2 id="845c" class="mt mc iq bd md mu mv dn mh mw mx dp ml la my mz mn le na nb mp li nc nd mr ne bi translated">数字滚动计数器</h2><p id="c2f0" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">一个<code class="fe nt nu nv nw b">NumberScrollCounter</code>是一个<code class="fe nt nu nv nw b">DigitScrollCounters</code>和“标点符号”视图的集合，它们被组合在一起以允许在一个无限的数字范围内滚动。</p><p id="1e8d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，<code class="fe nt nu nv nw b">NumberScrollCounter</code>根据需要编排<code class="fe nt nu nv nw b">DigitScrollCounter</code>和标点符号。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/71097ce12cf53c2497077252be4b1f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*4kBX64VCwHI1YZYyyNkqrQ.jpeg"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated"><code class="fe nt nu nv nw b">NumberScrollCounter arranges each DigitScrollCounter individually, and accounts for any additional views needed for punctuation.</code></p></figure><p id="9b1d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当<code class="fe nt nu nv nw b">NumberScrollCounter</code>的值改变时，只要将<code class="fe nt nu nv nw b">DigitScrollCounters</code>和标点从当前位置移动到新的目标位置即可。</p><p id="4b18" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这意味着对于<code class="fe nt nu nv nw b">NumberScrollCounter</code>动画被中断的情况不需要特别注意。简单来说，<code class="fe nt nu nv nw b">DigitScrollCounter</code>就是四处移动，根据需要淡入淡出。</p><p id="e6c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当布局被动画化时，每个单独的<code class="fe nt nu nv nw b">DigitScrollCounter</code>被动画化为任何需要的元素，以便<code class="fe nt nu nv nw b">NumberScrollCounter</code>更新其值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of lp l"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">水平滑动动画和淡入淡出动画将数字滚动计数器和标点符号视图发送到它们需要的位置。结合每个单独的DigitScrollCounter的滚动动画，这就产生了所需的Robinhood风格的过渡动画。</p></figure><p id="0d92" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，由于<code class="fe nt nu nv nw b">NumberScrollCounter</code>是<code class="fe nt nu nv nw b">UIView</code>的子类，它的框架应该随着它的子视图的更新而更新。</p><p id="864d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nt nu nv nw b">NumberScrollCounter</code>的框架应该根据其<code class="fe nt nu nv nw b">DigitScrollCounter</code>和“标点符号”视图的最终布局进行更新。</p><p id="da81" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这只是简单的任务，找到限制在<code class="fe nt nu nv nw b">NumberScrollCounter</code>中使用的所有视图的最小宽度和高度。检查<code class="fe nt nu nv nw b">sizeToFit()</code>的覆盖以了解实施细节。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og lp l"/></div><p class="lq lr gj gh gi ls lt bd b be z dk translated">可以调整整个NumberScrollCounter的框架(红色轮廓)的大小，以适合显示的数字(或正在动画显示的数字)。</p></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="60cf" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">结束</h1><p id="a685" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">所涉及的数学可能有点繁琐，所以我在本文中省略了它，但是您可以自己随意看看源代码，如果您有任何问题或评论，请联系我们:<a class="ae ln" href="https://github.com/stokatyan/ScrollCounter" rel="noopener ugc nofollow" target="_blank">GitHub上的源代码。</a></p><p id="3899" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你在这篇文章中做到了这一步，我希望你发现它有用，享受ScrollCounter！</p></div></div>    
</body>
</html>