<html>
<head>
<title>API-First Development: Build Consistent, Meaningful APIs With Postman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">API优先开发:用Postman构建一致的、有意义的API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/api-first-development-build-consistent-meaningful-apis-with-postman-db7d1e9e8b5c?source=collection_archive---------6-----------------------#2020-09-15">https://betterprogramming.pub/api-first-development-build-consistent-meaningful-apis-with-postman-db7d1e9e8b5c?source=collection_archive---------6-----------------------#2020-09-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cda6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用开放API规范和Postman构建强大的API</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/235e8f2142d33743d8676b0a95e68db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKT8-jcNDlIxbc0FdWXxig.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Josue Isai Ramos Figueroa 在<a class="ae ky" href="https://unsplash.com/s/photos/construction-worker?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的背景照片。</p></figure><p id="ff4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们生活在一个真正的革命时代。</p><p id="22a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">家居用品变得越来越智能，服务假设你的行为(而且通常是正确的！)，事情就自动完成了。</p><p id="0bee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着人工智能和人工智能迅速进入我们的生活，事情变得越来越简单。更方便。好多了。</p><p id="f192" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我的闹钟在早上响起时，我可以让它启动我的毛巾加热器。当我洗完澡的时候，我有一条漂亮的热毛巾可以用来擦干。这是怎么发生的？一切都有联系吗？</p><p id="c9ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从某种意义上说，是的。</p><p id="3843" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几乎所有东西都有一个API(应用程序编程接口),可以访问和控制某些功能。随着面向公众的API成为规范，标准必须到位，以便将服务连接在一起既容易又直观。</p><p id="0044" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看如何开始为您的应用带来一致的API，从而加入这场变革。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="72c3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">站台</h1><p id="0604" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你想要一个可以集设计、开发、测试和观察于一体的地方。<a class="ae ky" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">进入邮递员</a>。</p><p id="fe85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Postman处理<a class="ae ky" href="https://swagger.io/blog/api-strategy/what-is-api-lifecycle-management/" rel="noopener ugc nofollow" target="_blank"> API生命周期</a>的所有组件，为开发团队的所有成员提供无缝体验。</p><p id="f8c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分析师可以描述数据形状，开发人员可以构建端点和后端代码的连接，QA可以验证响应是否符合设计，技术人员可以在Markdown中构建漂亮的文档，自动化工程师可以构建复杂的工作流来测试它。</p><p id="d2ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更不用说，该应用程序允许对几乎每个组件进行完全的源代码控制和评论/协作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9c2c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">目标</h1><p id="10e2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当你决定采用API优先时，你到底在承诺什么？是什么给了你这样说的能力？</p><p id="bf62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想一想你的消费者——内部的和外部的。他们想从API中得到什么？</p><ul class=""><li id="5cce" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">可消费性</li><li id="c5e6" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">一致性</li><li id="0885" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">清除文档</li></ul><p id="f19e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">三个C。消费者不关心你的构建管道或者你的开发实践。他们关心最终产品。他们关心这三件简单的事情。</p><p id="1323" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为工程团队，你的目标是提供一个满足这些需求的API(同时解决业务问题！).要做到这一点，您需要在使用API时努力提供最佳体验。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9a8f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">可消费性</h1><p id="376a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以构建几种类型的API，Postman有能力处理所有这些API。但是我们想和大人物一起进去。我们的API应该与像谷歌、微软、易贝、IBM这样的公司并肩而坐。</p><p id="88fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们会做一个由<a class="ae ky" href="https://www.openapis.org/" rel="noopener ugc nofollow" target="_blank"> OpenAPI规范(OAS) </a>定义的REST API。</p><p id="0cf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">遵循标准不仅为我们提供了一个简单的格式化参考指南，还为我们提供了工作示例、社区支持，以及由于熟悉的结构而增加的易用性。API的消费者可能以前见过OAS，这正是我们想要的。</p><p id="5d61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最棒的是，Postman完全支持它，所以我们所要做的就是点击New -&gt; API并填写下面的表单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/49283c3e8cfa9740b93f785653e4636b.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/0*AzD7RWt2REiiWLDk.jpg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="no">邮递员中的新API对话框</em></p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="144e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设计API第一</h1><p id="03ec" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">按照API优先的思想，在编写一行代码之前，您将定义端点、请求和响应中的数据形状以及预期的状态代码。</p><p id="27e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用OpenAPI，这很容易管理。事实上，OAS文件的主要部分是<code class="fe np nq nr ns b">paths</code>(端点)和<code class="fe np nq nr ns b">components</code>(请求和响应)。定义这些主要部分将允许我们可视化API的形状，并向我们展示我们将能够用它做什么。</p><p id="4864" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://github.com/allenheltondev/gopher-holes-unlimited/" rel="noopener ugc nofollow" target="_blank">我虚构的业务</a>、<em class="nt">地鼠洞无限</em>中，我们想要跟踪两种主要类型的实体:<code class="fe np nq nr ns b">Gophers</code>和<code class="fe np nq nr ns b">Holes</code>。我们需要做的第一件事是弄清楚地鼠和洞的数据元素是什么。</p><p id="c87d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是OAS3.0中定义的<code class="fe np nq nr ns b">Hole</code>实体，每个字段都有一个有意义的描述和一个在<code class="fe np nq nr ns b">components\schemas</code>部分定义的例子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/172d655fc76c971e07747ae14fb7f2da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/0*ek99oA3OkCQys2p3.jpg"/></div></figure><p id="0970" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以看到我们唯一需要的字段是<code class="fe np nq nr ns b">location</code>，但是我们有很多其他属性可以用来帮助定义这个洞。</p><p id="a743" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将对<a class="ae ky" href="https://github.com/allenheltondev/gopher-holes-unlimited/blob/master/gopher-holes-unlimited-openapi.yaml#L220" rel="noopener ugc nofollow" target="_blank"> Gopher </a>做同样的事情，然后继续定义我们的端点。</p><p id="34f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的业务是帮助人们追踪地鼠和它们的洞。因此，我们需要能够轻松提供这种功能的终端。</p><ul class=""><li id="2ac1" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">添加新的地鼠/洞— <code class="fe np nq nr ns b">POST</code></li><li id="3808" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">更新地鼠/洞细节— <code class="fe np nq nr ns b">PUT</code></li><li id="220c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">获得所有地鼠/洞的列表— <code class="fe np nq nr ns b">GET</code></li><li id="cb1c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">获取特定地鼠/洞的详细信息— <code class="fe np nq nr ns b">GET</code></li><li id="e78b" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">给球洞添加新状态— <code class="fe np nq nr ns b">POST</code></li></ul><p id="483c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到这些需求，我们可以使用适当的HTTP方法和<a class="ae ky" href="https://restfulapi.net/resource-naming/" rel="noopener ugc nofollow" target="_blank"> REST结构</a>在OpenAPI规范中构建我们的端点。</p><p id="60ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们规范的<code class="fe np nq nr ns b">paths</code>部分，我们定义了如下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/8be3e8440c78296784fd85b7742d2b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GInLlQWkz7OV4WnA.jpg"/></div></div></figure><p id="4f7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们制作了端点<code class="fe np nq nr ns b">/gophers</code>，将其设置为<code class="fe np nq nr ns b">POST</code>，并在<a class="ae ky" href="https://www.markdownguide.org/" rel="noopener ugc nofollow" target="_blank"> Markdown </a>中对其进行了总结和有意义的描述。我们还使用我们的<code class="fe np nq nr ns b">Gopher</code>实体作为主体的定义，并声明了一些可以从<code class="fe np nq nr ns b">POST</code>返回的标准响应。</p><p id="464c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们所要做的就是为我们的需求的其余部分继续这种格式，我们将拥有我们自己定义的API！为了节省我们的时间，我已经为你做了，并包含在Gopher Holes Unlimited的GitHub repo中。</p><p id="59e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在您的Postman工作区中设置Gopher Holes Unlimited API，请按照以下步骤操作:</p><ol class=""><li id="c8e2" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu nw nf ng nh bi translated">分叉<code class="fe np nq nr ns b">gopher-holes-unlimited</code> repo，并将其克隆到您的机器上。</li><li id="4f20" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">在您的Postman工作区中，点击New -&gt; API并填写对话框。</li><li id="d35f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">将API连接到GitHub中的OAS文件。</li><li id="ca85" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">从API选项卡中选择API。</li><li id="d122" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">单击定义链接。</li><li id="2b17" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">单击连接存储库按钮。</li><li id="fa96" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">按照指南将Postman连接到repo。</li></ol><h2 id="bb50" class="nx md it bd me ny nz dn mi oa ob dp mm li oc od mo lm oe of mq lq og oh ms oi bi translated">预览您的API</h2><p id="c785" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">看一个API的定义是一回事，但是看它的实际应用完全是另一回事。再说一次，因为我们正在构建这个API，首先，我们还不想写任何代码。我们仍处于定义阶段。</p><p id="a98d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是时候使用Postman做它最擅长的事情了:发送web请求。</p><p id="38a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建了API并与源代码同步后，我们需要创建一个模拟服务器，它将在我们的端点接受请求并返回我们在规范中定义的示例值。</p><p id="584a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Postman中选择API后:</p><ol class=""><li id="4c0e" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu nw nf ng nh bi translated">单击“开发”选项卡。</li><li id="601a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">点击添加模拟服务器-&gt;创建新的模拟服务器。</li><li id="7365" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">为模拟服务器集合命名，并将文件夹组织高级设置更改为Tags。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/99460dfa4e43236b18ddeff90d625cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KLvyIiV97L_mf8St.jpg"/></div></div></figure><ol class=""><li id="524e" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu nw nf ng nh bi translated">在下一个屏幕上，命名模拟服务器并选择“将模拟服务器URL保存为环境变量”复选框。</li><li id="dee1" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">点击创建模拟服务器。</li></ol><p id="839d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了一个服务器，可以测试我们的API了！</p><p id="a888" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在幕后，Postman基于我们的OAS文件构建了一个包含示例请求和响应的集合。它还用我们定义的端点为我们设置了一个web服务器，并将其配置为返回示例。模拟服务器将返回链接集合中定义的响应，所以在修改请求时要小心！</p><p id="fb30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们单击集合中的一个请求，选择为模拟服务器创建的环境，并点击Send，我们可以看到一个示例返回来自OAS文件的值！</p><p id="31ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看请求和响应细节将有助于我们获得消费我们的API的真实视图。从这里，我们可以修补定义文件，重新生成集合，并微调我们的API！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/335db83252acf8055b390ef175251f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/0*kgWs_YeIssF5GnZX.jpg"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a4c1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一致性</h1><p id="79e7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当你的API的消费者启动并运行时，我有消息告诉你:他们不想回来维护他们与你的集成。他们想建立一次，让它永远工作。</p><p id="f15b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">老实说，这不是一个不合理的期望。当我在家里更换灯泡时，我并不指望每周都回去拧紧它。</p><p id="9231" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么这对你的API意味着什么呢？好吧，如果你有意识地努力使你的API既可靠又向后兼容，你会有满意的消费者。</p><h2 id="4817" class="nx md it bd me ny nz dn mi oa ob dp mm li oc od mo lm oe of mq lq og oh ms oi bi translated">可靠性</h2><p id="271c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当一个API是可靠的，它有很高的正常运行时间和一致的结果。你是如何设计的？</p><p id="0bf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从API优先的方法来看，这意味着我们需要主动监控我们的API，以便我们可以在消费者之前发现任何停机时间。最简单的方法是使用测试套件。</p><p id="5832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Postman中，一个测试套件是一个自动化请求的集合，它们建立在另一个之上以执行一个工作流。一个请求的响应包含一个我们在下一个请求中使用的值，依此类推。</p><p id="2a09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试套件不仅为您提供了可靠性，还为您提供了确保API提供一致结果的工具。如果预期的结果总是<em class="nt"> X </em>，我们可以在测试套件中编写JavaScript断言来确保结果不是<em class="nt"> Y </em>。</p><p id="f8f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Gopher Holes Unlimited中，我们希望构建一个自动验证以下内容的工作流:</p><ul class=""><li id="21fb" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">添加新的地鼠。</li><li id="d2d4" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">验证新的gopher在<code class="fe np nq nr ns b">List All</code>端点返回。</li><li id="c83a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">添加一个与新地鼠相关联的洞。</li><li id="a7bd" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">将孔状态设置为已填充。</li><li id="493a" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">验证孔的详细信息是否已更新。</li></ul><p id="ef83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用我们之前生成的模拟服务器集合，我们可以将请求复制并粘贴到我们的测试套件集合中来构建工作流。该集合应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/9fb4870c6f7ef5fd3296e03711fc2870.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/0*14QUjAQjQ9en6REQ.jpg"/></div></figure><p id="3bf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们所要做的就是加入一些测试，然后<a class="ae ky" href="https://blog.postman.com/extracting-data-from-responses-and-chaining-requests/" rel="noopener ugc nofollow" target="_blank">将请求</a>链接在一起，我们就有了一个自动化的工作流程！</p><p id="16cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了节省时间，我构建了测试套件集合，并将它添加到GitHub repo 中。您需要做的就是从文件中导入集合。</p><p id="04e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了自动化的工作流，我们现在只需要定期运行它来确保API保持健康。再一次，Postman通过<a class="ae ky" href="https://learning.postman.com/docs/designing-and-developing-your-api/monitoring-your-api/intro-monitors/" rel="noopener ugc nofollow" target="_blank">创建一个监视器</a>提供了一个简单的方法。</p><p id="ba2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该监视器将在一周中的特定日期的特定时间运行，如果我们的任何测试失败，它将返回报告。下面，我们可以看到运行我们的自动化测试的结果，并验证事情是健康的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/a8470665bf23bf1d45dd3ebc410d6728.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SgN1s0Cgt6Ge7FPS.jpg"/></div></div></figure><h2 id="efa0" class="nx md it bd me ny nz dn mi oa ob dp mm li oc od mo lm oe of mq lq og oh ms oi bi translated">向后兼容性</h2><p id="fe07" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们都有过这样的经历:我们热爱并每天使用的服务突然停止工作。昨天还能用，今天就不行了。</p><p id="a972" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不，服务没有中断。他们刚刚实现了一个<a class="ae ky" href="https://community.blackbaud.com/blogs/69/3219" rel="noopener ugc nofollow" target="_blank">突破性的改变</a>。不管他们知不知道，他们是为了你才打破的。现在你必须回去，改变你已经工作了这么久的集成中的一些东西。</p><p id="3944" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你不希望你的API这样做。你有意识地设计你的API来避免破坏性的改变。显然，总有一天你需要做出突破性的改变，但是如果你记住这些规则，你可以避免不必要的休息:</p><ul class=""><li id="e2fa" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">不要向API添加新的必填字段。相反，添加可选字段。</li><li id="d515" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">不要删除任何字段。相反，请尝试在文档中将这些字段标记为不推荐使用。</li><li id="0bd7" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">不要改变你回答的形式。添加新字段没问题，但是不要开始嵌套以前没有嵌套的值。</li><li id="9867" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">不要重命名字段。相反，添加新名称作为新字段，并取消旧字段名称。</li></ul><p id="8262" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多方法可以对一个API进行突破性的修改，但是遵循上面的四个问题应该可以让你在很大程度上了解。</p><p id="d7f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想确保您不会在不知不觉中做出破坏性的更改，您可以向您的自动化测试添加一个类似于<code class="fe np nq nr ns b">ajv</code>的模式验证检查器，以验证数据的形状没有改变。</p><p id="905b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">额外的好处:您可以在您的CI管道中包含您的自动化测试，并且如果您的测试失败，强制构建失败。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ec01" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">清除文档</h1><p id="c197" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">好消息！通过为每个路径、请求、响应和模式提供描述和示例，您已经在API文档中取得了巨大的进步。</p><p id="dd04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">易于使用的API的关键部分是文档。“这个端点是做什么的？这种价值从何而来？此枚举的可接受值是什么？</p><p id="2845" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些都是你的消费者在使用你的API时会遇到的问题。为他们提供答案是你的工作。</p><p id="9765" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开箱即用，Postman基于一个集合生成漂亮的HTML页面。它支持每一级的Markdown，提供了一个机会来制作一个非常棒的文档页面，易于理解。</p><p id="163d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这还不够，它还为开发人员提供了如何用他们选择的语言调用每个端点的代码片段。</p><p id="78c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以在生成的文档上添加一个自定义域，这意味着我可以毫无问题地将文档添加到docs.gopherholesunlimited.com的<em class="nt">中！</em></p><p id="5ff3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能希望将文档与模拟服务器集合分开，所以如果您导航回API选项卡:</p><ol class=""><li id="b2e3" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu nw nf ng nh bi translated">单击“开发”选项卡。</li><li id="3510" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">选择添加文档-&gt;创建新文档。</li><li id="fa43" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nw nf ng nh bi translated">为该集合命名，然后点击“创建文档”。</li></ol><p id="b715" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦创建了文档集合，您可以单击API的文档部分下的链接，它将直接带您到生成的文档。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/71ba60d5a9558c02805347e12f435e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ez35-xbuzjrgoshS.jpg"/></div></div></figure><p id="640f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Postman构建的文档将从您的OAS文件中获取信息，丰富文档集合中的请求，然后在web上呈现如下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/30ee3a97aebbe881e78d249d0952d470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QfBPrhqNtnwoUMWY.jpg"/></div></div></figure><p id="f2cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与模拟服务器一样，您可以查看生成的输出，更新OpenAPI规范，重新生成集合，并在web上查看更新以微调您的API细节。</p><p id="0ee1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名开发人员，当我看到这样的文档时，我知道我正在与一家知道他们在做什么的公司合作。他们花时间提供有意义的例子，详细描述每个领域，并对请求进行适当的分类。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="99d4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">包扎</h1><p id="6a1c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我只是对API优先的可能性略知一二。</p><p id="ccdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加<a class="ae ky" href="https://www.postman.com/webinars/api-governance/" rel="noopener ugc nofollow" target="_blank"> API治理</a>，使用<a class="ae ky" href="https://learning.postman.com/docs/running-collections/using-newman-cli/command-line-integration-with-newman/" rel="noopener ugc nofollow" target="_blank"> Postman CLI </a>在构建过程的每一步执行工作流，以及为第三方集成商编写专门的集成文档，这些都是您可以将触角延伸到API第一世界的方式。</p><p id="6e19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您已经获得了设计和开发API的工具。你现在要做的就是实现它。</p><p id="83fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最棒的是，一旦你的API被实现，你可以简单地在你的环境中替换掉<code class="fe np nq nr ns b">url</code>字段，所有的自动化测试现在都指向真实的东西！你可以确保你构建的是正确的，因为你不仅构建了API优先，而且你还做了<a class="ae ky" href="https://en.wikipedia.org/wiki/Test-driven_development" rel="noopener ugc nofollow" target="_blank">测试驱动开发(TDD) </a>。</p><p id="2fde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对你的API设计要有意识。把你的努力放在易用性、一致性和清晰的文档上。成为其他公司学习的榜样。坚持一个标准。建造伟大的东西。</p><pre class="kj kk kl km gt op ns oq or aw os bi"><span id="9854" class="nx md it ns b gy ot ou l ov ow">**POST** /blogs <br/>{ <br/>  content: 'awesome', <br/>  readerEnjoyability: 100, <br/>  shareWithFriends: true <br/>}</span></pre></div></div>    
</body>
</html>