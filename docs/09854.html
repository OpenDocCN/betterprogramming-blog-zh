<html>
<head>
<title>Deploy a “RemindMe” Reddit Bot Using AWS Lambda and EventBridge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda和EventBridge部署一个“RemindMe”Reddit Bot</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploy-a-reddit-bot-using-aws-lambda-and-eventbridge-7df793b979b2?source=collection_archive---------8-----------------------#2021-10-21">https://betterprogramming.pub/deploy-a-reddit-bot-using-aws-lambda-and-eventbridge-7df793b979b2?source=collection_archive---------8-----------------------#2021-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="72d5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过无服务器轻松安排AWS Lambda功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/abe295e51f6954c3159126870d8b2e1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iOTkbHoYWuv_yVmQXZ292w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">布雷特·乔丹摄于Pexels。</p></figure><h1 id="60f3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">目录</h1><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="b26a" class="lw la it ls b gy lx ly l lz ma">Introduction<br/>Register a Reddit bot<br/>Create a RemindMe bot with praw<br/>Deploy the service to Lambda and run it on a schedule<br/>Complete scripts<br/>Conclusion<br/>References</span></pre><h1 id="88bb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="7489" class="pw-post-body-paragraph mb mc it md b me mf ju mg mh mi jx mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">什么是Reddit机器人？我可以造一个吗？我该怎么做？运行它们很贵吗？这些只是我在开始实现自己的Reddit机器人之前的几个问题。</p><p id="6c86" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">让我们从头开始。Reddit机器人是一个可以自动跟踪帖子、评论或回复的应用程序。你可以创建一个机器人来识别和自动标记NSFW的帖子，禁止用户使用攻击性的语言，检查事实，或者简单地用一个模因来回复。</p><p id="bcf9" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">Reddit不仅允许你建立一个机器人，而且鼓励你这样做。你怎么可能会问？通过它的官方应用程序编程接口(接下来会详细介绍)。</p><p id="1d81" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">你怎么做到的？个人认为最简单的方法是使用Python库<em class="nc"> praw </em>。这个库简化了你如何连接到Reddit API，如何阅读消息，检测提及以及如何回复。</p><p id="86f2" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">运行它们很贵吗？嗯，看情况。你需要多久跑一次步？每毫秒、每秒、每分钟或每小时？您需要跟踪多少子条目、用户或消息？如果您每次只处理几条消息，并且只需要每隔几分钟处理一次，那么您可能可以免费完成这项工作(使用AWS免费层)。</p><p id="aa3c" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">在这篇文章中，我将总结使用AWS Lambda⁴和EventBridge⁵.免费构建提醒机器人的关键概念</p><h1 id="70d6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">注册一个Reddit机器人</h1><p id="62e7" class="pw-post-body-paragraph mb mc it md b me mf ju mg mh mi jx mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">好，你需要两样东西:</p><ol class=""><li id="d4c7" class="nd ne it md b me mx mh my mk nf mo ng ms nh mw ni nj nk nl bi translated">Reddit用户帐户(如果您还没有的话)。只需按照此<a class="ae ky" href="https://www.reddit.com/register/" rel="noopener ugc nofollow" target="_blank">链接</a>中的说明进行操作。我建议为机器人创建一个新的用户帐户。</li><li id="69d8" class="nd ne it md b me nm mh nn mk no mo np ms nq mw ni nj nk nl bi translated">要注册您的新Reddit机器人，请点击<a class="ae ky" href="https://ssl.reddit.com/prefs/apps/" rel="noopener ugc nofollow" target="_blank">此处</a>。在<code class="fe nr ns nt ls b">Name</code>部分输入你的机器人名称；选择<code class="fe nr ns nt ls b">script</code> <strong class="md iu"> </strong>选项<strong class="md iu"> </strong>(脚本自用)；在<code class="fe nr ns nt ls b">redirect uri</code> <strong class="md iu"> </strong>部分键入一个随机url(这是必填字段)；点击<code class="fe nr ns nt ls b">create app</code>。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/6a19cb12dc3a51151b471bcff5683acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5hsmGdx7Lvo7qPtcnDo3g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如何创建一个Reddit机器人？点击<a class="ae ky" href="https://ssl.reddit.com/prefs/apps/" rel="noopener ugc nofollow" target="_blank">这里</a>进行注册。作者截图。</p></figure><p id="2b57" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">如果一切顺利，你现在应该看到与你的机器人相关的两个重要键:一个<code class="fe nr ns nt ls b">client_id</code>(就在“个人使用脚本”下)和一个<code class="fe nr ns nt ls b">secret</code>。请记住这些，因为我们将在下一节用到它们。</p><h1 id="6a1c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">用praw创建一个提醒机器人</h1><p id="b10a" class="pw-post-body-paragraph mb mc it md b me mf ju mg mh mi jx mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">首先在一个新环境中安装<code class="fe nr ns nt ls b">praw</code>库，并将已安装的包保存在一个<code class="fe nr ns nt ls b">requirements.txt</code>文件中(我们稍后会用到)。Praw是我们将用来与Reddit API交互的库。您可以简单地将下面的片段复制到一个新的终端窗口。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="71f1" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">现在，要连接到Reddit API，您需要上面生成的bot凭证以及您的用户凭证。按照下面的片段连接并阅读收件箱中的前5封邮件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="7409" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">在本教程中，我们将创建一个机器人，提醒用户一个线程，评论或个人信息，以便稍后检查。如果你经常使用Reddit，你可能已经在使用一个类似我们描述的机器人:RemindMeBot⁶.</p><p id="1473" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">为了创建我们的新机器人，我们需要能够:从收件箱中读取新消息(就像上面的例子)；提取到预期提醒的时间；回复消息。</p><p id="7b5d" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">让我们创建第一个函数，从收件箱中读取消息并处理提醒请求。为了跟踪我们解析的消息，我们将使用S3。该函数的一个示例如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="3a72" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">我们的第二个也是最后一个函数将加载任何用<code class="fe nr ns nt ls b">save_unread_requests()</code>处理过的S3文件，如果当前时间超过了提醒时间，就给用户发送一条提醒消息。该函数的一个示例如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="3d95" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">我们现在可以顺序运行这两个函数来检查任何未读的消息，然后检查是否有任何已处理的请求可以被满足。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="ecad" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">万岁！我们刚刚创建了一个Reddit机器人，可以回复提及或pm。让我们试一试，从不同的帐户向<code class="fe nr ns nt ls b">YOUR_USER_ACCOUNT_NAME</code>发送一个PM，主题为'<strong class="md iu"> remindme 2m </strong> ' <strong class="md iu"> </strong>，正文中包含任何文本。如果一切顺利，您应该会收到来自机器人的两条消息，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/fddefb546725515989debb0370d84d0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mP6QcO2aW252QnA7CiSC_g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">bot“copy reminder”正在回复用户提醒请求。作者截图。</p></figure><h1 id="a1be" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">将服务部署到Lambda并按计划运行它</h1><p id="c07b" class="pw-post-body-paragraph mb mc it md b me mf ju mg mh mi jx mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">困难的部分已经完成了。使用Docker +无服务器框架将Python服务上传到Lambda非常容易。</p><p id="dade" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">如果你没有看过我以前的文章“用Amazon Lambda和API Gateway  ⁷构建一个无服务器API”，我强烈推荐你学习其他与Amazon Lambda函数交互的方法，以便更深入地理解无服务器框架。</p><p id="6e18" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">因此，对于这个例子，让我们首先创建一个包含我们的应用程序(机器人)的<code class="fe nr ns nt ls b">Dockerfile</code>文件。在此阶段需要记住几个关键概念:</p><ol class=""><li id="1051" class="nd ne it md b me mx mh my mk nf mo ng ms nh mw ni nj nk nl bi translated">从<code class="fe nr ns nt ls b">public.ecr.aws/lambda</code>中选择支持的图像</li><li id="fcbb" class="nd ne it md b me nm mh nn mk no mo np ms nq mw ni nj nk nl bi translated">安装所有需要的包(还记得我们之前创建的<code class="fe nr ns nt ls b">requirements.txt</code>文件吗？)</li><li id="0e32" class="nd ne it md b me nm mh nn mk no mo np ms nq mw ni nj nk nl bi translated">将您的应用程序复制到Docker容器中。你可以在这里找到<code class="fe nr ns nt ls b">app.py</code>文件<a class="ae ky" href="https://github.com/andreRibeiro1989/medium/blob/main/reddit_bot_lambda_schedule/app/app.py" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="eb10" class="nd ne it md b me nm mh nn mk no mo np ms nq mw ni nj nk nl bi translated">确保最后的命令指向您想要运行的函数。在这种情况下，我们想要运行<code class="fe nr ns nt ls b">app.py</code>文件中的<code class="fe nr ns nt ls b">lambda_handler</code>函数。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="80eb" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">现在让我们创建<code class="fe nr ns nt ls b">serverless.yml</code>文件，该文件用于通过无服务器框架创建我们需要的所有AWS服务。对于这项服务，我们需要:</p><ol class=""><li id="f51c" class="nd ne it md b me mx mh my mk nf mo ng ms nh mw ni nj nk nl bi translated">将praw和S3路径的凭证定义为环境变量。我们也可以直接在<code class="fe nr ns nt ls b">app.py</code>文件中设置它们，但是如果我们改变凭证或S3路径，就会使容器不可用。</li><li id="a488" class="nd ne it md b me nm mh nn mk no mo np ms nq mw ni nj nk nl bi translated">允许Lambda从我们定义的存储已处理提醒请求的S3位置读取、写入和删除。</li><li id="aec2" class="nd ne it md b me nm mh nn mk no mo np ms nq mw ni nj nk nl bi translated">定义通过EventBridge (CloudWatch事件)调用Lambda函数的计划速率，以检查未读消息并完成任何未完成的请求。</li></ol><p id="0a72" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">请注意，在下面的代码片段中，您必须用自己的凭据替换凭据占位符。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="a03b" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">现在在根目录(Dockerfile和serverless.yml文件所在的位置)运行<code class="fe nr ns nt ls b">serverless deploy</code>来部署Lambda函数。</p><p id="6fa2" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">为了测试它是否有效，向<code class="fe nr ns nt ls b">YOUR_USER_ACCOUNT_NAME</code>发送一条新消息，主题为“remind me 2m”<strong class="md iu"/>，正文中包含任何文本。</p><h1 id="ec30" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">完成脚本</h1><p id="6dfb" class="pw-post-body-paragraph mb mc it md b me mf ju mg mh mi jx mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">如需完整的脚本，请点击以下链接进入我的GitHub页面:</p><div class="ny nz gp gr oa ob"><a href="https://github.com/andreRibeiro1989/medium/tree/main/reddit_bot_lambda_schedule" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">medium/Reddit _ bot _ lambda _ schedule at main and Ribeiro 1989/medium</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">具有AWS Lambda和EventBridge的Reddit bot服务</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op ks ob"/></div></div></a></div></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><h1 id="d756" class="kz la it bd lb lc ox le lf lg oy li lj jz oz ka ll kc pa kd ln kf pb kg lp lq bi translated">结论</h1><p id="012b" class="pw-post-body-paragraph mb mc it md b me mf ju mg mh mi jx mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">构建和维护一个Reddit机器人并不困难，也不昂贵。通过开发无服务器计算，人们可以开发和部署一个不需要花费太多的弹性机器人。</p><p id="d619" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">这个简单的例子应该给你所有必要的工具来构建更复杂的Reddit机器人，如情感/对话、事实检查或仇恨言论检测机器人。</p><p id="f026" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">如果你想了解更多关于无服务器计算的知识，请查看我以前的文章:</p><ul class=""><li id="bbdd" class="nd ne it md b me mx mh my mk nf mo ng ms nh mw pc nj nk nl bi translated"><a class="ae ky" href="https://towardsdatascience.com/build-a-serverless-api-with-amazon-lambda-and-api-gateway-dfd688510436" rel="noopener" target="_blank">用亚马逊Lambda和API网关</a> ⁷构建一个无服务器API</li><li id="b2c1" class="nd ne it md b me nm mh nn mk no mo np ms nq mw pc nj nk nl bi translated">使用亚马逊S3和⁸53号公路建立一个无服务器网站</li></ul><h1 id="dcef" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考</h1><p id="552f" class="pw-post-body-paragraph mb mc it md b me mf ju mg mh mi jx mj mk ml mm mn mo mp mq mr ms mt mu mv mw im bi translated">[1] Reddit团队。"<em class="nc"> Reddit api文档</em>【https://www.reddit.com/dev/api/】<br/>T3</p><p id="a068" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">[2]布莱斯·博伊斯。https://praw.readthedocs.io/en/stable/:<em class="nc">PRAW:Python Reddit API包装器</em><br/><a class="ae ky" href="https://praw.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"/></p><p id="f022" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">[3]亚马逊团队。"<em class="nc"> AWS自由层</em>"<br/><a class="ae ky" href="https://aws.amazon.com/free" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/free</a></p><p id="39a4" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">[4]亚马逊团队。<em class="nc">AWS Lambda</em><br/><a class="ae ky" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/lambda/</a></p><p id="508a" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">[5]亚马逊团队。<em class="nc">亚马逊事件桥</em><br/><a class="ae ky" href="https://aws.amazon.com/eventbridge/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/eventbridge/</a></p><p id="4df4" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">[6] u/Watchful1。"<em class="nc">remind mebot Info v 2.1</em>"<a class="ae ky" href="https://www.reddit.com/r/RemindMeBot/comments/e1bko7/remindmebot_info_v21/" rel="noopener ugc nofollow" target="_blank">https://www . Reddit . com/r/remind mebot/comments/E1 bko 7/remind mebot _ Info _ v21/</a></p><p id="0d4e" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">7 a .里贝罗。"<em class="nc">用亚马逊Lambda和API网关</em>构建无服务器API "<br/><a class="ae ky" href="https://towardsdatascience.com/build-a-serverless-api-with-amazon-lambda-and-api-gateway-dfd688510436" rel="noopener" target="_blank">https://towardsdatascience . com/Build-a-server less-website-using-Amazon-S3-and-route-53-c 741 FAE 6 ef 8d</a></p><p id="fc1a" class="pw-post-body-paragraph mb mc it md b me mx ju mg mh my jx mj mk mz mm mn mo na mq mr ms nb mu mv mw im bi translated">8 a .里贝罗。"<em class="nc">使用亚马逊S3和Route 53</em>"<br/><a class="ae ky" href="https://towardsdatascience.com/build-a-serverless-website-using-amazon-s3-and-route-53-c741fae6ef8d" rel="noopener" target="_blank">https://towards data science . com/Build-a-server less-website-using-Amazon-S3-and-Route-53-c 741 FAE 6 ef 8d</a></p></div></div>    
</body>
</html>