<html>
<head>
<title>Uploading Files to S3 Using Express and React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Express和React将文件上传到S3</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/uploading-files-to-s3-using-express-and-react-7da0e7a91596?source=collection_archive---------3-----------------------#2022-11-01">https://betterprogramming.pub/uploading-files-to-s3-using-express-and-react-7da0e7a91596?source=collection_archive---------3-----------------------#2022-11-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1946" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这一宝贵功能的简要指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/24732d43edf78db905aa56f1df775cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2r2YtFhLSM8FunCf"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@hharritt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亨特·哈里特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="1b3b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">目标</h1><p id="a00b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我想要一个系统，在那里我可以:<br/> 1。使用HTML <code class="fe mk ml mm mn b">input</code>在我的电脑上选择一个CSV文件<br/> 2。使用Express服务器<br/> 3生成预先指定的URL。将来自React的CSV文件放入S3 <br/> 4。使用Express服务器成功上传后，阅读文件内容</p><p id="07ff" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">这个想法是，我希望我的服务器处理来自用户的CSV文件，但是我还希望保存该文件的副本以供审计。出于这个原因，我将介绍S3的持久性。在我的文件服务器文件夹的根目录下有一个我用来测试的示例CSV文件:<a class="ae kv" href="https://github.com/jdister1/file-upload-s3/blob/master/fileserver/upload.csv" rel="noopener ugc nofollow" target="_blank">https://github . com/jdister 1/file-upload-S3/blob/master/file server/upload . CSV</a></p><h1 id="eb3a" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">放弃</h1><p id="5f8f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了实现这一点，我创建了一些AWS资产(S3 bucket和IAM account ),仅供演示之用。我让事情变得更加开放，以使这篇文章能够如我所愿。为了描述架构设置，我没有进行安全配置。</p><h1 id="850c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">高层架构</h1><p id="1922" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在高层次上，设置将是与我们的服务器React和S3的来回舞蹈:<br/> 1。用户选择带有<code class="fe mk ml mm mn b">input</code>元素<br/> 2的文件。点击提交按钮<br/> 3。用文件名<br/> 4向<code class="fe mk ml mm mn b">/begin-upload</code>发布请求。服务器使用aws-sdk生成使用此文件名的预签名URL，并返回到前端。也返回一个<code class="fe mk ml mm mn b">uploadID</code> <br/> 5。前端直接向S3发出上传文件<br/> 6的上传请求。用<code class="fe mk ml mm mn b">uploadID</code>前端发布/完成上传</p><p id="ab12" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">视觉上，这个想法是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/1fb336f26e4fc043cf98e8bbcc862f00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d8qzSoISNU5xee2qMF6HGw.png"/></div></div></figure><h1 id="0fb8" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">步骤1:配置测试S3存储桶</h1><p id="218e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这一节中，我们将创建一个具有公共访问权限的测试S3桶，并将CORS配置为允许我们的前端与之对话。我不是说这是文件存储的生产就绪/安全设置，但出于演示目的，它将允许我们与S3对话。</p><p id="424f" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">创建一个存储桶并记下地区(例如:us-east-2)。此外，在配置过程中，确保关闭“阻止所有公共访问”:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/eb751ff51caa7849f06e03e5ebe5855e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MzHFCPKg59AXskX6OTka6Q.png"/></div></div></figure><p id="505c" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">创建后，转到存储桶-&gt;权限-&gt;跨来源资源共享，然后单击编辑:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/af0c3d44c04e8ae3e4978306f37d350b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PZhjJJbLxGiKbYgcEnCfnQ.png"/></div></div></figure><p id="44d2" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">使用以下JSON允许所有来源的CORS</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="08c4" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">步骤2:为测试目的设置IAM帐户</h1><p id="6481" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于这个测试，我将在I am中创建一个Admin帐户，稍后我们将在express中使用它来配置aws-sdk。</p><p id="87ad" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">您可以通过在AWS控制台中转到IAM并添加一个用户来做到这一点。选择凭据类型作为编程访问:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/b467c80add3d51609381f9badd9faaf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ztsetRk8E9bSNcZuACKB7w.png"/></div></div></figure><p id="d5d4" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">授予他们管理员访问权限(出于演示目的)。实际上，您需要附加一个具有正确权限的适当策略。这超出了本文的范围。</p><p id="1c9f" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">记下新用户的访问密钥和秘密访问密钥</p><h1 id="0cc1" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">第三步:前端(反应)</h1><p id="9411" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先用create react app配置一个React项目</p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="a3df" class="nd kx iq mn b gy ne nf l ng nh">npx create-react-app frontend</span></pre><p id="b6a4" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">将<code class="fe mk ml mm mn b">App.js</code>的内容替换为我GitHub上的<code class="fe mk ml mm mn b">App.js</code>文件这里:<a class="ae kv" href="https://github.com/jdister1/react-s3-csv/blob/master/fileapp/src/App.js" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/jdister 1/react-S3-CSV/blob/master/file app/src/app . js</a></p><h1 id="a560" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">相关反应部分</h1><p id="5a08" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，我们使用一个HTML <code class="fe mk ml mm mn b">input</code>和一个附加到处理函数的<code class="fe mk ml mm mn b">onChange</code></p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="60a9" class="nd kx iq mn b gy ne nf l ng nh">&lt;input type="file" name="file" onChange={changeHandler} /&gt;</span></pre><p id="f546" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">更改处理程序获取事件并将文件对象存储在状态中。它还设置了一个状态布尔值，以有条件地显示提交按钮。</p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="fff2" class="nd kx iq mn b gy ne nf l ng nh">const changeHandler = (event) =&gt; {</span><span id="a2f8" class="nd kx iq mn b gy ni nf l ng nh">setSelectedFile(event.target.files[0]);</span><span id="2efa" class="nd kx iq mn b gy ni nf l ng nh">setIsFilePicked(true);</span><span id="1d0d" class="nd kx iq mn b gy ni nf l ng nh">};</span></pre><p id="e174" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">单击后，提交按钮将协调上面概述的高级架构。</p><p id="b72d" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">第一个调用是给<code class="fe mk ml mm mn b">/begin-upload</code>检索一个预先指定的URL。我们将POST主体中的文件类型和名称传递给服务器，并期望得到一个URL，我们将其存储在<code class="fe mk ml mm mn b">fileLocation</code>中。</p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="3419" class="nd kx iq mn b gy ne nf l ng nh">method: "POST",</span><span id="c738" class="nd kx iq mn b gy ni nf l ng nh">headers: { "Content-Type": "application/json" },</span><span id="04ce" class="nd kx iq mn b gy ni nf l ng nh">body: JSON.stringify({</span><span id="9a1a" class="nd kx iq mn b gy ni nf l ng nh">fileName: selectedFile.name,</span><span id="3ea4" class="nd kx iq mn b gy ni nf l ng nh">fileType: selectedFile.type,</span><span id="691c" class="nd kx iq mn b gy ni nf l ng nh">}),</span><span id="9c25" class="nd kx iq mn b gy ni nf l ng nh">};</span><span id="d689" class="nd kx iq mn b gy ni nf l ng nh">fetch("http://localhost:5000/begin-upload", requestOptions)</span></pre><p id="cfa2" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">一旦我们有了预先指定的URL，我们就可以通过将file对象作为PUT请求的主体来将CSV文件直接传递到S3。重要的是不要尝试使用<code class="fe mk ml mm mn b">FormData</code>附加文件，因为这会被序列化。</p><p id="1490" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">相反，我们将文件对象直接存储在S3，以便在用户的文件夹中有一个一对一的备份副本，用于历史目的。(更多见此:<a class="ae kv" href="https://stackoverflow.com/a/57689819" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/54468419/webkitformboundary-upload-a-file-to-S3-using-axios-formdata</a>)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="59a8" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在我的例子中，这最后一步被称为<code class="fe mk ml mm mn b">tellServerComplete</code>。这里的想法是前端现在应该告诉我们的服务器文件已经成功上传到S3。这取决于您的业务规则来决定接下来会发生什么。</p><p id="5776" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在我的示例中，我让我的express服务器将该CSV拉入内存，读取数据，并将其返回到前端。在实践中，这并不真正有意义，但它证明了所有系统为了演示的目的都在一起正常工作。</p><p id="0b3e" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated"><code class="fe mk ml mm mn b">/process-upload</code>端点将只需要接受一个<code class="fe mk ml mm mn b">uploadID</code>。我的例子没有数据库，所以值是硬编码的。</p><p id="84cd" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">最后一步是将<code class="fe mk ml mm mn b">processedData</code>变量呈现到页面上，以确认我们的系统正在工作。</p><h1 id="eee1" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">第四步:服务器(快速)</h1><p id="6616" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们需要几个库来安装服务器。即:</p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="fd12" class="nd kx iq mn b gy ne nf l ng nh">npm install express cors body-parser <!-- -->csv-parser aws-sdk</span></pre><p id="2922" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">首先，我们将配置AWS SDK。使用<code class="fe mk ml mm mn b">AWS.Config</code>类配置aws-sdk客户端，并向其传递我们在上面建立的访问密钥、秘密密钥和区域:</p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="b161" class="nd kx iq mn b gy ne nf l ng nh">AWS.config = new AWS.Config({</span><span id="0f18" class="nd kx iq mn b gy ni nf l ng nh">accessKeyId: "YOUR ACCESS KEY",</span><span id="5d2b" class="nd kx iq mn b gy ni nf l ng nh">secretAccessKey: "YOUR SECRET ID",</span><span id="9f6e" class="nd kx iq mn b gy ni nf l ng nh">region: "YOUR REGION",</span><span id="39f6" class="nd kx iq mn b gy ni nf l ng nh">signatureVersion: "v4",</span><span id="c678" class="nd kx iq mn b gy ni nf l ng nh">});</span><span id="ed89" class="nd kx iq mn b gy ni nf l ng nh">app.use(cors());</span></pre><p id="e55b" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">将<code class="fe mk ml mm mn b">signatureVersion</code>设置为v4以生成预签名的URL也很重要。更多信息请点击这里:(<a class="ae kv" href="https://docs.aws.amazon.com/AmazonS3/latest/API/bucket-policy-s3-sigv4-conditions.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon S3/latest/API/bucket-policy-S3-SIG v4-conditions . html</a>)</p><p id="24d1" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">接下来，我们编写<code class="fe mk ml mm mn b">/begin-upload</code>函数。这个函数将生成预先指定的URL，并将其返回给React应用程序。在生产环境中，我会有一个<code class="fe mk ml mm mn b">Upload</code>表来存储元数据，但是出于演示的目的，我伪造了一个<code class="fe mk ml mm mn b">uploadID</code>。</p><p id="4c5c" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">我们使用aws-sdk生成预先设计的URL，如下所示:</p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="522a" class="nd kx iq mn b gy ne nf l ng nh">const s3 = new AWS.S3();</span><span id="86b6" class="nd kx iq mn b gy ni nf l ng nh">const myBucket = "YOUR BUCKET NAME";</span><span id="ab59" class="nd kx iq mn b gy ni nf l ng nh">const myKey = userID + "/" + fileName;</span><span id="f3fc" class="nd kx iq mn b gy ni nf l ng nh">const signedUrlExpireSeconds = 60 * 5;</span><span id="cef2" class="nd kx iq mn b gy ni nf l ng nh">const url = s3.getSignedUrl("putObject", {</span><span id="0973" class="nd kx iq mn b gy ni nf l ng nh">Bucket: myBucket,</span><span id="670d" class="nd kx iq mn b gy ni nf l ng nh">Key: myKey,</span><span id="6a3b" class="nd kx iq mn b gy ni nf l ng nh">ContentType: "multipart/form-data",</span><span id="510b" class="nd kx iq mn b gy ni nf l ng nh">Expires: signedUrlExpireSeconds,</span><span id="5165" class="nd kx iq mn b gy ni nf l ng nh">});</span></pre><p id="361f" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">注意，bucket名称应该是您在S3创建的根文件夹。关键将需要有其余的位置。所以你的变量看起来像这样:</p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="3f4b" class="nd kx iq mn b gy ne nf l ng nh">myBucket = "bucket-name"<br/>myKey = "12345/upload.csv"</span></pre><p id="fde0" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">最后是<code class="fe mk ml mm mn b">/process-upload</code>。在实践中，我们希望它使用一个<code class="fe mk ml mm mn b">uploadID </code>并在我们的数据库中进行查找。这张唱片会告诉我们在S3哪里可以找到。出于演示的目的，我只是硬编码在S3的位置，我们将读取。请在此功能中相应替换<code class="fe mk ml mm mn b">myBucket</code>和<code class="fe mk ml mm mn b">myKey</code>。</p><p id="12c7" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在这个函数中，我们使用npm库csv-parser将csv转换成JSON，然后返回给服务器。我的业务需求是将CSV行保存在我的数据库中，但是您的可能不同。这就是为什么我只是返回JSON来证明我们已经解析了文件，并且可以对数据做任何需要做的事情。</p><p id="0887" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">csv-parser需要一个可读的csv文件流。他们的文档(<a class="ae kv" href="https://www.npmjs.com/package/csv-parser" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/csv-parser</a>)显示了下面的例子:</p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="65fd" class="nd kx iq mn b gy ne nf l ng nh">const csv = require('csv-parser')<br/>const fs = require('fs')<br/>const results = [];</span><span id="c57a" class="nd kx iq mn b gy ni nf l ng nh">fs.createReadStream('data.csv')<br/>  .pipe(csv())<br/>  .on('data', (data) =&gt; results.push(data))<br/>  .on('end', () =&gt; {<br/>    console.log(results);<br/>    // [<br/>    //   { NAME: 'Daffy Duck', AGE: '24' },<br/>    //   { NAME: 'Bugs Bunny', AGE: '22' }<br/>    // ]<br/>  });</span></pre><p id="65de" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">我们的服务器无法访问其本地文件系统上的CSV文件，因此我们将使用aws-sdk的<code class="fe mk ml mm mn b">s3.getObject</code>(<a class="ae kv" href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#getObject-property" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/AWSJavaScriptSDK/latest/AWS/S3 . html # getObject-property</a>)函数将CSV文件拉入内存并创建一个读取流:</p><pre class="kg kh ki kj gt mz mn na nb aw nc bi"><span id="c6ee" class="nd kx iq mn b gy ne nf l ng nh">const file = s3</span><span id="e0db" class="nd kx iq mn b gy ni nf l ng nh">.getObject({</span><span id="aeac" class="nd kx iq mn b gy ni nf l ng nh">Bucket: myBucket,</span><span id="0cda" class="nd kx iq mn b gy ni nf l ng nh">Key: myKey,</span><span id="68ea" class="nd kx iq mn b gy ni nf l ng nh">})</span><span id="2fc2" class="nd kx iq mn b gy ni nf l ng nh">.createReadStream();</span><span id="9284" class="nd kx iq mn b gy ni nf l ng nh">let results = [];</span><span id="12b1" class="nd kx iq mn b gy ni nf l ng nh">file</span><span id="ee5c" class="nd kx iq mn b gy ni nf l ng nh">.pipe(csv())</span><span id="6188" class="nd kx iq mn b gy ni nf l ng nh">.on("data", function (data) {</span><span id="1d81" class="nd kx iq mn b gy ni nf l ng nh">results.push(data); <em class="nj">// --&gt; here</em></span><span id="8cb1" class="nd kx iq mn b gy ni nf l ng nh">})</span><span id="870b" class="nd kx iq mn b gy ni nf l ng nh">.on("end", () =&gt; {</span><span id="4458" class="nd kx iq mn b gy ni nf l ng nh">res.send({ results: results });</span><span id="3313" class="nd kx iq mn b gy ni nf l ng nh">console.log("done");</span><span id="6bca" class="nd kx iq mn b gy ni nf l ng nh">});</span></pre><p id="dc8e" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">就是这样！CSV文件现在被转换成JSON并返回给React应用程序。</p><h1 id="b5de" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">资源和链接</h1><div class="nk nl gp gr nm nn"><a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#getObject-property" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">类:AWS。S3</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">编辑描述</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><div class="nk nl gp gr nm nn"><a href="https://docs.aws.amazon.com/AmazonS3/latest/API/bucket-policy-s3-sigv4-conditions.html" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">亚马逊S3签名版本4认证特定策略密钥</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">如何使用AWS签名版本4身份验证特定策略密钥。</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><div class="nk nl gp gr nm nn"><a href="https://www.npmjs.com/package/csv-parser" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">csv分析器</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">流式CSV解析器，旨在实现最高速度以及与csv-spectrum测试套件的兼容性。最新…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">www.npmjs.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob kp nn"/></div></div></a></div><p id="8d73" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">包含我的代码的公共存储库:</p><p id="2fc9" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated"><a class="ae kv" href="https://github.com/jdister1/file-upload-s3" rel="noopener ugc nofollow" target="_blank">https://github.com/jdister1/file-upload-s3</a></p></div></div>    
</body>
</html>