# 对 Swift 功能的深入探究

> 原文：<https://betterprogramming.pub/functions-in-swift-5d8ee85f2de6>

## 从闭包到高阶函数，我们已经涵盖了所有内容

![](img/38178387f2bf890ea26db7faa1372e29.png)

由[麦克斯韦·纳尔逊](https://unsplash.com/@maxcodes?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

总的来说，函数是任何编程语言的基本组成部分，也是您开始编码时首先要学习的东西之一。在这篇文章中，我们将通过基本知识，然后也深入研究他们的一些细节。

# 基础:函数和闭包

函数和闭包都是 Swift 提供的构造，用于在其内部执行一组任务。它们接受执行任务可能需要的 0 个或多个参数，并且可以选择返回值。

## 功能

让我们从函数开始，因为它们更容易理解。

一个函数有五个部分:

1.  关键词`func`。这个关键字表示一个函数定义的开始。
2.  函数的名称。
3.  参数(命名或未命名)
4.  函数的主体。
5.  返回类型后跟一个`->`例如:`-> String`

## 输入参数

定义在函数中声明和使用参数的不同方式的最好方法是遵循代码。

1.  **命名参数**

**2。未命名的参数**

您可以在函数签名中的参数名称前添加一个`_`，它将成为一个未命名的参数，这可以确保您在调用函数时不必编写参数名称。

**3。可变参数**

这适用于您不知道可以传递给函数的输入数量的情况。

## `inout`参数

函数签名中的参数总是`let`参数，因此在函数内部修改它们会导致编译时错误。

为了能够修改函数中的参数值，您需要将它们标记为`inout`参数，如下所示:

请注意，您**不能**将`let`变量作为`inout`参数传递，因为它们不能被修改。

`inout`的工作原理是`copy-in copy-out`，也就是说输入的参数首先被复制到一个新的变量中(通过调用它的 getter)，然后在函数结束时新的值被设置到参数中(通过调用它的 setter)。如果它们的`inout`参数原来是一个引用类型，引用本身就被直接修改了。

## 返回

您可以使用`return`关键字从函数中返回值。你需要知道三种类型的`return`:

**1。不返回:**Swift 中的每个函数本质上都返回一些东西。对于没有显式返回任何内容的函数，该函数返回一个空元组。这个元组被称为类型`Void`。您不能显式返回`Void`,因为它是一个类型，但是如果您需要的话，您总是可以返回一个空元组——或者更好的是，直接省略那个返回语句！

**2。返回单个或多个值:**只需在要返回的值之前添加`return`关键字，就可以返回单个值

在返回之前，需要将多个值包含在一个元组中。

**3。隐式返回:**这是一种特殊类型的`return`，在这里您不必编写`return`关键字。

它们只在单一表达式函数中起作用。

## 作为一等公民的职能

在 Swift 中，函数是语言的一等公民。这基本上意味着函数可以像语言中的其他值一样使用。它们可以存储在变量中，并像其他任何对象一样传递。

有两种方法可以引用这些函数。

**1。创建对实例函数的引用。**

对实例函数的这种类型的引用最好如下例所示使用:

**2。创建对类/结构的函数的引用:**每当你引用一个类或结构的函数作为变量时，对该函数的静态引用就存储在该变量中。这意味着如果你想通过变量调用那个函数，你也必须传入那个特定类/结构的实例。通过一个例子可以更容易地形象化:

看着上面的代码，你可能会问“我为什么要这么做？”。答案是，你可能不会！虽然在一些情况下，它可以使代码更容易阅读，但您可能需要编写自己的扩展来使代码更容易阅读。

[在这里阅读更多](https://www.swiftbysundell.com/articles/first-class-functions-in-swift/)

# 关闭

闭包也是一个接受参数并在其中执行一些处理的构造。

定义闭包的方式如下:

结尾有四个部分:

1.  方括号`[]`中指定的捕获列表——捕获列表本质上是一个变量列表，您可以将它关联为一个闭包将引用的数组。如果管理不当，它是内存泄漏的主要来源。[阅读此处了解更多详情。](/a-look-into-automatic-reference-counting-b17e9539d34f)
2.  括号内的参数列表`()`。闭包的参数总是未命名的。
3.  `in`关键词
4.  闭包的主体

## `@escaping` vs `@nonescaping`关闭

这些关键字用于定义闭包的生存期以及它们在其中捕获的对象。

*默认情况下，作为参数传递给函数的闭包是@nonescaping。*

`nonescaping`闭包告诉编译器闭包将在函数本身中执行，并且一旦函数执行完成就可以被销毁(顺便说一下，销毁只是意味着对闭包的引用将减 1，因此如果你有对闭包的任何其他引用，它们仍将被维护，否则它将变成`nil`

`escaping`闭包是即使在函数执行完成后也可能被保留的闭包。这些主要在闭包的异步执行期间使用，这时您必须不断传递闭包。这里有一个`escaping`闭包用法的例子。

现在我们已经有了如何定义函数和闭包的基础知识，让我们更仔细地看看它们，看看它们的区别。

## 函数和闭包的区别

*   函数参数可以被命名，而闭包参数总是不被命名。
*   函数有自己的隐式名称，而闭包则没有。您可以使用您选择的任何变量名来引用它们。
*   闭包可以捕获带有`strong`、`weak`或`unonwed`关键字的值，而函数不捕获值。

*   如果函数本身在闭包中被捕获，那么它们可以捕获值。这意味着，如果在一个函数中使用了一个`object`，并且这个函数在闭包中被强捕获，那么这个函数会捕获那个`object`，即使你把它变成了`nil`。下面的例子应该有助于说明这一点:

# 高阶函数

高阶函数(HOF)是接受其他函数作为参数，或者返回一个函数，或者两者兼有的函数。它们通常看起来像这样:

你在日常生活中可能会用到的一些最常见的 Hof 例子有`filter`、`map`、`reduce`等。我会留下一些常见 Hof 的链接，你可能会在面试中被问到，但现在，我们将专注于上面的三个。理解它们的最好方法是定义它们，然后实现它们。

## [过滤器](https://developer.apple.com/documentation/swift/sequence/3018365-filter)

一个`filter`方法" ***过滤掉满足特定标准的*** "元素。

下面是查找超过五个字符的名称的代码片段。它展示了如何使用实际的`filter`函数以及我们的方法实现:

[https://developer . apple . com/documentation/swift/sequence/3018365-filter](https://developer.apple.com/documentation/swift/sequence/3018365-filter)

## [地图](https://developer.apple.com/documentation/swift/array/3017522-map)

`map`方法*使用转换函数转换*序列的每个元素，并返回转换后的元素列表。

让我们试着写一个映射转换函数，让数组中的所有字符串都大写，然后实现我们自己的映射来做同样的事情。

## [减少](https://developer.apple.com/documentation/swift/array/2298686-reduce)

一个`reduce`方法将一个序列简化为任何输出类型，可能是也可能不是一个序列。虽然它通常用于将序列的元素相互组合以得到一个结果(因为如果您希望您的输出只是另一个序列，那么您总是可以使用`map`)。

这个有点棘手，很多人讨厌它，因为它冗长，而且在大多数情况下你可以用一个`forEach`块来代替`reduce`。不过，我们还是讨论一下吧。

*其背后的一般思想是将* ***可选地*** ***变换*** *就像* `*map*` *然后* ***将*** *那些映射(或未映射)的元素* ***组合成单个值*** *(在一个方法中完成的两步过程*

假设您想从一组`Item`中找出购物车的总价值:

你也可以使用其他类似的 Hof，比如`compactMap`、`sorted`等。一定要尝试并实现它们，以便更好地理解如何在函数签名中使用闭包作为参数。

# 参考

*   [Swift 功能指南](https://docs.swift.org/swift-book/LanguageGuide/Functions.html)
*   [Swift 文档为](https://docs.swift.org/swift-book/ReferenceManual/Declarations.html#ID545) `[inout](https://docs.swift.org/swift-book/ReferenceManual/Declarations.html#ID545)` [参数](https://docs.swift.org/swift-book/ReferenceManual/Declarations.html#ID545)
*   [作为一等公民的功能—Sundell Swift](https://www.swiftbysundell.com/articles/first-class-functions-in-swift/)