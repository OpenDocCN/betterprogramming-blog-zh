# 我从马丁·福勒的书中学到了重构的 4 个原则

> 原文：<https://betterprogramming.pub/my-top-takeaways-from-refactoring-part-2-55efe6c547b8>

## 我们来谈谈《重构:改进现有代码的设计》这本书的第二章

![](img/613a1d041a89942e558df37f744c6efb.png)

马库斯·温克勒在 [Unsplash](https://unsplash.com/s/photos/building-blocks?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

在这个系列中，我分享了我从肯特·贝克和马丁·福勒所著的《重构 T4》一书中获得的一些经验。我强烈推荐任何对学习重构感兴趣的人阅读这本书。

在本系列的第 1 部分中，我们从更普遍的意义上看了一下重构。在第 2 部分中，我们将探讨何时以及为何进行重构，以及如何进行重构的更多指导。

# 第 2 章——重构的原则

在第二章中，马丁·福勒分享了重构的定义:

对软件内部结构的一种改变，使其更容易理解，修改起来更便宜，而不破坏其可观察的行为。

术语“可观察的行为”指的是软件的公共接口。这方面的一个例子是一个类的公共方法，其他类调用它来与之交互。定义再次明确了重构的目的。这是为了让软件更容易理解，并以一种更容易做出改变的方式进行重组。

这将带我们到我们的第一个外卖。

# 1.重构应该是经济的

我喜欢清理/重组一段代码！回顾这些变化，我有种莫名其妙的自豪感。这就是为什么对我来说这是一个很好的认识，我们重构是出于经济原因。我们应该重构，不仅是为了结果的美观，也是为了我们长期获得的经济利益。

Martin Fowler 提到我们是专业人员，有责任完成工作。重构是一个神奇的工具，可以帮助我们尽可能高效地实现这个目标。

# 2.重构是一个判断问题

如果我们列出这些:

*   改进软件的设计，
*   让软件更容易理解，
*   发现软件中的错误，
*   提高开发速度…

上面列表中的最后一个对一些人来说可能听起来矛盾。因为他们认为重构是“更多的工作”。这可能只适用于实际变化很小的情况。但是重要的是要记住，从长远来看，重构是有回报的。

因此，我们通常需要做出“重构还是不重构”的判断。随着我们在职业生涯中遇到越来越多的正确判断，做出正确判断的能力会随着时间的推移而提高。作为做出这些决定的起点，这本书提到了唐·罗伯茨的“三法则”:

“当你第一次做某事时，你就去做。当你第二次做类似的事情时，你会因为重复而退缩，但你还是做了重复的事情。第三次你做类似的事情，你重构”。

# 3.识别重构的机会

我们如何找到重构的正确时间？我们需要学会识别那些非常适合重构的特定场合。

1.  当添加新功能或修复错误时。为什么？在结构良好的代码库上做任何修改都更容易。
2.  当试图理解一段代码时。为什么？更名为更好的，解开依赖给我们一个清晰的画面。
3.  当我们发现一段代码可以做得更好的时候。为什么？嗯，因为“永远要让露营地比你发现它的时候更干净。”。
4.  做代码评审的时候。为什么？这是一个与你的同事分享一些观点的好机会。这可能不适合“拉-请求”类型的代码评审，因为这个过程需要更长的时间。这在结对编程时更合适，你们可以讨论这些建议。
5.  有计划的重构时间。为什么？在某些情况下——通常是涉及遗留代码库的情况——重构可能不是一件容易的事情。在这种情况下，提前计划偿还以前开发决策的债务是一个明智的选择。

# 4.两顶帽子的比喻——任何时候都只戴一顶帽子

这本书提到了一个很好的隐喻“两顶帽子”(作者 Kent Beck)来描述 Martin Fowler 进行重构的方式。

它表示将使用重构时的开发时间一分为二。一顶帽子用于添加新功能，另一顶用于重构。

当我们戴上第一顶帽子时，我们应该只关注添加新的功能(以及它的测试)。我们不应该对现有的代码进行任何更改。当我们戴上第二顶帽子时，我们应该专注于重构现有的代码并保持测试通过。我们不应该添加任何新的功能(甚至不应该添加新的测试)。

在开发过程中，我们可能会不断换帽子。但是记住当前戴的是哪顶帽子是很重要的。

肯特·贝克分享了关于这两顶帽子的笔记:

“一旦戴上重构的帽子，记下你认为代码中不正确的地方，但是抵制住现在改变它的诱惑，在你完成重构后，代码应该做完全相同的事情。然后，您可以换下帽子，回去修复实现。”

这本书提到了处理重构常见问题的好主意。这些问题包括:

*   我们如何不让它减缓发展，
*   我们应该如何为重构的合适环境安排我们的代码所有权，
*   我们如何处理遗留代码库，
*   如何利用版本控制系统中的分支，
*   如何应对涉及重构的数据库？

我不会深入讨论这些想法的细节。当我们面临这些问题时，最好将它们作为参考，并参考那些章节。

感谢您的阅读。

*最初发表于*【https://recepinanc.com】