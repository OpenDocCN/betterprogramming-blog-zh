<html>
<head>
<title>How to Play Audio and Video Files in Your Android App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在您的Android应用程序中播放音频和视频文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-play-audio-and-video-files-in-your-android-app-15b846411cb2?source=collection_archive---------4-----------------------#2020-04-07">https://betterprogramming.pub/how-to-play-audio-and-video-files-in-your-android-app-15b846411cb2?source=collection_archive---------4-----------------------#2020-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d943" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用MediaPlayer控制音频/视频文件和流的播放</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f0b6ac80667857cb78f8ed6e2f6cb4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZFuc3v9lswjZmpFfoAW-A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Josh Sorenson 在<a class="ae ky" href="https://unsplash.com/s/photos/speaker?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="0168" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读本文，您将学习如何编写一个与用户交互的音频播放应用程序。基于<a class="ae ky" href="https://developer.android.com/guide/topics/media/mediaplayer" rel="noopener ugc nofollow" target="_blank">官方文件</a>:</p><blockquote class="lv lw lx"><p id="9575" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“Android多媒体框架支持播放各种常见的媒体类型，因此您可以轻松地将音频、视频和图像集成到您的应用程序中。您可以播放存储在应用程序资源(原始资源)中的媒体文件、文件系统中的独立文件或通过网络连接到达的数据流中的音频或视频，所有这些都使用<code class="fe mc md me mf b">MediaPlayer</code>API。”</p></blockquote><p id="43d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说，你可以用它来播放视频和图像等媒体文件。说到这里，本文只着重于播放音频文件，作为对这个API的简要介绍。在此之后，您可以自由探索。</p><p id="80b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始你的Android项目吧。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="8b58" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">1.设置</h1><p id="7a77" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">在继续之前，请确保您已经安装了Android Studio和必要的SDK。添加以下<code class="fe mc md me mf b">INTERNET</code>访问权限，因为我们稍后将尝试播放本地和在线音频:</p><pre class="kj kk kl km gt nk mf nl nm aw nn bi"><span id="2c05" class="no mo it mf b gy np nq l nr ns">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</span></pre><p id="000e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mc md me mf b">res</code>文件夹中，创建一个名为<code class="fe mc md me mf b">raw</code>的新文件夹。将你的音频文件放入<code class="fe mc md me mf b">raw</code>文件夹，如下图所示。只要遵循正确的命名约定，您可以随意命名它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/f1ee982033e5ebc1d68f4fed21fb9a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*wPrqeh6s_kz9SmAL7xAZDw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3408" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于在线音频文件，你可以设置自己的服务器，或者只需要一个有效的音频文件URL来测试它。让我们进入下一节，开始编写Java代码。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="e533" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">2.履行</h1><h2 id="1d77" class="no mo it bd mp nu nv dn mt nw nx dp mx li ny nz mz lm oa ob nb lq oc od nd oe bi translated">导入</h2><p id="db76" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">在Java类的顶部添加以下导入声明:</p><pre class="kj kk kl km gt nk mf nl nm aw nn bi"><span id="d6ae" class="no mo it mf b gy np nq l nr ns">import android.media.AudioAttributes;<br/>import android.media.MediaPlayer;</span></pre><h2 id="656f" class="no mo it bd mp nu nv dn mt nw nx dp mx li ny nz mz lm oa ob nb lq oc od nd oe bi translated">初始化</h2><p id="84bd" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">如果您打算只播放一个音频文件，您可以在<code class="fe mc md me mf b">onCreate</code>函数中初始化它。根据音频文件的名称传入相应的资源:</p><pre class="kj kk kl km gt nk mf nl nm aw nn bi"><span id="c1e5" class="no mo it mf b gy np nq l nr ns">mp = MediaPlayer.<em class="ly">create</em>(this, R.raw.<em class="ly">alarm</em>);</span></pre><h2 id="3fb6" class="no mo it bd mp nu nv dn mt nw nx dp mx li ny nz mz lm oa ob nb lq oc od nd oe bi translated">开始或继续播放</h2><p id="2726" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">之后，您可以调用以下函数开始播放音频文件:</p><pre class="kj kk kl km gt nk mf nl nm aw nn bi"><span id="0bce" class="no mo it mf b gy np nq l nr ns">mp.start();</span></pre><p id="81cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理论上，在调用<code class="fe mc md me mf b">start</code>之前，你必须确保状态已经准备好。在这种情况下，<code class="fe mc md me mf b">create</code>函数会自动为您完成这项工作。让我们看看下面的图表，以了解更多关于流程。如果你不按照正确的顺序，你会遇到<code class="fe mc md me mf b">IllegalStateException</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/57b8681ced312ffe54c827fe896e17dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/0*qtJlIBKD-ylnsV6M.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://developer.android.com/reference/android/media/MediaPlayer" rel="noopener ugc nofollow" target="_blank">安卓</a>。</p></figure><h2 id="a615" class="no mo it bd mp nu nv dn mt nw nx dp mx li ny nz mz lm oa ob nb lq oc od nd oe bi translated">中止</h2><p id="c6c9" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">调用下面的函数暂停它。您可以通过再次调用<code class="fe mc md me mf b">start</code>轻松恢复:</p><pre class="kj kk kl km gt nk mf nl nm aw nn bi"><span id="ce07" class="no mo it mf b gy np nq l nr ns">mp.pause();</span></pre><h2 id="2cf3" class="no mo it bd mp nu nv dn mt nw nx dp mx li ny nz mz lm oa ob nb lq oc od nd oe bi translated">正在播放</h2><p id="3184" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">如果您需要检查MediaPlayer是否正在运行，请调用以下函数:</p><pre class="kj kk kl km gt nk mf nl nm aw nn bi"><span id="64f0" class="no mo it mf b gy np nq l nr ns">if (mp.isPlaying()) {</span><span id="78ba" class="no mo it mf b gy og nq l nr ns">}</span></pre><h2 id="4a2c" class="no mo it bd mp nu nv dn mt nw nx dp mx li ny nz mz lm oa ob nb lq oc od nd oe bi translated">停止</h2><p id="f290" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">通过下面的函数调用可以很容易地停止媒体:</p><pre class="kj kk kl km gt nk mf nl nm aw nn bi"><span id="aa9d" class="no mo it mf b gy np nq l nr ns">mp.stop()</span></pre><p id="9789" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要呼叫<code class="fe mc md me mf b">prepare()</code>或<code class="fe mc md me mf b">prepareAsync()</code>，然后才能再次呼叫<code class="fe mc md me mf b">start()</code>。</p><h2 id="12c6" class="no mo it bd mp nu nv dn mt nw nx dp mx li ny nz mz lm oa ob nb lq oc od nd oe bi translated">释放；排放；发布</h2><p id="a24f" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">一旦您使用完它，并且不再需要MediaPlayer对象，强烈建议您释放它并将其设置为<code class="fe mc md me mf b">null</code>以释放资源:</p><pre class="kj kk kl km gt nk mf nl nm aw nn bi"><span id="3d00" class="no mo it mf b gy np nq l nr ns">mp.release();<br/>mp = null;</span></pre><h2 id="a664" class="no mo it bd mp nu nv dn mt nw nx dp mx li ny nz mz lm oa ob nb lq oc od nd oe bi translated">在线URL</h2><p id="8e66" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">加载在线资源，需要调用<code class="fe mc md me mf b">setDataSource</code>而不是<code class="fe mc md me mf b">create</code>函数。初始化它，并传入指向相应在线音频文件的URL字符串。你必须将它包装在一个<code class="fe mc md me mf b">try catch</code>块中来捕捉<code class="fe mc md me mf b">IOException</code>错误。它可能需要一些时间来加载文件。建议用一个持续几秒钟的片段来测试一下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="f697" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">3.结论</h1><p id="1414" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">让我们回顾一下今天所学的内容。我们首先设置<code class="fe mc md me mf b">INTERNET</code>访问权限，并将音频文件存储在<code class="fe mc md me mf b">res</code>文件夹中。</p><p id="652c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们探索了<code class="fe mc md me mf b">MediaPlayer</code> API，包括如何基于本地资源初始化对象。有许多功能可用于开始、暂停、恢复或停止播放。</p><p id="76b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们甚至编写了一个从在线URL加载资源的函数。请随意进一步探索这个主题，并在视频文件上进行尝试。</p><p id="8bfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。希望下一篇文章能再见到你！</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="782e" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">参考</h1><ol class=""><li id="2cc8" class="oj ok it lb b lc nf lf ng li ol lm om lq on lu oo op oq or bi translated"><a class="ae ky" href="https://developer.android.com/guide/topics/media/mediaplayer" rel="noopener ugc nofollow" target="_blank"> MediaPlayer文档</a></li><li id="624a" class="oj ok it lb b lc os lf ot li ou lm ov lq ow lu oo op oq or bi translated"><a class="ae ky" href="https://developer.android.com/reference/android/media/MediaPlayer" rel="noopener ugc nofollow" target="_blank"> MediaPlayer参考</a></li></ol></div></div>    
</body>
</html>