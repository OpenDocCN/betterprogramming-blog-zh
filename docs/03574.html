<html>
<head>
<title>Using JavaScript Mixins — The Good Parts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript混合插件——好的部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-javascript-mixins-the-good-parts-5be6fdd46ef0?source=collection_archive---------13-----------------------#2020-02-18">https://betterprogramming.pub/using-javascript-mixins-the-good-parts-5be6fdd46ef0?source=collection_archive---------13-----------------------#2020-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7241" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如果你正在使用JavaScript mixins，你应该做什么</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c512b69e9fc749e380d1abad0245c121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*evw5pvMDJ3lVphmIYLjf0g.jpeg"/></div></div></figure><p id="156b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们开始使用某样东西之前，我们需要了解它是什么，以及我们可以用它来实现什么。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="1e2d" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">什么是Mixin？</h1><blockquote class="mm"><p id="21ec" class="mn mo iq bd mp mq mr ms mt mu mv lm dk translated">“mixin是一个抽象子类；即可以应用于不同超类以创建相关的修改类族的子类定义—吉拉德·布拉查和威廉·库克，<a class="ae mw" href="http://www.bracha.org/oopsla90.pdf" rel="noopener ugc nofollow" target="_blank">基于Mixin的继承</a></p></blockquote><p id="68b7" class="pw-post-body-paragraph kr ks iq kt b ku mx jr kw kx my ju kz la mz lc ld le na lg lh li nb lk ll lm ij bi translated">让我们以伐木为例。假设您有三页:</p><ul class=""><li id="e6c8" class="nc nd iq kt b ku kv kx ky la ne le nf li ng lm nh ni nj nk bi translated">红色</li><li id="6a18" class="nc nd iq kt b ku nl kx nm la nn le no li np lm nh ni nj nk bi translated">格林（姓氏）；绿色的</li><li id="5d91" class="nc nd iq kt b ku nl kx nm la nn le no li np lm nh ni nj nk bi translated">蓝色</li></ul><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="68a4" class="nv lv iq nr b gy nw nx l ny nz">              +----------+<br/>              |   Page   |<br/>              +----------+<br/>                |  |  |<br/>     +----------+  |  +-----------+<br/>     |             |              |<br/>+---------+ +-----------+ +----------+<br/>| PageRed | | PageGreen | | PageBlue |<br/>+----+----+ +-----------+ +----------+</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="617f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，每当有人上<code class="fe oc od oe nr b">PageRed</code>时，我们都要记录。为了存档，我们扩展了<code class="fe oc od oe nr b">PageRed</code>并创建了一个日志<code class="fe oc od oe nr b">PageRed</code>。</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="8380" class="nv lv iq nr b gy nw nx l ny nz">              +----------+<br/>              |   Page   |<br/>              +-+--+--+--+<br/>                |  |  |<br/>     +----------+  |  +-----------+<br/>     |             |              |<br/>+----+----+  +-----+-----+  +-----+----+<br/>| PageRed |  | PageGreen |  | PageBlue |<br/>+----+----+  +-----------+  +----------+<br/>     |<br/>+----+----+<br/>| Logged  |<br/>| PageRed |<br/>+---------+</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2689" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们想开始为<code class="fe oc od oe nr b">PageGreen</code>记录日志，我们会遇到一个问题:</p><ul class=""><li id="7c70" class="nc nd iq kt b ku kv kx ky la ne le nf li ng lm nh ni nj nk bi translated">我们不能把逻辑放在<code class="fe oc od oe nr b">Page</code>中，因为蓝色不应该被记录。</li><li id="bdd4" class="nc nd iq kt b ku nl kx nm la nn le no li np lm nh ni nj nk bi translated">我们不能重用<code class="fe oc od oe nr b">Logged PageGreen</code>中的逻辑，因为我们不能从两个来源扩展(即使我们可以，也意味着红色和绿色的信息冲突)。</li></ul><p id="81eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们能做的就是把它放在一个“外在”的地方，把它写出来，这样它就可以“混进去”了。</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="7f1e" class="nv lv iq nr b gy nw nx l ny nz">               +----------+                +----------+<br/>               |   Page   |                | Logging* |<br/>               +-+--+--+--+                +----------+<br/>                 |  |  |<br/>      +----------+  |  +-----------+<br/>      |             |              |<br/>+-----+----+  +-----+-----+  +-----+----+<br/>| PageRed  |  | PageGreen |  | PageBlue |<br/>|  with    |  |   with    |  +----------+<br/>| Logging* |  |  Logging* |<br/>+----------+  +-----------+</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="7163" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用这种方法，我们可以将逻辑提取到单独的代码片段中，以便在需要时使用。</p><p id="d928" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要获得更深入的技术解释，请阅读<a class="ae mw" href="https://justinfagnani.com/2015/12/21/real-mixins-with-javascript-classes/" rel="noopener ugc nofollow" target="_blank"> <em class="of">带有JavaScript类的Real Mixins</em></a>。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="78e1" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">为什么有必要对Mixins进行重复数据删除？</h1><p id="07b9" class="pw-post-body-paragraph kr ks iq kt b ku og jr kw kx oh ju kz la oi lc ld le oj lg lh li ok lk ll lm ij bi translated">我们现在希望将所有日志记录到红色、绿色和蓝色页面。很简单，因为我们现在可以在页面上应用<code class="fe oc od oe nr b">LoggingMixin</code>。</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="3dc9" class="nv lv iq nr b gy nw nx l ny nz">               +----------+               +----------+<br/>               |   Page   |               | Logging* |<br/>               |   with   |               +----------+<br/>               | Logging* |<br/>               +-+--+--+--+<br/>                 |  |  |<br/>      +----------+  |  +-----------+<br/>      |             |              |<br/>+-----+----+  +-----+-----+  +-----+----+<br/>| PageRed  |  | PageGreen |  | PageBlue |<br/>+----------+  |   with    |  +----------+<br/>              |  Logging* |<br/>              +-----------+</span></pre><p id="fabc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，绿色团队急于发布，所以他们已经将<code class="fe oc od oe nr b">LoggingMixin</code>应用到他们的<code class="fe oc od oe nr b">Page</code>类中。当我们将它应用到基类<code class="fe oc od oe nr b">Page</code>时，<code class="fe oc od oe nr b">Mixin</code>现在被应用了两次…</p><p id="050a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">突然，绿色页面将每个日志打印两次——这不是我们最初的想法。</p><p id="3fd9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要做的是确保每个mixin只被附加一次，即使我们试图多次应用它。</p><p id="c505" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一般来说，mixin越通用，它被多次应用的机会就越大。</p><p id="1c0e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">作为一个mixin作者，你不能控制它如何被使用，也不能总是预测它。因此，作为一项安全措施，始终建议创建重复数据删除混合。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2fde" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以在演示中看到这种情况。</p><p id="11b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过将<code class="fe oc od oe nr b">dedupeMixin</code>应用于<code class="fe oc od oe nr b">mixin</code>函数，在我们导出它之前，我们可以确定我们的<code class="fe oc od oe nr b">mixin</code>类只会生效一次，即使它被混合到继承链中的多个基类中。</p><ul class=""><li id="f6e3" class="nc nd iq kt b ku kv kx ky la ne le nf li ng lm nh ni nj nk bi translated"><code class="fe oc od oe nr b"><a class="ae mw" href="https://open-wc.org/dedupe-mixin/demo/no-dedupe/" rel="noopener ugc nofollow" target="_blank">no-dedupe</a></code>“失败”记录绿色两次。</li><li id="4cd4" class="nc nd iq kt b ku nl kx nm la nn le no li np lm nh ni nj nk bi translated"><code class="fe oc od oe nr b"><a class="ae mw" href="https://open-wc.org/dedupe-mixin/demo/with-dedupe/" rel="noopener ugc nofollow" target="_blank">with-dedupe</a></code>“成功”也记录一次绿色。</li></ul><p id="7d0c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以在<a class="ae mw" href="https://github.com/open-wc/open-wc/tree/master/packages/dedupe-mixin/demo-typed" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上查看两者的源代码。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="4e67" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">嵌套示例</h1><p id="a8ca" class="pw-post-body-paragraph kr ks iq kt b ku og jr kw kx oh ju kz la oi lc ld le oj lg lh li ok lk ll lm ij bi translated">您可能认为上面的例子太简单了，可以通过调整何时进行更改来解决。</p><p id="5e35" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，在大多数真实场景中，情况要复杂得多。mixin是可以扩展的，仅仅因为你导入了一个类，并不意味着这个类已经预先应用了一些mixin。</p><p id="2d35" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">考虑这个例子:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="c9f1" class="nv lv iq nr b gy nw nx l ny nz">+----------+<br/>| Logging* |<br/>+----+-----+<br/>     |         +----------+                  +----------+<br/>+----+-----+   |   Page   |                  | Feature  |<br/>| Metrics* |   |   with   |                  |   with   |<br/>+----------+   | Logging* |                  | Metrics* |<br/>               +-+--+--+--+                  +----+--+--+<br/>                 |  |  |                          |  |<br/>      +----------+  |  +-----------+              |  +-----+<br/>      |             |              |              |<br/>+-----+----+  +-----+-----+  +-----+----+  +------+-------+<br/>| PageRed  |  | PageGreen |  | PageBlue |  | WaterFeature |<br/>+----------+  +-----------+  |   with   |  +--------------+<br/>                             | Metrics* |<br/>                             +----------+</span></pre><ul class=""><li id="4bc5" class="nc nd iq kt b ku kv kx ky la ne le nf li ng lm nh ni nj nk bi translated">页面一般只需要日志记录。</li><li id="1ce0" class="nc nd iq kt b ku nl kx nm la nn le no li np lm nh ni nj nk bi translated">然而，还有一个更高级的度量系统，它扩展了日志记录。</li><li id="9c4a" class="nc nd iq kt b ku nl kx nm la nn le no li np lm nh ni nj nk bi translated">特性的度量标准是单独开发的。</li><li id="755f" class="nc nd iq kt b ku nl kx nm la nn le no li np lm nh ni nj nk bi translated">当我们现在想要在蓝色页面上获得相同的度量时，我们得到了重复的日志记录，甚至没有有意识地应用日志记录一次(我们做了<code class="fe oc od oe nr b">class PageBlue extends MetricsMixin(Page) {}</code>)。</li><li id="7eb5" class="nc nd iq kt b ku nl kx nm la nn le no li np lm nh ni nj nk bi translated">在这些情况下，只有重复数据删除能有所帮助。</li></ul></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="5b52" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">何时不使用Mixin</h1><p id="be8e" class="pw-post-body-paragraph kr ks iq kt b ku og jr kw kx oh ju kz la oi lc ld le oj lg lh li ok lk ll lm ij bi translated">你现在可能会想:“该死，那是强大的”你是对的。我们现在应该把它用在任何事情上吗？当然不是。</p><p id="b76e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">只有在绝对需要访问实例本身时才使用它。这里有一些当<em class="of">不</em>使用mixin的不好的例子。</p><h2 id="0066" class="nv lv iq bd lw ol om dn ma on oo dp me la op oq mg le or os mi li ot ou mk ov bi translated">我想做<code class="fe oc od oe nr b">if (this.isIE11()) { // ... }</code></h2><p id="6c2d" class="pw-post-body-paragraph kr ks iq kt b ku og jr kw kx oh ju kz la oi lc ld le oj lg lh li ok lk ll lm ij bi translated">对于任何“纯”函数，最好将其放在类/原型之外。例句:最好这样写:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h2 id="6684" class="nv lv iq bd lw ol om dn ma on oo dp me la op oq mg le or os mi li ot ou mk ov bi translated">我想有一个特别的<code class="fe oc od oe nr b">this.addEventListener()</code></h2><p id="e32f" class="pw-post-body-paragraph kr ks iq kt b ku og jr kw kx oh ju kz la oi lc ld le oj lg lh li ok lk ll lm ij bi translated">首先，重写内置函数可能非常危险。</p><p id="fc95" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当在你的类中，当你需要一个非常具体的用例发生时，它可能是好的。然而，如果这在使用mixin时神奇地发生了，那就非常令人困惑了。</p><p id="0633" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最好将这些作为一个额外的函数来传递。这样，人们可以选择这些特殊功能，而不会“污染”他们的原型链。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="0f86" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">其次，所有的属性/方法对类/原型来说都是全局的。这意味着如果两个mixins使用相同的名称，就会发生冲突。</p><p id="68ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，确保明确地为私有/受保护的方法使用特定的名称，并确保如果您使用通用名称，则可以从mixin name/docs中清楚地看到。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="cf21" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">何时使用Mixin</h1><p id="275e" class="pw-post-body-paragraph kr ks iq kt b ku og jr kw kx oh ju kz la oi lc ld le oj lg lh li ok lk ll lm ij bi translated">如果您需要访问类实例本身。也就是说，如果每个实例都有不同的设置。</p><p id="9e04" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一个有效的例子可以是，例如，使您能够设置<code class="fe oc od oe nr b">myEl.locale = 'de-DE';</code>的<code class="fe oc od oe nr b">LocalizeMixin</code>。在这种情况下，mixin需要提供该属性并对其做出反应。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="2c12" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">我们学到了什么</h1><p id="1643" class="pw-post-body-paragraph kr ks iq kt b ku og jr kw kx oh ju kz la oi lc ld le oj lg lh li ok lk ll lm ij bi translated">使用mixins，您可以将共享逻辑引入多个类。这是一个非常强大的工具——伴随着这种力量而来的是责任。请务必负责任地使用它，并对您的mixins进行重复数据删除。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="910b" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">笔记</h1><ul class=""><li id="795f" class="nc nd iq kt b ku og kx oh la ow le ox li oy lm nh ni nj nk bi translated">用<a class="ae mw" href="http://asciiflow.com/" rel="noopener ugc nofollow" target="_blank"> AsciiFlow </a>制作的ASCII图形。</li><li id="f390" class="nc nd iq kt b ku nl kx nm la nn le no li np lm nh ni nj nk bi translated">由<a class="ae mw" href="https://unsplash.com/@vaniashows?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">瓦尼亚拍摄的照片显示</a>在<a class="ae mw" href="https://unsplash.com/s/photos/mixer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上。</li></ul></div></div>    
</body>
</html>