<html>
<head>
<title>Use the Serverless Framework to Test AWS Microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无服务器框架测试AWS微服务</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/serverless-framework-to-test-aws-microservices-575cbbc0823?source=collection_archive---------5-----------------------#2020-03-21">https://betterprogramming.pub/serverless-framework-to-test-aws-microservices-575cbbc0823?source=collection_archive---------5-----------------------#2020-03-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a301" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习使用AWS无服务器服务进行测试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1c9bdb90f85b4ac4373c2efe1a5986f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DPzcg8L7NMHg02M1NrciUw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一些最广泛使用的AWS无服务器服务</p></figure><p id="0451" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">与普通的REST API、web应用程序或数据库相比，AWS服务的功能测试稍微有点挑战性。让我们看看在处理AWS服务时有哪些主要问题。</p><p id="4c3a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们考虑一个使用Lambda函数运行应用程序并使用step函数进行编排的解决方案，将元数据存储在DynamoDB中，将数据文件存储在S3中。</p><p id="7e4e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在构建测试自动化框架时，如果您使用Jenkins、CircleCI、GoCD或任何其他CI工具来执行测试，那么在服务器上传递和存储像<code class="fe lr ls lt lu b">aws_access_key_id</code>和<code class="fe lr ls lt lu b">aws_secret_access_key</code>这样的用户凭证并不是访问AWS服务的安全方式——而且它有潜在的安全隐患。因此在这种情况下，您需要分配在AWS中运行的CI/CD服务器(<a class="ae lv" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> EC2 </a> / <a class="ae lv" href="https://aws.amazon.com/ecs/" rel="noopener ugc nofollow" target="_blank"> ECS </a>)并分配<a class="ae lv" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html" rel="noopener ugc nofollow" target="_blank"> IAM角色</a>来访问所有其他AWS服务。</p><p id="c7bc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个解决方案也有一个限制:如果应用程序中的服务使用<a class="ae lv" href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints.html" rel="noopener ugc nofollow" target="_blank"> VPC端点，</a>那么管理起来就变得非常困难，因为企业中的CI服务器通常托管在不同的AWS帐户中(传统上称为<em class="lw">工具帐户)。</em>视觉上，可以这样表示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lx"><img src="../Images/f197b0ec9c085bec38b9ef0f042cd417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-Tldtl_IqL0DJzDvKTpiA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">典型的企业AWS客户管理</p></figure></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="9bd7" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">无服务器框架如何帮助缓解这些问题</h1><p id="4980" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">该框架考虑了以下假设:</p><ul class=""><li id="64df" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">测试运行时间不超过15分钟(当前的Lambda最大执行时间)</li><li id="63e9" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated">测试执行时不会消耗超过3008 MB的内存</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/a2266c7f72a30ab7a30f0c4e4219f044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A2_e_L5ff-dyBqfyPpNK6g.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">详细的无服务器测试架构</p></figure><p id="d24c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我将讨论构建和运行无服务器测试所需的一些组件。我将省略如何为测试调用/测试执行报告的语音命令构建Alexa技能，以及如何使用Express服务器报告仪表板，但我将在未来的文章中返回这些主题。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="1202" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">第一步</h1><p id="0771" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">使用任何现有的框架编写您的自动化测试。在这个例子中，我们使用摩卡茶来展示一个样本测试。理想情况下，这些将是验证您的AWS应用程序的自动化测试。</p><p id="2e26" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">运行以下命令，首先在本地运行这些测试:</p><pre class="kg kh ki kj gt nr lu ns nt aw nu bi"><span id="5e7e" class="nv mg iq lu b gy nw nx l ny nz">mkdir serverless-test-framework &amp;&amp; cd serverless-test-framework<br/>npm init -y<br/>npm i mocha chai mochawesome moment-timezone aws-sdk fs</span></pre><ul class=""><li id="2fd9" class="nc nd iq kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated"><code class="fe lr ls lt lu b">mocha</code>，<code class="fe lr ls lt lu b">chai</code> : Mocha是测试框架，柴是断言库</li><li id="478b" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated"><code class="fe lr ls lt lu b">mochawesome</code>:生成漂亮HTML报告的报告库</li><li id="e622" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated"><code class="fe lr ls lt lu b">moment-timezone</code>:用于轻松生成AEST时区的当前日期和时间</li><li id="26d2" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated"><code class="fe lr ls lt lu b">aws-sdk</code>:用于与S3、SNS等服务交互，推送报表文件和通知</li><li id="5c38" class="nc nd iq kx b ky nl lb nm le nn li no lm np lq nh ni nj nk bi translated"><code class="fe lr ls lt lu b">fs</code>:用于从本地目录读取文件内容，以便复制到S3</li></ul><p id="4b60" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建测试文件，并将下面的代码复制到其中。这是一个样本测试用例。</p><pre class="kg kh ki kj gt nr lu ns nt aw nu bi"><span id="bc91" class="nv mg iq lu b gy nw nx l ny nz">touch test.js</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="aa4e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个阶段，可以通过运行<code class="fe lr ls lt lu b">mocha</code>命令来独立运行这些测试。这将生成如下所示的输出。注意，还没有生成HTML报告。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/b2d77b869cde102aa4022978c6f16d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uh5HXLS0WOLkqF4pngileA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Mocha测试-执行结果</p></figure><p id="3d5c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们开始编写Lambda函数的代码。首先，创建一个<code class="fe lr ls lt lu b">lib</code>文件，该文件将包含助手函数，用于与框架所需的必要AWS服务进行交互。</p><pre class="kg kh ki kj gt nr lu ns nt aw nu bi"><span id="f59c" class="nv mg iq lu b gy nw nx l ny nz">mkdir lib &amp;&amp; cd lib<br/>touch aws-manager.js</span></pre><p id="6e6b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将下面的代码复制到<code class="fe lr ls lt lu b">aws-manager.js</code>文件中。第3行有<code class="fe lr ls lt lu b">region</code>值。请确保根据您的位置进行更新。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="5912" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后一步是创建Lambda函数调用所需的<code class="fe lr ls lt lu b">index.js</code>文件。</p><pre class="kg kh ki kj gt nr lu ns nt aw nu bi"><span id="91e1" class="nv mg iq lu b gy nw nx l ny nz">// come out of lib directory<br/>cd .. <br/>touch index.js</span></pre><p id="aefb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将下面的代码复制到<code class="fe lr ls lt lu b">index.js</code>中。在这个文件中，我们将使用编程方法调用Mocha测试。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="7a51" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">注意:</strong>在AWS中创建资源后，第40行和第55行需要更新对S3和SNS主题的引用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/31ff3e57419e675260163e58c95875c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*jYSj2oFFX3jDOkqSij0z5Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">无服务器测试框架目录</p></figure><p id="fb3a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是你的文件夹在这一步结束时的样子。如果没有，请检查错过了哪一步。(<code class="fe lr ls lt lu b">node_modules</code>将在<code class="fe lr ls lt lu b">npm i</code>命令后自动创建。)</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="2afa" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">第二步</h1><p id="9461" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">让我们开始构建AWS资源。我想你已经有一个AWS账户了——如果没有，可以免费注册。转到<a class="ae lv" href="https://aws.amazon.com/console/" rel="noopener ugc nofollow" target="_blank"> AWS控制台，</a>并使用您的凭证登录。</p><h2 id="432f" class="nv mg iq bd mh oe of dn ml og oh dp mp le oi oj mr li ok ol mt lm om on mv oo bi translated"><strong class="ak">创建S3存储桶</strong></h2><p id="d38c" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">这是存储使用mochawesome生成的执行报告所必需的。<br/>点击“服务”，然后点击“S3”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/b103518e23f3598eb6005e11afb984d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MrljHW0P_kD7KkSa6q5Qow.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">S3在储物区下面</p></figure><p id="6a78" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击“创建存储桶”按钮，并输入您的存储桶名称。根据您的位置选择区域，然后单击底部的“创建存储桶”按钮。</p><p id="660d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不要忘记更新<code class="fe lr ls lt lu b">index.js</code>文件中第40行的<code class="fe lr ls lt lu b">name</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/2b75db4dfd69a38077e61113964b069d.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*bN498aRpggvwJnPYAX3iOA.png"/></div></figure><h2 id="b5b1" class="nv mg iq bd mh oe of dn ml og oh dp mp le oi oj mr li ok ol mt lm om on mv oo bi translated"><strong class="ak">创建SNS话题</strong></h2><p id="8a3d" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">这用于在测试失败时向所有订户发送通知。</p><p id="25d4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击“服务”，然后单击“应用程序集成”部分下的“简单通知服务”。或者在搜索栏搜索“SNS”。</p><p id="40bc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击左侧窗格中的“主题”,然后单击“创建主题”按钮</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/0f22d40f62d0a7e63c6f6c3c90ddf938.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K6i1A5v4kFPSpXmyW2sAZQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建社交网络话题</p></figure><p id="1b7f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输入主题的名称，然后单击底部的“创建主题”按钮。</p><p id="654c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不要忘记更新<code class="fe lr ls lt lu b">index.js file</code>中第55行的<code class="fe lr ls lt lu b">name</code>。</p><p id="bdbe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们给这个主题添加订阅者。单击上面创建的主题名称，然后单击“创建订阅”这是一个非常重要的步骤，可以确保您在测试失败时收到通知。</p><p id="d6d7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">选择“电子邮件”作为协议，并输入您的有效电子邮件。点击屏幕底部的“创建订阅”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/dd11ea279f5c8f1840dae29b79c09c38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6zLIKU3MAkfpjM1xYWucVg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建订阅</p></figure><p id="7539" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将向您的ID发送主题为“AWS通知-订阅确认”的电子邮件点击“确认订阅”链接。</p><p id="1ae2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">可选:</strong>为您的手机号码创建另一个套餐。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/1cb1890c4596eb47297da1a8269c5f61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IBckSHOo0bQNmOVkeLE2QQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">短信和电子邮件订阅</p></figure><h2 id="3418" class="nv mg iq bd mh oe of dn ml og oh dp mp le oi oj mr li ok ol mt lm om on mv oo bi translated"><strong class="ak">创建一个Lambda函数</strong></h2><p id="ec82" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">这用于为自动执行部署测试。单击“服务”，然后单击“计算”部分下的“Lambda”。或者在搜索栏中搜索“Lambda”。</p><p id="f3e1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击“创建函数”按钮，您应该会看到以下屏幕:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/d623c3b60d25f2772ac41ad350b06cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jVga8MWAjobnDefr9FdHRw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建Lambda函数</p></figure><p id="f491" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输入函数名，运行时选择“Node.js 12.x”(默认选择)。</p><p id="2d94" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一步可能是整个教程中最重要的部分。创建一个IAM角色，它将授予这个Lambda函数对上面创建的S3存储桶和SNS主题的访问权限。</p><p id="4f65" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">展开“选择”部分，或创建一个执行角色。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/6682affd96b059770f53da2cfb157cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRZuv2Jp7gwENhHkwYOrxQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">从AWS策略模板中选择“创建新角色”</p></figure><p id="fafe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输入角色名称，从策略模板下拉列表中选择“Amazon SNS发布策略”</p><p id="657c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击“创建函数”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/8368ac74d5385cda682f204389c254ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*typT-XCoJYmgE7SJuOweMw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择亚马逊社交网络发布政策</p></figure><p id="3836" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是你的Lambda函数最初的样子。我们将在步骤3中对这个Lambda部署测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/e93e5b9876ec718b098742256dea9ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQjwECKQKL9JtwImnubc4Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">λ函数</p></figure><p id="5b41" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">向下滚动Lambda函数页面，在基本设置下，点击“编辑”将超时时间增加到30秒，然后单击“保存”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/29853484d99f60e083329c4171cdfc2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PbkTqgMbLgplWGsSzJClow.png"/></div></div></figure><p id="cb1b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在Lambda function页面上，在execution role下，点击“查看<rolename>角色”这将带您进入IAM管理控制台角色页面。</rolename></p><p id="c251" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击“附加策略”按钮。在“附加权限”页面上，在搜索栏中搜索“s3”，并选择“AmazonS3FullAccess”单击屏幕底部的“附加策略”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/50c8abf62d774421c73a084554515eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zf5_RjKVIJzNwOh8hDR8VQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加策略以授予Lambda对S3的完全访问权限</p></figure><h2 id="57fe" class="nv mg iq bd mh oe of dn ml og oh dp mp le oi oj mr li ok ol mt lm om on mv oo bi translated">创建云观察事件</h2><p id="7a65" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">这将需要在预定的基础上触发Lambda功能。</p><p id="7a36" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击“服务”，然后单击“管理和治理”部分下的“云观察”。或者在搜索栏搜索“CloudWatch”。</p><p id="510c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击左侧窗格中的“规则”,然后单击“创建规则”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/f409e33a175da82a0af7e90a715fadcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJnsT5vV9ompZu5I_nod-w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建云观察事件</p></figure><p id="2fe2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击“Schedule”单选按钮，并选择“Cron Expression”在文本框中输入<br/> <code class="fe lr ls lt lu b">30 13 * * ? *</code>。这意味着该事件将在每天13:30 GMT时间发生。您需要将当地时间转换为GMT，以便正确安排活动。</p><p id="d9b8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击“目标”部分下右侧的“添加目标”,并从下拉列表中选择您的Lambda函数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/d6d88e92410f8731d1b779b085fe5cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OVKNnYIZlO21CCKlMbTzwg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择Lambda函数作为目标</p></figure><p id="c291" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击底部的“配置详细信息”按钮。</p><p id="6ff3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输入名称和描述，然后单击右侧的“创建规则”按钮。</p><p id="8127" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">注意:</strong>状态默认启用。不要禁用它。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="fd55" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">第三步</h1><p id="a260" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">所有AWS资源都已创建，代码已经准备好部署到Lambda函数中。</p><p id="f0f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打开终端，和<code class="fe lr ls lt lu b">cd serverless-test-framework</code>。这与我们在步骤1中创建的目录相同。打包你的测试代码。</p><pre class="kg kh ki kj gt nr lu ns nt aw nu bi"><span id="8d3b" class="nv mg iq lu b gy nw nx l ny nz">zip -qr tests.zip .</span></pre><p id="fcbc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将生成一个名为<code class="fe lr ls lt lu b">tests.zip</code>的新Zip文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/4efcd40a6259f86f784517882b2be3f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*6qAJ2Ry1qouw7ExuDdkm1A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">新的Zip文件已经添加</p></figure><p id="8a49" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">返回AWS控制台，并转到作为步骤2的一部分创建的Lambda函数。</p><p id="42e5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击“代码输入类型”下拉菜单，并选择“上传. zip文件”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/7f601b3d67fb6746d1443f10ea1714e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7CuKA0JmSgVsqCCev6rWrQ.png"/></div></div></figure><p id="b9e6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击上传按钮，并选择<code class="fe lr ls lt lu b">tests.zip</code>文件。点击屏幕顶部的“保存”按钮。</p><p id="e4fc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">重要提示:</strong>点击屏幕上方的“保存”按钮故意重复)。</p><p id="566f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在是测试部署是否成功的时候了。</p><p id="fd72" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击屏幕顶部“测试”旁边的下拉菜单，然后单击“配置测试事件”</p><p id="464f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输入事件的名称，一切保持原样。点击“创建”按钮。</p><p id="4a72" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">单击“测试”按钮，您应该会看到下面的绿色输出。这意味着Lambda函数已经成功运行，并且所有测试都已经执行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/7d6188e9459da20c7d63aab40b5bc3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymSt5Q3mZQSQ4Al_Rr1GJg.png"/></div></div></figure><p id="bc84" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们看看S3的处决报告。打开一个新选项卡，并转到步骤2中创建的S3存储桶。</p><p id="cb3f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个S3中，应该会自动创建新的文件夹，<br/> <code class="fe lr ls lt lu b">reports</code> &gt; <code class="fe lr ls lt lu b">html</code> —包含所有HTML报告<br/> <code class="fe lr ls lt lu b">reports</code> &gt; <code class="fe lr ls lt lu b">json </code> —包含每次执行对应的JSON报告</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/39aa08736882f988bf2987f40ae06aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RYjs_QMoM1M-6r2jxIJNMQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">执行报告</p></figure><p id="a48b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们检查当测试失败时我们是否收到通知。回到你的编辑器，让我们故意让其中一个测试失败。</p><p id="5cd2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打开<code class="fe lr ls lt lu b">test.js</code>，将第6行改为<code class="fe lr ls lt lu b">expect(i).to.not.equal(9)</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/87e6bd5d21fd5dfcc674f7e090495113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfWhnISqO42yPeiyEevdjg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">更新的测试用例</p></figure><p id="d301" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">执行Zip命令<code class="fe lr ls lt lu b">zip -qr tests.zip</code>，它将更新现有的<code class="fe lr ls lt lu b">tests.zip</code>文件。</p><p id="bb3c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">返回到AWS控制台Lambda功能。点击“上传”，并选择<code class="fe lr ls lt lu b">tests.zip</code>。点击右上角的“保存”。</p><p id="6326" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">保存成功后，点击“测试”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/58e498b5a6170f4e2dd9741628b60184.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l7JrKMlmqU8ECLgoRGLjmA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">试验时的损坏</p></figure><p id="2d2f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">日志显示一次失败和九次通过。另外，你可以在CloudWatch中查看详细的日志。</p><p id="1fe2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击“监控”，然后点击“查看CloudWatch中的日志”</p><p id="153e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您已经执行了多次，请选择最新的流。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/9da5ad86203484bedffd9da711abe787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9uPqQrpL93-zmQYuWttt3g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">CloudWatch中的日志流</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/05eb548ecc14664d10264826eae11c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y048uf7Q-CEqh81XqfMfQw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">详细日志</p></figure><p id="b274" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">与此同时，您应该已经通过SMS(取决于您的订阅)在您的收件箱中收到了一封电子邮件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/c8dc89adbed20bc617d70b330cc65b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cGyy9kBzJtMau6bAFkKm3A.png"/></div></div></figure></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="6fa1" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">第四步</h1><p id="3b9b" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">最后一件事很突出:我们需要检查Lambda函数是否基于步骤2中预定的触发器执行。检查CloudWatch中的日志，看看您是否注意到当时的日志流。</p><p id="222d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">注意:</strong>日程安排部分提到的时间是GMT，而不是您当地的时间。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="b6ae" class="mf mg iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">结论</h1><p id="f6f6" class="pw-post-body-paragraph kv kw iq kx b ky mx jr la lb my ju ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">我们只涉及了详细的测试框架架构图(如下)中显示的一小部分。但是这是一个非常好的开始，现在您可以在一个无服务器的环境中运行自动化测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/72617fab43b21fd506f5fcdc6366b1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OccG37qbDS4CQzongU-zqA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这是我们今天建造的</p></figure><p id="82f5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以向<code class="fe lr ls lt lu b">test.js</code>文件中添加更多的测试，如果您想对任何AWS服务运行测试，比如DynamoDB或RDS，只需确保更新IAM角色并根据需要增加超时/内存。</p><p id="4a07" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是为每个应用程序独立运行测试的一种简洁明了的方法。</p><p id="513e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">而且都搞定了！如果您成功地创建了所有的资源并成功地执行了测试，那就做得很好。在我的下一篇文章中，我将解释如何建立一个Alexa技能来使用语音命令执行测试。想象一下，说“嘿，Alexa，执行我的样本测试”，然后看到你的测试开始执行。</p><p id="3093" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为您的框架构建简单而详细的报告仪表板—<a class="ae lv" href="https://medium.com/javascript-in-plain-english/reporting-dashboard-for-serverless-test-framework-36dd46bf54da" rel="noopener">https://medium . com/JavaScript-in-plain-English/reporting-dashboard-for-server less-test-framework-36dd 46 BF 54 da</a></p></div></div>    
</body>
</html>