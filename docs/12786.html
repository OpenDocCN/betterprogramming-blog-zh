<html>
<head>
<title>Native Modules: Export C++ Function to React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">本机模块:导出C++函数以反应本机</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/native-modules-export-c-function-to-react-native-for-beginners-77e89934b210?source=collection_archive---------7-----------------------#2022-07-01">https://betterprogramming.pub/native-modules-export-c-function-to-react-native-for-beginners-77e89934b210?source=collection_archive---------7-----------------------#2022-07-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="860b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从React Native和more调用Swift</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1be07a9df4b225a1755d9b8b0b757562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IC1Ux8npoHgcojOaT57YJg.png"/></div></div></figure><p id="b48f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">今天，我继续分享我在原生模块和C++方面的经验。</p><p id="93d5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于我们将会看到很多为移动平台编写的C/C++库，我们需要将它们实现到我们的iOS或React本地应用程序中。这也是为什么我要写一篇关于如何从C++导出一个函数到React Native的文章，对于初学者来说简单易懂，节省时间。我将从一个新的react本机应用程序开始</p><h2 id="ed94" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated"><strong class="ak"> 1。创建一个新的react本地应用，打开你的终端并运行</strong></h2><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="5870" class="ln lo iq mh b gy ml mm l mn mo">npx react-native init NativeModules</span></pre><h2 id="ca9c" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated"><strong class="ak"> 2。打开Xcode并导航至native modules/IOs/native module . xc workspace</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/68818c4700143bd8e068ed26338a1c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*32d8JlGHwOtVZapN.png"/></div></div></figure><h2 id="66ae" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated"><strong class="ak"> 3。在C++端工作</strong></h2><p id="5bc1" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">创建一个新的C++文件，并将其命名为<code class="fe mv mw mx mh b">Cpp_to_RN.cpp</code></p><p id="f542" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们创建一个新的C++文件时，Xcode会为我们创建一个头文件<code class="fe mv mw mx mh b">Cpp_to_RN.hpp</code> <strong class="kt ir"> </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/99ac73aee37f361a9e47545cbcce2c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uf2usS1Eod6g_hMFdfU57A.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/89c70ce36b34ead28a00cebca4502fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hNy2A2h5sKTMmtvqQ6S1nw.png"/></div></div></figure><p id="ed57" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，打开“<code class="fe mv mw mx mh b">Cpp_to_RN.hpp</code>”<strong class="kt ir">”</strong>文件，创建一个包含函数而没有主体的类。</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="b92b" class="ln lo iq mh b gy ml mm l mn mo">#ifndef Cpp_to_RN_hpp<br/>#define Cpp_to_RN_hpp</span><span id="24af" class="ln lo iq mh b gy na mm l mn mo">#include &lt;stdio.h&gt;<br/>#include &lt;string&gt;</span><span id="7d03" class="ln lo iq mh b gy na mm l mn mo">class Cpp_to_RN {<br/>public:<br/>    std::string sayHello();<br/>};</span><span id="7ea1" class="ln lo iq mh b gy na mm l mn mo">#endif /* Cpp_to_RN_hpp */</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/c59e9aa1005d8023d5cfe86546450566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0P1yPD90rSXW3skOsmMLWg.png"/></div></div></figure><p id="6691" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后打开<code class="fe mv mw mx mh b">Cpp_to_RN.cpp</code>文件，写一个简单的函数<code class="fe mv mw mx mh b">sayHello()</code></p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="245c" class="ln lo iq mh b gy ml mm l mn mo">#include "Cpp_to_RN.hpp"<br/>std::string Cpp_to_RN::sayHello(){<br/>    return "Hello from CPP";<br/>}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ba77768870e32922bbde578fefc405ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w_lY3hNLdNhfg9boSNU1Ig.png"/></div></div></figure><h2 id="3fcb" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated"><strong class="ak"> 4。正在包装C++文件。</strong></h2><p id="ae35" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">将C++文件打包并导出到IOS (swift)端</p><p id="dc9c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">a.创建一个目标C文件，并将其命名为<code class="fe mv mw mx mh b">Cpp_to_RN.m</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/d98b4300e4ee4851baa6395a8ec47d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6h9PMcf86fQn6YxXCkyBug.png"/></div></div></figure><p id="5ed9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将<code class="fe mv mw mx mh b">Cpp_to_RN.m</code> <strong class="kt ir"> <em class="nd"> </em> </strong> <em class="nd">重命名为</em> <strong class="kt ir"> <em class="nd"> </em> </strong> <code class="fe mv mw mx mh b">Cpp_to_RN.mm</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/5c53997a54316e94104a81c5e4411301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCOtBuUwsA1jyTTcYJRRsQ.png"/></div></div></figure><p id="2a7c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">b.打开<code class="fe mv mw mx mh b">WrapCpp_to_RN.mm</code> <strong class="kt ir"> <em class="nd"> </em> </strong>文件，编写将从C++文件中包装函数<code class="fe mv mw mx mh b">sayHello</code>的主体内容。</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="1b44" class="ln lo iq mh b gy ml mm l mn mo">#import &lt;Foundation/Foundation.h&gt;<br/>#import "WrapCpp_to_RN.h"<br/>#import "Cpp_to_RN.hpp"</span><span id="783d" class="ln lo iq mh b gy na mm l mn mo"><a class="ae ne" href="http://twitter.com/implementation" rel="noopener ugc nofollow" target="_blank">@implementation</a> WrapCpp_to_RN</span><span id="70ed" class="ln lo iq mh b gy na mm l mn mo">- (NSString *) sayHello {<br/>  Cpp_to_RN fromCPP;<br/>    std::string helloWorldMessage = fromCPP.sayHello();<br/>    return [NSString<br/>            stringWithCString:helloWorldMessage.c_str()<br/>            encoding:NSUTF8StringEncoding];<br/>}<br/><a class="ae ne" href="http://twitter.com/end" rel="noopener ugc nofollow" target="_blank">@end</a></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/ab382943e0cad2144f498373f471bd39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i7j3hlKAKV-2Co9jPRJ6Qw.png"/></div></div></figure><p id="e0cf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">c.创建一个头文件，命名为<code class="fe mv mw mx mh b">WrapCpp_to_RN.h</code></p><p id="7c36" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将<code class="fe mv mw mx mh b">wrapSayHello</code>函数导出到Swift文件中</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="d06a" class="ln lo iq mh b gy ml mm l mn mo">#import &lt;Foundation/Foundation.h&gt;<br/><a class="ae ne" href="http://twitter.com/interface" rel="noopener ugc nofollow" target="_blank">@interface</a> WrapCpp_to_RN : NSObject<br/>- (NSString *) wrapSayHello;<br/><a class="ae ne" href="http://twitter.com/end" rel="noopener ugc nofollow" target="_blank">@end</a></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/6b9499ffef6264b04282e9efa33b336d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UgUFFh7cq9nBi_5_ay6cFA.png"/></div></div></figure><h2 id="8101" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated"><strong class="ak"> 5。在iOS (Swift)端工作</strong></h2><p id="4eb3" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">要导出C++函数以本机反应</p><p id="0e4f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">a.创建一个Swift文件，并将其命名为<code class="fe mv mw mx mh b">SendCpp_to_RN.swift</code></p><p id="f2b0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:Xcode会要求我们为我们创建一个<code class="fe mv mw mx mh b">NativeModules-Bridging-Header.h</code>文件。</p><p id="2698" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建一个类<code class="fe mv mw mx mh b">SendCpp_to_RN</code>并将其声明为<code class="fe mv mw mx mh b">NSObject</code></p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="f55c" class="ln lo iq mh b gy ml mm l mn mo">#import &lt;Foundation/Foundation.h&gt;<br/><a class="ae ne" href="http://twitter.com/interface" rel="noopener ugc nofollow" target="_blank">@interface</a> WrapCpp_to_RN : NSObject<br/>- (NSString *) wrapSayHello;<br/><a class="ae ne" href="http://twitter.com/end" rel="noopener ugc nofollow" target="_blank">@end</a></span></pre><p id="973f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">编写一个函数<code class="fe mv mw mx mh b">requiresMainQueueSetup()</code>来防止我们运行应用程序时出现警告</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="f676" class="ln lo iq mh b gy ml mm l mn mo">#import &lt;Foundation/Foundation.h&gt;<br/><a class="ae ne" href="http://twitter.com/interface" rel="noopener ugc nofollow" target="_blank">@interface</a> WrapCpp_to_RN : NSObject<br/>- (NSString *) wrapSayHello;<br/><a class="ae ne" href="http://twitter.com/end" rel="noopener ugc nofollow" target="_blank">@end</a></span></pre><p id="7f39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">编写一个函数来包装来自<code class="fe mv mw mx mh b">WrapCpp_to_RN.mm</code>的<code class="fe mv mw mx mh b">WrapCpp_to_RN()</code></p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="66a2" class="ln lo iq mh b gy ml mm l mn mo">import Foundation</span><span id="676d" class="ln lo iq mh b gy na mm l mn mo"><a class="ae ne" href="http://twitter.com/objc" rel="noopener ugc nofollow" target="_blank">@objc</a>(SendCpp_to_RN)<br/>class SendCpp_to_RN : NSObject {<br/>    <br/>  <a class="ae ne" href="http://twitter.com/objc" rel="noopener ugc nofollow" target="_blank">@objc</a> static func requiresMainQueueSetup() -&gt; Bool {<br/>        return false<br/>    }<br/>  <br/>  <a class="ae ne" href="http://twitter.com/objc" rel="noopener ugc nofollow" target="_blank">@objc</a> func fromCpp(_ successCallback: RCTResponseSenderBlock) -&gt; Void {<br/>    successCallback([NSNull(), WrapCpp_to_RN().wrapSayHello() as Any])<br/>    }</span><span id="0f4b" class="ln lo iq mh b gy na mm l mn mo">}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/9417812ac4c06a8ceeff793f3c0b96f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f5c2gkGL2v4OXgkTN4e3ag.png"/></div></div></figure><p id="826e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">b.在Swift文件中导出一个wrap函数以反应本机</p><p id="78e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用<code class="fe mv mw mx mh b">Callback</code>创建一个目标C文件来导出Swift类及其函数</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="e524" class="ln lo iq mh b gy ml mm l mn mo">#import &lt;React/RCTBridgeModule.h&gt;<br/>#import &lt;Foundation/Foundation.h&gt;<br/>#import "UIKit/UIKit.h"<br/><a class="ae ne" href="http://twitter.com/interface" rel="noopener ugc nofollow" target="_blank">@interface</a> RCT_EXTERN_MODULE(SendCpp_to_RN, NSObject)</span><span id="4bec" class="ln lo iq mh b gy na mm l mn mo">RCT_EXTERN_METHOD(fromCpp:(RCTResponseSenderBlock)successCallback)</span><span id="c632" class="ln lo iq mh b gy na mm l mn mo"><a class="ae ne" href="http://twitter.com/end" rel="noopener ugc nofollow" target="_blank">@end</a></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/84616ce7db8d254c2ebc7adee5a321ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mkJSslkLzNyqYCkG-Lhhpw.png"/></div></div></figure><p id="f551" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">c.反应过来的原生连接Swift，打开<code class="fe mv mw mx mh b">NativeModules-Bridging-Header.h</code> <strong class="kt ir"> </strong>文件</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="20d7" class="ln lo iq mh b gy ml mm l mn mo">#import &lt;React/RCTBridgeModule.h&gt;</span><span id="8de2" class="ln lo iq mh b gy na mm l mn mo">#import &lt;React/RCTViewManager.h&gt;</span><span id="f317" class="ln lo iq mh b gy na mm l mn mo">#import "WrapCpp_to_RN.h"</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/c130ca7ba4fb9ba5b4e3b5700de6d903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iA0NoxRAbXJ2JAlRhtRUnQ.png"/></div></div></figure><h2 id="6d7f" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated"><strong class="ak"> 6。在React本机侧工作</strong></h2><p id="a43e" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">调用Swift类及其函数</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="1b53" class="ln lo iq mh b gy ml mm l mn mo">import React from 'react';<br/>import {StyleSheet, Text, View, NativeModules, Button} from 'react-native';</span><span id="8a64" class="ln lo iq mh b gy na mm l mn mo">const App = () =&gt; {<br/>  const onPress = () =&gt; {<br/>    const {SendCpp_to_RN} = NativeModules;<br/>    SendCpp_to_RN.fromCpp((_err, res) =&gt; console.log(res));<br/>  };<br/>  return (<br/>    &lt;View style={styles.container}&gt;<br/>      &lt;Text&gt; Practice !&lt;/Text&gt;<br/>      &lt;Button title="C++ to React Native" color="#841584" onPress={onPress} /&gt;<br/>    &lt;/View&gt;<br/>  );<br/>};<br/>const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    justifyContent: 'center',<br/>    alignItems: 'center',<br/>  },<br/>});<br/>export default App;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/70b224235e29fead4e53119cb9baae25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CR44CQrdZdWSjmTUrSTz3Q.png"/></div></div></figure><p id="d911" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们完成了，只需运行应用程序</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="a9f5" class="ln lo iq mh b gy ml mm l mn mo">react-native run-ios</span></pre><p id="32be" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者只需点击Xcode上的“运行”按钮，看看我们做了什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/190e07e2511103b8befb342a15e14baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bL2jK-OPpl4XIxpvEm2VvQ.png"/></div></div></figure><p id="80b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望我的文章对你有帮助，感谢你的阅读时间。</p><p id="2aa9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里有一个GitHub链接，里面有关于本机模块的所有提示，请到达你想要克隆它的分支。</p><div class="nh ni gp gr nj nk"><a href="https://github.com/Wynne-Tran/NativeModules" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">GitHub-Wynne-Tran/native modules</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">github.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny kp nk"/></div></div></a></div></div></div>    
</body>
</html>