<html>
<head>
<title>Building a Minecraft Server in the Cloud for $2 a Month</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以每月2美元的价格在云中构建一个《我的世界》服务器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-minecraft-server-in-the-cloud-for-2-a-month-530ed0340800?source=collection_archive---------24-----------------------#2022-02-01">https://betterprogramming.pub/building-a-minecraft-server-in-the-cloud-for-2-a-month-530ed0340800?source=collection_archive---------24-----------------------#2022-02-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8399" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们如何将总定价从每月17美元降至2美元的故事</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4a201c3be1029778915e370e1f85c932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qkYzWnVZ4Cx44u3Y"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@helloimnik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">你好我是Nik </a>上<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="3feb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">挑战:我的朋友亚当和我正在进行一次怀旧之旅，想一起玩《我的世界》——就像10年前放学后我们一起做的那样。</p><p id="fb41" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大多数从个人电脑上运行过游戏服务器的人都会证明这有多烦人——要求主机同时在线，以便任何人都能连接。现在我们都有成年人的责任了。所以我们想支付托管费用，避免这种情况。</p><p id="4035" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们很便宜，《我的世界》领域(Mojang的第一方服务器产品)在英国每月5.59英镑。利用我们的AWS/JS技能，我们认为我们可以使它更便宜。</p><p id="f202" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们提出的架构:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/c2b606cb19cfaf0c279e82e2b2f48424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PpsKQsRcyg1nQ5dMu3uG2A.png"/></div></div></figure><p id="047b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">服务器运行在一个<code class="fe lt lu lv lw b">t3.small</code> EC2实例上，在安全组和NACL级别打开了必要的端口，以便用户能够从公共互联网与它通信。</p><p id="3a07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是第一个问题:AWS EC2是按服务器运行的时间计费的——对于伦敦地区，一个<code class="fe lt lu lv lw b">t3.small</code>实例每小时的费用是0.0236美元，这意味着如果服务器持续运行，总价格大约是每月17美元。为了降低成本，我们需要停止不使用的服务器。</p><p id="24da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们需要《我的世界》服务器可执行文件在实例启动时自动启动。我们使用了一个<code class="fe lt lu lv lw b">systemd</code>服务，它在启动时简单地执行<code class="fe lt lu lv lw b">server.jar</code>文件，并分配了所需的内存量。</p><p id="f601" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从这一点来看，我们可以在每次想玩的时候登录AWS管理控制台，并启动实例——但是我们设计了一个更优雅的解决方案。</p><p id="3852" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Adam <a class="ae kv" href="https://github.com/werzl/" rel="noopener ugc nofollow" target="_blank">使用React </a>构建了一个web前端，它触发了对Lambda函数的请求。这个用Python编写的Lambda函数使用boto3启动实例，Linux服务从那里启动Java可执行文件。</p><p id="24f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对AWS更有经验的人会注意到这里遗漏了一些东西——EC2实例在停止和启动时当然会改变它们的IP，除非分配了一个弹性IP(AWS对静态IP的名称)。</p><p id="8c3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这导致了我们的下一个问题:弹性IP只有在没有分配给正在运行的实例时才会产生费用。在我们使用EC2的情况下，大部分时间实例不会运行。这将意味着每月6-7美元的费用，使我们在价格上超过目标。</p><p id="374b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了解决这个问题，我们更新了Lambda，以便在启动时返回实例的公共IP，整齐地显示在前端:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/ad3d085303199f878a0feff271d4942d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*Zf6hDt6S701d2TPJc6SW8g.png"/></div></figure><p id="a43a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么我们在成本上击败了服务器吗？是的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ly"><img src="../Images/97ad334147063f3fb3c0d3898e5269e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iclu47CE4dMaVwAmTDxiDQ.png"/></div></div></figure><p id="dded" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在高峰期，该帐户的总成本仅在一个月内达到2.33美元。服务器增加到大约5-6个玩家，t3.small实例可以在没有明显减速的情况下处理所有问题。然而，这是在该帐户的免费等级期间，因此您的里程可能会有所不同。</p><h1 id="25df" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">潜在的改进</h1><p id="e6f9" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这是同时构建和测试的——与其说是一个完美的平台，不如说是一个原型。因此，一切都是手动设置的。我真的很想重新审视这个项目，让它依赖于短暂的实例，断开lambda函数停止和启动特定实例的连接。</p><p id="d906" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相反，它会在停止时终止一个实例，启动一个全新的实例，并从保留的EBS卷或S3存储桶中检索服务器文件。</p><p id="8c7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个方便的功能是自动更新服务器镜像——当新版本的《我的世界》发布时，新的<code class="fe lt lu lv lw b">server.jar</code>文件会自动安装在旧文件的位置，而不是手动上传。</p><p id="bb48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">自动备份是该系统的自然发展，在当前的设计中，在实例关闭之前进行基本的S3备份。</p><p id="fe44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了实现所有这些并使其更容易更新，我还将它构建到CloudFormation模板中，允许通过源代码控制跟踪代码更改，并从单一权威来源管理更改。</p><p id="67df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">手动管理云资源是一件痛苦的事情，并且无法扩展，不要这样做。</p><div class="mw mx gp gr my mz"><a href="https://github.com/werzl/jdmcserver" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">GitHub - werzl/jdmcserver: Lambda和python用于AWS EC2中托管的《我的世界》服务器。</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">github.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn kp mz"/></div></div></a></div></div></div>    
</body>
</html>