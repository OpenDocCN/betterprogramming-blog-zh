<html>
<head>
<title>How to Detect Coronavirus Using Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用深度学习检测冠状病毒</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-detect-coronavirus-using-deep-learning-1568332c728?source=collection_archive---------7-----------------------#2020-03-20">https://betterprogramming.pub/how-to-detect-coronavirus-using-deep-learning-1568332c728?source=collection_archive---------7-----------------------#2020-03-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="989b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">使用Python和深度学习技术自动检测X射线图像中的新冠肺炎</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3cd17f8931d89f6bcc2751958a8a4316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s1mHvw9wxrb8Bz5E"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@fusion_medical_animation?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">融合医学动画</a>拍摄</p></figure><p id="14b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，我们都知道新冠肺炎的存在，更好的说法是冠状病毒。</p><p id="dde2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它是由严重急性呼吸综合征冠状病毒2型(新型冠状病毒)引起的传染病。这种疾病于2019年在中国武汉首次被发现，此后在全球范围内传播，导致了2019-20冠状病毒疫情。常见症状包括发烧、咳嗽和气短(<a class="ae ky" href="https://en.wikipedia.org/wiki/Coronavirus_disease_2019" rel="noopener ugc nofollow" target="_blank">维基百科</a>)。</p><p id="076c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但今天，我们不会谈论疾病本身。相反，我们将看到如何使用TensorFlow、Keras和OpenCV在Python中创建深度学习模型，该模型可以分类为新冠肺炎阳性或新冠肺炎阴性的胸部x光图像。</p><p id="610d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始之前，我想提一下，这不是一个科学严谨的研究。只是用现实世界的问题来实际解释深度学习的一种方式。</p><p id="3682" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，我们可以设置我们将用于这个项目的开发环境。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c58b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置开发环境</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/c2fb2dbf1d38da37b2af6a920f5dd300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zh_mQFF6elp7WINi"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@fotomaniacu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> D L </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="731c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虚拟环境是一种工具，通过为不同项目创建隔离的Python虚拟环境，有助于保持不同项目所需的依赖关系分离。这意味着每个项目都可以有自己的依赖项，而不管其他项目有什么依赖项。</p><p id="bdc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中，为了构建虚拟环境，我们使用了<code class="fe mv mw mx my b"><a class="ae ky" href="https://virtualenv.pypa.io/en/latest/" rel="noopener ugc nofollow" target="_blank">virtualenv</a></code>包。</p><p id="5068" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为<code class="fe mv mw mx my b">virtualenv</code>安装Python绑定:</p><pre class="kj kk kl km gt mz my na nb aw nc bi"><span id="f3a4" class="nd md it my b gy ne nf l ng nh">pip install virtualenv</span></pre><p id="6c36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们使用以下命令创建环境:</p><pre class="kj kk kl km gt mz my na nb aw nc bi"><span id="2ed4" class="nd md it my b gy ne nf l ng nh">virtualenv project</span></pre><p id="7291" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建项目文件夹。然后我们激活虚拟环境:</p><p id="16ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在UNIX上(Mac和Linux): <code class="fe mv mw mx my b">source project/bin/activate</code></p><p id="48c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Windows上:<code class="fe mv mw mx my b">project\env\Scripts\activate.Bat</code></p><p id="fece" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们安装并设置了开发环境，现在我们需要安装我们将在本教程中使用的包:</p><ul class=""><li id="e210" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated"><a class="ae ky" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank">张量流</a>(这可能需要几分钟):<code class="fe mv mw mx my b">pip install tensorflow</code></li><li id="2772" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><a class="ae ky" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a> : <code class="fe mv mw mx my b">pip install sklearn</code></li><li id="38fe" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><a class="ae ky" href="https://pypi.org/project/imutils/" rel="noopener ugc nofollow" target="_blank">伊穆蒂尔斯</a> : <code class="fe mv mw mx my b">pip install imutils</code></li><li id="eb7b" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><a class="ae ky" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> Matplotlib </a> : <code class="fe mv mw mx my b">pip install matplotlib</code></li><li id="98d2" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><a class="ae ky" href="https://opencv.org/" rel="noopener ugc nofollow" target="_blank"> OpenCV </a> : <code class="fe mv mw mx my b">pip install opencv-python</code></li></ul><p id="0ce1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完所有这些包之后，您就可以进入下一步了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2e86" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">我们将在教程中做什么</h1><p id="f04e" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">正如我在标题中所说，我们将建立一个CNN来检测x光图像中的冠状病毒。</p><p id="c5e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章的结构是这样的:</p><ul class=""><li id="3da8" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">下载数据集</li><li id="4d28" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">构建卷积神经网络以自动检测X射线图像中的新冠肺炎</li><li id="0c96" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">模型的局限性</li><li id="6374" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">结论</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="88b0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据集</h1><p id="b3b4" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">我们将在本教程中使用的新冠肺炎X射线图像数据集是由蒙特利尔大学的博士后研究员<a class="ae ky" href="https://josephpcohen.com/w/" rel="noopener ugc nofollow" target="_blank">Joseph Cohen</a>博士管理的。</p><p id="39e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以从Dropbox 下载数据集。</p><p id="97d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下载完zip文件后，将其解压缩。你应该在你的下载文件夹中看到<em class="ob"> </em> <code class="fe mv mw mx my b">/dataset</code>文件夹。将其移动到您将在该项目中使用的目录中。</p><p id="a084" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我的目录是这样设置的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/04f5ef1b8343082745c0e48bdd8d893f.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*D2eBPvyGjaDfW57cCv0S-Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的项目的文件夹</p></figure><h2 id="8dfd" class="nd md it bd me od oe dn mi of og dp mm li oh oi mo lm oj ok mq lq ol om ms on bi translated">数据集的结构</h2><p id="eeb0" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">正如您在前面的图像中看到的，我们的数据集被分成两个文件夹:<code class="fe mv mw mx my b">/covid</code>和<code class="fe mv mw mx my b"> /normal</code> <strong class="lb iu">。</strong><code class="fe mv mw mx my b">/covid</code>目录包含25张Covid阳性胸部的X射线图像，而<code class="fe mv mw mx my b"> /normal</code>文件夹包含25张Covid阴性胸部的X射线图像。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cc39" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">CNN模型</h1><p id="e92e" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">在看到我们的数据集是如何构建的之后，我们可以开始构建我们的CNN脚本了。</p><h2 id="8577" class="nd md it bd me od oe dn mi of og dp mm li oh oi mo lm oj ok mq lq ol om ms on bi translated">导入和参数</h2><p id="3f66" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">创建<code class="fe mv mw mx my b">train_covid19.py</code> <strong class="lb iu"> </strong>文件并粘贴以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="893f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将创建的脚本使用TensorFlow、<a class="ae ky" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>、scikit-learn和OpenCV库。</p><p id="c4e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用:</p><ul class=""><li id="4bb3" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">TensorFlow和Keras与我们的CNN(卷积神经网络)有关的一切工作</li><li id="de1b" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">sci kit-学习使用数据预处理和模型评估</li><li id="d723" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">OpenCV加载和处理图像</li><li id="89e9" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">Matplotlib绘制模型的结果</li></ul><p id="5a44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入所需模块后，我们<a class="ae ky" href="https://docs.python.org/3/library/argparse.html" rel="noopener ugc nofollow" target="_blank">解析命令行参数</a>并初始化超参数(将用于构建CNN的参数):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="b719" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第2–9行定义了我们的<a class="ae ky" href="https://docs.python.org/3/library/argparse.html" rel="noopener ugc nofollow" target="_blank">命令行参数</a>:</p><ul class=""><li id="a1a6" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated"><code class="fe mv mw mx my b">–dataset</code>是数据集的路径。</li><li id="e2fd" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><code class="fe mv mw mx my b">–plot</code>是输出训练历史图的可选路径。默认是<code class="fe mv mw mx my b">plot.png</code>。</li><li id="992c" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated"><code class="fe mv mw mx my b">–model</code>是我们输出新冠肺炎模型的可选路径；默认情况下，它将被命名为<code class="fe mv mw mx my b">covid19.model</code>。</li></ul><p id="4380" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第13–15行定义了<a class="ae ky" href="https://machinelearningmastery.com/understand-the-dynamics-of-learning-rate-on-deep-learning-neural-networks/" rel="noopener ugc nofollow" target="_blank">初始学习率</a>、训练周期数<a class="ae ky" href="https://machinelearningmastery.com/difference-between-a-batch-and-an-epoch/" rel="noopener ugc nofollow" target="_blank">和批量大小</a>。</p><h2 id="27ca" class="nd md it bd me od oe dn mi of og dp mm li oh oi mo lm oj ok mq lq ol om ms on bi translated">加载和处理数据</h2><p id="58ff" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">我们现在准备加载和预处理X射线数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="b8eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了加载数据，我们获取数据集目录中图像的所有路径(第3行)。然后，对于每个<code class="fe mv mw mx my b">imagePath</code>，我们:</p><ul class=""><li id="8843" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">从路径中提取类标签(Covid或normal )(第11行)。</li><li id="b8e2" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">加载图像，通过转换为RGB通道排序对其进行预处理，并将其大小调整为224×224像素，以便为我们的卷积神经网络做好准备(第15–17行)。</li><li id="e93d" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">分别更新我们的数据和标签列表(第20和21行)。</li></ul><p id="2f00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第25–27行:将数据和标签转换成NumPy数组。</p><p id="c637" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用一次热编码(第2–4行)对标签进行编码，并将数据集分成<em class="ob"> </em>列并进行测试:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="fbf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一键编码意味着我们的数据将以下列格式显示:</p><p id="f039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">[[0. 1.] [0. 1.] [0. 1.] … [1. 0.] [1. 0.] [1. 0.]]</p><p id="9896" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个编码标签由一个两元素数组组成，其中一个元素为“热”(1)或“非”(0)。我们根据需要使用它来分类积极或消极的情况；也就是说，我们执行二元分类。</p><p id="2c20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第9行，<strong class="lb iu"> </strong>测试大小0.20意味着我们分割数据集，保留20%用于测试，剩下的80%用于训练。</p><p id="c949" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在第12–14行，我们执行数据扩充，这是一种提高模型分类能力的数据预处理技术。</p><h2 id="3884" class="nd md it bd me od oe dn mi of og dp mm li oh oi mo lm oj ok mq lq ol om ms on bi translated">建立模型</h2><p id="c523" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">处理完所有数据后，我们可以初始化我们的模型。我们将使用<a class="ae ky" href="https://keras.io/applications/#vgg16" rel="noopener ugc nofollow" target="_blank"> VGG16型号</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="5c10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第2–3行用ImageNet 上预先训练的权重实例化了<a class="ae ky" href="https://keras.io/applications/#vgg16" rel="noopener ugc nofollow" target="_blank"> VGG16网络。</a></p><p id="068a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第6–11行，我们构建了<a class="ae ky" href="https://keras.io/layers/core/" rel="noopener ugc nofollow" target="_blank">头部层</a>，在第14行，我们将它们添加到模型中。</p><p id="7181" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第17–18行，我们冻结了模型中的每一层，这样它们就不会在第一次训练过程中更新。</p><h2 id="eff2" class="nd md it bd me od oe dn mi of og dp mm li oh oi mo lm oj ok mq lq ol om ms on bi translated">训练CNN</h2><p id="f92e" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">我们现在准备编译和训练我们的新冠肺炎(冠状病毒)深度学习模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="2fb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第3–4行:这里我们用<a class="ae ky" href="https://keras.io/optimizers/" rel="noopener ugc nofollow" target="_blank"> Adam优化器</a>编译CNN。鉴于这是一个两类问题，我们使用<code class="fe mv mw mx my b">binary_crossentropy</code>损失而不是分类<code class="fe mv mw mx my b">crossentropy</code>。</p><p id="bc14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第9–14行:我们调用了<a class="ae ky" href="https://keras.io/models/sequential/" rel="noopener ugc nofollow" target="_blank"> Keras的fit_generator方法</a> <a class="ae ky" href="https://www.pyimagesearch.com/2018/12/24/how-to-use-keras-fit-and-fit_generator-a-hands-on-tutorial/" rel="noopener ugc nofollow" target="_blank">，</a>，同时通过我们的数据扩充对象传递胸部x光数据。</p><h2 id="a42d" class="nd md it bd me od oe dn mi of og dp mm li oh oi mo lm oj ok mq lq ol om ms on bi translated">评估模型</h2><p id="ce62" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">训练模型后，我们对其进行评估:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="e241" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第3–6行:我们对测试集进行预测，并获取预测指数。</p><p id="a597" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第9–10行:这里我们使用scikit-learn的助手工具生成并打印一份分类报告。</p><p id="5541" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们为进一步的统计评估计算混淆矩阵:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="f01d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第2行:生成混淆矩阵。</p><p id="9fd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第4–6行:使用混淆矩阵得出准确性、敏感性和特异性，并打印出来(第9–12行)。</p><h2 id="74d6" class="nd md it bd me od oe dn mi of og dp mm li oh oi mo lm oj ok mq lq ol om ms on bi translated">历史训练图和模型序列化</h2><p id="9047" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">我们至少已经完成了我们的冠状病毒(新冠肺炎)探测器CNN。但是我们还希望看到检测器的训练历史，并在最后将模型保存在一个文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="e521" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第2–12行:绘制模型的训练精度/损失。</p><p id="ba24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第13行:保存我们在参数中定义的<code class="fe mv mw mx my b">plot.png</code>图像中的情节。</p><p id="876e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第16–17行:<strong class="lb iu"> </strong>将<strong class="lb iu"> </strong>模型保存在<code class="fe mv mw mx my b">.model</code>文件中。</p><p id="8011" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">搞定了。</p><p id="b6ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是完整的<code class="fe mv mw mx my b">train_covid19.py</code>代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/806f477f3a4302b3e8ecab1fc54ca685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3TuSlqRpu-a0AKO-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯蒂安·博尔特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="458e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">试验</h1><p id="a58e" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">现在我们测试我们的CNN。但在此之前，我们先回顾一下我们所做的事情:</p><ol class=""><li id="bdb8" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu or no np nq bi translated">创建了虚拟环境并安装了TensorFlow、scikit-learn、Imutils、Matplotlib和OpenCV</li><li id="91d5" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">下载了数据集并讨论了它的结构</li><li id="4a44" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">创造了<code class="fe mv mw mx my b">train_covid19.py</code></li><li id="5ded" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">导入了所需的模块</li><li id="4533" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">加载并预处理数据集</li><li id="08cb" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">构建模型及其图层</li><li id="9831" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">训练它并保存它的准确性</li><li id="61aa" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">在<code class="fe mv mw mx my b">plot.png</code>图像中绘制模型的精度/损失历史</li><li id="90d0" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">将模型保存在<code class="fe mv mw mx my b">covid19.model</code>文件中</li></ol><p id="9c6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看我们项目的文件夹:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/d39504ea0bb729e4c38a0b99e8b9420b.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*fWsfuetMpR--FtYH9ruK_Q.png"/></div></figure><p id="c045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们之前创建的<code class="fe mv mw mx my b">train_covid19.py</code>文件与<code class="fe mv mw mx my b">/dataset</code>文件夹在同一个目录下。这是一个关键点，因为脚本在<code class="fe mv mw mx my b">/covid-19_x_rays_detect</code>文件夹中搜索数据集文件夹。</p><p id="5c12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您的目录像前面看到的那样设置好了，我们就可以执行<code class="fe mv mw mx my b">train_covid19.py</code>文件:</p><pre class="kj kk kl km gt mz my na nb aw nc bi"><span id="5adc" class="nd md it my b gy ne nf l ng nh">python3 train_covid19.py –dataset dataset</span></pre><p id="ac76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将需要几分钟的时间，因为处理图像的计算成本更高。最后，您的输出应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/63e03ffc815ba389231a7d93b800601b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QsJnbSLzz-rhbTRTw2Q38Q.png"/></div></div></figure><p id="1003" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的<code class="fe mv mw mx my b">train_covid19.py</code>:</p><ol class=""><li id="0e4d" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu or no np nq bi translated">读取并预处理数据集</li><li id="5fc8" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">下载了VGG16型号的重量</li><li id="69e8" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">为模型训练了25个时期</li><li id="9446" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">评估了CNN的表现</li><li id="0dca" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu or no np nq bi translated">打印出来了</li></ol><p id="5703" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，查看您的目录，您应该会看到一个新的<code class="fe mv mw mx my b">plot.png</code>文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/be00094a94dfee2384c485a6f6809f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*hNUDTzfnymK3CABORN0rmQ.png"/></div></figure><p id="cf7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过读取模型的训练历史，我们可以获得以下内容:</p><ul class=""><li id="ffb9" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">模型没有过度拟合或拟合不足。这意味着它在训练和测试中是一样的。</li><li id="4e88" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">它的损失随着时代的增加而减少。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7a52" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">该模型的局限性</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/1aeef33ba858238202473df6217fad0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*92YK31jI-C9E-m1z"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ludo_photos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ludovic Charlet </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="2c1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创造了一个完美的卷积神经网络来检测新冠肺炎。另一方面，我们的CNN也不是很准确；它有80%的准确率，但是为什么呢？</p><ul class=""><li id="1653" class="ni nj it lb b lc ld lf lg li nk lm nl lq nm lu nn no np nq bi translated">也许有更好的分类模型。</li><li id="2dea" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">数据集非常非常小。不幸的是，我没有发现其他新冠肺炎阳性的胸部x光片。</li><li id="db89" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">很难对图像进行分类，尤其是对于不是医学专家的人来说。</li><li id="d235" class="ni nj it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">该模型只考虑图像，而不考虑你在过去几周去过哪里，或者类似的事情。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a335" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="5772" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">我真的希望这篇文章成功实现了它的主要目的:以实用的方式教授深度学习。事实上，通过阅读我以前的关于使用Python进行情感分析的文章，或者等我发表其他文章，你会发现我的主要意图是以实用和聪明的方式解释复杂的主题，使你能够解决现实世界的问题。</p></div></div>    
</body>
</html>