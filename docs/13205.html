<html>
<head>
<title>Build a REST API With Deno Using MVC Pattern and MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MVC模式和MySQL构建一个REST API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deno-rest-api-with-mvc-pattern-using-mysql-212af5c6306?source=collection_archive---------5-----------------------#2022-08-07">https://betterprogramming.pub/deno-rest-api-with-mvc-pattern-using-mysql-212af5c6306?source=collection_archive---------5-----------------------#2022-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b38e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用新的简单、现代和快速的JavaScript/TypeScript运行时</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c9dfce229dfb9750a391e2625d860372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KyO-JAcZ90rcic45.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">天龙🦕</p></figure><p id="34fc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以在GitHub资源库中查看本文中开发的全部代码。</p><h1 id="b74b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">先决条件</h1><p id="619e" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">我喜欢Deno的一点是，它不需要你安装这么多的依赖项来开始。你只需要在你的机器上安装Deno。要做到这一点，你只需按照这里的指示<a class="ae lr" href="https://deno.land/#installation" rel="noopener ugc nofollow" target="_blank"/>。我推荐你直接用PowerShell (Windows) <em class="mp"> </em>安装就可以了。</p><p id="2cc0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如您所知，我们将使用MVC模式构建REST API。如果你不熟悉MVC模式，我建议你<a class="ae lr" href="https://dev.to/software_writer/introduction-to-the-mvc-pattern-in-asp-net-58c8" rel="noopener ugc nofollow" target="_blank">阅读这篇文章</a>来稍微了解一下MVC。基本上，MVC代表模型-视图-控制器，这是我们将要用来构建我们的REST API的结构，但是因为我们只构建没有任何用户界面(UI)的API，所以我们将省略视图。</p><p id="e5d6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们项目的文件夹结构如下所示:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="fd89" class="mv lt iq mr b gy mw mx l my mz">- data<br/>- controllers<br/>- routes</span></pre><p id="68cd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe na nb nc mr b">Data</code>是模型文件夹。<code class="fe na nb nc mr b">Controllers</code>是我们的控制器，<code class="fe na nb nc mr b">routes</code>是路由器，负责将传入的浏览器请求映射到指定的MVC控制器动作。</p><h1 id="a2e9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">构建REST API(编码时间)💻</h1><p id="9685" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">现在您已经知道了先决条件和结构，是时候开始构建应用程序了。你应该做的第一件事是在你的数据库上做一个新表，哦，对了，我们要做一个众所周知的待办事项应用程序(为什么不呢)。我们将使用MySQL作为我们的RDBMS，这是表模式:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="773f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，我们将制作数据库配置文件，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e82f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以看到我使用<code class="fe na nb nc mr b">environment</code>来存储所有的数据库连接字符串。您可以很容易地创建<code class="fe na nb nc mr b">.env</code>文件，并用您需要的环境变量填充它。</p><p id="5c8e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们首先创建接口，或者我想称它为数据传输对象(对不起，我以前用。网)。我们的界面应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e762" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">只是简单的三个属性。在我们有了接口之后，现在是时候从底部开始构建第一个门了，也就是存储库，也就是模型，也就是任何与数据库直接交互的东西，也就是你可以称之为编写数据库查询的地方。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="9980" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如你所见，我导入了<code class="fe na nb nc mr b">db.ts</code>和我们之前已经做好的接口。在这个存储库中，定义了五个函数来通过SQL查询执行我们的CRUD应用程序。你可以在这里看到Deno MySQL驱动<a class="ae lr" href="https://github.com/denodrivers/mysql" rel="noopener ugc nofollow" target="_blank">的完整文档。</a></p><p id="c342" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们定义了存储库/数据文件夹之后，现在我们将让控制器负责控制应用程序逻辑，并充当HTTPS请求和数据门之间的协调。我们的控制器应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="7526" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此时，您实际上可以看到MVC结构在这个应用程序上是如何工作的，对吗？这很简单，因为我们要做的下一件事是制定路线，这是来自用户的每个请求的大门。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="8863" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">每条路线都有自己的服务方式。我们有一些路线，包括一条我特意加在这个文件上的主要路线。我们几乎完成了所有的工作，除了最后一件事——运行整个系统/服务器的主文件。</p><p id="6df6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的主文件如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="2637" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们已经拥有了运行服务器所需的所有<em class="mp">要素</em>，您可以使用以下命令进入终端并运行应用程序:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="f287" class="mv lt iq mr b gy mw mx l my mz">deno run --allow-read --allow-env --allow-net server.ts</span></pre><p id="c473" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不要忘记打开您的本地SQL server。之后，您可以尝试使用Postman访问我们创建的端点。</p><h1 id="550c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">部署</h1><p id="757a" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">不用说，Deno是一个构建服务器应用程序的快速简单的JS/TS运行时。</p><p id="a199" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不仅如此，当我们谈论部署时，Deno也派上了用场，因为Deno使用<a class="ae lr" href="https://dash.deno.com/" rel="noopener ugc nofollow" target="_blank">dash.deno.com</a>提供了CI/CD部署系统。</p><p id="bf1e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你熟悉Netlify、Vercel、Heroku等平台，那么在使用<a class="ae lr" href="https://dash.deno.com/" rel="noopener ugc nofollow" target="_blank"> Deno Deploy </a>时你不会感到任何麻烦。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/bc33a8d862a2c8f7013ab0441f86941c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tXCHpOuAQleH_tet35IEcw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Deno部署</p></figure><h1 id="08b6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">也许有所改善</h1><p id="f0d8" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">我已经包含了一个测试文件，其中包含了每个控制器/端点的单元测试。如你所知，这个项目只是我周末愉快学习的一部分，在我使用的原则模式上肯定有许多小错误或者可能是错误的实现，所以我不建议你在生产基础上使用这个项目，因为你需要真正考虑应用程序的安全性和可靠性。</p><p id="9253" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">源代码这里是<a class="ae lr" href="https://github.com/jerichosiahaya/deno-crud" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="ba14" class="mv lt iq mr b gy mw mx l my mz"><strong class="mr ir">Want to Connect?</strong></span><span id="87fd" class="mv lt iq mr b gy ng mx l my mz">If you have any recommendations about better implementation, how to improve my code or anything, please just hit me up on <a class="ae lr" href="http://twitter.com/jerichosiahaya" rel="noopener ugc nofollow" target="_blank">Twitter</a> or <a class="ae lr" href="http://linkedin.com/in/jerichosiahaya" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</span></pre></div></div>    
</body>
</html>