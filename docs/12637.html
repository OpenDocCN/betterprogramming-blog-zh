<html>
<head>
<title>3 Examples of Motifs with Spark GraphFrames</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">3个带有火花图案框架的图案示例</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/3-examples-of-motifs-with-spark-graphframes-db873b3fdc8a?source=collection_archive---------3-----------------------#2022-06-18">https://betterprogramming.pub/3-examples-of-motifs-with-spark-graphframes-db873b3fdc8a?source=collection_archive---------3-----------------------#2022-06-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b985" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在图中寻找特定的关系模式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/292cfe91f0a85755ee0a437b5fab19ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m02jwEsAHhgn_m03Pn_6RA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://github.com/neo4j-graph-examples/recommendations" rel="noopener ugc nofollow" target="_blank"> Neo4j图推荐回购</a></p></figure><h2 id="b86d" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h2><p id="9d97" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">图形分析提供了一种分析节点(实体)之间的边(关系)的好方法。Apache Spark提供了两种处理图形数据的方法；GraphX和GraphFrames。GraphFrames允许您快速创建数据的图形表示。如果你已经来自Spark的世界，GraphFrames <a class="ae ky" href="https://graphframes.github.io/graphframes/docs/_site/index.html" rel="noopener ugc nofollow" target="_blank">文档</a>将自己描述为:</p><blockquote class="mo mp mq"><p id="4615" class="lv lw mr lx b ly ms ju ma mb mt jx md mu mv mf mg mw mx mi mj my mz ml mm mn im bi translated">GraphFrames对于数据帧，就像GraphX对于rdd一样。</p></blockquote><p id="0c74" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">在本教程的剩余部分，我将介绍什么是“motif”，基于<a class="ae ky" href="https://github.com/neo4j-graph-examples/recommendations" rel="noopener ugc nofollow" target="_blank"> Neo4j电影数据集</a>创建一个图表，并使用“motif”查找3个示例。</p><p id="8c30" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">本文的所有代码和数据都可以在repo <a class="ae ky" href="https://github.com/sjrusso8/graph-motifs" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="3121" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是“主题”？</h2><p id="a0d0" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">“主题”的标准定义是<em class="mr">一种</em> <strong class="lx iu"> <em class="mr">装饰性的设计或图案</em> </strong> <em class="mr">。</em>这和图表有什么关系？图表框架“主题”允许您在图表中搜索结构模式。Motifs使用领域特定语言(DSL)来探索图形以匹配模式，并提供具有匹配模式的过滤数据帧。</p><p id="b0fd" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">motif语言乍一看有点奇怪，但是一旦你掌握了它，它会非常有用。比如回答问题“<em class="mr">的一个模体，有哪些节点对是双向互相连接的？</em>”会是这样的<code class="fe na nb nc nd b">(“(a)-[e]-&gt;(b); (b)-[e2]-&gt;(a)”)</code>。</p><p id="ef87" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">你可以把<code class="fe na nb nc nd b">(“(a)-[e]-&gt;(b); (b)-[e2]-&gt;(a)”)</code>理解为</p><blockquote class="mo mp mq"><p id="1a0c" class="lv lw mr lx b ly ms ju ma mb mt jx md mu mv mf mg mw mx mi mj my mz ml mm mn im bi translated">找出节点'(a)'通过边'[e]'直接连接到节点'(b)'以及节点'(b)'通过边'(e2)'直接连接回节点'(a '的所有情况</p></blockquote><p id="2f0b" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">这里的关键词是“<em class="mr">直接连接</em>”，因为主题寻找两个节点之间的方向关系。括号中的值可以不同，使用适当的标签会更有意义。这对于下面的例子来说更有意义。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h2 id="91d8" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">初始化GraphFrames中的图形</h2><p id="cb36" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我假设您已经运行了一个Apache Spark实例并安装了GraphFrames。有更好的例子可以详细地向你展示。</p><p id="671a" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">我使用一个Databricks工作区和一个运行Spark 10.4 LTS ML的小型集群。Spark ML版本在集群上预装了GraphFrames。我在这个演示中使用的数据来自<a class="ae ky" href="https://github.com/neo4j-graph-examples/recommendations" rel="noopener ugc nofollow" target="_blank"> Neo4j电影数据集</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="8983" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">简单主题</h2><p id="7058" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">让我们从一个简单的主题开始回答这个问题:</p><p id="57ac" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated"><em class="mr">“汤姆·汉克斯演过的电影都是什么，他演了什么角色？”</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6da5" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">motif返回一个数据帧，其中motif值用作列名。列的底层字段将是包含该记录所有属性的<code class="fe na nb nc nd b">struct</code>类型字段。您可以在一个<code class="fe na nb nc nd b">struct</code>类型字段上使用PySpark点符号来轻松过滤和选择结果数据帧中的细节。</p><h2 id="c0f3" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">匿名边和节点</h2><p id="7792" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">您也可以通过省略motif中的值来选择不返回节点或边。对于这个例子，我们将回答这个问题:</p><p id="09df" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated"><em class="mr">哪些人有不止一种外向关系类型？</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="e596" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">这个例子通过使用函数<code class="fe na nb nc nd b">collect_set</code>将所有的关系类型组合成一个集合来聚合数据。这将返回一个数组，其中包含一个组的所有唯一值。在这种情况下，它返回特定个人的唯一传出关系类型的数组。</p><h2 id="7499" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">定向可变长度基序</h2><p id="81ad" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">与Neo4j中使用的Cypher语言相比，GraphFrames的一个局限性是无法轻松创建可变长度的模式。有一种方法可以通过一些聪明的python编码来解决这个问题，但是结果相当笨拙。</p><p id="94ae" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">下面的代码通过将生成的主题追加到单个数据帧中来创建一个可变长度的主题。然后使用一些列表理解来创建一个列，将特定于域的值合并成一个列。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="7c90" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结束了！</h2><p id="a0c5" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这篇文章回顾了一些有价值的使用GraphFrames寻找模体的特定领域的例子。我强烈建议您也探索Neo4j和其他专门为图形数据构建的库。</p><p id="c20c" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">同样，所有代码都可以在repo <a class="ae ky" href="https://github.com/sjrusso8/graph-motifs" rel="noopener ugc nofollow" target="_blank">这里</a>中获得。</p><p id="44d9" class="pw-post-body-paragraph lv lw it lx b ly ms ju ma mb mt jx md li mv mf mg lm mx mi mj lq mz ml mm mn im bi translated">感谢阅读。</p></div></div>    
</body>
</html>