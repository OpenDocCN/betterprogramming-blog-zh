<html>
<head>
<title>Spin Up a Rails API for Your New Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为您的新项目创建一个Rails API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-fire-up-a-rails-api-for-your-new-project-6fad595caf07?source=collection_archive---------8-----------------------#2020-09-04">https://betterprogramming.pub/how-to-fire-up-a-rails-api-for-your-new-project-6fad595caf07?source=collection_archive---------8-----------------------#2020-09-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="828b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">立即开始新的Rails API项目</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6832fceefec7ea9938b4d09bdce852ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TjZUiCikoXYU0__n"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@rparmly?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">罗斯·帕莫利</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="780f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，你的任务是为你的新项目使用一个<a class="ae ky" href="https://guides.rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"> Rails </a> API后端，而你不知道从哪里开始。</p><p id="7038" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">我再安装什么宝石？！如何指定我想使用PostgreSQL？！串行器到底是什么？我需要一个登录功能，完全忘记了如何工作</em> <code class="fe lw lx ly lz b"><em class="lv">bcrypt</em></code> <em class="lv">！[-开始内心沮丧的尖叫-] </em></p><p id="18e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有恐惧，初学者Rails开发，这里是我需要你做的:1。深呼吸，然后2。使用这个分步指南作为你开始的模型。</p><p id="f43d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了这个演示的目的，我将设置两个模型的电子商务应用程序的后端:<strong class="lb iu"> </strong>用户<strong class="lb iu"> </strong>和项目。一个用户有许多想要出售的物品，而一个物品属于一个用户。好了，我们开始吧！</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="0d43" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">步骤0。使用“rails new”命令创建新的Rails应用程序</h1><ul class=""><li id="4030" class="mz na it lb b lc nb lf nc li nd lm ne lq nf lu ng nh ni nj bi translated">导航到要存储Rails应用程序的文件夹。在终端中抛出下面的命令，告诉Rails您想要创建一个新项目，使用<a class="ae ky" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>作为数据库，并且它将是一个API。</li></ul><pre class="kj kk kl km gt nk lz nl nm aw nn bi"><span id="621d" class="no mi it lz b gy np nq l nr ns">rails new &lt;project-name&gt; --database=postgresql --api</span></pre><ul class=""><li id="1624" class="mz na it lb b lc ld lf lg li nt lm nu lq nv lu ng nh ni nj bi translated">您应该已经安装了PostgreSQL。如果没有，按照<a class="ae ky" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">步骤安装</a>。</li><li id="9310" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated">在GitHub上创建一个新的存储库，将<strong class="lb iu"> </strong> <code class="fe lw lx ly lz b">/ <strong class="lb iu">cd</strong></code>导航到您刚刚创建的新rails项目目录，并按照GitHub给出的步骤在您的新项目中初始化Git。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/58d4ae5bf272eae59518218e47fb027b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GhT9UVM0qCSTGDgFMKgq2A.png"/></div></div></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="749f" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第一步。启用“bcrypt”和“rack-cors”</h1><ul class=""><li id="faba" class="mz na it lb b lc nb lf nc li nd lm ne lq nf lu ng nh ni nj bi translated">导航到您的<code class="fe lw lx ly lz b">Gemfile</code>，取消注释<code class="fe lw lx ly lz b">gem ‘bcrypt’</code>和<code class="fe lw lx ly lz b">gem ‘rack-cors’</code>。</li><li id="1387" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated"><code class="fe lw lx ly lz b">bcrypt</code> gem允许你使用<code class="fe lw lx ly lz b">has_secure_password</code>宏来很好地保护你的密码验证。</li><li id="e662" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated"><code class="fe lw lx ly lz b"><a class="ae ky" href="https://github.com/cyu/rack-cors" rel="noopener ugc nofollow" target="_blank">rack-cors</a></code> gem是一个中间件，它让跨源AJAX/获取数据的魔力得以实现。</li><li id="b00a" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated">完成后在你的终端上运行<code class="fe lw lx ly lz b">bundle install</code>来安装这些gem。</li><li id="cadb" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated">导航进入<code class="fe lw lx ly lz b">config/initializers/cors.rb</code>，取消<code class="fe lw lx ly lz b">Rack::Cors</code>配置的注释，将<code class="fe lw lx ly lz b">'example.com'</code>原点改为<code class="fe lw lx ly lz b">'*'</code>:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/708a301e45248878789dd48e33350861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFJk_P_k2gB83mpbKPZuwA.png"/></div></div></figure><ul class=""><li id="e320" class="mz na it lb b lc ld lf lg li nt lm nu lq nv lu ng nh ni nj bi translated">当您稍后部署您的应用程序时，将<code class="fe lw lx ly lz b">origin</code>更改为您的前端网站地址将只允许您的前端向您的后端发出获取请求。目前，通配符<code class="fe lw lx ly lz b">'*'</code>允许任何本地主机URL从您的后端获取信息。</li></ul></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="0984" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第二步。为您的表生成迁移、模型和资源</h1><ul class=""><li id="0c54" class="mz na it lb b lc nb lf nc li nd lm ne lq nf lu ng nh ni nj bi translated">我的数据库将保存两个表的信息:<code class="fe lw lx ly lz b">users</code>和<code class="fe lw lx ly lz b">items</code>。这是我希望他们看起来的样子:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/e574df9a97cb8674c9154d739d538df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LKJnqeaEhvCwlJRvez3ZCw.png"/></div></div></figure><ul class=""><li id="bb5a" class="mz na it lb b lc ld lf lg li nt lm nu lq nv lu ng nh ni nj bi translated">使用<code class="fe lw lx ly lz b">rails g resource</code>，我可以使用以下命令生成迁移、模型和资源:</li><li id="7f0c" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated"><code class="fe lw lx ly lz b">rails g resource User username password_digest city state zip:integer email</code></li><li id="3c57" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated"><code class="fe lw lx ly lz b">rails g resource Item user:belongs_to name description condition price:integer pickup:boolean shipping:boolean category photo</code></li><li id="c200" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated">如果数据类型是字符串，则不需要在列名后指定它们的类型。添加<code class="fe lw lx ly lz b">user:belongs_to</code>指定两个表之间的关系，并在<code class="fe lw lx ly lz b">items</code>表中为<code class="fe lw lx ly lz b">user_id</code>设置一列。此外，我们使用列名<code class="fe lw lx ly lz b">password_digest</code>来避免直接将密码存储为字符串。</li><li id="19f4" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated">接下来，运行<code class="fe lw lx ly lz b">rails db:create</code>来创建后端，运行<code class="fe lw lx ly lz b">rails db:migrate</code>来迁移您的表。然后，转到您的模型，以确保建立了适当的关系(<code class="fe lw lx ly lz b">has_many</code>、<code class="fe lw lx ly lz b">belongs_to</code>)。</li></ul></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="1368" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第三步。使用“bcrypt”并添加一些验证</h1><ul class=""><li id="ea55" class="mz na it lb b lc nb lf nc li nd lm ne lq nf lu ng nh ni nj bi translated">你安装的<code class="fe lw lx ly lz b">bcrypt</code> gem允许你使用一个叫做<code class="fe lw lx ly lz b">has_secure_password</code>的宏。将此添加到您的用户模型中，因为我们将验证用户的密码。在那里，为<code class="fe lw lx ly lz b">email</code>和<code class="fe lw lx ly lz b">username</code>添加验证:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="db27" class="mz na it lb b lc ld lf lg li nt lm nu lq nv lu ng nh ni nj bi translated">添加这一点，您应该导航到您的<code class="fe lw lx ly lz b">db/seeds.rb</code>文件，生成种子数据，并在<code class="fe lw lx ly lz b">rails console</code>中测试它们。</li></ul></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="3968" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第四步。生成序列化程序</h1><ul class=""><li id="dbc4" class="mz na it lb b lc nb lf nc li nd lm ne lq nf lu ng nh ni nj bi translated">序列化器允许您以对前端最有用的格式组织发送的JSON数据。我将在这个演示中使用<code class="fe lw lx ly lz b">active_model_serializers</code>。首先，将<code class="fe lw lx ly lz b">gem 'active_model_serializers'</code>添加到您的<code class="fe lw lx ly lz b">Gemfile</code>中，然后再次运行<code class="fe lw lx ly lz b">bundle install</code>。</li><li id="547d" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated">使用以下命令为用户和项目生成序列化程序:</li><li id="2943" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated"><code class="fe lw lx ly lz b">rails g serializer User</code>T24<code class="fe lw lx ly lz b">rails g serializer Item</code></li><li id="774e" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated">导航到<code class="fe lw lx ly lz b">app/serializers</code>并为您的序列化程序类设置属性。这些属性指定了您希望作为JSON发送出去的键及其相应的值。我的<code class="fe lw lx ly lz b">UserSerializer</code>类现在看起来像这样:</li></ul><pre class="kj kk kl km gt nk lz nl nm aw nn bi"><span id="281f" class="no mi it lz b gy np nq l nr ns">class UserSerializer &lt; ActiveModel::Serializer<br/>   attributes :id, :username, :city, :state, :zip, :email<br/>end</span></pre><ul class=""><li id="a334" class="mz na it lb b lc ld lf lg li nt lm nu lq nv lu ng nh ni nj bi translated">注意，我没有发送<code class="fe lw lx ly lz b">created_at</code>、<code class="fe lw lx ly lz b">updated_at</code>和<code class="fe lw lx ly lz b">password_digest</code>列。序列化器的奇妙之处在于，您可以只发送前端需要的信息，而隐藏其余的信息。</li><li id="63bb" class="mz na it lb b lc nw lf nx li ny lm nz lq oa lu ng nh ni nj bi translated">我的<code class="fe lw lx ly lz b">ItemSerializer</code>类是这样的:</li></ul><pre class="kj kk kl km gt nk lz nl nm aw nn bi"><span id="ab5a" class="no mi it lz b gy np nq l nr ns">class ItemSerializer &lt; ActiveModel::Serializer<br/>   attributes :id, :name, :description, :condition, :price, :pickup, :shipping, :category, :photo, :user</span><span id="3a71" class="no mi it lz b gy og nq l nr ns">   belongs_to :user<br/>end</span></pre><ul class=""><li id="2009" class="mz na it lb b lc ld lf lg li nt lm nu lq nv lu ng nh ni nj bi translated">在这里指定<code class="fe lw lx ly lz b">belongs_to :user</code>并将<code class="fe lw lx ly lz b">:user</code>作为一个属性，这样当我发送一个获取项目的请求时，我得到的数据将具有以下格式:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="0126" class="mz na it lb b lc ld lf lg li nt lm nu lq nv lu ng nh ni nj bi translated">请注意与项目关联的用户是如何嵌套在项目对象中的。串行器是自切片面包以来最好的东西，证明我错了！</li></ul></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="8458" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">第五步。设置路线和行动</h1><ul class=""><li id="f9ad" class="mz na it lb b lc nb lf nc li nd lm ne lq nf lu ng nh ni nj bi translated">我想为项目设置一个路由，这样当我请求get <code class="fe lw lx ly lz b">/items</code>时，我就可以接收到JSON数据，该数据以刚才描述的格式表示我的数据库中的项目。为此，首先在<code class="fe lw lx ly lz b">config/routes.rb</code>中指定以下内容:</li></ul><pre class="kj kk kl km gt nk lz nl nm aw nn bi"><span id="1854" class="no mi it lz b gy np nq l nr ns">resources :items, only: [:index]</span></pre><ul class=""><li id="be77" class="mz na it lb b lc ld lf lg li nt lm nu lq nv lu ng nh ni nj bi translated">接下来，创建<code class="fe lw lx ly lz b">items#index</code>动作，看起来像这样:</li></ul><pre class="kj kk kl km gt nk lz nl nm aw nn bi"><span id="954d" class="no mi it lz b gy np nq l nr ns">class ItemsController &lt; ApplicationController<br/>  def index<br/>    items = Item.all<br/>    render json: items<br/>  end<br/>end</span></pre><ul class=""><li id="09ef" class="mz na it lb b lc ld lf lg li nt lm nu lq nv lu ng nh ni nj bi translated">最后，使用<code class="fe lw lx ly lz b"><strong class="lb iu">rails s</strong></code> <strong class="lb iu"> </strong>启动rails服务器，在浏览器上导航到<a class="ae ky" href="http://localhost:3000/items" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/items</a>，查看显示的JSON数据。</li></ul></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="144c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，伙计们，这就是要点！我希望这有助于缓解您在启动Rails API时最初的挫败感。有关Rails的更多具体信息，请访问官方的<a class="ae ky" href="https://guides.rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"> Rails文档</a>。</p></div></div>    
</body>
</html>