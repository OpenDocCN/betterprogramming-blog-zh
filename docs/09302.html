<html>
<head>
<title>How to Design Software — Report Generators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何设计软件—报告生成器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-design-software-report-generators-in-ruby-6691df98a518?source=collection_archive---------7-----------------------#2021-08-09">https://betterprogramming.pub/how-to-design-software-report-generators-in-ruby-6691df98a518?source=collection_archive---------7-----------------------#2021-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/85d2d51401254f0a7d567e579f5f46bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HbWKd8zVUfOTQ8b3jpxriA.png"/></div></div></figure><div class=""/><div class=""><h2 id="6ee6" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">了解如何使用模板设计模式创建可重用的导出生成系统。</h2></div><p id="539c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">报告。这通常是企业要求开发人员构建的第一个特性之一。一旦有人有了数据，他们想用它做什么？</p><p id="bae1" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">没错——查看。</p><h2 id="69d8" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">工程师对报告有疑问</h2><p id="e20e" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">许多工程师以用例特定的方式处理报告。</p><p id="d2eb" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">他们将得到一个要求，如<em class="mn">“创建一个. csv报告，显示从商店购买的所有商品”</em>，他们将去创建那个特定的功能。</p><p id="10a2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">下一次，他们可能会收到一个请求，要求<em class="mn">“创建一个. csv报告，报告所有属于该帐户的用户”</em>，他们也会去创建该功能。</p><p id="deb6" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">随着时间的推移，业务要求不同的格式、不同的领域等。这些请求加起来，经过几次迭代后，系统最终会有十几个报告实现，它们都有自己的错误和怪癖。</p><p id="1a3f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">更糟糕的是，如果需要任何重大的迭代，比如可定制性或一些新的性能改进，就必须一遍又一遍地进行更改(每次都可能稍有不同)，这导致了大量的实现和维护开销，而仅仅是为了生成一个逗号分隔的列表！但是，不一定要这样。有一些简单的技巧可以让你完全避免这种痛苦。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="6dab" class="mv lq je bd lr mw mx my lu mz na nb lx kk nc kl ma kn nd ko md kq ne kr mg nf bi translated">什么是报告？</h1><p id="53f4" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">首先，让我们了解一下——到底什么是报告？每个报告都有以下四个基本组成部分:</p><ul class=""><li id="0866" class="ng nh je kv b kw kx kz la lc ni lg nj lk nk lo nl nm nn no bi translated">数据记录</li><li id="260f" class="ng nh je kv b kw np kz nq lc nr lg ns lk nt lo nl nm nn no bi translated">数据值</li><li id="4a7d" class="ng nh je kv b kw np kz nq lc nr lg ns lk nt lo nl nm nn no bi translated">标签</li><li id="2b3d" class="ng nh je kv b kw np kz nq lc nr lg ns lk nt lo nl nm nn no bi translated">格式</li></ul><h2 id="1a76" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">数据记录</h2><p id="21f2" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">数据是您用来填充报告的实际数据。可能是你系统里的一堆事件。也许是交易数据。很可能是从你的数据库中提取的数据。</p><p id="8424" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">数据可能有一个特定的范围，根据一些参数(如日期范围)来限制数据。</p><h2 id="67d8" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">数据值</h2><p id="84e5" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">仅有整体数据是不够的。人们通常对特定的数据点感兴趣——数据的特定领域。财务人员可能只对结算的金额感兴趣，而安全监控人员可能对地址不匹配状态感兴趣。</p><h2 id="be1d" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">标签</h2><p id="ef2d" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">标签为数据提供了意义。这是它与众不同的地方:</p><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="ff4d" class="lp lq je nz b gy od oe l of og">5 | 3 | 230 | 40</span></pre><p id="783a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">…由此可见:</p><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="23e5" class="lp lq je nz b gy od oe l of og">id | event_id | amount_paid_cents | fee_paid_cents<br/>5  | 3        | 230               | 40</span></pre><p id="c436" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">标签将无意义的值转换成数据，并为其他任意值提供人类可理解的上下文。</p><h2 id="e4d9" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">格式</h2><p id="e07f" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">最后，还有报告的格式。格式可以是任意的，需要什么格式最终取决于消费者。如果消费者是一个API，格式可能是JSON。</p><p id="7a5f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如果消费者是FTP下线或打算将其导入另一个系统的人，则可能是CSV。如果消费者是一个对切片和切块感兴趣的数据人员，它可能最终成为一个Excel电子表格，甚至是一组数据库导入命令。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="0e18" class="mv lq je bd lr mw mx my lu mz na nb lx kk nc kl ma kn nd ko md kq ne kr mg nf bi translated">生成报告的步骤是什么？</h1><p id="d937" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">现在我们知道了这些部分，我们可以看看算法:生成<em class="mn">任何</em> <strong class="kv jf"> </strong>类型的报告需要的步骤顺序是什么？</p><p id="a839" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">原来，这并不是一个复杂的算法！它可以概括为以下内容:</p><ul class=""><li id="0237" class="ng nh je kv b kw kx kz la lc ni lg nj lk nk lo nl nm nn no bi translated">设置-获取报告的参数</li><li id="204f" class="ng nh je kv b kw np kz nq lc nr lg ns lk nt lo nl nm nn no bi translated">获取记录</li><li id="c574" class="ng nh je kv b kw np kz nq lc nr lg ns lk nt lo nl nm nn no bi translated">映射-从每个记录中获取一组特定的字段</li><li id="ce00" class="ng nh je kv b kw np kz nq lc nr lg ns lk nt lo nl nm nn no bi translated">将每组字段转换为报告中的条目</li><li id="6c45" class="ng nh je kv b kw np kz nq lc nr lg ns lk nt lo nl nm nn no bi translated">将报告发回给用户</li></ul><h2 id="b941" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">设置</h2><p id="98ff" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">第一步是设置——将参数发送到报告中以调整它的行为。这通常是用于<em class="mn">范围界定的数据</em> <strong class="kv jf"> <em class="mn"> — </em> </strong>一些记录集合需要过滤并缩减为一个子集(例如，按帐户、按日期等)。)</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="90a3" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">取得</h2><p id="6e10" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">一旦您有了报告的参数，您将想要开始检索那些记录。您可以根据需要应用过滤器:</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="93a5" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">地图</h2><p id="fb2f" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">您可能对记录中的一组特定属性和字段感兴趣。您可以将您的记录转换成那个特定的集合，并且可以选择用额外的数据来丰富每个条目。</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="8fde" class="lp lq je bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">皈依者</h2><p id="115a" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">一旦您有了自己的集合——在本例中是一组散列，您将希望把它转换成特定的格式，比如CSV。</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="7f2b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">想支持其他格式？没问题:</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="2096" class="mv lq je bd lr mw mx my lu mz na nb lx kk nc kl ma kn nd ko md kq ne kr mg nf bi translated">把所有的放在一起</h1><p id="c9ca" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">上面的每个步骤可能都有自己的细节，但您通常可以将其概括为如下内容:</p><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/25fe154a33451e365312238d86db52a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PXdctmLEs3bswKKF6-5IGQ.png"/></div></div></figure><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="647c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一个用例特定的实现可能看起来像:</p><figure class="nu nv nw nx gt iv"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="7b63" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">请注意，绑定到报告的现有功能是多么容易——您可以快速创建许多不同种类的报告，而不必担心如何生成或交付它们。</p><p id="423a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如果它看起来很熟悉——那是因为它可能就是！</p><p id="ed7e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这就是模板模式<strong class="kv jf"/>——一种设计模式，它有助于封装算法的序列和不变步骤的实现，同时留下可供子类“填充”的可变步骤。</p><h1 id="017b" class="mv lq je bd lr mw ok my lu mz ol nb lx kk om kl ma kn on ko md kq oo kr mg nf bi translated">附加迭代</h1><p id="cdc4" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">一个报告可能有许多其他的关注点和可能的迭代，例如:</p><ul class=""><li id="9811" class="ng nh je kv b kw kx kz la lc ni lg nj lk nk lo nl nm nn no bi translated">性能—记录批处理、记录大小管理</li><li id="8fe9" class="ng nh je kv b kw np kz nq lc nr lg ns lk nt lo nl nm nn no bi translated">自定义—指定标题，更改顺序</li><li id="6dcd" class="ng nh je kv b kw np kz nq lc nr lg ns lk nt lo nl nm nn no bi translated">交付— SFTP、下载、电子邮件</li></ul><p id="9ba2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这种功能可以适当地添加到基类或子类中，而不改变系统的整体结构。输入和输出的标准化允许连接到系统的其他部分。</p><p id="6b25" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">例如，如果您已经有了一个通过电子邮件传递文件的模块，那么您可以轻松地将报告生成器的输出插入到该子系统中，或者从类似于<code class="fe op oq or nz b">deliver_to_email(email)</code>的函数中调用它。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="62e7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">就是这样！创建可重用的软件，将机制从用例中分离出来，允许它在许多其他用例中使用，就像将它分解成小部分并仔细考虑输入和输出一样简单。</p><p id="3b18" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">你喜欢这篇文章吗？在评论里告诉我，或者在<a class="ae os" href="https://www.linkedin.com/in/jgefroh/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我！</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="2e67" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">你喜欢这篇文章吗？请在评论中告诉我，或者在<a class="ae os" href="https://www.linkedin.com/in/jgefroh/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我！</p><p id="3c2c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf"> <em class="mn">本文是我的</em> </strong> <a class="ae os" href="https://medium.com/@jgefroh/list/how-to-design-software-03066fa9dcbf" rel="noopener"> <strong class="kv jf"> <em class="mn">如何设计软件</em> </strong> </a> <strong class="kv jf"> <em class="mn">系列的一部分。</em> </strong></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="f165" class="mv lq je bd lr mw mx my lu mz na nb lx kk nc kl ma kn nd ko md kq ne kr mg nf bi translated"><a class="ae os" href="https://jgefroh.medium.com/membership" rel="noopener">成为灵媒会员</a>帮助支持我的写作以及成千上万的其他作者！</h1><figure class="nu nv nw nx gt iv gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/f874440e955db6ca1895cb9f465f7772.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*oKJjwKDXbeXXQAq5iXgwQg.png"/></div></figure></div></div>    
</body>
</html>