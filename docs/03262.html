<html>
<head>
<title>Learn About Property Wrappers in Swift 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解Swift 5中的属性包装器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/property-wrappers-in-swift-b8011c47545d?source=collection_archive---------7-----------------------#2020-01-30">https://betterprogramming.pub/property-wrappers-in-swift-b8011c47545d?source=collection_archive---------7-----------------------#2020-01-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8cdc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用属性包装清理你的代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/41bfae8813af593f80d0d4d172f01b46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ufrhtlo_cDPfK2j0kiWUcg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/@brett-sayles?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">布雷特·赛勒斯</a>从<a class="ae ky" href="https://www.pexels.com/photo/green-grass-field-2388571/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄</p></figure><p id="df4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">属性包装器是一种实现模式。在属性包装器的帮助下，您可以像创建库一样创建自己的逻辑。它将支持XCode 11 <strong class="lb iu"> </strong>和Swift 5 <strong class="lb iu"> </strong>或更高版本。</p><p id="d908" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是在Swift论坛SE-0258上提出的。你可以写<code class="fe lv lw lx ly b">@propertyWrapper</code>来定义。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="eecd" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">我们开始吧</h1><p id="6554" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">从头开始，我们将为<a class="ae ky" href="https://medium.com/better-programming/userdefaults-in-swift-4-d1a278a0ec79" rel="noopener">用户默认值</a>编写第一个<code class="fe lv lw lx ly b">@propertyWrapper</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/a1a7aa8d35c53db21fe7964f2c0a0d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RL4N2l8ay5gebl34zQ2-gQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">属性包装的错误</p></figure><p id="c2bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是确认<code class="fe lv lw lx ly b">wrappedValue</code>时对<code class="fe lv lw lx ly b">@propertyWrapper</code>的基本警告。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="d5f4" class="ni mh it ly b gy nj nk l nl nm">@<strong class="ly iu">propertyWrapper</strong><br/>struct <strong class="ly iu">UserDefaultsWrapper</strong>&lt;Value&gt; <strong class="ly iu">{</strong><br/>    let key: <strong class="ly iu">String</strong><br/>    let defaultValue: <strong class="ly iu">Value</strong><br/>    let userDefaults: <strong class="ly iu">UserDefaults</strong> = .standard<br/>    <br/>    var <strong class="ly iu">wrappedValue</strong>: Value{<br/>        <strong class="ly iu">get</strong> {<br/>            return userDefaults.object(forKey: key) as? <strong class="ly iu">Value</strong>??    <strong class="ly iu">defaultValue</strong><br/>        }<br/>        <strong class="ly iu">set</strong> {<br/>            userDefaults.set(<strong class="ly iu">newValue</strong>, forKey: key)<br/>        }<br/>    }<br/><strong class="ly iu">}</strong></span></pre><p id="051a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们为<code class="fe lv lw lx ly b">userDefaults</code>写了<code class="fe lv lw lx ly b">@propertyWrapper</code>。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="c29e" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">如何使用它</h1><p id="9d59" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为<code class="fe lv lw lx ly b">@propertyWrapper</code>定义你的结构。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="60ce" class="ni mh it ly b gy nj nk l nl nm">struct <strong class="ly iu">UserDefaultsConfig</strong>{<br/>    @<strong class="ly iu">UserDefaultsWrapper</strong>(key: "com.user.session", <br/>                defaultValue: false)<br/>    static var <strong class="ly iu">sessionStarted</strong>: Bool<br/>    <br/>    @<strong class="ly iu">UserDefaultsWrapper</strong>(key: "com.user.details", <br/>                defaultValue: [:])<br/>    static var <strong class="ly iu">userDetails</strong>: [String: String]<br/>}</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1cdd" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">保存和检索值</h1><h2 id="31e8" class="ni mh it bd mi nn no dn mm np nq dp mq li nr ns ms lm nt nu mu lq nv nw mw nx bi translated"><em class="ny">存储一个布尔值</em></h2><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="3981" class="ni mh it ly b gy nj nk l nl nm"><strong class="ly iu">UserDefaultsConfig</strong>.sessionStarted = true<br/>print(<strong class="ly iu">UserDefaultsConfig</strong>.sessionStarted)   //<strong class="ly iu">true</strong></span></pre><h2 id="cb7e" class="ni mh it bd mi nn no dn mm np nq dp mq li nr ns ms lm nt nu mu lq nv nw mw nx bi translated"><em class="ny">存储字典值</em></h2><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="0b3d" class="ni mh it ly b gy nj nk l nl nm"><strong class="ly iu">UserDefaultsConfig</strong>.userDetails = <strong class="ly iu">[</strong>“userName”: “Anand”, <br/>                                  “country”: “India”<strong class="ly iu">]</strong><br/>print(<strong class="ly iu">UserDefaultsConfig</strong>.userDetails) // <strong class="ly iu">["userName": "Anand", "country": "India"]</strong></span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="c5e8" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">重置值</h1><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="3e44" class="ni mh it ly b gy nj nk l nl nm"><strong class="ly iu">UserDefaultsConfig</strong>.sessionStarted = true<br/><strong class="ly iu">UserDefaultsConfig</strong>.userDetails = [:]</span></pre><ul class=""><li id="d625" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">如果有人试图将您的<code class="fe lv lw lx ly b">@propertyWrapper</code>对象的值设置为<code class="fe lv lw lx ly b">nil</code>，那么需要进行一些更改以避免代码崩溃。</li></ul></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="9a29" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">为可选值创建协议</h1><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="55ab" class="ni mh it ly b gy nj nk l nl nm">private protocol <strong class="ly iu">AnyOptional</strong>{<br/>     var isNil: <strong class="ly iu">Bool</strong> { get }<br/>}</span></pre><h2 id="34ed" class="ni mh it bd mi nn no dn mm np nq dp mq li nr ns ms lm nt nu mu lq nv nw mw nx bi translated"><strong class="ak">检查扩展可选是否有值</strong></h2><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="a47f" class="ni mh it ly b gy nj nk l nl nm">private extension <strong class="ly iu">Optional</strong>: <strong class="ly iu">AnyOptional</strong>{<br/>      var isNil: Bool { self == nil }<br/>}</span></pre><p id="a2df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将协议和扩展设为私有，因为在其他类中不需要它们。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="7c54" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated"><strong class="ak">最终属性包装代码</strong></h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户默认值的属性包装</p></figure><p id="51ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是<code class="fe lv lw lx ly b">@propertyWrapper</code>的基本用途，但是你也可以为其他用途编写它——没有限制。有了它，我们可以让我们的<code class="fe lv lw lx ly b">UserDefault</code>代码更加高级。这只是开始。</p><h2 id="2cf4" class="ni mh it bd mi nn no dn mm np nq dp mq li nr ns ms lm nt nu mu lq nv nw mw nx bi translated">另一个例子</h2><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="5691" class="ni mh it ly b gy nj nk l nl nm">@<strong class="ly iu">propertyWrapper</strong><br/>struct <strong class="ly iu">CapitalFirstLetter</strong> {<br/>    private(set) var value: <strong class="ly iu">String</strong> = ""</span><span id="61a4" class="ni mh it ly b gy ok nk l nl nm">var <strong class="ly iu">wrappedValue</strong>: String {<br/>        get <strong class="ly iu">{</strong> value <strong class="ly iu">}</strong><br/>        set <strong class="ly iu">{</strong><br/>            let first = <strong class="ly iu">String</strong>(newValue.prefix(1)).<strong class="ly iu">capitalized</strong><br/>            let other = <strong class="ly iu">String</strong>(newValue.dropFirst())<br/>            value = first + other<br/>        <strong class="ly iu">}</strong><br/>    }<br/>}</span><span id="4ec3" class="ni mh it ly b gy ok nk l nl nm">// <em class="ol">Model - </em><br/>struct <strong class="ly iu">UserDetails{</strong><br/>    @<strong class="ly iu">CapitalFirstLetter</strong> var userName: <strong class="ly iu">String</strong><br/>    @<strong class="ly iu">CapitalFirstLetter</strong> var lastName: <strong class="ly iu">String</strong><br/>    <br/>    <strong class="ly iu">init</strong>(userName: <strong class="ly iu">String</strong>, lastName: <strong class="ly iu">String</strong>) {<br/>        self.<strong class="ly iu">userName</strong> = userName<br/>        self.<strong class="ly iu">lastName</strong> = lastName<br/>    }<br/><strong class="ly iu">}</strong></span><span id="e9a2" class="ni mh it ly b gy ok nk l nl nm"><em class="ol">//Uses - </em><br/>let userDetails =  <strong class="ly iu">UserDetails</strong>(userName: "anand", lastName: "nimje")<br/><strong class="ly iu">print</strong>(userDetails.userName) //Anand <br/><strong class="ly iu">print</strong>(userDetails.lastName) // Nimje</span></pre><p id="40ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你已经在SwiftUI里面看到了<code class="fe lv lw lx ly b">@State</code>、<code class="fe lv lw lx ly b">@Binding</code>和<code class="fe lv lw lx ly b">@FetchRequest</code>。这些是<code class="fe lv lw lx ly b">@propertyWrapper</code>。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="017b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="fdc1" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在这一部分，我已经介绍了<code class="fe lv lw lx ly b">@propertyWrapper’</code>的基本用途。减少我们的代码并增加其可重用性是非常有用的。这将减少你的代码中的大量样板文件，以及当前代码所需的最小改动。</p><p id="b6e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多方法可以使用<code class="fe lv lw lx ly b">@propertyWrapper</code>。它很容易使用，但需要Swift 5和Xcode 11或更高版本。</p><p id="a9a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢它。感谢阅读！</p></div></div>    
</body>
</html>