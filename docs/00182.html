<html>
<head>
<title>Convert a Base64 url to image file in Angular 4+</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Base64 url转换为Angular 4+格式的图像文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/convert-a-base64-url-to-image-file-in-angular-4-5796a19fdc21?source=collection_archive---------1-----------------------#2018-08-27">https://betterprogramming.pub/convert-a-base64-url-to-image-file-in-angular-4-5796a19fdc21?source=collection_archive---------1-----------------------#2018-08-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/3164afcb0f2b6608d81edf3363774349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*86NRPjJ3jjqT5TWk1-mHrQ.png"/></div></figure><p id="b7f4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">嘿大家好！</p><p id="63c5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我想分享我最近在一个项目中遇到的一个问题，在这个项目中，我需要通过相机捕捉来上传一张个人资料照片。我用的是<a class="ae kv" href="https://basst314.github.io/ngx-webcam/" rel="noopener ugc nofollow" target="_blank">ngx-网络摄像头</a>套装，它允许从网络摄像头/设备摄像头捕捉图像。</p><p id="9933" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我集成了这个包，并且能够捕获图像——它在页面上显示正确。但问题是它给出的数据是base64 URL，可以通过用<em class="kw">数据:URL替换<em class="kw"> src </em>来显示图像。</em></p><p id="a99b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在尝试了超过10-15个关于堆栈溢出的链接后，我找到了解决方案，并能够转换图像。起初，我认为它已经工作，但转换后的文件没有显示。于是我又找了一遍，终于得到了代码，加上一些自定义的修改。</p><h1 id="92e8" class="kx ky it bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">更新</strong></h1><p id="c041" class="pw-post-body-paragraph jx jy it jz b ka lv kc kd ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku im bi translated">以前有类似异步调用序列的问题，所以一些用户得到了<em class="kw"> atob </em>函数错误。所以我重新排序了方法，现在一切都正常了。我为方法添加了返回类型，也为变量添加了数据类型。所以你可以更详细地了解在哪里发生了什么。</p><h1 id="8e8a" class="kx ky it bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">让我们看看代码:</h1><p id="bfda" class="pw-post-body-paragraph jx jy it jz b ka lv kc kd ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku im bi translated">首先从外部URL获取图像，并以字符串形式获取图像的base64Data URL。</p><ol class=""><li id="525c" class="ma mb it jz b ka kb ke kf ki mc km md kq me ku mf mg mh mi bi translated">getImage <br/>调用提交图像URL的用户。会依次调用其他方法。</li><li id="1f19" class="ma mb it jz b ka mj ke mk ki ml km mm kq mn ku mf mg mh mi bi translated">调用getBase64ImageFromUrl <br/>从提供的Url获取图像。该URL可以是外部URL或base64 URL。</li><li id="7094" class="ma mb it jz b ka mj ke mk ki ml km mm kq mn ku mf mg mh mi bi translated">它将从图像中创建base64Url。</li></ol><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="7edd" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">然后创建本地使用或显示方法的图像</p><ol class=""><li id="9687" class="ma mb it jz b ka kb ke kf ki mc km md kq me ku mf mg mh mi bi translated">createBlobImageFileAndShow <br/>它将从base64 URL创建图像blob，这将用于本地处理图像或显示图像。</li><li id="097e" class="ma mb it jz b ka mj ke mk ki ml km mm kq mn ku mf mg mh mi bi translated">dataUriToBlob <br/>获取数据URI并返回包装在Observable中的Blob文件的方法。</li><li id="576f" class="ma mb it jz b ka mj ke mk ki ml km mm kq mn ku mf mg mh mi bi translated">generateName <br/>为图像斑点生成随机名称的辅助方法。</li></ol><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="32ee" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">演示:</strong>我已经添加了更新代码的完整代码片段，您可以在复制之前测试代码。我还更新了所有类型的数据和返回类型。</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="mu mt l"/></div><p class="mv mw gj gh gi mx my bd b be z dk translated">从Url获取图像演示</p></figure><p id="f9c5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu"> <em class="kw">注意:</em> </strong> <em class="kw">如果您在控制台中看到此错误，请确保您的窗口对象atob方法被正确调用，并且base64Trimmed数据URL作为参数被正确发送:</em></p><pre class="mo mp mq mr gt mz na nb nc aw nd bi"><span id="1194" class="ne ky it na b gy nf ng l nh ni">Error: Failed to execute ‘atob’ on ‘Window’: The string to be decoded is not correctly encoded.</span></pre><p id="fb45" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">更新- </strong>执行blob失败现已修复，不会再来。不过，你可以评论任何问题。</p><p id="1fb1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">通过使用这些功能，您可以捕捉图像，并将其保存到一个文件夹中，或者轻松上传到在线服务器上。</p><p id="20e5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">此外，请访问Tekraze.com网站获取更多类似的技术帖子。</p><p id="5764" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">谢了。</p></div></div>    
</body>
</html>