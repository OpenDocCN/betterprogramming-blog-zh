<html>
<head>
<title>Diagnose Memory Leaks Using Xcode Instruments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Xcode工具诊断内存泄漏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/diagnose-memory-leaks-using-xcode-instruments-5692a6458020?source=collection_archive---------0-----------------------#2020-02-13">https://betterprogramming.pub/diagnose-memory-leaks-using-xcode-instruments-5692a6458020?source=collection_archive---------0-----------------------#2020-02-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1bc6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">面临记忆问题时，leaks仪器可能会成为你最好的朋友</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/97404ff4a76712a1ab30b4c76dad10ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kTLLzrBKe997a5e2Vyd6DA.gif"/></div></div></figure><p id="d885" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个简短的教程中，我们将学习如何使用Xcode的调试内存图和泄漏工具来产生并准确识别内存泄漏。</p><p id="ef0f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">示例应用程序显示了两个屏幕。在第一个屏幕上，点击一个按钮，让我们导航到第二个屏幕，在那里我们使用一个保留周期故意创建一个内存泄漏。</p><p id="d68b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是我们的工作流程:</p><ul class=""><li id="dbe0" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">我们首先打开Xcode leaks仪器，按下record按钮</li><li id="b071" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">当应用程序自动启动时，我们按下导航按钮，显示我们泄漏的视图控制器</li><li id="6ad8" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">我们只需使用导航项目的后退按钮弹出它</li><li id="2f64" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">最后，我们在泄漏仪器和内存图中观察效果。</li></ul><p id="162a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">GitHub上有<a class="ae me" href="https://github.com/zivaev462/memory-leak" rel="noopener ugc nofollow" target="_blank">源代码</a>。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="b9c7" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">我们开始吧</h1><p id="8c32" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">假设我们有一个简单的<code class="fe nj nk nl nm b">UIViewController</code>子类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="b122" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它所做的只是呈现我们的目标泄漏视图控制器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="e729" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了创建一个保留循环，我们有一个将<code class="fe nj nk nl nm b">UIViewController</code>作为参数的<code class="fe nj nk nl nm b">ViewComponent</code>类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="112f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我们有以下关系:</p><p id="7c66" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b">LeakingViewController</code> ➼ <code class="fe nj nk nl nm b">ViewComponent</code></p><p id="0cb4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b">ViewComponent</code> ➼ <code class="fe nj nk nl nm b">LeakingViewController</code></p><p id="d18d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于一个要从内存中释放的对象，不应该有其他对象指向或持有它，当然，在我们的例子中不是这样。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="374f" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">诊断内存泄漏</h1><p id="2e61" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">现在，是时候打开测漏仪了:</p><ul class=""><li id="0563" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">选取屏幕左上角的“Xcode”</li><li id="05cc" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">展开“打开开发者工具”，并选择“工具”</li><li id="7155" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">现在选择“Leaks”，并确保您已经在顶部选择了您的目标应用程序和设备(“为…选择一个分析模板”):</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/2cbf261f9321e354049c269550bb7689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R1atX5MJkAMbE0PkcC55aA.png"/></div></div></figure><ul class=""><li id="a86f" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">最后，按下录制按钮</li></ul><p id="9b64" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们的应用程序启动了，我们需要做的就是点击导航按钮，然后点击<code class="fe nj nk nl nm b">LeakingViewController</code>的后退按钮。</p><p id="622b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们有以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/f846fca3c6972295c7533c635ae6da8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gX2EFKYDDEW5CnBmxwecJw.png"/></div></div></figure><p id="e82c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">红色图标意味着我们在某个地方泄漏了内存。要查看实际的未分配对象，我们将使用Xcode的内存图工具:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/5e21dc13d0f17c172fbf8960e8a611bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8i0O9iF9OmZobXZcpsQ3w.png"/></div></div></figure><p id="0c2b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以看到，即使我们提出并放弃了<code class="fe nj nk nl nm b">LeakingViewController</code>，它仍然和<code class="fe nj nk nl nm b">ViewComponent</code>一起出现在内存图中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/485bed1ad5a9efa3ee7c9a9f028d7b30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*1Aw-Ep31bNdvgax5dMVPcw.png"/></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="7fed" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">包扎</h1><p id="7d23" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">Xcode的leaks函数是一个非常方便的工具。我们只需按下记录按钮，在一个大型应用程序中导航和执行操作，仪器就会在报告中记录新的泄漏。我们还有一种保存录音并在将来查看的方法:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/f28f3a51d59ec36dc60792c7acabcc54.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*CpUC5OawU0PV_MxRdmZ2Sg.png"/></div></div></figure><p id="056a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">非常感谢您的阅读！</p></div></div>    
</body>
</html>