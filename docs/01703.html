<html>
<head>
<title>Build and Push to Docker With Maven</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Maven构建并推送至Docker</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-push-to-docker-with-maven-eea7c4b8cfa2?source=collection_archive---------2-----------------------#2019-10-07">https://betterprogramming.pub/build-push-to-docker-with-maven-eea7c4b8cfa2?source=collection_archive---------2-----------------------#2019-10-07</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="1bb4" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用Spotify、fabric8和JIB Maven插件自动将项目推送到Docker</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/3292104306942d6aec0482ffdc850cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Clf1hqhKKZ28yI-5bcF_DA.png"/></div></div></figure><p id="4898" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Maven现在已经完全自动化了您的构建。你所有的插件和依赖都已经就位。你的罐子在<code class="fe lr ls lt lu b">target</code>等着你。</p><p id="e7a8" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">但是，如何将它转换成Docker映像并推送到您喜欢的Docker注册表中呢？接下来我们一起来做。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="ce43" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">让我们有pom</h1><p id="2550" class="pw-post-body-paragraph kv kw iu kx b ky mu jv la lb mv jy ld le mw lg lh li mx lk ll lm my lo lp lq in bi translated">我们将使用<a class="ae mz" href="https://maven.apache.org/archetypes/maven-archetype-quickstart/" rel="noopener ugc nofollow" target="_blank"> Maven Quickstart原型</a> : <br/> <code class="fe lr ls lt lu b">mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=1.4 -DgroupId=com.test -DartifactId=maven-docker -Dversion=1.0.0-SNAPSHOT</code>创建并构建一个简单的Hello World命令行应用程序</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj na"><img src="../Images/d3a8c234c785d75a2da28066a4a2cd7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-TJ-8t0pBiATgRl1TzIU0Q.png"/></div></div><p class="nb nc gk gi gj nd ne bd b be z dk translated">快速Hello World原型</p></figure><p id="e3a5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在我们检查自动生成的项目是否编译和运行之前，我们需要修改<code class="fe lr ls lt lu b">pom.xml</code>来构建一个可执行的JAR，方法是修改<code class="fe lr ls lt lu b">plugins</code>部分，添加下面的<code class="fe lr ls lt lu b">plugin</code>:</p><pre class="kk kl km kn gu nf lu ng nh aw ni bi"><span id="2c9a" class="nj md iu lu b gz nk nl l nm nn">&lt;plugin&gt;<br/>  &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;<br/>  &lt;configuration&gt;<br/>    &lt;archive&gt;<br/>      &lt;manifest&gt;<br/>        &lt;mainClass&gt;com.test.App&lt;/mainClass&gt;<br/>      &lt;/manifest&gt;<br/>    &lt;/archive&gt;<br/>    &lt;descriptorRefs&gt;<br/>      &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;<br/>    &lt;/descriptorRefs&gt;<br/>  &lt;/configuration&gt;<br/>  &lt;executions&gt;<br/>    &lt;execution&gt;<br/>      &lt;id&gt;make-assembly&lt;/id&gt;<br/>      &lt;phase&gt;package&lt;/phase&gt;<br/>      &lt;goals&gt;<br/>        &lt;goal&gt;single&lt;/goal&gt;<br/>      &lt;/goals&gt;<br/>    &lt;/execution&gt;<br/>  &lt;/executions&gt;<br/>&lt;/plugin&gt;</span></pre><p id="f07f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">构建和运行时间:</p><p id="46da" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe lr ls lt lu b">mvn clean install<br/>java -jar target/maven-docker-1.0.0-SNAPSHOT-jar-with-dependencies.jar</code></p><p id="dba3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">你看过《你好世界》吗？很好，是时候让多克参与进来了。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="7505" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">准备好订购另一个插件了吗，先生？</h1><p id="2aad" class="pw-post-body-paragraph kv kw iu kx b ky mu jv la lb mv jy ld le mw lg lh li mx lk ll lm my lo lp lq in bi translated">说到Maven-Docker集成，不缺Maven插件:<a class="ae mz" href="https://github.com/spotify/docker-maven-plugin" rel="noopener ugc nofollow" target="_blank">Spotify/Docker-Maven-plugin</a>(现已不活动)<a class="ae mz" href="https://github.com/spotify/dockerfile-maven" rel="noopener ugc nofollow" target="_blank">Spotify/Docker file-Maven</a>，<a class="ae mz" href="https://github.com/GoogleContainerTools/jib" rel="noopener ugc nofollow" target="_blank"> JIB </a>，<a class="ae mz" href="https://openliberty.io/blog/2018/09/12/build-and-push-spring-boot-docker-images.html" rel="noopener ugc nofollow" target="_blank"> boost-maven-plugin </a>(专注于Spring Boot)，<a class="ae mz" href="https://dmp.fabric8.io/" rel="noopener ugc nofollow" target="_blank">fabric 8 io/Docker-Maven-plugin，</a>可能还有一些我不知道的。</p><p id="447f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">那么选择哪个插件呢？一个比其他的好吗？哪一个构建得更快，哪一个没有？哪一个更灵活，提供大量选项来完全定制您的构建？</p><p id="1a3e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">好吧，这些都是有效的问题，但是在我们挑选一些插件进行实验之前，让我们花几分钟来讨论几个重要的概念。</p><h2 id="16fd" class="nj md iu bd me no np dn mi nq nr dp mm le ns nt mo li nu nv mq lm nw nx ms ny bi translated">归档还是不归档</h2><p id="45d5" class="pw-post-body-paragraph kv kw iu kx b ky mu jv la lb mv jy ld le mw lg lh li mx lk ll lm my lo lp lq in bi translated">传统上，您通过创作一个<a class="ae mz" href="https://docs.docker.com/engine/reference/builder/" rel="noopener ugc nofollow" target="_blank">Docker文件</a>来使用Docker映像，在<code class="fe lr ls lt lu b">docker build</code>和<code class="fe lr ls lt lu b">docker push</code>的帮助下，您构建您的映像并将其推送到远程注册表。</p><p id="b885" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">许多可用的Maven-Docker插件允许您跳过这一部分:当您的<code class="fe lr ls lt lu b">pom</code>中有XML的全部功能和一个智能插件来解析您的配置时，为什么还要有Docker文件呢？选择这样做，您可以将所有的构建逻辑放在一个文件中。如果你没有太多的Docker知识，你可能会发现在必要的时候应用修改更容易。</p><p id="1dd0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">当然，大多数Maven-Docker插件也允许使用外部定义的Docker文件。这里没有什么特别的——您只需像处理Maven时一样处理Docker文件，插件会负责将Docker映像构建作为Maven构建的一部分来调用。</p><p id="e080" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">那么该走哪条路呢？我想说这确实是项目和经验特有的，这里没有正确或错误的答案。就我个人而言，我更喜欢有一个外部Docker文件——因为当我需要参考时有大量的文档可用，并且我可以快速测试我的Docker构建中的更改，而不必每次都调用Maven。</p><h2 id="534d" class="nj md iu bd me no np dn mi nq nr dp mm le ns nt mo li nu nv mq lm nw nx ms ny bi translated">客户端、守护程序和API</h2><p id="19bd" class="pw-post-body-paragraph kv kw iu kx b ky mu jv la lb mv jy ld le mw lg lh li mx lk ll lm my lo lp lq in bi translated">Docker是一只具有巨大深度和复杂性的野兽；但是，它的高级架构可以在下图中简要概括:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nz"><img src="../Images/993b712d970d1140d25112f49cf7beee.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/0*tsSwWFTOkfz2eC86.png"/></div><p class="nb nc gk gi gj nd ne bd b be z dk translated">Docker发动机的主要部件来自Docker公司的。</p></figure><p id="f55f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">其核心是Docker守护进程，周围是一个基于REST的API，提供了与外界交互的端点。使用API的官方客户端作为命令行应用程序提供给您使用(即您使用的<code class="fe lr ls lt lu b">docker</code>命令)。</p><p id="7a67" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">直到最近，所有已知的Maven-Docker插件都在与Docker守护进程的REST API进行交互，以利用其功能来构建和推送图像。2018年夏天，谷歌云平台<a class="ae mz" href="https://cloud.google.com/blog/products/gcp/introducing-jib-build-java-docker-images-better" rel="noopener ugc nofollow" target="_blank">的工程师们推出了</a> JIB。JIB从根本上不同于所有其他Docker-Maven插件，因为它不仅不使用Docker守护进程的REST API，而且它实际上甚至不关心您是否有Docker可用/安装。</p><p id="c692" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">根据JIB的Google<a class="ae mz" href="https://cloud.google.com/blog/products/gcp/introducing-jib-build-java-docker-images-better" rel="noopener ugc nofollow" target="_blank">博客公告</a>:</p><blockquote class="oa ob oc"><p id="08e9" class="kv kw od kx b ky kz jv la lb lc jy ld oe lf lg lh of lj lk ll og ln lo lp lq in bi translated">Jib是一个快速简单的容器映像构建器，可以处理将应用程序打包成容器映像的所有步骤。它不需要您编写docker文件或安装docker，它直接集成到Maven和Gradle中——只需将插件添加到您的构建中，您就可以立即将您的Java应用程序容器化。</p></blockquote><p id="7212" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">JIB会查看你的pom文件，找出你想要构建的内容，进行一些默认的合理猜测，并通过直接构建<a class="ae mz" href="https://docs.docker.com/v17.09/engine/userguide/storagedriver/imagesandcontainers/" rel="noopener ugc nofollow" target="_blank">图像的层</a>来生成一个Docker图像。</p><p id="7e4f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这实际上意味着，在CI/CD环境中，由于权限的原因，对Docker守护进程的访问可能会有问题(或者在Docker-in-Docker场景中很有挑战性)，JIB可以为您构建一个映像，为您省去这个麻烦。在这一点上，你可能想知道，“所以JIB是我所需要的，为什么我要从现在开始为任何其他Docker-Maven插件而烦恼呢？”</p><p id="3958" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">JIB是强大、灵活和智能的，但是有一个重要的警告:您不能执行RUN命令。你知道，那些<code class="fe lr ls lt lu b">apt-get install</code>、<code class="fe lr ls lt lu b">wget foo.tar</code>、<code class="fe lr ls lt lu b">tar xfz bar.tar.gz</code>等等。我们通常在Dockerfile文件开头看到的命令？</p><p id="0db2" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">原因很简单，与JIB的架构有关。因为JIB不使用Docker守护进程，所以没有创建临时容器来执行这样的RUN命令。所以这是一个可能<a class="ae mz" href="https://github.com/GoogleContainerTools/jib/blob/master/docs/faq.md#i-need-to-run-commands-like-apt-get" rel="noopener ugc nofollow" target="_blank">永远不会在JIB中得到支持的功能</a>，除非从根本上改变它的架构。</p><p id="a1b4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">当然，你可以有一个已经包含了你需要的所有定制的基础映像，然后使用JIB在它的基础上构建你的应用程序；然而，这将额外的活动部分引入到您可能不想要的构建管道中。在关闭JIB之前，值得一提的是，如果你愿意，JIB也可以使用Docker守护进程。</p><p id="3fb5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">既然理论已经过时了，是时候深入研究一些代码了。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="7cd7" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">构建和推动</h1><p id="3f63" class="pw-post-body-paragraph kv kw iu kx b ky mu jv la lb mv jy ld le mw lg lh li mx lk ll lm my lo lp lq in bi translated">我们的测试程序非常简单，所以我们可以尝试上面提到的所有主要的Docker-Maven插件。接下来就让我们一个一个来看。这篇文章的完整代码可以在<a class="ae mz" href="https://github.com/NMichas/maven-docker" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><h2 id="9a68" class="nj md iu bd me no np dn mi nq nr dp mm le ns nt mo li nu nv mq lm nw nx ms ny bi translated">私有注册支持</h2><p id="7650" class="pw-post-body-paragraph kv kw iu kx b ky mu jv la lb mv jy ld le mw lg lh li mx lk ll lm my lo lp lq in bi translated">如果您计划将您的映像推送到需要认证的注册中心，请确保您相应地准备好了您的环境。有几种方法可以做到这一点，下面的每个插件可能支持以下一种或多种方法:</p><h2 id="8706" class="nj md iu bd me no np dn mi nq nr dp mm le ns nt mo li nu nv mq lm nw nx ms ny bi translated"><code class="fe lr ls lt lu b">~/.docker/config.json</code></h2><pre class="kk kl km kn gu nf lu ng nh aw ni bi"><span id="5e04" class="nj md iu lu b gz nk nl l nm nn">"auths": {<br/>    "<a class="ae mz" href="https://index.docker.io/v1/" rel="noopener ugc nofollow" target="_blank">https://index.docker.io/v1/</a>": {<br/>      "auth": "FOO",<br/>      "email": "<a class="ae mz" href="mailto:nassosmichas@me.com" rel="noopener ugc nofollow" target="_blank">m</a>e@me.com"<br/>    }<br/>  }</span></pre><p id="4d5f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">请注意，<code class="fe lr ls lt lu b">auth</code>参数是username:password的Base64编码版本(即<code class="fe lr ls lt lu b">echo -n 'username:password' | base64</code>)。</p><h2 id="13be" class="nj md iu bd me no np dn mi nq nr dp mm le ns nt mo li nu nv mq lm nw nx ms ny bi translated"><strong class="ak">$ MAVEN _ HOME/settings . XML</strong></h2><pre class="kk kl km kn gu nf lu ng nh aw ni bi"><span id="12dd" class="nj md iu lu b gz nk nl l nm nn">&lt;server&gt;<br/>  &lt;id&gt;docker.io&lt;/id&gt;<br/>  &lt;username&gt;FOO&lt;/username&gt;<br/>  &lt;password&gt;BAR&lt;/password&gt;<br/>&lt;/server&gt;</span></pre><h2 id="8fc3" class="nj md iu bd me no np dn mi nq nr dp mm le ns nt mo li nu nv mq lm nw nx ms ny bi translated">Spotify插件</h2><pre class="kk kl km kn gu nf lu ng nh aw ni bi"><span id="fb76" class="nj md iu lu b gz nk nl l nm nn">&lt;plugin&gt;<br/>  &lt;groupId&gt;com.spotify&lt;/groupId&gt;<br/>  &lt;artifactId&gt;dockerfile-maven-plugin&lt;/artifactId&gt;<br/>  &lt;version&gt;${dockerfile-maven-version}&lt;/version&gt;<br/>  &lt;executions&gt;<br/>    &lt;execution&gt;<br/>      &lt;id&gt;default&lt;/id&gt;<br/>      &lt;goals&gt;<br/>        &lt;goal&gt;build&lt;/goal&gt;<br/>        &lt;goal&gt;push&lt;/goal&gt;<br/>      &lt;/goals&gt;<br/>    &lt;/execution&gt;<br/>  &lt;/executions&gt;<br/>  &lt;configuration&gt;<br/>    &lt;repository&gt;myrepo/maven-docker-spotify&lt;/repository&gt;<br/>    &lt;tag&gt;${project.version}&lt;/tag&gt;<br/>    &lt;buildArgs&gt;<br/>      &lt;JAR_FILE&gt;${project.build.finalName}-jar-with-dependencies.jar&lt;/JAR_FILE&gt;<br/>    &lt;/buildArgs&gt;<br/>  &lt;/configuration&gt;<br/>&lt;/plugin&gt;</span></pre><p id="0729" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">构建:<code class="fe lr ls lt lu b">mvn dockerfile:build<br/></code>运行:<code class="fe lr ls lt lu b">docker run --rm myrepo/maven-docker-spotify:1.0.0-SNAPSHOT<br/></code>推送:<code class="fe lr ls lt lu b">mvn dockerfile:push<br/></code>带认证推送(带<code class="fe lr ls lt lu b">~/.docker/config.json</code> ): <br/> <code class="fe lr ls lt lu b">mvn dockerfile:push<br/></code>带认证推送(带<code class="fe lr ls lt lu b">$MAVEN_HOME/settings.xml</code> ): <br/> <code class="fe lr ls lt lu b">mvn dockerfile:push -Ddockerfile.useMavenSettingsForAuth=true</code></p><h2 id="35ea" class="nj md iu bd me no np dn mi nq nr dp mm le ns nt mo li nu nv mq lm nw nx ms ny bi translated">Fabric8插件</h2><pre class="kk kl km kn gu nf lu ng nh aw ni bi"><span id="338e" class="nj md iu lu b gz nk nl l nm nn">&lt;plugin&gt;<br/>  &lt;groupId&gt;io.fabric8&lt;/groupId&gt;<br/>  &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;<br/>  &lt;version&gt;${docker-maven-plugin}&lt;/version&gt;<br/>  &lt;configuration&gt;<br/>    &lt;filter&gt;${*}&lt;/filter&gt;<br/>    &lt;images&gt;<br/>      &lt;image&gt;<br/>        &lt;name&gt;myrepo/maven-docker-fabric8:${project.version}&lt;/name&gt;<br/>      &lt;/image&gt;<br/>    &lt;/images&gt;<br/>  &lt;/configuration&gt;<br/>&lt;/plugin&gt;</span></pre><p id="c617" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">构建:<code class="fe lr ls lt lu b">mvn docker:build<br/></code>运行:<code class="fe lr ls lt lu b">docker run --rm myrepo/maven-docker-fabric8:1.0.0-SNAPSHOT<br/></code>推送:<code class="fe lr ls lt lu b">mvn docker:push<br/></code>带认证的推送(带<code class="fe lr ls lt lu b">$MAVEN_HOME/settings.xml</code> ): <br/> <code class="fe lr ls lt lu b">mvn docker:push</code></p><h2 id="1ade" class="nj md iu bd me no np dn mi nq nr dp mm le ns nt mo li nu nv mq lm nw nx ms ny bi translated">JIB插件</h2><pre class="kk kl km kn gu nf lu ng nh aw ni bi"><span id="df4b" class="nj md iu lu b gz nk nl l nm nn">&lt;plugin&gt;<br/>  &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;<br/>  &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;<br/>  &lt;version&gt;1.6.1&lt;/version&gt;<br/>  &lt;configuration&gt;<br/>    &lt;to&gt;<br/>      &lt;image&gt;myrepo/maven-docker-jib:${project.version}&lt;/image&gt;<br/>    &lt;/to&gt;<br/>  &lt;/configuration&gt;<br/>&lt;/plugin&gt;</span></pre><p id="4940" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">带认证的构建和推送(带<code class="fe lr ls lt lu b">~/.docker/config.json</code> ): <br/> <code class="fe lr ls lt lu b">mvn docker:build<br/></code>运行:<code class="fe lr ls lt lu b">docker run --rm myrepo/maven-docker-jib:1.0.0-SNAPSHOT</code></p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="f4c1" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">结论</h1><p id="e74a" class="pw-post-body-paragraph kv kw iu kx b ky mu jv la lb mv jy ld le mw lg lh li mx lk ll lm my lo lp lq in bi translated">对于使用Maven构建和推送Docker映像，没有通用的解决方案。</p><p id="0392" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这实际上取决于你想完成什么，你的项目有多复杂，你的映像构建有多复杂，在构建过程中你是否可以访问Docker守护进程，以及其他一些因素。</p><p id="f9f1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">来自<a class="ae mz" href="https://github.com/spotify/dockerfile-maven" rel="noopener ugc nofollow" target="_blank"> Spotify </a>、<a class="ae mz" href="https://dmp.fabric8.io/" rel="noopener ugc nofollow" target="_blank"> Fabric8 </a>、以及<a class="ae mz" href="https://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin" rel="noopener ugc nofollow" target="_blank"> Google云平台</a>的三款主流插件都是非常优秀的选择，性能良好，维护积极，在很多项目中都有使用。</p><p id="245c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">离开之前的最后一件事:尽管Docker-Maven集成使得推送图像变得不那么痛苦，但是尽量避免直接从您的开发工作站/环境推送。</p><p id="f8b6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在您的CI/CD环境中设置一个作业，并确保只有通过触发该作业才能推送新映像。这将为您省去一些麻烦，并为您提供对Docker映像创建和分发的集中控制和监控。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><p id="b76c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><em class="od">如果你使用Docker，你可能还想看看这个由三部分组成的Docker自动化系列:<br/> </em> <a class="ae mz" href="https://medium.com/better-programming/build-your-docker-images-automatically-when-you-push-on-github-18e80ece76af" rel="noopener"> <em class="od">当你推GitHub </em> </a> <em class="od">，<br/> </em> <a class="ae mz" href="https://medium.com/better-programming/how-to-test-your-automated-builds-on-docker-hub-e40879f35d1e" rel="noopener"> <em class="od">如何在Docker Hub </em> </a> <em class="od">上测试你的自动化构建，以及<br/> </em> <a class="ae mz" href="https://medium.com/better-programming/how-to-recover-from-a-failed-automated-docker-hub-build-8b6c1cc3d7d4" rel="noopener"> <em class="od">如何从失败的自动化Docker Hub构建</em> </a> <em class="od">中恢复。</em></p></div></div>    
</body>
</html>