<html>
<head>
<title>Meet &amp; Greet — Advanced Lists in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">会面和问候SwiftUI中的高级列表</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/meet-greet-advanced-lists-in-swiftui-80ab6f08ca03?source=collection_archive---------4-----------------------#2019-07-14">https://betterprogramming.pub/meet-greet-advanced-lists-in-swiftui-80ab6f08ca03?source=collection_archive---------4-----------------------#2019-07-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="030b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">实现一个包含空、错误和加载状态的动态列表</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f612d93c6495128a1bb7d63dbe667c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BU2Urv-cMAIM3rFbUouydw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">列表图片(版权所有2019 <strong class="bd ky">克里斯蒂安·埃利斯</strong></p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="9824" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li iu">更新2019/08/14: </strong>现作为<a class="ae mc" href="https://github.com/crelies/AdvancedList" rel="noopener ugc nofollow" target="_blank"> Swift包</a>提供🚀</p><h1 id="e43e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">动机</h1><p id="8add" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">我说的<em class="na">进阶榜</em>是什么意思？</p><p id="fa69" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我目前在做的app有很多动态列表，可以代表不同的状态，比如<code class="fe nb nc nd ne b">empty</code>、<code class="fe nb nc nd ne b">error</code>、<code class="fe nb nc nd ne b">items</code>或者<code class="fe nb nc nd ne b">loading</code>。</p><p id="1193" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我在数据驱动框架<a class="ae mc" href="https://github.com/Instagram/IGListKit" rel="noopener ugc nofollow" target="_blank"> IGListKit </a>之上实现了一个解决方案，能够在我们的<a class="ae mc" href="https://getuikit.com/" rel="noopener ugc nofollow" target="_blank"> UIKit </a> <strong class="li iu"> </strong>应用中创建这些类型的列表。</p><p id="33a2" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，我想使用<a class="ae mc" href="https://developer.apple.com/xcode/swiftui/" rel="noopener ugc nofollow" target="_blank"> SwiftUI </a>实现类似的东西。只有几行代码，对吗？</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8c19" class="md me it bd mf mg nf mi mj mk ng mm mn jz nh ka mp kc ni kd mr kf nj kg mt mu bi translated">履行</h1><p id="d90f" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">在这一节中，我们将看看我的实现和我创建的不同组件。</p><h2 id="52ee" class="nk me it bd mf nl nm dn mj nn no dp mn lp np nq mp lt nr ns mr lx nt nu mt nv bi translated">列表状态</h2><p id="0beb" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated"><code class="fe nb nc nd ne b">AdvancedList</code>应该能够代表不同的州。我们可以很容易地用一个<code class="fe nb nc nd ne b">Enum</code>来定义状态。</p><p id="90a6" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">您将在下面看到为什么我跳过添加一个空案例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="6de5" class="nk me it bd mf nl nm dn mj nn no dp mn lp np nq mp lt nr ns mr lx nt nu mt nv bi translated">列表服务</h2><p id="f15b" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated"><code class="fe nb nc nd ne b">AdvancedList</code>需要一个组件来存储和管理<code class="fe nb nc nd ne b">ListState</code> <em class="na"> </em>和<code class="fe nb nc nd ne b">items</code>。</p><p id="5852" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">利用<code class="fe nb nc nd ne b">Combine</code>和SwiftUI的数据绑定特性，我们将<code class="fe nb nc nd ne b">AdvancedList</code> <em class="na"> </em>和<code class="fe nb nc nd ne b">ListService</code>连接起来。</p><p id="35ec" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">您可以通过<code class="fe nb nc nd ne b">ListService</code>改变列表状态并修改项目，此时<code class="fe nb nc nd ne b">AdvancedList</code> <em class="na"> </em>会自动更新。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="d9bc" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在<code class="fe nb nc nd ne b">ListService</code>的实现中有两个特殊项:<code class="fe nb nc nd ne b">Item</code>和<em class="na"> </em> <code class="fe nb nc nd ne b">AnyListItem</code>。</p><h2 id="14cd" class="nk me it bd mf nl nm dn mj nn no dp mn lp np nq mp lt nr ns mr lx nt nu mt nv bi translated">项目</h2><p id="19de" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">我们希望能够在同一个列表中显示不同的项目。每个项目都应该是可识别的，并且应该可以表示为一个SwiftUI视图。</p><p id="a037" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为了实现这一点，我将<code class="fe nb nc nd ne b">Item</code> <em class="na"> </em>约束为<code class="fe nb nc nd ne b">Identifiable</code> <em class="na"> </em>和<code class="fe nb nc nd ne b">View</code>协议。</p><pre class="kj kk kl km gt ny ne nz oa aw ob bi"><span id="4ea9" class="nk me it ne b gy oc od l oe of">func appendItems&lt;<strong class="ne iu">Item: Identifiable</strong>&gt;(<strong class="ne iu">_ items: [Item]</strong>) <strong class="ne iu">where Item: View</strong> {}</span></pre><p id="f556" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">但是有一个问题。</p><p id="9caf" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们不能在<code class="fe nb nc nd ne b">ListService</code>内部的数组中存储符合<code class="fe nb nc nd ne b">Identifiable</code>和<code class="fe nb nc nd ne b">View</code>协议的对象，因为这些协议有相关的类型和通用约束。这就是为什么我必须使用“类型擦除”。</p><p id="02d7" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我实现了一个名为<code class="fe nb nc nd ne b">AnyListItem</code>的盒子类型，它使用<code class="fe nb nc nd ne b">AnyView</code>删除了<code class="fe nb nc nd ne b">body</code>属性(由<code class="fe nb nc nd ne b">View</code>要求)的类型信息，并使用<code class="fe nb nc nd ne b">AnyHashable</code>删除了<code class="fe nb nc nd ne b">id</code> <strong class="li iu"> </strong>属性(由<code class="fe nb nc nd ne b">Identifiable</code>要求)的类型信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="a0e4" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe nb nc nd ne b">ListService</code>在内部使用<code class="fe nb nc nd ne b">AnyListItem</code>擦除添加到列表中的每个<code class="fe nb nc nd ne b">item</code>的类型信息。</p><h2 id="1a7e" class="nk me it bd mf nl nm dn mj nn no dp mn lp np nq mp lt nr ns mr lx nt nu mt nv bi translated">高级列表</h2><p id="8c34" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">最后，我们来看看SwiftUI视图<code class="fe nb nc nd ne b">AdvancedList</code>的实现。</p><p id="acaa" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">该视图使自己依赖于当前列表状态和当前项目。为此，<code class="fe nb nc nd ne b">AdvancedList</code>视图需要一个管理列表状态和条目的<code class="fe nb nc nd ne b">ListService</code> <em class="na"> </em>实例。</p><p id="2119" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">利用<code class="fe nb nc nd ne b">ObjectBinding</code> <em class="na"> </em>属性包装器上的<code class="fe nb nc nd ne b">listService</code> <em class="na"> </em>变量，我们告诉<code class="fe nb nc nd ne b">AdvancedList</code> <em class="na"> </em>视图<em class="na"> </em>要绑定到修改上。</p><p id="1aee" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">另外，<code class="fe nb nc nd ne b">AdvancedList</code>视图的用户应该能够为列表的<code class="fe nb nc nd ne b">empty</code>、<code class="fe nb nc nd ne b">loading</code>和<code class="fe nb nc nd ne b">error</code>状态指定一个视图。</p><p id="214d" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我在初始化器的参数上使用了<code class="fe nb nc nd ne b">ViewBuilder</code>属性包装器来实现这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="7b03" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">正如我上面提到的，我们不需要在<code class="fe nb nc nd ne b">ListState</code>枚举上使用空case，因为我们可以在<code class="fe nb nc nd ne b">items</code>上使用<code class="fe nb nc nd ne b">isEmpty</code>来代替。</p><p id="3085" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在我的实现中还有一件特别的事情:</p><p id="a275" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li iu"> </strong> <code class="fe nb nc nd ne b">ListState</code> <strong class="li iu"> </strong>的<code class="fe nb nc nd ne b">error</code> <strong class="li iu"> </strong>案例有一个<code class="fe nb nc nd ne b">Error</code> <em class="na">类型的关联值。这样，我可以将错误传递给错误查看器，如果需要的话，它可以显示错误。</em></p><p id="f286" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">就是这样！让我们看看如何在现场使用<code class="fe nb nc nd ne b">AdvancedList</code> <em class="na"> </em>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="54cf" class="md me it bd mf mg nf mi mj mk ng mm mn jz nh ka mp kc ni kd mr kf nj kg mt mu bi translated">用法示例</h1><p id="7f9f" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">在本节中，您将看到一个简单的<code class="fe nb nc nd ne b">AdvancedList</code> SwiftUI <strong class="li iu"> </strong>视图的使用示例。</p><p id="b5fe" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">提示<strong class="li iu"> : </strong>您将在下面链接的GitHub资源库中找到完整的实现。</p><p id="9993" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，我们必须创建想要在列表上显示的项目。</p><h2 id="00c8" class="nk me it bd mf nl nm dn mj nn no dp mn lp np nq mp lt nr ns mr lx nt nu mt nv bi translated">示例项目</h2><p id="ebdb" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">我创建了一个代表联系人(姓名、地址等)的<code class="fe nb nc nd ne b">ContactListItem</code>。).</p><p id="400b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">要将该项目的实例添加到列表中，它必须符合协议<code class="fe nb nc nd ne b">Identifiable</code>和<em class="na"> </em> <code class="fe nb nc nd ne b">View</code>。</p><p id="578d" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我在这里做了一些特别的事情；我希望能够根据其类型属性以不同的方式呈现该项。</p><p id="7435" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">看看<code class="fe nb nc nd ne b">body</code> <strong class="li iu"> </strong>属性中<code class="fe nb nc nd ne b">viewRepresentationType</code>的用法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/393134fd701b1a6308bab081b2568d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_mlt20ehMdpQykTzDv8ouQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示iPhone XR 上带有<strong class="bd ky"> <em class="oh">联系人项目</em> </strong> <em class="oh">的高级列表的动画图像</em></p></figure><p id="8c8e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">此外，我实现了第二个项目，它代表一个简单的广告。</p><p id="1bd5" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我用<code class="fe nb nc nd ne b">ContactListItem</code>做了同样的事情。<code class="fe nb nc nd ne b">AdListItem</code>有一个控制视图定义的类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/e9a3ca9e8227e886ca24ffd2d4eaf5e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*EH1uhKbWG5kjbJiLRxmm8w.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示iPhone XR上带有附加项目的高级列表的动画图像</p></figure><h2 id="2434" class="nk me it bd mf nl nm dn mj nn no dp mn lp np nq mp lt nr ns mr lx nt nu mt nv bi translated">示例内容视图</h2><p id="245d" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">最后，我们看看如何在一个简单的内容视图中使用<code class="fe nb nc nd ne b">AdvancedList</code>。</p><p id="ab32" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">你可能想知道<code class="fe nb nc nd ne b">CustomListStateSegmentedControlView</code>是什么<strong class="li iu">。这是一个助手视图，可以轻松地改变列表状态，并向列表中添加随机项目。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/c10f05402e9276c38adc5b61136bf1c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cnAnAlCQlgcmRT68lGiJPg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示iPhone XR上不同项目的高级列表<strong class="bd ky"> </strong>的动画图像</p></figure><p id="74da" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">你已经到达终点了！非常感谢您阅读这篇文章。希望你和我一样喜欢我的<code class="fe nb nc nd ne b">AdvancedList</code> <em class="na"> </em> <code class="fe nb nc nd ne b">view</code> <em class="na"> </em>，当然还有SwiftUI。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6553" class="md me it bd mf mg nf mi mj mk ng mm mn jz nh ka mp kc ni kd mr kf nj kg mt mu bi translated">资源</h1><p id="395c" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">本文的代码如下:</p><div class="oi oj gp gr ok ol"><a href="https://github.com/crelies/AdvancedList-SwiftUI" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">crelies/AdvancedList-SwiftUI</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">使用swift ui-crelies/advanced list-swift ui实现了具有空、错误和加载状态的高级列表</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">github.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz ks ol"/></div></div></a></div></div></div>    
</body>
</html>