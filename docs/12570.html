<html>
<head>
<title>Spring Boot and Swagger — Writing Good API Documentations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot和斯瓦格——写好API文档</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/spring-boot-swagger-api-documentation-249b3cad7d9c?source=collection_archive---------9-----------------------#2022-06-14">https://betterprogramming.pub/spring-boot-swagger-api-documentation-249b3cad7d9c?source=collection_archive---------9-----------------------#2022-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4e82" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">文档变得简单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/9d96a93d2ac7286358b2b23e9f5ed96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*4YAd1MH39nFbf_xdMZoTBw.jpeg"/></div></figure><p id="861e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">无论是在简单的移动应用程序中，还是在集成复杂的企业系统中，API都是技术世界中的关键角色之一。任何应用程序都可以成为一个平台，方法是使用API为现有产品增强和添加服务。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="ea85" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">拥有这些API的良好文档对它们的成功至关重要。API文档是技术内容，包括使用和集成API的说明。可以把它看作是一本参考手册，其中包含了使用API所需的所有信息，比如请求和响应格式，以及如何开始使用它们。</p><p id="a582" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">对于API，您总是可以有自己的文档格式，但是有一个标准或通用的格式会使它更具可读性。使用规范驱动开发(SDD)这样的良好实践也有助于保持文档的有效性。有几个规范可以用来开始编写文档，比如<a class="ae ll" href="https://raml.org/" rel="noopener ugc nofollow" target="_blank"> RAML </a> (RESTful API建模语言)<a class="ae ll" href="https://swagger.io/specification/" rel="noopener ugc nofollow" target="_blank"> OpenAPI </a>(以前的Swagger)和<a class="ae ll" href="https://apiblueprint.org/" rel="noopener ugc nofollow" target="_blank"> API Blueprint </a>，但是在本文中，我们将重点介绍OpenAPI和Spring Boot应用程序的Swagger。</p><h1 id="e33c" class="lm ln iq bd lo lp lq lr ls lt lu lv lw jw lx jx ly jz lz ka ma kc mb kd mc md bi translated">什么是霸气？</h1><p id="2699" class="pw-post-body-paragraph kn ko iq kp b kq me jr ks kt mf ju kv kw mg ky kz la mh lc ld le mi lg lh li ij bi translated">Swagger是一组开源工具，帮助您描述基于REST的API。这使得您可以自动构建漂亮的交互式API文档，自动为您的API生成多种语言的客户端库，并探索自动化测试等其他可能性。</p><h1 id="a597" class="lm ln iq bd lo lp lq lr ls lt lu lv lw jw lx jx ly jz lz ka ma kc mb kd mc md bi translated">入门指南</h1><p id="e292" class="pw-post-body-paragraph kn ko iq kp b kq me jr ks kt mf ju kv kw mg ky kz la mh lc ld le mi lg lh li ij bi translated">要开始使用OpenAPI并创建您的第一个swagger文档，您的应用程序中需要以下依赖项。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="1824" class="mo ln iq mk b gy mp mq l mr ms">&lt;dependency&gt;     <br/>    &lt;groupId&gt;<strong class="mk ir">io.springfox</strong>&lt;/groupId&gt;     <br/>    &lt;artifactId&gt;<strong class="mk ir">springfox-boot-starter</strong>&lt;/artifactId&gt;<br/>    &lt;<strong class="mk ir">version</strong>&gt;3.0.0&lt;/<strong class="mk ir">version</strong>&gt;<br/>&lt;/dependency&gt;</span></pre><p id="0adc" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">使用3.0.0版本的starter，请确保您拥有兼容版本的starter父依赖项。在我的情况下，我使用的是2.4.0。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="2bed" class="mo ln iq mk b gy mp mq l mr ms">&lt;<strong class="mk ir">parent</strong>&gt;<br/>   &lt;<strong class="mk ir">groupId</strong>&gt;org.springframework.boot&lt;/<strong class="mk ir">groupId</strong>&gt;<br/>   &lt;<strong class="mk ir">artifactId</strong>&gt;spring-boot-starter-parent&lt;/<strong class="mk ir">artifactId</strong>&gt;<br/>   &lt;<strong class="mk ir">version</strong>&gt;2.4.0&lt;/<strong class="mk ir">version</strong>&gt;<em class="mt"><br/></em>&lt;/<strong class="mk ir">parent</strong>&gt;</span></pre><p id="5b5f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在这些依赖项都已就绪，您需要提供<code class="fe mu mv mw mk b">Docket</code> bean来开始为开放API文档端点提供服务。为此，您可以使用带有<code class="fe mu mv mw mk b">@Bean</code>注释的给定方法添加以下配置。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="d21c" class="mo ln iq mk b gy mp mq l mr ms">@Configuration<br/><strong class="mk ir">public class </strong>SwaggerConfig{<br/>    @Bean<br/>    <strong class="mk ir">public </strong>Docket getDocket() {<br/>        <strong class="mk ir">return new </strong>Docket(DocumentationType.<strong class="mk ir"><em class="mt">SWAGGER_2</em></strong>)<br/>                .select()<br/>                .apis(RequestHandlerSelectors.<em class="mt">any</em>())<br/>                .paths(PathSelectors.<em class="mt">any</em>())<br/>                .build();<br/>    }<br/>}</span></pre><p id="5fea" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe mu mv mw mk b">select()</code>方法将返回<code class="fe mu mv mw mk b">ApiSelectorBuilder</code>，它可用于管理公开的swagger端点。如果您需要特定路径或包的文档，您可以更改相关方法的输入。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="a4d3" class="mo ln iq mk b gy mp mq l mr ms"><strong class="mk ir">return new </strong>Docket(DocumentationType.<strong class="mk ir"><em class="mt">SWAGGER_2</em></strong>)<br/>    .select()<br/>    .apis(RequestHandlerSelectors.<em class="mt">basePackage</em>(<strong class="mk ir">"fp.sw.controller"</strong>))<br/>    .paths(PathSelectors.<em class="mt">regex</em>(<strong class="mk ir">"/student/*"</strong>))<br/>    .build();</span></pre><p id="2ba0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我们的例子中，我们使用了<code class="fe mu mv mw mk b">any()</code>，这将导致记录所有的API。准备好Docket bean并运行应用程序后，您可以使用以下端点获得JSON格式的机器可读版本的API文档。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="2b4e" class="mo ln iq mk b gy mp mq l mr ms"><a class="ae ll" href="http://localhost:8080/v2/api-docs" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/v2/api-docs</a></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/5f2e61ca6f68c67c52a8e4174e19059e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*KFkdgc28aelAQaIe_R4VHQ.png"/></div></figure><p id="5c3e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在为了有一个人类可读的版本和一些额外的测试特性，我们可以使用swagger-UI依赖项。您唯一需要做的就是在POM文件中添加以下依赖项。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="b878" class="mo ln iq mk b gy mp mq l mr ms">&lt;<strong class="mk ir">dependency</strong>&gt;<br/>   &lt;<strong class="mk ir">groupId</strong>&gt;io.springfox&lt;/<strong class="mk ir">groupId</strong>&gt;<br/>   &lt;<strong class="mk ir">artifactId</strong>&gt;springfox-swagger-ui&lt;/<strong class="mk ir">artifactId</strong>&gt;<br/>   &lt;<strong class="mk ir">version</strong>&gt;3.0.0&lt;/<strong class="mk ir">version</strong>&gt;<br/>&lt;/<strong class="mk ir">dependency</strong>&gt;</span></pre><p id="3dc7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果您在添加此依赖项后运行您的应用程序，并访问下面的URL，您将会发现一个基于web的GUI，它描述了API并为您提供了测试API的功能。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="3fa7" class="mo ln iq mk b gy mp mq l mr ms"><a class="ae ll" href="http://localhost:8080/swagger-ui/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/swagger-ui/</a></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/a90b656bf8c857b088f563ae46c95f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*tjSiMxMR-mqTXiYpsNcpcQ.png"/></div></figure><p id="b7e6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">默认情况下，根据您的Docket配置，您将在此页面上看到一个控制器列表。如果您扩展控制器，您会发现一个有效方法的列表(<em class="mt"> GET、POST、PUT、DELETE、HEAD、OPTIONS </em>)，正如您在控制器中定义的那样。通过扩展每个方法，您将获得关于参数列表、内容类型、响应状态和..</p><h2 id="e5a9" class="mo ln iq bd lo mx my dn ls mz na dp lw kw nb nc ly la nd ne ma le nf ng mc nh bi translated">带注释的文档</h2><p id="c300" class="pw-post-body-paragraph kn ko iq kp b kq me jr ks kt mf ju kv kw mg ky kz la mh lc ld le mi lg lh li ij bi translated">为了获得关于每个方法、参数和其余相关实体的更多细节，您可以使用一组注释来添加注释，这些注释稍后将由swagger呈现在UI中。以下是通过swagger记录API的一些最常用的注释:</p><p id="bcfc" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe mu mv mw mk b">@ApiOperation </code> —使用方法上的注释，您可以为该方法添加一些描述，它将出现在swagger UI中端点路径的旁边。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="fd81" class="mo ln iq mk b gy mp mq l mr ms">@GetMapping(<strong class="mk ir">"/{id}"</strong>)<br/><strong class="mk ir">@ApiOperation(value="Getting student user information")</strong><br/><strong class="mk ir">public </strong>ResponseEntity&lt;Student&gt; getStudent(<br/>...</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/1edf51ae5224933faa294554578ffbfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*or-r10MbfGwboBK82aBodg.png"/></div><p class="ni nj gj gh gi nk nl bd b be z dk translated">swagger-UI中的<strong class="bd nm"> @ApiOperation </strong>注释</p></figure><p id="7629" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe mu mv mw mk b">@ApiParam</code> —该注释将用于描述所请求方法中的参数。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="1dd5" class="mo ln iq mk b gy mp mq l mr ms">@GetMapping(<strong class="mk ir">"/{id}"</strong>)<strong class="mk ir"><br/>public </strong>ResponseEntity&lt;Student&gt; getStudent(<br/>        <strong class="mk ir">@ApiParam(value = "Student ID number" , required = true , example = "1")</strong><br/>        @PathVariable Long id ){<br/>...</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/596c947e303128f324d6aceb06b6793a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*8DL8Ld_OOec1FcyYEXMC9w.png"/></div><p class="ni nj gj gh gi nk nl bd b be z dk translated">swagger-UI中的@GetMapping注释</p></figure><p id="ba62" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe mu mv mw mk b">@ApiModelProperty </code> —可用于描述模型中用作请求或响应对象的属性。</p><pre class="kg kh ki kj gt mj mk ml mm aw mn bi"><span id="476c" class="mo ln iq mk b gy mp mq l mr ms"><strong class="mk ir">public class </strong>Student {<br/>    @ApiModelProperty(notes = <strong class="mk ir">"Student Id Number"</strong>, <br/>         example = <strong class="mk ir">"1"</strong>, position = 1)<br/>    <strong class="mk ir">private </strong>Long <strong class="mk ir">id</strong>;<br/><br/>    @ApiModelProperty(notes = <strong class="mk ir">"Student name"</strong>, <br/>          example = <strong class="mk ir">"John"</strong>, position = 2)<br/>    <strong class="mk ir">private </strong>String <strong class="mk ir">name</strong>;<br/>}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/6306f2559d290f9b76d0b584d9d20e12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*DPUOBrzo8mZ8NWO79SijEQ.png"/></div><p class="ni nj gj gh gi nk nl bd b be z dk translated">swagger-UI中的@ApiModelProperty注释</p></figure><p id="7337" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">你可以在这里找到完整的列表。</p><h2 id="5cff" class="mo ln iq bd lo mx my dn ls mz na dp lw kw nb nc ly la nd ne ma le nf ng mc nh bi translated">确保昂首阔步</h2><p id="c2b8" class="pw-post-body-paragraph kn ko iq kp b kq me jr ks kt mf ju kv kw mg ky kz la mh lc ld le mi lg lh li ij bi translated">因为您通过swagger暴露了一些敏感信息，所以建议在生产环境中禁用swagger，或者至少保护它。为了保护它，您可以使用Spring Security并添加相关的started，默认情况下，swagger端点将使用基本的身份验证方法来保护。在Spring Security中，您可以利用很多灵活的认证和授权选项。</p><h2 id="aeb1" class="mo ln iq bd lo mx my dn ls mz na dp lw kw nb nc ly la nd ne ma le nf ng mc nh bi translated">生成客户端库</h2><p id="ee84" class="pw-post-body-paragraph kn ko iq kp b kq me jr ks kt mf ju kv kw mg ky kz la mh lc ld le mi lg lh li ij bi translated">使用swagger的另一个好处是，您可以使用OpenAPI Swagger规范来生成不同语言的客户端库或SDK。Swagger Codegen 是可以用来创建这些库的工具之一。Swagger Codegen可以通过为任何API生成服务器存根和客户端SDK来简化您的构建过程，这些API是用OpenAPI(以前称为Swagger)规范定义的，因此您的团队可以更好地专注于API的实现和采用。虽然该工具可以快速生成40种不同语言的客户端库，但它也可以与SwaggerHub集成。这使得通过该工具的云接口进行协作变得更加容易。</p><h2 id="cd35" class="mo ln iq bd lo mx my dn ls mz na dp lw kw nb nc ly la nd ne ma le nf ng mc nh bi translated">自动化测试</h2><p id="4596" class="pw-post-body-paragraph kn ko iq kp b kq me jr ks kt mf ju kv kw mg ky kz la mh lc ld le mi lg lh li ij bi translated">拥有一个机器可读的Swagger规范使您有可能使用其他应用程序来准备自动化测试。像<a class="ae ll" href="https://assertible.com/" rel="noopener ugc nofollow" target="_blank">assertable</a>和<a class="ae ll" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>这样的工具可以用来导入Swagger规范，并自动为每个端点和方法创建测试和断言。</p></div></div>    
</body>
</html>