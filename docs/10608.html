<html>
<head>
<title>The Best Way to Group Data in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫数据分组的最佳方式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-best-way-to-group-data-in-pandas-7f446a1fc7fa?source=collection_archive---------3-----------------------#2022-01-18">https://betterprogramming.pub/the-best-way-to-group-data-in-pandas-7f446a1fc7fa?source=collection_archive---------3-----------------------#2022-01-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="61af" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我不知道你怎么想，但对我来说，熊猫的分组是有史以来最好的！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a9a72e082ed6b01a5c6a85afc1890952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EcuEoY61v0E4wqBQ3iBx3w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">瑞兰德·迪恩在<a class="ae kv" href="https://unsplash.com/s/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="d528" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我不知道你怎么想，但对我来说，熊猫的分组是有史以来最好的！</p><p id="9aa3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于任何从事数据分析的人来说，我确信“Groupby”应该在你最常用的5个函数列表中！</p><p id="9f3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，随着每个口袋妖怪的发展，我会在这里告诉你我使用Groupby的方式，以及它是如何极其通用的。</p><p id="2582" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">跟着走！</p><p id="ccf3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将使用来自Kaggle 的<a class="ae kv" href="https://www.kaggle.com/olistbr/brazilian-ecommerce" rel="noopener ugc nofollow" target="_blank"> Olist数据集，做一些修改，并且我已经执行了数据库的合并。</a></p><p id="6c94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先来进口熊猫和Numpy:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="b85f" class="lx ly iq lt b gy lz ma l mb mc">import pandas as pd<br/>import numpy as np</span></pre><p id="bd0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我使用Pandas info()函数加载了我的数据帧，它看起来像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi md"><img src="../Images/9f752c5f54d7cca1644ff265c05333ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*JAI2ucWoK6sQ08qrXPpkeA.png"/></div></figure><p id="f4a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么，假设我想知道订单购买日期之前的支付值的总和，我该怎么做呢？</p><p id="1563" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来看看通常的方法及其输出:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="d5ff" class="lx ly iq lt b gy lz ma l mb mc">df.groupby('order_purchase_timestamp')['payment_value'].sum().reset_index()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi me"><img src="../Images/d43086e1906379fab226be93c1ccd8f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*CEKyE9zcFpm5o70Z6XXzQw.png"/></div></figure><p id="d8bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很好，成功了，不是吗？</p><p id="4584" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，这是在一个每日基地，我怎么能这样做每月？我们将使用<code class="fe mf mg mh lt b">pd.Grouper() </code>函数，就像这样:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="e88a" class="lx ly iq lt b gy lz ma l mb mc">df.groupby(pd.Grouper(key = 'order_purchase_timestamp', freq = 'M'))['payment_value'].sum().reset_index()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/99c1c0374414884dfe7daf512ca74844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*zI-3xeLNSrAjULcNJpO9Hw.png"/></div></figure><p id="13fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个<em class="mj">键</em>参数必须是日期时间列，而<em class="mj"> freq </em>是时间的频率，如月(M)、周(W)、三个月(3M)、年(Y)等等…</p><p id="def7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是在这段代码中，我只查看一列的和。如何向多个列添加多个度量？</p><p id="33e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用<code class="fe mf mg mh lt b">agg()</code>功能！</p><p id="9572" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">跟我来。</p><p id="7500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我想要在2个月的时间内，到订单购买日期，支付值和运费值的平均值之和:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="fbec" class="lx ly iq lt b gy lz ma l mb mc">df.groupby(pd.Grouper(key = 'order_purchase_timestamp', freq = '2M')).agg({'payment_value': 'sum', 'freight_value': 'mean'}).reset_index()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/1a8c4a90a5d8a40afee848a0925f495d.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*FlK66UivrTldJ0i_3y5BHQ.png"/></div></figure><p id="62bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mf mg mh lt b">agg()</code> <em class="mj"> </em>函数使用字典作为参数！</p><p id="b2a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我可以对每列使用多个度量吗？</p><p id="4849" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是的，你可以！</p><p id="e125" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们在代码中添加支付值的平均值！</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="bdf4" class="lx ly iq lt b gy lz ma l mb mc">df.groupby(pd.Grouper(key = 'order_purchase_timestamp', freq = '2M')).agg({'payment_value': ['sum', 'mean'],'freight_value': 'mean'}).reset_index()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a4227d9950416acadb9b556a7cef8c03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*QIqRBdqto6x4kZhWUBG_iQ.png"/></div></figure><p id="ad87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将返回一个多索引数据帧:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/fc4675fdbde6c080fb2656fec11abdd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*_5SD5xd3K8qkUbIaoPD0Sw.png"/></div></figure><p id="7ba9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">别担心！解决起来很简单！我们将使用列表理解！</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="abd0" class="lx ly iq lt b gy lz ma l mb mc">weeks2.columns = ['_'.join(col) for col in weeks2.columns]</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/f701479b0295573166b8c75db2ece92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*3nM_sXdPVERdYJJ2yKHbtg.png"/></div></figure><p id="502b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">容易吗？</p><p id="6aea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就说说你对它的看法吧:)</p><p id="2e0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">.</p><p id="a44a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">.</p><p id="1861" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">.</p><p id="2351" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想了解更多，请点击这里查看我的指导课程:<a class="ae kv" href="https://mentorcruise.com/mentor/NathanLara/" rel="noopener ugc nofollow" target="_blank">https://mentorcruise.com/mentor/NathanLara/</a></p></div></div>    
</body>
</html>