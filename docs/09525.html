<html>
<head>
<title>Build Android DropdownMenu in Jetpack Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Jetpack Compose中构建Android下拉菜单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-android-dropdownmenu-in-jetpack-compose-25512fe08068?source=collection_archive---------2-----------------------#2021-09-06">https://betterprogramming.pub/build-android-dropdownmenu-in-jetpack-compose-25512fe08068?source=collection_archive---------2-----------------------#2021-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1b31" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建弹出窗口变得简单多了</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c62a27b4c7590d2c1910ae4859f37e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1NC03VBd9PtZPCS0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯汀·休姆在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6467" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将学习如何在Jetpack compose中构建下拉菜单。我们将构建一个可重用的通用可组合组件。我们将要构建的类似于传统的下拉菜单。</p><h1 id="8c32" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">介绍</h1><p id="0033" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Jetpack Compose是谷歌最近试图让Android开发者轻松构建UI的尝试之一。</p><blockquote class="ms mt mu"><p id="1ed4" class="kz la mv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><em class="it">“Jetpack Compose是一个用于构建原生Android UI的现代工具包。Jetpack Compose以更少的代码、强大的工具和直观的Kotlin APIs简化并加速了Android上的UI开发。”— </em> <a class="ae ky" href="https://developer.android.com/jetpack/compose/tutorial" rel="noopener ugc nofollow" target="_blank"> <em class="it">安卓开发者</em> </a></p></blockquote><p id="1746" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Jetpack Compose的稳定版本1.0最近发布，这意味着它的生产就绪。因此，这将是学习如何使用下一代UI套件进行Android开发的大好时机。</p><p id="e247" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要安装Android Studio —北极狐(2020.3.1) <strong class="lb iu"> </strong>版本才能使用Jetpack Compose。</p><h1 id="e4f3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">先决条件</h1><p id="4aac" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在进一步学习之前，您必须具备如何使用Jetpack Compose的基本知识。如果你是作曲新手，我强烈推荐阅读以下文章:</p><ul class=""><li id="d0bd" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">"<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/jetpack-compose-components-part-1-a80717dbfb59"> Jetpack构成组件(第1部分)</a>"</li><li id="af07" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/explore-android-bottom-sheets-in-jetpack-compose-50eff0257231">“探索Jetpack Compose中的Android底部表单”</a></li><li id="b198" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">"<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/build-android-layouts-in-jetpack-compose-bda2e0837f5e">在JetPack Compose中构建Android布局</a>"</li><li id="cb18" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/android-bottom-navigation-bar-with-jetpack-compose-8c2aa02b933d">“使用Jetpack撰写的Android底部导航栏”</a></li></ul><h1 id="ff6b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建下拉视图</h1><p id="2a35" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，我们需要创建一个下拉视图，并测试显示占位符或选定的项目，然后在右端创建一个下拉图标，帮助用户将其识别为下拉视图。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="e61a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我用<code class="fe np nq nr ns b">Box</code> compose函数画了一个矩形边框。在它里面，我们用<code class="fe np nq nr ns b">16.dp</code>填充了<code class="fe np nq nr ns b"><em class="mv">ConstraintLayout</em></code> <em class="mv">，使它看起来更有吸引力<em class="mv">。</em>实际的设计现在从分别代表选中文本或占位符文本和下拉图标的<code class="fe np nq nr ns b"><em class="mv">Text</em></code>和<code class="fe np nq nr ns b"><em class="mv">Icon</em></code> <em class="mv"> </em>组件开始。看一下代码:</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/be781e7194e3a359a47e472fec61d1be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gZeGiC5Q2nvg7mF9GX2hgA.png"/></div></div></figure><h1 id="f1d9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">菜单参数组合的思考</h1><p id="0739" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在compose中，UI用一种叫做<code class="fe np nq nr ns b">recomposition </code>的理论进行更新——通过调用带有不同参数的同一个可组合函数来更新UI。在Compose中，数据沿着从主可组合组件到内部小部件<code class="fe np nq nr ns b">composables</code>的线路向下流动，而事件沿着相反的方向流动。</p><p id="be2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这使得<code class="fe np nq nr ns b">recomposition</code>工作完美，因为当事件发生时，数据得到更新，这导致<code class="fe np nq nr ns b">recomposition</code>具有新数据。这正是我们的<code class="fe np nq nr ns b">ComposeMenu</code>将要工作的方式。</p><p id="7df7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ComposeMenu函数接受一组输入。看一下代码:</p><pre class="kj kk kl km gt nu ns nv nw aw nx bi"><span id="0e44" class="ny lw it ns b gy nz oa l ob oc">@Composable<br/><strong class="ns iu">fun </strong>Menu(<br/>    menuItems: List&lt;String&gt;,<br/>    menuExpandedState: Boolean,<br/>    seletedIndex : Int,<br/>    updateMenuExpandStatus : () -&gt; Unit,<br/>    onDismissMenuView : () -&gt; Unit,<br/>    onMenuItemclick : (Int) -&gt; Unit,<br/>) {</span></pre><ul class=""><li id="bb7b" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">menuItems —表示要在菜单中显示的列表。</li><li id="11a1" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">menuExpandedState —表示菜单是否已展开并在用户界面中可见。</li><li id="2e4d" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">seletedIndex —表示列表中当前选定的索引；它用于显示占位符中的活动元素。</li><li id="9d94" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">updateMenuExpandStatus —一个简单的Kotlin函数，用于将<code class="fe np nq nr ns b">menuExpandedState</code>更改为true，从而通过重新组合显示<code class="fe np nq nr ns b">ComposeMenu</code>。</li><li id="d3c3" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">onDismissMenuView —当用户请求关闭菜单时调用。</li><li id="00ed" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">onMenuItemclick以所选索引作为参数的最终Kotlin函数。当我们将选中的索引传递给这个函数时，<code class="fe np nq nr ns b">seletedIndex</code>参数会得到更新，这又会导致重新组合以在占位符中显示选中的项。</li></ul><h1 id="53e6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">设计下拉菜单</h1><p id="082b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这里我们使用了<code class="fe np nq nr ns b">DropdownMenu</code>可组合函数。一个<code class="fe np nq nr ns b">DropdownMenu</code>的行为类似于一个弹出菜单，它将使用父布局的位置在屏幕上定位自己。在里面，我们将使用<code class="fe np nq nr ns b">DropdownMenuItem</code>来设计菜单中的每个项目。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="3828" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看一下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/081460ff2f03760eff98dc2ab5344e24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kNnQMsmhXN-Kfbym4j0thQ.png"/></div></div></figure><h1 id="c1eb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">将事情整合在一起</h1><p id="c865" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在我们需要将占位符和<code class="fe np nq nr ns b">DropdownMenu</code>添加到单个可组合函数中，以对每个可组合函数上的更改做出反应。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="ddb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要从实际的compose函数中调用<code class="fe np nq nr ns b">ComposeMenu</code>函数来显示它。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="338e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在只要从你的活动中触发它。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="f9a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看最终的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/d96199c41dbc018802698cc61fd13fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*sj1kslOyAseJFY1yBly7Ag.gif"/></div></figure><h1 id="f678" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="533c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">目前就这些。希望你学到了有用的东西。快乐作曲！</p><p id="a28c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div></div>    
</body>
</html>