<html>
<head>
<title>How To Add Multiple Request and Response Examples in FastAPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在FastAPI中添加多个请求和响应示例</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-add-multiple-request-and-response-examples-in-fastapi-ce2117eac7ed?source=collection_archive---------2-----------------------#2021-05-25">https://betterprogramming.pub/how-to-add-multiple-request-and-response-examples-in-fastapi-ce2117eac7ed?source=collection_archive---------2-----------------------#2021-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="408a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">提升您的文档级别</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/77ba7121ccc021717e0a5672213a1864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aL6XFvAcPIK0fUI1jBEGUA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="81d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过阅读本文，您将学会扩展<a class="ae lu" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>的文档，以包含所有请求和响应的多个示例。这适用于Swagger UI和ReDoc端点。</p><p id="211c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，您将能够在ReDoc中实现以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/8f688e11693273692e1a7c2358bffbfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*vbX_t1U915cYUKOKlTXC-g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0a1e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">同样，同样的功能也适用于Swagger UI:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/1ab5439f7cc644529165278448a44ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vazHqHNRwxd-Wg4heH6JnQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3d21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以前，你必须依赖pydantic的<code class="fe lx ly lz ma b">Field()</code>对象或者继承自<code class="fe lx ly lz ma b">BaseModel</code>的类内部的<code class="fe lx ly lz ma b">extra_schema</code>来添加例子。除此之外，您只能向请求或响应添加一个示例。</p><p id="7c50" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从版本0.64.0开始，FastAPI正式支持以下对象的<code class="fe lx ly lz ma b">example</code>和<code class="fe lx ly lz ma b">examples</code>参数:</p><ul class=""><li id="bcf0" class="mb mc it la b lb lc le lf lh md ll me lp mf lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Body()</code></li><li id="fa9a" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Path()</code></li><li id="0f9c" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Query()</code></li><li id="af05" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Cookie()</code></li><li id="b230" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Header()</code></li></ul><p id="df28" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">根据<a class="ae lu" href="https://fastapi.tiangolo.com/tutorial/schema-extra-example/#technical-details" rel="noopener ugc nofollow" target="_blank">官方文件</a>:</p><blockquote class="mp mq mr"><p id="a42b" class="ky kz ms la b lb lc ju ld le lf jx lg mt li lj lk mu lm ln lo mv lq lr ls lt im bi translated">“最近发布了一个新版本的OpenAPI: 3.1.0。它基于最新的JSON模式，并删除了OpenAPI定制版本JSON模式的大部分修改，以交换最新版本JSON模式的功能，因此所有这些小差异都减少了。尽管如此，Swagger UI目前还不支持OpenAPI 3.1.0。”</p></blockquote><p id="f14b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">FastAPI背后的开发人员通过一些技巧来解决这个问题，以处理OpenAPI、JSON Schema和OpenAPI的3.0.x定制版JSON Schema之间的兼容性和不兼容性。</p><p id="ee14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们继续下一节，开始安装必要的Python模块。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="b5ab" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">设置</h1><p id="f58f" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">强烈建议您在继续安装之前创建一个新的虚拟环境。</p><h2 id="5d8a" class="oa ne it bd nf ob oc dn nj od oe dp nn lh of og np ll oh oi nr lp oj ok nt ol bi translated">FastAPI</h2><p id="0a17" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">激活它并运行以下命令来安装FastAPI:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="886f" class="oa ne it ma b gy oq or l os ot">pip install fastapi</span></pre><p id="41de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请确保您安装了0.65.1+版本，因为该版本附带了稳定的pydantic版本，该版本<a class="ae lu" href="https://github.com/samuelcolvin/pydantic/security/advisories/GHSA-5jqp-qgf6-3pvh" rel="noopener ugc nofollow" target="_blank">修复了一个关键的安全问题</a>。</p><h2 id="bd88" class="oa ne it bd nf ob oc dn nj od oe dp nn lh of og np ll oh oi nr lp oj ok nt ol bi translated">紫玉米</h2><p id="78ae" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">接下来，安装标准的uvicorn包，如下所示:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="e0ea" class="oa ne it ma b gy oq or l os ot">pip install uvicorn[standard]</span></pre></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="fba5" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">履行</h1><p id="13a1" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">让我们看看下面这个简单的FastAPI服务器的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="f487" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它包含两个继承自<code class="fe lx ly lz ma b">BaseModel</code>的类:</p><ul class=""><li id="5d41" class="mb mc it la b lb lc le lf lh md ll me lp mf lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Number </code> —输入参数</li><li id="f8e5" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Response</code> —输出结果</li></ul><p id="ea5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，还有一个名为<code class="fe lx ly lz ma b">odd</code>的端点，它确定输入值是否为奇数，并将结果返回给用户。</p><p id="6e0f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了向端点添加请求示例，您需要做的就是创建一个有效的dictionary对象，该对象对应于以下对象之一的JSON模式:</p><ul class=""><li id="b792" class="mb mc it la b lb lc le lf lh md ll me lp mf lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Body()</code></li><li id="c133" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Path()</code></li><li id="394d" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Query()</code></li><li id="d85b" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Cookie()</code></li><li id="78e2" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">Header()</code></li></ul><p id="0ef8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，最好的选择是使用<code class="fe lx ly lz ma b">Body()</code>对象。</p><h2 id="0766" class="oa ne it bd nf ob oc dn nj od oe dp nn lh of og np ll oh oi nr lp oj ok nt ol bi translated">添加请求示例</h2><p id="e6b9" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">字典对象中的每个项目都应包含以下字段:</p><ul class=""><li id="5f56" class="mb mc it la b lb lc le lf lh md ll me lp mf lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">summary</code> —作为选项的一部分显示在下拉列表中的名称。</li><li id="a4d3" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">description</code> —可选字段包含用户选择选项时的简短支持描述。支持markdown格式的文本。</li><li id="8273" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated"><code class="fe lx ly lz ma b">value</code> —代表有效负载或结果的示例模式。</li></ul><p id="ac80" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，您可以按如下方式定义字典对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="bca1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，只需修改以下代码:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="b258" class="oa ne it ma b gy oq or l os ot">def odd(number: Number):</span></pre><p id="4186" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">收件人:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="bc4b" class="oa ne it ma b gy oq or l os ot">def odd(number: Number = Body(..., examples=odd_examples)):</span></pre><h2 id="d169" class="oa ne it bd nf ob oc dn nj od oe dp nn lh of og np ll oh oi nr lp oj ok nt ol bi translated">添加回应示例</h2><p id="08e3" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">另一方面，将示例添加到响应中略有不同。这主要是因为响应被绑定到HTTP状态代码，尽管大多数情况下，示例只针对状态代码200。</p><p id="61c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个新的字典对象，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="b810" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，修改以下代码:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="6917" class="oa ne it ma b gy oq or l os ot">@app.post("/odd", response_model=Response)</span></pre><p id="6274" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">收件人:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="c5f2" class="oa ne it ma b gy oq or l os ot">@app.post("/odd", response_model=Response, responses=odd_responses)</span></pre><h2 id="671b" class="oa ne it bd nf ob oc dn nj od oe dp nn lh of og np ll oh oi nr lp oj ok nt ol bi translated">测试FastAPI的文档</h2><p id="3e8a" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">完成后，将文件另存为<code class="fe lx ly lz ma b">myapp.py</code>并在命令行中运行以下命令来启动FastAPI服务器:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="589e" class="oa ne it ma b gy oq or l os ot">uvicorn myapp:app</span></pre><p id="a944" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果使用不同的文件名和变量名，请相应地修改名称:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="2852" class="oa ne it ma b gy oq or l os ot">uvicorn &lt;file_name&gt;:&lt;variable_name&gt;</span></pre><p id="d44f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认情况下，它将使用端口8000运行服务器。请访问以下网址:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="38b5" class="oa ne it ma b gy oq or l os ot">http://localhost:8000/docs</span></pre><p id="7f99" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该在<code class="fe lx ly lz ma b">Example</code>部分看到请求和响应的下拉列表。例如:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/1724ed2921ec7dcfd7687cb04732c47f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*-c8UtOfnbccl6RZ5e_TS6w.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3382" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">至于ReDoc，您应该使用以下URL:</p><pre class="kj kk kl km gt om ma on oo aw op bi"><span id="0cf0" class="oa ne it ma b gy oq or l os ot">http://localhost:8000/redoc</span></pre><p id="e72b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/036f359a9384eae4c6cb961b531804b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*o3h0qPcV3BPCzUYyqKuMzw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4e2e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在以下<a class="ae lu" href="https://gist.github.com/wfng92/1c47646c9561b9fc75c5f0f983820213" rel="noopener ugc nofollow" target="_blank">要点</a>中找到完整的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="5944" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">结论</h1><p id="92ba" class="pw-post-body-paragraph ky kz it la b lb nv ju ld le nw jx lg lh nx lj lk ll ny ln lo lp nz lr ls lt im bi translated">让我们回顾一下你今天所学的内容。</p><p id="e746" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本教程首先简要解释了FastAPI如何支持请求和响应的多个示例。</p><p id="a9da" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">稍后，我们继续安装过程，在此过程中，您将被引导完成<code class="fe lx ly lz ma b">fastapi</code>和<code class="fe lx ly lz ma b">uvicorn</code>包的安装。</p><p id="d694" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在接下来的部分中，我们讨论了请求和响应的整个过程。给出了代码片段作为实现的参考。最后一部分是关于运行服务器和访问文档来验证结果。</p><p id="9fed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="874c" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">参考</h1><ol class=""><li id="4a90" class="mb mc it la b lb nv le nw lh oy ll oz lp pa lt pb mh mi mj bi translated"><a class="ae lu" href="https://fastapi.tiangolo.com/tutorial/schema-extra-example/" rel="noopener ugc nofollow" target="_blank"> FastAPI —模式额外示例</a></li><li id="8a5d" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt pb mh mi mj bi translated"><a class="ae lu" href="https://fastapi.tiangolo.com/advanced/additional-responses/" rel="noopener ugc nofollow" target="_blank"> FastAPI —附加响应</a></li></ol></div></div>    
</body>
</html>