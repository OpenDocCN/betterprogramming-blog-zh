<html>
<head>
<title>How To Refactor Code in Visual Studio Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Visual Studio代码中重构代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-refactor-code-in-visual-studio-code-884dc85a066a?source=collection_archive---------5-----------------------#2021-05-10">https://betterprogramming.pub/how-to-refactor-code-in-visual-studio-code-884dc85a066a?source=collection_archive---------5-----------------------#2021-05-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0aa7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让重构变得容易的强大插件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5eb2ef96633b2f39b7e4b2df569e74d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GwjW0An4VVUmYFvp1GaPUw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="87f1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://www.stepsize.com/blog/the-ultimate-engineers-guide-to-refactoring?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=1" rel="noopener ugc nofollow" target="_blank">重构</a>根据最佳实践或规则改进代码的内部结构，而不改变当前行为。您经常会看到开发团队在开始新的开发周期之前，计划一周的重构时间来评估代码的架构和内部结构。对于工程团队来说，持续解决技术问题并定期讨论维护和代码质量非常重要。</p><p id="a1b2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码重构是提高代码质量和可维护性的重要活动。在干净的代码上构建新的特性要容易得多，但是在编写测试时也会让你受益。</p><p id="b220" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文着眼于如何使用Visual Studio代码(VS代码)和VS代码插件来重构代码。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7296" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.使用Visual Studio代码快捷方式进行重构</h1><p id="c951" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">首先，我们利用Visual Studio代码的原生快捷方式来做一些基本的代码重构。我们使用JavaScript创建了一个小代码示例来帮助您使用这些功能。</p><p id="0b10" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有一个包含业务逻辑的<code class="fe mz na nb nc b">index.js</code>文件。我们导入一个<code class="fe mz na nb nc b">userModule</code>，检索一个新的用户对象，并将用户名转换成大写:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="3ef9" class="nh md it nc b gy ni nj l nk nl">const userModule = require('./modules/users/retrieve')</span><span id="4e5c" class="nh md it nc b gy nm nj l nk nl">const myUser = userModule.getUser("Ben", 17)<br/>console.log(myUser.name)</span><span id="47c9" class="nh md it nc b gy nm nj l nk nl">const name = userModule.toUpperCaseUser(myUser.name)<br/>console.log(name)</span></pre><p id="6939" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，这里是包含我们在<code class="fe mz na nb nc b">index.js</code>文件中使用的几个导出函数的<code class="fe mz na nb nc b">userModule</code>的实现。该文件嵌套在两个文件夹中。由此产生的路径是<code class="fe mz na nb nc b">/modules/users/retrieve.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="2ff4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们右击<code class="fe mz na nb nc b">index.js</code>文件中的<code class="fe mz na nb nc b">getUser</code>函数。您将看到不同的选项可以帮助我们重构代码。这里有一个简短的列表:</p><ul class=""><li id="fa8c" class="np nq it la b lb lc le lf lh nr ll ns lp nt lt nu nv nw nx bi translated">转到定义:打开一个窗格，显示函数的定义位置。</li><li id="5364" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated">转到实现:带您到<code class="fe mz na nb nc b">modules/users/retrieve.js</code>文件中的函数定义。</li><li id="6ad9" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated">查找所有引用:显示一个函数在一个文件中被使用的所有位置和每个函数的用法。</li></ul><p id="3a72" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的命令对于在VS代码中快速导航和查找函数定义非常有用。例如，您想弄清楚在哪些文件中使用了特定的函数。您可以使用这些命令快速解决此类任务。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="522b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.自动修复导入和文件名</h1><p id="107a" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">当重构代码时，开发人员经常忍不住批评选择不当的文件名。最重要的是，重构代码意味着你在不同的文件之间转移代码，改变某些模块的用途。因此，当代码重构完成时，不完整的导入太常见了。</p><p id="51a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">VS代码可以让你免去手动扫描所有文件来查找不完整导入的麻烦。当你第一次在VS代码中改变一个文件名时，它会要求你自动更新导入。在这里，选择“总是自动更新导入”选项。您可以通过重命名前面示例中的<code class="fe mz na nb nc b">retrieve.js</code>文件来尝试一下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/34b7f39182c37657059f918911a5a198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Cv2aKiPmCOl0bQtz.png"/></div></div></figure><p id="b55a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，创建一个新文件夹并将<code class="fe mz na nb nc b">retrieve.js</code>文件移动到这个文件夹中。这样做时，VS代码会向您显示另一个弹出消息，询问您是否希望在移动文件时自动更新导入。再次选择“总是自动更新导入”选项。就是这样！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="028d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.Visual Studio代码的内置代码格式</h1><p id="0d79" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">从<a class="ae lu" href="https://code.visualstudio.com/docs/editor/codebasics#_formatting" rel="noopener ugc nofollow" target="_blank"> VS代码文档</a>中，我们可以了解内置格式化选项是如何工作的:</p><blockquote class="oe of og"><p id="4fac" class="ky kz oh la b lb lc ju ld le lf jx lg oi li lj lk oj lm ln lo ok lq lr ls lt im bi translated">“VS代码有JavaScript、TypeScript、JSON和HTML的默认格式化程序。每种语言都有特定的格式选项(例如，<code class="fe mz na nb nc b">html.format.indentInnerHtml</code>)，您可以在用户或工作区设置中根据自己的喜好进行调整。”</p></blockquote><p id="2a2b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要触发格式化选项，您可以打开命令面板(shift + CMD + P)并查找选项“格式化文档”选择此选项来格式化您的文档。最有可能的是，除了修复一些缩进问题，这不会改变你的代码太多。</p><p id="0a83" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您希望Visual Studio代码在您对文件进行更改时自动触发“格式化文档”选项，您可以通过<a class="ae lu" href="https://code.visualstudio.com/docs/getstarted/settings" rel="noopener ugc nofollow" target="_blank">用户设置</a>进行配置。我们更喜欢在点击保存按钮(CMD + S)时格式化文档。为此，打开您的用户设置并查找规则<code class="fe mz na nb nc b">editor.formatOnSave</code>。单击规则旁边的复选框以启用它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/a0b95b2302a5d4b3edda8ee19a9a682d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*P0SnlHvYNHK-3G0l.png"/></div></div></figure><p id="9ea3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">或者，您可以选择<code class="fe mz na nb nc b">editor.formatOnType</code>，它在输入后格式化一行，或者选择<code class="fe mz na nb nc b">editor.formatOnPaste</code>，它在您将内容粘贴到编辑器中时格式化内容。</p><p id="5199" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">选择格式规则时，您无需执行任何其他操作即可启用该规则。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9398" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.通过更漂亮的Visual Studio代码扩展自定义代码格式</h1><p id="1bca" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们不需要使用VS Code提供的内置代码格式化工具。我们可以禁用默认的语言格式化程序，用一个自定义的语言格式化程序或者一个像Prettier这样的扩展提供的语言格式化程序来代替它。</p><blockquote class="ol"><p id="7dee" class="om on it bd oo op oq or os ot ou lt dk translated">"如果您安装了另一个为同一种语言提供格式化的扩展，您也可以禁用默认的语言格式化程序。"—  <a class="ae lu" href="https://code.visualstudio.com/docs/editor/codebasics#_formatting" rel="noopener ugc nofollow" target="_blank"> <em class="ov"> VS代码文档</em> </a></p></blockquote><p id="7123" class="pw-post-body-paragraph ky kz it la b lb ow ju ld le ox jx lg lh oy lj lk ll oz ln lo lp pa lr ls lt im bi translated">首先，我们需要在扩展窗格中找到更漂亮的扩展。确保选择支持多种语言的官方beauty扩展。你可以点击“安装”按钮来安装扩展。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/d858f5120defb4e3c9f60df226a5b1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RkNmokqQXyoHZWsC.png"/></div></div></figure><p id="e59b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您也可以选择一个特定的<a class="ae lu" href="https://marketplace.visualstudio.com/items?itemName=rvest.vs-code-prettier-eslint" rel="noopener ugc nofollow" target="_blank">更漂亮的ESLint扩展</a>。然而，使用官方插件更容易，因为你可以为不同的文件类型配置它。例如，您可能在一个项目中有CSS、JSON和JavaScript文件。</p><p id="d2ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要启用漂亮的格式化程序作为所有语言的默认格式化程序，我们必须再次打开用户设置。寻找<code class="fe mz na nb nc b">editor.DefaultFormatter</code>规则，选择更漂亮的格式化程序<code class="fe mz na nb nc b">esbenp.prettier-vscode</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/428e54ee74a73854473632f1b4c68710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x9E5N_ebd8vF4rhC.png"/></div></div></figure><p id="620b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们需要添加更漂亮的配置规则来告诉VS代码现在如何格式化我们的文档。最简单的方法是在项目的根目录下创建一个<code class="fe mz na nb nc b">.prettierrc </code> <a class="ae lu" href="https://prettier.io/docs/en/configuration.html" rel="noopener ugc nofollow" target="_blank">配置文件</a>。这个文件将包含一个保存所有活动规则的JSON对象。这种方法的优点是，您可以将配置文件提交到您的存储库中，以便在您的团队中实施相同的编码标准。这种标准化将减少未来的重构工作。</p><p id="3d0f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是一些流行的规则，可以帮助你快速重构代码:</p><ul class=""><li id="a3d7" class="np nq it la b lb lc le lf lh nr ll ns lp nt lt nu nv nw nx bi translated"><code class="fe mz na nb nc b">tabWidth</code>:指定每个缩进层次的空格数。</li><li id="93da" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated"><code class="fe mz na nb nc b">semi</code>:在语句末尾打印分号。</li><li id="7a91" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated"><code class="fe mz na nb nc b">singleQuote</code>:用单引号代替双引号。</li><li id="6bcb" class="np nq it la b lb ny le nz lh oa ll ob lp oc lt nu nv nw nx bi translated"><code class="fe mz na nb nc b">arrowParens</code>:在一个单独的arrow函数参数周围加上括号，这是我们在这个例子中想要避免的。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="63a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以通过更改一个文件并保存它来尝试这些设置。或者，您可以再次打开命令调板，然后选择命令“格式化文档”</p><p id="22f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想看看所有可能的规则，你可以在<a class="ae lu" href="https://prettier.io/docs/en/options.html" rel="noopener ugc nofollow" target="_blank">更漂亮的文档</a>中找到所有选项。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7273" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">重构好玩吗？</h1><p id="a0d5" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">是的，重构应该很有趣！首先，它让开发人员有机会评估他们的代码，改进代码，并从错误中学习。最重要的是，开发人员喜欢从干净的代码基础开始，而不是在混乱的代码基础上开发新功能。</p><p id="ded9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">说到重构工具和插件，你有很多选择。例如，我们没有涵盖VS代码市场中的<a class="ae lu" href="https://marketplace.visualstudio.com/items?itemName=cmstead.jsrefactor" rel="noopener ugc nofollow" target="_blank"> JS重构扩展</a>，因为它只提供基本的重构选项。</p><p id="df03" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想快速获得显著的收益，我们建议使用更漂亮的。这是一个强大的重构工具，它也有助于使用更漂亮的配置文件在您的团队中实施编码风格标准——更不用说VS Code提供了一些有用的重构功能，如查找函数的所有引用或自动修复导入。</p><p id="45a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你正在和一个工程师团队一起工作，并且想要正确地安排重构工作的优先次序，请查看<a class="ae lu" href="http://www.stepsize.com?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=1" rel="noopener ugc nofollow" target="_blank">步长</a>。</p><p id="fbd7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="oh">本文原载于</em> <a class="ae lu" href="https://www.stepsize.com/blog/how-to-refactor-code-in-visual-studio-code" rel="noopener ugc nofollow" target="_blank"> <em class="oh">管理技术债务博客</em> </a> <em class="oh">。</em></p></div></div>    
</body>
</html>