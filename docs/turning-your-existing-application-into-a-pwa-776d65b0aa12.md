# 将您现有的应用程序转变为渐进式网络应用程序

> 原文：<https://betterprogramming.pub/turning-your-existing-application-into-a-pwa-776d65b0aa12>

![](img/c0c738b8cd5f9aa45be36f3bcdd86c40.png)

由[罗迪翁·库察耶夫](https://unsplash.com/@frostroomhead?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

## 让我们深入了解什么是 PWA，如何实现它，以及它的局限性

如果你正在考虑将一个 web 应用程序重构为一个移动应用程序，在重写整个前端代码库之前，你需要评估几件事情。

你也许可以用一个简单得多的解决方案、先进的网络应用程序和服务人员来实现你的目标。

# 什么是 PWA？

渐进式网络应用有许多技术定义，但最简单的说法是，它是一个可以直接从浏览器下载的网站。

它给你建立一个移动应用程序的便利的常规网站的所有好处。

这也意味着它允许您的应用程序发送通知，并在所有支持的设备上以离线模式工作，就像普通应用程序一样[1]。只要你的网站响应迅速，你的应用程序就可以为所有移动用户所用，这些用户代表了今天大多数的在线用户。

# 使用 PWA 的优势

Twitter 和全球速卖通[2]等公司最近向使用 PWAs 过渡了很多。

PWAs 作为手机 app 有自己的优势。应用程序是下载的，但没有安装，所以没有必要提交给任何移动应用程序商店。这使得它们以更快的方式提供给用户，允许客户绕过产品生命周期中的许多瓶颈，例如更新的批准等待[2]。

# 服务人员

所有这一切都是由浏览器的服务人员促成的。它们由浏览器运行与其他服务器通信的脚本组成，很像代理服务器[3]。出于安全原因，服务人员只在 HTTPS 上运行，因为他们有能力拦截网络请求和修改响应。

这些脚本，很像 web workers，允许你的浏览器运行异步的、基于事件的功能，而不中断或阻塞你的应用程序，大量使用承诺，并在一个独立于主线程的线程中运行[3]。这些工人不能直接访问 DOM，所以他们不能使用浏览器的本地存储。因此，服务人员使用缓存 API。高速缓存允许您保存相关文件和数据，并模拟离线模式。

# 设立公共工程局

## 第一步

首先，您需要在您的目录中建立一个`.webmanifest`文件，并在 HTML 中添加一个链接来访问您的 web 清单文件，类似于您对 CSS 样式表所做的，在`head`标记中。

web manifest 是一个 JSON 对象，它将作为浏览器下载应用程序的向导。它应该包含你的应用程序的基本信息，如名称，网址，图标等。

## 第二步

下一步是检查浏览器是否支持服务人员，如果支持，就注册它。

有几种方法可以完成这一步。如果您使用的是普通 JS，您将在加载时添加一个事件监听器来运行检查，然后注册服务工作器。在使用框架的实例中，比如 React，你将在主 HTML 文件中添加一个运行类似逻辑的脚本，在`body`标签之外。

最佳做法是在开发模式下每次重新加载浏览器时更新您的服务人员，因此请确保在浏览器的开发人员工具上进行检查。

## 第三步

最后，您将设置您的服务人员。首先，您将在您的项目目录中创建一个`serviceWorker.js`文件。在这个文件中，您将为您的服务人员添加所有主要功能。为了跟踪服务工作者的生命周期，您需要三个主要的事件侦听器。请记住，您可以随时添加更多内容来配置您的服务人员。

**3.1 —安装**

您的服务人员将收听的第一个事件是`install`，这是它注册后做的第一件事。在这里，您将在浏览器中创建一个缓存，并存储所有静态文件，允许您的应用程序离线运行。

请记住，这里的关键字`self`让您可以访问服务工作器的全局范围以及它可用的方法和对象。

**3.2 —激活**

服务人员将收听的第二个事件是`activate`，它在安装完成后立即被触发。虽然它被激活了，但是应用程序只会在下次重新加载时使用它。

为了确保服务工作者在当前会话中被使用，您必须使用`clients`对象，它允许您访问当前可执行上下文中的方法。通过调用方法`claim`，服务工作者成为该上下文的控制器。

**3.3 —获取**

最后，您将为`fetch`请求添加一个事件监听器，在这里您的服务人员将请求定向到网络或您的缓存，模拟离线模式。

对于这个事件，通过检查从哪里请求信息来分解流量。如果是来自您自己的应用程序的数据，比如您的静态文件，就从您之前创建的缓存中提供它们。在所有其他情况下，它需要来自网络的数据，这时您需要为离线模式添加条件语句。这将使您的服务人员在网络无法响应的情况下从缓存中获取数据。

在所有这些步骤中，通过检查你的浏览器的开发者工具应用程序标签来实现这一点是很重要的，这样你就可以更好地理解他们每个人实际上在做什么。

您将能够看到您的服务人员、缓存存储和清单。完成后，你可以点击开发者工具中应用清单上的“添加到主屏幕”链接，将应用添加到主屏幕。

# **结论**

与任何工程解决方案一样，也有缺点。

PWAs 无法让您充分利用本地移动环境中的所有功能[4]。这意味着它不能提供具有最佳性能和响应能力的用户界面。如果那是你正在寻找的，坚持使用特定于移动环境的框架，比如 React Native。

如果您选择将您的 web 应用程序转变为 PWA，通过简单的设置，您将拥有一个可下载的应用程序，可以在任何平板电脑或智能手机上访问，并为您的所有移动用户提供令人惊叹的新功能。

此设置仅允许您使用离线模式，但请记住，您可以向服务人员添加许多其他配置，以使您的应用程序的用户体验更好，如推送通知和定期后台同步。

# 参考资料和有用的链接:

> [1][https://medium . com/@ deepusnath/4-points-to-keep-in-mind-before-introducing-progressive-web-apps-pwa-to-your-team-8dc 66 BCF 6011](https://medium.com/@deepusnath/4-points-to-keep-in-mind-before-introducing-progressive-web-apps-pwa-to-your-team-8dc66bcf6011)
> 
> [2][https://apiumhub . com/tech-blog-Barcelona/progressive-we b-apps/](https://apiumhub.com/tech-blog-barcelona/progressive-web-apps/)
> 
> [3][https://developers . Google . com/web/fundamentals/primers/service-workers](https://developers.google.com/web/fundamentals/primers/service-workers)
> 
> [https://www.kirupa.com/apps/pwa_vs_react_native.htm](https://www.kirupa.com/apps/pwa_vs_react_native.htm)
> 
> [https://www.youtube.com/watch?v=E8BeSSdIUW4](https://www.youtube.com/watch?v=E8BeSSdIUW4)