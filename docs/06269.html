<html>
<head>
<title>Android ExoPlayer: Play Videos in Your App Like YouTube</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android ExoPlayer:像YouTube一样在你的应用程序中播放视频</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/android-exoplayer-play-videos-in-your-app-like-youtube-486853913397?source=collection_archive---------1-----------------------#2020-09-16">https://betterprogramming.pub/android-exoplayer-play-videos-in-your-app-like-youtube-486853913397?source=collection_archive---------1-----------------------#2020-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a809" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Android中ExoPlayer集成的初学者指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b1a2b5beec283a0a51365c636885c7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5vNkV-9AsQexXb3cq_zPxA.jpeg"/></div></div></figure><h1 id="fe97" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">视频应用的重要性</h1><p id="f413" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">出于娱乐、教育和许多其他目的，对视频播放应用程序的需求一直存在。如果我们看看Youtube过去五到十年的使用情况，你就能清楚地看到这一点。即使在地球上最偏远的地区，移动娱乐也增加了很多。甚至偏远村庄的文盲也在使用视频应用程序进行娱乐。另一方面，由于新冠肺炎引起的疫情，世界上大多数学校都转向了电子学习。出于这些原因，一个好的应用程序可以做很多事情，为满足当前世界的需求而构建。说够了，让我们深入到我们的概念:Exoplayer。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="6735" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">介绍</h1><p id="cabe" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在ExoPlayer之前，Android的MediaPlayer API是在本地和互联网上跨Android设备播放音频和视频的主要解决方案。一开始，使用MediaPlayer播放一个简单的视频很容易，但如果你想建立一个像Youtube这样的播放器，那将需要大量的时间、精力和痛苦。我的原则是不要重新发明轮子，而是使用已经存在的完美解决方案。</p><p id="270e" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">ExoPlayer是运行在Android YouTube应用程序中的视频播放器。它不是Android框架的一部分，而是由谷歌维护的一个开源项目。ExoPlayer是Google提供的一个库，它代表我们处理音频和视频相关的事情，我们可以调用一些方法来玩它。我们还可以对播放器UI(用户界面)进行自定义。</p><p id="3fbc" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated"><em class="mz"> ExoPlayer建立在Android的MediaCodec API之上，该API在Android 4.1(API 16级)中已经出了。所以，如果我们想集成Exoplayer，你的应用程序的最低API版本需要设置为API 16。</em></p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="dd92" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">为什么要用ExoPlayer？</h1><ul class=""><li id="a33b" class="na nb it lo b lp lq ls lt lv nc lz nd md ne mh nf ng nh ni bi translated">ExoPlayer支持DASH(基于HTTP的动态自适应流)、HLS(HTTP直播流)、SmoothStreaming和Common Encryption等功能，<code class="fe nj nk nl nm b">MediaPlayer</code>不支持这些功能。</li><li id="3f90" class="na nb it lo b lp nn ls no lv np lz nq md nr mh nf ng nh ni bi translated">ExoPlayer采用模块化设计，因此易于扩展和定制。</li><li id="5010" class="na nb it lo b lp nn ls no lv np lz nq md nr mh nf ng nh ni bi translated">Android上的主要视频流巨头大多依赖Exoplayer，因为它的功能和灵活性。ExoPlayer是运行在Android YouTube、网飞、亚马逊媒体播放器Prime、HotStar和许多其他流行和强大的应用程序上的视频播放器。</li><li id="1935" class="na nb it lo b lp nn ls no lv np lz nq md nr mh nf ng nh ni bi translated">很好的文档和教程。</li><li id="9eee" class="na nb it lo b lp nn ls no lv np lz nq md nr mh nf ng nh ni bi translated">免费的！</li></ul><p id="25bb" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">说够了，让我们开始编码吧。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="1aad" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">基本Android ExoPlayer应用程序</h1><p id="fb5c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">让我们通过创建一个示例应用程序并检查一步一步的过程来检查集成，以便更好地理解。从你的工作室创建一个新项目，并遵循以下步骤。</p><p id="a569" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">如果您没有足够的时间一步一步来，或者您打算直接深入代码，请查看示例集成的repo链接:</p><div class="ns nt gp gr nu nv"><a href="https://github.com/pavan5208/exoplayer_android_sample.git" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">pavan 5208/exo player _ Android _ sample</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">通过在GitHub上创建帐户，为pavan 5208/exo player _ Android _ sample开发做出贡献。</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj ks nv"/></div></div></a></div><h2 id="5aff" class="ok kv it bd kw ol om dn la on oo dp le lv op oq lg lz or os li md ot ou lk ov bi translated">步骤1:在应用级build.gradle文件中添加ExoPlayer依赖项</h2><pre class="kj kk kl km gt ow nm ox oy aw oz bi"><span id="aeed" class="ok kv it nm b gy pa pb l pc pd">implementation 'com.google.android.exoplayer:exoplayer:2.11.8'</span></pre><p id="8a61" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">这可以是您选择的任何版本——我只是添加了目前可用的最新版本。顺便说一下，我们还可以灵活地只添加我们实际需要的库模块，而不是上面提到的完整包。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="ec02" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">可用的库模块有:</p><ul class=""><li id="5365" class="na nb it lo b lp mu ls mv lv pg lz ph md pi mh nf ng nh ni bi translated"><code class="fe nj nk nl nm b">exoplayer-core</code>:核心功能(必备)。</li><li id="93c0" class="na nb it lo b lp nn ls no lv np lz nq md nr mh nf ng nh ni bi translated"><code class="fe nj nk nl nm b">exoplayer-dash</code>:支持破折号内容。</li><li id="5796" class="na nb it lo b lp nn ls no lv np lz nq md nr mh nf ng nh ni bi translated"><code class="fe nj nk nl nm b">exoplayer-hls</code>:支持HLS内容。</li><li id="1f49" class="na nb it lo b lp nn ls no lv np lz nq md nr mh nf ng nh ni bi translated"><code class="fe nj nk nl nm b">exoplayer-smoothstreaming</code>:支持平滑流式内容。</li><li id="8e44" class="na nb it lo b lp nn ls no lv np lz nq md nr mh nf ng nh ni bi translated"><code class="fe nj nk nl nm b">exoplayer-ui</code>:和ExoPlayer一起使用的UI组件和资源。</li></ul><p id="e419" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">在这个例子中，让我们接着添加一个完整的包，因为添加单个模块有不同的需求，有时会导致错误。</p><p id="e466" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">此外，确保您已经在项目级build.gradle文件的<code class="fe nj nk nl nm b">repositories</code> <strong class="lo iu"> </strong>部分添加了JCenter和Google，尽管它们在新版本中是默认添加的。</p><pre class="kj kk kl km gt ow nm ox oy aw oz bi"><span id="6e5e" class="ok kv it nm b gy pa pb l pc pd">repositories <strong class="nm iu">{<br/>    </strong>google()<br/>    jcenter()<br/><strong class="nm iu">}</strong></span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="f4b1" class="ok kv it bd kw ol om dn la on oo dp le lv op oq lg lz or os li md ot ou lk ov bi translated">步骤2:在应用程序级别启用Java8支持<code class="fe nj nk nl nm b">build.gradle</code></h2><pre class="kj kk kl km gt ow nm ox oy aw oz bi"><span id="b844" class="ok kv it nm b gy pa pb l pc pd">compileOptions <strong class="nm iu">{<br/>    </strong>targetCompatibility JavaVersion.<em class="mz">VERSION_1_8<br/></em><strong class="nm iu">}</strong></span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h2 id="8588" class="ok kv it bd kw ol om dn la on oo dp le lv op oq lg lz or os li md ot ou lk ov bi translated">步骤3:创建一个XML并向其中添加一个ExPlayer视图</h2><p id="0fab" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">为了定制UI看起来像Youtube或其他东西，我们需要添加一些布局，drawables等，我们将在我接下来的文章中看到。这里，让我们给基本的<code class="fe nj nk nl nm b">PlayerView</code>充气:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="edeb" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">步骤4:通过创建一个ExoPlayer实例并分配一个播放源来初始化播放器</h1><p id="5394" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">当我们完成了UI之后，让我们创建ExoPlayer的实例来开始播放媒体。我们可以使用可用的构建器模式来创建实例。在大多数情况下，使用<code class="fe nj nk nl nm b">SimpleExoPlayer</code>将是一种方便的方法——实现<code class="fe nj nk nl nm b">ExoPlayer</code>接口。</p><pre class="kj kk kl km gt ow nm ox oy aw oz bi"><span id="99ec" class="ok kv it nm b gy pa pb l pc pd">val videoPlayer = SimpleExoPlayer.Builder(this).build()</span></pre><p id="92a4" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">由于我们已经创建了ExoPlayer的实例，现在我们需要将它分配给用XML创建的视图:</p><pre class="kj kk kl km gt ow nm ox oy aw oz bi"><span id="3dd9" class="ok kv it nm b gy pa pb l pc pd">video_player_view?.<em class="mz">player </em>= videoPlayer</span></pre><p id="c3da" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">接下来，我们需要构建源来播放。有许多类型的媒体源可供选择，让我们从<code class="fe nj nk nl nm b">ProgressiveMediaSource</code> <strong class="lo iu">开始。</strong>这里我们拿一个URL，通过构建<code class="fe nj nk nl nm b">ProgressiveMediaSource</code> <strong class="lo iu">来玩。</strong></p><p id="9b5d" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">这通常分两步完成。第一步我们创建<code class="fe nj nk nl nm b">DefaultDataSourceFactory</code> <strong class="lo iu"> </strong>的实例，然后将这个实例传递给<code class="fe nj nk nl nm b">ProgressiveMediaSource.Factory</code>，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="363d" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated"><code class="fe nj nk nl nm b">sampleUrl</code>是包含流URL的字符串变量。</p><p id="bb73" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">到目前为止，初始化播放器的方法将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="d6a3" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">步骤5:添加与活动生命周期相关的基本暂停和播放功能</h1><p id="9935" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">当我们完成时，不要忘记释放播放器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="e35d" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">步骤6:向清单文件添加互联网权限并运行应用程序</h1><pre class="kj kk kl km gt ow nm ox oy aw oz bi"><span id="8e9a" class="ok kv it nm b gy pa pb l pc pd">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</span></pre><p id="4093" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">你应该看到下面的视频播放与所有的播放器功能:暂停，播放，倒带，寻找选项等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/ae74294191b6b688b97d451e3ccbbcc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*VmgrHEx6D2bNeXXhss_Fhg.gif"/></div><p class="pk pl gj gh gi pm pn bd b be z dk translated">视频因尺寸较大而被修剪</p></figure><p id="b5f1" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">整个活动看起来会像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="1d4e" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">这款播放器的功能类似于YouTube。当应用程序进入后台时，播放器暂停播放，当用户回来时，它从停止的地方播放。</p><p id="309c" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">但是在现实世界的场景中，我们需要处理更多的事情来获得更好的用户体验，比如玩家的状态处理或者保持seek位置继续。</p><p id="2440" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">下面是GitHub的repo链接，用于本文中使用的示例:</p><div class="ns nt gp gr nu nv"><a href="https://github.com/pavan5208/exoplayer_android_sample.git" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">pavan 5208/exo player _ Android _ sample</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">通过在GitHub上创建帐户，为pavan 5208/exo player _ Android _ sample开发做出贡献。</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj ks nv"/></div></div></a></div></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="a468" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">摘要</h1><p id="b2f7" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">暂时就这些了。我希望你学到了新东西。让我们在我即将发表的文章中检查高级状态处理、实时流处理、类似于Youtube的UI美化等。敬请期待！</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="82e6" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">参考</h1><ul class=""><li id="e6f5" class="na nb it lo b lp lq ls lt lv nc lz nd md ne mh nf ng nh ni bi translated"><a class="ae po" href="https://developer.android.com/guide/topics/media/exoplayer" rel="noopener ugc nofollow" target="_blank"> ExoPlaye </a></li><li id="9da5" class="na nb it lo b lp nn ls no lv np lz nq md nr mh nf ng nh ni bi translated"><a class="ae po" href="https://codelabs.developers.google.com/codelabs/exoplayer-intro/#0" rel="noopener ugc nofollow" target="_blank">使用ExoPlayer进行流媒体播放</a></li></ul></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><p id="b1dc" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">请给我留下你的建议和意见。</p><p id="c562" class="pw-post-body-paragraph lm ln it lo b lp mu ju lr ls mv jx lu lv mw lx ly lz mx mb mc md my mf mg mh im bi translated">感谢阅读。</p></div></div>    
</body>
</html>