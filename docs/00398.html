<html>
<head>
<title>How to Animate Map Markers Using Mapbox and React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Mapbox和React钩子制作地图标记动画</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/animate-map-markers-using-mapbox-react-hooks-2f646a6301e?source=collection_archive---------3-----------------------#2019-05-13">https://betterprogramming.pub/animate-map-markers-using-mapbox-react-hooks-2f646a6301e?source=collection_archive---------3-----------------------#2019-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a290" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">美妙的地图体验改变了应用程序的游戏规则。我们如何在web应用程序中实现这一点？</h2></div><p id="f8ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个人都会注意到一款拥有良好地图体验的应用。我们都见过让这种情况发生的移动应用程序:你在等待拼车，实际上可以看到你的司机越来越近！那么，我们如何在web应用程序上实现这一点呢？</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/1c4b873ebc4f01f40165839b0ba21f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*hO1cfRK9YshkolGh33bbeA.png"/></div></figure><h1 id="01ee" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated"><strong class="ak">地图框</strong></h1><p id="06d8" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">相比谷歌地图，我更喜欢Mapbox，原因有几个，主要是我觉得它性能更好。以下示例将使用<a class="ae mj" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>和第三方NPM模块<code class="fe mk ml mm mn b"><a class="ae mj" href="https://www.npmjs.com/package/react-mapbox-gl" rel="noopener ugc nofollow" target="_blank">react-mapbox-gl</a></code>。您可以使用普通的JS和您选择的视图库来做同样的事情。</p><h1 id="cd7d" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">贴图设置(React-mapbox-gl示例)</h1><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="b0ba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们建立并渲染了地图，我们就可以创建动画标记了。这可以使用一个<a class="ae mj" href="https://docs.mapbox.com/help/tutorials/custom-markers-gl-js/" rel="noopener ugc nofollow" target="_blank">标记</a>，或者像上面例子中的符号。我们还将使用另一个名为<a class="ae mj" href="https://github.com/Turfjs/turf" rel="noopener ugc nofollow" target="_blank"> Turf </a>的包。Turf基本上是lodash的地图功能。非常方便。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="9c43" class="lm ln it bd lo lp mx lr ls lt my lv lw jz mz ka ly kc na kd ma kf nb kg mc md bi translated">反应钩</h1><p id="3560" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated"><a class="ae mj" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> React钩子</a>都是最近炒作的。钩子允许我们利用许多我们习惯于基于类的组件的特性，而没有类的开销。在这个例子中，我们将使用两个不同的钩子，useState和useEffect。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/df8d6c3ce8ee59d201e26ab086a8f3a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X0QwRkXD5R6I50dHrbB4sw.jpeg"/></div></div></figure></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="af38" class="lm ln it bd lo lp mx lr ls lt my lv lw jz mz ka ly kc na kd ma kf nb kg mc md bi translated">组件设置</h1><p id="34ae" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">我们的组件将接受一个prop，它是一个给定时间段内的位置数组。我假设您的应用程序每隔几秒钟就更新一次位置数据。如果你有一个更基于事件的模式，比如web sockets，那就更好了👏。我们要做的第一件事是初始化我们将提供给地图提供商的当前位置。</p><pre class="lf lg lh li gt nh mn ni nj aw nk bi"><span id="f4e7" class="nl ln it mn b gy nm nn l no np"><em class="nq">const </em>[currentLocation, setCurrentLocation] = useState(<em class="nq">null</em>);</span></pre><p id="8de5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们要设置我们的效果，它将遍历我们的位置坐标数组。我们将使用一个名为<code class="fe mk ml mm mn b"><a class="ae mj" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank">requestAnimationFrame</a></code>的web API函数:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="0fd2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将这种效应分解得更细一些。首先，我们希望确保我们的locations prop不为空(<code class="fe mk ml mm mn b">length == 0</code>)。如果是这样，我们想返回，不做任何其他事情。一旦我们知道我们有了坐标，我们将使用Turf来构建我们的<a class="ae mj" href="https://turfjs.org/docs/#lineString" rel="noopener ugc nofollow" target="_blank">更详细的</a>坐标数组。这可以接受一个包含X个项目的数组，并创建一个包含任意多步长的线的数组。很有帮助！然后，我们想定义我们的动画功能。这是我们用数组中的当前位置设置状态的地方。确保我们有一个退路，以防我们想出<code class="fe mk ml mm mn b"><em class="nq">undefined</em></code> <em class="nq">。</em></p><p id="0688" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们的时间步长不大于我们的步数，我们将继续调用<code class="fe mk ml mm mn b">requestAnimationFrame</code> <strong class="kk iu"> </strong>并将其传递给我们的动画函数。一旦我们用完了步骤，动画将停止被调用。在上面的例子中，我们假设大约每30秒就会得到一个新的位置。在animate函数下面是我们取消动画帧并开始一个新帧的调用。当我们的位置发生变化时，就会发生这种情况。有一个很好的方法来防止在每个组件渲染时运行。这是<code class="fe mk ml mm mn b">useState</code>的第二个参数:一组用于观察和比较的道具。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="80db" class="lm ln it bd lo lp mx lr ls lt my lv lw jz mz ka ly kc na kd ma kf nb kg mc md bi translated">提供；给予</h1><p id="612a" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">最后，我们将使用当前位置的状态来呈现我们的标记:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mo mp l"/></div></figure></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="d4f0" class="lm ln it bd lo lp mx lr ls lt my lv lw jz mz ka ly kc na kd ma kf nb kg mc md bi translated">资源</h1><ul class=""><li id="e6c3" class="nr ns it kk b kl me ko mf kr nt kv nu kz nv ld nw nx ny nz bi translated"><a class="ae mj" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank">反应钩</a></li><li id="0b88" class="nr ns it kk b kl oa ko ob kr oc kv od kz oe ld nw nx ny nz bi translated"><a class="ae mj" href="https://www.npmjs.com/package/react-mapbox-gl" rel="noopener ugc nofollow" target="_blank"> react-mapbox-gl </a></li><li id="93a2" class="nr ns it kk b kl oa ko ob kr oc kv od kz oe ld nw nx ny nz bi translated"><a class="ae mj" href="https://github.com/Turfjs/turf" rel="noopener ugc nofollow" target="_blank">地盘</a></li></ul></div></div>    
</body>
</html>