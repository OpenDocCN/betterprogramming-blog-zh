<html>
<head>
<title>How To Fix Angular HttpClient Not Escaping URL Parameters</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何修复Angular HttpClient不转义URL参数</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-fix-angular-httpclient-not-escaping-url-parameters-ddce3f9b8746?source=collection_archive---------2-----------------------#2019-07-23">https://betterprogramming.pub/how-to-fix-angular-httpclient-not-escaping-url-parameters-ddce3f9b8746?source=collection_archive---------2-----------------------#2019-07-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/27f18382048e56cae4074b29515cd98b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-K4bpH1IXEua6hcshfESw.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="0667" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">创建自定义的HttpParameterCodec来编码所有内容</h2></div><p id="84d5" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">Angular <a class="ae lp" href="https://angular.io/api/common/http/HttpClient" rel="noopener ugc nofollow" target="_blank"> Http客户端</a>是在Angular 4.3中引入的，在大多数方面都比旧的Http更好。它自动使用JSON作为内容类型，它支持Http拦截器，并且它比旧的HTTP具有更好的TypeScript支持。</p><p id="48cb" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">最近，我需要向一个HTTP请求添加查询参数。对于这个用例，Angular提供了<code class="fe lq lr ls lt b"><a class="ae lp" href="https://angular.io/api/common/http/HttpParams" rel="noopener ugc nofollow" target="_blank">HttpParams</a></code>类。奇怪的是，我注意到我的查询参数没有按预期编码，这使得API返回错误的结果。</p><p id="3f6a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这种行为可能会令人困惑:<code class="fe lq lr ls lt b"><a class="ae lp" href="https://angular.io/api/common/http/HttpUrlEncodingCodec" rel="noopener ugc nofollow" target="_blank">HttpUrlEncodingCodec</a></code>不编码某些特殊字符，如<em class="lu"> + </em>。这可能符合<a class="ae lp" href="https://tools.ietf.org/html/rfc3986" rel="noopener ugc nofollow" target="_blank"> RFC 3986 </a>。但是，有些情况下您需要对这些字符进行编码。在本文中，我想向您展示如何做到这一点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="41cf" class="mc md je bd me mf mg mh mi mj mk ml mm kk mn kl mo kn mp ko mq kq mr kr ms mt bi translated">如何用Angular编码HttpParams</h1><ol class=""><li id="e101" class="mu mv je kv b kw mw kz mx lc my lg mz lk na lo nb nc nd ne bi translated">创建一个实现<code class="fe lq lr ls lt b"><a class="ae lp" href="https://angular.io/api/common/http/HttpParameterCodec" rel="noopener ugc nofollow" target="_blank">HttpParameterCodec</a></code>的类。或者，您也可以扩展<code class="fe lq lr ls lt b"><a class="ae lp" href="https://angular.io/api/common/http/HttpUrlEncodingCodec" rel="noopener ugc nofollow" target="_blank">HttpUrlEncodingCodec</a></code>。</li><li id="e167" class="mu mv je kv b kw nf kz ng lc nh lg ni lk nj lo nb nc nd ne bi translated"><code class="fe lq lr ls lt b">encodeKey</code>和<code class="fe lq lr ls lt b">encodeValue</code>函数需要对数值进行编码。普通JavaScript允许你使用<code class="fe lq lr ls lt b"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent" rel="noopener ugc nofollow" target="_blank">encodeURIComponent</a></code>。</li><li id="47c6" class="mu mv je kv b kw nf kz ng lc nh lg ni lk nj lo nb nc nd ne bi translated">创建新的<code class="fe lq lr ls lt b">HttpParams</code> : <code class="fe lq lr ls lt b">new HttpParams({ encoder: new CustomHttpParamEncoder() })</code>时使用自定义编码器类。重要的部分是<code class="fe lq lr ls lt b"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent" rel="noopener ugc nofollow" target="_blank">encodeURIComponent</a></code>的用法，这是一个普通的JavaScript函数，用于对字符串进行编码。</li></ol><p id="3dd3" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">以下是自定义解码器的外观:</p><pre class="nk nl nm nn gt no lt np nq aw nr bi"><span id="0ff8" class="ns md je lt b gy nt nu l nv nw">import { HttpParameterCodec } from '@angular/common/http';</span><span id="87d1" class="ns md je lt b gy nx nu l nv nw">export class CustomHttpParamEncoder implements HttpParameterCodec {</span><span id="12a7" class="ns md je lt b gy nx nu l nv nw">  encodeKey(key: string): string {<br/>    return encodeURIComponent(key);<br/>  }</span><span id="9571" class="ns md je lt b gy nx nu l nv nw">  encodeValue(value: string): string {<br/>    return encodeURIComponent(value);<br/>  }</span><span id="1cd3" class="ns md je lt b gy nx nu l nv nw">  decodeKey(key: string): string {<br/>    return decodeURIComponent(key);<br/>  }</span><span id="b33d" class="ns md je lt b gy nx nu l nv nw">  decodeValue(value: string): string {<br/>    return decodeURIComponent(value);<br/>  }</span><span id="5d6b" class="ns md je lt b gy nx nu l nv nw">}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="5409" class="ns md je bd me ny nz dn mi oa ob dp mm lc oc od mo lg oe of mq lk og oh ms oi bi translated">结论</h2><p id="c04c" class="pw-post-body-paragraph kt ku je kv b kw mw kf ky kz mx ki lb lc oj le lf lg ok li lj lk ol lm ln lo im bi translated">感谢阅读这篇文章。虽然Http客户端的行为初看起来令人惊讶，但它符合RFC。幸运的是，很容易改变行为来满足你的需求。如果这篇文章对你有帮助，请在评论中告诉我。</p></div></div>    
</body>
</html>