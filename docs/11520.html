<html>
<head>
<title>Build a Simple To-Do Flutter App Using Hive Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hive数据库构建一个简单的待办事项颤振应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-simple-to-do-app-using-hive-database-2a61331c9e75?source=collection_archive---------2-----------------------#2022-03-28">https://betterprogramming.pub/build-a-simple-to-do-app-using-hive-database-2a61331c9e75?source=collection_archive---------2-----------------------#2022-03-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0126" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Hive是最好的本地存储数据库吗？让我们找出答案。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3c284a6025639dcfb007c77babe798fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XgAJUPgzoL2TrKr2.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://pixabay.com/users/openclipart-vectors-30363/" rel="noopener ugc nofollow" target="_blank">openclipbart-Vectors</a>在<a class="ae ky" href="https://pixabay.com/vectors/bee-beehive-hive-honey-honeycomb-2022492/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄</p></figure><p id="c03d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想在我的应用程序中添加一个本地数据库。所以我开始寻找一个优秀的库来实现我的应用程序。我还遇到过<a class="ae ky" href="https://pub.dev/packages/localstorage" rel="noopener ugc nofollow" target="_blank"> localstorage </a> Flutter库，它使用JSON实现来存储数据。但是不像Hive那么费力。所以我开始在我的应用程序中实现Hive。</p><p id="fc85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始之前，我只是想告诉你，决不，我是一个在颤振方面的专家。我和你们一样在学习颤振。这只是我的一点小小的尝试，让初学者学习Flutter和Hive数据库更容易一点。所以如果你有任何建议，请在评论区写下。</p><h1 id="abf2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">什么是蜂巢？</strong></h1><p id="df10" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Hive是一个用纯Dart编写的轻量级、速度极快的键值数据库，灵感来自于<a class="ae ky" href="https://en.wikipedia.org/wiki/Bitcask" rel="noopener ugc nofollow" target="_blank"> Bitcask </a>。</p><p id="6efd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多信息可以在Hive的官方<a class="ae ky" href="https://docs.hivedb.dev/#/" rel="noopener ugc nofollow" target="_blank">文档</a>上找到。</p><h1 id="b8b9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">为什么是蜂巢？</strong></h1><p id="824e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">它具有以下特点:</p><ul class=""><li id="349d" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">跨平台:移动、桌面、浏览器</li><li id="7cfb" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">高性能(参见<a class="ae ky" href="https://pub.dev/packages/hive#benchmark" rel="noopener ugc nofollow" target="_blank">基准</a>)</li><li id="936a" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">简单、强大、直观的API</li><li id="d35b" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">内置强加密</li><li id="2b26" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">没有本机依赖项</li><li id="f509" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">含电池</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/9b7567f97c1d839cf748e66a610efd77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GdDM7qpmmz1s6927"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自Hive官方<a class="ae ky" href="https://pub.dev/packages/hive" rel="noopener ugc nofollow" target="_blank">文档</a></p></figure><p id="3833" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我爱上了Hive数据库，因为它简单、快速、高效。它也是一个本地存储数据库。因为简单所以学起来超级快。</p><p id="85ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将在这篇博客中回顾下面的步骤，同时构建一个真正的应用程序。</p><ul class=""><li id="ef99" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">在Hive数据库中读取和写入数据的一些有用指令的概述</li><li id="fe7c" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">项目设置</li><li id="504a" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">创建类型适配器</li><li id="bc4c" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">写入和读取数据</li><li id="d35a" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">删除数据</li></ul><p id="994e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们跳到这个例子之前，让我们快速浏览一下Hive提供的一些有用的指令。</p><h1 id="c54c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">先决条件</h1><p id="51ba" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">你应该对Flutter有基本的了解，比如如何创建一个Flutter项目，小部件是什么等等。</p><h1 id="3b1a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">将数据写入数据库</h1><p id="e685" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Hive将所有数据存储在盒子中。更简单地说，hive box就像SQL中没有任何结构的表，它可以包含任何内容。我们可以创建多个盒子来组织数据，也可以存储加密数据来保护敏感数据。在大型app中是有优势的。</p><p id="89b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始往盒子里写东西之前，我们必须打开一个盒子。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="aefc" class="nm lw it ni b gy nn no l np nq">var box = await Hive.openBox&lt;E&gt;(‘boxName’);</span></pre><p id="f8db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<code class="fe nr ns nt ni b">E</code>是可选的类型参数。它提供了框中值的类型。</p><p id="f7ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有一种东西叫<code class="fe nr ns nt ni b">Hive.openLazyBox()</code>。它用于大型数据库，因为它不会将所有数据加载到内存中。但是我们的例子很简单，所以我们将使用一个普通的盒子。但是您可以在hive文档中查看更多关于<a class="ae ky" href="https://docs.hivedb.dev/#/advanced/lazy_box" rel="noopener ugc nofollow" target="_blank">懒惰盒</a>的信息。</p><p id="3da6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有多种方法可以用来将数据写入数据库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="44f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能已经注意到，键必须是String或int。</p><p id="d3d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们将使用<code class="fe nr ns nt ni b">box.add()</code>指令。让Hive处理索引会更容易，我们可以处理输入数据。这使得通过listview构建器迭代所有数据变得更加容易。</p><h1 id="6c92" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">从蜂箱数据库中读取</h1><p id="f466" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">从数据库中读取数据非常简单，如下所示:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="2a09" class="nm lw it ni b gy nn no l np nq">var box = Hive.box('myBox');</span><span id="c928" class="nm lw it ni b gy nw no l np nq">// .get instruction return stored data at given key.</span><span id="be68" class="nm lw it ni b gy nw no l np nq">// return default value incase of key does not exist</span><span id="255d" class="nm lw it ni b gy nw no l np nq">String name = box.get(‘key’, defaultValue: -1);</span><span id="8b2d" class="nm lw it ni b gy nw no l np nq">// use for an existing index</span><span id="77c9" class="nm lw it ni b gy nw no l np nq">String name = box.getAt(int index);</span></pre><p id="0842" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你应该明白我为什么要使用<code class="fe nr ns nt ni b">box.add()</code>指令了，因为它会在每次添加数据时自动创建一个int索引。我们可以通过在<code class="fe nr ns nt ni b">box.getAt()</code>中提供一个特定的索引来直接读取数据。当我们使用这个指令来添加和读取数据时，在示例中会更有意义。</p><h1 id="b4eb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">从配置单元数据库中删除数据</h1><p id="53b9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">删除数据也超级简单。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="72a7" class="nm lw it ni b gy nn no l np nq">var box = Hive.box('myBox');</span><span id="4a04" class="nm lw it ni b gy nw no l np nq">// deletes the given key and data</span><span id="1dde" class="nm lw it ni b gy nw no l np nq">box.delete(‘key’);</span><span id="e127" class="nm lw it ni b gy nw no l np nq">// deletes the nth key and data</span><span id="97c4" class="nm lw it ni b gy nw no l np nq">box.deleteAt(int index);</span></pre><p id="4b1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在示例中，我们将使用<code class="fe nr ns nt ni b">box.deleteAt()</code>通过listview builder更有效地删除数据。</p><p id="2ba4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有更多读取、写入和删除数据的指令。但是为了使这篇博客简短，我只提到了其中的几个。如果您对其他指令感兴趣，那么您可以查看Hive <a class="ae ky" href="https://docs.hivedb.dev/#/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h1 id="a8a9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用Hive数据库的简单待办事项应用程序</h1><p id="d509" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">学习新事物的最好方法是实践。因此，我们将使用Hive数据库构建一个简单或最简单的TODO应用程序。但是你可以随意添加更多的特性。请记住，我的重点更多的是展示如何使用Hive数据库，而不是如何构建TODO应用程序。</p><p id="6417" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使我的解释更易于管理，我还将在代码中写一些描述作为注释。</p><p id="fd7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，没有进一步的原因，让我们进入例子。</p><p id="a02a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我假设你已经了解了一些关于Flutter的知识，比如如何创建一个新的Flutter项目，如何将包添加到项目的<code class="fe nr ns nt ni b">pubspec.yaml</code>文件中，等等。</p><p id="a507" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将以下几行添加到项目的<code class="fe nr ns nt ni b">pubspec.yaml</code>文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="bc85" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">让我们开始编写Todo应用程序</h1><p id="ed0b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在Flutter版本1.20中，如果我们在main函数中运行async函数，那么它将抛出“<em class="nx"> FlutterError(在绑定初始化之前访问了servicesbinding . defaultbinarymenger</em>”。为了避免这个错误，你必须添加<code class="fe nr ns nt ni b">WidgetsFlutterBinding.ensureInitialized()</code>作为主函数的第一行。</p><p id="491e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要初始化Hive，我们需要给出它存储数据的目录的路径。这可以通过下面两行来完成:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="db8b" class="nm lw it ni b gy nn no l np nq"><em class="nx">final</em> applicatonDocumentDir =</span><span id="dafb" class="nm lw it ni b gy nw no l np nq">await path_provider.getApplicationDocumentsDirectory();</span><span id="b250" class="nm lw it ni b gy nw no l np nq">Hive.init(applicatonDocumentDir.path);</span></pre><p id="a651" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们的主要函数看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="d275" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如下所示，除了将标题从“Flutter Demo”更改为“Simple TODO App Using Hive”之外，我没有对预生成类的<code class="fe nr ns nt ni b">MyApp</code>类进行任何重大更改</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="454e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使这个例子简单，我将在一个名为<code class="fe nr ns nt ni b">task_model.dart</code>的不同文件中创建一个介绍性的任务类，它只有一个名为Task的属性。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="6fd7" class="nm lw it ni b gy nn no l np nq">class Task{</span><span id="8655" class="nm lw it ni b gy nw no l np nq">String task;</span><span id="2624" class="nm lw it ni b gy nw no l np nq">Task({this.task});</span><span id="68c3" class="nm lw it ni b gy nw no l np nq">}</span></pre><p id="2b5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置单元仅支持以下数据类型:</p><ul class=""><li id="a4b8" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">（同Internationalorganizations）国际组织</li><li id="74e1" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">线</li><li id="c359" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">目录</li><li id="9427" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">地图</li><li id="7850" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">日期时间</li></ul><p id="1f0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt ni b">Task</code>类只有一个属性，所以我们当然可以将直接任务存储到数据库中，正如我所说的String是一种受支持的数据类型。但是我假设<code class="fe nr ns nt ni b">Task</code>是一个更重要的职业。将来您可能会添加更多的属性。</p><p id="c424" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不能使用<em class="nx"> </em> <code class="fe nr ns nt ni b"><em class="nx">Hive.add(Task(task:’ goto gym’))</em></code>将任务直接存储到数据库中。我们必须为类<code class="fe nr ns nt ni b">Task</code>创建一个<code class="fe nr ns nt ni b">TypeAdapter </code>。还有另一种方法将对象转换成JSON字符串，但是我认为使用<code class="fe nr ns nt ni b">TypeAdapter </code>是更好的方法。</p><p id="ea54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先造一个<code class="fe nr ns nt ni b">TypeAdapter</code>吧。制作<code class="fe nr ns nt ni b">TypeAdapter </code>的最好方法是自动生成<code class="fe nr ns nt ni b">TypeAdapter</code>代码，而不是手工编写。这样，我们可以避免许多打字错误，节省大量时间(这里它只是一个简单的类，但是在复杂的类中，自动生成非常方便)。</p><p id="71f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了自动生成<code class="fe nr ns nt ni b">TypeAdapter</code>，我们需要从<code class="fe nr ns nt ni b">Hive_generator</code>包中获得帮助，我们已经将它添加到了<code class="fe nr ns nt ni b">pubspec.yaml</code>中。现在我们必须向我们的<code class="fe nr ns nt ni b">Task</code>类添加以下代码行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="17a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">唯一要记住的是，我们必须用part关键字编写完全相同的模型文件名称，然后给它添加一个“. g.dart”扩展名。我已经创建了一个名为<code class="fe nr ns nt ni b">task_model.dart</code>的单独文件。因此我在这里写了<code class="fe nr ns nt ni b">task_model.g.dart</code>。</p><p id="e5f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是你在课堂上要做的一切。现在是魔法时间。在项目目录内的终端中运行以下命令:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="59a0" class="nm lw it ni b gy nn no l np nq">flutter packages pub run build_runner build</span></pre><p id="8878" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令将自动生成一个新文件，该文件具有给定的文件名和' part '关键字。在我们的例子中，它被称为<code class="fe nr ns nt ni b">task_model.g.dart</code>，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="0620" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅仅生成<code class="fe nr ns nt ni b">TypeAdapter </code>是不够的，我们还必须在初始化hive后通过将<code class="fe nr ns nt ni b">Hive.registerAdapter(TaskAdapter())</code>添加到主函数中来注册它，我还创建/打开了一个“TODOs”框来添加todo任务。现在，主函数将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="b6dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们设计并创建一个主页。主页将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/b66bcd5acd2edf7b67eacf1360aad470.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/0*vQtO4HWgVSRqkhfs"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="9892" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上图所示，我已经用我的主页的名字创建了一个有状态的小部件，它返回一个支架小部件。在scaffold小部件中，我添加了一个标题为“使用Hive的简单待办事项应用程序”的appbar。在正文中，我添加了一个<code class="fe nr ns nt ni b">ValueListenableBuilder</code>小部件。</p><p id="31a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们只使用use <code class="fe nr ns nt ni b">Listview.Builder</code>，那么每次我们在数据库中添加一个新条目时，我们都必须手动重建UI，这不是一个好主意。这就是我使用<code class="fe nr ns nt ni b">ValueListenableBuilder</code>小部件的原因。</p><p id="2429" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我注意到在其他没有更新的Hive教程中，人们使用了<code class="fe nr ns nt ni b">WatchBoxBuilder</code>小部件。在最新版本的Hive (hive 1.4.3)中已经贬值了。因此，我使用了<code class="fe nr ns nt ni b">ValueListenableBuilder</code>小部件。</p><p id="0bbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我认为使用<code class="fe nr ns nt ni b">ValueListenableBuilder</code>小部件是一个很好的实践。它的性能效率更高，因为它只在更新<code class="fe nr ns nt ni b">valueListenable</code>上的变量时才重建UI。在我们的例子中，每次我们在数据库中添加一个新的待办事项条目。</p><p id="e2c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在<code class="fe nr ns nt ni b">Hive.box&lt;Task&gt;(‘TODOs’).listenable()</code>得到一个错误，那么您可能忘记在您的<code class="fe nr ns nt ni b">myHomePage</code>文件中导入<code class="fe nr ns nt ni b">package:hive_flutter/hive_flutter.dart</code>。代码将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="6ac6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能已经注意到，通过长按<code class="fe nr ns nt ni b">ListTile</code>，我们可以删除todo任务(使用<code class="fe nr ns nt ni b">todos.deleteAt()</code>)，并且我还添加了<code class="fe nr ns nt ni b">FloatingActionButton</code>小部件。它将打开一个简单的对话框来编写待办任务，看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/89568d4fc0738a14e45977be2fbd46dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/0*hM-g_DF14sYEzLsp"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3288" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我有点忘乎所以地设计了这个简单的对话框。<code class="fe nr ns nt ni b">simpleDialog</code>的代码很简单。我添加了一个<code class="fe nr ns nt ni b">SimpleDialog</code>小部件，在<code class="fe nr ns nt ni b">SimpleDialog</code>小部件中，我添加了一个<code class="fe nr ns nt ni b">TextField</code>小部件和两个<code class="fe nr ns nt ni b">FlatButton</code>小部件。</p><p id="e9af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当“添加”按钮被按下时，会调用<code class="fe nr ns nt ni b">_addTodo</code>函数来添加一个新的待办任务。按下“取消”按钮，我们可以回到主屏幕。<code class="fe nr ns nt ni b">_simpleDialog</code>和<code class="fe nr ns nt ni b">_addTodo</code>功能(使用<code class="fe nr ns nt ni b">todosBox.add()</code>将任务添加到“待办事项”框中)的代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="f870" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们编写了大部分的应用程序。所以，现在是清理的时候了:Hive是一个只附加的数据存储。它写在盒子文件的末尾，导致盒子越来越大。为了克服这一点，我们可以手动使用<code class="fe nr ns nt ni b">.compact()</code>方法，或者Hive可以自动处理它。</p><p id="c92e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经覆盖了<code class="fe nr ns nt ni b">dispose</code>方法来关闭Openbox。这里我使用了<code class="fe nr ns nt ni b">todosBox.close()</code>来指定一个特定的盒子。但是我们也可以使用<code class="fe nr ns nt ni b">Hive.close()</code>，它可以在关闭页面之前关闭所有打开的框。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="5469" class="nm lw it ni b gy nn no l np nq">@override<br/>  void dispose() {<br/>    // remove the deleted index holes/slots from database<br/>    // to free up the space<br/>    todosBox.compact();</span><span id="4493" class="nm lw it ni b gy nw no l np nq">    todosBox.close();<br/>    super.dispose();<br/>  }</span></pre><p id="f7d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，现在你添加任何任务，然后重启应用程序。它会自动打开主屏幕上的所有任务。</p><p id="9e58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有代码都可以在这里找到:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="e412" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">准备好迎接挑战了！</h1><ul class=""><li id="6c0e" class="ms mt it lb b lc mn lf mo li oa lm ob lq oc lu mx my mz na bi translated">您可以通过添加复选框按钮来添加更多功能，也可以向应用程序添加主题和装饰。</li><li id="a0d5" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">更进一步，尝试实现一个笔记应用程序。杰·纳伊克在<a class="ae ky" href="https://medium.com/aubergine-solutions/creating-a-note-taking-app-in-flutter-dart-f50852993cd0" rel="noopener">https://medium . com/aubergine-solutions/creating-a-note-taking-app-in-flutter-dart-f 50852993 CD 0</a>上给出了这个例子。他在这里使用了"<a class="ae ky" href="https://pub.dev/packages/sqflite" rel="noopener ugc nofollow" target="_blank"> sqflite </a>"数据库，但是您可以尝试用一个Hive数据库来替换它。</li></ul><h1 id="5d30" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="bff7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Hive是一个优秀的、易于使用的、快速的和高效的数据库。它还有我们已经使用过的自定义<code class="fe nr ns nt ni b">TypeAdapters </code>。我将在我未来的项目中使用Hive。我要特别感谢这个令人惊奇的包的作者西蒙·莱尔。</p><p id="8b4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有任何反馈或者在评论中发现难以理解，请告诉我。毕竟我们都是来学东西的。</p></div></div>    
</body>
</html>