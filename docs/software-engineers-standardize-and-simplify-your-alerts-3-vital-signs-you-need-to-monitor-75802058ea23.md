# 您应该监控的 3 个重要 API 指标

> 原文：<https://betterprogramming.pub/software-engineers-standardize-and-simplify-your-alerts-3-vital-signs-you-need-to-monitor-75802058ea23>

## 标准化并简化您的警报

![](img/655ef847a7cdbe0aacd82af5ba3c6e75.png)

[丹尼尔·勒曼](https://unsplash.com/@dlerman6?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

不应该为每个应用程序重新发明警报。

*   有很多警报会给人一种虚假的安全感。事故未被发现是因为基本知识未被涵盖。
*   更多的警报意味着更多的调整。通常他们没有调整，他们会引起警觉疲劳。
*   标准化的生命体征使与其他工程师的交流更加容易。每个人都可以在不了解您的应用程序的情况下理解它们。

对于每个 API，您需要监控的三个重要特征是:成功率、延迟和 QPS。

# 1.成功率(SR)是您需要监控故障的指标

成功率在各原料药中是可比的，因为它使 QPS 正常化。

警报音量会随着 QPS 的变化而变化。你的成功率应该保持稳定。

记得为您的 API 设定期望并记录 SLA。大多数 API 的 SLA 应该是 3-9(99.9%)或 4-9(99.99%)。你的 API 的上游客户应该知道他们的 SLA 不可能比你的高，除非他们有退路。

衡量成功率的最佳方法是导出成功和失败次数。使用此公式:

```
success_rate = success / (success + failure)
```

相对于`success / qps`，我更喜欢这个公式，因为这个公式永远不可能超过 100%。如果您的监控系统在导出度量的时间戳方面稍有偏差，您很可能会以`success > qps`结束，在这种情况下，您的成功率将超过 100%。

三个高级提示:

1.  来自无效输入的任何错误都不应该算作失败(它们不是应用程序中的错误)
2.  如果缓慢的请求高于您的 SLA，则将其视为错误(您的客户会超时，并认为这是一次失败——您也应该如此)。
3.  用至少 100 个请求来衡量你的成功率。如果您的 API 每秒调用次数不超过 100 次，那么您需要在更长的时间内(1-10 分钟)进行滚动成功率测试。

# 2.延迟:用它来捕捉坏代码、坏主机和坏的下游依赖项

延迟可以总结每台主机的行为以及下游主机的行为。

坏代码会增加所有主机的延迟。坏主机会增加群集中的最大延迟。糟糕的下游依赖关系(如数据库)会导致集群中的一些服务器出现问题。

最好的监控指标是多用途的，可以帮助你避免精神负担过重。

服务的延迟是使用您需要调整的两个聚合来计算的:

1.  如何合计一台服务器的请求延迟
2.  如何汇总集群的每服务器指标(1)

每个服务器将在一段时间内累计请求的延迟。然后，您的监控系统会将这些每台服务器的指标汇总到集群的汇总统计数据中。

我建议每台服务器监控四个统计数据:p50、p90、p99、p999。当您从集群中的所有服务器汇总这些信息时，请考虑您可以容忍多少服务器处于不良状态。例如，如果您有一个 100 台服务器的集群，并且您可以容忍 10 台服务器是坏的，那么使用 p90 来聚合它们。如果你不能有一个人行为不端，使用最大值。

延迟控制面板和警报经常测量服务群中所有主机的所有延迟的平均值或中值(p50)。这些汇总统计数据都不能可靠地捕捉坏主机或下游依赖项。

# 3.每秒查询数(QPS):意外的 QPS 下降和峰值是事件的主要指标。

总是测量你的 QPS。

QPS 是你需要与其他工程师交流的最重要的指标之一。你的用例有多少 QPS？我的应用程序能处理多少？

QPS 的下降和上升通常是由其他系统引起的。但是你需要注意掉线，因为如果你的服务不可用，这可能是你的错。QPS 的增加可能会使您的服务或其依赖项过载。

应用程序需要根据其 QPS 进行不同的构建和扩展。

不要测量每分钟、每小时或每十秒钟的查询量:只测量每秒钟的查询量。QPS 是跨服务进行比较的有用指标。如果您的服务每秒处理的请求不少于 1 个，请将其聚合，然后标准化为秒。

警惕 QPS 的最好方法是将其与历史数据进行比较。在过去，我每天和每周都进行监测，以捕捉事故。

基于 QPS 的标准化将帮助您在跨多个 API 和服务工作时保持理智。