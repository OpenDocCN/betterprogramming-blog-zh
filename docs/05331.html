<html>
<head>
<title>I Wrote a Pipeline to Publish the Best of Reddit to Instagram</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我写了一个管道把Reddit的精华发布到Instagram</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/i-wrote-a-pipeline-to-fetch-posts-from-reddit-and-post-them-to-instagram-d073e55fd258?source=collection_archive---------6-----------------------#2020-06-30">https://betterprogramming.pub/i-wrote-a-pipeline-to-fetch-posts-from-reddit-and-post-them-to-instagram-d073e55fd258?source=collection_archive---------6-----------------------#2020-06-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2dd3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以下是我学到的</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7785d20c5a4ae3b1157e6899dc59bce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*waTVY4uYjm8DRYpz"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">帕特里克·托马索在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="3225" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在Instagram上呆的时间足够长，你会看到发布有趣的Reddit帖子截图的个人资料。如果你仔细想想，这是有道理的:Reddit受到了严格的监管。这可以确保只有高质量的帖子才会出现在你的订阅源上。</p><p id="3669" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再加上Instagram，一个每月拥有超过10亿活跃账户的社交媒体，你就有了成功的秘诀。</p><p id="c38a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果你看到Instagram页面中的一个样本帖子，你会意识到创建这些帖子需要相当大的努力:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/67631c8d9bcc4dd91f39b6f297330ee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCxY7llSZ0RHX9Rw-uDkMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">大量的努力</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/a2184e7de81e1038db1cb5609d6753ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yThusiLbE6Yqtwu9zjqBzg.png"/></div></div></figure><p id="feeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，页面所有者必须搜索Reddit来找到值得发布的帖子。</p><ol class=""><li id="c320" class="lx ly it lb b lc ld lf lg li lz lm ma lq mb lu mc md me mf bi translated">他们会根据相关性来判断Reddit上的帖子，并挑选出值得发布的帖子。</li><li id="a308" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">然后，他们必须将帖子截图并粘贴在黑色背景上，以赋予其Instagram友好的维度。</li><li id="6016" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">他们必须想出一个与帖子相关的标题，以提高参与度。</li><li id="d668" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">他们必须想出标签来提高帖子的可见性。</li><li id="f32e" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">而且，很简单，他们必须记住他们发布的所有帖子——两次发布相同的内容是没有意义的。</li></ol><p id="4ea3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我开始想，“有没有一种方法可以让他们的生活变得更容易……<em class="ml">自动化</em>？”</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="1581" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">第一课:头朝下潜水前做好计划</h1><p id="cf6d" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">我的第一个错误是在脑子里把所有东西分类，然后“编码”</p><p id="8a10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我开始探索Reddit和Instagram提供的API。一天之内，我意识到这不会是一个周末的项目。这些API不足以满足我的想法。例如，Reddit会提供帖子的文本。我不得不自己把文字粘贴到图片上。</p><p id="7f14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我创建了一个文档来跟踪重要的里程碑:</p><ol class=""><li id="97f1" class="lx ly it lb b lc ld lf lg li lz lm ma lq mb lu mc md me mf bi translated">在Reddit上搜索热门帖子。</li><li id="9977" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">从文本中创建一个图像。</li><li id="25ef" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">上传到Instagram。</li><li id="c075" class="lx ly it lb b lc mg lf mh li mi lm mj lq mk lu mc md me mf bi translated">自动化整个事情。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/6bf7952a16c5580a1ffe42c196d3f88e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z-iXj-Q-p858vc205ne8qg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="7ea6" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">第二课:不要过度设计它。最简单的解决办法可能是盯着你的脸</h1><p id="fc44" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">这个计划也让我省去了创建帖子数据库的很多麻烦。</p><p id="5149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我需要保存帖子，这样我就知道哪些帖子已经上传了。想想看:如果我连续两天向Reddit请求“本月十大帖子”，几乎不可能没有任何重叠。因此，我需要将帖子保存到数据库中，并避免在已经获取帖子的情况下追加帖子。</p><p id="84f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最初，我通过本地CSV开始这样做。但是随着项目的进展，我开始想，“嘿，如果我把咖啡洒在我的笔记本电脑上，我的DB就不见了。噗！”</p><p id="769f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了确保数据备份，我不得不使用一个位于互联网上的数据库。我开始探索各种选择。我曾见过我工作单位的人使用Firebase。那会是最好的解决方案吗？或者我应该探索一下我在大学时见过的<a class="ae ky" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>的特点？</p><p id="a401" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我坐下来，和我经验丰富得多的同事普内特一起集思广益，想出一个更强大的东西。经过一个小时的权衡，普内特问道:“提醒我一下，Surya，为什么我们又需要一个<em class="ml">数据库</em>数据库？”</p><p id="1971" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们意识到，我们只需要对数据表进行基本操作:每次有新文章上传时添加一行，上传后更新一行，并查询行以查看哪些尚未上传。我们没有执行复杂的连接。如果互联网备份是我们唯一关心的问题，为什么不简单地使用<em class="ml"> </em> Google Sheets呢？</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="a05d" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">第三课:重构是值得的。我只需要将某些函数调用从CSV改为GSheets</h1><p id="afda" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">本着自动化的精神，我们必须使用GSheets API，而不是任何手工劳动。设置凭证花费了一些努力，但很快它就启动并运行了。然而，API只提供了一些一揽子选项。我在API上写了一个包装器，这样它就可以将GSheets作为一个数据库使用。</p><p id="d0c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用基于在线GSheets的方法取代基于本地CSV的方法时，我感谢过去的自己痴迷地模块化和重构我的代码。我不必为所有可能使用CSV操作的位置而烦恼。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="a5ba" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">第四课(你的Scrum经理不会承认):时间表是不可靠的</h1><p id="d9c3" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">令人惊讶的是，设置整个管道最耗时的部分是从文本中创建图像。</p><p id="f9c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于没有现成的解决方案可用，我不得不修改现有的图像处理库(<a class="ae ky" href="https://pypi.org/project/Pillow/" rel="noopener ugc nofollow" target="_blank"> Pillow </a>)，以适应分割图像和保持每个部分的文本在边界之间居中对齐等功能，以便它在Instagram feed上看起来很好。那花了两个周末的大部分时间。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="322f" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">第五课:选择你的战斗。你不能拘泥于细节</h1><p id="95ae" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">Avishek帮我处理生成的图像的美学部分，他对自己的字体很挑剔。他让我使用一种标准字体调色板上没有的字体。因为我想让这个项目易于复制，所以我必须将这个字体添加到包中。在找到“签入”字体的方法时，我深入研究了图像处理代码，却发现字体是直接从系统字体中选取的(而不是从某个字体文件位置)。</p><p id="d1b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，我可以花些时间看看是否有办法从一个位置选择一种字体。但在那时，我决定在自述文件中添加一条注释，从网站下载字体要简单得多。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="688e" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">结论</h1><p id="5b30" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">现在我们到了:管道已经准备好，代码已经签入。唯一剩下的部分是找出一种方法来自动触发每日上传。Cron是这项工作的合适工具吗？同事Bhavya建议用AWS Lambda。还是一个简单得多的解决方案摆在我们面前？</p><p id="dd94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想看看代码或者复制它，这里有记录良好的<a class="ae ky" href="https://github.com/suryashekharc/insta_reddit" rel="noopener ugc nofollow" target="_blank"> GitHub链接</a>。尽情享受吧！</p></div></div>    
</body>
</html>