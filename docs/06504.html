<html>
<head>
<title>How to Prepare and Publish Your First Python Package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何准备和发布您的第一个Python包</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-prepare-and-publish-your-first-python-package-85de378b77f6?source=collection_archive---------12-----------------------#2020-10-07">https://betterprogramming.pub/how-to-prepare-and-publish-your-first-python-package-85de378b77f6?source=collection_archive---------12-----------------------#2020-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="211d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">老实说，这很简单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a905ba60a8ce6c222ba71e04df6554b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hW-tenG6pecpnN-G"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@photoshobby?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">照片爱好</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="0062" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python已经成为最流行的编程语言之一。一个主要原因是，我们这些Python的普通用户可以自由地分享我们的代码，其他人也可以非常方便地使用它。这种代码共享的一种正式方式是将你的所有代码打包成一个包，并上传到Python包索引(<a class="ae ky" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank">pypi.org</a>)，通过它，其他Python用户可以使用pip工具轻松安装你的包。</p><p id="ee38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你自己发布过Python包，应该知道过程并不难。但是，对于没做过的人来说，你可能会误以为那一定是一个痛苦的过程。在本文中，我将向您展示准备您的包并发布它的步骤。</p><p id="543f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，第一步是完成你的项目。然而，我们都明白，包装从来都不是完美的。因此，您不必等到项目完成后才知道如何发布您的包。</p><p id="aef1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于当前教程的目的，让我们假设包含所有Python文件(例如<code class="fe lv lw lx ly b">python_file_0.py</code>，如下所示)的目录称为<code class="fe lv lw lx ly b">test_package</code>。这就是你想要发表的。为了简单起见，文件<code class="fe lv lw lx ly b">python_file_0.py</code>只有下面的代码，当我们准备在包发布后导入它时会用到它:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="0859" class="md me it ly b gy mf mg l mh mi">def hello_world():<br/>    print(<strong class="ly iu">"Hello World!"</strong>)</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ad8e" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">1.准备文件</h1><p id="e37b" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">在我们深入到发布的细节之前，让我们首先用必要的支持文件来构建目录:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">包文件结构</p></figure><ul class=""><li id="4b26" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">在根目录下，在与<code class="fe lv lw lx ly b"> test_package</code>相同的层次上，创建<code class="fe lv lw lx ly b">README.md</code>文件。该文件将包含您希望用户了解的关于您的软件包的内容，例如安装和使用说明。</li><li id="b838" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">另一个同级的文件是<code class="fe lv lw lx ly b">setup.py</code>文件。该文件将包含设置发布包所需的信息。我们一会儿会讨论这个文件里面有什么。</li><li id="01f6" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">在<code class="fe lv lw lx ly b">test_package</code>目录中，创建<code class="fe lv lw lx ly b">__init__.py</code>文件。这个文件必须这样命名，它的作用是将一个常规目录转换成一个Python包。对于当前的简单包，我们可以将代码放在<code class="fe lv lw lx ly b">python_file_0.py</code>中导出<code class="fe lv lw lx ly b">from test_package.python_file_0 import hello_world</code>。</li></ul><h2 id="e534" class="md me it bd mr oc od dn mv oe of dp mz li og oh nb lm oi oj nd lq ok ol nf om bi translated">自述文件</h2><p id="d06b" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">理论上，你可以对这个文件只使用纯文本，但是我更喜欢使用一个markdown文件，它提供了格式化选项，让你读起来更有趣。为了简单起见，下面显示了一个示例<code class="fe lv lw lx ly b">README.md</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">README.md</p></figure><p id="cb67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，要点保存为TXT文件，在GitHub自动应用markdown文件的格式之前，它向您显示markdown的源文本。</p><p id="0068" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，建议您包含关于软件包的许可信息，以便用户能够了解这些条款。在这种情况下，我们简单地使用MIT许可证。</p><h2 id="1306" class="md me it bd mr oc od dn mv oe of dp mz li og oh nb lm oi oj nd lq ok ol nf om bi translated">安装文件</h2><p id="afa1" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">如前所述，我们使用<code class="fe lv lw lx ly b">setup.py</code>文件来指示我们的包应该如何准备。以下代码向您展示了典型的<code class="fe lv lw lx ly b">setup.py</code>文件的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python包setup.py</p></figure><ul class=""><li id="df45" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">我们首先导入<code class="fe lv lw lx ly b">setuptools</code>模块，它有方便的打包设置方法。</li><li id="17f5" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">在<code class="fe lv lw lx ly b">setup()</code>函数调用中，大多数参数都非常简单明了，应该是不言自明的。以下是一些亮点:</li></ul><p id="6c86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">name</code> : <strong class="lb iu"> </strong>包的分销名称，在pypi.org上必须是唯一的。为了确保唯一性，将您的pypi用户名附加到您的包名中总是一个好主意。</p><p id="f37a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">long_description</code>:长描述通常从<code class="fe lv lw lx ly b">README.md</code>文件设置。为了正确显示描述，通过设置<code class="fe lv lw lx ly b">long_description_content_type</code>参数指定它是一个降价文件。</p><p id="554e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">packages</code>:您要在发行包中发布的包列表。因为我们只发布了一个包(<code class="fe lv lw lx ly b">test_package</code>)，所以它的名字显示在列表中。但是，如果您想发布目录中的所有包，可以使用<code class="fe lv lw lx ly b">setuptools.find_packages()</code>来方便地检索它们。</p><p id="1c09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">python_requires</code>:指定您的包需要的Python版本。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="f5c3" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">2.准备上传</h1><h2 id="ef16" class="md me it bd mr oc od dn mv oe of dp mz li og oh nb lm oi oj nd lq ok ol nf om bi translated">注册PyPI帐户</h2><p id="24b1" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">当我们谈论PyPI时，大多数时候，我们指的是常规网站(<a class="ae ky" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/</a>)，这是索引Python包的地方。然而，网站的另一个测试实例(<a class="ae ky" href="https://test.pypi.org/" rel="noopener ugc nofollow" target="_blank">https://test.pypi.org/</a>)致力于测试目的，而不会搞乱官方索引。</p><p id="46a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，这两个实例上的帐户是独立的。因此，出于测试目的，让我们只使用测试实例。来吧，在这里注册一个账户:<a class="ae ky" href="https://test.pypi.org/account/register/" rel="noopener ugc nofollow" target="_blank">https://test.pypi.org/account/register/</a>。</p><h2 id="5ba7" class="md me it bd mr oc od dn mv oe of dp mz li og oh nb lm oi oj nd lq ok ol nf om bi translated">创建PyPI API令牌</h2><p id="d3e0" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">准备好帐户后，建议您创建一个API令牌来上传包。转到您的帐户设置,“API令牌”部分，然后单击“添加API令牌”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/32154fab5794a91f461441a2245c4f40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvHpRuoVQpA82JufKYgeAQ.png"/></div></div></figure><p id="ec70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">系统会提示您创建一个API令牌。您可以指定应用于所有项目或特定项目的此标记的范围。一旦创建了令牌，将它保存在某个地方以便以后可以检索是很重要的，因为出于安全原因，不能重新创建或恢复完全相同的令牌。</p><h2 id="84f4" class="md me it bd mr oc od dn mv oe of dp mz li og oh nb lm oi oj nd lq ok ol nf om bi translated">安装存档和上传工具</h2><p id="4ce7" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">需要注意的是，有不同的工具用于归档和上传Python包。我们将使用的是<code class="fe lv lw lx ly b">setuptools</code>、<code class="fe lv lw lx ly b">wheel</code>和<code class="fe lv lw lx ly b">twine</code>，它们更常用于Python包分发。</p><p id="61cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的计算机上还没有安装它们，只需运行下面的命令即可安装所有三个软件包及其依赖项:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="71c2" class="md me it ly b gy mf mg l mh mi">python3 -m pip install --user --upgrade setuptools wheel twine</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0487" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">3.分发包</h1><h2 id="4b36" class="md me it bd mr oc od dn mv oe of dp mz li og oh nb lm oi oj nd lq ok ol nf om bi translated">存档包</h2><p id="5f94" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">第一步是通过归档来准备分发包。在终端中，导航到所有包文件(如<code class="fe lv lw lx ly b">setup.py</code>)所在的根目录。运行以下命令:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="cbc1" class="md me it ly b gy mf mg l mh mi">python3 setup.py sdist bdist_wheel</span></pre><p id="b6d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令使用滚轮工具，该工具将使用<code class="fe lv lw lx ly b">setup.py</code>文件中详述的指令创建分发所需的所有文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">存档后的文件结构</p></figure><p id="6ea5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，它将在<code class="fe lv lw lx ly b">dist</code>目录中创建两个文件，如上所示。这些文件是可以上传的关键文件。</p><h2 id="3720" class="md me it bd mr oc od dn mv oe of dp mz li og oh nb lm oi oj nd lq ok ol nf om bi translated">上传包</h2><p id="0e29" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">将包上传到PyPI(同样，我们使用测试实例，但原则与常规实例相同)非常简单。我们将使用之前下载的<code class="fe lv lw lx ly b">twine</code>工具，在终端中运行以下命令:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="46f5" class="md me it ly b gy mf mg l mh mi">python3 -m twine upload --repository testpypi dist/*</span></pre><p id="8a6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本质上，这个命令请求将<code class="fe lv lw lx ly b">dist</code>目录中的文件上传到testpypi存储库进行分发。系统会提示您输入用户名和密码。虽然输入用户名和密码上传到PyPI是可以的，但是如果您简单地使用<code class="fe lv lw lx ly b">__token__</code>作为用户名，使用您之前创建的令牌作为密码，会更安全。</p><p id="8a2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你一切都正确，你应该能够上传你的包没有任何问题。然而，如果有任何错误，它通常会给你关于你的<code class="fe lv lw lx ly b">setup.py</code>文件中可能的错误的明确信息。只要纠正任何可能出现的错误，就可以了。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="bbb9" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">4.测试包</h1><h2 id="dbeb" class="md me it bd mr oc od dn mv oe of dp mz li og oh nb lm oi oj nd lq ok ol nf om bi translated">在PyPI上查看包</h2><p id="5158" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">一旦您的包被上传到testpypi，您就可以转到包的页面，看看所有的内容是否都显示正确(例如包描述)。在我们的情况下，网站应该在你上传后直接提供给你:【https://test.pypi.org/project/test-package-username/0.1.1/】T4。下面的截图向您展示了我们的<code class="fe lv lw lx ly b">README.md</code>中详细描述的详细描述是正确呈现的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/89af463967a655e5f77e4bd3cf6bc1e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nDsjQDlPdK2_L_voss2SRw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">pypi.org上的测试包描述</p></figure><h2 id="64d0" class="md me it bd mr oc od dn mv oe of dp mz li og oh nb lm oi oj nd lq ok ol nf om bi translated">导入包</h2><p id="1c77" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">同一个网页为您提供了安装测试包的命令行。只需复制并粘贴到您的终端:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="a882" class="md me it ly b gy mf mg l mh mi">pip install -i https://test.pypi.org/simple/ test-package-username==0.1.1</span></pre><p id="7df1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装这个软件包应该没有问题。现在是时候测试我们是否可以使用这个包了——在我们将它上传到pypi存储库之后，它被认为是公共的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">测试包导入</p></figure><p id="0331" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所示，我们可以使用刚刚上传到pypi进行分发的第一个包。多么大的成就啊！</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="4f23" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">结论</h1><p id="0a47" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">在本文中，我们学习了创建通过pypi.org发布的Python包的四个主要步骤。虽然所示的示例集中在包索引的测试实例上，但是对于包索引的常规实例来说，一切基本上都是相同的。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ad1f" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">参考</h1><ol class=""><li id="ca71" class="no np it lb b lc nh lf ni li op lm oq lq or lu os nu nv nw bi translated"><a class="ae ky" href="https://pythonhosted.org/an_example_pypi_project/setuptools.html" rel="noopener ugc nofollow" target="_blank">https://python hosted . org/an _ example _ pypi _ project/setup tools . html</a></li><li id="679d" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu os nu nv nw bi translated"><a class="ae ky" href="https://packaging.python.org/tutorials/packaging-projects/" rel="noopener ugc nofollow" target="_blank">https://packaging.python.org/tutorials/packaging-projects/</a></li></ol></div></div>    
</body>
</html>