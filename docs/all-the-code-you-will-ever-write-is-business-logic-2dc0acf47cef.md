# 您将编写的所有代码都是业务逻辑

> 原文：<https://betterprogramming.pub/all-the-code-you-will-ever-write-is-business-logic-2dc0acf47cef>

## 亚马逊首席技术官沃纳·威格尔可能是对的——原因如下

![](img/c08b3b9acc3ab0f0654e04f31dadacdb.png)

来自 [Pexels](https://www.pexels.com/photo/woman-in-black-shirt-with-face-paint-5473952/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) 的 [cottonbro](https://www.pexels.com/@cottonbro?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) 摄影

在 2017 年的 [re:invent 期间，亚马逊的副总裁& CTO 沃纳·威格尔发表了一个大胆的声明:他声称我们未来将编写的所有代码都是商业逻辑。](https://youtu.be/nFKVzEAm-ts?t=6708)

当时，我们许多人都持怀疑态度，但看看当前的发展，特别是在数据工程和分析领域，这句话可能是正确的。

只要你不是一家技术公司，就有可能不再需要维护与具体业务目标没有直接联系的内部开发工具(*由业务逻辑*表示)。

事实上，从长远来看，这甚至可能是有害的。让我们讨论一下这种现象背后的原因和含义。

```
**Table of contents**· [How It Typically Begins](#ca93)
  ∘ [Example Scenario](#1ac2)
· [Reasons For In-House Solutions](#786c)
  ∘ [Lack of Understanding of the Problem Domain](#8317)
  ∘ [The Engineering Ego](#687f)
  ∘ [Failing to Leverage Cloud Resources and Containerized Workloads](#9bc8)
· [Homegrown Solutions Don’t Scale](#527d)
  ∘ [Data Ingestion](#4278)
  ∘ [Workflow Orchestration](#6d91)
  ∘ [Data Transformation](#a21c)
· [When “Make” Still Trumps “Buy”](#efaf)
· [How Will You Build Your Modern Data Stack?](#327f) 
· [Conclusion](#f05f)
```

# 通常是如何开始的

当我们遇到一些业务问题时，几乎任何内部系统都会开始，并且市场上似乎没有工具可以让我们充分地解决它。这意味着下列情况之一为真:

*   即使有些产品存在，它们也不能完全满足我们的需求
*   现有产品不能很好地与我们特定的技术体系集成。

## 示例场景

想象一个用例，工程师试图在关系 OLTP 数据库中存储大量时间序列数据用于分析。

由于这种类型的数据库不是为此目的而设计的(*它会很慢而且昂贵*)，他们序列化并压缩每个数据集，以便它可以作为一个单独的 BLOB 对象存储在关系数据库表中。

他们使用的序列化方法是特定于 Python 的。因此，为了提供一个与编程语言无关的访问层，他们额外创建了一个 REST API，它在请求时反序列化压缩的 BLOBs，并再次序列化这些数据——这次是作为 JSON。

如果我们退后一步，分析上述内部系统试图解决的实际问题，我们会意识到我们真正需要的是:

*   将数据存储为压缩对象(*例如，快速压缩拼花文件*)
*   存储关于每个数据集的附加元数据
*   通过对象名以简单的方式检索它，最好是使用 SQL 或 Python。

如果上述示例中的工程师在构建内部系统之前花更多时间做市场调查，他们会意识到有许多现成的数据存储可以满足这些确切的需求:

*   开源软件 [Trino](https://trino.io/) ( *以前叫做 Presto* )提供了一个快速的 SQL 引擎来查询存储的数据，例如，作为 S3 数据湖中的压缩对象
*   [Dremio](https://www.dremio.com/platform/) 提供了一个完整的 lakehouse 平台，可以高效地从对象存储中查询数据，并将其连接到 BI 工具进行可视化
*   开源的 [awswrangler](https://aws-data-wrangler.readthedocs.io/en/stable/index.html) Python 包可以轻松地将压缩的拼花文件存储到 S3，使用 AWS Glue catalog 附加元数据，并使用 Athena SQL 引擎查询这些数据
*   云数据仓库，如[雪花](https://docs.snowflake.com/en/user-guide/intro-summary-loading.html)、[红移(光谱)](https://docs.aws.amazon.com/redshift/latest/dg/c-getting-started-using-spectrum-create-external-table.html)和 [BigQuery](https://cloud.google.com/bigquery/external-data-cloud-storage) 允许从存储在对象存储中的压缩文件中读取数据
*   …以及更多。

上述所有产品都提供了一个灵活的与编程语言无关的访问层，因此我们不必构建任何序列化或解压缩 API。

不需要担心规模或者选择的序列化方法会在特定包升级时停止工作。托管解决方案降低了运营中断的风险。

简而言之，我们可以选择一个可用的选项，并开始实现可以提供真正价值的业务逻辑，而不是花费时间维护内部开发的数据存储系统。

# 内部解决方案的理由

## 缺乏对问题领域的理解

如上面的场景所示，实现多余的内部系统最可能的原因是没有充分考虑需要解决的问题，并且没有正确评估市场上现有的工具。

示例中的工程师似乎过早地决定使用 OLTP 数据库并将数据集存储为 BLOBs:

*   理解他们需要支持什么样的访问模式——在这种情况下，如果目标是为这些数据提供一个与编程语言无关的接口，那么选择一个特定于 Python 的序列化方法似乎是一个次优的决定。
*   理解这些数据的预期用途**——用例被描述为分析性的，而不是事务性的；因此，OLTP 数据库首先似乎不是一个好的选择。**
*   **了解需要存储在那里的数据的类型和数量—我们提到过，在这个场景中，目标是存储大量的时间序列数据。从历史上看，OLTP 数据存储作为这种类型数据的存储机制被证明是非常低效的(*有一些明显的例外，如 TimescaleDB 和 CrateDB* )。一个简单的谷歌搜索时间序列数据的数据库解决方案将提供更多关于其他人过去如何处理这个问题的信息。**

**有时这也取决于人们如何表达他们的问题和要求。假设问题以一种已经暗示了特定解决方案的方式被指定。在这种情况下，我们可能无法识别更普遍的模式，并错误地认为我们的问题是我们的业务、公司或战略所特有的。因此，我们可能会错误地认为，本土系统是唯一的选择。**

## **工程自我**

**多余的内部工具的另一个原因是软件工程自负。有时候工程师想向别人证明他们自己能造出任何东西。**

**但是他们忘了，任何自建的系统都是需要长期维护的。它不仅要在现在工作，而且在未来当我们周围的世界发生变化时，依赖包(*或*)会得到升级或重新设计。**

**同样的自负经常阻止高级工程师寻求反馈。在建立内部解决方案之前，向几个人寻求建议是一个很好的做法(*理想情况下，还有外部顾问*)。**

**如果我们没有意识到实际问题，或者市场上已经存在解决方案，其他人可以帮助我们找到盲点，并为我们指出正确的方向。**

## **未能利用云资源和容器化的工作负载**

**亚马逊的 CTO 说的片头语是什么意思？我们构建应用程序和数据工作负载通常需要的大多数构造块已经存在。**

**如果不是由云供应商和开源平台提供，那么由围绕这些平台构建的第三方技术提供，作为它们和(*通常是遗留*)本地系统之间的粘合剂。**

**工程师需要定义所需的业务逻辑，然后使用存储、计算、网络、监控和安全服务进行部署。**

**这意味着，诸如扩展数据库和服务器、构建定制存储或执行系统以及任何类似的无差别的繁重工作不应该是他们所关心的问题。**

**特别是，容器化的工作负载和编排平台使只编写核心业务逻辑的未来成为现实。**

# **自行开发的解决方案无法扩展**

**到目前为止，我们认为定制内部解决方案越来越成为技术债务的主题，而不是提供竞争优势的东西。为了验证这一假设，让我们看看数据分析领域的工具。**

## **数据摄取**

**从历史上看，每个建立数据仓库的公司都会开发自己的 ETL 过程，从 ERP、CRM、PIM 等操作系统中提取数据。**

**随着时间的推移，工程师们意识到，如果每个公司都构建自己版本的相同样板代码来将数据从 A 复制到 b，这是非常多余的。最终，将来自 Salesforce 等源系统的数据同步到 Redshift、Snowflake 或任何其他数据仓库并没有什么不同。一些公司( *a.o. Stitch、Fivetran、Airbyte* )意识到了让事情变得更好的潜力。**

**他们开始构建一组更灵活的连接器，使我们能够智能地将源系统与我们选择的数据仓库同步，从而自动化接收，并允许我们跳过将数据从 A 移动到 B 的样板代码，只专注于使用 ELT 范式编写业务逻辑。**

## **工作流程编排**

**工作流程编排系统也有类似的情况。过去，几乎每个数据驱动型公司都有自己的定制工具来管理数据管道中的依赖关系，将它们部署到特定的计算集群，并安排它们的执行。**

**随着时间的推移，添加了越来越多的功能后，工程师通常会开始意识到维护一个自主开发的平台并使其足够灵活以支持所有与数据相关的问题是多么具有挑战性。**

**如今，由于有了[perfect](https://www.prefect.io/)这样的工具，我们可以专注于构建业务逻辑，即解决我们业务所需的实际数据科学和分析问题，而不是维护底层系统。**

**该平台负责跟踪数据和状态依赖关系，跨各种代理按需和按计划执行流程，提供对系统健康状况的高粒度可见性，并与分布式 Dask 集群通信以快速执行，无论数据大小如何。**

## **数据转换**

**到目前为止，我们已经讨论了数据接收和工作流编排。但是还有更多的领域从标题中不断证实假设。**

**以数据仓库的数据转换为例。在过去，数据工程师一直在执行同样单调乏味的任务:编写 DDL 来创建表，手工创建增量负载的合并查询，构建缓慢变化的维度脚本，以及确定以何种顺序触发所有那些相互依赖的 ETL 作业。**

**然后， [dbt](https://www.getdbt.com/) 完全改变了我们处理这个问题的方式。它将这些繁琐的任务自动化到了数据分析师和领域知识专家可以进行大规模数据库内转换的程度。**

**它创造了分析工程师的新角色，他们最终可以专注于用 SQL 编写业务逻辑，并使用 dbt 部署它。同样，剩下要做的就是编写业务逻辑，而不是维护不会增加任何实际业务价值的自制工具和样板代码。**

# **当“制造”仍然胜过“购买”**

**阅读所有这些论点，你可以开始认为所有内部系统本质上都是“坏的”，我们应该总是使用现成的工具和完全托管的解决方案。然而，在某些情况下,“制造”比“购买”更有优势**

**首先，如果**市场上没有可行的选项**能够解决你的问题，那么你别无选择，只能自己动手。**

**但是，在“制造或购买”的困境中，制造的最重要的论点是当你实施与你的业务核心竞争力**——使你区别于竞争对手的产品或服务——相关的东西时。****

****想象一下，你领导着一家数据科学初创公司，它自动生成长文章的摘要(*比如这篇*)。****

****你的核心能力是你的自然语言处理引擎，可以生成高质量的摘要。在内部，您可以使用我们到目前为止提到的所有工具，例如，使用 Snowflake 来存储数据，使用 Fivetran 来同步来自源系统的数据，使用 Prefect 来编排您的数据科学流，使用 dbt 来进行仓库内转换。****

****但是当涉及到生成摘要的 NLP 算法时，你很可能不想外包它(*例如，通过使用 AWS 或 GCP* 的一些现成的 NLP 算法)，因为这是你的核心产品。****

****任何构成企业重要组成部分或提供竞争优势的东西都是定制内部解决方案的回报所在。****

# ****您将如何构建您的现代数据堆栈？****

****其中一个经常被认为为时已晚的主题是如何可视化数据、构建 KPI 和指标，以及将分析嵌入到现有的前端应用程序中。****

****[云原生 GoodData BI 平台](https://www.gooddata.com/developers/cloud-native/)可以帮助您做到这一点，以便您可以专注于自己的业务逻辑。您可以通过启动一个 Docker 容器来开始试验平台的[社区版](https://www.gooddata.com/developers/cloud-native-community-edition/):****

```
**docker run --name gooddata -p 3000:3000 -p 5432:5432 -e LICENSE_AND_PRIVACY_POLICY_ACCEPTED=YES gooddata/gooddata-cn-ce:latest**
```

****然后可以在浏览器中使用[**http://localhost:3000/**](http://localhost:3000/)查看 UI，使用`demo@example.com`邮箱和`demo123`密码登录。之后，您可以直接从浏览器开始构建洞察力、KPI 和仪表板。****

****借助该平台，您可以创建语义模型和指标的共享定义，作为公司和所有消费者的单一真实来源，无论是 BI 工具、ML 模型还是面向客户的应用程序。****

****智能缓存、几乎任何数据仓库的连接器和单点登录等附加功能强调了这样一个事实，即您只需构建自己的业务逻辑，平台将在其他所有方面为您提供支持。****

****GoodData 还写了一篇文章讨论何时构建或购买分析工具的相同主题。****

# ****结论****

****本文讨论了一个假设，即我们将来编写的所有代码都将是业务逻辑。****

****我们研究了一个导致开发次优的自制存储系统的示例情况，并调查了这种情况的潜在原因。****

****然后，我们讨论了为什么自主开发的解决方案无法扩展，以及在什么情况下构建定制的内部系统仍然有意义。****

****感谢您的阅读！****