<html>
<head>
<title>How to Use the React Hook useDeepEffect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React挂钩useDeepEffect</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-the-react-hook-usedeepeffect-815818c0ad9d?source=collection_archive---------7-----------------------#2020-02-17">https://betterprogramming.pub/how-to-use-the-react-hook-usedeepeffect-815818c0ad9d?source=collection_archive---------7-----------------------#2020-02-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="25e4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">自定义React挂钩，用于对useEffect挂钩的依赖项执行浅层相等检查</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ce35fe32d527781ef9015c7fe4be9ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WyWdy_rdjQtT3Fh8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@timswaanphotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Tim Swaan </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b6da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在使用React钩子时，一个非常常见的情况是，我们需要增强它们的基本功能，以适应组件行为强加的需求，即使本机钩子实现非常有用，并且涵盖了我们需要的大部分内容。React提供的挂钩可以组合起来创建自定义挂钩，以支持复杂的情况。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c29b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">问题是</h1><p id="6389" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设我们有一个组件，它接收一个对象作为道具，我们想在每次这个对象的一个属性改变时运行一个效果。我们可以编写一些基本代码来获得更好的想法:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/fd253938ad5d315c7005e4637bbdd992.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_O0shMbr8Z-NZ1X11vH8iw.png"/></div></div></figure><p id="667d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，我们将一些数据传递给一个对象，并将一个计数值传递给子组件，它应该只在值<code class="fe na nb nc nd b">firstName</code>或<code class="fe na nb nc nd b">lastName</code>之一改变时运行效果，对吗？没有。</p><p id="a13e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">useEffect</code>钩子不对对象进行简单的比较，但是它检查它的引用是否改变。</p><p id="9c94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们更好地看看上面的代码，您会看到<code class="fe na nb nc nd b">Parent</code> <strong class="lb iu"> <em class="ne"> </em> </strong>在传递props时总是创建一个新的对象，所以每当count变量发生变化并且子组件被重新渲染时，即使数据属性<strong class="lb iu"> <em class="ne">的值没有发生真正的变化，效果也会运行。</em> </strong></p><p id="7764" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要一种方法，只在对象内容发生变化的情况下运行效果——检查对象属性。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="848c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">解决方案</h1><p id="5f9b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">根据需求，我们需要一个特殊的钩子来检查是否有任何传递的依赖项改变了它的内容。我们可以编写<code class="fe na nb nc nd b">useDeepEffect</code>钩子，然后我将评论它的实现。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/4ecf01dea7f25e97921ca2ea4c9fb384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IhuSRKDQjI22ICv0OlhYRA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe na nb nc nd b">useDeepEffect</code>挂钩实现</p></figure><p id="7408" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现这个定制钩子，我们使用了Lodash函数<code class="fe na nb nc nd b">isEqual</code> <strong class="lb iu"> <em class="ne">，</em> </strong>，这将帮助我们深入比较两个传递的元素是否属于object类型。让我们回顾一下它是如何工作的:</p><ol class=""><li id="9e27" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">使用<code class="fe na nb nc nd b">useRef</code>钩子声明一个<code class="fe na nb nc nd b">isFirst</code>引用来跟踪效果的状态。我们稍后需要检查它是否是第一次运行。我们对<code class="fe na nb nc nd b">prevDeps</code> ref做了同样的处理，总是有一个对钩子应该检查的先前依赖项的引用。</li><li id="2f0d" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">使用<code class="fe na nb nc nd b">Array.propotype.every</code> <strong class="lb iu"> </strong>方法，遍历当前的依赖关系数组，并将它们中的每一个与之前的值进行比较。将结果存储在一个变量中，以确定是否有任何更改。</li><li id="412f" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">是时候决定是否应该运行效果函数了。它应该只在第一次运行或者<code class="fe na nb nc nd b">isSame</code> <strong class="lb iu"> </strong>变量为<code class="fe na nb nc nd b">false</code>时运行，这意味着先前的依赖关系发生了变化。</li><li id="a401" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">最后，我们应该确保这不是钩子第一次运行。我们还必须更新<code class="fe na nb nc nd b">prevDeps</code> <strong class="lb iu"> </strong>引用，使用我们刚刚用于比较的最后一个依赖项。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4f9f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">包扎</h1><p id="986a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在你可以用我们刚刚宣布的新<code class="fe na nb nc nd b">useDeepEffect</code>替换普通的<code class="fe na nb nc nd b">useEffect</code>。这种钩子用在很多场合。上面解释的是一个简单的例子，但它有助于理解它的用法。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="6f0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于这个话题的评论、分享和讨论总是很受欢迎，我很乐意回答你的任何问题！</p><p id="8479" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ne">感谢阅读！</em></p></div></div>    
</body>
</html>