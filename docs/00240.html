<html>
<head>
<title>How To Build Blazing Fast REST APIs With Node.js, MongoDB, Fastify, and Swagger</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js、MongoDB、Fastify和Swagger构建超快的REST APIs</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-blazing-fast-rest-apis-with-node-js-mongodb-fastify-and-swagger-114e062db0c9?source=collection_archive---------0-----------------------#2018-12-05">https://betterprogramming.pub/how-to-build-blazing-fast-rest-apis-with-node-js-mongodb-fastify-and-swagger-114e062db0c9?source=collection_archive---------0-----------------------#2018-12-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4206" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">循序渐进的教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e4c1b2592cbda44f9bc8eca9105f194d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8yGyadpWiDJtyXGVtNO-Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:<a class="ae ky" href="https://www.freepik.com/free-vector/hand-with-a-pencil-with-lightning-shape_901992.htm" rel="noopener ugc nofollow" target="_blank">由Dooder </a>设计</p></figure><p id="455e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想必没有一个web开发人员对REST APIs和设计一个有效的API解决方案所带来的挑战是陌生的。</p><p id="e799" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些挑战包括:</p><ul class=""><li id="e575" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">速度。(API响应时间。)</li><li id="e0d2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">文档。(清晰简洁的文档，描述API。)</li><li id="c8f8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">建筑和可持续性。(可维护和可扩展的代码库。)</li></ul><p id="1e05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将使用Node.js、<a class="ae ky" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank">、MongoDB </a>、<a class="ae ky" href="https://www.fastify.io/" rel="noopener ugc nofollow" target="_blank"> Fastify </a>和<a class="ae ky" href="https://swagger.io/" rel="noopener ugc nofollow" target="_blank"> Swagger </a>的组合来解决上述所有问题。</p><p id="0eb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该项目的源代码可以在<a class="ae ky" href="https://github.com/siegfriedgrimbeek/fastify-api" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="fcba" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">在开始之前</h1><p id="b8ef" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">你应该有初级到中级的JavaScript知识，听说过Node.js和MongoDB，知道什么是REST APIs。</p><p id="2a8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是让您了解最新情况的一些链接:</p><ul class=""><li id="f2f7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://developer.mozilla.org/bm/docs/Web/JavaScript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a></li><li id="0ed9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://codeburst.io/the-only-nodejs-introduction-youll-ever-need-d969a47ef219" rel="noopener" target="_blank"> Node.js </a></li><li id="fb25" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://docs.mongodb.com/manual/introduction/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a></li><li id="f61e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://restful.io/an-introduction-to-api-s-cee90581ca1b" rel="noopener ugc nofollow" target="_blank">REST API</a></li></ul><h2 id="50a9" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated">我们将使用的技术</h2><ul class=""><li id="837b" class="lv lw it lb b lc nk lf nl li ob lm oc lq od lu ma mb mc md bi translated"><a class="ae ky" href="https://www.fastify.io/" rel="noopener ugc nofollow" target="_blank">加速</a></li><li id="cd74" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mongoosejs.com/" rel="noopener ugc nofollow" target="_blank">猫鼬</a></li><li id="26e8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://swagger.io/" rel="noopener ugc nofollow" target="_blank">大摇大摆</a></li></ul><p id="6e61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最好在新标签页中打开以上页面，以便于参考。</p><h2 id="a169" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated">您需要安装以下软件</h2><ul class=""><li id="f390" class="lv lw it lb b lc nk lf nl li ob lm oc lq od lu ma mb mc md bi translated"><a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">Node.js/npm</a></li><li id="411d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://docs.mongodb.com/manual/installation/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a></li><li id="50c4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a></li></ul><p id="9750" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你还需要一个<a class="ae ky" href="https://ourcodeworld.com/articles/read/200/top-7-best-free-web-development-ide-for-javascript-html-and-css" rel="noopener ugc nofollow" target="_blank"> IDE </a>和一个终端<strong class="lb iu"> </strong>我用的是Mac的<a class="ae ky" href="https://www.iterm2.com/" rel="noopener ugc nofollow" target="_blank"> iTerm2 </a>和Windows的<a class="ae ky" href="https://hyper.is/" rel="noopener ugc nofollow" target="_blank"> Hyper </a>。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="1988" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">我们开始吧</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/7ac00ae084e41c6b7febc6566bd2bf5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jw9V__6jYhm2amP74D_0lw.png"/></div></div></figure><p id="f22b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过打开终端并执行以下代码行来初始化一个新项目:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="0c5c" class="np mt it og b gy ok ol l om on">mkdir fastify-api<br/>cd fastify-api<br/>mkdir src<br/>cd src<br/>touch index.js<br/>npm init</span></pre><p id="09a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们创建了两个新目录，导航到它们，创建了一个<code class="fe oo op oq og b">index.js</code>文件，并通过<a class="ae ky" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>启动了我们的项目。</p><p id="53a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">初始化新项目时，系统会提示您输入几个值，您可以将这些值留空，稍后进行更新。</p><p id="1ea4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦完成，就会在<code class="fe oo op oq og b">src</code>目录中生成一个<code class="fe oo op oq og b"><a class="ae ky" href="https://alligator.io/nodejs/package-json/" rel="noopener ugc nofollow" target="_blank">package.json</a></code>文件。在此文件中，您可以更改项目初始化时输入的值。</p><p id="aac5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们安装我们将需要的所有依赖项:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="d11e" class="np mt it og b gy ok ol l om on">npm i nodemon mongoose fastify fastify-swagger boom</span></pre><p id="c462" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是对每个软件包功能的简要描述，引自它们各自的网站:</p><h2 id="daad" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated"><strong class="ak">节点门</strong></h2><blockquote class="or os ot"><p id="83d9" class="kz la ou lb b lc ld ju le lf lg jx lh ov lj lk ll ow ln lo lp ox lr ls lt lu im bi translated">nodemon是一个工具，通过在检测到目录中的文件更改时自动重新启动节点应用程序，来帮助开发基于Node.js的应用程序。</p><p id="d43e" class="kz la ou lb b lc ld ju le lf lg jx lh ov lj lk ll ow ln lo lp ox lr ls lt lu im bi translated">nodemon不需要<em class="it">对你的代码或者开发方法做任何</em>额外的修改。nodemon是<code class="fe oo op oq og b">node</code>的替换包装器，在执行脚本时使用<code class="fe oo op oq og b">nodemon</code>替换命令行上的单词<code class="fe oo op oq og b">node</code>。</p></blockquote><p id="4578" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了设置<a class="ae ky" href="https://github.com/remy/nodemon" rel="noopener ugc nofollow" target="_blank"> nodemon </a>，我们需要将下面一行代码添加到脚本对象中的<code class="fe oo op oq og b">package.json</code>文件中:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="3780" class="np mt it og b gy ok ol l om on">“start”: “./node_modules/nodemon/bin/nodemon.js ./src/index.js”,</span></pre><p id="fcc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的<code class="fe oo op oq og b">package.json</code>文件现在应该如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">package.json</p></figure><h2 id="9f93" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated"><strong class="ak">猫鼬</strong></h2><blockquote class="or os ot"><p id="8317" class="kz la ou lb b lc ld ju le lf lg jx lh ov lj lk ll ow ln lo lp ox lr ls lt lu im bi translated">mongose提供了一个直接的、基于模式的解决方案来为你的应用数据建模。它包括内置的类型转换、验证、查询构建、业务逻辑挂钩等等。</p></blockquote><h2 id="ba83" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated">固定化</h2><blockquote class="or os ot"><p id="feef" class="kz la ou lb b lc ld ju le lf lg jx lh ov lj lk ll ow ln lo lp ox lr ls lt lu im bi translated">Fastify 是一个高度专注于以最少的开销和强大的插件架构提供最佳开发体验的web框架。它的灵感来自哈比神和Express，据我们所知，它是目前最快的web框架之一。</p></blockquote><h2 id="9e70" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated"><strong class="ak"> fastify-swagger </strong></h2><blockquote class="or os ot"><p id="8a6d" class="kz la ou lb b lc ld ju le lf lg jx lh ov lj lk ll ow ln lo lp ox lr ls lt lu im bi translated">用于Fastify的<a class="ae ky" href="https://swagger.io/" rel="noopener ugc nofollow" target="_blank"> Swagger </a>文档<a class="ae ky" href="https://github.com/fastify/fastify-swagger" rel="noopener ugc nofollow" target="_blank">生成器</a>。它使用您在路由中声明的模式来生成swagger兼容文档。</p></blockquote><h2 id="3b1c" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated"><strong class="ak">吊杆</strong></h2><blockquote class="or os ot"><p id="cdd9" class="kz la ou lb b lc ld ju le lf lg jx lh ov lj lk ll ow ln lo lp ox lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/hapijs/boom" rel="noopener ugc nofollow" target="_blank"> boom </a>提供了一套返回HTTP错误的实用程序。</p></blockquote></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="b3ef" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">设置服务器并创建第一条路由</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/9108ec1a079f4cf55245e4a46f5f0b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rocnESJrNWsRGXMygLfDCQ.png"/></div></div></figure><p id="edae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将以下代码添加到您的<code class="fe oo op oq og b">index.js</code>文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">索引. js</p></figure><p id="43a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要Fastify框架，声明我们的第一个路由，并在<code class="fe oo op oq og b">port 3000</code>上初始化服务器，代码很简单，但请注意初始化Fastify时传递的options对象:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="9a16" class="np mt it og b gy ok ol l om on">// Require the fastify framework and instantiate it<br/>const fastify = require('fastify')({<br/>  logger: true<br/>})</span></pre><p id="48a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码启用了Fastify的内置记录器，默认情况下是禁用的。</p><p id="a85b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以在终端的<code class="fe oo op oq og b">src</code>目录中运行以下代码:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="17f7" class="np mt it og b gy ok ol l om on">npm start</span></pre><p id="452c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当您导航到<a class="ae ky" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>时，您应该看到返回的<code class="fe oo op oq og b">{hello:world}</code>对象。</p><p id="50c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将回到<code class="fe oo op oq og b">index.js</code>文件，但现在，让我们继续设置我们的数据库。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="a081" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">启动MongoDB并创建模型</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/4bb5c5229fedd53d888abb0d6420cdfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ce0gUe0LbnhL7ebnDGTp5w.png"/></div></div></figure><p id="2610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功安装MongoDB后，您可以通过运行以下命令打开一个新的终端窗口并启动一个MongoDB实例:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="da2b" class="np mt it og b gy ok ol l om on">mongod</span></pre><p id="d869" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用MongoDB，我们不需要创建数据库。我们只需在设置中指定一个名称，一旦我们存储了数据，MongoDB就会为我们创建这个数据库。</p><p id="9e2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将以下内容添加到您的<code class="fe oo op oq og b">index.js</code>文件中:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="f14a" class="np mt it og b gy ok ol l om on">...</span><span id="e4df" class="np mt it og b gy pb ol l om on">// Require external modules<br/>const mongoose = require('mongoose')</span><span id="0b50" class="np mt it og b gy pb ol l om on">// Connect to DB<br/>mongoose.connect(‘mongodb://localhost/mycargarage’)<br/> .then(() =&gt; console.log(‘MongoDB connected…’))<br/> .catch(err =&gt; console.log(err))</span><span id="e97a" class="np mt it og b gy pb ol l om on">...</span></pre><p id="5b1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们需要Mongoose并连接到我们的MongoDB数据库。数据库名为<code class="fe oo op oq og b">mycargarage</code>，如果一切顺利，您将在终端上看到<code class="fe oo op oq og b">MongoDB connected...</code>。</p><p id="8b87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，由于我们之前添加的<code class="fe oo op oq og b">Nodemon</code>包<em class="ou">，您不必重启应用程序。</em></p><p id="c6d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们的数据库已经建立并运行了，我们可以创建我们的第一个模型了。在<code class="fe oo op oq og b">src</code>目录下创建一个名为<code class="fe oo op oq og b">models</code>的新文件夹，在其中创建一个名为<code class="fe oo op oq og b">Car.js</code>的新文件，并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy mk l"/></div></figure><p id="219c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码声明了我们的<code class="fe oo op oq og b">carSchema</code>，它包含了与我们的汽车相关的所有信息。除了两个明显的数据类型:<code class="fe oo op oq og b">String</code>和<code class="fe oo op oq og b">Number</code>。</p><p id="0fa4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还使用了一个对猫鼬来说相对较新的<code class="fe oo op oq og b">Map</code>，你可以在这里阅读更多关于它的内容。然后，我们导出我们的<code class="fe oo op oq og b">carSchema</code>以在我们的应用程序中使用。</p><p id="667c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以继续在<code class="fe oo op oq og b">index.js</code>文件中设置我们的路线、控制器和配置，但是本教程的一部分是演示一个可持续的代码库。因此，每个组件都有自己的文件夹。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="b7b9" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">创建汽车控制器</h1><p id="6b4d" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">为了开始创建控制器，我们在<code class="fe oo op oq og b">src</code>目录中创建一个名为<code class="fe oo op oq og b">controllers</code>的文件夹，并在该文件夹中创建一个<code class="fe oo op oq og b">carController.js</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">汽车控制器. js</p></figure><p id="8ceb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上内容可能看起来有点难以理解，但实际上非常简单。</p><ul class=""><li id="a505" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我们需要<em class="ou"> boom </em>来处理我们的错误:<code class="fe oo op oq og b">boom.boomify(err)</code>。</li><li id="2a76" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们导出将在我们的路由中使用的每个函数。</li><li id="85a7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">每个函数都是一个<code class="fe oo op oq og b">async</code> <strong class="lb iu"> </strong>函数，其中可以包含一个<code class="fe oo op oq og b">await</code>表达式，该表达式暂停<code class="fe oo op oq og b">async</code>函数的执行并等待传递的承诺的解析，然后恢复<code class="fe oo op oq og b">async</code>函数的执行并返回解析后的值。点击此处了解更多信息。</li><li id="87b6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">每个函数都包装在一个<code class="fe oo op oq og b">try</code> / <code class="fe oo op oq og b">catch</code>语句中。在此了解更多信息。</li><li id="95d5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">每个函数都有两个参数:<code class="fe oo op oq og b">req</code>(请求)和<code class="fe oo op oq og b">reply</code>(回复)。在我们的教程中，我们只使用请求参数。我们将使用它来访问请求体和请求参数，从而允许我们处理数据。<a class="ae ky" href="https://www.fastify.io/docs/latest/Reply/" rel="noopener ugc nofollow" target="_blank">在此了解更多信息。</a></li><li id="56b6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">注意第31行的代码:<br/> <code class="fe oo op oq og b">const car = new Car({ …req.body })</code> <br/>这使用了JavaScript spread操作符。<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax" rel="noopener ugc nofollow" target="_blank">点击此处了解更多信息。</a></li><li id="1e2c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">注意第42行的代码:<br/> <code class="fe oo op oq og b">const { …updateData } = car</code> <br/>这使用了JavaScript <strong class="lb iu"> </strong>析构，结合了spread操作符。点击此处了解更多信息。</li></ul><p id="346a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，我们使用一些标准的mongose<strong class="lb iu"/>特性来操作我们的数据库。</p><p id="fc39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能正在燃烧以启动您的API并进行健全性检查，但在我们这样做之前，我们只需要将控制器连接到路由，然后，最后，将路由连接到应用程序。</p><h2 id="37a8" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated">创建和导入路线</h2><p id="d847" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">同样，我们可以从在项目的根目录下创建一个文件夹开始，但是这一次，它被称为<code class="fe oo op oq og b">routes</code>。在该文件夹中，我们用以下代码创建了一个<code class="fe oo op oq og b">index.js</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy mk l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">索引. js</p></figure><p id="9d19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们需要我们的控制器，并将我们在控制器中创建的每个功能分配给我们的路由。</p><p id="588a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，每个路由都由一个方法、一个URL和一个处理程序组成，指示应用程序在访问其中一个路由时使用哪个函数。</p><p id="0d98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">跟随某些路线的<code class="fe oo op oq og b">:id</code>是向路线传递参数的常见方式，这将允许我们如下访问<code class="fe oo op oq og b">id</code> <strong class="lb iu"> </strong>:</p><p id="6d8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oo op oq og b"><a class="ae ky" href="http://127.0.0.1:3000/api/cars/5bfe30b46fe410e1cfff2323" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:3000/api/cars/5bfe30b46fe410e1cfff2323</a></code></p><h2 id="bc25" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated">将所有这些放在一起并测试API</h2><p id="2abf" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">既然我们已经构建了大部分部分，我们只需要将它们连接在一起，开始通过我们的API提供数据。</p><p id="5468" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要通过向主<code class="fe oo op oq og b">index.js</code>文件添加以下代码行来导入我们创建的路线:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="5c8c" class="np mt it og b gy ok ol l om on">const routes = require(‘./routes’)</span></pre><p id="827c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们需要遍历routes数组，用Fastify初始化它们。<strong class="lb iu"> </strong>我们可以用下面的代码做到这一点，这些代码也需要添加到主<code class="fe oo op oq og b">index.js</code>文件中:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="21a2" class="np mt it og b gy ok ol l om on">routes.forEach((route, index) =&gt; {<br/> fastify.route(route)<br/>})</span></pre><p id="e8b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们准备开始测试了！</p><p id="feb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这项工作的最佳工具是<a class="ae ky" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>，我们将用它来测试我们所有的路线。我们将在请求体中以原始对象和参数的形式发送数据。</p><p id="bcb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查找所有汽车:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/cea60a2fae39033d49106b163726b7ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YoxRE054Q7qgrAxaCgrzLw.png"/></div></div></figure><p id="1f3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">寻找一辆车:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/9ab6eca1985124eab917125a854867fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1T4C1-LmgWv0S5W-bgk4wQ.png"/></div></div></figure><p id="66db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加新车**:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/4b05a75cd32443ba7f48ec87831fc9cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYqA6GVUv_dcKArTRJ_NPA.png"/></div></div></figure><p id="ab42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">**服务看起来是空的，但事实上，信息确实保存在数据库中。</p><p id="977b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更新汽车:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/785e77d4febd4d87383b9109583869b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BcZdrz0X3dyfDfOhkDFwFg.png"/></div></div></figure><p id="3773" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">删除汽车:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/a329ee96fe0668c13232feff3301f2a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9PwntcmeC1wfYMqo3raXdQ.png"/></div></div></figure><p id="a98e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在有了一个全功能的API——但是文档呢？这就是Swagger真正得心应手的地方。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/620cd49953a7a2d70368a04f7a844a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*7iaXjYojG6kWxLTZaW1x4Q.png"/></div></figure><h2 id="f224" class="np mt it bd mu nq nr dn my ns nt dp nc li nu nv ne lm nw nx ng lq ny nz ni oa bi translated">添加招摇和总结</h2><p id="258a" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">现在，我们将创建名为<code class="fe oo op oq og b">config</code>的最终文件夹。在里面，我们将用下面的代码创建一个名为<code class="fe oo op oq og b">swagger.js</code>的文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy mk l"/></div></figure><p id="34ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码是一个带有选项的对象，我们将把它传递到我们的fastify-swagger <strong class="lb iu"> </strong>插件中。为此，我们需要将以下内容添加到我们的<code class="fe oo op oq og b">index.js</code>文件中:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="fcff" class="np mt it og b gy ok ol l om on">// Import Swagger Options<br/>const swagger = require(‘./config/swagger’)</span><span id="9265" class="np mt it og b gy pb ol l om on">// Register Swagger<br/>fastify.register(require(‘fastify-swagger’), swagger.options)</span></pre><p id="d13b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在初始化Fastify服务器后，我们需要添加以下代码行:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="3412" class="np mt it og b gy ok ol l om on">...<br/>await fastify.listen(3000)<br/>fastify.swagger()<br/>fastify.log.info(`listening on ${fastify.server.address().port}`)<br/>...</span></pre><p id="338d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！如果您现在导航到<a class="ae ky" href="http://localhost:3000/documentation" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/documentation</a>，您应该会看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/1348f1f21474506805760268cd768da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HV-5eImCMs7LtiLodTz7CQ.png"/></div></div></figure><p id="466c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这么简单！现在，您拥有了可以自我更新的API文档，它将与您的API一起发展。您可以轻松地将附加信息添加到您的路线中，点击此处查看更多<a class="ae ky" href="https://github.com/fastify/fastify-swagger" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="5624" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">下一步是什么</h1><p id="bf79" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">现在我们已经有了一个基本的API，可能性是无限的。它可以作为任何可以想象的应用程序的基础。</p><p id="3679" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一个教程中，我们将集成<a class="ae ky" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a>，并最终将前端也与Vue.js集成在一起！</p></div></div>    
</body>
</html>