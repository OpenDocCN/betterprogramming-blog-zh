<html>
<head>
<title>The 5-Step Checklist for Serverless Load Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器负载测试的5步清单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-5-step-checklist-for-serverless-load-testing-346f4a60841d?source=collection_archive---------17-----------------------#2022-02-21">https://betterprogramming.pub/the-5-step-checklist-for-serverless-load-testing-346f4a60841d?source=collection_archive---------17-----------------------#2022-02-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a3d6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">3.构建一个监控仪表板</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8d074e8a1ee67d8d634ce5c8c1106b64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vtSqRGEUj642cloiZfn0cQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">格伦·卡斯滕斯-彼得斯在<a class="ae ky" href="https://unsplash.com/s/photos/checklist?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="4b33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无服务器很棒。它消除了您的许多担忧，并将它们交给了您的云提供商，如AWS。</p><p id="bd07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当涉及到您的职责时，诸如可伸缩性、可靠性和服务器维护之类的事情就不在话下了。但这并不意味着你没有自己的责任。</p><p id="7101" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">负载测试的目的是看您的应用程序是否能够处理预期的(再加上一点点)流量。但这就是整个<em class="lv">无服务器可伸缩性</em>的前提，对吗？这应该不是你的问题吧？</p><p id="6b9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不完全是。</p><p id="9255" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您仍然有责任确保正确地将服务连接在一起，并为您的端点提供适当的节流机制。</p><blockquote class="lw"><p id="6e86" class="lx ly it bd lz ma mb mc md me mf lu dk translated"><em class="mg">无服务器负载测试不是为了测试您的云供应商是否可以扩展，而是测试您是否设计了可以扩展的软件。</em></p></blockquote><p id="fe23" class="pw-post-body-paragraph kz la it lb b lc mh ju le lf mi jx lh li mj lk ll lm mk lo lp lq ml ls lt lu im bi translated">记住这一点，在您点击负载测试上的“Go”按钮之前，您需要做几件事情。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="13fb" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">1.确定主要的业务工作流程</h1><p id="ca2a" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">当运行负载测试时，您希望确保80%的时间内要执行的操作具有最佳伸缩性。在理想的世界中，我们可以对一切进行负载测试，但是在现实的世界中，我们需要测试大多数用例。</p><p id="672c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有一个购物车应用程序，你的主要用例将是<em class="lv">添加商品到你的购物车，从你的购物车中移除商品，</em>和<em class="lv">结帐</em>。在购物应用中，你可以做很多其他的事情，但是80%的时候，你的用户会做这三个动作中的一个。</p><p id="7ec5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望在您决定运行负载测试时，您已经准备好了<a class="ae ky" href="https://www.eginnovations.com/blog/what-is-proactive-monitoring" rel="noopener ugc nofollow" target="_blank">主动监控</a>。这意味着您的测试定期在您的系统中运行虚假数据，以便在您的客户发现问题之前发现问题。</p><p id="78e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多工具可用于主动监控:</p><p id="b6fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我关于负载测试的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-easily-load-test-serverless-apps-with-postman-and-aws-912de7f1f7e0">上一篇文章</a>中，我谈到了使用<a class="ae ky" href="https://aws.amazon.com/solutions/implementations/distributed-load-testing-on-aws/" rel="noopener ugc nofollow" target="_blank"> AWS分布式负载测试工具</a>和Postman来运行负载测试。对于无服务器负载测试，这已经被证明是非常成功的，我继续推荐它。</p><p id="f501" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是有了所有不同的应用程序性能监控(APM)工具，如果您的测试不在Postman中呢？</p><p id="54e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以选择在Postman中重新创建测试或者转换它们。如果你使用DataDog synthetics，我有一个<a class="ae ky" href="https://t.co/7GRdOauUiH" rel="noopener ugc nofollow" target="_blank"> Public Postman Workspace </a>可以用来将你的多步API合成测试转换成Postman集合。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="0663" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">2.建立失败重试和警报机制</h1><p id="e409" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">当无服务器应用程序出错时，最佳实践是将事件发送到一个<a class="ae ky" href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html" rel="noopener ugc nofollow" target="_blank">死信队列</a>。但是不要止步于此。</p><p id="75e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦一个项目进入死信队列，你会怎么做？</p><p id="d3de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的负载测试将导致您的应用程序出现一些故障。它应该有意地将事件发送到错误状态，这样您就可以了解应用程序是如何处理故障的。</p><p id="9613" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如何处理无服务器应用程序中的故障？</p><p id="d2f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有两种主要类型的错误:</p><ul class=""><li id="dd3e" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated"><strong class="lb iu">瞬时错误</strong> —临时/一次性错误，可能是由云供应商基础设施或竞争条件中的小故障引起的</li><li id="bf88" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><strong class="lb iu">数据错误</strong> —系统中提供的数据不正确，导致系统故障</li></ul><p id="b0b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">能够分别跟踪这些错误是快速轻松地重新开始的关键。理论上，暂时性错误是一种可重试的错误，系统可以自行处理。它可以<em class="lv">回退并重试</em>以查看该信号是否已被解决。</p><p id="14b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">LEGO.com有一个很好的参考资料，关于他们如何重试暂时性错误并自动跟踪系统的健康状况。</p><p id="403f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据错误往往需要人工干预。无论是应用团队的开发人员还是最终用户，都需要有人来解决问题。在这些情况下，你需要一种方法来提醒那些负责修复的人。你可以发送电子邮件、闲置信息、应用程序内通知等…</p><p id="36a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当这些类型的错误出现在队列中时，您必须提供一种方法让某人知道发生了问题，并给他们一种修复问题的方法。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="b9c4" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">3.构建一个监控仪表板</h1><p id="023b" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">如果您无法了解系统的性能，负载测试就没有多大价值。为您的无服务器应用程序构建一个仪表板将允许您以多种方式查看它是如何执行的。</p><p id="e17f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以查看您的AWS服务是否接近任何服务配额，查看API Gateway和Lambda中的错误与成功响应率，以及各种其他洞察<a class="ae ky" href="https://docs.aws.amazon.com/lambda/latest/dg/monitoring-insights.html" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/f87cfa10e54ff362f02ea83e21638774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hrIR57hCNP2rMYvX.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><em class="mg">λ监测仪表盘</em></p></figure><p id="499c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">负载测试有助于识别系统中的瓶颈，这是应用程序的关键压力点。如果你在某个地方遇到瓶颈，就会影响性能和可伸缩性。确保监控SQS队列<em class="lv">项目计数</em>和队列中的<em class="lv">时间，以快速识别会降低系统速度的区域。</em></p><p id="29d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像云中的其他东西一样，当涉及到仪表板时，您有多种选择。您可以使用<a class="ae ky" href="https://aws.amazon.com/cloudwatch/" rel="noopener ugc nofollow" target="_blank"> AWS CloudWatch </a>、DataDog、Dynatrace或许多其他工具来构建您所需要的东西。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="37cc" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">4.建立关键绩效指标(KPI)</h1><p id="aab4" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">当负载测试结束时，您需要一种客观的方法来确定它是否成功。进入<em class="lv">关键绩效指标</em>。</p><p id="d5cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">工作负载KPI是一个用于确定应用程序是否正常运行的指标。这些范围根据您的应用程序的性质而有所不同。以购物车为例，您可以使用KPI来处理付款。</p><ul class=""><li id="c6fa" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated"><em class="lv">付款成功率为99.9%</em></li><li id="dac1" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><em class="lv">支付处理耗时不到3500毫秒</em></li><li id="d628" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><em class="lv"> 100%的失败支付导致订单取消并通知用户</em></li></ul><p id="b4f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是围绕应用程序性能的业务指标。如果您的负载测试导致这些中的任何一个失败，您就知道您需要将重点放在哪里。没有KPI，就无法判断您的应用程序是否如您所愿。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="0fe1" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">5.调整负载测试工具</h1><p id="0282" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">负载测试应该比您预期的最高流量多提供大约20%的流量。如果您预计在<a class="ae ky" href="https://netenrich.com/glossary/bursty-traffic" rel="noopener ugc nofollow" target="_blank">峰值突发时间</a>每分钟1000个请求，那么您的负载测试应该通过系统每分钟运行大约1200个请求。</p><p id="299c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你以一个不可能达到的量运行你的负载测试(比如在我们上面的场景中，每分钟1，000，000个请求)，你不会得到真实的结果。是的，您会对您的系统进行压力测试，但是它不需要被压力压到那个容量。</p><p id="9a5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，超越并没有错，但是你可能会为自己做不必要的工作。如果您的应用程序以每分钟100，000个请求的速度开始中断，但是您的最大预期规模是每分钟1，000个请求，那么您可以将时间花在修复应用程序的其他方面。</p><p id="b821" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">了解应用程序的预期流量可能很困难，尤其是在新的应用程序中。如果你在一个客户一个客户的基础上销售你的应用，很容易知道会有多少流量。但是在一个公共网站上估计流量可能会变成西部荒野。你必须求助于像搜索引擎优化排名这样的东西来找到你网站的关键词。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="b397" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">结论</h1><p id="f27f" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">负载测试是产品发布中有趣且令人兴奋的部分。您可以看到您的系统在真实世界中的表现，但仍然是在受控的环境中。一旦你修复了最初的问题，考虑在你的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/are-you-really-ready-for-ci-cd-9a8bf6d01b8a"> CI/CD管道</a>中添加一个减少负载的测试，以确保正在进行的开发不会在某个地方开始限制你。</p><p id="a1c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记得把重点放在你的主要业务案例上。您希望确保应用程序中使用最多的区域受到最严重的影响。用于初始设置的应用程序区域或很少使用的区域不需要进行负载测试。</p><p id="197d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">KPI将是你成功的主要指标。如果您在死信队列中得到许多错误，但是它们被重试并最终通过系统，您的KPI可能仍然认为这是成功的。<em class="lv">出错并不意味着你的业务流程失败</em>。对于无服务器，最重要的是可靠性和健壮性。其实就是一个<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/7-aws-serverless-design-principles-for-solutions-architects-2be22717713b"> AWS无服务器设计原理</a>！</p><p id="2e98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的应用程序可以自动恢复，那么它将更有可能处理大量负载并继续达到您的KPI。</p><p id="ba8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝您的负载测试好运。玩得开心！</p></div></div>    
</body>
</html>