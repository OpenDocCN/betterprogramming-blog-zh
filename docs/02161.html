<html>
<head>
<title>When to Use Event Sourcing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">何时使用事件来源</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/when-to-use-event-sourcing-d001e4bab691?source=collection_archive---------5-----------------------#2019-11-11">https://betterprogramming.pub/when-to-use-event-sourcing-d001e4bab691?source=collection_archive---------5-----------------------#2019-11-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f399" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">事件源可能很棒，但是它确实增加了系统的复杂性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/770af5aee13339fa4e15706568d5b4c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFuk_-bMLU92ZDBkvLTPhw.jpeg"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="bbf7" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">什么是事件采购？</h1><p id="6cf1" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">大多数web应用程序将系统的<em class="mp">状态</em>存储在数据库中。</p><p id="38a6" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">假设你被要求设计一个网店的数据库。最有可能的是，传统的sequel数据库设计会有一个<code class="fe mv mw mx my b">users</code>、<code class="fe mv mw mx my b">products</code>和<code class="fe mv mw mx my b">orders</code>表——代表系统的<em class="mp">状态</em>。</p><p id="e3f9" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">让我们假设你开始编码，并最终推出网上商店。几周后，产品负责人想知道用户平均更新电子邮件地址的次数。</p><p id="8b33" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">在这种传统的数据库设计中，当用户更新他们的电子邮件地址时，会执行如下所示的查询:</p><pre class="kj kk kl km gt mz my na nb aw nc bi"><span id="1185" class="nd lc it my b gy ne nf l ng nh">UPDATE users SET email='newemail@mail.com' WHERE id=1</span></pre><p id="0fe5" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">问题是在传统的sequel数据库中没有存储这种变化的事件日志。</p><p id="de5c" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">您可以构建一个额外的列<code class="fe mv mw mx my b">event_log</code>，并在每次用户更新其电子邮件地址时添加一个“用户更改的电子邮件”。然而，这有几个问题:</p><ul class=""><li id="ea28" class="ni nj it lv b lw mq lz mr mc nk mg nl mk nm mo nn no np nq bi translated">构建该功能需要额外的工作。</li><li id="89dd" class="ni nj it lv b lw nr lz ns mc nt mg nu mk nv mo nn no np nq bi translated">这使得数据库设计更加复杂。</li><li id="c1af" class="ni nj it lv b lw nr lz ns mc nt mg nu mk nv mo nn no np nq bi translated">您只能从实现该特性的那一刻起生成这些事件，没有办法追溯生成这些事件。</li></ul><p id="9a40" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">这是一个很好的例子，说明活动采购是多么的棒！</p><p id="3ac3" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">使用事件源设计，您不需要存储系统的<em class="mp">状态</em>。相反，您存储的是<em class="mp">事件</em>。</p><p id="3aec" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">例如，当用户注册时，会存储一个<code class="fe mv mw mx my b">UserCreated</code>事件。然后，当用户更新他们的电子邮件地址时，会存储一个<code class="fe mv mw mx my b">UserChangedEmail</code>事件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/d8b0fb8279c9d1d18dd8f7eb63f44b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*viG1yP8F41QjrM8V2qPvMg.png"/></div></div><p class="nx ny gj gh gi nz oa bd b be z dk translated">事件源系统中的示例事件</p></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="0b40" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">为什么使用事件采购</h1><h2 id="f7d4" class="nd lc it bd ld ob oc dn lh od oe dp ll mc of og ln mg oh oi lp mk oj ok lr ol bi translated">代表了我们的思维方式</h2><p id="1532" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">在现实世界中，人们在事件中思考。当有人问你今天过得怎么样时，你很可能会告诉他们发生的有趣的事情。而且你很可能不会描述x时刻世界的确切状态。</p><p id="589c" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">类似地，一个领域专家在描述一个过程时可能会谈到一系列事件。当您使用事件源时，在您的系统中对此建模变得更加容易。</p><h2 id="12f3" class="nd lc it bd ld ob oc dn lh od oe dp ll mc of og ln mg oh oi lp mk oj ok lr ol bi translated">生成报告变得很容易</h2><p id="c3c8" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">想知道用户更改电子邮件地址的次数吗？通过事件源，您已经存储了所有这些数据。</p><p id="e39a" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">想知道一个商品从用户的购物车中移除了多少次？简单统计一下<code class="fe mv mw mx my b">EventRemovedFromCart</code>事件。</p><p id="327a" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">借助事件源，您可以更深入地了解数据，并且可以追溯性地生成报告。</p><h2 id="6fac" class="nd lc it bd ld ob oc dn lh od oe dp ll mc of og ln mg oh oi lp mk oj ok lr ol bi translated">您有可靠的审计日志</h2><p id="3a00" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">您可以生成一个审计日志，准确地显示系统是如何进入一种状态的。</p><p id="4103" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">例如，想想你的银行账户。Event sourcing会生成一个交易事件日志，让我清楚地知道为什么每个月底我会破产。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="8765" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">为什么不使用事件采购</h1><p id="8cf9" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">听起来不错，但是有什么问题呢？</p><p id="eb71" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">我个人对事件源的经验是，它给你的系统增加了额外的复杂性。更复杂意味着更难引入新的开发人员，需要更长的时间来添加新功能，并且更难维护。</p><p id="29da" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">如果您正在构建一个相对小规模的系统，不需要安全的审计日志，实现这一点可能会比它的价值更麻烦。</p><p id="b0c9" class="pw-post-body-paragraph lt lu it lv b lw mq ju ly lz mr jx mb mc ms me mf mg mt mi mj mk mu mm mn mo im bi translated">如果你想了解更多关于活动采购的信息，我推荐格雷格·杨的演讲。</p></div></div>    
</body>
</html>