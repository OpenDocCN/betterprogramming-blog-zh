<html>
<head>
<title>Programmatically Publish a Markdown File as a Medium Story With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python以编程方式将降价文件发布为中间故事</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/programmatically-publish-a-markdown-file-as-a-medium-story-with-python-b2b072a5f968?source=collection_archive---------15-----------------------#2022-01-13">https://betterprogramming.pub/programmatically-publish-a-markdown-file-as-a-medium-story-with-python-b2b072a5f968?source=collection_archive---------15-----------------------#2022-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="aaea" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Medium的发布API从您的终端发布内容(不会丢失太多格式)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2dbfbe08794dfcb9f8af5e796809b169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q9_rOCV2T3D-H4nQJb5UCw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">谢尔盖·佐尔金在<a class="ae kv" href="https://unsplash.com/s/photos/typing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="1e4f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">动机:<em class="lo">轻微</em>不便</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/f98530da50811f2016ec487c223a7b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*E9EppvCqPbW4P6hmSSgK5Q.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">之前:将本地文件上的内容放入一个中等大小的帖子中</p></figure><h1 id="857b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">问题陈述</h1><p id="e397" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">当试图将文章草稿从本地markdown文件(通常是从Bear或concept等编写应用程序中导出的)传输到Medium时，格式粘贴不良，并且需要花费几分钟的时间来重新调整格式。</p><p id="6ba1" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">因此，在真正的程序员的方式中，诱惑导致试图使过程稍微不那么痛苦。</p><h1 id="668f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">解决方案</strong></h1><p id="a727" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">进行命令行交互(CLI)以读取本地文件并将其作为新帖子上传到媒体，同时保持大部分预设格式(如标题、链接、代码块)不变。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="8d2a" class="kw kx iq bd ky kz my lb lc ld mz lf lg jw na jx li jz nb ka lk kc nc kd lm ln bi translated">代码</h1><p id="5924" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">为简洁起见，本文中不会包括所有代码。完整的代码可以在<a class="ae kv" href="https://github.com/kaili-chen/writing-supplements/blob/master/publish%20to%20medium%20via%20cli/publish.py" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="7160" class="nd kx iq bd ky ne nf dn lc ng nh dp lg lz ni nj li md nk nl lk mh nm nn lm no bi translated">1.获取中等集成令牌</h2><p id="1d3c" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">a.帐户&gt;设置&gt;集成令牌</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/7c97ba350a54561cc2ae1ab7804ad36e.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*Rj1QN08HTnZv71B4b1tKMw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">转到“媒体设置”页面下的“集成令牌”部分</p></figure><p id="bd86" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">b.输入令牌描述，然后单击“获取集成令牌”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/0fc49c5afee6a7147a35962ba3586743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DB45TXKA9hy7mUGTZ9RcaQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">生成集成令牌</p></figure><p id="7c26" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">c.复制生成的令牌</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/ab783106a72a8051c0d90f8cf7c86590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4JR83BLmOl1wbr4oQ88pSA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">复制生成的集成令牌</p></figure><p id="34ce" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">d.将生成的令牌作为常量变量添加到python文件中</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="220c" class="nd kx iq nt b gy nx ny l nz oa"># file name: publish.py</span><span id="d6ba" class="nd kx iq nt b gy ob ny l nz oa">TOKEN = 'insert_generated_medium_integration_token'</span></pre><h2 id="7937" class="nd kx iq bd ky ne nf dn lc ng nh dp lg lz ni nj li md nk nl lk mh nm nn lm no bi translated">2.设置命令行界面</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="c219" class="nd kx iq bd ky ne nf dn lc ng nh dp lg lz ni nj li md nk nl lk mh nm nn lm no bi translated">3.准备要发布的文件</h2><p id="6aa1" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">用于发布的Medium <code class="fe oe of og nt b">post</code> API只接受HTML和markdown内容。下面是读取本地降价文件的Python脚本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="1d0e" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">现在让我们通过解析文件内容来准备有效负载数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="8a23" class="nd kx iq bd ky ne nf dn lc ng nh dp lg lz ni nj li md nk nl lk mh nm nn lm no bi translated">4.获取作者ID</h2><p id="2a20" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">要构建发布文章的URL(稍后在第5点中)，需要一个<code class="fe oe of og nt b">authorId</code>。</p><p id="e740" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">可以使用带有在点1中生成的集成令牌的<code class="fe oe of og nt b">Users</code>端点来获得<code class="fe oe of og nt b">authorId</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="e4e2" class="nd kx iq bd ky ne nf dn lc ng nh dp lg lz ni nj li md nk nl lk mh nm nn lm no bi translated">5.将文件发布到媒体</h2><p id="e890" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">准备好<code class="fe oe of og nt b">authorId</code>和有效负载后，使用POST请求将文件内容发布到媒体。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h1 id="99d5" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结果</h1><p id="a53c" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">从命令行运行Python脚本将本地降价发布到中。</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="bbee" class="nd kx iq nt b gy nx ny l nz oa">python publish.py draft_article.md --title "this is from the cli"</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/26695e011fe5a6cb6e186062fbcbbb0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*u9eLTe91jdRVeNl2nDS9Ww.gif"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/930e5bb7d21843738015fc272064021e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*QPmDyqmwi9QHNCKCiEgB4A.gif"/></div></figure><p id="1f0b" class="pw-post-body-paragraph lq lr iq ls b lt mm jr lv lw mn ju ly lz mo mb mc md mp mf mg mh mq mj mk ml ij bi translated">从CLI添加到Medium的同一个文件保留了原始文件的许多格式(如标题、链接、代码块),大大减少了我完成这篇文章的时间。</p><h1 id="1e44" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">进一步说明</h1><ul class=""><li id="7232" class="oh oi iq ls b lt lu lw lx lz oj md ok mh ol ml om on oo op bi translated">曾尝试将其转换为web应用程序，但由于API目前不支持基于浏览器的身份验证，这一尝试被放弃了</li><li id="5b75" class="oh oi iq ls b lt oq lw or lz os md ot mh ou ml om on oo op bi translated">API不会将本地图像引用作为图像上传，快速测试发现，只有URL来源的图像会转换为显示在CLI发布的帖子中的图像—一个很好的练习是使用Medium的图像API来处理这种情况</li></ul><h1 id="1dad" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">参考</h1><ul class=""><li id="444b" class="oh oi iq ls b lt lu lw lx lz oj md ok mh ol ml om on oo op bi translated"><a class="ae kv" href="https://github.com/Medium/medium-api-docs" rel="noopener ugc nofollow" target="_blank">介质API参考</a></li><li id="d062" class="oh oi iq ls b lt oq lw or lz os md ot mh ou ml om on oo op bi translated"><a class="ae kv" href="https://docs.python.org/3/library/argparse.html" rel="noopener ugc nofollow" target="_blank"> python argparse库</a></li></ul></div></div>    
</body>
</html>