<html>
<head>
<title>How to Store Confidential Credentials in Your Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在项目中存储机密凭据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/an-effective-way-to-store-confidential-credentials-in-your-project-8aa1822a733e?source=collection_archive---------6-----------------------#2020-02-21">https://betterprogramming.pub/an-effective-way-to-store-confidential-credentials-in-your-project-8aa1822a733e?source=collection_archive---------6-----------------------#2020-02-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d748" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建一个自动化环境，只有真正需要的人才能访问关键信息</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fab29cff1c7bca0100e3b7ea77a30580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6H5pqOvrAM74UVExBJ2ViQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自pixabay.com<a class="ae ky" href="https://pixabay.com/images/search/confidential/" rel="noopener ugc nofollow" target="_blank"/>。</p></figure><p id="fbcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为开发人员，我们最关心的是让事情顺利进行。但与此同时，我们通常会忘记我们已经在应用程序中存储了像服务帐户JSON/私钥这样的机密凭证！</p><p id="8680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理想情况下，建议不要与任何人分享此类任务关键信息。但有时，它被提交给我们的版本控制系统，并对每个有权查看该存储库的人开放。</p><p id="8255" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据最佳实践，建议我们不要在我们的存储库中提交这样的文件，也不要将它们存储在前端/客户端环境中。</p><p id="bd5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以问题是“你如何建立这样一个环境，只有真正需要的人才能获得关键信息？”</p><p id="b13f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我想提到一种方法，我使用<a class="ae ky" href="https://www.atlassian.com/continuous-delivery/principles/continuous-integration-vs-delivery-vs-deployment" rel="noopener ugc nofollow" target="_blank"> CI/CD </a>(持续集成，持续开发)<em class="lv">的概念来实现。使用这种方法，您不仅可以保护服务密钥，还可以在部署环境中直接编写关键任务代码/文件，而不会暴露它。只需轻轻一按按钮，您就可以实现整个过程的自动化！</em></p><p id="5f97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整个过程可以分为以下几个步骤:</p><ol class=""><li id="031e" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">管理服务帐户</li><li id="d8f7" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">设置GitLab配置项</li></ol></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="d483" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">管理服务帐户</h1><p id="6ca9" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在这一步中，我们建立了授权代码执行所需操作的机制，例如代码部署、存储桶访问等。基于您的云环境，创建一个具有所需权限的服务帐户。</p><p id="ba8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我使用谷歌云平台的应用引擎来部署和运行我们的代码。</p><p id="0a3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建服务帐户:</p><ul class=""><li id="d61d" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu no mc md me bi translated">进入我是管理员页面，点击➕“创建服务账户”</li><li id="e9cd" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu no mc md me bi translated">建议遵循最小特权原则。因此，我选择“App Engine Admin”和“Cloud Build Service Account”角色来创建我们将在下一步中使用的JSON密钥。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/81b76a8a3ac9f53e2127b8b445f05950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KYvlw8PXYb4tKGQgrej97g.png"/></div></div></figure><ul class=""><li id="3c10" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu no mc md me bi translated">下载JSON密匙，进入下一步。</li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="6b04" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">设置GitLab配置项</h1><p id="ae75" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在在GitLab中(你可以使用任何版本控制系统)，我们需要设置在部署代码时使用运行时的变量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/8f1a9040333ed0f70c66c46a7bcb67c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NWt_8mbZpWTbKV8q3CbalA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">配置变量。</p></figure><p id="1e0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我创建了三个变量:<code class="fe nr ns nt nu b">PROJECT_ID</code>、<code class="fe nr ns nt nu b">SERVICE_ACCOUNT</code>和<code class="fe nr ns nt nu b">AWS_SERVICES_CREDENTIALS</code>。</p><ul class=""><li id="95cc" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu no mc md me bi translated"><code class="fe nr ns nt nu b">PROJECT_ID</code> <em class="lv"> </em>包含我要部署代码的项目的名称。</li><li id="d6a4" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu no mc md me bi translated"><code class="fe nr ns nt nu b">SERVICE_ACCOUNT</code>包含我们刚刚在前面的步骤中生成的JSON字符串。</li><li id="b700" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu no mc md me bi translated"><code class="fe nr ns nt nu b">AWS_SERVICES_CREDENTIALS</code>包含授权凭证，我的代码将在内部使用这些凭证与部署在AWS上的一些服务进行通信。</li></ul><p id="2edd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:您可以根据需要创建任意数量的变量。</p><p id="f496" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，<em class="lv"> </em> <code class="fe nr ns nt nu b">AWS_SERVICES_CREDENTIALS</code>才是我想要保护的人。</p><p id="56d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们需要在项目的根文件夹中创建<code class="fe nr ns nt nu b"><a class="ae ky" href="https://docs.gitlab.com/ee/ci/yaml/" rel="noopener ugc nofollow" target="_blank">.gitlab-ci.yml</a></code> <strong class="lb iu"> </strong>文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="d9f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在脚本部分，您可以看到bash指令来执行所需的操作。安装Google Cloud SDK后，它会先创建<code class="fe nr ns nt nu b">MY_AWS_SERVICES_CREDENTIALS.json</code>文件，并在其中写入<code class="fe nr ns nt nu b">AWS_SERVICES_CREDENTIALS</code>凭证。</p><p id="5548" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于这些变量只对存储库维护人员开放，我们可以在某种程度上对公钥/秘密加以限制。</p><p id="12bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，您也可以直接向部署环境编写一些分类代码，而无需将其提交给版本控制系统。</p><p id="56c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的过程都发生在Docker容器中，所以您也可以执行测试和其他操作。关于这方面的更多信息，你可以阅读<a class="ae ky" href="https://medium.com/faun/ci-cd-essentials-from-scratch-with-gitlab-61502acf318e" rel="noopener">这篇精彩的文章</a>。也可以为其创建您自己的个性化码头/滑道。也许我会在另一篇文章中写他们。</p><p id="66df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，主分支的一个<strong class="lb iu"> </strong> git push <strong class="lb iu"> </strong>将自动使用凭证JSON文件将代码部署到app engine环境。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="aad0" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">结论</h1><p id="460b" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">这只是我在工作中发现的CI/CD的一个应用。让我知道你正在使用的其他更好的方法。这对其他人也会有帮助。</p><p id="f475" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这篇文章，并发现它很有帮助。</p><p id="2f66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。继续自动化。</p></div></div>    
</body>
</html>