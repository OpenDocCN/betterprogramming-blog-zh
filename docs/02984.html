<html>
<head>
<title>The Dangers of the ‘+’ Operator in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中'+'操作符的危险</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-dangers-of-the-operator-in-javascript-2276f1e83c5d?source=collection_archive---------13-----------------------#2020-01-13">https://betterprogramming.pub/the-dangers-of-the-operator-in-javascript-2276f1e83c5d?source=collection_archive---------13-----------------------#2020-01-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="75bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简单的加法会以你意想不到的方式破坏JavaScript应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a405ce07f9dbfb3e006d3ab4c38d7e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c6NI83iw_D7X6JB_"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凯文·杰瑞特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="00f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像大多数编程语言一样，JavaScript有一个<code class="fe lv lw lx ly b">+</code>操作符，可以用来执行加法。然而，与其他编程语言不同，运算符还有第二个用途:字符串格式化。</p><p id="86d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章探索了<code class="fe lv lw lx ly b">+</code>操作符是如何工作的，以及如果你不小心的话，它是如何失败并导致错误的。它还显示了如何首先避免这些问题。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d015" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">基础知识</h1><p id="785a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如前所述，<code class="fe lv lw lx ly b">+</code>操作符在JavaScript中有两个用途:</p><ol class=""><li id="9dd8" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">添加数字</li><li id="26fa" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">串联字符串</li></ol><p id="fb52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">+</code>运算符的第一个目的是将数字相加。这里有一个例子:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="bdf4" class="nv mh it ly b gy nw nx l ny nz">const price = 20<br/>const shipping = 3<br/>const tax = 3<br/>const total = price + shipping + tax<br/>console.log(total) // Outputs 26</span></pre><p id="45da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运算符的另一个目的是连接字符串。它可以这样使用:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="0692" class="nv mh it ly b gy nw nx l ny nz">const firstName = 'Marty'<br/>const lastName = 'McFly'<br/>const fullName = firstName + ' ' + lastName <br/>console.log(fullName) // Outputs 'Marty McFly'</span></pre><p id="c9e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这至少目前看来是可行的，但是当你使用字符串形式的数字时会发生什么呢？</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="40ab" class="nv mh it ly b gy nw nx l ny nz">console.log('2' + '2') // This outputs '22'</span></pre><p id="1e73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运算符的行为取决于给定的数据类型。如果它收到两个数，那么它将执行加法。但是，如果您给它一个或多个字符串，行为将变为字符串连接。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="ba0b" class="nv mh it ly b gy nw nx l ny nz">console.log(2 + '2') // This also outputs '22'!</span></pre><p id="b759" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">+</code>操作符的模糊性会在JavaScript应用程序中造成大问题。让我们看看如何。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="2e88" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">现实世界的例子</h1><p id="4049" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">上面的例子以最基本的形式展示了这个问题。然而，在现实世界中，问题往往隐藏在复杂性中。这里有一个更现实的情况:</p><p id="601e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的公司维护着一个电子商务网站。您的任务是在网站的标题上添加一个小计指示器，这样用户就可以看到他们购物时花了多少钱。</p><p id="6a9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">小计是通过对用户购物车中的所有产品求和来计算的。产品数据以JSON格式从REST API中获取。用户购物车中的产品用一个对象文字数组表示。例如，它可能是这样的:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="a76f" class="nv mh it ly b gy nw nx l ny nz">[<br/>  {<br/>    "id": 23173128,<br/>    "title": "Nutella Hazelnut Spread",<br/>    "price": 8<br/>  },<br/>  {<br/>    "id": 89123012,<br/>    "title": "Oreo Chocolate Sandwich",<br/>    "price": 5<br/>  }<br/>]</span></pre><p id="389d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过结合使用<code class="fe lv lw lx ly b">+</code>操作符和<code class="fe lv lw lx ly b">reduce</code>数组方法来计算购物车中产品的总和:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="f841" class="nv mh it ly b gy nw nx l ny nz">const subtotal = productsInCart<br/>  .reduce((total, product) =&gt; total + product.price, 0)</span></pre><p id="ab81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前这样做很好，但是如果后端API发生变化，价格意外地从数字转换为字符串，会发生什么情况呢？</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="371b" class="nv mh it ly b gy nw nx l ny nz">{<br/>  {<br/>    "id": 23173128,<br/>    "title": "Nutella Hazelnut Spread",<br/>    "price": "8" // Price is now a string!<br/>  },<br/>  {<br/>    "id": 89123012,<br/>    "title": "Oreo Chocolate Sandwich Cookies",<br/>    "price": "5"<br/>  }<br/>}</span></pre><p id="3e3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码仍然会运行，但是结果会有所不同。<code class="fe lv lw lx ly b">8 + 5</code>导致<code class="fe lv lw lx ly b">13</code>，而<code class="fe lv lw lx ly b">'8' + '5'</code>导致<code class="fe lv lw lx ly b">'85'</code>！不会抛出任何错误，因此bug可能会悄悄进入生产环境而不被发现。</p><p id="70ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这很危险！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="abc8" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">如何避免这个问题</h1><p id="d3bc" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果您想要添加您无法绝对控制的数字(例如，来自API或用户输入)，那么最好使用<code class="fe lv lw lx ly b">parseInt</code>、<code class="fe lv lw lx ly b">parseFloat</code>、<code class="fe lv lw lx ly b">Number</code>或类似的方式显式强制您的值为数字。</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="711e" class="nv mh it ly b gy nw nx l ny nz">console.log(parseInt('2') + parseInt('2')) // This outputs 4</span></pre><p id="b59c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过<code class="fe lv lw lx ly b">parseFloat</code>函数传递购物车中每个商品的价格，可以避免上面电子商务示例中引入的错误:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="d771" class="nv mh it ly b gy nw nx l ny nz">const subtotal = productsInCart<br/>  .reduce((total, product) =&gt; total + parseFloat(product.price), 0)</span></pre><p id="30e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，如果您想要从可能包含数字的值形成一个字符串，那么您应该显式地强制这些值成为字符串:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="15bf" class="nv mh it ly b gy nw nx l ny nz">const prefix = 777<br/>const suffix = 888<br/>const result = prefix.toString() + suffix.toString()<br/>console.log(result) // Outputs '777888'</span></pre><p id="b2df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更好的是，不要使用<code class="fe lv lw lx ly b">+</code>操作符来格式化字符串。请改用ES6模板文字:</p><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="67fb" class="nv mh it ly b gy nw nx l ny nz">const prefix = 777<br/>const suffix = 888<br/>const result = `${prefix}${suffix}`<br/>console.log(result) // Outputs '777888'</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b1c9" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">摘要</h1><p id="bcda" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在JavaScript中,<code class="fe lv lw lx ly b">+</code>操作符用于执行加法和字符串连接。如果不小心的话，这种双重用途的功能可能会导致危险的错误，当想要添加时会发生连接，反之亦然。</p><p id="fad7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">处理这一潜在问题的最佳方式是主动将未知数据转换为其预期类型。可以使用<code class="fe lv lw lx ly b">parseInt</code>、<code class="fe lv lw lx ly b">parseFloat</code>或<code class="fe lv lw lx ly b">Number</code>将值转换为数字。可以通过使用<code class="fe lv lw lx ly b">toString</code>方法或模板文字将值转换为字符串。</p></div></div>    
</body>
</html>