<html>
<head>
<title>Build an Object Detection App Using Amazon Rekognition, Amplify, and SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Amazon Rekognition、Amplify和SwiftUI构建一个对象检测应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-an-object-detection-app-using-amazon-rekognition-amplify-and-swiftui-20b51dd0024b?source=collection_archive---------13-----------------------#2021-01-04">https://betterprogramming.pub/build-an-object-detection-app-using-amazon-rekognition-amplify-and-swiftui-20b51dd0024b?source=collection_archive---------13-----------------------#2021-01-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="86ec" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让计算机视觉世界变得简单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f5b05be756ba4e38647b7e9ed85d6b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QjHEKyBjTiURgPzZ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@krissana_renae?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯萨纳·波尔托</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄。</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="c29e" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">为什么要用亚马逊Rekognition？</h1><p id="e7c8" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">有许多方法可以将机器学习集成到iOS应用程序中。苹果甚至提供Core ML来训练我们自己的模型，并获得在iOS设备上运行的预测。然而，不用担心训练我们自己的模型和许多因素，我们可以轻松访问云服务来获得所需的预测。Amazon Rekognition是一种云服务，可以轻松识别对象、文本和人，以及其他可能性。</p><p id="8f83" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果你有兴趣部署一个快速使用这些类型预测的应用程序，这个工具正适合你。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="2767" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">配置您的项目</h1><p id="1f9f" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">如果您以前从未使用过AWS Amplify CLI，您可以遵循<a class="ae kv" href="https://docs.amplify.aws/start/q/integration/ios" rel="noopener ugc nofollow" target="_blank">入门指南</a>。如果您没有AWS帐户，您需要注册一个，然后安装和配置CLI。</p><p id="fdd8" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">配置完CLI后，让我们在Xcode中创建新项目。选择“单视图应用程序”选择Swift作为语言，SwiftUI作为用户界面。您可以将生命周期保留为“SwiftUI App”给它您想要的产品名称和组织名称。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/1fc3fdb3d4f7c6cd3a0e4caced57954e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsJyiHRJu86_Mc3OF7N_jA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建我们的项目</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="431e" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">设置放大器</h1><p id="ba05" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">考虑到您已经在计算机上配置了AWS CLI和Amplify，请在项目文件夹中运行以下命令:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="5d2a" class="nc le iq my b gy nd ne l nf ng">$ amplify init</span></pre><p id="5e97" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这将在AWS上创建一个新的Amplify项目。在这里，您可以输入项目和环境的名称。选取您的默认编辑器，选取iOS应用程序作为类型，然后选取您想要使用的AWS描述文件。</p><p id="db80" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在您看到消息“Amplify setup completed successfully”后，您可以运行以下命令来添加<code class="fe nh ni nj my b">predictions</code>插件:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="b443" class="nc le iq my b gy nd ne l nf ng">$ amplify add predictions</span></pre><ul class=""><li id="7141" class="nk nl iq lx b ly mr mb ms me nm mi nn mm no mq np nq nr ns bi translated">出现提示时，选择“识别”类别，因为我们将对图像进行标记。</li><li id="ebd4" class="nk nl iq lx b ly nt mb nu me nv mi nw mm nx mq np nq nr ns bi translated">您需要选择“是”将<code class="fe nh ni nj my b">auth</code>添加到项目中。如果您没有使用它，请选取“电子邮件”作为鉴定类型，然后选取“识别标签”</li><li id="efce" class="nk nl iq lx b ly nt mb nu me nv mi nw mm nx mq np nq nr ns bi translated">你可以选择资源的默认名称，默认配置，最后选择“授权和访客用户”来允许未签名的用户使用<code class="fe nh ni nj my b">predictions</code>插件。在本文中，我们允许访客用户关注预测部分，而不是授权。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/1a93fabd12ef25e45c020eeb47bbc50d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PLnOceQBIuEHIn5Dh7W_TA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加放大预测插件</p></figure><p id="8bb7" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">设置好<code class="fe nh ni nj my b">predictions</code>插件后，您可以运行以下命令将更改推送到云:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="090e" class="nc le iq my b gy nd ne l nf ng">$ amplify push</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="ad4e" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">设置pod</h1><p id="b1fd" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">一旦所有的更改都被推送到云中，我们需要将<a class="ae kv" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>添加到我们的项目中:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="ebbe" class="nc le iq my b gy nd ne l nf ng">$ pod init</span></pre><p id="099f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在将以下窗格添加到窗格文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们项目的Podfile</p></figure><p id="70ac" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">要安装pod，我们需要运行:</p><pre class="kg kh ki kj gt mx my mz na aw nb bi"><span id="cc1b" class="nc le iq my b gy nd ne l nf ng">$ pod install</span></pre><p id="acd3" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在我们已经完成了配置，我们可以打开Xcode了。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="1fff" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">检查Xcode中的AWS配置文件</h1><p id="280f" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">如果您在终端上运行最新的Amplify CLI，当打开Xcode时，您应该会看到下图中的文件夹:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/2f96bc80336b44a49e73fef640be5993.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*St1MLYMngH1SVsLRlfdP2w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">必需的文件</p></figure><p id="4f81" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果没有看到这个文件夹，需要把这些文件拖到Xcode: <code class="fe nh ni nj my b">awsconfiguration.json</code>和<code class="fe nh ni nj my b">amplifyconfiguration.json</code>。</p><p id="1a9f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我们可能需要更新放大器配置。若要仅保留对原始文件的引用，请在将文件拖到项目中时取消选中“如果需要，请拷贝项目”。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="5f17" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">初始化放大器</h1><p id="67ea" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">要使用Amplify，我们需要在我们的<code class="fe nh ni nj my b">App Lifecycle</code>文件中初始化它。在示例项目中，由于我将项目命名为“SwiftUIAmplifyRekognitionTutorial”，因此文件被命名为<code class="fe nh ni nj my b">SwiftUIAmplifyRekognitionTutorialApp.swift</code>。您应该将文件内容更改为如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SwiftUI应用生命周期文件</p></figure><p id="6745" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">由于本教程使用新的SwiftUI生命周期，我们仍然需要使用<code class="fe nh ni nj my b">UIApplicationDelegateAdaptor</code>来初始化<code class="fe nh ni nj my b">didFinishLaunchingWithOptions</code>中的Amplify。如果您选择使用传统的<code class="fe nh ni nj my b">AppDelegate</code>生命周期，您可以编辑您的<code class="fe nh ni nj my b">AppDelegate.swift</code>，添加<code class="fe nh ni nj my b">initializeAWSAmplify</code>方法，并调用它。</p><p id="0554" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果你注意到了，我们在<code class="fe nh ni nj my b">initializeAWSAmplify</code>中添加了<code class="fe nh ni nj my b">Auth</code>插件。即使我们允许用户作为访客使用预测，我们仍然需要添加这个插件来成功初始化Amplify。</p><p id="63d8" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果您在Xcode控制台上看到“Amplify initialized”信息，则一切正常。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="4a01" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">在SwiftUI中创建图像拾取器</h1><p id="3b33" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">现在我们的项目已经完全配置好了，我们可以从创建一个<code class="fe nh ni nj my b">ImagePicker</code>开始，它将允许我们使用相机(如果使用物理设备的话)或者从库中选择图像。</p><p id="3cee" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在项目中创建一个新文件，并将其命名为<code class="fe nh ni nj my b">ImagePicker.swift</code>。然后向其中添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图像拾取器UIViewControllerRepresentable</p></figure><p id="8887" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">使用<code class="fe nh ni nj my b">UIViewControllerRepresentable</code>，我们将能够从SwiftUI视图中调用<code class="fe nh ni nj my b">ImagePicker</code>。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="4c3e" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">在Info.plist上设置权限</h1><p id="d506" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在我们可以在我们的设备上获取图像之前，我们需要向用户请求访问相机和库的权限。为此，打开您的<code class="fe nh ni nj my b">Info.plist</code>，添加描述为“需要访问图书馆以获取用于标记的图片”(或其他适合您的内容)的关键字<code class="fe nh ni nj my b">NSPhotoLibraryUsageDescription</code>，以及描述为“需要相机来获取用于标记的图片”的关键字<code class="fe nh ni nj my b">NSCameraUsageDescription</code></p><p id="77cd" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">您的<code class="fe nh ni nj my b">Info.plist</code>文件应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/ef9ec92cd43db4da64f98a10bbe6626f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6As8jaMj3ZUr5e9feiuK2Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">修改的信息列表</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="ae6d" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">在内容视图上标记图像</h1><p id="b974" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">现在，我们终于可以开始选择图像，然后使用Amplify获得标签。为此，我们可以在<code class="fe nh ni nj my b">ContentView</code>中创建一个非常基本的UI:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用Amplify获取图像和标签的视图</p></figure><p id="c9b3" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">正如您在代码中看到的，我们创建了一个简单的<code class="fe nh ni nj my b">VStack</code>，它包含一个文本和一个按钮，该按钮将显示我们之前创建的<code class="fe nh ni nj my b">ImagePicker</code>，使我们能够用相机拍照(如果使用物理设备)或从库中选择图片(如果使用模拟器)。在同一个<code class="fe nh ni nj my b">VStack</code>上，我们还添加了可选的<code class="fe nh ni nj my b">chosenImage</code>(显示在我们的选择之后)和一个列表(将显示我们使用Amplify <code class="fe nh ni nj my b">predictions</code>插件得到的标签)。您的应用程序应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/b4b4ce6e36f3f06d9b4290e01772ee60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P29dRjJWpegufEc9wgofWw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">获取图像的简单用户界面</p></figure><p id="fad2" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">当<code class="fe nh ni nj my b">ImagePicker</code>被解除时，我们调用<code class="fe nh ni nj my b">loadImage()</code>方法，它检查我们是否选择了图像，然后压缩图像以便更快上传。然后，我们获取图像的URL，以便将其传递给<code class="fe nh ni nj my b">detectLabels()</code>方法，当对AWS的调用返回时，该方法将显示预测的标签。正如你在下图中看到的，当选择一张热狗的图片时，我们确实以99.89%的置信度得到了正确的标签:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/4fe27b69ebaebaa2445ce7a64d4e6b9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IlPAKdNomQNhArqvEqDl3g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们使用Amplify得到选择的图像和标签</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="c15b" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">结论</h1><p id="7981" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">如果你想看看整个项目，请查看<a class="ae kv" href="https://github.com/rolisanchez/swiftui-rekognition-amplify-tutorial" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</p><p id="fbc8" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>