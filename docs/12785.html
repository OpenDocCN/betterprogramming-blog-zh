<html>
<head>
<title>Preventing SQL Injection Attacks in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">防止Node.js中的SQL注入攻击</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/stop-doing-this-in-your-sql-queries-if-you-already-are-252b3f8c1029?source=collection_archive---------6-----------------------#2022-07-01">https://betterprogramming.pub/stop-doing-this-in-your-sql-queries-if-you-already-are-252b3f8c1029?source=collection_archive---------6-----------------------#2022-07-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8da5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如果您已经这样做了，请停止在SQL查询中这样做</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/23178488e7a644c9b4e53e7128b5227e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2Wv6shsb9giNwmP5"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">卡斯帕·卡米尔·鲁宾在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3537" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想知道SQL注入是什么吗？</p><p id="1365" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SQL注入是最流行的网络黑客技术之一，它允许攻击者通过简单地注入几行代码来窥视你的数据库。</p><p id="4841" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">攻击者可以读取、修改甚至删除数据库中的数据，只需在向服务器发送请求时对参数进行一些更改，从而修改原始SQL查询。</p><p id="4000" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">迷茫？</p><p id="ffc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们用最简单的例子来理解这一点:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/87018e1aeba3f4bfec39acd6ad57a1f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Lqnum01bmkmD-EqHXlRfw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SQL注入的例子</p></figure><p id="e46b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个GET请求，请求后端用<code class="fe lt lu lv lw b">id = 3</code>发送用户的数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lx"><img src="../Images/231c31ce062d8cae925bde66ec9dff8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*skfTUqnF9uQPqddBVI-KWQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">按ID获取用户</p></figure><p id="3dbc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的示例显示了查询中的一个更改如何从数据库中获取所有用户数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/810f571e9008e8563a1de37877651c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*20uIv5u9Sz8c8zXO1qYBqg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在请求参数中添加(1==1)</p></figure><p id="c758" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ly">注:这是理解SQL注入</em>最简单的例子之一</p><p id="4121" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">幕后发生了什么？</p><p id="c958" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的例子中，用户以<code class="fe lt lu lv lw b">id = 3 OR (1 = 1)</code>的身份发送查询。</p><p id="9637" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当在后端从请求中提取这个查询时，它将整个事情作为一个字符串处理，这个字符串将在SQL查询中进一步处理。</p><p id="d14b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从技术上讲，SQL查询应该是:</p><pre class="kg kh ki kj gt lz lw ma mb aw mc bi"><span id="0dc3" class="md me iq lw b gy mf mg l mh mi">SELECT * from Persons WHERE PersonId = 3</span></pre><p id="839d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是现在有了给定的输入，SQL查询变成了:</p><pre class="kg kh ki kj gt lz lw ma mb aw mc bi"><span id="cb4d" class="md me iq lw b gy mf mg l mh mi">SELECT * from Persons WHERE PersonId = 3 OR (1 = 1)</span></pre><p id="95fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为(1 = 1)始终为真，所以它返回存在于<code class="fe lt lu lv lw b">Persons</code>表中的所有用户。</p><p id="eeb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">毫无疑问，你不希望这个问题出现在你的下一个开发项目中！</p><p id="3a4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们更深入地了解这一点，动手用MySQL数据库编写一些express后端，并实现更好的实践来避免SQL注入。</p><p id="67fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用以下文件夹结构创建最小的express项目:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/abe0e8fd610872abcf82662f9ca77162.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*X6A2-xzaKW_4MWixSt3wTg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">文件夹结构</p></figure><h2 id="ad23" class="md me iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated"><strong class="ak"> <em class="nb">包装要求</em> </strong></h2><ul class=""><li id="0327" class="nc nd iq ky b kz ne lc nf lf ng lj nh ln ni lr nj nk nl nm bi translated"><code class="fe lt lu lv lw b">mysql2</code></li><li id="3cf9" class="nc nd iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated"><code class="fe lt lu lv lw b">dotenv</code>(确保每一件私人物品都留在。环境文件)</li><li id="19cc" class="nc nd iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated"><code class="fe lt lu lv lw b">express</code></li></ul><p id="764e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在MySQL数据库中建立了一个虚拟表。要将数据库与express后端连接起来，请设置<code class="fe lt lu lv lw b">connection.js</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="2971" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:我已经建立了一个. env文件来存储连接细节</p><p id="6341" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们跳到编写API来通过ID获取这个人的详细信息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="dfc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用这段代码，我们将面临第一个例子中显示的问题。注意，这里出了什么问题？作为JavaScript开发人员，我们倾向于使用ES6模板文字。但是这样做，我们只是让我们的代码容易受到攻击。</p><h1 id="8b96" class="nu me iq bd mk nv nw nx mn ny nz oa mq jw ob jx mt jz oc ka mw kc od kd mz oe bi translated">我们如何防止这种情况发生？</h1><p id="aa9d" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf of lh li lj og ll lm ln oh lp lq lr ij bi translated">一些方法是:</p><h2 id="2f16" class="md me iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated"><strong class="ak"> 1。使用占位符:</strong></h2><p id="5cee" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf of lh li lj og ll lm ln oh lp lq lr ij bi translated">我们可以使用占位符，而不是在SQL查询中使用ES6文字，瞧！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用占位符更正了SQL查询</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/66060ad10c76d29e9201540ac84f2935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3B_OFmTrC9AWHomT_krA5Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">更正的SQL查询的输出</p></figure><h2 id="fdf8" class="md me iq bd mk ml mm dn mn mo mp dp mq lf mr ms mt lj mu mv mw ln mx my mz na bi translated">2.输入验证</h2><p id="d73e" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf of lh li lj og ll lm ln oh lp lq lr ij bi translated">让我们再举一个例子来理解为什么我们需要验证从请求中提取的输入。考虑获取给定城市中29岁的人的详细信息。我们将从用户那里获取城市信息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/a9cb77dc6fdfd1aad44272840e09c9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYtdfaFqlI_TcuiPV9flEg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GetPeopleByCity api预期输出</p></figure><p id="a037" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是该请求的API:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="ba1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设，输入城市是“曼哈顿”。</p><p id="5040" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果攻击者将参数作为<code class="fe lt lu lv lw b">“Manhattan”; — </code>而不是<code class="fe lt lu lv lw b"><strong class="ky ir">“Manhattan”</strong></code>发送，那么“—”注释掉SQL查询的其余部分，而“；”充当分隔符:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/e42e101e195586f70a7bd795adf29a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JyQj94L_kHhsOUUXbRaUow.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加“；—“导致产量的变化</p></figure><p id="272b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，SQL查询现在变成了:</p><pre class="kg kh ki kj gt lz lw ma mb aw mc bi"><span id="a911" class="md me iq lw b gy mf mg l mh mi">SELECT * FROM persons WHERE city = Manhattan ; --AND Age = 29</span></pre><p id="132a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而不是:</p><pre class="kg kh ki kj gt lz lw ma mb aw mc bi"><span id="ca43" class="md me iq lw b gy mf mg l mh mi">SELECT * FROM persons WHERE city = Manhattan AND Age = 29</span></pre><p id="2d18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此获取了停留在曼哈顿的所有用户的详细资料，从而影响了系统的数据隐私。</p><p id="4398" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与此示例类似，攻击者可以发送各种特殊字符组合来修改原始SQL查询。我们可以通过检查输入字符串是否只有字母或者根据用例来验证查询。</p><p id="9515" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是相同的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">验证从请求中提取的输入参数</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/25e1684e96e198a1c053469258a6c80a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ffKWw-Orca-61NmJng-Cw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">验证输入并避免SQL注入</p></figure><p id="19a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有用！！</p><h1 id="0ae3" class="nu me iq bd mk nv nw nx mn ny nz oa mq jw ob jx mt jz oc ka mw kc od kd mz oe bi translated">摘要</h1><p id="156c" class="pw-post-body-paragraph kw kx iq ky b kz ne jr lb lc nf ju le lf of lh li lj og ll lm ln oh lp lq lr ij bi translated">这些是理解SQL注入以及如何在node.js项目中防止它们以避免崩溃的一些最简单的例子。您可以通过寻找特定于语言的方法来避免SQL注入，从而更深入地了解这个主题。您还可以了解不同类型的SQL注入及其对代码库的影响。</p><p id="7bec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结帐:<a class="ae kv" href="https://www.invicti.com/blog/web-security/sql-injection-cheat-sheet/#LineComments" rel="noopener ugc nofollow" target="_blank"> SQL注入备忘单</a></p><p id="0974" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码GitHub链接:</p><div class="om on gp gr oo op"><a href="https://github.com/dsrao711/sql-injection.git" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd ir gy z fp ou fr fs ov fu fw ip bi translated">GitHub - dsrao711/sql-injection:这篇文章用代码解释了什么是sql注入以及如何…</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">SQL注入是最流行的网络黑客技术之一，它允许攻击者通过…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">github.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd kp op"/></div></div></a></div><pre class="kg kh ki kj gt lz lw ma mb aw mc bi"><span id="850f" class="md me iq lw b gy mf mg l mh mi"><strong class="lw ir">Want to Connect?</strong></span><span id="fc9a" class="md me iq lw b gy pe mg l mh mi">Here's my <a class="ae kv" href="https://www.linkedin.com/in/divya-rao-739a8b143" rel="noopener ugc nofollow" target="_blank">LinkedIn handle</a>.</span></pre></div></div>    
</body>
</html>