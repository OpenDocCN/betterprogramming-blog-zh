<html>
<head>
<title>Handling Errors With Swift Result Type</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Swift结果类型处理错误</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swift-result-type-6dfe1b41c8b4?source=collection_archive---------17-----------------------#2019-08-16">https://betterprogramming.pub/swift-result-type-6dfe1b41c8b4?source=collection_archive---------17-----------------------#2019-08-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5c40" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">Swift语言的新成员</h2><div class=""/><div class=""><h2 id="c812" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">创建更干净的API规范</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/b70cc035430d44facca2bbb990a8871f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXMZlCywFmY9WLlBuvOfrA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Nick Tiemeyer 在Unsplash上拍摄的照片</p></figure><p id="4b89" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我们将讨论Swift 5中引入的一种结果类型，以及如何使用它来处理错误。让我们借助下面的例子来讨论这个问题:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="f959" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在讨论Swift 中的<a class="ae lh" href="https://heartbeat.fritz.ai/error-handling-in-swift-c7987f9f8659" rel="noopener ugc nofollow" target="_blank">错误处理时，我们使用了optionals和try catch来处理错误。</a></p><p id="2a6d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当出现故障时，<em class="mg"> try/catch </em>允许我们交流更多关于出错原因的信息，这就是为什么在处理错误时try catch是更好的选择。</p><p id="1628" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有时，我们可能需要在失败的情况下处理除零以外的值，结果类型在这些不太常见的场景中很方便。</p><p id="1e82" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">结果类型在异步错误处理中非常有用，并被添加到Swift 5本地库中。如果您正在编写Swift 5代码，此结果类型会隐藏Swift点结果类型。</p><p id="c6c9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在下面的示例中，我们将为上面提到的代码示例创建自己的结果类型，如下所示:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="9007" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于两个泛型关联值，有两种互斥的可能性，如代码所示。</p><p id="4f8a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">结果类型的核心是成功的<code class="fe mh mi mj mk b">success</code>类型和必须符合快速错误的<code class="fe mh mi mj mk b">failure</code>类型。</p><p id="1692" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们试着在函数中使用它，如下所示:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="b636" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当成功值不存在时，该函数要么返回一个<code class="fe mh mi mj mk b">success</code>值，要么抛出一个<code class="fe mh mi mj mk b">failure</code>错误。</p><p id="baa3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们可以转换上面例子中的除法函数，使用我们刚刚创建的<code class="fe mh mi mj mk b">ResultType</code>:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="b78a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如你所见，我们不再需要使用投掷了，使用<code class="fe mh mi mj mk b">try?</code>的额外需求也消失了。</p><p id="ddbb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了获得实际值，我们可以使用<code class="fe mh mi mj mk b">getResult</code>函数，如下所示:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="5317" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们试图将分子除以零时，执行代码的结果将在控制台上显示如下内容:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/8197fa1e1f1668d5950bef6348550572.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*Y7RbyIiZvfF1PQbzoPAzzw.png"/></div></figure><p id="fbc6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如我们在上面的代码中所做的，能够将操作链接在一起是很有用的。函数式编程方法公开了像<code class="fe mh mi mj mk b">map</code>和<code class="fe mh mi mj mk b">flatMap</code>这样的函数，使我们能够进行类似的链接。</p><p id="7964" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们试着编写这些函数的自己的版本，这样我们就可以比较不同之处，但是，在我们这样做之前，让我们看看下图中的<code class="fe mh mi mj mk b">map</code>的声明:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/85ae2bffeedb599d9533415a89bf62ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*SuDaMMjk74rmtxMkXvwO_A.png"/></div></figure><p id="834b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因为我们已经知道了map函数的参数列表，所以让我们尝试为我们的自定义map函数创建自定义实现。</p><p id="1def" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们称这个函数为<code class="fe mh mi mj mk b">mapValues</code> <strong class="lk jd"> <em class="mg"> </em> </strong>并且，由于我们希望<strong class="lk jd"> <em class="mg"> </em> </strong>这个函数与<code class="fe mh mi mj mk b">ResultType</code>一起工作，让我们在一个<code class="fe mh mi mj mk b">ResultType</code>扩展中声明这个函数，如下所示:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="3df3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如我们在这里看到的，map函数是一个通用的类型<strong class="lk jd"> </strong> <code class="fe mh mi mj mk b">T</code>。它接受一个转换函数作为参数。</p><p id="26d9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">用指定的参数值写成参数中的<code class="fe mh mi mj mk b">transform</code>。</p><p id="633d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">转换从<code class="fe mh mi mj mk b">success</code>类型进行到通用类型<code class="fe mh mi mj mk b">T</code> <strong class="lk jd"> <em class="mg"> </em> </strong>，然后返回类型<code class="fe mh mi mj mk b">T</code>的结果。让我们看看当我们将它链接起来时，它们是如何组合在一起的:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="b732" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们使用自定义的<code class="fe mh mi mj mk b">mapValues()</code>函数来转换使用divide函数的值。</p><p id="e6a0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将1000除以两次得到一个结果。</p><p id="1484" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">执行上述代码的结果会将以下内容打印到控制台:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/8559ab31eb99a4fd74634aa55ba5f5b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*bOOe-xofAA5ufwMC81IyIA.png"/></div></figure><p id="09a0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意，为了从执行中获得10.0作为输出，我们需要调用两次<code class="fe mh mi mj mk b">getResult()</code>。</p><p id="91a8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是因为它嵌入在另一个<code class="fe mh mi mj mk b">ResultType</code>中，很像一个<code class="fe mh mi mj mk b">optional</code>在一个<code class="fe mh mi mj mk b">optional</code>中。</p><p id="49fa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了保持结果的简洁，我们也可以为flatMap()编写自定义实现。我们将在后续文章中看到这一点。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="2910" class="mv mw it bd mx my mz na nb nc nd ne nf ki ng kj nh kl ni km nj ko nk kp nl nm bi translated">结论</h1><p id="ae51" class="pw-post-body-paragraph li lj it lk b ll nn kd ln lo no kg lq lr np lt lu lv nq lx ly lz nr mb mc md im bi translated">在本文中，我们使用了<code class="fe mh mi mj mk b">ResultType</code>,并了解了如何对其进行组合以产生其他结果。这对于我们没有东西可扔的异步代码来说是理想的。</p><p id="8789" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们也可以<code class="fe mh mi mj mk b">ResultType</code>在函数式编程风格中，我们用<code class="fe mh mi mj mk b">map</code>示例来演示这一点。结果正式包含在Swift 5中。</p><p id="820f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢阅读！</p></div></div>    
</body>
</html>