<html>
<head>
<title>How to Write a Python Script to Create and Update a Changelog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何编写Python脚本来创建和更新Changelog</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-write-a-python-script-to-create-and-update-a-changelog-c2d39615064b?source=collection_archive---------15-----------------------#2022-04-21">https://betterprogramming.pub/how-to-write-a-python-script-to-create-and-update-a-changelog-c2d39615064b?source=collection_archive---------15-----------------------#2022-04-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5fa1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不再有生成器、日志或依赖——现在是Python！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b200f619811df959b38240aa47ebf4c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x-Zj7pAw-F_MbjvR"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@soymeraki?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Javier Allegue Barros </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="245f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你读了我的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-write-a-bash-script-to-create-and-update-a-changelog-de4df98985ab">上一篇关于如何编写bash脚本来创建和更新changelog的文章</a>，你可能也会对这篇文章感兴趣。我正在为工作编写一些python脚本，这时我想到一些Python开发者可能会喜欢用Python编写一个changelog脚本。</p><p id="5b0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在他们知道了！</p><p id="8d24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我添加了<a class="ae ky" href="https://github.com/macro6461/changelog-python" rel="noopener ugc nofollow" target="_blank"> Python支持</a>来扩展我的<a class="ae ky" href="https://github.com/macro6461/changelog-bash" rel="noopener ugc nofollow" target="_blank">原始changelog脚本</a>给偏爱Python的工程师。现在，您可以对Python代码使用相同的脚本逻辑。如果你是一个python开发者，并且想要在你的changelog创建/生成中添加更多的定制，你现在可以更容易地完成这些。</p><p id="bc32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于和我之前的脚本是一个逻辑，所以在功能上我就不太深入了。相反，我将强调一些句法差异。让我们直接跳进来吧！</p><p id="8a2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，创建一个<code class="fe lv lw lx ly b">changelog.py</code>文件来运行脚本的逻辑。您可以通过运行<code class="fe lv lw lx ly b">chmod 755 changelog.py</code>使该文件可执行。这样你就可以从命令行运行<code class="fe lv lw lx ly b">./changelog.py</code>,或者在另一个脚本中添加<code class="fe lv lw lx ly b">./changelog.py</code>来包含它。</p><p id="2af6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要我们的项目版本与我们的changelog同步。下面是我们如何在Bash中获得版本。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="8a6d" class="md me it ly b gy mf mg l mh mi">version="$(git describe --long)"</span></pre><p id="3405" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中，您可以使用下面的代码获得相同的结果。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="f515" class="md me it ly b gy mf mg l mh mi">version=subprocess.check_output([“git”, “describe”, “ — long”]).strip()</span></pre><p id="dbf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在代码的其他部分，您将需要使用字符串插值。Python中的做法与Bash中略有不同。Bash字符串插值见下文。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="0327" class="md me it ly b gy mf mg l mh mi">name="Matthew Croak"<br/>introduction="My name is $name"</span><span id="fcdf" class="md me it ly b gy mj mg l mh mi">echo $introduction</span><span id="f05b" class="md me it ly b gy mj mg l mh mi">&gt; "My name is Matthew"</span></pre><p id="fd5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是Python的字符串插值。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="935f" class="md me it ly b gy mf mg l mh mi">name="Matthew Croak"<br/>introduction="My name is {}".format(name)</span><span id="531a" class="md me it ly b gy mj mg l mh mi">print(introduction)</span><span id="734e" class="md me it ly b gy mj mg l mh mi">&gt; "My name is Matthew"</span></pre><p id="2b85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">字符串插值对脚本很重要，因为我们将从提供的字符串写入和重写changelog文件。这些字符串将包含更新的信息，例如今天的日期和包的版本。</p><p id="bc36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们编写我们的<code class="fe lv lw lx ly b">init</code>函数。这个函数将被用来决定我们是否想要创建一个新的changelog或者简单地更新一个现有的changelog。在bash中，像这样检查文件是否存在。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="e267" class="md me it ly b gy mf mg l mh mi">if test -f "$changelog" ; then<br/>  new_changelog_item<br/>else<br/>  new_changelog<br/>fi</span></pre><p id="044d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中，我们需要从<code class="fe lv lw lx ly b">os.path</code>导入<code class="fe lv lw lx ly b">exists</code>函数。</p><p id="a006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要导入这个函数，只需将<code class="fe lv lw lx ly b">from os.path import exists</code>放在<code class="fe lv lw lx ly b">changelog.py</code>文件的顶部。一旦我们导入了它，我们可以用下面的代码检查CHANGELOG.md。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="a036" class="md me it ly b gy mf mg l mh mi">if exists('CHANGELOG.md'):<br/>  new_changelog_item()<br/>else:<br/>  new_changelog()</span></pre><p id="ef59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们回顾一下如何读写我们的changelog文件。在Bash中，您可以这样读取文件:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="6528" class="md me it ly b gy mf mg l mh mi">while read line; do           <br/>  # code performed for each line<br/>done &lt; CHANGELOG.md</span></pre><p id="fadb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中，我们使用内置的<code class="fe lv lw lx ly b">open</code>和<code class="fe lv lw lx ly b">readlines</code>函数。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="58bc" class="md me it ly b gy mf mg l mh mi">changelog = open('CHANGELOG.md', 'r')<br/>changelog_items = changelog.readlines()</span><span id="1686" class="md me it ly b gy mj mg l mh mi">for line in changelog_items:<br/>  # code performed for each line<br/></span></pre><p id="74e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于如何在Python中读取文件的更多信息，请查看本文。</p><p id="76e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了需要读取我们的文件，我们还需要<em class="mk">更新</em>我们的changelog文件。</p><p id="dfff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Bash中，这是使用<code class="fe lv lw lx ly b"><a class="ae ky" href="https://www.geeksforgeeks.org/sed-command-in-linux-unix-with-examples/" rel="noopener ugc nofollow" target="_blank">sed</a></code>完成的。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="359c" class="md me it ly b gy mf mg l mh mi">while read line; do<br/>  if [[ $line == "## [Unreleased]"* ]]; then<br/>    <strong class="ly iu">sed -i 's/old_text/new_text/' CHANGELOG.md</strong><br/>done &lt; CHANGELOG.md</span></pre><p id="6553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Python中，我们可以利用内置函数<code class="fe lv lw lx ly b">open</code>和<code class="fe lv lw lx ly b">writelines</code>。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="3131" class="md me it ly b gy mf mg l mh mi">changelog = open('CHANGELOG.md', 'w')<br/>changelog_items = changelog.writelines(new_lines)</span></pre><p id="429e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你注意到当我们使用<code class="fe lv lw lx ly b">open</code>读取文件时，我们如何使用<code class="fe lv lw lx ly b">"r"</code>，当我们使用<code class="fe lv lw lx ly b">open</code>将写入文件时，我们如何使用<code class="fe lv lw lx ly b">"w"</code>。下面是我们使用Python更新changelog中特定行的剩余代码。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="7a4f" class="md me it ly b gy mf mg l mh mi">index = -1<br/>changelog_items=read_changelog()<br/>for line in changelog_items:<br/>  index+=1<br/>  if "## [Unreleased]" in line:<br/>    changelog_items[index] = "## [Unreleased]\n{}\n### Added\n- ADD CHANGE HERE!\n".format(item)<br/>    write_changelog_lines(changelog_items)<br/>    break</span></pre><p id="88e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将读/写代码分解到它们自己的函数中，以使代码更具可读性。下面是<code class="fe lv lw lx ly b">read_changelog</code>的代码。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="4ed8" class="md me it ly b gy mf mg l mh mi">def read_changelog():<br/>  changelog = open('CHANGELOG.md', 'r')<br/>  changelog_items = changelog.readlines()<br/>  return changelog_items</span></pre><p id="b1c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是<code class="fe lv lw lx ly b">write_changelog_lines</code>的代码。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="5720" class="md me it ly b gy mf mg l mh mi">def write_changelog_lines(changelog_items):<br/>  with open('CHANGELOG.md', 'w') as changelog:<br/>    changelog.writelines(changelog_items)</span></pre><p id="7755" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你知道了！添加了python对纯<em class="mk">脚本的支持，以合并到您的应用程序中来生成变更日志，添加变更日志项目。它还在格式和变更日志内容方面为您提供了灵活性，而不需要生成器、日志或其他依赖项。完整代码在<a class="ae ky" href="https://github.com/macro6461/changelog-python/blob/main/changelog.py" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</em></p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="9cb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://matt-croak.medium.com/membership" rel="noopener"> <strong class="lb iu"> <em class="mk">升级您的免费Medium会员资格</em> </strong> </a> <em class="mk">并接收各种出版物上数千名作家的无限量、无广告的故事。这是一个附属链接，你的会员资格的一部分帮助我为我创造的内容获得奖励。</em></p><p id="0d86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mk">您还可以通过电子邮件</em> <a class="ae ky" href="https://matt-croak.medium.com/subscribe" rel="noopener"> <strong class="lb iu"> <em class="mk">进行订阅</em> </strong> </a> <em class="mk">每当我发布新内容时，您都会收到通知！</em></p><p id="c588" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mk">谢谢！</em></p><h1 id="4f76" class="ms me it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">参考</h1><div class="nj nk gp gr nl nm"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-write-a-bash-script-to-create-and-update-a-changelog-de4df98985ab"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">如何编写Bash脚本来创建和更新Changelog</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">不再有生成器、日志或依赖项</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">better编程. pub</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a href="https://github.com/macro6461/changelog-python" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">GitHub-macro 6461/changelog-python:生成和更新changelog的Python脚本</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">这是创建和更新changelog的纯python脚本的代码。不需要发电机。不需要…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">github.com</p></div></div><div class="nv l"><div class="ob l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a href="https://www.geeksforgeeks.org/read-a-file-line-by-line-in-python/" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">在Python - GeeksforGeeks中逐行读取文件</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">先决条件:Python提供了创建、写入和读取文件的内置函数。有两种类型的文件…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">www.geeksforgeeks.org</p></div></div><div class="nv l"><div class="oc l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a href="https://www.geeksforgeeks.org/sed-command-in-linux-unix-with-examples/" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">Linux/Unix中的Sed命令及示例</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">UNIX中的SED命令代表流编辑器，它可以对文件执行许多功能，如搜索、查找和…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">www.geeksforgeeks.org</p></div></div><div class="nv l"><div class="od l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a href="https://github.com/macro6461/changelog-python/blob/main/changelog.py" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">主宏中的changelog-python/changelog . py 6461/changelog-python</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">github.com</p></div></div><div class="nv l"><div class="oe l nx ny nz nv oa ks nm"/></div></div></a></div></div></div>    
</body>
</html>