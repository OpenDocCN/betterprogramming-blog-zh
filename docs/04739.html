<html>
<head>
<title>The Singleton in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">斯威夫特的单身族</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/singleton-in-swift-8da9bea06339?source=collection_archive---------2-----------------------#2020-05-05">https://betterprogramming.pub/singleton-in-swift-8da9bea06339?source=collection_archive---------2-----------------------#2020-05-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ae2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">确保你有一样东西！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d2752f7279288ea896d2de89680fc2b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j-tDRHpyA-87MUJi"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">泰勒·拉斯托维奇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="c6b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">难度:初级|简单<strong class="lb iu">|<strong class="lb iu">普通</strong> |挑战</strong></p><p id="9cce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作用域是编程语言中某些东西的可见性。一种让某些东西到处可用的方法是简单地创建一个全局变量或方法。</p><p id="abd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，如果您想要更复杂的东西—也许是一个可以在许多地方访问的类—您可能会遇到一个问题。如何确保在应用程序的不同位置(或不同的线程)使用相同的引用？这就是单身族的用武之地。</p><p id="4b36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想跳到Swift中的单件示例，请跳到视频</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lw lx l"/></div></figure></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="bda6" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">先决条件</h1><ul class=""><li id="cb5f" class="mx my it lb b lc mz lf na li nb lm nc lq nd lu ne nf ng nh bi translated">能够产生一句“你好，世界！”iOS应用程序(参见本指南<a class="ae ky" href="https://medium.com/@stevenpcurtis.sc/your-first-swift-application-without-a-mac-79598ad839f8" rel="noopener">)。</a></li><li id="38ec" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">对警卫有所了解(见<a class="ae ky" href="https://medium.com/@stevenpcurtis.sc/precondition-assert-fatal-error-or-guard-in-your-swift-code-5f9297658be0" rel="noopener">这篇文章</a>)。</li><li id="09b6" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><a class="ae ky" href="https://medium.com/@stevenpcurtis.sc/swift-initializers-fc12908a9106" rel="noopener">初始化器</a>的隐含知识。</li></ul></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="f917" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">术语</h1><ul class=""><li id="9462" class="mx my it lb b lc mz lf na li nb lm nc lq nd lu ne nf ng nh bi translated">类:在Swift中定义的对象，使用按引用传递语义。</li><li id="9dab" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">设计模式:软件设计中常见问题的解决方案。</li><li id="cc85" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">实例:某事物的一个例子或一次出现。</li><li id="6a08" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">实例化:特定对象的创建。</li><li id="b737" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">Singleton:保证一个类只创建一个实例的一种实例化方式。</li></ul></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="5dac" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">作为设计模式的单例</h1><p id="0363" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">singleton是一种设计模式，它确保一个类只有一个实例，并且无论您在哪里尝试访问该类，您都可以访问该类的singleton版本。</p><p id="156a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一种广泛使用的解决一个类的多个实例问题的方法，它通常被称为设计模式。</p><p id="4818" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，它被如此广泛地使用，以至于苹果自己在类似<a class="ae ky" href="https://developer.apple.com/documentation/foundation/urlsession/1409000-shared" rel="noopener ugc nofollow" target="_blank"> URLSession.shared </a>的类中使用它(注意，苹果称之为共享单例会话对象)。</p><h2 id="15cb" class="nq mg it bd mh nr ns dn ml nt nu dp mp li nv nw mr lm nx ny mt lq nz oa mv ob bi translated">线索就在名字里</h2><p id="f647" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">单例需要是唯一的、单一的实例。</p><p id="3be4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，初始化器应该是私有的，以防止客户创建他们自己的singleton对象的实例(因为那样的话，你知道，它就不是singleton了)。</p><p id="71f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使单例只能创建一次，但如果多个线程试图一次实例化单例又会怎样呢？这会带来很多麻烦，所以我们需要确保我们的代码是线程安全的。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="c165" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">记录在案的单身者(谢谢，苹果)</h1><h2 id="36e5" class="nq mg it bd mh nr ns dn ml nt nu dp mp li nv nw mr lm nx ny mt lq nz oa mv ob bi translated">简单的独生子</h2><p id="9cd0" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">在文档中，苹果有一种方法来创建单例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc lx l"/></div></figure><h2 id="0306" class="nq mg it bd mh nr ns dn ml nt nu dp mp li nv nw mr lm nx ny mt lq nz oa mv ob bi translated">具有属性的单例</h2><p id="92aa" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">然后他们继续回答这个问题:有方法和属性要设置的单例怎么办？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc lx l"/></div></figure><h2 id="4736" class="nq mg it bd mh nr ns dn ml nt nu dp mp li nv nw mr lm nx ny mt lq nz oa mv ob bi translated">Apple的singleton与属性的实现</h2><p id="fbc2" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">当我们实现这个的时候，我们需要对初始化更加小心一点——我们<em class="lv">只</em>希望我们客户端的用户使用共享实例，永远不要创建他们自己的singleton实例(记住，实例应该是单数)。</p><p id="cd6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个实现给了我们一个计数器，这意味着我们可以看到什么时候<code class="fe od oe of og b">incCounter()</code>被点击。</p><p id="f972" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意初始化器是私有的，所以它不能被这个类的错误用户调用(因为这是一个单例，这应该是唯一的一个类)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc lx l"/></div></figure><p id="90ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您希望在控制台上打印什么内容？</p><p id="3012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你考虑这件事的时候，我会等一会儿。</p><p id="ce07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">明白了吗？</p><p id="943d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，是<code class="fe od oe of og b">4</code>，因为计数器从1开始计数，然后有三个电话打到<code class="fe od oe of og b">incCounter()</code>。而且由于这是一个单例，所以如果你试图使用同一个实例的不同“实例”也没关系。</p><h2 id="8ae3" class="nq mg it bd mh nr ns dn ml nt nu dp mp li nv nw mr lm nx ny mt lq nz oa mv ob bi translated">防止子类化</h2><p id="478d" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">有一个危险，这个危险就是Singleton的公共API可能被误用。关键字<code class="fe od oe of og b">final</code>防止类被子类化，这意味着任何类都不能从它继承，并且类的行为不能被类的用户改变。</p><p id="647b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是通过在声明类之前编写<code class="fe od oe of og b">final</code>关键字来实现的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc lx l"/></div></figure><p id="df8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它可以放在本文中任何一个类的前面，使它也成为<code class="fe od oe of og b">final</code>。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><p id="a259" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那似乎很好。他们甚至推荐使用单例或网络管理器来发出HTTP请求。</p><p id="d395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你看到可能的问题了吗？如果没有，你当然应该继续读下去。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="d56c" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">创建网络管理器来发出HTTP请求</h1><h2 id="3d4e" class="nq mg it bd mh nr ns dn ml nt nu dp mp li nv nw mr lm nx ny mt lq nz oa mv ob bi translated">基本原理</h2><p id="1431" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">网络管理员将使用<code class="fe od oe of og b">URLSession</code>来创建网络请求。</p><p id="3660" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，这个简化的网络管理器将只通过一个方法向<code class="fe od oe of og b">URL</code>发出一个简单的请求，该方法要求网络管理器发出那个请求。</p><p id="456c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重点是我们想要创建一个可以被<em class="lv">嘲弄</em> <strong class="lb iu"> <em class="lv"> </em> </strong>的对象来进行测试。</p><h2 id="9ebd" class="nq mg it bd mh nr ns dn ml nt nu dp mp li nv nw mr lm nx ny mt lq nz oa mv ob bi translated">使用依赖注入</h2><p id="7aae" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated"><code class="fe od oe of og b">URLSession</code>已经是singleton了，是进行网络调用的对象。这可以从主类中抽象出来，所以可以将<code class="fe od oe of og b">URLSession</code>注入到网络管理器中，或者用作模拟类。完整的实现有点复杂(有几个协议围绕着这个实现)，要看到这一点，请查看完整的<a class="ae ky" href="https://medium.com/@stevenpcurtis.sc/my-basic-httpmanager-in-swift-db2be1e340c2" rel="noopener"> HTTPManager类</a>。</p><p id="bf5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是一个相当简单的演示(如前所述，如果你感兴趣的话，看看完整的类可能是有益的)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc lx l"/></div></figure><p id="b4b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码(在提供的测试中)给出了一种以简化的方式模拟网络调用的方法。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="c645" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">结论</h1><p id="2359" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">你实现应用程序的任何方式在业内其他人看来都可能是对或错的。</p><p id="5fbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在我们的军械库中，单件衣服是“小心使用”的工具。苹果公司确实使用了它们，但是您可能也想在您实现中使用依赖注入，这也是事实。</p><p id="db6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">适合您工作的工具？那是你的决定。</p><p id="98ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你在那里的时候，为什么不看看<a class="ae ky" href="https://github.com/stevencurtis/SwiftCoding/tree/master/Singleton/Code" rel="noopener ugc nofollow" target="_blank">回购</a>中的代码呢？</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="c0e0" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">扩展你的知识</h1><ul class=""><li id="fa99" class="mx my it lb b lc mz lf na li nb lm nc lq nd lu ne nf ng nh bi translated">存储的属性被苹果记录为单例。</li><li id="0cdb" class="mx my it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我有一个<a class="ae ky" href="https://medium.com/@stevenpcurtis.sc/my-basic-httpmanager-in-swift-db2be1e340c2" rel="noopener">完整的基本HTTPManager </a>类，你可以看看。您还可以看到依赖注入在实践中是如何实现的。</li></ul></div></div>    
</body>
</html>