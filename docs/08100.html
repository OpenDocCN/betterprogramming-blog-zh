<html>
<head>
<title>Build a Simple PHP Login Form With reCAPTCHA v3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用reCAPTCHA v3构建一个简单的PHP登录表单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-simple-php-login-form-with-recaptcha-v3-d3362805e661?source=collection_archive---------3-----------------------#2021-03-25">https://betterprogramming.pub/build-a-simple-php-login-form-with-recaptcha-v3-d3362805e661?source=collection_archive---------3-----------------------#2021-03-25</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ad7c" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用公共资源登录的通用用户名和密码</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj kj"><img src="../Images/fa2e76ecfa10ea3f8e7da292978d05c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*8ZtznB3YGwa6__h_WTpPmQ.png"/></div><p class="kr ks gk gi gj kt ku bd b be z dk translated">作者照片。来自placeholder.com<a class="ae kv" href="https://placeholder.com/logos/" rel="noopener ugc nofollow" target="_blank">的标志</a>。</p></figure></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="fa9d" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">目录</h1><pre class="kk kl km kn gu lv lw lx ly aw lz bi"><span id="1509" class="ma le iu lw b gz mb mc l md me">· <a class="ae kv" href="#3dd4" rel="noopener ugc nofollow">Introduction</a><br/>· <a class="ae kv" href="#11e3" rel="noopener ugc nofollow">reCAPTCHA v3</a><br/>· <a class="ae kv" href="#b100" rel="noopener ugc nofollow">Index.php</a><br/>· <a class="ae kv" href="#1699" rel="noopener ugc nofollow">form.php</a><br/>· <a class="ae kv" href="#4d64" rel="noopener ugc nofollow">page.php</a><br/>· <a class="ae kv" href="#670f" rel="noopener ugc nofollow">download.php</a><br/>· <a class="ae kv" href="#1817" rel="noopener ugc nofollow">logout.php</a><br/>· <a class="ae kv" href="#b926" rel="noopener ugc nofollow">style.css</a><br/>· <a class="ae kv" href="#42de" rel="noopener ugc nofollow">Conclusion</a><br/>· <a class="ae kv" href="#ab67" rel="noopener ugc nofollow">Reference</a></span></pre></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="3dd4" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">介绍</h1><p id="35c0" class="pw-post-body-paragraph mf mg iu mh b mi mj jv mk ml mm jy mn mo mp mq mr ms mt mu mv mw mx my mz na in bi translated">我妻子用WordPress写博客，用Dropbox和她的时事通讯订阅者分享她的PDF资源。她与用户分享Dropbox链接。如果你有网址，每个人都能看到，她也不介意。</p><p id="007f" class="pw-post-body-paragraph mf mg iu mh b mi nb jv mk ml nc jy mn mo nd mq mr ms ne mu mv mw nf my mz na in bi translated">她想把Dropbox中的资源转移到自己的网站上。她四处寻找一个简单的登录插件，访问者可以使用一个共同的用户名和密码。她也想安装reCAPTCHA。在尝试了一些WP插件后，她放弃了。她找不到自己想要的，就让我想办法解决。</p><p id="eb46" class="pw-post-body-paragraph mf mg iu mh b mi nb jv mk ml nc jy mn mo nd mq mr ms ne mu mv mw nf my mz na in bi translated">为了让它使用起来非常简单，我没有使用Composer、数据库或任何库。</p><p id="917b" class="pw-post-body-paragraph mf mg iu mh b mi nb jv mk ml nc jy mn mo nd mq mr ms ne mu mv mw nf my mz na in bi translated">您可以在reCAPTCHA 上观看演示<a class="ae kv" href="http://recaptcha-example.42web.io/index.php" rel="noopener ugc nofollow" target="_blank">。</a></p><ul class=""><li id="a843" class="ng nh iu mh b mi nb ml nc mo ni ms nj mw nk na nl nm nn no bi translated">用户名:演示</li><li id="8ff1" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">密码:密码</li></ul><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj nu"><img src="../Images/292747c0d09ca54a1304579fced96762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8Dq-HhrMzf-45RGWvs1uRw.gif"/></div></div></figure></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="11e3" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">reCAPTCHA v3</h1><p id="df1c" class="pw-post-body-paragraph mf mg iu mh b mi mj jv mk ml mm jy mn mo mp mq mr ms mt mu mv mw mx my mz na in bi translated"><a class="ae kv" href="https://developers.google.com/recaptcha/docs/v3" rel="noopener ugc nofollow" target="_blank"> reCAPTCHA v3 </a>不需要用户交互。这是一种基于分数的ReCaptcha方法。reCAPTCHA v3可以测试一个网站的<a class="ae kv" href="https://developers.google.com/search/blog/2018/10/introducing-recaptcha-v3-new-way-to" rel="noopener ugc nofollow" target="_blank">人类与机器人的活动</a>，通过返回一个分数来告诉你一个交互有多可疑。</p><blockquote class="nz oa ob"><p id="ddc2" class="mf mg oc mh b mi nb jv mk ml nc jy mn od nd mq mr oe ne mu mv of nf my mz na in bi translated">reCAPTCHA v3在没有用户摩擦的情况下为每个请求返回一个分数。分数基于与您的网站的交互，使您能够对您的网站采取适当的措施。”— <a class="ae kv" href="https://developers.google.com/recaptcha/docs/v3" rel="noopener ugc nofollow" target="_blank"> reCAPTCHA v3 </a></p></blockquote><p id="7668" class="pw-post-body-paragraph mf mg iu mh b mi nb jv mk ml nc jy mn mo nd mq mr ms ne mu mv mw nf my mz na in bi translated">首先，<a class="ae kv" href="https://www.google.com/recaptcha/admin/create" rel="noopener ugc nofollow" target="_blank">注册一个新站点</a>并从Google reCAPTCHA管理站点获取站点密钥和秘密密钥。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj og"><img src="../Images/7e32f01d36db07d04eefa0f855695c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8lOZD4TIH9VByephNERlQg.png"/></div></div><p class="kr ks gk gi gj kt ku bd b be z dk translated">新注册后的站点密钥和秘密密钥</p></figure><p id="c913" class="pw-post-body-paragraph mf mg iu mh b mi nb jv mk ml nc jy mn mo nd mq mr ms ne mu mv mw nf my mz na in bi translated">对于开发，您可以将localhost添加到Domains字段。显影后就可以去掉了。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gi gj oh"><img src="../Images/2a2472807e21e1e51819a2f580235983.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*iUf0PCYUeJprqSTrflGuCA.png"/></div></div><p class="kr ks gk gi gj kt ku bd b be z dk translated">您可以在“域”字段中添加本地主机。</p></figure></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="b100" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">Index.php</h1><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><ul class=""><li id="972e" class="ng nh iu mh b mi nb ml nc mo ni ms nj mw nk na nl nm nn no bi translated">第10行:我使用了谷歌字体。</li><li id="5338" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第15行:调用<code class="fe ok ol om lw b">session_start()</code>来使用会话变量。</li><li id="5391" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第18-25行:如果设置了一个“安全的”会话，并且会话内容是“安全的”，我们使用<code class="fe ok ol om lw b">download.php</code>。否则，我们用<code class="fe ok ol om lw b">form.php</code>。</li></ul></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="1699" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">form.php</h1><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><ul class=""><li id="0532" class="ng nh iu mh b mi nb ml nc mo ni ms nj mw nk na nl nm nn no bi translated">第1行和第23行:用您的站点密钥替换<code class="fe ok ol om lw b">your-recaptcha-site-key</code>。</li><li id="854d" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第5-8行:当URL有一个<code class="fe ok ol om lw b">err</code>变量并且它的值是<code class="fe ok ol om lw b">400</code>时，显示一条错误消息。参见<code class="fe ok ol om lw b">page.php</code>。</li><li id="346a" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第10-27行:提交表单时使用<code class="fe ok ol om lw b">page.php</code>。我们使用用户名和密码作为输入字段。为ReCaptcha响应添加隐藏的输入字段。</li><li id="4bdc" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第28-35行:使用<code class="fe ok ol om lw b">grecaptcha</code>对象中的<code class="fe ok ol om lw b"><a class="ae kv" href="https://developers.google.com/recaptcha/docs/v3" rel="noopener ugc nofollow" target="_blank">execute</a></code>方法和ReCaptcha站点键。将返回的令牌存储到<code class="fe ok ol om lw b">recaptchaResponse</code>。</li></ul></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="4d64" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">page.php</h1><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><ul class=""><li id="91bf" class="ng nh iu mh b mi nb ml nc mo ni ms nj mw nk na nl nm nn no bi translated">第2行:调用<code class="fe ok ol om lw b">session_start()</code>来使用会话变量。</li><li id="fe1f" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第4-7行:设置变量。您可以更改<code class="fe ok ol om lw b">$username</code>和<code class="fe ok ol om lw b">$password</code>值。</li><li id="ee56" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第12行:更改<code class="fe ok ol om lw b">your-recaptcha-secret-key</code>。</li><li id="5935" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第9-29行:检查<code class="fe ok ol om lw b">$_POST['uname']</code>是否置位，<code class="fe ok ol om lw b">$_POST['uname']</code>是否等于<code class="fe ok ol om lw b">$username</code>值，<code class="fe ok ol om lw b">$_POST['psw']</code>是否等于<code class="fe ok ol om lw b">$password</code>值。<br/>如果失败，我们重定向到URL中带有<code class="fe ok ol om lw b">err=400</code>的索引页面。使用<code class="fe ok ol om lw b">file_get_contents</code>获取ReCaptcha响应，它将内容读入一个字符串。使用<code class="fe ok ol om lw b">json_decode</code>方法将字符串改为JSON。<br/>如果响应的成功值为<code class="fe ok ol om lw b">true</code>，则其得分高于0.5，并且其操作为“提交”，则将<code class="fe ok ol om lw b">secured</code>会话设置为“安全”。然后重定向到<code class="fe ok ol om lw b">index.php</code>。如果失败，那么重定向到URL中带有<code class="fe ok ol om lw b">err=400</code>的索引页面。</li></ul></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="670f" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">download.php</h1><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><ul class=""><li id="b81c" class="ng nh iu mh b mi nb ml nc mo ni ms nj mw nk na nl nm nn no bi translated">第2-4行:链接到<code class="fe ok ol om lw b">logout.php</code>。</li><li id="d423" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第12行:使用<code class="fe ok ol om lw b">glob</code>函数找到所有的PNG文件。</li><li id="3db4" class="ng nh iu mh b mi np ml nq mo nr ms ns mw nt na nl nm nn no bi translated">第13-17行:下载目录保存了与PNG和PDF同名的文件(例如<code class="fe ok ol om lw b">file.pdf</code>、<code class="fe ok ol om lw b">file.png</code>)。我们使用PNG文件作为图像，使用PDF文件作为使用<code class="fe ok ol om lw b">download</code>属性的链接。当访问者点击一张图片时，它会下载它的PDF文件。</li></ul></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="1817" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">logout.php</h1><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="0316" class="pw-post-body-paragraph mf mg iu mh b mi nb jv mk ml nc jy mn mo nd mq mr ms ne mu mv mw nf my mz na in bi translated">调用<code class="fe ok ol om lw b">session_start()</code>使用会话变量并销毁会话。我们重定向到一个网页。</p></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="b926" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">style.css</h1><p id="86b8" class="pw-post-body-paragraph mf mg iu mh b mi mj jv mk ml mm jy mn mo mp mq mr ms mt mu mv mw mx my mz na in bi translated">我在<code class="fe ok ol om lw b">.container .gallery</code>类中使用了flex。</p><p id="78b1" class="pw-post-body-paragraph mf mg iu mh b mi nb jv mk ml nc jy mn mo nd mq mr ms ne mu mv mw nf my mz na in bi translated">你可以在GitHub 上看到<code class="fe ok ol om lw b">style.css</code> <a class="ae kv" href="https://gist.github.com/shinokada/4afc8cc2ffc3bfcb01a0ea3335a8cff5" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="42de" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">结论</h1><p id="c77e" class="pw-post-body-paragraph mf mg iu mh b mi mj jv mk ml mm jy mn mo mp mq mr ms mt mu mv mw mx my mz na in bi translated">这种方法易于设置和维护，因为您不需要使用数据库。如果你不介意访问者能够分享你的网址和登录信息，这可能是一个很好的解决方案。</p><p id="4293" class="pw-post-body-paragraph mf mg iu mh b mi nb jv mk ml nc jy mn mo nd mq mr ms ne mu mv mw nf my mz na in bi translated">请在<a class="ae kv" href="https://github.com/shinokada/recaptcha-demo" rel="noopener ugc nofollow" target="_blank">Github回购</a>中找到代码。</p></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><p id="29c8" class="pw-post-body-paragraph mf mg iu mh b mi nb jv mk ml nc jy mn mo nd mq mr ms ne mu mv mw nf my mz na in bi translated"><strong class="mh iv">通过</strong> <a class="ae kv" href="https://blog.codewithshin.com/membership" rel="noopener ugc nofollow" target="_blank"> <strong class="mh iv">成为</strong> </a> <strong class="mh iv">会员，获得媒体上所有故事的访问权限。</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj on"><img src="../Images/0be3ee559fee844cb75615290e4a8b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*DjTM9iFtVc2wlcWcOms7VQ.png"/></div><p class="kr ks gk gi gj kt ku bd b be z dk translated"><a class="ae kv" href="https://blog.codewithshin.com/subscribe" rel="noopener ugc nofollow" target="_blank">https://blog.codewithshin.com/subscribe</a></p></figure></div><div class="ab cl kw kx hy ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="in io ip iq ir"><h1 id="ab67" class="ld le iu bd lf lg lh li lj lk ll lm ln ka lo kb lp kd lq ke lr kg ls kh lt lu bi translated">参考</h1><ul class=""><li id="5085" class="ng nh iu mh b mi mj ml mm mo oo ms op mw oq na nl nm nn no bi translated"><a class="ae kv" href="https://code.tutsplus.com/tutorials/example-of-how-to-add-google-recaptcha-v3-to-a-php-form--cms-33752" rel="noopener ugc nofollow" target="_blank">如何将Google reCAPTCHA v3添加到PHP表单的示例</a></li></ul></div></div>    
</body>
</html>