<html>
<head>
<title>Dynamically Add/Remove Validators in Angular Reactive Forms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以角度反应形式动态添加/删除验证器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/dynamically-add-remove-validators-in-angular-reactive-forms-8ea83c44529?source=collection_archive---------1-----------------------#2020-11-27">https://betterprogramming.pub/dynamically-add-remove-validators-in-angular-reactive-forms-8ea83c44529?source=collection_archive---------1-----------------------#2020-11-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b5d4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在角度反应表单中添加和删除动态验证的简单指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/90b4bcbb61865eec4d1cb5342d48f535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dI8ulj20RBlsrv4z.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="41c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你正在开发一个<a class="ae lu" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>应用程序，你可能会面临这样的情况，你必须在表单控件中动态地添加或删除一些验证器。例如，假设您的反应式表单中有一个<code class="fe lv lw lx ly b">County</code>字段，您希望根据用户选择的国家将它设置为必填字段。为此，您可能会考虑根据所选择的国家在<code class="fe lv lw lx ly b">County</code>字段中添加和删除<code class="fe lv lw lx ly b">Required</code>验证器。</p><p id="0402" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗯，对于这种场景，Angular帮了我们很大的忙。我们在Angular中有一些内置函数，可以用来有条件地设置验证器——多亏了反应式表单，我们可以非常非常容易地做到这一点。</p><p id="4349" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以我们从头开始吧。</p><p id="5933" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望你有一个反应形式的运行角度应用程序。对我来说，我有一个非常简单的表单，有两个字段。一个是给<code class="fe lv lw lx ly b">Country</code>的，第二个是给<code class="fe lv lw lx ly b">County</code>的，就像开头提到的。</p><p id="823f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我有一个模板和相应的组件代码，如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="12c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们一步一步地讨论我们在这里做什么。</p><ol class=""><li id="5e0d" class="mb mc it la b lb lc le lf lh md ll me lp mf lt mg mh mi mj bi translated">我们刚刚创建了一个简单的反应式表单，有两个字段，<code class="fe lv lw lx ly b">Country</code>和<code class="fe lv lw lx ly b">County</code>。</li><li id="d560" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated">我们有一个<code class="fe lv lw lx ly b">Country</code>的下拉列表，每当下拉列表的值改变时，我们调用一个函数<code class="fe lv lw lx ly b">onCountryChange()</code>来更新<code class="fe lv lw lx ly b">County</code>的验证器。</li><li id="4d2a" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated">只是为了验证是否设置了<code class="fe lv lw lx ly b">Required</code>验证器，我们正在检查<code class="fe lv lw lx ly b">County</code>字段是否有<code class="fe lv lw lx ly b">required</code>错误。</li><li id="a0ec" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated">我们只是用默认验证初始化了反应式表单。</li><li id="6e38" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated">在<code class="fe lv lw lx ly b">onCountryChange()</code>方法中，我们检查所选国家的值。如果这个值是<code class="fe lv lw lx ly b">B</code>(只是在我的例子中)，我们用<code class="fe lv lw lx ly b">setValidators()</code>方法为<code class="fe lv lw lx ly b">County</code>设置<code class="fe lv lw lx ly b">Required</code>验证器。</li><li id="23f2" class="mb mc it la b lb mk le ml lh mm ll mn lp mo lt mg mh mi mj bi translated">如果<code class="fe lv lw lx ly b">Country</code>不是<code class="fe lv lw lx ly b">B</code>，我们只是清除验证器。</li></ol><p id="27bf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是它在浏览器中的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/8fdb459b5f106e410f8e3d057ba051c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/0*NzKFNzZjUxB1hFim.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/f871d0e113630fd77f7dba8b2dbc3255.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/0*AuNZNcjaa66GJxJj.png"/></div></figure><p id="76d2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">仅此而已。在角反应形式中添加或删除验证器就是这么简单。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="42a9" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated"><strong class="ak">需要记住的一些要点</strong></h1><p id="e771" class="pw-post-body-paragraph ky kz it la b lb nq ju ld le nr jx lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">1.方法从表单控件中移除所有先前的/默认的验证器。例如，让我们假设在表单初始化期间，您为<code class="fe lv lw lx ly b">County</code>设置了<code class="fe lv lw lx ly b">maxLength</code>和<code class="fe lv lw lx ly b">minLength</code>验证器。但是一旦<code class="fe lv lw lx ly b">setValidators([Validators.required])</code>执行，它将从<code class="fe lv lw lx ly b">County</code>中移除<code class="fe lv lw lx ly b">maxLength</code>和<code class="fe lv lw lx ly b">minLength</code>，并且只设置<code class="fe lv lw lx ly b">Required</code>验证器。</p><p id="febb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，如果您想同时拥有<code class="fe lv lw lx ly b">maxLength</code>和<code class="fe lv lw lx ly b">minLength</code> <strong class="la iu"> </strong>，只需这样做:</p><pre class="kj kk kl km gt nv ly nw nx aw ny bi"><span id="1390" class="nz mz it ly b gy oa ob l oc od">setValidators([Validators.required, Validators.maxLength(10), Validators.minLength(5)])</span></pre><p id="988e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.在更新(添加或删除)验证器之后，总是使用<code class="fe lv lw lx ly b">updateValueAndValidity()</code>方法。因为你所有与控制相关的改变只有在你放了这个语句，也就是<code class="fe lv lw lx ly b">updateValueAndValidity()</code>才会体现出来。</p><p id="19f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.不幸的是，Angular没有提供从表单控件中只移除一个验证器的方法。它有一个<code class="fe lv lw lx ly b">clearValidators()</code>方法，但是这将移除所有的验证器。</p><p id="b29b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我们可以做两件事。我们可以使用<code class="fe lv lw lx ly b">clearValidators()</code>来删除所有的验证器，然后使用<code class="fe lv lw lx ly b">setValidators()</code>来设置需要的验证，或者我们可以直接使用<code class="fe lv lw lx ly b">setValidators()</code>来设置需要的验证器(没有您不想要的验证器)。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="efb0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是这篇文章的内容。我希望这有所帮助。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="e325" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">参考</h1><p id="45e5" class="pw-post-body-paragraph ky kz it la b lb nq ju ld le nr jx lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">最终代码可在GitHub上获得:</p><div class="oe of gp gr og oh"><a href="https://github.com/gouravkajal/dummyApp-dynamicFormValidation" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">gouravkajal/dummy app-dynamicFormValidation</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">此项目是使用Angular CLI版本11.0.2生成的。为开发服务器运行ng serve。导航到…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div></div></a></div><p id="c044" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！</p></div></div>    
</body>
</html>