<html>
<head>
<title>AutoScraper and Flask: Create an API From Any Website in Less Than 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AutoScraper和Flask:在不到5分钟的时间内从任何网站创建一个API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/autoscraper-and-flask-create-an-api-from-any-website-in-less-than-5-minutes-3f0f176fc4a3?source=collection_archive---------2-----------------------#2020-09-17">https://betterprogramming.pub/autoscraper-and-flask-create-an-api-from-any-website-in-less-than-5-minutes-3f0f176fc4a3?source=collection_archive---------2-----------------------#2020-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9d8e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用不到20行Python代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/35bee21bed179d3027af3a57eed8ddd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsB1jWtHPvpGUdB7aufryQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@lordarcadius?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Vipul Jha </a>在<a class="ae ky" href="https://unsplash.com/s/photos/python-code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="f9cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将创建自己的电子商务搜索API，支持易贝和Etsy，而不使用任何外部API。借助<a class="ae ky" href="https://github.com/alirezamika/autoscraper/" rel="noopener ugc nofollow" target="_blank"> AutoScraper </a>和<a class="ae ky" href="https://flask.palletsprojects.com/" rel="noopener ugc nofollow" target="_blank"> Flask </a>的强大功能，我们能够在每个站点不到20行的Python代码中实现这个目标。如果你还没有这样做，我推荐你阅读我上一篇关于AutoScraper的文章。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4b1a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">要求</h1><p id="2062" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用pip安装所需的库:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="df3c" class="ne md it na b gy nf ng l nh ni">pip install -U autoscraper flask</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c46a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">让我们开始吧</h1><p id="9da1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们将创建一个智能刮刀，从易贝的搜索结果页面获取数据。假设我们想要获得每个项目的<code class="fe nj nk nl na b">title</code>、<code class="fe nj nk nl na b">price</code>和<code class="fe nj nk nl na b">product link</code>。使用AutoScraper，只需提供一些示例数据就可以轻松完成:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="1b6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，如果您想要复制并运行这段代码，您可能需要更新<code class="fe nj nk nl na b">wanted_list</code>。</p><p id="e8eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们按照刮擦规则对结果进行分组:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="49d6" class="ne md it na b gy nf ng l nh ni">scraper.get_result_similar(url, grouped=True)</span></pre><p id="3827" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从输出中，我们将知道哪个规则对应于哪个数据，因此我们可以相应地使用它。让我们根据输出设置一些别名，删除多余的规则，并保存模型，以便以后使用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="b5b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，如果您运行代码，规则id会有所不同。</p><p id="f493" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，我们已经覆盖了易贝。让我们添加对Etsy搜索结果的支持。我们将从制造它的刮刀开始。这次，我们将使用<code class="fe nj nk nl na b">wanted_dict</code>而不是<code class="fe nj nk nl na b">wanted_list</code>。它会自动为我们设置别名:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="c9dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于Etsy上的链接每次都是用一个唯一的ID生成的，所以我们向<code class="fe nj nk nl na b">wanted_dict</code>添加了一个示例产品ID，这样我们就可以从中创建链接。此外，我们提供了两个标题和价格示例，因为Etsy搜索结果页面上的项目结构是不同的，我们希望scraper了解它们。</p><p id="7501" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在分析了输出之后，让我们保留我们想要的规则，删除其余的，并保存我们的模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="85a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经准备好了我们的刮刀，我们可以用不到40行代码为这两个站点创建功能完整的API:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="757b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们用参数<code class="fe nj nk nl na b">q</code>定义一个API作为我们的搜索查询。我们将获得并加入易贝和Etsy的搜索结果，并将它们作为响应返回。注意，我们将<code class="fe nj nk nl na b">group_by_alias=True</code>传递给scraper，以获得按我们定义的别名分组的结果。</p><p id="a823" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过运行这段代码，API服务器将监听端口8080。所以让我们通过在浏览器中打开<code class="fe nj nk nl na b"><a class="ae ky" href="http://localhost:8080/?q=headphone" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/?q=headphone</a></code>来测试我们的API:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/47c8daec3be7508a99f59716ac348b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i13MQE455mvv7ouOZoOC6Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自易贝的一些结果</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/ae08a4c88fd0839b550752f6c0b8bd4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UJt7y3MXB1xheBwDPWiN1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Etsy的一些结果</p></figure><p id="9673" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。我们已经准备好了电子商务API。只需将URL中的<code class="fe nj nk nl na b">headphone</code>替换为您想要的查询，就可以获得搜索结果。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="efc7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最终注释</h1><p id="4cba" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">本教程的最终代码可在GitHub 的<a class="ae ky" href="https://github.com/alirezamika/tutorials/tree/master/api_server" rel="noopener ugc nofollow" target="_blank">上获得。</a></p><p id="8ac2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个适合开发和测试的开发设置。Flask的内置服务器不适合生产。<strong class="lb iu"> </strong>关于生产用途，请检查<a class="ae ky" href="https://flask.palletsprojects.com/en/1.1.x/deploying/" rel="noopener ugc nofollow" target="_blank">烧瓶的展开选项</a>。</p><p id="52dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程旨在个人和教育用途。如果你想抓取网站，你可以查看他们关于抓取机器人的政策。</p><p id="5606" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章是有用的，有助于将您的想法更快地转化为代码。编码快乐！</p></div></div>    
</body>
</html>