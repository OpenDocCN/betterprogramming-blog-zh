<html>
<head>
<title>Build GitHub Actions Using Docker Containers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker容器构建GitHub动作</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-github-actions-using-docker-containers-c57a97be60e2?source=collection_archive---------6-----------------------#2020-05-22">https://betterprogramming.pub/build-github-actions-using-docker-containers-c57a97be60e2?source=collection_archive---------6-----------------------#2020-05-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bc15" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建GitHub动作并将其部署到GitHub市场</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a430d36bcefd4323c61c93e04082d3be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hR3lBacpj1jpT89Gj09PvQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@yipleonardo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">莱昂纳多·叶</a>在<a class="ae ky" href="https://unsplash.com/s/photos/picture-frame?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2a74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GitHub支持几个第三方的持续集成和持续部署工具，比如Travis CI和Circle CI。另一方面，GitHub提供自己的CI服务，即<a class="ae ky" href="https://help.github.com/en/actions/configuring-and-managing-workflows" rel="noopener ugc nofollow" target="_blank"> GitGub workflows </a>。</p><p id="dc81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以创建工作流来实现几个目标，比如构建docker映像、运行单元测试，甚至部署到远程服务器。工作流可以基于<a class="ae ky" href="https://help.github.com/en/actions/reference/events-that-trigger-workflows" rel="noopener ugc nofollow" target="_blank"> GitHub事件</a>以及<a class="ae ky" href="https://help.github.com/en/actions/reference/events-that-trigger-workflows#external-events-repository_dispatch" rel="noopener ugc nofollow" target="_blank">外部事件</a>触发。例如，可以创建一个工作流，一旦您在存储库上创建了一个新的版本，这个工作流就会被执行。此外，相同的工作流可以配置为由外部API调用触发。</p><p id="3c11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">工作流的结构包括使用几个<a class="ae ky" href="https://help.github.com/en/actions/building-actions/about-actions" rel="noopener ugc nofollow" target="_blank"> GitHub动作</a>来实现工作流目标。操作是完成CI工作流所需的任务。例如，<a class="ae ky" href="https://github.com/marketplace/actions/checkout" rel="noopener ugc nofollow" target="_blank">签出</a>动作将签出runner机器上的GitHub存储库。GitHub行动的完整列表可以在GitHub <a class="ae ky" href="https://github.com/marketplace?type=actions" rel="noopener ugc nofollow" target="_blank">市场</a>上查看。</p><p id="3c19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">动作不仅仅是GitHub开发的；事实上，开发actions是对公众开放的，许多知名公司甚至个人都开发了自己的actions并发布到GitHub市场。</p><p id="328c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有两种类型的操作可以与GitHub工作流一起使用和集成:</p><ul class=""><li id="8710" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://help.github.com/en/actions/building-actions/about-actions#docker-container-actions" rel="noopener ugc nofollow" target="_blank"> Docker容器动作</a>:这种类型允许你将动作所需的所有依赖项打包到Docker镜像中，它们将在执行动作之前在runner机器上构建。</li><li id="d781" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://help.github.com/en/actions/building-actions/about-actions#javascript-actions" rel="noopener ugc nofollow" target="_blank"> JavaScript动作</a>:这些动作直接在runner机器上运行，因此比docker动作快得多。动作必须用纯javascript编写，不使用任何二进制文件。</li></ul><p id="ce6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将解释创建和发布docker GitHub操作的必要步骤。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="f8ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建docker GitHub动作非常简单和容易。下面是需要包含在操作存储库中的文件列表。</p><p id="8a24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> action.yml: </strong>这个文件使用YAML语法，用来定义描述动作的动作元数据。以下是最需要的物品的简要说明:</p><ul class=""><li id="4a43" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">name:GitHub操作的名称。</li><li id="dbb4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">描述:操作的简短描述。</li><li id="2712" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">运行:配置用于操作的docker图像。您可以提供公共docker映像或docker文件来构建docker映像。</li></ul><p id="72b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有其他可选项目，如动作输入参数和输出。所有配置项目的完整列表可在<a class="ae ky" href="https://help.github.com/en/actions/building-actions/metadata-syntax-for-github-actions" rel="noopener ugc nofollow" target="_blank">这里</a>找到。下面是一个动作文件示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="9131" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> dockerfile: </strong>构建GitHub动作的docker可以通过提供一个公共的docker映像来完成，也可以通过引入一个Docker文件来描述应该如何构建动作的Docker映像来完成。GitHub提供了为动作构建docker图像的标准和建议。例如，用户和工作目录Docker指令不应在Docker文件中用于操作。<a class="ae ky" href="https://help.github.com/en/actions/building-actions/dockerfile-support-for-github-actions" rel="noopener ugc nofollow" target="_blank">在这里</a>，你可以找到用Docker容器构建动作所需的完整建议列表。下面是一个GitHub动作的Docker文件的例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="8540" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b"><strong class="lb iu">docker-entrypoint.sh</strong></code><strong class="lb iu">:</strong>docker入口点是封装动作逻辑的shell文件。例如，如果操作应该通过SSH连接到远程服务器，这个文件将利用所需的SSH命令连接到远程服务器并执行定义的任务。</p><p id="e553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b"><strong class="lb iu">README.md</strong></code> <strong class="lb iu"> : </strong>这个<strong class="lb iu"> </strong>文件包含了使用动作和理解动作所需的所有信息。机密、必需的和可选的输入、输出和环境变量需要记录在这个文件中，这样其他人就很容易理解这些操作并能够使用它。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="9331" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦动作存储库被创建并推送到GitHub，就可以将动作发布到GitHub marketplace，并开始在GitHub工作流中使用它。</p><p id="97de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在GitHub marketplace上发布动作的第一步是访问GitHub上的动作存储库，并点击存储库页面顶部的“Draft a release”按钮，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/d136133c468016a28759c86535328974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wOVCxlEiWQpB7SUeMF9BQ.png"/></div></div></figure><p id="e267" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是用所有需要的信息填充发布表单，最重要的是选中“将此操作发布到GitHub Marketplace”复选框，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/7cea01d45a5b12de563c8d8039e1d024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FFff4SHABIEX78POVFh_CA.png"/></div></div></figure><p id="45f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您点击“发布发布”按钮，该操作将被发布到市场，并且可以使用创建的发布标签在GitHub工作流中使用。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="a26c" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated"><strong class="ak">结论</strong></h1><p id="8464" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">执行持续集成和持续交付任务并不局限于CI应用程序，比如Travis CI和Cercle CI。如果源代码托管在GitHub上，工作流和操作可以用来以更简单直接的方式完成相同的任务。</p><p id="f7ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">工作流最重要的优势之一是你可以基于GitHub内部事件来触发它们，而不会有任何麻烦或者使用webhooks。</p></div></div>    
</body>
</html>