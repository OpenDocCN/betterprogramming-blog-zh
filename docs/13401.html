<html>
<head>
<title>Deploy React-Node.js Application in a Virtual Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在虚拟机中部署React-Node.js应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploy-react-node-js-application-in-a-virtual-machine-5b910d6f3aac?source=collection_archive---------1-----------------------#2022-08-24">https://betterprogramming.pub/deploy-react-node-js-application-in-a-virtual-machine-5b910d6f3aac?source=collection_archive---------1-----------------------#2022-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1d3b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Ubuntu中部署全栈应用的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/04a553b57ca2d4c908b65586eb6894cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_7n-jMq5-osTQcXPTUEnOw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">部署MERN堆栈应用程序(图片由作者提供)</p></figure><p id="a779" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为全栈开发者，我们构建新的应用。从头开始制作一个应用程序，设计架构，集思广益，编码，测试和修复bug，这总是很有趣而且存在的。</p><p id="d363" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，下一步，我们需要部署我们的应用程序，使其对公众可用。在大多数情况下，我们在这一点上陷入了困境，因为据我们所知，没有适当的DevOps实践。</p><p id="c36b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，通过这篇文章，我将带您一步步地部署您的全栈应用程序。此外，我愿意揭示部署应用程序时的最佳实践。</p><p id="b0ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，您不仅能获得部署应用的知识，还能获得生产最佳实践、性能和可靠性。</p><h1 id="e8fe" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">部署应用程序的概念</h1><p id="2dd2" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">如果你理解它的概念，你可以做任何事情。app是在React还是Angular都无所谓。概念将是相同的。因此，在开始部署之前，让我们先了解一下基础知识。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/527f912c1e0a81e0ffbbe4432243cc2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ny-GaDj_TExiNAg1AhRbGQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本地开发环境中的MERN应用程序(图片由作者提供)</p></figure><p id="6c62" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我在图中所示，这是一个全栈应用程序在开发环境中通常的样子。</p><p id="b967" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们用服务于应用程序的地下开发服务器开发React应用程序。但是在生产中，我们不使用这个开发服务器。我们创建了一个优化的生产版本，并使用Nginx服务器提供服务。</p><p id="aa89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">等等！这个Nginx是什么？我们不能直接使用我们的后端服务应用程序吗？让我为你澄清这些事情。</p><p id="daf2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">著名的Unix哲学是“编写做一件事的程序，并把它做好。”虽然我们的Node express后端可以提供静态文件，但它并不是为此而专门设计的。但另一方面，Nginx就像一只小野兽。</p><p id="e59e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Nginx，发音为<strong class="la iu"> ' </strong> engine ex，是一个免费的开源的功能丰富的web服务器。此外，它还可以用作反向代理、负载平衡器、邮件代理和HTTP缓存。</p><h2 id="a330" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated"><strong class="ak">你应该考虑使用Nginx的一些原因:</strong></h2><ol class=""><li id="549b" class="nd ne it la b lb mm le mn lh nf ll ng lp nh lt ni nj nk nl bi translated">更好地服务静态内容:它能以闪电般的速度为他们服务，处理器负载最小。它还带有一个内置的gzip压缩器。</li><li id="78de" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">低内存和资源消耗:这可以处理许多并发用户请求，同时消耗大约2.5MB的非常低的内存。这可以更好地利用操作系统和硬件资源。</li><li id="76d8" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">缓存:这为静态和动态内容提供了缓存。</li><li id="1beb" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">充当反向代理:它将客户端请求转发到适当的服务器，反之亦然。</li><li id="3122" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">充当负载平衡器:这有助于在多个服务器之间分配资源和调度流量，允许非常高效地向外扩展。此外，它可以配置为在同一台服务器上运行多个后端。</li><li id="2a37" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">错误处理:如果应用程序崩溃，它可以显示正确的错误页面。</li><li id="d803" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">实现SSL/TLS:这允许用SSL配置安全HTTPS协议。因此网站用户接收和发送的信息将受到保护。加密和压缩是Node.js不擅长的两个繁重的计算过程。</li><li id="e117" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">安全性:可以防止DDoS攻击、IP黑名单和白名单等。</li></ol><p id="5fae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望现在你对Nginx有了清晰的认识。让我们讨论一下我们的应用程序在生产环境中是什么样子的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/53727366868e4aaf61c20609f80c59b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AzEGbAv5709h8-wYF69-8A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生产环境(图片由作者提供)</p></figure><p id="9eca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如图所示，我为我的虚拟机选择了一个Ubuntu实例。在主入口点，Nginx将处理用户请求并充当反向代理。它将为React静态内容提供服务，并将web客户端的请求路由到适当的节点流程。</p><p id="5560" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧！现在我们已经准备好部署应用程序了。</p><h1 id="d4e0" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">示例应用程序</h1><p id="5ae4" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我为这个演示创建了一个简单的notes应用程序。您可以在参考资料部分找到这个应用程序的源代码。</p><p id="c71c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我实现了一些基本的CRUD操作，可以添加和删除注释。下面是在我的本地主机上运行的应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/a2d898c209ef8f14d274cc92d2ab8f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2h3vJzETndImC_kdPI0Tzw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我的笔记应用程序(图片由作者提供)</p></figure><p id="bbbf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">源代码由服务器和客户端文件夹组成。所有的React前端代码都在客户端文件夹中，Node.js后端代码在服务器文件夹中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/2a3ad4013aa502e388b247bacb39a8c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fhTjMypOy_HWxNj4C_iHzg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">文件夹结构(作者图片)</p></figure><h1 id="30ad" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">部署应用程序</h1><p id="e2dc" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">让我们进入部署应用程序的分步教程。</p><h1 id="8792" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">1.代码修改</h1><p id="57a4" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">作为第一步，我们需要对当前工作的应用程序做一些小的代码修改。</p><h2 id="5fd4" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">前端</h2><p id="761b" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我们需要更改基本URL，因为我们的express服务器不再可以通过<code class="fe nt nu nv nw b">localhost:3001</code>访问，我们可以只使用前缀<code class="fe nt nu nv nw b">/api</code>来访问资源，因为我们从同一台机器上提供服务。</p><p id="8975" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的应用程序中，你可以在<code class="fe nt nu nv nw b">src</code>文件夹中找到<code class="fe nt nu nv nw b">API.ts</code>文件。在那里，基本URL将如下所示:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="80c6" class="mr lv it nw b gy ob oc l od oe">const baseUrl: string = "<a class="ae of" href="http://localhost:3001/api" rel="noopener ugc nofollow" target="_blank">http://localhost:3001</a>/api";</span></pre><p id="7d76" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，按如下方式更改基本URL:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="1440" class="mr lv it nw b gy ob oc l od oe">const baseUrl: string = "/api";</span></pre><h2 id="0352" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">后端</h2><p id="354b" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在将应用程序投入生产之前，您应该遵循一些最佳实践。</p><p id="027a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">实现一个记录器</strong></p><p id="dd6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于这是一个演示应用程序，我没有特意包括一个日志。但是在部署应用程序之前配置一个日志记录器是非常必要的。你可以使用像温斯顿这样的记录器。有一篇文章用我写的最佳实践解释了Node.js日志记录。您可以在参考资料部分找到它。</p><p id="7df1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，请记住Node.js应用程序在遇到未捕获的异常时会崩溃。因此，请确保正确处理异常。</p><p id="c710" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">取下CORS </strong></p><p id="1e92" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">跨源资源共享是一种允许从不同的域、子域、端口或协议请求资源的机制。但是现代网络浏览器强制执行同源策略作为其安全模型的一部分。所以对于CORS，我们可以绕过它。</p><p id="9c3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们使用CORS是因为React和Node.js运行在开发环境中的两个不同的端口上。我们需要从一个源向另一个源请求资源。由于端口不同，浏览器会将它们视为不同的来源。</p><p id="e5f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是在生产中，我们不需要CORS机制来访问资源，因为我们不使用React的开发服务器。正如我之前告诉您的，我们可以只使用相对路径(<code class="fe nt nu nv nw b">/api</code>)来访问端点。所以我们可以移除它。</p><p id="56e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有些人盲目地认为CORS为应用程序提供了安全性。实际上，CORS就是漏洞。这可能导致您的应用程序容易受到跨域攻击。</p><p id="b173" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为一个简单的场景，如果攻击者通过删除和添加必要的CORS头来创建自己的代理，您的应用程序将容易受到攻击。</p><p id="b876" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，CORS会影响应用程序的性能，因为CORS预检请求会产生额外的请求和延迟开销。</p><p id="ad73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你更关心安全，我建议你使用头盔包。</p><h2 id="1859" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">使用头盔包装保护应用</h2><p id="7928" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我希望你们大多数人都知道这个计划。这将创建一个安全层，防止像跨站点脚本(XSS)、点击劫持等攻击。，通过设置各种HTTP头。</p><p id="e46a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">头盔是Node Express应用程序的安全最佳实践。它由15个较小的中间件组成，可以单独启用或禁用。</p><p id="1d3a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使服务器安全的一些标题是:</p><ul class=""><li id="7604" class="nd ne it la b lb lc le lf lh og ll oh lp oi lt oj nj nk nl bi translated">content-Security-Policy-这表示允许加载哪些动态资源。它可以缓解跨站脚本(XSS)攻击。</li><li id="3ab3" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated">严格的传输安全—这确保了只能使用HTTPS访问网站。</li><li id="7ff7" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated">Expect-CT —检查证书的滥用。这只影响HTTPS连接。</li><li id="793c" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated">Referrer-Policy-定义应该从请求的referrer中包含哪些信息。</li><li id="97dd" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated">x-内容-类型-选项-通过<a class="ae of" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types#mime_sniffing" rel="noopener ugc nofollow" target="_blank"> MIME类型嗅探</a>进行保护</li></ul><p id="1d95" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以通过使用<code class="fe nt nu nv nw b">npm instal --save helmet</code>简单地安装头盔，并像这样将其作为中间件来操作，从而将头盔添加到我们的应用程序中:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="e9ce" class="mr lv it nw b gy ob oc l od oe">const helmet = require('helmet');<br/>app.use(helmet());</span></pre><p id="1b18" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我打算部署这个应用程序，所以我不会在本文中深入探讨安全问题。有一篇关于Node.js安全清单的好文章。如果你对那个领域更感兴趣，你可以在这里阅读<a class="ae of" href="https://blog.risingstack.com/node-js-security-checklist/" rel="noopener ugc nofollow" target="_blank">并获得额外的知识。</a></p><h2 id="4fc4" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">将Node.js投入生产</h2><p id="5e12" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">将Node.js环境转化为生产环境将优化代码并提高性能。此外，它将删除错误页面中的堆栈跟踪，使您的应用程序更加安全。</p><p id="6e6c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用一个<code class="fe nt nu nv nw b">.env</code>文件将Node.js环境设置为生产环境。(也可以用环境变量来设置这个，简单多了。)</p><p id="472a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在服务器目录中创建一个<code class="fe nt nu nv nw b">.env</code>文件，并将以下代码行添加到其中:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="9c2a" class="mr lv it nw b gy ob oc l od oe">NODE_ENV = production</span></pre><p id="578b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些是您在部署应用程序时应该考虑的一些最佳实践。此外，您可以遵循生产指南中的<a class="ae of" href="http://expressjs.com/en/advanced/best-practice-performance.html" rel="noopener ugc nofollow" target="_blank">快速性能最佳实践中提到的步骤。</a></p><p id="c053" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是大部分都是用Nginx处理的。例如，Nginx默认启用Gzip压缩。所以你不需要担心这个。</p><h1 id="daa3" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">2.创建优化的生产版本</h1><p id="4e92" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我们需要优化和最小化前端应用程序中的js包，以提供更好的用户体验。</p><p id="4f74" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行前端(客户端)文件夹中的<code class="fe nt nu nv nw b">yarn build</code>或<code class="fe nt nu nv nw b">npm run build</code>。这将捆绑，缩小和优化所有代码成HTML，CSS和JavaScript文件，并把它放入<code class="fe nt nu nv nw b">build</code>文件夹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/c1d30c917e464d69cbd02043ca024f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iY2JLBlOu8mvgw0CDTXShA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建优化的生产版本(图片由作者提供)</p></figure><h1 id="3498" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">3.创建虚拟机</h1><p id="ca6b" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">您可以使用AWS EC2、微软Azure、GCP或任何其他服务来创建虚拟机。我在这个演示中使用了微软Azure。此外，如果你是一名大学生，你可以申请Azure学生计划，并获得免费的100美元Azure信用，而不需要信用卡。(<a class="ae of" href="https://azure.microsoft.com/en-us/free/students/" rel="noopener ugc nofollow" target="_blank">学生用天蓝色</a>)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/19e3d196165120d5c06996b52bf88e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ukQRfIP9vK63cP9RUw4XA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Azure虚拟机创建(图片由作者提供)</p></figure><blockquote class="om on oo"><p id="c01f" class="ky kz op la b lb lc ju ld le lf jx lg oq li lj lk or lm ln lo os lq lr ls lt im bi translated">专业提示:创建虚拟机时，根据成本更改区域(大多数情况下，美国东部的成本会更低)。有价格计算器来计算这个。</p></blockquote><p id="c02d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我选择了Ubuntu Server 20.04 LTS版本作为我在虚拟机中的操作系统。</p><p id="d6aa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，您需要允许入站流量，因为您可以到达您的实例。确保在部署应用程序后创建规则，以获得更好的安全性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/539e767052903057252b420c48b27c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ikfEXIP57F5FuvKcku8Zqw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置入站端口(图片由作者提供)</p></figure><p id="a3d7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望您能按照每个选项卡中的步骤创建虚拟机。如果您在某一点上遇到困难，请在参考资料部分观看我的视频指南。</p><h1 id="c51c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">4.连接到虚拟机</h1><p id="1d63" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">如果您是windows用户，您可以使用power-shell，或者使用第三方工具(如Putty)连接到虚拟机。我已经写了一篇关于创建EC2实例的文章。如果连接有问题，可以参考参考资料部分。</p><p id="fff5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有必要的细节和SSH信息都在Azure dashboard中提供。因此您可以轻松地连接到实例。</p><p id="4c02" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">成功连接后，您将看到以下消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/b5454677b96a19a6b3ebf31ec10bcabf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fVFQ7GhFW1Alls_wYuxWzA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">连接到虚拟机(作者图片)</p></figure><p id="ba10" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">确保在执行任何其他操作之前更新您的虚拟机。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="6fbf" class="mr lv it nw b gy ob oc l od oe">sudo apt update &amp;&amp; sudo apt upgrade -y</span></pre><h1 id="0dc5" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">5.配置虚拟机</h1><p id="4d48" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">首先，我们需要在虚拟机中设置环境来部署我们的应用程序。</p><h2 id="54ee" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">设置NGINX</h2><p id="6fc3" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">小野兽来了。您可以使用以下命令轻松安装Nginx:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="8028" class="mr lv it nw b gy ob oc l od oe">sudo apt-get install nginx -y</span></pre><p id="2852" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，我们需要确保Nginx配置为在服务器重启时自动启动。为此，运行以下命令:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="d3b0" class="mr lv it nw b gy ob oc l od oe">sudo systemctl enable nginx</span></pre><p id="d616" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您可以看到Nginx的状态，通过运行以下命令来确认一切正常:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="c26a" class="mr lv it nw b gy ob oc l od oe">sudo systemctl status nginx</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/f7de720927aa2dfc26f6698bef0a37ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TtYlevfVumP2MDvGzs0zgg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Nginx安装(图片由作者提供)</p></figure><p id="3c59" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，如果您在浏览器中粘贴虚拟机的公共地址(您可以使用<code class="fe nt nu nv nw b">curl <a class="ae of" href="https://ipinfo.io/ip" rel="noopener ugc nofollow" target="_blank">https://ipinfo.io/ip</a> </code>命令找到它)，您将会看到类似这样的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/d1704131fb83524d8b81b0ad3f8a1c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3vy5Nri0cGrKQ603KwvTg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">默认Nginx登录页面(图片由作者提供)</p></figure><p id="c927" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是默认的Nginx登录页面。</p><p id="27ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">确保在创建实例时启用了HTTP流量。除非防火墙会屏蔽Nginx服务。</p><p id="c18b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们需要配置Nginx服务器来服务我们的应用程序。为此，我们需要浏览<code class="fe nt nu nv nw b">cd /etc/nginx/sites-available</code>目录。您将看到一个名为default的文件。</p><p id="a21a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是Nginx服务器配置的参考文件。你可以复制并根据你的要求修改它。首先，通过运行以下命令将其复制并粘贴为<code class="fe nt nu nv nw b">myserver</code>:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="8ff6" class="mr lv it nw b gy ob oc l od oe">sudo cp default myserver</span></pre><p id="d919" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，您可以使用以下配置覆盖该文件。使用vim作为内部编辑器来编辑文件。确保以超级用户权限打开(<code class="fe nt nu nv nw b">sudo vim myserver</code>)。</p><p id="8c59" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">键入<code class="fe nt nu nv nw b">:%d</code>并按回车键删除所有行。使用<code class="fe nt nu nv nw b">ctrl+shift+v</code>复制并粘贴该配置，根据您的虚拟机更改配置，然后<code class="fe nt nu nv nw b">:wq</code>写入更改。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="4717" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将侦听IPV4和IPV6上的<code class="fe nt nu nv nw b">port 80</code>。根目录是您的前端(客户端)构建文件夹所在的位置。你可以把它命名为<code class="fe nt nu nv nw b">/home/{user}/apps/my-notes-app/client/build;</code>把它放在这里，我们稍后会创建文件夹。</p><p id="5c15" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你有购买的域名，可以添加到<code class="fe nt nu nv nw b">server_name</code>我目前没有。所以我添加了虚拟机的公共IP地址。</p><p id="cffc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们在安装Nginx后看到了一个默认的网页。现在我们必须覆盖它来显示我们的应用程序，而不是那个。这可以通过使用<code class="fe nt nu nv nw b">location /</code>块来实现。</p><p id="514b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将在构建文件夹中找到<code class="fe nt nu nv nw b">index.html</code>文件，并将其作为静态内容。此外，任何其他URL路由都将被重定向到<code class="fe nt nu nv nw b">index.html</code>，因此，所有路由都可以从react应用程序内部处理。</p><p id="b86a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们可以使用<code class="fe nt nu nv nw b">location /api</code> Nginx来配置我们的Node express服务器，Nginx将代理将在<code class="fe nt nu nv nw b">port 3001</code>上运行的Node express服务器。</p><p id="4b2a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">设置完成后，您需要启用站点并重启Nginx服务以使更改生效。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="80e5" class="mr lv it nw b gy ob oc l od oe">sudo ln -s /etc/nginx/sites-available/myserver /etc/nginx/sites-enabled/</span><span id="2689" class="mr lv it nw b gy oz oc l od oe">sudo service nginx restart</span></pre><h1 id="46e9" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">安装节点。射流研究…</h1><p id="4ea7" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我们来安装Node.js吧，至于Debian和基于Ubuntu的Linux发行版的<a class="ae of" href="https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions" rel="noopener ugc nofollow" target="_blank">官方文档</a>，推荐的方式是使用二进制安装。</p><p id="f3d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Node.js二进制发行版可以在节点源代码GitHub页面上找到。</p><p id="ae84" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以运行以下命令来安装Node.js。请确保您选择的版本与您的应用程序兼容。我选择版本16作为我的应用程序构建版本，使用该节点版本。</p><p id="8a25" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以使用<code class="fe nt nu nv nw b">node --version</code>检查版本并安装相关的版本。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="37f4" class="mr lv it nw b gy ob oc l od oe">curl -fsSL <a class="ae of" href="https://deb.nodesource.com/setup_16.x" rel="noopener ugc nofollow" target="_blank">https://deb.nodesource.com/setup_16.x</a> | sudo -E bash -</span><span id="c530" class="mr lv it nw b gy oz oc l od oe">sudo apt-get install -y nodejs</span></pre><p id="4a17" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安装成功后，您可以检查版本进行确认。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/f5e07440a333151acbf64551ef0a32f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4W4OS7c-TnuWOIu-OEUv0A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Node.js安装(图片作者提供)</p></figure><blockquote class="om on oo"><p id="270d" class="ky kz op la b lb lc ju ld le lf jx lg oq li lj lk or lm ln lo os lq lr ls lt im bi translated">专业提示:始终使用Node.js的LTS版本，因为你会收到关键的错误修复、安全更新等。消除新的错误或漏洞。</p></blockquote><h2 id="fd6b" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">安装流程管理器</h2><p id="0ce7" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">现在，我们可以通过运行<code class="fe nt nu nv nw b">node app.js</code>来启动我们的Node express服务器，但这不是最佳实践，因为它很容易崩溃。这就是为什么流程经理会出现的原因。</p><p id="d83c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它通过在崩溃后甚至在虚拟机重启后自动重启应用程序，确保应用程序在部署后保持在线。此外，我们可以使用进程管理器来了解运行时性能和资源消耗。</p><p id="57ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有很多流程经理，比如Forever、Strong PM等等。此外，您可以使用操作系统本地进程管理器，如SystemD和Upstart。</p><p id="8bb4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是PM2是其中最著名的，它超级酷。它以NPM软件包的形式提供，因此您可以通过以下命令安装它:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="33c3" class="mr lv it nw b gy ob oc l od oe">npm install pm2 --location=global</span></pre><p id="d6ac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您遇到权限问题，请授予对<code class="fe nt nu nv nw b">/usr/lib/node_modules/</code>文件夹的写权限。(这里不要用<code class="fe nt nu nv nw b">sudo</code>，因为从安全角度来看这样不好。)</p><p id="bcbd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果已经成功安装，试着在控制台运行<code class="fe nt nu nv nw b">pm2</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/013b851432aed202d2c6d21d5083cc44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p1dFH2MJu22eS-L1etQNaQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PM2装置(图片由作者提供)</p></figure><p id="e51c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PM2不仅仅是一名流程经理，他还能提供更多的东西。</p><p id="5858" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PM2提供的一些主要功能:</p><ul class=""><li id="3d2b" class="nd ne it la b lb lc le lf lh og ll oh lp oi lt oj nj nk nl bi translated"><a class="ae of" href="http://pm2.keymetrics.io/docs/usage/application-declaration/" rel="noopener ugc nofollow" target="_blank">行为配置</a></li><li id="0844" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated"><a class="ae of" href="http://pm2.keymetrics.io/docs/usage/docker-pm2-nodejs/" rel="noopener ugc nofollow" target="_blank">集装箱集成</a></li><li id="4457" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated"><a class="ae of" href="http://pm2.keymetrics.io/docs/usage/cluster-mode/" rel="noopener ugc nofollow" target="_blank">集群模式</a></li><li id="c903" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated"><a class="ae of" href="http://pm2.keymetrics.io/docs/usage/watch-and-restart/" rel="noopener ugc nofollow" target="_blank">观看&amp;重新加载</a></li><li id="ff2d" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated"><a class="ae of" href="http://pm2.keymetrics.io/docs/usage/log-management/" rel="noopener ugc nofollow" target="_blank">日志管理</a></li><li id="411e" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated"><a class="ae of" href="http://pm2.keymetrics.io/docs/usage/monitoring/" rel="noopener ugc nofollow" target="_blank">监控</a></li><li id="0e55" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated"><a class="ae of" href="http://pm2.keymetrics.io/docs/usage/startup/" rel="noopener ugc nofollow" target="_blank">启动脚本</a></li></ul><p id="f2d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PM2最有趣的部分是集群模式。众所周知，Node.js是一个单线程应用程序。因此它一次只能使用一个内核。但是我们可以使用这种集群模式来利用所有其他内核。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8a03214efacbded93482db1e774b6112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mgPQkCv-EqGrAhFBhLYHsQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PM2集群模式(图片由作者提供)</p></figure><p id="4f06" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如上图所示，我们可以使用PM2在集群模式下运行Node express服务器。所以它将为每个处理器创建一个子进程。此外，PM2将执行负载平衡并共享同一个端口，因为它带有内置的负载平衡器。</p><p id="bfd9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们的虚拟机中有四个内核，我们最多可以创建同时运行的四节点集群实例。这将提高应用程序的性能和可靠性。这是一个水平缩放。</p><p id="276b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是当应用程序完全无状态时，这个特性工作得最好。这意味着在这个过程中没有存储本地数据。(sessions/web-sockets)如果你有这种行为，最好使用native Node.js <a class="ae of" href="https://nodejs.org/api/cluster.html" rel="noopener ugc nofollow" target="_blank">集群模块</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b12a2a46e7d9921c16e025b3adc7540a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n2zAscjtkGqjzr2DsU4_Kg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Nginx作为负载平衡器(图片由作者提供)</p></figure><p id="a4c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Nginx还可以为Node.js应用程序进行负载平衡。正如我们前面看到的，我们可以使用<code class="fe nt nu nv nw b">upstream</code>块在服务器文件中设置配置。这是示例配置。(这个不需要补充。)</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="49e4" class="mr lv it nw b gy ob oc l od oe">upstream app_servers {<br/>        server 127.0.0.1:3000;<br/>        server 127.0.0.1:3001;<br/>        server 127.0.0.1:3002;<br/>}</span></pre><p id="2244" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Nginx允许跨多个服务器的负载平衡。(IP和端口)因此，这可以用于在单个服务器上部署不同的应用程序，以及在不同的服务器上部署相同的应用程序。此外，我们可以通过将Nginx和PM2集群模式与多个虚拟机相结合来实现进一步的水平扩展。</p><p id="edd3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里我将使用PM2，因为我们只有一个应用程序。在本文的后半部分，我将讨论如何在我们的应用程序中使用集群。所以，在这里你只需要安装它。</p><h2 id="6696" class="mr lv it bd lw ms mt dn ma mu mv dp me lh mw mx mg ll my mz mi lp na nb mk nc bi translated">设置MongoDB</h2><p id="a6da" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在使用MongoDB时，您可以使用两种解决方案:</p><ol class=""><li id="f4b2" class="nd ne it la b lb lc le lf lh og ll oh lp oi lt ni nj nk nl bi translated">MongoDB Atlas——带免费层的在线云数据库。</li><li id="c5f9" class="nd ne it la b lb nm le nn lh no ll np lp nq lt ni nj nk nl bi translated">在虚拟机中安装MongoDB。</li></ol><p id="7a0c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">希望大家可以建立一个MongoDB atlas账号，在Node.js app中使用。但是我会安装MongoDB，因为它非常简单，你不需要再修改代码。如果你需要连接MongoDB atlas账户的帮助，请在评论区留言。我很乐意帮忙。</p><p id="4083" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于我使用的是Ubuntu 20.02实例，我需要遵循<a class="ae of" href="https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-ubuntu/" rel="noopener ugc nofollow" target="_blank">官方MongoDB文档</a>中提供的必要说明。那个文档真的很好。</p><p id="c5b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安装MongoDB只需要四个简单的步骤。您可以在控制台中逐一运行这些命令:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="309e" class="mr lv it nw b gy ob oc l od oe">wget -qO - <a class="ae of" href="https://www.mongodb.org/static/pgp/server-5.0.asc" rel="noopener ugc nofollow" target="_blank">https://www.mongodb.org/static/pgp/server-5.0.asc</a> | sudo apt-key add -</span><span id="2a17" class="mr lv it nw b gy oz oc l od oe">echo "deb [ arch=amd64,arm64 ] <a class="ae of" href="https://repo.mongodb.org/apt/ubuntu" rel="noopener ugc nofollow" target="_blank">https://repo.mongodb.org/apt/ubuntu</a> focal/mongodb-org/5.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-5.0.list <br/> <br/>sudo apt-get update</span><span id="6455" class="mr lv it nw b gy oz oc l od oe">sudo apt-get install -y mongodb-org</span></pre><p id="c55d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行这些命令后，您可以通过输入以下命令启动<code class="fe nt nu nv nw b"><a class="ae of" href="https://www.mongodb.com/docs/manual/reference/program/mongod/#mongodb-binary-bin.mongod" rel="noopener ugc nofollow" target="_blank">mongod</a></code>进程:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="7d8f" class="mr lv it nw b gy ob oc l od oe">sudo systemctl start mongod</span></pre><p id="c4e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后验证MongoDB是否已经成功启动。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="093e" class="mr lv it nw b gy ob oc l od oe">sudo systemctl status mongod</span><span id="50d6" class="mr lv it nw b gy oz oc l od oe">mongo --version</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/989444143eeb72cc6457f17cbc922d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zG1_3XPgwVfsBfctP4vjgg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MongoDB安装(图片由作者提供)</p></figure><p id="8b2e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您需要使<code class="fe nt nu nv nw b">mongod</code>服务在虚拟机自动重启后启动。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="c4d8" class="mr lv it nw b gy ob oc l od oe">sudo systemctl enable mongod.service</span></pre><p id="f4a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，您需要给MongoDB套接字执行的权限。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="de29" class="mr lv it nw b gy ob oc l od oe">sudo chown -R mongodb:mongodb /var/lib/mongodb</span><span id="94ba" class="mr lv it nw b gy oz oc l od oe">sudo chown mongodb:mongodb /tmp/mongodb-27017.sock</span><span id="161d" class="mr lv it nw b gy oz oc l od oe">sudo service mongod restart</span></pre><p id="2b51" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，您可以通过设置用户名和密码认证来保护MongoDB实例。我希望你能独立完成。</p><p id="6ca9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧！部署我们的应用程序的一切准备就绪。那我们现在为什么要等呢？让我们将源代码移到VM中。</p><h1 id="c203" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">6.将源代码移入虚拟机</h1><p id="044f" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">你可以直接从GitHub克隆你的代码，或者通过SSH把文件复制到VM。此外，您可以使用第三方FTP客户端，如FileZilla或WinSCP，将代码复制到VM中。</p><p id="46c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我打算用SSH把我的代码复制到VM，因为这非常简单。</p><p id="3f2b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如您所记得的，在Nginx服务器配置中，我们将根命名为<code class="fe nt nu nv nw b">/home/azureuser/apps/my-notes-app/client/build</code>。因此，让我们创建文件夹，并据此复制我们的代码。</p><p id="2487" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在我的机器中创建了一个名为<code class="fe nt nu nv nw b">my-notes-app</code>的新文件夹，然后我将把我的源代码放入其中。</p><blockquote class="om on oo"><p id="991e" class="ky kz op la b lb lc ju ld le lf jx lg oq li lj lk or lm ln lo os lq lr ls lt im bi translated">专业提示:确保在上传文件到服务器之前移除节点模块，因为这会耗费你的时间和数据。</p></blockquote><p id="7060" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您可以将该文件夹SSH复制到您的虚拟机中。转到计算机中服务器密钥对文件所在的新终端。现在运行下面的命令将文件夹复制到虚拟机中。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="8d68" class="mr lv it nw b gy ob oc l od oe">scp -i key-pair.pem -r ./path/to/folder &lt;username&gt;@&lt;public-ip&gt;:/pathwhere/you/need/to/copy</span></pre><p id="b4cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的场景中，我使用了以下内容:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="2568" class="mr lv it nw b gy ob oc l od oe">scp -i YasasServer_key.pem -r ./my-notes-app azureuser@20.51.228.239:/home/azureuser/apps/</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/064d0dfb070e43727db0af72a88c22bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CC3kpe7WqOUKcCc0mDSJCw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SSH将源代码复制到VM(图片由作者提供)</p></figure><p id="a36d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在您需要在服务器上安装NPM软件包。为此，将<code class="fe nt nu nv nw b">cd</code>放入服务器文件夹并运行<code class="fe nt nu nv nw b">npm install</code>来安装软件包。</p><h1 id="7c41" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">7.运行应用程序</h1><p id="1f19" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">现在您可以通过运行<code class="fe nt nu nv nw b">npm run dev</code>来检查您的应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/e3fe44bc65dccd9963c23860287d4194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*U4ofaaZ5B_-VMJReTh1pzw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">运行服务器(作者图片)</p></figure><p id="07b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，我们的Node.js express服务器运行良好。但这不是正确的部署。按<code class="fe nt nu nv nw b">ctrl+c</code>退出。</p><blockquote class="om on oo"><p id="7340" class="ky kz op la b lb lc ju ld le lf jx lg oq li lj lk or lm ln lo os lq lr ls lt im bi translated">专业提示:确保以非根用户身份运行Node.js进程，因为根用户访问会导致安全漏洞。如果攻击者设法在服务器上运行恶意脚本，他将获得对虚拟机的无限权力。所以建议不要以超级用户权限运行。</p></blockquote><p id="6ad7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所知，我们安装了PM2流程管理器。大狗来了！我们可以使用PM2通过指向主<code class="fe nt nu nv nw b">app.js</code>文件来部署应用程序。</p><p id="c89c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，我们可以添加<code class="fe nt nu nv nw b">--name</code>标志来给进程一个描述性的、可识别的名称，该名称可以用来引用PM2子命令。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="ebe3" class="mr lv it nw b gy ob oc l od oe">pm2 start app.js --name notes-app</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/59f25fb8c88216f21ade5b2a67bdb05d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tHXx7zKzDHVUtsgKYzcOXQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">行动中的PM2(图片由作者提供)</p></figure><p id="342f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">或者，您可以使用PM2集群模式，就像我前面提到的那样。(不要两者都用。只有一种方法就够了！您可以通过<code class="fe nt nu nv nw b">pm2 stop 0</code>停止分叉过程</p><p id="9909" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要启用集群模式，你只需要通过<code class="fe nt nu nv nw b">-i &lt;number-of-instances&gt;</code>选项。</p><p id="1d82" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于<code class="fe nt nu nv nw b">&lt;number of instances&gt;</code>，您可以给出0/1/2…直到虚拟机中可用CPU的数量。也可以给它<code class="fe nt nu nv nw b">max</code>。然后，PM2将自动检测可用CPU的数量，并运行尽可能多的进程。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="0fe0" class="mr lv it nw b gy ob oc l od oe">pm2 start app.js -i max</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/9cc1abef1ba69ce5dced9a358bd6ff94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C6XM8WshaepZ0LjOHr2gDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PM2集群模式(图片由作者提供)</p></figure><p id="86e0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以看到两个实例以集群模式启动并运行。然后，您需要将PM2配置为在自动重启后启动该过程。运行以下命令:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="828a" class="mr lv it nw b gy ob oc l od oe">pm2 startup</span></pre><p id="834a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，根据您的虚拟机，您将看到一条与此类似的消息。</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="bd0a" class="mr lv it nw b gy ob oc l od oe">To setup the Startup Script, copy/paste the following command:<br/>sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u azureuser --hp /home/azureuser</span></pre><p id="e7f1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不要抄这个！复制您的消息并粘贴到终端。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/1a495def7006be6194d60cef9a3d3b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6NNx8RjBbaow9PQu8CE7Fg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">PM2重启后自动启动(图片由作者提供)</p></figure><p id="2033" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后使用<code class="fe nt nu nv nw b">pm2 status</code>验证应用程序正在运行。您还需要使用<code class="fe nt nu nv nw b">pm2 save</code>保存这些配置。</p><p id="48b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">PM2允许你通过一个漂亮的仪表板监控所有的服务器处理器。你可以在这里评估一下<a class="ae of" href="https://app.pm2.io/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="8f40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您已经按照本指南完成了所有步骤，现在您将在虚拟机的公共地址中看到一个托管应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/aefc39f760ab8ee4aef3eb8d6c167fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3HyKCrUPfieFZVsajr-SHA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">部署的应用程序(图片由作者提供)</p></figure><p id="f85e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">问候！你的申请在网上。</p><p id="28b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尝试<code class="fe nt nu nv nw b">sudo reboot now</code>并再次检查是否所有东西都工作正常。</p><p id="94a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文可以进一步扩展到添加自定义域、启用防火墙、获取SSL证书、创建自定义负载平衡器、扩展应用程序等。我会写一篇单独的文章，因为它会比这更长。</p><h1 id="9f80" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">解决纷争</h1><p id="b56f" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">如果您正确遵循本教程，您将很快看到您的应用托管。但是，如果您无法配置它，我会给您一个一般的故障排除指南来帮助您。这也会帮助你记住重要的事情。</p><p id="6fbe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，确保所有服务都已启动并运行。你可以通过<code class="fe nt nu nv nw b">systemctl</code>命令来检查。Nginx和MongoDB应该启用并运行。即使在虚拟机重新启动后，这些进程也应该会自动启动。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/5d6d8f29549f9014526db22280bfb67e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a0-z5r5CP5SaLvgy-0vgQg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">所有服务都已启动并运行(图片由作者提供)</p></figure><p id="8952" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您正在使用MongoDB Atlas，请确保您的虚拟机的IP地址没有被阻止。您可以在这里设置访问策略<a class="ae of" href="https://www.mongodb.com/docs/atlas/security/ip-access-list/" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/7cd7eda82037f0cb5c4da8fed5c18d53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-b3yGMIr-5MakxCbVRYvw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MongoDB Atlas网络访问(图片由作者提供)</p></figure><p id="f71d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您的<code class="fe nt nu nv nw b">mongod</code>服务在VM重启后给出状态14，这意味着您没有正确地允许MongoDB套接字。按照本文MongoDB安装一节中的描述为套接字提供权限。此外，再次检查路径是否正确。就像有时候<code class="fe nt nu nv nw b">/var/lib</code>文件夹可以是<code class="fe nt nu nv nw b">mongo</code>而不是<code class="fe nt nu nv nw b">mongodb</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/5e2b9910629aca1d706a9e2060c71d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VPhvNXoLtTyzCdaKgNZ_eA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MongoDB加载但中断并返回状态=14问题(图片由作者提供)</p></figure><p id="1715" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，您应该确保将正确的路径放入Nginx配置文件并激活它。仔细检查<code class="fe nt nu nv nw b">server_name</code>，因为我已经给了我的IP地址。将其替换为虚拟机的公共IP地址。您可以使用<code class="fe nt nu nv nw b">curl <a class="ae of" href="https://ipinfo.io/ip" rel="noopener ugc nofollow" target="_blank">https://ipinfo.io/ip</a></code>命令检查您的IP地址。</p><p id="66ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Nginx配置文件中做了任何更改后，您需要运行<code class="fe nt nu nv nw b">sudo restart nginx</code>并验证它运行时没有任何问题。</p><p id="dfbd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您的Nginx服务失败了，您最好检查一下配置文件语法，确保您没有引入任何错误。您可以通过键入以下命令来检查它:</p><pre class="kj kk kl km gt nx nw ny nz aw oa bi"><span id="9e1b" class="mr lv it nw b gy ob oc l od oe">sudo nginx -t</span></pre><p id="79c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你有任何问题，请在评论区留言。我很乐意帮助你解决你的问题。</p><h1 id="93d9" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">资源</h1><ul class=""><li id="147d" class="nd ne it la b lb mm le mn lh nf ll ng lp nh lt oj nj nk nl bi translated"><a class="ae of" href="https://github.com/Yasas4D/NotesApp" rel="noopener ugc nofollow" target="_blank">源代码库</a></li><li id="4ddf" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated"><a class="ae of" rel="noopener ugc nofollow" target="_blank" href="/a-complete-guide-to-node-js-logging-1ba70a4a346d">node . js日志记录的完整指南</a></li><li id="2e8d" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated"><a class="ae of" href="https://medium.com/@yasassandeepa007/connecting-to-ec2-instance-linux-ubuntu-ultimate-guide-1788fee00182" rel="noopener">连接到EC2实例</a></li><li id="dc00" class="nd ne it la b lb nm le nn lh no ll np lp nq lt oj nj nk nl bi translated">视频教程</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk oy l"/></div></figure><h1 id="6358" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">结论</h1><p id="cfce" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">终于，我们做到了！</p><p id="7588" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在您已经了解了关于部署MERN堆栈应用程序的一切。您不仅学会了部署应用程序，还学会了遵循最佳实践。</p><p id="775a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我相信一切都很清楚。如果没有，不要犹豫给我发信息。你可以将今天学到的一切应用到你的应用程序中，并与世界分享。希望能在评论区看到你的一些申请。</p><p id="e4c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将按照承诺，分别撰写关于扩展应用程序和提高安全性的文章。如有任何意见或建议，我们将不胜感激。</p><p id="0912" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">保持健康，保持安全，保持学习。下次见，编码快乐！</p></div></div>    
</body>
</html>