<html>
<head>
<title>How to Interactively Search and Replace Across Many Files With 2 Commands</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用两个命令交互式搜索和替换多个文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-interactively-search-and-replace-across-many-files-with-2-commands-b133d1d82b86?source=collection_archive---------17-----------------------#2020-09-02">https://betterprogramming.pub/how-to-interactively-search-and-replace-across-many-files-with-2-commands-b133d1d82b86?source=collection_archive---------17-----------------------#2020-09-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d641" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Vim跨文件进行看似简单的搜索和替换</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/7ba76750db5960327f97eff61e9b21ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*XS-vZ4zl1SyvzaRq.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者照片。</p></figure><p id="7da6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然有多种方法可以在单个文件中搜索和替换单词，但是当您有一个字符串要在多个名称不同的不相关文件中更新时，该怎么办呢？当然，您利用了命令行工具的强大功能！</p><p id="67e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，你需要<code class="fe lq lr ls lt b">find</code>所有你想改变的文件。将对<code class="fe lq lr ls lt b">find</code>有效的搜索查询串在一起实际上只受到你的想象力的限制。下面是一个查找Python文件的简单示例:</p><pre class="kj kk kl km gt lu lt lv lw aw lx bi"><span id="4729" class="ly lz it lt b gy ma mb l mc md">find . -name '*.py'</span></pre><p id="50c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">-name</code>测试搜索一个模式，比如所有以<code class="fe lq lr ls lt b">.py</code>结尾的文件，但是<code class="fe lq lr ls lt b">find</code>可以用其他测试条件做更多的事情，包括<code class="fe lq lr ls lt b">-regex</code>测试。运行<code class="fe lq lr ls lt b">find --help</code>查看众多选项。</p><p id="a104" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用<code class="fe lq lr ls lt b">grep</code>进一步调整您的搜索，只获取包含您想要更改的字符串的文件，例如添加:</p><pre class="kj kk kl km gt lu lt lv lw aw lx bi"><span id="e5ae" class="ly lz it lt b gy ma mb l mc md">grep -le '\&lt;a whale\&gt;'</span></pre><p id="f4c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">-l</code>选项只给出包含与“鲸鱼”匹配的模式(用<code class="fe lq lr ls lt b">-e</code>表示)的所有文件的文件名。</p><p id="bcd9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用<a class="ae me" href="https://github.com/vim/vim" rel="noopener ugc nofollow" target="_blank"> Vim </a>令人印象深刻的<code class="fe lq lr ls lt b">:bufdo</code>可以让您跨多个缓冲区运行相同的命令，交互式地处理所有这些文件，而无需一次打开、保存和关闭一个文件的繁琐工作。</p><p id="fb4d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们将您强大的<code class="fe lq lr ls lt b">find</code> + <code class="fe lq lr ls lt b">grep</code>结果插入到Vim中:</p><pre class="kj kk kl km gt lu lt lv lw aw lx bi"><span id="4ad5" class="ly lz it lt b gy ma mb l mc md">vim `find . -name '*.py' \<br/>-exec grep -le '\&lt;a whale\&gt;' {} \;`</span></pre><p id="a599" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用backtick-expansion将我们的搜索传递给Vim会打开多个准备就绪的缓冲区(更多信息请参见Vim中的<code class="fe lq lr ls lt b">:h backtick-expansion</code>)。现在您可以将Vim命令<code class="fe lq lr ls lt b">:bufdo</code>应用于所有这些文件，并执行诸如交互式搜索和替换之类的操作:</p><pre class="kj kk kl km gt lu lt lv lw aw lx bi"><span id="980e" class="ly lz it lt b gy ma mb l mc md">:bufdo %s/a whale/a bowl of petunias/gce</span></pre><p id="b98f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">“全局”的<code class="fe lq lr ls lt b">g</code>将改变所有行上图案的出现。如果找不到图形，<code class="fe lq lr ls lt b">e</code>将忽略错误。<code class="fe lq lr ls lt b">c</code>选项使其具有交互性。如果你有信心，你可以省略它，不需要逐一检查就可以做出改变。</p><p id="5440" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当你完成了所有的缓冲区，保存你完成的所有工作:</p><pre class="kj kk kl km gt lu lt lv lw aw lx bi"><span id="52cd" class="ly lz it lt b gy ma mb l mc md">:bufdo wq!</span></pre><p id="28b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后享受你节省下来的时间和精力。</p></div></div>    
</body>
</html>