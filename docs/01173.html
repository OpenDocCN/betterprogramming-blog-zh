<html>
<head>
<title>Using Xcode Instruments to Improve App Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Xcode工具提高应用程序性能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-xcode-instruments-to-improve-app-performance-a9b30f5e5813?source=collection_archive---------5-----------------------#2019-08-20">https://betterprogramming.pub/using-xcode-instruments-to-improve-app-performance-a9b30f5e5813?source=collection_archive---------5-----------------------#2019-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a3ea" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">深入可用的工具，开始改进您的应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/979844239b66a97c0514b3f5787df69c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L35piUM3A9oVonHYVo9rBw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@07lista?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">艾米·李斯特</a>在<a class="ae ky" href="https://unsplash.com/search/photos/dive?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="1e4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Xcode  Instruments是Xcode免费提供的开发工具。它有很多有用的工具来检查和改进你的应用程序。尽管它能提供很多东西，但它通常是一个不太为人所知的领域。</p><p id="5e70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这部分在你的应用里越好，你的应用表现越好。</p><p id="520b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇博客文章中，我将向你展示我如何使用Xcode Instruments提高了WeTransfer 应用程序<a class="ae ky" href="https://collect.wetransfer.com" rel="noopener ugc nofollow" target="_blank"> Collect的关键部分的性能。</a></p><p id="1c3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让您对结果有一个概念，这是“导入照片”后得到显著改进的前后结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/992dd2c88cb330ceac99c7379610ddbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Yuofl_gpIIuq32j8JjX-2g.gif"/></div></div></figure><p id="646d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，在旧版本中，导入弹出窗口显示的时间更长，而最终的共享表也延迟了很多。</p><p id="d85d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是时候深入了解并看看我们是如何改进这一流程的了！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4b3b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">什么是Xcode仪器？</h1><p id="6e7d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Xcode Instruments被描述为一个强大而灵活的性能分析和测试工具。它是Xcode工具集的一部分，该工具集还包括Create ML和Accessibility Inspector等工具。</p><p id="89b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些仪器可用于:</p><ul class=""><li id="eb2b" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">追踪源代码中的问题。</li><li id="3455" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">分析你的应用程序的性能。</li><li id="4f8e" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">查找内存问题。</li></ul><p id="87ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有很多！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="89cf" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">如何访问Xcode乐器？</h1><p id="5f8d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">您可以使用Xcode菜单中的<code class="fe no np nq nr b">Product ➔ Profile</code>来访问仪器，该菜单的快捷手柄为<code class="fe no np nq nr b">⌘ + I</code>。这将重建您的产品并打开Xcode仪器概述。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/07bee7cc84626322880facb4d88d3150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4iknyAsePb-zNw6C.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Xcode仪器概述</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="143e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">我应该知道如何使用每个仪器吗？</h1><p id="d4fa" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">展示17种不同乐器的概览可能会让人不知所措。</p><p id="329a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们中的每一个都可能非常有价值，但绝对不是每个应用程序都需要它们。其中一些，比如游戏性能工具，只有在你开发游戏的时候才有价值。</p><p id="8297" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过，深入研究可用的工具并了解哪些工具可用是值得的。你可能会陷入一个可以通过现有工具解决的问题。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9d59" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">我可以在模拟器中使用仪器吗？</h1><p id="a803" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">虽然大多数仪器可以在模拟器上运行，但并不总是建议这样做。物理设备将显示更真实的结果，因此推荐使用。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a858" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用Xcode Instruments时间配置文件研究和提高性能</h1><p id="7f2a" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Time Profiler工具可以深入了解系统的CPU以及多核和线程的使用效率。这部分在你的应用里越好，你的应用表现越好。</p><p id="4dc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在收集应用程序性能示例中，我们的目标是加快向应用程序添加内容的流程。时间分析器是我们洞察哪部分代码可以优化的起点。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e5d9" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用时间剖面仪创建新记录</h1><p id="5585" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">选择Time Profiler仪器后，我们可以按左上方的红色按钮或使用<code class="fe no np nq nr b">⌘ + R</code>开始新的记录。这将在所选设备中启动你的应用程序，之后你可以开始你的流量。</p><p id="aaab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你完成了你想要改进的流程，你可以停止记录，开始研究结果。</p><p id="cb7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先想知道主线程是怎么用的。当主线程上有大量工作发生时，UI被阻塞，这正是我们在Collect应用程序中遇到的问题。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4722" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">使用过滤器创建线程概述</h1><p id="36cc" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">通过选择<em class="nt">螺纹</em>选项卡，过滤栏可用于缩小概览并更好地了解使用的螺纹。</p><p id="c5c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向下滚动显示我们的主线程被大量使用，而其他线程并不那么忙:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/00a3ab5f86c97ced20a01f7f2f5639f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Nw9DzKRwthymATZc.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">时间分析器主线程使用情况</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="c04f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">确定哪部分代码可以优化</h1><p id="d359" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">使用<code class="fe no np nq nr b">⌘ + D</code>将打开<em class="nt">细节区域</em>，如果它还不可见的话。</p><p id="b9af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这显示了突出显示的时间段的符号名称。在前面的示例中，您可以看到图表中的峰值以蓝色突出显示。您可以通过单击并拖动想要调查的零件来完成同样的操作。</p><p id="56a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，从细节区域中的符号名称来看，它看起来非常不可用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/2f88ac705a2f26b66b6d29110a50ac2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B9H9t0J6FZXModwT.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">细节区域中不清楚的符号名称</p></figure><p id="0367" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管细节区域的右侧向我们显示了<em class="nt">最重的堆栈跟踪</em>，但是我们可以使用<em class="nt">调用树</em>输入过滤器来获得更好的概览。这也将通过隐藏某些符号来改善最重堆栈跟踪视图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/5368ab8d8b4bdfeaafe3f7271a6ec222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HnucFdz122Cch94S.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在详细信息区域隐藏系统库</p></figure><p id="a69d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从<em class="nt">隐藏系统库</em>开始，它将去掉所有不在我们控制范围内的低级符号，我们也无法对它们进行优化。正如你所看到的，最重的堆栈跟踪现在要干净得多。</p><p id="e688" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来是<em class="nt">反转调用树</em>过滤器，它将使顶层方法可见，而不必单击每个调用树。</p><p id="6f5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结合对<em class="nt"> Weight </em>列的排序，我们可以确切地看到哪些方法应该被优化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/6c7d3ae5de93842af8586ed5f731af8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rXpqKdfF6JG03eRC.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于缩小结果范围的时间剖面输入过滤器</p></figure><p id="439a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很明显，我们的<code class="fe no np nq nr b">PHImageManager</code>代码表现最差，因为它花费了总时间11.16秒中的3.36秒。事实证明，我们可以很容易地将这一部分转移到后台线程，并为这一部分卸载主线程。</p><p id="2ffa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们注意到的另一件事是<code class="fe no np nq nr b">BucketHeaderView</code>，它一直在重新计算它的高度，尽管我们在测试的流中没有对它做任何事情。事实证明，我们确实不必这样做。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f197" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">验证结果</h1><p id="fd59" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在您改进了代码之后，是时候重新运行时间分析器并验证结果，以确保它确实得到了改进。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/6b2b5dbbeb38aa366c254aa96cab8606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BGJ6OUPnYrR2S7S8.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在时间分析器中验证结果</p></figure><p id="77f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我们已经在之前分享的前后视频中看到了改进，但我们现在可以看到，同一个流不再包含作为最重堆栈跟踪的<code class="fe no np nq nr b">PHImageManager</code>。这证实了我们的代码更改是有效的。</p><p id="b8f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">标题也不再重新计算，我们的流的性能得到了改善。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="11ad" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="644c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Xcode Instruments包含许多有价值的工具，可以提高应用程序的性能。时间分析器可用于深入某个流程，改进一段代码，然后立即进行验证。</p><p id="c687" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">花些时间钻研可用的工具，这样你就知道哪些是有用的，并开始改进你的应用程序。</p></div></div>    
</body>
</html>