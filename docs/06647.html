<html>
<head>
<title>A Deep Dive Into GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对GitHub动作的深入探究</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-deep-dive-into-github-actions-51e234da0c50?source=collection_archive---------8-----------------------#2020-10-21">https://betterprogramming.pub/a-deep-dive-into-github-actions-51e234da0c50?source=collection_archive---------8-----------------------#2020-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="af5e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解动作的架构、两种类型的动作以及如何构建JavaScript动作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c42dac84c5c527282385470986f7c030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WaaXnUvhvrswhBJSw4YTuQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub徽标</p></figure><p id="6e29" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的<a class="ae lu" href="https://medium.com/better-programming/deploy-your-gatsby-site-with-github-actions-e761ea93813f" rel="noopener">上一篇文章</a>中，我概述了GitHub动作，并演示了如何使用一个<a class="ae lu" href="https://github.com/marketplace/actions/gatsby-publish" rel="noopener ugc nofollow" target="_blank">现有动作</a>将一个Gatsby站点部署到GitHub页面。在这篇文章中，我想深入探究GitHub动作，探究它们背后的潜在动机、架构以及构建自定义动作的步骤。</p><p id="8e2e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在进入GitHub动作的细节之前，让我们通过首先深入研究GitHub事件以及GitHub如何支持这些事件的处理来理解它们带来的价值。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e471" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">GitHub事件</h1><p id="c961" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated"><a class="ae lu" href="http://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>使用Git为软件项目和版本控制提供托管服务。它通过支持跨团队(通常是分布式的)、代码审查和项目管理的协作，形成了软件开发生命周期的核心。</p><p id="a931" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">GitHub事件在帮助GitHub做它最擅长的事情方面发挥了很大的作用，同时也提供了可扩展性点来与软件开发生命周期中使用的其他工具集成。你可以用GitHub来合作开发源代码，用<a class="ae lu" href="https://www.atlassian.com/software/jira?&amp;aceid=&amp;adposition=&amp;adgroup=89541920342&amp;campaign=9124878366&amp;creative=415596748931&amp;device=c&amp;keyword=jira&amp;matchtype=e&amp;network=g&amp;placement=&amp;ds_kids=p51241989307&amp;ds_e=GOOGLE&amp;ds_eid=700000001558501&amp;ds_e1=GOOGLE&amp;gclid=Cj0KCQjwuL_8BRCXARIsAGiC51Cdwq74xFOF4AuRaEMtphFQLNLRM6fjsLjW61G_Liyf16GKepDxlusaAsBWEALw_wcB&amp;gclsrc=aw.ds" rel="noopener ugc nofollow" target="_blank"> JIRA </a>来管理项目，用<a class="ae lu" href="https://confluence.atlassian.com/doc/confluence-data-center-and-server-documentation-135922.html" rel="noopener ugc nofollow" target="_blank"> Confluence </a>来记录流程。GitHub事件帮助您扩展在GitHub上执行的典型活动，并与您已经使用的其他工具挂钩。</p><blockquote class="mz na nb"><p id="abf7" class="ky kz nc la b lb lc ju ld le lf jx lg nd li lj lk ne lm ln lo nf lq lr ls lt im bi translated">“每个事件对应于您的组织和/或存储库中可能发生的一组特定操作。例如，如果您订阅了问题事件，您将在每次打开、关闭、标记问题时收到详细的有效负载。”— <a class="ae lu" href="https://docs.github.com/en/enterprise-server@2.21/developers/webhooks-and-events/about-webhooks" rel="noopener ugc nofollow" target="_blank"> GitHub文档</a></p></blockquote><p id="bc01" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，当一个pull请求在GitHub上被合并时，您可能希望更新JIRA相应票据的状态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/f7310202e4e444c0af39c88561f75d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jJqXKZ9yXxMtXKxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过处理GitHub事件来扩展GitHub活动</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cd07" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">你能对哪些GitHub事件做出反应？</h1><p id="6e33" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">GitHub提供广泛的<a class="ae lu" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows" rel="noopener ugc nofollow" target="_blank">事件报道</a>。您可以挂接在GitHub上执行的大量活动，并根据您的团队或您的业务需求扩展它们。</p><p id="9950" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如:</p><ul class=""><li id="0bbe" class="nh ni it la b lb lc le lf lh nj ll nk lp nl lt nm nn no np bi translated">当GitHub中发生与<strong class="la iu">问题</strong>相关的事情时，<a class="ae lu" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#issues" rel="noopener ugc nofollow" target="_blank">问题</a>事件可以用来影响另一个系统中的变化。</li><li id="29cb" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">当与<strong class="la iu">拉取请求</strong>相关的事情发生时，可以类似地使用<a class="ae lu" href="https://docs.github.com/en/free-pro-team@latest/developers/webhooks-and-events/webhook-events-and-payloads#pull_request_review" rel="noopener ugc nofollow" target="_blank">拉取请求</a>事件。</li></ul><p id="0d4d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">可能性是无限的——您可以在每次合并时自动发现并修复代码中的lint问题，在每次部署失败时发送电报消息，或者自动标记对存储库的每个新的pull请求。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8a1a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在GitHub动作之前对事件做出反应</h1><p id="212c" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">那么，如何监听GitHub事件并对其做出反应呢？在GitHub动作之前，<a class="ae lu" href="https://docs.github.com/en/free-pro-team@latest/developers/webhooks-and-events/about-webhooks" rel="noopener ugc nofollow" target="_blank"> webhooks </a>是消费GitHub事件的推荐方式。</p><p id="8c18" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，事件侦听器是一个公开HTTP端点的web服务。您可以在GitHub存储库上配置一个webhook，使用这个端点作为事件的交付目标。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/d39614df40d3b56373a3b1fe021c01c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RsP70irqTQz4vBVry6uH-w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub存储库的Webhook设置页面</p></figure><p id="e9f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每当存储库中发生活动时，GitHub就会向该端点发布感兴趣的事件。webhook可以通过执行一些自定义代码来响应事件，从而扩展活动。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/5d13c1bc493489c5d0a88a5587fbf35c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AqK2xZ9sEe23H9wE.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用webhook响应GitHub事件</p></figure><p id="5652" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">webhooks最大的缺点是必须支持外部服务。这意味着编写一个新的服务，部署它，并维护它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e4fb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">输入GitHub操作</h1><p id="3daf" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated"><a class="ae lu" href="https://docs.github.com/en/free-pro-team@latest/actions/creating-actions/about-actions" rel="noopener ugc nofollow" target="_blank"> GitHub动作</a>提供了一种在GitHub平台内对GitHub事件做出反应的方式，而不是让一个独立部署的webhook来接收和处理事件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/9e3fbf4249587d90797bdf191266d2bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jgnax71YqF3SWaZk.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用基于GitHub动作的工作流来响应GitHub事件</p></figure><blockquote class="mz na nb"><p id="c495" class="ky kz nc la b lb lc ju ld le lf jx lg nd li lj lk ne lm ln lo nf lq lr ls lt im bi translated">" GitHub Actions是您的工作流程:由您构建，由我们运行."—<a class="ae lu" href="https://github.blog/2018-10-17-action-demos/" rel="noopener ugc nofollow" target="_blank">GitHub博客</a></p></blockquote><p id="4593" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">GitHub操作提供了许多优势:</p><ol class=""><li id="321d" class="nh ni it la b lb lc le lf lh nj ll nk lp nl lt nx nn no np bi translated">提供对GitHub中的事件做出反应的能力。这避免了引入第三方工具，并防止数据流经另一个服务。</li><li id="2102" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nx nn no np bi translated">提供比CI/CD单独服务更低的<a class="ae lu" href="https://docs.github.com/en/free-pro-team@latest/github/setting-up-and-managing-billing-and-payments-on-github/about-billing-for-github-actions#about-billing-for-github-actions" rel="noopener ugc nofollow" target="_blank">定价方案</a>。它对公共存储库是免费的，对私人存储库是按需付费的。</li><li id="bda8" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nx nn no np bi translated">允许重复使用共享的工作流。这一点尤其重要，因为它避免了开发人员不得不一遍又一遍地解决相同的问题。相反，公共工作流创建了一个动作的<a class="ae lu" href="https://github.com/marketplace?type=actions" rel="noopener ugc nofollow" target="_blank">生态系统，开发者可以派生、编辑、迭代和改进，就像代码一样。</a></li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c36b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">构建模块—工作流、作业、步骤、操作和运行器</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/03036a6a7425627fb28ff78121b6aced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xaWrleeIdi2c0Y-6.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">工作流程的组成部分:作者图片</p></figure><p id="e79d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">GitHub事件触发工作流。</p><ul class=""><li id="e203" class="nh ni it la b lb lc le lf lh nj ll nk lp nl lt nm nn no np bi translated">一个<strong class="la iu">工作流</strong>有一个或多个任务(默认情况下并行运行)。</li><li id="9e74" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">一个<strong class="la iu">作业</strong>有一个或多个步骤在同一个<strong class="la iu">运行器</strong>上执行。同一作业中的步骤可以将数据传递给后续步骤。</li><li id="1dbd" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">一个<strong class="la iu">步骤</strong>由一个<strong class="la iu">动作</strong>、该动作的输入和一个可选名称组成。</li><li id="5f73" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">因此，<strong class="la iu">动作</strong>是工作流中最小的独立组件。</li><li id="a090" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated"><strong class="la iu"> runner </strong>是安装了GitHub Actions runner应用程序的服务器，该应用程序监听作业，一次运行一个作业，报告进度，并记录结果。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="529a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">GitHub操作的类型</h1><p id="f2e1" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">动作是工作流中最小的独立组件。它封装了执行单个逻辑任务所需的代码——签出存储库、设置节点或部署静态站点。</p><p id="7790" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们在上面看到的，这些逻辑任务可以组合起来执行一个完整的工作。</p><p id="632b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有两种方法<a class="ae lu" href="https://www.reddit.com/r/docker/comments/gopv3w/github_actions_docker_containers_vs_javascript/" rel="noopener ugc nofollow" target="_blank">来编写GitHub动作:</a></p><h2 id="9719" class="ny md it bd me nz oa dn mi ob oc dp mm lh od oe mo ll of og mq lp oh oi ms oj bi translated">JavaScript操作</h2><p id="fcfe" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在这里，您用Javascript编写动作代码。这段代码是使用您在<code class="fe ok ol om on b">action.yml</code>(元数据)文件中指定的节点版本执行的(稍后将详细介绍)。</p><p id="2a26" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种方法有一些缺点:</p><ol class=""><li id="c8aa" class="nh ni it la b lb lc le lf lh nj ll nk lp nl lt nx nn no np bi translated">动作<strong class="la iu">取决于运行器</strong>上可用的节点版本。比如GitHub上的<a class="ae lu" href="https://github.com/actions/virtual-environments/blob/main/images/linux/Ubuntu1804-README.md" rel="noopener ugc nofollow" target="_blank"> Ubuntu-18 Runner </a>运行节点12。如果您使用自己的运行Node 10的runner，为Node 12编写的Javascript动作可能无法正常工作。</li><li id="bcd3" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nx nn no np bi translated"><strong class="la iu">依赖项需要与动作</strong>打包在一起(要么通过将<code class="fe ok ol om on b">node_modules</code>文件夹包含在动作存储库中，要么通过使用<a class="ae lu" href="https://docs.github.com/en/free-pro-team@latest/actions/creating-actions/creating-a-javascript-action#commit-tag-and-push-your-action-to-github" rel="noopener ugc nofollow" target="_blank"> vercel/ncc </a>将<code class="fe ok ol om on b">node_modules</code>文件夹打包成一个文件)。</li></ol><h2 id="7a16" class="ny md it bd me nz oa dn mi ob oc dp mm lh od oe mo ll of og mq lp oh oi ms oj bi translated">Docker容器操作</h2><p id="3877" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">Docker容器将GitHub动作的环境和代码捆绑在一起，这使得它成为一种更可靠的打包动作的方式。</p><p id="1521" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">动作的消费者不需要担心动作中使用的工具或依赖关系。例如，如果动作指定了节点版本12，但是在运行节点10的非标准运行程序上运行，这不会导致问题，因为Docker动作在其自己的容器中运行，该容器具有该动作的正确节点版本。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5984" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建Javascript操作</h1><p id="47ff" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在<a class="ae lu" href="https://medium.com/@deborah.gertrude.digges/pr-bot-8402805ab7d4" rel="noopener">之前的一篇文章</a>中，我描述了我如何设置GitHub webhook来评论新贡献者在存储库上打开的pull请求。我将介绍如何使用GitHub操作来重现这种行为。</p><h2 id="e01d" class="ny md it bd me nz oa dn mi ob oc dp mm lh od oe mo ll of og mq lp oh oi ms oj bi translated">正在初始化存储库</h2><ol class=""><li id="4901" class="nh ni it la b lb mu le mv lh oo ll op lp oq lt nx nn no np bi translated">创建一个空文件夹</li><li id="4aac" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nx nn no np bi translated">文件夹内:<code class="fe ok ol om on b">npm init -y</code></li></ol><h2 id="d663" class="ny md it bd me nz oa dn mi ob oc dp mm lh od oe mo ll of og mq lp oh oi ms oj bi translated">描述动作</h2><p id="80fe" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在同一个文件夹中创建一个<code class="fe ok ol om on b">action.yml</code>文件。该文件包含描述动作意图、输入和输出的元数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="98b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们的操作需要一个<code class="fe ok ol om on b">access-token</code>来代表用户评论一个拉请求。对新贡献者的欢迎<code class="fe ok ol om on b">message</code>也是可配置的。</p><p id="2253" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们指定动作在<code class="fe ok ol om on b">node12</code>上运行，还指定入口点为<code class="fe ok ol om on b">src/index.js</code>(动作代码所在的位置)。</p><h2 id="2836" class="ny md it bd me nz oa dn mi ob oc dp mm lh od oe mo ll of og mq lp oh oi ms oj bi translated">添加工具包依赖项</h2><p id="6d01" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">GitHub提供了一个action <a class="ae lu" href="https://github.com/actions/toolkit" rel="noopener ugc nofollow" target="_blank"> toolkit </a>,其中包含任何操作都需要的基本工具。我们将使用这些实用程序来读取事件负载，创建GitHub API客户端，以及其他我们不希望自己构建的细节。</p><pre class="kj kk kl km gt ot on ou ov aw ow bi"><span id="4675" class="ny md it on b gy ox oy l oz pa">npm install @actions/core<br/>npm install @actions/github</span></pre><h2 id="e49e" class="ny md it bd me nz oa dn mi ob oc dp mm lh od oe mo ll of og mq lp oh oi ms oj bi translated">编写操作代码</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><ul class=""><li id="d283" class="nh ni it la b lb lc le lf lh nj ll nk lp nl lt nm nn no np bi translated">我们从GitHub action toolkit中导入<code class="fe ok ol om on b">core</code>和<code class="fe ok ol om on b">github</code>模块。</li><li id="190f" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">我们使用<code class="fe ok ol om on b">core.getInput</code>函数访问动作的输入。</li><li id="9c45" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">我们使用<code class="fe ok ol om on b">github</code>模块:<code class="fe ok ol om on b">github.context.payload</code>访问事件负载。</li><li id="1e9e" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">我们使用<code class="fe ok ol om on b">github</code>模块:<code class="fe ok ol om on b">github.getOctokit(accessToken)</code>创建一个GitHub客户端，并从输入中获取访问令牌。</li><li id="5938" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">我们检查<code class="fe ok ol om on b">payload</code>看它是否是一个新的拉请求(即<code class="fe ok ol om on b">action</code>是<code class="fe ok ol om on b">opened</code>)。我们还检查这是否是一个新贡献者发出的拉请求。</li><li id="e27d" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">如果是，我们使用之前创建的<code class="fe ok ol om on b">githubClient</code>来注释pull请求:<code class="fe ok ol om on b">githubClient.issues.createComment</code>。</li></ul><p id="ea5c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！</p><h2 id="d4ba" class="ny md it bd me nz oa dn mi ob oc dp mm lh od oe mo ll of og mq lp oh oi ms oj bi translated">提交代码</h2><ol class=""><li id="0c25" class="nh ni it la b lb mu le mv lh oo ll op lp oq lt nx nn no np bi translated">添加<code class="fe ok ol om on b">src</code>文件夹、<code class="fe ok ol om on b">package.json</code>和<code class="fe ok ol om on b">package-lock.json</code>文件以及<code class="fe ok ol om on b">node_modules</code>文件夹。</li><li id="ebff" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nx nn no np bi translated">提交您的更改。</li><li id="86b2" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nx nn no np bi translated">标记您的更改:<code class="fe ok ol om on b">git tag -am "Release version 1.0" v1.0</code>。</li><li id="e18d" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nx nn no np bi translated">将您的更改推送到GitHub上的一个存储库中:<code class="fe ok ol om on b">git push --follow-tags</code>。</li></ol><p id="a379" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要查看这个GitHub动作的完整代码，请查看我在GitHub上的<a class="ae lu" href="https://github.com/Deborah-Digges/new-pull-request-comment-action" rel="noopener ugc nofollow" target="_blank">库</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="785c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在存储库工作流中使用操作</h1><p id="8770" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">转到存储库，在那里您希望使用这个操作来评论新贡献者提出的pull请求。在这个存储库中，添加一个<code class="fe ok ol om on b">.github/workflows</code>文件夹。向该文件夹添加一个<code class="fe ok ol om on b">.yml</code>文件来描述该工作流程:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="d4de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在此指定要运行此工作流的响应事件。在我们的例子中，我们希望它在<code class="fe ok ol om on b">main</code>分支的<code class="fe ok ol om on b">pull_request</code>上。</p><p id="e475" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该工作流有一个名为<code class="fe ok ol om on b">comment</code>的单一作业，它有一个由我们刚刚创建的动作和该动作使用的输入组成的单一步骤。我们使用以下格式引用我们创建的操作:<code class="fe ok ol om on b">deborah-digges/new-pull-request-comment-action@v1.9</code>，它表示:</p><ul class=""><li id="00cc" class="nh ni it la b lb lc le lf lh nj ll nk lp nl lt nm nn no np bi translated">在其下查找操作的GitHub用户名或组织</li><li id="3b10" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">操作及其依赖项所在的存储库名称</li><li id="75d5" class="nh ni it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">操作的版本(可以是标记或提交散列的形式)</li></ul><h2 id="f107" class="ny md it bd me nz oa dn mi ob oc dp mm lh od oe mo ll of og mq lp oh oi ms oj bi translated">添加访问令牌</h2><p id="311d" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们将动作的<code class="fe ok ol om on b">access-token</code>输入指定为值<code class="fe ok ol om on b">${{ secrets.ACCESS_TOKEN }}</code>。要设置这个值，需要向存储库中的<code class="fe ok ol om on b">Secrets</code>部分添加一个<a class="ae lu" href="https://github.com/settings/tokens/" rel="noopener ugc nofollow" target="_blank">个人访问令牌</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/1507448fb71d146daeb31a54810f0a51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MEYarUWRCL3bnxHL.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub存储库中的Secrets部分</p></figure><p id="5f20" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://github.com/Deborah-Digges/test-github-action" rel="noopener ugc nofollow" target="_blank">查看使用该动作的库</a>的完整源代码。</p><h2 id="4902" class="ny md it bd me nz oa dn mi ob oc dp mm lh od oe mo ll of og mq lp oh oi ms oj bi translated">对动作进行测试</h2><p id="dae7" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">去吧！通过向您的存储库发出拉请求来测试您的新工作流！如果这是您第一次向资源库发出pull请求，您应该会从友好的GitHub操作中看到一条欢迎消息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="977e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望您喜欢这次对GitHub操作的深入探究。请继续关注我的下一篇文章，我将详细介绍如何制作Docker容器GitHub动作。激动人心的时刻即将到来！</p></div></div>    
</body>
</html>