<html>
<head>
<title>How To Correctly Build a Multi-Environment React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何正确构建多环境React App</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-correctly-build-a-multi-environment-react-app-6ba4878e98ba?source=collection_archive---------1-----------------------#2021-04-14">https://betterprogramming.pub/how-to-correctly-build-a-multi-environment-react-app-6ba4878e98ba?source=collection_archive---------1-----------------------#2021-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3505" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为每个环境保留一个专用的构建文件夹</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7e81f00b410553a89995c0e33353220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hNlydNHYJ140RQ1KX0tlOA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@jexo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Jexo </a>在<a class="ae ky" href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="12fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在开发React应用程序时，您可能需要<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/environment-based-error-handling-with-spring-boot-and-kotlin-b36b901135ad">处理不同的环境</a>。根据我的经验，你至少应该考虑以下三种<a class="ae ky" href="https://en.wikipedia.org/wiki/Deployment_environment" rel="noopener ugc nofollow" target="_blank">环境</a>:</p><ul class=""><li id="f99d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">发展</li><li id="e9e5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">脚手架</li><li id="7912" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">生产</li></ul><p id="611c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将React应用程序部署到最后两个环境之一之前，您需要构建它。这通常通过运行一个命令来实现，该命令旨在创建一个保存在项目的<code class="fe mj mk ml mm b">build</code>文件夹中的可部署构建。</p><div class="mn mo gp gr mp mq"><a rel="noopener  ugc nofollow" target="_blank" href="/environment-based-error-handling-with-spring-boot-and-kotlin-b36b901135ad"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">Spring Boot和科特林基于环境的错误处理</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">简化登台环境中的调试</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">better编程. pub</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne ks mq"/></div></div></a></div><p id="95b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法有一个巨大的缺点。例如，您不能并行启动许多构建命令。事实上，它们都依赖于同一个文件夹。因此，在处理多种环境时，这可能是一个瓶颈。</p><p id="47bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，由于每个环境都共享相同的构建文件夹，所以很难直观地判断出您最后一次构建的目标环境是什么。这也会导致错误。</p><p id="0c3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何通过在React中正确构建多环境应用来避免这种情况。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="70cd" class="nm nn it bd no np nq nr ns nt nu nv nw jz nx ka ny kc nz kd oa kf ob kg oc od bi translated">1.安装所需的依赖项</h1><p id="b217" class="pw-post-body-paragraph kz la it lb b lc oe ju le lf of jx lh li og lk ll lm oh lo lp lq oi ls lt lu im bi translated">首先，您需要将<code class="fe mj mk ml mm b"><a class="ae ky" href="https://www.npmjs.com/package/react-app-rewired" rel="noopener ugc nofollow" target="_blank">react-app-rewired</a></code>和<code class="fe mj mk ml mm b"><a class="ae ky" href="https://www.npmjs.com/package/env-cmd" rel="noopener ugc nofollow" target="_blank">env-cmd</a></code>添加到项目的依赖项中。您可以使用以下命令安装这两者:</p><pre class="kj kk kl km gt oj mm ok ol aw om bi"><span id="53b4" class="on nn it mm b gy oo op l oq or">npm install react-app-rewired env-cmd --save</span></pre><p id="1708" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了能够指定定制的构建路径，您必须更改您的<a class="ae ky" href="https://webpack.js.org/configuration/" rel="noopener ugc nofollow" target="_blank"> webpack配置</a>。如果你使用<code class="fe mj mk ml mm b"><a class="ae ky" href="https://reactjs.org/docs/create-a-new-react-app.html" rel="noopener ugc nofollow" target="_blank">create-react-app</a></code>创建了你的应用程序，你可能会被迫<a class="ae ky" href="https://create-react-app.dev/docs/available-scripts/#npm-run-eject" rel="noopener ugc nofollow" target="_blank">退出你的项目</a>——如果没有严格的要求，这应该避免。</p><p id="bffb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是<code class="fe mj mk ml mm b">react-app-rewired</code>发挥作用的地方！</p><p id="153a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="os">注意:如果你的项目已经使用了</em> <code class="fe mj mk ml mm b"><em class="os">react-app-rewired</em></code> <em class="os">，可以跳过下面两步。</em></p><p id="abf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多亏了它，你可以很容易地调整<code class="fe mj mk ml mm b">create-react-app</code>网络包配置。为了让一切正常工作，您需要遵循以下两个步骤:</p><ol class=""><li id="620c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ot mb mc md bi translated">在根目录下创建一个有效的<code class="fe mj mk ml mm b">config-overrides.js</code>文件。</li><li id="6f73" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ot mb mc md bi translated">在您的<code class="fe mj mk ml mm b">package.json</code>文件的<code class="fe mj mk ml mm b">scripts</code>部分，将现有的引用从<code class="fe mj mk ml mm b">react-scripts</code>更改为<code class="fe mj mk ml mm b">react-app-rewired</code>。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">以前</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在...之后</p></figure><p id="ccfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您刚刚重新连接了React应用程序，现在可以定义基于环境的构建路径了。</p><p id="415f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，<code class="fe mj mk ml mm b">react-app-rewired</code>还能让你实现其他不可思议的目标。例如，<a class="ae ky" href="https://javascript.plainenglish.io/avoid-the-fear-of-refactoring-with-absolute-imports-in-react-804bce61dc31" rel="noopener ugc nofollow" target="_blank">定义绝对路径别名以使你的导入易于重构</a>。</p><div class="mn mo gp gr mp mq"><a href="https://javascript.plainenglish.io/avoid-the-fear-of-refactoring-with-absolute-imports-in-react-804bce61dc31" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">避免对React中绝对导入的重构的恐惧</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">在React中使用绝对路径别名使导入易于重构</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mz l"><div class="ow l nb nc nd mz ne ks mq"/></div></div></a></div></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="9dad" class="nm nn it bd no np nq nr ns nt nu nv nw jz nx ka ny kc nz kd oa kf ob kg oc od bi translated">2.定义环境文件</h1><p id="44bf" class="pw-post-body-paragraph kz la it lb b lc oe ju le lf of jx lh li og lk ll lm oh lo lp lq oi ls lt lu im bi translated">现在，是时候为您的每个环境定义一个<code class="fe mj mk ml mm b">.env</code>文件了。这样的文件应该包含其值取决于当前环境的任何变量。</p><p id="7a6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们定义两个<code class="fe mj mk ml mm b">.env</code>文件，我们将根据当前环境在其中放置构建路径。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">登台环境文件</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生产环境文件。</p></figure><p id="b79c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="os">注意:如</em> <a class="ae ky" href="https://create-react-app.dev/docs/adding-custom-environment-variables/" rel="noopener ugc nofollow" target="_blank"> <em class="os"> Create React App文档</em> </a> <em class="os">中所述，每个环境变量都必须以</em> <code class="fe mj mk ml mm b"><em class="os">REACT_APP_</em></code> <em class="os">开头。</em></p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="2baa" class="nm nn it bd no np nq nr ns nt nu nv nw jz nx ka ny kc nz kd oa kf ob kg oc od bi translated">3.使用环境变量</h1><p id="c159" class="pw-post-body-paragraph kz la it lb b lc oe ju le lf of jx lh li og lk ll lm oh lo lp lq oi ls lt lu im bi translated">要从环境文件中读取构建路径并将其用作构建的基本路径，定义一个<code class="fe mj mk ml mm b">config-overrides.js</code>文件，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="87db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我确保了<code class="fe mj mk ml mm b">appBuild</code>变量有一个有效的回退值。这是极其重要的。空的、<code class="fe mj mk ml mm b">null</code>或<code class="fe mj mk ml mm b">undefined</code> <em class="os"> </em>字符串<em class="os"> </em>可能会导致构建过程严重出错，潜在地影响您的整个代码库。</p><p id="a7aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您应该为每个<code class="fe mj mk ml mm b">.env</code>文件定义一个构建命令。通过使用<code class="fe mj mk ml mm b">env-cmd</code>，您可以通过使用<code class="fe mj mk ml mm b"><a class="ae ky" href="https://www.npmjs.com/package/env-cmd#using-custom-env-file-path" rel="noopener ugc nofollow" target="_blank">-f</a></code> <a class="ae ky" href="https://www.npmjs.com/package/env-cmd#using-custom-env-file-path" rel="noopener ugc nofollow" target="_blank">标志</a>向您的构建命令传递一个定制的<code class="fe mj mk ml mm b">.env</code>文件。</p><p id="e65e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保您的<code class="fe mj mk ml mm b">package.json</code>文件的<code class="fe mj mk ml mm b">scripts</code>部分包含以下两行:</p><pre class="kj kk kl km gt oj mm ok ol aw om bi"><span id="ebaf" class="on nn it mm b gy oo op l oq or">"build": "react-app-rewired build",<br/>"build:staging": "env-cmd -f .env.staging npm run build"</span></pre><p id="1289" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，将使用<code class="fe mj mk ml mm b">env.production</code> <em class="os"> </em>文件，因此不需要在第一个命令中指定它。</p><p id="6782" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以使用以下命令创建一个基于环境的构建。</p><p id="b377" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于登台环境:</p><pre class="kj kk kl km gt oj mm ok ol aw om bi"><span id="f2f7" class="on nn it mm b gy oo op l oq or">npm run build:staging</span></pre><p id="6dbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于生产环境:</p><pre class="kj kk kl km gt oj mm ok ol aw om bi"><span id="7f55" class="on nn it mm b gy oo op l oq or">npm run build</span></pre><p id="1c7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建将被放置在<code class="fe mj mk ml mm b">REACT_APP_BUILD_PATH</code>环境变量中定义的目标路径中。如果您遵循这个示例，您的试运行构建将在<code class="fe mj mk ml mm b">build-staging</code>文件夹中创建，而您的生产构建将在<code class="fe mj mk ml mm b">build</code>文件夹中创建。</p><p id="33d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊！现在，您的每个环境都有一个专用的构建文件夹。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><h1 id="5981" class="nm nn it bd no np nq nr ns nt nu nv nw jz nx ka ny kc nz kd oa kf ob kg oc od bi translated">结论</h1><p id="a8e2" class="pw-post-body-paragraph kz la it lb b lc oe ju le lf of jx lh li og lk ll lm oh lo lp lq oi ls lt lu im bi translated">今天，我们学习了如何为React应用程序的每个环境定义一个构建文件夹。这样，您可以并行启动不同的构建命令，并确保它们都有自己专用的目标文件夹。正如我刚刚展示的，这可以通过使用<code class="fe mj mk ml mm b">react-app-rewire</code>和<code class="fe mj mk ml mm b">env-cmd</code>很容易地实现。此外，这种方法可以很容易地扩展到任何数量的环境。</p><p id="ba77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！我希望这篇文章对你有所帮助。请随意留下任何问题、评论或建议。</p></div></div>    
</body>
</html>