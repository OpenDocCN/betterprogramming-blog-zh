<html>
<head>
<title>How to Prompt Users of New App Versions With Service Workers in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用React中的服务人员提示用户新的App版本</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/prompting-new-app-versions-with-the-service-worker-and-create-react-app-bf3350d3bed1?source=collection_archive---------11-----------------------#2020-08-18">https://betterprogramming.pub/prompting-new-app-versions-with-the-service-worker-and-create-react-app-bf3350d3bed1?source=collection_archive---------11-----------------------#2020-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fc14" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建一个React应用和一个服务人员来提醒您的用户</h2></div><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/6cf01d724902b96cbf39a9ca9f7a80f3.png" data-original-src="https://miro.medium.com/v2/0*ALmUvOqXTpK8cYSn"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者照片(背景由<a class="ae ku" href="https://unsplash.com/@clemhlrdt" rel="noopener ugc nofollow" target="_blank"> Clément H </a>上<a class="ae ku" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>)。</p></figure><p id="4a4e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">服务人员可以成为提高应用程序性能的强大工具。它们提供了一些强大的缓存机制和现代功能。但是，它们在web开发中普遍被误解。</p><p id="9473" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">一个常见的误解是，当新内容可用时，它只会在渐进式web应用程序的所有选项卡都关闭后加载。</p><p id="65e9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">虽然这可能是默认行为，但是您可以通过跳过等待并提示用户更新来加快这个过程。</p><p id="ce7e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在这个简短的教程中，我们将对一个<a class="ae ku" href="https://create-react-app.dev/" rel="noopener ugc nofollow" target="_blank"> Create React App </a>设置进行同样的操作。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="aeaa" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">创建React应用程序</h1><p id="8ad3" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">我们将使用<code class="fe mv mw mx my b">npx create-react-app</code>并在全球范围内安装<a class="ae ku" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank"> Vercel </a>的<code class="fe mv mw mx my b">serve</code>来服务我们的构建:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="56eb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在建造之前，让我们更新一下<code class="fe mv mw mx my b">index.js</code>:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="9a4b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在这里，我们正在为CRA为我们提供的开箱即用的<code class="fe mv mw mx my b">onUpdate</code>处理程序添加我们的神奇代码。</p><p id="18ed" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在这段代码中，我们将检查是否有服务人员在等待文件更改。如果是这样，我们只需添加一个状态改变事件，并向<code class="fe mv mw mx my b">SKIP_WAITING</code>发送一条消息。</p><p id="1b03" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，下一次我们重新加载应用程序时，我们将被提示一个“确认”对话框来重新加载我们最新更新的页面！</p><p id="bf06" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果用户愿意，他们仍然可以选择拒绝更改。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="2128" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">建造和服务</h1><p id="940c" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">让我们建立并运行:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="ef54" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在在港口5000(或无论你有什么)，你会看到通常的基本CRA已经建成。</p><p id="d5bc" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们做一些改变，看看我们的提示在行动中！</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="46cb" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">对React应用程序进行更改</h1><p id="dec0" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">更新应用程序，拥有你想要的一切。这可以包括改变风格等。(我在下面的例子中已经做到了):</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="f575" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">一旦你高兴了，就简单地运行<code class="fe mv mw mx my b">yarn build</code>。</p><p id="212c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><em class="nb">注意:在服务器运行时，在另一个选项卡中执行此操作。这里没有真正的原因，除了防止自己怀疑为什么会发生变化。</em></p><p id="2431" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果您在端口5000上重新加载React应用程序，过一会儿，您会在控制台中看到以下内容:</p><pre class="ki kj kk kl gt nc my nd ne aw nf bi"><span id="f855" class="ng lz it my b gy nh ni l nj nk">New content is available and will be used when all tabs for this page are closed.</span></pre><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/7266b95a1a0594d33a91d993349c19e9.png" data-original-src="https://miro.medium.com/v2/0*5FlVv7Oqf-r0Z0hF"/></div></figure><p id="8cf4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">事实上，该日志是我们自定义的<code class="fe mv mw mx my b">onUpdate</code>钩子发挥作用之前的前兆。同时，屏幕上会出现一个窗口对话框:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/3e482ac1f130c23b71a50e77bceb11c4.png" data-original-src="https://miro.medium.com/v2/0*LNDGFBxLNJkepqYd"/></div></figure><p id="43e9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果我们接受(如果您愿意，您可以取消)，您将看到我们更新的应用程序！</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/c785005241b38fe5ca69974076c083c5.png" data-original-src="https://miro.medium.com/v2/0*M_ftVuxxc9kunfDM"/></div></figure><p id="999e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">胜利！</p><p id="5f4f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当然，你不必使用窗口对话框。一旦收到通知，你就可以随心所欲地让用户知道他们可以在重新加载时更新应用程序。事实上，你可以粗鲁地在它们上面重新加载页面(虽然我不会！).</p><p id="0870" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">最后一点，大多数主流浏览器都支持这一功能，但是Safari iOS <a class="ae ku" href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/waiting" rel="noopener ugc nofollow" target="_blank">不支持这一功能</a>。取舍由你决定！</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="be11" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">资源和进一步阅读</h1><ol class=""><li id="e146" class="nl nm it kx b ky mq lb mr le nn li no lm np lq nq nr ns nt bi translated"><a class="ae ku" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/confirm" rel="noopener ugc nofollow" target="_blank">窗口对话框</a></li><li id="9a6a" class="nl nm it kx b ky nu lb nv le nw li nx lm ny lq nq nr ns nt bi translated"><a class="ae ku" href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" rel="noopener ugc nofollow" target="_blank">维修工人API </a></li><li id="84df" class="nl nm it kx b ky nu lb nv le nw li nx lm ny lq nq nr ns nt bi translated"><a class="ae ku" href="https://googlechrome.github.io/samples/service-worker/post-message/" rel="noopener ugc nofollow" target="_blank">服务人员发布消息</a></li><li id="ad2b" class="nl nm it kx b ky nu lb nv le nw li nx lm ny lq nq nr ns nt bi translated"><a class="ae ku" href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/waiting" rel="noopener ugc nofollow" target="_blank">服务人员等待兼容性</a></li></ol></div></div>    
</body>
</html>