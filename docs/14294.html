<html>
<head>
<title>Build a Single Page Application With Flutter Web</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Flutter Web构建单页面应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-single-page-application-with-flutter-web-312c03d0e488?source=collection_archive---------1-----------------------#2022-11-25">https://betterprogramming.pub/build-a-single-page-application-with-flutter-web-312c03d0e488?source=collection_archive---------1-----------------------#2022-11-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="00c1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Flutter建立一个带有狗图像的SPA，并使用Firebase主机为生产做好准备</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8ae6c9d2ec1bb7551bdd5b4681d57e96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rl32gvkVKgwL8WQ-uYZHkg.jpeg"/></div></div></figure><p id="7abc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">单页应用程序是一个网站，所有的内容都显示在一个单独的(长的)可滚动页面上。页面可以是静态的，但也可以在您滚动时从服务器动态更新。它已经成为一种非常流行的设计模式。例子包括网飞和特雷罗。</p><p id="8ffe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SPA是展示产品数量有限的小型企业的理想选择。</p><p id="3ffd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以阅读大量的文章来了解更多关于spa的知识，例如，<a class="ae lq" href="https://www.monocubed.com/blog/what-is-single-page-application/" rel="noopener ugc nofollow" target="_blank"> <em class="lr">单页申请:它是什么，它实际上是如何工作的？</em></a><a class="ae lq" href="https://gearheart.io/articles/pros-and-cons-building-single-page-applications-2019/" rel="noopener ugc nofollow" target="_blank"><em class="lr">2022年构建单页面app的利弊</em> </a> <em class="lr">。</em></p><p id="cb7a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本教程中，我们将构建一个非常简单的SPA，按品种显示狗的图像。以上是截图示例。使用以下URL运行SPA:<code class="fe ls lt lu lv b"><a class="ae lq" href="https://dog-spa.web.app" rel="noopener ugc nofollow" target="_blank">https://dog-spa.web.app</a></code>。它具有以下特点:</p><ol class=""><li id="2209" class="lw lx it kw b kx ky la lb ld ly lh lz ll ma lp mb mc md me bi translated">内容是延迟加载的，即启动时只加载前几个品种的图像，其余的在向下滚动时加载。这使得第一个品种出现的时间更短。</li><li id="6824" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp mb mc md me bi translated">每个品种的网址会随着你的滚动而更新，所以如果你对拉布拉多最感兴趣，你可以在观看该品种时将网址加入书签，以后你(和你邮寄网址的朋友)可以通过这个网址直接进入本部分:<code class="fe ls lt lu lv b"><a class="ae lq" href="https://dog-spa.web.app/?breed=labrador" rel="noopener ugc nofollow" target="_blank">https://dog-spa.web.app/?breed=labrador</a></code></li><li id="4b58" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp mb mc md me bi translated">如果你点击菜单按钮，会显示一个菜单，很容易导航到不同的品种。</li></ol><p id="783e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你将学习如何建立这个温泉。教程假设你有关于构建一个Flutter应用的基础知识。</p><h1 id="87a9" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">步骤1:使用ListView.builder</h1><p id="473f" class="pw-post-body-paragraph ku kv it kw b kx nc ju kz la nd jx lc ld ne lf lg lh nf lj lk ll ng ln lo lp im bi translated">使用Android Studio或<code class="fe ls lt lu lv b">flutter create</code>命令创建一个新的flutter项目。用以下代码替换<code class="fe ls lt lu lv b">main.dart</code>:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="8a0f" class="nl ml it lv b be nm nn l no np">import 'package:flutter/material.dart';<br/>import 'dart:ui';<br/>import 'constants.dart';<br/>import 'dogwidget.dart';<br/><br/>void main() {<br/>  runApp(MyApp());<br/>}<br/><br/>class MyApp extends StatelessWidget {<br/>  MyApp({Key? key}) : super(key: key);<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      home: MyHomePage(),<br/>    );<br/>  }<br/>}<br/><br/>class MyHomePage extends StatefulWidget {<br/>  MyHomePage({Key? key}) : super(key: key);<br/>  @override<br/>  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();<br/>}<br/><br/>class _MyHomePageState extends State&lt;MyHomePage&gt; {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    print('********** Main build');<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>          title: Center(<br/>              child: Text('Dog Breeds Single Page Application',<br/>                  style: TextStyle(color: Colors.white, fontSize: 40)))),<br/>      body: ScrollConfiguration(<br/>        behavior: ScrollConfiguration.of(context).copyWith(dragDevices: {<br/>          PointerDeviceKind.touch,<br/>          PointerDeviceKind.mouse,<br/>        }),<br/>        child: ListView.builder(<br/>            cacheExtent: 0,<br/>            itemCount: dogBreeds.length,<br/>            itemBuilder: (BuildContext context, int index) {<br/>              return Container(<br/>                  color: Colors.primaries[index.remainder(Colors.primaries.length)],<br/>                  child: DogWidget(dogBreeds[index]));<br/>            }),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="b02d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ls lt lu lv b">ListView.builder</code>加载一个小部件列表。在我们的例子中，它是同一个小部件<code class="fe ls lt lu lv b">DogWidget</code>，由一个参数控制。但是您也可以在<code class="fe ls lt lu lv b">constants.dart</code>中有一个小部件名称列表，并为每个索引返回一个不同的小部件。</p><p id="4b00" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果没有<code class="fe ls lt lu lv b">ScrollConfiguration</code>小部件，您可以使用鼠标上的滚轮和滚动条来滚动，但不能通过按下鼠标左键来拖动。更多信息<a class="ae lq" href="https://docs.flutter.dev/release/breaking-changes/default-scroll-behavior-drag#copy-and-modify-existing-scrollbehavior" rel="noopener ugc nofollow" target="_blank">点击此处</a>。</p><p id="9a0d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在品种列表中添加<code class="fe ls lt lu lv b">lib/constants.dart</code>:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="8483" class="nl ml it lv b be nm nn l no np">const List&lt;String&gt; dogBreeds = [<br/>  'airedale',<br/>  'beagle',<br/>  'dalmatian',<br/>  'cockapoo',<br/>  'dachshund',<br/>  'havanese',<br/>  'germanshepherd',<br/>  'labradoodle',<br/>  'labrador',<br/>  'pekinese',<br/>];</span></pre><p id="6452" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">添加<code class="fe ls lt lu lv b">lib/dogwidget.dart</code>:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="edd4" class="nl ml it lv b be nm nn l no np">import 'package:flutter/cupertino.dart';<br/>import 'package:flutter/material.dart';<br/>import 'package:http/http.dart' as http;<br/>import 'dart:convert' as convert;<br/>import 'dart:math';<br/>import 'dart:ui';<br/><br/>class DogWidget extends StatelessWidget {<br/>  final String? breed;<br/>  const DogWidget(this.breed, {Key? key}) : super(key: key);<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    print('DogWidget build for breed $breed');<br/>    return Center(<br/>      child: FutureBuilder(<br/>          future: http.get(Uri.https('dog.ceo', '/api/breed/$breed/images')),<br/>          builder: (BuildContext context, AsyncSnapshot&lt;http.Response&gt; snapshot) {<br/>            if (snapshot.connectionState == ConnectionState.waiting) {<br/>              return Container(<br/>                  height: 500,<br/>                  child: const CupertinoActivityIndicator(<br/>                    radius: 100,<br/>                    color: Colors.white,<br/>                  ));<br/>            } else if (snapshot.connectionState == ConnectionState.done) {<br/>              if (snapshot.hasError) {<br/>                return const Text('Error');<br/>              } else if (snapshot.hasData) {<br/>                var jsonResponse = convert.jsonDecode(snapshot.data!.body);<br/>                List imgList = jsonResponse["message"];<br/>                print('$breed number of images ${imgList.length}');<br/>                return Column(children: [<br/>                  Text('Breed: $breed', style: const TextStyle(color: Colors.white, fontSize: 25)),<br/>                  if (imgList.length &gt; 0) dogRow(imgList, context, first: 0),<br/>                  if (imgList.length &gt; 4) dogRow(imgList, context, first: 4),<br/>                  if (imgList.length &gt; 8) dogRow(imgList, context, first: 8),<br/>                ]);<br/>              } else {<br/>                return const Text('Empty data');<br/>              }<br/>            } else {<br/>              return Text('State: ${snapshot.connectionState}');<br/>            }<br/>          }),<br/>    );<br/>  }<br/><br/>  Widget dogRow(List imgList, BuildContext context, {int first = 0}) {<br/>    return ScrollConfiguration(<br/>      behavior: ScrollConfiguration.of(context).copyWith(dragDevices: {<br/>        PointerDeviceKind.touch,<br/>        PointerDeviceKind.mouse,<br/>      }),<br/>      child: SingleChildScrollView(<br/>        scrollDirection:Axis.horizontal,<br/>        physics: BouncingScrollPhysics(),<br/>        child: Row(<br/>        mainAxisAlignment: MainAxisAlignment.center,<br/>        children: [<br/>          for (int i = first; i &lt; min(first + 4, imgList.length); i++)<br/>            Padding(<br/>              padding: const EdgeInsets.all(10),<br/>              child: ClipRRect(<br/>                borderRadius: BorderRadius.circular(15.0),<br/>                child: Image.network(<br/>                  imgList[i].toString(),<br/>                  height: 200,<br/>                ),<br/>              ),<br/>            )<br/>        ],<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="dc1e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个小部件使用<a class="ae lq" href="https://dog.ceo/dog-api/" rel="noopener ugc nofollow" target="_blank"> Dog CEO Dog API </a>为一个品种检索多达12张图片。它以一到三行的形式返回它们。例如:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/85882dc7b7919d0b5055edfac659dd0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w-6-qclYuY8RU6JmTKFVMQ.jpeg"/></div></div></figure><p id="6a0a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果视口不够宽，无法显示一行中的所有狗，我们希望这一行可以水平滚动(通过拖动)，因此有了<code class="fe ls lt lu lv b">SingleChildScrollView</code>和<code class="fe ls lt lu lv b">ScrollConfiguration</code>小部件。</p><p id="8a5d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ls lt lu lv b">dogWidget</code>使用pub.dev上的<a class="ae lq" href="https://pub.dev/packages/http" rel="noopener ugc nofollow" target="_blank"> HTTP </a>包，用这个更新<code class="fe ls lt lu lv b">pubspec.yaml</code>并执行<code class="fe ls lt lu lv b">Pub get</code>。然后打开命令行窗口，转到项目目录，输入这个命令:<code class="fe ls lt lu lv b">flutter run -d chrome</code>。(或者，如果你更喜欢微软Edge而不是谷歌Chrome，<code class="fe ls lt lu lv b">flutter run -d edge</code>。)在命令行窗口中，您将看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/44eadb0c9da910028ee06cb6b8c37a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YKU7HrRd7QwoBzYIe53IRA.jpeg"/></div></div></figure><p id="abaf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">只装两个第一品种，带<code class="fe ls lt lu lv b">ListView cacheExtent: 0</code>。使用默认缓存，将预装四或五个品种。</p><p id="759b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另请注意，在<code class="fe ls lt lu lv b">DogWidget</code>中，库比蒂诺活动指示器周围的<code class="fe ls lt lu lv b">Container height:500</code>。如果没有它，小部件的初始大小将会很小——当图像被加载后，它将增长到最大大小。并且当<code class="fe ls lt lu lv b">ListView</code>确定有多少窗口小部件适合视口时；初始大小很重要。</p><p id="fb89" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Chrome窗口中向下滚动，观察命令行窗口中出现的其他Dogwidget构建行。</p><h2 id="84d7" class="ns ml it bd mm nt nu dn mq nv nw dp mu ld nx ny mw lh nz oa my ll ob oc na od bi translated">测试SPA</h2><p id="1a83" class="pw-post-body-paragraph ku kv it kw b kx nc ju kz la nd jx lc ld ne lf lg lh nf lj lk ll ng ln lo lp im bi translated">人们可以写一篇关于这个主题的长篇教程。在这里，我将给出一些提示和建议:</p><ol class=""><li id="7d13" class="lw lx it kw b kx ky la lb ld ly lh lz ll ma lp mb mc md me bi translated">大多数测试将通过<code class="fe ls lt lu lv b">flutter run -d chrome</code>完成。您可以添加打印语句来显示您的位置和变量值。可以在命令行窗口和Flutter消息中看到输出。</li><li id="486c" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp mb mc md me bi translated"><a class="ae lq" href="https://docs.flutter.dev/development/tools/devtools/overview" rel="noopener ugc nofollow" target="_blank"> Flutter DevTools </a>是一套用于Dart和Flutter的性能和调试工具。可以通过命令行窗口中显示的URL访问Flutter检查器和调试器(参见上面的示例)。使用调试器，您可以设置断点、检查变量等等。检查器非常适合调试GUI。</li><li id="ed7c" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp mb mc md me bi translated">Chrome DevTools 是一套直接内置在谷歌Chrome浏览器中的网络开发工具。你可以通过在视窗中输入<code class="fe ls lt lu lv b">Ctrl-Shift-I</code>来找到它。控制台视图将显示打印输出和抖动消息。网络视图将显示图像加载的时间。点击节流并选择快速3G测试延迟加载。</li><li id="9680" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp mb mc md me bi translated">有两个屏幕非常有用。然后，您可以在一个屏幕上显示SPA，在另一个屏幕上显示命令行窗口、Flutter DevTools和Chrome DevTools。在Chrome DevTools中，单击菜单图标(三个垂直点)，然后移至单独的窗口。</li><li id="6dd7" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp mb mc md me bi translated">有几种方式来运行SPA:</li></ol><ul class=""><li id="c57b" class="lw lx it kw b kx ky la lb ld ly lh lz ll ma lp oe mc md me bi translated"><code class="fe ls lt lu lv b">flutter run -d chrome</code></li><li id="3787" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated"><code class="fe ls lt lu lv b">flutter run -d web-server --debug</code></li><li id="fbff" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated"><code class="fe ls lt lu lv b">flutter run -d web-server --release</code></li><li id="ceda" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated"><code class="fe ls lt lu lv b">flutter build web</code>，然后在(项目目录)/build/web中提供代码</li><li id="a617" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated"><code class="fe ls lt lu lv b">flutter run</code>，在连接的(或仿真的)手机上作为Android应用程序运行。使用<code class="fe ls lt lu lv b">if (kIsWeb)</code>来避免SPA中Android不支持的代码(参见最后的<code class="fe ls lt lu lv b">main.dart</code>中的两个例子)。</li><li id="b706" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated">还有一个名为<code class="fe ls lt lu lv b">--web-renderer</code>的选项，您可以选择<code class="fe ls lt lu lv b">auto</code>、<code class="fe ls lt lu lv b">html</code>或<code class="fe ls lt lu lv b">canvaskit</code>。这里，我们使用默认值，即<code class="fe ls lt lu lv b">auto</code>。你可以在这里阅读<a class="ae lq" href="https://docs.flutter.dev/development/platform-integration/web/renderers" rel="noopener ugc nofollow" target="_blank"/>。</li></ul><h1 id="82be" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">第二步:使用<strong class="ak"> scrollable_positioned_list并添加一个菜单</strong></h1><p id="92d3" class="pw-post-body-paragraph ku kv it kw b kx nc ju kz la nd jx lc ld ne lf lg lh nf lj lk ll ng ln lo lp im bi translated"><code class="fe ls lt lu lv b">ListView.builder</code>有一个限制:使用它的滚动控制器，你可以跳到一个偏移量，但是不能跳到一个特定小部件的索引。这在菜单中是需要的。</p><p id="3a37" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果<code class="fe ls lt lu lv b">ListView</code>中的所有部件都具有相同的高度，这不是问题。你可以很容易地计算出偏移量。或者可以用<code class="fe ls lt lu lv b">PageView.builder</code>代替<code class="fe ls lt lu lv b">ListView.builder</code>。</p><p id="ab64" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是如果高度不可预测地变化(就像我们的情况)，你能做什么？以下是一些想法:</p><ol class=""><li id="0c49" class="lw lx it kw b kx ky la lb ld ly lh lz ll ma lp mb mc md me bi translated">给<code class="fe ls lt lu lv b">ListView</code>中的每个小部件分配一个全局键。然后用<code class="fe ls lt lu lv b">scrollController.position.ensureVisible</code> ( <code class="fe ls lt lu lv b">globalKeys[index].currentContext.findRenderObject()</code>，..)进行滚动，直到具有该索引的小部件在视口中可见。这在<code class="fe ls lt lu lv b">ListView,</code>中运行良好，但是在<code class="fe ls lt lu lv b">ListView.builder</code>中，它并不总是运行良好，因为对于不在视口或缓存中的窗口小部件，键是空的。然后，您可以在一个循环中执行<code class="fe ls lt lu lv b">scrollcontroller.jumpTo</code>一小段距离，直到键为非空，然后执行<code class="fe ls lt lu lv b">ensureVisible</code>。这是可行的，但不是最好的解决方案。</li><li id="f066" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp mb mc md me bi translated">使用pub.dev上的<code class="fe ls lt lu lv b"><a class="ae lq" href="https://pub.dev/packages/indexed_list_view" rel="noopener ugc nofollow" target="_blank">indexed_list_view</a> </code>包，它有一些限制。</li><li id="768f" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp mb mc md me bi translated">使用pub.dev上的<code class="fe ls lt lu lv b"><a class="ae lq" href="https://pub.dev/packages/scrollable_positioned_list" rel="noopener ugc nofollow" target="_blank">scrollable_positioned_list</a> </code>包。这是我们将要使用的。用这个更新<code class="fe ls lt lu lv b">pubspec.yaml</code>，做一个扑扑的酒馆get。</li></ol><p id="1457" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在可以创建一个菜单来滚动到某个品种。</p><p id="f5c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">添加<code class="fe ls lt lu lv b">lib/navigationmenu.dart</code>:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="a414" class="nl ml it lv b be nm nn l no np">import 'package:flutter/material.dart';<br/>import 'package:scrollable_positioned_list/scrollable_positioned_list.dart';<br/>import 'constants.dart';<br/><br/>class NavigationMenu extends StatelessWidget {<br/>  final ItemScrollController itemScrollController;<br/>  int? focusedDogIndex;<br/>  NavigationMenu(this.itemScrollController, {this.focusedDogIndex});<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Container(<br/>      color: Colors.white,<br/>      padding: const EdgeInsets.all(3.0),<br/>      child: Column(<br/>        children: [<br/>          for (int i = 0; i &lt; dogBreeds.length; i++) menuRow(i, focusedDogIndex),<br/>        ],<br/>      ),<br/>    );<br/>  }<br/><br/>  Widget menuRow(int index, int? focusedDogIndex) {<br/>    return GestureDetector(<br/>      onTap: () {<br/>        itemScrollController.scrollTo(<br/>            index: index, duration: Duration(seconds: 1), curve: Curves.easeInOut);<br/>      },<br/>      child: Container(<br/>        width: 150,<br/>        height: 50,<br/>        color: Colors.primaries[index.remainder(Colors.primaries.length)],<br/>        child: Center(<br/>            child: Text(<br/>              dogBreeds[index],<br/>              style: TextStyle(color: index == focusedDogIndex ? Colors.white : Colors.black, fontSize: 15),<br/>            )),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="330b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个小部件将显示一个如下所示的菜单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/76a5a09519cf60ee644d0ce524440de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*pmuUvoy_YaYd-_DAlphkQQ.png"/></div></figure><p id="5b3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当点击一行时，滚动控制器的<code class="fe ls lt lu lv b">scrollTo</code>方法被调用，相应的索引作为参数。(可选参数<code class="fe ls lt lu lv b">focusedDogIndex</code>在步骤3中解释。)</p><p id="14d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将<code class="fe ls lt lu lv b">main.dart</code>替换为:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="a939" class="nl ml it lv b be nm nn l no np">import 'package:flutter/material.dart';<br/>import 'package:scrollable_positioned_list/scrollable_positioned_list.dart';<br/>import 'constants.dart';<br/>import 'dogwidget.dart';<br/>import 'navigationmenu.dart';<br/><br/>void main() {<br/>  runApp(MyApp());<br/>}<br/><br/>class MyApp extends StatelessWidget {<br/>  MyApp({Key? key}) : super(key: key);<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      home: MyHomePage(),<br/>    );<br/>  }<br/>}<br/><br/>class MyHomePage extends StatefulWidget {<br/>  MyHomePage({Key? key}) : super(key: key);<br/>  @override<br/>  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();<br/>}<br/><br/>class _MyHomePageState extends State&lt;MyHomePage&gt; {<br/>  final ItemScrollController itemScrollController = ItemScrollController();<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    print('********** Main build');<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>          title: Center(<br/>              child: Text('Dog Breeds Single Page Application',<br/>                  style: TextStyle(color: Colors.white, fontSize: 40)))),<br/>      body: Stack(children: [<br/>        ScrollablePositionedList.builder(<br/>          // cacheExtent: 0,<br/>            itemCount: dogBreeds.length,<br/>            itemScrollController: itemScrollController,<br/>            itemBuilder: (BuildContext context, int index) {<br/>              return Container(<br/>                  color: Colors.primaries[index.remainder(Colors.primaries.length)],<br/>                  child: DogWidget(dogBreeds[index]));<br/>            }),<br/>        NavigationMenu(itemScrollController)<br/>      ]),<br/>    );<br/>  }<br/>}</span></pre><p id="3a01" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">滚动控制器被声明，然后在生成器和菜单中使用。小部件列表被一个<code class="fe ls lt lu lv b">Stack</code>小部件包裹，菜单被添加。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/6440cf33cd75cf4372e4bd62cd71fec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NtElY-0AKvMLX5L2mgSNLw.png"/></div></div></figure><p id="e551" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">命令窗口现在显示如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/8253a3734b00c76fed26442e2c9d3c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q_FJAhQFvWW6cPXpoHjsag.png"/></div></div></figure><p id="2354" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">几个品种现在开始预装，而不是两个。这是因为<code class="fe ls lt lu lv b">scrollable_positioned_list</code>不支持<code class="fe ls lt lu lv b">cacheExtent</code>参数。</p><p id="85e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了使网站更加用户友好，我在<code class="fe ls lt lu lv b">appBar</code>中添加了一个菜单按钮来关闭和打开菜单。并用一个<code class="fe ls lt lu lv b">Draggable </code>小部件包装了菜单。<code class="fe ls lt lu lv b">main.dart</code>现在看起来是这样的:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="ecb9" class="nl ml it lv b be nm nn l no np">import 'package:flutter/material.dart';<br/>import 'package:scrollable_positioned_list/scrollable_positioned_list.dart';<br/>import 'constants.dart';<br/>import 'dogwidget.dart';<br/>import 'navigationmenu.dart';<br/><br/>void main() {<br/>  runApp(MyApp());<br/>}<br/><br/>class MyApp extends StatelessWidget {<br/>  MyApp({Key? key}) : super(key: key);<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      debugShowCheckedModeBanner: false,<br/>      home: MyHomePage(),<br/>    );<br/>  }<br/>}<br/><br/>class MyHomePage extends StatefulWidget {<br/>  MyHomePage({Key? key}) : super(key: key);<br/>  @override<br/>  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();<br/>}<br/><br/>class _MyHomePageState extends State&lt;MyHomePage&gt; {<br/>  final ItemScrollController itemScrollController = ItemScrollController();<br/>  bool menuVisible = false;<br/>  Offset menuPosition = Offset(20, 20);<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    print('********** Main build');<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: Center(<br/>            child: Text('Dog Breeds Single Page Application',<br/>                style: TextStyle(color: Colors.white, fontSize: 40))),<br/>        actions: [<br/>          IconButton(<br/>            icon: Icon(Icons.menu),<br/>            onPressed: () {<br/>              menuVisible = !menuVisible;<br/>              setState(() {});<br/>            },<br/>          )<br/>        ],<br/>      ),<br/>      body: Stack(children: [<br/>        ScrollablePositionedList.builder(<br/>          // cacheExtent: 0,<br/>            itemCount: dogBreeds.length,<br/>            itemScrollController: itemScrollController,<br/>            itemBuilder: (BuildContext context, int index) {<br/>              return Container(<br/>                  color: Colors.primaries[index.remainder(Colors.primaries.length)],<br/>                  child: DogWidget(dogBreeds[index]));<br/>            }),<br/>        menuVisible<br/>            ? Positioned(<br/>          left: menuPosition.dx,<br/>          top: menuPosition.dy,<br/>          child: Draggable(<br/>            feedback: NavigationMenu(itemScrollController),<br/>            childWhenDragging: Opacity(opacity: .3, child: NavigationMenu(itemScrollController)),<br/>            onDragEnd: (details) {<br/>              menuPosition = details.offset;<br/>              setState(() {});<br/>            },<br/>            child: NavigationMenu(<br/>              itemScrollController,<br/>            ),<br/>          ),<br/>        )<br/>            : Container()<br/>      ]),<br/>    );<br/>  }<br/>}</span></pre><p id="e2cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，如果你愿意，菜单可以被关闭和打开，并被拖动到一个新的位置。<code class="fe ls lt lu lv b">debugShowCheckedModeBanner: false</code>行删除了调试横幅，否则它会隐藏菜单按钮。</p><p id="a627" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">进行热重启并测试新版本。</p><h1 id="a518" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">步骤3:处理URL</h1><p id="af90" class="pw-post-body-paragraph ku kv it kw b kx nc ju kz la nd jx lc ld ne lf lg lh nf lj lk ll ng ln lo lp im bi translated">如果SPA有很多小部件，用户可能希望能够标记一个直接指向所需小部件的URL，而不必滚动到它。当然，这对于一个菜单来说可能不是很重要，但是拥有它很好，也很容易修复。</p><p id="2b29" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将支持类似<code class="fe ls lt lu lv b">hostname/?breed=labrador</code>的URL。更新URL只需一行代码:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="85d3" class="nl ml it lv b be nm nn l no np">html.window.history.pushState(null, '', '?breed=${dogBreeds[focusedDogIndex]}');</span></pre><p id="d7ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">问题是要知道用户在SPA中向下滚动了多远。<code class="fe ls lt lu lv b">scrollable_positioned_list</code>中的<code class="fe ls lt lu lv b">itemPositionsListener</code>特性会处理好这一点。<code class="fe ls lt lu lv b">ScrollablePositionedList.builder</code>向任何想听的人发送一串位置。在滚动的过程中，听众会每隔一段时间得到一组<code class="fe ls lt lu lv b">ItemPosition</code>。在视窗中全部或部分可见的每个小部件都有一个<code class="fe ls lt lu lv b">ItemPosition</code>，它包含以下内容:</p><ul class=""><li id="9752" class="lw lx it kw b kx ky la lb ld ly lh lz ll ma lp oe mc md me bi translated">小部件的索引(例如，<code class="fe ls lt lu lv b">2</code>代表斑点狗)</li><li id="858a" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated"><code class="fe ls lt lu lv b">itemLeadingEdge</code> =从视窗前缘到小工具前缘的距离，与视窗主轴长度成比例。如果项目是部分可见的，它可能是负的。例如，<code class="fe ls lt lu lv b">0.5</code>表示小部件的顶部在视口的中间位置。</li><li id="4d2f" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated"><code class="fe ls lt lu lv b">itemTrailingEdge</code> =与视窗主轴长度成比例的距离，从微件的前沿到后沿。如果项目是部分可见的，则它可能大于1。</li></ul><p id="0efb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要接收这个流，用一个<code class="fe ls lt lu lv b">ValueListenableBuilder</code>小部件包装菜单:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="f6b4" class="nl ml it lv b be nm nn l no np">final ItemScrollController itemScrollController = ItemScrollController();<br/>final ItemPositionsListener itemPositionsListener = ItemPositionsListener.create();<br/>  :<br/>body: Stack(children: [<br/>        ScrollablePositionedList.builder(<br/>          // cacheExtent: 0,<br/>            itemCount: dogBreeds.length,<br/>            itemScrollController: itemScrollController,<br/>            itemPositionsListener: itemPositionsListener,<br/>            itemBuilder: (BuildContext context, int index) {<br/>              return Container(<br/>                  color: Colors.primaries[index.remainder(Colors.primaries.length)],<br/>                  child: DogWidget(dogBreeds[index]));<br/>            }),<br/>        ValueListenableBuilder&lt;Iterable&lt;ItemPosition&gt;&gt;(<br/>            valueListenable: itemPositionsListener.itemPositions,<br/>            builder: (context, positions, child) {<br/>              if (positions.isEmpty) {<br/>                return Container();<br/>              }<br/>              int focusedDogIndex = findFocusedDog(positions);<br/>              html.window.history.pushState(null, '', '?breed=${dogBreeds[focusedDogIndex]}');<br/>              return menuVisible<br/>                  ? Positioned(<br/>                left: menuPosition.dx,<br/>                top: menuPosition.dy,<br/>                child: Draggable(<br/>                  feedback: NavigationMenu(itemScrollController),<br/>                  childWhenDragging: Opacity(opacity: .3, child: NavigationMenu(itemScrollController)),<br/>                  onDragEnd: (details) {<br/>                    menuPosition = details.offset;<br/>                    setState(() {});<br/>                  },<br/>                  child: NavigationMenu(itemScrollController, focusedDogIndex: focusedDogIndex),<br/>                ),<br/>              )<br/>                  : Container();<br/>            })<br/>      ]),</span></pre><p id="a143" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ls lt lu lv b">findFocusedDog</code>功能旨在当视窗中有多个品种时，找出用户最可能关注的品种。例如，在这些情况下，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/494d0ec68015e669f726e3061de3faa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5wbo0JnJemNOqOYRbp7wYg.png"/></div></div></figure><p id="a9f0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该函数应该为左侧图像返回<code class="fe ls lt lu lv b">7 = labradoodle</code>，为右侧图像返回<code class="fe ls lt lu lv b">8 = labrador</code>。</p><p id="6505" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">返回值用于执行以下操作:</p><ul class=""><li id="4b9b" class="lw lx it kw b kx ky la lb ld ly lh lz ll ma lp oe mc md me bi translated">更新网址— <code class="fe ls lt lu lv b">html.window.history.pushState(null, ‘’, ‘?breed=${dogBreeds[focusedDogIndex]}</code></li><li id="b579" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated">在<code class="fe ls lt lu lv b">NavigationMenu</code>调用中，这将使菜单中相应的行高亮显示。</li></ul><p id="4860" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用以下代码添加<code class="fe ls lt lu lv b">lib/findfocuseddog.dart</code>:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="9501" class="nl ml it lv b be nm nn l no np">import 'package:scrollable_positioned_list/scrollable_positioned_list.dart';<br/><br/>int findFocusedDog(Iterable&lt;ItemPosition&gt; positions) {<br/>  ItemPosition topPos = positions.where((ItemPosition position) =&gt; position.itemTrailingEdge &gt; 0).reduce(<br/>          (ItemPosition min, ItemPosition position) =&gt;<br/>      position.itemTrailingEdge &lt; min.itemTrailingEdge ? position : min);<br/>  ItemPosition botPos = positions.where((ItemPosition position) =&gt; position.itemLeadingEdge &lt; 1).reduce(<br/>          (ItemPosition max, ItemPosition position) =&gt;<br/>      position.itemLeadingEdge &gt; max.itemLeadingEdge ? position : max);<br/>  if (topPos.itemLeadingEdge == 0) {<br/>    // If a widget is aligned with the top of the viewport, use it<br/>    return topPos.index;<br/>  } else if (positions.length == 1) {<br/>    // If a widget covers the whole viewport, use it<br/>    return topPos.index;<br/>  } else if (positions.length == 2) {<br/>    // If there are two widgets in the viewport,<br/>    // select the one which uses most of the viewport<br/>    if (topPos.itemTrailingEdge &lt; 1 - botPos.itemLeadingEdge)<br/>      return topPos.index + 1;<br/>    else<br/>      return topPos.index;<br/>  } else if (positions.length == 3) {<br/>    // If there are three widgets in the viewport, select the one in the middle<br/>    Iterable otherPositions = positions.where((ItemPosition position) =&gt; position != topPos &amp;&amp; position != botPos);<br/>    return otherPositions.first.index;<br/>  } else<br/>    return topPos.index;<br/>}</span></pre><p id="995f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">iterable中的<code class="fe ls lt lu lv b">ItemPositions</code>可以是任意顺序的——位置<code class="fe ls lt lu lv b">positions.first</code>不一定代表最顶端的小部件。这使得代码有点复杂。(我怀疑可能有更简单的解决方案。有想法就回应。)</p><p id="3918" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，URL会随着您的滚动而动态更新。如果你去一个网址。品种=xyz，您希望SPA直接跳转到查询品种。为此，将品种作为参数添加到<code class="fe ls lt lu lv b">MyHomePage</code>:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="8d73" class="nl ml it lv b be nm nn l no np">class MyApp extends StatelessWidget {<br/>  MyApp({Key? key}) : super(key: key);<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    String queryBreed;<br/>    String query = Uri.base.query;<br/>    if (query.length &gt; 6) {<br/>      queryBreed = query.substring(6);<br/>      if (dogBreeds.indexOf(queryBreed) == -1) queryBreed = dogBreeds[0];<br/>    } else {<br/>      queryBreed = dogBreeds[0];<br/>    }<br/>    print('building for breed $queryBreed');<br/>    return MaterialApp(<br/>      debugShowCheckedModeBanner: false,<br/>      home: MyHomePage(queryBreed: queryBreed),<br/>    );<br/>  }<br/>}<br/><br/>class MyHomePage extends StatefulWidget {<br/>  String queryBreed;<br/>  MyHomePage({Key? key, required this.queryBreed}) : super(key: key);<br/>  @override<br/>  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();<br/>}</span></pre><p id="4e3c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后添加以下<code class="fe ls lt lu lv b">initState</code>覆盖:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="a8b1" class="nl ml it lv b be nm nn l no np">@override<br/>  void initState() {<br/>    SchedulerBinding.instance.addPostFrameCallback((_) {<br/>      itemScrollController.jumpTo(index: dogBreeds.indexOf(widget.queryBreed));<br/>    });<br/>    super.initState();<br/>  }</span></pre><p id="fbd5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ls lt lu lv b">addPostFrameCallback</code>确保跳转被推迟到第一次构建完成之后。</p><p id="6698" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完整的最终<code class="fe ls lt lu lv b">main.dart</code>看起来是这样的:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="588d" class="nl ml it lv b be nm nn l no np">import 'package:flutter/foundation.dart';<br/>import 'package:flutter/material.dart';<br/>import 'package:flutter/scheduler.dart';<br/>import 'dart:html' as html if (kIsWeb) "";<br/>import 'dart:ui';<br/>import 'package:scrollable_positioned_list/scrollable_positioned_list.dart';<br/>import 'constants.dart';<br/>import 'dogwidget.dart';<br/>import 'navigationmenu.dart';<br/>import 'findfocuseddog.dart';<br/><br/>void main() {<br/>  runApp(MyApp());<br/>}<br/><br/>class MyApp extends StatelessWidget {<br/>  MyApp({Key? key}) : super(key: key);<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    String queryBreed;<br/>    String query = Uri.base.query;<br/>    if (query.length &gt; 6) {<br/>      queryBreed = query.substring(6);<br/>      if (dogBreeds.indexOf(queryBreed) == -1) queryBreed = dogBreeds[0];<br/>    } else {<br/>      queryBreed = dogBreeds[0];<br/>    }<br/>    print('building for breed $queryBreed');<br/>    return MaterialApp(<br/>      debugShowCheckedModeBanner: false,<br/>      home: MyHomePage(queryBreed: queryBreed),<br/>    );<br/>  }<br/>}<br/><br/>class MyHomePage extends StatefulWidget {<br/>  String queryBreed;<br/>  MyHomePage({Key? key, required this.queryBreed}) : super(key: key);<br/>  @override<br/>  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();<br/>}<br/><br/>class _MyHomePageState extends State&lt;MyHomePage&gt; {<br/>  final ItemScrollController itemScrollController = ItemScrollController();<br/>  final ItemPositionsListener itemPositionsListener = ItemPositionsListener.create();<br/>  bool menuVisible = false;<br/>  Offset menuPosition = Offset(20, 20);<br/><br/>  @override<br/>  void initState() {<br/>    SchedulerBinding.instance.addPostFrameCallback((_) {<br/>      itemScrollController.jumpTo(index: dogBreeds.indexOf(widget.queryBreed));<br/>    });<br/>    super.initState();<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    print('********** Main build');<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: Center(<br/>            child: Text('Dog Breeds Single Page Application',<br/>                style: TextStyle(color: Colors.white, fontSize: 40))),<br/>        actions: [<br/>          IconButton(<br/>            icon: Icon(Icons.menu),<br/>            onPressed: () {<br/>              menuVisible = !menuVisible;<br/>              setState(() {});<br/>            },<br/>          )<br/>        ],<br/>      ),<br/>      body: Stack(children: [<br/>        ScrollConfiguration(<br/>          behavior: ScrollConfiguration.of(context).copyWith(dragDevices: {<br/>            PointerDeviceKind.touch,<br/>            PointerDeviceKind.mouse,<br/>          }),<br/>          child: ScrollablePositionedList.builder(<br/>            // cacheExtent: 0,<br/>              itemCount: dogBreeds.length,<br/>              itemScrollController: itemScrollController,<br/>              itemPositionsListener: itemPositionsListener,<br/>              itemBuilder: (BuildContext context, int index) {<br/>                return Container(<br/>                    color: Colors.primaries[index.remainder(Colors.primaries.length)],<br/>                    child: DogWidget(dogBreeds[index]));<br/>              }),<br/>        ),<br/>        ValueListenableBuilder&lt;Iterable&lt;ItemPosition&gt;&gt;(<br/>            valueListenable: itemPositionsListener.itemPositions,<br/>            builder: (context, positions, child) {<br/>              if (positions.isEmpty) {<br/>                return Container();<br/>              }<br/>              int focusedDogIndex = findFocusedDog(positions);<br/>              if (kIsWeb) html.window.history.pushState(null, '', '?breed=${dogBreeds[focusedDogIndex]}');<br/>              return menuVisible<br/>                  ? Positioned(<br/>                left: menuPosition.dx,<br/>                top: menuPosition.dy,<br/>                child: Draggable(<br/>                  feedback: NavigationMenu(itemScrollController),<br/>                  childWhenDragging: Opacity(opacity: .3, child: NavigationMenu(itemScrollController)),<br/>                  onDragEnd: (details) {<br/>                    menuPosition = details.offset;<br/>                    setState(() {});<br/>                  },<br/>                  child: NavigationMenu(itemScrollController, focusedDogIndex: focusedDogIndex),<br/>                ),<br/>              )<br/>                  : Container();<br/>            })<br/>      ]),<br/>    );<br/>  }<br/>}</span></pre><h1 id="96e3" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">第五步:为生产做准备</h1><p id="4afc" class="pw-post-body-paragraph ku kv it kw b kx nc ju kz la nd jx lc ld ne lf lg lh nf lj lk ll ng ln lo lp im bi translated">法图标。favicon是一个16x16像素的小图标，显示在Chrome的标签和书签中。我用颜料做了这个:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/7c5b2217c8bf553a47410476f0749087.png" data-original-src="https://miro.medium.com/v2/resize:fit:32/format:webp/1*cMW9MFzPyLLHjRTmxb3auA.png"/></div></figure><p id="e71d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用你自己的图标替换<code class="fe ls lt lu lv b">web\favicon.png</code>。</p><p id="dac8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">清单和Chrome图标</strong>。更新文件<code class="fe ls lt lu lv b">web\manifest.json</code>。更改字段<code class="fe ls lt lu lv b">name</code>、<code class="fe ls lt lu lv b">short_name</code>和<code class="fe ls lt lu lv b">description</code>。另外，用你自己的图标替换<code class="fe ls lt lu lv b">web\icons\icon-192.png</code>。我使用了与splash图像相同的图像，如下所示，并将其大小调整为192x192。如果您选择通过单击Chrome地址栏中三个图标中最左边的一个来将SPA安装为Chrome应用程序，将会使用该名称和图标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/4d512c34e4e186843db9e387a674f090.png" data-original-src="https://miro.medium.com/v2/resize:fit:256/format:webp/1*uJHHEJ6k5bnBpSCllujuUw.jpeg"/></div></figure><p id="1bf3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">闪屏</strong>。这是在启动SPA、等待Flutter加载以及显示第一个应用程序屏幕时显示的。它看起来是这样的(但背景是蓝色的):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/f9a1930a8b96bc3d5e4de91f60278ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*HI33R336rdX7We2cjPng5w.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/65dbc3d13f0f303088aab805a67f003e.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/1*NpvdmheA9-ylsXaZ3RMJ_g.gif"/></div></figure><p id="0e84" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将图像和gif保存在<code class="fe ls lt lu lv b">\web\icons</code>中。将以下两行添加到<code class="fe ls lt lu lv b">web\index.html</code>，就在主体之后:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="d45d" class="nl ml it lv b be nm nn l no np">&lt;img src="icons/splash.png" class="center" /&gt;<br/>&lt;img src="icons/wait1.gif" width="100" height="100"  class="below" /&gt;</span></pre><p id="2825" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后添加以下文件作为<code class="fe ls lt lu lv b">web\styles.css</code>:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="34ca" class="nl ml it lv b be nm nn l no np">html,<br/>body {<br/>    background-color: #368ed6<br/>}<br/>.center {<br/>    margin: 0;<br/>    position: absolute;<br/>    top: 30%;<br/>    left: 50%;<br/>    margin-right: -50%;<br/>    transform: translate(-50%, -50%)<br/>}<br/>.below {<br/>    margin: 0;<br/>    position: absolute;<br/>    top: 70%;<br/>    left: 50%;<br/>    margin-right: -50%;<br/>    transform: translate(-50%, -50%)<br/>}</span></pre><p id="d407" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，将这一行添加到<code class="fe ls lt lu lv b">web\index.html</code>，就在清单链接的后面:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="4fb1" class="nl ml it lv b be nm nn l no np">  &lt;link rel="stylesheet" type="text/css" href="styles.css"&gt;</span></pre><p id="455c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">建造并主持水疗中心。您现在已经准备好进行最后的构建了。输入这个命令:<code class="fe ls lt lu lv b">flutter build web</code>。将创建一个<code class="fe ls lt lu lv b">build</code>目录，其中包含部署到服务器所需的所有文件。<code class="fe ls lt lu lv b">web</code>目录中的图标和其他文件将被复制到<code class="fe ls lt lu lv b">build\web</code>。</p><p id="4b6f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于主机，我推荐Firebase主机。它很容易使用。遵循这里的说明<a class="ae lq" href="https://firebase.google.com/docs/hosting/quickstart" rel="noopener ugc nofollow" target="_blank"/>。在创建Firebase项目时，确保将默认的项目id更改为更加用户友好的名称，因为它将是SPA的URL的一部分:<code class="fe ls lt lu lv b">(project_id).web.app</code>。在<code class="fe ls lt lu lv b">firebase init hosting</code>期间，</p><ul class=""><li id="29cd" class="lw lx it kw b kx ky la lb ld ly lh lz ll ma lp oe mc md me bi translated">输入build/web作为您的公共目录</li><li id="d2fe" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated">回答是配置为单页app？</li><li id="6072" class="lw lx it kw b kx mf la mg ld mh lh mi ll mj lp oe mc md me bi translated">对文件build/web/index.html的回答是否定的，因为它已经存在。覆盖？</li></ul><p id="8d31" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您现在可以将您的SPA部署到服务器:firebase deploy。</p><p id="9fc0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">添加Firebase Analytics </strong>。这是可选的，但如果您想了解SPA的使用方式和位置，建议您这样做。而且实现起来也不难。按照这里的指示<a class="ae lq" href="https://firebase.google.com/docs/analytics/get-started?platform=web" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="55cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要找到要添加到<code class="fe ls lt lu lv b">index.html</code>的代码，请转到Firebase控制台，选择您的项目，单击项目概述设置齿轮，向下滚动到您的应用程序，选择CDN配置并复制代码:</p><pre class="kj kk kl km gt nh lv ni bn nj nk bi"><span id="2ea8" class="nl ml it lv b be nm nn l no np">&lt;script type="module"&gt;<br/>  // Import the functions you need from the SDKs you need<br/>  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";<br/>  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-analytics.js";<br/>  // TODO: Add SDKs for Firebase products that you want to use<br/>  // https://firebase.google.com/docs/web/setup#available-libraries<br/><br/>  // Your web app's Firebase configuration<br/>  // For Firebase JS SDK v7.20.0 and later, measurementId is optional<br/>  const firebaseConfig = {<br/>    apiKey: "AIzaSyBfFajK2I2UR2xtXQXBqPj31lLLmfsIWEY",<br/>    authDomain: "dog-spa.firebaseapp.com",<br/>    projectId: "dog-spa",<br/>    storageBucket: "dog-spa.appspot.com",<br/>    messagingSenderId: "913865773590",<br/>    appId: "1:913865773590:web:6b89da844ba439aa409b37",<br/>    measurementId: "G-76XBK247DD"<br/>  };<br/><br/>  // Initialize Firebase<br/>  const app = initializeApp(firebaseConfig);<br/>  const analytics = getAnalytics(app);<br/>&lt;/script&gt;</span></pre><p id="5903" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将这段代码添加到web/index.html中，就在闪屏的img语句之后。然后进行新的firebase构建和firebase部署。</p><p id="4050" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(由于我们使用Firebase托管，我们可以通过从<a class="ae lq" href="https://firebase.google.com/docs/hosting/reserved-urls" rel="noopener ugc nofollow" target="_blank">保留的URL</a>加载Firebase SDKs来稍微提高性能。我没试过。)</p><p id="e9f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要测试分析是否有效，请在几台设备上运行SPA。然后转到Firebase控制台，选择分析—实时。在“过去30分钟内的用户”中，您应该看到用于测试的设备数量。</p><p id="87d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了防止滥用apiKey，任何人都可以使用Chrome Inspector显示API key，您应该限制它在您的SPA中使用。这是在<a class="ae lq" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">这里</a>完成的。</p><h1 id="bf47" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">摘要</h1><p id="f409" class="pw-post-body-paragraph ku kv it kw b kx nc ju kz la nd jx lc ld ne lf lg lh nf lj lk ll ng ln lo lp im bi translated">感谢您阅读本教程。如果您已经学习了它，那么您已经了解了如何使用Flutter Web构建一个具有延迟加载、URL更新和菜单的单页面应用程序网站，以及如何使用Firebase托管和分析来部署它。如果你觉得它有用，请为它鼓掌。</p><p id="6b67" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于一个用这个代码制作的网站的实例，去我的主页<a class="ae lq" href="https://ndssoft.se/" rel="noopener ugc nofollow" target="_blank">https://ndssoft.se/</a>。</p></div></div>    
</body>
</html>