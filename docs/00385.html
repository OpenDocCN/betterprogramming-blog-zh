<html>
<head>
<title>CI/CD Ingredients for Success</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CI/CD成功要素</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ci-cd-ingredients-for-success-2031cf7ad152?source=collection_archive---------0-----------------------#2019-05-11">https://betterprogramming.pub/ci-cd-ingredients-for-success-2031cf7ad152?source=collection_archive---------0-----------------------#2019-05-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cdf6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于<em class="ki">持续集成</em>和<em class="ki">持续交付</em>的明显和不太明显的信息</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/77a776d73c13b969403c79699b6682e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yosm0MNqzfjYrWX_NE4_bA.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">让我们从潘多里诺到日本子弹头列车的管道</p></figure><p id="b22a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">持续集成</em>和<em class="lv">持续交付</em> (CI/CD)是任何有价值的软件公司的主要产品。这是一种已经成为行业基础的实践，以至于我们许多人都无法想象没有它的工作。CI/CD和测试一样基本，也一样有用，但是，我已经看到了各种各样的管道，有好的，有坏的，也有疯狂的。</p><p id="412e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我从事CI/CD系统已经好几年了，在我的时间里，我积累了太多我自己的失败。失败带来了一点智慧和许多白发。</p><p id="88f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将介绍您的管道应该具备的一些基本功能。我将标记出基本的和奢侈的，然后我们将讨论你的非功能性，即速度、日志和错误处理。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="5696" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">CI/CD到底是什么？</h1><p id="e9f5" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在我们进入这篇文章的主体之前，先做一个快速的概述。回到1997年的光辉岁月，当绿洲乐队变得强大，穿得像殡仪员一样很酷时，肯特·贝克和罗恩·杰弗里斯推出了极限编程。XP列出了一系列实践、原则和价值观，他们相信这些将会带来一个更好的软件工程世界。这是一个惊人的变化。</p><h2 id="4d77" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">第一，CI</h2><p id="81cd" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">虽然Grady Booch在1991年提出了持续集成，但是是Kent和Ron推动了它的发展。简而言之，CI获取所有代码并不断测试。目标？确保团队不会彼此疏远，并将集成问题扼杀在萌芽状态。</p><h2 id="a747" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">和CD</h2><p id="b106" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Jez Humble和David Farley推广了连续交付(CD)。这是一个双管齐下的原则:</p><ol class=""><li id="6360" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">主干(主分支或SVN主干)中的代码应该是可部署的。</li><li id="afa8" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">这些部署应该完全自动化，不需要任何手动步骤。</li></ol><h2 id="735a" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">他们在一起很棒。</h2><p id="5181" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">就是这样，CI/CD不断地打包、测试和轻松地将代码部署到生产环境中。这有利于消除集成问题，并通过提高部署频率来降低部署风险。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="166c" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">那么，管道应该做什么呢？</h1><p id="c559" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">很高兴你问了。我在这里介绍的每一个特性都是实现CI/CD管道的好处所必需的。我已经尽力做到面面俱到，但还是希望有些变化。</p><h2 id="b108" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">试验</h2><p id="24fe" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这是显而易见的，它应该针对您的代码运行一些测试。想知道你的代码是否有效吗？做些该死的测试。</p><h2 id="0872" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">包装</h2><p id="21e2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">它应该在建造某种可部署的人造物品。同样，显而易见。你打算部署这个，是吗？你需要一件艺术品。</p><h2 id="a7ff" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">安全扫描</h2><p id="3250" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这一点引起了一些人的注意，但是在亲自实现了这一点之后，我决定将它放在“必须拥有”的列表中。代码和工件扫描提供了不可或缺的反馈。OWasp 可以扫描你的依赖关系。<a class="ae oa" href="https://www.tenable.com/products/tenable-io/container-security" rel="noopener ugc nofollow" target="_blank">成立</a>可以扫描你的集装箱。Checkmarx 可以看看你的代码。具体的工具并不重要。重要的是能力。您需要知道SQL注入漏洞何时会出现。您的测试可能会通过，但是除非您的代码是安全的，否则它还不能用于生产。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ob"><img src="../Images/1b25aea7e7215efbc65678e9f62ef954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AZxlL3DuJfUFK06FvrNy1A.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">你/tmp目录下的这个trojan.ru文件是什么？</p></figure><p id="2a01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要将这一责任推卸给运营部门或您的信息安全团队。承认问题，并使用自动化将它可视化。通过在管道中进行安全扫描，您可以生成大量的数据流，这些数据流可以在危机或日常调试中使用。</p><h2 id="de4a" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">将应用程序部署到所有环境</h2><p id="5c9b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">有人曾经告诉我，除了生产之外，所有的部署<em class="lv">都是自动化的，因为我们不能在生产环境中冒险。他们的部署非常复杂，他们不想冒自动化的“风险”。决定把它留给永远可靠的人类思维。</em></p><p id="658b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要因为你感到紧张而回避。如果您有一个简单的部署过程，自动化是很容易的。如果你有一个复杂的过程，这是绝对必要的。没有出路:自动化，自动化，自动化。</p><h2 id="f9f9" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">部署后检查</h2><p id="45c5" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">一旦部署完成，您如何知道它正在工作呢？健壮管道的一个关键要素是健全性检查。这可以采取<a class="ae oa" href="https://en.wikipedia.org/wiki/Smoke_testing_(software)" rel="noopener ugc nofollow" target="_blank">冒烟测试</a>的形式或者更严格的形式。您可以向您的API发出一个HTTP调用，并检查它是否返回了一个<code class="fe oc od oe of b">2xx</code>状态代码。无论如何——不要因为你的应用已经启动就认为你的部署很好。</p><h2 id="4391" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">通知</h2><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi og"><img src="../Images/fffcf61c26fe605219a35b17a3c21f19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/0*Mx3wW5XtNTCcM1R5.jpg"/></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">我的部署失败了！！</p></figure><p id="3722" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不管构建是成功还是失败，管道都应该发出通知。这应该发送到您的工程师最常用的媒体。不要堵塞人们的电子邮件收件箱——他们只会制定一个规则，把它们藏在一个随机的文件夹里。推动他们通过即时消息平台(以及任何审计解决方案)，如Slack或微软团队(叹息)。</p><h2 id="459e" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">有用的错误消息</h2><p id="51e1" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">谈论好的错误消息的最好方式是从一个不清楚的错误消息开始:</p><pre class="kk kl km kn gt oh of oi oj aw ok bi"><span id="6c39" class="na me it of b gy ol om l on oo">Error: "nginx-ingress" has no deployed releases</span></pre><p id="8b3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是显而易见的，如果你了解helm并且遇到过这个问题，唉，我们的错误信息不应该只针对那些已经知道这个问题的人。应该很容易被大家理解。所以从表面上看，这个信息并不是很清楚，是吗？我部署了我的最后一个版本。我想它已经展开了。如果您运行<code class="fe oc od oe of b">helm list</code>,您会看到类似这样的内容:</p><pre class="kk kl km kn gt oh of oi oj aw ok bi"><span id="89cd" class="na me it of b gy ol om l on oo">NAME           REVISION UPDATED                  STATUS</span><span id="3f04" class="na me it of b gy op om l on oo">nginx-ingress  6        Fri May  3 11:19:45 2019 FAILED</span></pre><p id="bffa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">错误消息的问题是它没有提供上下文或说明。这是两种完全必要的成分。这意味着什么，有什么影响，你该怎么办？考虑到这些，一个更有用的错误消息是这样的:</p><pre class="kk kl km kn gt oh of oi oj aw ok bi"><span id="fa85" class="na me it of b gy ol om l on oo">Your application can not be deployed because it is in a failed state. You can verify this using the helm list command. You should rollback to a previous working revision, using the helm rollback command.</span></pre><p id="f42a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里提供的第一句话指出了根本原因:应用程序处于错误的状态。如果您想亲自验证此问题，它还会提供诊断帮助。语境！</p><p id="d141" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此错误消息的第二部分提供了补救措施的说明。指令就在代码中，而不是遵循一些古老的confluence文档。一个好的错误消息可以消除对大量教程和操作指南的需求。它可以消除昂贵的谷歌搜索，并在不会过时的代码中创建活的、响应性的文档。花时间把这些做好是值得的。</p><h2 id="358b" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated">韵律学</h2><p id="ea35" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">最后一个是度量。了解有多少部署失败了，有多少成功了，构建花了多长时间，瓶颈在哪里，等等，这是很有帮助的。有大量的信息需要你的团队去挖掘和理解。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oq"><img src="../Images/f734b20dc693a60b58f6dd76656a2e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6sircfiDsWOl-ZCF7YU_Aw.png"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">理解这样的度量标准可以开启真正的团队改进。</p></figure><p id="2cd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些数据是您团队的生命线——这些度量代表了您团队交付软件变更的能力。如果你能让它浮出水面，你就拥有了一座信息的金矿。</p></div></div>    
</body>
</html>