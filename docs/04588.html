<html>
<head>
<title>How to Add Stimulus.js to a Rails 6 Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Stimulus.js添加到Rails 6应用程序中</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-add-stimulus-js-to-a-rails-6-application-4201837785f9?source=collection_archive---------2-----------------------#2020-04-23">https://betterprogramming.pub/how-to-add-stimulus-js-to-a-rails-6-application-4201837785f9?source=collection_archive---------2-----------------------#2020-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b041" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Webpacker和Ruby on Rails安装Stimulus.js</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/842dad2bcb39a04cc3fa8e622e8de462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MqOMAT7V35cOBH6YaAo8Pw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/users/pixel2013-2364555/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2662550" rel="noopener ugc nofollow" target="_blank"> S. Hermann &amp; F. Richter </a>来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2662550" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="3450" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://stimulusjs.org" rel="noopener ugc nofollow" target="_blank"> Stimulus.js </a>是Rails创建者提供的一个轻量级JavaScript框架。</p><p id="193e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Stimulus将不显眼的JavaScript无缝集成到Rails应用程序中。你可以把它想象成在RoR的基础上添加React或Vue，但要轻量得多。</p><p id="6e12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为它是一个基于MVC框架构建的框架，所以它结合了Rails管道的简单性和现代JavaScript标准——它是模块化的，并且非常快。</p><p id="9e5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Stimulus创建了自己的一组控制器，可以与应用程序前端的DOM交互。它使用<a class="ae ky" href="https://github.com/turbolinks/turbolinks" rel="noopener ugc nofollow" target="_blank"> Turbolinks </a>拦截请求，并通过AJAX执行它们。</p><p id="5018" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从Rails 6开始，JavaScript不再是资产管道的一部分，而是默认使用<a class="ae ky" href="https://github.com/rails/webpacker" rel="noopener ugc nofollow" target="_blank"> Webpacker </a>进行集成。代码保存在<code class="fe lv lw lx ly b">app/javascript</code>文件夹中，并通过<code class="fe lv lw lx ly b">javascript_pack_tag</code>加载到应用程序布局的主体中。</p><p id="3da0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">增加刺激只需要几个步骤。我们开始吧！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b41a" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">第一部分—安装刺激装置</h1><h2 id="be79" class="my mh it bd mi mz na dn mm nb nc dp mq li nd ne ms lm nf ng mu lq nh ni mw nj bi translated">步骤1:通过yarn或npm向应用程序添加刺激</h2><p id="8174" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">因为Rails 6 JS是通过Webpacker加载的，所以任何JavaScript模块或外部库都不是通过gems或供应商文件夹添加的。</p><p id="d329" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个包都通过包管理器(如yarn或npm)加载，并导入到应用程序中。要在应用程序中添加刺激，首先使用类似yarn的包安装它:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="3bef" class="my mh it ly b gy nt nu l nv nw">yarn add stimulus </span></pre><h2 id="9f57" class="my mh it bd mi mz na dn mm nb nc dp mq li nd ne ms lm nf ng mu lq nh ni mw nj bi translated">步骤2:用Webpacker设置刺激</h2><p id="8f1f" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">一旦安装了刺激，通过Webpack将其导入到应用程序中。<code class="fe lv lw lx ly b">app/javascript/packs/application.js</code>文件通常用于引用不同的导入插件——它不应该有单独的JS。</p><p id="edb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，创建<code class="fe lv lw lx ly b">controllers</code>文件夹，然后在里面添加一个<code class="fe lv lw lx ly b">index.js</code>文件。然后，参考<code class="fe lv lw lx ly b">application.js</code>里面的文件夹。</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="9f8b" class="my mh it ly b gy nt nu l nv nw">#shell </span><span id="1a0d" class="my mh it ly b gy nx nu l nv nw">mkdir app/javascript/controllers<br/>touch app/javascript/controllers/index.js</span><span id="2e76" class="my mh it ly b gy nx nu l nv nw"><br/>#app/javascript/packs/application.js</span><span id="99be" class="my mh it ly b gy nx nu l nv nw">import 'controllers'</span></pre><p id="7862" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以简单地导入文件夹的名称，因为默认情况下Webpacker会读取<code class="fe lv lw lx ly b">index.js</code>文件和导入的文件夹。</p><h2 id="66b8" class="my mh it bd mi mz na dn mm nb nc dp mq li nd ne ms lm nf ng mu lq nh ni mw nj bi translated">步骤3:添加刺激启动代码</h2><p id="84cf" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">导入刺激启动文件。<code class="fe lv lw lx ly b">context</code>组件使得从<code class="fe lv lw lx ly b">controllers</code>文件夹中读取和包含每个文件成为可能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="6b32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！现在，您可以将控制器添加到该文件夹中，并开始将其整合到您的Rails 6应用程序中。</p><p id="7207" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">继续阅读一些刺激措施的最佳实践。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="f96b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">第二部分——使用刺激</h1><h2 id="0561" class="my mh it bd mi mz na dn mm nb nc dp mq li nd ne ms lm nf ng mu lq nh ni mw nj bi translated">第一步:设置</h2><p id="7c52" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">第一步是创建一个Stimulus.js将访问DOM的页面。</p><p id="0670" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，这样做是为了通过特定的模型与数据库进行交互，或者与websockets同时使用(通过Action Cable)。但是对于这个演示，我将使用一个静态页面控制器作为主页。</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="cd6c" class="my mh it ly b gy nt nu l nv nw">rails g controller pages home</span><span id="3f79" class="my mh it ly b gy nx nu l nv nw">#config/routes.rb<br/>root "pages#home"</span></pre><p id="d150" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我将在主页上添加一些要操作的内容。</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="1819" class="my mh it ly b gy nt nu l nv nw">#app/views/pages/home.html.erb</span><span id="d3c4" class="my mh it ly b gy nx nu l nv nw">&lt;div class=”btn btn-primary”&gt;Say Hello&lt;/div&gt;</span></pre><p id="0878" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，你可以整合刺激方案了。</p><h2 id="ecb7" class="my mh it bd mi mz na dn mm nb nc dp mq li nd ne ms lm nf ng mu lq nh ni mw nj bi translated">步骤2:创建刺激控制器</h2><p id="d99d" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">在JavaScript文件夹中创建刺激控制器(注意:不是在<code class="fe lv lw lx ly b">app/controllers</code>文件夹中)，然后添加样板代码。</p><p id="617c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对此没有Rails生成器，但我希望它能被包含在未来的版本中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="ad03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当从DOM调用控制器时，将运行connect方法:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="faba" class="my mh it ly b gy nt nu l nv nw">#app/views/pages/home.html.erb</span><span id="c13e" class="my mh it ly b gy nx nu l nv nw">&lt;div data-controller="hello"&gt;<br/>  &lt;div class="btn btn-primary"&gt;Say Hello&lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="854b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更优雅和Rails-y的方式是添加一个<code class="fe lv lw lx ly b">content_tag</code>:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="446b" class="my mh it ly b gy nt nu l nv nw">#app/views/pages/home.html.erb</span><span id="eaf5" class="my mh it ly b gy nx nu l nv nw">&lt;%= content_tag :div, nil, data: {controller: "hello"} do %&gt;<br/>  &lt;div class="btn btn-primary"&gt;Say Hello&lt;/div&gt;<br/>&lt;% end %&gt;</span></pre><p id="8365" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加数据属性后，您可以在JS控制台中检查连接:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/eaddad7578b3c67f60c8981025da2df4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUCRgbC59lumrepLm7nTaQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">请访问网站http://localhost:3000/</p></figure><h2 id="6940" class="my mh it bd mi mz na dn mm nb nc dp mq li nd ne ms lm nf ng mu lq nh ni mw nj bi translated">第三步:添加你的第一个动作</h2><p id="50e4" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">好吧，让我们让事情发生。为此，我将从官方<a class="ae ky" href="https://stimulusjs.org/handbook/hello-stimulus" rel="noopener ugc nofollow" target="_blank">刺激</a>手册中摘录一个例子。让我们在点击按钮时用经典程序员<em class="ob"> Hello World </em>替换标题文本。</p><p id="880b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是向我的按钮div添加一个回调。数据属性的这个组成部分被称为<em class="ob">动作描述符</em>。它在点击时创建一个监听器来调用<code class="fe lv lw lx ly b">hello</code>控制器中的<code class="fe lv lw lx ly b">greet</code>动作。</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="bf26" class="my mh it ly b gy nt nu l nv nw">#app/views/pages/home.html.erb</span><span id="aeb1" class="my mh it ly b gy nx nu l nv nw">&lt;div class="btn btn-primary" data-action="click-&gt;hello#greet"&gt;Say Hello&lt;/div&gt;</span></pre><p id="589e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，将动作添加到刺激控制器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h2 id="1350" class="my mh it bd mi mz na dn mm nb nc dp mq li nd ne ms lm nf ng mu lq nh ni mw nj bi translated">第四步。改变DOM</h2><p id="3925" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">最后，让我们在DOM中添加一些可以通过点击按钮来改变的东西。刺激框架通过在控制器内部将元素指定为<code class="fe lv lw lx ly b">targets</code>来简化对元素的引用。</p><p id="7f27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在HTML页面中，将<code class="fe lv lw lx ly b">data-target</code>属性添加到<code class="fe lv lw lx ly b">h1</code>元素中，同时引用控制器的名称和元素的名称。</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="411a" class="my mh it ly b gy nt nu l nv nw">&lt;h1 data-target="hello.heading"&gt;This is the home page&lt;/h1&gt;</span></pre><p id="c489" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在控制器内部，创建数据目标。可以将多个目标添加到阵列中。</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="923d" class="my mh it ly b gy nt nu l nv nw">export default class extends Controller {<br/>  static targets = ["heading"]<br/>  [...]<br/>}</span></pre><p id="e387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，修改greet函数来替换click上的目标的<code class="fe lv lw lx ly b">innerHTML</code>:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="8ce9" class="my mh it ly b gy nt nu l nv nw">greet() {<br/>   this.headingTarget.innerHTML = "Hello World"<br/>}</span></pre><p id="c565" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！就这么简单。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="57ed" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated"><strong class="ak">资源</strong></h1><ul class=""><li id="d451" class="oc od it lb b lc nk lf nl li oe lm of lq og lu oh oi oj ok bi translated"><a class="ae ky" href="https://github.com/maltyeva/rails-stimulus-demo" rel="noopener ugc nofollow" target="_blank">GitHub上的Rails刺激演示</a></li><li id="1222" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated"><a class="ae ky" href="https://rails-stimulus-demo.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">一个Heroku demo </a></li></ul></div></div>    
</body>
</html>