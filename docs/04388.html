<html>
<head>
<title>How to Share Your Medium Posts on LinkedIn With Python and AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python和AWS Lambda分享你在LinkedIn上的中型帖子</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-share-your-medium-posts-on-linkedin-with-python-and-aws-lambda-c54f355a5195?source=collection_archive---------16-----------------------#2020-04-09">https://betterprogramming.pub/how-to-share-your-medium-posts-on-linkedin-with-python-and-aws-lambda-c54f355a5195?source=collection_archive---------16-----------------------#2020-04-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cca9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">增加你的知名度和你的观众</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/42d0e94efade8141d6e4d73db7dff73e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*03xqA1YUC0K0VrMukPid9w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@merittthomas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">merit Thomas</a>在<a class="ae ky" href="https://unsplash.com/s/photos/future?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f592" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们来看看如何使用Medium的API抓取你的Medium帖子。</p><p id="8ca3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要做到这一点，你只需要请求中型团队访问他们的API。您需要访问配置文件中的以下元素:</p><ul class=""><li id="b7e0" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">配置文件名称</li><li id="a816" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">简历</li><li id="174d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">一个化身</li><li id="1818" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">你的两个写作样本发表在媒体上</li></ul><p id="e3c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后你只需要给yourfriends@medium.com发一封电子邮件，请求一个客户端ID和一个客户端密码。灵媒的人会带着珍贵的钥匙回来找你。</p><p id="cd69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，如果您只想解析您的提要，并且不需要访问您的媒体信息，则不需要API访问。Medium不通过API公开你的提要，但它是通过RSS完成的。</p><p id="1ed9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你有了它们，让我们来谈谈Python。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="a483" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先需要做的是导入请求(到<code class="fe ml mm mn mo b">GET</code>和<code class="fe ml mm mn mo b">POST</code>URL)，feedparser解析RSS提要，以及JSON，因为现在一切都是JSON。</p><p id="99d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还需要导入SSL并稍微修改一下配置，因为使用feedparser会面临证书问题(关于这一点的更多信息，请参见GitHub链接)。</p><p id="eb29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来我们需要做的是设置我们的头来使用Medium令牌，并设置一个用户代理(我只是在网上随机挑选了一个):</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="939e" class="mt mu it mo b gy mv mw l mx my">base_url = "https://api.medium.com/v1/"r = requests.get(base_url+'me', headers=headers)myUserJson = (r.json())</span></pre><p id="4ec3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码将用我们的头在<code class="fe ml mm mn mo b">me</code> API上发出一个<code class="fe ml mm mn mo b">GET</code>请求。响应以JSON格式存储在一个<code class="fe ml mm mn mo b">var</code>中:</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="c7e0" class="mt mu it mo b gy mv mw l mx my">{'<strong class="mo iu">data</strong>': {'id': '164c349dea9b05a140503bfe7fa20c47a9ce54210eb46940b61b9ec039e88ec22', '<strong class="mo iu">username</strong>': '<strong class="mo iu">geoffrey.mariette</strong>', 'name': 'Geoffrey Mariette', 'url': '<a class="ae ky" href="https://medium.com/@geoffrey.mariette'" rel="noopener">https://medium.com/@geoffrey.mariette'</a>, 'imageUrl': '<a class="ae ky" href="https://cdn-images-1.medium.com/fit/c/400/400/2*UErYKnZmjLi1cjBoTZNGJQ.jpeg'" rel="noopener">https://cdn-images-1.medium.com/fit/c/400/400/2*UErYKnZmjLi1cjBoTZNGJQ.jpeg'</a>}}</span></pre><p id="8aaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是来自API的完整响应。它包含唯一的ID、用户名、姓名、用户资料的URL以及头像的URL(例如我自己的帐户)。</p><p id="fc9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们需要的是用户名来获取我们的提要内容:</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="9e8d" class="mt mu it mo b gy mv mw l mx my">newsFeed = feedparser.parse('https://medium.com/feed/@'+myUserJson['data']['username'])</span></pre><p id="d1ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将RSS提要的结果存储在一个变量中，然后我们可以分析它并提取我们想要的特定信息。</p><p id="d485" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">注意:您可以在浏览器中打开该链接，以便更好地查看内容。</em></p><p id="e51c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里重要的是以下字段:文章标题和链接、发表日期，可能还有相关的标签。</p><p id="c346" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将所有这些字段存储在一个<code class="fe ml mm mn mo b">dict</code>中，T5本身存储在一个列表中。我们的<code class="fe ml mm mn mo b">var</code>会是这样的:</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="03ee" class="mt mu it mo b gy mv mw l mx my">blogPosts = [{"title": "mytitle1", "link": "mylink1", "published" : "date1", "tags" : ["tag10", "tag11" ]},{"title": "mytitle2", "link": "mylink2", "published" : "date2", "tags" : ["tag20", "tag21" ]} ]</span></pre><p id="693c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这导致了下面的代码:</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="b16f" class="mt mu it mo b gy mv mw l mx my">blogPosts = []<br/>for entry in newsFeed.entries:<br/>  tags = []<br/>  for tag in entry['tags']:<br/>    tags.append(tag['term'])<br/>    blogPosts.append({"title": entry['title'], "link": entry['id'], "published": entry['published'], "tags": tags})</span></pre><h2 id="de98" class="mt mu it bd na nb nc dn nd ne nf dp ng li nh ni nj lm nk nl nm lq nn no np nq bi translated">是时候看看我们如何在两个网络之间自动共享了</h2><p id="5368" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">LinkedIn API访问比Medium的稍微复杂一点。</p><p id="5e8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它使用OAuth2协议进行访问，在获得著名的访问令牌之前需要一些步骤。</p><p id="774e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了学习这些步骤，我使用了在Medium上找到的这个<a class="ae ky" href="https://medium.com/@ellesmuse/how-to-get-a-linkedin-access-token-a53f9b62f0ce" rel="noopener">精彩教程</a>。即使截图有一点旧，但流程是一样的。我将很快总结一下:</p><ol class=""><li id="84e3" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nw mb mc md bi translated">创建LinkedIn应用程序。APi LinkedIn上的每个授权都必须与一个应用程序链接。每个应用程序都链接到一个公司(所以你可能也需要创建一个)。</li><li id="6e48" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nw mb mc md bi translated">选择权限。一旦您完成认证过程，您将被授予访问:<br/><em class="mz"/><code class="fe ml mm mn mo b">r_emailaddress</code><br/><code class="fe ml mm mn mo b">r_liteprofile</code><br/><code class="fe ml mm mn mo b">w_member_social</code>的权限</li><li id="6bf4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nw mb mc md bi translated">使用您的新客户id和客户密码，然后按照Esther Liao的教程将您的应用程序链接到一个网站，这样您就可以获得发布到您的LinkedIn个人资料所需的访问令牌。</li></ol></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="c71f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您已经拥有了梦寐以求的令牌，您已经准备好使用Python了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="fac0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的注释中，有一些Python行可以用来生成访问令牌。</p><p id="73a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与Medium一样，我们首先需要知道令牌背后的人是谁。为此，您可以调用<code class="fe ml mm mn mo b"> /me</code> API。LinkedIn API允许您在响应中直接请求您需要的字段，而不是检索需要由您解析的巨大JSON。</p><p id="557a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">投影场的例子可以在<a class="ae ky" href="https://docs.microsoft.com/en-us/linkedin/shared/references/v2/profile" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="0e7e" class="mt mu it mo b gy mv mw l mx my">linkedinBaseUrl = 'https://api.linkedin.com/v2/'<br/>headers = {'Authorization': 'Bearer ' + access_token}<br/>r = requests.get(linkedinBaseUrl+'me?<strong class="mo iu">projection=(id)</strong>', headers=headers)<br/>linkedInProfile = r.json()#create the author variable in linkedin urn format<br/>author = "urn:li:person:"+linkedInProfile['id']</span></pre><p id="3783" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这段代码中，只有我们用来创建author var的id字段引用LinkedIn资源。</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="d94b" class="mt mu it mo b gy mv mw l mx my">#concat all tags extracted from medium with an hashtag<br/>myTagsstr = ' #'.join(map(str, myposttags))</span></pre><p id="86ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们想用相同的媒体标签分享我们的文章。上面的代码将获取所有的post标签，然后在单词后面添加一个hashtag(第一个除外)，并将项目列表转换为string。</p><p id="15e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，如果我们有这样一个列表:</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="e5d3" class="mt mu it mo b gy mv mw l mx my">myposttags = ["tag1", "tag2", "tag3", "tag4"]</span></pre><p id="bce2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将变成:</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="1021" class="mt mu it mo b gy mv mw l mx my">myTagsstr = "tag1 #tag2 #tag3 #tag4"</span></pre><p id="d891" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要为UGC Post API准备我们的帖子内容，并在我们的帖子中包含我们想要的值(请参考<a class="ae ky" href="https://docs.microsoft.com/en-us/linkedin/marketing/integrations/community-management/shares/ugc-post-api" rel="noopener ugc nofollow" target="_blank">此链接</a>了解允许/必需的JSON帖子数据字段)。</p><pre class="kj kk kl km gt mp mo mq mr aw ms bi"><span id="9248" class="mt mu it mo b gy mv mw l mx my">data = { <br/> "author": author,<br/> "lifecycleState": "PUBLISHED",<br/> "specificContent": {<br/>  "com.linkedin.ugc.ShareContent": {<br/>   "shareCommentary": {<br/>    "text": "Check out my new Medium post : " + myposttitle + "\n" + myposturl + "\n #" + myTagsstr + "\n \n This was automaticaly posted from AWS Lambda"<br/>   },<br/>  "shareMediaCategory": "NONE"<br/>  },<br/> },<br/> "visibility": {<br/> "com.linkedin.ugc.MemberNetworkVisibility": "PUBLIC"<br/> },<br/>}</span></pre><p id="c799" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里重要的是:</p><p id="fefc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ml mm mn mo b">author</code> <em class="mz"> </em> =你</p><p id="ae84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ml mm mn mo b">text</code> <em class="mz"> </em> =你想分享的内容。这里应该是这样的:</p><blockquote class="oe of og"><p id="d3ae" class="kz la mz lb b lc ld ju le lf lg jx lh oh lj lk ll oi ln lo lp oj lr ls lt lu im bi translated">查看我的新媒体帖子:如何在LinkedIn上与API分享<br/>https://medium.com/myarticlelink<br/># tag 1 # tag 2 # tag 3 # tag 4<br/><br/>这是自动从AWS Lambda发布的。</p></blockquote><p id="8b7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ml mm mn mo b">shareMediaCategory</code> <em class="mz"> </em> =可以是<code class="fe ml mm mn mo b">JOB</code>、<code class="fe ml mm mn mo b">ARTICLE</code>、<code class="fe ml mm mn mo b">QUESTION</code>等等。</p><p id="78aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ml mm mn mo b">visibility</code> <em class="mz"> </em> =如果您希望您的帖子被以下人看到:</p><ul class=""><li id="15f6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe ml mm mn mo b">CONNECTIONS</code> —代表业主一级网络。</li><li id="1436" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">任何人都可以查看。</li><li id="4acc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ml mm mn mo b">LOGGED_IN</code> —仅可由登录成员查看。</li></ul><p id="8ab6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发布你的请求，你就完成了。我们只是记录内容回复，以确保文章被正确分享。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="9f76" class="ok mu it bd na ol om on nd oo op oq ng jz or ka nj kc os kd nm kf ot kg np ou bi translated">自动化文章分享的最后一步:AWS Lambda和Python V-ENV</h1><p id="c7b1" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">我们到了。我们的三部分教程的最后一部分是关于如何自动分享中型职位到你的LinkedIn帐户！</p><p id="3147" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们将使用AWS Lambda和Cloudwatch事件。首先，让我们看看它们是什么:</p><blockquote class="oe of og"><p id="4f2d" class="kz la mz lb b lc ld ju le lf lg jx lh oh lj lk ll oi ln lo lp oj lr ls lt lu im bi translated">AWS Lambda允许您在不提供或管理服务器的情况下运行代码。您只需为消耗的计算时间付费。Amazon CloudWatch Events提供了一个近乎实时的系统事件流，描述了Amazon Web Services (AWS)资源的变化。使用可以快速设置的简单规则，您可以匹配事件并将它们路由到一个或多个目标函数或流。</p><p id="db18" class="kz la mz lb b lc ld ju le lf lg jx lh oh lj lk ll oi ln lo lp oj lr ls lt lu im bi translated"><a class="ae ky" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> <em class="it">亚马逊</em> </a></p></blockquote><p id="682c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">听起来很适合我们。</p><p id="6007" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们不想构建一个运行简单Python函数的VM。第二，由于我计划在每个星期四发布我的中型帖子，我也可以计划在其后立即触发我的lambda。一个简单的cron事件将非常适合！</p><p id="de7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:这符合我的需要，但可能不符合你的需要。在任何情况下，您仍然可以找到如何自动触发Lambda的解决方案。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="b150" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们先做λ部分。</p><p id="f7cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录您的AWS登录名，然后转到Lambda页面，然后创建一个新函数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/b3519ee8dd1bd9e4c7346d4d7d50b9a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y_X6GnbZuP6nsKeb.png"/></div></div></figure><p id="0d11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给你的函数命名，选择python作为框架(我选择Python 3.6，因为我写函数的时候电脑上就有这个)。</p><p id="dfd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至于权限，您可以将其保留为默认值。AWS将为您创建一个具有基本权限(允许访问cloudwatch日志)的新IAM角色，这足以满足我们的需求。</p><p id="96ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的函数现在已经创建了，但是是空的！我们现在需要做的是将代码以zip格式直接上传到Lambda中。为什么要上传而不是直接将代码复制粘贴到web编辑器中？因为我们使用了一些Lambda环境中默认不存在的库(比如请求)。这没什么大不了的，因为我们可以使用Python v-env来上传函数依赖关系！</p><p id="47bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，Python中的v-env是什么？基本上，v-env允许你为你的函数创建一个专用的env，带有特定的依赖项，这些依赖项也存在于特定的版本中！使用它们实际上是一种很好的实践，因为它允许不同的应用程序在同一台服务器上运行，而不会发生冲突。如果你对v-env感兴趣，请阅读这篇<a class="ae ky" href="https://docs.python.org/3/tutorial/venv.html" rel="noopener ugc nofollow" target="_blank">有用的文档</a>。</p><p id="c8df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AWS也有一个为Lambda 创建v-env的简单指南。</p><p id="57bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们需要在v-env中安装以下内容:</p><ul class=""><li id="cdc6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe ml mm mn mo b">requests</code></li><li id="ac64" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ml mm mn mo b">feedparser</code></li></ul><p id="904a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们上传创建我们的功能代码(我的。py文件是<code class="fe ml mm mn mo b">share.py</code>。注意你可以改变它，但是你需要记住你的文件的名字来从Lambda调用它。</p><p id="61ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是Lambda页面配置。这里有两件事你需要明白。</p><ul class=""><li id="89b4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">您的Lambda函数将调用share.py文件中的函数<code class="fe ml mm mn mo b">lambdaHandler</code>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/19207920ec7ea444970581b73b4efafa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ykHS3V9qTKbXunYM.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">请注意处理程序部分:share (filename)。lambdaHandler(函数名)</p></figure><ul class=""><li id="d36c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">您需要创建一个数据集来测试您的代码。你在里面放什么并不重要，因为你没有把参数传递给你的Lambda。您可以将其保留为默认值。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/65626488fa01d321253dd193e21f0bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fxnVnUu_nobIhpV7.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本测试事件</p></figure><p id="52dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能会注意到你不能直接从Lambda接口修改你的脚本。那是因为我们的代码对于编辑器来说太大了。这意味着，如果您需要更改一些代码，您必须重新创建一个新的zip包并再次上传，然后才能测试它。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="c7f9" class="ok mu it bd na ol om on nd oo op oq ng jz or ka nj kc os kd nm kf ot kg np ou bi translated">Cloudwatch事件触发器配置</h1><p id="40f9" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">既然我们的函数已经正确配置，我们需要安排一个<code class="fe ml mm mn mo b">cloudwatch</code>事件来触发它。</p><p id="6223" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可以很容易地从Lambda UI中完成。您只需点击“添加触发器”，然后选择cloudwatch事件并配置您的cron表达式，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/0cfd9b4e9cfd94db0e1c8210fc0f117a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ELK9DqOk23gipqLg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们函数的CRON配置:每周四上午10点。</p></figure><p id="b607" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们的Lambda已经被正确调度，我们可以尝试触发它，看看它是否在工作。为此，我们直接从web界面使用“测试”按钮。</p><p id="9ed4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果脚本运行正常，您可以访问您的LinkedIn个人资料并直接查看结果，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/de50de77b594155bc2acc83a5ee5b2cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tZ5Q0P-IEI9F3LmL.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">你最近的媒体文章已经被自动分享了！</p></figure><p id="944a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">注意:如果你想做一些额外的测试，你需要删除你的LinkedIn帖子。这是因为脚本试图只共享你最新的媒体文章，而LinkedIn API不接受重复的共享内容。</em></p><p id="0619" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是GitHub 上的<a class="ae ky" href="https://github.com/gmariette/sharing/blob/master/aws/lambda/share.py" rel="noopener ugc nofollow" target="_blank">完整源代码。</a></p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="7f63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你，你现在可以自动分享你的文章了！</p><p id="dd4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有任何困难，不要犹豫地评论，我将很乐意帮助你通过这个过程。</p></div></div>    
</body>
</html>