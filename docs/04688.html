<html>
<head>
<title>Omicron: A Simple Library to Build HTTP Servers in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Omicron:在Node.js中构建HTTP服务器的简单库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/omicron-a-simple-library-to-build-http-servers-in-node-js-421ef387da7c?source=collection_archive---------15-----------------------#2020-04-29">https://betterprogramming.pub/omicron-a-simple-library-to-build-http-servers-in-node-js-421ef387da7c?source=collection_archive---------15-----------------------#2020-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="46e1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以更实用的方式构建服务器</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e71b040986e7d6c80e4137a5b1822144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V7pVmB03HxT4CxtkyUinWg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">詹姆斯·哈里森在<a class="ae kv" href="https://unsplash.com/@jstrippa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="24c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">几天前，我开始开发一个新的npm包，在Node.js中构建HTTP服务器。</p><p id="9cc8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目标是创建一种以更实用的方式构建服务器的方法。结果是<code class="fe ls lt lu lv b">Omicron</code>。你可以在npm 上查看<a class="ae kv" href="https://www.npmjs.com/package/@zaetrik/omicron" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="056f" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">简短的介绍</h1><p id="25d3" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">首先，去拿<code class="fe ls lt lu lv b">Omicron</code> → <code class="fe ls lt lu lv b">npm i --save @zaetrik/omicron</code>。为了遵循本文中的示例，您还需要<a class="ae kv" href="https://github.com/gcanti/fp-ts" rel="noopener ugc nofollow" target="_blank"> fp-ts </a>和<a class="ae kv" href="https://github.com/gcanti/io-ts" rel="noopener ugc nofollow" target="_blank"> io-ts </a>。可以用<code class="fe ls lt lu lv b">npm i --save fp-ts io-ts</code>安装。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="d49e" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">简单的服务器示例</h1><p id="823d" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">现在让我们启动一个简单的服务器来处理对<code class="fe ls lt lu lv b">http://localhost:3000/</code>的<code class="fe ls lt lu lv b">GET</code>请求。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">去运行你的文件吧！您现在应该有一个正在运行的服务器，它用“Hello”来响应对<code class="fe ls lt lu lv b">http://localhost:3000/</code>的<code class="fe ls lt lu lv b">GET</code>请求👋".</p><p id="b623" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如您可能已经看到的，我们必须定义两个处理函数。第一个处理程序用于传入的请求，它将接收传入的请求。第二个函数是错误处理程序，只有在处理程序中出现错误时才会执行。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="b7c3" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">使用自定义设置进行响应</h1><p id="0895" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">您也可以发送带有自定义设置的响应:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="3820" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要返回带有自定义设置的响应，您的处理函数必须返回类型为<code class="fe ls lt lu lv b">RouteResponse</code>的内容。在上面的例子中，我们在自定义头的帮助下向客户机发回了一个cookie。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="a89a" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">中间件</h1><p id="ba79" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated"><code class="fe ls lt lu lv b">Omicron</code>也允许你使用中间件。你可以用中间件功能做一些非常酷的事情。</p><p id="d20f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以将中间件与<code class="fe ls lt lu lv b">Omicron</code>中的<code class="fe ls lt lu lv b">useMiddleware()</code>功能一起使用。这个函数除了将中间件函数与您的处理函数组合起来之外，基本上什么也不做。</p><p id="5ae3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以很容易地编写中间件函数。传入的请求被传递到您的中间件，您可以从中间件函数返回您想要的任何数据。这些数据然后被传递给你的处理器。</p><p id="6a1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">中间件必须接受一个传入的请求，并返回类型为<code class="fe ls lt lu lv b">Either&lt;Error, HttpRequest | unknown&gt;</code>的东西。还可以选择编写返回原始数据的中间件，并在中间件失败时抛出错误。您可以通过<code class="fe ls lt lu lv b">useErrorThrowingMiddleware()</code>功能使用它们。</p><p id="99ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个示例中间件，它在一个<code class="fe ls lt lu lv b">Option&lt;RequestBody&gt;</code>中返回一个<code class="fe ls lt lu lv b">RequestBody</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4da9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，您可以编写自己的小中间件函数来转换传入的请求以满足您的需求。</p><p id="5bc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你也可以传入多个中间件。它们是从左向右执行的。来自第一个中间件的结果将被传递到第二个中间件，依此类推，直到它最终被传递到您的处理函数。</p><p id="ff3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">中间件功能的另一个有趣的例子是输入验证。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="bbfa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我们编写了一个小的验证器函数，它接受我们用<code class="fe ls lt lu lv b">io-ts</code>定义的类型，然后返回一个验证传入请求体的中间件函数。</p><p id="a2d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这真的很强大，因为我们现在可以将一个类型化的对象返回给我们的处理函数，它肯定具有我们想要的类型。然后，我们可以在处理函数中处理我们的类型化数据。</p><p id="166c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是一个正在开发的产品，仍然缺少很多重要的特性，但是你已经可以用它来创建一些很酷的东西了。如果你决定用<code class="fe ls lt lu lv b">Omicron</code>建造什么东西，我很想看看。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="75f6" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">参考</h1><ul class=""><li id="9de9" class="nc nd iq ky b kz mv lc mw lf ne lj nf ln ng lr nh ni nj nk bi translated">奥米克隆图书馆—<a class="ae kv" href="https://www.npmjs.com/package/@zaetrik/omicron" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/@zaetrik/omicron</a></li><li id="9274" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">fp-ts库—<a class="ae kv" href="https://github.com/gcanti/fp-ts" rel="noopener ugc nofollow" target="_blank">https://github.com/gcanti/fp-ts</a></li><li id="fe24" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">io-ts库—<a class="ae kv" href="https://github.com/gcanti/io-ts" rel="noopener ugc nofollow" target="_blank">https://github.com/gcanti/io-ts</a></li></ul></div></div>    
</body>
</html>