<html>
<head>
<title>Solana — Understanding Programs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">索拉纳——理解程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/solana-understand-programs-a7d2d15f32fa?source=collection_archive---------18-----------------------#2022-08-29">https://betterprogramming.pub/solana-understand-programs-a7d2d15f32fa?source=collection_archive---------18-----------------------#2022-08-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7fba" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">深入了解窗帘后面的东西</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/569eba98f6e8bba13b73f5cc74e81254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DlC_F-pk9UlkMAwz"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@theshubhamdhage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">https://guerrillabuzz.com</a><a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a>——<a class="ae kv" href="https://guerrillabuzz.com/" rel="noopener ugc nofollow" target="_blank">GuerrillaBuzz Crypto PR</a>拍摄</p></figure><p id="c5d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章是我想在开始着手<a class="ae kv" href="https://solana.com" rel="noopener ugc nofollow" target="_blank"> Solana </a>程序开发时找到的文章。事实上，有很多资源可以教你如何构建Solana程序，但是我还没有找到一个足够完整的资源可以让你真正理解幕后发生的事情。</p><p id="4f33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将解释以下内容:</p><ol class=""><li id="9a28" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">索拉纳计划和账户的基本概念</li><li id="2902" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">基本索拉纳程序结构</li><li id="c06d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">从这里去哪里</li></ol><p id="bb02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到这篇文章结束时，你应该能理解窗帘后面的铁锈是干什么的了。</p><p id="f98b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这能促进你的旅程:)让我们开始吧。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="e910" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">1 — Solana计划和客户</h1><p id="f144" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">如果你来自以太坊世界，索拉纳计划基本上是一个聪明的合同。一开始我最大的困扰是在Solana中程序是“无状态”的。换句话说，在以太坊世界中，你可以创建一个<em class="no">计数器</em>智能合约，并将<em class="no">计数器</em>的值存储在智能合约本身中，这在Solana上是不可能的。为了在Solana上存储数据，您需要使用帐户。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="5889" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我澄清这一点。总的来说，你可以把索拉纳世界想象成一个由客户主导的世界。事实上，索拉纳程序只是一个被标记为可执行的账户。从<a class="ae kv" href="https://docs.solana.com/terminology#account" rel="noopener ugc nofollow" target="_blank">索拉纳官方文件</a>中我们读到一个账号是:</p><blockquote class="nr ns nt"><p id="ba03" class="kw kx no ky b kz la jr lb lc ld ju le nu lg lh li nv lk ll lm nw lo lp lq lr ij bi translated">Solana分类帐中的一种记录，它或者保存数据，或者是一个可执行程序。</p></blockquote><p id="f77d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Solana中，除了数据帐户和程序帐户，还有表示Solana上的本地程序的本地帐户。其中最重要的是系统程序。这个程序很重要，因为Solana上的每个新帐户都默认为系统程序所有。</p><p id="7179" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了完善我们的帐户知识，我们可以说帐户具有:</p><ol class=""><li id="4317" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">所有者→这必须是一个程序，默认情况下是系统程序</li><li id="cb27" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">持有人→拥有账户私钥的人</li><li id="8503" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">总是可以通过公钥来寻址</li><li id="3ff4" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">可以保存数据(如果不可执行)和SOL(sola本地令牌)</li></ol><p id="c255" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这提出了一个重要的问题。如果我不是我帐户的所有者，我如何从/向我的帐户转移SOL？在Solana上，虽然任何人都可以对账户进行贷记，但只有账户所有者可以对账户进行借记和更改数据。</p><p id="c97d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">索拉纳通过以下方式实现这一目标:</p><ol class=""><li id="a5ca" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">账户持有人必须用其私钥签署指令</li><li id="968a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">指令必须发送给系统程序(即账户所有者，也是唯一允许借记账户和更改数据的人)</li><li id="cefb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">系统程序对照账户公钥检查私钥，如果检查通过，则授权转账</li></ol><p id="8c02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这澄清了索拉纳计划和帐户。现在我们准备好看一些代码了。</p><h1 id="ff33" class="mr ms iq bd mt mu nx mw mx my ny na nb jw nz jx nd jz oa ka nf kc ob kd nh ni bi translated">2 —程序结构</h1><p id="45ad" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">如果你熟悉REST api，当你在Solana chain上写一个程序时，你需要定义你的程序能够处理哪些指令，因为它们是你的web服务器的端点。</p><p id="7926" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">函数签名通常采用以下参数:</p><ul class=""><li id="7fef" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oc ly lz ma bi translated">程序id →这是当前正在执行的程序的公钥</li><li id="9e12" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oc ly lz ma bi translated">在交易过程中程序可以读写的账户。一个帐户在数组中的位置表明了它的意义，例如，当转移资金时，一个指令可以将第一个帐户定义为源，将第二个帐户定义为目的</li><li id="e05c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oc ly lz ma bi translated">特定于该功能的附加数据</li></ul><p id="387e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在简单的Rust代码中，这可以解释为:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od nq l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图书馆</p></figure><p id="392f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要注意的是，Solana希望您将交易中涉及的所有帐户传递给函数。这使得Solana可以通过并行处理涉及不同账户的交易来优化交易本身的吞吐量。</p><p id="fa93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">换句话说，运行库可以查看一个程序(甚至跨程序)的所有传入事务，并可以检查事务的第一个参数中的内存区域是否重叠。如果没有，运行时就可以并行运行这些事务，因为它们彼此不冲突。更好的是，如果运行时发现两个事务访问重叠的内存区域，但只读不写，它还可以并行处理这些事务，因为它们彼此不冲突！</p><p id="9321" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了举例，我们重点看一下Solana提供的<a class="ae kv" href="https://github.com/solana-labs/example-helloworld" rel="noopener ugc nofollow" target="_blank"> Hello World例子</a>。在本例中，我们希望存储我们向特定客户打招呼的时间。因为Solana中的程序是无状态的，所以我们至少需要:</p><ol class=""><li id="2644" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">一个<em class="no"> HelloWorld </em>可执行程序(又名。程序帐户)可以处理我们的指令</li><li id="c450" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">一个或多个<em class="no">问候账号</em>(每个你要问候的账号一个)。那些将是不可执行的程序(又名。数据账户)，其可以存储他们被问候的次数。这些帐户必须归HelloWorld程序所有，以便它能够进行更改</li></ol><p id="091c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于要点1，我们可以使用<a class="ae kv" href="https://docs.solana.com/cli/deploy-a-program" rel="noopener ugc nofollow" target="_blank"> Solana CLI </a>简单地部署我们的HelloWorld程序。</p><p id="cd43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于要点2，我们可以在执行Hello之前创建不存在的问候帐户，并将所有权转移到HelloWorld程序(查看完整的客户端代码<a class="ae kv" href="https://github.com/solana-labs/example-helloworld/blob/master/src/client/hello_world.ts#:~:text=//%20Check%20if%20the%20greeting%20account%20has%20already%20been%20created" rel="noopener ugc nofollow" target="_blank">此处</a>)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od nq l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自hello_world.ts的亮点</p></figure><p id="21f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在,<code class="fe mg mh mi mj b">process_instruction</code> Rust代码应该清楚多了。让我们来看看:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="od nq l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">lib.rs中的突出显示</p></figure><p id="4275" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们开始吧:</p><ol class=""><li id="db6d" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">我们使用来自Solana的<code class="fe mg mh mi mj b">next_account_info</code>实用程序从帐户列表中获取问候帐户值</li><li id="a149" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">我们检查HelloWorld程序id是否是该帐户的所有者，以及进行更改的能力。如果不是，我们抛出一个错误</li><li id="b4be" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">如果一切正常:<br/> -我们使用<code class="fe mg mh mi mj b">borsh</code> <br/>取消帐户的序列化-我们递增数据属性<br/>中的计数器-我们用新数据序列化帐户</li></ol><h1 id="1b73" class="mr ms iq bd mt mu nx mw mx my ny na nb jw nz jx nd jz oa ka nf kc ob kd nh ni bi translated">从这里去哪里</h1><p id="f0b5" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">您可能已经注意到，基本的Solana代码包含许多样板文件(例如，params序列化和反序列化、帐户验证…) <br/>为此，<a class="ae kv" href="https://github.com/coral-xyz/anchor" rel="noopener ugc nofollow" target="_blank"> Anchor </a>是一个框架，可以帮助您更快地创建Solana程序，并主要关注程序的业务逻辑。</p><p id="f670" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，你可能想知道为什么不从Anchor开始，而不是从Solana plain开始:)总的来说，我相信从零开始总是理解抽象如何工作的好方法，并允许你在开发时做出有意识的选择。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="f5ac" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">参考</h1><ul class=""><li id="ea82" class="ls lt iq ky b kz nj lc nk lf oe lj of ln og lr oc ly lz ma bi translated">索拉纳<a class="ae kv" href="https://solana.com" rel="noopener ugc nofollow" target="_blank"/></li><li id="33f0" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oc ly lz ma bi translated"><a class="ae kv" href="https://book.anchor-lang.com/prerequisites/intro_to_solana.html" rel="noopener ugc nofollow" target="_blank">索拉纳简介</a></li></ul></div></div>    
</body>
</html>