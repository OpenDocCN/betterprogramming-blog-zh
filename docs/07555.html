<html>
<head>
<title>How To Authenticate Your Spring Boot Application With Keycloak</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Keycloak验证您的Spring Boot应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-authenticate-your-spring-boot-application-with-keycloak-1e9ccb5f2478?source=collection_archive---------1-----------------------#2021-01-27">https://betterprogramming.pub/how-to-authenticate-your-spring-boot-application-with-keycloak-1e9ccb5f2478?source=collection_archive---------1-----------------------#2021-01-27</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="6b0e" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">关于设置Keycloak以保护Spring Boot应用程序的详细演练</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/93a447b3da45e01d046fc4236c8bcc91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N4LLKCOLD1LXXBOi"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@alejandroescamilla?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亚历杭德罗·埃斯卡米拉</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="b9f7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://www.keycloak.org/about" rel="noopener ugc nofollow" target="_blank"> Keycloak </a>是由RedHat社区开发的开源产品，为现代应用程序提供身份和访问管理解决方案。它几乎不需要任何代码来保护您的应用程序和服务。</p><p id="401b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您将从本教程中学到什么:</p><ul class=""><li id="42a7" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">Keycloak的主要概念和优势</li><li id="4865" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">如何使用Keycloak保护Spring Boot应用程序</li></ul><p id="2c33" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我计划创建本教程的第二部分，其中我们将介绍Spring Security和第三方社交媒体身份提供商，如Google、GitHub等。</p><p id="2b6a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们开始吧！</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="5096" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">钥匙锁概述</h1><p id="b818" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">Keycloak的主要好处是它提供了一个<strong class="lc iv">单点登录</strong> ( <strong class="lc iv"> SSO </strong>)，这使得用户更容易访问不同的应用程序。对于用户和开发人员来说，这都是一种友好的方法。</p><p id="d798" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">作为开发人员，您不必担心实现登录表单或在数据库中存储凭据。作为用户，您不必记住登录每个应用程序的各种密码。</p><p id="4cbf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">同样的方法也适用于<strong class="lc iv">单点登录</strong>。如果您注销Keycloak，您将注销所有正在使用它的应用程序。</p><p id="81bf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">另一个很好的功能是，你可以添加一个身份提供商，如脸书，谷歌，GitHub等。无需任何代码更改。</p><p id="f971" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您还可以使用现有的OpenID Connect或SAML 2.0身份提供者进行身份验证。</p><p id="2847" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">用户管理是通过管理控制台进行的。您可以管理各种东西，如角色、会话、cookies等。</p><p id="6d3b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">用户可以通过帐户管理控制台管理自己的帐户设置。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="362f" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">设置键盘锁</h1><p id="fc08" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">现在您已经熟悉了Keycloak的优点，让我们来设置服务器。</p><p id="d6c6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有不同的开始方式。最快的方法是拉一个Docker图像。</p><p id="7c18" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们需要通过提供一个端口号来启动服务器。我们还需要用户名和密码才能登录到管理控制台。</p><p id="5d25" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我更喜欢创建一个<code class="fe no np nq nr b">docker-compose.yaml</code>文件，因为将来启动服务器会更容易。流程如下:</p><pre class="kk kl km kn gu ns nr nt nu aw nv bi"><span id="7361" class="nw ms iu nr b gz nx ny l nz oa">version: "3.2"<br/>services:<br/>  keycloak:<br/>    image: jboss/keycloak:12.0.2<br/>    ports:<br/>      - "9900:8080"<br/>    environment:<br/>    - KEYCLOAK_USER=admin<br/>    - KEYCLOAK_PASSWORD=admin123</span></pre><p id="37ae" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过在终端中执行以下docker命令来启动服务器:</p><pre class="kk kl km kn gu ns nr nt nu aw nv bi"><span id="c6ee" class="nw ms iu nr b gz nx ny l nz oa">docker-compose up</span></pre><p id="d5b7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一旦容器启动，在<code class="fe no np nq nr b"><a class="ae kz" href="http://localhost:8080/auth/" rel="noopener ugc nofollow" target="_blank">http://localhost:9900/auth/</a></code>上打开浏览器并选择管理控制台。在<code class="fe no np nq nr b">environment </code>部分输入您刚刚提供的凭证。</p><h2 id="f3a0" class="nw ms iu bd mt ob oc dn mx od oe dp nb lj of og nd ln oh oi nf lr oj ok nh ol bi translated">创建一个领域</h2><p id="5a73" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">一个领域管理一组用户、凭据、角色和组。您在领域中创建的用户属于该领域。因此，当他们登录到Keycloak时，他们登录到指定的领域。</p><p id="480d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">默认情况下，你现在应该看到默认的<strong class="lc iv">主</strong>领域。</p><ol class=""><li id="1519" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv om mc md me bi translated">点击左上角并选择<strong class="lc iv">添加领域</strong>。</li><li id="c85f" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">将其命名为<code class="fe no np nq nr b">keycloak-demo </code>，点击<strong class="lc iv">创建</strong>。</li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/0904fcb8b4d76f7bc848c46f7d44a735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_qh1Iag96nvGfP3mdD1yog.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">创造一个新领域</p></figure><h2 id="9cd5" class="nw ms iu bd mt ob oc dn mx od oe dp nb lj of og nd ln oh oi nf lr oj ok nh ol bi translated">创建客户端</h2><p id="d515" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">通常，客户端是希望使用Keycloak进行身份验证的应用程序和服务。在我们的例子中，它将是我们即将创建的Spring Boot应用程序。</p><p id="7e49" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们为我们的新领域添加一个客户端。</p><ol class=""><li id="7d52" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv om mc md me bi translated">点击<strong class="lc iv">客户端</strong>菜单项。</li><li id="2767" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">从右上角选择<strong class="lc iv">创建</strong>。</li><li id="26e2" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">称之为<code class="fe no np nq nr b">keycloak-app</code> <em class="oo">。</em></li><li id="9be7" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">拯救客户。</li><li id="e802" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">点击<strong class="lc iv">设置</strong>选项卡。填写<strong class="lc iv">有效重定向URL </strong>的字段。我们的Spring Boot应用将在<code class="fe no np nq nr b"><a class="ae kz" href="http://localhost:8090." rel="noopener ugc nofollow" target="_blank">http://localhost:8090</a></code> <a class="ae kz" href="http://localhost:8090." rel="noopener ugc nofollow" target="_blank">上运行。</a>那么，我们进入<code class="fe no np nq nr b"><a class="ae kz" href="http://localhost:8090." rel="noopener ugc nofollow" target="_blank">http://localhost:8090</a>/*</code>。</li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/c191f25324f5f9bef9854b3c6d8488e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJH7qzrpEWUppNfa9xr0ag.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">创建新的客户端设置</p></figure><h2 id="9e2e" class="nw ms iu bd mt ob oc dn mx od oe dp nb lj of og nd ln oh oi nf lr oj ok nh ol bi translated">创建一个角色</h2><p id="2ce2" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">目前，Keycloak中有三种类型的角色:</p><ul class=""><li id="7fbc" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">领域角色—它们更像是特定于该领域的全局角色。</li><li id="46e0" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">客户角色——每个客户都有特定的角色。</li><li id="bfd8" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">复合角色——顾名思义，它们是与多个角色相关联的角色。</li></ul><p id="e3cc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的示例中，让我们创建一个专用于Spring Boot应用程序的客户端角色:</p><ol class=""><li id="15e0" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv om mc md me bi translated">从<strong class="lc iv">客户端</strong>菜单项中选择<code class="fe no np nq nr b">keycloack-app</code>客户端。</li><li id="4d50" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">点击<strong class="lc iv">角色</strong>标签。</li><li id="879f" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">点击<strong class="lc iv">添加角色。</strong></li><li id="a0c9" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">创建一个名为<code class="fe no np nq nr b">visitor </code>的新角色并保存。</li><li id="5e11" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">创建另一个名为<code class="fe no np nq nr b">admin </code>的文件并保存。</li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/3336f93c2b72e1ae3c15341f83515620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uLCkbPYjiz9Dg2mgKQbF1w.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">为访问者添加新角色</p></figure><p id="d8ec" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要验证角色是否已成功创建，请单击<code class="fe no np nq nr b">keycloak-app</code>客户端，然后单击<strong class="lc iv">角色</strong>选项卡，并选择<strong class="lc iv">查看所有角色</strong>:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/1f5e3ff0155ec9a2b496f8900cfa0587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0zoqk9cOpKCSYwPjNTg1wg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">客户角色</p></figure><h2 id="491a" class="nw ms iu bd mt ob oc dn mx od oe dp nb lj of og nd ln oh oi nf lr oj ok nh ol bi translated">创建用户</h2><p id="4372" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">现在，我们需要为用户分配我们刚刚创建的角色。</p><ol class=""><li id="9aee" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv om mc md me bi translated">点击<strong class="lc iv">用户</strong>菜单项。</li><li id="07a8" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">选择<strong class="lc iv">添加用户</strong>。</li><li id="2c07" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">创建一个名为<code class="fe no np nq nr b">user </code>的用户<em class="oo"> </em>并保存。</li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/a6a260a525c68e0977cc222ea71414f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qVcoDoMYoTaaLszDqwXvsQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">添加新用户</p></figure><p id="06ee" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">4.添加另一个名为<code class="fe no np nq nr b">admin</code> <em class="oo">的用户。</em></p><p id="2db9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">5.为了演示权限是如何工作的，让我们为用户分配不同的角色。对于<code class="fe no np nq nr b">user</code>，请转到<code class="fe no np nq nr b">Role Mappings</code>选项卡。从<strong class="lc iv">客户角色</strong>下拉菜单中，选择<code class="fe no np nq nr b">keycloak-app</code>并分配<code class="fe no np nq nr b">visitor</code>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/48a9c45e64f3dddef0a88cf5060bf9a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6yRSdtiXHfqnRy0W2tMheA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">用户客户端角色</p></figure><p id="c3a0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于<code class="fe no np nq nr b">admin</code>，同时选择<code class="fe no np nq nr b">visitor </code>和<code class="fe no np nq nr b">admin </code>角色。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/c40ed56f299e59bc20a5df515c54b10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ru00doDGkOwePpQG131BPQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">管理客户端角色</p></figure><p id="4255" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">6.要登录该应用程序，用户需要密码。转到<strong class="lc iv">凭证</strong>选项卡并设置密码。为避免用户在首次登录后更改密码，关闭<strong class="lc iv">临时</strong>选项。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="4c25" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">创建Spring Boot应用程序</h1><p id="346c" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">我们将创建一个非常简单的应用程序，根据用户的角色向用户显示自定义文本。在我们的例子中，我们将区分<code class="fe no np nq nr b">visitors </code>和<code class="fe no np nq nr b">admins</code>。</p><p id="cc98" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我在利用格雷尔来建立这个项目。在您喜欢的IDE中创建一个新的Gradle项目。</p><h2 id="dbf6" class="nw ms iu bd mt ob oc dn mx od oe dp nb lj of og nd ln oh oi nf lr oj ok nh ol bi translated">获取依赖关系</h2><p id="4130" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">打开<code class="fe no np nq nr b">build.gradle</code>文件并添加以下依赖项:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="op oq l"/></div></figure><p id="62de" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，Keycloak的依赖项包括必要的Keycloak客户端适配器。</p><h2 id="34f9" class="nw ms iu bd mt ob oc dn mx od oe dp nb lj of og nd ln oh oi nf lr oj ok nh ol bi translated">创建控制器</h2><ol class=""><li id="d81d" class="lw lx iu lc b ld nj lg nk lj or ln os lr ot lv om mc md me bi translated">创建一个新的包，例如<code class="fe no np nq nr b">boot</code>。</li><li id="1aac" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">创建一个名为<code class="fe no np nq nr b">Controller</code>的新Java类，如下所示:</li></ol><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="op oq l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Spring Boot属地</p></figure><p id="e84d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这是一个非常简单的控制器，它定义了当你调用选择的URL路径时显示什么消息。</p><h2 id="6d06" class="nw ms iu bd mt ob oc dn mx od oe dp nb lj of og nd ln oh oi nf lr oj ok nh ol bi translated">创建主应用程序</h2><p id="f249" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">创建一个名为<code class="fe no np nq nr b">App.java</code>的新类，如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="op oq l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">主应用程序类</p></figure><p id="d192" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个类将启动我们的应用程序。</p><h2 id="23a8" class="nw ms iu bd mt ob oc dn mx od oe dp nb lj of og nd ln oh oi nf lr oj ok nh ol bi translated">配置键盘锁</h2><p id="3d83" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">为了集成Keycloak身份验证，我们需要定义一些设置。</p><ol class=""><li id="f145" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv om mc md me bi translated">在<code class="fe no np nq nr b">resources</code>文件夹下创建一个<code class="fe no np nq nr b">application.properties</code>文件。</li><li id="4bcd" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv om mc md me bi translated">请记住，我们已经在Keycloak的管理控制台中将<strong class="lc iv"> 8090 </strong>定义为有效的重定向URL的端口。Spring Boot默认运行在<strong class="lc iv"> 8080 </strong>。要覆盖此行为，请如下定义<code class="fe no np nq nr b">server.port</code>属性:</li></ol><pre class="kk kl km kn gu ns nr nt nu aw nv bi"><span id="8d0c" class="nw ms iu nr b gz nx ny l nz oa">server.port=8090</span></pre><p id="447d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">3.通过定义以下属性来添加钥匙锁的设置:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="op oq l"/></div></figure><p id="9763" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您会看到ream属性与我们领域的名称相匹配，而资源与我们客户端的名称相同。通过将<code class="fe no np nq nr b">keycloak.use-resource-role-mapping</code>设置为true，我们告诉我们的应用程序使用客户端角色进行操作。</p><p id="5904" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">4.添加安全约束，如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="op oq l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">认证配置</p></figure><p id="9a68" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这意味着只有角色为<code class="fe no np nq nr b">admin </code>的用户才能访问<code class="fe no np nq nr b">visitor </code>和<code class="fe no np nq nr b">admin </code>路径。具有<code class="fe no np nq nr b">visitor </code>角色的用户将仅被允许查看<code class="fe no np nq nr b">visitor </code>路径。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="ee6c" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">测试应用程序</h1><p id="5a1b" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">通过在终端中执行以下命令来启动应用程序:</p><pre class="kk kl km kn gu ns nr nt nu aw nv bi"><span id="232e" class="nw ms iu nr b gz nx ny l nz oa">gradle bootRun</span></pre><p id="ab09" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">或者，在IDE中右键单击<code class="fe no np nq nr b">App.java</code>并选择<strong class="lc iv">运行App.main() </strong>。</p><p id="cf30" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在浏览器中输入<code class="fe no np nq nr b">localhost:8090/visitor</code>。</p><p id="4fc2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">系统会提示您输入凭据。输入<code class="fe no np nq nr b">user</code>的用户名和密码。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ou"><img src="../Images/6af49a43d7ebbeda4c1b3e4b7310454d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4PmeGWnTnKeBZMTtyr5WfA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">以用户身份登录</p></figure><p id="dc54" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您应该会看到以下消息:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ov"><img src="../Images/349e3638c1010ab205585a4c17eae337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZX2NMjgnwGc4XCb861oyDw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作为访问者成功登录</p></figure><p id="930e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">尝试访问<code class="fe no np nq nr b">localhost:8090/admin</code>:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ov"><img src="../Images/1b92658b8f9210a96a6dc1e849b2a0ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RB11nJtlUz3G5E7Biw6tqQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">禁止作为访问者的管理路径</p></figure><p id="eedd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要管理当前用户的会话，请返回到Keycloak的管理控制台，然后单击<strong class="lc iv">会话</strong>选项卡。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/4405c2b2ce6684e77520d134018576aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Ji1-pqP18oyxNioXPNTAA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">登录的用户会话</p></figure><p id="852c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">点击<strong class="lc iv">全部注销</strong>可以强制注销。</p><p id="86b4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，您可能需要重新启动Spring Boot应用程序，因为浏览器会存储当前会话。否则，您可以使用新的浏览器窗口。</p><p id="469e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，让我们以<code class="fe no np nq nr b">admin</code>的身份登录。加载<code class="fe no np nq nr b">localhost:8090/admin</code> URL并输入<code class="fe no np nq nr b">admin </code>用户的凭证。</p><p id="a8d0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您应该会看到这个页面:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ov"><img src="../Images/b6b3154296e38668142d66393408f77a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*joIaZuJZlScPA9HukEpSHg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">以管理员身份成功登录</p></figure><p id="eb6d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在让我们尝试访问<code class="fe no np nq nr b">visitor </code>路径:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ov"><img src="../Images/349e3638c1010ab205585a4c17eae337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZX2NMjgnwGc4XCb861oyDw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">以管理员身份成功访问访问者路径</p></figure><p id="e840" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">完美！该应用程序运行正常。</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="7167" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">结论</h1><p id="3b3a" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">恭喜你，你已经完成了本教程的学习！现在，你应该能够理解基本的Keycloak的概念，并知道如何认证一个Spring Boot应用程序。</p><p id="332c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本教程的第二部分，您将看到如何将Keycloack与Spring Security集成，并添加GitHub作为社交媒体身份提供者。</p><p id="298c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望这篇文章对你有用。</p><p id="21af" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">感谢阅读，敬请期待下一部分！</p></div><div class="ab cl mk ml hy mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="in io ip iq ir"><h1 id="b6f3" class="mr ms iu bd mt mu mv mw mx my mz na nb ka nc kb nd kd ne ke nf kg ng kh nh ni bi translated">参考</h1><ul class=""><li id="57d9" class="lw lx iu lc b ld nj lg nk lj or ln os lr ot lv mb mc md me bi translated"><a class="ae kz" href="https://www.keycloak.org/about" rel="noopener ugc nofollow" target="_blank">https://www.keycloak.org/about</a></li><li id="606a" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><a class="ae kz" href="https://hub.docker.com/r/jboss/keycloak/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/r/jboss/keycloak/</a></li></ul></div></div>    
</body>
</html>