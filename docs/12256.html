<html>
<head>
<title>Working With Three.js: The Popular 3D JavaScript Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Three.js:流行的3D JavaScript库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/working-with-three-js-the-popular-3d-javascript-library-bd2e9b03c95a?source=collection_archive---------4-----------------------#2022-05-23">https://betterprogramming.pub/working-with-three-js-the-popular-3d-javascript-library-bd2e9b03c95a?source=collection_archive---------4-----------------------#2022-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a239" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索Create React应用程序工作环境中的three.js</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/5e3ed86679ab07b75549c102be96f8f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*8S4XX5CkZPJvx1z076ToSw.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="8da8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/mrdoob/three.js/" rel="noopener ugc nofollow" target="_blank"> Three.js </a>是一个3D JavaScript库，在网页上渲染3D内容。这是一个开源项目，旨在创建一个易于使用、轻量级、跨浏览器、通用的3D库。</p><p id="a1f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当前版本包括一个<a class="ae lq" href="https://webglfundamentals.org/" rel="noopener ugc nofollow" target="_blank"> WebGL(网络图形库)</a>渲染器和一个JavaScript API，用于在任何兼容的网络浏览器中渲染交互式2D和3D图形，无需插件。现代浏览器广泛支持WebGL。</p><p id="0e26" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">WebGL它是一个绘制点、线和三角形的低级API。要用WebGL做任何有用的事情，需要相当多的代码，这就是three.js的用武之地。它处理高级功能，如场景、灯光、阴影、材质、纹理、3D数学等。</p><p id="6f50" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Three.js还支持其他渲染器，如WebGPU、SVG和CSS3D。<a class="ae lq" href="https://threejs.org/examples/" rel="noopener ugc nofollow" target="_blank">官方举例</a>展示高级用法。</p><p id="4f78" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于这是我们关于three.js的第一篇文章，我们将快速了解一下它是什么以及如何使用它。</p><h1 id="66e5" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">官方动画立方体代码</h1><p id="7a60" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">上面的标题图像是由官方动画立方体代码渲染的，列在三人的<code class="fe mo mp mq mr b">README</code>文件中。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="0b46" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们解释一下它是如何工作的。</p><p id="bfe3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在官方代码行1，<code class="fe mo mp mq mr b">THREE</code>被导入。</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="054b" class="my ls it mr b gy mz na l nb nc">import * as THREE from 'three';</span></pre><p id="b07b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在官方代码的第4行，一个<code class="fe mo mp mq mr b">PerspectiveCamera</code>被实例化。</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="a853" class="my ls it mr b gy mz na l nb nc">const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 10);</span></pre><p id="ad53" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">PerspectiveCamera</code>构造函数有四个参数，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="c7d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个例子中，<code class="fe mo mp mq mr b">fov</code>(视野)在垂直维度上被设置为70度，<code class="fe mo mp mq mr b">aspect</code>被设置为DOM <code class="fe mo mp mq mr b">window</code>的纵横比(<code class="fe mo mp mq mr b">window.innerWidth / window.innerHeight</code>)。<code class="fe mo mp mq mr b">near</code>和<code class="fe mo mp mq mr b">far</code>代表将要渲染的摄像机前面的空间。</p><p id="9099" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">near</code>之前或<code class="fe mo mp mq mr b">far</code>之后的任何内容都将被剪切。范围被设置为相机前面的<code class="fe mo mp mq mr b">[0.01, 10]</code>。平截头体是一种三维形状，类似于顶端被切掉的金字塔。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/54684423d494fa8ee0ab6d11360f822a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A_XpuNbk2-OW2FGYJr5vOw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">《平截头体》，抄袭自<a class="ae lq" href="https://threejs.org/manual/#en/fundamentals" rel="noopener ugc nofollow" target="_blank">https://threejs.org/manual/#en/fundamentals</a></p></figure><p id="bc90" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在官方代码第5行，<code class="fe mo mp mq mr b">camera.position</code>是3D矢量。</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="3174" class="my ls it mr b gy mz na l nb nc">camera.position.z = 2;</span></pre><p id="d424" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">摄像机位于<code class="fe mo mp mq mr b">[0, 0, 2]</code>。<code class="fe mo mp mq mr b">+Y</code>和<code class="fe mo mp mq mr b">-Y</code>轴在绿色方块的中间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi ni"><img src="../Images/d283eb9ab9c809b644812e35096a99fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sRR2MK8jPwOr61cxKh8N8w.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">摄像机位置，抄袭自<a class="ae lq" href="https://threejs.org/manual/#en/fundamentals" rel="noopener ugc nofollow" target="_blank">https://threejs.org/manual/#en/fundamentals</a></p></figure><p id="ad16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些是可用的摄像机类型:<code class="fe mo mp mq mr b">ArrayCamera</code>、<code class="fe mo mp mq mr b">Camera</code>、<code class="fe mo mp mq mr b">CubeCamera</code>、<code class="fe mo mp mq mr b">OrthographicCamera</code>、<code class="fe mo mp mq mr b">PerspectiveCamera</code>和<code class="fe mo mp mq mr b">StereoCamera</code>。</p><p id="8185" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在官方代码第7行，实例化了一个场景。</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="5b89" class="my ls it mr b gy mz na l nb nc">const scene = new THREE.Scene();</span></pre><p id="f70f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">场景是我们放置物体、灯光和摄像机的地方。这些是可用的场景类型:<code class="fe mo mp mq mr b">Fog</code>、<code class="fe mo mp mq mr b">FogExp2</code>和<code class="fe mo mp mq mr b">Scene</code>。</p><p id="34b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在官方代码行9，一个<code class="fe mo mp mq mr b">BoxGeometry</code>被实例化。</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="1f19" class="my ls it mr b gy mz na l nb nc">const geometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);</span></pre><p id="ae4f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">几何定义了物体的形状。<code class="fe mo mp mq mr b">BoxGeometry</code>定义了箱体尺寸<code class="fe mo mp mq mr b">width</code>、<code class="fe mo mp mq mr b">height</code>和<code class="fe mo mp mq mr b">depth</code>。在本例中，<code class="fe mo mp mq mr b">width</code>、<code class="fe mo mp mq mr b">height</code>和<code class="fe mo mp mq mr b">depth</code>被设置为<code class="fe mo mp mq mr b">0.2</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="c199" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">构造函数也可以沿着每条边定义分段的面。默认情况下，每条边都有一个分段面。每一面的细节越多，需要分割的面就越多。下面是<code class="fe mo mp mq mr b">4 x 5 x 10</code>的分割脸部示意图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nj"><img src="../Images/c6d9299f1872fd8d267ee6b63423c9ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFEjvpTco8Zcyunsr1_IJw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图像由<a class="ae lq" href="https://jsfiddle.net/prisoner849/8hqy99jj/" rel="noopener ugc nofollow" target="_blank">https://jsfiddle.net/prisoner849/8hqy99jj/</a>生成</p></figure><p id="500a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些是可用的几何图形类型:<code class="fe mo mp mq mr b">BoxGeometry</code>、<code class="fe mo mp mq mr b">CapsuleGeometry</code>、<code class="fe mo mp mq mr b">CircleGeometry</code>、<code class="fe mo mp mq mr b">ConeGeometry</code>、<code class="fe mo mp mq mr b">CylinderGeometry</code>、<code class="fe mo mp mq mr b">DodecahedronGeometry</code>、<code class="fe mo mp mq mr b">EdgesGeometry</code>、<code class="fe mo mp mq mr b">ExtrudeGeometry</code>、<code class="fe mo mp mq mr b">IcosahedronGeometry</code>、<code class="fe mo mp mq mr b">LatheGeometry</code>、<code class="fe mo mp mq mr b">OctahedronGeometry</code>、<code class="fe mo mp mq mr b">PlaneGeometry</code>、<code class="fe mo mp mq mr b">PolyhedronGeometry</code>、<code class="fe mo mp mq mr b">RingGeometry</code>、<code class="fe mo mp mq mr b">ShapeGeometry</code>、<code class="fe mo mp mq mr b">SphereGeometry</code>、<code class="fe mo mp mq mr b">TetrahedronGeometry</code>、<code class="fe mo mp mq mr b">TorusGeometry</code>、<code class="fe mo mp mq mr b">TorusKnotGeometry</code>、<code class="fe mo mp mq mr b">TubeGeometry</code>和<code class="fe mo mp mq mr b">WireframeGeometry</code>。</p><p id="6125" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在官方代码的第10行，一个<code class="fe mo mp mq mr b">MeshNormalMaterial</code>用默认参数进行了实例化。</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="1cb6" class="my ls it mr b gy mz na l nb nc">const material = new THREE.MeshNormalMaterial();</span></pre><p id="5d03" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">材质决定了物体的外观——光泽、平面、颜色、纹理等。—它采用以下参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="479b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">MeshNormalMaterial</code>有附加参数，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="7e07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些是可用的物料类型:<code class="fe mo mp mq mr b">ShadowMaterial</code>、<code class="fe mo mp mq mr b">SpriteMaterial</code>、<code class="fe mo mp mq mr b">RawShaderMaterial</code>、<code class="fe mo mp mq mr b">ShaderMaterial</code>、<code class="fe mo mp mq mr b">PointsMaterial</code>、<code class="fe mo mp mq mr b">MeshPhysicalMaterial</code>、<code class="fe mo mp mq mr b">MeshStandardMaterial</code>、<code class="fe mo mp mq mr b">MeshPhongMaterial</code>、<code class="fe mo mp mq mr b">MeshToonMaterial</code>、<code class="fe mo mp mq mr b">MeshNormalMaterial</code>、<code class="fe mo mp mq mr b">MeshLambertMaterial</code>、<code class="fe mo mp mq mr b">MeshDepthMaterial</code>、<code class="fe mo mp mq mr b">MeshDistanceMaterial</code>、<code class="fe mo mp mq mr b">MeshBasicMaterial</code>、<code class="fe mo mp mq mr b">MeshMatcapMaterial</code>、<code class="fe mo mp mq mr b">LineDashedMaterial</code>、<code class="fe mo mp mq mr b">LineBasicMaterial</code>和<code class="fe mo mp mq mr b">Material</code>。</p><p id="3d21" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在官方代码行12，用特定的<code class="fe mo mp mq mr b">geometry</code>和<code class="fe mo mp mq mr b">material</code>实例化一个<code class="fe mo mp mq mr b">Mesh</code>。在下一行，它被添加到一个场景中。</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="37a7" class="my ls it mr b gy mz na l nb nc">const mesh = new THREE.Mesh(geometry, material);<br/>scene.add(mesh);</span></pre><p id="8d94" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">网格是构成3D对象图形的骨架。它由几何体(形状)、材质(表面)和场景(位置)定义。</p><p id="e61f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在官方代码行15–18，一个WebGL渲染被实例化。它被设置为DOM <code class="fe mo mp mq mr b">window</code>大小，配置了一个动画循环，它的<code class="fe mo mp mq mr b">domElement</code>被附加到DOM <code class="fe mo mp mq mr b">body</code>中。</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="2778" class="my ls it mr b gy mz na l nb nc">const renderer = new THREE.WebGLRenderer({ antialias: true });<br/>renderer.setSize(window.innerWidth, window.innerHeight);<br/>renderer.setAnimationLoop(animation);<br/>document.body.appendChild(renderer.domElement);</span></pre><p id="8796" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在官方代码行21–26，定义了一个动画函数。</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="6217" class="my ls it mr b gy mz na l nb nc">function animation(time) {  <br/>  mesh.rotation.x = time / 2000;   <br/>  mesh.rotation.y = time / 1000;   <br/>  renderer.render(scene, camera);<br/>}</span></pre><p id="60c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">参数<code class="fe mo mp mq mr b">time</code>是从调用<code class="fe mo mp mq mr b">renderer.setAnimationLoop(animation)</code>开始的时间。时间的单位是毫秒。由于每轴转一圈需要2π，所以上述动画函数绕x轴转一圈大约需要12.56秒，绕y轴转一圈大约需要6.28秒。</p><p id="8c82" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">renderer.setAnimationLoop(animation)</code>是开始动画的请求。如果<code class="fe mo mp mq mr b">animation</code>是<code class="fe mo mp mq mr b">null</code>，它将停止任何已经在进行的动画。<code class="fe mo mp mq mr b">setAnimationLoop</code>是<code class="fe mo mp mq mr b">requestAnimationFrame</code>的替代。</p><p id="4441" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">renderer.render(scene, camera)</code>重新渲染更新后的数据。</p><p id="a455" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是three.js在JavaScript中的工作方式。</p><h1 id="b9ef" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">在Create React App中设置Three.js</h1><p id="0b5f" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我们使用<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/an-in-depth-guide-for-create-react-app-5-cra-5-b94b03c233f2"> Create React App </a>来看看three.js在React中是如何工作的。以下命令创建一个React项目:</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="8608" class="my ls it mr b gy mz na l nb nc">% npx create-react-app react-three<br/>% cd react-three</span></pre><p id="6dba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">设置<code class="fe mo mp mq mr b">three.js</code>:</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="c76a" class="my ls it mr b gy mz na l nb nc">% npm i three</span></pre><p id="fbd9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">three</code>成为<code class="fe mo mp mq mr b">package.json</code>中<code class="fe mo mp mq mr b"><a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/package-jsons-dependencies-in-depth-a1f0637a3129">dependencies</a></code>的一部分:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="cb6b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它可以在Create React应用程序中使用。</p><p id="6700" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用以下代码替换<code class="fe mo mp mq mr b">src/App.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="acbf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它几乎与官方代码相同，除了几件事:</p><ul class=""><li id="fdbd" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">初始化代码被包装在<code class="fe mo mp mq mr b">useEffect</code>(第7–32行)中，它被初始化一次(第32行<code class="fe mo mp mq mr b">useEffect</code>的依赖列表被设置为空数组，<code class="fe mo mp mq mr b">[]</code>)。</li><li id="4fad" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">相反，<code class="fe mo mp mq mr b">renderer.domElement</code>被附加到<code class="fe mo mp mq mr b">document.body</code>，它被附加到<code class="fe mo mp mq mr b">divRef.current</code>(第34行的<code class="fe mo mp mq mr b">div</code>元素的可变引用对象)。</li></ul><p id="dd64" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过<code class="fe mo mp mq mr b">npm start</code>执行代码，我们看到动画立方体在浏览器中旋转。</p><p id="771f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">代码中有许多可以改进的地方:</p><ul class=""><li id="26ff" class="nk nl it kw b kx ky la lb ld nm lh nn ll no lp np nq nr ns bi translated">我们不应该依赖于DOM窗口的大小，因为我们可以在一个组件上实现three.js。</li><li id="0d28" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">当浏览器调整大小时，应用程序不会调整大小。</li><li id="3517" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">与大多数JavaScript库不同，three.js不会自动清理资源。它依靠浏览器在用户离开页面时进行清理。最佳实践是在不再使用对象时释放内存。</li></ul><p id="e550" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是改进后的<code class="fe mo mp mq mr b">src/app.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="e777" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第59行，<code class="fe mo mp mq mr b">div</code>元素的<code class="fe mo mp mq mr b">height</code>被设置为视窗高度的100%。</p><p id="33c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第9–10行，我们将<code class="fe mo mp mq mr b">div</code>元素的<code class="fe mo mp mq mr b">width</code>和<code class="fe mo mp mq mr b">height</code>保存到变量中，以便在第11和23行重用。</p><p id="4a71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第26行，<code class="fe mo mp mq mr b">divRef.current</code>被保存到<code class="fe mo mp mq mr b">divCurrent</code>。这允许在第27行添加到<code class="fe mo mp mq mr b">divCurrent</code>的子元素在第52行被移除。</p><p id="e7f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第29行，事件监听器用回调函数<code class="fe mo mp mq mr b">handleResize</code>监听<code class="fe mo mp mq mr b">resize</code>事件。</p><p id="d904" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第32–39行，<code class="fe mo mp mq mr b">handleResize</code>函数检索新的<code class="fe mo mp mq mr b">width</code>和<code class="fe mo mp mq mr b">height</code>，并使用它们更新<code class="fe mo mp mq mr b">render</code>和<code class="fe mo mp mq mr b">camera</code>。在第38行，<code class="fe mo mp mq mr b">renderer.render(scene, camera)</code>重新呈现更新后的数据。</p><p id="ba07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第49–56行，返回清理函数来停止动画，删除窗口监听器，并释放three的资源。</p><p id="defa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个更高效的three.js代码。</p><h1 id="88bf" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">在创建React应用程序时使用React-Three-Fiber</h1><p id="b3aa" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated"><a class="ae lq" href="https://github.com/pmndrs/react-three-fiber" rel="noopener ugc nofollow" target="_blank"> react-three-fiber </a>是three.js的react渲染器，它允许我们使用JSX编写three.js，这样更具有声明性。在three.js中起作用的一切都会毫无例外地在react-three-fiber中继续起作用。</p><p id="1a2d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">没有额外的开销，因为JSX元素被转换为三的对象。例如，<code class="fe mo mp mq mr b">&lt;mesh /&gt;</code>转换为<code class="fe mo mp mq mr b">new THREE.Mesh()</code>。</p><p id="5721" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装软件包，<code class="fe mo mp mq mr b">@react-three/fiber</code>:</p><pre class="kj kk kl km gt mu mr mv mw aw mx bi"><span id="4d1f" class="my ls it mr b gy mz na l nb nc">% npm i @react-three/fiber</span></pre><p id="55a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">@react-three/fiber</code>成为<code class="fe mo mp mq mr b">package.json</code>的另一个属地:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="659b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了react-three-fiber，<code class="fe mo mp mq mr b">src/App.js</code>更凝聚，看起来更有反应。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="98e5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第4–18行，定义了<code class="fe mo mp mq mr b">Box</code>组件。它为<code class="fe mo mp mq mr b">mesh</code>元素定义了<code class="fe mo mp mq mr b">meshRef</code>，该元素由钩子<code class="fe mo mp mq mr b">useFrame</code>在第6–11行使用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="3879" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">useFrame</code>为每一帧调用。参数<code class="fe mo mp mq mr b">state</code>包含所有三者的状态信息，包括<code class="fe mo mp mq mr b">gl</code>(web GL)<code class="fe mo mp mq mr b">camera</code>、<code class="fe mo mp mq mr b">clock</code>、<code class="fe mo mp mq mr b">scene</code>等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi ny"><img src="../Images/b06f4e9018f39355de93c8ac89d3192d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kuoZw5l3PpTT9_JnF_pu5w.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="08ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">参数<code class="fe mo mp mq mr b">delta</code>是以秒为单位的时钟增量。它用于在第8–9行设置动画。</p><p id="a584" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">renderPriority</code>是完全关闭自动渲染的高级参数。</p><p id="f03e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在react-three-fiber中，<code class="fe mo mp mq mr b">mesh</code>与object three的对象一起，成为全局组件。我们创建了包含<code class="fe mo mp mq mr b">boxGeometry</code>和<code class="fe mo mp mq mr b">meshNormalMaterial</code>的<code class="fe mo mp mq mr b">mesh</code>元素(第13-16行)。</p><p id="d4a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">Box</code>元素放置在第22-27行定义的<code class="fe mo mp mq mr b">Canvas</code>中。</p><p id="8cef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mo mp mq mr b">Canvas</code>是three.js的入口，呈现three的组件。画布的道具有<code class="fe mo mp mq mr b">gl</code>(web GL)<code class="fe mo mp mq mr b">camera</code><code class="fe mo mp mq mr b">raycaster</code>等。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="4e82" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第23行，<code class="fe mo mp mq mr b">camera</code>的道具被定义为<code class="fe mo mp mq mr b">{ fov: 70, near: 0.01, far: 100, position: [0, 0, 2] }</code>。</p><p id="67be" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第24行，<code class="fe mo mp mq mr b">style</code>被定义为<code class="fe mo mp mq mr b">{ height: '100vh', backgroundColor: ‘black’ }</code>。对于宽度，<code class="fe mo mp mq mr b">Canvas</code>自动拉伸到100%。</p><p id="67c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这种缩短的代码和其他代码一样好用。</p><p id="e41a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你有没有注意到我们不叫<code class="fe mo mp mq mr b">object.dispose()</code>？</p><p id="6141" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">React知道对象的生命周期，react-three-fiber将试图通过调用<code class="fe mo mp mq mr b">object.dispose()</code>来释放资源，如果存在的话，在所有卸载的对象上。可以通过将<code class="fe mo mp mq mr b">dispose={null}</code>放置在网格、材质等上，甚至是像组这样的父容器上来关闭dispose尝试。</p><h1 id="b89c" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">结论</h1><p id="3b81" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我们已经解释了三的官方动画立方体代码。它一直在Create React App工作环境内运行，带有<code class="fe mo mp mq mr b">three</code>包，或者说<code class="fe mo mp mq mr b">@react-three/fiber</code>包。</p><p id="92db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你的偏好是什么？</p><p id="5d41" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/5-steps-to-render-d3-js-with-react-functional-components-fcce6cec1411">D3文章</a>中提到过，它是React和D3代码之间的平衡。同样是React和three.js代码的平衡。</p><p id="6641" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。我希望这有所帮助。如果你有兴趣，可以在three.js 中阅读关于<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/working-with-3d-model-in-three-js-e228621141af">的3D模型，或者查看</a><a class="ae lq" href="https://jenniferfubook.medium.com/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener">我的其他媒体文章</a>。</p><h1 id="d65c" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">附录</h1><p id="3f9f" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我们已经用不同风格的代码编写了几次动画立方体程序。它在浏览器中不断旋转。</p><p id="521b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们如何制作一个捕捉动作的动画gif？</p><p id="afdd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们用视频捕捉动画，然后用<a class="ae lq" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">https://giphy.com/</a>将短片转换成动画gif。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nz"><img src="../Images/39c942f364570e573f26cea5f5442d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-6_VCl3IFwGDahdQG8jR8w.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure></div></div>    
</body>
</html>