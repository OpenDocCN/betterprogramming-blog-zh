<html>
<head>
<title>Why You Should Add Environment Variables to Netlify Sites</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么应该向网络站点添加环境变量</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/why-you-should-add-environment-variables-to-netlify-sites-bae57012cc74?source=collection_archive---------5-----------------------#2020-04-03">https://betterprogramming.pub/why-you-should-add-environment-variables-to-netlify-sites-bae57012cc74?source=collection_archive---------5-----------------------#2020-04-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b4f2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">仅仅因为它是无服务器的并不意味着你在安全上妥协</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/eadb264d68057970cd593ec1a66d0b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*34KwcpvXQXb1kkOyS8xCQg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@pietrozj?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">皮埃特罗·詹</a>在<a class="ae kv" href="https://unsplash.com/s/photos/future?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="cf49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当创建一个项目时，通常有一些我们不想添加到我们的存储库中的秘密值。环境变量提供了一种简单的方法来将这些值排除在repo之外，同时仍然能够在我们的代码中使用它们。</p><p id="8349" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文简要解释了什么是环境变量，为什么它们可能对您有用，以及如何将它们添加到您的网络构建中。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9909" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">什么是环境变量？</h1><p id="d4e0" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先，我们需要理解什么是环境变量，以及为什么我们想要使用它们。如果你已经处于编程的初级水平，我肯定你以前听说过变量这个术语——它只是一个可以改变的值，并不总是保持不变。</p><p id="0eb7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">环境<strong class="ky ir"> </strong>变量是由构建发生的环境设置的。例如，如果您在本地计算机上的开发环境中进行构建，则该变量将与您在Netlify构建中为生产而构建的变量不同。</p><h2 id="3e95" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">改变行为</h2><p id="934e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">通过在不同的环境中拥有不同的价值，我们能够改变我们构建的行为。假设我们想要一些前端代码在开发中构建时查询<code class="fe ni nj nk nl b">localhost</code>，但是在生产中需要它使用一些其他的URL。通过用这些值设置一个环境变量，我们可以允许我们的程序改变请求的位置，从而改变它的行为。</p><h2 id="85de" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">让信息更加安全</h2><p id="1796" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">除了改变行为之外，环境变量还允许我们保持API密钥和其他敏感信息更加安全。我们可以将值存储为环境变量，供Netlify在构建时使用，而不是将值硬编码并上传到任何人都可以查看和使用的公共存储库中。</p><p id="afd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，请记住，虽然这些环境变量在您的repo中不可见，但它们仍然会被浏览器中的前端代码使用——它们不能从其他人的视图中完全删除。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0b2f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">向代码中添加环境变量</h1><p id="6915" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在我们已经了解了环境变量的能力，是时候看看如何将一些环境变量添加到我们的代码库中了。在这个例子中，我们将使用一个基本的React应用程序，但是这个例子背后的原理也适用于其他框架和语言。</p><h2 id="7f29" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">创建应用程序</h2><p id="ed7e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先，运行<code class="fe ni nj nk nl b">npx create-react-app react-dotenv</code>创建一个新的React应用程序。构建完成后，进入目录，用下面的代码替换<code class="fe ni nj nk nl b">App.js</code>中的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将此添加到App.js文件中</p></figure><p id="acee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文不会给出创建代码的一步一步的说明，但是我会强调环境变量的关键部分。</p><h2 id="6e74" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">添加变量</h2><p id="ec72" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">第八行的<code class="fe ni nj nk nl b">environment</code>常量从<code class="fe ni nj nk nl b">process.env.NODE_ENV</code>中获取值，以表示我们是处于生产环境还是开发环境中。我们可以在后面的代码中使用它来改变应用程序的行为。</p><p id="26a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第11行的<code class="fe ni nj nk nl b">secret</code>常量是我们将添加到环境变量文件中的一个值。创建一个名为<code class="fe ni nj nk nl b">.env.local</code>的新文件，并添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将它添加到. env.local</p></figure><p id="eb3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们要保密的环境变量。来自<code class="fe ni nj nk nl b">create-react-app</code>的默认<code class="fe ni nj nk nl b">.gitignore</code>文件会自动添加<code class="fe ni nj nk nl b">.env.local</code>，但是对于其他情况，请确保将存储变量的文件添加到<code class="fe ni nj nk nl b">.gitignore</code>。</p><h2 id="5783" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">检查网站</h2><p id="cbbc" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">添加这些文件后，运行<code class="fe ni nj nk nl b">npm start</code>来启动开发服务器。我们应该看到网站的Kitty版本，因为我们处于开发环境中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/3d69351e9fed1426987fa64e4b8e29fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PFKtMBBZcw978ePj3lIwIg.png"/></div></div></figure><p id="ec11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以从我们的<code class="fe ni nj nk nl b">.env.local</code>文件中看到秘密被记录到控制台。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/f3b2aa14c6bb9212595016244f3d7afb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*kvWSDeviPzvMjC33O5c1aQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">保持双手干净</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0fce" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">向Netlify添加环境变量</h1><p id="acb4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在我们的代码库已经准备好了，是时候把它上传到Github，把我们的repo连接到Netlify了。如果你以前从未向Github添加过代码，快速阅读一下这些指令<a class="ae kv" href="https://help.github.com/en/github/importing-your-projects-to-github/adding-an-existing-project-to-github-using-the-command-line" rel="noopener ugc nofollow" target="_blank">并在代码上线后继续。</a></p><h2 id="06ca" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">创建网络生活网站</h2><p id="8f21" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">一旦我们的回购启动并准备就绪，我们就可以登录Netlify并从Git创建一个新站点。我们将选择Github作为我们的主机，因为我们的代码就在那里。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/55adda842e65b40c84fa07466844b2a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Czd1PRzKYwpvXWqZ7BvRg.png"/></div></div></figure><p id="092b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将为我们提供一个存储库列表，我们可以通过搜索找到我们上传项目的存储库:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/15b719f06feaf0148514ca6127eef949.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IeQ9Hia4EZu29RO9WaY_AA.png"/></div></div></figure><p id="2526" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当选择我们的构建选项时，我们希望从master部署。React使用<code class="fe ni nj nk nl b">npm</code>进行部署构建，使用<code class="fe ni nj nk nl b">build/</code>进行发布，因此我们可以保留默认的构建命令。</p><h2 id="dc2e" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">添加变量</h2><p id="27da" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">最重要的部分是更改高级构建设置。点击“显示高级”打开这些设置，并添加一个与本地<code class="fe ni nj nk nl b">.env</code>文件同名的新变量(例如本例中的<code class="fe ni nj nk nl b">REACT_APP_SECRET</code>)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/cc312548ca365699b6739af6e3a56050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7DRDu7tbvpYEBaPhUhq5Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不要告诉任何人，但我真的知道</p></figure><p id="e90b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们的秘密已经被添加，我们可以点击页面底部的“部署网站”。给Netlify几分钟时间来构建所有的东西，然后前往您部署的站点来查看结果。</p><h2 id="1c9a" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">检查网站</h2><p id="6bce" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">因为我们现在在生产环境中，我们看到Doggo版本而不是Kitty版本，因为<code class="fe ni nj nk nl b">process.env.NODE_ENV</code>值现在变成了<code class="fe ni nj nk nl b">production</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/784bd4dd33ed88649f2fb742c9287c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xvvB23yldVjfwCHKBU7w-g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">多好的孩子啊</p></figure><p id="b79e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以看到，我们刚刚添加的环境变量正用于确定控制台的秘密日志记录。我们当地版本的秘密无处可寻。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/a6adc17b3c06bae1e6d0ba9d0c866486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*Jm01inHgksVeqC9AYJ4yag.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">又来了。不要告诉任何人。</p></figure><p id="2a5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">至此，我们已经成功地向Netlify添加了环境变量！当在浏览器中查看时，这个秘密仍然在前端可见，但是它没有存储在我们的存储库中的任何地方。不同的环境允许我们改变应用程序的行为。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="d28c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">环境变量在将API键和其他敏感数据排除在repos之外的过程中起着至关重要的作用。Netlify隐藏环境变量，并允许您在构建、无服务器功能和其他服务中使用它们。</p><p id="aba2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您很快就要开始一个新项目，或者想要回到以前的项目，使其更适合不同的环境，那么使用环境变量是一个不错的选择。Netlify帮你搞定了。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="559a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">资源</h1><ul class=""><li id="b861" class="nu nv iq ky b kz mr lc ms lf nw lj nx ln ny lr nz oa ob oc bi translated"><a class="ae kv" href="https://docs.netlify.com/configure-builds/environment-variables/#declare-variables" rel="noopener ugc nofollow" target="_blank"> Netlify文档</a></li><li id="ea7a" class="nu nv iq ky b kz od lc oe lf of lj og ln oh lr nz oa ob oc bi translated"><a class="ae kv" href="https://create-react-app.dev/docs/adding-custom-environment-variables/" rel="noopener ugc nofollow" target="_blank">创建-反应-应用文档</a></li><li id="326b" class="nu nv iq ky b kz od lc oe lf of lj og ln oh lr nz oa ob oc bi translated"><a class="ae kv" href="https://github.com/orangegrove1955/react-dotenv" rel="noopener ugc nofollow" target="_blank">本例中的Github repo </a></li></ul><div class="oi oj gp gr ok ol"><a href="https://github.com/orangegrove1955/react-dotenv" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd ir gy z fp oq fr fs or fu fw ip bi translated">orangegrove1955/react-dotenv</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">github.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz kp ol"/></div></div></a></div></div></div>    
</body>
</html>