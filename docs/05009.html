<html>
<head>
<title>Create a REST Transaction API With Mongoose in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js中用Mongoose创建一个REST事务API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-a-restful-transaction-api-with-mongoose-in-nodejs-15efa6015392?source=collection_archive---------2-----------------------#2020-05-31">https://betterprogramming.pub/creating-a-restful-transaction-api-with-mongoose-in-nodejs-15efa6015392?source=collection_archive---------2-----------------------#2020-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="06ef" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">JavaScript中带有类型的事务</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/e3cdc7115f8cf7e80a2602d533dcdc39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/0*9mS_u-ur_0CHncbB"/></div></figure><h1 id="0dc4" class="kq kr it bd ks kt ku kv kw kx ky kz la jz lb ka lc kc ld kd le kf lf kg lg lh bi translated">安装</h1><p id="39b4" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们需要导入Mongoose并将其连接到我们的本地或云数据库。然后，我们希望导出活动连接。让我们称这个文件为<code class="fe me mf mg mh b">mongoose.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="0973" class="kq kr it bd ks kt mr kv kw kx ms kz la jz mt ka lc kc mu kd le kf mv kg lg lh bi translated">创造我们的猫鼬模型</h1><p id="4fba" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，是时候创建我们的模型了。对于事务API，将涉及三个对象:购买商品的用户、正在购买的商品以及最后但同样重要的事务记录本身。</p><h2 id="ddd3" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">乘积模型</h2><p id="6075" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们将创建一个mongose模式，它基本上定义了对象的外观，然后它将被导出为一个mongose模型。我们把这个文件叫做<code class="fe me mf mg mh b">product.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="f4c6" class="pw-post-body-paragraph li lj it lk b ll ni ju ln lo nj jx lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">本质上，我们创建的模式将<code class="fe me mf mg mh b">Product</code>限制为只有价格、描述、名称和类别。或者，如果我们不需要一个产品有一个<code class="fe me mf mg mh b">category</code>属性，那么我们可以这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="addb" class="kq kr it bd ks kt mr kv kw kx ms kz la jz mt ka lc kc mu kd le kf mv kg lg lh bi translated">用户模型</h1><p id="d1f6" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们继续讨论用户模型。我将把它叫做<code class="fe me mf mg mh b">user.js</code>——你可以根据需要随意更改它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="2059" class="pw-post-body-paragraph li lj it lk b ll ni ju ln lo nj jx lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">注意<code class="fe me mf mg mh b">history</code>属性是如何依赖于我们已经创建的<code class="fe me mf mg mh b">Product</code>模式的。</p><h2 id="4a59" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">交易模型</h2><p id="8b66" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我们姑且称之为<code class="fe me mf mg mh b">transaction.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="2bfa" class="pw-post-body-paragraph li lj it lk b ll ni ju ln lo nj jx lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">注意，我传入了一个额外的参数<code class="fe me mf mg mh b">{ timestamps: true }</code>，它将在通过两个属性<code class="fe me mf mg mh b">createdAt</code>和<code class="fe me mf mg mh b">updatedAt</code>创建和/或更新对象时生成一个时间戳。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="6059" class="kq kr it bd ks kt mr kv kw kx ms kz la jz mt ka lc kc mu kd le kf mv kg lg lh bi translated">构建API路由</h1><p id="18f1" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在到了激动人心的部分——创建实际的API！</p><p id="8b1d" class="pw-post-body-paragraph li lj it lk b ll ni ju ln lo nj jx lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">首先，让我们将模型导出到一个新的JavaScript文件中，我将其命名为<code class="fe me mf mg mh b">server.js</code>。实际上，我们还将从mongo导入<code class="fe me mf mg mh b">ObjectID</code>,用于验证对象id。我们还将使用一个名为<code class="fe me mf mg mh b">body parser</code>的中间件，它用于将HTTP JSON主体解析成可用的对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="0a43" class="kq kr it bd ks kt mr kv kw kx ms kz la jz mt ka lc kc mu kd le kf mv kg lg lh bi translated">发布路线</h1><p id="b0ed" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些是用于使用我们刚刚创建的三个Mongoose模型创建新对象的。用户和产品的<code class="fe me mf mg mh b">POST</code>路线是相似和直接的，但是对于我们的交易<code class="fe me mf mg mh b">POST</code>路线，我们同时更新用户的购买历史。</p><h2 id="2204" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">用户</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="cea0" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">产品</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="2fd0" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">交易</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="0ee2" class="kq kr it bd ks kt mr kv kw kx ms kz la jz mt ka lc kc mu kd le kf mv kg lg lh bi translated">获取路线</h1><p id="026a" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe me mf mg mh b">GET</code>路线用于获取现有物体的信息。使用GET routes发送JSON请求体是不可能的——要发送参数，我们可以使用URL查询参数(即在URL中的<code class="fe me mf mg mh b">?</code>之后)或路由参数，我们可以分别使用<code class="fe me mf mg mh b">req.query</code>或<code class="fe me mf mg mh b">req.params</code>而不是<code class="fe me mf mg mh b">req.body</code>来访问这些参数。</p><h2 id="4941" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">用户</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="355c" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">产品</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="10d4" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">交易</h2><p id="c115" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本质上，事务模型可以设计为与用户或产品路线相同。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="2a10" class="kq kr it bd ks kt mr kv kw kx ms kz la jz mt ka lc kc mu kd le kf mv kg lg lh bi translated">删除路线</h1><p id="6f23" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe me mf mg mh b">DELETE</code>路由用于删除现有用户或对象。个人认为交易不需要<code class="fe me mf mg mh b">DELETE</code>路线。</p><h2 id="b89e" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">用户</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="829c" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">产品</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="d7f3" class="kq kr it bd ks kt mr kv kw kx ms kz la jz mt ka lc kc mu kd le kf mv kg lg lh bi translated">修补/上传路线</h1><p id="d083" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些用于更新现有用户或对象的信息。</p><h2 id="aa93" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">用户</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="ad54" class="mw kr it bd ks mx my dn kw mz na dp la lr nb nc lc lv nd ne le lz nf ng lg nh bi translated">产品</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="b53e" class="pw-post-body-paragraph li lj it lk b ll ni ju ln lo nj jx lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">就是这样！希望这能帮助任何试图在Node.js中使用Mongoose创建自己的API的人。</p><p id="d17e" class="pw-post-body-paragraph li lj it lk b ll ni ju ln lo nj jx lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">感谢阅读！</p></div></div>    
</body>
</html>