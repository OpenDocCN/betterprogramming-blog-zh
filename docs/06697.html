<html>
<head>
<title>How to Create Trusted Self-Signed SSL Certificates and Local Domains for Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建用于测试的可信自签名SSL证书和本地域</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/trusted-self-signed-certificate-and-local-domains-for-testing-7c6e6e3f9548?source=collection_archive---------0-----------------------#2020-10-27">https://betterprogramming.pub/trusted-self-signed-certificate-and-local-domains-for-testing-7c6e6e3f9548?source=collection_archive---------0-----------------------#2020-10-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="295c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">设置本地测试域，并为快速本地测试启用可信的自签名证书</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b30dc486024111ed6400a61393c51cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tBDuu31gzN_9MDZ1aMzbLQ.png"/></div></div></figure><p id="938c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">大多数情况下，我们会使用本地主机以外的域来测试本地应用程序，并且我们还需要可信的自签名SSL证书。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="7882" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">自签名证书</h1><p id="9bd4" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated"><em class="mu">自签名证书</em>是由创建它的人签名的证书，而不是由可信的证书颁发机构签名的证书。开发服务器可以启用自签名证书，这将有助于我们降低证书成本和管理开销。</p><p id="0cf2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">默认情况下，在浏览器中访问网站时，自签名证书会抛出一个证书验证错误，但允许我们通过接受风险来进入实际页面。在某些情况下，自签名证书不会帮助我们测试一些只能通过有效SSL工作的浏览器功能，例如，测试不同浏览器的API，如地理定位。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/7be2fe7c994c6dbe8bb2c17e2dd3b8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7HkdTt4bRMMfwEUuEqiLJg.png"/></div></div></figure><p id="dcc4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们看看如何快速设置本地域和可信自签名证书，以便在Windows中进行测试。通过一些额外的步骤，同样可以用于其他系统。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="439d" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">本地域</h1><p id="c5cf" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">有时我们可能需要不同的领域来测试开发环境中的应用程序。DNS设置将消耗更多的时间和成本；本地域帮助我们在开发环境中快速测试应用程序。</p><p id="1d5f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我将定义以下测试域— <code class="fe mw mx my mz b">myexample.com</code>、<code class="fe mw mx my mz b">sub.myexample.com</code>和<code class="fe mw mx my mz b">myexample1.com</code>。</p><p id="62d9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">编辑Windows <code class="fe mw mx my mz b">hosts</code>文件，<code class="fe mw mx my mz b">C:\Windows\System32\drivers\etc\hosts</code>。添加下面的条目，将测试域映射到<code class="fe mw mx my mz b">127.0.0.1</code>，这样定义的域将能够在同一台机器上访问本地主机上运行的应用程序。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="035b" class="ne ly it mz b gy nf ng l nh ni">127.0.0.1 myexample.com <br/>127.0.0.1 sub.myexample.com <br/>127.0.0.1 myexample1.com</span></pre><p id="4d1f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们通过OpenSSL创建一个自签名证书。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="8760" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">生成根SSL证书</h1><p id="4305" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">创建一个RSA-2048密钥，并将其保存到文件<code class="fe mw mx my mz b">rootCA.key</code>。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="370e" class="ne ly it mz b gy nf ng l nh ni">openssl genrsa -des3 -out rootCA.key 2048</span></pre><p id="fdc1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您收到“输入rootCA.key的密码短语”时，请输入一个密码短语并将其安全存储。</p><p id="d1da" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过生成的密钥创建根证书。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="ca3f" class="ne ly it mz b gy nf ng l nh ni">openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 1460 -out rootCA.pem</span></pre><p id="54d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据需要更改有效期。</p><p id="b54f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当出现“输入rootCA.key的密码”时，输入生成根密钥时使用的密码。</p><p id="b5e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">输入其它可选信息:</p><ul class=""><li id="47c4" class="nj nk it kw b kx ky la lb ld nl lh nm ll nn lp no np nq nr bi translated">国家名称(2个字母的代码)[AU]:美国</li><li id="a430" class="nj nk it kw b kx ns la nt ld nu lh nv ll nw lp no np nq nr bi translated">州或省名(全名)[某些州]: MN</li><li id="bd59" class="nj nk it kw b kx ns la nt ld nu lh nv ll nw lp no np nq nr bi translated">地点名称(例如，城市)[]: Eagan</li><li id="a865" class="nj nk it kw b kx ns la nt ld nu lh nv ll nw lp no np nq nr bi translated">组织名称(如公司)[互联网Widgits Pty Ltd]:技术论坛</li><li id="b33f" class="nj nk it kw b kx ns la nt ld nu lh nv ll nw lp no np nq nr bi translated">组织单位名称(如部门)[]:营销</li><li id="9014" class="nj nk it kw b kx ns la nt ld nu lh nv ll nw lp no np nq nr bi translated">公用名(例如，服务器FQDN或您的名字)[]:本地证书</li><li id="4b64" class="nj nk it kw b kx ns la nt ld nu lh nv ll nw lp no np nq nr bi translated">电子邮件地址[]: <code class="fe mw mx my mz b"><a class="ae nx" href="mailto:admin@techforum.com" rel="noopener ugc nofollow" target="_blank">admin@techforum.com</a></code></li></ul></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="8a7b" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">信任根SSL证书:</h1><p id="d920" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">现在根证书准备好了。让我们信任本地系统中的根SSL证书。</p><p id="36ff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过命令提示符运行以下命令(通过提升的访问权限运行):</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="2ae9" class="ne ly it mz b gy nf ng l nh ni">certutil -addstore -f "ROOT" rootCA.pem</span></pre><p id="d785" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，根证书被添加为受信任的根证书颁发机构的一部分。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/2539355fc1b107e41de9c7d5c1c50e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HVlPBeSKLJGF4H6bUEhpxA.png"/></div></div></figure><p id="3c5f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以通过证书管理器或<code class="fe mw mx my mz b">Certmgr.msc</code>验证证书。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/7620076c92793d7805e42f6d84ae027f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qPKX6ScawwZGZ4aDqhv-ow.png"/></div></div></figure><p id="047f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">甚至可以通过浏览器管理根证书:在Chrome中，导航到设置→隐私和安全→安全→管理证书→受信任的根证书颁发机构。</p><p id="9b44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以导入/导出和删除证书(如果是通过<code class="fe mw mx my mz b">Certmgr.msc</code>导入的，则不能删除证书):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/5d90194a57ccccf0717cd3aa073245d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9fai9OIxdthY2tBolzhfA.png"/></div></div></figure><p id="b11e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果使用Firefox进行本地测试，它不会考虑来自Windows cert store的根证书(Chrome和Edge指的是来自Windows cert store的根证书)。自签名根证书应该单独导入Firefox。</p><p id="1957" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">导航到选项→隐私和安全→安全→证书→查看证书。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/3464a4f47166aa59d987b0aa001e6b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgH3fK0sDOBI4v3i968yWQ.png"/></div></div></figure><p id="f025" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以导入/导出和删除证书。导入在前面步骤中生成的根CA证书。选择“信任此CA来识别网站”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/297a9cb1a42f5b95bb5cb91918bf8d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ihs01r8uxjX8Qqamb9tFOg.png"/></div></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="17fa" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">使用根证书生成SSL SAN证书</h1><p id="d839" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">根证书现在是可信的。让我们发布一个SSL证书来支持我们的本地域— <code class="fe mw mx my mz b">myexample.com</code>、<code class="fe mw mx my mz b">sub.myexample.com</code>、<code class="fe mw mx my mz b">myexample1.com</code>和<code class="fe mw mx my mz b">localhost</code>进行测试。</p><p id="1ab9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建一个新的OpenSSL配置文件<code class="fe mw mx my mz b">server.csr.cnf</code>，以便在生成证书时可以使用配置细节。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="9ef2" class="ne ly it mz b gy nf ng l nh ni">[req]<br/>default_bits = 2048<br/>prompt = no<br/>default_md = sha256<br/>distinguished_name = dn<br/><br/>[dn]<br/>C=US<br/>ST=MN<br/>L=Eagan<br/>O=Tech Forum<br/>OU=Marketing<br/>emailAddress=admin@techforum.com<br/>CN = localhost</span></pre><p id="9445" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建一个包含本地SAN域列表的<code class="fe mw mx my mz b">v3.ext</code>文件:</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="1205" class="ne ly it mz b gy nf ng l nh ni">authorityKeyIdentifier=keyid,issuer<br/>basicConstraints=CA:FALSE<br/>keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment<br/>subjectAltName = @alt_names</span><span id="340d" class="ne ly it mz b gy nz ng l nh ni">[alt_names]<br/>DNS.1 = myexample.com<br/>DNS.2=sub.myexample.com<br/>DNS.3=myexample1.com<br/>DNS.4=localhost</span></pre><p id="c0c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为本地主机证书创建私钥和证书签名请求(CSR)。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="bc67" class="ne ly it mz b gy nf ng l nh ni">openssl req -new -sha256 -nodes -out server.csr -newkey rsa:2048 -keyout server.key -config server.csr.cnf</span></pre><p id="5650" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该私钥存储在<code class="fe mw mx my mz b">server.key</code>上。</p><p id="fb9b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们通过根SSL证书和前面创建的CSR发布一个证书。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="4de5" class="ne ly it mz b gy nf ng l nh ni">openssl x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 500 -sha256 -extfile v3.ext</span></pre><p id="e8df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当显示“输入rootCA.key的密码”时，输入生成根密钥时使用的密码。</p><p id="e3ff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">输出证书存储在名为<code class="fe mw mx my mz b">server.crt</code>的文件中。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="c197" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">为本地服务器启用SSL证书</h1><p id="f8a9" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">现在让我们为本地服务器启用证书。我将使用Express.js应用程序配置证书，以启用可信SSL通信。</p><h2 id="6c5b" class="ne ly it bd lz oa ob dn md oc od dp mh ld oe of mj lh og oh ml ll oi oj mn ok bi translated">app.js</h2><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="1c52" class="ne ly it mz b gy nf ng l nh ni">var express = require('express')<br/>const path = require('path')<br/>const https = require('https');<br/>const fs = require('fs');</span><span id="87c7" class="ne ly it mz b gy nz ng l nh ni">var app = express ()</span><span id="ba89" class="ne ly it mz b gy nz ng l nh ni">app.get('/index.html', function (req, res) {</span><span id="ec7c" class="ne ly it mz b gy nz ng l nh ni">res.sendFile('index.html', {<br/>        root: path.join(__dirname, '.')<br/>    })<br/>})</span><span id="ce75" class="ne ly it mz b gy nz ng l nh ni"><strong class="mz iu">https.createServer({<br/>  key: fs.readFileSync('ssl\\server.key'),<br/>  cert: fs.readFileSync('ssl\\server.crt')<br/>}, app)<br/>.listen(443, function () {<br/>  console.log('Example app listening on port 443! Go to </strong><a class="ae nx" href="https://localhost/" rel="noopener ugc nofollow" target="_blank"><strong class="mz iu">https://localhost/</strong></a><strong class="mz iu">')<br/>})</strong></span></pre><p id="c730" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，对于测试域<code class="fe mw mx my mz b">myexample.com</code>、<code class="fe mw mx my mz b">sub.myexample.com</code>、<code class="fe mw mx my mz b">myexample1.com</code>和<code class="fe mw mx my mz b">localhost</code>，该证书在浏览器中是可信的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/f91c4d9dd4eddc3ce90d1c199a83f9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Dgb3TjiRch84a7Ly4GEEg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/17af22876436870dfe95cf7f756068e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*27D-jIbGI_JYz82zzuG6Ww.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/6079b43e930e090950c8857599eab604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*hu7QE6GYUt1WyeghQMNomA.png"/></div></figure><p id="af89" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">可信的自签名证书以及本地域可用于开发和初始测试。这将帮助我们快速启用受信任的本地域来测试一些需要受信任的SSL证书的场景。</p></div></div>    
</body>
</html>