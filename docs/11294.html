<html>
<head>
<title>How To Design an AWS EKS Cluster With EC2 Spot Instances</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用EC2 Spot实例设计AWS EKS集群</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/design-aws-eks-with-ec2-spot-instances-c9a0f814bc00?source=collection_archive---------8-----------------------#2022-03-07">https://betterprogramming.pub/design-aws-eks-with-ec2-spot-instances-c9a0f814bc00?source=collection_archive---------8-----------------------#2022-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="addc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">节省高达90%的计算成本，同时确保零停机时间</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a015f3e6131b097fa816ec3c2790a7b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-kxfVxyJg-9kKDOI"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4bf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">亚马逊弹性Kubernetes服务(<em class="lv"> EKS </em>)是在AWS云上运行Kubernetes的托管服务。托管解决方案为每个EKS集群运行一个单租户Kubernetes控制计划。一旦EKS集群启动并准备就绪，您需要提供亚马逊弹性计算云(EC2)工人或AWS Fargate来运行您的应用程序。</strong></p><p id="6de1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> EC2服务为您提供可扩展的计算能力。您可以租用虚拟机命名实例来运行您的应用程序。该服务为您提供不同的实例类型和支付方式。</strong></p><p id="4a3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">选择最佳定价模式对您的成本有直接影响。您的所有计算工作负载并没有相同的限制。玩弄承诺以获得更大的弹性，你可以每月节省很多钱。</strong></p><p id="56a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">大多数时候，人们只为他们的EKS集群使用按需实例。如果您也是这种情况，您可能会错过不使用EC2 Spot实例的巨大节省(高达90%的节省)。</strong></p><p id="99a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">阅读本文，您将通过</strong>了解如何将EKS与EC2 Spot实例一起使用</p><ul class=""><li id="930d" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><strong class="lb iu">全面了解4种EC2定价模式，选择最适合您的模式。</strong></li><li id="74b2" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><strong class="lb iu">了解在您的计算策略中何时使用Spot实例。</strong></li><li id="bef6" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">了解Spot实例如何最大化您的投资并最小化它们的缺点。</li><li id="3f4d" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><strong class="lb iu">使用<strong class="lb iu"> EC2 Spot实例</strong>设计您的EKS集群</strong>。</li></ul></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="ac80" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">4种EC2定价模式</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/89d340ee8a03152a5886dd52584831e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*UQ0UEsz4ONs1BJSaxtUjAQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://en.wikipedia.org/" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/</a>的亚马逊弹性计算云(EC2)</p></figure><h2 id="8683" class="nk ms it bd mt nl nm dn mx nn no dp nb li np nq nd lm nr ns nf lq nt nu nh nv bi translated">1-按需实例</h2><p id="d829" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">您需要为每小时或每秒的计算能力付费(仅适用于Linux实例)。你不需要预付款。您可以根据需要增加或减少计算能力。您只需为您使用的实例付费。这种模式适合开发<strong class="lb iu">短期</strong>或<strong class="lb iu">不可预测工作负载</strong>的应用。</p><blockquote class="ob oc od"><p id="2759" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">选择按需实例，无需预付费用或长期承诺。</p></blockquote><h2 id="a338" class="nk ms it bd mt nl nm dn mx nn no dp nb li np nq nd lm nr ns nf lq nt nu nh nv bi translated">2-保留的实例</h2><p id="4bc4" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">与按需实例相比，保留实例可为您提供高达75%的折扣。您将受益于特定可用性区域中的容量预留。<strong class="lb iu">使用可预测性</strong>确保计算容量在需要时可用。</p><blockquote class="ob oc od"><p id="a826" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">为可预测的使用选择保留实例。您可以承诺1年或3年的期限，以降低您的总计算成本。</p></blockquote><h2 id="d694" class="nk ms it bd mt nl nm dn mx nn no dp nb li np nq nd lm nr ns nf lq nt nu nh nv bi translated">3台专用主机</h2><p id="4beb" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">专用主机是专用于运行实例的物理EC2服务器。您可以使用现有的服务器绑定软件(例如Windows Server)来降低成本。使用这种定价模式可以帮助您达到<strong class="lb iu">合规要求</strong>。您需要为主机在帐户中活动的每个小时支付点播价格。</p><blockquote class="ob oc od"><p id="5699" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">如果您有软件许可证并且有合规性要求，请选择专用主机</p></blockquote><h2 id="e3f4" class="nk ms it bd mt nl nm dn mx nn no dp nb li np nq nd lm nr ns nf lq nt nu nh nv bi translated">4点实例</h2><p id="a4d4" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">EC2 Spot实例是AWS云中<strong class="lb iu">未使用的EC2容量</strong>。与按需购买的价格相比，它们的折扣高达90%。实例的<strong class="lb iu">现货价格根据<strong class="lb iu">供求</strong>波动</strong>。作为按需实例，你按小时或秒付费。现场实例上没有<strong class="lb iu">承诺</strong>，并且<strong class="lb iu"> AWS可以请求终止实例</strong>。AWS云中的计算是这样重新分配的。</p><blockquote class="ob oc od"><p id="38bf" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">为大规模动态工作负载的紧急计算选择Spot实例。</p></blockquote></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="01be" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">何时使用EC2 Spot实例？</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自https://aws.amazon.com/<a class="ae ky" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">的亚马逊EC2现货实例</a></p></figure><p id="91e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以使用Spot实例以<strong class="lb iu">折扣价</strong>购买额外的计算能力。它是按需实例的一个很好的补充。它们比按需EC2定价更便宜。</p><blockquote class="ob oc od"><p id="9c33" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">由于潜在的服务中断，Spot实例不应该处理所有的工作负载。</p></blockquote><p id="1964" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Spot实例是以下情况的理想选择:</p><ul class=""><li id="7611" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><strong class="lb iu">批处理任务</strong>涉及在短时间内处理大量数据。报告生成、文档生成或视频编码等任务就是很好的例子。他们大部分时间都是无国籍的。</li><li id="701c" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><strong class="lb iu">持续集成(CI) &amp;持续交付(CD) </strong>:您可以扩展在您喜欢的CI/CD工具(Gitlab、Jenkins等)上运行的任务..).工作运行在不规则的时间表上，并且是短暂的。对于这种用法，使用按需实例的开销很大。</li><li id="6167" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><strong class="lb iu">高性能计算:</strong>对于需要大量内存和密集计算能力的工作负载，您可以使用Spot实例。人工智能和ML驱动的应用程序是贪婪和昂贵的。Spot实例是它们的最佳选择。</li><li id="a6d0" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><strong class="lb iu">大数据分析</strong>:您可以使用Spot实例进行密集处理，以分析大型数据集，从而提取洞察力。Spot实例的可扩展性和成本提供了一个很好的解决方案。</li><li id="8a27" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><strong class="lb iu">渲染工作负载</strong>:你可以用Spot实例渲染廉价的工作负载。</li></ul><blockquote class="ob oc od"><p id="fb1e" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">Spot实例是自动化、大规模和非常易于使用的理想选择。</p></blockquote><p id="469c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">警告</strong>:你不应该将Spot实例用于不能容忍错误和不灵活的工作负载。这是为了避免将它们用于数据库、缓存和队列。对于无状态工作负载，首选Spot实例。</p><p id="12de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于时间和中断的原因，管理Spot实例往往是具有挑战性的。只要你能<strong class="lb iu">处理中断</strong>和<strong class="lb iu">减轻风险</strong>，你就可以继续前进。</p><p id="c3f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们将使用Spot实例来呈现廉价的工作负载。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="d0d7" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">EC2 Spot实例是如何工作的？</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/f0595c0c0185a829bff3a9b9aac8ad1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2cxiTW4iSqsu8Wbo.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“Spot实例如何工作？”来自<a class="ae ky" href="https://aws.amazon.com/ec2/spot/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/ec2/spot/</a></p></figure><p id="743f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须创建一个<strong class="lb iu"> Spot实例请求</strong>来启动实例。</p><p id="db52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该请求包括您愿意为每个实例支付的最高价格。如果不指定，最高价格将是按需价格。您可以添加其他约束，如实例类型和可用性区域。</p><p id="6c95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AWS <strong class="lb iu">验证您的请求</strong>并在<strong class="lb iu"> 2条件</strong>下启动您的Spot实例:</p><ul class=""><li id="671e" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">你的最高价低于现货价。</li><li id="188a" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">可用容量取决于可用性区域上的实例类型。</li></ul><blockquote class="ob oc od"><p id="00a7" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">验证后，您将被收取现货实例的当前价格，而不是您设置的最高价格。</p></blockquote><p id="6bc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">亚马逊EC2根据长期供应和现货需求调整现货价格。现货市场一直在波动。你可以根据报价和需求把它比作股票市场。</p><p id="caf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的Spot实例会一直运行，直到您停止或终止它，或者直到Amazon EC2中断它。<strong class="lb iu">亚马逊EC2可以中断</strong>你的Spot实例<strong class="lb iu">当</strong>:</p><ul class=""><li id="e64d" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">现场实例要求上升。</li><li id="1239" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">现货供应减少。</li><li id="c59c" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">现货价格超过你的最高价格。</li></ul><p id="d076" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">亚马逊EC2在实例终止前2分钟给你发送<strong class="lb iu">现货实例中断通知。因此，您可以预见到中断。</strong></p><p id="33d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将了解如何使用Terraform构建一个具有弹性且经济高效的EKS集群。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="0841" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">使用EC2 Spot实例设计EKS集群</h1><h2 id="bfd8" class="nk ms it bd mt nl nm dn mx nn no dp nb li np nq nd lm nr ns nf lq nt nu nh nv bi translated">多样化你的现货实例</h2><p id="d64d" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">多样化您的Spot实例是一个必须具备的最佳实践。您可以从多个点池中选择资源调配容量。由于现货市场一直在波动，它可能会出现池短缺。您可以确保缩放和定点实例替换。</p><p id="4422" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现货容量池在可用性区域之间是不同的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/dff3bce246b3469b2d8fbcfd6ee3f34a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CsAS_K9Xk-F4AwsICA25dw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可用性区域的现货实例定价历史记录</p></figure><p id="89b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据实例类型的不同，价格也会有所不同:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/ed7ca577f106655cb6c0edd7281cde86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AEvA0slt4N93ck2ovfKG7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不同实例的现货实例定价历史记录</p></figure><p id="bbf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Spot容量被分成由实例类型、可用性区域和AWS区域确定的池:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/1699846665badf4a0c4464287080ff6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w71eGxyqx2sgHOfIguOOiQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有实例类型/可用性区域的AWS现货池的定价矩阵</p></figure><blockquote class="ob oc od"><p id="a183" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated"><strong class="lb iu">现场容量池=(可用区域)x(实例类型)= 3 x 5= 15 </strong></p></blockquote><p id="fe01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图给出了15个容量池。</p><blockquote class="ob oc od"><p id="4b90" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated"><strong class="lb iu">使用尽可能多的可用性区域和实例类型来增加稳定性和弹性</strong></p></blockquote><h2 id="b4cc" class="nk ms it bd mt nl nm dn mx nn no dp nb li np nq nd lm nr ns nf lq nt nu nh nv bi translated">EKS集群架构</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/7778b26e42f370fc370ab07bc889c78a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1EqAwRsQKJuFTe9hBUI8oQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有Spot实例的EKS集群体系结构的体系结构图</p></figure><p id="4858" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下EKS架构分布在<strong class="lb iu"> 3个可用区域</strong>。工作负载分为<strong class="lb iu"> 2个节点组</strong>:</p><ul class=""><li id="ed93" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">1个节点组运行具有多种实例类型的Spot实例，以确保弹性。</li><li id="3910" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">1个运行按需实例的节点组，用于运行关键集群组件、有状态应用程序，并确保为现场实例提供备份解决方案。</li><li id="b88b" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">每个EKS工作者运行一个<a class="ae ky" href="https://github.com/aws/aws-node-termination-handler" rel="noopener ugc nofollow" target="_blank">节点终止处理器控制器</a></li><li id="ef22" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><a class="ae ky" href="https://github.com/kubernetes/autoscaler" rel="noopener ugc nofollow" target="_blank">集群自动缩放器</a>部署在按需实例上</li></ul><h2 id="7d3e" class="nk ms it bd mt nl nm dn mx nn no dp nb li np nq nd lm nr ns nf lq nt nu nh nv bi translated">节点终端处理器控制器</h2><blockquote class="ob oc od"><p id="0f62" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">“该项目确保Kubernetes控制平面对可能导致您的EC2实例变得不可用的事件做出适当的响应，例如<a class="ae ky" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/monitoring-instances-status-check_sched.html" rel="noopener ugc nofollow" target="_blank"> EC2维护事件</a>、<a class="ae ky" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-interruptions.html" rel="noopener ugc nofollow" target="_blank"> EC2现场中断</a>、<a class="ae ky" href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/AutoScalingGroupLifecycle.html#as-lifecycle-scale-in" rel="noopener ugc nofollow" target="_blank"> ASG扩大</a>、<a class="ae ky" href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/auto-scaling-benefits.html#AutoScalingBehavior.InstanceUsage" rel="noopener ugc nofollow" target="_blank"> ASG AZ重新平衡</a>，以及通过API或控制台终止EC2实例。如果处理不当，您的应用程序代码可能无法正常停止，需要更长时间来恢复完全可用性，或者意外地将工作安排到正在关闭的节点上。”来自<a class="ae ky" href="https://github.com/aws/aws-node-termination-handler" rel="noopener ugc nofollow" target="_blank">https://github.com/aws/aws-node-termination-handler</a></p></blockquote><div class="on oo gp gr op oq"><a href="https://github.com/aws/aws-node-termination-handler" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">GitHub—AWS/AWS-node-termination-handler:优雅地处理EC2实例关闭…</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">在Kubernetes内部妥善处理EC2实例关闭每月召开一次第n次社区会议…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">github.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks oq"/></div></div></a></div><p id="3fe2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Amazon Eventbridge收集EC2事件，包括<strong class="lb iu">点实例中断</strong>，并将其推送到SQS队列。节点终止处理程序使用该队列并管理工作负载以确保弹性:</p><ul class=""><li id="23c5" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">确定两分钟内将被中断的Spot实例。</li><li id="b80b" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">使用两分钟的通知窗口让节点做好终止准备。</li><li id="4bf8" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">污染节点并封锁它以防止新的豆荚被部署在上面。</li><li id="748f" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">运行舱上的排水连接。</li></ul><h2 id="7756" class="nk ms it bd mt nl nm dn mx nn no dp nb li np nq nd lm nr ns nf lq nt nu nh nv bi translated">聚类自动缩放器</h2><blockquote class="ob oc od"><p id="831f" class="kz la lv lb b lc ld ju le lf lg jx lh oe lj lk ll of ln lo lp og lr ls lt lu im bi translated">来自https://github.com/kubernetes/autoscaler<a class="ae ky" href="https://github.com/kubernetes/autoscaler" rel="noopener ugc nofollow" target="_blank">的</a><a class="ae ky" href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler" rel="noopener ugc nofollow" target="_blank">“集群自动缩放器</a>——一个自动调整Kubernetes集群大小的组件，这样所有的集群都有一个运行的地方，并且没有不需要的节点”</p></blockquote><div class="on oo gp gr op oq"><a href="https://github.com/kubernetes/autoscaler" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">GitHub—Kubernetes/auto scaler:Kubernetes的自动缩放组件</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">这个库包含Kubernetes的自动缩放相关组件。集群自动缩放—一个组件…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">github.com</p></div></div><div class="oz l"><div class="pf l pb pc pd oz pe ks oq"/></div></div></a></div><p id="1cf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cluster-Autoscaler的作用是扩大/缩小集群，以确保灵活性。它还将管理未来终止的Spot实例的替换。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="7c17" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">结论</h1><p id="2a07" class="pw-post-body-paragraph kz la it lb b lc nw ju le lf nx jx lh li ny lk ll lm nz lo lp lq oa ls lt lu im bi translated">现在，您对不同的EC2定价模型有了更好的理解。根据你的承诺和工作量，你知道哪一个是最好的。我们深入研究何时使用Spot实例，并了解它们是如何工作的。这使得理解主要的不便成为可能:没有承诺和干扰。</p><p id="1857" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望由于通知，Spot实例中断是可以预料的。此外，您将看到如何使实例类型多样化，并尽可能地将它们分布在多个可用性区域中。这增加了您可以从中挑选实例的Spot实例池的数量。</p><p id="90d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">处理现场实例中断和多样化是弹性和容错的关键。您最终看到了一个运行EKS的架构，它使用了Spot实例来优化成本，而不牺牲弹性。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="f406" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！🙏我希望这篇文章是有帮助的。想了解更多关于DevOps的知识？看看下面更多类似的文章吧！⬇️</p><div class="on oo gp gr op oq"><a href="https://getbetterdevops.io" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">Getbetterdevops</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">Getbetterdevops是一个devops博客，帮助学习现代基础设施和云技术，如Kubernetes…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">getbetterdevops.io</p></div></div><div class="oz l"><div class="pg l pb pc pd oz pe ks oq"/></div></div></a></div></div></div>    
</body>
</html>