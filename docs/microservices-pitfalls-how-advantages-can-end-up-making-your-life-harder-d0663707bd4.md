# 微服务陷阱——优势最终会让您的生活变得更加艰难

> 原文：<https://betterprogramming.pub/microservices-pitfalls-how-advantages-can-end-up-making-your-life-harder-d0663707bd4>

## 每一项新潮技术都应该谨慎实施

![](img/65dfa2caab562acce589ea76d2cba3e7.png)

谢栋豪在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

微服务已经流行了一段时间，它们提供了一些不可否认的好处。我不是来告诉你这个模型是错误的..不，那太疯狂了。然而，我一直热衷于阅读规则的例外，以及我们称之为编码和软件架构中“最佳实践”的局限性。一次又一次出现的一件事是整体服务与微服务的争论。

这不是一个真正的大讨论，大多数人都认识到微服务方法的优势，但我确实遇到了一些有趣的反对点，或者更确切地说是实施方式中的风险。我也目睹了很多这样的风险变成现实，成为工程师的负担。像生活中的所有事情一样，该模型应该有所保留，并与现实世界的环境和限制以及业务细节和目标保持平衡。所以，我想总结一下我自己发现和观察到的一些关键陷阱。

让我们先来看看放弃整体架构的原因以及微服务架构的所有“宣传”优势。

# 什么是整体式建筑，为什么不再流行了？

整体式应用程序是这样一种应用程序，其中所有的代码，即使被分割成逻辑模块，也被认为是一个单一的项目，通常代码存在于一个单一的存储库中，构建也产生一个单一的可部署的、可执行的产品。通常，当谈到这种应用程序时，人们会想到具有这三个组件的企业应用程序——数据库、用户界面和服务器端应用程序，尽管这不是必需的。

嗯，听起来不错，不是吗？这有一些明显的**优势**:

*   **易于开发和部署** —您将所有代码放在一个地方，因此重用代码很容易，端到端测试也很容易，部署也不那么麻烦
*   **性能** —这经常被认为是 monoliths 的优势，如果不需要通过 HTTP API 或任何其他方式在网络上调用，前端和后端之间的通信会更有效。然而，对于那些不太重要的应用程序来说，这个论点就变得不那么重要了。

另一方面，如果单片应用不再流行，那么它肯定有很多缺点，对吗？

*   紧密耦合(tight coupling)——无论你多么努力地试图在代码中保持某种逻辑分离，不可避免的是，你最终会得到至少有些耦合的模块。
*   **更高的复杂性**——对于新手甚至有经验的开发人员来说，整体存储库经常变成一个迷宫。这使得很难做出改变，因为这些改变的影响还不清楚。即使代码库经过了很好的测试，并且能够防止大多数错误泄漏到产品中，工程师实施更改和调试任何潜在测试失败所花费的时间也会加倍
*   **bug 影响**——无论何时你的安全测试网失败了，并且一个 bug 最终发布了，那么这将影响整个应用程序并使一个重要的业务服务不可用
*   更慢的构建和启动时间——因为你所有的代码都在一个地方，所以构建起来很慢，启动应用程序通常也很慢
*   **扩展是困难的** —这种架构有点儿把你推向垂直扩展，因为水平扩展需要同步实例的数据，这就破坏了整体的意义
*   **创新很难，几乎不可能** —拥有单一的代码库通常意味着兼容的语言和框架数量有限，因此实验和创新是一场没有人愿意面对的噩梦

注意到反对者和赞成者数量的差异了吗？这就是人们远离这种模式的原因。

所以，你现在可以先占微服务现在的一些好处，但让我们总结一下。

# 为什么选择微服务？

微服务的目标是拥有更小的、单一用途的服务，这些服务通过 REST、RPC 或基于消息的 API 相互通信。每个微服务使用自己的数据库，公开的 API 实际上可以服务于多个其他服务。这给开发团队和业务带来了很多好处:

*   **松耦合** —每个服务都是一个独立的代码库，它隐藏了业务逻辑，只公开了一个 API。微服务中的变化不会影响与其通信的任何其他服务(如果操作正确并且考虑了向后兼容性)
*   **降低复杂性** —对于开发人员来说，在一个微服务中做出改变，他们不一定需要熟悉整个系统，因此减少了开发时间
*   **bug 影响** —生产中的任何问题都被限制在特定的微服务中，所有与其通信的其他微服务都可以以合理的方式实现处理该问题的机制
*   **更快的构建和启动时间**——只需减少代码量和复杂性
*   **更轻松、更高效的扩展** —因为每个微服务都有自己的数据库和职责，所以可以更轻松地进行横向扩展。更重要的是，有了分离，你只能扩展成为瓶颈的部分，而不是整个系统
*   **易于创新和试验** —跟进第一点——变更对其他微服务是透明的——将一个微服务迁移到新的框架或语言很容易，无需考虑兼容性和对其他模块的影响

这些听起来都不错，但微服务并不全是彩虹和玫瑰，它不是灵丹妙药。当你朝着这个方向前进时，仍然有很多要考虑的因素——技术和非技术因素都应该考虑，因为否则，你可能会以几十个非常微小的微服务而告终，这使你作为开发人员的生活成为地狱。

让我们看看有哪些。

# 微服务陷阱

## 可量测性

等等，这不是专家之一吗？是的，它是..在某种程度上，这是……因为微服务通过网络通信，所以它们需要更复杂的设置，并且依赖于它们使用的 API 的速度。这可能意味着，在某些时候，添加更多的服务实例并不会带来预期的性能提升，最终甚至会适得其反。

## Bug 影响

另一个可能对你不利的优势。尽管一个失败的应用程序从定义上来说不会拖垮其他所有程序，但这并不总是意味着它不会影响其他程序的功能。这是一项专业功能，它严重依赖于您的系统设计以及负责与故障服务通信的微服务团队的善意、技能或记忆。我的意思是，如果你创建微服务只是为了说你有一个微服务架构，而没有考虑这些如何通信以及每个人失败的影响，那么你还不如保持它的整体性。

如果服务 A 失败了，而其余的服务没有办法合理地处理 A 中的失败，那么它们也会失败，这一切只会传播回顶层。此外，即使有办法做到这一点，也完全取决于团队中的开发人员是否记得处理失败并正确地完成它。从工程的角度来看，这很好——您只关心您开发的一点，然而，这可能会导致更多的时间和很少的迭代，直到它正确完成，这可能会影响用户的体验。

## 代码整洁

是的，微服务意味着单个存储库中的代码更少，但这并不一定意味着干净高效的代码。当不同的团队开发和维护不同的服务时，您可能最终会使用不兼容的不同语言和框架，因此您最终会重写相同的代码。像这样的重复在一些服务中似乎是无害的，但是想象一下，重要的代码以 3-4-5 种方式被重写，然后不得不对所有的进行修改。这将需要团队之间的协调，这将增加生产时间..很多。

通过为每一点业务逻辑创建一个**单一公共库**而走极端也是不理想的。这是一个好主意，但走得太远可能会有问题。您可能最终得到一个试图适应多种服务需求中的细微差异的库，并且这变成了一个过于复杂和难以维护的项目，其中每个变化的影响都不清楚并且很难测试…听起来很熟悉吧？此外，想象一下，为了从库中应用所需的更改，必须单独更新所有微服务依赖关系？这不仅需要时间和努力，还需要大量的协调和计算，首先是哪里，然后是哪里，这意味着什么等等…

## 展开性

在微服务架构中添加新功能似乎很容易……确实可以，但并不总是如此。有时，微服务可能更难满足新功能的要求——要么是因为它涉及多个服务和团队，这些服务和团队现在需要将所有其他优先级放在一起协同工作，要么是因为在微服务环境中，该功能会迫使您实施变通方案，从而增加技术债务和不必要的复杂性。

## 同步状态

建议每个微服务都有自己的数据库，以便为维护它的开发团队保持松耦合和独立性。然而，如果两个或更多的服务需要同步他们对世界的看法，会发生什么？如果 A 更新了它的数据库，而 B 和 C 没有更新，会发生什么？

调查跨多个应用程序的问题并理解时间线是一项痛苦的工作，需要开发人员实际上了解很多(如果不是全部)其他相关应用程序的实现细节，这违背了职责分离的目的。

此外，花费太多时间和精力以编程方式缓解这些问题的负面影响可能会超过将这 3 项服务作为一个整体回购的好处。这又回到了设计的重要性，并考虑到沟通和故障处理，而不仅仅是为了它而盲目跟风。

## 迁移

这是已经在几个地方提到的几点的一种融合，也就是说，将更改应用到所有微服务是一项耗时费力的工作。这既无聊又重复，真的会打击负责这项工作的可怜的开发人员的精神。

变更可能涉及更新依赖关系、逻辑变更、迁移到不同的第三方服务、部署、监控或警报机制。这一点尤其重要，在小公司/团队中确实应该仔细考虑，它们应该有自己的部分。

## 公司/团队规模

如果一个由 3-4 名开发人员组成的团队需要支持并积极扩展 10 个以上的微服务，我敢说这将是一个问题。这将是一个例子，作为一个团队，您需要权衡好的架构实践和趋势与其实际的日常含义。您必须在自己的带宽和以推荐的方式做事之间取得平衡。如果您决定使用 10 个微服务，那么这可能会大大降低您的吞吐量，并减缓业务发展。

为了给自己一些喘息的机会，你可能需要在一些设计决策上做出妥协。这并不一定意味着糟糕的代码，尤其是当你有意识地做出这些决定并对未来有所规划的时候。您可以将一些逻辑上相关的部分放在一起，但保持模块之间的松散耦合，这种方式有助于您在团队和公司扩展时将其拆分。

最后，所有这些都是关于用良好的推理来支持您的架构和实现决策，并在您的设计、代码和文档中显而易见。这对服务的未来发展极其重要，并且将有助于指导或激励未来的决策，因为设计、编写和维护服务的人以及处于其职业生涯不同阶段的所有不同的人，他们在公司的时间通常不会重叠。确保你能支持你的决定，不要不考虑你的具体情况就跳上当前流行的最佳实践列车。

感谢阅读:)