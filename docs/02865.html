<html>
<head>
<title>Create a Custom Web Editor Using TypeScript, React, ANTLR, and Monaco Editor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TypeScript、React、ANTLR和Monaco编辑器创建自定义Web编辑器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-custom-web-editor-using-typescript-react-antlr-and-monaco-editor-part-1-2f710c69c18c?source=collection_archive---------5-----------------------#2020-01-06">https://betterprogramming.pub/create-a-custom-web-editor-using-typescript-react-antlr-and-monaco-editor-part-1-2f710c69c18c?source=collection_archive---------5-----------------------#2020-01-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c32a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第1部分:使用语法着色构建web编辑器</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1d11c6635111c0512f6d41247221ef57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eIFZ95a_xpVH-UrYf_kcIA.jpeg"/></div></div></figure><p id="23c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你有没有想过像<a class="ae ln" href="https://visualstudio.microsoft.com/services/visual-studio-codespaces/" rel="noopener ugc nofollow" target="_blank"> Visual Studio(在线</a>)、<a class="ae ln" href="https://codesandbox.io/" rel="noopener ugc nofollow" target="_blank"> CodeSandbox </a>或<a class="ae ln" href="https://snack.expo.io/" rel="noopener ugc nofollow" target="_blank"> Snack </a>这样的网页编辑器是如何工作的？或者你想做一个自定义的网页或桌面编辑器，但不知道如何开始？</p><p id="8e8b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我将解释web编辑器是如何工作的，我们将为自定义语言创建一个。</p><p id="4750" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将要为之构建编辑器的语言很简单。它声明了一个TODOs列表，然后对它们应用一些预定义的指令。我把这种语言叫做<em class="lo"> TodoLang </em>。以下是这些说明的一些示例:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="64fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们简单地添加一些TODOs，如下所示:</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="eb22" class="lw lx iq ls b gy ly lz l ma mb">ADD TODO "TODO_TEXT";</span></pre><p id="a7d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者我们可以使用<code class="fe mc md me ls b">COMPLETE TODO “todo_text”</code>来完成一个TODO，这样解释这段代码的输出可以告诉我们剩余的TODO以及到目前为止我们已经完成的TODO。这是我为本文发明的一种简单语言。它可能看起来没什么用，但是它包含了我需要在本文中介绍的所有内容。</p><p id="fa69" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使编辑器支持以下功能:</p><ul class=""><li id="78df" class="mf mg iq kt b ku kv kx ky la mh le mi li mj lm mk ml mm mn bi translated">自动格式化</li><li id="cad5" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">自动完成</li><li id="5256" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">语法突出显示</li><li id="d4f1" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">语法和语义验证</li></ul><p id="1a71" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:编辑器一次只支持一个代码或文件编辑。它不支持多个文件或代码编辑。</p><h2 id="2220" class="lw lx iq bd mt mu mv dn mw mx my dp mz la na nb nc le nd ne nf li ng nh ni nj bi translated">TodoLang语义规则</h2><p id="b5ad" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">以下是我将用于TodoLang代码语义验证的一些语义:</p><ul class=""><li id="6f4f" class="mf mg iq kt b ku kv kx ky la mh le mi li mj lm mk ml mm mn bi translated">如果TODO是使用<code class="fe mc md me ls b">ADD TODO</code>指令定义的，我们可以重新添加它。</li><li id="d7bc" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated"><code class="fe mc md me ls b">COMPLETE</code>指令不应该应用在没有使用<code class="fe mc md me ls b">ADD TODO</code>声明的TODO中。</li></ul><p id="dbae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将在本文后面回到这些语义规则。</p><p id="f997" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们深入研究代码之前，让我们先从web编辑器或任何一般编辑器的一般架构开始。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/296d205d88af4c3de81d1373193cab31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hbxfzkStRjL2w2zwEOwD7g.jpeg"/></div></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">App架构。图片来源:作者</p></figure><p id="493e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从上面的模式可以看出，一般来说，任何编辑器都有两个线程。一个负责UI方面的工作，比如等待用户输入一些代码或者做一些动作。另一个线程接受用户所做的更改，并进行繁重的计算，包括代码解析和其他编译工作。</p><p id="a1f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于编辑器中的每次更改(可能是针对用户键入的每个字符，或者直到用户停止键入2秒)，将向语言服务工作人员发送一条消息以执行一些操作。工作者本身将用包含结果的消息来响应。例如，当用户键入一些代码并希望格式化代码(单击Shift + Alt + F)时，工作人员将收到一条消息，其中包含“format”操作和要格式化的代码。这应该异步发生，以获得良好的用户体验。</p><p id="6602" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一方面，语言服务负责解析代码，生成<a class="ae ln" href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" rel="noopener ugc nofollow" target="_blank">抽象语法树</a> (AST)，查找任何可能的语法或词汇错误，使用AST查找任何语义错误，格式化代码等。</p><p id="0e10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以通过使用<a class="ae ln" href="https://microsoft.github.io/language-server-protocol/" rel="noopener ugc nofollow" target="_blank"> LSP协议</a>使用一种新的、先进的方式来处理语言服务，但是在这个例子中，语言服务和编辑器将在同一个进程中，也就是浏览器，没有任何后端处理。如果你想让你的语言在其他编辑器中得到支持，比如<a class="ae ln" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS Code </a>、<a class="ae ln" href="https://www.sublimetext.com/" rel="noopener ugc nofollow" target="_blank"> Sublime </a>或<a class="ae ln" href="https://www.eclipse.org/community/eclipse_newsletter/2017/may/article3.php" rel="noopener ugc nofollow" target="_blank"> Eclipse </a>，而不需要重新发明轮子，最好将语言服务和工作器分开。实现LSP将允许你为其他编辑器制作插件来支持你的语言。请查看LSP页面了解更多信息。</p><p id="ffe3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">编辑器提供了一个界面，允许用户键入代码并执行一些操作。当用户键入时，编辑器应该查询配置列表，以了解它应该如何突出显示代码标记(关键字、类型等)。).这可以由语言服务来完成，但是对于我们的例子，我们将在编辑器中完成。我们稍后将看到如何做到这一点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/e54d46a9bfcff10159c9daaf649d93be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gk80M88gCvA4Ul3jT5jjng.png"/></div></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">与网络工作者交流。图片来源:作者</p></figure><p id="9b6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Monaco提供了一个API<a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/modules/monaco.editor.html#createwebworker" rel="noopener ugc nofollow" target="_blank">Monaco . editor . create WebWorker</a>来创建一个使用内置<a class="ae ln" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="noopener ugc nofollow" target="_blank"> ES6代理</a>的代理web worker。使用<a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/interfaces/monaco.editor.monacowebworker.html#getproxy" rel="noopener ugc nofollow" target="_blank"> getProxy </a>方法获取代理对象(语言服务)。要访问语言服务工作器中的任何服务，我们将使用这个代理对象来调用任何方法。所有方法都将返回一个Promise对象。</p><p id="16a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看一下<a class="ae ln" href="https://github.com/GoogleChromeLabs/comlink" rel="noopener ugc nofollow" target="_blank"> Comlink </a>，这是一个由Google开发的微型库，它使得使用ES6代理与web工作者一起工作变得愉快。</p><p id="1fa5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">事不宜迟，让我们开始写一些代码。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h1 id="e7c7" class="oc lx iq bd mt od oe of mw og oh oi mz jw oj jx nc jz ok ka nf kc ol kd ni om bi translated">我们要用什么？</h1><p id="c9dc" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">对于这个项目，我将使用:</p><h2 id="c7e1" class="lw lx iq bd mt mu mv dn mw mx my dp mz la na nb nc le nd ne nf li ng nh ni nj bi translated">反应</h2><p id="4e76" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">对于UI</p><h2 id="1907" class="lw lx iq bd mt mu mv dn mw mx my dp mz la na nb nc le nd ne nf li ng nh ni nj bi translated"><a class="ae ln" href="https://www.antlr.org/" rel="noopener ugc nofollow" target="_blank"> ANTLR </a></h2><p id="3ca3" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">正如其网站上所定义的，“ANTLR(另一种语言识别工具)是一种强大的解析器生成器，用于读取、处理、执行或翻译结构化文本或二进制文件。它被广泛用于构建语言、工具和框架。ANTLR从语法中生成一个可以构建和遍历解析树的解析器。ANTLR支持很多语言作为目标，这意味着它可以生成Java、C#和其他语言的解析器。对于这个项目，我将使用<a class="ae ln" href="https://github.com/tunnelvisionlabs/antlr4ts" rel="noopener ugc nofollow" target="_blank"> ANTLR4TS </a>，它是ANTLR的Node.js版本，可以在TypeScript中生成一个lexer和一个解析器。</p><p id="416f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ANTLR使用一种特殊的语法来声明一种语言语法，这种语法通常放在一个<code class="fe mc md me ls b">*.g4</code>文件中。它允许您在一个组合的语法文件中定义词法分析器和语法分析器规则。在这个<a class="ae ln" href="https://github.com/antlr/grammars-v4" rel="noopener ugc nofollow" target="_blank">库</a>中，你会找到很多知名语言的语法文件。</p><p id="c718" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这种语法句法使用一种被称为<a class="ae ln" href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form" rel="noopener ugc nofollow" target="_blank">巴克斯范式(BNF) </a>的符号来描述<a class="ae ln" href="https://en.wikipedia.org/wiki/Formal_language#Programming_languages" rel="noopener ugc nofollow" target="_blank">语言</a>的<a class="ae ln" href="https://en.wikipedia.org/wiki/Syntax_(programming_languages)" rel="noopener ugc nofollow" target="_blank">句法</a>。</p><h2 id="8d61" class="lw lx iq bd mt mu mv dn mw mx my dp mz la na nb nc le nd ne nf li ng nh ni nj bi translated">托多兰语法</h2><p id="5f30" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">这是我们TodoLang的简化语法。它为TodoLang声明了一个根规则，<code class="fe mc md me ls b">todoExpressions</code>，它保存了表达式列表。TodoLang中的表达式可以是一个<code class="fe mc md me ls b">addExpression</code>或<code class="fe mc md me ls b">completeExpression</code>。在正则表达式中，星号(*)表示表达式可能出现零次或多次。</p><p id="5254" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">每个表达式都以一个结束关键字(<em class="lo"> add </em>、<em class="lo"> todo </em>或<em class="lo"> complete </em>)开始，并有一个标识todo的字符串(“…”)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><h2 id="2062" class="lw lx iq bd mt mu mv dn mw mx my dp mz la na nb nc le nd ne nf li ng nh ni nj bi translated"><a class="ae ln" href="https://microsoft.github.io/monaco-editor/" rel="noopener ugc nofollow" target="_blank">摩纳哥-编辑</a></h2><p id="90d9" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">Monaco编辑器是为<a class="ae ln" href="https://github.com/Microsoft/vscode" rel="noopener ugc nofollow" target="_blank"> VS代码</a>提供动力的代码编辑器。这是一个JavaScript库，提供了语法高亮、自动完成等API。</p><h2 id="fc8d" class="lw lx iq bd mt mu mv dn mw mx my dp mz la na nb nc le nd ne nf li ng nh ni nj bi translated">开发工具</h2><p id="117a" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">打字稿、<a class="ae ln" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> webpack </a>、<code class="fe mc md me ls b"><a class="ae ln" href="https://webpack.js.org/configuration/dev-server/" rel="noopener ugc nofollow" target="_blank">webpack-dev-server</a></code>、<a class="ae ln" href="https://webpack.js.org/api/cli/" rel="noopener ugc nofollow" target="_blank"> webpack-cli </a>、<code class="fe mc md me ls b"><a class="ae ln" href="https://github.com/jantimon/html-webpack-plugin" rel="noopener ugc nofollow" target="_blank">HtmlWebpackPlugin</a></code>和<code class="fe mc md me ls b"><a class="ae ln" href="https://www.npmjs.com/package/ts-loader" rel="noopener ugc nofollow" target="_blank">ts-loader</a></code>。</p><p id="7f03" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，让我们从启动项目开始。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h1 id="fd44" class="oc lx iq bd mt od oe of mw og oh oi mz jw oj jx nc jz ok ka nf kc ol kd ni om bi translated">启动新的TypeScript项目</h1><p id="0c5e" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">为此，让我们开始我们的项目:</p><p id="35bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mc md me ls b">npm init</code></p><p id="4977" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建一个包含最少内容的<code class="fe mc md me ls b">tsconfig.json</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="80d0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为webpack添加一个配置文件<code class="fe mc md me ls b">webpack.config.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="1e52" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为React和TypeScript添加依赖项:</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="419e" class="lw lx iq ls b gy ly lz l ma mb">npm add react react-dom</span><span id="012c" class="lw lx iq ls b gy on lz l ma mb">npm add -D typescript <a class="ae ln" href="http://twitter.com/types/react" rel="noopener ugc nofollow" target="_blank">@types/react</a> <a class="ae ln" href="http://twitter.com/types/react-dom" rel="noopener ugc nofollow" target="_blank">@types/react-dom</a> ts-loader html-webpack-plugin webpack webpack-cli webpack-dev-server</span></pre><p id="f51a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">用您的入口点<code class="fe mc md me ls b">index.ts</code>和<code class="fe mc md me ls b">index.html </code>创建一个<code class="fe mc md me ls b">src</code>目录，其中包含一个id为<code class="fe mc md me ls b">container.</code>的div</p><p id="6e51" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里是这个<a class="ae ln" href="https://github.com/amazzalel-habib/TodoLangEditor/tree/Starter" rel="noopener ugc nofollow" target="_blank">启动项目</a>的源代码。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h1 id="6a3b" class="oc lx iq bd mt od oe of mw og oh oi mz jw oj jx nc jz ok ka nf kc ol kd ni om bi translated">添加摩纳哥编辑器组件</h1><p id="df55" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">如果您的目标是现有的语言，如TypeScript、HTML或Java，您不必重新发明轮子。摩纳哥编辑器和<a class="ae ln" href="https://github.com/Microsoft/monaco-languages" rel="noopener ugc nofollow" target="_blank">摩纳哥语言</a>支持大多数语言。</p><p id="9361" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于我们的例子，我们将使用名为<a class="ae ln" href="https://www.npmjs.com/package/monaco-editor-core" rel="noopener ugc nofollow" target="_blank"> monaco-editor-core </a>的Monaco编辑器的核心版本。</p><p id="ec88" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">添加包:</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="dd4b" class="lw lx iq ls b gy ly lz l ma mb">npm add monaco-editor-core</span></pre><p id="5af1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还需要一些CSS加载器，因为摩纳哥内部使用它们:</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="417d" class="lw lx iq ls b gy ly lz l ma mb">npm  add -D style-loader css-loader</span></pre><p id="16a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将这些规则添加到webpack配置中的模块属性:</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="79f6" class="lw lx iq ls b gy ly lz l ma mb">{</span><span id="13c3" class="lw lx iq ls b gy on lz l ma mb">test: /\.css$/,</span><span id="df96" class="lw lx iq ls b gy on lz l ma mb">use: ['style-loader', 'css-loader']</span><span id="c6aa" class="lw lx iq ls b gy on lz l ma mb">}</span></pre><p id="490c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，将CSS添加到已解析的扩展中:</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="0c0e" class="lw lx iq ls b gy ly lz l ma mb">extensions: ['.ts', '.tsx', '.js', '.jsx','.css']</span></pre><p id="d18c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们已经准备好创建编辑器组件了。创建一个React组件(我们称之为编辑器)，并返回一个具有ref属性的元素，这样我们就可以引用它，让Monaco API在其中注入编辑器。</p><p id="3902" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要创建一个摩纳哥编辑器，我们需要调用<a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/modules/monaco.editor.html#create" rel="noopener ugc nofollow" target="_blank"> monaco.editor.create </a>。它将Monaco将在其中注入编辑器的DOM元素以及一些语言id、主题等选项作为参数。查看文档了解更多细节。</p><p id="6161" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">添加一个包含<code class="fe mc md me ls b">src/todo-lang</code>中所有语言配置的文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="df50" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe mc md me ls b">src/components</code>中添加一个组件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div><p class="nq nr gj gh gi ns nt bd b be z dk translated">编辑器组件</p></figure><p id="8626" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们基本上使用一个回调钩子来获取挂载时div的<a class="ae ln" href="https://reactjs.org/docs/forwarding-refs.html" rel="noopener ugc nofollow" target="_blank">引用</a>，所以我们可以把它传递给<code class="fe mc md me ls b">create</code>函数。</p><p id="8d91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，您可以将编辑器组件添加到您的应用程序中，并根据需要添加一些样式。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h1 id="aa45" class="oc lx iq bd mt od oe of mw og oh oi mz jw oj jx nc jz ok ka nf kc ol kd ni om bi translated">使用摩纳哥API注册我们的语言</h1><p id="e1a3" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">为了让Monaco编辑器支持我们定义的语言(例如，当我们创建编辑器时，我们指定了语言ID)，我们需要使用API<a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/modules/monaco.languages.html#register" rel="noopener ugc nofollow" target="_blank">Monaco . languages . register</a>注册它。让我们在<code class="fe mc md me ls b">src/todo-lang</code>中创建一个名为<code class="fe mc md me ls b">setup</code>的文件。我们还需要通过给它一个回调来实现<code class="fe mc md me ls b"><a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/modules/monaco.languages.html#register" rel="noopener ugc nofollow" target="_blank">monaco.languages</a>.onLanguage</code>，这个回调将在语言配置就绪时被调用。(我们稍后将使用这个回调来注册我们的语言提供者，以便进行语法突出显示、自动完成、格式化等。):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="5514" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在从入口点调用设置函数。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h1 id="5524" class="oc lx iq bd mt od oe of mw og oh oi mz jw oj jx nc jz ok ka nf kc ol kd ni om bi translated">为摩纳哥添加Web Workers</h1><p id="01af" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">到目前为止，如果您运行项目并在浏览器中打开它，您将得到一个关于web worker的错误:</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="5f05" class="lw lx iq ls b gy ly lz l ma mb">Could not create web worker(s). Falling back to loading web worker code in main thread, which might cause UI freezes. Please see <a class="ae ln" href="https://github.com/Microsoft/monaco-editor#faq" rel="noopener ugc nofollow" target="_blank">https://github.com/Microsoft/monaco-editor#faq</a><br/>You must define a function MonacoEnvironment.getWorkerUrl or MonacoEnvironment.getWorker</span></pre><p id="bfbe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">语言服务创造了web工作者来计算UI线程之外的繁重工作。就资源开销而言，它们几乎没有任何成本，只要让它们正常工作，您就不应该太担心它们(参见上面的跨域案例)。(<a class="ae ln" href="https://github.com/Microsoft/monaco-editor" rel="noopener ugc nofollow" target="_blank">出处</a>)止也<a class="ae ln" href="https://github.com/Microsoft/monaco-editor/blob/master/docs/integrate-esm.md" rel="noopener ugc nofollow" target="_blank">此</a>。</p><p id="716f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">摩纳哥编辑器使用一个web worker我认为它是用来突出显示和执行其他内置动作的。我们将创建另一个来处理我们的语言服务。</p><p id="ee4d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们先告诉webpack捆绑Monaco的编辑器web worker。将这一行添加到入口点:</p><pre class="kg kh ki kj gt lr ls lt lu aw lv bi"><span id="9d20" class="lw lx iq ls b gy ly lz l ma mb">entry: {</span><span id="5ca3" class="lw lx iq ls b gy on lz l ma mb">app: './src/index.tsx',</span><span id="20c9" class="lw lx iq ls b gy on lz l ma mb">"editor.worker": 'monaco-editor-core/esm/vs/editor/editor.worker.js'</span><span id="38ed" class="lw lx iq ls b gy on lz l ma mb">},</span></pre><p id="5df8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">更改输出，告诉webpack给web worker一个不带散列的特定名称，并按照Monaco的要求使用<code class="fe mc md me ls b">‘self’</code>作为全局对象。以下是目前为止webpack配置文件的内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="afe3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从上面的错误中我们可以看到，Monaco从全局变量<code class="fe mc md me ls b">MonacoEnvironment</code>调用了一个名为<code class="fe mc md me ls b">getWorkerUrl</code>的方法。转到设置功能并添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="492f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将告诉摩纳哥在哪里找到工人。我们将尽快添加我们的自定义语言服务人员。</p><p id="9ed3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行应用程序，您应该会看到一个尚不支持任何功能的编辑器:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/2cc3c31cb6047b1a0a1c1fccc6f64867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2aRAVuZ6CMtYlM7VyQ9bA.png"/></div></div></figure></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h1 id="f51e" class="oc lx iq bd mt od oe of mw og oh oi mz jw oj jx nc jz ok ka nf kc ol kd ni om bi translated">添加语法突出显示和语言配置</h1><p id="e0c4" class="pw-post-body-paragraph kr ks iq kt b ku nk jr kw kx nl ju kz la nm lc ld le nn lg lh li no lk ll lm ij bi translated">在这一节，我们将添加一些关键字荧光笔。</p><p id="c9b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Monaco Editor使用<a class="ae ln" href="https://microsoft.github.io/monaco-editor/monarch.html" rel="noopener ugc nofollow" target="_blank"> Monarch库</a>，它允许我们使用JSON创建声明式语法高亮器。如果想了解更多关于这种语法的知识，可以看看他们的文档。</p><p id="9108" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/microsoft/monaco-languages/blob/master/src/java/java.ts" rel="noopener ugc nofollow" target="_blank">这里有一个Java配置</a>的例子，用于语法高亮、代码折叠等。</p><p id="710b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe mc md me ls b">src/todo-lang</code>中创建一个名为<code class="fe mc md me ls b">config.ts</code>的文件。我们将使用Monaco API:<a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/modules/monaco.languages.html#setmonarchtokensprovider" rel="noopener ugc nofollow" target="_blank">Monaco . languages . setmonarch tokensprovider</a>配置TodoLang荧光笔和标记器。它有两个参数，语言ID和类型<code class="fe mc md me ls b"><a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/interfaces/monaco.languages.imonarchlanguage.html" rel="noopener ugc nofollow" target="_blank">IMonarchLanguage</a></code> <em class="lo">的配置。</em></p><p id="e739" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是TodoLang的配置:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="6a91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们基本上为TodoLang中的每种类型的关键字指定CSS类或标记名。例如，对于关键字<code class="fe mc md me ls b">COMPLETE </code>和<code class="fe mc md me ls b">ADD</code>，我们指示Monaco给它们一个类<code class="fe mc md me ls b">keyword</code> <strong class="kt ir"> <em class="lo"> </em> </strong>，对于类型关键字<code class="fe mc md me ls b">TODO</code>给它们一个类<strong class="kt ir"> <em class="lo"> </em> </strong> <code class="fe mc md me ls b">type</code>。我们还指示Monaco通过给字符串一个由Monaco预定义的<code class="fe mc md me ls b">string</code>类型的CSS类来给字符串着色。请记住，您可以通过使用<code class="fe mc md me ls b"><a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/modules/monaco.editor.html#definetheme" rel="noopener ugc nofollow" target="_blank">defineTheme</a></code> <a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/modules/monaco.editor.html#definetheme" rel="noopener ugc nofollow" target="_blank"> API </a>覆盖主题并添加新的CSS类，并在创建编辑器或使用<code class="fe mc md me ls b"><a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/modules/monaco.editor.html#settheme" rel="noopener ugc nofollow" target="_blank">setTheme</a></code>设置时指定它。</p><p id="3dc8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要让Monaco考虑这个配置，请转到设置函数，在<code class="fe mc md me ls b">onLanguage</code>回调中，调用<code class="fe mc md me ls b"><a class="ae ln" href="https://microsoft.github.io/monaco-editor/api/modules/monaco.languages.html#setmonarchtokensprovider" rel="noopener ugc nofollow" target="_blank">monaco.languages.setMonarchTokensProvider</a></code>，并将其配置作为第二个参数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="405c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行应用程序。编辑器现在应该支持语法高亮显示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/874770d95903735f43b63d5f07b4770f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*owARrYsbBCfqHOCmybb_zw.png"/></div></div></figure><p id="3fc4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是目前为止项目的源代码:<a class="ae ln" href="https://github.com/amazzalel-habib/TodoLangEditor/tree/add-syntax-highlighter" rel="noopener ugc nofollow" target="_blank">amazzalel-Habib/TodoLangEditor</a>。</p><p id="e253" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文的下一部分 ( <a class="ae ln" href="https://medium.com/better-programming/create-a-custom-web-editor-using-typescript-react-antlr-and-monaco-editor-bcfc7554e446" rel="noopener">查看这里</a>)中，我将介绍语言服务。我将使用ANTLR生成TodoLang lexer和解析器，并使用解析器提供的AST实现编辑器的大多数特性。然后我们将看到如何创建一个web worker来提供自动完成的语言服务。</p></div></div>    
</body>
</html>