<html>
<head>
<title>Build an E-Commerce Backend Using a GraphQL Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GraphQL引擎构建电子商务后端</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-an-e-commerce-backend-using-a-graphql-engine-c5f3bb9d9ca?source=collection_archive---------16-----------------------#2022-01-28">https://betterprogramming.pub/build-an-e-commerce-backend-using-a-graphql-engine-c5f3bb9d9ca?source=collection_archive---------16-----------------------#2022-01-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5744" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们使用Hasura通过最小化代码量来加快开发时间</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/eaf0d7f669e11e521e634dd89c163ce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NDN5G3-nFQ_QQlSx"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@synkevych?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">罗曼·辛克维奇</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6517" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在构建全栈应用程序的传统方法中，您需要手动构建后端和前端。</p><p id="1a97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">手动构建后端意味着您需要决定是使用REST还是GraphQL。根据您选择使用的内容，您需要定义GraphQL模式和解析器，编写数据库查询，并创建视图、控制器等等。</p><p id="8d9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然这种方法既没有错也没有坏，但是您可以通过自动化一些东西来加速您的开发。这就是哈苏拉出现的原因。</p><p id="97b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，您将使用Hasura构建一个电子商务应用程序的后端。最终，您将拥有一个实用的基本电子商务应用程序。</p><h1 id="ae18" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">哈苏拉是什么？</h1><p id="468b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Hasura是一个GraphQL引擎，可以将您的Postgres数据库转换为即时、实时的GraphQL API。</p><p id="e500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更简单地说，将PostgreSQL数据库连接到Hasura，它会根据数据库表/视图自动生成GraphQL模式和解析器。之后，您可以开始查询和变更您的数据。</p><p id="9b9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，如果应用程序需要支持REST端点呢？如果应用程序需要支持REST端点，您可以从命名查询和变异中创建它们。有了Hasura，你可以同时支持GraphQL和REST。</p><p id="f5ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，Hasura允许您将定制的GraphQL/REST API分别与远程模式和操作一起插入Hasura。</p><p id="957d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">概括一下:</p><ul class=""><li id="d41d" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">Hasura将您的Postgres数据库转换成一个GraphQL API。</li><li id="e9df" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">您的应用程序也可以支持REST端点。</li><li id="088b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">Hasura使您能够插入自定义API。</li></ul><h1 id="6035" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">电子商务数据建模</h1><p id="0f60" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们通过构建一个简单的电子商务应用程序来看看Hasura的能力。该过程的第一步是确定数据库的结构。</p><p id="9905" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图1展示了应用程序的数据库模式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/af76aab5ca4bf240b5870dfcc410f951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sSvjtWvvHnFaodWX.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图1 —电子商务数据建模</em></p></figure><p id="f11d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该数据库由四个表组成:</p><ul class=""><li id="8f3f" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">用户</li><li id="83fe" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">制品</li><li id="f04b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">订单项目</li><li id="07ab" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">命令</li></ul><p id="7f25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nf ng nh ni b">users</code>和<code class="fe nf ng nh ni b">order</code>是一对多的关系，也就是说一个用户可以有多个订单，但是一个订单只能属于一个用户。两个用户不能有相同的订单。</p><p id="ab91" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nf ng nh ni b">order</code>和<code class="fe nf ng nh ni b">order_item</code>的关系也是一对多的关系。一个订单可以包含多个项目，但同一订单项目不能属于多个订单。</p><p id="031f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nf ng nh ni b">order_item</code>和<code class="fe nf ng nh ni b">product</code>具有一对多的关系，这意味着一个订单项只与一个产品相关联。本质上，一旦用户将产品添加到购物车中，它就变成了订单项。<code class="fe nf ng nh ni b">order_item</code>在<code class="fe nf ng nh ni b">product</code>和<code class="fe nf ng nh ni b">order</code>之间创建了一个链接。</p><p id="1f6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经完成了数据建模，下一步是在Hasura中实现它。</p><h1 id="d921" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Hasura实现</h1><p id="5d38" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">有两种方法可以使用Hasura。可以用Docker在本地机器上使用，也可以用Hasura Cloud。教程使用Hasura Cloud来实现电子商务后端。</p><p id="e1d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你是第一次使用Hasura，你需要建立一个帐户和一个项目。遵循本指南<a class="ae kv" href="https://bit.ly/3FPvzot" rel="noopener ugc nofollow" target="_blank">和</a>，您应该在几分钟内就可以开始运行。</p><p id="19db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">设置好您的帐户和项目后，您应该在项目仪表板中。图2展示了您应该看到的页面。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/a4067b42b3787c848f6322b08defaf0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y4M3oOJR60n0ixll.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图2 — Hasura项目仪表板</em></p></figure><p id="0b08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实施包括:</p><ul class=""><li id="b0db" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">创建数据库表</li><li id="5a46" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">建立表之间的关系</li><li id="e6c3" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">定义权限规则</li><li id="0170" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">添加带有操作的自定义业务逻辑</li></ul><h1 id="b52e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建数据库</h1><p id="d233" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">实现的第一步是创建数据库。点击“数据”选项，如图2所示。这将把您带到数据库页面，在这里您可以连接一个现有的数据库或创建一个新的数据库。</p><p id="2b26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于本教程，建议创建一个新的数据库。需要注意的是，您需要一个Heroku帐户来创建一个新的数据库。如果您没有Heroku帐户，也不想创建一个，您可以将Hasura连接到一个现有的数据库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/9b4c1ed1dfb60aac9ee87348d046f772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DC4MFJYGXPztxQWu.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图3 — Heroku项目数据库页面</em></p></figure><p id="815f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图3展示了创建新数据库的过程。这个过程很快，所以你应该在几秒钟内就有一个新的数据库。</p><p id="2414" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦数据库准备就绪，您就可以通过点击“public”来访问它，如图4所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/77c85c1abb9cfbd5b5ff091068c63351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JYNsV-UDv4fnFu0y.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图4 —数据库仪表板</em></p></figure><p id="2bba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一阶段涉及构建表和关系。</p><h1 id="3f03" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">数据库表</h1><p id="804a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">既然已经建立了数据库，那么就该创建表了。在这一步中，您将创建四个表:用户、产品、订单、订单项目。</p><h1 id="1325" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">用户表</h1><p id="1611" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们先实现<code class="fe nf ng nh ni b">user</code>表。点击“Create Table”来创建一个新的表，如图4所示。</p><p id="4ec1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nf ng nh ni b">users</code>表格有以下字段和类型:</p><ul class=""><li id="98e2" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">id</code>(主键)= &gt; UUID</li><li id="acd6" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">name</code> = &gt;正文</li><li id="713c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">username</code> = &gt;正文</li><li id="273d" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">email</code> = &gt;正文</li><li id="cdb1" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">password</code> = &gt;文本</li><li id="db43" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">updated_at</code> = &gt;时间戳</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/f49dd7417c999927f99c61a57de9d03b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V2tIqSZvC0lnQrHu.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图5 —创建“用户”表</em></p></figure><p id="cd31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在图5中，您可以看到所有的字段、它们的类型以及用于主键的字段。</p><p id="e9eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加所有字段并选择主键后，按“添加表”创建表。</p><h1 id="5741" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">产品表</h1><p id="7fd4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您还需要实现product表，该表具有以下字段和类型:</p><ul class=""><li id="d557" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">id</code>(主键)= &gt; UUID</li><li id="9ea8" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">name</code> = &gt;正文</li><li id="a625" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">description</code> = &gt;文本</li><li id="1587" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">price</code> = &gt;数字</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/a1d7194cfb890ca4a50209ee18c74b3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M1RC9NasD_z_cMTB.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图6 —创建“产品”表</em></p></figure><p id="ef29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建字段并选择主键后，将表保存到数据库中。</p><h1 id="e677" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">订单表</h1><p id="0406" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">下一个要创建的表是“Order”表，它有以下字段:</p><ul class=""><li id="3ba8" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">id</code>(主键)= &gt; UUID</li><li id="df41" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">city</code> = &gt;正文</li><li id="2e31" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">country</code> = &gt;文本</li><li id="1953" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">street_name</code> = &gt;正文</li><li id="68a2" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">house_number</code> = &gt; Int</li><li id="a592" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">zip_code</code> = &gt;正文</li><li id="3914" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">ordered</code> = &gt;布尔型</li><li id="c917" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">total</code> = &gt;数字</li><li id="83b3" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">created_at</code> = &gt;时间戳</li><li id="e00b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">user_id</code>(外键)= &gt; UUID</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/3e07d2b2c068a3d7eea42c3f792377e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s2OXQLgGgo0Fwsho.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图7 —创建“订单”表</em></p></figure><p id="bcc0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图7展示了您的表应该是什么样子。完成设置后，将表添加到数据库中。</p><h1 id="0c00" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">订单项目表</h1><p id="9a0c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">最后创建的表格是<code class="fe nf ng nh ni b">order_item</code>。该表包含以下字段和类型:</p><ul class=""><li id="fb9c" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">id</code>(主键)= &gt; UUID</li><li id="e809" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">quantity</code> = &gt; Int</li><li id="b82f" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">product_id</code>(外键)= &gt; UUID</li><li id="a5ba" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">order_id</code>(外键)= &gt; UUID</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/be7ca4599dab5366ba4250cf1ae9651e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Kn8BGWviWwGWARJb.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图8 —创建“订单_项目”表</em></p></figure><p id="993f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保存表，表的创建就完成了。</p><h1 id="78f5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">关系</h1><p id="ff0d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">虽然创建了表，但它们之间没有任何联系。下面的步骤是创建表之间的关系。在Hasura中，有两种方法可以创建关系:</p><ol class=""><li id="b66e" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr nn mv mw mx bi translated">根据外键约束定义的关系</li><li id="362b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nn mv mw mx bi translated">手动创建的关系(当不可能使用外键约束时)</li></ol><p id="0b2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个电子商务应用程序中，我们将从外键约束创建关系。</p><h1 id="7306" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">用户-订单关系</h1><p id="a72f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">第一步是导航到“order”表中的“Modify”选项卡，并单击“Add a foreign key”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/832f5636e72a5d06be40543855bca337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Fnga7La71sjxo4vI.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图9 —修改表格</em></p></figure><p id="72f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击按钮后，您就可以设置外键了。添加<code class="fe nf ng nh ni b">user_id</code>作为<code class="fe nf ng nh ni b">users</code>表中<code class="fe nf ng nh ni b">id</code>列的外键。</p><p id="d110" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图10展示了添加外键的过程。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/7df8e3121d1b6f375db6bd68bc26af6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ADb1qe8OmRygDNHk.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图10 —添加外键</em></p></figure><p id="b476" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成后，点击“保存”按钮。</p><p id="e469" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Hasura很聪明，可以根据添加的外键建议潜在的关系。因为您添加了外键，所以Hasura知道:</p><ul class=""><li id="04bb" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">一个订单只属于一个用户</li><li id="09cf" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">一个用户可以有多个订单</li></ul><p id="f3d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您转到“关系”选项卡<em class="np">(图9中“修改”选项卡旁边)</em>，您应该会看到建议的关系。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/bfa9c7732e5745e646c09a5486a9c7d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dFJ5t3fB0GDL_-cm.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图11 —建议的关系</em></p></figure><p id="d7ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击“添加”按钮，命名你的关系(或保留默认名称)，按“保存”，你就完成了一半。</p><p id="75c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在转到被引用表“用户”中的“关系”选项卡</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/dfdc3c60a9057bc52a42760dd92abf73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hobYDGH5lZjz0NPL.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图12 —建议的关系</em></p></figure><p id="54cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以看到它再次暗示了一段新的关系。这一次，隐含的关系是一个“数组关系”，这意味着用户可以拥有一个名为orders的嵌套对象数组。简单来说，用户可以有多个订单。</p><h1 id="0fc4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">订单-订单项目关系</h1><p id="654d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在表<code class="fe nf ng nh ni b">order</code>和<code class="fe nf ng nh ni b">order_item</code>之间建立关系的过程类似。</p><p id="b7db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到<code class="fe nf ng nh ni b">order_item</code>表，添加<code class="fe nf ng nh ni b">order_id</code>作为<code class="fe nf ng nh ni b">order</code>表中<code class="fe nf ng nh ni b">id</code>列的外键。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/8051ff4929f71e3fcbb20a675913e5ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MG3x2MNv_V__Wx1l.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图13 —添加外键</em></p></figure><p id="974c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为练习，从两个表转到“Relationships”选项卡，接受建议的关系。请记住，一个订单项目只能属于一个订单，而一个订单可以有多个项目。</p><p id="043c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nf ng nh ni b">order_item</code>表中的关系应该是对象关系，而“<code class="fe nf ng nh ni b">order</code>表中的关系应该是数组关系。</p><h1 id="073a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">订单项目-产品关系</h1><p id="5ca9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">最后一个关系是表<code class="fe nf ng nh ni b">order_item</code>和<code class="fe nf ng nh ni b">product</code>之间的关系。</p><p id="38e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，进入<code class="fe nf ng nh ni b">order_item</code>表中的“修改”选项卡。然后添加<code class="fe nf ng nh ni b">product_id</code>作为<code class="fe nf ng nh ni b">product</code>表中<code class="fe nf ng nh ni b">id</code>列的外键。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/aa4a086b46d5673df76d2bbacc1aad7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yzSeve93CVmPCswN.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图14 —添加外键</em></p></figure><p id="afeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是转到两个表的“Relationships”选项卡，接受建议的关系。<code class="fe nf ng nh ni b">order_item</code>表中的关系应该是对象关系，而<code class="fe nf ng nh ni b">product</code>表中的关系应该是数组关系。</p><p id="8818" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">表和关系都已就位。这意味着剩下的唯一事情就是设置权限！</p><p id="eaff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于创建关系的更深入的信息，我建议查看关于<a class="ae kv" href="https://bit.ly/3nSbyYo" rel="noopener ugc nofollow" target="_blank">关系</a>的文档。</p><h1 id="7884" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">权限规则</h1><p id="b696" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用Hasura，您可以在三个级别定义访问控制规则:</p><ol class=""><li id="94e3" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr nn mv mw mx bi translated">角色级别</li><li id="bff5" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nn mv mw mx bi translated">表格级别</li><li id="5449" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nn mv mw mx bi translated">操作(插入、选择、更新、删除)级别</li></ol><p id="2e6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，您将使用所有这些工具。</p><h1 id="a4b6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">用户表权限</h1><p id="7a9b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们为<code class="fe nf ng nh ni b">users</code>表定义权限规则。首先选择<code class="fe nf ng nh ni b">users</code>工作台，然后点击<code class="fe nf ng nh ni b">Permissions</code>选项卡。</p><p id="f712" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">进入权限页面后，添加一个名为<strong class="ky ir">用户</strong>的新角色。图15中的箭头说明了应该在哪里添加新角色。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/e1f65d0a06069a0409406a148b755910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*m6IAx1zQCwdOTJUb.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图15 —用户表权限</em></p></figure><p id="f9c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在继续之前，让我们定义一下用户应该能够做什么:</p><ul class=""><li id="dd10" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">用户应该只能看到自己的详细信息，而不能看到其他用户的详细信息。</li><li id="ecf1" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">用户应该能够更新他们的记录。</li></ul><p id="cd07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于这些规则，您只需要更新操作“选择”和“更新”</p><h2 id="0519" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated"><strong class="ak">选择(读取)</strong></h2><p id="92f6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">单击“选择”，您将能够添加规则。</p><p id="9470" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如图16所示，您需要添加以下自定义检查:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="8f57" class="ns lt iq ni b gy oi oj l ok ol">{<br/>    "id": {<br/>         "_eq": "X-Hasura-User-Id"<br/>     }<br/>}</span></pre><p id="18e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过使用下拉框来添加检查—您不需要手动编写它。上述检查确保用户只能访问他们的记录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/f7ce5d546d68b42ae26b9f11a72d6e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-Q_ECwRkx5whunlP.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图16 —定义的权限规则</em></p></figure><p id="b568" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请确保您还检查了您希望对用户可用的字段。在这种情况下，用户可以看到他们的:</p><ul class=""><li id="cbb8" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">id</code></li><li id="7f0e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">email</code></li><li id="0060" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">name</code></li><li id="2b7b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">username</code></li><li id="40cb" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">上次更新的时间</li></ul><p id="ede4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成后保存权限。</p><h2 id="5785" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated"><strong class="ak">更新</strong></h2><p id="269b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Hasura的一个有用之处是您可以重用自定义检查。选择与“更新”动作选择相同的自定义检查选项<strong class="ky ir">，如图17所示。</strong></p><p id="ace9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，用户应该能够更新除了ID以外的一切。选中除ID之外的所有框，并保存权限。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/9193fd8b7591125ff1650f9642a29c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eOj0NfNTWrf6OHXm.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图17 —定义权限规则</em></p></figure><p id="d913" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">已经为用户设置了规则，至此，您已经在所有三个级别定义了访问控制规则。</p><h2 id="a2a2" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated"><strong class="ak">插入—公共角色</strong></h2><p id="a490" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">稍后，您将添加允许人们注册的附加功能。注册过程将散列人们的密码，并将他们的详细资料添加到数据库中。</p><p id="82d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为“用户”角色指的是注册的人，所以您需要另一个角色来代表未经身份验证的人。你可以称之为“公共”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/83098bb26b5322ca591cc3396e85b535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tuKmkIsOQ7QKXhgT.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图18 —定义公共许可规则</em></p></figure><p id="5c76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一个公共角色，不需要任何检查。配置权限规则，如图18所示。</p><h2 id="755d" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated"><strong class="ak">选择—公共角色</strong></h2><p id="dfd0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当一个未经身份验证的人注册时，服务器返回新创建的用户的ID。为此，您需要为“选择”操作定义权限规则。</p><p id="fd14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加图19中的自定义检查是必要的。如果检查不存在，未经身份验证的用户可以看到所有其他用户的个人详细信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/08691a1a37741715b1931de9109cbf1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6fV8Gdj0bccbgVfU.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图19 —定义公共许可规则</em></p></figure><p id="d1b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为注册只返回新创建用户的id，所以只检查<code class="fe nf ng nh ni b">id</code>字段。</p><h1 id="c0c0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">产品表权限</h1><p id="7359" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">无论用户是否登录，都应该可以看到这些产品。这意味着您可以重用“公共”角色。</p><h2 id="e128" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated"><strong class="ak">选择(读取)</strong></h2><p id="a55a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">转到“权限”选项卡，添加新的权限。启用选项<strong class="ky ir">而不进行任何检查</strong>并选择应该显示的产品字段。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/2630fbaae9fb79b401eead9dc7fe1ccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UWqfWGLDje3i17jg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图20 —定义公共权限</em></p></figure><p id="8632" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在继续之前，您还需要允许登录的用户获取产品。对“用户”角色应用与“公共”角色相同的权限。此外，还要检查<code class="fe nf ng nh ni b">id</code>字段。登录的用户应该能够看到所有产品字段。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/05bdcba8558db70c46c6200b4cd6c782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2uVQ8U85JPzpicnP.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图21 —定义用户权限</em></p></figure><p id="65e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">经过身份验证和未经身份验证的用户都应该只能看到产品，而不能改变它们。这意味着他们无权创建、更新或删除产品。</p><h1 id="42ee" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">订单表权限</h1><p id="5112" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">对于订单，用户应该只能看到他们的订单。他们不应该得到其他人的命令。</p><h2 id="cb6f" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">**选择(读取)**</h2><p id="8eca" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">转到<code class="fe nf ng nh ni b">order</code>表，然后转到“权限”选项卡。单击“用户”角色的“选择”操作，并添加以下自定义检查:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="a76f" class="ns lt iq ni b gy oi oj l ok ol">{<br/>    "user_id": {<br/>        "_eq":" X-Hasura-User-Id"<br/>     }<br/>}</span></pre><p id="8f04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的自定义检查确保只有下订单的用户才能访问它。此外，检查您希望查询返回的字段。在这种情况下，它应该返回所有的字段，因为用户应该能够访问关于订单的所有信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/ccf611e618e5b8ea1495efb30afda331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QmAkIpRxX1YFq0IO.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图22 —订单的用户权限</em></p></figure><h2 id="db2a" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated"><strong class="ak">插入</strong></h2><p id="0ea8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">除了看到他们的订单，用户还应该能够创建新的订单。单击“插入”操作添加权限规则。</p><p id="f7dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">！【Hasura定义权限规则】(截图2021–12–06 at 22 . 44 . 41 . png)(https://cdn . hash node . com/RES/hash node/image/upload/v 1638823532467/88 fjv 8 rd 0 . png)<em class="np">图23 —订单的用户权限</em></p><p id="9418" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加与图23相同的权限规则。</p><h2 id="1164" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated"><strong class="ak">更新</strong></h2><p id="0fe6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">用户还需要更新订单的权限。单击“更新”操作，选择除以下列之外的所有列:</p><ul class=""><li id="eb83" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">created_at</code></li><li id="daa0" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">id</code></li><li id="c454" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">user_id</code></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/4d5d8cf28eb4330198023fe24bec22a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Aejs2H5zyiWwoJIH.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图24 —订单的用户权限</em></p></figure><p id="721e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用户可以插入、读取和更新订单，但不能删除现有订单。</p><h1 id="1a17" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">订单项目权限</h1><p id="4069" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">要创建订单项目，登录用户应该有权插入它们。</p><h2 id="af01" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated"><strong class="ak">插入</strong></h2><p id="1beb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">转到<code class="fe nf ng nh ni b">order_item</code>中的“权限”选项卡，添加以下规则:</p><ul class=""><li id="657b" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">允许登录用户插入<code class="fe nf ng nh ni b">quantity</code>、<code class="fe nf ng nh ni b">product_id</code>和<code class="fe nf ng nh ni b">order_id</code></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/fef7aa75cf6df33cbf20b85c4a4dce10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9B8mgxUbBeeKn-6X.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图25 —订单项目的用户权限</em></p></figure><p id="fc8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图25展示了插入订单项目的用户权限。</p><h2 id="af03" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated"><strong class="ak">选择</strong></h2><p id="e472" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">用户还应该能够从他们的订单中看到项目。为了避免用户访问其他人的订单项目，您需要添加一个自定义检查。</p><p id="df45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它检查订单项所属的用户订单是否与发出请求的用户id匹配。如果您查看图26中的检查，会更有意义。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/6ae1755c6cb11d6854b59472bb7e8463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nNRXopmf3I6Ic_2w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图26 —订单项目的用户权限</em></p></figure><p id="22e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然所有的权限都到位了，我们可以进入下一章——用Hasura动作实现定制的业务逻辑。</p><p id="d865" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我建议查看关于<a class="ae kv" href="https://bit.ly/3CZ2VzA" rel="noopener ugc nofollow" target="_blank">配置权限规则</a>的文档部分，以获得关于权限规则的深入信息。</p><h1 id="5e32" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">自定义业务逻辑</h1><p id="e8f2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">尽管Hasura生成了您需要的大部分内容，但您可能需要添加定制的业务逻辑，比如定制查询或变异。</p><p id="c295" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Hasura允许您通过Hasura操作添加自定义业务逻辑。此外，您可以使用动作进行数据验证和转换。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/31047488e8ceebe3adbeff02f10d4868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r6U8flCQGyEbFd55.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图27 — Hasura动作</em></p></figure><p id="739e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于电子商务应用程序，您可以使用Hasura操作来:</p><ul class=""><li id="ec4c" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">注册和登录用户</li><li id="90f6" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">将商品添加到购物车</li><li id="9d24" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">下订单</li></ul><p id="df94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“Actions”是一个强大的工具，使您能够定制您的Hasura应用程序，以满足您的需要和要求。</p><h2 id="00ac" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">存取关键字</h2><p id="6f69" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在编写定制业务逻辑之前，您需要检索Hasura访问键。访问键使您能够向Hasura的GraphQL端点发出请求。</p><p id="a1c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到Hasura主仪表板，其中列出了您的所有项目。然后点击齿轮图标打开你的项目设置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/06c60bd5707161fdd0893df243798737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hUxNofAsduDU8o8X.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图28 — Hasura仪表盘</em></p></figure><p id="d612" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦你进入设置页面，进入“环境变量”选项来获取你的管理密码/访问密钥。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/05d433d9d6e1b901609ffc56e284eda8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pVUHildkJrGezr0k.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图29 —项目设置</em></p></figure><p id="5828" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这个项目，您将使用Node.js并在Heroku上部署代码。部署代码后，您需要将密钥作为环境变量添加到项目中。您将在对Hasura GraphQL端点的每个请求中传递它。</p><p id="4d6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">稍后当您编写自定义逻辑时，会详细介绍这一点。</p><h2 id="acb8" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">证明</h2><p id="bbb7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">该应用程序应该允许人们注册，但目前，没有办法做到这一点。让我们创建一个允许人们注册的自定义变异。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/eed0a77f42ea32aabfb66531a2f1d9a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AWebZIruz4ZT1A8b.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图30 —哈苏拉行动</em></p></figure><p id="2379" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到操作页面，点击“创建”按钮将打开一个新页面，您可以在其中设置新操作。</p><p id="cef7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在此页面上，您可以定义以下内容:</p><ul class=""><li id="949b" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">操作的类型—查询或变异</li><li id="bedd" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">行动本身</li><li id="fc9f" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">处理程序—执行您希望运行查询或变异的逻辑</li><li id="81d0" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">通信类型—同步或异步</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/78c404afb3544b80789d6b326656ec82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XViSzLjOGUp478_p.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图31 — Hasura操作页面</em></p></figure><p id="ed63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从定义类型和动作开始。动作类型和定义如下:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="45e3" class="ns lt iq ni b gy oi oj l ok ol">type Mutation {<br/>  register(<br/>    name: String!<br/>    username: String!<br/>    email: String!<br/>    password: String!<br/>  ): RegisterResponse<br/>}</span></pre><p id="aba2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个动作也应该返回一些东西。在这种情况下，让我们返回新注册用户的<code class="fe nf ng nh ni b">id</code>。</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="7022" class="ns lt iq ni b gy oi oj l ok ol">type RegisterResponse {<br/>  id: uuid!<br/>}</span></pre><p id="3f80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于“Handler”选项，您可以暂时保持不变。实现操作后，您将部署代码并用适当的URL更新处理程序。</p><p id="45a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，如果处理程序URL是<code class="fe nf ng nh ni b">apps-aws.hasuractions.com/register</code>，您需要用这个URL更新“动作处理程序”。</p><p id="ecf4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，保存动作，让我们开始构建处理程序。</p><h2 id="54c0" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">派生动作</h2><p id="661a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">但是还有另一种方法来创建动作。Hasura可以从一个突变或查询中自动派生出一个动作。转到项目仪表板中的“API”选项卡。</p><p id="57b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在GraphiQL中，编写以下变体:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="a014" class="ns lt iq ni b gy oi oj l ok ol">mutation ($name: String!, $username: String!, $email: String!, $password: String!) {<br/>  insert_users_one(object: {<br/>    name: $name,<br/>    username: $username,<br/>    email: $email,<br/>    password: $password<br/>  }) {<br/>    id<br/>  }<br/>}</span></pre><p id="2e85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在编写完变异之后，点击“Derive action”按钮，如图32所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/cbd75b469d2f62a9f0854c4d94326bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xriSP7914i1LqYYa.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图32 —衍生动作</em></p></figure><p id="ce4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将带您进入可以创建新操作的页面。这与图31中显示的页面相同。按照手动创建动作时的相同步骤进行操作，并保存它。</p><p id="f958" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，Hasura还会为您生成代码。如果您转到“Codegen”选项卡，您应该会看到生成的代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/b42a70dec0d669ccc5dc7582290cc42d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*S9BRLMppBzYNt0dL.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图33 —代码生成</em></p></figure><p id="748e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，我们只需要对自动生成的代码做一点小小的修改。即加密存储在数据库中的密码。</p><p id="5ee0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">%[https://gist . github . com/catalinpit/9 E1 b5 a 36 f 4d 420034 a 20 a 304 e 008 CAC 9]</p><p id="baf1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的要点显示了注册突变的代码。唯一添加到自动生成代码中的是第40行，它对密码进行加密。</p><h2 id="c066" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">部署代码</h2><p id="e5d0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在使用新创建的操作之前，您需要部署代码。因此，让我们为部署准备服务器。</p><p id="c42d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击“代码生成”选项卡中的<em class="np"> Starter-kit.zip </em>选项，下载启动代码(图33)。您下载的初学者工具包是一个简单的Node.js服务器。您可以专注于编写定制的业务逻辑，而不是从头开始启动和配置服务器。</p><p id="40ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您最喜欢的代码编辑器中打开初学者工具包，然后转到<code class="fe nf ng nh ni b">src/server.js</code>。您应该会看到以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="7124" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以删除<code class="fe nf ng nh ni b">/hello</code>路线，并将上面要点中的代码添加到它的位置。您可以在这个<a class="ae kv" href="https://github.com/catalinpit/hasura-actions/tree/main/register-action" rel="noopener ugc nofollow" target="_blank">库</a>中看到完整的服务器代码。</p><p id="214b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您的应用程序已经可以部署了。可以免费部署Node.js服务器的一个地方是Heroku。查看本<a class="ae kv" href="https://devcenter.heroku.com/articles/git" rel="noopener ugc nofollow" target="_blank">指南</a>关于部署到Heroku。</p><p id="1319" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">部署应用程序后，确保设置Hasura访问密钥(来自第<a class="ae kv" href="#heading-access-key" rel="noopener ugc nofollow">节访问密钥</a>)。您需要在Heroku中将它添加为环境变量。查看这篇文章，了解如何在Heroku 中设置环境变量。</p><h2 id="c187" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">更新处理程序</h2><p id="4a08" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">成功部署后，您的应用程序应该有一个可以访问它的公共URL。比如，我的申请网址是<code class="fe nf ng nh ni b">crorit.herokuapp.com</code>。</p><p id="610f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要更新处理程序URL:</p><ul class=""><li id="d354" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">转到Hasura Dashboard中的“注册”操作</li><li id="3d66" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">选择“修改”选项卡</li><li id="01a8" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">添加处理程序URL</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/19330a2041f7003c8ad0a91e7ea8d659.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XoUNumMaHJfpe1em.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图34 —更新的处理器URL </em></p></figure><p id="c0a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保存更改，您就完成了！用户现在可以注册。</p><h1 id="1f96" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">操作权限</h1><p id="7dbd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">默认情况下，操作被配置为仅供管理员使用。这意味着只有管理员可以执行这些突变。</p><p id="c2ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是您可能需要其他类型的用户来执行这些改变。在这种情况下，未经授权的人应该能够注册。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/7c38b51049caac116c3f71687f8127a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bu1bV07nqXiHy4hX.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图35 —动作权限</em></p></figure><p id="8500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在动作的“权限”选项卡中，允许<strong class="ky ir">公共</strong>角色的动作。点击“x ”,然后点击“保存”。</p><p id="6243" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你需要更多的信息，Hasura文档详细介绍了<a class="ae kv" href="https://hasura.io/docs/latest/graphql/core/auth/index.html" rel="noopener ugc nofollow" target="_blank">认证和授权</a>。</p><h2 id="27a0" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">测试动作</h2><p id="811d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们通过运行以下变异来测试注册过程:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="245f" class="ns lt iq ni b gy oi oj l ok ol">mutation {<br/>    register(<br/>        name: "Hasura Action",<br/>        username: "haac",<br/>        email: "haac@gmail.com",<br/>        password: "this_IS_password1!"<br/>    ) {<br/>        id<br/>    }<br/>}</span></pre><p id="ef66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:在运行变异之前，不要忘记将<code class="fe nf ng nh ni b">x-hasura-role</code>设置为“公共”。</p><p id="7337" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过检查Hasura中的记录来检查突变是否成功。查询所有用户表明操作成功。</p><p id="155d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图36展示了通过“注册”操作添加的用户。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/4142b86a3c45ae64d57ce1f815ab1bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4ZH3kSd4fPO7mUZf.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图36 —用户表</em></p></figure><p id="7513" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每当您需要扩展应用程序的功能时，您可以通过“操作”创建自定义查询或变异。</p><h2 id="22fe" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">创建订单项目</h2><p id="f216" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">该应用程序还需要一个定制的变异来创建订单项。在GraphiQL中，编写以下变体:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="3c57" class="ns lt iq ni b gy oi oj l ok ol">mutation createOrderItem($product_id: uuid, $quantity: Int!, $order_id: uuid){<br/>  insert_order_item_one(object: {<br/>    product_id: $product_id,<br/>    quantity: $quantity,<br/>    order_id: $order_id<br/>  }) {<br/>    id<br/>  }<br/>}</span></pre><p id="8c63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在编写完变异之后，点击选项“Derive Action”，就像您对注册操作所做的那样(图32)。</p><p id="a16b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Hasura自动生成动作定义和类型。对于这个定制的变异，您不需要修改任何东西。您可以在不更改处理程序URL的情况下保存操作，因为您将在部署应用程序后更新它。</p><p id="99c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保存新动作后，转到“Codegen”选项卡(图33 ),查看由Hasura生成的代码，并下载初学者工具包。</p><p id="df97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">自动生成的代码是这个操作的良好起点，但是我们还需要编写定制的业务逻辑。</p><p id="1474" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个动作的逻辑是什么？</p><ol class=""><li id="681c" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr nn mv mw mx bi translated">在创建<code class="fe nf ng nh ni b">order</code>项目之前，检查用户是否有未结订单。</li><li id="5351" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nn mv mw mx bi translated">如果用户没有未完成的订单或有已完成的订单，请先创建一个订单。之后，创建<code class="fe nf ng nh ni b">order</code>项，并将其添加到新创建的订单中。</li><li id="3fc0" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nn mv mw mx bi translated">如果用户有一个未结订单，创建<code class="fe nf ng nh ni b">order</code>项目并将其添加到现有订单中。</li></ol><h1 id="7d6c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">执行功能</h1><p id="c626" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">首先，我们先来概括一下<code class="fe nf ng nh ni b">execute</code>函数。该函数应采用以下参数:</p><ul class=""><li id="3747" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">变量</li><li id="deed" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">操作GraphQL查询或变异</li><li id="592c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">请求标题</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="1790" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以针对不同的查询和变化重用该函数。</p><h2 id="4bf8" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">附加查询/突变</h2><p id="b244" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Hasura给出了在自动生成的代码中创建新的<code class="fe nf ng nh ni b">order</code>项的第一个突变。</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="17a9" class="ns lt iq ni b gy oi oj l ok ol">const CREATE_ORDER_ITEM = `<br/>mutation createOrderItem($product_id: uuid, $quantity: Int!, $order_id: uuid) {<br/>  insert_order_item_one(object: {<br/>    product_id: $product_id,<br/>    quantity: $quantity,<br/>    order_id: $order_id<br/>  }) {<br/>    id<br/>  }<br/>}`;</span></pre><p id="9898" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是在创建<code class="fe nf ng nh ni b">order</code>项目之前，您需要检查用户是否有任何未完成的订单。为此，您需要另一个查询，如下所示:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="3d20" class="ns lt iq ni b gy oi oj l ok ol">const USER_ORDER_EXISTS = `query getUserOrder($user_id: uuid) {<br/>  users(where: {id: {_eq: $user_id}}) {<br/>    orders(order_by: {created_at: desc}) {<br/>      created_at<br/>      id<br/>      ordered<br/>    }<br/>  }<br/>}`;</span></pre><p id="5fac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果用户没有任何订单，上述查询将返回一个空数组。因此，如果它返回一个空数组，我们需要创建一个新的订单。</p><p id="2e9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以使用以下变体创建新订单:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="c417" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，订单充当购物车。这意味着您创建了一个没有地址的新订单。它的目的是简单地跟踪用户想要购买的商品。</p><p id="d2e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，订单充当购物车。这意味着您创建了一个没有地址的新订单。它的目的是简单地跟踪用户想要购买的商品。</p><h2 id="0ace" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">构建处理程序</h2><p id="1ad2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">下一阶段包括构建处理程序本身。让我们从将请求输入和消息头存储在单独的变量中开始，这样就可以更容易地访问它们。</p><p id="31be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为最新的订单创建一个空变量。该变量将被赋予用户的顺序。</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="40bb" class="ns lt iq ni b gy oi oj l ok ol">app.post('/createOrderItem', async (req, res) =&gt; {<br/>    const { product_id, quantity } = req.body.input;<br/>    const user_id = req.body.session_variables['x-hasura-user-id'];<br/>    let latest_order = '';<br/>});</span></pre><p id="222f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一步是检查用户是否有订单。您使用以下参数调用<code class="fe nf ng nh ni b">execute</code>方法:</p><ul class=""><li id="9817" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">发出请求的用户的ID</li><li id="7cbc" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">GraphQL查询<code class="fe nf ng nh ni b">USER_ORDER_EXISTS</code></li></ul><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="8a62" class="ns lt iq ni b gy oi oj l ok ol">// check if the user has any orders<br/>const { data: orderExists, errors: orderExistsErr } = await execute({ user_id }, USER_ORDER_EXISTS, req.body.session_variables);<br/><br/>if (orderExistsErr) {<br/>    return res.status(400).json({ error: orderExistsErr[0].message });<br/>}</span></pre><p id="75dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nf ng nh ni b">USER_ORDER_EXISTS</code>查询返回一个名为<code class="fe nf ng nh ni b">orders</code>的数组。如果用户没有任何订单，它将返回一个空数组。如果用户有订单，它将返回一个包含所有订单的数组。</p><p id="b7c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在图37中，您可以看到一个没有任何订单的用户的例子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/baaad5efdc5beb5da353abbc4388b633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vBjSMlWRoInCFWhk.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图37 —无用户订单</em></p></figure><p id="210e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图38展示了一个用户订购的例子。该查询返回订单的创建时间和订单ID。</p><p id="9aa7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">订单ID是必需的，因为您将需要它来向订单追加订单项目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/862fcc8a40ee8443fc142354b2e3a6b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5RDeG4-B1K3wqqzK.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图38 —用户订单</em></p></figure><p id="1043" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将我们带到下一步，我们将订单分配给<code class="fe nf ng nh ni b">latest_order</code>变量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="3daa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码检查<code class="fe nf ng nh ni b">orders</code>数组是否为空，或者最新的订单是否完成。如果数组为空或者最新的订单已完成，它将运行<code class="fe nf ng nh ni b">CREATE_USER_ORDER</code>变异为发出请求的用户创建一个新订单。考虑到变异是成功的，它将新创建的订单的ID赋给<code class="fe nf ng nh ni b">latest_order</code>变量。</p><p id="d5ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">否则，如果<code class="fe nf ng nh ni b">orders</code>数组不为空或最新订单未完成，它将最后一个未完成订单的id分配给<code class="fe nf ng nh ni b">latest_order</code>。</p><p id="a995" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此时，无论用户已经有了一个订单还是创建了一个新订单，都有一个活动订单。这意味着可以创建<code class="fe nf ng nh ni b">order</code>商品并将其添加到订单中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="0568" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">操作代码已经完成，您可以使用它来创建订单项目。你可以在这个<a class="ae kv" href="https://gist.github.com/catalinpit/51dbb1691e23431237d83ffd0d6da9d9" rel="noopener ugc nofollow" target="_blank">要点</a>中看到动作的完整代码。</p><h2 id="24f8" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">部署代码</h2><p id="772e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在使用新创建的操作之前，您需要部署新代码。为了保持事物的分离并使其更容易理解，我们将为所有的动作提供一个单独的Node.js服务器。</p><p id="f111" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着您需要创建一个新的节点服务器。这些步骤类似于您对<code class="fe nf ng nh ni b">register</code>动作所做的:</p><ul class=""><li id="48b8" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">下载初学者工具包</li><li id="6f24" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">添加必要的代码(用<code class="fe nf ng nh ni b">src/server.js</code>文件中上述要点的代码替换<code class="fe nf ng nh ni b">/hello</code>路线)</li><li id="ac9c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">部署应用程序</li></ul><p id="967f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这个<a class="ae kv" href="https://github.com/catalinpit/hasura-actions/tree/main/create-order-item" rel="noopener ugc nofollow" target="_blank">库</a>中看到完整的服务器代码。</p><h2 id="9df7" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">修改操作</h2><p id="ae1d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">查看图37(如上)，您可以看到动作定义包含了<code class="fe nf ng nh ni b">order_id</code>字段。</p><p id="eae9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，我们不必再手动传递它了。只有经过身份验证的用户才能创建订单项，因此根据发出请求的用户自动传递<code class="fe nf ng nh ni b">order_id</code>。</p><p id="9ff6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到<code class="fe nf ng nh ni b">createOrderItem</code>操作，点击“修改”选项卡。之后，删除带有<code class="fe nf ng nh ni b">order_id</code>的行并保存。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/ff9fc9decbe4f252089e56ede24eba22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mNB4bzipWOFW0OwZ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图39 — Hasura修改动作</em></p></figure><p id="6f86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图39展示了此时的操作。</p><p id="17e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要更新的最后一件事是动作处理程序。用URL更新处理程序，就像对<code class="fe nf ng nh ni b">register</code>动作那样。</p><p id="c858" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是测试动作的时候了，看看它是否正常工作。</p><h1 id="1470" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">操作权限</h1><p id="1ac7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">类似于设置注册的动作权限，允许“用户”角色执行<code class="fe nf ng nh ni b">createOrderItem</code>突变。</p><p id="17b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参考图35。</p><h2 id="b0fe" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">测试动作</h2><p id="3e53" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们通过运行以下变异来尝试创建一个新的订单项:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="209a" class="ns lt iq ni b gy oi oj l ok ol">mutation {<br/>    createOrderItem (<br/>        product_id: "00209df6-d11a-4b04-b7e2-9cf1fa122215",<br/>        quantity: 10<br/>    ) { id }<br/>}</span></pre><p id="aa8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该操作工作正常，并创建了新的订单项目。在图40中，您可以看到它返回了新创建的订单项的id。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/9a135cb35aaa05b4a51f1b03f217665d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VGCMGC6lhR0u35AX.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图40 —创建订单项目突变</em></p></figure><p id="fb17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果查看数据库，您可以看到,<code class="fe nf ng nh ni b">order</code>商品已成功创建并添加到订单中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/173509c706aa576c083f8fdfa761cd99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*n5qqcQvVNSinY2w7.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图41 —新订单项目</em></p></figure><p id="e8f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将带我们进入下一步——下订单！</p><h2 id="0b7e" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">订购</h2><p id="b8ba" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">最后，我们需要一个定制的变异，允许用户下订单。下订单将使用户能够输入他们的详细地址，计算支付总额，并将<code class="fe nf ng nh ni b">ordered</code>变为真。</p><p id="a354" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从Hasura仪表板转到GraphiQL编辑器，编写以下变化:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="35c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">变异可能看起来很复杂，所以让我来解释一下。突变:</p><ul class=""><li id="be83" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">查找具有特定ID的订单</li><li id="a93c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">用用户传递的详细信息更新订单</li><li id="d164" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">返回订单id、订单状态和总金额</li></ul><p id="9b08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编写完变异之后，像前面的操作一样，单击“派生操作”选项。</p><p id="a623" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像往常一样，Hasura自动生成动作定义。这一次我们将通过从定义中删除<code class="fe nf ng nh ni b">order_id</code>来修改它。</p><p id="32d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图42展示了新动作应该是什么样子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/c599718e1381a02ad2eec7d56f0d857f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2gU62p2iyYUUVn7f.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图42 —下单操作</em></p></figure><p id="c1f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">字段<code class="fe nf ng nh ni b">order_id</code>被删除，因为它将在操作代码中自动传递。</p><p id="8095" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保存操作后，您可以转到“Codegen”选项卡查看自动生成的代码。我们还需要编写定制的业务逻辑，因为<code class="fe nf ng nh ni b">order_id</code>是自动传递的。此外，我们需要计算订单需要支付的总金额。</p><h1 id="20fd" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">附加查询和变异</h1><p id="0db7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Hasura总是在生成的代码中给你主要的突变。下单的突变如下:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="3c3a" class="ns lt iq ni b gy oi oj l ok ol">const PLACE_ORDER = `mutation placeOrder($order_id: uuid, $city: String!, $country: String!, $house_number: Int!, $street_name: String!, $zip_code: String!, $ordered: Boolean!, $total: numeric) {<br/>  update_order(where: {id: {_eq: $order_id}}, _set: {city: $city, country: $country, house_number: $house_number, ordered: $ordered, street_name: $street_name, zip_code: $zip_code, total: $total}) {<br/>      returning {<br/>        id<br/>        ordered<br/>        total<br/>    }<br/>  }<br/>}`;</span></pre><p id="8f62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还需要一个查询来获取属于经过身份验证的用户的订单。该查询应返回以下信息:</p><ul class=""><li id="981c" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">订单ID</li><li id="b02e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">ordered</code>字段</li><li id="0f07" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">所有的<code class="fe nf ng nh ni b">order</code>项</li><li id="2e95" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">每个订单项目的<code class="fe nf ng nh ni b">id</code></li><li id="3075" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">它所代表的<code class="fe nf ng nh ni b">product</code></li><li id="4ae1" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">产品的<code class="fe nf ng nh ni b">name</code></li><li id="7f5e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">产品的<code class="fe nf ng nh ni b">price</code></li><li id="f0a8" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><code class="fe nf ng nh ni b">quantity</code></li></ul><p id="956d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的查询返回所有这些信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="db21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这个操作，这些是所有需要的查询和突变。下一步是构建处理程序。</p><h2 id="e43c" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">构建处理程序</h2><p id="606f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您可以重用同一个<code class="fe nf ng nh ni b"><a class="ae kv" href="#heading-execute-function" rel="noopener ugc nofollow">execute</a></code>函数来运行查询和变异。它的功能与前面动作的功能相同。</p><p id="0c2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是处理来自用户的数据和发出请求的用户的id。</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="87ca" class="ns lt iq ni b gy oi oj l ok ol">app.post('/placeOrder', async (req, res) =&gt; {<br/>  // get request input<br/>  const { city, country, house_number, street_name, zip_code, ordered } = req.body.input;<br/>  const user_id = req.body.session_variables['x-hasura-user-id'];</span></pre><p id="13eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦有了用户ID，就可以执行<code class="fe nf ng nh ni b">LATEST_USER_ORDER</code>查询来检索所有的用户订单。</p><p id="27b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果操作成功，您将最新订单的id存储在一个单独的变量中。您将使用这个<code class="fe nf ng nh ni b">id</code>来下订单。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="74a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这让我们进入了下一步。这是您循环订单中的项目并计算每个项目的总数的地方。</p><p id="a90d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您获得了每个订单项目的总金额，您就可以计算整个订单的总金额。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/0ac099f5ec826acaa224c64a47859e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V42LbDMp07bT-vOx.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图43 —订单示例</em></p></figure><p id="82dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们以图43中的顺序为例。订单有两个<code class="fe nf ng nh ni b">order</code>项目:</p><ul class=""><li id="0b95" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">包含两台游戏电脑的订单项目</li><li id="1561" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">包含一台Macbook的订单项目</li></ul><p id="8637" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于每个订单项，它将产品的价格乘以数量，得出每个订单项的总金额。</p><p id="8dbb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nf ng nh ni b">orderItemsTotal</code>是一个数组，包含每个订单项目的总金额。对于此示例，<code class="fe nf ng nh ni b">orderItemsTotal</code>是以下数组:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="c8a1" class="ns lt iq ni b gy oi oj l ok ol">const orderItemsTotal = [ 9000, 1500 ];</span></pre><p id="09cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们需要计算订单的总和。我们可以通过将来自<code class="fe nf ng nh ni b">orderItemsTotal</code>数组的所有金额相加来实现。支付订单的总金额存储在<code class="fe nf ng nh ni b">amountToPay</code>中。</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="109b" class="ns lt iq ni b gy oi oj l ok ol">const orderItemsTotal = orderExists.users[0].orders[0].order_items.map(orderItem =&gt; {<br/>    const total = orderItem.product.price * orderItem.quantity;<br/><br/>    return total;<br/>  });<br/><br/>  const amountToPay = orderItemsTotal.reduce((acc, curr) =&gt; acc + curr, 0);</span></pre><p id="9d42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此时，您有了订单<code class="fe nf ng nh ni b">id</code>和要支付的总金额。这意味着该下订单了。</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="4a8b" class="ns lt iq ni b gy oi oj l ok ol">const { data: placeOrder, errors: placeOrderErr } = await execute({ order_id, city, country, house_number, street_name, zip_code, ordered }, PLACE_ORDER, req.body.session_variables);<br/><br/>if (placeOrderErr) {<br/>    return res.status(400).json({ error: placeOrderErr[0].message });<br/>}<br/><br/>return res.json({<br/>    ...placeOrder.update_order.returning[0]<br/>});</span></pre><p id="8c1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">操作代码已完成，现在您可以下订单了。你可以在这个<a class="ae kv" href="https://gist.github.com/catalinpit/0416bedb8929632c5bb05dc22a6e031c" rel="noopener ugc nofollow" target="_blank">要点</a>中看到这个动作的完整代码。</p><h2 id="c79a" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">部署代码</h2><p id="4148" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您为这个操作部署Node.js服务器，就像您为前面的操作所做的那样。您可以在这个<a class="ae kv" href="https://github.com/catalinpit/hasura-actions/tree/main/place-order" rel="noopener ugc nofollow" target="_blank">库</a>中看到完整的服务器代码。</p><h2 id="4769" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">更新处理程序</h2><p id="2134" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您需要更新的最后一件事是动作处理程序。添加您的URL并保存操作。</p><p id="80ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在你可以用行动了！</p><h2 id="6493" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">操作权限</h2><p id="df75" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">类似于为前两个操作设置操作权限，允许“用户”角色执行<code class="fe nf ng nh ni b">placeOrder</code>变异。</p><p id="a927" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参考图35。</p><h2 id="a06f" class="ns lt iq bd lu nt nu dn ly nv nw dp mc lf nx ny me lj nz oa mg ln ob oc mi od bi translated">测试动作</h2><p id="3fc9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在下订单之前，您需要创建一个订单并向其中添加订单项目。否则，应用程序会抛出一个错误，因为您试图向一个不存在的订单添加项目。</p><p id="5cc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您有一个开放的商品订单，在Hasura仪表板的GraphiQL中运行以下变化:</p><pre class="kg kh ki kj gt oe ni of og aw oh bi"><span id="b15f" class="ns lt iq ni b gy oi oj l ok ol">mutation {<br/>  placeOrder(<br/>    city: "London"<br/>    country: "England"<br/>    house_number: 10<br/>    ordered: true<br/>    street_name: "Potter Street"<br/>    zip_code: "AA21JJ"<br/>  ) {<br/>    id<br/>    ordered<br/>    total<br/>  }<br/>}</span></pre><p id="97cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在图44中，您可以在项目仪表板中看到突变和响应。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/4018588d9ebb9902517a4991baf26489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pH2ErhNGGDp2Uiup.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图44 —订单突变</em></p></figure><p id="f9b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行突变后检查数据库，显示订单已经发出。图45展示了数据库中的新订单。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/1d8f1c444078ccfe5945635946cfa5c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*d-dngtXpW1-BAui0.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="ne">图45 —完成订单</em></p></figure><p id="e221" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，认证用户也可以下订单了！但是，在这个应用程序中下订单并不处理付款。一个完整的下订单过程也需要处理付款。Hasura有一个视频展示了如何用Stripe和Actions创建一个<a class="ae kv" href="https://youtu.be/NEZ5ceGt_PM" rel="noopener ugc nofollow" target="_blank">支付API </a>。</p><p id="112f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，当您想要扩展或定制应用程序的功能时，Hasura的“Actions”特性非常方便。</p><h1 id="b4aa" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="4be7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本教程中，您将通过编写最少的代码来构建一个基本电子商务应用程序的后端。Hasura通过最大限度地减少构建应用程序时编写的代码量来帮助您加快开发时间。</p><p id="09ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从这里去哪里？从这里开始，您可以尝试从头开始构建应用程序的后端，然后再构建前端。之后，您可以尝试使用动作和远程模式将您的自定义REST和GraphQL APIs插入到Hasura中。</p></div></div>    
</body>
</html>