<html>
<head>
<title>Build a Notes App With Google Authentication in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js中构建一个带有Google身份验证的Notes应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-notes-app-with-google-authentication-in-node-js-e0c3dea761e1?source=collection_archive---------3-----------------------#2020-12-02">https://betterprogramming.pub/build-a-notes-app-with-google-authentication-in-node-js-e0c3dea761e1?source=collection_archive---------3-----------------------#2020-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9275" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将Google OAuth添加到您的web应用程序中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fb0806e034d3c98316c4c0c68b5290c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Tq5Q5n55ALALz6rh"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/twE-bTk0BnM" rel="noopener ugc nofollow" target="_blank">资料来源:Unsplash上的Daria</a></p></figure><h1 id="335d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">本文的学习目标</h1><ul class=""><li id="b29f" class="lr ls it lt b lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">知道什么是第三方认证。</li><li id="8fff" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">知道何时使用第三方认证。</li><li id="c1ca" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">为了能够使用内置的Google OAuth构建一个notes应用程序。</li></ul></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="1ffc" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">介绍</h1><p id="f726" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">镇上的人都说你是一个了不起的web开发人员，对学习新技能有极大的热情，喜欢追赶前沿的框架和技术。因此，一位客户找到您，要求您开发一款满足以下要求的应用:</p><ul class=""><li id="515f" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">具有普通CRUD功能的基本notes应用程序。</li><li id="3ff1" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">一个登录和注销系统——这个web应用程序将有多个用户。</li></ul><p id="8f2e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">“当然，没问题”，你告诉自己。“我已经构建了一个<a class="ae ky" href="https://medium.com/better-programming/simple-notes-app-with-node-js-and-mongoosejs-6595cd5d15b" rel="noopener">笔记应用</a>，我还学会了<a class="ae ky" href="https://medium.com/better-programming/build-a-login-system-in-node-js-f1ba2abd19a" rel="noopener">如何构建一个登录系统</a>。这个<em class="nv">真的</em>容易”。</p><p id="f243" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">“但是，有一个问题，”客户告诉你。“很抱歉打断你的工作，但你必须让用户通过他的谷歌账户登录。”</p><p id="8ce1" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">你仍然接受提议。毕竟，事实上程序员最重要的工作之一就是应对出现的挑战。通过几次谷歌搜索，你会发现让用户通过另一个服务登录的过程被称为第三方认证。</p><h2 id="7094" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">什么是第三方认证？</h2><p id="b81a" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">注册一项新服务时，通常需要通过另一个社交媒体网站注册，例如Google+、脸书、Twitter或LinkedIn。通过另一个第三方服务登录的过程叫做<strong class="lt iu">第三方认证</strong>。</p><p id="8d9e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们先来讨论一下第三方认证的好处。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="af2e" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">为什么使用第三方认证？</h1><p id="7b6b" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">根据这篇<a class="ae ky" href="https://medium.com/@sellarafaeli/no-more-username-passwords-just-use-a-3rd-party-for-authentication-59b12db092a4" rel="noopener">中的文章</a>，你的开发过程变得更简单。支持这一说法的一些理由包括:</p><ul class=""><li id="1d4b" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><strong class="lt iu">不需要处理密码安全</strong>:想想看——作为一名开发者，你不再需要考虑彩虹表、<code class="fe oi oj ok ol b">bcrypt</code>、散列和盐。处理身份验证的第三方服务已经为您处理了密码安全。这意味着开发者肩上卸下了一个巨大的负担。</li><li id="bc45" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><strong class="lt iu">不再出现“忘记密码了？”困境</strong>:如果你的网络应用程序包含用户名/密码条目，那么包含“忘记密码”也很重要。这意味着您必须编写额外的代码和逻辑，以便用户可以重置其密码。然而，如果有一个通过第三方认证登录的选项，那么用户只需记住一个密码(在这种情况下，他通过社交媒体网站登录)就可以使用你的应用程序。在这个场景中，我们可以看到用户不需要记住额外的密码，开发人员也不需要编写更多的代码来重置用户的密码。</li></ul><p id="aa96" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们已经谈了它的成果，现在让我们开始实践吧！</p><p id="592c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在本文中，我们将使用Google作为第三方认证服务来创建一个笔记应用程序。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="b68c" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">入门指南</h1><p id="3ead" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在您的项目目录中，我们需要初始化项目。像这样做:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/3be6c4ea98280c39a8963ab760a2b143.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*tlSU5Fx7ssQ48K6w2aPYLw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">命令来初始化项目</p></figure><h2 id="cfa1" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">库和依赖项的安装</h2><p id="f0e8" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">我们需要安装以下库:</p><ul class=""><li id="6e81" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">处理我们的路由和中间件功能。</li><li id="55d4" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">mongoose</code>:我们将把我们的笔记和用户存储在一个数据库中。为此，我们将使用<code class="fe oi oj ok ol b">mongoose</code>。这里有一个关于MongooseJS的复习。</li><li id="894d" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">connect-mongo</code>:这将允许我们在数据库中存储会话。所以当我们重置服务器时，我们不会被注销。</li><li id="6c7a" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">express-handlebars</code>:我们将使用把手作为模板引擎。你也可以使用<code class="fe oi oj ok ol b">pug</code>或者其他模板引擎。</li><li id="9661" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">dotenv</code>:用于我们的配置和环境变量。</li><li id="67ab" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">从我们的模板中发出上传和删除请求。通常，你不能从浏览器中执行上传和删除请求，但是这个包使它成为可能。</li><li id="47a7" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">正确安排我们的日期。</li><li id="a56f" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">passport</code>:用于认证。</li><li id="b5aa" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">passport-google-oauth20</code>:因为我们将使用Google OAuth 2.0，所以我们也将使用这个包。</li><li id="44a7" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">nodemon</code>:这个包会持续监视我们的服务器，并在我们每次修改代码时自动重启。这将是一个开发依赖。</li></ul><p id="8ef6" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">要安装这些依赖项，请在终端中运行以下命令:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/e57df4b982344a497a37b6b47196df7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UOg4UoevP7KSVGnCj0p6bw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安装依赖项</p></figure><p id="7e1a" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">接下来，我们将安装<code class="fe oi oj ok ol b">nodemon</code>作为开发依赖项。像这样做:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/dc4726dcf06acc2b67d5b46b03403cbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*XO_wnquAR9Y-M9zWAwr_wA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安装开发依赖项</p></figure><h2 id="86d6" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">环境变量</h2><p id="b51c" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在项目的根目录中，在终端中运行以下命令。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/a4f2991b16235153ac9c49716e570705.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*CzTE2SO7SQeXhJL-70RosQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创造。环境文件</p></figure><h2 id="b874" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">构建MongoDB集群</h2><p id="b47d" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">MongoDB集群将允许我们在云服务器上托管数据，而不是在本地机器上托管数据。</p><p id="1940" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">为此，首先登录<a class="ae ky" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB网站</a>。然后按照这些步骤<a class="ae ky" href="https://docs.atlas.mongodb.com/tutorial/manage-organizations/#create-an-organization" rel="noopener ugc nofollow" target="_blank">创建一个组织。使用该组织，您可以通过遵循这些步骤</a>成功地创建一个集群。</p><p id="3267" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">创建集群后，您将看到一个如下所示的控制面板:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/8f66486d1b7bef9f658ef85dbed39871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9WibwvYGSSDmp5ltWIfhWg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MongoDB仪表板的屏幕截图</p></figure><p id="a335" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">点击<code class="fe oi oj ok ol b">Database</code>按钮(黑色圆圈)，然后点击<code class="fe oi oj ok ol b">Add new Database user</code>。在那里，创建您的凭证。</p><p id="6154" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在点击侧边栏上的<code class="fe oi oj ok ol b">Clusters</code>,回到你的仪表板，然后点击<code class="fe oi oj ok ol b">Connect</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/2767cafcb0ec7ad69441452a79596182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YY2LxWMlQCRrOVEpkkCUBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MongoDB仪表盘截图。点击连接</p></figure><p id="900c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在那里，您将看到以下对话框:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/7fd671f8f8e6b37a8491d49dcd4069f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*Cm6ldt_34-oOI6FYlBzTrA.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">点击“连接”后的结果</p></figure><p id="9314" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在按下<code class="fe oi oj ok ol b">Connect to Application</code>(黑色圆圈)，您将收到您的连接字符串。</p><p id="8821" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">将连接字符串复制到您的<code class="fe oi oj ok ol b">.env</code>文件中，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/cb42b7225645b30828c12a7bd82ac01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*0bOZVrLTXpeJcAgFeO10ag.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更改为。环境文件</p></figure><p id="b505" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在这种情况下,<code class="fe oi oj ok ol b">mongodbconnectionstring</code>将是您实际的MongoDB连接字符串。</p><p id="fd51" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后一步是允许从任何地方访问网络。为此，请转到您的仪表板并点击<code class="fe oi oj ok ol b">Network Access</code>。在那里，点击<code class="fe oi oj ok ol b">Actions</code>栏下的<code class="fe oi oj ok ol b">EDIT</code>按钮。确保访问列表条目为<code class="fe oi oj ok ol b">0.0.0.0/0</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/1d1240fa183386e96c4874995d2c8725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MRyCQV9EW28Dv8uVUcv4CQ.gif"/></div></div></figure><p id="1dfb" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这一步现在完成了！现在让我们继续获取我们的Google API密钥。</p><h2 id="8b86" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">使用Google APIs</h2><p id="630e" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在我们的应用程序中实现Google OAuth之前，我们需要首先获得我们的API密钥。要获得它，进入谷歌开发者控制台页面，然后<a class="ae ky" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" rel="noopener ugc nofollow" target="_blank">按照这些步骤</a>创建一个项目。</p><p id="f75d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">你会看到一个仪表盘。点击<code class="fe oi oj ok ol b">ENABLE APIS AND SERVICES</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/58e3eebd825bf9b9dc0f5b60289d1b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cskaeMcwdXcU3MHSlUJFXA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Google OAuth仪表板</p></figure><p id="59ea" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在向下滚动到<code class="fe oi oj ok ol b">Socials</code>部分下的<code class="fe oi oj ok ol b">Google+ API</code>。</p><p id="3ba8" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">您将看到一个如下所示的页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ca"><img src="../Images/ac18b09b3446269bd736bd1d51d16bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I6neQl9fF3NbAQ-SKjrCFQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建新项目后的页面</p></figure><p id="0851" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在点击<code class="fe oi oj ok ol b">Credentials</code>，你会看到一个如下所示的页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/709a33b89db38b81e1731343783701b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DxqcJvbr7-rgCeIbkgzRmQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“凭据”页面</p></figure><p id="6762" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">之后，点击<code class="fe oi oj ok ol b">Create Credentials</code>，然后点击<code class="fe oi oj ok ol b">OAuth Client ID</code>。在<code class="fe oi oj ok ol b">Application Type</code>栏上，选择<code class="fe oi oj ok ol b">Web Application</code>。除此之外，请使用以下设置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/9ec1f9245d0a3e1cf8f47fc283781d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*NHQP35K0fP8XXNKuBWGavw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">web应用程序的设置</p></figure><p id="99fc" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">当您点击<code class="fe oi oj ok ol b">Create</code>时，您将收到您的客户ID密钥和客户密钥。</p><p id="0662" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">将API密钥和秘密复制到您的<code class="fe oi oj ok ol b">.env </code>文件中的<code class="fe oi oj ok ol b">MongoURI</code>变量之后，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/a831fb6ef9a807d4e841fad18bad46db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*_t9icdgkKYn-QkXJqDdZOA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更改为。环境文件</p></figure><p id="e395" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在这种情况下，<code class="fe oi oj ok ol b">GoogleID</code>将是您的客户ID，GoogleSecret将是您的客户机密。</p><p id="78b1" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在是编码的时候了！让我们创建<code class="fe oi oj ok ol b">app.js</code>文件。</p><h2 id="9b15" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">我们的主文件— app.js</h2><p id="1eb7" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">这将是我们的主要项目文件。现在，我们将只编写一些样板代码。我们还将配置模板引擎和静态文件夹。在项目的根目录下，创建一个名为<code class="fe oi oj ok ol b">app.js</code>的文件，其中包含以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="12e8" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 1–2</code>:将<code class="fe oi oj ok ol b">express</code>和<code class="fe oi oj ok ol b">dotenv</code>模块导入到我们的项目中。</li><li id="8c2a" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 7</code>:将环境变量加载到我们的项目中，以便它们可以在开发中使用。</li><li id="d49d" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 9</code>:在<code class="fe oi oj ok ol b">port 3000</code>启动我们的NodeJS服务器。</li></ul><p id="18ee" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">运行应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/f066dab66c271f412f3d732e7ba973c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*cVaiMUwCpb7vQcYX8unMFA.png"/></div></figure><p id="7163" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这是输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/18400ed45a3b79161d4564319f7381ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZFiEu9GD0mZC2ZM292YnWQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="4763" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这意味着我们的服务器已经成功启动。</p><p id="a7c7" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们终于完成了初始阶段！让我们继续建立我们的数据库。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="3eb3" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">Mongoose用户数据库设置</h1><p id="064f" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">因为我们将使用MongoDB来存储用户注释，所以我们将使用Mongoose API来获得web应用程序中的数据库设施。</p><p id="40dd" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在项目的根目录下，创建两个新文件夹:<code class="fe oi oj ok ol b">config</code>和<code class="fe oi oj ok ol b">models</code>。</p><p id="5952" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">models</code>文件夹中，创建一个名为<code class="fe oi oj ok ol b">User.js</code>的文件。该模块将包括用户模式的定义。该文件将导出一个从用户模式派生的模型。</p><p id="f8bd" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">models/User.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="c343" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 1–3</code>:将<code class="fe oi oj ok ol b">mongoose</code>库导入到我们的项目中，然后创建一个<code class="fe oi oj ok ol b">Schema</code>变量。</li><li id="ab41" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 4-30</code>:定义<code class="fe oi oj ok ol b">UserSchema</code>。这将告诉我们，当我们创建一个模型时，下面给出的所有字段都将被存储。Google OAuth API为我们提供了所需的数据，这些数据稍后将存储在这些字段中。我们还将存储一个<code class="fe oi oj ok ol b">createdAt</code>字段，用于存储账户创建日期。默认情况下，这将是用户注册的日期。</li><li id="6d72" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 32</code>:导出一个名为<code class="fe oi oj ok ol b">User</code>的模型，该模型将从我们刚刚在上面定义的<code class="fe oi oj ok ol b">UserSchema</code>派生而来。</li></ul><p id="c1df" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在转到<code class="fe oi oj ok ol b">config</code>目录，创建一个名为<code class="fe oi oj ok ol b">db.js</code>的模块。这个模块导出一个函数，让我们连接到我们的数据库。</p><p id="088e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">config/db.js</code>、<strong class="lt iu">、</strong>中编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="3ae9" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">当你使用Mongoose时，你是在使用承诺，这就是为什么你声明了一个<code class="fe oi oj ok ol b">async</code>函数。</li><li id="d2a2" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 4–9</code>:使用我们之前获得的连接字符串连接到我们的MongoDB数据库。由于我们的连接字符串位于我们的<code class="fe oi oj ok ol b">.env</code>文件中(它是一个环境变量)，我们可以通过<code class="fe oi oj ok ol b">process.env.MONGO_URI</code>变量来访问它。我们还配置了选项<code class="fe oi oj ok ol b">UseNewUrlParser</code>、<code class="fe oi oj ok ol b">useUnifiedTopology</code>和<code class="fe oi oj ok ol b">useFindAndModify</code>，这样每当我们连接到数据库时，Mongoose就不会抛出错误和警告。</li><li id="d23f" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 11–15 </code>:如果Mongoose在连接过程中遇到问题，抛出错误。</li><li id="110b" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 16 </code>:导出<code class="fe oi oj ok ol b">connectDB</code>函数。</li></ul><p id="dece" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们现在需要连接到数据库。</p><p id="e15f" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">/app.js</code>、<strong class="lt iu">、</strong>中执行以下步骤:</p><ul class=""><li id="b950" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">首先将<code class="fe oi oj ok ol b">connectDB</code>功能导入<code class="fe oi oj ok ol b">app.js</code>:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/cf937ddb1bb6523e3feae3c3dc61e6aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzvMz0P7KBhqqqAfkZ1UBQ.png"/></div></div></figure><ul class=""><li id="9fe7" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">就在<code class="fe oi oj ok ol b">dotenv.config()</code>方法调用之后，调用<code class="fe oi oj ok ol b">connectDB</code>函数:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/59127b208b0ce98592c4dcc4c8df33aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*uWcqkWOvU26GgHdKXny8Nw.png"/></div></figure><p id="1fa4" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">再次运行该应用程序，您将看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/f6647527c6ca62ba68a57967f335aa46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ltcckDLbfSwaTFU6uTF1iw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="13eb" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这意味着与数据库的连接是成功的！下一步，我们将配置模板引擎和布局</p><p id="b250" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">app.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="3f53" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">模板引擎和布局</h1><p id="3ed1" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">对于我们的模板引擎，我们将使用手柄。在<code class="fe oi oj ok ol b">app.js</code>中，导入<code class="fe oi oj ok ol b">express-handlebars</code>库:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/8e8a393c38578e842288acdfa2589732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wQisEWEuJUqdewJlo80q9g.png"/></div></div></figure><p id="6dba" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在让我们告诉Express，我们将使用把手作为我们的模板引擎。在<code class="fe oi oj ok ol b">/app.js</code> <strong class="lt iu">，</strong>中编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/de6b05e614158c652891ea571c248496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sh4iONisLGHJ1kdyvQAd4g.png"/></div></div></figure><ul class=""><li id="050c" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 1</code>:指定我司车把文件的扩展名(<code class="fe oi oj ok ol b">extname</code>)为<code class="fe oi oj ok ol b">hbs</code>。我们还告诉Express我们的默认布局(<code class="fe oi oj ok ol b">defaultLayout</code>)将是<code class="fe oi oj ok ol b">main.hbs</code>。布局是HTML页面包装，可以在应用程序的不同视图中重复使用。</li><li id="44d3" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 2</code>:在这里，我们通知Express我们的视图引擎将会是Handlebars，或者简称为<code class="fe oi oj ok ol b">hbs</code>。</li></ul><p id="4cad" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">完成后，转到根目录，创建一个名为<code class="fe oi oj ok ol b">views</code>的文件夹。在这个文件夹中，创建另一个名为<code class="fe oi oj ok ol b">layouts</code>的文件夹。在<code class="fe oi oj ok ol b">layouts</code>目录中，创建两个文件:<code class="fe oi oj ok ol b">main.hbs</code>，我们的默认布局，和<code class="fe oi oj ok ol b">login.hbs</code>，当用户登录时使用。</p><p id="9e73" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">views/layouts/main.hbs</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="e0eb" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这些都是标准的HTML，但是要注意<code class="fe oi oj ok ol b">Line 6</code>。<code class="fe oi oj ok ol b">{{{body}}}</code>是一个占位符，用于显示主要内容。换句话说，所有将使用<code class="fe oi oj ok ol b">main.hbs</code>作为默认布局的文件将具有相同的标题(这一点从<code class="fe oi oj ok ol b">title</code>元素内容中可以明显看出)，但是将具有不同的主体(<code class="fe oi oj ok ol b">{{{body}}}</code>)。这个概念到后期你就清楚了。</p><p id="efd3" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在在<code class="fe oi oj ok ol b">views/layouts/login.hbs</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="3ba3" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">注意，它类似于<code class="fe oi oj ok ol b">main.hbs</code>文件，但是标题不同。</p><p id="fc40" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">既然我们已经对布局进行了编码，现在我们希望用户能够看到页面。现在是时候创建我们的路线，将渲染我们的观点。</p><p id="31b5" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后<code class="fe oi oj ok ol b">/app.js</code> <strong class="lt iu">，</strong>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="4748" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">索引路线和视图</h1><p id="e309" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在这一部分，我们将对路线进行编码。这些路径将呈现我们刚刚创建的车把文件。</p><p id="e1e2" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">首先，在根目录下，创建一个名为<code class="fe oi oj ok ol b">routes</code>的新文件夹。</p><p id="bd8a" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">routes</code>目录下，创建一个名为<code class="fe oi oj ok ol b">index.js</code>T31的文件。该文件将处理没有跟随的路径，例如<code class="fe oi oj ok ol b">/dashboard</code>或根目录<code class="fe oi oj ok ol b">/</code>。</p><p id="b2ea" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">routes/index.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="f1d8" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在这段代码中，我们只是导出一个处理<code class="fe oi oj ok ol b">/</code>和<code class="fe oi oj ok ol b">/dashboard</code>路线的<code class="fe oi oj ok ol b">Router</code>。出于测试目的，我们向客户端发送基本文本。这段代码将在本教程的后面部分进一步编辑。</p><p id="1074" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在我们需要将<code class="fe oi oj ok ol b">index.js</code>路由文件与<code class="fe oi oj ok ol b">app.js</code>链接起来。</p><p id="e423" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">/app.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/48b39edab01d491f36a59bf4deb88067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GFMcGcgeelevVJcWJjpPlg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在app.js中输入的代码</p></figure><p id="db3b" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这意味着<code class="fe oi oj ok ol b">/</code>(根目录)和<code class="fe oi oj ok ol b">/dashboard</code>目录现在将由<code class="fe oi oj ok ol b">index.js</code>文件处理。</p><p id="32c3" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">运行程序，将网络浏览器指向<code class="fe oi oj ok ol b">localhost:3000</code>，然后指向<code class="fe oi oj ok ol b">localhost:3000/dashboard</code>。这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/f93f3fbe05ed47c1e6c9ecc02a4312d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/1*SJ2CtwmGAmQG46TAwgzmyw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">先去localhost:3000/再去localhost:3000/dashboard后的结果。</p></figure><p id="2cc7" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们的代码有效！现在让我们创建当用户访问<code class="fe oi oj ok ol b">/</code>或<code class="fe oi oj ok ol b">/dashboard</code>时将呈现的视图。</p><p id="1d5c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在您的<code class="fe oi oj ok ol b">views</code>目录中，创建两个名为<code class="fe oi oj ok ol b">dashboard.hbs</code>和<code class="fe oi oj ok ol b">login.hbs</code>的文件。</p><p id="2459" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">views/login.hbs</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="cb11" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 3–5</code>:创建一个按钮，将用户重定向到<code class="fe oi oj ok ol b">/auth/google</code>路线。这条路线将让用户使用他的谷歌帐户登录到我们的应用程序。我们将在本教程的后面处理这条路线。</li></ul><p id="508d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在转到<code class="fe oi oj ok ol b">views/dashboard.hbs</code>并编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="8150" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">当我们使用Passport启用第三方身份验证时，我们将为仪表板页面编写更多的代码。目前，我们只是在测试代码是否有效。</p><p id="011a" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在转到<code class="fe oi oj ok ol b">routes/index.js</code>，并执行以下步骤。</p><ul class=""><li id="cc57" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">找到以下代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/c9cc858d0708f34828b694ce4506bc32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*8zR-OG5PX8-5nMWIuoUWSg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在index.js中查找的代码</p></figure><ul class=""><li id="7462" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">现在用以下代码替换这些代码行:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/945c0bbe2bcdd2171fbc9916b3af612a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cc8Cae28qlAkHc7lRzN6NA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">index.js中要替换的代码</p></figure><ul class=""><li id="0582" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 2 &amp; 3</code>:渲染<code class="fe oi oj ok ol b">login.hbs</code>文件，告诉Express使用<code class="fe oi oj ok ol b">login.hbs</code>作为默认布局(我们通过设置<code class="fe oi oj ok ol b">layout</code>选项来实现)。确保<code class="fe oi oj ok ol b">login</code>默认布局文件位于<code class="fe oi oj ok ol b">views/layouts</code>目录中。</li></ul><p id="44a6" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">运行程序，这应该是你的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/02b5a1d4625a72136393e80c284c5b8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/1*cRgyMdsUdYA4gHQ8XBBu7w.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们代码的结果</p></figure><p id="25a1" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这个结果表明我们的代码是有效的！在下一部分，我们将使用Passport。这个库将帮助我们在web应用程序中实现Google身份验证。</p><p id="ff76" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b"> app.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="49d5" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这是<code class="fe oi oj ok ol b">routes/index.js</code>应该有的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="56f5" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">用护照认证</h1><p id="2045" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated"><a class="ae ky" href="http://www.passportjs.org/" rel="noopener ugc nofollow" target="_blank"> Passport.js </a>是一个非常有用的库，它将帮助我们在Notes应用程序中启用第三方认证。或者，如果我们愿意，我们甚至可以<a class="ae ky" href="https://medium.com/better-programming/build-a-login-system-in-node-js-f1ba2abd19a" rel="noopener">实现我们自己的登录系统</a>。对于本教程，由于我们使用Google OAuth，我们将使用<a class="ae ky" href="http://www.passportjs.org/packages/passport-google-oauth20/" rel="noopener ugc nofollow" target="_blank"> Passport的Google Auth 2.0策略</a>。</p><p id="f2c6" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在开始使用Passport之前，让我们先配置Passport及其会话。</p><h2 id="5565" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">Passport配置和会话</h2><p id="819d" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">转到根目录下的<code class="fe oi oj ok ol b">config</code>文件夹，创建一个名为<code class="fe oi oj ok ol b">passport.js</code>的模块。这就是我们谷歌战略的定位。</p><p id="20f6" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">config/passport.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="cc4d" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 1-3</code>:将Google认证护照策略、Mongoose API和我们的<code class="fe oi oj ok ol b">User</code>模型导入到模块中。</li><li id="51bd" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">Passport需要我们的Google Client ID和Google Client Secret，以便我们可以继续OAuth。这些数据将由我们在本教程前面编写的环境变量提供。关于环境变量的更多信息，<a class="ae ky" href="https://holycoders.com/node-js-environment-variable/" rel="noopener ugc nofollow" target="_blank">点击此处</a>。</li><li id="c031" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 14</code>:在控制台记录用户的档案数据。稍后，我们将编辑这段代码，将用户数据保存到我们的数据库中。</li><li id="22e9" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 17–26</code>:序列化和反序列化<code class="fe oi oj ok ol b">user</code>实例以支持登录会话。</li></ul><p id="70d5" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">接下来，我们需要在您的项目中使用该模块。为此，转至<code class="fe oi oj ok ol b">/app.js</code>并采取以下步骤。</p><ul class=""><li id="c8cf" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">从导入<code class="fe oi oj ok ol b">passport</code>库开始:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/bccc82f7d4b116bfec8db7008a5a992b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zf6ztPspZiFtU-Dcl5W3ow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app.js中的代码</p></figure><ul class=""><li id="6126" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">我们需要告诉Passport我们将使用谷歌认证。为此，我们将导入我们的Passport配置:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pn"><img src="../Images/aa8592b368bb6d267f4442e9cce556e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G08pljMKaqhldxdn6E3_aQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app.js中的代码</p></figure><ul class=""><li id="a093" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">现在我们需要添加Passport中间件:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi po"><img src="../Images/73842c4c6b4ca01b6152cc1ee86a7992.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*laWce4o1ziKNzMvNaJbzDg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app.js中的中间件</p></figure><ul class=""><li id="4313" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">为了让Passport与会话一起工作，我们需要实现<code class="fe oi oj ok ol b">express-sessions</code>。回到<code class="fe oi oj ok ol b">/app.js</code>的顶部，导入<code class="fe oi oj ok ol b">express-sessions</code>:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/66be2b6d752280a8c685bf8215bb0753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LMD8rISG_57zEGZL81c3rg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">导入快速会话</p></figure><ul class=""><li id="78d8" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">express-session</code>有自己的中间件。在<code class="fe oi oj ok ol b">passport</code>中间件之前输入这段代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/a6d8d74d114dc1b6b8e94560555120e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*0V3ij4A8fge0qbTzbSM1Ow.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app.js中的快速会话</p></figure><p id="8944" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们将<code class="fe oi oj ok ol b">resave</code>属性保留为<code class="fe oi oj ok ol b">false</code>。这意味着如果没有修改任何内容，我们就不想保存会话。我们还将<code class="fe oi oj ok ol b">saveUnitialized</code>属性设置为<code class="fe oi oj ok ol b">false</code>，这指示Express在存储内容之前不要创建会话。有关更多信息，您可以参考<a class="ae ky" href="https://www.npmjs.com/package/express-session" rel="noopener ugc nofollow" target="_blank">快速会话文档</a>。</p><p id="addc" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">app.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><h2 id="c39c" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">认证路线</h2><p id="d609" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">我们现在需要配置Google OAuth所需的身份验证路由。</p><p id="d937" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到您的<code class="fe oi oj ok ol b">routes</code>目录，创建一个名为<code class="fe oi oj ok ol b">auth.js</code>的新文件。在那里，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="32c6" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 5</code>:这里我们处理的是<code class="fe oi oj ok ol b">/google</code>路线。我们告诉Express，当用户被引导到这条路线时，就会调用<code class="fe oi oj ok ol b">passport.authenticate</code>函数。我们也在指导Passport使用谷歌策略。<code class="fe oi oj ok ol b">{scope : [‘profile’]} </code>片段意味着我们需要用户的个人资料数据。</li><li id="1ec6" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 7–13</code>:处理<code class="fe oi oj ok ol b">/google/callback</code>路径，再次调用<code class="fe oi oj ok ol b">passport.authenticate</code>功能。这次我们告诉Passport，如果认证过程失败，那么我们应该将他重定向回<code class="fe oi oj ok ol b">/</code>(登录)页面。否则，如果该过程成功，将用户重定向到仪表板。</li><li id="9a01" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">导出这个路由器，这样它就可以用在我们的项目中了。</li></ul><p id="b35d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在转到<code class="fe oi oj ok ol b">/app.js</code>，添加下面一行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/ddb6b29e58a66d75813c243d5b4cb9fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_PMEavykHLcAk49PumcwNg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app.js中的代码</p></figure><p id="36a3" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这意味着所有以<code class="fe oi oj ok ol b">/auth</code>开始的路线现在将由<code class="fe oi oj ok ol b">auth.js</code>处理。</p><p id="11f9" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在运行代码，并在您的网络浏览器中进入<code class="fe oi oj ok ol b">localhost:3000</code>。这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/62353526ec970a504802008944c402a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/1*sXweKQW-pMcdagd7vjoRow.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的结果</p></figure><p id="175d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">控制台中的输出如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/5c62f3b79c6ffeca58ccee5cdea72b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgqsGz_YiuL7P2Z-M51UKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">控制台中的输出</p></figure><p id="e092" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这是因为我们选择在控制台中记录用户数据。这在<code class="fe oi oj ok ol b">config/passport.js</code>中的以下代码片段中显而易见:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/b03095abba73c0669fd0b5484d50bc7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0y1uQ79sOBD_nVlMuZjQsg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">passport.js中的代码</p></figure><p id="a37d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们的代码有效！但是有一个问题——不是登录，而是应用程序挂起。这是因为我们没有处理谷歌战略中的回调。</p><p id="7ee7" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在下一节中，我们将继续将用户的档案数据保存到我们的数据库中。</p><p id="7308" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">/app.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><h2 id="bfc6" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">保存Google个人资料数据</h2><p id="d7de" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">为了防止我们的应用程序冻结，让我们保存用户数据，而不是将其记录到控制台。</p><p id="ce8e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">/config/passport.js</code>中，找到下面这段代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/b1854ca37ac5bc4d7611bd30420b5a06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsIcxILF6LosWK3pStB9Rg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">passport.js中要替换的代码</p></figure><p id="1dbb" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在将其替换为以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="c404" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 3–9</code>:将谷歌返回给我们的数据保存在一个名为<code class="fe oi oj ok ol b">newUser</code>的对象中。</li><li id="5dbc" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 10–11</code>:验证用户是否存在于我们的数据库中。我们通过用户ID找到用户，这个ID对每个用户来说都是唯一的。</li><li id="d64e" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 13–15</code>:如果用户存在，调用我们的回调函数，告诉Passport没有产生错误。</li><li id="3112" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 16–19</code>:如果用户不存在，将他的数据保存到我们的数据库中，并告诉Passport在此过程中没有出现错误。</li></ul><p id="0dd0" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">完成后，运行代码。这是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/b6839aa06bfb4b840c2275a8fe9ca4ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/1*R2K7dvXlV3SYyKGnQpwddw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="89c6" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">成功！用户进入了仪表板。然而，在通常情况下，用户也想注销。就这么办吧。</p><p id="cf60" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">config/passport.js</code>，应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><h2 id="f7f4" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">注销功能</h2><p id="cd63" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在<code class="fe oi oj ok ol b">routes/auth.js</code>、内编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="9e54" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 2</code>:当用户点击注销按钮时，他们将被导向<code class="fe oi oj ok ol b">/logout</code>路线。在这里，我们处理的是<code class="fe oi oj ok ol b">/logout</code>路线。</li><li id="5829" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 3</code>:调用<code class="fe oi oj ok ol b">req.logout()</code>功能，可以启动注销过程。这个方法是Passport提供的。</li><li id="61f0" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 5</code>:注销过程成功后，将用户重定向到登录(<code class="fe oi oj ok ol b">/</code>)页面。</li></ul><p id="1d4e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们已经实施了<code class="fe oi oj ok ol b">/logout</code>路线。下一步是在仪表板上创建一个注销按钮。</p><p id="3c47" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这里，我们需要创建一个分部。什么是部分？分部允许模板重用。您可能认为它们是模板中的模板。</p><p id="758f" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在您的<code class="fe oi oj ok ol b">views</code>文件夹中，创建一个名为<code class="fe oi oj ok ol b">partials</code>的新文件夹。在这里，创建一个文件名为<code class="fe oi oj ok ol b">_header.hbs</code>的文件。</p><p id="919f" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">views/partials/_header.hbs</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="0b9c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这里，我们刚刚创建了一个简单的列表元素，为用户指出不同的路线。</p><p id="218b" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在在<code class="fe oi oj ok ol b">views/layouts/main.hbs</code>中，执行以下步骤。</p><ul class=""><li id="a5d0" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">找到这段代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/407d4f85061ff768e629032bc63a1af5.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*XSVZvDPDlWma6kAeGMXCvA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在views/layout/main.hbs中查找的代码</p></figure><ul class=""><li id="cd11" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">在<code class="fe oi oj ok ol b">{{{body}}}</code>正上方的<code class="fe oi oj ok ol b">line 2</code>，写下以下内容:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/87632c37c29af104786281332aacd675.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*TUJrbQjmydpQzEVMtCbynA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在views/layout/main.hbs中编写的代码</p></figure><p id="ae11" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这为<code class="fe oi oj ok ol b">main.hbs</code>增加了<code class="fe oi oj ok ol b">_header.hbs</code>部分。</p><p id="3623" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">运行代码。这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/2e5a7d22416bbd0c8cbda356a79bf440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/1*VESB2SgnDbEphzpHHVl6Aw.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的结果</p></figure><p id="60ae" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这意味着我们的代码按预期运行。然而，在我们的程序中有一个主要的安全缺陷:即使我们注销，我们仍然可以访问仪表板。这里有一个例子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/c75c1f37a04b0467f1bc3aa984a59b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/1*ue2Z6vHrwzVwhIEOMddPZg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们程序中的问题</p></figure><p id="75eb" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在下一节中，我们将通过使用认证中间件来缓解这个问题。</p><p id="a69e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">routes/auth.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><h2 id="8e22" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">认证中间件</h2><p id="de3d" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在您的项目中，创建一个名为<code class="fe oi oj ok ol b">middleware</code>的新文件夹。在这里，创建一个名为<code class="fe oi oj ok ol b">auth.js</code>的新文件。</p><p id="e870" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">middleware/auth.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="dc20" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 2–5</code>:这里，我们检查用户是否已经登录。如果有，请求可以正常进行。否则，他们将被重定向到登录页面。<code class="fe oi oj ok ol b">req.isAuthenticated()</code>方法告诉我们用户是否已经登录。当用户在<code class="fe oi oj ok ol b">/dashboard</code>中但选择进入登录页面时，将使用<code class="fe oi oj ok ol b">ensureAuth</code>方法。</li><li id="041e" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 9–15</code>:在这里，我们也要确保用户的认证。如果用户没有登录，他们将被引导回登录页面。当用户没有登录但选择进入仪表板时，将使用<code class="fe oi oj ok ol b">ensureGuest</code>方法。</li></ul><p id="c518" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在转到<code class="fe oi oj ok ol b">routes/index.js</code>，执行以下步骤。</p><ul class=""><li id="4b3f" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">找到下面这段代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi px"><img src="../Images/704f49c2830766e4e9b1e0c489a7c1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k5yFgk8JWNeHp7kAOcfdFw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在routes/index.js中查找的代码</p></figure><ul class=""><li id="1ff8" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">用下面的代码片段替换它:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="dd4b" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 3</code> : <code class="fe oi oj ok ol b">ensureGuest</code>现在每当用户转到<code class="fe oi oj ok ol b">/</code>目录时，中间件就会运行。</li><li id="03a4" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 8</code>:同样，每当用户进入<code class="fe oi oj ok ol b">/dashboard</code>目录时，<code class="fe oi oj ok ol b">ensureAuth</code>中间件就会运行。</li></ul><p id="f33f" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这将是代码的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/ecd23a2261467fccba2eb1486eae0d3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/1*N1VPhGX809ypgffvpfK0qQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="6751" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">routes/index.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><h2 id="58c8" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">将登录会话存储在数据库中</h2><p id="7f97" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">到目前为止，我们的网络应用运行良好。但是有一个关键问题:如果NodeJS服务器重启，那么用户将再次被注销。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi py"><img src="../Images/0381dfe4449deba540a2ba143dfe57d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*XR5QFpGunWtM3uQ8g8o3wQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">重启服务器会使我们注销</p></figure><p id="43eb" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这个问题的一个解决方案是将用户的登录会话存储到数据库中。</p><p id="9549" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到<code class="fe oi oj ok ol b">/app.js</code> <strong class="lt iu">、</strong>并执行以下步骤。</p><ul class=""><li id="f59e" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">进口<code class="fe oi oj ok ol b">mongoose</code>和<code class="fe oi oj ok ol b">connect-mongo</code>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pz"><img src="../Images/70ac3091f7656b2d22dde54ac02e6dd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m2JcLBqtKSA1XuGJ9iguLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在app.js中导入库</p></figure><p id="adf5" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">line 2</code>中，我们将传递一个<code class="fe oi oj ok ol b">express-session</code>作为参数。这是因为<code class="fe oi oj ok ol b">connect-mongo</code>需要<code class="fe oi oj ok ol b">express-session</code>中间件才能正常工作。</p><ul class=""><li id="df41" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">现在，向下滚动并找到下面这段代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/7efc44a0c5b581d3bb4e637d75ff0e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*HWm3l-tyy25Kmr4ISOSADw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在app.js中查找的代码</p></figure><ul class=""><li id="817c" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">将它替换为以下代码片段:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qb"><img src="../Images/52005aa6dea0ab89fe612907a71645f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R02iGV2hWRRVpdL6UbOnLQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app.js中要替换的代码</p></figure><p id="a7e0" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们刚刚添加了<code class="fe oi oj ok ol b">store</code>属性，并告诉它使用当前正在使用的Mongoose连接。</p><p id="ca1e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">再次运行该程序。瞧啊。问题已经消失了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi py"><img src="../Images/f9eaca967454d02f093150a2cdfa8c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*u8x_xUIygw1RXnrDR2b9yQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="68e3" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">app.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><h2 id="5bc9" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">问候用户</h2><p id="81af" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">为了让我们的用户体验更好，让我们在用户进入仪表板时用他们的名字问候他们。</p><p id="da0a" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">为此，转到<code class="fe oi oj ok ol b">views/partials</code>并创建一个名为<code class="fe oi oj ok ol b">_dashboard.hbs</code>的新文件。在<code class="fe oi oj ok ol b">views/partials/_dashboard.hbs</code>中，编写以下代码行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="62a0" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这里，我们只是使用将通过Express发送给我们的<code class="fe oi oj ok ol b">name</code>数据。</p><p id="c90d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在转到<code class="fe oi oj ok ol b">views/dashboard.hbs</code> <strong class="lt iu"> </strong>并在末尾添加以下代码行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/ae9ceef85d0699e6366eb00937322a33.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*qJ1RYSjvuze39eW8fTj8SQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要添加到views/dashboard.hbs中的代码</p></figure><p id="e1e9" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这一行表示我们现在将在<code class="fe oi oj ok ol b">dashboard.hbs</code>文件中使用<code class="fe oi oj ok ol b">_dashboard.hbs</code>部分。</p><p id="e40d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在转到<code class="fe oi oj ok ol b">routes/index.js</code>并执行以下步骤。</p><ul class=""><li id="9f85" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">找到下面这段代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qd"><img src="../Images/32c220ee37b815d70553d7ef9aab5cdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6eqa8p30pcmaJgNs0BCag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">routes/index.js中要替换的代码</p></figure><p id="2a23" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">并替换为以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qe"><img src="../Images/0ad7ae17fa437110269137db19530637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NO6dFkCxKSAHU-jnAQEIig.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">routes/index.js中要替换的代码</p></figure><p id="4657" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在这里，我们渲染<code class="fe oi oj ok ol b">dashboard.hbs</code>并将<code class="fe oi oj ok ol b">name</code>变量作为数据发送，以便它可以被显示。</p><p id="7f25" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这将是代码的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qf"><img src="../Images/bef4ec3b52aff83ffb111a24977d4056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*rNs9GQeGWiAsnZInrxOBNA.png"/></div></figure><p id="95ec" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最终，<code class="fe oi oj ok ol b">routes/index.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="3e24" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">恭喜，我们终于完成了使用Passport的Google OAuth！最难的部分已经完成了。</p><p id="6f72" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">当你准备好了，在下一节我们将创建我们的Notes应用程序，这是本教程的要点。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="5b69" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">笔记应用程序:开始使用</h1><h2 id="8e5b" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">主体解析器中间件</h2><p id="eb8a" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">我们将使用这个中间件来解析来自客户端的输入。</p><p id="cace" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到<code class="fe oi oj ok ol b">/app.js</code>并编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qg"><img src="../Images/c4cba552836845120cf1fd3c02f51b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Bkvs-Ox4ak-iLFH9V8ZBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在app.js中编写的代码</p></figure><p id="bcc7" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">完成后，让我们继续创建<code class="fe oi oj ok ol b">notes.js</code>文件。</p><h2 id="89d5" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">notes.js文件</h2><p id="2005" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在开始之前，去你的<code class="fe oi oj ok ol b">routes</code>目录。在那里，创建一个名为<code class="fe oi oj ok ol b">notes.js</code>的文件。这个文件将是一个路由器实例，它将处理从<code class="fe oi oj ok ol b">/notes</code>开始的所有路由。随着本教程的深入，我们将向该文件添加更多的代码。</p><p id="5a4c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在转到根目录下的<code class="fe oi oj ok ol b">app.js</code>。在这里，我们将告诉Express所有以<code class="fe oi oj ok ol b">/notes</code>开头的路线。</p><p id="afc1" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">/app.js</code>、<strong class="lt iu">、</strong>中编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qh"><img src="../Images/ee6f1644b3af84292841f946894f5b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Hxcd1lQLAc_8cMB6ifmIw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要写入notes.js的代码</p></figure><p id="6aa8" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们现在已经完成了初始阶段。让我们在Mongoose中为我们的Note文档创建一个模型。</p><p id="4503" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">/app.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="2e3e" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">Mongoose Notes数据库设置</h1><h2 id="cf2e" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">笔记模型</h2><p id="ea20" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">我们首先需要在Mongoose中创建一个notes模型，这样就可以将它们保存到数据库中。</p><p id="3718" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在您的<code class="fe oi oj ok ol b">models</code>文件夹中，创建一个名为<code class="fe oi oj ok ol b">Note.js</code>的新文件。</p><p id="d063" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<strong class="lt iu"> </strong> <code class="fe oi oj ok ol b">models/Note.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="2e8e" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 5–16</code>:保存注释的标题和正文。此外，我们还保存了笔记的创建日期。</li><li id="f2dc" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 17</code>:保存对<code class="fe oi oj ok ol b">User</code>模型的引用。我们这样做是为了让用户看不到其他用户的个人笔记。我们将在本教程的后面详细讨论这一点。</li><li id="851a" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 20</code>:以<code class="fe oi oj ok ol b">Note</code>的名称导出模型，以便在我们的应用程序中使用。</li></ul><p id="92dc" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们现在已经创建了笔记模型。现在让我们来看看这个应用程序的CRUD功能。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="ee48" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">Notes中的CRUD功能</h1><h2 id="a330" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">导入库</h2><p id="a333" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在开始本节之前，让我们先在<code class="fe oi oj ok ol b">routes/notes.js</code>中导入所需的库。</p><p id="cf41" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到<code class="fe oi oj ok ol b">routes/notes.js</code>并编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qi"><img src="../Images/0cedab329edf43e2e51db737f3550175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qejbx1pvX60ZboILpd_FZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在routes/notes.js中编写的代码</p></figure><ul class=""><li id="fbc1" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 1 &amp; 3</code>:因为我们正在处理路线，我们已经导入了<code class="fe oi oj ok ol b">express</code>库和一个<code class="fe oi oj ok ol b">express.Router</code>实例。</li><li id="ec78" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 2</code>:我们希望确保客户端在执行CRUD相关操作时保持登录状态。为此，还导入了<code class="fe oi oj ok ol b">ensureAuth</code>功能。</li><li id="8bfd" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 4</code>:因为我们在Mongoose中对我们的<code class="fe oi oj ok ol b">Note</code>模型执行CRUD操作，我们也将在我们的模块中导入<code class="fe oi oj ok ol b">Note</code>模型。</li></ul><p id="b99c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">当这个阶段完成后，让我们继续创建一个注释。</p><h2 id="155d" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">编写或创建便笺</h2><p id="fa29" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在您的<code class="fe oi oj ok ol b">views</code>目录中，创建一个名为<code class="fe oi oj ok ol b">notes</code>的新文件夹。在<code class="fe oi oj ok ol b">notes</code>文件夹中，创建一个名为<code class="fe oi oj ok ol b">add.hbs</code>的文件。</p><p id="7259" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">views/notes/add.hbs</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="0cad" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在这里，我们构建了一个包含两个<code class="fe oi oj ok ol b">textarea</code>元素的简单网页，其中一个名为<code class="fe oi oj ok ol b">title</code>，另一个名为<code class="fe oi oj ok ol b">body</code>。提交后，表单将向<code class="fe oi oj ok ol b">notes/add</code>目录发出<code class="fe oi oj ok ol b">POST</code>请求。</p><p id="1c0b" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">首先，我们需要在仪表板上为这个页面创建一个链接。为此，转到<code class="fe oi oj ok ol b">views/dashboard.hbs</code>，添加以下代码行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qj"><img src="../Images/94f76f26d57775ab7f73ba36749982ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9tVwzS4nn16r1ggV-IV7fQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在views/dashboard.hbs中编写的代码</p></figure><p id="e427" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这将在仪表板页面上创建一个链接，以便用户可以被重定向到<code class="fe oi oj ok ol b">/notes/add</code>路线。</p><p id="acab" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在我们处理这个路由的<code class="fe oi oj ok ol b">GET</code>和<code class="fe oi oj ok ol b">POST</code>请求。转到<code class="fe oi oj ok ol b">/routes/notes.js</code>，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="1284" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 1–3</code>:处理对<code class="fe oi oj ok ol b">/notes/add</code>目录的<code class="fe oi oj ok ol b">GET</code>请求。当用户去<code class="fe oi oj ok ol b">/notes/add</code>时，就会呈现出<code class="fe oi oj ok ol b">add.hbs</code>文件。中间件确保用户始终保持登录状态。</li><li id="6b7d" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 5</code>:处理<code class="fe oi oj ok ol b">POST</code>对<code class="fe oi oj ok ol b">/notes/add</code>的请求。</li><li id="7da3" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 7</code>:因为Passport，我们已经有了登录用户的ID。我们现在将这些数据传递到<code class="fe oi oj ok ol b">req.body</code>对象中，以便MongoDB可以将用户的ID存储到Note文档中。</li><li id="97e0" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 8-9</code>:将我们的注释存储到MongoDB中，然后将用户重定向到仪表板。</li><li id="10c1" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 11</code>:如果我们在保存文档时遇到错误，则注销该错误。</li></ul><p id="26dd" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，这应该是代码的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qk"><img src="../Images/c1de7ab92a879457b00f7c39b3510854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/1*n_LiZBq4OVd5JD4d4ZO9ZA.gif"/></div></figure><p id="6773" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这意味着我们的代码有效！现在我们需要列出所有保存的笔记。</p><h2 id="f9f7" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">列出我们所有的笔记</h2><p id="7f46" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">首先，转到<code class="fe oi oj ok ol b">routes/index.js</code>并执行以下步骤。</p><ul class=""><li id="6c24" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">导入我们刚刚创建的<code class="fe oi oj ok ol b">Note</code>模型:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/cb051d5c2a3dc5290eba78af606f9970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2J0s4GDK6qvv3hhjI6gwSg.png"/></div></div></figure><ul class=""><li id="6e6e" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">现在找到处理<code class="fe oi oj ok ol b">/dashboard</code>路线的那段代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/cac860578b56fca3794cfa525e5b515c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*iKkTrbXYN6ZZ2B_xnigBHA.png"/></div></figure><ul class=""><li id="6882" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">在这里，我们将获取我们所有的笔记，然后将它们发送到<code class="fe oi oj ok ol b">dashboard.hbs</code>页面。编写以下代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ql"><img src="../Images/00687b9f6b55b54806acb57bdc00842c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_UpmtMOD9_o34ZihH0tDFg.png"/></div></div></figure><ul class=""><li id="a4ba" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 3</code>:在数据库中找到我们所有的<code class="fe oi oj ok ol b">Note</code>文档，然后转换成JavaScript对象数组(因此有了<code class="fe oi oj ok ol b">lean</code>函数)，然后保存到一个名为<code class="fe oi oj ok ol b">notes</code>的变量中。</li><li id="8c64" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 4</code>:呈现<code class="fe oi oj ok ol b">dashboard.hbs</code>页面，发送登录用户名(<code class="fe oi oj ok ol b">req.user.firstName</code>)和<code class="fe oi oj ok ol b">notes</code>数据。</li></ul><p id="a521" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在我们需要呈现一个显示数据的表格。</p><p id="ae3b" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">partials/_dashboard.hbs</code> <strong class="lt iu">、</strong>中追加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="5069" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这里，我们刚刚构建了一个带有两个标题的表格:标题和创建日期。但是，我们需要注意这几行:</p><ul class=""><li id="93ef" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 11–15</code>:对于出现在<code class="fe oi oj ok ol b">notes</code>数组中的每个票据文档，创建一个单独的行。在<code class="fe oi oj ok ol b">Title</code>标题下，应该有我们笔记的标题，而<code class="fe oi oj ok ol b">Date</code>标题应该有笔记的创建日期。请记住，我们已经在<code class="fe oi oj ok ol b">Note</code>模型中保存了这些数据。我们只是展示一下。</li><li id="cbb3" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 16–24</code>:我们还创建了单独的<code class="fe oi oj ok ol b">td</code>元素，这样每个笔记都可以有自己的删除和编辑选项。在<code class="fe oi oj ok ol b">line 18</code>，我们试图发送一个删除请求。由于这不可能通过浏览器实现，我们将使用<code class="fe oi oj ok ol b">method-override</code>包来执行这个请求。我们将在本教程的后面处理这些路线。</li></ul><p id="246a" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">运行代码。这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qm"><img src="../Images/aaa28a34511a42af22bd5de695f5a0dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*G4EXL7fMMwdQXt_8pJVGIw.gif"/></div></div></figure><p id="e0c4" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">然而，有一个致命的问题:如果另一个用户使用他自己的谷歌账户创建一个笔记，平台上的其他用户也有可能看到那个用户的笔记。这是一个关键的隐私问题，因为我们不希望用户看到彼此的个人笔记。这可以这样证明:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/1cf82ebe3a636d0bbf0a2466eab9ed59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yyxoU5TMDKJCrQ0bNcObww.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用一个账户做一个笔记，用另一个账户做另一个笔记。</p></figure><p id="cc89" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这个问题的解决方案非常简单。在仪表板上，我们只需要显示登录用户写的笔记，而不是其他任何人。</p><p id="e780" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到<code class="fe oi oj ok ol b">routes/index.js</code>，执行以下步骤:</p><ul class=""><li id="a890" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">找到下面这段代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qn"><img src="../Images/eb07b49f12d700a4248a46f98bb5de38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9coc75Y2U2o1T21HvnjK6Q.png"/></div></div></figure><p id="3174" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">并用下面的代码片段替换它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qn"><img src="../Images/ba2953b2e89add470cd2637b892792ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-L2XIQ7f61isikeLyFqS-Q.png"/></div></div></figure><p id="5111" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">唯一的变化是在<code class="fe oi oj ok ol b">Line 3</code>上，我们告诉Mongoose只查找登录用户写的笔记。</p><p id="f06c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这将是代码的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qo"><img src="../Images/207cfde47e2e28490be711b44574e629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FXouhIarGjPMIjqRhMjnHw.png"/></div></div></figure><p id="c188" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在两个用户都看不到对方的笔记了！我们现在已经完成了这一部分。</p><p id="baac" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最终，<code class="fe oi oj ok ol b">routes/index.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="c440" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">当用户点击他的一个笔记时，他希望看到一个页面，在那里他可以看到笔记的完整标题和正文。让我们在下一节做这件事。</p><h2 id="4c70" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">读一张纸条</h2><p id="e158" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">为此，请转到您的<code class="fe oi oj ok ol b">routes/notes.js</code>模块。在这里，编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qp"><img src="../Images/d917420fa53e6ba24ae708a2bf680ccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pkNZot_rTaWJU3j1aeGLtQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在routes/notes.js中编写的代码</p></figure><ul class=""><li id="e08d" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 1</code>:用<code class="fe oi oj ok ol b">id</code>参数处理<code class="fe oi oj ok ol b">/notes</code>目录。</li><li id="8f75" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 3</code>:使用其ID查找笔记文档。我们可以通过用<code class="fe oi oj ok ol b">req.params.id</code>获取<code class="fe oi oj ok ol b">id</code>参数来获取注释的ID。</li><li id="7cea" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 5</code>:渲染<code class="fe oi oj ok ol b">read.hbs</code>文件，将<code class="fe oi oj ok ol b">note</code>对象发送到文件中。</li></ul><p id="bf3d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在我们需要对<code class="fe oi oj ok ol b">read.hbs</code>文件进行编码。</p><p id="2c4d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在您的<code class="fe oi oj ok ol b">views/notes</code>目录中，创建一个名为<code class="fe oi oj ok ol b">read.hbs</code>的文件。</p><p id="b961" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">views/notes/read.hbs</code>、<strong class="lt iu">、</strong>中编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="77ff" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 1-5</code>:呈现便笺的标题、正文和创建日期。</li><li id="7bb6" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 8–11</code>:这里，我们正在执行一个<code class="fe oi oj ok ol b">DELETE</code>请求。创建删除按钮。在本教程的后面，我们将使用<code class="fe oi oj ok ol b">method-override</code>模块发送<code class="fe oi oj ok ol b">DELETE</code>请求。</li><li id="90d0" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 13</code>:呈现编辑页面来编辑我们的注释。我们将在本教程的后面处理这条路线。</li></ul><p id="9b3d" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">运行您的代码。这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qq"><img src="../Images/6a8b222299902b0f29eea6647b456bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/1*GITWWVnw3ylnxVbVCvzwkA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="eb9e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这表明我们的代码起作用了！在下一部分，我们将学习如何更新或编辑我们的笔记。</p><p id="84b1" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最终，<code class="fe oi oj ok ol b">routes/notes.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><h2 id="34a0" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">更新或编辑注释</h2><p id="e5cb" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在开始之前，我们需要使用<code class="fe oi oj ok ol b">method-override</code>模块。该模块将允许我们通过浏览器执行<code class="fe oi oj ok ol b">PUT</code>和<code class="fe oi oj ok ol b">DELETE</code>请求。</p><p id="91db" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到<code class="fe oi oj ok ol b">/app.js</code>并执行以下步骤:</p><ul class=""><li id="6039" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">像这样导入<code class="fe oi oj ok ol b">method-override</code>模块:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qr"><img src="../Images/1e918d0bde5725a7aac08a94b38d4018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*drI1JtT_5pfdeMAH6mopuw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在app.js中导入库</p></figure><ul class=""><li id="2a6a" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">现在我们需要使用这个模块作为中间件。编写以下代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qs"><img src="../Images/01c3754e8f76a7de8e1b43eb2daa3a21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vvyLNrNCxtX9rv4mVjikUQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在app.js中编写的代码</p></figure><p id="65a7" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">更多信息，建议您参考<code class="fe oi oj ok ol b"><a class="ae ky" href="https://www.npmjs.com/package/method-override" rel="noopener ugc nofollow" target="_blank">method-override</a></code> <a class="ae ky" href="https://www.npmjs.com/package/method-override" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="40db" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在我们的Handlebar文件中，我们已经用<code class="fe oi oj ok ol b">ID</code>参数指定用户将被重定向到<code class="fe oi oj ok ol b">/notes/edit</code>目录。这条路线将呈现编辑页面。让我们首先创建编辑页面。</p><p id="f45b" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到您的<code class="fe oi oj ok ol b">views/notes</code>目录，创建一个名为<code class="fe oi oj ok ol b">edit.hbs</code>的新文件。</p><p id="6c45" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">views/notes/edit.hbs</code>中，编写以下代码行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="ba07" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 1–2</code>:这实际上告诉<code class="fe oi oj ok ol b">method-override</code>我们将创建一个<code class="fe oi oj ok ol b">PUT</code>请求，而不是发送一个<code class="fe oi oj ok ol b">POST</code>请求(如<code class="fe oi oj ok ol b">line 2</code>所示)。</li><li id="b095" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 4</code>:创建一个<code class="fe oi oj ok ol b">textarea</code>元素，它已经包含了注释的标题。</li><li id="0c19" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 8</code>:创建一个<code class="fe oi oj ok ol b">textarea</code>元素，它已经包含了注释的主体。</li><li id="abe6" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 12</code>:呈现提交按钮，该按钮将文本区域的值发送到数据库，以便可以编辑注释。</li></ul><p id="9181" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在在<code class="fe oi oj ok ol b">routes/notes.js</code>中，我们需要首先渲染<code class="fe oi oj ok ol b">edit.hbs</code>文件。</p><p id="20d2" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">routes/notes.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qt"><img src="../Images/bdfa4e114773390e9b0c1e3aedad1eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-KBJOfIHMl2GWtMmY_-2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在routes/notes.js中编写的代码</p></figure><ul class=""><li id="3882" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 1</code>:处理URL中包含<code class="fe oi oj ok ol b">ID</code>参数的<code class="fe oi oj ok ol b">notes/edit</code>目录。</li><li id="c108" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 3</code>:通过其ID查找相关笔记。我们可以用<code class="fe oi oj ok ol b">req.params.id</code>值获得这个ID。接下来，我们使用<code class="fe oi oj ok ol b">lean()</code>方法将文档转换成普通的JavaScript对象。</li><li id="9407" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 4</code>:渲染<code class="fe oi oj ok ol b">edit.hbs</code>文件，将<code class="fe oi oj ok ol b">note</code>对象作为数据发送。</li></ul><p id="dd52" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">接下来，我们需要处理<code class="fe oi oj ok ol b">PUT</code>请求，这将允许我们编辑数据库中的数据。</p><p id="7bdd" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">routes/note.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pz"><img src="../Images/2ac3766a98d12ee1cf34c3ea7923f994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-bZRswHX5WWgXS0UIUlNg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在routes/note.js中编写的代码</p></figure><ul class=""><li id="0648" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 1</code>:在<code class="fe oi oj ok ol b">/notes/</code>目录下处理<code class="fe oi oj ok ol b">PUT</code>请求，该目录包含URL中的参数<code class="fe oi oj ok ol b">ID</code>。</li><li id="dc28" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Lines 3–4</code>:通过笔记文档的ID找到笔记文档。我们可以通过<code class="fe oi oj ok ol b">req.params.ID</code>值获得ID。</li><li id="784f" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 5</code>:用<code class="fe oi oj ok ol b">textarea</code>元素的值更新文档的<code class="fe oi oj ok ol b">title</code>和<code class="fe oi oj ok ol b">body</code>值。</li><li id="e4a0" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 7</code>:完成后，将用户重定向到<code class="fe oi oj ok ol b">/dashboard</code>目录。</li></ul><p id="c3c1" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在运行代码。这将是代码的输出。在这里，我们正在从仪表板进行编辑。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qu"><img src="../Images/0f9c03d4538edb891e3d3b465a1a6c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aZv49DUyid4TkE8cB6Ipdw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="7c83" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">太好了！这个代码有效！现在让我们继续删除我们的笔记文档。</p><p id="146c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最终，<code class="fe oi oj ok ol b">routes/notes.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="5a6e" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">而这就是<strong class="lt iu"> </strong> <code class="fe oi oj ok ol b"><strong class="lt iu">/app.js</strong></code>应该有的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><h2 id="1d19" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">删除注释</h2><p id="fdc1" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">让我们回溯一下。请注意，无论我们在车把文件中的什么地方实现了删除按钮，我们都编写了以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qv"><img src="../Images/c077ba8d57f0b3c48032bd813acb0df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lcYUyKK3_vRnlEslhEliyA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">执行删除请求的代码</p></figure><p id="ffdc" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">您可以在<code class="fe oi oj ok ol b">views/partials/_dashboard.hbs</code>和<code class="fe oi oj ok ol b">views/notes/read.hbs</code>文件中找到这个片段。这段代码告诉<code class="fe oi oj ok ol b">method-override</code>我们将创建一个<code class="fe oi oj ok ol b">DELETE</code>请求(如<code class="fe oi oj ok ol b">line 2</code>所示)，而不是发送一个<code class="fe oi oj ok ol b">POST</code>请求。</p><p id="5a80" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在剩下的就是处理这个<code class="fe oi oj ok ol b">DELETE</code>请求了。</p><p id="c078" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">为此，转到<code class="fe oi oj ok ol b">routes/notes.js</code>，并编写以下代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/d811886c6d15e07ebff072a5462a5771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OrKGx5iJbXLdC3tY5VoXLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在routes/notes.js中编写的代码</p></figure><ul class=""><li id="f01a" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 1</code>:处理URL中包含<code class="fe oi oj ok ol b">ID</code>参数的<code class="fe oi oj ok ol b">/notes/delete</code>目录。</li><li id="b4f1" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 3</code>:运行<code class="fe oi oj ok ol b">deleteOne</code>mongose方法，该方法将查询Note文档及其ID。我们可以通过<code class="fe oi oj ok ol b">req.params.id</code>的值来获取该纸币的ID。</li><li id="b596" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 4</code>:现在将用户重定向到<code class="fe oi oj ok ol b">/dashboard</code>路线。</li></ul><p id="3ac4" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">运行代码。在这里，我们将从控制面板页面中删除。这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qu"><img src="../Images/17db6d0fd6748dd5ba38f2bfe02d820c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FJtb_NsJlIDeOTaQNlwoEQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="935f" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">瞧啊。我们成功了！我们终于用Google OAuth创建了Notes应用程序。</p><p id="e614" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">但是，如果您愿意，还可以做一些收尾工作来增强用户体验。这是完全可选的。</p><p id="bff1" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">routes/notes.js</code>看起来是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="c5b3" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">改善用户体验</h1><h2 id="8497" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">显示用户的个人资料照片</h2><p id="8b39" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">在设计我们的<code class="fe oi oj ok ol b">UserSchema</code>时，我们还包含了一个<code class="fe oi oj ok ol b">image</code>属性，它指向用户个人资料图片的URL。</p><p id="d943" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">让我们从将用户的图像发送到<code class="fe oi oj ok ol b">dashboard.hbs</code>文件开始。</p><p id="7a77" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">为此，转到<strong class="lt iu"> </strong> <code class="fe oi oj ok ol b"><strong class="lt iu">routes/index.js</strong></code> <strong class="lt iu"> </strong>文件并执行以下步骤。</p><ul class=""><li id="8789" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">找到处理<code class="fe oi oj ok ol b">/dashboard</code>路线的那段代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qw"><img src="../Images/d36648c44c93f8f81cc96f3a79d5de36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0lKIfdEsfw19uGAfVynhA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">routes/index.js中要替换的代码</p></figure><ul class=""><li id="ed4a" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">用以下内容替换:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qw"><img src="../Images/af218aeed6507006c3e14787d38da863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rdwfnRCQbzqlym0D_hjoig.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">routes/index.js中要替换的代码</p></figure><p id="47b3" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">唯一的变化是在<code class="fe oi oj ok ol b">Line 8</code>上，我们也将用户的<code class="fe oi oj ok ol b">image</code>数据发送到<code class="fe oi oj ok ol b">dashboard.hbs</code>。</p><p id="3ae8" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">剩下的就是渲染<code class="fe oi oj ok ol b">dashboard.hbs</code>中的图像了。</p><p id="6789" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到<code class="fe oi oj ok ol b">views/dashboard.hbs</code> <strong class="lt iu"> </strong>，在开头写下下面一行代码:</p><pre class="kj kk kl km gt qx ol qy qz aw ra bi"><span id="d21b" class="nw la it ol b gy rb rc l rd re">{{!-- Code to write in views/dashboard.hbs --}}<br/>&lt;img src="{{imgSrc}}" referrerpolicy="no-referrer" /&gt;</span></pre><p id="3521" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在运行代码。以下是仪表板页面上的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi rf"><img src="../Images/46730c959e5a438a2fb8ac2d25f4d510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SIfS0wkvdHfTYGWwsRTb6Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="5fe8" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">太好了！我们终于可以看到用户的个人资料图像了。</p><p id="21f0" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在下一节中，我们将格式化日期以使其更短。</p><h2 id="6074" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">格式化日期</h2><p id="7ffa" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">我们将使用<code class="fe oi oj ok ol b">moment</code>包来格式化日期。</p><p id="a83f" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">首先，在根目录下创建一个名为<code class="fe oi oj ok ol b">helpers</code>的新文件夹。在<code class="fe oi oj ok ol b">helpers</code>中，创建一个名为<code class="fe oi oj ok ol b">formatDate.js</code>的新模块。</p><p id="5ace" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">在<code class="fe oi oj ok ol b">helpers/formatDate.js</code>中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><ul class=""><li id="4286" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 1</code>:导入<code class="fe oi oj ok ol b">moment</code>库。</li><li id="979b" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><code class="fe oi oj ok ol b">Line 3–5</code>:导出一个以date为参数的函数，返回一个格式为<code class="fe oi oj ok ol b">Month Date Year H:M:S</code>的日期。</li></ul><p id="8446" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在我们需要告诉寄存器<code class="fe oi oj ok ol b">formateDate</code>作为一个辅助函数。</p><p id="3a23" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到<code class="fe oi oj ok ol b">/app.js</code>并执行以下步骤。</p><ul class=""><li id="51f9" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">导入<code class="fe oi oj ok ol b">formatDate</code>功能:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi rg"><img src="../Images/9694549d8092696a3f49536bb1a41157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G97rjIcxyf6_8pirCwcYyg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在app.js中导入库</p></figure><p id="2721" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在我们需要告诉<code class="fe oi oj ok ol b">express-handlebars</code>使用<code class="fe oi oj ok ol b">formatDate</code>作为辅助函数。</p><ul class=""><li id="0248" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">找到下面这段代码:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi rh"><img src="../Images/62635b073d0ee3d6c30d3b97f180dde7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*cNnv1t33ggPPa6Zd88gbfQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在app.js中替换的代码</p></figure><p id="ae03" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">并替换为以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ri"><img src="../Images/029cf3eddd476aacace609ae813ea1f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*yZGDsLKA6kQZa3EmQTFJjA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">app.js中要替换的代码</p></figure><p id="2ca6" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">唯一的变化是在<code class="fe oi oj ok ol b">Line 6</code>上。我们现在已经告诉<code class="fe oi oj ok ol b">express-handlebars</code>我们可以使用<code class="fe oi oj ok ol b">formatDate</code>函数作为辅助方法。剩下的就是用这个了。</p><p id="660f" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">为此，我们首先从仪表板页面开始。转到<code class="fe oi oj ok ol b">views/partials/_dashboard.hbs</code> <strong class="lt iu">、</strong>并执行以下步骤。</p><ul class=""><li id="296d" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">找到显示时间的代码行:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi rh"><img src="../Images/702bcef7cdaaa53f09323ef9dbfc82fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*8kS3d9jaCN26xANzrJFpZw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在views/partials/_dashboard.hbs中替换的代码</p></figure><ul class=""><li id="9304" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">现在，将其替换为以下内容:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi rf"><img src="../Images/9b51cb2fcd44d8377cf2fe566af3f712.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FoVAR1oEHKS8HYsRcW2DYA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要替换为in views/partials/_ dashboard . HBS的代码</p></figure><p id="8570" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">现在让我们对<code class="fe oi oj ok ol b">read.hbs</code>做同样的事情。</p><p id="ebc2" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">转到<code class="fe oi oj ok ol b">views/notes/read.hbs</code> <strong class="lt iu">、</strong>并执行以下步骤:</p><ul class=""><li id="7d9b" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">找到显示创建日期的代码行:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi rj"><img src="../Images/6e6d2570863403327625828216e26286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*TvJLrU2NEm-lCsMx3uwuyA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">要在views/notes/read.hbs中替换的代码</p></figure><ul class=""><li id="db58" class="lr ls it lt b lu nn lw no ly np ma nq mc nr me mf mg mh mi bi translated">现在将其替换为以下内容:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi rk"><img src="../Images/bdf32a7d26103569143d8257e9ca5725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQla5eSpyfGIfWtnoKFCrg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在views/notes/read.hbs中替换为的代码</p></figure><p id="a627" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">太好了！我们都做完了。让我们运行代码。以下是仪表板页面上的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/50c4db4663d9ced73202a884b4df6f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*OmcsNtaTVnbLM7b9e0W0vw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="ba77" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">瞧啊。代码起作用了！</p><p id="e84c" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">最后，<code class="fe oi oj ok ol b">/app.js</code> <strong class="lt iu"> </strong>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="2f49" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">我们都做完了！有一些建议可以让这个应用程序看起来更好。</p><h2 id="1136" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">改进应用程序</h2><ul class=""><li id="a9e9" class="lr ls it lt b lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="lt iu">更好的用户界面</strong>:为了在不损失任何功能的情况下让教程尽可能的简单，我没有把重点放在让web应用看起来更好上。可以使用<a class="ae ky" href="https://materializecss.com/" rel="noopener ugc nofollow" target="_blank"> Materialize、</a>这样的组件，让它看起来很醒目。</li><li id="4760" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">在将笔记保存到数据库之前对其进行加密:一些用户可能希望对他们的数据保密，不希望任何人窥探他们。你可以通过使用<code class="fe oi oj ok ol b"><a class="ae ky" href="https://nodejs.org/api/crypto.html" rel="noopener ugc nofollow" target="_blank">crypto</a></code>或<code class="fe oi oj ok ol b"><a class="ae ky" href="https://www.npmjs.com/package/mongoose-encryption" rel="noopener ugc nofollow" target="_blank">mongoose-encryption </a></code>来加密用户的笔记，这样如果有人查看了应用程序的数据库，就没有人可以读取其他人的数据。</li></ul></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="abb0" class="kz la it bd lb lc mv le lf lg mw li lj jz mx ka ll kc my kd ln kf mz kg lp lq bi translated">结论</h1><p id="aadb" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">如果您有任何困难，那么建议您使用代码并广泛研究，以完全掌握Passport身份验证和Notes应用程序的内部工作原理。不要放弃！</p><p id="d797" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">这篇教程绝不是一篇短文。恭喜你坚持到了最后！我希望你从这篇文章中学到了很多。感谢阅读！</p><h1 id="601e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">GitHub链接和其他学习资源</h1><h2 id="884a" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">Github知识库</h2><p id="f263" class="pw-post-body-paragraph na nb it lt b lu lv ju nc lw lx jx nd ly ne nf ng ma nh ni nj mc nk nl nm me im bi translated">这是这个项目的<a class="ae ky" href="https://github.com/HussainArif12/notes-google-auth" rel="noopener ugc nofollow" target="_blank"> Github回购</a>。</p><h2 id="c0d3" class="nw la it bd lb nx ny dn lf nz oa dp lj ly ob oc ll ma od oe ln mc of og lp oh bi translated">额外学习</h2><ul class=""><li id="94cc" class="lr ls it lt b lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=SBvmnHTQIPY" rel="noopener ugc nofollow" target="_blank">故事书应用程序——在YouTube上浏览媒体</a></li><li id="bf72" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=o9e3ex-axzA" rel="noopener ugc nofollow" target="_blank">快递(NodeJS)——谷歌oauth 2.0——Youtube上的武卡</a></li><li id="faec" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated"><a class="ae ky" href="https://dev.to/phyllis_yym/beginner-s-guide-to-google-oauth-with-passport-js-2gh4" rel="noopener ugc nofollow" target="_blank">谷歌OAuth初学者指南。</a></li><li id="0064" class="lr ls it lt b lu mj lw mk ly ml ma mm mc mn me mf mg mh mi bi translated">用Mongoose在NodeJS上创建一个Notes应用程序</li></ul></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="cae0" class="pw-post-body-paragraph na nb it lt b lu nn ju nc lw no jx nd ly ns nf ng ma nt ni nj mc nu nl nm me im bi translated">下一篇:<a class="ae ky" href="https://medium.com/javascript-in-plain-english/build-a-react-pomodoro-app-with-material-ui-and-tailwindcss-e4bab98e30ae" rel="noopener">用TailwindCSS和Material-UI </a>构建React Pomodoro App<br/>上一篇:<a class="ae ky" href="https://codeburst.io/simple-web-scraping-project-with-node-js-b2a1710b4b37" rel="noopener" target="_blank">用Node.js构建简单的网页抓取项目</a></p></div></div>    
</body>
</html>