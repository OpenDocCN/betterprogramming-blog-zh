<html>
<head>
<title>How to Obfuscate Python Scripts With PyArmor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用PyArmor混淆Python脚本</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-obfuscate-python-scripts-with-pyarmor-7b7d45efaf76?source=collection_archive---------0-----------------------#2022-08-22">https://betterprogramming.pub/how-to-obfuscate-python-scripts-with-pyarmor-7b7d45efaf76?source=collection_archive---------0-----------------------#2022-08-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="503e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让你的源代码不可读</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b983522e65e706c0a947681789857b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A1n0de-51nXfWfZs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@markuswinkler?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·温克勒</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="fc1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用Python编写程序很棒:它们写起来很快，而且非常容易阅读。然而，有时你不希望你的软件代码如此容易理解，原因有很多，从商业秘密到加强付费墙。</p><p id="f480" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分发经典Python程序的问题是，任何人都可以在编辑器中打开文件并阅读源代码，可能会修改你作为开发人员不想让用户接触的部分，删除应用内的付费墙，或了解你的程序如何工作。</p><p id="cdda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名开发人员，您可以使用代码混淆来使程序文件对人来说不可读，但对计算机来说仍然是可执行的，从而防止不希望看到的人潜入您的应用程序代码。模糊处理与加密的相似之处在于目标是相同的:隐藏消息，但加密需要解密才能使用信息，而模糊处理的代码通常可以直接运行。</p><h1 id="4c14" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装PyArmor</h1><p id="97ef" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要使用PyArmor，可以通过<code class="fe ms mt mu mv b">pip</code>安装:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="a0cf" class="na lw it mv b gy nb nc l nd ne">pip install pyarmor</span></pre><p id="9896" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您希望卸载PyArmor，请遵循其官方文档中“<a class="ae ky" href="https://pyarmor.readthedocs.io/en/latest/installation.html#clean-uninstallation" rel="noopener ugc nofollow" target="_blank">干净卸载</a>”部分的说明。</p><h2 id="0f89" class="na lw it bd lx nf ng dn mb nh ni dp mf li nj nk mh lm nl nm mj lq nn no ml np bi translated">使用PyArmor的基本混淆</h2><p id="c3f5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们首先创建一个名为<code class="fe ms mt mu mv b">script.py</code>的简单Python脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4493" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用PyArmor混淆Python脚本就像在控制台中运行以下命令一样简单:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="70b6" class="na lw it mv b gy nb nc l nd ne">pyarmor obfuscate script.py</span></pre><p id="5651" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将生成一个<code class="fe ms mt mu mv b">dist</code>文件夹，其中包含与原始文件同名的模糊Python文件以及运行时依赖项，如下面的文件夹结构所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/1c700cb5787a26c8dd5b78a679bb6df4.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*B5Y6a1dZGEbaTcnxHTcuKw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">文件夹结构</p></figure><p id="9f7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看输出<code class="fe ms mt mu mv b">dist/script.py</code>文件中有什么:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="aea2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不是很容易让人读懂，是吗？但是您仍然可以像这样运行它:</p><p id="2bf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ms mt mu mv b">python3 dist/script.py</code></p><p id="0376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在控制台输出中看到的那样，它会工作得很好:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="3031" class="na lw it mv b gy nb nc l nd ne">Hello World</span></pre><h2 id="fedd" class="na lw it bd lx nf ng dn mb nh ni dp mf li nj nk mh lm nl nm mj lq nn no ml np bi translated">混淆整个包</h2><p id="36cd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">PyArmor还允许您通过使用<code class="fe ms mt mu mv b">--recursive</code>选项来混淆整个Python包:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="c380" class="na lw it mv b gy nb nc l nd ne">pyarmor obfuscate --recursive --output [output path] [module init path]<br/>pyarmor obfuscate --recursive --output dist/module src/__init__.py</span></pre><h2 id="473f" class="na lw it bd lx nf ng dn mb nh ni dp mf li nj nk mh lm nl nm mj lq nn no ml np bi translated">更安全的混淆</h2><p id="df1f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果您希望混淆源代码中包含的字符串，这可能会给出一些关于程序正在做什么的提示，您可以像这样指定<code class="fe ms mt mu mv b">--mix-str</code>选项:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="752b" class="na lw it mv b gy nb nc l nd ne">pyarmor obfuscate --mix-str script.py</span></pre><p id="a6de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以使用<code class="fe ms mt mu mv b">--advanced</code>选项指定高级模糊模式:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="5dd2" class="na lw it mv b gy nb nc l nd ne">pyarmor obfuscate --advanced 1 script.py</span></pre><p id="a627" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">高级模式<code class="fe ms mt mu mv b">1</code>现在已被弃用，但在撰写本文时仍然有效。</p><p id="2c48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得更多保护，PyArmor提供了“超级模式”和“超级增强模式”要使用它们，您必须在<code class="fe ms mt mu mv b">obfuscate</code>命令中使用<code class="fe ms mt mu mv b">--advanced</code>参数指定它，如下所示:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="2839" class="na lw it mv b gy nb nc l nd ne">pyarmor obfuscate --advanced 2 script.py # Super Mode<br/>pyarmor obfuscate --advanced 5 script.py # Super Plus Mode</span></pre><p id="fc77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，超级模式不适用于免费试用用户。</p><h2 id="158c" class="na lw it bd lx nf ng dn mb nh ni dp mf li nj nk mh lm nl nm mj lq nn no ml np bi translated">添加许可证以获得更多限制</h2><p id="a83b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">PyArmor允许开发者通过使用<code class="fe ms mt mu mv b">licenses</code>命令在混淆程序中包含许可证。许可证可以指定运行程序必须满足的某些条件，如硬盘序列号、IP地址、日期、MAC地址等。</p><p id="c7bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，要生成指定到期日期的许可证，可以使用以下命令:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="ed40" class="na lw it mv b gy nb nc l nd ne">pyarmor licenses --expired [date] [license name]<br/>pyarmor licenses --expired 2019-01-01 r001</span></pre><p id="874d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了包含许可证，您运行带有<code class="fe ms mt mu mv b">--with-license</code>选项的<code class="fe ms mt mu mv b">obfuscate</code>命令:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="bc4b" class="na lw it mv b gy nb nc l nd ne">pyarmor obfuscate --with-license [license path] script.py<br/>pyarmor obfuscate --with-license licenses/r001/license.lic script.py</span></pre><p id="17b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您尝试运行一个不符合许可标准的程序，它会退出并显示以下消息:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="7848" class="na lw it mv b gy nb nc l nd ne">License is expired</span></pre><p id="ae51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关更多信息和许可选项，请查看官方文档。</p><h2 id="ed60" class="na lw it bd lx nf ng dn mb nh ni dp mf li nj nk mh lm nl nm mj lq nn no ml np bi translated">混淆性能</h2><p id="dd25" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">代码混淆很简洁，但是它带来了轻微的运行时性能下降。模糊处理通过添加冗余和看似随机的操作，同时保持程序行为不变，从而以降低可读性为代价换取了一定的执行速度。正因为如此，通常要运行的指令比清除代码要多。</p><p id="e36e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然几毫秒的性能下降对于小脚本来说无关紧要，但是大程序在混淆时可能会经历显著的速度差异。如果您计划混淆您的Python应用程序，您也应该考虑硬币的这一面。</p><p id="5c54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关性能问题以及每种模式如何影响性能的更多信息，您可以阅读<a class="ae ky" href="https://pyarmor.readthedocs.io/en/latest/performance.html#the-performance-of-obfuscated-scripts" rel="noopener ugc nofollow" target="_blank">官方文档</a>，包括一个小型基准测试。</p><h2 id="2739" class="na lw it bd lx nf ng dn mb nh ni dp mf li nj nk mh lm nl nm mj lq nn no ml np bi translated">分发混淆程序</h2><p id="f500" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可以使用<code class="fe ms mt mu mv b">pack</code>命令将混淆的Python文件打包成可执行文件进行分发。首先，您必须安装<code class="fe ms mt mu mv b">pyinstaller</code>:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="dfd5" class="na lw it mv b gy nb nc l nd ne">pip install pyinstaller</span></pre><p id="9696" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后运行以下命令:</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="83d2" class="na lw it mv b gy nb nc l nd ne">pyarmor pack script.py</span></pre><p id="993a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ms mt mu mv b">dist</code>文件夹中，您将找到要分发的混淆捆绑应用程序。</p><h1 id="0ea1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="aae9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">总结一下，PyArmor允许你混淆你的Python源代码，让不想要的眼睛很难看到你的程序文件。虽然模糊处理并不完美，而且有可能恢复出多少有些可读性的代码版本，但它向更安全的应用程序又迈进了一步。</p><p id="70c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这篇文章。如果你有什么要补充的，请在评论中分享你的想法。感谢阅读！</p><p id="5afe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您对另一种开发方法感兴趣，请查看下面的故事:</p><div class="nt nu gp gr nv nw"><a href="https://aws.plainenglish.io/why-i-now-develop-on-a-remote-virtual-machine-d9b340bbc200" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd iu gy z fp ob fr fs oc fu fw is bi translated">为什么我现在在远程虚拟机上开发</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">通过利用云提高您的工作效率并降低成本。</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">aws .平原英语. io</p></div></div><div class="of l"><div class="og l oh oi oj of ok ks nw"/></div></div></a></div></div></div>    
</body>
</html>