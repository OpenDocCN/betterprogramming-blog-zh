# 如何为 Spring Boot 应用程序创建 docker 文件

> 原文：<https://betterprogramming.pub/how-to-create-a-dockerfile-for-a-spring-boot-application-46878997382f>

## 创建 Spring Boot 容器的分步指南

![](img/16fcc1bbe9779d0167673b6726a65b1d.png)

马克西米利安·魏斯贝克尔在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片。

在本文中，我们将创建一个 Spring Dockerfile 文件。我的目标是为您提供入门所需的所有信息。我们将讨论我在一个宠物项目中的发现。在这个项目中，我使用了 [Gradle](https://gradle.org/) 和 [MongoDB](https://www.mongodb.com/) 来创建一个存储和检索图片的小应用程序。

在本文中，我们将检查创建 Spring Dockerfile 文件所需的每一行。我们将坚持从基础开始，所以如果你对这个主题不熟悉也不用担心。在本文结束时，您将准备好自己应用这些技术。对于任何一个开发人员来说，拥有一些 Docker 的专业知识是一个游戏规则的改变者。

你没看错。即使有完美的测试驱动思维，你的工作也不会因为到处乱搞而结束。要成为一名真正的工匠，你需要将你的代码投入生产。它必须与其他服务配合良好，必须稳定，而且必须对您的最终用户有价值。在我们这个行业，他们希望你熟悉集装箱。仅此一点就应该激励你浏览这篇文章。

不过别担心，不会太久的。我们将在五分钟内涵盖所有内容。

# 创建一个 Spring 应用程序

开始一个 Spring 项目很简单。外面有那么多向导。开始时，你需要做的就是去 Spring initializr 网站选择合适的依赖项。

初级程序员经常在这一点上过于兴奋。不要从一开始就添加不需要的依赖项。虽然包含奇特的库(例如 Lombok)可能很有诱惑力，但你可能还不需要它们( [YAGNI](https://www.martinfowler.com/bliki/Yagni.html) )。所以尽量只加基本的。您添加的每个依赖项也会增加应用程序的大小。

如果您没有应用程序，请转到 [spring.io](https://spring.io/guides/gs/spring-boot/) 创建一个。如果不想浪费太多时间开发，就创建一个 hello world rest 控制器。应该够了。基本上，我会推荐 Gradle 或 Maven。应该没那么重要。在这个项目中，我和 Gradle 一起去。

使用 Gradle 运行应用程序:

```
./gradlew bootRun
```

要使用 Maven 运行应用程序:

```
./mvnw spring-boot:run
```

要验证您的应用程序是否正常工作，请快速浏览一下。如果您正确地遵循了一个在线指南，那么运行一个基本的`curl`命令(GET request)应该会看到类似的结果:

```
$ **curl localhost:8080**
Hey, I'm a hello world program (try this yourself)!
```

就是这样。应用程序正在运行！在下一节中，我们将确保它也适用于所有生产环境。您的代码可能是跨平台的，但是安装 Docker 应该足以运行程序。这样，代码就可以在任何地方运行。当然是在任何装有 Docker 的电脑或服务器上。

# 创建 Dockerfile 文件

在上一节中，我们成功地构建了一个 Spring 应用程序。最近，我对一个 Java 14 应用程序做了同样的事情。第一条指令与此版本相关。你看，我们不必完全从零开始。我们将为 Java 14 使用一个小的——因此是 alpine——open JDK 映像:

```
FROM openjdk:14-jdk-alpine
```

接下来，我们将确保我们的应用程序有一个用户组和一个用户。从技术上讲，您可以不使用下面两行代码继续，但是这样做并不明智(这只是一个最佳实践)。容器内的用户最终将获得运行应用程序所需的所有权限。

*注意:关于 Docker 有太多需要学习的了。权限是我在与 Jenkins 一起工作时发现的一个重要问题。如果你对我有什么建议，请在评论中告诉我！*

```
RUN addgroup -S spring && adduser -S spring -G spring
USER spring:spring
```

下一行必不可少。它将本地机器的构建文件夹(Gradle 构建步骤的结果)中的`jar`文件复制到 Docker 文件夹中。为了便于使用，让我们将它复制到我们的 spring 用户文件夹中:

```
COPY build/libs/*.jar home/spring/application.jar
```

瞧，我们现在有一个`jar`文件可以使用了。再来两行就完事了。因为没有理由改变应用程序运行的端口(它运行在 Docker 中)，所以我把它留在 8080。下一行只是为我们提供了这些信息。是的，没错。不要射我——我稍后会指定主机端口(在 Docker `run`命令期间)！你可以把它看作文档。

```
EXPOSE 8080
```

最后一行是有魔力的一行。我们将使用众所周知的`java -jar`命令运行应用程序:

```
ENTRYPOINT ["java", "-jar", "/home/spring/application.jar"]
```

仅此而已。如果您正确地构建并运行了这个 Docker 容器，您将看到与步骤 1 相同的结果。

好了，你已经读到这里了，所以给你那些命令应该是公平的。我将为您包括它们:

*   `docker build -t app/hi:v0.1.0`

项目 app ，应用程序名称 hi，特性版本 v0.1.0。我已经为版本化构建制定了一个命名约定，但是您可以随意使用您喜欢的任何版本化系统。如果你想推荐一个，那将非常感谢。

*   `docker run app/hi:v0.1.0 -p 8080:8080`

拥有这个 Docker 映像的每个人都可以运行您的应用程序。从现在开始，它可以在所有安装了 Docker 的机器上运行。是不是很牛逼？让我们把它提供给用户，我们会得到即时反馈！尽早获得反馈是非常有价值的！

# 奖励:MongoDB docker-撰写示例

用命令设置应用程序容器、数据库和大型应用程序的其他部分可能会成为一项单调乏味的工作。我不喜欢使用命令(如果你不记录它们，祝你好运记住它们)。有一个很棒的解决方案叫做`docker-compose`。在这个文件中，您可以描述端口、要使用的 docker 文件、重启策略等参数。

让我们分解一下这个 MongoDB 应用程序的`docker-compose`文件的例子。首先，它启动 MongoDB 数据库。然后，它启动处理存储和检索图像请求的应用程序。pet 项目仍处于早期阶段，因此配置很可能会在未来发生变化。

如果你对这个项目感兴趣，请随时提问。也欢迎建议！这可能是未来文章的主题，请继续关注。

# 结论

嗯，就是这样。感谢您从头到尾的阅读！最后，我将总结一下我们在本文中所做的工作。

我们创建了一个小的 Spring 应用程序。有了这些优秀的指南，创建一个 Spring 应用程序应该很容易。总是从微小的应用程序开始。

之后，我们学习了如何将这个应用程序包装到一个容器中，以便可以与我们的同事有效地共享。如今，Docker 是你工具箱中的必备工具。在目前的就业市场上，对具有 Docker 和 Kubernetes 知识的开发人员的需求很高。

最后，我们看到了一个稍微成熟一点的应用程序的样子。`Docker-compose`在搭建和维护集装箱的时候，会让你远离烦恼。在开发周期的早期就开始使用它。