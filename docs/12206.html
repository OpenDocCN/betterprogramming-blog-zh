<html>
<head>
<title>Why I Like Using UUIDs on Database Tables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我喜欢在数据库表上使用UUIDs</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/why-i-like-using-uuids-on-database-tables-ccab8c350f8a?source=collection_archive---------1-----------------------#2022-05-19">https://betterprogramming.pub/why-i-like-using-uuids-on-database-tables-ccab8c350f8a?source=collection_archive---------1-----------------------#2022-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="62cc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">无论是为了安全还是营销，你的团队都应该使用它们。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c81691066596a266b269a3164d587c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L24uwC5SrzwN5mUOMJslJQ.png"/></div></div></figure><p id="cda0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在处理关系数据库时，我们通常给表分配自动递增的整数ID:第一行的ID为1，第二行的ID为2，依此类推。让我用一个假的CRM应用程序来说明这个问题:</p><p id="ff61" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">今天是这个月的最后一天，我们想找到客户的电子邮件地址，给他发一份账单。我们打开CRM，浏览用户界面，点击他的名字。然后我们会被重定向到他在系统上的特定页面:</p><p id="a349" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ln lo lp lq b">https://example.com/client/<a class="ae lr" href="#" rel="noopener ugc nofollow"><strong class="kt ir">1</strong></a></code>。到目前为止，一切都按预期运行！</p><p id="c321" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看URL，很容易就能知道我们的客户ID是什么:<strong class="kt ir"> 1 </strong>。我是一个好奇的人，所以我将把数字1改为2，看看会发生什么……正确的行为应该是不显示该客户端(因为<code class="fe ln lo lp lq b">403</code>未被授权，或者，理想情况下，因为没有找到HTTP <code class="fe ln lo lp lq b">404</code>)。</p><p id="61ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不幸的是，我们假定的CRM开发人员忘记了验证这个特定的路由，所以我们能够看到客户端2的数据，这是一个巨大的安全问题！</p><blockquote class="ls lt lu"><p id="cc00" class="kr ks lv kt b ku kv jr kw kx ky ju kz lw lb lc ld lx lf lg lh ly lj lk ll lm ij bi translated">这样的漏洞经常发生，因为代码库非常大，很容易忘记一行简单的代码。例如，在Rails中，正确的代码行是<code class="fe ln lo lp lq b">currentUser.clients.find(id)</code>，而易受攻击的代码行是<code class="fe ln lo lp lq b">Client.find(id).</code>，发现区别了吗？相当小…</p></blockquote><p id="502a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，由于我的客户ID是1，我想这个CRM相当小，因为我是第一个在其中创建客户的人，所以我可能想迁移到一个更流行和更可靠的系统...这样，营销团队就会抱怨开发商失去了他们辛苦赢得的客户！</p><h1 id="ce25" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">使用UUIDs如何解决这个问题？</h1><blockquote class="ls lt lu"><p id="0938" class="kr ks lv kt b ku kv jr kw kx ky ju kz lw lb lc ld lx lf lg lh ly lj lk ll lm ij bi translated">快速提示:如果你从未见过UUID，它是一个类似<code class="fe ln lo lp lq b">34e80691-9878-4e78-a1f2-eea8981984ef</code>的随机字符串，所以它的前面和后面都没有数字；相比之下，对于整数，我们都知道数字2的前面是1，后面是3。</p></blockquote><p id="d94c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们使用UUIDs时，我们将URL的ID从连续的整数变为随机的字符串。所以用户1的页面看起来像是<code class="fe ln lo lp lq b"><a class="ae lr" href="https://example.com/client/34e80691-9878-4e78-a1f2-eea8981984ef" rel="noopener ugc nofollow" target="_blank">https://example.com/client/34e80691-9878-4e78-a1f2-eea8981984ef</a></code>而不是<code class="fe ln lo lp lq b"><a class="ae lr" href="https://example.com/client/34e80691-9878-4e78-a1f2-eea8981984ef" rel="noopener ugc nofollow" target="_blank">https://example.com/client/</a>1</code>。</p><p id="33ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在那个巨大的东西后面(或前面)没有数字！这是一个随机的无序的字符串。因此，即使CRM开发人员忘记验证路由，也很难有人利用这个漏洞:没有人知道用什么来替换UUID！还有，没人知道我们平台有多少用户，所以……营销团队快乐！</p><h1 id="ad80" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">这是否意味着我们应该将主键从整数id改为UUIDs？</h1><p id="4b41" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">关于这一点我听到过一些争论，但是，在我看来，<strong class="kt ir">没有！</strong></p><p id="01ac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们将主键更改为整数以外的值，我们可能会损失查询性能，因为整数比SQL查询中的字符串更快；相反，我创建了一个名为UUID的单独列，并在所有用户公开的路线上使用它。</p><p id="214a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要了解如何在Rails上<a class="ae lr" href="https://fuchs.dev.br/adding-uuids-to-rails-apps-using-dry-code-and-attr-readonly-d62734d00800" rel="noopener ugc nofollow" target="_blank">实现UUIDs】，请阅读我的文章。</a></p><p id="d51a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我还听说过使用整数主键的其他一些好处，比如加速RDBMSs的索引过程；然而，这超出了本文的范围，也超出了我对RDBMSs内部工作原理的了解。</p><h1 id="434c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">快速常见问题</h1><p id="1d6f" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated"><strong class="kt ir">问:如果我在URL上使用UUIDs，而这个URL在某种程度上被转换为SQL查询，那么在数据库上维护这个ID对索引有什么帮助呢？”</strong></p><p id="d976" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">答:</strong>您使用UUID执行第一个SQL查询，并获得客户端的ID！然后，您使用该ID进行所有其他查询…</p><p id="8378" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，一个用户发出一个请求<code class="fe ln lo lp lq b">GET <a class="ae lr" href="https://example.com/client/34e80691-9878-4e78-a1f2-eea8981984ef" rel="noopener ugc nofollow" target="_blank">https://example.com/client/34e80691-9878-4e78-a1f2-eea8981984ef</a>.</code>，我们的系统接收到这个请求，对UUID为<code class="fe ln lo lp lq b">34e80691-9878-4e78-a1f2-eea8981984ef</code>的客户端进行SQL查询，我们得到他的ID是1。现在我们对所有其他关系查询使用主键！例如，我们可以使用它来查找该客户的所有订单。</p><h1 id="4f2d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">总结</h1><p id="8c2a" class="pw-post-body-paragraph kr ks iq kt b ku mr jr kw kx ms ju kz la mt lc ld le mu lg lh li mv lk ll lm ij bi translated">同时使用id和UUIDs是很好的做法。您应该将UUIDs用于系统之外的所有东西(即HTTP请求)，但继续将id用于内部处理(SQL查询)。</p><p id="a772" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望这是一个有见地的帖子，如果它太令人困惑，请让我知道。</p><p id="a069" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您读到这里！</p><pre class="kg kh ki kj gt mw lq mx my aw mz bi"><span id="b427" class="na ma iq lq b gy nb nc l nd ne"><strong class="lq ir">Want to Connect?</strong></span><span id="2485" class="na ma iq lq b gy nf nc l nd ne">If you ever have a great startup idea but not a software team, please, don’t hesitate to contact my company <a class="ae lr" href="https://almosthackers.net" rel="noopener ugc nofollow" target="_blank">AlmostHackers</a>! We’ll develop your software without charging money, getting equity instead.</span></pre></div></div>    
</body>
</html>