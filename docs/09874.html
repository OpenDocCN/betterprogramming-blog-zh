<html>
<head>
<title>Create a Blockchain Game With Solidity, Web3, and Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Solidity，Web3，和Vue.js创建一个区块链游戏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-blockchain-game-with-solidity-web3-and-vue-js-c75eed4b49a6?source=collection_archive---------2-----------------------#2021-10-25">https://betterprogramming.pub/create-a-blockchain-game-with-solidity-web3-and-vue-js-c75eed4b49a6?source=collection_archive---------2-----------------------#2021-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="40b5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用以太坊区块链建造一个分散的游戏</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fe271023e174fae4761b762293055cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oFLiQHfFs2hzHtqf"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@zoltantasi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Zoltan·塔斯</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="3596" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将看到使用以太坊公共区块链创建分散式游戏的一步一步的方法:</p><ul class=""><li id="e349" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">建筑工人</li><li id="b15f" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">固态</li><li id="9efd" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">vue . j</li></ul><p id="a690" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下一部分中，我们将更多地关注前端，但是首先，我将简单解释一下可靠性以及如何将它部署到Rinkeby <code class="fe mg mh mi mj b">testnet</code>。</p><p id="f9dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我的第一篇文章，我觉得缺乏关于Web3和Vue.js的信息，因为它也需要一些关注。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="4248" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们开始之前，我想赞扬buildspace制作这个项目。我加的是Vue.js部分。如果您是这个领域的新手，请随时查看它们！他们有最好的学习工具和社区！</p><p id="2461" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在我们开始之前，让我们谈谈如果您刚刚开始进入这个领域，您真正需要的是什么:</p><ul class=""><li id="7f14" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">你需要安装MetaMask并在Chrome中启用扩展</li><li id="1983" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">元掩码的基本知识</li><li id="d243" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">关于坚固性的基本知识</li><li id="0679" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">关于JavaScript和Vue.js的知识。</li></ul></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="7160" class="mr ms iq bd mt mu mv mw mx my mz na nb jw nc jx nd jz ne ka nf kc ng kd nh ni bi translated">我们今天要建造什么</h1><p id="c3cf" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">我们将构建一个基于区块链的游戏(受<code class="fe mg mh mi mj b">buildspace</code>启发)，在这里你可以铸造你的角色并与老板战斗！</p><p id="40d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里查看最终结果:</p><ul class=""><li id="15c6" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><a class="ae kv" href="https://epic-game-buildspace-a2c4ixjyk-zlayine.vercel.app/" rel="noopener ugc nofollow" target="_blank"> App </a></li><li id="61fc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://github.com/zlayine/epic-game-buildspace" rel="noopener ugc nofollow" target="_blank"> GitHub库</a></li></ul><h1 id="a29e" class="mr ms iq bd mt mu no mw mx my np na nb jw nq jx nd jz nr ka nf kc ns kd nh ni bi translated">固态</h1><p id="4948" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">对于Solidity的初学者，我建议你<a class="ae kv" href="https://www.google.com/search?q=buildspace+solidity&amp;oq=buildspace+solidity&amp;aqs=chrome..69i57.1665j0j7&amp;sourceid=chrome&amp;ie=UTF-8" rel="noopener ugc nofollow" target="_blank">遵循buildspace </a>。</p><p id="a87c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的智能合同将允许我们创造角色，铸造我们选择的角色，然后用它打一个老板！简单吧？</p><p id="3011" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们的<code class="fe mg mh mi mj b">MyEpicGame.sol</code>智能合同:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="cce8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于<code class="fe mg mh mi mj b">Base64.sol</code>文件，可以在这里找到<a class="ae kv" href="https://github.com/zlayine/epic-game-buildspace/blob/master/contracts/libraries/Base64.sol" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="f4a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这基本上为我们提供了一些帮助函数，让我们将任何数据编码成Base64字符串——这是将一些数据编码成字符串的标准方式。</p><h1 id="99f2" class="mr ms iq bd mt mu no mw mx my np na nb jw nq jx nd jz nr ka nf kc ns kd nh ni bi translated">试验</h1><p id="6a95" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">部署前。我们应该检验合同以确保我们能使用它。</p><p id="e2d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在根目录下新建一个名为<code class="fe mg mh mi mj b"><a class="ae kv" href="https://buildspace.so/" rel="noopener ugc nofollow" target="_blank">test</a></code> <strong class="ky ir"> </strong>的文件夹。该文件夹可以包含客户端和以太坊测试。</p><p id="f040" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe mg mh mi mj b">test</code>文件夹中添加一个新的JS文件，名为<code class="fe mg mh mi mj b">test.js</code>。该文件将在一个文件中包含合同测试。你可以创建你自己的，我创建一个简单的测试文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="b40e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要运行测试:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="874f" class="nz ms iq mj b gy oa ob l oc od">npx hardhat test</span></pre><h1 id="a18c" class="mr ms iq bd mt mu no mw mx my np na nb jw nq jx nd jz nr ka nf kc ns kd nh ni bi translated">部署(到Rinkeby测试网络)</h1><p id="b502" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">让我们在hardhat项目的scripts文件夹中创建一个新文件<code class="fe mg mh mi mj b">deploy.js</code>。里面有这段代码。</p><p id="1470" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将从我们的构造函数中创建3个默认角色和一个boss。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="1b3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要部署合同，请运行以下命令:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="63ae" class="nz ms iq mj b gy oa ob l oc od">npx hardhat run scripts/deploy.js --network rinkeby</span></pre><p id="fcfa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们完成了坚实的部分。现在我们要做一个前端接口与之交互。</p><h1 id="7ecd" class="mr ms iq bd mt mu no mw mx my np na nb jw nq jx nd jz nr ka nf kc ns kd nh ni bi translated">前端Vue.js</h1><p id="3fb6" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">我不会在这里分享CSS，请随时查看我的GitHub repo。</p><p id="37c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从创建项目开始:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="ff53" class="nz ms iq mj b gy oa ob l oc od">vue create frontend<br/>cd frontend</span></pre><p id="4331" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用ethers进行Web3交互，使用Vuex进行状态管理。以下是安装它们的方法:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="13a6" class="nz ms iq mj b gy oa ob l oc od">npm install --save vuex ethers</span></pre><p id="4203" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好了，现在项目准备开始了！让我们来谈谈制作前端应用程序的步骤:</p><ul class=""><li id="35ed" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">连接用户的钱包</li><li id="1de5" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">选择一个角色</li><li id="ea23" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">攻击老板</li></ul><h1 id="2f13" class="mr ms iq bd mt mu no mw mx my np na nb jw nq jx nd jz nr ka nf kc ns kd nh ni bi translated">连接钱包</h1><p id="d1bb" class="pw-post-body-paragraph kw kx iq ky b kz nj jr lb lc nk ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">为了让用户与我们的应用程序进行交互，他们必须安装Metamask并选择Rinkeby网络。但是我们会在最后一部分处理它。</p><p id="2ffb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的<code class="fe mg mh mi mj b">App.vue</code>模板应该是这样的，有一个连接按钮，它将在Metamask中打开一个提示，允许我们的应用程序请求用户接受的事务:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="1eff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">connect按钮有一个click事件，该事件将向我们的商店发送一个动作(Vuex)，我们稍后将讨论它—现在，让我们看一下我们的商店结构:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="f7cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">状态对象具有以下属性:</p><ul class=""><li id="2396" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><code class="fe mg mh mi mj b">account</code>:我们关联账户的保存位置</li><li id="4f4c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mg mh mi mj b">error</code>:显示错误</li><li id="3cf2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mg mh mi mj b">mining</code>:用于检查事务是否被挖掘的布尔值</li><li id="9e03" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">我们选择的角色将被保存在哪里</li><li id="0f68" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mg mh mi mj b">characters</code>:默认字符的保存位置</li><li id="2310" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mg mh mi mj b">boss</code>:会和我们性格打架的老板</li><li id="afc9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mg mh mi mj b">attackState</code>:攻击boss时，在挖掘交易的同时状态发生变化</li><li id="7686" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe mg mh mi mj b">contract_address</code>:我们将合同部署到Rinkeby网络时返回的地址。</li></ul><p id="1d6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并且不要忘记在部署契约之后从构建中导入<code class="fe mg mh mi mj b">MyEpicGame.json</code>。我们将需要它为我们的web3电话与合同在区块链。</p><p id="73d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们为状态创建了getters和setters(突变)。现在让我们开始行动吧。</p><p id="a349" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们有之前讨论过的<code class="fe mg mh mi mj b">connect</code>行动，现在我将向大家详细介绍:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="a7a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们在这里检查是否安装了元掩码:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="eaf5" class="nz ms iq mj b gy oa ob l oc od">const { ethereum } = window;<br/>if (!ethereum) {<br/>  commit("setError", "Metamask not installed!");<br/>  return;<br/>}</span></pre><p id="1486" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果一切正常，我们检查用户是否已经授予我们的应用程序访问Metamask的权限，然后我们只需连接帐户，如果没有，它返回0，即找到的帐户数。这意味着我们必须向用户请求访问权限:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="d225" class="nz ms iq mj b gy oa ob l oc od">if (!(await dispatch("checkIfConnected")) &amp;&amp; connect) {<br/>	await dispatch("requestAccess");<br/>}</span></pre><p id="a90f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:<code class="fe mg mh mi mj b">connect</code>变量帮助我们知道它是一个被点击的按钮，还是实际上是调用它的挂载函数</p><p id="0791" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们检查了选定的网络后，如果它不是Rinkeby网络，我们会发送一个请求来更改它:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="62a7" class="nz ms iq mj b gy oa ob l oc od">await dispatch("checkNetwork");</span></pre><p id="c00a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">找到帐户后，我们将帐户提交给突变，以将其保存在我们的状态中:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="413c" class="nz ms iq mj b gy oa ob l oc od">// in checkIfConnected action<br/>commit("setAccount", accounts[0]);</span></pre><p id="1d1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是我们的连接行动。</p><p id="e130" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将创建一个操作来获取默认字符，供用户从智能合约中选择:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="2067" class="nz ms iq mj b gy oa ob l oc od">async getCharacters({ state, commit, dispatch }) {<br/>  try {<br/>    const connectedContract = await dispatch("getContract");<br/>    const charactersTxn = await connectedContract.getAllDefaultCharacters();<br/>    const characters = charactersTxn.map((characterData) =&gt;<br/>      transformCharacterData(characterData)<br/>    );<br/>    commit("setCharacters", characters);<br/>  } catch (error) {<br/>    console.log(error);<br/>  }<br/>},</span></pre><p id="6735" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了从我们的契约中调用一个函数，我们需要通过创建一个动作来获取契约，并返回它。我们提供一个提供者、契约abi和签名者:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="ffc5" class="nz ms iq mj b gy oa ob l oc od">async getContract({ state }) {<br/>  try {<br/>    const { ethereum } = window;<br/>    const provider = new ethers.providers.Web3Provider(ethereum);<br/>    const signer = provider.getSigner();<br/>    const connectedContract = new ethers.Contract(<br/>      state.contract_address,<br/>      MyEpicGame.abi,<br/>      signer<br/>    );<br/>    return connectedContract;<br/>  } catch (error) {<br/>    console.log(error);<br/>    console.log("connected contract not found");<br/>    return null;<br/>  }<br/>},</span></pre><p id="d73c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以调用智能契约中返回默认字符的函数，并在函数的帮助下映射每个字符，该函数将字符数据转换为JavaScript可用的对象:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="a60d" class="nz ms iq mj b gy oa ob l oc od">const charactersTxn = await connectedContract.getAllDefaultCharacters();<br/>const characters = charactersTxn.map((characterData) =&gt;<br/>  transformCharacterData(characterData)<br/>);</span></pre><p id="9773" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mg mh mi mj b">transformCharacterData</code>功能添加在<a class="ae kv" href="http://Vuex.Store" rel="noopener ugc nofollow" target="_blank"> Vuex之上。存储</a>初始化。它将<code class="fe mg mh mi mj b">hp</code>、<code class="fe mg mh mi mj b">attackDamage</code>从<code class="fe mg mh mi mj b">bigNumber</code>转换成可读的数字:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="8198" class="nz ms iq mj b gy oa ob l oc od">const transformCharacterData = (characterData) =&gt; {<br/>  return {<br/>    name: characterData.name,<br/>    imageURI: characterData.imageURI,<br/>    hp: characterData.hp.toNumber(),<br/>    maxHp: characterData.maxHp.toNumber(),<br/>    attackDamage: characterData.attackDamage.toNumber(),<br/>  };<br/>};</span></pre><p id="1d70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们回到我们的<code class="fe mg mh mi mj b">App.vue</code>来设置我们的视图并创建一个名为<code class="fe mg mh mi mj b">SelectCharacter</code>的组件。</p><p id="a394" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">修改我们的<code class="fe mg mh mi mj b">App.vue</code>，这样当用户连接他们的钱包时，我们在我们的商店中保存了一个帐户，然后他可以从我们之前获取的默认值中选择角色。</p><p id="5948" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向我们的connect div holder添加一个<code class="fe mg mh mi mj b">v-if</code>，并在视图中添加我们的character select组件:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="9d5a" class="nz ms iq mj b gy oa ob l oc od">&lt;div class="connect-wallet-container" v-if="!account"&gt;<br/>  &lt;img<br/>    src="&lt;https://64.media.tumblr.com/tumblr_mbia5vdmRd1r1mkubo1_500.gifv&gt;"<br/>    alt="Monty Python Gif"<br/>  /&gt;<br/>  &lt;button class="cta-button connect-wallet-button" @click="connect"&gt;<br/>    Connect Wallet To Get Started<br/>  &lt;/button&gt;<br/>&lt;/div&gt;<br/>&lt;select-character v-else-if="account" /&gt;</span></pre><p id="cd7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于帐户，它实际上是一个从我们的存储中返回的计算变量:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="6f88" class="nz ms iq mj b gy oa ob l oc od">computed: {<br/>  account() {<br/>    return this.$store.getters.account;<br/>  },<br/>}</span></pre><p id="28fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">来到我们的<code class="fe mg mh mi mj b">SelectCharacter</code>组件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="01b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦组件被安装，我们必须获取<code class="fe mg mh mi mj b">defaultCharacters</code>并在视图中显示它们。</p><p id="1e37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于每件商品，我们都有一个点击事件，该事件将根据选择的<code class="fe mg mh mi mj b">characterId</code>或索引向我们名为<code class="fe mg mh mi mj b">mintCharacterNFT</code>的商店发送一个新的操作。让我们将此操作添加到我们的商店:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="dc49" class="nz ms iq mj b gy oa ob l oc od">async mintCharacterNFT({ commit, dispatch }, characterId) {<br/>  try {<br/>    const connectedContract = await dispatch("getContract");<br/>    const mintTxn = await connectedContract.mintCharacterNFT(characterId);<br/>    await mintTxn.wait();<br/>  } catch (error) {<br/>    console.log(error);<br/>  }<br/>},</span></pre><p id="4b80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就像之前我们调用负责铸造的智能合约函数一样。</p><p id="2b87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是这里有一个问题，我们没有在我们的州设置我们的新角色？别担心，如果你记得我们在智能契约中的功能，一旦角色被铸造出来，我们就有一个事件。</p><p id="1239" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们现在要做的就是听那个事件，从中设定角色。让我们创建一个操作来设置事件侦听器:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="6a23" class="nz ms iq mj b gy oa ob l oc od">async setupEventListeners({ state, commit, dispatch }) {<br/>  try {<br/>    const connectedContract = await dispatch("getContract");<br/>    if (!connectedContract) return;<br/>    connectedContract.on(<br/>      "CharacterNFTMinted",<br/>      async (from, tokenId, characterIndex) =&gt; {<br/>        console.log(<br/>          `CharacterNFTMinted - sender: ${from} tokenId: ${tokenId.toNumber()} characterIndex: ${characterIndex.toNumber()}`<br/>        );<br/>        const characterNFT = await connectedContract.checkIfUserHasNFT();<br/>        console.log(characterNFT);<br/>        commit("setCharacterNFT", transformCharacterData(characterNFT));<br/>        alert(<br/>          `Your NFT is all done -- see it here: &lt;https://testnets.opensea.io/assets/$&gt;{<br/>            state.contract_address<br/>          }/${tokenId.toNumber()}`<br/>        );<br/>      }<br/>    );<br/><br/>  } catch (error) {<br/>    console.log(error);<br/>  }<br/>},</span></pre><p id="7d55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要监听web3中的事件，我们只需使用<code class="fe mg mh mi mj b">contract.on("event_name", callback)</code>。</p><p id="dd5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在事件内部，我们检查NFT用这个函数<code class="fe mg mh mi mj b">checkIfUserHasNFT</code>选择的用户，并把它提交给我们的状态。如果用户希望看到NFT链接，该警告只是附加信息。那么你认为这个动作应该在哪里调用呢？</p><p id="deb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将把它添加到<code class="fe mg mh mi mj b">checkNetwork</code>分派下面的连接操作中:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="ffbb" class="nz ms iq mj b gy oa ob l oc od">await dispatch("setupEventListeners");<br/>await dispatch("fetchNFTMetadata");</span></pre><p id="4b59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以添加另一个操作来检查用户在访问我们的应用程序时是否已经拥有NFT:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="4878" class="nz ms iq mj b gy oa ob l oc od">async fetchNFTMetadata({ state, commit, dispatch }) {<br/>  try {<br/>    const connectedContract = await dispatch("getContract");<br/>    const txn = await connectedContract.checkIfUserHasNFT();<br/>    if (txn.name) {<br/>      commit("setCharacterNFT", transformCharacterData(txn));<br/>    }<br/>  } catch (error) {<br/>    console.log(error);<br/>  }<br/>},</span></pre><p id="baaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个动作和事件几乎一样，但是只在它被调用后检查它。</p><p id="65bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经完成了我们的角色选择，让我们回到我们的<code class="fe mg mh mi mj b">App.vue</code>,建立我们的竞技场去和老板战斗。我们必须修改我们在<code class="fe mg mh mi mj b">App.vue</code>中调用的选择角色孩子，如果用户已经选择了一个NFT，我们必须直接进入竞技场:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="89b4" class="nz ms iq mj b gy oa ob l oc od">&lt;select-character v-else-if="account &amp;&amp; !characterNFT" /&gt;<br/>&lt;arena v-else-if="account &amp;&amp; characterNFT" /&gt;</span></pre><p id="f695" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mg mh mi mj b">characterNFT</code>变量是计算变量，如账户:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="028b" class="nz ms iq mj b gy oa ob l oc od">characterNFT() {<br/>  return this.$store.getters.characterNFT;<br/>},</span></pre><p id="b36d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建我们的<code class="fe mg mh mi mj b">Arena</code>组件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="de7a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦安装了这个组件，我们调用一个动作来获取boss，并在点击攻击按钮时调用另一个动作，这就是<code class="fe mg mh mi mj b">attackState</code>在(攻击/命中)之间变化的地方:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="2feb" class="nz ms iq mj b gy oa ob l oc od">async fetchBoss({ state, commit, dispatch }) {<br/>  try {<br/>    const connectedContract = await dispatch("getContract");<br/>    const bossTxn = await connectedContract.getBigBoss();<br/>    commit("setBoss", transformCharacterData(bossTxn));<br/>  } catch (error) {<br/>    console.log(error);<br/>  }<br/>},<br/>async attackBoss({ state, commit, dispatch }) {<br/>  try {<br/>    const connectedContract = await dispatch("getContract");<br/>    commit("setAttackState", "attacking");<br/>    console.log("Attacking boss...");<br/>    const attackTxn = await connectedContract.attackBoss();<br/>    await attackTxn.wait();<br/>    console.log("attackTxn:", attackTxn);<br/>    commit("setAttackState", "hit");<br/>  } catch (error) {<br/>    console.error("Error attacking boss:", error);<br/>    setAttackState("");<br/>  }<br/>},</span></pre><p id="b9a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们不要忘记<code class="fe mg mh mi mj b">setupEventListeners</code>动作中的<code class="fe mg mh mi mj b">attackComplete</code>事件，这将更新boss和玩家<code class="fe mg mh mi mj b">hp</code>:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="84e4" class="nz ms iq mj b gy oa ob l oc od">connectedContract.on(<br/>  "AttackComplete",<br/>  async (newBossHp, newPlayerHp) =&gt; {<br/>    console.log(<br/>      `AttackComplete: Boss Hp: ${newBossHp} Player Hp: ${newPlayerHp}`<br/>    );<br/>    let boss = state.boss;<br/>    boss.hp = newBossHp;<br/>    commit("setBoss", boss);</span><span id="55dc" class="nz ms iq mj b gy oe ob l oc od">    let character = state.characterNFT;<br/>    character.hp = newPlayerHp;<br/>    commit("setCharacterNFT", character);<br/>  }<br/>);</span></pre><p id="8ba6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以添加这个负载指示器组件以获得更好的UX:</p><pre class="kg kh ki kj gt nv mj nw nx aw ny bi"><span id="0d8d" class="nz ms iq mj b gy oa ob l oc od">&lt;template&gt;<br/>  &lt;div class="lds-ring"&gt;<br/>    &lt;div&gt;&lt;/div&gt;<br/>    &lt;div&gt;&lt;/div&gt;<br/>    &lt;div&gt;&lt;/div&gt;<br/>    &lt;div&gt;&lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="d6ba" class="nz ms iq mj b gy oe ob l oc od">&lt;script&gt;<br/>export default {};<br/>&lt;/script&gt;</span></pre><p id="96a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，你已经使用Vue.js完成了你的第一个web3游戏。你可以像我一样在<code class="fe mg mh mi mj b">vercel</code>上运行它——免费。</p><p id="2fa9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里是我的应用程序和GitHub库的完整源代码。</p><p id="2d26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再次大声喊出来<a class="ae kv" href="https://buildspace.so/" rel="noopener ugc nofollow" target="_blank"> buildspace </a>帮助做这个项目！</p><p id="2606" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我还因为完成了这个项目而获得了NFT奖:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/1fb26da83325c1e664fc301585de306b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p8zkiIov-1PiZwlDZA4jDw.png"/></div></div></figure><p id="bae1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！在Twitter 上与<a class="ae kv" href="https://twitter.com/zouln96" rel="noopener ugc nofollow" target="_blank">我联系。</a></p></div></div>    
</body>
</html>