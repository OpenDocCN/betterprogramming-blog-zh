<html>
<head>
<title>Five Steps to Reduce webpack 4 Bundle Size</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">缩减webpack 4捆绑包大小的五个步骤</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/five-steps-to-reduce-webpack-bundle-size-8aebcd8e1562?source=collection_archive---------2-----------------------#2019-11-06">https://betterprogramming.pub/five-steps-to-reduce-webpack-bundle-size-8aebcd8e1562?source=collection_archive---------2-----------------------#2019-11-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cafd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何优化应用程序的大小</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e7cfd8ea4360354024710b07b5872241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xQfm8vzVztFwi4ivojBuXQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@reneporter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> René Porter </a>在<a class="ae ky" href="https://unsplash.com/s/photos/size?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="1e24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经做了几个关于材料反应的项目-用户界面和蚂蚁设计。Material-UI 是一套很棒的React组件，可以用来开发web应用程序。<a class="ae ky" href="https://ant.design" rel="noopener ugc nofollow" target="_blank"> Ant Design </a>是一套令人惊叹的React组件。如果你和他们一起工作，你会知道他们丰富多样的组件。</p><p id="b961" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，我对包的大小有困难。我在互联网上搜索了很多，希望找到一种优化webpack捆绑包大小的方法。下面是我的方法，用五个步骤来优化和减少包的大小。</p><p id="6cb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不知道如何设置webpack 4，这里是我以前的文章，“<a class="ae ky" href="https://medium.com/better-programming/how-to-set-up-webpack-4-49012dedbfd6" rel="noopener">如何设置webpack 4 </a>”</p><p id="96ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始改进我们的webpack配置。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c8a7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.分析我们的产品包</h1><p id="f177" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们必须知道代码中哪个组件的大小更大。</p><p id="6ef2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我通过<a class="ae ky" href="https://www.npmjs.com/package/webpack-bundle-analyzer" rel="noopener ugc nofollow" target="_blank">web pack-bundle-analyzer</a>分析我们的包依赖关系。这个库分析webpack统计数据，并通过一个交互式的可缩放树状图给出了一个很好的可视化效果。</p><p id="4b67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将创建两个视图:一个用于React代码，另一个用于node_modules。为此，我们需要安装它:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7c0c" class="ne md it na b gy nf ng l nh ni">npm install --save-dev webpack-bundle-analyzer</span></pre><p id="f7c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要将以下代码添加到<code class="fe nj nk nl na b">webpack.config.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="bfbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们运行这个应用程序时，这个可视化效果会显示出来:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/9a99d1a680e7a267a74956d4b210d9e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYluMmL10NVaLMfgXSgnFg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">web pack-捆绑包-分析器报告</p></figure><p id="e48b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这有助于理解哪个组件太大。现在我们知道<code class="fe nj nk nl na b">Ant-Design</code>、<code class="fe nj nk nl na b">Ant-Design Icons</code>和<code class="fe nj nk nl na b">moment.js</code>有问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b43c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.巴别塔构型</h1><h2 id="c43b" class="ne md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated"><strong class="ak">巴别-插件-转换-导入</strong></h2><p id="c1cc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">大多数开发人员是这样导入<code class="fe nj nk nl na b">lodash</code>的:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="42f3" class="ne md it na b gy nf ng l nh ni">import { get } from 'lodash';</span></pre><p id="c40b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们导入了所有的Lodash模块，这似乎会导致包的大小非常大。我们应该这样使用它:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="892f" class="ne md it na b gy nf ng l nh ni">import _get from 'lodash/get';</span></pre><p id="d0db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们从Lodash导入特定的方法，而不是将整个包导入到我们的代码中。</p><p id="2ce1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注:</strong>我们可以用<a class="ae ky" href="https://www.npmjs.com/package/babel-plugin-transform-imports" rel="noopener ugc nofollow" target="_blank">巴别-插件-转换-导入</a>。这个插件会用这个特殊的方法将你的第一行转换到第二行，并允许你拉你需要的模块。</p><p id="517e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该安装<code class="fe nj nk nl na b">babel-plugin-transform-imports</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a337" class="ne md it na b gy nf ng l nh ni">npm install --save-dev babel-plugin-transform-imports</span></pre><p id="153b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们应该配置我们的<code class="fe nj nk nl na b">wepback.config.js</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d72c" class="ne md it na b gy nf ng l nh ni">["transform-imports"], {<br/>  "lodash": {<br/>    "transform": "lodash/${member}",<br/>    "preventFullImport": true<br/>  }<br/>}</span></pre><h2 id="f5b7" class="ne md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated"><strong class="ak">巴别塔-插件-导入</strong></h2><p id="fcc8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当我们从<code class="fe nj nk nl na b">Ant-Design</code>进口一个组件时，我们将进口所有未使用的组件。</p><p id="0d75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让<code class="fe nj nk nl na b">Ant-Design</code>只加载需要的模块，你应该使用<a class="ae ky" href="https://github.com/ant-design/babel-plugin-import" rel="noopener ugc nofollow" target="_blank"> babel-plugin-import </a>。该插件兼容<code class="fe nj nk nl na b">antd</code>、<code class="fe nj nk nl na b">antd-mobile</code>、<code class="fe nj nk nl na b">lodash</code>、<code class="fe nj nk nl na b">material-UI</code>等。</p><p id="7293" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们安装并测试它:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="4388" class="ne md it na b gy nf ng l nh ni">npm install babel-plugin-import --save-dev</span></pre><p id="b17f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将以下代码添加到<code class="fe nj nk nl na b">webpack.config.js</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2e7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将从<code class="fe nj nk nl na b">Ant-Design</code>组件导入仅使用来自<code class="fe nj nk nl na b">es</code>目录的CSS的模块。</p><p id="bb49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe nj nk nl na b">lodash</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5cbc" class="ne md it na b gy nf ng l nh ni">{<br/>  "libraryName": "lodash",<br/>  "libraryDirectory": "",<br/>  "camel2DashComponentName": false,  // default: true<br/>}</span></pre><p id="290d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe nj nk nl na b">material-ui</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="dd64" class="ne md it na b gy nf ng l nh ni">{<br/>  "libraryName": "@material-ui/core",<br/>  "libraryDirectory": "components",  // default: lib<br/>  "camel2DashComponentName": false,  // default: true<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5bcb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.减小Moment.js的大小</h1><p id="1712" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Moment.js是一个很好的库，可以用来更新对象。但是如果你研究一下这个包的大小，moment.js是500Kb。</p><p id="4d9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用<code class="fe nj nk nl na b">ContextReplacementPlugin</code>把moment.js的大小从500Kb缩小到125Kb。它指定在webpack配置文件中包含区域设置文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="0cd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不需要在代码中加载语言环境文件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9afa" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.缩小蚂蚁图案图标的尺寸</h1><p id="235c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你看看我们的包，我们装了一堆巨大的<code class="fe nj nk nl na b">Ant-Design SVG icons</code>。让我们通过向<code class="fe nj nk nl na b">webpack.config.js</code>添加以下代码来减小它们的大小:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1385" class="ne md it na b gy nf ng l nh ni">resolve: {<br/>  alias: {<br/>      "@ant-design/icons/lib/dist$": path.resolve(__dirname, "<!-- -->src/constants/icons.js<!-- -->")<br/>  }<br/>}</span></pre><p id="3ce4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们应该在文件夹<code class="fe nj nk nl na b">src/constants</code>中创建<code class="fe nj nk nl na b">icons.js</code>(或者你想要的任何地方)。确保它与别名路径匹配。在这个文件中，你定义了Ant Design应该包含哪些图标。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a9ad" class="ne md it na b gy nf ng l nh ni">export {<br/>  default as BarChartOutline<br/>} from "<a class="ae ky" href="http://twitter.com/ant" rel="noopener ugc nofollow" target="_blank">@ant</a>-design/icons/lib/outline/BarChartOutline";</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2881" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.使用SplitChunksPlugin进行代码拆分</h1><p id="cb06" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">SplitChunksPlugin将我们的包分成几个小部分，只在需要的时候加载包。webpack在内部使用这个插件，我们可以在<code class="fe nj nk nl na b">webpack.config.js</code>的<code class="fe nj nk nl na b">optimization</code>块中启用/配置它。</p><p id="e2f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的例子中，我分成了两部分(<code class="fe nj nk nl na b">node_modules</code>和<code class="fe nj nk nl na b">src</code>)。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d3ac" class="ne md it na b gy nf ng l nh ni">optimization: {<br/>  splitChunks: {<br/>    cacheGroups: {<br/>      commons: {<br/>        test: /[\\/]node_modules[\\/]/,<br/>        name: "vendors",<br/>        chunks: "all"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/70560cabaa39b29883eff24308e73e4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GKYa2esnrnv8u4Ota5Q97g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">优化捆绑包</p></figure><p id="72a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，包的大小从6.26MB减少到了4.56MB</p><p id="d894" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章对你有用。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7919" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">资源</h1><ul class=""><li id="d1c2" class="ob oc it lb b lc mu lf mv li od lm oe lq of lu og oh oi oj bi translated"><a class="ae ky" href="https://medium.com/@poshakajay/heres-how-i-reduced-my-bundle-size-by-90-2e14c8a11c11" rel="noopener">“以下是我如何将我的包大小减少90% </a>”</li><li id="8a3e" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><a class="ae ky" href="https://www.linkedin.com/pulse/reduce-your-react-bundle-size-webpack-half-amit-gaikwad/" rel="noopener ugc nofollow" target="_blank">“用webpack将你的React包大小减半</a>”</li><li id="2637" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><a class="ae ky" href="https://medium.com/hackernoon/optimising-your-application-bundle-size-with-webpack-e85b00bab579" rel="noopener">“使用webpack </a>优化您的应用捆绑包大小”</li><li id="09d8" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><a class="ae ky" href="https://medium.com/@GeoffMiller/how-to-customize-ant-design-with-react-webpack-the-missing-guide-c6430f2db10f" rel="noopener">“如何使用React &amp; Webpack </a>定制Ant设计”</li></ul></div></div>    
</body>
</html>