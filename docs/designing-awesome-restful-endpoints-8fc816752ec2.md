# 如何设计出色的 RESTful 端点

> 原文：<https://betterprogramming.pub/designing-awesome-restful-endpoints-8fc816752ec2>

## 你的网络开发者会因此而喜欢你的

![](img/dc696826fdc78ac749e80cc872169870.png)

[法尔扎德·纳齐菲](https://unsplash.com/@euwars?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

构建 REST APIs 很像构建网页。当你设计一个网站时，你希望用户对你的网站有很好的体验，并且因为他们喜欢使用它而不断回来。

REST APIs 也是如此，只是您的用户是 web 开发人员或其他希望与您的应用程序集成的应用程序开发人员。你仍然希望他们有一个惊人的体验，并发现你的 API 直观易用。

因此，在构建 REST API 时，在端点设计上投入大量的前期时间是非常重要的。设计良好的端点将使 web 开发人员能够很容易地确定他们要为特定任务使用哪个端点以及如何使用它。

那么设计良好的 REST 端点到底是什么样子的呢？首先，他们应该遵循行业最佳实践，以减少不熟悉 API 的开发人员的学习曲线。它们应该在资源命名方法、HTTP 方法和状态代码的使用上保持一致，并在出错时提供有意义的错误消息。

我认为讨论端点设计最简单的方法是使用例子，所以我将浏览一些具体的用例，并考虑如何为它们设计端点。

顺便说一句，在这一点上值得注意的是，在与 REST 架构中的资源进行交互时，您不必使用 HTTP，也不必使用 JSON 来表示这些资源。然而，HTTP 和 JSON 的组合可能是最常见的实现，这也是大多数人在谈论 REST APIs 时想到的，所以这也是我在这里重点关注的。

# 检索整个资源集合

让我们从一个简单的场景开始，我们希望检索特定类型的所有资源。例如，假设我们想要构建一个 API 来管理在线学校的课程，并且我们想要提供一个列出所有课程的端点。

我们可以使用下面的端点来检索整个课程集合。

```
GET /courses
```

我们正在检索资源，所以我们使用 GET 方法。路径标识了我们感兴趣的资源集合。我们想要获取的资源称为`course`，因此集合的名称是复数形式，也是小写形式，即`courses`。

这个端点应该返回一个 HTTP 状态代码“200 OK”和一个 JSON 对象数组，其中每个对象保存一个不同的`course`的细节，如下所示。

```
[
  { 
    "id": 1,
    "code": "PHY_Q_1",
    "name": "Quantum Physics",
    "faculty": "Science",
    "level": 1
  },
  { 
    "id": 2,
    "code": "ENG_3",
    "name": "English",
    "faculty": "Arts",
    "level": 3
  },
  ...
]
```

# 搜索资源

如果我们的客户不想检索整个资源集合，而是想搜索符合搜索标准的资源子集，那该怎么办？我们通过添加查询参数来实现这一点。

例如，我们可以通过采用上一个示例中的端点并添加一个“教员”查询参数来支持按教员搜索课程。

```
GET /courses?faculty=Science
```

这个端点将继续返回一个 HTTP 状态代码`200 OK`和一个数组，该数组只包含那些由“科学”教师提供的课程。

这里有几个反模式需要注意。

*   *当没有资源返回时，返回 HTTP 状态码“404 未找到”。*404 状态代码仅适用于集合本身不存在的情况，例如，您拼错了集合名称，如`coarses`。如果没有符合我们搜索标准的课程，那么仍然会返回一个 HTTP 状态代码`200 OK`,并带有一个空数组。
*   *当只找到一个资源时，返回一个资源而不是一个资源数组。*即使只有一个资源符合搜索条件，我们也应该在使用查询参数过滤集合时返回一个数组。

# 限制搜索结果的大小

对于大型集合，通常希望限制返回的资源数量，因为大型结果集会导致响应时间很短。这里我们可以采用多种设计方法。

我们可以添加一个查询参数来限制结果的数量。如果没有传入，我们可以使用默认值。

```
GET /courses?faculty=Science&numberOfResults=100
```

我们可以更复杂一点，通过添加查询参数来指定页码和大小，从而支持分页。Web 开发人员经常需要以分页的形式呈现搜索结果，这样他们就会喜欢这个特性。下面的示例将返回 10 个结果中的第 2 页(如果我们假设页码从 1 开始，则相当于结果 11–20)。

```
GET /courses?faculty=Science&pageNumber=2&pageSize=10
```

或者我们可以用查询参数实现同样的事情，指定开始和结束结果。

```
GET /courses?faculty=Science&startResult=11&endResult=20
```

# 使用 ID 检索单个资源

如果一个 API 客户端知道一个资源的唯一标识符(可能在搜索之后)，那么他们应该能够使用它来检索那个资源。例如，下面的端点可以用来返回一个`course`的细节，其中`course` ID 等于 1。

```
GET /courses/1
```

这应该会返回一个 HTTP 状态`200 OK`和一个单独的课程(这次不是一个数组)。如果提供了一个没有课程的`course` ID，则返回一个`404 Not Found`是合适的。

请注意，在上面的例子中，我们在`course`资源中包含了一个代码，例如，1 级量子物理学的代码是`PHY_Q_1`。如果代码是独一无二的，那么这就引出了一个问题，我们是否也可以在检索时使用代码来识别`course`。

```
GET /courses/PHY_Q_1
```

我的观点是端点应该只使用一个属性作为标识符，所以在这种情况下应该决定是使用`id`还是`code`属性。如果我们决定`id`将成为资源标识符，那么代码仍然可以如下使用:

```
GET /courses?code=PHY_Q_1
```

然而，如前所述，这将返回一个包含单个资源的*数组*。

# 嵌套资源

在这一点上，有必要花点时间来讨论我们是否要嵌套资源的问题。在上面的例子中，我们一直将课程视为顶级资源。

然而，让我们假设所有的课程都属于同一个院系，并且这种情况会一直存在。换句话说，院系和课程之间有非常强的亲子关系。在这种情况下，我们可以使用下面的端点来返回科学学院提供的所有课程。

```
GET /faculties/science/courses
```

注意，我使用一个代码(在本例中是`science`)来标识教员，而不是一个数字 ID。因此，这个端点的意思是，我们想要获取`faculties`集合，找到由代码`science`标识的院系，然后获取该院系下的`courses`集合。

到目前为止，我们讨论的所有其他内容都将继续适用，因此，如果您想要搜索 3 级科学课程，您只需添加如下查询参数。

```
GET /faculties/science/courses?level=3
```

# 创建资源

到目前为止，我们所做的一切都涉及到资源的检索。但是如果我们想要创建一个资源呢？如果我们想支持添加一个新的课程，那么我们可以使用下面的端点。

```
POST /courses
```

注意，我们在添加资源时使用“POST”HTTP 方法，路径标识了要添加资源的集合。请求体应该是包含资源属性的 JSON 对象。

如果成功地创建了资源，那么应该返回一个 HTTP 状态代码“201 Created ”,尽管有时也使用“200 OK”。如果由于请求体中的无效数据而无法创建资源，那么应该返回“400 错误请求”。

# 更新资源

说到更新资源，我们有几个选项，现在我们来看看其中的一些。一种方法是使用“PUT”HTTP 方法，这种方法应该在替换整个资源时使用。这假设 API 消费者将知道他们想要改变的资源的所有属性(可能在第一次执行 GET 之后)，并且能够覆盖所有属性。

使用下面的端点可以支持这一点，其中请求体应该是包含资源所有属性的 JSON 对象。请注意，路径使用唯一标识符来标识单个资源。

```
PUT /courses/1
```

HTTP 状态代码与创建资源的状态代码相同，即“200 OK”表示成功更新，而“400 Bad Request”表示请求体包含无效数据。

另一种方法是提供针对特定属性更新的端点，如下所示。

```
PUT /courses/1/description
```

在这种情况下，我们仍然是在做一个完全的替换，而是一个特定属性的完全替换。

还有一种方法是使用“补丁”HTTP 方法，该方法旨在允许部分更新资源。这个操作使用起来有点棘手，也是我个人避免使用的，但是为了完整起见，我想在这里提一下。

# 删除资源

毫不奇怪，当我们想要删除资源时，我们使用“DELETE”HTTP 方法。例如，我们将使用下面的端点来删除一个课程。

```
DELETE /courses/1
```

同样，我们使用资源的惟一标识符来标识要删除的资源。如果删除成功，该操作应该返回“204 No Content ”,但是有时会返回“200 OK”。如果资源不存在，应该返回“404 Not Found”。

# 对资源执行其他操作

有时候，我们希望执行简单的创建、更新和删除资源之外的操作。例如，假设我们想要取消一门课程，这将具有更新课程状态、注册任何学生以及通知学生取消的效果。

虽然课程资源将被更新，但是这个操作显然不仅仅是简单的更新。对于简单 CRUD 操作之外的任何场景，我们应该使用 POST 方法。那么我们的终点会是什么样子呢？

一种选择是将动作包含在路线中，如下所示。然而，有些人可能不喜欢这种方法，因为路由不再用于简单地识别资源或集合。

```
POST /courses/1/cancel
```

另一种选择是使用查询参数来指示操作，如下面的两个示例所示。

```
POST /courses/1?action=cancel
POST /courses/1?cancel=true
```

第三种选择是在请求体中包含操作和任何其他相关信息。

# 总结

所以有一些关于 RESTful 端点设计的想法。我们并没有考虑到所有的情况，但是希望你已经掌握了一些有用的技巧，可以应用到你的场景中。

祝您愉快地设计令人惊叹的 RESTful 端点。你的网络开发者真的会因此而爱上你！