<html>
<head>
<title>How to Use Git Hooks in JavaScript Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript项目中使用Git挂钩</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/git-hooks-in-javascript-projects-f23a6a096830?source=collection_archive---------5-----------------------#2022-10-27">https://betterprogramming.pub/git-hooks-in-javascript-projects-f23a6a096830?source=collection_archive---------5-----------------------#2022-10-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0774" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我后悔没有早点知道的钩子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0653da4fda8c581c3952785d3eea90ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X3Wzp0e6ay3iYvda"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@synkevych?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">罗曼·辛克维奇·🇺🇦</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="732e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当Git存储库中发生特定事件时，Git挂钩将自动触发定制脚本。有两组钩子，客户端和服务器端。</p><p id="b825" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以查看这个<a class="ae ky" href="https://git-scm.com/docs/githooks" rel="noopener ugc nofollow" target="_blank">链接</a>以获得Git挂钩的完整文档，但是在本文中，我将只讨论<code class="fe lv lw lx ly b">pre-commit</code>和<code class="fe lv lw lx ly b">pre-push</code>。您可以从头开始编写自己的脚本，也可以查看这个<a class="ae ky" href="https://github.com/aitemr/awesome-git-hooks#tools" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>以获得现成的工具。对我来说，我更喜欢<a class="ae ky" href="https://typicode.github.io/husky/#/" rel="noopener ugc nofollow" target="_blank">哈士奇</a>。汪汪！汪汪！</p><h1 id="1478" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">问题</h1><p id="3f1b" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">你能想象许多开发人员在一个项目上工作，每个人都有自己的代码风格吗？是的，我知道有一些工具叫做<a class="ae ky" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> ESLint </a>、<a class="ae ky" href="https://prettier.io/" rel="noopener ugc nofollow" target="_blank">beautiful</a>和<a class="ae ky" href="https://stylelint.io/" rel="noopener ugc nofollow" target="_blank"> Stylelint </a>，但是你如何确保每个人都在他们的IDE中安装了它或者手动运行这个命令呢？</p><p id="639f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的项目可能已经集成了<a class="ae ky" href="https://sentry.io/" rel="noopener ugc nofollow" target="_blank">哨兵</a>，您必须将发布版本从主要版本更新为次要版本。人类会犯错；我们不能保证我们永远不会忘记在提交之前更新哨兵版本。</p><h1 id="1904" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">解决方案</h1><p id="d102" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">由于我们既需要<code class="fe lv lw lx ly b">pre-commit</code>又需要<code class="fe lv lw lx ly b">pre-push</code>吊钩，我们选择左<a class="ae ky" href="https://typicode.github.io/husky/#/" rel="noopener ugc nofollow" target="_blank">粗</a>和<a class="ae ky" href="https://github.com/evilmartians/lefthook" rel="noopener ugc nofollow" target="_blank">左吊钩</a>。与Lefthook相比，Husky的配置更简单。然后，我们需要来自lint-staged 的帮助，以迫使每个人在将他们的代码提交到存储库之前遵守标准；找到哨兵释放线，并在<code class="fe lv lw lx ly b">pre-push</code>中将其替换为正确的版本</p><h1 id="e34c" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">入门指南</h1><p id="0b3c" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">装置</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="c7bb" class="na ma it ly b gy nb nc l nd ne">npm i -D husky lint-staged<br/>// or<br/>pnpm i -D husky lint-staged<br/>// or<br/>yarn add husky lint-staged -D</span></pre><p id="9ab9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">启用Git挂钩</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="e544" class="na ma it ly b gy nb nc l nd ne">npx husky install</span></pre><p id="c868" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保项目中的每个开发人员都启用了Git挂钩。在您的<code class="fe lv lw lx ly b">package.json</code>中这样做，每当您本地运行<code class="fe lv lw lx ly b">npm install</code>时，它将自动启用<code class="fe lv lw lx ly b">husky</code>。</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="801e" class="na ma it ly b gy nb nc l nd ne">// package.json<br/>{   <br/>  "scripts": {     <br/>    "prepare": "husky install"   <br/>  } <br/>}</span></pre><h1 id="2280" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">预提交</h1><p id="4a5c" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">将下面的片段添加到<code class="fe lv lw lx ly b">package.json</code>:</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="2597" class="na ma it ly b gy nb nc l nd ne">// package.json<br/>{<br/>  "lint-staged": {<br/>    "*.{js,vue}": "eslint --cache --fix"<br/>  }<br/>}</span></pre><p id="9e8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码片段可以这样理解:每当一个扩展名为<code class="fe lv lw lx ly b">js</code>或<code class="fe lv lw lx ly b">vue</code>的文件被登台时，它就会运行命令<code class="fe lv lw lx ly b">eslint --cache --fix</code>。这将尽可能尝试修复ESLint问题。否则，它将返回错误，您必须在再次提交之前修复错误。</p><p id="734e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">.husky/pre-commit</code>创建一个文件</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="8fbc" class="na ma it ly b gy nb nc l nd ne"><em class="nf">#!/bin/sh<br/>. </em>"<em class="nf">$</em>(<em class="nf">dirname </em>"$0")/_/husky.sh"</span><span id="97fe" class="na ma it ly b gy ng nc l nd ne"><em class="nf">npx </em>lint-staged</span></pre><p id="3efe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行<code class="fe lv lw lx ly b">git commit</code>时，命令<code class="fe lv lw lx ly b">npx lint-staged</code>将在成功提交之前运行。</p><h1 id="9fcd" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">预推</h1><p id="9bd0" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">我们需要一个自定义脚本来更新推前释放哨兵。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="905a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Sentry发布在<code class="fe lv lw lx ly b">vite.config.js</code>中，因此脚本将定位到<code class="fe lv lw lx ly b">release:</code>的关键字所在的行，并用正确的发布名称替换它。</p><p id="1b41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将下面的片段添加到<code class="fe lv lw lx ly b">package.json</code></p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="f518" class="na ma it ly b gy nb nc l nd ne">// package.json<br/>{<br/>  "scripts": {<br/>    "prepush": "node scripts/update-sentry-release.js"<br/>  }<br/>}</span></pre><p id="08d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并使用下面的代码片段创建一个文件<code class="fe lv lw lx ly b">.husky/pre-push</code></p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="8a4e" class="na ma it ly b gy nb nc l nd ne"><em class="nf">#!/bin/sh<br/>. </em>"<em class="nf">$</em>(<em class="nf">dirname </em>"$0")/_/husky.sh"</span><span id="ba8f" class="na ma it ly b gy ng nc l nd ne"><em class="nf">npm </em>run prepush</span></pre><p id="402b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！</p><h1 id="fede" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">已知问题</h1><p id="4ac9" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated"><code class="fe lv lw lx ly b">lint-staged</code>当您尝试在Windows中提交大量暂存文件时，会抛出错误。在处检查未决问题<a class="ae ky" href="https://github.com/okonet/lint-staged/issues/420" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="9678" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自定义脚本<code class="fe lv lw lx ly b">update-sentry-release</code>只有在没有换行符时才起作用。</p><p id="368f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当有人绕过Git钩子，你合并他们的提交时，你必须修复他们的linter错误。</p><p id="3570" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。敬请关注更多内容。</p></div></div>    
</body>
</html>