<html>
<head>
<title>Our Journey With Vite and Why We Turned Back to Webpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们的Vite之旅以及我们为何回归Webpack</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/our-journey-with-vite-and-why-we-turned-back-to-webpack-b9a84ba7a223?source=collection_archive---------2-----------------------#2022-02-25">https://betterprogramming.pub/our-journey-with-vite-and-why-we-turned-back-to-webpack-b9a84ba7a223?source=collection_archive---------2-----------------------#2022-02-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="30a4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Vite 2承诺了闪电般的开发者体验。抓住机会后，我们面临一些重大问题，不得不变得有创造性</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ec205f49d67301936fe28425e3be3a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eHcUhvMyQT6xzRVf"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@robynnexy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Robynne Hu </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="72ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">多年来，我们使用Webpack和typescript编译器<code class="fe ls lt lu lv b"><a class="ae kv" href="https://www.typescriptlang.org/download" rel="noopener ugc nofollow" target="_blank">tsc</a></code>来捆绑我们的应用程序。启动开发服务器需要很长时间，热模块替换需要很长时间来更新浏览器，这真的很难保持专注。很多时候，我们在等待浏览器显示更改时，会切换到查看新闻栏或社交媒体。</p><p id="ace2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Vite 2承诺了闪电般的开发者体验，并在2021年3月终于稳定下来。我们不得不抓住这个机会。这是把我们的开发者体验带到下一个层次的工具。因此，我们做出了决定，建立Vite开发环境变得非常容易。</p><p id="054b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们使用Vite的旅程，也是促使我们再次使用Webpack的主要问题。</p><h1 id="6828" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">Vite的出色性能</h1><p id="0edb" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">我兑现了承诺。启动开发服务器需要半秒钟！热模块更换几乎是瞬间完成的。这正是我们所希望的！</p><p id="37d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">页面重新加载有点令人失望。这花了大约4秒钟，主要是因为应用程序太大了。我们公司的主要产品是一个用于俱乐部和协会的<a class="ae kv" href="https://www.webling.eu/" rel="noopener ugc nofollow" target="_blank">CRM</a>，它有一个巨大的前端，由1300个文件组成，包含160000行打字稿和<a class="ae kv" href="https://vuejs.org/guide/scaling-up/sfc.html#single-file-components" rel="noopener ugc nofollow" target="_blank"> vue 2模板</a>代码。所以不奇怪，浏览器加载1'300个模块需要一些时间。但是总的来说，开发者的体验已经改善了很多。</p><p id="61e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Vite一段时间后，随着时间的推移，两个痛点变得更加严重。</p><h1 id="1c83" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">1.不使用Vite开发服务器进行类型检查</h1><p id="cc0a" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">类型检查是TypeScript的主要优点之一。编码时，大多数错误都是通过类型检查发现的。这样可以节省很多时间，避免很多挫败感。如果代码通过了类型检查，那么只剩下逻辑错误。所有的语法错误都是在类型检查中发现的。</p><p id="c473" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Vite在幕后使用<a class="ae kv" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank"> esbuild </a>将typescript编译成javascript。Esbuild运行速度很快，但是它忽略了所有类型信息。这意味着我们失去了typescript的主要优势。Vite有一个类型检查工具——<code class="fe ls lt lu lv b"><a class="ae kv" href="https://github.com/johnsoncodehk/volar/tree/master/packages/vue-tsc" rel="noopener ugc nofollow" target="_blank">vue-tsc</a></code>——但是它没有监视模式。这使得它在开发服务器中毫无用处。</p><p id="f32a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的产品是在CI上编译的，所以我们很少在本地编译它。这种情况经常发生，代码在本地dev服务器上运行时没有任何错误，但是在CI上却失败了。由于CI只需不到一个小时的时间就能完成，因此感觉比旧的Webpack解决方案更痛苦。在一个新特性上工作了一个小时之后，我们不得不回去修复一些在配置项上发现的小的类型错误。</p><h1 id="379e" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">2.使用Esbuild，Typescript接口变成空文件</h1><p id="b044" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">我们像所有人一样，为typescript接口使用了通用的默认导入:</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="28b2" class="mx lx iq lv b gy my mz l na nb">import IExportName from '@/path/to/IExportName'</span></pre><p id="0243" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果模块只包含一个接口，Vite将无法运行应用程序。这是因为esbuild忽略所有类型信息，并且文件编译为空模块，无法导入。存在一个解决方案</p><pre class="kg kh ki kj gt mt lv mu mv aw mw bi"><span id="113f" class="mx lx iq lv b gy my mz l na nb">import <strong class="lv ir">type</strong> IExportName from '@/path/to/IExportName'</span></pre><p id="fccc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是这意味着所有的接口导入都必须改变。此外，IDE会在自动导入时生成普通导入。这非常令人不快，因为每次自动导入都必须手动纠正。</p><h1 id="626d" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">两全其美</h1><p id="1f5c" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">现在我们要在斯库拉和卡律布狄斯之间做出选择。我们应该使用慢速的Webpack设置还是不进行类型检查就使用快速的Vite？</p><p id="7231" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在一个漫长的夜晚，一个绝妙的想法出现了:如果Vite通过使用esbuild实现了闪电般的开发人员体验，为什么我们不能在Webpack中使用esbuild？</p><p id="fd3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个简短的研究就足够了:存在一个用于esbuild的Webpack加载器— <code class="fe ls lt lu lv b"><a class="ae kv" href="https://github.com/privatenumber/esbuild-loader" rel="noopener ugc nofollow" target="_blank">esbuild-loader</a></code>！我们找出我们的Webpack配置文件，并使用<code class="fe ls lt lu lv b">esbuild-loader</code>来编译和缩小文件。这样更快，但是我们失去了类型检查，因为esbuild忽略了类型。</p><p id="aec7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">解决方案是使用<code class="fe ls lt lu lv b"><a class="ae kv" href="https://github.com/TypeStrong/fork-ts-checker-webpack-plugin#readme" rel="noopener ugc nofollow" target="_blank">fork-ts-checker-webpack-plugin</a></code>。这个插件跨越了一个单独的进程，它运行typescript编译器来检查类型错误。因为它在一个单独的进程中运行类型检查，所以它不会降低dev服务器的速度。</p><p id="c695" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Webpack配置的重要部分非常简单:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="6085" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，Webpack dev服务器在12秒内启动，页面重新加载需要4秒。热模块更换会在2到4秒内更新浏览器。</p><p id="e2dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这没有Vite设置快，但比我们最初的Webpack设置快得多。</p><h1 id="5878" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">结论</h1><p id="d4fe" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">我们的Vite之旅给了我们快速的开发体验，但减少了类型检查的成本。对我们来说，快如闪电的开发服务器并没有弥补连续类型检查的不足。</p><p id="ac70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的Webpack设置中集成esbuild允许我们保持类型检查的安全网，同时拥有足够快的开发人员体验，不会被开发服务器的编译时间分散注意力。</p><h1 id="aaeb" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">你有哪些经历？</h1><p id="29e4" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">你有使用Vite和typescript的经验吗？我期待着听到你从Vite学到的经验教训。在开发过程中，你如何处理类型安全？</p></div></div>    
</body>
</html>