<html>
<head>
<title>Clock-In/Out System Part 8: Deploy Front End (Angular 6+) Using Environments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">上下班打卡系统第8部分:使用环境部署前端(角度6+)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/part-8-clock-in-out-system-deploy-frontend-angular-6-using-environments-ad267325d3b6?source=collection_archive---------0-----------------------#2019-02-15">https://betterprogramming.pub/part-8-clock-in-out-system-deploy-frontend-angular-6-using-environments-ad267325d3b6?source=collection_archive---------0-----------------------#2019-02-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9b3e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">NestJS + Angular教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/27028d592125269574905771e8218205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*KhCkmbtORw2Ux3n5WCrtzA.png"/></div></figure><p id="7c68" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这篇文章是我描述上下班打卡系统的系列文章的一部分。如果你想了解更多，你可以阅读以下内容:</p><ul class=""><li id="2dce" class="lm ln it ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/@ccaballero/part-1-clock-in-out-system-diagram-a0a51bab02a7?source=post_page---------------------------" rel="noopener">上下班打卡系统第1部分:图</a></li><li id="ddd8" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/better-programming/part-2-clock-in-out-system-basic-backend-i-authmodule-66d4a5c56122?source=post_page---------------------------" rel="noopener">上下班打卡系统第二部分:基础后端— AuthModule </a></li><li id="80ff" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/better-programming/part-3-clock-in-out-system-basic-backend-ii-usersmodule-a56f42b20f62?source=post_page---------------------------" rel="noopener">上下班打卡系统第3部分:基本后端——用户模块</a></li><li id="ebc7" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/better-programming/part-4-clock-in-out-system-basic-backend-iii-appmodule-850dd17883e?source=post_page---------------------------" rel="noopener">上下班打卡系统第4部分:基础后端— AppModule </a></li><li id="39e2" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/better-programming/part-5-clock-in-out-system-seed-database-and-migration-data-cf037be21aac?source=post_page---------------------------" rel="noopener">上下班打卡系统第5部分:种子数据库和迁移数据</a></li><li id="6793" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/@ccaballero/part-6-clock-in-out-system-basic-frontend-an-7e5f9ed08c3f?source=post_page---------------------------" rel="noopener">上下班打卡系统第6部分:基本前端</a></li><li id="adfc" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/@ccaballero/part-7-deploy-backend-nestjs-docker-docker-compose-2429c0b6aa9c?source=post_page---------------------------" rel="noopener">上下班打卡系统第7部分:使用Docker/Docker-Compose部署后端(NestJS)</a></li><li id="989e" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/@ccaballero/part-8-clock-in-out-system-deploy-frontend-angular-6-using-environments-ad267325d3b6?source=post_page---------------------------" rel="noopener">上下班打卡系统第8部分:使用环境部署前端(角度6+)</a></li><li id="7cbc" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/@ccaballero/part-9-testing-backend-testing-2d021f48403b?source=post_page---------------------------" rel="noopener">上下班打卡系统第9部分:后端测试——服务的单元测试</a></li><li id="e598" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://medium.com/@ccaballero/part-10-testing-backend-testing-unit-testing-controllers-4177370ef581?source=post_page---------------------------" rel="noopener">上下班打卡系统第10部分:后端测试——控制器单元测试</a></li><li id="9f8f" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated">上下班打卡系统第11部分:后端测试-e2e测试</li><li id="5ee0" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated">上下班打卡系统第12部分:前端测试单元测试</li><li id="bceb" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated">上下班打卡系统第13部分:前端测试集成测试</li></ul><p id="f708" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在第7部分中，我们使用环境变量部署了系统的后端，并在生产服务器中使用了<a class="ae lv" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> Docker/Docker Compose </a>。在本文中，我们将部署我们的前端，使用环境变量(使用Angular CLI创建)和Docker/Docker Compose在Angular中开发。</p><p id="9d3c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这里包括一个在Angular中管理环境变量的通用解决方案，使用<a class="ae lv" href="https://cli.angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular CLI </a>(我们很快就会用到)。另一个解决方案是使用诸如<a class="ae lv" href="https://gulpjs.com/" rel="noopener ugc nofollow" target="_blank"> gulp </a>或<a class="ae lv" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> webpack </a>之类的工具创建自己的部署系统。</p><p id="d22c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最后，使用<a class="ae lv" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker的容器</a>部署我们的代码。我们将从我们的代码和<a class="ae lv" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> Docker Compose </a>中创建一个图像。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="bac8" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">步骤1:用Angular管理环境变量</h1><p id="c650" class="pw-post-body-paragraph kq kr it ks b kt na ju kv kw nb jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">默认情况下，Angular CLI会创建一个包含环境文件的<code class="fe nf ng nh ni b">src/environments</code>文件夹。最初有两个文件:<code class="fe nf ng nh ni b">environment.ts</code>和<code class="fe nf ng nh ni b">environment.prod.ts</code>。</p><p id="0603" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe nf ng nh ni b">environment.ts</code>文件用于开发环境，而<code class="fe nf ng nh ni b">environment.prod.ts</code>文件用于生产环境。这些文件都在<code class="fe nf ng nh ni b">angular.json</code>文件中被引用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nj"><img src="../Images/d1ff63fe7301c755cbd8ec7e826094f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gypdxSLP_4U_Q3cfwX8RUA.png"/></div></div></figure><p id="ecd1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe nf ng nh ni b">fileReplacements</code>数组是Angular的环境键，因为它用于指示当使用<code class="fe nf ng nh ni b">production</code>配置时哪个文件将被替换。</p><p id="0d46" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在我们的代码中，我们只需要从环境文件中导入对象来使用我们的环境变量。下面的代码显示了一个导入所述环境文件的组件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ca"><img src="../Images/869aae323b9c6eafd5f45316146c9279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gbYlLmnTSqej5MJJgFJM-Q.png"/></div></div></figure><p id="762d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在不同环境之间切换的方法是使用<code class="fe nf ng nh ni b">--configuration</code>选项，该选项可在<code class="fe nf ng nh ni b">ng serve</code>和<code class="fe nf ng nh ni b">ng build</code>命令中使用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi no"><img src="../Images/aaed46183000d92d6b2e0fec2a094464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ahv-Zh0V0J3vpJzn8ecgVg.png"/></div></div></figure><p id="12d9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们可以拥有任意多的配置环境，例如:</p><ul class=""><li id="bf31" class="lm ln it ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated"><code class="fe nf ng nh ni b">environment.test.ts</code>这个配置可以用来改变单元测试环境中的几个变量。</li><li id="7fc8" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><code class="fe nf ng nh ni b">environment.e2e-test.test</code>该配置可用于改变e2e测试环境中的几个变量。</li><li id="afa8" class="lm ln it ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><code class="fe nf ng nh ni b">environment.qa.ts</code>该配置可用于改变质量保证环境中的几个变量。</li></ul><p id="ee56" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">因此，我们的环境文件的内容如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi np"><img src="../Images/d7cd76305ff8cbdc995fe595de27f109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9kmbQgGylnR-R7UUJ7DlfQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/3569f34716876fe41dede3e9433b219f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsJGyAu-LnMkx61GxxGBZg.png"/></div></div></figure><p id="0dcd" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在环境文件之间变化的变量是<code class="fe nf ng nh ni b">APIENDPOINT_BACKEND</code>和<code class="fe nf ng nh ni b">production</code>。在<code class="fe nf ng nh ni b">main.ts</code>文件中使用<code class="fe nf ng nh ni b">production</code>变量来调用<code class="fe nf ng nh ni b">enableProdMode</code>，T5用于在最终的<code class="fe nf ng nh ni b">bundle</code>中做一些优化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nr"><img src="../Images/e090de78dbd0b128dbf5219297dc3559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5OWGAJoZc50KEWUuHknog.png"/></div></div></figure><p id="3f23" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在我们的项目中，有一个包含项目常数的文件。该文件包含端点列表，这些端点是使用<code class="fe nf ng nh ni b">APIENDPOINT_BACKEND</code>的关系。这个想法是使用环境文件(<code class="fe nf ng nh ni b">environment</code>)，您可能会在下面的代码中看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ns"><img src="../Images/f929e6e3198675fda74b7ec0d4951cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sE-LerIthjLeph633v8mmQ.png"/></div></div></figure><h1 id="aac0" class="mi mj it bd mk ml nt mn mo mp nu mr ms jz nv ka mu kc nw kd mw kf nx kg my mz bi translated">步骤2:使用Docker和Docker Compose进行部署</h1><p id="2b1d" class="pw-post-body-paragraph kq kr it ks b kt na ju kv kw nb jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">这个想法是在开发和生产中使用相同的环境。在这种情况下，Docker是完美的工具，因为它允许我们配置不同的容器来切换环境的配置。我们需要建立自己的形象，一个Docker容器。这将使用<code class="fe nf ng nh ni b">docker-compose</code>进行编排。</p><h2 id="a74a" class="ny mj it bd mk nz oa dn mo ob oc dp ms kz od oe mu ld of og mw lh oh oi my oj bi translated">码头工人</h2><p id="3cf0" class="pw-post-body-paragraph kq kr it ks b kt na ju kv kw nb jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">我们的<code class="fe nf ng nh ni b">dockerfile</code>文件基于<code class="fe nf ng nh ni b">nginx:alpine</code>图像，因为项目不需要系统库。该图像仅使用命令<code class="fe nf ng nh ni b">ng build --configuration=prod</code>从构建到发布复制了<code class="fe nf ng nh ni b">nginx.conf</code>配置和角度项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ok"><img src="../Images/9f91f28e72d40fd3b3d6613b0d4e1611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oBp4fJbUzIom-8Bq2vcTdg.png"/></div></div></figure><p id="9ab8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">将Angular代码部署在web服务器中非常重要，例如<code class="fe nf ng nh ni b">apache</code>或<code class="fe nf ng nh ni b">nginx</code>服务器。</p><p id="b43a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe nf ng nh ni b">nginx</code>配置如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ol"><img src="../Images/2d09c378a9a68c9dcb5552840bdf8eca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5sKR7uuRlklbxaDUgOlsLA.png"/></div></div></figure><h2 id="e1f7" class="ny mj it bd mk nz oa dn mo ob oc dp ms kz od oe mu ld of og mw lh oh oi my oj bi translated">docker-撰写</h2><p id="6e00" class="pw-post-body-paragraph kq kr it ks b kt na ju kv kw nb jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">在我们的项目中，我们有一个用于部署docker映像的<code class="fe nf ng nh ni b">docker-compose</code>文件。文件非常简单。它仅仅部署了包含我们Angular项目的编译代码的容器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi om"><img src="../Images/56e35d42948aa8f307900d61ee7e454d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MSUJCC_TNf8ElC-9Rcu0TA.png"/></div></div></figure><h1 id="bc0e" class="mi mj it bd mk ml nt mn mo mp nu mr ms jz nv ka mu kc nw kd mw kf nx kg my mz bi translated">步骤3:使用Shell脚本执行</h1><p id="3b19" class="pw-post-body-paragraph kq kr it ks b kt na ju kv kw nb jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">我们流程的最后一步是自动化容器的构造和执行。我有两个脚本来完成这项任务:第一个脚本创建图像(首先删除图像，如果有图像的话)，第二个脚本使用<code class="fe nf ng nh ni b">docker-compose</code>部署代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi on"><img src="../Images/dcc5327dae443572276fff23d6ee02a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAerpYSNPjixJH3gfGXDNQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi oo"><img src="../Images/45c7f2e435b62d597f3e4c8d4214b384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M9WUfCPHSZZqXr1OxoIjCA.png"/></div></div></figure></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="efac" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="094c" class="pw-post-body-paragraph kq kr it ks b kt na ju kv kw nb jx ky kz nc lb lc ld nd lf lg lh ne lj lk ll im bi translated">在这篇文章中，我解释了如何使用Docker和Docker Compose部署Angular前端。这段代码最有趣的特性是，我们可以加载自己的环境变量，使用Angular CLI在开发和生产环境之间切换。</p></div></div>    
</body>
</html>