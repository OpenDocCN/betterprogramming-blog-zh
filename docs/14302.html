<html>
<head>
<title>Reverse Engineering Pokemon FireRed Through ROM Hacking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">逆向工程口袋妖怪通过ROM黑客火了</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/low-level-explorations-reverse-engineering-pokemon-firered-through-rom-hacking-54edfb4426?source=collection_archive---------6-----------------------#2022-11-26">https://betterprogramming.pub/low-level-explorations-reverse-engineering-pokemon-firered-through-rom-hacking-54edfb4426?source=collection_archive---------6-----------------------#2022-11-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b73b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我第一次进入引擎盖下</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/edab8b3759dcdb4ae9b43332c604c9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QNq4WA8omOJ_V4pzeLHS-g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带有口袋妖怪FireRed的Gameboy模拟器|图片由任天堂提供</p></figure><p id="9bf1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在计算机科学中，逆向工程是指对一个软件进行反汇编，以分析核心组件并了解其功能。我在这方面的经验有限，所以我决定尝试一个逆向工程项目。我喜欢口袋妖怪，具体来说，我选择破解口袋妖怪FireRed是因为在这个主题上存在大量的文档。让我们一起探索吧！</p><p id="0a78" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我下载了一个名为“视觉男孩进阶”的Gameboy模拟器，并安装了Pokemon FireRed的ROM文件。</p><p id="91d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我立即研究了内存，如图1所示。我编辑了随机的十六进制值，破坏了控件，并在游戏中创造了刺耳的噪音。厉害！我拥有操纵游戏的能力。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lr"><img src="../Images/9f9f250cce3367087f71b6b676e452d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H7vPl03qWphkrPVsU0hmJQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图一。口袋妖怪FireRed的记忆“兜帽”下</p></figure><p id="a453" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尝试让你遇到的所有野生口袋妖怪都闪闪发光会很酷。让我们首先了解游戏如何生成闪亮的口袋妖怪来实现这一目标。根据<a class="ae ls" href="https://bulbapedia.bulbagarden.net/wiki/Shiny_Pok%C3%A9mon#Generation_III_onward" rel="noopener ugc nofollow" target="_blank"> Bulbapedia </a>的说法，第三代口袋妖怪的闪亮程度取决于以下公式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/12a9c533fa4b131cdfbebae6525bad01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*AKkQT7fXwOhOTZGPSzCI4A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图二。从第三代开始，闪亮口袋妖怪的配方</p></figure><p id="2d5e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">什么是异或？XOR指的是“异或”逻辑门，其中如果输入位都是1，输出位将是0。只有一个输入位可以为1，输出才能为1。</p><p id="3b64" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要生成一个闪亮的口袋妖怪，这个公式的值必须小于8。我们需要知道我们必须为教练ID(包含秘密ID)和个性值编辑哪些特定的内存地址。<a class="ae ls" href="https://bulbapedia.bulbagarden.net/wiki/Pok%C3%A9mon_data_structure_(Generation_III)" rel="noopener ugc nofollow" target="_blank"> Bulbapedia </a>揭示了这一具体信息，如图3所示。</p><div class="kg kh ki kj gt ab cb"><figure class="lu kk lv lw lx ly lz paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/ab3b16656a95b4b73e1fea62e3f2f68c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*vHzTpEy_jqUfunWXzRmV9g.png"/></div></figure><figure class="lu kk ma lw lx ly lz paragraph-image"><img src="../Images/13fe21d537582300e33b8c45b53f33e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*ch2uLLl-Y4Ekt8hvxk0PVg.png"/><p class="kr ks gj gh gi kt ku bd b be z dk mb di mc md translated">图3。来自Bulbapedia的Gen 3数据结构信息</p></figure></div><p id="d95f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们返回到仿真器中的内存查看器，我们可以跳转到这个内存地址(0x0202402C)并识别必要的内核信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi me"><img src="../Images/333782b30012644762739f2ef445f34a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*3xk99futIoImYaRj5rQzXg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图4。存储器地址0x0202402C的数据</p></figure><p id="fe4b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当你解释多字节内存时，你需要非常小心。例如，个性值是<strong class="kx ir"/><code class="fe mf mg mh mi b">NOT<strong class="kx ir"> </strong>0x0B5CD830</code>——更确切地说，个性值是<code class="fe mf mg mh mi b">0x30DB5C0B</code>。</p><p id="f7eb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们必须了解计算机内存，才能理解字节顺序的这种差异。计算机只理解0和1，我们可以将它们转换成十六进制值，以获得更人性化的视图，如图4所示。想象一下，试图用一系列位来破解ROM那会很痛苦！</p><p id="e8ac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">每对十六进制数字表示内存中的一个字节。然而，当内存中有多个字节时，我们必须选择读取字节的顺序。从逻辑上看，从左到右阅读英语似乎很直观，但存在从右到左阅读的阿拉伯语或希伯来语等人类文字，因此这些简单的决定没有自动标准化。</p><p id="9122" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就引出了字节序的概念，指的是最高有效字节(MSB)和最低有效字节(LSB)的数据字节的特定顺序。有两种类型的端序，称为小端序和大端序，下面的图表将进一步解释这两种端序:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/eba9e741c1513b71c7eff31d1e0b92cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*Bc00UMZLCWgRBjUsefZtwQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图5。</p></figure><p id="5589" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Gameboy Advance使用Little Endian，所以这就是为什么我们把自己的人格价值解释为<code class="fe mf mg mh mi b">0x30DB5C0B</code>。不同的处理器可能使用Big Endian，因此您应该验证任何关于endianness的假设，以防止任何计算机内存相关项目出现大规模错误。这些字节序的设计选择基本上是任意的，并且这两种选择都不存在特定的优势。</p><p id="1870" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦我们提取了个性值和训练师ID，我们必须为我们闪亮的公式操纵它们，以总是输出闪亮的口袋妖怪。由于我们对所有这些值进行异或运算，因此实现这一点的一个简单方法可能是将教练ID设置为个性值，因为如果我们对相同的字符串进行异或运算，我们将获得所有0作为输出，这将小于8(我们的闪亮阈值)。</p><p id="78a6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，改变教练ID而不是个性值会更好，因为个性值会影响各种内部口袋妖怪统计，如电动汽车。</p><p id="b370" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，让我们看看当我们在一次野生口袋妖怪遭遇中改变这些值时会发生什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/aa0831cf2264517f5518910b956e9690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RqOXBRvq7U1Mec_o2nfcjw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图6。哎呀！我们的野生口袋妖怪变成了坏蛋！</p></figure><p id="0145" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">哦不！当我们试图改变ROM值时，我们收到了一个坏鸡蛋。经过进一步研究，这是因为我们没有更新校验和。</p><h2 id="7310" class="ml mm iq bd mn mo mp dn mq mr ms dp mt le mu mv mw li mx my mz lm na nb nc nd bi translated"><strong class="ak">什么是校验和？</strong></h2><p id="9594" class="pw-post-body-paragraph kv kw iq kx b ky ne jr la lb nf ju ld le ng lg lh li nh lk ll lm ni lo lp lq ij bi translated">校验和检验数据的完整性，因为数据传输中可能存在错误。在口袋妖怪的情况下，这些校验和可能是反作弊机制。一旦我们编辑了训练者ID，校验和表明数据中存在错误，并将野生口袋妖怪变成了坏蛋，如图6所示。</p><p id="94ef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，我们需要更新校验和，它是通过对数据子结构求和计算出来的，如图7所示。然而，还存在另一个问题——数据是加密的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi me"><img src="../Images/7e01f36c9adb3a81029e3ec4102ed6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*nshKvHDfp27TvrIytIM3-w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图7。校验和及加密数据</p></figure><p id="9c4f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要解密我们的数据并重新计算我们的校验和，我们需要遵循以下步骤(根据Bulbapedia):</p><ol class=""><li id="c46e" class="nj nk iq kx b ky kz lb lc le nl li nm lm nn lq no np nq nr bi translated">通过将教练ID与个性值进行异或运算，获得32位解密密钥</li><li id="6c4f" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">将解密密钥与加密数据的每四个字节进行异或运算，以获得解密数据</li><li id="9948" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">每次将所有加密值的两个字节相加，以获得新的校验和</li><li id="f85f" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">更新旧的校验和值</li></ol><p id="89a7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，似乎有这个问题的一个组成部分，我失踪了，因为我无法生成闪亮的口袋妖怪后，重新计算校验和。一个理想的解决方案是删除校验和算法，因为它必须存储在计算机内存中的某个地方，但没有文档存在。</p><p id="a03c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然我没有达到我最初的目标，但这个探索的过程非常有趣和吸引人。这是我第一次体验ROM黑客，我肯定学到了很多。当我为这个项目做研究时，我发现各种论坛都有关于细微差别的ROM黑客和人们的汇编脚本的大量教程。这可能是我低级探索的下一个方向。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/79b28b3dc724dfaedaa9044303d2b7a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UvQNsfJxwH_6iPXBwJ0UQA.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">不太像我期待的闪闪发光的口袋妖怪…</p></figure><p id="3854" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">逆向工程远远超出了操纵Gameboy游戏的汇编代码。当今最突出的应用之一是网络安全中的恶意软件分析和数字取证。我希望通过更多这样的项目来探索网络安全的不同途径。</p><p id="8cec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢阅读！如果你对文章有任何想法，你想联系我，我很乐意与你交谈。下次见！</p></div></div>    
</body>
</html>