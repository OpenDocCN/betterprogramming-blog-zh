<html>
<head>
<title>Ruby on Apple Silicon M1 Macs: The Problems, the Findings, and the Workarounds</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">苹果硅M1苹果电脑上的红宝石:问题、发现和解决办法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ruby-on-apple-silicon-m1-macs-fb159849b2f5?source=collection_archive---------0-----------------------#2021-01-24">https://betterprogramming.pub/ruby-on-apple-silicon-m1-macs-fb159849b2f5?source=collection_archive---------0-----------------------#2021-01-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c079" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让你的Ruby程序在苹果基于ARM的处理器上运行</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d08d9bb940f1bc968a261cc1908c91a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QK_xsPIJf9paM67r"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@karthikeya_gs07?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Karthikeya GS </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="3ee7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">问题是</h1><p id="3244" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有了苹果硅M1 MAC电脑，我们有了全新的macOS、通用二进制文件和一套新的Xcode命令行工具。和往常一样，这个包附带了Ruby的安装，但这是第一次，它附带了一个通用的二进制文件来支持ARM和Intel CPU——一段旅程就这样开始了。</p><p id="7f97" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于有经验的Ruby开发人员来说，这个故事可能并不新鲜和/或不必要的复杂。我只想在这里分享我的经验、见解和成果。</p><p id="7666" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在玩M1的时候，我很快就遇到了一些运行Ruby程序的问题。就像椰子恐龙，哲基尔，或者快车道。起初，它似乎总是来自包含在许多项目中的一个依赖项。</p><p id="f864" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在网上搜索发现，我不是唯一一个有这个问题的人，因为有些人似乎在M1上有一些问题:</p><div class="mp mq gp gr mr ms"><a href="https://github.com/ffi/ffi/issues/870" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">1 . 14 . 2:M1 Mac mini问题#870 ffi/ffi上的ffi_c.bundle中缺少兼容的arch</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">我正试着用这个指南在我的M1 mac Mini上本地建立我的Github Pages网站。现在，我试着创造一个…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng kp ms"/></div></div></a></div><div class="mp mq gp gr mr ms"><a href="https://github.com/CocoaPods/CocoaPods/issues/9907#issuecomment-742102069" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">CocoaPods与苹果DTK(苹果硅)的兼容性问题#9907 CocoaPods/CocoaPods</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">引用于2020年10月27日引用于2020年12月17日引用于2020年12月24日引用于…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nh l nd ne nf nb ng kp ms"/></div></div></a></div><div class="mp mq gp gr mr ms"><a href="https://github.com/CocoaPods/CocoaPods/issues/10220" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">尝试pod安装时出错问题#10220 CocoaPods/CocoaPods</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">命令/usr/local/bin/pod安装报告你做了什么？吊舱安装你预计会发生什么？正在安装我的…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="ni l nd ne nf nb ng kp ms"/></div></div></a></div><p id="fc26" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">…以及其他。</p><p id="f925" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">尝试运行某些Ruby程序似乎总是会导致相同的问题:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="d19c" class="no kx iq nk b gy np nq l nr ns">LoadError - dlopen(/Library/Ruby/Gems/2.6.0/gems/ffi-1.13.1/lib/ffi_c.bundle, 0x0009): missing compatible arch in /Library/Ruby/Gems/2.6.0/gems/ffi-1.13.1/lib/ffi_c.bundle</span></pre><p id="6737" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">起初，我以为是<a class="ae kv" href="https://luajit.org/ext_ffi.html" rel="noopener ugc nofollow" target="_blank"> FFI库</a>本身以及与ARM架构的兼容性缺失。但是我发现我完全错了。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="632a" class="kw kx iq bd ky kz oa lb lc ld ob lf lg jw oc jx li jz od ka lk kc oe kd lm ln bi translated">变通办法</h1><p id="deef" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当我开始分析二进制文件时，我发现在x86模式下安装和运行FFI效果很好，因此我可以运行:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="b036" class="no kx iq nk b gy np nq l nr ns">~ arch -arch x86_64 bundle install<br/>~ arch -arch x86_64 bundle exec jekyll serve</span></pre><p id="16e6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">网上有些人提到，安装一个定制的Ruby二进制文件(例如，通过homebrew或rbenv)对他们来说也很好。</p><p id="c49d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">所以我们有了一个变通办法——但是问题并没有让我一个人呆着，我不得不更深入地研究它。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="a087" class="kw kx iq bd ky kz oa lb lc ld ob lf lg jw oc jx li jz od ka lk kc oe kd lm ln bi translated">分析</h1><p id="3708" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我深入研究这个问题的第一步是分析Ruby二进制文件本身，它位于macOS系统上的<code class="fe of og oh nk b">/usr/bin</code>:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="7025" class="no kx iq nk b gy np nq l nr ns">~ ruby -v</span><span id="3ba9" class="no kx iq nk b gy oi nq l nr ns">ruby 2.6.3p62 (2019-04-16 revision 67580) [universal.arm64e-darwin20]</span></pre><p id="47a7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">和苹果预装的版本一样，这是一个旧版本，但有趣的是，它是一个通用的二进制文件，而不是一个模拟的x86版本。</p><p id="83ee" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了分析通用二进制文件，苹果提供了Lipo，一个命令行程序来创建或操作通用文件。</p><p id="ae1d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我转储了关于二进制文件的详细信息:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="e671" class="no kx iq nk b gy np nq l nr ns">~ lipo -detailed_info /usr/bin/ruby<br/>Fat header in: /usr/bin/ruby<br/>fat_magic 0xcafebabe<br/>nfat_arch 2<br/>architecture x86_64<br/>    cputype CPU_TYPE_X86_64<br/>    cpusubtype CPU_SUBTYPE_X86_64_ALL<br/>    capabilities 0x0<br/>    offset 16384<br/>    size 56624<br/>    align 2^14 (16384)<br/>architecture arm64e<br/>    cputype CPU_TYPE_ARM64<br/>    cpusubtype CPU_SUBTYPE_ARM64E<br/>    capabilities PTR_AUTH_VERSION USERSPACE 0<br/>    offset 81920<br/>    size 56432<br/>    align 2^14 (16384)</span></pre><p id="2c40" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">因此，看起来我们有一个普通的通用二进制文件，它会自动为系统架构选择正确的二进制文件——在我的例子中，是ARM64的二进制文件，但运行的是:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="c8b8" class="no kx iq nk b gy np nq l nr ns">~ ruby -e 'require "rbconfig"; pp RbConfig::CONFIG' | grep "host"</span></pre><p id="eb28" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这显示了一些有趣的东西。</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="e5c7" class="no kx iq nk b gy np nq l nr ns"> "host_os"=&gt;"darwin20",<br/> "host_vendor"=&gt;"apple",<br/><strong class="nk ir"> "host_cpu"=&gt;"x86_64",</strong><br/> "host"=&gt;"x86_64-apple-darwin20",<br/> "host_alias"=&gt;"",</span></pre><p id="35ff" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">除了清单第3行的<code class="fe of og oh nk b">host_cpu</code>字段中的<code class="fe of og oh nk b">arm64</code>或<code class="fe of og oh nk b">arm64e</code>之外，一切似乎都很好，因为我们在ARM处理器上运行程序。</p><p id="b3a0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">注意:</strong>许多程序似乎使用并依赖于<a class="ae kv" href="https://www.rubydoc.info/github/rubyworks/facets/RbConfig" rel="noopener ugc nofollow" target="_blank"> RbConfig </a>模块来获取关于它们正在运行的系统的信息。</p><p id="fa9b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在那之后，很明显问题不在于FFI库本身，而在于苹果自己提供的Ruby安装中更深层的东西。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="e34b" class="kw kx iq bd ky kz oa lb lc ld ob lf lg jw oc jx li jz od ka lk kc oe kd lm ln bi translated">通用二进制</h1><p id="bd79" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有了这些新的见解，我怀疑通用二进制没有为它运行的架构选择正确的二进制部分。为了验证这一点，我想确保我的测试是用ARM Ruby二进制文件运行的——但是如何做到这一点呢？</p><p id="94cc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Lipo工具还有另一个有趣的特性:你可以把一个通用的二进制文件精简成它的架构二进制部分。</p><p id="e59b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Lipo的主页上写道:</p><blockquote class="ok ol om"><p id="107d" class="lo lp oj lq b lr mk jr lt lu ml ju lw on mm lz ma oo mn md me op mo mh mi mj ij bi translated">”<code class="fe of og oh nk b"><em class="iq">thin arch_type</em></code></p><p id="74fc" class="lo lp oj lq b lr mk jr lt lu ml ju lw on mm lz ma oo mn md me op mo mh mi mj ij bi translated">取一个输入文件，用指定的<code class="fe of og oh nk b"><em class="iq">arch_type</em></code>创建一个瘦输出文件。该命令需要<code class="fe of og oh nk b"><em class="iq">-output</em></code>选项。"</p></blockquote><p id="70ec" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">所以我把苹果的二进制文件变薄，试着去掉ARM部分，以确保我只使用ARM代码。</p><p id="2a7b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">运行这个:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="784b" class="no kx iq nk b gy np nq l nr ns">~ lipo -thin arm64e -output ruby-thin /usr/bin/ruby</span></pre><p id="8090" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">…生成了一个新文件(<code class="fe of og oh nk b">ruby-thin</code>)，看起来是纯ARM二进制代码:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="2b72" class="no kx iq nk b gy np nq l nr ns">~ lipo -archs ruby-thin<br/>arm64e</span></pre><p id="ea21" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但是使用这个新的二进制文件再次运行之前的相同测试:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="6159" class="no kx iq nk b gy np nq l nr ns">~ ./ruby-thin -e 'require "rbconfig"; pp RbConfig::CONFIG' | grep "host"</span></pre><p id="c591" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">…仍然导致:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="f373" class="no kx iq nk b gy np nq l nr ns">"host_os"=&gt;"darwin20",<br/>"host_vendor"=&gt;"apple",<br/><strong class="nk ir">"host_cpu"=&gt;"x86_64",</strong><br/>"host"=&gt;"x86_64-apple-darwin20",<br/>"host_alias"=&gt;"",</span></pre><p id="908b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">而且它还在识别主机CPU为<code class="fe of og oh nk b">x86_64</code>！</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="e3a9" class="kw kx iq bd ky kz oa lb lc ld ob lf lg jw oc jx li jz od ka lk kc oe kd lm ln bi translated">走漫长的路</h1><p id="f7ab" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我不是Ruby开发人员，对这种语言本身也没有什么经验，这只会让事情变得更加困难，让我更加束手无策。</p><p id="526f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我想到了自己编译Ruby的想法，因为这应该是获得ARM二进制文件的确定方式，所以我下载了源代码并开始制作自己的Ruby二进制文件。</p><p id="69ae" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我不希望生成的二进制文件安装在系统上，所以我只运行:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="7b52" class="no kx iq nk b gy np nq l nr ns">~ ./configure &amp;&amp; make</span></pre><p id="15ca" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这产生了一个新的Ruby二进制文件。</p><p id="afa3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对二进制文件的分析表明，它是一个纯ARM64二进制文件:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="09fe" class="no kx iq nk b gy np nq l nr ns">~ ./ruby -v<br/>ruby 3.0.0p0 (2020-12-25 revision 95aff21468) [arm64-darwin20]</span><span id="72e2" class="no kx iq nk b gy oi nq l nr ns">~ lipo -detailed_info ruby<br/>input file ruby is not a fat file<br/>Non-fat file: ruby is architecture: arm64</span></pre><p id="5778" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">不幸的是，运行这个二进制文件没有我想象的那么容易，并导致了一个错误:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="1fa8" class="no kx iq nk b gy np nq l nr ns">~ ./ruby -e 'require "rbconfig"; pp RbConfig::CONFIG' | grep "host"<br/>`RubyGems' were not loaded.<br/>`did_you_mean' was not loaded.<br/>-e:1:in `require': cannot load such file -- rbconfig (LoadError)<br/>from -e:1:in `&lt;main&gt;'</span></pre><p id="03e7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Ruby运行起来更复杂，并且需要以我想避免的方式安装。</p><p id="9cac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然而，还有另一个线索:我在编译二进制文件的目录中发现了<code class="fe of og oh nk b">rbconfig.rb</code>文件。我发现这个文件负责<code class="fe of og oh nk b">rbconfig</code>模块读取和显示的值，因为它包含了许多程序使用的所有键/值对。</p><p id="0866" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在之前编译的Ruby的<code class="fe of og oh nk b">rbconfig.rb</code>文件里面，我发现:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="ed31" class="no kx iq nk b gy np nq l nr ns">~ ruby-3.0.0 cat rbconfig.rb | grep "_cpu"</span><span id="8904" class="no kx iq nk b gy oi nq l nr ns">CONFIG["target_cpu"] = "arm64"<br/>CONFIG["host_cpu"] = "arm64"<br/>CONFIG["build_cpu"] = "aarch64"</span></pre><p id="6f72" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这不仅是另一条线索，而且似乎是我所有未决问题的最终答案！</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="fbb2" class="kw kx iq bd ky kz oa lb lc ld ob lf lg jw oc jx li jz od ka lk kc oe kd lm ln bi translated">结论aka TL速度三角形定位法(dead reckoning)</h1><p id="6ea2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">所以最后的结论比我最初想的要简单得多。问题出在<code class="fe of og oh nk b">rbconfig.rb</code>本身，它是在编译时构建的。</p><p id="77eb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">通用二进制文件或多或少只是两个独立二进制文件的组合，因此每个二进制文件都需要一个独立的<code class="fe of og oh nk b">rbconfig.rb</code>配置文件。当然，<code class="fe of og oh nk b">rbconfig</code>模块和配置既不支持也不打算这样做，当然也永远不会支持。</p><p id="0bac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这个问题似乎没有最终的解决方案——除了安装一个定制的Ruby安装。</p><p id="2cd0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在我发现的几天后，我收到了GitHub上的一条评论:</p><div class="mp mq gp gr mr ms"><a href="https://github.com/ffi/ffi/issues/870#issuecomment-756989318" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">1 . 14 . 2:M1 Mac mini上的ffi_c.bundle中缺少兼容arch，系统Ruby问题#870 …</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">我正试着用这个指南在我的M1 mac Mini上本地建立我的Github Pages网站。现在，我试着创造一个…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="oq l nd ne nf nb ng kp ms"/></div></div></a></div><p id="2831" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">所以一直以来，苹果都在计划弃用Ruby二进制程序。</p><p id="372b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">有了这些信息，几乎可以肯定永远不会有修复，我们开发人员需要自己关心Ruby。</p></div></div>    
</body>
</html>