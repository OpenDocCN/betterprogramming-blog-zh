<html>
<head>
<title>What’s New in React v17?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React v17有什么新功能？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/whats-new-in-react-v17-68b7e15576e1?source=collection_archive---------1-----------------------#2020-10-26">https://betterprogramming.pub/whats-new-in-react-v17-68b7e15576e1?source=collection_archive---------1-----------------------#2020-10-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ed6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">React三年来的首次发布。有什么新鲜事？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ce2a8bf5ae447da223dd3f9ff538f81b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qMhMmX0uXWpB8bpt"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@nft?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">尼古拉斯·天梭</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="a9b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">React v16第一次发布已经有三年了，终于，下一个主要版本的等待结束了。React开发团队承诺，更新v17对React的未来非常重要，但也提到没有添加新功能。你可能想知道为什么它会在那时发布。</p><p id="2148" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将列出最新版本中所做的更改。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="39e9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么没有新功能？</h1><p id="789e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">React 17主要致力于让React本身的升级变得更容易。虽然在这个更新中没有面向开发人员的功能是不寻常的，但这个版本的主要目标是确保将一个版本的React管理的树嵌入到另一个版本的React管理的树中是安全的。React开发团队称这个<a class="ae ky" href="https://reactjs.org/blog/2020/08/10/react-v17-rc.html" rel="noopener ugc nofollow" target="_blank">为“垫脚石”版本</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="296d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">逐步升级</h1><p id="5314" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这些年来，React升级一直是孤注一掷。要么你不得不继续使用旧版本，要么你需要将整个应用程序升级到新版本。因此，如果在新的更新中引入了突破性的变化，并且您计划迁移到新的版本，您必须更改您的代码库——尤其是当您的代码库非常大的时候。</p><p id="c0f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">React团队已经用React 17修复了这些问题中的大部分。当React v18和以下版本推出时，您可以通过升级应用程序的一些部分来逐步迁移，同时仍然保持其他部分在React v17上运行。因此，如果您有一个大型应用程序使用的版本不是主动维护的，这个选项将非常有用。</p><p id="8e90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">React的团队准备了一个repo来演示如何延迟加载React的旧版本:</p><div class="mz na gp gr nb nc"><a href="https://github.com/reactjs/react-gradual-upgrade-demo/" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">react js/react-渐进-升级-演示</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">这是一个演示，展示了如何配置一个构建系统，以便在…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ks nc"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9093" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">对事件委托的更改</h1><blockquote class="nr"><p id="1535" class="ns nt it bd nu nv nw nx ny nz oa lu dk translated">“在React 17中，React将不再在<code class="fe ob oc od oe b">document</code>级别附加事件处理程序。相反，它会将它们附加到呈现React树的根DOM容器中。— <a class="ae ky" href="https://reactjs.org/blog/2020/08/10/react-v17-rc.html" rel="noopener ugc nofollow" target="_blank"> React的博客</a></p></blockquote><p id="64ff" class="pw-post-body-paragraph kz la it lb b lc of ju le lf og jx lh li oh lk ll lm oi lo lp lq oj ls lt lu im bi translated">让我们看一个例子。考虑将一个<code class="fe ob oc od oe b">onClick</code>事件附加到React中的一个按钮上，如下所示:</p><pre class="kj kk kl km gt ok oe ol om aw on bi"><span id="0c34" class="oo md it oe b gy op oq l or os">&lt;button onClick={handleClick}&gt;</span></pre><p id="e73c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与上面编译的代码相当的普通JS将如下所示:</p><pre class="kj kk kl km gt ok oe ol om aw on bi"><span id="6a22" class="oo md it oe b gy op oq l or os">myButton.addEventListener('click', handleClick);</span></pre><p id="962d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">React然后将每个事件类型的一个处理程序直接附加到文档节点，而不是附加到声明它们的DOM节点。这称为事件委托。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/ab1e0cd9997f510fd16fd56b701d96e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyGC1pno1PHi7Rf4oO-_Lg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片来自React的<a class="ae ky" href="https://reactjs.org/blog/2020/10/20/react-v17.html" rel="noopener ugc nofollow" target="_blank">博客</a>。</p></figure><p id="ab09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在React v17中，事件处理程序将不再附加在文档级别，而是附加在呈现树的DOM容器中。</p><pre class="kj kk kl km gt ok oe ol om aw on bi"><span id="0fcf" class="oo md it oe b gy op oq l or os">const rootNode = document.getElementById('root');<br/>ReactDOM.render(&lt;App /&gt;, rootNode);</span></pre><p id="3a06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了React v17中的这一变化，现在可以安全地嵌套使用不同版本React构建的应用程序了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cc76" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">新JSX变换</h1><p id="7fa1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">React v17提供了一个新的重写版本的JSX变换，尽管升级到这个新的变换是完全可选的。它仍然提供一些好处，如:</p><ul class=""><li id="9a99" class="ou ov it lb b lc ld lf lg li ow lm ox lq oy lu oz pa pb pc bi translated">不需要导入<code class="fe ob oc od oe b">React</code>。</li><li id="6935" class="ou ov it lb b lc pd lf pe li pf lm pg lq ph lu oz pa pb pc bi translated">增加你的包大小。</li></ul><p id="839f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您希望了解更多关于这一新转变的信息，请阅读React团队的这篇博客文章:</p><div class="mz na gp gr nb nc"><a href="https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">介绍新的JSX变革-反应博客</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">虽然React 17不包含新功能，但它将为新版本的JSX变换提供支持。在这个…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">reactjs.org</p></div></div><div class="nl l"><div class="pi l nn no np nl nq ks nc"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a0b6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">重大变化</h1><p id="39f8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这个新版本有一些突破性的变化。</p><h2 id="c243" class="oo md it bd me pj pk dn mi pl pm dp mm li pn po mo lm pp pq mq lq pr ps ms pt bi translated">1.事件委托</h2><p id="fb91" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如上所述，升级后您可能会面临一些问题。</p><p id="0f85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个新版本中，<code class="fe ob oc od oe b">event.stopPropagation()</code>实际上会阻止您的文档处理程序释放:</p><pre class="kj kk kl km gt ok oe ol om aw on bi"><span id="2e24" class="oo md it oe b gy op oq l or os">document.addEventListener('click', function() {<br/>  // This custom handler will no longer receive clicks<br/>  // from React components that called e.stopPropagation()<br/>});</span></pre><p id="3e51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要解决这个问题，通过传递一个<code class="fe ob oc od oe b">{ capture: true }</code>选项作为第三个参数，将您的事件监听器转换为使用一个<code class="fe ob oc od oe b">capture</code>阶段，如下所示:</p><pre class="kj kk kl km gt ok oe ol om aw on bi"><span id="46b7" class="oo md it oe b gy op oq l or os">document.addEventListener('click', function() {<br/>  // Now this event handler uses the capture phase,<br/>  // so it receives *all* click events below!<br/>}, { capture: true });</span></pre><p id="4774" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们看到事件委托现在比以往任何时候都更接近正常的DOM。</p><h2 id="6159" class="oo md it bd me pj pk dn mi pl pm dp mm li pn po mo lm pp pq mq lq pr ps ms pt bi translated">2.与浏览器对齐</h2><p id="b285" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">React对事件系统做了一些修改:</p><ul class=""><li id="2162" class="ou ov it lb b lc ld lf lg li ow lm ox lq oy lu oz pa pb pc bi translated"><code class="fe ob oc od oe b">onScroll</code>事件不再冒泡。</li><li id="8e1a" class="ou ov it lb b lc pd lf pe li pf lm pg lq ph lu oz pa pb pc bi translated"><code class="fe ob oc od oe b">onBlur</code>和<code class="fe ob oc od oe b">onFocus</code>事件现在已经切换到在内部使用原生<code class="fe ob oc od oe b">focusin</code>和<code class="fe ob oc od oe b">focusout</code>事件，更好地匹配React的现有行为，甚至提供更多信息。</li><li id="f555" class="ou ov it lb b lc pd lf pe li pf lm pg lq ph lu oz pa pb pc bi translated"><code class="fe ob oc od oe b">onClickCapture</code>现在使用实际的浏览器捕获阶段监听器。</li></ul><h2 id="cb79" class="oo md it bd me pj pk dn mi pl pm dp mm li pn po mo lm pp pq mq lq pr ps ms pt bi translated">3.没有事件池</h2><p id="c935" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这个新版本中，事件池优化已经从React中删除，原因是持续的混乱以及它没有提高性能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pu pv l"/></div></figure><p id="bd63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在React 17中，这段代码如您所料地工作。旧的事件池优化已经完全移除，因此您可以在需要时随时读取事件字段。</p><h2 id="4717" class="oo md it bd me pj pk dn mi pl pm dp mm li pn po mo lm pp pq mq lq pr ps ms pt bi translated">4.效果清理时间</h2><p id="04d2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这个新版本也使得<code class="fe ob oc od oe b">useEffect</code>钩子清理函数计时更加一致。</p><pre class="kj kk kl km gt ok oe ol om aw on bi"><span id="79ba" class="oo md it oe b gy op oq l or os">useEffect(() =&gt; {<br/>  // This is the effect itself.<br/>  return () =&gt; {    // This is its cleanup.  };});</span></pre><p id="54d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在React v16中，效果清理功能是同步运行的。根据<a class="ae ky" href="https://reactjs.org/blog/2020/08/10/react-v17-rc.html" rel="noopener ugc nofollow" target="_blank"> React博客</a>，“在React v17中，效果清理功能总是异步运行——例如，如果组件正在卸载，清理会在屏幕更新后运行。”</p><h2 id="d624" class="oo md it bd me pj pk dn mi pl pm dp mm li pn po mo lm pp pq mq lq pr ps ms pt bi translated">5.返回未定义的一致错误</h2><p id="65cb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在React v16中，返回<code class="fe ob oc od oe b">undefined</code>的函数总是抛出一个错误，主要是因为无意中返回<code class="fe ob oc od oe b">undefined</code>非常容易:</p><pre class="kj kk kl km gt ok oe ol om aw on bi"><span id="21ed" class="oo md it oe b gy op oq l or os">function Button() {<br/>  // We forgot to write return, so this component returns undefined.<br/>  // React surfaces this as an error instead of ignoring it.<br/>  &lt;button /&gt;;<br/>}</span></pre><p id="7de3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最初，这种行为只是类和函数组件独有的，但是在这个新版本中，添加了<code class="fe ob oc od oe b">forwardRef</code>和<code class="fe ob oc od oe b">memo</code>组件，使它们的行为与常规的类和函数组件一致。注意，对于那些你不想渲染任何东西的例子，将会返回<code class="fe ob oc od oe b">null</code>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eeb6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="c6e3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">虽然React v17没有任何新功能，但它通过直接解决升级体验问题为即将到来的版本奠定了坚实的基础，并使React的行为与现代浏览器更加一致。我希望这篇文章是有帮助的。</p><p id="6142" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4b5b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><div class="mz na gp gr nb nc"><a href="https://reactjs.org/blog/2020/10/20/react-v17.html" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">React v17.0 - React博客</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">今天，我们发布React 17！我们已经详细讨论了React 17版本的作用以及它的变化…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">reactjs.org</p></div></div><div class="nl l"><div class="pw l nn no np nl nq ks nc"/></div></div></a></div></div></div>    
</body>
</html>