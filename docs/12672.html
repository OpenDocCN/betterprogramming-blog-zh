<html>
<head>
<title>How to Build and Deploy an Angular Application Directly From GitHub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何直接从GitHub构建和部署Angular应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-and-deploy-an-angular-application-directly-from-github-a0aa5f28e6aa?source=collection_archive---------5-----------------------#2022-06-21">https://betterprogramming.pub/how-to-build-and-deploy-an-angular-application-directly-from-github-a0aa5f28e6aa?source=collection_archive---------5-----------------------#2022-06-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cc17" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过GitHub动作和GitHub页面轻松实现升级和运行的CI/CD</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/64c281998a4c76937ed5debc56968635.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EuQFupaVhZ9E5JBDXTydkw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="cb64" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如今，拥有一个用于持续集成和部署的可靠工作流是强制性的。无论您是单独工作还是作为团队的一员，拥有自动构建、检查和部署项目的能力可以节省大量时间。市场上为Angular构建配置项的选择如此之多，不可能面面俱到。</p><p id="283d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将简单地关注使用GitHub提供的工具做每一件事。如果您已经在使用GitHub来版本化您的项目，您可能会有兴趣充分利用它的潜力。</p><p id="d75c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将构建并部署一个我在上一篇文章中使用过的简单天气应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/36e6f553ce6c02b23856887b0f2cf2f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/0*w6bbyGsfe6ZjohDV.gif"/></div></figure><h1 id="801d" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">步骤1:初始化GitHub动作</h1><p id="be7f" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">要初始化CI的工作流，只需转到您的存储库主页并单击actions。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/a8e16992c08a6e74413768d0184f0bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NJ6Ps6biPCizH4ehdq1bBw.png"/></div></div></figure><p id="939c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如你所看到的，GitHub会建议一些预定义的工作流，这取决于你的库中代码的性质。我们将手动构建工作流，因此我们可以对每个步骤进行注释。(文章末尾提供了完整的最终文件)</p><p id="4a74" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击“自行设置工作流程”后，您将看到一个基本的hello world类型的工作流程。工作流以一个具有特定语法的<code class="fe mu mv mw mx b">.yml</code>文件的形式出现。每一行都有一个注释解释它为什么在这里。我们可以保持文件不变，然后单击提交。</p><p id="de7a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，如果您返回到“操作”选项卡，您的工作流应该已经成功执行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/84552878ea7f50c9173e51785559fe19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UjPQPpRoOJIZlzowo6kjpA.png"/></div></div></figure><p id="13f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">CI配置文件现在存储在项目中的<code class="fe mu mv mw mx b">/.github</code>文件夹下。</p><h1 id="d4ad" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">步骤2:设置和安装依赖项</h1><p id="7cee" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">首先，我们需要决定何时触发工作流。我决定每次有人推T2分行时就触发它。在我的例子中，这非常有意义，因为我的工作流将构建和部署我的项目。您可以选择为每个pull请求触发，或者甚至使用正则表达式来匹配分支名称。</p><p id="4dd6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我的文件的开头是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="0207" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们来准备实际工作。我们需要:</p><ul class=""><li id="c3de" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">查看项目源代码</li><li id="d458" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">设置node.js</li><li id="6e73" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">安装依赖项</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><ul class=""><li id="f795" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated"><code class="fe mu mv mw mx b">jobs</code>是开始一项工作的语法。一个工作流可以包含任意数量的作业。</li><li id="0756" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><code class="fe mu mv mw mx b">build-and-deploy</code>是这项工作的名称。你可以把任何东西放在这里。</li><li id="0621" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><code class="fe mu mv mw mx b">runs-on</code>是您决定工作平台的地方。我选择了Ubuntu，但由于我们将主要使用<code class="fe mu mv mw mx b">npm</code>,我们可以在这里选择任何东西。</li><li id="a18f" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><code class="fe mu mv mw mx b">uses</code>是导入外部动作的语法</li><li id="33c4" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><code class="fe mu mv mw mx b">run</code>简单地运行一个命令</li></ul><p id="60d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我使用提供的<code class="fe mu mv mw mx b">cache</code>参数设置Node.js。这将缓存和恢复依赖项，从而缩短构建时间。需要注意的是，它不会缓存整个<code class="fe mu mv mw mx b">node_modules</code>文件夹。因此，我可以使用<code class="fe mu mv mw mx b">npm ci</code>命令。</p><h1 id="8e74" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">第三步:检查角度项目</h1><p id="153f" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">设置完成后，我们现在可以执行几项检查，以确保在实际构建之前项目质量良好。对于这个例子，我们将执行最常见的检查:林挺项目和运行单元测试。</p><p id="4d4e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安装节点后，事情变得非常简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="d588" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在CI上lint项目之前，您需要在本地计算机上至少运行一次该命令。它将触发lint配置并将所需的文件添加到您的项目中。</p><p id="79ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了测试我的应用程序，您可能已经注意到我没有直接使用默认配置中的<code class="fe mu mv mw mx b">npm run test</code>命令。相反，我专门为配置项创建了一个脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><ul class=""><li id="d291" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">我把浏览器切换到Chrome的无头版本。没有必要为配置项打开浏览器窗口，因为我们无论如何也看不到它。</li><li id="e430" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">我将<code class="fe mu mv mw mx b">watch</code>属性设置为false。如果不这样做，该命令将永远不会结束，因为它将监视代码中的更改。您的工作总是会因为超时而失败。</li><li id="1bdd" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">我还添加了<code class="fe mu mv mw mx b">code-coverage</code>属性来显示代码覆盖率报告。</li></ul><h1 id="27ef" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">步骤4:构建角度项目</h1><p id="d24b" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我们的项目通过了所有的检查。太好了！现在是时候建造它了。</p><p id="1fbf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在实际这样做之前，可以有一个可选的额外步骤。在我的示例项目中，我通过他们提供给我的API键来使用天气API。但是，如果你进入我的<code class="fe mu mv mw mx b">environment.prod.ts</code>文件，在那里的关键应该是，这是你看到的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="ef13" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">钥匙不在那里。即使它是一个免费的API，在存储库中暴露秘密也是一个不好的做法，我希望尊重这个原则。但是现在，我们如何建立这个项目呢？</p><p id="4ace" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们需要将实际的密钥存储在一个安全的位置。转到您的存储库设置，并点击秘密。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/8e9bbe86dd4281e9b49c7863b9f644b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HNWbHSx-kRt5SjPGttLqyw.png"/></div></div></figure><p id="ef2b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，您可以添加新的存储库密码。给它一个明确的名称，因为您以后会需要它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/cd1ad7f1b490ae0ada75129600acb31d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e3VK3TbG1JXnp-aUSVrTDA.png"/></div></div></figure><p id="4926" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">回到工作流文件，我们必须添加一个步骤，用正确的值替换占位符值。市场上有很多提供这种服务的行为。我选了这个。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6c04" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的环境文件中，我小心地将我的值放在大括号中，以便插件更容易找到它。在这种情况下，<code class="fe mu mv mw mx b">SECRET_API_KEY</code>是将被替换的令牌的名称，<code class="fe mu mv mw mx b">API_KEY</code>是秘密的标识符。</p><p id="136b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要构建项目，我只需运行以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="230d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我通过添加<code class="fe mu mv mw mx b">— deploy-url </code>参数为配置项创建了一个特定的脚本。这在下一步中是有意义的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="8a68" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">步骤5:将Angular项目部署到GitHub页面</h1><p id="0bad" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">GitHub页面直接从GitHub提供静态托管。它非常适合个人页面、项目文档，甚至是托管一个小的Angular应用程序。</p><p id="7ec1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们需要创建一个分支来存储项目的编译版本。这个分支将直接反映GitHub页面上部署的内容。你想怎么叫都行。</p><p id="cb9b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是，<code class="fe mu mv mw mx b">gh-pages</code>是GitHub认可的标准名称。一旦您创建并推送了这个分支，您就可以检查部署是否工作了。</p><p id="9d5e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在您的存储库设置中，单击页面。分支<code class="fe mu mv mw mx b">gh-pages</code>应该已经被自动检测和部署了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/d0b1a9882f82e84c9b37c46d6823b87a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1MDrhwfbZdl1PXbqoZgMCw.png"/></div></div></figure><p id="38e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我使用一个自定义域名来托管我的GitHub页面，我不会在本教程中介绍如何做。默认的URL应该是这样的<code class="fe mu mv mw mx b">http://&lt;github_username&gt;.github.io/&lt;repository_name&gt;</code></p><p id="f391" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您的项目将部署在子文件夹中。这就是为什么我们之前设置的<code class="fe mu mv mw mx b">deploy-url</code>属性很重要。构建需要从正确的途径服务资产。</p><p id="e153" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面说你的网站发表了，但是还没有结束！如果您从<code class="fe mu mv mw mx b">master</code>创建了分支，那么您只需要部署一个Angular应用程序的源代码。它不能这样使用。我们需要部署我们在前面的步骤中生成的构建。</p><p id="2c98" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们回到工作流文件并添加最后一步。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="25a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个动作只是将<code class="fe mu mv mw mx b">dist</code>文件夹的内容复制到我们之前创建的分支，自动触发部署到GitHub页面。您可以在配置项的日志中看到它的工作情况。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/106dd10d485f1c461a3dd09de8c638cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_UzydF2EVgp13bameYMWjg.png"/></div></div></figure><p id="117e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">恭喜你！现在，您已经为Angular项目准备了一个简单的CI，以及一个要展示的已部署版本。</p><h1 id="0894" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Angular文件的完整CI / CD</h1><p id="e494" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">这是最终的工作流文件。你可以在这里访问完整的库<a class="ae lu" href="https://github.com/aurelien-leloup/weather-app" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="0cf2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">谢谢你看完这篇文章！我最近才开始钻研GitHub动作的特性。我惊讶于它是如此的好和简单。</p><p id="22c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我将继续使用它，我鼓励你也这样做。</p></div></div>    
</body>
</html>