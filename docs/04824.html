<html>
<head>
<title>String Interpolation in Swift Explained With 4 Useful Examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用4个有用的例子解释Swift中的字符串插值</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/string-interpolation-in-swift-explained-with-4-useful-examples-9be8a0b9a1fb?source=collection_archive---------13-----------------------#2020-05-12">https://betterprogramming.pub/string-interpolation-in-swift-explained-with-4-useful-examples-9be8a0b9a1fb?source=collection_archive---------13-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="059e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你可能每天都在使用字符串插值。让我们定制它</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1384968325707a3693318ce7fe66dd26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zBRiTW1Om1Qiu-Un"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@_javardh_001?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">贾瓦德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="616e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Swift 5用<a class="ae ky" href="https://github.com/apple/swift-evolution/blob/master/proposals/0228-fix-expressiblebystringinterpolation.md" rel="noopener ugc nofollow" target="_blank"> SE-228 </a>推出了一个体面的字符串插值版本，并更新了自Swift 3以来一直被弃用的旧版本<code class="fe lv lw lx ly b">ExpressibleByStringInterpolation</code>协议。该协议的新版本允许我们对现有类型编写强大的扩展，这些扩展定义了对象在字符串插值中使用时如何交互。</p><p id="1c5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在开发应用程序时，我们经常会打印出一些数据来帮助我们在测试或调试过程中理解我们的应用程序。<a class="ae ky" href="https://www.avanderlee.com/swift/custom-debug-descriptions/" rel="noopener ugc nofollow" target="_blank">使用自定义调试描述来改进调试</a>是改进我们在Swift中处理字符串的方式的一种方式，但是我们可以通过将此与字符串插值的优势相结合来达到另一个水平。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="f307" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">什么是字符串插值？</h1><p id="4fad" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">这个名字是不言自明的——它是关于将值插入字符串的。换句话说，将一个字符串添加到另一个字符串。</p><p id="37f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最简单的例子如下:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="1185" class="nh mh it ly b gy ni nj l nk nl">let name = "Antoine van der Lee"<br/>print("Hello, I'm \(name)")</span></pre><p id="af5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，我们将名称插入到print语句中。这产生了一个打印的句子:“你好，我是安托万·范德·李。”下面，我们利用了默认情况下处理插值的<code class="fe lv lw lx ly b">DefaultStringInterpolation</code>结构，并将名称添加到了<code class="fe lv lw lx ly b">"Hello, I'm"</code>字符串值中。</p><p id="ae9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Swift允许我们通过为特定类型添加我们自己的定制字符串插值逻辑来扩展这种默认行为，所以让我们来看看您可以在日常开发中使用的四个有用的案例。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="eeb1" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated"><strong class="ak">案例1:打印选项</strong></h1><p id="2016" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在Swift中打印期权可能会非常痛苦。有几个选项可供您选择:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="912e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编译器通常建议使用后者:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="b107" class="nh mh it ly b gy ni nj l nk nl">String interpolation produces a debug description for an optional value; did you mean to make this explicit?</span><span id="0cf2" class="nh mh it ly b gy no nj l nk nl">- Use <!-- -->String(describing:)<!-- --> to silence this warning</span></pre><p id="8dca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我一直在项目中使用这种方法，这导致了混乱的输出，在我的日志中没有非常有用的<code class="fe lv lw lx ly b">Optional()</code>关键字。在许多情况下，我最终使用默认值方法，这并不总是导致干净的字符串插值。因此，我决定编写一个处理可选值的自定义字符串插值解决方案:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4144" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这现在允许我们像以前一样打印出选项，但是我们不再得到编译器的建议:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="b837" class="nh mh it ly b gy ni nj l nk nl">print("The title is \(title)")<br/>// Prints: The title is SwiftLee - A blog about Swift</span></pre><p id="e42e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该值被很好地打印出来，没有关键字<code class="fe lv lw lx ly b">Optional(..)</code>。如果没有设置该值，将会打印出<code class="fe lv lw lx ly b">nil</code>，它清楚地表明该值没有设置，这将在调试过程中对我们有所帮助。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="3f77" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated"><strong class="ak">案例二:打印JSON </strong></h1><p id="5bdb" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">另一个常见的用例是从数据请求中打印出JSON响应。这在调试期间很有用，但是打印JSON的代码可能并不总是在手边。我发现自己搜索了几次关于栈溢出的代码，想知道如何从<code class="fe lv lw lx ly b">Data</code>漂亮地打印JSON。</p><p id="fddc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这个问题，我创建了一个自定义的字符串插值方法，将<code class="fe lv lw lx ly b">Data</code>作为输入:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4fc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种插值方法引入了一种处理字符串插值的新方法，并要求我们在插值中设置一个属性名。这一开始对你来说可能不常见，但是一旦你理解了它带来的可能性，它就会变得有用。在这种情况下，我们的JSON打印得很好！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="bc99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这也可以直接用在<code class="fe lv lw lx ly b">URLSessionDataTask</code>的回复中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="a827" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated"><strong class="ak">案例3:打印URL请求</strong></h1><p id="d1b4" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">就像打印JSON响应一样，打印出任何传出的<code class="fe lv lw lx ly b">URLRequest</code>也很有用。在开发应用程序时，我们经常利用网络请求，了解更多关于传出请求的信息会很有用。</p><p id="63d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，一个<code class="fe lv lw lx ly b">URLRequest</code>按如下方式打印出来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="daf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管这为我们提供了URL，但它也可以为我们提供关于HTTP方法的信息、包含的标头或您能想到的其他有用信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="4fa4" class="nh mh it bd mi np nq dn mm nr ns dp mq li nt nu ms lm nv nw mu lq nx ny mw nz bi translated">字符串插值与<code class="fe lv lw lx ly b">CustomStringConvertible</code></h2><p id="88ea" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">虽然这样做很好，但我还是用这个例子来指出这可以通过使用<code class="fe lv lw lx ly b">CustomStringConvertible</code>协议来实现。</p><p id="14c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">指出这一点的原因是，你必须明白，只有当你实际上在一个字符串内组合值时，字符串插值才起作用。</p><p id="939b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，即使我们已经配置了字符串插值扩展，如果按如下方式使用，前面的示例也会打印出没有额外属性的URL:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="4b66" class="nh mh it ly b gy ni nj l nk nl">print(request)<br/>// Prints: <a class="ae ky" href="https://www.avanderlee.com/feed?offset=10&amp;limit=20" rel="noopener ugc nofollow" target="_blank">https://www.avanderlee.com/feed?offset=10&amp;limit=20</a></span></pre><p id="1002" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为该请求没有在另一个使用<code class="fe lv lw lx ly b">\(..)</code>语法的字符串中使用。相反，它是使用<code class="fe lv lw lx ly b">CustomStringConvertible</code>协议中定义的<code class="fe lv lw lx ly b">description</code>值打印出来的。</p><p id="854a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想了解更多，你可以阅读我关于使用定制调试描述来改进调试的文章。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="624d" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated"><strong class="ak">案例4:转换为HTML </strong></h1><p id="97fb" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">当你使用HTML的时候，如果你能利用字符串插值，它可能更具可读性。一个常见的用例是在一段文本中包含一个链接。</p><p id="462a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，您的<code class="fe lv lw lx ly b">String</code>可能会被HTML标签弄得乱七八糟，而您希望保持它的可读性:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="d721" class="nh mh it ly b gy ni nj l nk nl">"""<br/>   The blog post can be found at &lt;a href="www.avanderlee.com"&gt;www.avanderlee.com&lt;/a&gt;<br/>"""</span></pre><p id="756b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于HTML <code class="fe lv lw lx ly b">&lt;a&gt;&lt;/a&gt;</code>标签，我们在我们的<code class="fe lv lw lx ly b">String</code>中添加了一些额外的语法，使得它可读性更差。相反，我们可以添加一个定制的字符串插值扩展来处理添加到一个<code class="fe lv lw lx ly b">String</code>的HTML链接:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="fb7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用定制的字符串插值方法，我们允许自己添加额外的验证逻辑，以确保使用有效的URL。我们利用断言失败在调试早期给自己反馈说使用了无效的URL。</p><p id="6a66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于同样的想法，您可以添加对markdown或其他导出方法的支持。我把这个留给你做练习！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="5142" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="ffbe" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">自定义字符串插值允许您进一步优化Swift中的字符串处理。打印JSON或optionals等常见用例可以让在Swift中进行开发成为更好的体验。然而，知道什么时候使用自定义字符串插值，什么时候使用<code class="fe lv lw lx ly b">CustomStringConvertible</code>协议实现，这是很好的。</p><p id="e5f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>