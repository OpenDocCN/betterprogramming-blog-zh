<html>
<head>
<title>Build a Secure Envelope in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS中构建安全信封</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-secure-envelope-in-ios-swift-f1f0297d2562?source=collection_archive---------8-----------------------#2022-11-29">https://betterprogramming.pub/build-a-secure-envelope-in-ios-swift-f1f0297d2562?source=collection_archive---------8-----------------------#2022-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5ee6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们学习如何在Swift中通过REST API传输敏感数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4f449658502f654b93f514f7ec125b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vR3VgxEL56KvR7ZN"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@i_am_simoesse?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">新美乐股份公司·塞尔吉</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="2858" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">互联网和网络应用正在迅速发展，因此保护这些应用的需求变得至关重要。</p><p id="3cdb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文通过提出两种不同的加密算法来解决这个问题。使用不对称和对称算法的组合效果产生了一种混合加密方案，使得不安全的人很难从通过不安全传输传输的消息中获知任何信息。</p><blockquote class="ls lt lu"><p id="1c32" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">密码术是用秘密代码书写的科学，是一种古老的艺术，它确保消息(书写)安全(隐藏)而不被非消息接收者发现。</p></blockquote><h1 id="df6c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">加密目标</h1><p id="2559" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">密码学用于为许多问题提供解决方案，例如:</p><ul class=""><li id="dd09" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">保密性(隐私)</li><li id="3e6c" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">数据完整性</li><li id="5165" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">证明</li><li id="8ea8" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">不可否认性</li></ul><h2 id="f1d0" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">密钥加密(对称)</h2><p id="3238" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">它使用一个密钥进行加密和解密。发送方使用密钥(或某些规则)加密明文，并将密文发送给接收方。</p><p id="1890" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接收者应用相同的密钥(或规则集)来解密消息并恢复明文。因为两种功能都使用一个密钥，所以密钥加密也称为对称加密。</p><h2 id="5dc5" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">公钥加密(非对称)</h2><p id="7fc6" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">目前用于密钥交换或数字签名的公钥加密算法包括RSA、Rabin、ElGamal、Paillier、椭圆曲线加密(ECC)、Cramer-Shoup和许多其他公钥加密算法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/0f4d3284273b3b5b778af2be8b8e6ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asuc-6Ab_bqkqBgPVgetUg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@maurosbicego" rel="noopener ugc nofollow" target="_blank"> Mauro Sbicego在Unsplash </a>上拍摄</p></figure><h1 id="850d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">混合算法</h1><p id="1c37" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">本文提出了一种混合加密方法，通过两种加密技术来保护数据传输:AES算法用于加密明文，RSA算法用于加密AES密钥，以确保客户端-客户端或客户端-服务器之间的安全传输不被他人验证，使其更难以被攻击者访问。</p><p id="9872" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在该算法中，原始数据进入系统，并且在一个执行阶段期间而不是在单独的阶段中输出通过AES密钥加密的数据和通过RSA公钥加密的AES密钥。在接收端，解密过程已经完成。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/78dedba7d8459d8032594391639b3d4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_EVycPUmisURNRuzS02Hw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">混合加密</p></figure><ol class=""><li id="1532" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr ny nc nd ne bi translated">发送方生成一个用于加密纯文本的公共密钥。</li><li id="4f0f" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">纯文本由发送方生成的公共密钥加密。</li><li id="e20b" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">发送方使用接收方的公钥对公钥进行加密。</li><li id="1715" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">发送方发送加密的文本和加密的公共密钥。</li><li id="9b95" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">接收方通过使用接收方的秘密密钥对加密的公共密钥进行解密。</li><li id="ec0f" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">接收方通过解密公共密钥来解密加密的文本</li></ol><blockquote class="ls lt lu"><p id="747e" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">AES(高级加密标准)是一种常用密钥加密方法的算法。它是在DES之后建立的加密标准，是当前默认的加密标准。</p><p id="e724" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">RSA是一种公钥加密算法。计算机器的能力影响算法，因为它是基于素数分解的困难。它需要足够的密钥长度，如“2010年加密算法问题”中所述。目前，2048位被用作标准长度。</p></blockquote><h1 id="0ccb" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">履行</h1><p id="9dc0" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在实现安全信封之前，我想简单地告诉您一些事情:</p><ol class=""><li id="f0e0" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr ny nc nd ne bi translated">实现安全信封对于将加密环境与后端相匹配非常重要。例如，当后端决定使用RSA/ECB/OAEPWithSHA-256时，在客户端实现相同的环境非常重要。</li><li id="f11d" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr ny nc nd ne bi translated">许多框架有助于加快开发速度，减少实现过程中可能出现的错误。</li></ol><h1 id="e2f0" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">演示项目</h1><p id="24f8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这里是<a class="ae kv" href="https://github.com/mehrankmlf/SecurePacketEnvelope" rel="noopener ugc nofollow" target="_blank">演示项目</a>，它展示了如何实现一个安全信封。</p><p id="0264" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们需要为AES算法实现一个IV和密钥生成器，它生成一个简单的16位长度的随机字符串。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="6744" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">AES加密密钥有三种长度。每个密钥长度都有不同数量的可能密钥组合。尽管这种加密方法的密钥长度不同，但其块大小(128位，即16字节)保持不变。</p><p id="9f21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其次，我们需要实现一个密钥对。RSA密钥对是RSA算法使用的公钥和私钥的名称。RSA公钥是加密密钥，而私钥(必须保密以确保只有目标接收者才能读取数据)是解密密钥。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="4d94" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">AES256-CBC操作</h2><p id="d4d3" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这种算法也被许多人称为“块密码”，因为它将数据分成称为块的块段。</p><ul class=""><li id="eaa9" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">AES加密密钥将数据分成4*4个数组，每个数组包含16个字节。</li><li id="0365" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">每个字节最多包含8位。但是这种划分不会改变密文的大小。原始文本和密文的大小都是128位。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/5cdc732abe6411d7b6a9fdd5e50e0610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwgXcvNnSDW_U8eQSFSzZQ.png"/></div></div></figure><p id="4ebd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们之前所说的，使用框架来实现AES是可能的，但是我们没有使用它们来更好地理解实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="03e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通用加密仍然是执行低级加密操作的推荐方式，如我们用于实现的AES。</p><p id="ce96" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如该方法中清楚的那样，除了算法和填充等输入之外，它还接收一个名为<code class="fe oc od oe of b">IV</code>的输入和另一个名为<code class="fe oc od oe of b">KEY</code>的输入。</p><h2 id="0979" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">注入静脉的</h2><p id="9fce" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">初始化向量(IV)是一个任意数字，它可以与密钥一起用于数据加密，以抵御网络攻击。该号码也称为nonce(使用一次的号码)，在任何会话中仅使用一次，以防止可疑或恶意参与者对消息进行未经授权的解密。关于IV重要的一点是，你绝不能对两个消息使用同一个IV，所以在实践中，你可以使用我们之前生成的一个随机的IV。</p><h2 id="9e37" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">键</h2><p id="5e6b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">由于AES支持多种密钥大小，我们应该为这种情况选择最好的一种。AES-128是商业应用中最常见的选择。它提供了安全性和速度之间的平衡。各国政府通常利用AES-192和AES-256来实现最高的安全性。我们使用AES-256来提高安全性。</p><h2 id="4376" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">RSA-PKCS1操作</h2><p id="2167" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如前所述，我们使用RSA算法来保护AES中使用的密钥。与AES一样，RSA也有一些要求，我们将在下面解释:</p><ul class=""><li id="71c3" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">不要发送带有私钥的密文。</li><li id="d1c7" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">您不应该使用1024位RSA密钥。他们不安全。切换到至少2048位的密钥。</li><li id="4175" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">加密是用公钥完成的，解密是用私钥完成的。</li><li id="6bd0" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">使用RSA密钥的加密是有限的；只有少量的数据可以加密或解密，RSA很慢。</li></ul><p id="c6f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于本文关注的是混合加密，我们可能在另一篇文章中讨论过公钥和私钥的结构。这里，我们将研究一个公钥和私钥的例子。</p><h2 id="b508" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">公钥</h2><p id="a991" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">以传统RSA格式编码的RSA公钥如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="cb79" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">私人钥匙</h2><p id="bc38" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">2048位RSA私钥的例子，对应上面的公钥。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5ef3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">苹果已经提供了一个处理RSA的安全框架，所以我们将使用它来保护敏感数据。这里敏感数据将是AES密钥。</p><h2 id="304c" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">RSA加密</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="7fe2" class="nk ma iq bd mb nl nm dn mf nn no dp mj lf np nq ml lj nr ns mn ln nt nu mp nv bi translated">RSA-解密</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="8172" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="dca6" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">由于RSA加密具有非常低的数据限制，仅使用<br/> RSA算法的敏感数据加密和解密的方法在某种程度上涉及一些困难。新算法结合了两种算法的特点，解决了对称加密算法的密钥移动问题和非对称加密算法的高功耗问题。</p><p id="e981" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你认为这是值得一读和耐人寻味。</p><div class="og oh gp gr oi oj"><a href="https://github.com/mehrankmlf/SecurePacketEnvelope" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">GitHub-mehrankmlf/SecurePacketEnvelope:Swift中的混合加密</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">SecurePacketEnvelope是一种混合加密系统，可以高效安全地加密用户敏感数据，支持…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">github.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox kp oj"/></div></div></a></div></div></div>    
</body>
</html>