<html>
<head>
<title>How to Implement Sign In With SwiftUI and AWS Amplify (Part 4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用SwiftUI和AWS Amplify实现登录(第4部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-implement-sign-in-with-swiftui-and-aws-amplify-part-4-a59144107147?source=collection_archive---------15-----------------------#2020-06-01">https://betterprogramming.pub/how-to-implement-sign-in-with-swiftui-and-aws-amplify-part-4-a59144107147?source=collection_archive---------15-----------------------#2020-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8e4b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用电子邮件登录</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/97f0d6dd9583cfdbb63695580aa34db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FcD0cJRtP3LPlD3t"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@aaronburden?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亚伦·伯顿</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h1 id="4601" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">通过电子邮件注册</strong></h1><p id="f89d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在跳转到代码之前，如果您没有用AWS Amplify设置您的项目，请检查<a class="ae kv" href="https://medium.com/better-programming/sign-in-with-aws-amplify-and-swiftui-978b01a5cf10" rel="noopener">第1部分</a>。在这一部分，我完成了项目的设置，还用Google添加了一个登录。对于脸书登录，检查<a class="ae kv" href="https://medium.com/better-programming/how-to-implement-sign-in-with-swiftui-and-aws-amplify-part-2-4a7b20bfe8cc" rel="noopener">第2部分</a>，对于苹果登录，检查<a class="ae kv" href="https://medium.com/better-programming/how-to-implement-sign-in-with-swiftui-and-aws-amplify-part-3-de994e218ed7" rel="noopener">第3部分</a>。</p><p id="567d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">幸运的是，当用电子邮件登录时，我们不需要配置任何东西，因为AWS Amplify会为我们处理一切，所以如果你只是在你的应用程序上使用电子邮件作为提供商，你只需要配置你的Amplify项目，忽略谷歌、脸书或苹果的配置。</p><p id="52a5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">注册和登录我们需要遵循的步骤是:</p><ol class=""><li id="a464" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">输入注册的名称、电子邮件和密码</li><li id="19b9" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">输入发送到电子邮件的验证码</li><li id="3e38" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">确认后用电子邮件登录</li></ol><p id="4135" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">首先，让我们在<code class="fe nd ne nf ng b">SignInViewController</code>上实现用电子邮件注册的方法。</p><p id="1142" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe nd ne nf ng b">AWSMobileclient</code>注册方法非常简单，只需要用户名和密码。如果您将Amplify项目配置为需要一个电子邮件、一个名字和一张图片，那么您需要在一个数组中传递它们。在这里，我为图片发送一个空字符串，但是如果您有图片的URL，请随意为您的用户添加它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">更新了通过电子邮件注册的SignInViewController</p></figure><p id="da4e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">由于我们可能希望在使用电子邮件(以及社交提供商)登录时检查令牌，请注意上面对<code class="fe nd ne nf ng b">getToken</code>方法的重构。</p><p id="f5f1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们还需要更新应用程序设置，以存储我们将发送确认码的电子邮件。这样做是为了即使用户关闭应用程序，我们也会跟踪他们之前输入的电子邮件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">更新的AppSettings</p></figure><p id="83d4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于注册，我们将创建一个像其他按钮一样的按钮，但一旦我们按下它，我们希望显示一个文本字段，用户可以在其中输入所需的信息。</p><p id="b89a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们需要添加几个我们想要跟踪的<code class="fe nd ne nf ng b">State</code>。我们还需要一个<code class="fe nd ne nf ng b">Bool</code> <code class="fe nd ne nf ng b">signUpWithEmail</code>来显示我们按下按钮后的<code class="fe nd ne nf ng b">TextField</code>。我们还需要为<code class="fe nd ne nf ng b">signUpName</code>、<code class="fe nd ne nf ng b">signUpEmail</code>和<code class="fe nd ne nf ng b">signUpPassword</code>添加<code class="fe nd ne nf ng b">Bindings</code>。参见下面更新的<code class="fe nd ne nf ng b">ContentView</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">内容视图</p></figure><p id="478a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">注意，我们使用了一个<code class="fe nd ne nf ng b">SecureField</code>，所以输入的密码不会显示出来。</p><p id="0a02" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">一旦您按下<code class="fe nd ne nf ng b">Button</code>，您应该会看到<code class="fe nd ne nf ng b">TextField</code>并能够调用我们的注册方法。AWS将向输入的电子邮件发送一个验证码，所以我们需要添加另一个方法来检查它，还需要一个<code class="fe nd ne nf ng b">TextField</code>来输入代码。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="0b9b" class="kw kx iq bd ky kz nq lb lc ld nr lf lg jw ns jx li jz nt ka lk kc nu kd lm ln bi translated">电子邮件确认</h1><p id="32e1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，我们需要更新我们的<code class="fe nd ne nf ng b">SignInViewController</code>并添加一个电子邮件确认方法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">已为确认更新SignInViewController</p></figure><p id="39f3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，在您的<code class="fe nd ne nf ng b">ContentView</code>中做相应的更改。这里我们在我们的<code class="fe nd ne nf ng b">if</code> / <code class="fe nd ne nf ng b">else</code>上添加另一个条件。如果我们在应用程序设置中存储了一封确认邮件，我们将显示一封确认邮件<code class="fe nd ne nf ng b">View</code>，让用户输入他们在邮件中收到的代码，并从<code class="fe nd ne nf ng b">SignInViewController</code>调用方法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带确认码的内容视图</p></figure><p id="4aed" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果我们运行这段代码，我们应该看到电子邮件被成功确认。这意味着电子邮件已被确认，但尚未登录，所以现在我们需要让用户登录。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="206c" class="kw kx iq bd ky kz nq lb lc ld nr lf lg jw ns jx li jz nt ka lk kc nu kd lm ln bi translated">使用经过验证的电子邮件登录</h1><p id="c063" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在让我们为我们的<code class="fe nd ne nf ng b">SignInViewController</code>添加一个最终方法，以便能够登录:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">已更新SignInViewController</p></figure><p id="acae" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们还需要一个Bool <code class="fe nd ne nf ng b">signInWithEmail</code>来显示当我们按下按钮时的登录文本字段以及对<code class="fe nd ne nf ng b">signInEmail</code>和<code class="fe nd ne nf ng b">signInPassword</code>的绑定。我们还需要向<code class="fe nd ne nf ng b">if</code> / <code class="fe nd ne nf ng b">else</code>添加另一个条件，以便它可以显示文本字段:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">内容视图</p></figure><p id="5305" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在你应该能够完成整个过程了:注册一个新的电子邮件，确认该电子邮件，然后用一个现有的电子邮件登录。</p><p id="095a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你想看看整个项目，请看<a class="ae kv" href="https://github.com/rolisanchez/swiftui-amplify-demo" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</p></div></div>    
</body>
</html>