<html>
<head>
<title>How to Save an HTML5 Canvas as an Image With .toDataURL()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将HTML5画布保存为图像？toDataURL()</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/saving-an-html5-canvas-as-an-image-with-todataurl-f9b7cb61595d?source=collection_archive---------2-----------------------#2020-06-24">https://betterprogramming.pub/saving-an-html5-canvas-as-an-image-with-todataurl-f9b7cb61595d?source=collection_archive---------2-----------------------#2020-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6eb6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">增强艺术应用及其他领域的交互性</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/814157c67da0ca06650a440c1657660b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FQG81QMGn64VTFRX.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个非常真实的画布，不要和数字的那种混淆。(图片来源:<a class="ae kv" href="https://www.jacksonsart.com/blog/2018/09/12/how-to-use-canvas-wedges-that-come-with-a-canvas-or-stretcher-bars/" rel="noopener ugc nofollow" target="_blank">杰克逊的艺术</a>)</p></figure><p id="07f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您已经创建了一个web应用程序，该应用程序使用HTML画布动态呈现某些内容，这些内容是自动生成的或基于用户输入生成的。太好了！你做了一件可爱的事情，给你的用户的浏览器窗口带来了一些令人眼花缭乱的东西。</p><p id="1a62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，假设您希望该用户(如果已登录)能够将画布保存到他们的个人资料中以供以后显示，或者匿名保存到您的应用程序的数据库中，或者以图像文件的形式保存到他们的计算机中。这正是<code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toDataURL" rel="noopener ugc nofollow" target="_blank">.toDataURL()</a></code>方法发挥作用的地方。</p><p id="6128" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">.toDataURL()</code>是一个内置于现代HTML5/JS浏览器生态系统中的方法，应该在网页上的画布元素上调用。它有两个参数:</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="73fb" class="ma mb iq lv b gy mc md l me mf"><em class="mg">canvas</em>.toDataURL(<strong class="lv ir"><em class="mg">type</em></strong>, <strong class="lv ir"><em class="mg">encoderOptions</em></strong>);</span></pre><ul class=""><li id="869d" class="mh mi iq ky b kz la lc ld lf mj lj mk ln ml lr mm mn mo mp bi translated"><code class="fe ls lt lu lv b">type</code>表示您希望画布保存的文件格式，默认为PNG。</li><li id="d2d6" class="mh mi iq ky b kz mq lc mr lf ms lj mt ln mu lr mm mn mo mp bi translated"><code class="fe ls lt lu lv b">encoderOptions</code>是一个介于0和1之间的数字，表示JPEG或WEBP等有损文件格式的图像质量。默认值为0.92，如果没有输入值，则使用该值。</li></ul><p id="86b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">.toDataURL()</code>方法的显著特点是，它不像我们最熟悉的那样将画布直接导出为图像文件，而是如其名称所示导出为<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" rel="noopener ugc nofollow" target="_blank">数据URL </a>。</p><p id="70bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图像上下文中的数据URL <strong class="ky ir">、</strong>实质上是以<a class="ae kv" href="https://en.wikipedia.org/wiki/Base64" rel="noopener ugc nofollow" target="_blank"> Base64 </a>编码的图像文件的二进制数据，显示为ASCII字符串。</p><p id="0acc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没错，这意味着你可以这样表现一幅图像:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/f9f6cf1cb3a737eddece4a82bfa8fa36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NvSJT2xIrLGcRZmx.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我能找到的最可爱的例子</p></figure><p id="783f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样的ASCII字符串:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/54b4260c11b3f40fc711353b44b108dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u_vfiD2qzEQ65gQmg7eIyA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">注意:这是一个真实的数据URL。真的。</p></figure><p id="2102" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很狂野，对吧？</p><p id="70af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于那些精通二进制数据在互联网上传输历史的人来说，这可能是常识，但当你第一次看到它时，会感到惊讶。这也是图像文件作为附件通过电子邮件发送的方式，也是图像在全球数据库中传输和存储的方式。</p><p id="59a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这正是我们试图用我们的应用程序做的事情！</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="26fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为上下文中的一个例子，我们将使用一个应用程序，这个应用程序是我和我的一个开发伙伴在今年早些时候的训练营中开发的。我们开发了一个名为<a class="ae kv" href="https://thefractal.zone/" rel="noopener ugc nofollow" target="_blank">分形区域</a>的应用程序，这是一个交互式网站，允许用户输入不同的规则集和值，并在画布上实时生成分形设计。松脆的东西！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/9f60d96c7baf34dab0923d8e410dd2e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YgWetKSU91JofRYNa8prCA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">是的，我们是疯狂的科学家。</p></figure><p id="ac83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们知道我们希望这些画布设计在我们的Rails后端数据库中持久化，但是需要找到一种方法来实现。我们使用PostgreSQL，我们知道我们不能直接在数据库中保存图像文件。又一次，救援来了。</p><p id="52b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的数据库模式中，我们为保存的分形设置了一个参数，类型为<code class="fe ls lt lu lv b">text</code>(一个超大字符串)，名称为<code class="fe ls lt lu lv b">image</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/06fbe8578ff6981082351b4165db7d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*os0-mHyoKuD3Y-ln7WGvQA.png"/></div></div></figure><p id="b2a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这使得我们可以通过在前端将画布编码为一个字符串来将它保存为一个图像。我们在一个保存按钮点击事件中调用的方法中这样做，就像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/fecd6c143a93e4947b66a5b9997f58c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5GoepJ-6zith-3bro6hOqg.png"/></div></div></figure><p id="91da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是全部了。我们所做的是:</p><ol class=""><li id="bec3" class="mh mi iq ky b kz la lc ld lf mj lj mk ln ml lr nh mn mo mp bi translated">在状态下，抓取变量<code class="fe ls lt lu lv b">currentCanvas</code>下的主画布。</li><li id="14e3" class="mh mi iq ky b kz mq lc mr lf ms lj mt ln mu lr nh mn mo mp bi translated">在画布下的Save按钮上放置一个click事件的监听器，这个监听器在被激活时调用<code class="fe ls lt lu lv b">saveFractal()</code>函数。</li><li id="c5e9" class="mh mi iq ky b kz mq lc mr lf ms lj mt ln mu lr nh mn mo mp bi translated">在<code class="fe ls lt lu lv b">currentCanvas</code>上调用<code class="fe ls lt lu lv b">.toDataURL()</code>并赋给另一个变量<code class="fe ls lt lu lv b">dataURL</code> <em class="mg">。</em></li><li id="71e4" class="mh mi iq ky b kz mq lc mr lf ms lj mt ln mu lr nh mn mo mp bi translated">将提取的<code class="fe ls lt lu lv b">dataURL</code>发布到我们后端服务器的<code class="fe ls lt lu lv b">image</code>参数下，将图像保存在我们的数据库中。</li></ol><p id="f83a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果我们通过Chrome将数据库呈现为JSON，我们可以看到这个数据URL的原始形式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/abd90ced0303936613d72d25db49b3a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JbyrHn2Xs5ELoDeT3k5PLQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这只是整个字符串的一小部分。数据URL实际上非常大，以至于它重载了JSON格式化扩展，所以我建议在开发过程中需要测试其他参数时不要序列化它。</p></figure><p id="e17f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们已经在后端数据库中成功地将画布持久化为一个以ASCII字符串表示的PNG。</p><p id="656b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是如果我们想在应用程序中重新呈现它呢？由于数据URL格式从技术上来说是一个URL，所以它与处理任何其他图像HTML标签的URL一样简单。</p><p id="b465" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到我们的前端，我们可以从数据库中获取一个保存的分形的数据，将数据URL赋给一个变量<code class="fe ls lt lu lv b">image</code>，并在页面上以卡片的形式呈现它，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/9e5da70e557661337e4b6ddddb1f75b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*72XxIYpp_fVwyMxwlXPsBg.png"/></div></figure><p id="7c7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧啊。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/0a03962bb0e204d0d71e32780b868f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a3K3Byle7BZGpjyBrQ9g7Q.png"/></div></div></figure><p id="5008" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">多亏了<code class="fe ls lt lu lv b">.toDataURL()</code>，我们现在已经成功地将HTML5画布导出、持久化、检索并呈现为图像。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="031c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一点，也是可能比将画布保存到数据库更有用的一点，是将画布作为图像直接导出并保存到用户硬盘的能力。这里我们将使用相同的概念，但执行起来略有不同。</p><p id="7262" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本质上，我们在前端所做的是创建一个带有下载属性和临时HREF属性的导出链接(一个<a>标签，尽管它可以被设计成一个按钮),并向它添加一个侦听器，该侦听器调用一个带有两个动作的函数:</a></p><ol class=""><li id="491f" class="mh mi iq ky b kz la lc ld lf mj lj mk ln ml lr nh mn mo mp bi translated">用<code class="fe ls lt lu lv b">.toDataURL()</code> <em class="mg">将画布设置为变量。</em></li><li id="144f" class="mh mi iq ky b kz mq lc mr lf ms lj mt ln mu lr nh mn mo mp bi translated">将链接的临时HREF更改为我们刚刚编码的数据URL。</li></ol><p id="b7b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看起来是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/1cdbe44171c2aa79aa0f404aed7a8df2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*g-OFX_z_H_tBOfVVABkrug.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/517ceb1f4aa6aa39495e8b08b2c30caa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tlFSEEz-cPJFJy5o26jmkg.png"/></div></div></figure><p id="a71c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单击此按钮将在您的浏览器中打开一个下载窗口，您分配给链接的下载属性的值是临时文件名，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/6ff10a5973208810fa8894fa27ff91f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-taNUxfF3Eg0V_RPnK8sWQ.png"/></div></div></figure><p id="08dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你完了！</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="c3bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您已经到了这一步，那么您已经学会了如何使用<code class="fe ls lt lu lv b">.toDataURL()</code> <em class="mg"> </em>的内置功能将HTML5画布保存为数据库中的编码字符串，并将其呈现在页面上，或者直接保存到用户的硬盘上。使用它可以为web应用程序增加一些很好的交互性和功能。</p><p id="b38c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>