<html>
<head>
<title>Python 3.10 is Released. Know What’s New and If It’s Worth the Switch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 3.10发布。知道什么是新的，是否值得更换</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/python-3-10-is-released-know-whats-new-and-if-it-s-worth-the-switch-19c7a5738f7c?source=collection_archive---------0-----------------------#2021-10-04">https://betterprogramming.pub/python-3-10-is-released-know-whats-new-and-if-it-s-worth-the-switch-19c7a5738f7c?source=collection_archive---------0-----------------------#2021-10-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6b3d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">类型注释、结构模式匹配、更好的错误消息和性能方面的改进</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f0fb89aa1c5736228cadf94bfe063752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SR9kv1wd0yHxk1ukW-yBOg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由来自pexels 的Vraj Shah <a class="ae ky" href="https://www.pexels.com/de-de/foto/rotes-autokopflicht-638479/" rel="noopener ugc nofollow" target="_blank">和来自pexels </a>的Mike <a class="ae ky" href="https://www.pexels.com/de-de/foto/graustufenfotografie-des-automotors-190574/" rel="noopener ugc nofollow" target="_blank">拍摄，由Martin Thoma编辑</a></p></figure><p id="5f8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 3.10 <a class="ae ky" href="https://www.python.org/downloads/release/python-3100/" rel="noopener ugc nofollow" target="_blank">根据<a class="ae ky" href="https://www.python.org/dev/peps/pep-0619/" rel="noopener ugc nofollow" target="_blank"> PEP 619 </a>于2021年10月4日</a>发布。让我们看看等待我们的是什么。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8464" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">键入注释</h1><p id="b89e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我绝对喜欢类型注释。从Python 3.6开始，它们超级有用。如果你还没有使用它们，我强烈推荐你阅读我的介绍。</p><p id="f2a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 3.10又对它们进行了改进！让我们看看如何</p><h2 id="a99d" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">TypeGuards:条件类型收缩</h2><p id="e7df" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">PEP 647 引入了一个新的TypeGuard注释。它是通过<a class="ae ky" href="https://pypi.org/project/typing-extensions/" rel="noopener ugc nofollow" target="_blank"> typing_extensions </a>反向移植的。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="1d58" class="mz md it nm b gy nq nr l ns nt">from typing_extensions import TypeGuard  # Before Python 3.10<br/>from typing import TypeGuard             # With Python 3.10</span></pre><p id="2c16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有TypeGuards，您不会发现这有什么问题:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="879b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是有了TypeGuard，你可以看到:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="eaed" class="mz md it nm b gy nq nr l ns nt">typeguard.py:17: error: TypedDict "User" has no key "x"</span><span id="37b2" class="mz md it nm b gy nw nr l ns nt">Found 1 error in 1 file (checked 1 source file)</span></pre><p id="6154" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整洁！现在你可以去掉几个<code class="fe nx ny nz nm b">cast</code>和<code class="fe nx ny nz nm b">assert</code>电话或者像<code class="fe nx ny nz nm b"># type: ignore</code>这样的评论。</p><h2 id="41cf" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">语法糖:允许将联合类型写成X | Y ✨</h2><p id="0b63" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://www.python.org/dev/peps/pep-0020/" rel="noopener ugc nofollow" target="_blank">可读性计数</a>。文档是我如此喜欢类型注释的原因。<a class="ae ky" href="https://www.python.org/dev/peps/pep-0604/" rel="noopener ugc nofollow" target="_blank"> PEP 604 </a>允许你使用更简洁、更易读的语法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="f76e" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">参数规范变量:装饰者的类型注释</h2><p id="6508" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">非平凡的装饰者一旦写出来就很难理解。编写类型注释相当困难。<a class="ae ky" href="https://www.python.org/dev/peps/pep-0612/" rel="noopener ugc nofollow" target="_blank"> PEP 612 </a>介绍<code class="fe nx ny nz nm b">typing.ParamSpec</code>和<code class="fe nx ny nz nm b">typing.Concatenate</code>。</p><p id="2205" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PEP已经为此树立了一个好榜样。假设您编写了一个装饰器<code class="fe nx ny nz nm b">add_logging</code>，它在被装饰的函数被调用之前执行了<code class="fe nx ny nz nm b">log_to_database</code>。该函数可以有任何参数—函数的执行不应改变。你会如何诠释？</p><p id="945f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于参数规范变量，您可以这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="8296" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还可以用decorators添加或移除参数。现在你可以添加适当的类型了！随便看看<a class="ae ky" href="https://www.python.org/dev/peps/pep-0612/" rel="noopener ugc nofollow" target="_blank"> PEP 612 </a>。</p><h2 id="8333" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">显式类型别名</h2><p id="a097" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://www.python.org/dev/peps/pep-0613/" rel="noopener ugc nofollow" target="_blank"> PEP 613 </a>介绍<code class="fe nx ny nz nm b">typing.TypeAlias</code>。这有助于类型检查器区分创建常数的模块级赋值和实际类型别名:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="7f8f" class="mz md it nm b gy nq nr l ns nt">StrCache: TypeAlias = 'Cache[str]'  # a type alias<br/>LOG_PREFIX = 'LOG[DEBUG]'  # a module constant</span></pre><p id="0754" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这有助于<code class="fe nx ny nz nm b">mypy</code>给出更好的错误信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e50a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结构模式匹配</h1><p id="f008" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">结构模式匹配是这么大的一个新特性，被多个PEP覆盖:<a class="ae ky" href="https://www.python.org/dev/peps/pep-0634/" rel="noopener ugc nofollow" target="_blank"> PEP 634 </a>(规范)<a class="ae ky" href="https://www.python.org/dev/peps/pep-0635/" rel="noopener ugc nofollow" target="_blank"> PEP 635 </a>(原理)<a class="ae ky" href="https://www.python.org/dev/peps/pep-0636/" rel="noopener ugc nofollow" target="_blank"> PEP 636 </a>(教程)！</p><p id="bddc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">教程中的一个例子很好地解释了这一点:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="7772" class="mz md it nm b gy nq nr l ns nt">match command.split():<br/>    case ["quit"]:<br/>        print("Goodbye!")<br/>        quit_game()<br/>    case ["look"]:<br/>        current_room.describe()<br/>    case ["get", obj]:<br/>        character.get(obj, current_room)<br/>    case ["go", direction]:<br/>        current_room = current_room.neighbor(direction)<br/>    # The rest of your commands go here</span></pre><p id="4224" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，新的关键词是<code class="fe nx ny nz nm b">match</code>和<code class="fe nx ny nz nm b">case</code>。比赛之后的部分才是被评价的。在这种情况下，<code class="fe nx ny nz nm b">command.spit()</code>返回一个字符串列表。结构模式匹配之前的等效代码是:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="633c" class="mz md it nm b gy nq nr l ns nt">val : List[str] = command.split()</span><span id="a2bc" class="mz md it nm b gy nw nr l ns nt">if val == ["quit"]:<br/>    print("Goodbye!")<br/>    quit_game()<br/>elif val == ["look"]:<br/>    current_room.describe()<br/>elif len(val) == 2 and val[0] == "get":<br/>    obj = val[1]<br/>    character.get(obj, current_room)<br/>elif len(val) == 2 and val[0] == "go":<br/>    direction = val[1]<br/>    current_room = current_room.neighbor(direction)</span></pre><p id="054c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，第一个例子更容易阅读。还有很多其他的例子——我推荐浏览一下<a class="ae ky" href="https://www.python.org/dev/peps/pep-0636/" rel="noopener ugc nofollow" target="_blank">这个教程</a>！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="77f0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更好的错误消息</h1><p id="5300" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Python 3.10改进了一些错误消息。这里只是两个例子，但还有更多:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/a42b9b405b540246f6f6c56018533a6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ws6meCi7NEPkbfZBv075ww.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/5ac2b96c66fed4229393a27950baa1b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R3tt6NFpLCSb6id553bbPA.png"/></div></div></figure><p id="331a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用了<a class="ae ky" href="https://stackoverflow.com/a/59507107/562769" rel="noopener ugc nofollow" target="_blank">彩色Python shell脚本</a>来突出显示。在终端，我使用ZSH和日晒深色主题。</p><h1 id="c578" class="mc md it bd me mf ob mh mi mj oc ml mm jz od ka mo kc oe kd mq kf of kg ms mt bi translated">表演</h1><p id="c84d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">比较性能总是很难。这很大程度上取决于你的工作量和你到底对什么感兴趣。一个明显的部分是启动时间。该解释器的启动速度比Python 3.8大约快10%。此外，Django模板的渲染也改进了不少。</p><p id="10d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 3.10将比3.9和3.8更快:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og nv l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og nv l"/></div></figure><p id="7f70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参见<a class="ae ky" href="https://speed.python.org/comparison/" rel="noopener ugc nofollow" target="_blank">官方速度对比</a>了解所有基准。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6f33" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何获得Python 3.10</h1><p id="1686" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作为一名开发人员，我喜欢使用<code class="fe nx ny nz nm b"><a class="ae ky" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank">pyenv</a></code>来获得我需要的Python版本:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="437f" class="mz md it nm b gy nq nr l ns nt">pyenv install 3.10.0<br/>pyenv local 3.10.0</span></pre><p id="d19c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想在生产环境中使用它，您会对<a class="ae ky" href="https://hub.docker.com/_/python" rel="noopener ugc nofollow" target="_blank"> Docker </a>感兴趣。基本映像是<code class="fe nx ny nz nm b">3.10</code>，但是当你在YAML ⚠️中写这个的时候要小心<code class="fe nx ny nz nm b">3.10</code>可能会被解释为浮点并被转换为<code class="fe nx ny nz nm b">3.1</code>。写<code class="fe nx ny nz nm b">"3.10"</code>在YAML。并且可能更具体，例如<code class="fe nx ny nz nm b">3.10-slim-bullseye</code>。</p><p id="8785" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对了:<a class="ae ky" href="https://www.pypy.org/download.html" rel="noopener ugc nofollow" target="_blank"> PyPy目前在3.7</a>AWS Lambda在3.9 。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="de27" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.10之前发生了什么？</h1><p id="df7e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">很多人还没有使用Python 3.9。因此，您可能会对Python 3.9甚至Python 3.8中引入的其他变化感兴趣:</p><div class="oh oi gp gr oj ok"><a href="https://python.plainenglish.io/killer-features-by-python-version-c84ca12dba8" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">Python版本的黑仔要素</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">了解当您支持旧的Python版本时，您错过了什么:Python 2.7到3.5、3.6、3.7、3.8和3.9</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">python .平原英语. io</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="637b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="6869" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Python 3.10太棒了！它有…</p><ul class=""><li id="194d" class="oz pa it lb b lc ld lf lg li pb lm pc lq pd lu pe pf pg ph bi translated">大大改进了类型注释</li><li id="1de3" class="oz pa it lb b lc pi lf pj li pk lm pl lq pm lu pe pf pg ph bi translated">结构模式匹配</li><li id="b581" class="oz pa it lb b lc pi lf pj li pk lm pl lq pm lu pe pf pg ph bi translated">更好的错误消息</li><li id="ad1c" class="oz pa it lb b lc pi lf pj li pk lm pl lq pm lu pe pf pg ph bi translated">更好的性能</li></ul><p id="ef07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关完整列表，请参见<a class="ae ky" href="https://docs.python.org/3.10/whatsnew/3.10.html" rel="noopener ugc nofollow" target="_blank">Python 3.10中的新特性</a>。</p></div></div>    
</body>
</html>