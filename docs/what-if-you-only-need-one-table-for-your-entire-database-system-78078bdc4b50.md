# 如果整个数据库系统只需要一个表，该怎么办？

> 原文：<https://betterprogramming.pub/what-if-you-only-need-one-table-for-your-entire-database-system-78078bdc4b50>

## 单表设计方法的剖析。有什么好的吗？

![](img/96e4f0b2f5348444b9f27ce3f1f6b9a6.png)

扎拉克汗在 [Unsplash](https://unsplash.com/s/photos/table?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片。

如果我告诉你你的系统只需要一张表会怎么样？如果你和我一样，有 SQL 查询和模式设计的经验，我打赌你会和我一样惊讶。

但是这实际上是在 NoSQL 类型的数据库中对数据库建模的推荐方式——尤其是在 DynamoDB 中。

今天，我将解释如何用一个表来设计一个系统，以及这个决定背后的理由。

# 告诉我更多

单表数据库设计正如其名。整个系统只有一个表。

但是它是如何工作的呢？不同的数据有非常不同的结构。

是的，没错。NoSQL 的美来了。顾名思义，这种类型的数据存储不需要严格的模式。你可以放任何你喜欢的东西。所以在同一个集合中，你可以把用户和产品**和**并排放在一起。

采用单表设计意味着将所有数据放在同一个表中，DynamoDB 不会对此有任何抱怨，因为它是无模式的键值对存储。

# 但是我怎么把数据拿回来呢？

这是有趣的部分。DynamoDB 对主键的概念有一种奇怪的理解。您将有两个密钥来标识特定数据:

```
Primary Key = Partition Key + Sort Key
```

为了指向特定的数据，我们可以做的是以这样一种方式设计我们的分区键，使得以后获取它们变得容易和可理解。

我们举个例子。我们有一个电子商务系统，需要存储产品、客户、订单等信息。为了存储这些数据，我们可以这样设计分区键:

```
 **ENTITY_TYPE      PARTITION_KEY (here 1234 is just a random id)** Product ->       PRODUCT#1234          
 Customer ->      CUSTOMER#1234    
 Order ->         ORDER#1234
```

因此，当您查询数据时，如果您想获得产品，您可以这样做:

```
Where PK = PRODUCT#1234 -> PK means Primary Key
```

如果你需要顾客，那也是一样:

```
Where PK = CUSTOMER#1234 
```

这样，通过使用分区键的概念，可以将多个表中的数据分割到一个表中。

# 关系呢？

这是一个很好的问题。在现实生活中，我们不只是将单个和离散的数据放入我们的系统。我们必须用一种特殊的方式把它们找回来。让我们回到前面的例子，试着理解我们在说什么。

## 现实生活场景

*   一位客户登录到系统，希望看到他们的订单。
*   订单需要知道包括哪些产品。
*   订单需要包含发票项目。

我们如何有效地解决这些问题？

在这个场景中，*排序键*的概念派上了用场。我们前面说过，一个条目的惟一性取决于主键和排序键的组合。

主键更多地用于逻辑划分数据，而排序键用于处理这些情况。让我们对订单进行建模，看看如何存储订单来检索这些查询:

```
 **PRIMARY_KEY**      **SORT_KEY      OTHER_INFO**1\.    ORDER#1234       PRODUCT#1     ProductName,Price etc2\.    ORDER#1234       INVOICE#1     InvoiceDate, PaymentInfo3\.    ORDER#1234       CUSTOMER#1    CustomerName, ShippingAddress
```

因此，现在如果我们想要获得特定订单的产品，我们可以利用查询函数`begins_with`:

```
Where PK = ORDER#1234 and begins_with( SK, PRODUCT# )
```

类似地，要获得一个产品的发票列表，我们可以这样做:

```
Where PK = ORDER#1234 and begins_with( SK, INVOICE# )
```

因此，我们必须牢记这一点，并相应地进行设计。要了解更多关于更复杂的查询，您可以查看这篇文章。

# 这种方法的好处是什么？

嗯，有几个好处。下面就来说说其中的一些。

## 获取多个数据的单一查询

使用 DynamoDB 进行多表设计的主要限制是一次只能查询一个表。如果您将您的`orders`和`ordered_produces`保存在不同的表中，您将需要查询两个表来获得一个订单的所有细节。

但是在单表设计中，您只需这样做:

```
where PK = ORDER#1234
```

这是一个很大的优势，也是单表设计背后的主要原因。

## 效率

在单表设计中，您可以通过 GSI(全局二级索引)的概念轻松处理复杂的访问模式。这样，您的查询会更高效。

## 谅解

单表设计更容易理解。乍一看，这可能令人望而生畏，但是如果您只有一个表，那么您就不必担心大量不同的主键和排序键以及它们是如何工作的。你将只有一个地方去了解它的全部。

# 那么这一切都是阳光和玫瑰吗？

不，绝对不行。这种方法有许多缺点。第一个是它有一个非常陡峭的学习曲线。也许我们会在另一篇文章中讨论这些缺点。

我仍然不相信这是正确的做法，但这确实是一个非常有趣的想法。请在评论中告诉我你的想法。

祝您愉快！

**通过**[**LinkedIn**](https://www.linkedin.com/in/56faisal/)**或我的** [**个人网站**](https://www.mohammadfaisal.dev/) **与我取得联系。**