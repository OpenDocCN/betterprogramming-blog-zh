<html>
<head>
<title>What is the Dependency Injection Design Pattern?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是依赖注入设计模式？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/dependency-injection-8f09a93ec995?source=collection_archive---------7-----------------------#2019-10-02">https://betterprogramming.pub/dependency-injection-8f09a93ec995?source=collection_archive---------7-----------------------#2019-10-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4f3a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">依赖注入确保我们的代码尽可能灵活、可测试、易于修改</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6bbd092f275d6cf1f85a4cf81b73358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*To8F0TFNFi7Jc8cTOzSJbQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@pawel_czerwinski?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">paweczerwiński</a>在<a class="ae ky" href="https://unsplash.com/s/photos/injection?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="8654" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们正在开发处理用户注册的应用程序的一部分。我们创建了一个负责与数据库通信的类。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="f465" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个处理与用户注册相关的逻辑。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="a0c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">乍一看，一切似乎都很好。但是随着应用程序开始增长，我们将面临许多问题:</p><ul class=""><li id="490d" class="lx ly it lb b lc ld lf lg li lz lm ma lq mb lu mc md me mf bi translated"><code class="fe mg mh mi mj b">User</code>与<code class="fe mg mh mi mj b">UserStorage</code>耦合非常严格。<code class="fe mg mh mi mj b">UserStorage</code>实施过程中的任何变化都可能直接影响<code class="fe mg mh mi mj b">User</code>。我们的代码打破了依赖倒置原则(来自<a class="ae ky" href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod" rel="noopener ugc nofollow" target="_blank"> SOLID </a>)。</li><li id="8f69" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated">如果<code class="fe mg mh mi mj b">UserStorage</code>的初始化需要任何额外的工作或依赖，那么<code class="fe mg mh mi mj b">User</code>将负责提供。这样我们就违反了单一责任原则。</li><li id="4278" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated">编写测试将变得更加困难。</li></ul><p id="541a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为这样一个类编写单元测试并非不可能，但是我们真的很难在<code class="fe mg mh mi mj b">register</code>方法中模仿<code class="fe mg mh mi mj b">User</code>的初始化。</p><p id="92ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们不模仿它，每次运行测试时，它都会连接并向数据库中插入一些东西。这不是一个好的做法。</p><p id="645f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种方法是在构造函数中传递<code class="fe mg mh mi mj b">User</code>实例。在这种情况下，嘲讽真的很容易，我们的代码可以更加独立于<code class="fe mg mh mi mj b">UserStorage</code>中的变化。</p><p id="7569" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个极简界面，这样<code class="fe mg mh mi mj b">User</code>现在将依赖于抽象(<code class="fe mg mh mi mj b">Storage</code>)而不是具体的实现(<code class="fe mg mh mi mj b">UserStorage</code>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="9046" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mg mh mi mj b">User</code>变得更加独立，不需要关心<code class="fe mg mh mi mj b">UserStorage</code>中的实现细节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="5722" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编写单元测试现在是一种真正的乐趣。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="5879" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">依赖注入是对一项非常简单的工作的一种奇特表达。我们只是传递对象，而不是直接初始化它。最简单的方法是将其放入构造函数中，但也有其他流行的解决方案:</p><ul class=""><li id="843b" class="lx ly it lb b lc ld lf lg li lz lm ma lq mb lu mc md me mf bi translated">通过setter方法传递具体的实现</li><li id="0207" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated">为依赖关系使用外部<a class="ae ky" href="https://stackoverflow.com/questions/50718586/what-is-a-di-container" rel="noopener ugc nofollow" target="_blank">容器</a></li><li id="74e6" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated">使用<a class="ae ky" href="https://en.wikipedia.org/wiki/Service_locator_pattern" rel="noopener ugc nofollow" target="_blank">服务定位器模式</a>(不推荐)</li></ul><p id="3deb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最流行的PHP框架也有自己的依赖注入实现(例如<a class="ae ky" href="https://laravel.com/docs/5.8/container" rel="noopener ugc nofollow" target="_blank"> Larvel </a>，<a class="ae ky" href="https://www.yiiframework.com/doc/guide/2.0/en/concept-di-container" rel="noopener ugc nofollow" target="_blank"> Yii 2 </a>)。<a class="ae ky" href="http://php-di.org" rel="noopener ugc nofollow" target="_blank"> PHP-DI </a>也是一个很有意思的项目。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="5cd4" class="mw mx it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">优势</h1><ul class=""><li id="d14a" class="lx ly it lb b lc no lf np li nq lm nr lq ns lu mc md me mf bi translated">使代码更易测试</li><li id="4185" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated">使代码更加灵活，耦合度更低</li></ul></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="4a79" class="mw mx it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">源代码</h1><p id="3470" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">完整的源代码和其他一些模式可以在这里找到:</p><div class="nw nx gp gr ny nz"><a href="https://github.com/jkapuscik2/design-patterns-php" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">jkapuscik 2/设计-模式-php</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">这个项目是一组在现实世界中使用不同设计模式的简单例子。每个人都有一个…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on ks nz"/></div></div></a></div></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><p id="737f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想了解一些更有用的设计模式，您可以在以下文章中找到它们:</p><ul class=""><li id="6a4a" class="lx ly it lb b lc ld lf lg li lz lm ma lq mb lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/getting-started-with-design-patterns-in-php-4d451ccdfb71" rel="noopener">工厂方法</a></li><li id="bf9d" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/creational-design-patterns-in-php-db365d3245ce" rel="noopener">创作模式</a></li><li id="e6df" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/observer-pattern-in-php-2ba240f89fb2" rel="noopener">观察者</a></li><li id="d274" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/iterator-pattern-in-php-b7624f6bdbcf" rel="noopener">迭代器</a></li><li id="e883" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/state-strategy-design-patterns-by-example-f57ebd7b6211" rel="noopener">状态&amp;策略</a></li><li id="33ac" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/template-method-pattern-in-php-6116fd7e8ccc?source=friends_link&amp;sk=ac4c483446bd5a5323c09a662bd54116" rel="noopener">模板法</a></li><li id="10d6" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/swlh/flyweight-design-pattern-in-php-edcda0486fb0?source=friends_link&amp;sk=a0fa3083d5afd7e41af8a4f7a1df05f1" rel="noopener">飞锤</a></li><li id="d8a1" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/better-programming/proxy-design-pattern-and-how-to-use-it-acd0f11e5330" rel="noopener">代理</a></li><li id="18e9" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/better-programming/decorator-c04fae63dfff" rel="noopener">装饰工</a></li><li id="df7c" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/swlh/composite-908878748d0e" rel="noopener">复合</a></li><li id="a345" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/swlh/building-cloud-storage-application-with-adapter-design-pattern-8b0105a1bda7" rel="noopener">适配器</a></li><li id="2cf8" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/better-programming/what-is-facade-design-pattern-67cb09ce35d4" rel="noopener">立面</a></li><li id="6099" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/better-programming/what-is-bridge-design-pattern-89bfa581fbd3" rel="noopener">桥</a></li><li id="78a4" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/what-is-chain-of-responsibility-design-pattern-ff4d22abd124" rel="noopener">责任链</a></li><li id="0cd1" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/what-is-visitor-design-pattern-8451fb75876" rel="noopener">访客</a></li><li id="22d3" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/what-is-cqrs-command-design-pattern-5d400fd9f93a" rel="noopener">命令</a></li><li id="ce0b" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/what-is-null-object-design-pattern-f3b4d3d28636" rel="noopener">空对象</a></li><li id="1eca" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/what-is-the-fluent-interface-design-pattern-2797645b2a2e" rel="noopener">流畅的界面</a></li><li id="c38e" class="lx ly it lb b lc mk lf ml li mm lm mn lq mo lu mc md me mf bi translated"><a class="ae ky" href="https://medium.com/@j.kapuscik2/what-is-the-specification-design-pattern-4051dd9e71c3" rel="noopener">规格</a></li></ul></div></div>    
</body>
</html>