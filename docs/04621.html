<html>
<head>
<title>JavaScript Best Practices for Writing More Robust Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写更健壮代码的JavaScript最佳实践</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/javascript-best-practices-for-writing-more-robust-code-device-checks-132729345007?source=collection_archive---------13-----------------------#2020-04-24">https://betterprogramming.pub/javascript-best-practices-for-writing-more-robust-code-device-checks-132729345007?source=collection_archive---------13-----------------------#2020-04-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e424" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">设备检查、网络连接状态和功能可用性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d18fbe7fc7ed33dfc82409f487212775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bv4KgL__dHofEIMs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@davidclode?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> David Clode </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="d8fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JavaScript是一种容易学习的编程语言。编写运行并执行某些操作的程序很容易。然而，很难考虑所有用例并编写健壮的JavaScript代码。</p><p id="22bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将看看如何检查设备类型和状态，以确保我们的应用程序降级。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d72f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设备类型检查</h1><p id="4dae" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们应该检查设备的类型，看看应该启用哪些功能。这很重要，因为网络应用不再只在台式机和笔记本电脑上运行。</p><p id="2b8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们不得不担心各种操作系统的移动设备。</p><p id="97c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从浏览器的用户代理检查设备类型。全局<code class="fe mz na nb nc b">navigator</code>对象具有包含用户代理的<code class="fe mz na nb nc b">userAgent</code>属性，该属性将操作系统信息作为用户代理字符串的一部分。</p><p id="1599" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以如下使用它:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="3720" class="nh md it nc b gy ni nj l nk nl">const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)</span></pre><p id="da0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们检查了移动操作系统的用户代理字符串中所有可能的子字符串。我们最关心的是Android、iPad和iPhone，但是测试其他的并不难。</p><p id="e689" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很容易欺骗用户代理字符串，使我们的浏览器伪装成其他东西。然而，大多数人不会这样做，也没有太多的理由让其他人这样做，所以检查设备是否是移动设备并采取相应行动仍然是一个好方法。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8e5b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">检查网络连接状态</h1><p id="3923" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">像检查用户代理一样，检查网络连接状态也很重要，因为很多设备随时都可能离线。</p><p id="830e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">移动设备在快速和慢速网络之间移动，或者移动到没有手机信号接收的地方。因此，我们必须检查这一点，以便当设备离线时，我们的应用程序能够优雅地失败。</p><p id="ea80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在大多数浏览器都支持网络信息API，所以我们可以很容易地用它来检查网络状态。</p><p id="b3f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以按如下方式检查网络连接类型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="214b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们只是用<code class="fe mz na nb nc b">connection</code>、<code class="fe mz na nb nc b">mozConnection</code>或<code class="fe mz na nb nc b">webkitConnection</code>属性检索连接类型，以获得初始连接对象。</p><p id="375f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们使用来自<code class="fe mz na nb nc b">connection</code>对象的<code class="fe mz na nb nc b">effectType</code>属性来获取有效的网络类型。</p><p id="2cb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们向<code class="fe mz na nb nc b">connection</code>对象添加一个<code class="fe mz na nb nc b">change</code>事件监听器来监视连接类型的变化。</p><p id="9cea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，我们不需要做太多就可以观察到互联网连接类型的变化。所以，我们绝对应该这么做。</p><p id="7bbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们从Chrome中的network选项卡更改网络连接类型，以模拟网络连接类型的更改或在现实生活中更改网络连接类型，我们应该会看到如下控制台日志输出:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="8f52" class="nh md it nc b gy ni nj l nk nl">4g to 2g<br/>2g to 4g<br/>4g to 4g</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1d88" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">检查功能可用性</h1><p id="5e39" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">默认情况下，不同的浏览器可能有不同的功能。在实现任何功能之前，我们应该检查浏览器是否支持我们想要的功能。</p><p id="3553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在使用可能不支持的库之前，我们可以使用<a class="ae ky" href="https://caniuse.com/" rel="noopener ugc nofollow" target="_blank">来检查浏览器是否支持某个功能。</a></p><p id="6785" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有<a class="ae ky" href="https://github.com/Modernizr/Modernizr" rel="noopener ugc nofollow" target="_blank"> Modernizr库</a>来检测给定浏览器中可用的特性。</p><p id="f82f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过添加一个脚本标签来安装Modernizr:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="6157" class="nh md it nc b gy ni nj l nk nl">&lt;script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"&gt;&lt;/script&gt;</span></pre><p id="bddc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它附带了一些类，我们可以使用这些类根据某些东西是否可用来打开或关闭HTML元素。</p><p id="06fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，它附带了<code class="fe mz na nb nc b">cssgradients</code>和<code class="fe mz na nb nc b">no-cssgradients</code>类，让我们分别为CSS渐变可用和不可用的情况添加不同的样式。</p><p id="3567" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装Modernizr后，我们可以在CSS代码中执行以下操作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="e7e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们为CSS渐变功能不可用的情况提供了一个后备图像，就像在<code class="fe mz na nb nc b">.no-cssgradients header</code>选择器中的情况一样。</p><p id="569a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mz na nb nc b">.cssgradients header</code>选择器中我们有正常的CSS渐变。</p><p id="cc75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以添加自己的测试功能，比如在添加上面的脚本标记后检查jQuery是否可用:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="a740" class="nh md it nc b gy ni nj l nk nl">window.Modernizr.addTest("hasJquery", "jQuery" in window);</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8e87" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="3312" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们应该使用用户代理来检查设备类型。尽管它很容易被欺骗，但大多数人不会这样做，因为它没有提供多少好处。</p><p id="e5ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们应该使用许多现代浏览器支持的网络信息API来检查设备的连接状态。</p><p id="6b4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们应该在使用Modernizr之前检查是否有特定的库或特性可用，以及我是否可以使用它。</p></div></div>    
</body>
</html>