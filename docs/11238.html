<html>
<head>
<title>Implement Google Tag Manager (GTM) in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React Native中实现Google Tag Manager (GTM)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implement-google-tag-manager-gtm-in-react-native-c7b6d44a0fcd?source=collection_archive---------6-----------------------#2022-03-01">https://betterprogramming.pub/implement-google-tag-manager-gtm-in-react-native-c7b6d44a0fcd?source=collection_archive---------6-----------------------#2022-03-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e25c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何将GTM与其他第三方分析相集成</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c1c220a6557c0b207cf7d1c1eb3ba50d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K8KnnF2QZ7RRNPmS"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Pawel Czerwinski 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3017" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">分析是安装在应用程序中的重要内容之一，因此我们可以改进我们的功能，或者通过了解用户的行为来建立一个对用户重要的功能。很难找到的一个资源是在react native apps中实现google tag manager。</p><p id="e1a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将解释如何在react native apps中实现google tag manager，并将其与<a class="ae kv" href="https://amplitude.com/" rel="noopener ugc nofollow" target="_blank"> Amplitude </a>集成，作为如何与其他第三方分析集成的示例。</p><h1 id="a2b6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">GTM在移动领域的工作方式</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/0f4619c8010e35d276d63fc926f12002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v8QgJWmdETIyv9qBCSlM_g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GTM如何在移动应用中工作的一般流程</p></figure><p id="508b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了利用GTM，我们需要firebase analytics来调用发送事件和参数的函数。GTM不会从移动应用程序收集数据分析。GTM的角色是组织来自应用程序的分析流量，以便与其他第三方分析整合。流量由JSON文件组织，该文件包含将分析数据发送到何处以及如何发送的映射。JSON文件将在第一次安装时下载，并放在应用程序的特定路径中。下一次在GTM仪表板中有更新时，GTM已经有了一个为所有用户设备分发和更新JSON文件的机制。</p><h1 id="3839" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">先决条件</h1><ul class=""><li id="cf19" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated">安装firebase analytics。你可以使用<a class="ae kv" href="https://rnfirebase.io/" rel="noopener ugc nofollow" target="_blank">react-native-firebase analytics</a>。按照链接中的说明进行安装。</li><li id="2961" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">在此创建一个谷歌标签管理员账户<a class="ae kv" href="https://tagmanager.google.com/" rel="noopener ugc nofollow" target="_blank"/></li><li id="3eb6" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">配置谷歌标签管理器容器。你可以跟着<a class="ae kv" href="https://support.google.com/tagmanager/answer/6103696#CreatingAnAccount" rel="noopener ugc nofollow" target="_blank">到这里</a></li></ul><h1 id="5228" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">安装谷歌标签管理器的步骤</h1><p id="57c6" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">GTM仍然不支持react-native的SDK。所以安装会在各个原生代码中完成，iOS和Android。</p><ul class=""><li id="be2e" class="ml mm iq ky b kz la lc ld lf ne lj nf ln ng lr ms mt mu mv bi translated">安装谷歌标签管理依赖，并把容器文件在android中。遵循本指令</li><li id="96d3" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">安装谷歌标签管理器依赖项，并将容器文件放入iOS。遵循本指令。</li></ul><h1 id="af66" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">与其他第三方分析集成的步骤(例如:振幅)</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/2c413852f734581c41505b1bc966653d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jf33AyhTrzioeCQQal-K_A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">要与其他第三方分析应用程序集成的标签类型列表</p></figure><p id="151f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在GTM仪表板中创建标签时会发生集成。当您单击导航抽屉标签&gt;按钮新建&gt;单击标签配置时，会出现一个您可以集成的第三方分析应用程序列表。有些需要SDK安装，有些不需要。如果您找不到任何想要集成的分析应用程序，您总是可以通过在本机代码中创建自定义提供程序(触发时要调用的函数的代码)来进行自己的集成，然后在仪表板中创建自定义的<code class="fe ni nj nk nl b">Function Call</code>标记，将代码函数的路径放在<code class="fe ni nj nk nl b">Class Path</code>中，并定义想要发送的数据的键值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/81a097ca297a0589dddf2df5b98eaa2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6V7Yx8_Rm-U7BL_zRMvZAg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带有标签类型函数调用的标签配置</p></figure><p id="c999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于<code class="fe ni nj nk nl b">class path</code>的几点建议</p><ul class=""><li id="04ff" class="ml mm iq ky b kz la lc ld lf ne lj nf ln ng lr ms mt mu mv bi translated">对于android，<code class="fe ni nj nk nl b">Class Path</code>是您的自定义提供程序文件的路径。例如，如果你在这个路径下创建文件`<code class="fe ni nj nk nl b">android/app/src/main/java/com/yourapp/GTMAmplitudeProvider.java</code>，<code class="fe ni nj nk nl b">Class Path</code>应该是<code class="fe ni nj nk nl b">com.yourapp.GTMAmplitudeProvider</code></li><li id="238e" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">对于iOS <code class="fe ni nj nk nl b">Class Path</code>，只需输入文件名. m，那么对于<code class="fe ni nj nk nl b">GTMAmplitudeProvider.m</code>，只需输入<code class="fe ni nj nk nl b">GTMAmplitudeProvider</code></li></ul><p id="2a92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">振幅有一个固有的SDK。但是为了利用GTM，我们应该安装本地SDK，因为要管理的流量是从本地代码引用的(在android或iOS中)。在本文中，我只向您展示了如何创建自定义提供程序的一般想法，而没有进一步解释当您想要使用分析包时如何初始化实例，因为它在所有第三方分析包之间有所不同，只需遵循文档即可。</p><p id="f593" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是与android集成的步骤</p><ul class=""><li id="f729" class="ml mm iq ky b kz la lc ld lf ne lj nf ln ng lr ms mt mu mv bi translated">用<a class="ae kv" href="https://developers.amplitude.com/docs/android#sdk-installation" rel="noopener ugc nofollow" target="_blank">安装振幅本指令为android </a>安装依赖项，添加权限，并初始化。</li><li id="0861" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">在此路径<code class="fe ni nj nk nl b">android/app/src/main/java/com/yourapp</code>中创建提供者java文件，例如<code class="fe ni nj nk nl b">GTMAmplitudeProvider</code>。</li><li id="4ee0" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">一般来说，第一个被调用的函数是<code class="fe ni nj nk nl b">execute</code>，输入参数<code class="fe ni nj nk nl b">map</code>是在dashboard中创建标签时定义的对象键值。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="3dda" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是与iOS集成的步骤</p><ul class=""><li id="1691" class="ml mm iq ky b kz la lc ld lf ne lj nf ln ng lr ms mt mu mv bi translated">使用本指令安装振幅，使用Cocoapod进行安装和初始化。</li><li id="9101" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">使用Xcode IDE创建文件<code class="fe ni nj nk nl b">GTMAmplitudeProvider.h</code>和<code class="fe ni nj nk nl b">GTMAmplitudeProvider.m</code></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="e310" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在安装了本机依赖项并创建了自定义提供程序之后，尝试使用javascript中的firebase analytics创建一个事件，并创建使用我们刚刚创建的自定义提供程序的标记。就是这样！</p><h1 id="789e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">提示和技巧</h1><ul class=""><li id="4568" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated">当您与其他第三方分析应用程序集成时，您必须知道的第一件事是调用什么函数来调用发送分析。一些应用程序需要你在发送数据之前先创建一个类对象，一些应用程序需要你调用精确的函数来进行精确的事件跟踪(例如:需要调用函数<code class="fe ni nj nk nl b">trackPurchase</code>来跟踪购买)</li><li id="a217" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">如果您使用自定义提供程序，在Android Studio或Xcode中编码会更容易，因为我们将在这里编写本机代码，并且那些IDE支持自动导入，如果我们的代码中有一些错误，会进行标记。</li><li id="0a7a" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">你可以随时<code class="fe ni nj nk nl b">console.log</code>调试一切。在android java中，你可以使用<code class="fe ni nj nk nl b">Log.d</code>，在iOS中，你可以使用<code class="fe ni nj nk nl b">NSLog</code>。要查看日志，我更喜欢使用flipper，这样你就不需要从多个应用程序中查看日志。</li><li id="c9c1" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">当您集成新的第三方应用程序时，用最新版本更新您代码中的容器JSON。</li><li id="83f7" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">对于其他第三方分析应用程序，如果您想要使用一些必须在javascript端调用的函数，请检查软件包是否已经安装了本机依赖项。如果您需要访问本机依赖项，也许您必须强制手动安装，以便您可以从本机代码访问它。</li><li id="3d6c" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">您可以通过在前面的路径中创建一个类似于<code class="fe ni nj nk nl b">GTMClass</code>的文件夹并将所有自定义提供程序放在那里来更好地组织。</li><li id="fc4c" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">您可以通过为一个第三方应用程序创建一个提供程序来组织提供程序文件(例如:提供程序包含trackEvent、trackUserProperties)，或者为第三方应用程序的一个功能创建一个提供程序(例如:提供程序仅包含trackEvent)。</li></ul><h1 id="8ad9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">充当故障检修员</h1><ul class=""><li id="14d4" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated">当您的CustomProvider文件被触发时没有被调用，可能是容器JSON没有更新或者在您使用<a class="ae kv" href="https://developers.google.com/tag-platform/tag-manager/android/v5#preview_container" rel="noopener ugc nofollow" target="_blank">预览模式</a>时更新失败。你可以查看设备日志(我更喜欢使用flipper)</li></ul></div></div>    
</body>
</html>