<html>
<head>
<title>Slick Like Ruby, Fast Like C — Does Such a Language Exist?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像Ruby一样流畅，像C一样快速——这样的语言存在吗？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/slick-like-ruby-fast-like-c-does-such-a-language-exist-9066fc16e6f1?source=collection_archive---------4-----------------------#2020-02-11">https://betterprogramming.pub/slick-like-ruby-fast-like-c-does-such-a-language-exist-9066fc16e6f1?source=collection_archive---------4-----------------------#2020-02-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b311" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">是的，是的，它是</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/10428fe027cc610a627acd782659ee83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfOreEtmEEbYo6Gmx8Ov1Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">rawpixel.com创建的背景向量—<a class="ae ky" href="http://www.freepik.com" rel="noopener ugc nofollow" target="_blank">www.freepik.com</a></p></figure><p id="67d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我永无止境地寻找做事速度(开发速度)和做事速度(性能)之间的和谐的过程中，我遇到了一个处于孵化阶段的项目，它让我思考:“这可能是一种适合我的语言。”</p><p id="4720" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对为人类和计算机设计的编程语言<a class="ae ky" href="https://crystal-lang.org/" rel="noopener ugc nofollow" target="_blank"> Crystal </a>一见钟情。多么崇高的事业。作为Ruby语法之美的粉丝，类似Ruby的语法和C语言的速度的前景非常吸引人——甚至改变了生活。</p><p id="00fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从那天起，我就一直密切关注着Crystal的进展，今天，我将为您解释为什么您应该关注它。老实说，它是最激动人心的语言之一，有着巨大的潜力。</p><p id="1d28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始之前，请记住Crystal还没有准备好投入生产，但是你仍然可以找到许多已经在使用它的项目——比如用Crystal编写的<a class="ae ky" href="https://github.com/mperham/sidekiq.cr" rel="noopener ugc nofollow" target="_blank">这个版本的Sidekiq </a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f68f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么是水晶？</h1><p id="29c5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">那么，为什么有人会关心另一种编程语言呢？嗯，因为Crystal结合了令人难以置信的令人信服的成分，这在许多其他语言中是找不到的。</p><h2 id="ab23" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">漂亮的语法</h2><p id="8faf" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Crystal最吸引人的地方之一是清晰易读的类似Ruby的语法。这种语言的创造者理解Ruby作为视觉上最吸引人的语言之一的吸引力，并把它作为Crystal的灵感来源。</p><p id="8d94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，如果你来自Ruby世界，过渡到Crystal会很简单。大多数时候，你可以直接在Crystal中运行Ruby代码，或者在Ruby shell中运行Crystal程序。</p><p id="9150" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更重要的是，你甚至可以在Crystal中使用Ruby语法高亮。与大多数解释语言相似，Crystal将让你用几行代码构建你最疯狂的想象。</p><h2 id="94e6" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">极快的性能</h2><p id="0aff" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Crystal是一种静态编译的语言，建立在受人尊敬的LLVM框架之上，可以抵御C、<a class="ae ky" href="http://www.cplusplus.com/" rel="noopener ugc nofollow" target="_blank"> C++ </a>和<a class="ae ky" href="https://www.rust-lang.org/" rel="noopener ugc nofollow" target="_blank"> Rust </a>之类的语言。</p><p id="4ac4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们稍微理解一下Ruby语法的开发速度与C……</p><p id="949d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这非常有说服力，希望你能像我第一次听到这个说法时一样兴奋。不相信我？只需查看一些最新的基准测试；<a class="ae ky" href="https://github.com/tbrand/which_is_the_fastest" rel="noopener ugc nofollow" target="_blank">这个基准</a>和<a class="ae ky" href="https://github.com/drujensen/fib" rel="noopener ugc nofollow" target="_blank">这个基准</a>。</p><h2 id="7754" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">通过简单的C绑定实现超高性能</h2><p id="8f6d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果应用程序或算法的一部分需要极高的性能，一种策略是将功能卸载到C扩展或库。</p><p id="7e89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Crystal，无需编写一行C代码就可以绑定到现有的C库或您自己的C库。</p><p id="bb7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑一个C库<code class="fe nl nm nn no b">hello.c</code>的简单例子，我们可以使用GCC编译器<code class="fe nl nm nn no b">gcc -c hello.c -o hello.o</code>来构建它。</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="6ba9" class="mz md it no b gy nt nu l nv nw">#include &lt;stdio.h&gt;</span><span id="bf11" class="mz md it no b gy nx nu l nv nw">void hello(const char * name){<br/>  printf("Hello %s!\n", name);<br/>}</span></pre><p id="51c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建二进制文件后，您可以使用<code class="fe nl nm nn no b">Link</code>轻松地链接二进制文件，并定义<code class="fe nl nm nn no b">lib</code>声明，该声明将属于该库的函数和类型分组，然后调用您的函数。瞧啊。</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="5076" class="mz md it no b gy nt nu l nv nw">#hello.cr</span><span id="2220" class="mz md it no b gy nx nu l nv nw">@[Link(ldflags: "#{__DIR__}/hello.o")]</span><span id="e42b" class="mz md it no b gy nx nu l nv nw">lib Say <br/>  fun hello(name : LibC::Char*) : Void<br/>end</span><span id="ebd1" class="mz md it no b gy nx nu l nv nw">Say.hello("your name")</span></pre><h2 id="a882" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">静态打字</h2><p id="1066" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Crystal是一种静态类型语言，允许它在编译时排除许多与类型相关的错误，并为优化做好准备，这在动态类型语言如Ruby或Python中是不可能的。</p><p id="f07f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这直接有助于Crystal的性能，更令人印象深刻的是，Crystal中的编译器只要求您在不明确的情况下显式指定类型——其余时间您可以像使用任何动态语言一样使用它。</p><h2 id="08de" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">宏指令</h2><p id="2e30" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">宏是一种修改抽象语法树的方法，它是在编程语言的符号化和解析阶段创建的，允许我们在编译时添加方法或者创建和修改类。</p><p id="5c26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做的主要优势是速度——因为您节省了编译器调用函数所花费的大量时间。</p><p id="2f77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在编写宏时，Crystal允许您使用大部分语言，这意味着您可以完成在静态编译语言中通常闻所未闻的疯狂的魔术。</p><h2 id="f961" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">Web框架</h2><p id="a489" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果不谈论该语言中可用的web框架，任何比较都是不完整的，如果你已经爱上了Rails和<a class="ae ky" href="https://github.com/phoenixframework/phoenix" rel="noopener ugc nofollow" target="_blank">Phoenix</a>——你会对Crystal的web框架<a class="ae ky" href="https://amberframework.org/" rel="noopener ugc nofollow" target="_blank"> Amber </a>感到如鱼得水。</p><p id="b50d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它完全是按照Rails设计的，但显然比Rails快一个数量级——加载时间以微秒计，而不是以毫秒计。</p><p id="c72e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你属于辛纳特拉爱好者的阵营，不要害怕，因为你已经得到了<a class="ae ky" href="https://kemalcr.com/" rel="noopener ugc nofollow" target="_blank">凯末尔</a>框架的简单性。</p><p id="52aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我提到过Crystal的内置HTTP服务器在基准测试中每秒能够处理超过<a class="ae ky" href="https://www.techempower.com/benchmarks/previews/round15/#section=data-r15&amp;hw=ph&amp;test=plaintext&amp;l=zdk8an&amp;c=3" rel="noopener ugc nofollow" target="_blank">200万个请求吗？大多数框架也为web应用程序提供了亚毫秒级的响应时间。</a></p><h2 id="5cd4" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">并发</h2><p id="c9bc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Crystal目前以一等公民的身份支持并发性，而并行性正在逐步提升——你可以在Crystal网站上了解它的进展<a class="ae ky" href="https://crystal-lang.org/2019/09/06/parallelism-in-crystal.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c203" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Crystal使用<em class="ny">纤程</em>支持并发——一个轻量级的操作系统线程。不像线程那样先发制人，纤程明确地告诉运行时调度程序何时切换上下文。这有助于Crystal避免不必要的上下文切换。</p><p id="bcd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想增加并发性，你会发现Crystal中的<code class="fe nl nm nn no b">spawn</code>方法类似于Go<a class="ae ky" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank">Go</a>中goroutines的用法——我个人非常喜欢这种用法。</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="a134" class="mz md it no b gy nt nu l nv nw"># Simple example<br/>spawn do <br/>  sleep 5.seconds <br/>end</span></pre><p id="2df5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Crystal还支持受CSP启发的通道，允许在光纤之间传输数据，无需共享内存，也不必担心锁或信号量。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0958" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">但是等等，有什么不喜欢的？</h1><p id="b95d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作为软件工程师，我们总是在选择编程语言或框架时进行权衡，就像任何语言一样，Crystal不是您所有祈祷的答案，它有自己的局限性。</p><ul class=""><li id="46e5" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">Crystal仍然相对年轻和不成熟，这导致在这个特定的时间点缺乏社区和软件包。</li><li id="a7ed" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">这也导致了可用开发工具的稀缺，即使它们很容易获得。</li><li id="4664" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">如果你的目标是做一些难以置信的具体的事情，你会很难找到文档，但这只是意味着我们有机会成为第一批采用者，一起黑客很酷的项目。</li><li id="2dac" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">尽管Crystal内置了并发性，但并行性仍然是一等公民。</li><li id="5d1a" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">由于该语言的预生产状态，在达到v1.0之前，有可能发生突破性的更改。</li><li id="1516" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">它也没有很好的Windows兼容性，但老实说，这对我来说不是一个缺点。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0569" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">外卖食品</h1><p id="9f6c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Crystal可能还需要一段时间才能投入生产使用，因为它背后有很好的工具和繁荣的社区。但令人欣慰的是，像Crystal这样精彩的语言正在幕后工作。</p><p id="66a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">纵观Crystal汇集的所有特性，它值得大量关注和普及。如果我激起了你的兴趣，我会鼓励你去看看Crystal，自己做决定。</p><p id="878a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与此同时，我将继续宣传Crytal，并密切关注它的进展。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5f12" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">开始使用这些资源</h1><ul class=""><li id="cea4" class="nz oa it lb b lc mu lf mv li on lm oo lq op lu oe of og oh bi translated"><a class="ae ky" href="https://github.com/veelenga/awesome-crystal" rel="noopener ugc nofollow" target="_blank">牛逼水晶— GitHub </a></li><li id="9978" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://www.reddit.com/r/crystal_programming/" rel="noopener ugc nofollow" target="_blank">水晶编程— Reddit </a></li><li id="92fd" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="http://kemalcr.com/" rel="noopener ugc nofollow" target="_blank">凯末尔</a></li><li id="9f6f" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://amberframework.org/" rel="noopener ugc nofollow" target="_blank">琥珀色框架</a></li></ul></div></div>    
</body>
</html>