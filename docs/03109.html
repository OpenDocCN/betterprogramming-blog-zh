<html>
<head>
<title>How to Implement UITableView and UICollectionView With RxDataSources</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用RxDataSources实现UITableView和UICollectionView</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-implement-uitableview-and-uicollectionview-with-rxdatasources-1afcd68729bf?source=collection_archive---------7-----------------------#2020-01-21">https://betterprogramming.pub/how-to-implement-uitableview-and-uicollectionview-with-rxdatasources-1afcd68729bf?source=collection_archive---------7-----------------------#2020-01-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c277" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及为什么您再也不会直接使用UITableViewDataSource</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c72f19cb0939a0f7b37650f35bbb4633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rYYNXNVSJaNHLYmL2i1aGA.png"/></div></div></figure><p id="b940" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我将通过一个同时实现了<code class="fe lr ls lt lu b">UITableView</code>和<code class="fe lr ls lt lu b">UICollectionView</code>的应用程序的例子向您展示<a class="ae lq" href="https://github.com/RxSwiftCommunity/RxDataSources" rel="noopener ugc nofollow" target="_blank"> RxDataSources </a>的强大功能。</p><p id="07a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该项目的源代码可在GitHub 上获得<a class="ae lq" href="https://github.com/zafarivaev/RxDataSources-Demo" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1023" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">演示应用程序</h1><p id="3f9e" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">该应用程序有一个<code class="fe lr ls lt lu b">UITabBarController</code>，其中包含三个视图控制器:<code class="fe lr ls lt lu b">SimpleViewController</code>、<code class="fe lr ls lt lu b">IntermediateViewController</code>和<code class="fe lr ls lt lu b">AdvancedViewController</code>。</p><p id="4ecd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">每个屏幕对应于实现的难度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/753e4472626d8a55f99393f8fc272680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VuZRhghRKvkNNBzPzDJOmA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/6b031392c9451938f82b470ba96b62d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0MgjkUnYnagmufQztN687g.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/f1a3221046e03a2f21c0bbc82decda81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aRPUcArKKwR0Ohx5anbM8g.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5b4c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">项目结构</h1><p id="9845" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">该应用程序遵循MVVM架构。我们有三个主文件夹:<code class="fe lr ls lt lu b">App</code>、<code class="fe lr ls lt lu b">Classes</code>、<code class="fe lr ls lt lu b">Utils</code>和<code class="fe lr ls lt lu b">Supporting Files</code>。</p><p id="963d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lr ls lt lu b">App</code>文件夹中，我们有<code class="fe lr ls lt lu b">AppDelegate.swift</code>负责将<code class="fe lr ls lt lu b">UITabBarController</code>设置为<code class="fe lr ls lt lu b">window</code>的<code class="fe lr ls lt lu b">rootViewController</code>。</p><p id="f019" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lr ls lt lu b">Classes</code>文件夹中，我们有所有的视图控制器和视图模型。</p><p id="e3d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lr ls lt lu b">Utils</code>包含<code class="fe lr ls lt lu b">Utilities.swift</code>文件，该文件提供了一个帮助器方法，用于从特定的单元格获取重用标识符。</p><p id="b22e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lr ls lt lu b">Supporting files</code>包含我们在本教程中不会用到的文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/045938eaa682d59b9d73fc41b1770f37.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*lgxCoPOQGTQVQ6mfsRnlbw.png"/></div></figure><p id="9392" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">清楚这一点后，让我们开始一个接一个地学习简单、中级和高级实现。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5ac3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">简单的</h1><p id="e0ea" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">显示带有简单数据源的基本<code class="fe lr ls lt lu b">UITableView</code>。</p><h2 id="390e" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated">SimpleViewController.swift</h2><p id="ddaf" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">这里我们布局一个<code class="fe lr ls lt lu b">tableView</code>，参考一个<code class="fe lr ls lt lu b">SimpleViewModel</code>获取数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="39cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们仔细看看如何实现<code class="fe lr ls lt lu b">tableView</code>数据绑定:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="d154" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们所要做的就是访问<code class="fe lr ls lt lu b">viewModel</code>的items属性并将其绑定到<code class="fe lr ls lt lu b">tableView</code>。结果，我们只用几行代码就完成了<code class="fe lr ls lt lu b">tableView</code>的设置！</p><h2 id="f903" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak"> SimpleViewModel.swift </strong></h2><p id="112b" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">这就是<code class="fe lr ls lt lu b">items</code>属性的样子。它只是<code class="fe lr ls lt lu b">[String]</code>的一个<code class="fe lr ls lt lu b">Observable</code>，值从“1”数到“10”:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="045e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">中间的</h1><p id="b484" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">显示带有集管的分段<code class="fe lr ls lt lu b">UITableView</code>。</p><h2 id="178b" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak">intermediated data source . swift</strong></h2><p id="23ed" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">首先，因为我们想要使用区段，我们必须为<code class="fe lr ls lt lu b">tableView</code>定义我们的定制数据源:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="0e55" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里需要记住的关键点是:</p><ul class=""><li id="8b24" class="np nq it kw b kx ky la lb ld nr lh ns ll nt lp nu nv nw nx bi translated"><code class="fe lr ls lt lu b">TableViewItem</code>代表一个特定的单元格。</li><li id="3263" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><code class="fe lr ls lt lu b">TableViewSection</code>代表一段。当定义我们的自定义部分时，我们必须符合<code class="fe lr ls lt lu b">SectionModelType</code>。</li><li id="355f" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated">我们定义了<code class="fe lr ls lt lu b">IntermediateDataSource</code>结构，在这里我们为<code class="fe lr ls lt lu b">tableView</code>创建并返回一个<code class="fe lr ls lt lu b">dataSource</code>。</li></ul><p id="3efe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完成这些后，我们只用10行代码就成功实现了<code class="fe lr ls lt lu b">cellForRow(at: )</code>和<code class="fe lr ls lt lu b">titleForHeaderInSection</code>！</p><h2 id="3e07" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak">intermediateviewmodel . swift</strong></h2><p id="afd7" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">这里，我们定义了<code class="fe lr ls lt lu b">items</code>和<code class="fe lr ls lt lu b">dataSource</code>供<code class="fe lr ls lt lu b">tableView</code>使用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="9fcb" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak">intermediateviewcontroller . swift</strong></h2><p id="def3" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">现在我们准备好显示<code class="fe lr ls lt lu b">tableView</code>。我们所需要做的就是简单地将<code class="fe lr ls lt lu b">viewModel</code>的<code class="fe lr ls lt lu b">items</code>属性绑定到<code class="fe lr ls lt lu b">tableView</code>，将<code class="fe lr ls lt lu b">dataSource</code>作为参数传入:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cf4a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先进的</h1><p id="a620" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">显示一个自定义的<code class="fe lr ls lt lu b">UITableView</code>。第一部分有一个带有嵌入式<code class="fe lr ls lt lu b">UICollectionView</code>的<code class="fe lr ls lt lu b">UITableViewCell</code>。第二部分包含一个带有显示指示器的单元格和另一个带有开关的单元格。</p><h2 id="3c00" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak">advanced data source . swift</strong></h2><p id="d9c9" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">enum描述了我们将要使用的细胞模型。</p><p id="a41b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lr ls lt lu b">AdvancedTableViewSection</code>定义了两个部分:<code class="fe lr ls lt lu b">GridSection</code>(内部将有一个<code class="fe lr ls lt lu b">UICollectionView</code>)和<code class="fe lr ls lt lu b">CustomSection</code>(将包含一个带指示灯的单元格和一个带开关的单元格):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="e4d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意，我们根据显示在<code class="fe lr ls lt lu b">tableView</code>中的截面类型为截面定义了一个<code class="fe lr ls lt lu b">header</code>。</p><h2 id="5e16" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak">advanced viewmodel . swift</strong></h2><p id="bf8f" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">我们定义<code class="fe lr ls lt lu b">items</code>和一个<code class="fe lr ls lt lu b">dataSource</code>供<code class="fe lr ls lt lu b">tableView</code>使用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="de24" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak">advancedviewcontroller . swift</strong></h2><p id="62c1" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">最后，我们准备使用定义好的<code class="fe lr ls lt lu b">dataSource</code>和<code class="fe lr ls lt lu b">items</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="ec2a" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak">advancedgridtableviewcell . swift</strong></h2><p id="8609" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">为了在单元格内有一个网格，我们创建了一个<code class="fe lr ls lt lu b">collectionView</code>。它与数据绑定，类似于我们在本文的<em class="od">简单</em>部分所做的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="42c3" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak">advancedindicatortableviewcell . swift</strong></h2><p id="1f35" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">代表一个带有居中标签和显示指示器的简单单元格(在<code class="fe lr ls lt lu b">AdvancedDataSource.swift</code>中设置):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="dace" class="nb md it bd me nc nd dn mi ne nf dp mm ld ng nh mo lh ni nj mq ll nk nl ms nm bi translated"><strong class="ak">advancedswitchtableviewcell . swift</strong></h2><p id="71c5" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">显示居中的标签和一个<code class="fe lr ls lt lu b">switch</code>，有自己的<code class="fe lr ls lt lu b">viewModel</code>来表示其<code class="fe lr ls lt lu b">isOn</code>属性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="773b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">设置好之后，我们用相对较少的代码创建了一个不平凡的<code class="fe lr ls lt lu b">UITableView</code>！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b806" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">包扎</h1><p id="5dd6" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">注意，我们没有在代码的任何地方使用<code class="fe lr ls lt lu b">tableView.dataSource = self</code>。我们还大大缩短了代码，使其看起来整洁清晰。</p><p id="8960" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了探索你还能用RxDataSources库做些什么，我建议你看看它的官方GitHub repo。</p><p id="edc9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>