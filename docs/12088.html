<html>
<head>
<title>6 Metrics To Watch for on Your K8s Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您的K8s集群需要关注的6项指标</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/6-metrics-to-watch-for-on-your-k8s-cluster-76d58f08397f?source=collection_archive---------0-----------------------#2022-05-11">https://betterprogramming.pub/6-metrics-to-watch-for-on-your-k8s-cluster-76d58f08397f?source=collection_archive---------0-----------------------#2022-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5a02" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">要监控的最重要的Kubernetes指标</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e1689339e7966a43ebf18e25cd60829a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SkcWTcf-5u8XZ3Pm"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">米凯尔·麦克维利在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="cd5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">库伯内特。如今，该行业中的公司似乎分为两类:已经在生产工作负载中大量使用it的公司和正在将工作负载迁移到it的公司。</p><p id="4c67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kubernetes的问题在于，它不是Redis RabbitMQ或PostgreSQL那样的单一系统。它是几个控制平面组件(例如etcd、API服务器)的组合，通过一组虚拟机在用户(数据)平面上运行我们的工作负载。</p><p id="626f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">乍看之下，控制平面组件、虚拟机和您的工作负载产生的指标数量可能多得令人应接不暇。从这些指标中形成一个全面的可观察性堆栈需要在管理Kubernetes集群方面有相当的知识和经验。</p><p id="bc10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么，如何处理大量的度量标准呢？阅读这篇文章可能是一个好的开始。</p><p id="bb80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将涵盖基于k8s元数据的最关键指标，这些指标为监控您的工作负载并确保它们处于健康状态提供了良好的基准。为了让这些指标可用，您需要安装<a class="ae kv" href="https://github.com/kubernetes/kube-state-metrics" rel="noopener ugc nofollow" target="_blank"> kube-state-metrics </a>和Prometheus来收集它所公开的指标，并存储它们以供以后查询。</p><p id="0e0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们不打算在这里涵盖安装过程，但一个很好的线索是<a class="ae kv" href="https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus" rel="noopener ugc nofollow" target="_blank">普罗米修斯头盔图</a>，它安装两者的默认设置。</p><p id="f524" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于列出的每个指标，我们将涵盖指标的含义、您为什么应该关注它，以及您应该如何在其中设置警报。</p><h1 id="a0c9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.CPU /内存请求与实际使用</h1><p id="9e9a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">什么:每个容器都可以(也应该！)定义对CPU和内存的请求。Kubernetes调度程序使用这些请求来确保选择一个有能力托管pod的节点。这是通过计算节点上未使用的资源来实现的，考虑节点的容量减去当前调度的pods的请求。</p><p id="13f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看一个例子来更清楚地说明这一点:假设您有一个节点，它有八个CPU核心，运行三个pod，每个pod有一个请求一个CPU核心的容器。该节点有五个未预留的CPU核心，供调度程序在分配pod时使用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/7287069663a32db51ba776d0ef64fcd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/0*t26uzAsxWtQK9kWG.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">5个内核可用于其他pod</p></figure><p id="30fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请记住，我们所说的“可用”并不是指实际使用情况，而是指当前安排到节点中的pods尚未请求(保留)的CPU核心。需要六个CPU核心的pod不会被安排到此节点中，因为没有足够的可用CPU核心来托管它。</p><p id="5afd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“实际使用”指标跟踪pod在运行时使用了多少资源。当我们测量实际使用情况时，通常是在一组pod上(部署、<code class="fe mq mr ms mt b">statefulset</code>等)。)，所以我们应该参考百分位数而不是单个pod的使用量。第90百分位应该是这个问题的一个好的起点。</p><p id="1bc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，要求每个pod有1个CPU核心的部署可能会在其副本中使用0.7个核心。</p><p id="082f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原因:保持请求和实际使用的一致性很重要。高于实际使用量的请求会导致资源使用效率低下(利用不足)。想象一下，当一个请求四个核心的pod在第90百分位使用一个核心时会发生什么。</p><p id="6646" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">K8s可以将这个pod调度到一个具有四个空闲核心的节点中，这意味着没有其他pod能够使用保留的三个未使用的核心。下图显示每个pod保留了四个核心，但实际上使用了一个核心，这意味着我们在节点上“浪费”了六个核心。它们将不会被使用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/5250f9f08f61d9b6f18bbfa24b3ed7e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/0*yKVBblttHenSZHNj.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">请求高于实际使用量=未充分利用</p></figure><p id="0251" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记忆也是如此。如果我们将请求设置得比使用量高，我们将无法使用可用的内存。</p><p id="1b87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">未对齐的另一个选项是pod的请求低于其实际使用量(过度利用)。在CPU过度使用的情况下，由于节点上的资源不足，您的应用程序会运行得更慢。</p><p id="e7cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想象三个豆荚。他们每个人都要求一个内核，但实际上使用了三个。这三个pod可能被调度到一个8核机器中(1个请求* 3 =3个&lt;8), but when they do, they’ll compete for CPU time since their actual usage — 9 cores — exceeds the number of cores on the node.</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/6481434959340a018efc1aef0a097aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ikjzJRxHGliy35XD.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><em class="mw">pod实际使用量超过了一个节点上的核心数</em></p></figure><p id="8f67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而对于CPU，当内存请求低于要求时，您会经历缓慢的应用程序执行，您可能会遇到其他类型的问题。</p><p id="e657" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们有三个单元，每个单元请求1 GB内存，但使用3 GB，那么它们可能都被安排到一个8GB内存的节点中。在运行时，当一个进程试图分配比节点更多的内存时，它会被内核杀死(内存不足杀死),使用K8s，它会重新启动。</p><p id="1e67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们的进程崩溃时，它可能会丢失任何正在运行的请求，并且在它重新启动之前不可用，这使我们的能力不足。一旦启动，它可能会由于冷缓存或其依赖项(数据库、其他服务等)的空连接池而遭受冷启动。).</p><p id="6cc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">方法:让我们将pod请求定义为100%。实际使用(CPU或内存，这并不重要)的合理范围是第90百分位的60%-80%。</p><p id="1b98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，如果您有一个请求10GB内存的pod，其实际使用量的第90百分位应该是6GB-8GB。如果它低于6GB，那么您就没有充分利用您的内存，浪费金钱。如果它高于8GB，您将会面临由于内存不足而被杀死的风险。我们应用于内存请求的规则也可以应用于CPU请求。</p><h1 id="9285" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.CPU /内存限制与实际使用</h1><p id="9b68" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">内容:当调度程序使用资源请求将工作负载调度到节点时，资源限制允许您在运行时定义工作负载的资源使用边界。</p><p id="b98c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原因:了解CPU和内存限制的实施方式非常重要，这样您就能意识到超出这些限制的工作负载的影响:</p><p id="73d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当一个容器达到CPU限制时，它将受到限制，这意味着它从操作系统获得的CPU周期比它能够获得的要少，最终导致执行时间变慢。托管pod的节点是否有空闲的CPU周期并不重要docker运行时调节容器。</p><p id="c3c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在没有意识到的情况下被CPU节流是非常危险的。系统中随机流的延迟会增加，如果系统中的某个组件受到抑制，并且您没有预先设置所需的可观察性，那么可能很难查明根本原因。这种情况可能会导致部分服务中断或完全不可用，以防被节流的服务参与到我们系统的核心流中。</p><p id="781a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">内存限制和CPU限制的实施方式不同:当你的容器达到内存限制时，它会被杀死。这与由于节点上的内存不足而被关闭的效果相同:进程将丢弃正在进行的请求，服务将处于容量不足状态，直到容器重新启动，然后它将进行冷启动。</p><p id="adce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果进程积累内存的速度足够快，它可能会进入<code class="fe mq mr ms mt b">CrashLoop</code>状态。这种状态表明进程要么在启动时崩溃，要么在反复启动后的短时间内崩溃。崩溃循环pod通常意味着服务不可用。</p><p id="43d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">方法:监视资源限制的方法类似于我们监视CPU/内存请求的方法。您的目标应该是超出第90百分位限制的80%的实际使用率。例如，如果我们有一个pod，其CPU限制为两个核心，内存限制为2GB，则警报应该设置为1.6个核心的CPU使用率或1.6GB的内存使用率。</p><p id="d44b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">任何高于这一水平的因素都会导致您的工作负载根据超出的阈值而被抑制或重启的风险。</p><h1 id="624d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.所需副本中不可用单元的百分比</h1><p id="c2a6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">内容:当您部署一个应用程序时，您设置它应该运行的所需副本(pod)的数量。有时，由于多种原因，某些pod可能不可用，例如:</p><ul class=""><li id="88ce" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">由于资源请求的原因，一些pod可能不适合群集中任何正在运行的节点。这些pod将转换为挂起状态，直到某个节点释放资源来托管它们，或者满足要求的新节点加入集群。</li><li id="0323" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">一些pod可能没有通过活性/就绪性探测，这意味着它们要么正在重新启动(活性)，要么正从服务端点中取出(就绪性)。</li><li id="0bbc" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">如上所述，一些pod可能会达到其资源限制，并进入崩溃循环状态。</li><li id="6a48" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">由于各种原因，一些pod可能被托管在故障节点上，如果该节点不健康，大多数情况下托管在其上的pod将不能很好地运行。</li></ul><p id="83fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原因:pod不可用对您的系统来说不是一种健康的状态。这可能会导致从轻微服务中断到完全服务不可用的任何情况，具体取决于不可用的pod占所需副本数量的百分比，以及缺少的pod在系统核心流中的重要性。</p><p id="1429" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如何:我们在这里要监控的函数是不可用的pod占期望的pod数量的百分比。您应该在KPI中设定的确切百分比取决于服务及其在您系统中的每个pod的重要程度。</p><p id="f290" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于某些工作负载，只要系统能够自行恢复健康状态，并且对客户没有影响，我们就可以接受5%的pod在某段时间内不可用。对于某些工作负载，即使一个不可用的pod也可能成为问题。一个很好的例子就是<code class="fe mq mr ms mt b">statefulsets</code>，其中每个pod都有其独特的身份，让它不可用可能是不可接受的。</p><h1 id="a24e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.HPA最大副本数中的所需副本数</h1><p id="6f61" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">内容:Horizontal Pod Autoscaler (HPA)是一种k8s资源，允许您根据您定义的目标功能调整工作负载正在运行的副本数量。常见的用例是根据部署中pod的平均CPU使用率与CPU请求数的比较来自动扩展。</p><p id="573b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原因:当部署的副本数量达到HPA中定义的最大值时，您可能会遇到需要更多单元，但HPA无法纵向扩展的情况。根据您设置的<code class="fe mq mr ms mt b">scale up</code>功能，结果可能会有所不同。这里有两个例子来说明这一点:</p><ul class=""><li id="a7b0" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">如果<code class="fe mq mr ms mt b">scale up</code>函数使用CPU使用率，那么现有pod的CPU使用率将增加到达到极限并被抑制的程度(详见第2点)。这最终会降低系统的吞吐量。</li><li id="1980" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">如果<code class="fe mq mr ms mt b">scale up</code>函数使用定制的度量标准，比如队列中未决消息的数量，那么队列可能会被未决消息填满，这会在处理管道中造成延迟。</li></ul><p id="2a11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如何:监控这个指标非常简单。您需要为当前副本数除以HPA最大副本数设置一个<code class="fe mq mr ms mt b">X%</code>阈值。一个理智的<code class="fe mq mr ms mt b">X</code>可能是85%允许你在达到最大值之前做出必要的改变。</p><p id="adab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请记住，增加副本的数量可能会影响系统的其他部分，因此您最终可能会更改比HPA配置更多的内容来支持这个<code class="fe mq mr ms mt b">scale up</code>操作。</p><p id="893a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个典型的例子是，当您增加副本的数量并且有更多的pod尝试连接到数据库时，该数据库将达到其最大连接限制。这就是为什么在这种情况下，将足够大的缓冲区作为准备时间是非常有意义的。</p><h1 id="475d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">5.状态检查失败的节点</h1><p id="9305" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">内容:kubelet是一个k8s代理，运行在集群上的每个节点上。在它的职责中，kubelet发布一些指标(称为节点状况)来反映它所运行的节点的健康状态:</p><ul class=""><li id="0f63" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated"><code class="fe mq mr ms mt b">Ready</code> —如果节点正常并准备好接受pod，则为真</li><li id="4708" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe mq mr ms mt b">DiskPressure </code> —如果节点磁盘的可用存储空间不足，则为真</li><li id="285c" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe mq mr ms mt b">MemoryPressure</code> —如果节点内存不足，则为真</li><li id="305f" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe mq mr ms mt b">PIDPressure </code> —如果节点上运行的进程太多，则为真</li><li id="11d2" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated"><code class="fe mq mr ms mt b">NetworkUnavailable</code> —如果节点的网络配置不正确，则为真</li></ul><p id="c33e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">健康节点应在<code class="fe mq mr ms mt b">Ready</code>条件下报告<code class="fe mq mr ms mt b">True</code>，在所有其他四种条件下报告<code class="fe mq mr ms mt b">False</code>。</p><p id="b28f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原因:如果<code class="fe mq mr ms mt b">Ready</code>条件变为负值，或者任何其他条件变为正值，这可能意味着该节点上运行的部分或全部工作负载运行不正常，这是您应该注意的事情。</p><p id="f18d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于DiskPressure、<code class="fe mq mr ms mt b">MemoryPressure</code>和<code class="fe mq mr ms mt b">PIDPressure</code>，根本原因非常清楚——一个进程以节点无法维持的速度写入磁盘/分配内存/产生进程。</p><p id="a555" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b">Ready</code>和<code class="fe mq mr ms mt b">NetworkUnavailable</code>的情况有点复杂，需要进一步调查才能弄清问题。</p><p id="987a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如何实现:首先，我预计正好有0个节点不健康，这样每个不健康的节点都会触发一个警报。</p><h1 id="c161" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">6.持久卷利用率</h1><p id="60cf" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">内容:永久卷(PV)是一种k8s资源，代表一个存储块，可以连接到系统中的pod，也可以从pod中分离。PV的实现是特定于平台的。</p><p id="6c43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，如果您的Kubernetes部署基于AWS，那么一个PV将由一个EBS卷来表示。与每个数据块存储一样，它也有容量，可能会随着时间的推移而变满。</p><p id="eea0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原因:当一个进程使用一个没有空闲空间的磁盘时，就会发生混乱，因为故障可能有一百万种不同的表现形式，而且堆栈跟踪并不总是能找到根本原因。除了避免将来的失败之外，观察这个指标还可以用于规划记录和添加数据的工作负载。</p><p id="b109" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Prometheus是这种工作负载的一个很好的例子，因为它将数据点写入其时序数据库，这意味着磁盘中的可用空间量减少。由于Prometheus写入数据的速度非常一致，因此很容易使用PV利用率指标来预测删除旧数据或为磁盘购买更多容量所需的时间。</p><p id="f3db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如何实现:kubelet公开了PV的使用和容量，因此在它们之间进行简单的划分就可以提供PV的利用率。很难提出一个合理的警报阈值，因为它实际上取决于利用率图表的轨迹，但根据经验，在耗尽光伏存储之前，至少要给自己两到三周的时间。</p><h1 id="e630" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">摘要</h1><p id="6d72" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">正如您已经知道的，处理Kubernetes集群不是一件容易的事情。有大量的可用指标，选择重要的指标需要大量的专业知识。</p><p id="5829" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让一个仪表板监视您的集群的关键指标，既可以作为一种预防措施来避免问题的发生，也可以作为一种工具来排除系统中潜在的问题。</p><p id="1175" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注</strong> <em class="nl">:这篇博客也发表在</em> <a class="ae kv" href="https://komodor.com/blog/6-metrics-to-watch-for-on-your-kubernetes-cluster/" rel="noopener ugc nofollow" target="_blank"> <em class="nl"> Komodor </em> </a> <em class="nl">的科技博客上。</em></p></div></div>    
</body>
</html>