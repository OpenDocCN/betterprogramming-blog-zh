<html>
<head>
<title>How to Handle CORS in Angular 2 and Node/Express Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular 2和Node/Express应用中处理CORS</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-handle-cors-in-an-angular2-and-node-express-applications-eb3de412abef?source=collection_archive---------4-----------------------#2016-05-23">https://betterprogramming.pub/how-to-handle-cors-in-an-angular2-and-node-express-applications-eb3de412abef?source=collection_archive---------4-----------------------#2016-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b00b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">允许其他域访问后端资源</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6591ca26d59e5dd02854bb5e4525b939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*noWugq475wECiEqGOyG9Zw.png"/></div></div></figure><p id="4f01" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在许多应用程序中，前端和后端驻留在一个点上，即可能有许多使用<a class="ae lq" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>服务前端的<a class="ae lq" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>应用程序。带有<a class="ae lq" href="https://jade.tilab.com/" rel="noopener ugc nofollow" target="_blank">玉石</a> / <a class="ae lq" href="https://handlebarsjs.com/" rel="noopener ugc nofollow" target="_blank">车把</a>或其他框架的js。但是，有时您可能希望将前端托管在其他地方，以隔离后端。或者，您可能希望允许多个域访问Node.js后端。在这种情况下，您必须启用CORS。</p><p id="1951" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing#cite_note-mozhacks_cors-1" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">跨来源资源共享</strong>(<strong class="kw iu"/>)</a>是一种机制，允许从资源来源域之外的另一个<a class="ae lq" href="https://en.wikipedia.org/wiki/Domain_name" rel="noopener ugc nofollow" target="_blank">域</a>请求<a class="ae lq" href="https://en.wikipedia.org/wiki/Web_page" rel="noopener ugc nofollow" target="_blank">网页</a>上的受限资源(如字体)。</p><p id="ebff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">长话短说，CORS允许其他域访问您想要公开的后端资源以及API/REST调用。</p><p id="2e04" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于<a class="ae lq" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank">角度2 </a>应用，有多种起始模板可供选择。然后是Angular 2应用程序的angular-cli ,尽管它目前仍处于测试阶段，但已被许多人使用。这些模板允许您拥有自己的Angular应用程序独立服务器。因此，当您构建Angular 2和Node.js应用程序时，您的前端和后端将位于不同的域中，并且在开发过程中，可能位于不同的端口上。例如http://localhost:4200可能是你的Angular 2应用的地址，而<a class="ae lq" href="http://localhost:300" rel="noopener ugc nofollow" target="_blank"> http://localhost:300 </a> 0可能是你的Node.js API服务器。</p><p id="116d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在你可能会想，“哦，得了吧，阿桑，这些我都知道！只要告诉我如何做CORS的东西。”</p><p id="22a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">开始了。</p><p id="6cb7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Node.js端，非常简单。Express.js有一个很棒的CORS NPM包，它是一个中间件。因此，使用npm在您的项目中安装软件包:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="acbf" class="lw lx it ls b gy ly lz l ma mb">cd /path-to-your-project<br/>npm install cors --save</span></pre><p id="4a65" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，在你的主Node.js文件中，通常是<code class="fe mc md me ls b">app.js</code>，需要这个模块，并使用如下配置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="120f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上述代码将在Node.js和Express.js应用程序上启用CORS。</p><p id="57a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在你需要准备你的Angular应用程序来为CORS工作。到目前为止，还没有一个官方的方法来做到这一点。<a class="ae lq" href="https://github.com/angular/angular" rel="noopener ugc nofollow" target="_blank">角2 github库</a>上有一个<a class="ae lq" href="https://github.com/angular/angular/issues/4231" rel="noopener ugc nofollow" target="_blank">拉请求</a>，但是我觉得还没有合并。</p><p id="fa0d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以事情是这样的。要启用CORS，您可以扩展<code class="fe mc md me ls b">BrowserXhr </code>类(考虑到您正在为Angular 2编写Typescript ),并将其包含在引导过程中。在Angular 2项目中创建一个名为<code class="fe mc md me ls b">cust-ext-browser-xhr.ts</code>的文件，并粘贴以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="94b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，在引导应用程序组件的主文件中，导入我们的自定义浏览器xhr模块，并在引导过程中使用它:</p><p id="0983" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="mh">注:以下代码用于角度2。对于角度4+，进一步向下滚动。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="66eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="mh">对于角度4+，使用下面的代码片段:</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="4591" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样！这就是我们在Angular 2和Node.js/Express.js应用中使CORS工作所需的全部内容。我在Node.js应用程序中使用<a class="ae lq" href="http://passportjs.org/" rel="noopener ugc nofollow" target="_blank"> Passport.js </a>进行身份验证，这是一个非常灵活且易于使用的框架。</p><p id="3ab4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">编码快乐！:)</p></div></div>    
</body>
</html>