<html>
<head>
<title>Create a Text Classifier Using Core ML 2, NLP, and Create ML in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用核心ML 2、NLP创建文本分类器，并在Swift中创建ML</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/text-classifier-using-coreml-2-nlp-and-createml-6d5c9f456b35?source=collection_archive---------15-----------------------#2019-12-01">https://betterprogramming.pub/text-classifier-using-coreml-2-nlp-and-createml-6d5c9f456b35?source=collection_archive---------15-----------------------#2019-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2661" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">影评的情感分析</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0d6ed6728d49f0ce2f036755796f2b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2OocTN9awG2iOFvS4Lbow.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">查尔斯·🇵🇭在<a class="ae kv" href="https://unsplash.com/s/photos/movie?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a0db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，一些定义:</p><ul class=""><li id="7e35" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">自然语言:分析自然语言文本，并推断其特定于语言的元数据。</li><li id="dae1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/createml" rel="noopener ugc nofollow" target="_blank">创建ML </a>:让你构建、训练和部署机器学习模型，不需要机器学习专业知识。</li><li id="552d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://developer.apple.com/documentation/coreml" rel="noopener ugc nofollow" target="_blank"> Core ML </a>型号捆绑到应用中，有助于推动智能特性。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/a1628ccbbc210ec97c8b079392b648c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LZ0z7w1wStn3sUoKZFgllA.png"/></div></div></figure><p id="786a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将训练一个可用于对电影评论进行情感分析的模型。</p><p id="a0c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用Create ML在使用Xcode和Swift的计算机上训练机器学习模型。我们将在iOS应用程序中使用训练好的模型。这个应用程序告诉我们一个电影评论是积极的还是消极的。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="87bd" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">训练模型</h1><p id="ac22" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">分类器应该用大量标记的文本数据来训练。Create ML可以处理来自JSON或CSV文件并标记为文件夹结构的训练文本数据。</p><p id="9c01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Create ML在移动设备上不起作用，我们需要创建一个macOS游乐场。</p><ul class=""><li id="3756" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">打开Xcode，<em class="nl">文件→新建→游乐场→ macOS →空白</em>。点击<em class="nl">下一步。</em></li><li id="f0b2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">给它起一个合适的名字，点击<em class="nl">创建</em>。</li></ul><h2 id="2fb7" class="nm mp iq bd mq nn no dn mu np nq dp my lf nr ns na lj nt nu nc ln nv nw ne nx bi translated">使用JSON</h2><ul class=""><li id="2234" class="ls lt iq ky b kz ng lc nh lf ny lj nz ln oa lr lx ly lz ma bi translated">训练数据由来自IMDB的电影评论及其对应的情感标签组成。</li><li id="62ed" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">我们将建立两个<code class="fe ob oc od oe b">MLDataTable</code>实例:一个训练数据表，保存训练数据集的内容；一个测试数据表，保存用于测试训练好的分类器的数据。</li><li id="b5be" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">取消隐藏游乐场中的导航器，并将<code class="fe ob oc od oe b">reviews.json</code>和<code class="fe ob oc od oe b">testing-reviews.json</code>文件拖到<code class="fe ob oc od oe b">Resources</code>文件夹中。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/16bd6412002a25971534769a2f96fb1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MOIfl1XIGd8QzUjIE-33kw.png"/></div></div></figure><ul class=""><li id="dd01" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">我们将从主包中加载<code class="fe ob oc od oe b">trainingDataFileURL</code>和<code class="fe ob oc od oe b">testingDataFileURL</code>。</li><li id="ba9a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">在我们的JSON文件中，我们有包含文本和评论的条目。正文就是复习正文，结果告诉我们复习是负面的还是正面的。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><ul class=""><li id="63e4" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">我们将创建一个<code class="fe ob oc od oe b">MLDataTable</code>实例来开始训练过程。<code class="fe ob oc od oe b">MLDataTable</code>初始化器获取训练数据文件的URL，并用训练JSON文件的内容创建一个数据表。</li><li id="7345" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">以类似的方式为测试数据创建一个数据表。</li><li id="3924" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">训练过程从创建文本分类器实例开始。初始化器需要训练数据表作为输入，我们还需要提供文本和结果列的名称。</li></ul><h2 id="4748" class="nm mp iq bd mq nn no dn mu np nq dp my lf nr ns na lj nt nu nc ln nv nw ne nx bi translated">使用带标签的文件夹结构</h2><ul class=""><li id="1b3a" class="ls lt iq ky b kz ng lc nh lf ny lj nz ln oa lr lx ly lz ma bi translated">这里，我们将使用带标签的文件夹结构，即在名为<code class="fe ob oc od oe b">positive</code>和<code class="fe ob oc od oe b">negative</code>的文件夹中使用单独的文本文件。如果我们有一个文本文件的集合，这就很好了。</li><li id="ea39" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">我们将通过提供目录文件夹的路径来加载<code class="fe ob oc od oe b">trainingDataDirectory</code> URL。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><ul class=""><li id="0063" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">训练过程从创建文本分类器实例开始。初始化器需要存储在一组目录中的训练集。</li></ul></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="7707" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">后续步骤</h1><p id="c366" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">对于这两种方法中的任何一种，请在上述步骤之后执行以下步骤。</p><ul class=""><li id="c0b5" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">让我们建造并经营操场。用提供的训练数据创建一个<code class="fe ob oc od oe b">MLTextClassifier</code>只需要几秒钟。我们可以在控制台日志中跟踪进度。</li><li id="41e6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">我们必须创建一个核心ML模型文件，这样我们就可以在我们的应用程序中使用分类器模型。我们可以通过调用<code class="fe ob oc od oe b">MLTextClassifier</code>的<code class="fe ob oc od oe b">write(to:, metadata:)</code>实例方法来实现。该方法接受核心ML模型文件的路径和文件名，以及包含模型附加信息的元数据实例。</li><li id="f830" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">请确保更新路径，使其成为您计算机上的有效路径。</li></ul></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="332b" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">iOS演示应用</h1><p id="3a65" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">让我们开始在Swift中开发iOS应用程序的Xcode项目。</p><ol class=""><li id="2bf3" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oi ly lz ma bi translated">将<code class="fe ob oc od oe b">MovieReviewsClassifier.mlmodel</code>拖到Xcode项目中。</li><li id="46e9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated">在故事板中，创建一个视图，用<code class="fe ob oc od oe b">UITextView</code>表示回顾文本，<code class="fe ob oc od oe b">UIButtons</code>表示结果和清除文本，<code class="fe ob oc od oe b">UIImageView</code>和<code class="fe ob oc od oe b">UILabel</code>表示结果。</li><li id="2c5e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated"><code class="fe ob oc od oe b">`MovieReviewsClassifier`</code>类是为相应的模型自动生成的。</li><li id="fdff" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated">导入<a class="ae kv" href="https://developer.apple.com/documentation/naturallanguage" rel="noopener ugc nofollow" target="_blank">自然语言</a>框架。</li><li id="81b7" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated">创建一个类型为<code class="fe ob oc od oe b">NLModel</code>的惰性属性，并传入<code class="fe ob oc od oe b">MovieReviewsClassifier</code>的模型</li><li id="e8a9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oi ly lz ma bi translated">通过调用<code class="fe ob oc od oe b">predictedLabel(for:)</code> <strong class="ky ir"> </strong>实例方法获得预测。<strong class="ky ir"> </strong>该方法可能返回训练数据中使用的情感标签之一。使用switch语句找出情感标签。</li></ol><pre class="kg kh ki kj gt oj oe ok ol aw om bi"><span id="5283" class="nm mp iq oe b gy on oo l op oq"><strong class="oe ir">if</strong> <strong class="oe ir">let</strong> label = sentimentClassifier?.predictedLabel(for:        <strong class="oe ir">self</strong>.movieReviewText.text) {<br/>   <strong class="oe ir">switch</strong> label {<br/>     <strong class="oe ir">case</strong> "pos":<br/>          //Positive<br/>     <strong class="oe ir">case</strong> "neg":<br/>          //Negative"<br/>     <strong class="oe ir">default</strong>:<br/>          //Neutral<br/>}}</span></pre><p id="45e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参考GitHub 上的<a class="ae kv" href="https://github.com/talreja-priya/SentimentAnalyzer-Swift" rel="noopener ugc nofollow" target="_blank">完整Xcode项目。</a></p><p id="d451" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行应用程序，编写/粘贴评论，点击<em class="nl">显示结果</em>评估评论。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/dbf97b15619e120bc718ce02b12437f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hk4cLuPKt7Hupi3cwTrLJA.png"/></div></div></figure><p id="3b00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谢谢你。希望这有帮助！</p></div></div>    
</body>
</html>