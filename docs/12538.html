<html>
<head>
<title>Native Modules: Export C Functions to React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">本机模块:导出C函数来反应本机</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/native-modules-program-c-to-react-native-for-beginners-b0bc01e94c81?source=collection_archive---------6-----------------------#2022-06-12">https://betterprogramming.pub/native-modules-program-c-to-react-native-for-beginners-b0bc01e94c81?source=collection_archive---------6-----------------------#2022-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5fe0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">转换C库以反应本机</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7a349d7eef05511d38290d876b62ac93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rt_af4dumBItxV22oJ22Nw.png"/></div></div></figure><p id="95f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文的目的是帮助初学者在第一次使用本机模块时节省时间。由于我们将会看到很多移动C库，作为一名开发者，你必须将它们转换到iOS或react原生平台。</p><p id="a5a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了继续我的原生模块列表，我写了这篇文章来描述我们如何从C语言包装和导出一个函数，以在移动开发中进行原生反应。像往常一样，我们从一个新的react原生应用开始。</p><h1 id="06a4" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><strong class="ak"> 1。创建新的react原生应用</strong></h1><p id="afac" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">打开您的终端并运行:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="f226" class="mp lo iq ml b gy mq mr l ms mt">npx react-native init NativeModules</span></pre><h1 id="85f1" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><strong class="ak"> 2。打开Xcode </strong></h1><p id="9603" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">现在导航到:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="1cab" class="mp lo iq ml b gy mq mr l ms mt">NativeModules/ios/NativeModule.xcworkspace</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/b8bc91f4896e7fddd9e070b5a8401bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ymK7FyL4kxqLDO4M.png"/></div></div></figure><h1 id="2bb6" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><strong class="ak"> 3。创建一个C文件</strong></h1><p id="4b72" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们创建一个新的文件夹并创建一个新的c文件<code class="fe mv mw mx ml b">C_to_RN.c</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/cd9f435d42f1405e3241528aada773c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RI-7POafHIO_VsJ2eV6xwQ.png"/></div></div></figure><p id="fa33" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们点按“下一步”时，Xcode会要求我们创建一个头文件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/db3835651f5baed5269f4bed475293ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qayTKWyXpwCM-3fPEIlRrA.png"/></div></div></figure><p id="ce60" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将首先从<code class="fe mv mw mx ml b">C_to_RN.c</code>开始，编写一个简单的函数:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="977c" class="mp lo iq ml b gy mq mr l ms mt">// <strong class="ml ir"><em class="na">C_to_RN.c</em></strong></span><span id="ad78" class="mp lo iq ml b gy nb mr l ms mt">long factorial(int n) {    <br/>  if (n == 0 || n == 1) return 1;    <br/>  return n * factorial(n-1);<br/>}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/81f230e7d6b7cdb4f07781ffaa462cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Euwp93L4qVeerViS5hcK_g.png"/></div></div></figure><p id="69bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">继续，我们把这个函数放到头文件中:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="14a4" class="mp lo iq ml b gy mq mr l ms mt">// <strong class="ml ir"><em class="na">C_to_RN.h</em></strong></span><span id="4fb5" class="mp lo iq ml b gy nb mr l ms mt"><strong class="ml ir">long</strong> factorial(<strong class="ml ir">int</strong> n);</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/0c98355f84e1ddf27c777a7e838f99db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7hwTS2U3XfEDc05uY1292A.png"/></div></div></figure><h1 id="eb21" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><strong class="ak"> 4。将“<em class="ne"> C_to_RN.c”中的“factorial”函数包装到Swift文件</em> </strong></h1><ul class=""><li id="d067" class="nf ng iq kt b ku mf kx mg la nh le ni li nj lm nk nl nm nn bi translated">创建一个新的swift文件，并将其命名为<code class="fe mv mw mx ml b">C_to_RN.swift</code></li><li id="3780" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">创建新的swift文件时，Xcode会像我们一样创建<code class="fe mv mw mx ml b">NativeModules-Bridging-Header.h</code></li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/8f58b3dcd500a232356b0af1829b2547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oqDxlv6PX4rgWS8j4sH6dw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/0c7e80711e7ae3088022d4c90a1ee86b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*spXL-UClungiDvAaZ1ciLg.png"/></div></div></figure><p id="6d49" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，在swift文件中，我们声明一个<code class="fe mv mw mx ml b">C_to_RN</code> <strong class="kt ir"> <em class="na"> </em> </strong>类为<code class="fe mv mw mx ml b">NSObject</code>，并将这个类导出到Objective-C文件(我们将在下一步创建)<code class="fe mv mw mx ml b">@objc(C_to_RN)</code> <strong class="kt ir">。</strong></p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="fe72" class="mp lo iq ml b gy mq mr l ms mt">// <strong class="ml ir"><em class="na">C_to_RN.swift</em></strong></span><span id="da32" class="mp lo iq ml b gy nb mr l ms mt"><strong class="ml ir">@objc(C_to_RN)<br/>class</strong> C_to_RN : NSObject {</span><span id="4ef5" class="mp lo iq ml b gy nb mr l ms mt">}</span></pre><p id="55ea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，编写两个函数:</p><ul class=""><li id="0db6" class="nf ng iq kt b ku kv kx ky la nv le nw li nx lm nk nl nm nn bi translated">以防止我们运行react本机应用程序时出现警告。</li><li id="b91b" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">从<code class="fe mv mw mx ml b">C_to_RN.c</code>包装一个“阶乘”函数</li></ul><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="865a" class="mp lo iq ml b gy mq mr l ms mt">// <strong class="ml ir"><em class="na">C_to_RN.swift</em></strong></span><span id="e0d0" class="mp lo iq ml b gy nb mr l ms mt"><strong class="ml ir">@objc</strong> <strong class="ml ir">static</strong> <strong class="ml ir">func</strong> requiresMainQueueSetup() -&gt; Bool {<strong class="ml ir">return</strong> <strong class="ml ir">false </strong>}</span><span id="fbb2" class="mp lo iq ml b gy nb mr l ms mt"><strong class="ml ir">@objc</strong> <strong class="ml ir">func</strong> WrapFactorial(<strong class="ml ir">_</strong> num:(Int), callback: RCTResponseSenderBlock) {</span><span id="fc4a" class="mp lo iq ml b gy nb mr l ms mt">     callback([NSNull(), factorial(Int32(num)) <strong class="ml ir">as</strong> <strong class="ml ir">Any</strong>])</span><span id="0c1c" class="mp lo iq ml b gy nb mr l ms mt">}</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/569396338496b75f8317e352a6820003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bswM1jNq5fBeFFgMYCSQGg.png"/></div></div></figure><p id="545b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> 5。创建一个新的目标C文件，命名为"<em class="na"> C_to_RN.m" </em> </strong></p><p id="0511" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当然，如果我们想从Swift导出一个函数到React Native，我们需要通过Objective-C文件导出它。</p><p id="4bf2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你是一个没有Swift或Objective C经验的新生，请浏览我的主题，在这里:</p><p id="ef18" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如何将函数从Objective C导出到react-native:</p><div class="nz oa gp gr ob oc"><a href="https://medium.com/@WynneTran/native-modules-objective-c-to-react-native-for-beginners-9ec49ac5ca65" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">本机模块:Objective C为初学者反应本机。</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">为了继续与从事移动开发的初学者分享我关于本机模块的知识，这个…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq kp oc"/></div></div></a></div><p id="b6bd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如何从Swift文件中导出一个函数以反应本地:</p><div class="nz oa gp gr ob oc"><a href="https://medium.com/@WynneTran/native-modules-swift-to-react-native-for-beginners-ecfecd72c0a6" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">原生模块:Swift为初学者反应原生。</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">本文是为第一次使用本机模块的初学者编写的。虽然有很多方法可以…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq kp oc"/></div></div></a></div><p id="6d51" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">回到我们的任务，我们将创建一个新的Objective C文件，并从Swift文件中导出<code class="fe mv mw mx ml b">C_to_RN class</code>和<code class="fe mv mw mx ml b">WrapFactorial</code>函数。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="9649" class="mp lo iq ml b gy mq mr l ms mt">// <strong class="ml ir"><em class="na">C_to_RN.m</em></strong></span><span id="4652" class="mp lo iq ml b gy nb mr l ms mt">#import &lt;Foundation/Foundation.h&gt;<br/>#import &lt;React/RCTBridgeModule.h&gt;</span><span id="2944" class="mp lo iq ml b gy nb mr l ms mt"><strong class="ml ir">@interface</strong> RCT_EXTERN_MODULE(C_to_RN, NSObject)</span><span id="ad13" class="mp lo iq ml b gy nb mr l ms mt">RCT_EXTERN_METHOD(WrapFactorial: (<strong class="ml ir">int</strong>)num callback: (RCTResponseSenderBlock)callback;)</span><span id="dc0d" class="mp lo iq ml b gy nb mr l ms mt"><strong class="ml ir">@end</strong></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/1969e6b40687f2330e73207556e49577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6zplTERD_kWY7fx6iXpWQ.png"/></div></div></figure><h1 id="fbec" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><strong class="ak"> 6。桥接iOS原生(文件夹/模块C_to_RN)以反应原生</strong></h1><p id="a866" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">下一步是通过<code class="fe mv mw mx ml b">NativeModules-Bridging-Header.h</code>将iOS本地连接到react-native:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="d455" class="mp lo iq ml b gy mq mr l ms mt">// <strong class="ml ir"><em class="na">NativeModules-Bridging-Header.h</em></strong></span><span id="fdd5" class="mp lo iq ml b gy nb mr l ms mt">#import &lt;React/RCTBridgeModule.h&gt;</span><span id="8218" class="mp lo iq ml b gy nb mr l ms mt">#import “C_to_RN.h”</span></pre><h1 id="c58d" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><strong class="ak"> 7。从react-native端调用C_to_RN native模块</strong></h1><p id="31ff" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">回到react原生应用程序，打开<code class="fe mv mw mx ml b">App.js</code>文件并编写一些代码来获取用户输入和一个按钮来运行该功能。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="21b2" class="mp lo iq ml b gy mq mr l ms mt">// <strong class="ml ir"><em class="na">App.js</em></strong></span><span id="f12f" class="mp lo iq ml b gy nb mr l ms mt">import React, {useState} from 'react';<br/>import {StyleSheet, Text, View, TextInput, Alert} from 'react-native';<br/>import {NativeModules, Button} from 'react-native';</span><span id="2dfe" class="mp lo iq ml b gy nb mr l ms mt">const App = () =&gt; {<br/>  const [number, setNumber] = useState('');<br/>  const onPress = (num: any) =&gt; {<br/>    const {C_to_RN} = NativeModules;<br/>    if (parseInt(num)) {<br/>      C_to_RN.WrapFactorial(parseInt(num), (_err, res) =&gt; console.log(res));<br/>    } else {<br/>      Alert.alert('Please enter a digit');<br/>    }<br/>  };<br/>  return (<br/>    &lt;View style={styles.container}&gt;<br/>      &lt;Text&gt; Practice !&lt;/Text&gt;<br/>      &lt;TextInput<br/>        style={{width: '50%', height: 40, borderBottomColor: 'black'}}<br/>        onChangeText={e =&gt; setNumber(e)}<br/>        value={number}<br/>        placeholder={'Input here'}<br/>      /&gt;<br/>      &lt;Button<br/>        title="C to React Native"<br/>        color="#841584"<br/>        onPress={() =&gt; onPress(number)}<br/>      /&gt;<br/>    &lt;/View&gt;<br/>  );<br/>};<br/>const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    justifyContent: 'center',<br/>    alignItems: 'center',<br/>  },<br/>});<br/>export default App;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/40cd085ca293e429cbec587b7a052ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OxbY8-Mx5wWP3e4DOuvFSA.png"/></div></div></figure><p id="f7c3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们完成了，让我们运行我们的应用程序，看看结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/73f8dcbc43d3023627b509bc8bbb16e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EKu26IVZnT_Fv_3qnaGZSA.png"/></div></div></figure><p id="48ad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，谢谢你看我的文章。</p></div></div>    
</body>
</html>