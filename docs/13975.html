<html>
<head>
<title>Create a Wikipedia Question-Answering App With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python创建一个维基百科问答应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-wikipedia-question-answering-app-with-python-2401e1789d6c?source=collection_archive---------5-----------------------#2022-10-21">https://betterprogramming.pub/create-a-wikipedia-question-answering-app-with-python-2401e1789d6c?source=collection_archive---------5-----------------------#2022-10-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d4bc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">有趣项目的逐步指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/71865c7b1c4d19186f43a0f9550dce93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uoCWFa3zbsXg1RPx"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">罗伯特·林德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="1144" class="lb lc iq kx b gy ld le l lf lg">Table of Contents</span><span id="854d" class="lb lc iq kx b gy lh le l lf lg"><a class="ae kv" href="#ade3" rel="noopener ugc nofollow">Prerequisites</a></span><span id="fd1e" class="lb lc iq kx b gy lh le l lf lg"><a class="ae kv" href="#3748" rel="noopener ugc nofollow">Demo of What we are Going to Build</a></span><span id="9b94" class="lb lc iq kx b gy lh le l lf lg"><a class="ae kv" href="#384c" rel="noopener ugc nofollow">Project Setup</a></span><span id="48a3" class="lb lc iq kx b gy lh le l lf lg"><a class="ae kv" href="#20b8" rel="noopener ugc nofollow">Parsing Wikipedia Data With Beautiful Soup</a></span><span id="1d31" class="lb lc iq kx b gy lh le l lf lg"><a class="ae kv" href="#399d" rel="noopener ugc nofollow">Performing Questioning and Answering With Transformers</a></span><span id="33dd" class="lb lc iq kx b gy lh le l lf lg"><a class="ae kv" href="#15ae" rel="noopener ugc nofollow">Creating a Frontend User Interface With Streamlit</a></span></pre><h1 id="ade3" class="li lc iq bd lj lk ll lm ln lo lp lq lr jw ls jx lt jz lu ka lv kc lw kd lx ly bi translated">先决条件</h1><p id="23af" class="pw-post-body-paragraph lz ma iq mb b mc md jr me mf mg ju mh mi mj mk ml mm mn mo mp mq mr ms mt mu ij bi translated">您应该对Python和用Python创建环境有一些基本的经验。虽然我会详细讨论所有步骤，但是您将受益于以前使用任何命令行界面(CLI)的经验、Git版本控制知识以及一些HTML和CSS知识。您还需要一个代码编辑器。我使用了<a class="ae kv" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VSCode </a>作为我的编辑器。我用VSCode的<a class="ae kv" href="https://code.visualstudio.com/docs/editor/command-line" rel="noopener ugc nofollow" target="_blank">终端窗口</a>作为我的CLI。</p><h1 id="3748" class="li lc iq bd lj lk ll lm ln lo lp lq lr jw ls jx lt jz lu ka lv kc lw kd lx ly bi translated">我们将要构建的演示</h1><p id="f0a5" class="pw-post-body-paragraph lz ma iq mb b mc md jr me mf mg ju mh mi mj mk ml mm mn mo mp mq mr ms mt mu ij bi translated">我们的维基百科问答应用程序的演示如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/8b34a3aa06ef626cf20f77e11b06784d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CsprFFMowlre_oGhzQD_dQ.gif"/></div></div></figure><p id="7a67" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">我们将首先在左上角的输入中提供一个维基百科文章的URL。一旦我们提供了这个输入并按下回车键，文章将被加载到屏幕左侧的URL输入下方。在我们上面的演示中，我们使用了'<a class="ae kv" href="https://en.wikipedia.org/wiki/Legume" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Legume</a>'文章的URL。</p><p id="fec7" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">然后，我们可以在右侧的右上角的文本输入中提出一个问题。我们问的问题是，“豆类富含什么？”。当我们按enter键时，应用程序会找到三个答案及其相对分数。该应用程序还会突出显示每个答案的答案，并显示答案在文章中出现的部分。</p><p id="0a63" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">现在让我们来看看如何创建这个应用程序。</p><h1 id="384c" class="li lc iq bd lj lk ll lm ln lo lp lq lr jw ls jx lt jz lu ka lv kc lw kd lx ly bi translated">项目设置</h1><h2 id="4ff8" class="lb lc iq bd lj nb nc dn ln nd ne dp lr mi nf ng lt mm nh ni lv mq nj nk lx nl bi translated">计算机编程语言</h2><p id="fead" class="pw-post-body-paragraph lz ma iq mb b mc md jr me mf mg ju mh mi mj mk ml mm mn mo mp mq mr ms mt mu ij bi translated">您需要在系统上安装Python。可以按照官方<a class="ae kv" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank">文档</a>安装Python。我安装了<a class="ae kv" href="https://www.python.org/downloads/release/python-3107/" rel="noopener ugc nofollow" target="_blank"> Python 3.10.7 </a>来创建这篇文章。安装后，您可以在命令行中使用“python — version”命令检查Python的版本。</p><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="cd97" class="lb lc iq kx b gy ld le l lf lg">vscode ➜ /workspace $ python --version <br/>Python 3.10.7</span></pre><h2 id="e508" class="lb lc iq bd lj nb nc dn ln nd ne dp lr mi nf ng lt mm nh ni lv mq nj nk lx nl bi translated">饭桶</h2><p id="12d0" class="pw-post-body-paragraph lz ma iq mb b mc md jr me mf mg ju mh mi mj mk ml mm mn mo mp mq mr ms mt mu ij bi translated">您需要在系统上安装git。你可以从官方文档<a class="ae kv" href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" rel="noopener ugc nofollow" target="_blank">这里</a>安装git。安装完成后，您可以在下面查看git的版本:</p><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="e881" class="lb lc iq kx b gy ld le l lf lg">vscode ➜ /workspace $ git --version<br/>git version 2.38.0</span></pre><p id="8d87" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">对于本文，我已经创建了一个<a class="ae kv" href="https://github.com/MausamGaurav/NLP_Wikipedia_QnA_App" rel="noopener ugc nofollow" target="_blank"> git存储库</a>，其中包含了本文中使用的全部代码。您应该使用‘git clone&lt;repository&gt;命令克隆这个存储库，如下所示。</p><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="aa09" class="lb lc iq kx b gy ld le l lf lg">vscode ➜ /workspace $ git clone <a class="ae kv" href="https://github.com/MausamGaurav/NLP_Wikipedia_QnA_App.git" rel="noopener ugc nofollow" target="_blank">https://github.com/MausamGaurav/NLP_Wikipedia_QnA_App.git</a><br/>Cloning into 'NLP_Wikipedia_QnA_App'...<br/>remote: Enumerating objects: 15, done.<br/>remote: Counting objects: 100% (15/15), done.<br/>remote: Compressing objects: 100% (9/9), done.<br/>remote: Total 15 (delta 4), reused 15 (delta 4), pack-reused 0<br/>Receiving objects: 100% (15/15), 472.47 KiB | 5.43 MiB/s, done.<br/>Resolving deltas: 100% (4/4), done.</span></pre><p id="2143" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">下面是我们的应用程序的结构，就像它在克隆的存储库中的样子。有两个文件叫做<code class="fe nm nn no kx b">Pipfile</code>和<code class="fe nm nn no kx b">Pipfile.lock</code>。这些文件包含我们的文章所需的所有包的信息。我们应用程序的代码包含在一个名为<code class="fe nm nn no kx b">src</code>的文件夹中。</p><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="46b5" class="lb lc iq kx b gy ld le l lf lg">.<br/>├── Pipfile<br/>├── Pipfile.lock<br/>└── src<br/>    ├── __init__.py<br/>    ├── app.py<br/>    ├── logo.png<br/>    └── wikipedia.py</span></pre><h2 id="031c" class="lb lc iq bd lj nb nc dn ln nd ne dp lr mi nf ng lt mm nh ni lv mq nj nk lx nl bi translated">Pipenv</h2><p id="9642" class="pw-post-body-paragraph lz ma iq mb b mc md jr me mf mg ju mh mi mj mk ml mm mn mo mp mq mr ms mt mu ij bi translated">对于本文，我已经使用<code class="fe nm nn no kx b">pipenv</code>创建了一个python环境。你可以从官方文件<a class="ae kv" href="https://pipenv.pypa.io/en/latest/" rel="noopener ugc nofollow" target="_blank">中了解更多关于<code class="fe nm nn no kx b">pipenv</code>的信息。对于本文，您需要执行几个步骤。</a></p><ul class=""><li id="b67f" class="np nq iq mb b mc mw mf mx mi nr mm ns mq nt mu nu nv nw nx bi translated">在CLI中，使用命令<code class="fe nm nn no kx b">pip install pipenv</code>在您的基本Python环境中安装<code class="fe nm nn no kx b">pipenv</code>。</li></ul><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="36ee" class="lb lc iq kx b gy ld le l lf lg">vscode ➜ /workspace $ pip install pipenv</span></pre><ul class=""><li id="986d" class="np nq iq mb b mc mw mf mx mi nr mm ns mq nt mu nu nv nw nx bi translated">为您的项目文件夹创建一个环境。导航到项目文件夹<code class="fe nm nn no kx b">NLP_Wikipedia_QnA_App</code>，它是在您从命令行克隆了上面的存储库之后创建的，并执行命令<code class="fe nm nn no kx b">pipenv shell</code>。</li></ul><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="6bf0" class="lb lc iq kx b gy ld le l lf lg">vscode ➜ /workspace $ cd NLP_Wikipedia_QnA_App/<br/>vscode ➜ /workspace/NLP_Wikipedia_QnA_App (master) $ pipenv shell<br/>Launching subshell in virtual environment...<br/> . /home/vscode/.local/share/virtualenvs/NLP_Wikipedia_QnA_App-ThmWYYmN/bin/activate<br/>vscode ➜ /workspace/NLP_Wikipedia_QnA_App (master) $  . /home/vscode/.local/share/virtualenvs/NLP_Wikipedia_QnA_App-ThmWYYmN/bin/activate<br/>(NLP_Wikipedia_QnA_App) vscode ➜ /workspace/NLP_Wikipedia_QnA_App (master) $</span></pre><p id="0629" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">这将为您的项目创建一个虚拟环境。我们可以通过执行<code class="fe nm nn no kx b">pipenv install</code>简单地安装所有需要的Python库。这使用<code class="fe nm nn no kx b">Pipfile.lock</code>来安装所有需要的库。</p><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="2d40" class="lb lc iq kx b gy ld le l lf lg">(NLP_Wikipedia_QnA_App) vscode ➜ /workspace/NLP_Wikipedia_QnA_App (master) $ pipenv install<br/>Installing dependencies from Pipfile.lock (c1f875)...</span></pre><p id="794f" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">我们的项目使用的主要库如下:</p><ol class=""><li id="594b" class="np nq iq mb b mc mw mf mx mi nr mm ns mq nt mu ny nv nw nx bi translated">Streamlit: Streamlit是数据科学社区中一个流行的框架，用于为各种数据科学项目搭建前端。你可以在这里了解更多关于Streamlit <a class="ae kv" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank">的信息。这很容易学。</a></li><li id="608a" class="np nq iq mb b mc nz mf oa mi ob mm oc mq od mu ny nv nw nx bi translated">美汤:美汤是一个python库，可以快速解析网页的HTML内容。图书馆的官方文档在这里<a class="ae kv" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank"/>。在本文中，我们将使用内置的Python“requests”库来获取网页的HTML内容，然后使用Beautiful Soup来解析HTML内容。</li><li id="2b26" class="np nq iq mb b mc nz mf oa mi ob mm oc mq od mu ny nv nw nx bi translated">变形金刚:根据<a class="ae kv" href="https://huggingface.co/docs/transformers/index" rel="noopener ugc nofollow" target="_blank">官方文档</a>,“变形金刚提供API和工具来轻松下载和训练最先进的预训练模型。”脸书维护着变形金刚库，官方网站包含各种自然语言处理任务的预训练模型。对于本文，我们将使用一个预先训练好的<a class="ae kv" href="https://huggingface.co/models?pipeline_tag=question-answering&amp;sort=downloads" rel="noopener ugc nofollow" target="_blank">“问答”模型</a>。</li></ol><p id="9a6d" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">项目配置完成后，我们现在解释创建应用程序的步骤。</p><h1 id="20b8" class="li lc iq bd lj lk ll lm ln lo lp lq lr jw ls jx lt jz lu ka lv kc lw kd lx ly bi translated">用美汤解析维基百科数据</h1><p id="830a" class="pw-post-body-paragraph lz ma iq mb b mc md jr me mf mg ju mh mi mj mk ml mm mn mo mp mq mr ms mt mu ij bi translated">我们做的第一件事是获取给定维基百科文章URL的HTML。这可以通过使用内置<code class="fe nm nn no kx b">requests</code>模块的get方法来实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="27cd" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">然后我们使用Beautiful Soup解析页面内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="4b94" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">我们可以编写一个名为<code class="fe nm nn no kx b"><em class="og">get_soup</em></code>的函数来实现这一点，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="0582" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">一旦有了汤，我们就可以遍历维基百科文章中的所有HTML标签。我们的目标是挑选维基百科文章的所有部分。我所说的节是指标题和该节中的后续段落。如果您在浏览器中打开维基百科的URL并检查文章的源代码，您会看到所有的标题都包含在HTML标记中，如<code class="fe nm nn no kx b">h1</code>、<code class="fe nm nn no kx b">h2</code>、…、<code class="fe nm nn no kx b">h6</code>，所有的段落都包含在<code class="fe nm nn no kx b">p</code>标记中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/f0dd713885eafbfab05a5c5b7dcb1c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gi620tHAemN7gnqKyeJt-A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="c792" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">对于每一段，内容都不直截了当。大多数情况下，段落包含更多的HTML标记来设置段落文本的样式。请参见下面的示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/54c0fa8731013484a10ae35b54f89d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TUWHDUyLMYznPz_111cfeQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="1555" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">因此，我们需要编写一个类似下面的函数来整理给定段落的所有子标签的内容。注意，在下面，参数<code class="fe nm nn no kx b">p</code>需要是一个使用Beautiful Soup提取的标签。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="9086" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">我还编写了一个函数来删除方括号中的所有数字<code class="fe nm nn no kx b">[]</code>，并从维基百科文本中删除<code class="fe nm nn no kx b">[edit]</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="44a4" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">我们希望创建一个包含标题和段落内容的所有部分的列表。正如已经解释过的，一个标题后面可以跟着多个段落，所以一旦我们发现一个标题后面有一个段落，我们就寻找后面的段落，直到我们到达该部分的结尾(也就是说，我们找不到任何其他后面的标题)。为了实现这一点，我们创建了一个名为<code class="fe nm nn no kx b">get_wiki_extract</code>的函数，如下面代码片段的底部所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="72e1" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">在上面的<code class="fe nm nn no kx b">get_wiki_extract</code>函数中，我们使用<code class="fe nm nn no kx b">soup.find_all()</code>函数遍历所有标签。然后我们检查标签是否是一个标题，并且那个部分不是“内容”部分。我们会整理标题后面所有段落的文本，直到到达节尾。我们在一个名为<code class="fe nm nn no kx b">section</code>的列表中存储小节信息——清除的标题、标题标签和清除的段落文本。然后，我们将所有部分添加到一个名为<code class="fe nm nn no kx b">wiki_extract</code>的主列表中。该函数返回这个主列表。</p><p id="63fe" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">为了演示这个函数的作用，我们对URL '<a class="ae kv" href="https://en.wikipedia.org/wiki/Legume'" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Legume</a>'运行上面的函数并打印输出。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="ebe8" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">如果我们检查输出，我们返回从维基百科文章解析的所有部分的列表。每个部分都包含标题、标题标签和段落内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="fb47" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">下一节讨论我们如何使用transformers库从提取的维基百科文章部分中寻找可能的答案。</p><h1 id="399d" class="li lc iq bd lj lk ll lm ln lo lp lq lr jw ls jx lt jz lu ka lv kc lw kd lx ly bi translated">用变形金刚表演问题和回答</h1><p id="3623" class="pw-post-body-paragraph lz ma iq mb b mc md jr me mf mg ju mh mi mj mk ml mm mn mo mp mq mr ms mt mu ij bi translated">我们将使用变形金刚库来执行问答。首先我们去官方<a class="ae kv" href="https://huggingface.co/" rel="noopener ugc nofollow" target="_blank">抱脸网站</a>选择一个合适的<a class="ae kv" href="https://huggingface.co/models?pipeline_tag=question-answering&amp;sort=downloads" rel="noopener ugc nofollow" target="_blank">问答预训模型</a>。在我们的例子中，我们使用<a class="ae kv" href="https://huggingface.co/deepset/roberta-base-squad2" rel="noopener ugc nofollow" target="_blank">‘Roberta-base-squad 2’</a>模型。</p><p id="55b9" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">这个模型使用起来很简单。我们首先下载预训练的模型，并使用<code class="fe nm nn no kx b">transformers</code>库中的<code class="fe nm nn no kx b">pipeline</code>对象将其加载到内存中。然后我们为加载的模型提供一个<code class="fe nm nn no kx b">question</code>和一个<code class="fe nm nn no kx b">context</code>。就是这样。该模型将预测答案、答案在上下文中的开始和结束位置以及预测的相对分数。这方面的演示如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="053c" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">上面的结果如下:</p><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="79fd" class="lb lc iq kx b gy ld le l lf lg"># Output<br/>{'score': 0.30402547121047974,<br/> 'start': 548,<br/> 'end': 562,<br/> 'answer': 'plant proteins'}</span></pre><p id="cf3b" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">对于给定的问题和上下文，我们得到一个答案<code class="fe nm nn no kx b">plant proteins</code>,它带有一个分数以及在所提供的上下文中的开始和结束位置。</p><p id="7d88" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">我们可以使用上述策略遍历维基百科文章的每一部分，找到一个可能的答案。为此，我们创建了一个名为<code class="fe nm nn no kx b">get_answers</code>的函数，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="385c" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">如果我们运行上面的函数，这将返回一个答案列表。该列表中的每个答案都是一个字典，包含部分标题、部分标题HTML标记、段落和预测结果，即分数、开始和结束位置以及答案。从上面返回的带有示例URL和示例问题的答案列表对象如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="129e" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">我们可以在维基百科文章的不同部分预测答案。现在，我们需要以人类可读的格式呈现这些预测。</p><p id="62b1" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">为此，我们希望只显示得分最高的前n个预测。我们可以通过将从上面的<code class="fe nm nn no kx b">get_answers</code>函数返回的answers对象转换成一个<a class="ae kv" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a> dataframe，并使用<code class="fe nm nn no kx b">nlargest</code>方法按分数对dataframe进行排序来实现这一点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="46cc" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">例如，如果我们使用值为3的<code class="fe nm nn no kx b">top_n</code>,我们将得到下面的数据帧作为输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/e2e00c158dbe94269d427bd4817e1bd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8X-_sucDNY60WI6-ElHWDQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="f379" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">接下来，对于顶部<code class="fe nm nn no kx b">n</code>答案中的每个答案，我们希望在相应的维基百科部分中突出显示该答案，以便用户可以看到该答案的上下文。我们也在维基百科的相应部分显示答案和分数。</p><p id="e45d" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">这可以通过遍历上面创建的数据框架并使用特定的HTML和CSS样式来格式化部分和答案来实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="833a" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">从上面的代码生成的HTML在呈现时将如下所示。现在，答案的格式更易于阅读。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/8686594c8f10b8f5f57b8868d7184854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a9HQgVhXwI2sGAUtgb05UA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="7270" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">获得前n个答案并将答案格式化为人类可读格式的上述功能可以通过一个函数<code class="fe nm nn no kx b">get_html_answers</code>来实现。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="3a67" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">本节之前的所有Python代码都被封装在一个名为<code class="fe nm nn no kx b">wikipedia.py</code>的模块中，该模块位于我们项目文件夹的<code class="fe nm nn no kx b">src</code>目录中。这个模块位于git库的<a class="ae kv" href="https://github.com/MausamGaurav/NLP_Wikipedia_QnA_App/blob/master/src/wikipedia.py" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="ec7b" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">在下一节中，我们将讨论如何创建一个前端UI来给我们的应用程序一个最终的形状。</p><h1 id="15ae" class="li lc iq bd lj lk ll lm ln lo lp lq lr jw ls jx lt jz lu ka lv kc lw kd lx ly bi translated">使用Streamlit创建前端用户界面</h1><p id="64a3" class="pw-post-body-paragraph lz ma iq mb b mc md jr me mf mg ju mh mi mj mk ml mm mn mo mp mq mr ms mt mu ij bi translated">前端的代码在<code class="fe nm nn no kx b">src</code>文件夹的<code class="fe nm nn no kx b">app.py</code>文件中。</p><p id="827e" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">我们首先导入<code class="fe nm nn no kx b">streamlit</code>，然后使用<code class="fe nm nn no kx b">streamlit.set_page_config()</code>方法设置页面的配置。我们设置页面标题，为页面提供一个favicon，并将Streamlit应用程序的布局设置为wide。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="e76b" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">当应用程序在浏览器中运行时，上面将创建页面标题和favicon。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/d606e17425594c337b1ba8ba558b7fbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*2PWud7k87GFwvvsL2d1fHg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="6178" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">然后我们使用一些CSS和HTML来创建应用程序标题。CSS和HTML可以使用<code class="fe nm nn no kx b">streamlit.markdown()</code>方法来呈现。注意，在下面的HTML中，我们打开了<code class="fe nm nn no kx b">src</code>文件夹中的<code class="fe nm nn no kx b">logo.png</code>图像，并使用内置的<code class="fe nm nn no kx b">base64</code> Python库对其进行渲染。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="3384" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">上面的代码会产生下面的应用程序标题。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/e93aa9fe95dac53d24c45523c64a813d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*npis3bwtQswrM-Ll5O4W0g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="624e" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">然后我们在应用程序中添加两个<code class="fe nm nn no kx b">streamlit</code>栏，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="4d02" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">在第一列中，我们添加了<code class="fe nm nn no kx b">streamlit</code>文本输入。文本输入将包含维基百科文章的URL。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="7b96" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">当用户在URL文本输入中输入URL时，该URL被传递给文本输入下面的iframe对象。iframe呈现维基百科文章。</p><p id="0a36" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">在第二列中，我们为问题添加了一个文本输入。在这下面，我们添加一个旋转器。微调器将一直运行，直到我们的代码可以从维基百科文章中获得答案。我们需要导入前面创建的<code class="fe nm nn no kx b">wikipedia.py</code>模块来寻找答案。微调器将显示<code class="fe nm nn no kx b">Finding answer…</code>，直到来自<code class="fe nm nn no kx b">wikipedia.py</code>模块的函数<code class="fe nm nn no kx b">get_html_answers</code>完成处理维基百科文章以提供可能的答案。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="9c1b" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">就是这样。我们的Streamlit应用程序随时可用。<code class="fe nm nn no kx b">app.py</code>文件的内容如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="7656" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">要从CLI运行我们的应用程序，我们只需切换到<code class="fe nm nn no kx b">src</code>目录并运行命令<code class="fe nm nn no kx b">streamlit run app.py</code>。</p><pre class="kg kh ki kj gt kw kx ky kz aw la bi"><span id="226b" class="lb lc iq kx b gy ld le l lf lg">(NLP_Wikipedia_QnA_App) vscode ➜ /workspace/NLP_Wikipedia_QnA_App (master ✗) $ cd src<br/>(NLP_Wikipedia_QnA_App) vscode ➜ /workspace/NLP_Wikipedia_QnA_App/src (master ✗) $ streamlit run app.py</span><span id="073c" class="lb lc iq kx b gy lh le l lf lg">Collecting usage statistics. To deactivate, set browser.gatherUsageStats to False.</span><span id="71e3" class="lb lc iq kx b gy lh le l lf lg">You can now view your Streamlit app in your browser.</span><span id="abed" class="lb lc iq kx b gy lh le l lf lg">Network URL: <a class="ae kv" href="http://172.18.0.2:8501" rel="noopener ugc nofollow" target="_blank">http://localhost:8501</a><br/>External URL: <a class="ae kv" href="http://152.37.88.161:8501" rel="noopener ugc nofollow" target="_blank">http://152.37.88.161:8501</a></span></pre><p id="ba61" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">一旦上面的命令完成，我们在浏览器中打开URL <code class="fe nm nn no kx b"><a class="ae kv" href="http://localhost:8501" rel="noopener ugc nofollow" target="_blank">http://localhost:8501</a></code>，我们的维基百科问答应用程序应该启动并运行了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/c8c8c74cc371302f78702eea8d1ec95d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yPBx-kkZJKtE-zMbafUvkA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="e3df" class="pw-post-body-paragraph lz ma iq mb b mc mw jr me mf mx ju mh mi my mk ml mm mz mo mp mq na ms mt mu ij bi translated">我希望你喜欢这篇文章！</p></div></div>    
</body>
</html>