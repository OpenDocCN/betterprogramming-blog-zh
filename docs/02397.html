<html>
<head>
<title>How To Keep Your Font Awesome Pro Secret Token in Public GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在公共GitHub动作中保持你的字体Awesome Pro Secret令牌</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-keep-secret-your-font-awesome-pro-token-in-public-github-actions-fd79792c510?source=collection_archive---------8-----------------------#2019-11-27">https://betterprogramming.pub/how-to-keep-secret-your-font-awesome-pro-token-in-public-github-actions-fd79792c510?source=collection_archive---------8-----------------------#2019-11-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eca6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">配置您的GitHub操作，使您的npm私有令牌保持秘密</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1e6ffc1d705ef0f039c094aea182debb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oASKWYL2zJdXrSghTn92PA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">塞尔坎·图尔克在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="865a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">昨天，<a class="ae ky" href="https://twitter.com/julienrenaux" rel="noopener ugc nofollow" target="_blank"> Julien Renaux </a>发表了一系列<a class="ae ky" href="https://twitter.com/julienrenaux/status/1199322520815583233" rel="noopener ugc nofollow" target="_blank">有趣的新博文。其中一次，他一步一步地展示了如何使用GitHub动作和Firebase主机 </a> <em class="lv">部署StencilJS应用。</em></p><p id="655e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个教程确实吸引了我的眼球，因为我们的web开源项目<a class="ae ky" href="https://deckdeckgo.com" rel="noopener ugc nofollow" target="_blank"> DeckDeckGo </a>的所有应用程序都是用<a class="ae ky" href="https://stenciljs.com" rel="noopener ugc nofollow" target="_blank"> StencilJS </a>开发的，并且托管在<a class="ae ky" href="https://firebase.google.com" rel="noopener ugc nofollow" target="_blank"> Firebase </a>上。</p><p id="ffd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，我不能等那么久，我必须试一试。</p><p id="ddde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为如果我使用一个CI来构建我们的演示编辑器，我将不得不做出一些改变，以不同的方式混淆生产令牌，所以我想我可以首先在当前的<a class="ae ky" href="https://ionicframework.com/docs/react" rel="noopener ugc nofollow" target="_blank"> Ionic React </a>演示应用程序中尝试他的配方，我正在为下周的<a class="ae ky" href="https://www.meetup.com/fr-FR/Ionic-Zurich/events/265767496/" rel="noopener ugc nofollow" target="_blank"> Meetup </a>开发这个应用程序。</p><p id="5625" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果，它只是无缝地工作。它运行得如此之好，设置如此之简单，以至于我认为我也可以快速地为我的网站设置另一个CI部署。</p><p id="9ab7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可惜没成。即使我的网站的技术和堆栈，用<a class="ae ky" href="https://www.gatsbyjs.org" rel="noopener ugc nofollow" target="_blank"> Gatsby </a>构建的，在某种程度上真的很像这个小应用，CI执行的构建失败了:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="5eb4" class="mb mc it lx b gy md me l mf mg">X Download Artifact<br/>  1 Run actions/download-artifact@master<br/>  2 with:<br/>  3    name: build<br/>  4 Download artifact 'build' to: '/home/runner/work/daviddalbusco.com/daviddalbusco.com/build'<br/>  5 <em class="lv">##[error]Artifact build was not found for build 2.<br/>  </em>6 <em class="lv">##[error]Exit code 1 returned from process: file name '/home/runner/runners/2.161.0/bin/Runner.PluginHost', arguments 'action "GitHub.Runner.Plugins.Artifact.DownloadArtifact, Runner.Plugins"'.</em></span></pre><p id="01a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">起初，我不明白错误。当然，我注意到一些工件无法下载，但我不知道这些是什么，根本原因是什么。</p><p id="5ad9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">过了一会儿，我终于想起来我曾经面对过另一个CI的类似问题。</p><p id="e672" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我的网站，我使用的是<a class="ae ky" href="https://fontawesome.com" rel="noopener ugc nofollow" target="_blank">字体Awesome </a>，特别是<code class="fe mh mi mj lx b">@fortawesome/pro-light-svg-icons</code>图标，只有在配置了我的相关字体Awesome Pro npm令牌的情况下才能使用。</p><p id="8d7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然文档清楚地解释了如何在本地配置令牌，但是它们没有(或者至少我一开始没有发现)提供一个示例来展示如何对公共存储库隐藏它。</p><p id="c513" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，这篇博文的目的。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="b11b" class="mr mc it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">配置npm注册表</h1><p id="ac48" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">字体Awesome npm令牌既可以全局设置，也可以按项目设置。我们需要用配置项构建我们的项目的方法是最后一种，“每个项目”。</p><p id="81c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们在项目的根目录下创建一个新文件<code class="fe mh mi mj lx b">.npmrc</code>。与文档相反，我们只在文件中分别添加一行，我们只添加对字体Awesome包管理器的引用。</p><p id="87ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们故意忽略指定任何关于令牌的内容。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="0e27" class="mb mc it lx b gy md me l mf mg">@fortawesome:registry=https://npm.fontawesome.com/</span></pre></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="318f" class="mr mc it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">在GitHub中设置新的秘密</h1><p id="09b3" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">由于我们在前面的文件中没有提供令牌，我们必须以不同的方式将它提供给GitHub动作，否则它仍然无法下载依赖项。</p><p id="335a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，GitHub已经提供了对环境变量保密的选项。因此，我们充分利用这个选项，为我们的字体Awesome npm令牌创建一个新的秘密。</p><p id="ebc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比如说，姑且称之为<code class="fe mh mi mj lx b">FONTAWESOME_NPM_AUTH_TOKEN</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/311f7ddcae4b8dfd8103443300754782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NVoURzVa2jn6uuvAKvo12Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为字体Awesome npm令牌设置GitHub秘密</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="a401" class="mr mc it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">使用CI中的秘密</h1><p id="e1e6" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">如果您已经学习了Julien的教程，那么您的CI工作流可能已经包含了从npm安装应用程序依赖项的下列内容:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="5c99" class="mb mc it lx b gy md me l mf mg">- name: Install Dependencies<br/>    run: npm ci</span></pre><p id="2349" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们问题的根源，因为npm不知道它必须用来下载特定工件的特定注册表和令牌。</p><p id="fb13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们最终将通过在安装之前运行命令行来解决这个问题，用我们的秘密令牌配置npm。</p><p id="9beb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管道(<code class="fe mh mi mj lx b">|</code>)让我们可以指定在同一个shell中运行的多个命令(参见<a class="ae ky" href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/workflow-syntax-for-github-actions#jobsjob_idstepsrun" rel="noopener ugc nofollow" target="_blank">文档</a>)。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="0c32" class="mb mc it lx b gy md me l mf mg">- name: Install Dependencies<br/>  run: |<br/>    npm config set '//npm.fontawesome.com/:_authToken' "${{ secrets.FONTAWESOME_NPM_AUTH_TOKEN }}"<br/>    npm ci</span></pre><p id="f4fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧，我们的CI现在应该能够下载所需的依赖项，从而构建和部署我们的项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/f878f90d8f616b7018256d3df23e5e3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0QAOSrrjgtLV5zywnA8sg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">成功的词，快乐的词</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="e856" class="mr mc it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="014d" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我的网站是开源的，可以在<a class="ae ky" href="https://github.com/peterpeterparker/daviddalbusco.com" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到，看看吧，用你自己的眼睛来验证这个解决方案。</p><p id="3fa2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到无限和更远的地方，</p><p id="05df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大卫</p></div></div>    
</body>
</html>