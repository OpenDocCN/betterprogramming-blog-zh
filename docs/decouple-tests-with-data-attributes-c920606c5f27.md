# 用数据属性解耦您的样式和测试

> 原文：<https://betterprogramming.pub/decouple-tests-with-data-attributes-c920606c5f27>

## 如何从测试中分离组件的样式

![](img/e744ceeb9e450593ecac9d1e8c342566.png)

[乔·塞拉斯](https://unsplash.com/@joaosilas?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍照

我给大家介绍一下我前阵子在开发大型前端应用时遇到的一个问题。

在我们的团队中，我们用 Angular 创建了可爱的组件。之后，我们的设计师通常会设计组件的样式或者更新它们以获得更好的用户体验。

然而，当我们在先前创建的功能上应用那些设计时，测试经常会失败。这导致了大量的时间损失，让开发人员和客户都感到沮丧。

这非常令人沮丧，因为我们没有测试造型。

那么，为什么我们的测试失败了呢？我们使用类选择器来识别代码中的元素。有时候，有些人会无意中使用一个选择器，这个选择器也被用来设计组件的样式。

当我们后来改变样式时，测试当然会失败。之前那么好用的 HTML 突然坏掉了。

这方面的一个例子是选择器`.container .message`，它变成了选择器`.container-fluid .message`，你可以在下面的要点中看到。

但另一方面，也没有什么能阻止设计者向我们测试使用的 CSS 添加样式。因此，这是一个双向的问题。

可能的样式更改示例:容器->容器-流体。

在我听到你想:“嗯，这不是测试驱动开发的最好例子，不是吗？”

嗯，你可能是对的。但是不要让这分散你对我们这里的问题的注意力。从某种意义上说，我们的 JavaScript 选择器和样式是强耦合的。

在这篇博文中，我会给你一个解决上述问题的方法。这个解决方案最初是我的一个同事的想法，我对此做了一些研究，以充分利用它。

如果你意识到你在测试代码中使用了`id`或`class`选择器来定位 HTML，确保你会读到最后。

# 让我向您介绍数据属性

解决方案都是关于数据属性的。你们中的一些人可能还没有听说过数据属性，所以我将给出一个快速的介绍来帮助你们了解。

任何属性名以`data-`开头的属性都是数据属性。例如，我们可以给我们的段落赋予数据属性 title。

之前的例子，带有数据属性"`data-message".`

这样做有以下优点。一方面，我们现在可以按照自己喜欢的方式使用 CSS 来设计组件的样式。另一方面，我们可以编写使用数据属性`data-angular="message"`来验证段落内容的测试。

这将我们的测试与组件的样式完全分离开来！哇，太棒了，对吧？

**备注**:是的，我知道你也可以使用数据属性来设计网页的样式。如果您这样做，请记住，您还没有实现真正的解耦。我对此也有一个解决方案，所以请继续阅读。

## 一个典型的例子

我将给出一个例子，说明在像 Angular 这样的语言中，如何在 JavaScript 或类型脚本代码中使用数据属性。

```
this.element.querySelector('[data-angular="message"]');
```

很简单，对吧？因为我们使用的是数据属性，所以看我们应用程序浏览器的人看不到它！这是非常整洁的。

那么，您不能创建一个特定的类前缀并在您的测试中使用它吗(例如`my-prefix-message`)？我们当然可以这样做，而且维护起来也很容易。还是这太明显了？

这让我想到，我们不能更进一步吗？在这两种解决方案(数据属性或类前缀)中，我们仍然有许多代码会留在生产中，但是我们根本不使用它们。运行时不能去掉吗？

# 在生产中消除数据属性

我们希望去掉每个仅用于测试目的的数据属性。这就是我之前使用 data-angular 的原因，如果你愿意，可以使用另一种命名方式。

例如，您可以很好地将数据属性`data-cy`用于 Cypress 测试。只要你在你的组织或项目中保持一致，你就会做得很好。

您可以编写一条指令，从生产代码中移除该属性。这样，在生产中，您将根本看不到任何测试数据属性。

这意味着在你完成测试后，产生的 HTML 会干净很多。我推荐使用这种方法。它很快而且影响有限。

如果您想在其他数据属性上做任何其他样式，那也很好。因为你是特定的(如`data-angular`)，你不应该有冲突问题。你实现了真正的脱钩。太棒了。

# 结论

上面的方法通过使用数据属性实现了测试代码与应用程序代码的分离。这对我个人有很大的好处，因为组件的样式有时是在功能创建之后完成的。

数据属性驱动方法使用指令在运行时删除数据属性。这隐藏了那些原本会在您的产品代码中显示的开发细节。