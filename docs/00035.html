<html>
<head>
<title>Testing Angular Components With @Input()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用@Input()测试角度组件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/testing-angular-components-with-input-3bd6c07cfaf6?source=collection_archive---------1-----------------------#2017-06-19">https://betterprogramming.pub/testing-angular-components-with-input-3bd6c07cfaf6?source=collection_archive---------1-----------------------#2017-06-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2ca3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">出于免费的故事？在https://aiko.dev/angular_test_input_decorator/<a class="ae ki" href="https://aiko.dev/angular_test_input_decorator/" rel="noopener ugc nofollow" target="_blank">免费获得这篇文章</a></h2></div><p id="61f9" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">本文涵盖了测试通过@Input()装饰器绑定输入的组件的多种方法</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/6745f4a4308ef5907ce570bc0394d8e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pRtZiOK9tHklgjK2nNAZ4A.png"/></div></div></figure><p id="10cf" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">(这篇文章的更新版本可以在<a class="ae ki" href="https://aiko.dev/angular_test_input_decorator/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。)</p><p id="f125" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">当开发一个接受输入的Angular(阅读Angular 2或Angular 4，或者当您阅读本文时的任何当前版本)组件时，您可能会决定对整个组件进行单元测试。至少我希望你有！</p><p id="e024" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">例如，我们有一个组件<code class="fe lr ls lt lu b">ComponentUnderTest</code>，在其中我们想要显示大写的输入…我知道这是一个多么好的用例，每个企业主都需要它！</p><p id="fbe5" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">所以，假设<code class="fe lr ls lt lu b">ComponentUnderTest</code>绑定并显示输入。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="d941" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为了验证<code class="fe lr ls lt lu b">processInput()</code>正确地大写了我们的输入，我们可以简单地给输入变量分配一个测试值，并断言，在调用该方法之后，显示的输入全部是大写的。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="f0da" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">很简单！对吗？</p><p id="3ea9" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">但是现在，我们需要手动调用<code class="fe lr ls lt lu b">processInput()</code>，直到我们调用它，我们的输入仍然以糟糕的小写显示。</p><p id="abe8" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">幸运的是，有了Angular的<code class="fe lr ls lt lu b">OnInit</code>生命周期挂钩，我们甚至可以在显示任何东西之前触发我们的<code class="fe lr ls lt lu b">processInput()</code>。所以我们来实现它，在相应的方法中调用<code class="fe lr ls lt lu b">processInput()</code>。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="7ac5" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">让我们进行测试！</p><p id="9bd2" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">哦不！测试失败了！</p><pre class="lg lh li lj gt lx lu ly lz aw ma bi"><span id="ce36" class="mb mc it lu b gy md me l mf mg">Cannot read property ‘toUpperCase’ of undefined</span></pre><p id="33d9" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">啊，当然，当在我们的<code class="fe lr ls lt lu b">ngOnInit()</code>中的输入上调用<code class="fe lr ls lt lu b">toUpperCase()</code>时，我们甚至还没有给它赋值。</p><p id="b405" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">当我们实际将组件嵌入到产品代码中时，我们将通过绑定组件标签中的输入来设置<code class="fe lr ls lt lu b">input</code>的值。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="9e3e" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">所以让我们将<code class="fe lr ls lt lu b">ComponentUnderTest</code>嵌入到<code class="fe lr ls lt lu b">TestHostComponent</code>中。通过实际拥有一个主机或父组件，我们能够准确地传递测试所需的输入。</p><p id="3890" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在我们的测试中，我们可以简单地定义这个<code class="fe lr ls lt lu b">TestHostComponent</code>，将它包含在测试模块配置中，并在我们的<code class="fe lr ls lt lu b">beforeEach</code>方法中实例化它。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="dbd6" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">什么结果是绿色测试，输入在开始时是大写的。</p><p id="208a" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">然而，我们真的能确定输入是大写的，并且我们的组件不总是显示“输入文本”吗？让我们编写另一个测试，它支持“不同的测试输入”。</p><p id="9f6f" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们可以做的是定义另一个<code class="fe lr ls lt lu b">TestHostComponent</code>来绑定另一个输入，但是我们可以做得更好！</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="31f4" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><code class="fe lr ls lt lu b">setInput()</code>在我们的主机组件中设置输入。在让Angular检测变化之前，在我们的测试中分配输入允许我们的两个测试都通过..</p><p id="c51a" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">现在，假设我们必须将不止一个而是多个输入绑定到组件。我们现在需要为每个输入编写一个setter方法吗？</p><p id="959f" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">幸运的是，答案是否定的！</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="9bda" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">除了设置器，我们还可以从主机组件中获取对组件的引用，并将其传递到我们的测试中。在那里，我们可以完全控制我们的组件，并可以修改我们想要的任何字段。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="17a8" class="mo mc it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">摘要</h1><ul class=""><li id="f45e" class="nf ng it kl b km nh kp ni ks nj kw nk la nl le nm nn no np bi translated">为了测试通过<code class="fe lr ls lt lu b">@Input()</code>装饰器绑定输入的组件，我们可以在测试中创建一个主机组件来包装我们的测试组件。</li><li id="22d2" class="nf ng it kl b km nq kp nr ks ns kw nt la nu le nm nn no np bi translated">对于多个测试输入，我们可以向我们的主机组件添加一个setter。</li><li id="16cb" class="nf ng it kl b km nq kp nr ks ns kw nt la nu le nm nn no np bi translated">对于一个以上的输入绑定，甚至对于测试中的组件的更多控制，我们可以用<code class="fe lr ls lt lu b">@ViewChild</code>从主机组件中获取它，并将其直接传递到我们的测试中。</li></ul><p id="e6f2" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">完整的源代码可以在<a class="ae ki" href="https://github.com/AikoPath/ComponentInputTest" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><a href="https://ko-fi.com/G2G5BKVAB"><div class="gh gi nv"><img src="../Images/f1553c88c61d1fa0f54648e89f8a9acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WLDZL2CnDQBnbItN.png"/></div></a><p class="nw nx gj gh gi ny nz bd b be z dk translated">在<a class="ae ki" href="https://ko-fi.com/G2G5BKVAB" rel="noopener ugc nofollow" target="_blank">https://ko-fi.com/G2G5BKVAB</a>支持我</p></figure></div></div>    
</body>
</html>