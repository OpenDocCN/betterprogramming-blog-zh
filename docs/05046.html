<html>
<head>
<title>How to Prevent Git Commit Naming Mistakes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何防止Git提交命名错误</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-prevent-git-commit-naming-mistakes-a34c8a7c6ae6?source=collection_archive---------6-----------------------#2020-06-03">https://betterprogramming.pub/how-to-prevent-git-commit-naming-mistakes-a34c8a7c6ae6?source=collection_archive---------6-----------------------#2020-06-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7b7e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">每次使用Git钩子时，抛出一个安全网</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5024389577e05fe8c942d1b41b77510e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*21xNCoRhStuuukMA"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@praveesh?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Praveesh Palakeel </a>拍摄的照片。</p></figure><p id="d673" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用Git已经很多年了，但我还远远没有完全了解它。然而，我觉得每次遇到问题，Git都有答案。最近，我一直在想，我们如何才能消除在提交消息前加上<a class="ae ky" href="https://www.atlassian.com/software/jira" rel="noopener ugc nofollow" target="_blank">吉拉</a>票号的无聊。</p><p id="ab21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我一直觉得命名我的分支和提交消息很乏味。尽管如此，我总是努力尊重命名惯例。它们对于保持正确的版本控制和帮助你的队友寻找你的分支是至关重要的。</p><p id="09f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么有哪些选择呢？您仍然可以手动命名您的分支，但是这很繁琐并且容易出错。如果您使用Git flow，您可能会被一个<a class="ae ky" href="https://danielkummer.github.io/git-flow-cheatsheet/index.fr_FR.html" rel="noopener ugc nofollow" target="_blank">包装器</a>所诱惑，来驱动您完成命名。不幸的是，我的经历并不是决定性的。此外，您可能希望在命名上有一些灵活性，我发现这个工具太死板了。</p><p id="2a49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">欢呼吧！Git总有锦囊妙计。您可以在执行脚本之前拦截特定的Git命令。它们被称为<a class="ae ky" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank">钩子</a>。</p><p id="7b6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我就不一一描述了。相反，我将把其中的两个展示给:</p><ol class=""><li id="700b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">实施分支命名策略。</li><li id="c9b4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">用分支名称标签作为提交消息的前缀。</li></ol></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="a8ba" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">1.实施分支命名策略</h1><p id="a44d" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我在介绍中提到了<a class="ae ky" href="https://nvie.com/posts/a-successful-git-branching-model/" rel="noopener ugc nofollow" target="_blank"> Git流</a>。这种分支约定在开发人员中很流行。这导致在您的分支前面加上名称，例如<code class="fe nn no np nq b">master</code>、<code class="fe nn no np nq b">develop</code>、<code class="fe nn no np nq b">feature</code>、<code class="fe nn no np nq b">bugfix</code>，等等。在命名您的分支机构时，您可能还想附加一个票证编号。</p><p id="7a44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的公司，我们强制执行这样的命名策略:</p><ul class=""><li id="52c9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nr mb mc md bi translated">分支必须以Git flow关键字之一开头，后跟一个点号。</li><li id="0e84" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nr mb mc md bi translated">然后指出用连字符连接的吉拉项目名称和票号。</li><li id="8c57" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nr mb mc md bi translated">然后开发者姓名首字母用下划线链接。</li><li id="9b20" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nr mb mc md bi translated">最后是票的描述。</li></ul><p id="14ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个例子是:</p><pre class="kj kk kl km gt ns nq nt nu aw nv bi"><span id="2660" class="nw mr it nq b gy nx ny l nz oa">feature/GTBC-9999_SV_git_hooks</span></pre><p id="a6d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">钩子可以检查所有这些条件。例如，在提交之前，确保您的分支机构名称遵守您的策略。您需要在<code class="fe nn no np nq b">.git/hooks</code>文件夹中添加一个<code class="fe nn no np nq b">pre-commit</code>脚本文件。</p><p id="4c09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是强制执行这些条件的脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="od oe of"><p id="5aa9" class="kz la og lb b lc ld ju le lf lg jx lh oh lj lk ll oi ln lo lp oj lr ls lt lu im bi translated">出于语法目的，这个要点是用<code class="fe nn no np nq b">sh</code>文件扩展名编写的。确保不要使用这个扩展，否则Git不会读取它。</p></blockquote><p id="afcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将文件标记为可执行文件:</p><pre class="kj kk kl km gt ns nq nt nu aw nv bi"><span id="311b" class="nw mr it nq b gy nx ny l nz oa">$ chmod +x pre-commit</span></pre><p id="ce65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更好地理解正则表达式，请看一下正则表达式的表示。这个例子表明它尊重我们的分支机构命名政策。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/f96f8c2ca8b5591463cc14265674dc2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OHi2YtxGmmjQMXv0bT4RYw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用<a class="ae ky" href="https://regexper.com/" rel="noopener ugc nofollow" target="_blank"> Regexper </a>制作的照片。</p></figure><p id="35d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您试图从与您的正则表达式模式不匹配的分支提交，您将在提交执行之前被拒绝。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="cc37" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">2.提交消息前缀</h1><p id="13f0" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">命名约定不仅仅适用于分支。每次提交时，您都可以在提交消息中添加额外的信息。例如，这可能是你的机票号码。</p><p id="4019" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Git允许您用一个<code class="fe nn no np nq b">prepare-commit-msg</code>钩子自动编辑提交消息。您获得原始的提交消息作为参数，您可以根据需要对其进行操作。</p><p id="b4ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们重温一下我上面的例子。我正在开发一个新特性，将Git挂钩添加到我的GTBC项目中——多么方便。这个任务指的是票号9999，我的首字母是SV。</p><p id="b30b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个有效的分支名称是:</p><pre class="kj kk kl km gt ns nq nt nu aw nv bi"><span id="9089" class="nw mr it nq b gy nx ny l nz oa">feature/GTBC-9999_SV_git_hooks</span></pre><p id="adb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个分支，我希望我所有的提交消息都以<code class="fe nn no np nq b">[GTBC-9999]</code>开始，然后是实际的开发人员消息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="8526" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，<code class="fe nn no np nq b">$1</code>指的是您的原始提交消息。使用<code class="fe nn no np nq b">grep</code>命令，我们从分支名称中提取项目名称和票据编号。然后我们把这个提取转换成大写。最后，我们在将最终的提交消息重定向到g it提交消息管道之前打印它。</p><p id="50b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在测试脚本之前，请记住将文件标记为可执行文件:</p><pre class="kj kk kl km gt ns nq nt nu aw nv bi"><span id="25e8" class="nw mr it nq b gy nx ny l nz oa">$ chmod +x prepare-commit-msg</span></pre><p id="2cdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">插上这个钩子后，输出如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/7c4efae947e393a21a31504e83ca8b21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*as6-761YfAd2jrY9ZijYhQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Git提交消息以[GTBC-9999]为前缀</p></figure><p id="9c1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意脚本中的<code class="fe nn no np nq b">if</code>条件。有时候，习惯很难改变。您的一些队友可能会继续手动添加他们的机票号码。</p><p id="0da9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了防止冗余，您可以检查票据编号是否驻留在提交消息中——不需要添加两次票据引用。</p><p id="4935" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试试这个:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/35e56cfd812f8faa9bc826b1bc99d518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUcA9xs7623dr1QXPPvOkQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">有目的地添加[GTBC-9999]以便提交消息不会重复</p></figure><p id="59f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在提交消息中捕获了票号，跳过了这个过程。我们可以检查我们的两个提交在日志中的命名是否正确:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/518bfce09e673c64b69bf2b8e1947d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9EfnUdxd-iSyGZk_-ynxeA.png"/></div></div></figure><p id="c202" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个钩子，您不再需要为提交消息添加前缀。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8802" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">与你的队友分享你的钩子</h1><p id="7415" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我在上面说过，你必须把你的钩子放在<code class="fe nn no np nq b">.git/hooks</code>文件夹里面。你应该知道<code class="fe nn no np nq b">.git</code>文件夹不受版本控制。Git会忽略这个文件夹下的每个文件。</p><p id="3faf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您将它们保存在此位置，您将无法:</p><ul class=""><li id="6c2c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nr mb mc md bi translated">与您的团队分享它们。</li><li id="11ac" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nr mb mc md bi translated">记录下你对它们的修改。</li></ul><p id="f88c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，您可以改变钩子执行的默认位置。例如，我在项目的根目录下创建了一个<code class="fe nn no np nq b">.git-hooks</code>文件夹，并把我所有的挂钩都放在里面。</p><p id="4c13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在项目的根目录下，执行以下命令行以应用这些更改:</p><pre class="kj kk kl km gt ns nq nt nu aw nv bi"><span id="f913" class="nw mr it nq b gy nx ny l nz oa">$ git config core.hooksPath .git-hooks</span></pre><p id="5049" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在版本这个文件夹，你的队友将从中受益。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="dce8" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">走向全球</h1><p id="407b" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我的其他项目呢？我必须把钩子添加到所有共享相同命名约定的项目中吗？</p><p id="8bc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用这种策略，是的。</p><p id="4fae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再一次，Git已经用<a class="ae ky" href="https://git-scm.com/docs/git-init#_template_directory" rel="noopener ugc nofollow" target="_blank">模板</a>考虑清楚了。你可以创建一个模板，避免重新配置钩子。</p><p id="a19e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文对此进行了更详细的解释:</p><div class="oo op gp gr oq or"><a href="https://coderwall.com/p/jp7d5q/create-a-global-git-commit-hook" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">创建一个全局git提交挂钩(示例)</h2><div class="oy l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">coderwall.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks or"/></div></div></a></div></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="db9b" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="dbb1" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">希望这两个实际使用案例能引发你的创意。自动化那些无聊的东西，确保你在命名你的提交时不会错过标记！</p><p id="fe3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>