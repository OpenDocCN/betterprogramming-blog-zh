<html>
<head>
<title>How to Set Up Biometric Authentication in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Android中设置生物认证</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-set-up-biometric-authentication-in-android-672688afcaae?source=collection_archive---------5-----------------------#2020-04-22">https://betterprogramming.pub/how-to-set-up-biometric-authentication-in-android-672688afcaae?source=collection_archive---------5-----------------------#2020-04-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="efc1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Android的生物识别API进行安全而简单的身份验证</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/705f6f2501ce465a46ad82483bd1bf95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SB2UJdDdDyS4MjUXZIiktA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@quentinlagache?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">昆廷·拉加奇</a>在<a class="ae ky" href="https://unsplash.com/s/photos/eye?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="9e86" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">这篇文章的要点是</h1><p id="90e2" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">生物认证是指纹认证的延伸。与它的前身相比，生物识别API要高级得多，也更容易集成。在本文中，您将学习如何集成生物识别API以及如何使用它。请继续阅读以了解它。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6461" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">介绍</h1><p id="bc03" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">近年来，Android团队的重点主要是提高安全性和隐私性。模式/pin锁在Android中已经存在多年，作为一种增强，指纹认证在几年前被引入。现在是时候增强指纹认证了，这就是所谓的生物认证。</p><p id="e446" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">生物认证更加安全且易于使用，这在许多情况下都很方便，例如支付授权、安全简单的登录、访问敏感数据时的认证等等。</p><p id="5afa" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">除此之外，生物特征API还提供了一种使用设备密码或pin进行身份验证的方法，无需开发人员做任何额外的工作。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="34f8" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">检查可用性</h1><p id="8fdd" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">正如我所说的，Android安全系统始于密码和pin锁，所以一些设备不具备指纹或面部解锁功能。在为用户启用这种类型的身份验证之前，最好检查设备是否与生物识别身份验证兼容。</p><p id="dc3c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">为了首先检查可用性，我们需要获得system <code class="fe mz na nb nc b">BiometricManager </code>类的实例，如下所示:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="542b" class="nh lh it nc b gy ni nj l nk nl">val biometricManager = BiometricManager.from(this)</span></pre><p id="9184" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">对于<code class="fe mz na nb nc b">BiometricManager</code> <strong class="ma iu"> </strong>实例，我们需要访问<code class="fe mz na nb nc b">canAuthenticate()</code>公共函数，这会产生一个整数。</p><p id="bc32" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe mz na nb nc b">canAuthenticate()</code>有四种可能的结果:</p><ul class=""><li id="6c29" class="nm nn it ma b mb mu me mv mh no ml np mp nq mt nr ns nt nu bi translated"><code class="fe mz na nb nc b">BIOMETRIC_SUCCESS</code>:该设备可以进行生物认证。</li><li id="845d" class="nm nn it ma b mb nv me nw mh nx ml ny mp nz mt nr ns nt nu bi translated"><code class="fe mz na nb nc b">BIOMETRIC_ERROR_NO_HARDWARE</code>:此设备上没有生物特征。</li><li id="0eb8" class="nm nn it ma b mb nv me nw mh nx ml ny mp nz mt nr ns nt nu bi translated"><code class="fe mz na nb nc b">BIOMETRIC_ERROR_HW_UNAVAILABLE</code>:生物特征目前在设备中不可用。</li><li id="4580" class="nm nn it ma b mb nv me nw mh nx ml ny mp nz mt nr ns nt nu bi translated"><code class="fe mz na nb nc b">BIOMETRIC_ERROR_NONE_ENROLLED</code>:用户尚未在设备中关联任何生物特征凭证。</li></ul><p id="e4a6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">使用<a class="ae ky" href="https://kotlinlang.org/" rel="noopener ugc nofollow" target="_blank"> Kotlin </a> mighty <code class="fe mz na nb nc b">when</code>来处理不同的用例。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">检查生物识别可用性</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="fa01" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">综合</h1><p id="4f60" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">生物特征库集成很简单。我们需要在应用程序级别的<code class="fe mz na nb nc b">build.gradle</code>中的dependencies标签下添加下面一行。看一看:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="87de" class="nh lh it nc b gy ni nj l nk nl">dependencies {<br/>    implementation 'androidx.biometric:biometric:1.0.1'<br/>}</span></pre><p id="44fe" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">看看<a class="ae ky" href="https://developer.android.com/training/sign-in/biometric-auth" rel="noopener ugc nofollow" target="_blank">最新版</a>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="abb0" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">使用生物特征库</h1><p id="9e11" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这是令人兴奋的部分。首先，我们需要创建一个<code class="fe mz na nb nc b">Executor</code>的实例，如下所示:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="664b" class="nh lh it nc b gy ni nj l nk nl">val executor = ContextCompat.getMainExecutor(this)</span></pre><p id="d8e5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe mz na nb nc b">getMainExecutor </code>返回一个<code class="fe mz na nb nc b">Executor</code>，它在与这个上下文相关的主线程上运行排队的任务。这是用于将调用分派给应用程序组件(活动、服务等)的线程。).这个<code class="fe mz na nb nc b">Executor</code>用于在生物识别服务和您的应用程序组件之间建立一座桥梁。</p><p id="196f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">接下来，我们需要创建一个<code class="fe mz na nb nc b">BiometricPrompt</code>的实例，如下所示，提示用户进行身份验证。它有三个论点。</p><ol class=""><li id="d7f9" class="nm nn it ma b mb mu me mv mh no ml np mp nq mt oc ns nt nu bi translated">Android组件的实例(活动/片段)</li><li id="f713" class="nm nn it ma b mb nv me nw mh nx ml ny mp nz mt oc ns nt nu bi translated">我们在上面创建的一个<code class="fe mz na nb nc b">Executor</code></li><li id="d56c" class="nm nn it ma b mb nv me nw mh nx ml ny mp nz mt oc ns nt nu bi translated">有三个回调的lambda表达式，称为<code class="fe mz na nb nc b">Biometric.AuthenticationCallback</code></li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有回调的生物识别提示</p></figure><p id="58bf" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在可以通过<code class="fe mz na nb nc b">PromptInfo</code> <strong class="ma iu"> </strong>构建器将必要的信息发布到提示符下，如下图所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将信息发布到生物特征以显示在用户界面上</p></figure><p id="7d5c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">剩下的就是通过将<code class="fe mz na nb nc b">promptInfo</code>作为参数传递，在<code class="fe mz na nb nc b">BiometricPrompt</code>实例上使用<code class="fe mz na nb nc b">authenticate</code>来显示生物统计对话框。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="53dd" class="nh lh it nc b gy ni nj l nk nl">biometricPrompt.authenticate(promptInfo)</span></pre><p id="29bc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">仅此而已；剩下的工作将由生物识别API负责，并通过回调提供适当的结果。</p><p id="576c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">为了更清楚地理解它，请参见下面的代码，其中所有部分都放在一起:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3c05" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">启用密码选项</h1><p id="68af" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">有时，您的指纹选项或面部检测可能会出现问题。例如，当光线不足以进行面部检测时，它可能不会像预期的那样工作。在这种情况下，用户应该能够使用其他身份验证模式，比如pin/密码/模式。</p><p id="6d7d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">为了实现这一点，生物特征库通过将<code class="fe mz na nb nc b">true</code>作为参数传递，在<code class="fe mz na nb nc b">BiometricPrompt.PromptInfo</code>实例上提供了一个函数<code class="fe mz na nb nc b">setDeviceCredentialAllowed </code>。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="33f4" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">奖金</h1><p id="d7b4" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">要了解有关Android安全性的更多信息，请阅读以下文章:</p><ul class=""><li id="8512" class="nm nn it ma b mb mu me mv mh no ml np mp nq mt nr ns nt nu bi translated">"<a class="ae ky" href="https://medium.com/better-programming/secure-communication-with-the-server-from-your-android-client-with-certificate-pinning-5f53cea55972" rel="noopener">使用证书锁定从您的Android客户端与服务器进行安全通信</a> <strong class="ma iu"> " </strong></li></ul><p id="5a22" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>