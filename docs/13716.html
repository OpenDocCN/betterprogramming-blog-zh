<html>
<head>
<title>How to Use a Result Type in .NET</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在中使用结果类型？网</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/bring-error-handling-and-eliminate-nullreferenceexceptions-using-a-result-type-in-net-f4447dceb6c4?source=collection_archive---------0-----------------------#2022-09-20">https://betterprogramming.pub/bring-error-handling-and-eliminate-nullreferenceexceptions-using-a-result-type-in-net-f4447dceb6c4?source=collection_archive---------0-----------------------#2022-09-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dcc3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用此结果类型消除NullReferenceExceptions并提升您的错误处理能力</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ff48b3e081c0a7d47dc8dfd64fdd5e5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NZH7wE1ry0d0r12p"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@jeshoots?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">JESHOOTS.COM</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3789" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非函数式编程语言的一个小缺点是，如果不检查，你不能100%确定你当前处理的值不是空的。通常，我们只是实现一个<code class="fe lv lw lx ly b">Function&lt;T&gt;</code>并在代码中继续使用该返回类型，而不检查它是否为空。</p><p id="47b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像Rust或F#这样的编程语言将这个问题提升到一种<code class="fe lv lw lx ly b">Result</code>类型或<code class="fe lv lw lx ly b">Option</code>类型。这种类型提醒您——并且有点强迫您——首先检查被调用的函数是否真的返回了预期的值或null。</p><p id="f9d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而在C#中，对于这个问题还没有一个好的解决方案。您可以使用一个可空类型，并在您的。csproj文件，但这仍然缺少结果类型的一个重要方面:显式性。当您在代码中接收到一个可空类型时，您可能只会看到，它被它旁边的<code class="fe lv lw lx ly b">?</code>操作符可空，或者由于您的IDE提醒您，您可能正在处理一个空值。</p><p id="56e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以现在我们需要一个<code class="fe lv lw lx ly b">Result</code>类型，它明确地提醒我们检查底层值是否被设置。现在想象一下，我们收到一个失败的函数返回的<code class="fe lv lw lx ly b">Result</code>。调用者肯定想知道哪里出错了，这样他就可以记录一个错误或者做任何其他方面的逻辑。这可以通过在方法失败的情况下向<code class="fe lv lw lx ly b">Result</code>添加异常来解决。</p><h1 id="030b" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">履行</h1><blockquote class="mr ms mt"><p id="9430" class="kz la mu lb b lc ld ju le lf lg jx lh mv lj lk ll mw ln lo lp mx lr ls lt lu im bi translated">更新(25.09.2022):我被告知，这里已经实施了类似的解决方案:</p></blockquote><div class="my mz gp gr na nb"><a href="https://github.com/louthy/language-ext/blob/main/LanguageExt.Core/Common/Result/Result.cs" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">主louthy/language-ext/result . cs</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ks nb"/></div></div></a></div><blockquote class="mr ms mt"><p id="3512" class="kz la mu lb b lc ld ju le lf lg jx lh mv lj lk ll mw ln lo lp mx lr ls lt lu im bi translated">更新(07.10.2022):另一个值得一提的是<a class="ae ky" href="https://github.com/dotnet/dotNext" rel="noopener ugc nofollow" target="_blank"> dotNext </a>包中的结果类型，它由。网络基础:</p></blockquote><div class="my mz gp gr na nb"><a href="https://dotnet.github.io/dotNext/api/DotNext.Result-2.html" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">结构结果</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">表示操作的结果，可以是实际结果或错误代码。汇编:DotNext.dll语法公共只读…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">dotnet.github.io</p></div></div></div></a></div><h2 id="63c8" class="nq ma it bd mb nr ns dn mf nt nu dp mj li nv nw ml lm nx ny mn lq nz oa mp ob bi translated">结果类型</h2><p id="383c" class="pw-post-body-paragraph kz la it lb b lc oc ju le lf od jx lh li oe lk ll lm of lo lp lq og ls lt lu im bi translated">为了处理所有用例，我们需要两种结果类型。一种结果类型用于不返回值的方法，另一种结果类型用于返回值的方法。我们称它们为<code class="fe lv lw lx ly b">Result</code>和<code class="fe lv lw lx ly b">Result&lt;T&gt;</code>，其中<code class="fe lv lw lx ly b">Result&lt;T&gt;</code>继承<code class="fe lv lw lx ly b">Result</code>。</p><p id="6785" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">Result</code>有两个属性:<code class="fe lv lw lx ly b">Success</code>和<code class="fe lv lw lx ly b">Message</code>，以及一个方法<code class="fe lv lw lx ly b">GetError()</code>，该方法返回底层异常(如果可用的话)。此外，我们实现了一个隐式转换，允许您直接返回任何<code class="fe lv lw lx ly b">Exception</code>，它会自动转换为<code class="fe lv lw lx ly b">Result</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="028e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">继承<code class="fe lv lw lx ly b">Result&lt;T&gt;</code>通过添加类型<code class="fe lv lw lx ly b">&lt;T&gt;</code>的有效载荷来扩展<code class="fe lv lw lx ly b">Result</code>，该有效载荷可通过<code class="fe lv lw lx ly b">GetOk()</code>方法访问。这里我们还添加了隐式转换，这样我们就可以返回有效负载，而不用每次都将它转换为<code class="fe lv lw lx ly b">Result&lt;T&gt;</code>。</p><h2 id="c2fc" class="nq ma it bd mb nr ns dn mf nt nu dp mj li nv nw ml lm nx ny mn lq nz oa mp ob bi translated">结果类型的扩展</h2><p id="9c55" class="pw-post-body-paragraph kz la it lb b lc oc ju le lf od jx lh li oe lk ll lm of lo lp lq og ls lt lu im bi translated">在我们的<code class="fe lv lw lx ly b">Result</code>类型之上有一点额外的特性，那就是一个扩展方法，它允许我们检查结果是正还是负，当结果是负时抛出一个异常。这个扩展方法将返回调用它的<code class="fe lv lw lx ly b">Result</code>，并抛出异常<strong class="lb iu">，同时保留StackTrace。当我们想要容易地将结果冒泡到其他层，而不丢失关于底层异常的宝贵信息时，这是特别必要的。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="8fd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常情况下，当我们抛出一个现有的<code class="fe lv lw lx ly b">Exception</code>时，异常的StackTrace会被一个新的StackTrace替换，这个Stack trace会丢失之前的堆栈，我们不希望出现在这里，因为异常的来源当然非常重要。</p><p id="a4db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个扩展方法现在允许我们像这样使用<code class="fe lv lw lx ly b">Result</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl oj ok hx ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="im in io ip iq"><p id="9863" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个结果类型是我的大多数项目的内部核心的一部分，这使得它对我的代码架构非常重要。如果正确使用它，它会强制执行更干净的代码风格，并消除NullReferenceExceptions。</p><p id="89d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想查看实现和一些单元测试，以及用例，你可以在这里查看我的GitHub库:</p><div class="my mz gp gr na nb"><a href="https://github.com/TobiStr/ResultType" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">GitHub - TobiStr/ResultType:中结果类型的建议。网</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">中结果类型的建议。这种结果类型在您希望适度实施检查的场景中很有用…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="oq l nm nn no nk np ks nb"/></div></div></a></div></div><div class="ab cl oj ok hx ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="im in io ip iq"><p id="bf35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您花时间阅读这篇文章。我希望，你会觉得它有知识性、教育性和趣味性。非常感谢您的支持和参与。</p><p id="2403" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有兴趣了解干净架构、干净编码和最新技术栈的最新趋势、技巧和诀窍，尤其是在C#环境中。净和有棱角——如果你考虑跟踪我，我会很感激。</p><p id="5f27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝你有美好的一天！</p></div><div class="ab cl oj ok hx ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/429378e6a7aee01df92851fb0e90e385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fK4zVN8TtnIM37dhEhE54g.png"/></div></div></figure><p id="2357" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你还没有每天使用媒体来增长你的知识，现在是开始的最佳时机！借助Medium，您可以轻松获得更多关于高度专业的主题的知识，发布高质量的内容，并接触到更广泛的受众。要开始，只需使用以下链接创建一个中型帐户:</p><p id="28a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://medium.com/@tobias.streng/membership" rel="noopener"> <em class="mu">现在加入中等</em> </a></p><p id="cb60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这样做，你将获得一个强大的平台，可以帮助你联系新的作者和读者，每天学习新的东西。</p></div></div>    
</body>
</html>