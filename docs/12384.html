<html>
<head>
<title>Accessing Ethereum Archive Nodes With Infura</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Infura访问以太坊归档节点</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/accessing-ethereum-archive-nodes-with-infura-f40b46a04f15?source=collection_archive---------13-----------------------#2022-06-01">https://betterprogramming.pub/accessing-ethereum-archive-nodes-with-infura-f40b46a04f15?source=collection_archive---------13-----------------------#2022-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6aba" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用Infura RPC端点URL读取历史区块链数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c231ed725c01771fc7cda5d45c279a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWrd0ddccxWbwuEp92XAcw.jpeg"/></div></div></figure><h1 id="e909" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">介绍</h1><p id="92c8" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">存档节点是以太坊网络上存储历史区块链数据的特定节点。因为它们提供了这些历史信息，所以当您需要审计过去的交易历史或收集数据时，它们会很有帮助。像<a class="ae mf" href="https://etherscan.io/" rel="noopener ugc nofollow" target="_blank"> Etherscan </a>和<a class="ae mf" href="https://docs.dune.xyz/" rel="noopener ugc nofollow" target="_blank"> Dune Analytics </a>这样的服务使用存档节点，但是任何人都可以自己运行一个。</p><p id="fde6" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在本文中，我们将回顾不同类型的以太坊节点，深入探讨归档节点，并介绍Infura的新归档节点功能。然后，我们将通过一个真实的项目展示如何将Infura API和web3.js连接到一个预构建的react前端。一旦完成，用户将能够查询一个归档节点，以获得给定以太坊钱包地址的一些统计信息。</p><h1 id="2036" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">目录</h1><ul class=""><li id="8b57" class="ml mm iq ll b lm ln lp lq ls mn lw mo ma mp me mq mr ms mt bi translated">以太坊节点是什么？</li><li id="e9be" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">以太坊节点的类型</li><li id="1d94" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">存档节点</li><li id="c5ac" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">存档节点提供程序</li><li id="aef5" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">该项目</li><li id="1a97" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">结论</li></ul><h1 id="5934" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">以太坊节点是什么？</h1><p id="fd12" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">简单来说，节点就是网络中的一个连接点。然而，在以太坊的情况下，不同类型的节点对网络负有不同的责任。</p><p id="be1e" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">以太坊区块链在所谓的<a class="ae mf" href="https://ethereum.org/en/developers/docs/evm/" rel="noopener ugc nofollow" target="_blank">以太坊虚拟机</a> (EVM)上运行，这是一种分散式<a class="ae mf" href="https://etherscan.io/nodetracker" rel="noopener ugc nofollow" target="_blank">全球</a>计算机。在这种情况下，节点为这台计算机提供处理能力。它们提供请求的数据，创建和验证块，存储交易数据或智能合约代码，等等。任何拥有所需硬件的人都可以下载一个<a class="ae mf" href="https://ethereum.org/en/developers/docs/nodes-and-clients/#execution-clients" rel="noopener ugc nofollow" target="_blank">以太坊客户端</a>并旋转他们自己的节点来加入网络。这也防止了任何单个实体控制整个网络，并有助于以太坊的去中心化。</p><p id="ffaa" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">以太坊节点主要有四种类型，每一种对网络的贡献都不同。它们一起将信息中继到其他节点，验证交易和EVM状态，并提供保持以太坊网络高效运行所需的基础设施。它们相互通信以确保它们都同意网络的状态。因此，拥有更多的节点使网络更强大，对攻击更有弹性。</p><h1 id="965e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">以太坊节点的类型</h1><h2 id="98de" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">完整节点</h2><p id="62b3" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">完整节点验证事务和EVM状态，验证块，启动和执行智能合约代码，并可以在请求时提供网络数据。他们还存储以太坊区块链的状态，直到最近的128个区块，但可以根据需要建立历史状态的档案。</p><h2 id="b403" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">挖掘节点(通常称为“挖掘器”)</h2><p id="ac7d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">Miner是运行<a class="ae mf" href="https://ethereum.org/en/developers/docs/consensus-mechanisms/pow/mining/" rel="noopener ugc nofollow" target="_blank">挖掘客户端</a>的完整节点。在目前的状态下，以太坊通过<a class="ae mf" href="https://ethereum.org/en/developers/docs/consensus-mechanisms/pow/" rel="noopener ugc nofollow" target="_blank">工作证明</a>算法提供共识。总而言之，这意味着一个挖掘节点与其他挖掘节点在计算竞赛中竞争创建下一个块。创建后，新数据块会广播到网络，由其他节点进行验证，并附加到区块链的末尾。</p><h2 id="daad" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">光节点</h2><p id="c069" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">轻型节点是完整节点的“轻型”版本，它只包含块头数据，如前一个块的哈希和时间戳，而不是完整的块数据。它们向完整节点发出按需请求，并且只根据用户的要求验证某些状态。示例用途是检查余额、验证交易是否已确认、检查事件日志以及执行其他轻型任务。轻型节点可以很容易地由低容量设备运行，如移动电话或RaspberryPi。</p><h2 id="790f" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">存档节点</h2><p id="f42d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">归档节点是一种在“归档模式”下运行的完整节点。它们包含与完整节点相同的所有数据，但也包含自<a class="ae mf" href="https://etherscan.io/block/0" rel="noopener ugc nofollow" target="_blank">创世纪区块</a>以来整个区块链的所有历史状态数据。在本文的剩余部分，我们将重点关注归档节点。</p><h1 id="9d15" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">关于归档节点的更多信息</h1><p id="41a9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">尽管完整节点可以重建历史区块链状态数据，但这个过程是缓慢且低效的。根据不同的用例，这些数据可能需要快速提供。这就是归档节点的用武之地。因为存档节点包含从第一个数据块开始的历史数据，所以它们可以随时轻松地跟踪任何任意事务。</p><h2 id="6777" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">为什么要访问归档节点？</h2><p id="3a38" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果在最近的128个区块之前，有你需要从以太坊区块链获取的信息，那么最高效的获取方式就是通过一个存档节点。其中一些信息可能包括帐户余额、智能合约代码、交易计数或特定存储位置的价值。它们还支持测试智能合约代码，而无需在区块链上创建交易。</p><h2 id="5ea6" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">运行归档节点的规格</h2><p id="d9cc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">运行自己的节点意味着对与区块链共享的信息有更多的控制。你可以创建更加安全和私密的dApps(去中心化应用)，你的地址和余额不会泄露给网络上的随机节点。运行归档节点还意味着无需注册任何第三方服务即可快速访问历史区块链数据。</p><p id="4d94" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">这些是您需要能够<a class="ae mf" href="https://ethereum.org/en/run-a-node/" rel="noopener ugc nofollow" target="_blank">运行您自己的以太坊存档节点</a>的规范:</p><ul class=""><li id="1d13" class="ml mm iq ll b lm mg lp mh ls nl lw nm ma nn me mq mr ms mt bi translated">至少有四个内核的CPU</li><li id="86cf" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">16 GB或更多内存</li><li id="59f9" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">至少有6 TB空间的固态硬盘</li><li id="0dca" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">至少25兆比特/秒的带宽</li></ul><p id="a224" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">正如您所看到的，启动归档节点的要求使其具有合理的可访问性。虽然不算便宜，但对个人来说还是可以承受的。它确实需要一些技术知识和持续的维护。如果您没有时间、驱动器或设备来运行自己的，节点提供商是一个很好的替代选择。</p><h1 id="f553" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">存档节点提供程序</h1><p id="583f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">节点提供商通过其易于使用的API，使任何人都可以轻松访问以太坊区块链并与之交互。你需要做的就是创建一个新项目，然后用它们提供的URL轻松调用<a class="ae mf" href="https://www.wallarm.com/what/what-is-json-rpc" rel="noopener ugc nofollow" target="_blank"> JSON RPC </a>方法。</p><h2 id="f78d" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">Infura</h2><p id="a37e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">Infura可以说是该领域最受欢迎的节点提供商。它是由ConsenSys，MetaMask和松露区块链开发框架背后的团队创建的。他们已经存在了一段时间，他们的服务对于初学者和希望扩大规模的组织来说非常好。</p><ul class=""><li id="e11c" class="ml mm iq ll b lm mg lp mh ls nl lw nm ma nn me mq mr ms mt bi translated">现在可以免费访问归档节点</li><li id="4f8f" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">伟大的<a class="ae mf" href="https://infura.io/pricing" rel="noopener ugc nofollow" target="_blank">自由定价层</a></li><li id="03b3" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">提供对第2层扩展解决方案的访问</li><li id="b4d8" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">许多其他附件可满足您的需求</li><li id="92c6" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">优秀的<a class="ae mf" href="https://docs.infura.io/infura" rel="noopener ugc nofollow" target="_blank">文档</a></li></ul><h1 id="ef6b" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">用例</h1><p id="9302" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">根据您正在构建的项目类型，有几种不同的技术可以连接到节点提供者。</p><h2 id="0f81" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">块菌/安全帽</h2><p id="0722" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果您正在编写与历史数据交互的智能契约，那么Truffle或Hardhat等开发套件将满足您的需求。它们都有各种各样的内置工具，使您的dApp的整个开发生命周期变得更加容易。在这种情况下，连接到归档节点就像将提供的API URL端点设置为要在前端代码中使用的变量一样简单。</p><h2 id="01d4" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">加纳切</h2><p id="7ebe" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果您需要快速访问归档节点进行本地开发或测试，Truffle提供了一个个人区块链，可以很好地完成这一任务。这个区块链叫做<a class="ae mf" href="https://trufflesuite.com/docs/ganache/index.html" rel="noopener ugc nofollow" target="_blank">加纳切</a>。从<a class="ae mf" href="https://blog.infura.io/fork-ethereum-replay-historical-transactions-with-ganache-7-archive-support/" rel="noopener ugc nofollow" target="_blank"> Ganache版本7.0 </a>开始，启动以太坊区块链的本地实例并访问存档就像一个命令一样简单:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="d41f" class="mz ks iq np b gy nt nu l nv nw">ganache --fork</span></pre><p id="e812" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">然后，您可以使用URL:<a class="ae mf" href="http://localhost:8545/" rel="noopener ugc nofollow" target="_blank">http://localhost:8545</a>，或者任何您设置的端口，与它进行类似的交互。</p><h2 id="bce3" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">直接集成</h2><p id="f13f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果您不需要一套区块链工具，那么您可以在前端代码中直接使用您的节点提供者URL，并通过一个JavaScript库(如ethers.js或web3.js)连接到它。这是我们将在下面的项目中探索的选项。</p><h1 id="bac2" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">该项目</h1><p id="abdf" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">正如本文开头提到的，我们将制作一个简单的“年度回顾”类型的应用程序来显示2021年以来的一些钱包统计数据。我们将克隆一个预构建的前端，因此我们所要担心的只是查询一个归档节点，然后很好地显示数据。</p><p id="2b2a" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><strong class="ll ir">我们将要学习的内容:</strong></p><ul class=""><li id="30d8" class="ml mm iq ll b lm mg lp mh ls nl lw nm ma nn me mq mr ms mt bi translated">如何获得具有归档访问权限的Infura API URL</li><li id="6b34" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">如何使用Infura API URL和web3.js收集归档数据</li><li id="300f" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">从区块链收集数据所需的JavaScript</li><li id="6382" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated">如何将数据放在一起，并在应用程序中很好地显示出来</li></ul><p id="4d8a" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><strong class="ll ir">完成项目需要什么:</strong></p><ul class=""><li id="dbc3" class="ml mm iq ll b lm mg lp mh ls nl lw nm ma nn me mq mr ms mt bi translated"><a class="ae mf" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank">一个不真实的账户</a></li><li id="3382" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated"><a class="ae mf" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank"> Git </a></li><li id="ffbb" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated"><a class="ae mf" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点/ npm </a></li><li id="e8d0" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated"><a class="ae mf" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank">一个代码编辑器</a></li></ul><p id="52d1" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><strong class="ll ir">附加资源</strong></p><ul class=""><li id="f245" class="ml mm iq ll b lm mg lp mh ls nl lw nm ma nn me mq mr ms mt bi translated"><a class="ae mf" href="https://docs.infura.io/infura" rel="noopener ugc nofollow" target="_blank">信息文件</a></li><li id="0f89" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated"><a class="ae mf" href="https://web3js.readthedocs.io/en/v1.7.0/web3.html" rel="noopener ugc nofollow" target="_blank"> Web3.js文档</a></li></ul><h2 id="1acc" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">Infura API URL</h2><p id="2348" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们项目的第一步是设置我们的Infura帐户并获取我们的API端点URL。前往<a class="ae mf" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank">https://infura.io/</a>，创建一个新账户或登录。</p><p id="1741" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">创建一个新项目来获取我们将在项目中用到的API端点URL。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/1167d046e9a0a94d66316d0362db37aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9mkPWU2BF9DGfrxP.jpg"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">获取Infura RPC端点URL</p></figure><p id="6c08" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">由于存档访问现在对所有用户都是免费的，我们不需要用我们的Infura帐户完成任何其他步骤。</p><p id="d51c" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">解决了这个问题，让我们开始在前端工作吧！</p><h2 id="f6df" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">前端</h2><p id="affe" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们将为这个项目的其余部分建立在一个预制的React前端之上。如果你以前从未使用过React，没关系。我们将一起完成剩下的步骤。</p><p id="ebc7" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">为了正确安装项目，我们将使用<strong class="ll ir"> git </strong>和<strong class="ll ir">节点包管理器</strong> (npm)。要查看它们是否已经安装，我们可以在命令行中检查版本号:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="d81d" class="mz ks iq np b gy nt nu l nv nw">npm --version</span><span id="5c0e" class="mz ks iq np b gy oc nu l nv nw">git --version</span></pre><p id="d72e" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">如果仍然需要在您的计算机上安装它们，您可以通过以下链接获得它们:</p><ul class=""><li id="44b2" class="ml mm iq ll b lm mg lp mh ls nl lw nm ma nn me mq mr ms mt bi translated">节点/NPM:<a class="ae mf" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/</a></li><li id="077a" class="ml mm iq ll b lm mu lp mv ls mw lw mx ma my me mq mr ms mt bi translated"><strong class="ll ir">吉特</strong>:<a class="ae mf" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank">https://git-scm.com/downloads</a></li></ul><p id="e82d" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">安装完成后，我们准备开始项目的其余部分:</p><ol class=""><li id="2096" class="ml mm iq ll b lm mg lp mh ls nl lw nm ma nn me od mr ms mt bi translated">在命令行中，导航到您想要处理的文件夹，并克隆我们项目的存储库:</li></ol><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="e633" class="mz ks iq np b gy nt nu l nv nw">git clone <a class="ae mf" href="https://github.com/paul-mcaviney/archive-node-project-frontend.git" rel="noopener ugc nofollow" target="_blank">https://github.com/paul-mcaviney/archive-node-project-frontend.git</a></span></pre><p id="0abd" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">2.将目录更改到新的项目文件夹中，并安装所需的依赖项:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="fcf7" class="mz ks iq np b gy nt nu l nv nw">cd archive-node-project-frontend</span><span id="9df4" class="mz ks iq np b gy oc nu l nv nw">npm i</span></pre><p id="de6a" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">3.在依赖项安装完成后，让我们运行项目，以确保它目前工作正常:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="f32f" class="mz ks iq np b gy nt nu l nv nw">npm start</span></pre><p id="b358" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">如果一切安装正确，我们现在将拥有一个运行在<a class="ae mf" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">http://localhost:3000</strong></a>上的前端，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/e773d3b746d87ab22f33e502cde344b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uNYoEKLnPzDIlRyr.jpg"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">我们的项目前端</p></figure><p id="af7e" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">我们将使用一个文本字段来输入钱包地址。点击提交按钮，我们将进入结果页面。我们也可以从这里按下<strong class="ll ir">输入新地址</strong>按钮返回输入页面。</p><p id="2c6f" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">4.在我们开始编码之前，我们需要再安装一个依赖项。我们将使用<strong class="ll ir"> web3.js </strong>通过我们的Infura URL访问一个归档节点。要安装web3.js，请在我们项目的目录中键入以下命令:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="7ecc" class="mz ks iq np b gy nt nu l nv nw">npm install web3</span></pre><p id="b90e" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">5.我们将在<strong class="ll ir"> src </strong>文件夹下的<strong class="ll ir"> App.js </strong>文件中完成我们所有的编码。我们需要编写的第一段代码是将web3导入到我们的项目中，并将其连接到我们的Infura URL。在import语句下，在<strong class="ll ir"> App </strong>函数之前，添加以下代码:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="4bc2" class="mz ks iq np b gy nt nu l nv nw">const Web3 = require('web3'); <br/>const infuraURL = 'YOUR_INFURA_URL_HERE'; <br/>const web3 = new Web3(new Web3.providers.HttpProvider(infuraURL));</span></pre><p id="bc62" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><strong class="ll ir">注意</strong>:不要在没有隐藏你真实的Infura URL之前将这个项目上传到公共库。您可以为此使用环境变量。</p><p id="dec3" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">6.我们将使用<strong class="ll ir"> useState </strong> React钩子来更新我们的UI。您会注意到它已经被导入到我们文件的顶部。接下来，让我们添加一些React状态变量，以便更容易地显示我们从归档节点收集的数据。在<strong class="ll ir">结果</strong>状态变量下，添加以下内容:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="959c" class="mz ks iq np b gy nt nu l nv nw">const [address, setAddress] = useState(''); <br/>const [currentBalance, setCurrentBalance] = useState(0); <br/>const [startOfYearBalance, setStartOfYearBalance] = useState(0); <br/>const [endOfYearBalance, setEndOfYearBalance] = useState(0); <br/>const [balanceDifference, setBalanceDifference] = useState(0); <br/>const [transactionCount, setTransactionCount] = useState(0);</span></pre><p id="01a8" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">7.现在我们需要更新<code class="fe of og oh np b">handleInput</code>函数，将用户输入分配给我们的地址状态变量，而不是记录注释:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="5e33" class="mz ks iq np b gy nt nu l nv nw">const handleInput = event =&gt; { 	<br/>    setAddress(event.target.value); <br/>};</span></pre><p id="2c3d" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><strong class="ll ir">注意</strong>:你会注意到我们没有在这里做任何检查来确保用户输入的实际上是一个以太坊钱包地址。这是为了保持本教程简单。如果公开部署，您将希望以不同的方式处理此问题。</p><p id="0091" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">8.JavaScript的最后一部分是一个异步函数，它将从归档节点收集数据，将其转换为更可读的值，并设置我们的状态变量。在注释<em class="oi">您的JavaScript代码将放在这里</em>下，键入以下代码:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="1f54" class="mz ks iq np b gy nt nu l nv nw">// Access and process data from Ethereum blockchain<br/>const accessEthereum = async () =&gt; {</span><span id="cb9a" class="mz ks iq np b gy oc nu l nv nw">    // 2021 Start and End Block variables <br/>    const START_2021_BLOCK = 11565019;<br/>    const END_2021_BLOCK = 13916165;<br/> <br/>    // Get current balance of address <br/>    const balance = await web3.eth.getBalance(address);</span><span id="6ffc" class="mz ks iq np b gy oc nu l nv nw">    // Convert balance from wei to ETH and set state variable<br/>    setCurrentBalance(await web3.utils.fromWei(balance.toString(), 'ether'));<br/>        <br/>    // Get wallet balance at the start of 2021 (Block #11565019)<br/>    const startBalance = await web3.eth.getBalance(address, START_2021_BLOCK);</span><span id="32e8" class="mz ks iq np b gy oc nu l nv nw">    // Get wallet balance at the end of 2021 (Block #13916165)<br/>    const endBalance = await web3.eth.getBalance(address, END_2021_BLOCK);<br/>         <br/>    // Convert startBalance to ETH and set state variable<br/>    const startBalanceAsETH = await web3.utils.fromWei(startBalance.toString(), 'ether');<br/>    setStartOfYearBalance(startBalanceAsETH);</span><span id="d2a5" class="mz ks iq np b gy oc nu l nv nw">    // Convert endBalance to ETH and set state variable<br/>    const endBalanceAsETH = await web3.utils.fromWei(endBalance.toString(), 'ether');<br/>    setEndOfYearBalance(endBalanceAsETH);</span><span id="547b" class="mz ks iq np b gy oc nu l nv nw">    // Set balanceDifference from start to end of 2021<br/>    setBalanceDifference(endBalanceAsETH - startBalanceAsETH);</span><span id="515b" class="mz ks iq np b gy oc nu l nv nw">    // Get transaction count at start of 2021 (Block #11565019)<br/>    let startTransactions = await web3.eth.getTransactionCount(address, START_2021_BLOCK);</span><span id="3aba" class="mz ks iq np b gy oc nu l nv nw">    // Get transaction count at end of 2021 (Block #13916165)<br/>    let endTransactions = await web3.eth.getTransactionCount(address, END_2021_BLOCK);</span><span id="7300" class="mz ks iq np b gy oc nu l nv nw">    // Set total transaction count in 2021<br/>    setTransactionCount(endTransactions - startTransactions);</span><span id="32e3" class="mz ks iq np b gy oc nu l nv nw">    // Received results, condition met to show them on screen<br/>    setResults(true);    </span><span id="4516" class="mz ks iq np b gy oc nu l nv nw">};</span></pre><p id="5f3e" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">9.转到HTML，我们需要做的第一件事是用我们刚刚编写的新函数替换按钮函数。改变<em class="oi">下按钮的功能调用改变该按钮功能</em>注释:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="a774" class="mz ks iq np b gy nt nu l nv nw">&lt;button onClick={accessEthereum} className='form-button' type='submit' name='submit' id='submit'&gt;</span></pre><p id="afc2" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">10.我们需要的最后一点代码是HTML，它将显示我们从归档节点收集的数据。在<strong class="ll ir"> return </strong>语句中，向下滚动到注释<em class="oi">您的HTML代码将在此处</em>并添加以下内容:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="9544" class="mz ks iq np b gy nt nu l nv nw">&lt;h3&gt;{address}&lt;/h3&gt;</span><span id="11df" class="mz ks iq np b gy oc nu l nv nw">&lt;p className='result-heading'&gt;Current Balance&lt;/p&gt;<br/>&lt;p&gt;{currentBalance} ETH&lt;/p&gt;</span><span id="b8b1" class="mz ks iq np b gy oc nu l nv nw">&lt;p className='result-heading'&gt;Start of 2021 Balance&lt;/p&gt;<br/>&lt;p&gt;{startOfYearBalance} ETH&lt;/p&gt;</span><span id="efd9" class="mz ks iq np b gy oc nu l nv nw">&lt;p className='result-heading'&gt;End of 2021 Balance&lt;/p&gt;<br/>&lt;p&gt;{endOfYearBalance} ETH&lt;/p&gt;</span><span id="f47f" class="mz ks iq np b gy oc nu l nv nw">&lt;p className='result-heading'&gt;Difference from Start of 2021&lt;/p&gt;<br/>&lt;p&gt;{balanceDifference} ETH&lt;/p&gt;</span><span id="ebb6" class="mz ks iq np b gy oc nu l nv nw">&lt;p className='result-heading'&gt;Number of transactions in 2021&lt;/p&gt;<br/>&lt;p&gt;{transactionCount}&lt;/p&gt;<br/>&lt;br /&gt;</span></pre><p id="59b8" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">要查看完整的项目代码，请查看这个<a class="ae mf" href="https://github.com/paul-mcaviney/archive-node-project-complete" rel="noopener ugc nofollow" target="_blank"> Github库</a>。</p><p id="560f" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">11.现在让我们测试一下我们的应用程序，看看它是否有效！首先，启动应用程序:</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="f6db" class="mz ks iq np b gy nt nu l nv nw">npm start</span></pre><p id="18d1" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在文本字段中输入以太坊钱包地址，然后点击<strong class="ll ir">提交</strong>。如果你没有在2021年激活的钱包地址，你可以使用<a class="ae mf" href="https://twitter.com/VitalikButerin" rel="noopener ugc nofollow" target="_blank"> Vitalik的。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/61bf6356621e6a001bda05a3a7312123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s6TlTpTOqfBGiDBw.jpg"/></div></div><p class="ny nz gj gh gi oa ob bd b be z dk translated">我们的最终结果！</p></figure><p id="c0c7" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">厉害！我们的结果显示正确，可以看到2021年钱包地址的所有活动！</p><h1 id="6f65" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">结论</h1><p id="9846" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">通过学习本教程，您使用Infura API端点URL访问了归档节点上的数据，然后在一个简单的<em class="oi"> ETH Year in Review </em>应用程序中很好地显示了这些数据。</p><p id="8996" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在最近的128个块之前，需要一个归档节点来访问以太坊块链中的数据。它们存储第一个数据块的所有历史状态数据，并且比完整节点更快、更高效地提供这些数据。现在，Infura向所有用户提供免费的存档节点访问，收集历史区块链数据从未如此简单！</p></div></div>    
</body>
</html>