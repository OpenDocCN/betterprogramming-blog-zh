<html>
<head>
<title>Building Smart Contracts for a Donut Vending Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为甜甜圈自动售货机建立智能合同</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-smart-contract-for-a-vending-machine-b1e901f61757?source=collection_archive---------7-----------------------#2022-04-07">https://betterprogramming.pub/building-smart-contract-for-a-vending-machine-b1e901f61757?source=collection_archive---------7-----------------------#2022-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5110" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">混合+稳固+智能合约</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f1710fbe1ffe574f1d6c2fea40cba2b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DGewPhNerMqmHjZO58yehA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">甜甜圈自动售货机智能合同，图片由作者编辑</p></figure><p id="5c88" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">自动售货机是一个有趣的事情，从坚实的基础开始。因此，我们将在Solidity中编写一个代码，它将帮助我们为甜甜圈自动售货机建立一个智能合同！</p><p id="6ab1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们从Remix开始，这是一个关于坚固性语言的IDE。它用于为区块链编写智能合同。就ERC-20令牌的实现编码而言，六个基本编码函数是:</p><ol class=""><li id="9ac0" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated"><code class="fe ma mb mc md b">getBalance</code></li><li id="0c8f" class="lr ls iq kx b ky me lb mf le mg li mh lm mi lq lw lx ly lz bi translated"><code class="fe ma mb mc md b">purchase</code></li><li id="d463" class="lr ls iq kx b ky me lb mf le mg li mh lm mi lq lw lx ly lz bi translated"><code class="fe ma mb mc md b">restock</code></li></ol><h2 id="d995" class="mj mk iq bd ml mm mn dn mo mp mq dp mr le ms mt mu li mv mw mx lm my mz na nb bi translated"><strong class="ak">混音</strong></h2><p id="f8ea" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">Remix IDE允许为类似以太坊的区块链开发、部署和管理智能合约。也可以作为学习平台。</p><p id="66dd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">它非常用户友好，有助于初学者了解部署合同所需的所有基本知识。</p><p id="a56e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们开始在File Explorers选项卡中创建一个名为<code class="fe ma mb mc md b">vending_machine.sol</code>的文件。</p><h1 id="1cff" class="ni mk iq bd ml nj nk nl mo nm nn no mr jw np jx mu jz nq ka mx kc nr kd na ns bi translated"><strong class="ak">代码</strong></h1><p id="afc9" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">Solidity 0.6.8引入了SPDX许可证标识符，因此开发人员可以指定合同使用的许可证。SPDX许可证标识符应添加到合同文件的顶部。以下标识符应添加到您的合同顶部:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="0bae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在需要编写我们将要使用的solidity版本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="b013" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一步是创建合同。在Solidity中，我们通过键入关键字<code class="fe ma mb mc md b">contract</code>后跟合同名称来编写智能合同。让我们从命名我们的合同销售机开始。所以，写下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="b124" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将在花括号中写下进一步的代码，因为所有的函数和变量都是它的一部分。接下来，我们定义将成为合同一部分的变量，即:</p><ol class=""><li id="b876" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated"><code class="fe ma mb mc md b">address public owner;</code></li><li id="d2e6" class="lr ls iq kx b ky me lb mf le mg li mh lm mi lq lw lx ly lz bi translated"><code class="fe ma mb mc md b">mapping(address =&gt; uint) public donutBalances;</code></li></ol><p id="8cf2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里，address指的是所有者的钱包地址，而mapping指的是一个关键字，我们可以将一种类型的变量映射到另一种类型的变量。</p><p id="d730" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，<code class="fe ma mb mc md b">donutBalances</code>是一个映射，其中甜甜圈的数量将与地址相关联。接下来，我们继续创建一个构造函数，当在以太坊区块链上进行部署时，将自动执行该构造函数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="192c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一个函数的创建是<code class="fe ma mb mc md b">getBalance()</code>。它用于获取自动售货机中剩余的甜甜圈的余额。</p><p id="112f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ma mb mc md b">donutBalances[address(this)]</code>代表与当前以太坊账户相关的甜甜圈余额。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="269a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一个函数称为<code class="fe ma mb mc md b">restock()</code>。它只限于所有者，因此，关键字以<code class="fe ma mb mc md b">require</code>的形式出现。</p><p id="3649" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当所有者输入要增加的金额时,<code class="fe ma mb mc md b">donutBalances</code>得到更新。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="554b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后一个功能是购买功能，它实际上帮助人们或顾客购买甜甜圈。</p><p id="c45d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们输入的一个甜甜圈的价格是0.5 ETH。因此，<code class="fe ma mb mc md b">msg.value</code>应该等于该数量乘以0.5 ETH。</p><p id="312f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，自动售货机应该有客户输入的甜甜圈数量。当这两个要求都满足时，该地址的余额将被扣除该金额。</p><p id="f0d7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，<code class="fe ma mb mc md b">msg.sender</code>的<code class="fe ma mb mc md b">donutBalances</code>将根据购买的甜甜圈数量进行更新。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="d151" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，代码完成。现在我们开始编译它。Remix会自动编译代码，并显示是否有错误。然后，我们继续部署代码。</p><p id="82ab" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">确保我们处于“部署和运行事务”选项卡中。那么要选择的环境就是Javascript VM。合同应该是我们的自动售货机合同。</p><p id="bad2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在部署它，您将获得如下部署的契约。此外，现在每当客户购买了甜甜圈，调用函数时会更新<code class="fe ma mb mc md b">donutBalances</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/f5a942c93b72343a5cf0b8b9ab4164e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*T66Lh40j8NI5H-rbxIjwEQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">当购买被按下时，自动售货机的甜甜圈余额减少</p></figure><p id="b6b5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，当我们从所有者的帐户调用restock函数时，<code class="fe ma mb mc md b">getBalance</code>再次更新为100！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/e5add76859a77f65397dfa543470149a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*WHr41bE3x5eJk8S_cOQV3A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">当所有者增加2个甜甜圈时，getBalance更新为100</p></figure><p id="0fa8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">自动售货机准备好了，我们的智能合约也准备好了。</p><p id="1419" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您有任何问题，可以参考GitHub链接:</p><div class="nx ny gp gr nz oa"><a href="https://github.com/Namyagupta/vending_machine" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">GitHub-Namyagupta/vending _ machine:一个自动售货机合约</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kp oa"/></div></div></a></div></div></div>    
</body>
</html>