<html>
<head>
<title>How to Play Music and Sound Effects in a SpriteKit Game</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SpriteKit游戏中播放音乐和音效</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/playing-music-and-sound-effects-in-a-spritekit-game-e3bdf8cc45e8?source=collection_archive---------6-----------------------#2019-10-06">https://betterprogramming.pub/playing-music-and-sound-effects-in-a-spritekit-game-e3bdf8cc45e8?source=collection_archive---------6-----------------------#2019-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="743c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将您的游戏带入生活！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c9d85c8dc0d7c3075a00064729bf7b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VwJyEOtyyZWPJkG1hSGUYA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@maltewingen?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马尔特·温根</a>在<a class="ae ky" href="https://unsplash.com/s/photos/music?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4dc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我和妻子目前正在开发一个小游戏。首先，我们只有一个场景，我们播放一些音频文件。随着游戏的发展，我们希望我们的应用程序设置中有两个滑块，用户可以分别改变背景音乐和声音效果的音量，正如你在下面的gif中看到的那样。</p><p id="73b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将向你展示我们在游戏中管理音乐和音效的方法！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/a41e5c2d2d04b02f48bf297dca44f8b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/1*JU2vIlxZ08WgDh_oOj21tg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">目标是:音乐和效果音量有两个独立滑块。</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="56f6" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">播放音频文件的简单方式</h1><p id="ef01" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">首先，我们来看一个播放音频文件的幼稚方式。</p><p id="416e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们用了一个<code class="fe na nb nc nd b">AVAudioPlayer</code>来播放背景音乐。这个类使用起来很方便——您可以创建一个实例，其中包含您想要收听的文件的URL，并使用<code class="fe na nb nc nd b">play</code>方法。以下要点显示了如何在操场上执行此操作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在操场上播放音频文件。</p></figure><p id="1d66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于效果，我们使用了不同的方法。由于声音效果是由我们的SKScene中节点之间的交互触发的，这些节点运行一个SKAction来播放声音文件。这里有一个在操场上用这种方式玩声音的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在操场上运行SKAction来播放音频文件。</p></figure><p id="79ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种播放音效的方式是使用<code class="fe na nb nc nd b">AudioToolbox</code>框架。这个框架允许你注册和播放短音效(30秒以下)，比<code class="fe na nb nc nd b">AVAudioPlayer</code>有更好的性能。然而，由于没有办法以编程方式控制音量，这个选项不适合我们的用例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用AudioToolbox播放一小段音频文件。</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a9a2" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">改进的音频处理</h1><p id="a130" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们需要一个通用的音频播放源，因此我们创建了一个名为AudioPlayer的协议。该协议定义了我们希望在应用程序中访问的所有功能。在我们的例子中，我们想要区分背景音乐和音效，背景音乐会一直播放，直到再次暂停，音效表示游戏中的事件。此外，我们希望为每个音频设置不同的音量。以下协议定义了这些功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们对音频播放器的定义。</p></figure><p id="eb98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">Music</code>和<code class="fe na nb nc nd b">Effect</code>都只将两个属性——音频文件的名称和类型包装为<code class="fe na nb nc nd b">String</code>。为了有一个共同的基础，我们定义了由两个<code class="fe na nb nc nd b">struct</code>实现的协议<code class="fe na nb nc nd b">SoundFile</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在结构中包装文件名和类型。</p></figure><p id="7962" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于此，我们可以给<code class="fe na nb nc nd b">AVAudioPlayer</code>添加一个方便的初始化器，它将用来播放所有的声音。这个新的初始化器被传递了一个<code class="fe na nb nc nd b">SoundFile</code>，并可能返回一个<code class="fe na nb nc nd b">AVAudioPlayer</code>设置的实例来播放给定的<code class="fe na nb nc nd b">SoundFile</code>。或者它可能抛出一个错误，在这种情况下，我们添加了一个新的包含可能错误的<code class="fe na nb nc nd b">enum</code>(例如<code class="fe na nb nc nd b">fileNotFound</code>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通过音频播放器直接使用我们的音乐和效果结构。</p></figure><p id="ac4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了方便访问整个应用程序中的所有<code class="fe na nb nc nd b">SoundFile</code>，我们添加了一个<code class="fe na nb nc nd b">struct</code>包装到其他<code class="fe na nb nc nd b">struct</code>中。这些包含所有音频文件，作为结构<code class="fe na nb nc nd b">Music</code>和<code class="fe na nb nc nd b">Effect</code>的实例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">轻松访问应用程序中的所有音频文件。</p></figure><p id="a4e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了实现我们的<code class="fe na nb nc nd b">AudioPlayer</code>协议之外，我们已经设置好了一切。我们添加了新的类<code class="fe na nb nc nd b">AudioPlayerImpl</code>来符合这个协议。</p><p id="8a81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个类需要有两个属性来保存当前的音乐和效果播放器，否则将听不到声音。此外，两个必需的属性<code class="fe na nb nc nd b">musicVolume</code>和<code class="fe na nb nc nd b">effectsVolume</code>都将从最大可能值1.0开始。由于可能有背景歌曲在播放，我们需要在更改音乐音量时调整当前音乐播放器的音量。</p><p id="b9fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要播放一个新的音乐文件，我们停止当前的播放器，尝试为该文件创建一个新的播放器，将其音量设置为当前选择的音乐音量，然后启动播放器。为了以后能够访问这个新播放器，我们将它保存在<code class="fe na nb nc nd b">currentMusicPlayer</code>属性中。</p><p id="8cb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">播放音效也同样简单——创建一个新的播放器，设置它的音量，然后启动它。同样，我们需要存储新的播放器来听到一些声音。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">把这些放在一起。</p></figure><p id="36ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在播放声音文件就像:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用新播放器。</p></figure><p id="5862" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过传递这个播放器实例，我们可以在整个应用程序中共享音量级别。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="0956" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，我希望你会对我的作品感兴趣。如果您有任何问题或改进建议，请告诉我！</p></div></div>    
</body>
</html>