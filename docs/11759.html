<html>
<head>
<title>Edit Salesforce Data Entirely Within Your Slack App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">完全在您的Slack应用程序中编辑Salesforce数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/edit-salesforce-data-entirely-within-your-slack-app-5cee81a92f9a?source=collection_archive---------13-----------------------#2022-04-13">https://betterprogramming.pub/edit-salesforce-data-entirely-within-your-slack-app-5cee81a92f9a?source=collection_archive---------13-----------------------#2022-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e87a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">第3部分:同步数据— Salesforce符合Slack</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1ca8eaa7d8e0e31b06fd215f8dc6a01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9yrLA-7odlFiVyIf.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">埃德加·莫兰在<a class="ae ky" href="https://unsplash.com/s/photos/salesforce?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f2fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们已经到了使用Salesforce的<a class="ae ky" href="https://github.com/developerforce/salesforce-slack-starter-kit" rel="noopener ugc nofollow" target="_blank"> Slack入门套件</a>快速搭建与Salesforce数据交互的可部署Slack应用程序系列的最后一部分。Slack Starter Kit使得通过Salesforce进行身份验证、将您的代码组织成可重用的块以及将项目部署到Heroku以便实时访问变得非常容易。我们这个系列很大程度上基于这些视频教程，展示了如何构建Slack应用程序。</p><p id="644a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/building-a-slack-app-with-native-sfdc-integration-bc91050d063e">在我们的第一篇文章</a>中，我们熟悉了Slack入门套件并设置了我们的开发环境。<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/building-a-slack-app-with-native-sfdc-integration-1b2dee945650">在我们的第二篇文章</a>中，我们的Slack应用程序发出了一个从Salesforce组织获取数据的查询，然后使用Block Kit中的UI组件显示结果。现在，我们将扩展该模式，展示如何在Slack中完全编辑Salesforce数据。我们开始吧！</p><h1 id="07be" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建快捷方式</h1><p id="a9a2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在Block Kit UI之外，Slack还支持另外两个交互系统:<a class="ae ky" href="https://api.slack.com/interactivity/slash-commands" rel="noopener ugc nofollow" target="_blank">斜杠命令</a>和<a class="ae ky" href="https://api.slack.com/interactivity/shortcuts/" rel="noopener ugc nofollow" target="_blank">快捷键</a>。斜线命令由用户在Slack的文本输入中输入(每个频道都有)，而快捷方式本质上是图形化的。因为它们更容易可视化，我们将通过创建一个快捷方式来演示快捷方式，该快捷方式将获取我们的联系人列表，并使我们能够编辑它们。</p><p id="e77d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加快捷方式(或者斜杠命令)首先需要告诉Slack命令的名称。转到Slack上的应用概述页面，然后单击<strong class="lb iu">交互性&amp;快捷方式</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/065a31685f05fa12d5dcbc75fd811627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XlDMx47AS0BatPOj.png"/></div></div></figure><p id="82ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">新建快捷方式</strong>，选择<strong class="lb iu">全局</strong>作为快捷方式类型，然后点击<strong class="lb iu">下一步</strong>。在下一页上，输入这些值:</p><ul class=""><li id="c2d6" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><strong class="lb iu">姓名</strong>:编辑联系人</li><li id="e515" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">简短描述</strong>:编辑SFDC上的联系人</li><li id="b0e9" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><strong class="lb iu">回拨ID </strong> : <code class="fe ng nh ni nj b">edit-contact-shortcut</code></li></ul><p id="00e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">创建</strong>，然后点击<strong class="lb iu">保存更改</strong>。切换到您的松弛工作区，并单击文本区域中的加号。您将能够浏览所有工作区快捷方式。在这里，您还会看到刚刚创建的全新快捷方式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/dff0de370d544253b9aa63efead9b8de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WYj0gZmreoMSOzFQ.png"/></div></div></figure><p id="70fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个快捷方式还不做任何事情，但是这个过程对于Slack了解你的快捷方式是必要的。接下来，让我们添加代码来处理每当有人单击该快捷方式时触发的事件。</p><h1 id="397f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">给捷径布线</h1><p id="4b63" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在您的代码编辑器中，导航到<code class="fe ng nh ni nj b">apps/slack-salesforce-starter-app/listeners/shortcuts/index.js</code>。这是我们将快捷方式事件与执行的代码联系起来的地方。初学者工具包已经给了我们一个快捷方式:<code class="fe ng nh ni nj b">whoami</code>。给定的行向我们建议我们需要做什么:我们调用一个名为<code class="fe ng nh ni nj b">shortcut</code>的函数，并传入一个字符串和一个函数名。在这种情况下，我们的字符串是我们之前定义的回调ID，我们的函数名是我们尚未编写的代码。将文件内容更改为如下所示:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="702f" class="np lw it nj b gy nq nr l ns nt">const { whoamiCallback } = require('./whoami');<br/>const { editContactCallback } = require('./edit-contact');</span><span id="e574" class="np lw it nj b gy nu nr l ns nt">module.exports.register = (app) =&gt; {<br/>   app.shortcut('who_am_i', whoamiCallback);<br/>   app.shortcut('edit-contact-shortcut', editContactCallback);<br/>};</span></pre><p id="e09b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在这里打好基础，说:“<em class="nv"> Slack App，如果你得到一个回调ID为</em> <code class="fe ng nh ni nj b"><em class="nv">edit-contact-shortcut</em></code> <em class="nv">的快捷方式，运行</em> <code class="fe ng nh ni nj b"><em class="nv">editContactCallback</em></code>。”</p><p id="be5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在同一个文件夹中，创建一个名为<code class="fe ng nh ni nj b">edit-contact.js</code>的文件，并将这些行粘贴到其中:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="d0c8" class="np lw it nj b gy nq nr l ns nt">'use strict';</span><span id="7e9b" class="np lw it nj b gy nu nr l ns nt">const {<br/>  editContactResponse,<br/>  authorize_sf_prompt<br/>} = require('../../user-interface/modals');</span><span id="bf3c" class="np lw it nj b gy nu nr l ns nt">const editContactCallback = async ({ shortcut, ack, client, context }) =&gt; {<br/>  try {<br/>    await ack();<br/>    if (context.hasAuthorized) {<br/>      const conn = context.sfconnection;<br/>      await client.views.open({<br/>        trigger_id: shortcut.trigger_id,<br/>        view: await editContactResponse(conn)<br/>      });<br/>    } else {<br/>      // Get BotInfo<br/>      const botInfo = await client.bots.info({ bot: context.botId });<br/>      // Open a Modal with message to navigate to App Home for authorization<br/>      await client.views.open({<br/>        trigger_id: shortcut.trigger_id,<br/>        view: authorize_sf_prompt(context.teamId, botInfo.bot.app_id)<br/>      });<br/>    }<br/>  } catch (error) {<br/>    // eslint-disable-next-line no-console<br/>    console.error(error);<br/>  }<br/>};</span><span id="6be3" class="np lw it nj b gy nu nr l ns nt">module.exports = { editContactCallback };</span></pre><p id="cae4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，这可能看起来有点吓人，但它主要是关于验证样板文件，确保用户有一个活动的SFDC连接。在第一个逻辑路径中(如果<code class="fe ng nh ni nj b">context.hasAuthorized</code>是<code class="fe ng nh ni nj b">true</code>，我们执行一个名为<code class="fe ng nh ni nj b">editContactResponse</code>的函数，它接受我们的open Salesforce <code class="fe ng nh ni nj b">conn</code>部分。在否定的情况下，我们要求用户转到Home选项卡重新进行身份验证，就像我们在本教程的第1部分中所做的那样。</p><p id="52f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导航到<code class="fe ng nh ni nj b">apps/slack-salesforce-starter-app/user-interface/modals</code>文件夹，创建一个名为<code class="fe ng nh ni nj b">edit-contact-response.js</code>的文件。这里，我们将弹出一个带有联系信息的模式，类似于我们在本教程第2部分的Home选项卡中看到的行:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="1ecc" class="np lw it nj b gy nq nr l ns nt">'use strict';<br/>const { Elements, Modal, Blocks } = require('slack-block-builder');</span><span id="b7c1" class="np lw it nj b gy nu nr l ns nt">const editContactResponse = async (conn) =&gt; {<br/>  const result = await conn.query(<br/>    `Select Id, Name, Description FROM Contact`<br/>  );<br/>  let records = result.records;</span><span id="5a6a" class="np lw it nj b gy nu nr l ns nt">  let blockCollection = records.map((record) =&gt; {<br/>    return Blocks.Section({<br/>      text: `*${record.Name}*\n${record.Description}`<br/>    }).accessory(<br/>      Elements.Button()<br/>        .text(`Edit`)<br/>        .actionId(`edit_contact`)<br/>        .value(record.Id)<br/>    );<br/>  });</span><span id="e6c2" class="np lw it nj b gy nu nr l ns nt">  return Modal({ title: 'Salesforce Slack App', close: 'Close' })<br/>    .blocks(blockCollection)<br/>    .buildToJSON();<br/>};</span><span id="bd50" class="np lw it nj b gy nu nr l ns nt">module.exports = { editContactResponse };</span></pre><p id="b87b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第2部分中的代码和这个块的主要区别在于，我们使用了一个名为<code class="fe ng nh ni nj b">blockCollection</code>的数组，它允许我们构造一个块数组(在本例中是Section块)。<code class="fe ng nh ni nj b">blocks</code>知道如何获取这个数组并将其转换成Slack理解的格式，这使得通过循环数组创建数据变得非常简单，就像我们在这里所做的那样。在本系列的第2部分中，我们构建了一个巨大的数据串。然而，通过使用<code class="fe ng nh ni nj b">BlockCollection</code>，我们可以附加其他松散的元素——比如按钮——我们已经在这里完成了。</p><p id="0d21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，在<code class="fe ng nh ni nj b">apps/slack-salesforce-starter-app/user-interface/modals/index.js</code>中，我们需要导出这个函数，这样它就可以被我们的<code class="fe ng nh ni nj b">edit-contact.js</code>函数导入:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="bc57" class="np lw it nj b gy nq nr l ns nt">'use strict';<br/>const { whoamiresponse } = require('./whoami-response');<br/>const { editContactResponse } = require('./edit-contact-response');<br/>const { authorize_sf_prompt } = require('./authorize-sf-prompt');</span><span id="30b9" class="np lw it nj b gy nu nr l ns nt">module.exports = { whoamiresponse, editContactResponse, authorize_sf_prompt };</span></pre><p id="f1d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在通过git push将这个新代码部署到Heroku之后，切换到Slack工作区，尝试执行快捷方式；您将会看到一个类似如下的对话框:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2d967db50217ed0e9c44d69cf61e2d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*b6Y0S-G6hlZ7yCkR.png"/></div></div></figure><h1 id="90bf" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">更新Salesforce数据</h1><p id="b307" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们能够获取并显示Salesforce数据。现在，是时候连接编辑按钮来更改Salesforce数据了！</p><p id="ec3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Slack的许多交互组件都有一个<code class="fe ng nh ni nj b"><a class="ae ky" href="https://api.slack.com/interactivity/handling#payloads" rel="noopener ugc nofollow" target="_blank">action_id</a></code>，和<code class="fe ng nh ni nj b">callback_id</code>一样，用来识别用户操作的元素。就像初学者工具包中的其他东西一样，有一个特殊的目录，您可以在其中为这些动作id定义侦听器:<code class="fe ng nh ni nj b">apps/slack-salesforce-starter-app/listeners/actions</code>。在那里的<code class="fe ng nh ni nj b">index.js</code>文件中，让我们添加一个新行，将动作ID与我们尚未编写的功能联系在一起:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="22a3" class="np lw it nj b gy nq nr l ns nt">'use strict';<br/>const { appHomeAuthorizeButtonCallback } = require('./app-home-authorize-btn');<br/>const { editContactButtonCallback } = require('./edit-contact-btn');</span><span id="41a2" class="np lw it nj b gy nu nr l ns nt">module.exports.register = (app) =&gt; {<br/>  app.action('authorize-with-salesforce', appHomeAuthorizeButtonCallback);<br/>  app.action('edit_contact', editContactButtonCallback);<br/>};</span></pre><p id="a7be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在同一个文件夹中，创建一个名为<code class="fe ng nh ni nj b">edit-contact-btn.js</code>的新文件，并将这些行粘贴到其中:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="be0b" class="np lw it nj b gy nq nr l ns nt">'use strict';<br/>const {<br/>  editIndividualContact,<br/>  authorize_sf_prompt<br/>} = require('../../user-interface/modals');</span><span id="9d49" class="np lw it nj b gy nu nr l ns nt">const editContactButtonCallback = async ({ body, ack, client, context }) =&gt; {<br/>  const contactId = body.actions[0].value;<br/>  try {<br/>    await ack();<br/>  } catch (error) {<br/>    // eslint-disable-next-line no-console<br/>    console.error(error);<br/>  }</span><span id="1d8d" class="np lw it nj b gy nu nr l ns nt">  if (context.hasAuthorized) {<br/>    const conn = context.sfconnection;<br/>    const result = await conn.query(<br/>      `SELECT Id, Name, Description FROM Contact WHERE Id='${contactId}'`<br/>    );<br/>    let record = result.records[0];<br/>    await client.views.push({<br/>      trigger_id: body.trigger_id,<br/>      view: editIndividualContact(record)<br/>    });<br/>  } else {<br/>    // Get BotInfo<br/>    const botInfo = await client.bots.info({ bot: context.botId });<br/>    // Open a Modal with message to navigate to App Home for authorization<br/>    await client.views.push({<br/>      trigger_id: body.trigger_id,<br/>      view: authorize_sf_prompt(context.teamId, botInfo.bot.app_id)<br/>    });<br/>  }<br/>};</span><span id="f266" class="np lw it nj b gy nu nr l ns nt">module.exports = { editContactButtonCallback };</span></pre><p id="d8fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个文件的开头和结尾应该看起来很熟悉:我们正在向Slack发送一个<code class="fe ng nh ni nj b">ack</code>响应，让它知道我们的应用程序收到了事件负载(在本例中，是通过单击编辑按钮)。我们还会检查我们是否仍然通过了身份验证。这里，我们使用联系人的ID进行单个DB查找，在构造UI时，我们将它作为一个值附加到编辑按钮上。</p><p id="cd02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码创建了另一个我们需要定义的模态设计。回到<code class="fe ng nh ni nj b">apps/slack-salesforce-starter-app/user-interface/modals</code>，创建一个名为<code class="fe ng nh ni nj b">edit-individual-contact.js</code>的文件，并将这些行粘贴到其中:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="02b9" class="np lw it nj b gy nq nr l ns nt">'use strict';<br/>const { Elements, Modal, Blocks } = require('slack-block-builder');</span><span id="b78f" class="np lw it nj b gy nu nr l ns nt">const editIndividualContact = (record) =&gt; {<br/>  return Modal({ title: 'Edit Contact', close: 'Close' })<br/>    .blocks(<br/>      Blocks.Input({ blockId: 'description-block', label: record.Name }).element(<br/>        Elements.TextInput({<br/>          placeholder: record.Description,<br/>          actionId: record.Id<br/>        })<br/>     )<br/>   )<br/>   .submit('Save')<br/>   .callbackId('edit-individual')<br/>   .buildToJSON();<br/>};</span><span id="6653" class="np lw it nj b gy nu nr l ns nt">module.exports = { editIndividualContact };</span></pre><p id="5ca5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们创建了一个只有一个块的模型:一个输入元素。该元素将预先填充联系人的描述。我们可以编辑这个块，并根据需要更改描述。</p><p id="d4c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这段代码中需要指出两个重要的注意事项:</p><ol class=""><li id="af33" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu nw my mz na bi translated">注意，我们将一个<code class="fe ng nh ni nj b">actionId</code>附加到输入元素上。这类似于我们之前附加到编辑按钮上的ID，只是这一次，它是基于我们正在编辑的记录的ID动态生成的。</li><li id="3994" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu nw my mz na bi translated">您还会注意到我们有另一个ID，即<code class="fe ng nh ni nj b">callbackID</code>，它附加到了模型本身。请记住这些id的存在:我们将在一会儿解决这两个问题。现在，打开同一个目录中的<code class="fe ng nh ni nj b">index.js</code>文件，以及<code class="fe ng nh ni nj b">require/export</code>这个新的模型创建函数:</li></ol><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="f0ad" class="np lw it nj b gy nq nr l ns nt">const { editIndividualContact } = require('./edit-individual-contact');<br/>// ...<br/>module.exports = {<br/>  whoamiresponse,<br/>  editContactResponse,<br/>  editIndividualContact,<br/>  authorize_sf_prompt<br/>};</span></pre><p id="8024" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当您单击编辑按钮时，系统会提示您更改描述:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/656344d38ac70da5fecec5814e238f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rRL6seKod9J-9MJb.png"/></div></div></figure><p id="fd53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在需要将更新后的文本发送给Salesforce。点击<strong class="lb iu">保存</strong>按钮……无任何反应。为什么？Slack有一套不同的事件来处理这样的交互，叫做<a class="ae ky" href="https://api.slack.com/reference/interaction-payloads/views" rel="noopener ugc nofollow" target="_blank">视图提交</a>。在构建应用程序时，初学者工具包提供了一个很好的出发点，但它不能处理每个松散的用例，包括这个。但这不是问题——我们将自己添加功能！</p><p id="6775" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ng nh ni nj b">apps/slack-salesforce-starter-app/user-interface folder</code>中，创建一个名为<code class="fe ng nh ni nj b">views</code>的新文件夹。就像之前一样，我们这里的<strong class="lb iu">保存</strong>按钮有一个动作ID来标识它:<code class="fe ng nh ni nj b">edit-individual-contact</code>。我们将回到<code class="fe ng nh ni nj b">apps/slack-salesforce-starter-app/listeners/actions/index.js</code>来配置这个函数:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="c277" class="np lw it nj b gy nq nr l ns nt">const { editIndividualButtonCallback } = require('./edit-individual-btn);</span><span id="0b17" class="np lw it nj b gy nu nr l ns nt">// ... </span><span id="84bd" class="np lw it nj b gy nu nr l ns nt">app.action('edit-individual-contact', editIndividualButtonCallback);</span></pre><p id="c35d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个名为<code class="fe ng nh ni nj b">edit-individual-contact.js</code>的新文件，并将这些行粘贴到其中:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="9259" class="np lw it nj b gy nq nr l ns nt">'use strict';</span><span id="c228" class="np lw it nj b gy nu nr l ns nt">const { submitEditCallback } = require('./submit-edit');</span><span id="762b" class="np lw it nj b gy nu nr l ns nt">module.exports.register = (app) =&gt; {<br/>  app.view('edit-individual', submitEditCallback);<br/>};</span></pre><p id="f394" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种格式与Slack初学者工具包提供的其他侦听器相同。唯一的区别是我们调用了<code class="fe ng nh ni nj b">view</code>方法。我们还需要将这个侦听器和其他侦听器一起注册。打开<code class="fe ng nh ni nj b">apps/slack-salesforce-starter-app/listeners/index.js</code>，和<code class="fe ng nh ni nj b">require/register</code>新的视图监听器:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="8ac0" class="np lw it nj b gy nq nr l ns nt">const viewListener = require('./views');</span><span id="1f9e" class="np lw it nj b gy nu nr l ns nt">module.exports.registerListeners = (app) =&gt; {<br/>  // ...<br/>  viewListener.register(app);<br/>};</span></pre><p id="c690" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，在<code class="fe ng nh ni nj b">apps/slack-salesforce-starter-app/listeners/views</code>中，创建另一个名为<code class="fe ng nh ni nj b">submit-edit.js</code>的文件，并将这些行粘贴到其中:</p><pre class="kj kk kl km gt nl nj nm nn aw no bi"><span id="5e45" class="np lw it nj b gy nq nr l ns nt">'use strict';<br/>const { editContactResponse, authorize_sf_prompt } = require('../../user-interface/modals');</span><span id="c4a5" class="np lw it nj b gy nu nr l ns nt">const submitEditCallback = async ({ view, ack, client, context }) =&gt; {<br/>  try {<br/>    await ack();<br/>  } catch (error) {<br/>    // eslint-disable-next-line no-console<br/>    console.error(error);<br/>  }</span><span id="d1a1" class="np lw it nj b gy nu nr l ns nt">  if (context.hasAuthorized) {<br/>    const contactId = view.blocks[0].element.action_id;<br/>    const newDescription =<br/>      view.state.values['description-block'][contactId].value;<br/>    const conn = context.sfconnection;<br/>    await conn.sobject('Contact').update({<br/>      Id: contactId,<br/>      Description: newDescription<br/>    });</span><span id="ade8" class="np lw it nj b gy nu nr l ns nt">    await client.views.open({<br/>      trigger_id: view.trigger_id,<br/>      view: await editContactResponse(conn)<br/>    });<br/>  } else {<br/>    // Get BotInfo<br/>    const botInfo = await client.bots.info({ bot: context.botId });<br/>    // Open a Modal with message to navigate to App Home for authorization<br/>    await client.views.push({<br/>      trigger_id: view.trigger_id,<br/>       view: authorize_sf_prompt(context.teamId, botInfo.bot.app_id)<br/>    });<br/>  }<br/>};</span><span id="1b60" class="np lw it nj b gy nu nr l ns nt">module.exports = { submitEditCallback };</span></pre><p id="d3a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来讨论一下之前设置的那些id。当Slack将事件有效负载发送到我们的应用程序时，默认情况下，它会自动为每个输入元素生成一个ID。那是因为Slack不知道底层数据<em class="nv">是什么</em>。通过动作id命名元素是您的责任。Slack使用这些id作为密钥来填充有效负载。当您收到Slack的有效负载时，您可以使用您提供的键来解析用户输入的数据。</p><p id="c42f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果您按照流程编辑您的联系人的描述，您会注意到模式将正确保存。要验证Salesforce端的数据是否已更新，请在您的终端中运行<code class="fe ng nh ni nj b">sfdx force:org:open</code>并导航到Contacts选项卡。</p><h1 id="f8c3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="7431" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Slack Starter Kit使得构建一个监听用户事件的Slack应用程序变得轻而易举。然而，除此之外，与Salesforce和Heroku互动也是一种绝对的乐趣。我们已经介绍了初学者工具包的所有功能。如果您想了解Slack和Salesforce如何合作，请查看我们在<a class="ae ky" href="https://developer.salesforce.com/blogs/2021/11/slack-and-salesforce-building-better-together" rel="noopener ugc nofollow" target="_blank"> building better together </a>上的博文。此外，与Salesforce交互的后端框架是精彩的<a class="ae ky" href="https://jsforce.github.io/" rel="noopener ugc nofollow" target="_blank"> JSforce </a>项目。请务必查看其文档和<a class="ae ky" href="https://developer.salesforce.com/docs/apis" rel="noopener ugc nofollow" target="_blank">sales force API参考</a>以了解更多关于您可以构建的内容！</p></div></div>    
</body>
</html>