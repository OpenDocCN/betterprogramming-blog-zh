<html>
<head>
<title>Back Press Handling in Android Jetpack Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android Jetpack Compose中的反压处理</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/back-press-handling-in-android-jetpack-compose-42d9ed402d40?source=collection_archive---------2-----------------------#2021-10-06">https://betterprogramming.pub/back-press-handling-in-android-jetpack-compose-42d9ed402d40?source=collection_archive---------2-----------------------#2021-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3e4c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建一个处理函数来定制你的反压事件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7251ba6ad1e1675c34f0c428bf151051.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jFuxaabWY8Y9MKtN"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@szolkin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">谢尔盖·佐尔金</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="24b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在Android和iPhone中发现的一个显著差异是它们如何处理系统背压。在iOS中，你可以从左向右滑动，而Android提供了不同的选项。无论用户选择使用哪个选项，开发人员都可以通过<code class="fe lv lw lx ly b">onBackPressed</code>函数处理事件。</p><h1 id="19e0" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">历史</h1><p id="0b8d" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">回到2015年，当我们主要使用android activities来设计新屏幕时，处理系统back press非常容易，因为我们可以直接覆盖<code class="fe lv lw lx ly b">onBackPressed</code>功能。</p><p id="64f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">后来出现了片段API。几年来，开发人员努力在片段中处理反压，因为反压事件是活动的一部分，而不是片段。过了一段时间，Android团队引入了<code class="fe lv lw lx ly b">onBackPressedDispatcher</code>,这使得片段可以添加一个回调函数来接收回压事件。</p><h1 id="5d19" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">先决条件</h1><p id="4aac" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">在进一步学习之前，您必须具备如何使用Jetpack Compose的基本知识。如果你是作曲新手，我强烈推荐阅读以下文章:</p><ul class=""><li id="d0bd" class="mw mx it lb b lc ld lf lg li my lm mz lq na lu nb nc nd ne bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/jetpack-compose-components-part-1-a80717dbfb59"> Jetpack组合组件(第1部分)</a></li><li id="d62d" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/explore-android-bottom-sheets-in-jetpack-compose-50eff0257231">探索Jetpack Compose中的Android底部表单</a></li></ul><h1 id="ddf0" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">Jetpack撰写</h1><p id="b4d2" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">Jetpack Compose在现代android开发中起着关键作用。Jetpack compose是稳定的，人们开始用compose构建生产就绪的应用程序。所以是时候学习如何在可组合函数中处理系统回压了。</p><p id="8b70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现成的系统back press in compose基于导航控制器运行。因此，当用户触发back press事件时，默认情况下，compose会在内部导航到导航视图中的上一个可组合函数。要了解更多有关撰写导航的信息，请阅读本文。</p><p id="5790" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您想要在用户回压时执行自定义操作，或者当您想要关闭compose中的底部表单时，就会出现问题。由于导航库不支持Jetpack compose底部表单，系统back press会关闭当前屏幕，而不是底部表单。</p><p id="fc32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了处理这些实时用例，compose提供了<code class="fe lv lw lx ly b">BackHandler</code>函数。首先，让我们来看看函数签名:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="d2b9" class="no ma it ly b gy np nq l nr ns">@Composable<br/>public fun BackHandler(enabled: Boolean = true, onBack: () -&gt; Unit)</span></pre><p id="5453" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，这个函数有两个参数:</p><ul class=""><li id="a2cc" class="mw mx it lb b lc ld lf lg li my lm mz lq na lu nb nc nd ne bi translated"><code class="fe lv lw lx ly b">enabled</code> —确定是否应启用此<code class="fe lv lw lx ly b">BackHandler</code>来处理系统回压事件。</li><li id="565a" class="mw mx it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe lv lw lx ly b">onBack</code> — Kotlin单元函数，可以传递一段代码在系统回压时执行。</li></ul><p id="2b7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看函数的用法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="9ec7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这非常简单，但是深入挖掘，您会发现上述实现的一个根本问题。Jetpack的compose主要基于根据状态构建UI的理论。通过向enabled参数传递一个静态值，您将无限地消耗back press事件。</p><p id="2fdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们应该传递一个状态，而不是传递一个静态值。例如，您正在处理构成底部纸张的印刷。这里我们需要使用的理想状态是<code class="fe lv lw lx ly b">ModalBottomSheetState</code>(基于您正在使用的底板类型)。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="b2bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此处<code class="fe lv lw lx ly b">BackHandler</code>的启用是基于底层纸的状态，这意味着只有当底层纸的状态可见(显示给用户)时，它才会接收回压事件。</p><p id="a023" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在多个可组合组件中使用<code class="fe lv lw lx ly b">BackHandler</code>,最里面的可组合组件接收回调，如果未注册，则回调在阶梯中向上移动。</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="1d2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前就这些。希望你学到了有用的东西。感谢阅读。</p></div></div>    
</body>
</html>