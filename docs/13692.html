<html>
<head>
<title>Is Upgrading From .Net 3.1 to .Net 6.0 Really Worth It?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">正在从升级。Net 3.1到。Net 6.0真的值得吗？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/does-it-really-worth-upgrading-your-app-from-net-3-1-to-net-6-0-c27641be70ac?source=collection_archive---------6-----------------------#2022-09-17">https://betterprogramming.pub/does-it-really-worth-upgrading-your-app-from-net-3-1-to-net-6-0-c27641be70ac?source=collection_archive---------6-----------------------#2022-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="25cf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们测试并找出答案</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ed29340145c16f2ef98c58929c1ca64e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t2f79M3xs5IK2zPSgJiRtw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">叶卡捷琳娜·博洛夫索娃在<a class="ae ky" href="https://www.pexels.com/" rel="noopener ugc nofollow" target="_blank">佩克斯</a>拍摄的照片</p></figure><p id="dcac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://dotnet.microsoft.com/en-us/download/dotnet/3.1" rel="noopener ugc nofollow" target="_blank"> The。Net Core 3.1 </a>是一个很棒的框架，由于长期支持(LTS) <a class="ae ky" href="https://docs.microsoft.com/en-us/lifecycle/products/microsoft-net-and-net-core" rel="noopener ugc nofollow" target="_blank">将于今年年底</a>(2022年12月)结束，现在可能是开始考虑升级现有应用的好时机。</p><p id="93ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，尽管LTS结束日期和新的语言特性，从性能的角度来看，值得努力吗？</p><p id="2026" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将尝试通过做一些测试来回答这个问题，并提供测试代码，这样您就可以以您认为更合适的方式重现或定制测试。</p><h1 id="57bb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">我以前的测试经验</h1><p id="c697" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">前一段时间，我在我的(简陋的)机器上本地运行了<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/what-is-faster-net-or-node-js-449a3c315407">我的性能测试</a>来比较。Net和Node.js，结果真的让我印象深刻。作为一个超级粉丝。Net，我决定运行一个类似的测试，但是这次在。Net 3.1和。Net 6.0使用相同的方法。</p><h2 id="e533" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">关于测试</h2><p id="cc99" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我将遵循与上次测试非常相似的方法；我将定义这三个测试场景:</p><ol class=""><li id="be3e" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated">Hello world:返回文本“Hello World”的简单端点。净”</li></ol><p id="b187" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2 .读取文件:读取100行文件并返回内容的端点。</p><p id="d628" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3 .冒泡排序:一个端点，用降序的数字填充一个长数组，使用<a class="ae ky" href="https://en.wikipedia.org/wiki/Bubble_sort" rel="noopener ugc nofollow" target="_blank">冒泡排序算法</a>对数字进行排序，并返回排序后的列表</p><blockquote class="nn no np"><p id="b474" class="kz la nq lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:在我最近的性能测试中，我对两者都使用了同步读取文件的方法。Net和NodeJs应用程序，我收到了一些指出这一点的评论，但即使在改为使用async-await后，性能差异也没有显著变化，无论如何，对于这些测试，我从一开始就开始使用async-await。</p></blockquote><h2 id="ae9e" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">测试工具</h2><p id="b65a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我将使用K6工具进行测试，并行运行10，000个请求，并使用30个虚拟用户请求，请求之间没有时间间隔。</p><p id="1cfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要设置它，只需在每个项目的根目录下添加下面的<code class="fe nu nv nw nx b">k6test.js</code>文件，并为每个测试运行更改端口和端点。</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="b2c6" class="ms lw it nx b gy oc od l oe of">import http from 'k6/http';<br/>export const options = {<br/>   vus: 30,<br/>   iterations: '10000',<br/>};</span><span id="8403" class="ms lw it nx b gy og od l oe of">export default function () {<br/>  http.get('http://localhost:5000/');<br/>}</span></pre><p id="1012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并行运行意味着我将在同一台计算机上同时开始这两个测试。</p><h2 id="e6e3" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">构建解决方案</h2><p id="91a6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您首先需要检查您是否有两个版本的。Net core SDK安装在你的计算机上来检查这个终端上的运行<code class="fe nu nv nw nx b">dotnet --list-sdks</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/aad99e2c2f0de5d877f7228b7fea0bf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*Cjq0bSOS9GbemqSKOVR-Yw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">点网列表SDK命令结果</p></figure><p id="3627" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的情况下，我的机器上有四个安装版本，我将只使用3.1.423和6.0.203。</p><p id="b259" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在创建新项目之前指定一个版本，您只需要在根文件夹中有一个与此类似的<code class="fe nu nv nw nx b">global.json</code>文件。</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="b31f" class="ms lw it nx b gy oc od l oe of">{<br/>   "sdk": {<br/>      "version": "3.1.422"<br/>   }<br/>}</span></pre><p id="88ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当运行<code class="fe nu nv nw nx b">dotnet new webapi</code>时，一个新的项目将按照指定的版本创建。</p><p id="3cf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个解决方案中的示例代码非常简单。我们有带三个端点的类<code class="fe nu nv nw nx b">PerformanceComparisonController</code>:<code class="fe nu nv nw nx b">/</code>、<code class="fe nu nv nw nx b">/readfile</code>和<code class="fe nu nv nw nx b">/bubblesort</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="4b22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个应用程序将遵循相同的方法，这一次<code class="fe nu nv nw nx b">global.json</code>将指定6.0版本。它看起来是这样的:</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="e5e1" class="ms lw it nx b gy oc od l oe of">{<br/>   "sdk": {<br/>      "version": "6.0.203"<br/>   }<br/>}</span></pre><p id="dc57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于第二个应用程序，代码实际上是相同的，但是我利用了。Net 6，所以我没有使用控制器，而是直接在<code class="fe nu nv nw nx b">Program.cs</code>文件中映射所有的端点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="f4f9" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">运行测试</h2><p id="acff" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在创建了包含两个项目和K6测试脚本的解决方案之后，我定义了一些bash文件来更快更容易地执行它们。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/f55e57c89ffa56f627782ccf0b58e10e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CAv9KWSE_31wncrp8l5Cg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置测试</p></figure><p id="3f74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在根文件夹中，运行命令<code class="fe nu nv nw nx b">./run-apps.sh</code>将在发布模式下执行这两个应用程序，并将暴露。Net 3.1和。Net 6.0应用分别在<code class="fe nu nv nw nx b">ports 5000 and 5001</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/1f647a138ed3717ba748eeecf8f97702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*hgAAygq5xqYliN57GKg7WQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">两个应用程序都在发布模式下执行</p></figure><p id="2927" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我所说的，我在两个独立的终端中同时运行两个测试脚本(我更喜欢在VSCode终端窗口中分割一个终端)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/5b9d56f7e3be6c074200fe7b288d1c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QrN2OHIhtIa9TwxKOxTBjA.png"/></div></div></figure><p id="ede7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但实际上。我们的测试设置已经准备好了。</p><blockquote class="nn no np"><p id="9185" class="kz la nq lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated"><strong class="lb iu">注</strong>:本次测试使用的所有文件都在我的<a class="ae ky" href="https://github.com/edsondiasalves/dotnet-core-comparison" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中有，可以随意查看，随心所欲。</p></blockquote><h2 id="56ed" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">试验结果</h2><blockquote class="nn no np"><p id="47c8" class="kz la nq lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated">第一项测试:Hello World</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/24186978cae4f8e95ef152ba1b2a584f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HoSAna5xyQm6GBcNCd7fEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。Net 3.1</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/dd24cd7a0d255666ad63306c1002c243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzELaXobazeek7yRgrCoQg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。Net 6.0</p></figure><blockquote class="nn no np"><p id="ffe5" class="kz la nq lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated">第二项测试:读取文件</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/273f9a30594b883de592daff77187528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jtjtgijytjSaMBplCX5E2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。Net 3.1</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/978eb290cf51ed8ae2cbb71f25e96e0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vNc1KhlFPHQ0gexpDdAAIA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。Net 6.0</p></figure><blockquote class="nn no np"><p id="0153" class="kz la nq lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated">第三个测试:冒泡排序</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/cf0013db314ca5e5c92bde86c9edede6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*biOkyu0jKxm97ac4uXNV4g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。Net 3.1</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/e1658cf406fb2b176d26a432a518c24b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QkeI16oJmV0YMf5gFJQRUw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。Net 6.0</p></figure><p id="fcd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我创建了下表来整合测试并促进分析:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">所有测试结果</p></figure><p id="5bce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您所看到的，结果非常令人印象深刻，但它们可能会因您的硬件、操作系统等条件而异。</p><p id="7592" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论如何，至少在这个简单的例子中。Net 6.0比。Net 3.1，太神奇了。</p><h1 id="c9c1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最终考虑</h1><p id="0e29" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">哇，真令人印象深刻。</p><p id="a7be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，在。Net 3.1和。Net 6.0。尽管性能是决定迁移现有应用的一个非常重要的原因，但还有其他事情需要考虑。例如，从的升级。Net 3.1到。Net 6.0也将受益于。Net 5.0 和微软支持到2024年11月。</p><p id="0e2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢谢你读到这里。请随意在我的<a class="ae ky" href="https://github.com/edsondiasalves/dotnet-core-comparison" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>上获取本文中使用的解决方案。下次见。</p><p id="b4c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nq">(是的，我相信升级是值得的。)</em></p></div></div>    
</body>
</html>