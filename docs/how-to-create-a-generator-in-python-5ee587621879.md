# 如何用 Python 创建生成器

> 原文：<https://betterprogramming.pub/how-to-create-a-generator-in-python-5ee587621879>

## 生成器、Python 和测试驱动开发

![](img/1002c2b3b334554bbbed83665e633739.png)

Izabelle Acheson 在 [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

自从 2001 年在 PEP 255 中引入以来，生成器一直是 Python 中的一个重要概念。那都快 20 年前了！生成器函数允许你以一种快速、简单、干净的方式创建一个迭代器。您可以将它们视为一个对象，可以非常容易地在其上循环或迭代。

作为初学者，编写迭代器可能非常复杂——更不用说编写测试了。我将使用测试驱动的开发方法(测试、编码和可选的重构)来解释，创建一个生成器实际上是非常容易的。我将在几分钟内带你从一个基本的例子到一个完整的发生器。所以坐到副驾驶座上，因为今天我是你的司机。

# 让我们从你能想到的最基本的发电机开始

在这个例子中，我将向您展示如何创建您见过的最基本的生成器。我将创建一个只返回`1`的生成器。在我创建生成器之前，让我写一个测试。

## 试验

所以我写了一个测试，创建了你能创建的最基本的生成器。下一个函数检索生成器的第一个值。测试期望第一个值是`1`。很简单，对吧？

当我们运行测试时，我们会立即发现它甚至无法编译。没有人喜欢考试不及格。因此，我们要让它工作——这样我们可以看到美丽的绿色，而不是红色测试错误。

测试生成值 1

## 密码

我们需要一个生成器函数，一个返回迭代器的函数。在 Python 中，你可以通过使用`yield`关键字简单地实现这一点。代码产生值`1`，之前编写的测试将会成功。我们就喜欢这样，对吧？编写最少的代码来使测试工作是一个好习惯。当然，我们不能就此打住。我们可以创建更具体的测试用例。

单值生成器

**提示:**调用`next`函数两次会导致错误。此时代码只产生一个值。当生成器遇到 return 语句或函数末尾时，生成器将停止生成新值。当然，如果你不相信我，你可以自己检查一下。我不会因此而反对你。

# 让我们尝试两个值

## 试验

我们不能只停留在一个价值观上——那太荒谬了。我们想要的是生成多个值的生成器。因此，让我们尝试两个值，并朝着更好的解决方案努力。

生成两个值的测试

## 密码

新编写的测试简单地调用了两次 next 函数。它期望第二个值是`2`。为了让这些测试工作，代码现在应该产生第一个值`1`和第二个值`2`。这应该很容易实现，对吗？

让我们编写第二个`yield`语句。这也相当简单。您不必编写更多的代码来实现这一点。

两个值的生成器

## 重构

我们已经编写了最少量的所需产品代码；然而，我们可以改进我们的测试。

在这一点上，稍微重构一下测试并没有什么坏处——我们只需要保持这种我们都喜欢的绿色状态。生成器的创建是重复的代码。由于我们将很快为生成器编写更多的测试，生成器的实例化可以移到`setUp`方法中。毕竟，没有发电机，我们无法测试任何东西。

用“setUp”方法重构

## 试验

停在两个值将是愚蠢的。我们的代码需要生成无限数量的数字。所以我们可以编写一个测试来生成 *n* 个值。现在，我们看到一种模式正在形成。因此，让我们编写一个适用于更多值的测试—假设有 *n* 个值(例如， *n = 7* )。

添加生成 n 个值的测试(例如，n = 7)

## 密码

在这一点上，我们最好编写一些更通用的东西，因为没有人能够为所有可能的数字编写一个测试。

所以我们妥协了。实现将是一个简单的迭代器。它适用于任何值`n`。我们从`1`开始，循环将产生值——一次无限增加`1`。同样，编写足够可读的代码来完成这项工作。

生成 n 个(或更多)值的实现

当我们再次运行所有测试时，我们看到，当然，它们都是绿色的！很顺利，不是吗？

当然，我们可以进一步改进测试。可以假设该实现对于任何`n`都是有效的。如果您担心值`n`等于`1000`时它不起作用，可以简单地用一个快速测试来验证它。然而，既然走那么远没有价值，我们就此打住。一个好的开发者有时候终究是懒的。

# 结论

恭喜你。您现在能够以测试驱动的方式编写任何生成器了！所以现在就自己试试吧。跳上驾驶座，让我看看你能做什么。如果你评论这个故事，我会给你反馈。你可以从简单的练习开始——比如生成[斐波那契](https://en.wikipedia.org/wiki/Fibonacci_number)数。

你甚至不必就此打住。你为什么不创建一个从互联网上生成猫图像的生成器呢？只需要一个测试驱动的步骤，你就可以实现了。别忘了:熟能生巧！