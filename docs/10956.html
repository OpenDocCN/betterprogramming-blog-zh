<html>
<head>
<title>Map, CompactMap, and FlatMap in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的地图、紧凑地图和平面地图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/map-compactmap-and-flatmap-in-swift-4ea4f1a39cbd?source=collection_archive---------7-----------------------#2022-02-07">https://betterprogramming.pub/map-compactmap-and-flatmap-in-swift-4ea4f1a39cbd?source=collection_archive---------7-----------------------#2022-02-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7a9b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何以及何时使用它们</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cc5354b3695ed139dad64e9a40ae785c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_44o5AqQe7L1ECQIzHm5w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://undraw.co/search" rel="noopener ugc nofollow" target="_blank"> Undraw </a></p></figure><p id="d8bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在普通的应用程序中，使用数组是很常见的。通常，我们需要一个接一个地获取所有元素，并对它们进行一些转换。</p><p id="ecfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种情况经常发生，我看到许多初级或中级开发人员使用类似于<code class="fe lv lw lx ly b">forEach</code>的经典迭代来执行这项任务，他们不知道在<code class="fe lv lw lx ly b">Foundation</code>框架中有更好的函数来解决这个问题。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="5df3" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">地图</h1><p id="aa40" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">map是一个标准的Swift函数，用在一个集合上，它接受一个应用于每个元素的闭包的输入，并返回一个不同的集合。换句话说，你有一个起始数组，你一个接一个地获取数组的所有元素，对每个元素应用一个由闭包控制的变换，并将结果值附加到一个新数组上。</p><p id="8f34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，举个例子吧。假设我们想创建一个游戏，给玩家一个漫威英雄名字的字谜，他/她必须猜出正确的角色。我们有一个名字列表，我们必须对列表中的每一项应用接下来的步骤:</p><ol class=""><li id="17cd" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">将名称转换成小写</li><li id="9564" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">删除空白</li><li id="4c5e" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">打乱字母顺序</li></ol><p id="f266" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果没有使用<code class="fe lv lw lx ly b">forEach</code>的<code class="fe lv lw lx ly b">map</code>，你当然需要为每一步创建一个空数组，对每个元素应用该步骤并附加结果……三个数组，太多东西，很难阅读和理解。让我们看看这种方法有多冗长:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="0427" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用<code class="fe lv lw lx ly b">map</code>代替，一切都变得非常容易和可读。就像魔术一样！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="7c6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，即使你不知道所有的步骤，这也是非常可读的。</p><h2 id="6c8d" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">紧凑地图</h2><p id="8b25" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated"><code class="fe lv lw lx ly b">CompactMap</code>工作类似于map，但是有一个额外的好处…它移除了变换给出的每个<code class="fe lv lw lx ly b">nil</code>元素。</p><p id="67ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一个简单的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="7bcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，表情图标无法创建有效的url。使用<code class="fe lv lw lx ly b">compactMap</code>你可以过滤它，没有任何问题或其他检查。</p><p id="6041" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">CompactMap</code>也是过滤列表以删除任何<code class="fe lv lw lx ly b">nil</code>值的好方法。最近我在开发一个应用程序，其中一个视图控制器的所有UI标签都由服务器发送的数据控制。如果有一个值，你必须显示标签，如果没有，标签将被隐藏，不留空白。</p><p id="291d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个<code class="fe lv lw lx ly b">UITableView</code>中一切都是动态的，所以我只需要在data source中添加或不添加一个项目(如果你对我个人处理数据源和部分的技术感兴趣<strong class="lb iu"> </strong> <a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/uitableview-sections-with-nested-types-27eabb833ad9">看看这篇文章</a>)。</p><p id="18f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，用<code class="fe lv lw lx ly b">compactMap</code>过滤所有东西非常快，非常易读。类似这样的东西，当然在应用程序中要复杂一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="8d63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意最新例子中的一件事。字段数组的类型是<code class="fe lv lw lx ly b">[String?]</code>，而条目数组的类型是<code class="fe lv lw lx ly b">[String]</code>，所以<code class="fe lv lw lx ly b">compactMap</code>的返回类型永远不是<code class="fe lv lw lx ly b">optional</code>。哇，太神奇了！</p><h1 id="3149" class="mg mh it bd mi mj of ml mm mn og mp mq jz oh ka ms kc oi kd mu kf oj kg mw mx bi translated">平面地图</h1><p id="2f52" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">最后一种类型的映射是一个函数，顾名思义，它将数组中的数组展平。它只是将一系列数组一次转换成一个数组，如下所示:</p><pre class="kj kk kl km gt ok ly ol om aw on bi"><span id="01c6" class="nt mh it ly b gy oo op l oq or">[[1, 1, 1], [2, 2, 2], [3, 3, 3]] -&gt; [1, 1, 1, 2, 2, 2, 3, 3, 3]</span></pre><p id="9950" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">举个例子吧。</p><p id="3be7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你正在编写一个有战斗英雄小队的游戏。你的队伍有一群角色，你决定每场比赛中谁战斗。</p><p id="2d0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在每一轮中，被击败的敌人数量会被添加到玩家英雄的属性中。你现在需要计算你的队伍每轮被击败的敌人的平均数量，所以基本上你需要创建一个所有英雄的所有数据的数组，并找出平均值。</p><p id="a2bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="9d13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的魔法都在第25行完成了。请注意，为了保持良好的函数式编程风格，我使用了一个扩展来计算平均值(第26行)，而不是使用<code class="fe lv lw lx ly b">Accelerate</code>框架的<code class="fe lv lw lx ly b">vDSP.mean</code>函数(<a class="ae ky" href="https://developer.apple.com/documentation/accelerate/vdsp/3241022-mean" rel="noopener ugc nofollow" target="_blank">链接，此处为</a>)。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="6886" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">还有一点</h1><p id="caf9" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果你仔细阅读了文章的开头，你可能已经注意到我写的是集合而不是简单的数组。你知道为什么吗？因为地图功能也可以应用于字典！无论如何使用字典的这些功能，都需要格外小心:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="0399" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在示例中看到的，原始字典被拆分成一个字典数组。现在，您可能希望仅对字典的值而不是键应用转换。</p><p id="24c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你知道吗？Swift有一系列针对所有前三种变体的地图来完成这项任务！只需使用<code class="fe lv lw lx ly b">mapValues</code>版本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="45cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，结果是一个<code class="fe lv lw lx ly b">[String: String]</code>，而不是像前一个例子中的<code class="fe lv lw lx ly b">[[String: String]]</code>。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="93fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢这篇文章，如果你喜欢，请鼓掌。<br/>如果这篇文章对你有用，请随意<a class="ae ky" href="https://www.buymeacoffee.com/dy59tqxn794" rel="noopener ugc nofollow" target="_blank">给我一杯咖啡</a>，并允许我创作更酷的内容和文章。</p><p id="d267" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">享受你的编码！</p></div></div>    
</body>
</html>