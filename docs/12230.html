<html>
<head>
<title>How To Deploy a Rust Web Server to Heroku Using Axum, Docker, and GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Axum、Docker和GitHub操作将Rust Web服务器部署到Heroku</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-deploy-a-rust-web-server-to-heroku-using-axum-docker-and-github-actions-6cddb442ea7e?source=collection_archive---------9-----------------------#2022-05-20">https://betterprogramming.pub/how-to-deploy-a-rust-web-server-to-heroku-using-axum-docker-and-github-actions-6cddb442ea7e?source=collection_archive---------9-----------------------#2022-05-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1520" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">编写生产就绪代码的技巧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a55763006a0d84ba6f0c104267f0b638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQ6qWUeT3g88IpVrIZSjVQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c570" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你好。今天，我们将使用Axum作为我们的web框架。</p><p id="fe43" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，首先，我们需要添加Axum和Tokio作为对<code class="fe lu lv lw lx b">Cargo.toml</code>的依赖。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Cargo.toml</p></figure><p id="6e79" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe lu lv lw lx b">main.rs</code>上，我们将添加Axum官方文档中的hello world版本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">main.rs</p></figure><p id="b6f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个好的开始，但是我们需要使服务器监听的端口更加灵活，以便在Heroku上工作。我们需要使用环境变量<code class="fe lu lv lw lx b">PORT</code>，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">main.rs</p></figure><p id="a253" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好，现在我们检查<code class="fe lu lv lw lx b">PORT</code>是否存在。如果没有，我们默认使用<code class="fe lu lv lw lx b">3000</code>，这样我们仍然可以轻松地在<code class="fe lu lv lw lx b">localhost</code>上运行它。</p><p id="6930" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，让我们用下面的代码创建一个docker文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Dockerfile文件</p></figure><p id="8d25" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个Dockerfile文件有两个阶段来生成一个较小的图像。</p><p id="6484" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第一阶段，它安装所有依赖项并编译代码，在第二阶段，它将二进制文件复制到一个较小的基础映像。如果您将所有内容都保留在映像上，结果大约是70MB而不是2GB。较小的图像更酷。</p><p id="ddbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们正在到达那里。现在我们将使用Github操作，您可以在下面看到:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。github/workflows/main.yml</p></figure><p id="2791" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们需要两个秘密来实现它:</p><p id="d92d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于<code class="fe lu lv lw lx b">HEROKU_API_KEY</code>，我们需要一个长期令牌，您可以使用以下命令生成它:</p><pre class="kj kk kl km gt ma lx mb mc aw md bi"><span id="1513" class="me mf it lx b gy mg mh l mi mj">heroku authorizations:create</span></pre><p id="cf2a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它将生成一个令牌，您需要它来执行Github操作:</p><p id="4e38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="mk">您的回购&gt;设置&gt;机密&gt;操作&gt;新建仓库机密</em></p><p id="7698" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一个变量将是你在Heroku上的应用程序的名称。您可以从Heroku UI或使用命令行界面通过以下小命令获取它:</p><pre class="kj kk kl km gt ma lx mb mc aw md bi"><span id="3d91" class="me mf it lx b gy mg mh l mi mj">heroku apps</span></pre><p id="96de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您还没有Heroku应用程序，您可以通过以下方式生成:</p><pre class="kj kk kl km gt ma lx mb mc aw md bi"><span id="ef66" class="me mf it lx b gy mg mh l mi mj">heroku apps:create</span></pre><p id="1503" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">找到名字后，继续用添加<code class="fe lu lv lw lx b">HEROKU_API_TOKEN</code>的方法创建<code class="fe lu lv lw lx b">HEROKU_APP</code>。</p><p id="9f3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好的，我们都准备好了。现在，你需要把你的代码推给Heroku。之后，它会触发一个新的GitHub动作工作流程。</p><p id="bb02" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它将构建Docker映像，将其推送到Heroku容器注册中心，并发布到生产环境。耶！</p><p id="13de" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你更喜欢视频而不是文章，<a class="ae ml" href="https://www.youtube.com/watch?v=ZF1WQGur_NA" rel="noopener ugc nofollow" target="_blank">你可以在我的Rust频道，Holy Crab这里观看。</a></p></div></div>    
</body>
</html>