<html>
<head>
<title>Error Handling With GraphQL, Spring Boot, and Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用GraphQL、Spring Boot和科特林处理错误</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/error-handling-with-graphql-spring-boot-and-kotlin-ed55f9da4221?source=collection_archive---------5-----------------------#2020-05-14">https://betterprogramming.pub/error-handling-with-graphql-spring-boot-and-kotlin-ed55f9da4221?source=collection_archive---------5-----------------------#2020-05-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d196" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Spring Boot和Kotlin对GraphQL错误和异常建模</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4e447dd88b9e5f788a0bc0b31e412be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZbLBeX0E_vbeEW3Dw37-MQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Georgie Cobbs 在<a class="ae ky" href="https://unsplash.com/s/photos/work?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="0727" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">问题</h1><p id="d5a4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">GraphQL中的错误处理可能相当棘手，因为响应总是有HTTP状态<code class="fe mn mo mp mq b">200 OK</code>。如果请求失败，JSON有效负载响应将包含一个名为<code class="fe mn mo mp mq b">errors</code>的根字段，其中包含失败的详细信息。</p><p id="c46c" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">对于类似下面的查询…</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="db30" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">…如果没有适当的错误处理，响应将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="fee3" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">这一点帮助都没有——回复并没有告诉你到底哪里出了问题。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="86e2" class="kz la it bd lb lc nf le lf lg ng li lj jz nh ka ll kc ni kd ln kf nj kg lp lq bi translated">解决办法</h1><h2 id="cfa7" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">1.设置</h2><p id="022c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们用GraphQL建立一个Spring Boot项目。此外，代码可以在<a class="ae ky" href="https://github.com/maniish-jaiin/graphql-error-handling" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="ea47" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">转到<a class="ae ky" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank">https://start.spring.io/</a>。</p><p id="fd94" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">选择一个<code class="fe mn mo mp mq b">Gradle</code>项目，设置语言为<code class="fe mn mo mp mq b">Kotlin</code>。</p><p id="77a1" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">对于最低限度的实现，您不必选择任何依赖项。</p><p id="cf7a" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">下载ZIP文件，并在您喜欢的IDE中打开它。</p><p id="5bfd" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">跳转到<code class="fe mn mo mp mq b">build.gradle.kts</code>，并添加:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9287" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">这些是您开始使用第一个端点所需的GraphQL库。</p><h2 id="f678" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">2.没有错误处理的端点</h2><p id="1efc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们创建两个端点来创建和获取资源。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="15c9" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">添加<code class="fe mn mo mp mq b">Service</code>提供<code class="fe mn mo mp mq b">car</code>的创建和取数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="23cc" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我们已经创建了一个<code class="fe mn mo mp mq b">function</code>来创建一个<code class="fe mn mo mp mq b">car</code>和另一个以<code class="fe mn mo mp mq b">name</code>作为输入来取回<code class="fe mn mo mp mq b">car</code>。但是如果没有找到汽车，这将抛出一个异常，并转化为如下所示的响应:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="6543" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">3.实现错误处理</h2><p id="1617" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了能够在错误或异常的情况下提供一些合理的东西，我们将添加更多的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="8046" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">让我们明白这是怎么回事。</p><ol class=""><li id="0503" class="nw nx it lt b lu mr lx ms ma ny me nz mi oa mm ob oc od oe bi translated">有一个消息字段，不言自明。</li><li id="2b9d" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">被覆盖的函数<code class="fe mn mo mp mq b">getExtensions()</code>用于提供参数映射。这可能是不同的属性，如您希望传递的错误的<code class="fe mn mo mp mq b">ErrorCodes</code>。</li><li id="94b0" class="nw nx it lt b lu of lx og ma oh me oi mi oj mm ob oc od oe bi translated">被覆盖的函数<code class="fe mn mo mp mq b">getErrorTypes()</code>用于提供错误的分类，例如<code class="fe mn mo mp mq b">DataFetchingException</code>或<code class="fe mn mo mp mq b">ValidationException</code>。</li></ol><p id="29a3" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">在上面的<code class="fe mn mo mp mq b">exception</code>中，你可以看到它是从<code class="fe mn mo mp mq b">GraphQLException</code>延伸出来的，是我们的习俗<code class="fe mn mo mp mq b">CarNotFoundException</code>和<code class="fe mn mo mp mq b">GraphQLError</code>之间的桥梁。</p><p id="f4f6" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">现在我们要加上<code class="fe mn mo mp mq b">GraphQLException</code>。</p><p id="bfe4" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">当我们添加它时，我们需要确保创建一个单独的Java模块，并在Java模块中添加那个<code class="fe mn mo mp mq b">GraphQLException</code>。</p><p id="5799" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">为什么？</p><p id="6c17" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">因为一个Kotlin类不能同时扩展<code class="fe mn mo mp mq b">RuntimeException</code>和实现<code class="fe mn mo mp mq b">GraphQLError</code>。原因可以在<a class="ae ky" href="https://github.com/graphql-java/graphql-java/issues/1022" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="f3d4" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">所以现在我们创建一个<code class="fe mn mo mp mq b">GraphQLException</code>类。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6211" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">从<code class="fe mn mo mp mq b">CarService</code>开始，当没有找到<code class="fe mn mo mp mq b">car</code>时，我们抛出异常。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="4896" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">有了这一改变，响应将包含比以前更多的细节。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="9863" class="kz la it bd lb lc nf le lf lg ng li lj jz nh ka ll kc ni kd ln kf nj kg lp lq bi translated">结论</h1><p id="59cd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">你可以在这里找到完整的实现。</p><p id="e9a8" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我很高兴你坚持到了最后。说明你对GraphQL感兴趣。下面是另一篇<a class="ae ky" href="https://levelup.gitconnected.com/6-months-of-using-graphql-faa0fb68b4af" rel="noopener ugc nofollow" target="_blank">文章</a>，分享我使用GraphQL六个月的经验。</p></div></div>    
</body>
</html>