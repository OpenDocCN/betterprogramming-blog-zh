<html>
<head>
<title>Lazy Load YouTube Videos Using <iFrame/></title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用<iFrame/>载入YouTube视频</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/lazy-load-youtube-video-iframe-8838e1913751?source=collection_archive---------9-----------------------#2020-01-09">https://betterprogramming.pub/lazy-load-youtube-video-iframe-8838e1913751?source=collection_archive---------9-----------------------#2020-01-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="72ea" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用交叉点观察器API延迟加载YouTube视频</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e556cb35e2a31a992a45675f8d0a31e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IwlNLyd4Db7716sLSeGq_w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">茱莉亚·乔皮恩在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="e2c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" rel="noopener ugc nofollow" target="_blank">交叉点观察器API </a>通常用于延迟加载图像，但是您知道它可以用于延迟任何类型的元素吗？</p><p id="57b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本周，我为DeckDeckGo开发了一个新的登陆页面，这是我们的web开源演示编辑器，我将在其中展示视频。</p><p id="e411" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么，出于性能原因，我不得不推迟他们的加载，也是为什么，我分享这个新的博客帖子。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="96c2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">配乐</h1><p id="33b0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我们将从我的家乡朋友<a class="ae ky" href="https://maxipuchrodeoclub.bandcamp.com" rel="noopener ugc nofollow" target="_blank">马克西布切竞技俱乐部</a>下载一段音乐视频剪辑。我只能强烈建议你在阅读这篇博文的时候播放下面的视频来听一些很棒的音乐。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Maxi Push Rodeo俱乐部——在会议期间的娱乐活动</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="05a9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><p id="69cb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我用<a class="ae ky" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>实现了这个实验，但是这个概念可以在有或者没有任何框架的情况下使用。</p><p id="e3e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们真正推迟加载视频之前，让我们将它添加到一个组件中(我使用YouTube提供的share动作收集了<code class="fe nb nc nd ne b">iframe</code>嵌入代码)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf na l"/></div></figure><p id="1126" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以打开我们的浏览器，并检查它是否在我们的页面加载的同时被有效地加载。您会注意到，即使没有显示视频，YouTube URL也会加载。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/94c00c23a35a209472ef54323eaf22af.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*MrPtsQS5FB6aF0L-eXncfQ.gif"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cb74" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">混淆视频</h1><p id="9a49" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们创建一个新的状态来显示或不显示我们的视频。默认情况下，由于我们不想在页面加载时加载它，我们将其设置为<code class="fe nb nc nd ne b">false</code>。</p><pre class="kj kk kl km gt nh ne ni nj aw nk bi"><span id="89de" class="nl md it ne b gy nm nn l no np">const [showVideo, setShowVideo] = useState(false);</span></pre><p id="d6cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了推迟视频的加载，我们将使用交叉点观察器API。它将检测元素是否(或将会)在视口中可见(如果我们没有指定另一个要观察的根)。</p><p id="ce7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦检测到这种可见性，它将触发一个事件，让我们执行一个任务，分别让我们有效地加载视频。</p><p id="9892" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么我们也将我们的元素包装在一个容器中，因为我们确实需要一个元素在页面生命周期中进行观察，而不管我们的视频状态如何。</p><p id="48ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们还创建了对它的引用，以便稍后实例化我们的观察者。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf na l"/></div></figure><p id="d62a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以像以前一样在浏览器中测试我们的应用程序，应该会注意到视频现在既没有加载也没有显示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/b4caf592041a8f098c0d8a3712651072.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*1EPwmYUiUcKyGdsochnN2w.gif"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9496" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">惰性装载</h1><p id="622b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后，我们可以创建我们的观察者。</p><p id="8688" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nb nc nd ne b">rootMargin</code>用于在元素周围添加一个边界框来计算交集，而<code class="fe nb nc nd ne b">threshold</code>指示观察者的回调应该在目标可见性的多少百分比处执行。</p><pre class="kj kk kl km gt nh ne ni nj aw nk bi"><span id="07ad" class="nl md it ne b gy nm nn l no np">const videoObserver = new IntersectionObserver(onVideoIntersection, {<br/>    rootMargin: '100px 0px',<br/>    threshold: 0.25<br/>});</span></pre><p id="52b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了指示它观察我们的容器，我们添加了一个<code class="fe nb nc nd ne b">useEffect</code>钩子，它将根据容器来执行。</p><p id="6412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们还测试浏览器是否支持API(目前所有现代平台都支持API)并在“即时”加载时后退，如果不是这样(“你好，黑暗，我的老朋友”)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf na l"/></div></figure><p id="e07c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们声明了一个当容器到达视口时将被触发的函数。我们用它来修改我们的状态，显示视频，以及<code class="fe nb nc nd ne b">disconnect</code>我们的观察者，因为我们不再需要它了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf na l"/></div></figure><p id="ddf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧，就是这样！我们可以再次执行我们的测试，并注意到只有在需要和容器出现时才加载视频。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/defced0a3ff66740576077ffb35c2e5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*nXaa2aaSs1jTOPN7XEm0xA.gif"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7cfc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更进一步</h1><p id="e8b8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">惰性加载很棒，但是你可能也想给你的视频添加一个自定义控件<code class="fe nb nc nd ne b">play</code>和<code class="fe nb nc nd ne b">pause</code>。</p><p id="3497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们可以自己编写代码，使用iframe嵌入的<a class="ae ky" href="https://developers.google.com/youtube/iframe_api_reference" rel="noopener ugc nofollow" target="_blank"> YouTube播放器API参考</a>，或者使用许多现有的库之一，但是，DeckDeckGo是开源的，我们确实将我们的平台分成了多个独立的组件，因此，你猜怎么着？</p><p id="efa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们确实共享一个<a class="ae ky" href="https://docs.deckdeckgo.com/components/youtube" rel="noopener ugc nofollow" target="_blank"> web组件</a>来轻松地将YouTube视频嵌入到您的应用程序中。</p><p id="4bb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们安装它。</p><pre class="kj kk kl km gt nh ne ni nj aw nk bi"><span id="a2bc" class="nl md it ne b gy nm nn l no np">npm install @deckdeckgo/youtube --save</span></pre><p id="7ca6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并将其加载到我们的应用程序中。</p><pre class="kj kk kl km gt nh ne ni nj aw nk bi"><span id="5727" class="nl md it ne b gy nm nn l no np">import { applyPolyfills, defineCustomElements }<br/>         from '@deckdeckgo/youtube/dist/loader';<br/><br/>applyPolyfills().then(() =&gt; {<br/>    defineCustomElements(window);<br/>});</span></pre><p id="a08f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们删除显示或不显示视频的状态，因为web组件不会加载任何东西，直到有进一步的通知。</p><p id="3d72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们用一个名为<code class="fe nb nc nd ne b">loadVideo</code>的新函数来代替它，在这个函数中，我们执行组件的方法<code class="fe nb nc nd ne b">lazyLoadContent</code>来处理所有的事情。</p><pre class="kj kk kl km gt nh ne ni nj aw nk bi"><span id="d6ab" class="nl md it ne b gy nm nn l no np">async function loadVideo() {<br/>    if (container &amp;&amp; container.current) {<br/>        container.current.lazyLoadContent();<br/>    }<br/>}</span></pre><p id="d43d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们添加两个按钮，用于调用<code class="fe nb nc nd ne b">play</code>和<code class="fe nb nc nd ne b">pause</code>，并用组件<code class="fe nb nc nd ne b">&lt;deckgo-youtube/&gt;</code>替换我们的<code class="fe nb nc nd ne b">iframe</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf na l"/></div></figure><p id="3176" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们继续进行最后的测试，注意到视频加载缓慢，我们玩着按钮，享受着<a class="ae ky" href="https://maxipuchrodeoclub.bandcamp.com/" rel="noopener ugc nofollow" target="_blank">马克西布切竞技俱乐部</a>的美妙音乐。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/990b05cfd3d10325439820bd25f4ab70.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*skQICbYpu0Q-x2C6u3TgkA.gif"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="80d3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为我们的项目做贡献</h1><p id="04d9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">即使它完成了工作，我们的组件还可以改进。我特别认为显示视频的平滑过渡会很有用。</p><p id="cb2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么我在<a class="ae ky" href="https://github.com/deckgo/deckdeckgo/issues/570" rel="noopener ugc nofollow" target="_blank"> GitHub </a>的回购中开了一个很好的第一期。如果你愿意帮忙，你的帮助将会受到感激。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="152f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">蛋糕上的樱桃</h1><p id="e3d4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们的组件<code class="fe nb nc nd ne b">@deckdeckgo/youtube</code>是用<a class="ae ky" href="https://stenciljs.com" rel="noopener ugc nofollow" target="_blank">模板</a>开发的web组件，因此，它可以用在任何现代web应用程序中，不管有没有任何框架。</p><p id="ec48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，如果你像我一样，有一点“捆绑恐惧症”，它将添加到你的应用程序，一旦缩小和压缩，只有<a class="ae ky" href="https://bundlephobia.com/result?p=@deckdeckgo/youtube@1.0.0-rc.1-2" rel="noopener ugc nofollow" target="_blank"> 198字节</a>。</p><p id="0f9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到无限和更远的地方，</p><p id="0e5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大卫</p></div></div>    
</body>
</html>