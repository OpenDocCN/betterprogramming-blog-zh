<html>
<head>
<title>Migrating from SwiftUI 2.0 to SwiftUI 3.0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从SwiftUI 2.0迁移到SwiftUI 3.0</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/migrating-from-swiftui-2-0-to-swiftui-3-0-d9eec418a251?source=collection_archive---------8-----------------------#2021-06-29">https://betterprogramming.pub/migrating-from-swiftui-2-0-to-swiftui-3-0-d9eec418a251?source=collection_archive---------8-----------------------#2021-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4208" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用新的iOS 15 SwiftUI功能为我们的应用做好准备</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f272aa82b617225e47d7da98a848bf33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*odwudlbKic-dG96716txtg.png"/></div></div></figure><p id="d9fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">WWDC 2021几周前结束了。它再次在网上举行，充满了功能丰富的内容。SwiftUI上的每个会话都传达了团队带给我们惊喜的要点，我们喜欢所宣布的改进和丰富功能。今年，苹果专注于支持更深入地采用我们的应用程序框架。</p><p id="858c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将从我们在<a class="ae lq" href="https://getstream.io/blog/music-chat-ios-swiftui/" rel="noopener ugc nofollow" target="_blank">创建的同一个项目开始，使用SwiftUI </a>构建一个音乐聊天iOS应用程序，同时开发SwiftUI Release 3的新功能。然后，我们将了解SwiftUI团队如何通过将自定义代码集成到框架本身来帮助我们删除自定义代码。</p><blockquote class="lr ls lt"><p id="5f2d" class="ku kv lu kw b kx ky ju kz la lb jx lc lv le lf lg lw li lj lk lx lm ln lo lp im bi translated"><em class="it">注意——你需要一个</em> <strong class="kw iu"> <em class="it">付费</em> </strong> <em class="it">开发者账号，并且在你的设备上安装了Apple Music才能跟随这篇文章。还有，本文要求</em><strong class="kw iu"><em class="it">Xcode 13.0+</em></strong><em class="it">和</em><strong class="kw iu"><em class="it">iOS 15.0+</em></strong></p></blockquote><h1 id="7b7c" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">TonesChat</h1><p id="3a44" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在“使用SwiftUI构建一个音乐聊天iOS应用程序”中，我们创建了一个音乐聊天应用程序，您可以在分享和聊天的同时聆听您最喜爱的音乐。示例应用程序广泛使用了SwiftUI Release 2，为框架缺少的东西提供了自定义视图，比如搜索栏。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/4fa1ab571ae0857b836dd75541dfa500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yxASJbnhFB-XUDEZ.png"/></div></div></figure><p id="01ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将从同一个项目开始，添加今年引入的新功能和改进。请下载<a class="ae lq" href="https://github.com/rudrankriyam/TonesChat" rel="noopener ugc nofollow" target="_blank">启动项目</a>并浏览<code class="fe mw mx my mz b">Initial</code>文件夹下的内容。它由助手视图、一些扩展和API数据模型组成。</p><p id="80ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lu">注意——你需要按照上一篇文章为Apple Music添加一个开发者令牌，为Stream添加一个API密钥。</em></p><p id="dbd3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Xcode中打开初始项目。首先，从项目导航器中选择项目，并将部署目标提升到iOS 15。这确保了我们可以在最新的iOS版本上开发新的令人兴奋的东西。</p><p id="e5eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行应用程序以确保其正常工作。现在，让我们开始看看这个框架给我们带来了什么惊喜吧！</p><h1 id="7ef6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">不对称图像</h1><p id="4ffb" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">顾名思义，<code class="fe mw mx my mz b">AsyncImage</code>是用来异步下载和显示图片的。之前，我们理想地使用了<a class="ae lq" href="https://github.com/SDWebImage/SDWebImageSwiftUI" rel="noopener ugc nofollow" target="_blank"> SDWebImageSwiftUI </a>，但是有了这个版本的SwiftUI，我们可以安全地移除对主要<strong class="kw iu"> </strong>用例的依赖。</p><p id="aedf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，从项目导航器→ Swift包中删除包。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/61f59fd63dd99a4b8bebd17dbb0af865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ojCAWRYCteP_yZAe.png"/></div></div></figure><p id="8eaf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另外，从<code class="fe mw mx my mz b">MusicCardView</code>上拆下<code class="fe mw mx my mz b">import SDWebImageSwiftUI</code>。我们将得到一个关于<code class="fe mw mx my mz b">WebImage</code>的错误。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/6b021b8a3a53847e10415466faa26838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*P8RAVchMQ-KCy3iR.png"/></div></div></figure><p id="3ab5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们用<code class="fe mw mx my mz b">AsyncImage</code>代替。提供了多个初始值设定项，这是最简单的一个:</p><p id="aede" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mw mx my mz b">init(url: <a class="ae lq" href="https://developer.apple.com/documentation/foundation/url?changes=l_5" rel="noopener ugc nofollow" target="_blank">URL</a>?, scale: <a class="ae lq" href="https://developer.apple.com/documentation/coregraphics/cgfloat?changes=l_5" rel="noopener ugc nofollow" target="_blank">CGFloat</a> = 1) where Content == <a class="ae lq" href="https://developer.apple.com/documentation/swiftui/image?changes=l_5" rel="noopener ugc nofollow" target="_blank">Image</a></code></p><p id="1170" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">查看语法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="d608" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们为视图提供一个URL，它自动获取并显示带有默认占位符的远程图像。为了对异步图像加载操作的<em class="lu">阶段</em>有更多的控制，我们使用:</p><p id="b1e7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mw mx my mz b">init(url: <a class="ae lq" href="https://developer.apple.com/documentation/foundation/url?changes=l_5" rel="noopener ugc nofollow" target="_blank">URL</a>?, scale: <a class="ae lq" href="https://developer.apple.com/documentation/coregraphics/cgfloat?changes=l_5" rel="noopener ugc nofollow" target="_blank">CGFloat</a> = 1, transaction: <a class="ae lq" href="https://developer.apple.com/documentation/swiftui/transaction?changes=l_5" rel="noopener ugc nofollow" target="_blank">Transaction</a> = Transaction(), content: @escaping (<a class="ae lq" href="https://developer.apple.com/documentation/swiftui/asyncimagephase?changes=l_5" rel="noopener ugc nofollow" target="_blank">AsyncImagePhase</a>) -&gt; Content)</code></p><p id="9e16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这有助于我们添加一个事务来传递动画，并为加载、成功和失败定义自定义视图。</p><p id="e110" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于在我们的应用程序中异步加载的作品，我们将使用一个方便的包装器来包装<code class="fe mw mx my mz b">AsyncImage</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7ccd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">穿过<code class="fe mw mx my mz b">ArtworkImage</code>:</p><ul class=""><li id="7c80" class="nc nd it kw b kx ky la lb ld ne lh nf ll ng lp nh ni nj nk bi translated">我们从将URL作为参数的<code class="fe mw mx my mz b">AsyncImage</code>开始。以及在阶段之间切换时传递动画的事务。</li><li id="9b27" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">在空阶段的情况下，我们显示一个<code class="fe mw mx my mz b"> ProgressView()</code>。</li><li id="08c5" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">在成功的图像的情况下，我们传回图像。</li><li id="33c1" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">如果出现错误，我们用红色背景显示错误描述。</li><li id="bdf9" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">我们为<code class="fe mw mx my mz b">AsyncImagePhase</code>的一个额外的未知值添加了一个<code class="fe mw mx my mz b">@unknown default</code>案例，这个未知值可能会在未来的版本中添加。</li></ul><p id="d41e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在一个新的SwiftUI文件中添加上述代码后，转到<code class="fe mw mx my mz b">MusicCardView</code>。移除<code class="fe mw mx my mz b">WebImage(url: url)</code>和与之相关的修改器。替换为以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="8b5a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lu">注意:从beta 2开始，列表中的AsyncImage有时会过早取消图像下载。</em></p><p id="0834" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行应用程序，看看图像异步加载，一个时髦的动画！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/c5f658b608dfbc3e5e98bbddf22d0be6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9r8Wq4xDw4Ha6LH3.png"/></div></div></figure><h1 id="5d37" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">可刷新的</h1><p id="1f95" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在主屏幕上，我们正在显示美国的热门歌曲。假设奥利维亚又推出了一张热门专辑，排行榜上全是她的歌曲。为此，我们需要添加根据更新数据的请求加载内容的功能。</p><p id="2781" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SwiftUI 3.0增加了一个新功能(过去几年没有的)，支持iOS和iPadOS上的拉至刷新。它可以很容易地与refreshable修饰符一起使用，该修饰符配置一个刷新动作并通过环境传递它。从文档中:</p><p id="0e5c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lu">使用此操作启动修改视图显示的模型数据的更新。在动作中使用一个</em> <code class="fe mw mx my mz b"><em class="lu">await</em></code> <em class="lu">表达式。SwiftUI显示一个刷新指示器，在等待操作期间保持可见。</em></p><p id="a35f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mw mx my mz b">func refreshable(action: @escaping () async -&gt; Void) -&gt; some View</code></p><p id="87a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">转到<code class="fe mw mx my mz b">HomeView</code>，在<code class="fe mw mx my mz b">onAppear</code>下，添加可刷新修改器:</p><pre class="kj kk kl km gt nr mz ns nt aw nu bi"><span id="1826" class="nv lz it mz b gy nw nx l ny nz">.refreshable {</span><span id="de2d" class="nv lz it mz b gy oa nx l ny nz">  viewModel.updateTopSongs()</span><span id="ec32" class="nv lz it mz b gy oa nx l ny nz">}</span></pre><p id="b340" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">截至Xcode 13.0 beta 1，只有<code class="fe mw mx my mz b">List</code>使用这个动作。所以，打开<code class="fe mw mx my mz b">MusicGridView</code>，改名为<code class="fe mw mx my mz b">MusicListView</code>。另外，替换这个:</p><pre class="kj kk kl km gt nr mz ns nt aw nu bi"><span id="eea1" class="nv lz it mz b gy nw nx l ny nz">ScrollView(.vertical, showsIndicators: false) {</span><span id="d2a9" class="nv lz it mz b gy oa nx l ny nz">  // LazyVGrid</span><span id="7167" class="nv lz it mz b gy oa nx l ny nz">}</span></pre><p id="232e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了这个:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="209e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以前，如果不做一些修改，隐藏行分隔符是不可能的。现在，我们有一个专用的修改器。</p><p id="30d9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SwiftUI还有一个新的修饰符任务，它将一个任务附加到视图的生存期中。它在视图出现时执行特定的任务，在视图消失时取消。</p><p id="1695" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将<code class="fe mw mx my mz b">onAppear</code>替换为<code class="fe mw mx my mz b">HomeView</code>中的任务:</p><pre class="kj kk kl km gt nr mz ns nt aw nu bi"><span id="5e8f" class="nv lz it mz b gy nw nx l ny nz">.task {</span><span id="566c" class="nv lz it mz b gy oa nx l ny nz">  viewModel.updateTopSongs()</span><span id="aaca" class="nv lz it mz b gy oa nx l ny nz">}</span></pre><p id="b3e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，运行应用程序并刷新以加载新的排行榜歌曲！</p><h1 id="6cfc" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">材料视图</h1><p id="f0a1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">引用自<a class="ae lq" href="https://developer.apple.com/wwdc21/10018" rel="noopener ugc nofollow" target="_blank">swift ui WWDC 2021的新功能</a>:</p><blockquote class="lr ls lt"><p id="9183" class="ku kv lu kw b kx ky ju kz la lb jx lc lv le lf lg lw li lj lk lx lm ln lo lp im bi translated">Apple的所有平台和应用程序都使用材料来创建真正强调其内容的美丽视觉效果，现在您可以直接在SwiftUI中创建它们！</p></blockquote><p id="cad4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之前，我们在<code class="fe mw mx my mz b">UIViewRepresentable</code>中使用了<code class="fe mw mx my mz b">UIVisualEffectView</code>来创建一个模糊效果。现在，我们可以直接在背景修改器中使用它们！</p><p id="972e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将更新单独的卡片，将数据显示成一行，并为材质效果使用艺术作品的模糊背景。类似的东西也用在Apple Music上。</p><p id="5d57" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将<code class="fe mw mx my mz b">MusicCardView</code>替换为以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b688" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它使用与前一版本相似的代码，但是现在我们将内容放在一个<code class="fe mw mx my mz b">HStack</code>中，而不是一个<code class="fe mw mx my mz b">VStack</code>和一个更小的图像中。</p><p id="9d9b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建一个名为<strong class="kw iu"> </strong> MusicRowView.swift的新SwiftUI文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="be5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个视图是这样做的:</p><ul class=""><li id="811c" class="nc nd it kw b kx ky la lb ld ne lh nf ll ng lp nh ni nj nk bi translated">创建另一个填充整行的<code class="fe mw mx my mz b">ArtworkImage</code>。我们正在添加一个覆盖层来使图像变暗。</li><li id="9919" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">添加薄材质的背景。这在背景上创建了一个微妙的模糊效果。这些材料会自动与它们上面的内容混合。</li></ul><p id="6259" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将为每一行生成一个漂亮的模糊背景。试试吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/5e0dbaf759fa6b3994c135d9727e5b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gpud6jn1FKAa6IjU.png"/></div></div></figure><h1 id="2a8a" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">搜索</h1><p id="e9e1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">当前使用搜索的方式是创建一个自定义视图，其中有一个<code class="fe mw mx my mz b">TextField</code>，带有一个取消按钮。您可以在SearchBar.swift中找到它的实现。</p><p id="4f37" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于<code class="fe mw mx my mz b">TonesChat</code>的核心功能是从我们世界各地的朋友那里找到精彩的歌曲并进行搜索，因此将搜索功能内置到框架中至关重要。今年，一个新的可搜索修饰符使得在我们的应用中添加搜索变得更加容易。</p><p id="09b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SwiftUI会自动在我们应用程序的适当位置添加一个搜索字段。您可以从<code class="fe mw mx my mz b">SearchView</code>中移除<code class="fe mw mx my mz b">SearchBar</code>，并将可搜索修饰符添加到<code class="fe mw mx my mz b">NavigationView</code>。新的实现如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b82c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是细目分类:</p><ul class=""><li id="1821" class="nc nd it kw b kx ky la lb ld ne lh nf ll ng lp nh ni nj nk bi translated">我们添加了绑定了<code class="fe mw mx my mz b">searchText</code>的可搜索修饰符。它会自动在视图顶部添加一个搜索栏。</li><li id="ca33" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">在提交查询时，我们获取文本并相应地更新歌曲列表。</li><li id="f4d1" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">每当用户点击取消按钮时，我们清空歌曲列表以获得默认视图。</li></ul><p id="0a55" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">只需几行代码，我们就能实现完整的搜索功能——这是一个显著的改进！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/f587c54c79b2b0e6a54dd237a7dc0499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lX15OVcTLbn4Czyh.png"/></div></div></figure><p id="c54e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以添加搜索建议，让搜索下一首我们要狂听的歌曲变得更加简单。SwiftUI提供了另一个修饰符:</p><pre class="kj kk kl km gt nr mz ns nt aw nu bi"><span id="a2f1" class="nv lz it mz b gy nw nx l ny nz">func searchable&lt;S&gt;(text: Binding&lt;String&gt;, placement: SearchFieldPlacement = .automatic, suggestions: () -&gt; S) -&gt; some View where S : View</span></pre><p id="e180" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它们为我们提供了可选的参数建议，我们可以在其中列出数据。根据输入的每个字符，我们点击Apple Music的提示API来获得优化的结果。点击任何建议都会在苹果音乐目录中搜索到那个特定的提示。</p><p id="22e7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用以下代码替换<code class="fe mw mx my mz b">SearchView</code>的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="44b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事情是这样的-</p><ul class=""><li id="6053" class="nc nd it kw b kx ky la lb ld ne lh nf ll ng lp nh ni nj nk bi translated">我们有一个<code class="fe mw mx my mz b">@State</code>来跟踪所选择的提示。这是为了确保我们不会为选中的提示找到更多的提示。</li><li id="b763" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">我们创建一个列表并循环搜索提示。当用户选择一个提示时，我们直接显示搜索结果。</li><li id="a610" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">当用户点击<strong class="kw iu">取消</strong>或<strong class="kw iu">明文</strong>按钮时，我们清空歌曲和<code class="fe mw mx my mz b">searchHints</code>数组。</li><li id="7ee9" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">对于每个输入的字符，我们获取提示来显示。</li></ul><p id="504f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过增加几行代码，我们有了一个全功能的搜索！使用提示寻找新音乐的时间到了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/e6576371c72ed14fb150e3bd87ae5f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9XbT4sFA7T6Ft0s-.png"/></div></div></figure><h1 id="464a" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">小跟班</h1><p id="abdc" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">这个版本与按钮有很大关系，特别是现在我们在iOS上有了标准的边框按钮。就像给元素添加一个<code class="fe mw mx my mz b">buttonStyle</code>修饰符一样简单。</p><p id="ff86" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">新的修饰符是:</p><ul class=""><li id="7a09" class="nc nd it kw b kx ky la lb ld ne lh nf ll ng lp nh ni nj nk bi translated"><code class="fe mw mx my mz b">buttonStyle</code>用于纽扣造型</li><li id="deab" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated"><code class="fe mw mx my mz b">tint</code>对于特定的颜色外观</li><li id="4a34" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated"><code class="fe mw mx my mz b">controlSize</code>用于定义一个按钮的标准尺寸</li><li id="70f0" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated"><code class="fe mw mx my mz b">controlProminence</code>让他们脱颖而出</li></ul><p id="cb79" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe mw mx my mz b">LoginView</code>中，用以下内容替换<strong class="kw iu">登录</strong>按钮:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7603" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">新的修饰键使按钮更加标准化:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/940b8a831a580157cd115de7d68726be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0uBIb6QhHhZZWEU7.png"/></div></div></figure><h1 id="d52d" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">更多变化</h1><p id="9299" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">有更多的变化无法在帖子中涵盖。推荐你看<a class="ae lq" href="https://developer.apple.com/videos/play/wwdc2021/10018/" rel="noopener ugc nofollow" target="_blank">swift ui</a>的新功能。</p><h2 id="b66a" class="nv lz it bd ma ob oc dn me od oe dp mi ld of og mk lh oh oi mm ll oj ok mo ol bi translated"><strong class="ak">自定义刷卡动作</strong></h2><p id="8561" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">SwiftUI今年允许我们定义自定义的滑动动作，像定义任何其他菜单一样定义它。语法类似于<code class="fe mw mx my mz b">contextMenu</code>，使用按钮定义动作。</p><p id="0546" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，我们想要标记我们喜欢的几首喜爱的歌曲。我们可以在<code class="fe mw mx my mz b">MusicGridView</code>中添加以下代码来定义一个自定义动作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/947ddd588ac22f9c58bf580036a0ea88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KAxO9_DmDd2hReKM.png"/></div></div></figure><p id="cf40" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里有几个更合你胃口的:</p><ul class=""><li id="cb37" class="nc nd it kw b kx ky la lb ld ne lh nf ll ng lp nh ni nj nk bi translated"><strong class="kw iu">渲染markdown: </strong>直接内嵌markdown格式的文本变得更加强大。</li><li id="9079" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated"><strong class="kw iu">新表单</strong>:一个新的修改器，防止使用<code class="fe mw mx my mz b">interactiveDismissDisabled(_:)</code>交互解散表单。此外，还有一个新的环境值消除，您可以使用它来消除屏幕。</li><li id="94b3" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated"><strong class="kw iu">徽章:</strong>您可以创建一个在列表行和标签栏中显示的徽章。例如，未读消息的数量。使用<code class="fe mw mx my mz b">badge(_:)</code>实现该功能。</li><li id="0d4e" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated"><strong class="kw iu">可访问性变化:</strong>许多新的可访问性变化使得在您的SwiftUI应用中支持可访问性变得毫不费力。你可以观看<a class="ae lq" href="https://developer.apple.com/wwdc21/10119" rel="noopener ugc nofollow" target="_blank">swift ui Accessibility:Beyond the basics</a>来提供一个非凡的可访问性体验。</li></ul><h1 id="4004" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">结论</h1><p id="0a62" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">有这么多的变化，在我们的应用程序中实现这些变化并为我们的用户提供流畅的体验将是令人兴奋的一年。</p><p id="f6c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SwiftUI从2019年到iOS 13已经走过了很长的路，但我们还有很长的路要走。例如，我们仍然需要UIKit支持来构建自定义屏幕和复杂的应用程序。</p><p id="4121" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是SwiftUI确实是未来！</p><p id="34d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我希望你喜欢这个教程。如果你觉得它有帮助，让我知道！</p></div></div>    
</body>
</html>