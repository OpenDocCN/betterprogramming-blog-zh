<html>
<head>
<title>How to Use GameplayKit in an Arcade iOS Game</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在街机iOS游戏中使用GameplayKit</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/make-it-structured-gameplaykit-6d7e79d5a44a?source=collection_archive---------18-----------------------#2022-04-12">https://betterprogramming.pub/make-it-structured-gameplaykit-6d7e79d5a44a?source=collection_archive---------18-----------------------#2022-04-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8ca8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用GameplayKit构建您的游戏</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b2f5c1ff99a5d59fcd93bc5586ecf700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BABvUoK6yy-JtjH3UmgI_Q.jpeg"/></div></div></figure><p id="8554" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">轮到我拿<code class="fe ln lo lp lq b">skScene</code>！哈哈！没有吗？好吧好吧…</p><p id="4291" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">嗨，我是Oreste，如果你在这里，这可能意味着你有了你的第一个有SpriteKit场景的游戏，如果没有，我真的建议你去看看这个教程的<a class="ae lr" href="https://medium.com/@scaps/how-to-make-your-arcade-ios-game-using-spritekit-and-gameplaykit-make-it-spritey-547a871b690f" rel="noopener">第一部分，作者</a><a class="ls lt ep" href="https://medium.com/u/4263bee5b0e3?source=post_page-----6d7e79d5a44a--------------------------------" rel="noopener" target="_blank"> Luigi Minniti </a>关于SpriteKit。</p><p id="6c6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是现在，<em class="lu">你能做些什么来更上一层楼呢？你知道如何处理一个完整的游戏，让它足够干净，以确保有效的可扩展性，而不必多次重写你已经在项目中提供的东西吗？</em></p><p id="1f1a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，</p><h1 id="6807" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">我们需要谈谈GameplayKit。</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/daa69d8140029597ad6f18bd912ca0ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*MEdi4cv71n70q_45FzTUBw.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">GameplayKit徽标</p></figure><p id="f58b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">GameplayKit是由Apple开发的一个框架，在iOS 9和macOS X.11中引入，它提供了许多类型的游戏中常见的基础架构。</p><p id="2a17" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它让你专注于游戏的玩法和游戏规则，最大限度地减少类似意大利面条的代码编写，它只需要一个基于Objective-C或Swift的界面。</p><blockquote class="ms"><p id="ed59" class="mt mu iq bd mv mw mx my mz na nb lm dk translated"><em class="nc">有了GameplayKit，一切都与结构有关。</em></p></blockquote><p id="c773" class="pw-post-body-paragraph kr ks iq kt b ku nd jr kw kx ne ju kz la nf lc ld le ng lg lh li nh lk ll lm ij bi translated">开发人员经常会遇到的一件事是，这种巨大的场景隐藏了一切，使他们的生活变得更加艰难，这是很容易预测的事情，尤其是使用SpriteKit。</p><p id="3808" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦你开始一个新项目，Xcode会给你一个明确的方向，一个继承自<code class="fe ln lo lp lq b">SKScene</code>的类已经解决了处理输入、帧更新、节点层次、所有物理管理等等…</p><p id="459e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是这些只是小积木，如果你迟早把它们放在一起…</p><blockquote class="ni nj nk"><p id="748d" class="kr ks lu kt b ku kv jr kw kx ky ju kz nl lb lc ld nm lf lg lh nn lj lk ll lm ij bi translated"><strong class="kt ir"><em class="iq"/>你会过得很不好<em class="iq"/></strong></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/f869cb15969d8d019c86d1ab75266cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*TG_zzPJ6jWxu-EBJRf2rQw.png"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">Sans下层</p></figure><p id="766b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以这种方式开始是可以的，但从长远来看，这不是你想要做的事情。</p><p id="bcc7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">老实说，我并不认为自己是专家，但我想向您展示一些我在研究GameplayKit以实现我最近的两个项目时学到的东西，特别是当意志力版本0.0.1(3)发布时，ECS和状态机，也使用了我在研究它时寻找的东西，你们都应该熟悉:Pac-Man！</p><h1 id="4429" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">实体-组件系统</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/d0541348fb84e13834bf6e635d1b987f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJcbzatlxHrudMXk4ze3Tw.jpeg"/></div></div></figure><p id="90e2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> ECS </strong>是<em class="lu">实体-组件系统</em>的首字母缩写，这是苹果鼓励我们在开发游戏时在项目中采用的软件工程实践，并无新意，只是游戏开发中的常见实践。</p><p id="46ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你不用把代码放在场景或<code class="fe ln lo lp lq b">SKSpriteNode</code>子类中，而是用这些更抽象的东西来表示你游戏中的对象(玩家、敌人、墙壁、任何东西),它们只需要很少的数据和信息，而你把其他的东西都放在<code class="fe ln lo lp lq b">Components</code>中。</p><p id="b6f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">每个实体都是一个<code class="fe ln lo lp lq b">GKEntity</code>，或者更可能是它的一个子类，你可以在其中添加你需要的属性，这些属性只是数据，你不希望你的功能放在那里。</p><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="8a9b" class="nu lw iq lq b gy nv nw l nx ny">class WPEntity: GKEntity{<br/>	//........<br/>}</span></pre><p id="010d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于它们，您使用组件，即<code class="fe ln lo lp lq b">GKComponent</code>的子类，然后将它们添加到实体中。您只需编写一次，就可以将该功能赋予您想要的每个实体。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">意志力健康组件版本0.0.1(3)</p></figure><p id="7b38" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是对独立性、模块化、可伸缩性和可维护性的巨大改进。</p><p id="0c5f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们用一个类似Pac-man的游戏来举例，从继承经典的面向对象范例开始:一个Pac-Man游戏依赖于玩家、幽灵、水果、小球和能量小球等元素；现在让我们把注意力集中在<code class="fe ln lo lp lq b">player</code>和<code class="fe ln lo lp lq b">ghost</code>上。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/7434014316a249de00b0184f86b43fd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gk8jSnm7nT5yRqfvUX4YMw.jpeg"/></div></div></figure><p id="a2d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">作为两者的超类，我们可以想到一个可渲染类，因为我们需要以某种方式显示它们，这是首先要想象的事情之一。吃豆人也受玩家输入的影响，所以我们让它也从一个可控类继承。</p><p id="6557" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是如果我想让我的游戏成为一个多人聚会游戏，也许是通过一个可玩的幽灵？还是用<em class="lu">隐形鬼</em>让<em class="lu">更难</em>？随着字符数量的增加，您可能已经看到了一些问题。如何设置继承链？可玩幽灵可以从幽灵继承，但它也需要可控；隐形鬼确实是鬼但是可渲染的呢？</p><p id="ff52" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们尝试切换到ECS:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/faa72a9610a548ac3c1eafacdd81ddd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9NSuHqIzweIe02l8w42oYg.jpeg"/></div></div></figure><p id="c359" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Pac-Man和Ghost是<code class="fe ln lo lp lq b">Entity</code>的子类，隐形Ghost和可玩Ghost继承自Ghost。已经是一个<em class="lu">更简单的概念，因为它遵循语义</em>。</p><p id="fab9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如前所述，我们可以将它们的功能分解为3个部分:<em class="lu">可渲染的</em>、<em class="lu">可控制的、</em>和<em class="lu">可渲染的</em>。</p><p id="90e4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦创建了它们，就可以将它们添加到具有该功能的实体中，这样就万事大吉了！您还可以使用ComponentSystems来管理特定功能的每个实例。</p><h1 id="eb49" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">状态机</h1><p id="8403" class="pw-post-body-paragraph kr ks iq kt b ku od jr kw kx oe ju kz la of lc ld le og lg lh li oh lk ll lm ij bi translated">每个游戏都要担心游戏状态:这都是关于它们以及它们如何变化的。它们代表着正在发生的事情，影响着一切，比如你如何处理输入，如何显示信息等等…</p><p id="da44" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您只是将所有代码转储到您的场景中，甚至是一个实体对象中，您可能会以一个庞大的if-else链结束，这通常很难调试、扩展和处理。</p><p id="fe2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">GameplayKit包括一种处理状态机的方法，这样你就可以处理它们了，所以让我们用Ghosts行为来做个例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/53de682a8c0c8f6cd56d4782d6169db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IhS_0iOou9SP-JUDS81eRA.jpeg"/></div></div></figure><p id="4050" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一只<strong class="kt ir">鬼</strong>有4种状态:</p><ul class=""><li id="3732" class="oj ok iq kt b ku kv kx ky la ol le om li on lm oo op oq or bi translated"><strong class="kt ir">追逐</strong>，其中它试图到达玩家；</li><li id="632f" class="oj ok iq kt b ku os kx ot la ou le ov li ow lm oo op oq or bi translated"><strong class="kt ir">逃离</strong>，通过吃一颗能量丸使其逃离吃豆人而不被吃掉；</li><li id="b621" class="oj ok iq kt b ku os kx ot la ou le ov li ow lm oo op oq or bi translated"><strong class="kt ir">打败了</strong>，玩家吃鬼的时候；</li><li id="b88d" class="oj ok iq kt b ku os kx ot la ou le ov li ow lm oo op oq or bi translated"><strong class="kt ir">重生</strong>，当它回到自己的牢房再次开始追逐状态。</li></ul><p id="c805" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了实现这个结构，我们创建了一个<code class="fe ln lo lp lq b">GKStateMachine</code>实例，您给出了一个状态列表，每个状态都必须是<code class="fe ln lo lp lq b">GKState</code>的一个特定子类。这个想法是，每当你必须做出一些决定或做一些依赖于那个状态的功能时，你把那个功能放在你想要处理的状态中，你可以根据你想要发生的事情实现那个覆盖方法，例如在转换、进入、离开等过程中……[<code class="fe ln lo lp lq b">didEnter(from previousState:GKState) ; willExit(to nextState:GKState)</code>]</p><p id="d66b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是我在意志力中为健康部分使用的状态机的另一个例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/b9404180fe973fbdeeb24af07f394d90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AClyFSzEDVilC6D1-Vqxeg.jpeg"/></div></div></figure><p id="7e99" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="lu">健康组件内部声明:</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">版本0.0.1(3)中意志力健康组件内的健康状态机声明</p></figure><p id="2a77" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="lu">状态类:</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div><p class="mo mp gj gh gi mq mr bd b be z dk translated">意志力健康状态0.0.1版(3)</p></figure><h1 id="9d90" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">包装它</h1><p id="c65f" class="pw-post-body-paragraph kr ks iq kt b ku od jr kw kx oe ju kz la of lc ld le og lg lh li oh lk ll lm ij bi translated">我真的鼓励你试试GameplayKit，它真的简化了我的工作流程，让我可以在短短3天内培养意志力！</p><p id="ddcf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我发现了新的东西，我会试着更新这篇文章，不要犹豫，联系我讨论它，继续发展！(大多是游戏！👾 ).</p><div class="oy oz gp gr pa pb"><a href="https://github.com/orleonedev/WillPower-JamVersion" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ir gy z fp pg fr fs ph fu fw ip bi translated">GitHub-orleonedev/意志力-JamVersion: NCX街机游戏Jam - SpriteKit和GameplayKit街机…</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">github.com</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp kp pb"/></div></div></a></div><p id="510e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你想的话，可以看看我的同事兼童年好友Matteo Morena写的关于意志力的文章，这是我们一起开发的游戏。</p><div class="oy oz gp gr pa pb"><a href="https://medium.com/@mmorenanow/making-a-game-in-5-days-willpower-a1b3cf79238d" rel="noopener follow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ir gy z fp pg fr fs ph fu fw ip bi translated">5天做游戏:意志力</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">通过试飞下载链接:https://testflight.apple.com/join/HwunISkz</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">medium.com</p></div></div><div class="pk l"><div class="pq l pm pn po pk pp kp pb"/></div></div></a></div><div class="oy oz gp gr pa pb"><a href="https://medium.com/@scaps/how-to-make-your-arcade-ios-game-using-spritekit-and-gameplaykit-make-it-spritey-547a871b690f" rel="noopener follow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ir gy z fp pg fr fs ph fu fw ip bi translated">如何使用SpriteKit和GameplayKit制作你的街机iOS游戏——制作它spritey。</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">你有没有想过在苹果手机平台上开发你的街机游戏？那就和我一起踏上这个旅程，学习两个…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">medium.com</p></div></div><div class="pk l"><div class="pr l pm pn po pk pp kp pb"/></div></div></a></div></div></div>    
</body>
</html>