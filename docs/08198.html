<html>
<head>
<title>How To Start Running Apache Airflow in Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Docker中开始运行Apache Airflow</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-start-running-apache-airflow-in-docker-6567d8165653?source=collection_archive---------4-----------------------#2021-04-06">https://betterprogramming.pub/how-to-start-running-apache-airflow-in-docker-6567d8165653?source=collection_archive---------4-----------------------#2021-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eb67" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">5分钟后开始在Docker中运行气流</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d5f1e7d243255487f59e430f2e7bbbf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t6r_I5AeAGzpwxXa"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿诺德·弗朗西斯卡在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><div class="kz la gp gr lb lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq ks lc"/></div></div></a></div><p id="dc85" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">启动Airflow最简单快捷的方法就是在Docker中用<code class="fe mn mo mp mq b"><a class="ae ky" href="https://airflow.apache.org/docs/apache-airflow/stable/executor/celery.html" rel="noopener ugc nofollow" target="_blank">CeleryExecutor</a></code>运行它。我们假设您对Docker有基本的了解，并且已经在您的计算机上安装了<a class="ae ky" href="https://docs.docker.com/engine/installation/" rel="noopener ugc nofollow" target="_blank"> Docker社区版(CE) </a>。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="a9c5" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">创建气流文件夹</h1><p id="1a84" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">创建一个Airflow目录很方便，你可以在里面放你的文件夹(比如<code class="fe mn mo mp mq b">dags</code>等等)。).因此，打开您的终端，运行:</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="bb96" class="nz mz it mq b gy oa ob l oc od">mkdir airflow-docker cd airflow-docker</span></pre><p id="f15d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我创建了一个名为<code class="fe mn mo mp mq b">airflow-docker</code>的文件夹。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="6e5e" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">下载docker-compose.yaml文件</h1><p id="4a3d" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">要在Docker Compose上部署Airflow，您应该获取<code class="fe mn mo mp mq b"><a class="ae ky" href="https://airflow.apache.org/docs/apache-airflow/stable/docker-compose.yaml" rel="noopener ugc nofollow" target="_blank">docker-compose.yaml</a> </code>文件。所以让我们用<code class="fe mn mo mp mq b">curl</code>命令下载它。</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="9f65" class="nz mz it mq b gy oa ob l oc od">curl -LfO 'https://airflow.apache.org/docs/apache-airflow/2.0.1/docker-compose.yaml'</span></pre><p id="d2d9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">容器中的一些目录是挂载的，这意味着它们的内容在您的计算机和容器之间是同步的。</p><ul class=""><li id="e679" class="oe of it lt b lu lv lx ly ma og me oh mi oi mm oj ok ol om bi translated">你可以把你的DAG文件放在这里</li><li id="7b16" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><code class="fe mn mo mp mq b">./logs</code>:包含任务执行和调度程序的日志</li><li id="4b4a" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><code class="fe mn mo mp mq b">./plugins</code>:你可以在这里放置你的<a class="ae ky" href="https://airflow.apache.org/docs/apache-airflow/stable/plugins.html" rel="noopener ugc nofollow" target="_blank">自定义插件</a></li></ul><p id="1a07" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">该文件包含几个服务定义:</p><ul class=""><li id="ed7c" class="oe of it lt b lu lv lx ly ma og me oh mi oi mm oj ok ol om bi translated"><code class="fe mn mo mp mq b">airflow-scheduler</code>:<a class="ae ky" href="https://airflow.apache.org/docs/apache-airflow/stable/scheduler.html" rel="noopener ugc nofollow" target="_blank">调度器</a>监控所有任务和Dag，一旦它们的依赖关系完成，就触发任务实例</li><li id="bf8a" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><code class="fe mn mo mp mq b">airflow-webserver</code>:在<code class="fe mn mo mp mq b"><a class="ae ky" href="http://localhost:8080." rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code>可用的网络服务器</li><li id="94f3" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><code class="fe mn mo mp mq b">airflow-worker</code>:执行调度程序给定任务的工作者</li><li id="7521" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><code class="fe mn mo mp mq b">airflow-init</code>:初始化服务</li><li id="5eae" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><code class="fe mn mo mp mq b">flower</code> : <a class="ae ky" href="https://flower.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">用于监测环境的花卉app </a>。<code class="fe mn mo mp mq b"><a class="ae ky" href="http://localhost:8080." rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code> <a class="ae ky" href="http://localhost:8080." rel="noopener ugc nofollow" target="_blank">有。</a></li><li id="e2ae" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><code class="fe mn mo mp mq b">postgres</code>:数据库</li><li id="6594" class="oe of it lt b lu on lx oo ma op me oq mi or mm oj ok ol om bi translated"><code class="fe mn mo mp mq b">redis</code>:<a class="ae ky" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank">Redis</a>代理，它将消息从调度器转发到工作器</li></ul></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="9f68" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">初始化环境</h1><p id="889b" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">要初始化环境，请运行以下命令:</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="897f" class="nz mz it mq b gy oa ob l oc od">docker-compose up airflow-init</span></pre><p id="108e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">初始化完成后，您应该会看到类似下面的消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/78147ace30457686cbbcf88cfa1a6ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/0*wVtOUra6rO2sxbju.png"/></div></figure></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="444f" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">运行气流</h1><p id="2fa3" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">您可以通过运行以下命令开始运行Airflow:</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="3456" class="nz mz it mq b gy oa ob l oc od">docker-compose up</span></pre><p id="dca6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您想确保容器正在运行，您应该打开一个新的终端并运行:</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="3387" class="nz mz it mq b gy oa ob l oc od">$ docker ps</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/689908dacc9f451030d28b6470336dce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OCESYw7mpS02UjNa.png"/></div></div></figure></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="7405" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">访问Web界面</h1><p id="ec7d" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">一旦集群启动，您就可以登录到web界面并尝试运行一些任务。网络服务器在<code class="fe mn mo mp mq b">http://localhost:8080</code>可用。默认账户有登录名和密码<code class="fe mn mo mp mq b">airflow</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/f15537661e4f1e7b8cc9cf328b6a568a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-PfEN50qcsi33Bb5.png"/></div></div></figure></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="4b44" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">如何与Airflow命令行交互</h1><p id="089e" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">在运行命令<code class="fe mn mo mp mq b">docker ps</code>之后，我们获得了正在运行的容器的名称和id。如果我们想与一个特定的容器交互，我们可以运行<code class="fe mn mo mp mq b">docker exec &lt;container_name&gt; &lt;command&gt;</code>。让我们来看看气流版本:</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="9979" class="nz mz it mq b gy oa ob l oc od">docker exec airflow-docker_airflow-webserver_1 airflow version</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/26bd7801620f4f46fbe2fd891d984f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0Ovq_GiYTihA_gM4.png"/></div></div></figure><p id="be66" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">请注意，在您的<code class="fe mn mo mp mq b">airflow-docker</code>文件夹中，您应该会找到以下文件和文件夹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/f2edebcc45c316a48d71dfe98172c48e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*raC5HJxm9NE9lann.png"/></div></div></figure></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="12d5" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">清理</h1><p id="4f71" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">要停止和删除容器、删除包含数据库数据的卷以及下载映像，请运行:</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="3bdb" class="nz mz it mq b gy oa ob l oc od">docker-compose down --volumes --rmi all</span></pre></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="e164" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">你准备好运行你的第一个DAG了吗？</h1><p id="fba6" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">如果你觉得已经准备好运行你的第一个DAG了，你可以看看我们的演练教程。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="d72f" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">参考</h1><p id="fb00" class="pw-post-body-paragraph lr ls it lt b lu nq ju lw lx nr jx lz ma ns mc md me nt mg mh mi nu mk ml mm im bi translated">[1] <a class="ae ky" href="https://airflow.apache.org/docs/apache-airflow/stable/start/docker.html" rel="noopener ugc nofollow" target="_blank">阿帕奇气流</a></p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><div class="kj kk kl km gt lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="ow l ln lo lp ll lq ks lc"/></div></div></a></div></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="465f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="ox">最初发表于</em><a class="ae ky" href="https://predictivehacks.com/how-to-start-running-apache-airflow-in-docker/" rel="noopener ugc nofollow" target="_blank"><em class="ox">【https://predictivehacks.com】</em></a><em class="ox">。</em></p></div></div>    
</body>
</html>