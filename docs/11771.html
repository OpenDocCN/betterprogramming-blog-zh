<html>
<head>
<title>Create a Simple AWS Lambda Using TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TypeScript创建简单的AWS Lambda</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-simple-aws-lambda-using-typescript-732c8a4a7a09?source=collection_archive---------0-----------------------#2022-04-15">https://betterprogramming.pub/create-simple-aws-lambda-using-typescript-732c8a4a7a09?source=collection_archive---------0-----------------------#2022-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3b14" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为我的Lambda函数使用类型脚本</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2ee753227e732da1a28f10fc9898116d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JoTtZ4PdLd-D7FVyQpK3wQ.png"/></div></div></figure><p id="3fa5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">大家好，今天我想谈谈如何使用TypeScript编写一个简单的AWS Lambda。我们知道NodeJs是编写Lambda函数的常用语言，但是由于缺乏类型检查和代码调试，JavaScript可能会令人沮丧。</p><p id="22b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为lambda使用Typescript有一些好处，比如:</p><ol class=""><li id="5db4" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">使用IDE编程时的代码完成提示</li><li id="b99b" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">编译时错误检查</li><li id="b0c2" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">关于你的输入和输出结构的知识</li></ol><p id="ca0c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好了，说够了。让我们跳到例子！</p><h1 id="5a41" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">准备</h1><p id="0c88" class="pw-post-body-paragraph kr ks iq kt b ku mt jr kw kx mu ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">在开始使用<a class="ae my" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html" rel="noopener ugc nofollow" target="_blank"> SAM CLI </a>工具创建lambda项目示例之前:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="a6df" class="ne mc iq na b gy nf ng l nh ni">sam init</span></pre><p id="25bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在您的终端中，您应该会看到类似这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/fb754d3cdcbac4bc064bcff7d8c76612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8EzHC-RJNXNtCxS3mNdZdQ.png"/></div></div></figure><p id="9fe3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">选择第一个选项，然后再选择一个<br/>当该过程完成时，您应该有一个如下所示的结构化文件夹:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="6f89" class="ne mc iq na b gy nf ng l nh ni">├── README.md<br/>├── events<br/>│   └── event.json<br/>├── hello-world<br/>│   ├── app.js<br/>│   ├── package.json<br/>│   └── tests<br/>│       └── unit<br/>│           └── test-handler.js<br/>└── template.yaml</span></pre><p id="b2a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，从将<code class="fe nk nl nm na b">hello-word</code>文件夹重命名为<code class="fe nk nl nm na b">src</code>开始，删除<code class="fe nk nl nm na b">tests</code>文件夹(本教程我们不会用到)。完成后，进入终端，开始添加一些依赖项。</p><p id="5829" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用以下命令从AWS依赖项开始:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="f5cf" class="ne mc iq na b gy nf ng l nh ni">npm install aws-sdk</span></pre><p id="5a0e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，是时候键入依赖关系了:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="f207" class="ne mc iq na b gy nf ng l nh ni">npm install --save-dev typescript @types/aws-lambda @types/node</span></pre><ol class=""><li id="f52c" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><code class="fe nk nl nm na b">typescript</code></li><li id="6dbe" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><code class="fe nk nl nm na b">@type/aws-lambda</code> <strong class="kt ir">，</strong>其中<strong class="kt ir"> </strong>包含用于代码完成和键入检查的AWS类型</li><li id="dbe3" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><code class="fe nk nl nm na b">@type/node</code> <strong class="kt ir">、</strong>其中<strong class="kt ir"> </strong>用于内置类型</li></ol><p id="fd22" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装完所有依赖项后，您可以运行:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="4ae6" class="ne mc iq na b gy nf ng l nh ni">tsc --init</span></pre><p id="d683" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个命令应该创建一个名为<code class="fe nk nl nm na b">tsconfig.json</code>的文件，如下所示:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="936e" class="ne mc iq na b gy nf ng l nh ni">{<br/>  "compilerOptions": {<br/>    "module": "CommonJS",<br/>    "target": "ES2017",<br/>    "noImplicitAny": true,<br/>    "preserveConstEnums": true,<br/>    "outDir": "./built",<br/>    "sourceMap": true<br/>  }<br/>}</span></pre><p id="68ee" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">TypeScript编译器需要<code class="fe nk nl nm na b">tsconfig.json</code>来弄清楚如何将TypeScript转换成JavaScript。</p><h2 id="5505" class="ne mc iq bd md nn no dn mh np nq dp ml la nr ns mn le nt nu mp li nv nw mr nx bi translated"><strong class="ak">更改代码</strong></h2><p id="4528" class="pw-post-body-paragraph kr ks iq kt b ku mt jr kw kx mu ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">好了，现在配置完成了，让我们来修改代码。<br/>将<code class="fe nk nl nm na b">app.js</code>重命名为<code class="fe nk nl nm na b">app.ts</code>，删除里面的代码。</p><p id="3567" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，像这样编写Lamba处理程序:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="929f" class="ne mc iq na b gy nf ng l nh ni"><strong class="na ir">import</strong> { <br/>  APIGatewayProxyEvent, <br/>  APIGatewayProxyResult } <br/><strong class="na ir">from "aws-lambda/trigger/api-gateway-proxy"</strong>;</span><span id="3093" class="ne mc iq na b gy ny ng l nh ni"><strong class="na ir">export const</strong> <em class="nz">lambdaHandler</em> = <strong class="na ir">async</strong> (<br/>   event: <strong class="na ir">APIGatewayProxyEvent</strong><br/>): Promise&lt;<strong class="na ir">APIGatewayProxyResult</strong>&gt; =&gt; {</span><span id="c2a6" class="ne mc iq na b gy ny ng l nh ni"><strong class="na ir">  const</strong> queries = <strong class="na ir">JSON</strong>.stringify(event.<strong class="na ir">queryStringParameters</strong>);</span><span id="3027" class="ne mc iq na b gy ny ng l nh ni"><strong class="na ir">  return</strong> {<br/>    <strong class="na ir">statusCode</strong>: 200,<br/>    <strong class="na ir">body</strong>: `Queries: ${queries}`<br/>  }<br/>}</span></pre><p id="318c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个简单的处理程序，它读取我的函数的查询字符串参数，并在输出中显示它们。酷吧？</p><p id="8a23" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好的，但不是让我们使用一些TypeScript特性来创建一个<code class="fe nk nl nm na b">Person</code>接口:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="d0ea" class="ne mc iq na b gy nf ng l nh ni"><strong class="na ir">interface</strong> Person {<br/>  name: <strong class="na ir">string</strong><br/>  surname: <strong class="na ir">string</strong><br/>  age: <strong class="na ir">number</strong><br/>}</span></pre><p id="2d09" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该函数的目的是传递一个输入，该输入是一个<code class="fe nk nl nm na b">Person</code>对象，并将包含的信息显示为一个输出。</p><p id="ff1f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们编码:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="a3fc" class="ne mc iq na b gy nf ng l nh ni"><strong class="na ir">import</strong> { <br/>  APIGatewayProxyEvent, <br/>  APIGatewayProxyResult } <br/><strong class="na ir">from "aws-lambda/trigger/api-gateway-proxy"</strong>;</span><span id="7cbb" class="ne mc iq na b gy ny ng l nh ni"><strong class="na ir">interface</strong> Person {<br/>  name: <strong class="na ir">string</strong><br/>  surname: <strong class="na ir">string</strong><br/>  age: <strong class="na ir">number</strong><br/>}</span><span id="60a8" class="ne mc iq na b gy ny ng l nh ni"><strong class="na ir">export const</strong> <em class="nz">lambdaHandler</em> = <strong class="na ir">async</strong> (<br/>   event: <strong class="na ir">APIGatewayProxyEvent</strong><br/>): Promise&lt;<strong class="na ir">APIGatewayProxyResult</strong>&gt; =&gt; {</span><span id="8b83" class="ne mc iq na b gy ny ng l nh ni"><strong class="na ir">  const</strong> person: Person = <strong class="na ir">JSON</strong>.parse(event.<strong class="na ir">body</strong>);</span><span id="a811" class="ne mc iq na b gy ny ng l nh ni"><strong class="na ir">  return</strong> {<br/>    <strong class="na ir">statusCode</strong>: 200,<br/>    <strong class="na ir">body</strong>: JSON.stringify({'Person' : person})<br/>  }<br/>}</span></pre><h2 id="7d25" class="ne mc iq bd md nn no dn mh np nq dp ml la nr ns mn le nt nu mp li nv nw mr nx bi translated">部署和测试</h2><p id="e045" class="pw-post-body-paragraph kr ks iq kt b ku mt jr kw kx mu ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">现在是时候测试Lambda函数了。首先，你必须编译Lambda并检查是否一切正常。</p><p id="edbf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">转到<code class="fe nk nl nm na b">package.json</code>文件，将该步骤添加到脚本部分:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="b493" class="ne mc iq na b gy nf ng l nh ni"><br/>.<br/>.<br/>.<br/>"scripts": {<br/>  "compile": "tsc"<br/>},<br/>.<br/>.<br/>.</span></pre><p id="a2c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并执行键入:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="8e83" class="ne mc iq na b gy nf ng l nh ni">npm run compile</span></pre><p id="bc69" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果一切正常，就编译Lambda函数。我们来测试一下！转到<code class="fe nk nl nm na b">template.yml</code>并调整到适合您的应用程序。我的是这样的:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="ef51" class="ne mc iq na b gy nf ng l nh ni"><strong class="na ir">AWSTemplateFormatVersion</strong>: '2010-09-09'<br/><strong class="na ir">Transform</strong>: AWS::Serverless-2016-10-31<br/><strong class="na ir">Description</strong>: Sample Lambda Function in Typescript<br/><strong class="na ir">Globals</strong>:<br/>  <strong class="na ir">Function</strong>:<br/>  <strong class="na ir">Timeout</strong>: 3<br/><strong class="na ir">Resources</strong>:<br/>  <strong class="na ir">TypescriptFunction</strong>:<br/>    <strong class="na ir">Type</strong>: AWS::Serverless::Function<br/>    <strong class="na ir">Properties</strong>:<br/>     <strong class="na ir">CodeUri</strong>: src/built<br/>     <strong class="na ir">Handler</strong>: app.lambdaHandler<br/>     <strong class="na ir">Runtime</strong>: nodejs14.x<br/>     <strong class="na ir">Events</strong>:<br/>      <strong class="na ir">Typescript</strong>:<br/>       <strong class="na ir">Type</strong>: Api<br/>        <strong class="na ir">Properties</strong>:<br/>         <strong class="na ir">Path</strong>: /hello<br/>         <strong class="na ir">Method</strong>: get<br/>.<br/>.<br/>.</span></pre><p id="9349" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完成跑步后:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="4b0a" class="ne mc iq na b gy nf ng l nh ni">sam build</span></pre><p id="7f84" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果没有显示错误，让我们修改放在<code class="fe nk nl nm na b">events</code>文件夹中的文件<code class="fe nk nl nm na b">event.json</code>,并替换字段<code class="fe nk nl nm na b">body</code>,如下所示:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="15b8" class="ne mc iq na b gy nf ng l nh ni">"body": "{\"name\": \"Bob\", \"surname\":\"Brown\",\"age\":21}",<br/>.<br/>.<br/>.</span></pre><p id="69f7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本地机器上运行Lambda函数:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="3651" class="ne mc iq na b gy nf ng l nh ni">sam local invoke -e events/event.json</span></pre><p id="de9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果一切正常，您应该会在终端输出中看到如下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/e64dedbd5efe3e77237b50615bb7bd6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VWns2kxzWl275RZMbPz6vw.png"/></div></div></figure><p id="475b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您的lambda现在可以部署到AWS了。</p><h1 id="9cae" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">结论</h1><p id="c77a" class="pw-post-body-paragraph kr ks iq kt b ku mt jr kw kx mu ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">示例代码可在以下位置找到:</p><div class="oa ob gp gr oc od"><a href="https://github.com/valeriouberti/aws-lambda-typescript" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">GitHub-valeriouberti/AWS-Lambda-typescript:AWS Lambda函数的一个简单示例，在…</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">Typescript-GitHub-valeriouberti/AWS-Lambda-Typescript中AWS Lambda函数的简单示例:一个简单的…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">github.com</p></div></div><div class="om l"><div class="on l oo op oq om or kp od"/></div></div></a></div><p id="172e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我发现为我的Lambda函数使用TypeScript非常简单和有趣。它帮助我避免错误——比如写方法名和在大量API文档中搜索。编译器帮助我编写正确的类型，并在部署之前避免潜在的问题。</p></div></div>    
</body>
</html>