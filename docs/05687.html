<html>
<head>
<title>Host Your Static Website in Azure as a Docker Container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将你的静态网站作为Docker容器托管在Azure中</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/host-your-static-website-in-azure-as-a-docker-container-be127f00267d?source=collection_archive---------6-----------------------#2020-07-28">https://betterprogramming.pub/host-your-static-website-in-azure-as-a-docker-container-be127f00267d?source=collection_archive---------6-----------------------#2020-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6169" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Azure上容器化你的网站</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7c5b30837807763e51e7f9f1ae47167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nz2Nd-yW4WGmATWKM554CQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@echaparro?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">埃德加·恰帕罗</a>在<a class="ae ky" href="https://unsplash.com/s/photos/container?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄。</p></figure><p id="e2a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将与您分享如何在<a class="ae ky" href="https://azure.microsoft.com/" rel="noopener ugc nofollow" target="_blank"> Azure </a>中将静态网站作为Docker容器轻松托管。托管应用程序从来没有比Docker更容易。这样做有以下好处:</p><ul class=""><li id="4c5f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">轻松设置您的托管环境。</li><li id="d248" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">易于原型化。</li><li id="8275" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">与客户或其他开发人员轻松共享您的应用程序。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e1c9" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">1.创建一个静态网站</h1><p id="b8cd" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们将为静态网站创建一个目录，并将其命名为<code class="fe nn no np nq b">docker-static</code>。但是你可以随意使用任何你喜欢的名字。</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="86b3" class="nv mr it nq b gy nw nx l ny nz">$ mkdir docker-static</span></pre><p id="f6a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的静态网站将由HTML5、CSS和JavaScript文件组成。继续在项目目录中创建以下文件:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="2e34" class="nv mr it nq b gy nw nx l ny nz">$ touch html.index index.js styles.css</span></pre><p id="2c72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，我们的网站将有最少的功能。静态文件的HTML将包含一个按钮，单击该按钮将触发JavaScript函数。JavaScript函数只是将一条消息记录到控制台。CSS只是给网站添加了一些背景色。</p><h2 id="fee0" class="nv mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">Index.html</h2><p id="608c" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">您可以将以下HTML代码复制并粘贴到<code class="fe nn no np nq b">index.html</code>文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="aa72" class="nv mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">索引. js</h2><p id="e7ab" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">将下面的JavaScript代码复制并粘贴到您的<code class="fe nn no np nq b">index.js</code>文件中。我们已经声明了一个函数，它会在每次单击HTML中的按钮时记录到控制台:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="c275" class="nv mr it nq b gy nw nx l ny nz">function logToConsole(){<br/>  console.log(`button clicked !`);<br/>}</span></pre><h2 id="890a" class="nv mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">样式. css</h2><p id="209f" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在<code class="fe nn no np nq b">styles.css</code>文件中，我们将简单地设置我们网站的背景颜色为浅灰色，如下所示:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="8f78" class="nv mr it nq b gy nw nx l ny nz">body {<br/>  background-color: lightgray;<br/>}</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e56c" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">2.创建Docker图像</h1><p id="a0d5" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在<code class="fe nn no np nq b">docker-static</code>项目文件夹中，添加一个名为<code class="fe nn no np nq b">Dockerfile</code>的文件。Docker文件是我们用来定义创建Docker映像的指令的文件。</p><p id="3be7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此阶段，项目的文件夹结构及其对应的文件应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/1602541402460683445e4fda9c1c9803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xkawwSC7NpZxssdeCIWuSg.png"/></div></div></figure><p id="3dfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，将下面的代码复制并粘贴到docker文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="3742" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的Dockerfile文件分为两个阶段，分别标记为<code class="fe nn no np nq b">static-site</code>和<code class="fe nn no np nq b">server</code>。</p><p id="aa44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在初始阶段，Dockerfile只是将静态网站的所有文件复制到Docker镜像中的<code class="fe nn no np nq b">app</code>文件夹。第二阶段(即服务器阶段)使用<a class="ae ky" href="https://www.nginx.com/" rel="noopener ugc nofollow" target="_blank"> NGINX </a>作为基础映像。然后，它将静态站点的内容复制到NGINX <code class="fe nn no np nq b">html</code>文件夹中，站点将从该文件夹中得到服务。</p><p id="15c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，Docker镜像暴露其内部端口:80，用于与外界交互。</p><h2 id="77d4" class="nv mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">构建Docker映像</h2><p id="e568" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在我们已经连接好了Docker文件，我们将构建它来创建一个Docker映像。只需在项目文件夹中运行以下Docker命令:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="e4b6" class="nv mr it nq b gy nw nx l ny nz">$ docker build -t mwizak/docker-staticwebpage -f Dockerfile .</span></pre><p id="75f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的命令中，我们用名称<code class="fe nn no np nq b">mwizak/docker-staticwebpage</code>标记了我们的Docker映像，其中“mwizak”是我的Docker Hub注册帐户的名称。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="577f" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">3.将图像推送到注册表</h1><p id="4326" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">一旦映像构建完成，您可以将它推送到Docker Hub注册表，这样您就可以轻松地从任何PC上访问它。我将在这里使用Docker Hub注册中心，但也可以随意使用您选择的其他注册中心(例如Azure container registry、Amazon ECR等。).</p><p id="1438" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将图像推送到Docker Hub，您首先必须登录您的帐户。运行命令:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="069d" class="nv mr it nq b gy nw nx l ny nz">$ docker login</span></pre><p id="8654" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过身份验证后，您可以使用以下命令将映像推送到注册表中:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="550d" class="nv mr it nq b gy nw nx l ny nz">$ docker push mwizak/docker-staticwebpage</span></pre><p id="7884" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oo">注意:mwizak是我的Docker Hub注册帐户的名称。相应地用您的帐户替换它。</em></p><p id="9ca9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，登录到您的Docker Hub注册表，映像应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/1501897024c15aba413b5abd8f6973ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fVDOn3eUnxsWDTlp-Q2JEw.png"/></div></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="6676" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">4.在Azure中创建虚拟机</h1><p id="66f5" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们将在Azure上的虚拟机中托管Docker映像中的静态网站。在这个例子中，我使用Azure作为云提供商，但是你可以使用任何你喜欢的提供商(例如谷歌云、AWS、阿里云等。).</p><p id="0e5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，登录Azure门户。从主页中，选择“创建资源”</p><p id="dff1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在下一步中，选择“计算”,然后选择“虚拟机”,如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/a458a9b6fbc15c941a552865365563c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BBs9g6m2SiVFUsjr81yt4g.png"/></div></div></figure><p id="2176" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一步中，填写所有必要的详细信息。</p><p id="cc7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虚拟机映像类型很重要。选择Docker预装的那个，这样就不用自己设置了。我使用名为“Ubuntu 18.04 Linux LTS与Docker”的Zerta镜像</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/01f5e3969a9d1b0d50d13ba9edf0c5be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hsbnWsplahbpxLepFMPtcw.png"/></div></div></figure><p id="5877" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在管理员账号选项中，选择【密码】，<strong class="lb iu">，</strong>然后提供用户名和密码。确保“允许选定的端口”已启用，以便能够通过SSH登录。</p><p id="b3cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建虚拟机可能需要几分钟时间。完成后，您可以通过SSH从本地或远程PC登录虚拟机，如下所示:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="0eac" class="nv mr it nq b gy nw nx l ny nz">$ ssh username@19.45.112.133</span></pre><p id="015d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">username</code>是您在创建虚拟机时提供的用户名，IP地址是虚拟机的IP地址。</p><h2 id="ddf8" class="nv mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">获取虚拟机IP地址</h2><p id="9e58" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">你可以从Azure门户获取你的虚拟机的IP地址。首先，在Azure门户中选择您的虚拟机。然后点击如下“概述”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/04e53ffa57637ed75ca26dcb48ee14dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0eyuYLfPIbwl--TTjDJcuw.png"/></div></div></figure><h2 id="00a5" class="nv mr it bd ms oa ob dn mw oc od dp na li oe of nc lm og oh ne lq oi oj ng ok bi translated">在端口8080上启用入站流量</h2><p id="3562" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">要使您的网站在端口8080上提供服务，您必须添加一个入站端口规则。选择您的虚拟机，然后选择“网络”并单击“添加入站端口规则”，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/8b70bda81ace9221a1486a05f0b92db1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ce978-eki__O9g1cvWUXRQ.png"/></div></div></figure><p id="4e9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将source设置为“Any”，然后在目的端口范围上输入端口号8080，这是我们的静态站点将通过的端口。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/34a57a202137c8b486eff255c738a0bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Pn4YM8Ryo1yileFTj6_5Q.png"/></div></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3351" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">5.服务器站点</h1><p id="af18" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">要为站点提供服务，请从虚拟机的终端使用以下命令运行您推送到Docker注册表的Docker映像:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="1153" class="nv mr it nq b gy nw nx l ny nz">$ sudo docker run -ti -d -p 8080:80 mwizak/docker-staticwebpage </span></pre><p id="1d7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oo">注意:如果您的本地机器(在本例中是虚拟机)上没有映像，Docker将自动从互联网(即注册表)下载映像。</em></p><p id="37bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然已经下载并运行了映像，请在本地浏览器上访问http://ip-address-of-vm:8080。瞧，Azure中有一个托管为Docker容器的网站。</p><p id="d48c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oo">注意:使用虚拟机的正确IP地址，后跟:8080(即端口号)。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/feac4d726528fc30f59c666609c0c62f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FtXTGEimiMK2pGlcB0_Qyg.png"/></div></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="90c0" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">摘要</h1><p id="4201" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">简而言之，这就是我们所做的:我们创建了一个简单的静态网站，然后将其打包为Docker容器。最后，我们在Azure的虚拟机(VM)上托管应用程序。</p></div></div>    
</body>
</html>