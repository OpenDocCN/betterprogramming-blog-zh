<html>
<head>
<title>Speed Up Your CI Pipeline With Smaller Docker Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用更小的Docker映像加快您的CI渠道</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/speed-up-your-ci-pipeline-with-smaller-docker-images-4e08dfed08c9?source=collection_archive---------7-----------------------#2021-03-18">https://betterprogramming.pub/speed-up-your-ci-pipeline-with-smaller-docker-images-4e08dfed08c9?source=collection_archive---------7-----------------------#2021-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a35b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你需要下载的越少，你就能跑得越快</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3061af41ccaba051d5bdf89c4d21911d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PtNKaaRjxCE_ZK_N"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@allodium?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Florian wchter</a>拍摄的照片。</p></figure><p id="cb8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CI/CD允许开发人员和组织更快地前进。通过自动化任务，如构建、测试和部署软件，我们在日常任务上花费的时间更少，而有更多的时间在实际的应用程序上。GitLab、CircleCI和GitHub等提供的解决方案使我们能够轻松地创建CI/CD作业。</p><p id="d847" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，CI/CD作业应该在一个独立的Docker容器中运行。这样，您就可以拥有一个可重现的构建环境。例如，您可以使用托管在Docker Hub上的Node.js映像。然后，您的作业在基于选定图像的容器中运行。该容器拥有构建应用程序所需的所有节点依赖项。</p><p id="4adb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与许多事情一样，“少即是多”的格言也适用于CI/CD。毕竟，我们不想要长时间运行的作业。但是，我们也不想牺牲CI/CD平台的优势。</p><p id="bf69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将分享一个可能的方法来加快你的管道。对于代码示例，我将使用GitLab CI。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4dff" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何使用较小的Docker映像减少CI/CD作业时间</h1><p id="9e5c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">通常，您选择的CI/CD平台允许您使用YAML文件配置作业和管道。对于GitLab CI，我们希望在我们的存储库中有一个<code class="fe mz na nb nc b">.gitlab-ci-yml</code>文件。我们现在感兴趣的是<code class="fe mz na nb nc b">image</code>配置选项。<code class="fe mz na nb nc b">image</code>关键字是Docker执行器运行以执行CI任务的Docker映像的名称。</p><p id="ea86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的第一次尝试是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c20d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先简单说一下这个配置:</p><ul class=""><li id="aa5a" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">我们告诉GitLab默认使用一个<a class="ae ky" href="https://github.com/nodejs/docker-node" rel="noopener ugc nofollow" target="_blank">节点镜像</a>(版本12.10.0)。</li><li id="d402" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">我们在每个作业之前运行<code class="fe mz na nb nc b">npm ci</code>来安装依赖项。</li><li id="5f56" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">我们有三项工作，构建、测试和lint我们的应用程序。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/ec050452e746126621548ce8442b20f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yUcwOlUgLFMCBaBVQxLVEg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/f28967ac4d5090631f027bc3b6b7440f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W0ZO7sNcBW238whQimYFUQ.png"/></div></div></figure><p id="687f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个配置没什么特别的毛病。但是，如果您看一下上面的日志，您会发现下载和准备节点映像花了33秒。33秒听起来可能不算多，但就计费分钟数而言，它可以很快累加起来。原因是像这里使用的“完整”映像除了节点之外还包含许多其他东西，比如运行时库和版本控制软件。</p><p id="baf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了一个基线，我们可以通过使用一个更小的图像来尝试改进它。在下面的例子中，我使用了一张阿尔卑斯山节点的图片。Alpine Linux比大多数发行版基础映像小得多，因此一般来说映像也小得多。除了这一变化之外，配置与上面相同。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/2235164d8c5f0dff97dcdaf44d2d8fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*36peTIBtIhC2C5oLK48cpA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/3a8b5107c222cc6c0e42fce23dbdf13a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ekrDLnLQTrQebJ4YW_3jVg.png"/></div></div></figure><p id="e7ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在只剩下15秒来下载和准备节点映像！这还不到设置完整节点映像所需时间的一半。对于只需要修改一行代码的东西来说，这是一个相当大的改进。</p><p id="2c49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特别是前端项目最有可能与较小的Docker映像兼容，因为它们除了Node之外几乎不需要任何东西。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="027b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">较小Docker图像的警告</h1><p id="f8b2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">不过，有时候你需要一个完整的图像。在下面的例子中，我试图在一个使用了<a class="ae ky" href="https://github.com/kelektiv/node.bcrypt.js" rel="noopener ugc nofollow" target="_blank"> bcrypt </a>库的Express.js项目中使用一个alpine-node图像。在日志中，我们看到我们的alpine-node映像不满足正确安装项目依赖项的所有要求。因此，工作失败了，我们需要使用一个满足项目需求的映像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/b7937d3ce21dc10604b42eea2743cbcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WUSshRyozLdEpSIUpkLy5A.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eef7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="f352" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢您阅读这篇关于如何通过使用较小的Docker映像来加速CI/CD作业的短文。正如你所看到的，很容易尝试不同的Docker图像，如<code class="fe mz na nb nc b">alpine-node</code>，看看它是否适合你。总的来说，从小图像开始是个好主意。如果它不符合您的要求，您仍然可以在必要时切换到另一个图像。</p><p id="77d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你知道其他加快CI/CD工作的技巧吗？请在评论中告诉我。</p></div></div>    
</body>
</html>