<html>
<head>
<title>Build Android App Widgets With Jetpack Glance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jetpack Glance构建Android应用程序小部件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/android-app-widgets-with-glance-9e881f40c636?source=collection_archive---------2-----------------------#2022-09-08">https://betterprogramming.pub/android-app-widgets-with-glance-9e881f40c636?source=collection_archive---------2-----------------------#2022-09-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="62ef" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建android应用程序小部件的现代方法。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8aec889c37146a7836c4b947335cfb89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p6iQ3wGLeIwL2Jo2"/></div></div></figure><p id="555f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在进入主题之前，让我们快速上一堂历史课，看看为什么这个<a class="ae ln" href="https://developer.android.com/jetpack/androidx/releases/glance" rel="noopener ugc nofollow" target="_blank">扫视</a>是一个重要且期待已久的功能。</p><ul class=""><li id="4b56" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">Android应用小部件是作为Android 1.5 (Cupcake)的一部分发布的。</li><li id="040a" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><a class="ae ln" href="https://cs.android.com/android/_/android/platform/frameworks/base/+/c39a6e0c51e182338deb8b63d07933b585134929:core/java/android/appwidget/AppWidgetManager.java;l=64;bpv=1;bpt=0" rel="noopener ugc nofollow" target="_blank">2009年代码开始</a>。</li><li id="77fe" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">在2012年，增加了在锁定屏幕上显示小工具的支持，并提供了第三方应用程序作为小工具主机(自定义启动器应用程序)等。</li><li id="1705" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">随着时间的推移，android系统不断发展，在系统的其他部分收到了很多更新，但在widget框架上收到的更新很少。</li></ul><p id="9da7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Android 12引入了<a class="ae ln" href="https://developer.android.com/jetpack/androidx/releases/glance" rel="noopener ugc nofollow" target="_blank"> Glance </a>框架，使用jetpack-compose(声明式风格)创建应用程序小部件，并对小部件框架本身进行了更多的更新。</p><h1 id="7cf0" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated"><strong class="ak">Android 12的新功能</strong></h1><h2 id="abfb" class="mu md iq bd me mv mw dn mi mx my dp mm la mz na mo le nb nc mq li nd ne ms nf bi translated"><a class="ae ln" href="https://developer.android.com/jetpack/androidx/releases/glance" rel="noopener ugc nofollow" target="_blank"><strong class="ak">Jetpack Glance</strong></a><strong class="ak">为app widgets </strong></h2><ul class=""><li id="eed3" class="lo lp iq kt b ku ng kx nh la ni le nj li nk lm lt lu lv lw bi translated">用于构建应用程序小部件UI的声明式API。</li><li id="7299" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">有状态小部件。</li><li id="e12a" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">新的干净的api来处理用户交互。</li><li id="c055" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">自定义错误用户界面(来自XML)。</li></ul><h2 id="9883" class="mu md iq bd me mv mw dn mi mx my dp mm la mz na mo le nb nc mq li nd ne ms nf bi translated"><strong class="ak">widget框架的其他更新</strong></h2><ul class=""><li id="5103" class="lo lp iq kt b ku ng kx nh la ni le nj li nk lm lt lu lv lw bi translated">可扩展小部件预览</li><li id="b9cf" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">更好的主题支持</li><li id="c94a" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">新的复合按钮</li><li id="c9da" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">添加了新的API以允许远程视图的运行时修改</li></ul><h1 id="4a52" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated"><strong class="ak">应用程序小部件的Jetpack Glance</strong></h1><h2 id="2584" class="mu md iq bd me mv mw dn mi mx my dp mm la mz na mo le nb nc mq li nd ne ms nf bi translated"><strong class="ak">什么是Jetpack Glance </strong></h2><ul class=""><li id="a56d" class="lo lp iq kt b ku ng kx nh la ni le nj li nk lm lt lu lv lw bi translated">Jetpack Glance是建立在Jetpack Compose运行时之上的新框架。</li><li id="a8ae" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">Glance提供了与Jetpack Compose类似的现代声明性Kotlin APIs，有助于构建响应性应用程序小部件。</li><li id="aa42" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">由于它构建在Jetpack Compose运行时之上，因此不能直接与其他现有的Jetpack Compose UI元素互操作，但可以与现有的RemoteViews互操作。</li><li id="0fdd" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">Glance提供了一组基本的<a class="ae ln" href="https://developer.android.com/jetpack/compose/tutorial" rel="noopener ugc nofollow" target="_blank">组件</a>来帮助构建“简略”的体验。</li><li id="cd64" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">使用Jetpack Compose runtime Glance可以将<a class="ae ln" href="https://developer.android.com/jetpack/compose/tutorial" rel="noopener ugc nofollow" target="_blank"> composables </a>转换成实际的RemoteViews，并在应用程序小部件中显示它们。</li><li id="a22a" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">Glance提供了更直观的API来处理用户交互。它抽象出了我们在使用<code class="fe nl nm nn no b">RemoteViews</code>和<code class="fe nl nm nn no b">PendingIntent</code>时会遇到的复杂性。它提供了以下用于处理用户交互的预定义操作。<br/>1)<a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/action/package-summary#actionruncallback" rel="noopener ugc nofollow" target="_blank">actionRunCallback</a><br/>2)<a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/action/package-summary#actionstartactivity" rel="noopener ugc nofollow" target="_blank">actionStartActivity</a><br/>3)<a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/action/package-summary#actionstartservice" rel="noopener ugc nofollow" target="_blank">actionStartService</a><br/>4)<a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/action/package-summary#actionsendbroadcast" rel="noopener ugc nofollow" target="_blank">actionsendboard</a></li><li id="ebb6" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">通过定义<code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/SizeMode.Single" rel="noopener ugc nofollow" target="_blank">SizeMode.Single</a></code><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/SizeMode.Single" rel="noopener ugc nofollow" target="_blank"/><code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/SizeMode.Exact" rel="noopener ugc nofollow" target="_blank">SizeMode.Exact</a></code>或<code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/SizeMode.Responsive" rel="noopener ugc nofollow" target="_blank">SizeMode.Responsive</a></code>内置支持不同尺寸的UI。</li><li id="5fef" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">使用<a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/state/GlanceStateDefinition.html" rel="noopener ugc nofollow" target="_blank">状态定义</a>进行状态管理。</li><li id="836c" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><code class="fe nl nm nn no b">LocalContext</code>、<code class="fe nl nm nn no b">LocalState</code>、<code class="fe nl nm nn no b">LocalGlanceId</code>、<code class="fe nl nm nn no b">LocalSize</code>。使用<code class="fe nl nm nn no b">CompositionLocalProvider</code>将<code class="fe nl nm nn no b">LocalAppWidgetOptions</code>提供给<code class="fe nl nm nn no b">content()</code>方法。</li></ul></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><p id="0a56" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">尽管Glance框架看起来像是对应用程序小部件的根本性改变。应用程序小部件的创建非常相似，唯一的变化是我们如何表示UI和维护状态。</p><h1 id="c17a" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated"><strong class="ak">创建GlanceAppWidget </strong></h1><p id="ddce" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">第0步:<a class="ae ln" href="https://developer.android.com/jetpack/androidx/releases/glance#declaring_dependencies" rel="noopener ugc nofollow" target="_blank">添加依赖关系</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="79be" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一步:创建<code class="fe nl nm nn no b">GlanceAppWidget</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="2825" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第二步:用<code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/androidx/glance/appwidget/GlanceAppWidgetReceiver" rel="noopener ugc nofollow" target="_blank">GlanceAppWidgetReceiver</a></code>连接</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="b80a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">步骤3:添加widget <a class="ae ln" href="https://developer.android.com/reference/android/appwidget/AppWidgetProviderInfo" rel="noopener ugc nofollow" target="_blank">元数据</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="02b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后一步:在<code class="fe nl nm nn no b">AndroidManifest.xml</code>注册组件</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="00b3" class="mc md iq bd me mf ob mh mi mj oc ml mm jw od jx mo jz oe ka mq kc of kd ms mt bi translated"><strong class="ak">有状态小部件</strong></h1><p id="cfe8" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">每个<code class="fe nl nm nn no b">GlanceAppWidget</code>维护自己的偏好，使用<a class="ae ln" href="https://developer.android.com/topic/libraries/architecture/datastore" rel="noopener ugc nofollow" target="_blank">数据存储</a>偏好将数据存储为键值对。</p><p id="f3ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从本地合成中使用<code class="fe nl nm nn no b">currentState</code>方法读取小部件状态(即<code class="fe nl nm nn no b">LocalState.current</code>)。<code class="fe nl nm nn no b">currentState</code>有两个重载方法:</p><p id="df2d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nl nm nn no b">currentState</code>不带参数返回一个<code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/datastore/preferences/core/Preferences" rel="noopener ugc nofollow" target="_blank">Preferences</a></code>。</p><p id="8423" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nl nm nn no b">currentState</code>以键作为参数(即<code class="fe nl nm nn no b">currentState(key)</code>)返回一个与键相关的值。</p><p id="13bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要将数据更新到首选项中，我们可以使用<code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/state/package-summary#updateappwidgetstate" rel="noopener ugc nofollow" target="_blank">updateAppWidgetState()</a></code></p><blockquote class="og oh oi"><p id="9c6f" class="kr ks oj kt b ku kv jr kw kx ky ju kz ok lb lc ld ol lf lg lh om lj lk ll lm ij bi translated">一旦使用<code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/state/package-summary#updateappwidgetstate" rel="noopener ugc nofollow" target="_blank"><em class="iq">updateAppWidgetState()</em></a></code>更新了首选项，我们必须手动调用<code class="fe nl nm nn no b"><em class="iq">GlanceAppWidget.update()</em></code>方法来用最新的数据重组UI。</p></blockquote><p id="3193" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们看看下面的代码，看看我们是如何更新布尔参数值来切换小部件主题的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/5c15ec172ab44ae777c80b4a1bf54bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p3GgtSCko9i0PkVGeayWkA.png"/></div></div><p class="oo op gj gh gi oq or bd b be z dk translated">有状态小部件代码</p></figure><h1 id="4582" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated"><strong class="ak">有状态小部件演示</strong></h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/891e93df250043efa4575cf4924a5679.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*uVdycvyl-aAZOCwI3kU5jA.gif"/></div><p class="oo op gj gh gi oq or bd b be z dk translated">有状态小部件演示</p></figure></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="8190" class="mc md iq bd me mf ob mh mi mj oc ml mm jw od jx mo jz oe ka mq kc of kd ms mt bi translated"><strong class="ak">用户交互</strong></h1><p id="8a8e" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">正如我们之前讨论的，Glance提供了更直观的API来处理用户交互，而<code class="fe nl nm nn no b">actionRunCallback</code>就是其中之一。</p><ul class=""><li id="b568" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated"><code class="fe nl nm nn no b">actionRunCallback</code>方法返回一个动作，该动作可以附加到按钮的<code class="fe nl nm nn no b">onClick</code>方法或任何其他具有<code class="fe nl nm nn no b">onClick</code>属性的扫视组件。</li><li id="1395" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><code class="fe nl nm nn no b">actionRunCallback</code>方法将<code class="fe nl nm nn no b">ActionCallback</code>类作为类型参数，可选的<code class="fe nl nm nn no b">ActionParameters</code>作为方法参数。</li></ul><p id="0488" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们看看下面的代码，每当点击按钮时，就会创建一个<code class="fe nl nm nn no b">ToastActionCallback</code>的实例，并使用<code class="fe nl nm nn no b">context</code>、<code class="fe nl nm nn no b">glanceId</code>和我们传递的参数(即<code class="fe nl nm nn no b">ActionParameters</code>)对其调用<code class="fe nl nm nn no b">onRun</code>方法。</p><p id="8a34" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">PS: <code class="fe nl nm nn no b">glanceId</code>是分配给每个<code class="fe nl nm nn no b">GlanceAppWidget</code>的唯一id。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/c39cde702b0fe0673cae25c2df6a4aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6HW58EzVH-F1jhNcfMgBMw.png"/></div></div><p class="oo op gj gh gi oq or bd b be z dk translated">处理程序用户与actionRunCallback的交互(带有操作参数)</p></figure><p id="037b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就像<code class="fe nl nm nn no b">actionRunCallback</code>一样，我们也有其他API来启动服务(即<code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/action/package-summary#actionstartservice" rel="noopener ugc nofollow" target="_blank">actionStartService</a></code>)、启动活动(即<code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/action/package-summary#actionstartactivity" rel="noopener ugc nofollow" target="_blank">actionStartActivity</a></code>)或发送广播(即<code class="fe nl nm nn no b"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/action/package-summary#actionsendbroadcast" rel="noopener ugc nofollow" target="_blank">actionSendBroadcast</a></code>)。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="332f" class="mc md iq bd me mf ob mh mi mj oc ml mm jw od jx mo jz oe ka mq kc of kd ms mt bi translated">不同尺寸</h1><h2 id="e760" class="mu md iq bd me mv mw dn mi mx my dp mm la mz na mo le nb nc mq li nd ne ms nf bi translated"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/SizeMode.Single" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> SizeMode。单身</strong> </a></h2><p id="fb8b" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">当小部件尺寸模式为<code class="fe nl nm nn no b">SizeMode.Single</code>时，则<code class="fe nl nm nn no b">GlanceAppWidget</code>提供单一用户界面。应用微件的宽度和高度将是<a class="ae ln" href="https://developer.android.com/reference/android/appwidget/AppWidgetProviderInfo" rel="noopener ugc nofollow" target="_blank">应用微件信息</a>中给出的最小宽度和高度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/9474a5fdf0a40079db23b82e163e9fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2HpNwlzvyuGR1yo1P2CAww.gif"/></div></div><p class="oo op gj gh gi oq or bd b be z dk translated">单一尺寸模式小部件演示</p></figure><h2 id="1500" class="mu md iq bd me mv mw dn mi mx my dp mm la mz na mo le nb nc mq li nd ne ms nf bi translated"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/SizeMode.Exact" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> SizeMode。</strong>确切的</a></h2><pre class="kg kh ki kj gt ov no ow ox aw oy bi"><span id="38ff" class="mu md iq no b gy oz pa l pb pc">When the widget size mode is SizeMode.Exact then the GlanceAppWidget provides a UI for each size the App Widget can be. (i.e any one of the possible size from supported grid. <a class="ae ln" href="https://developer.android.com/develop/ui/views/appwidgets/layouts#anatomy_determining_size" rel="noopener ugc nofollow" target="_blank">click here for more detail</a>).</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/870987066866c1ce4284ab622d7d4b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BoJK6YZgyGvbf2sDos0JHA.gif"/></div></div><p class="oo op gj gh gi oq or bd b be z dk translated">精确尺寸模式小部件演示</p></figure><h2 id="7354" class="mu md iq bd me mv mw dn mi mx my dp mm la mz na mo le nb nc mq li nd ne ms nf bi translated"><a class="ae ln" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/SizeMode.Responsive" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> SizeMode。响应式</strong>T5】</a></h2><pre class="kg kh ki kj gt ov no ow ox aw oy bi"><span id="08bc" class="mu md iq no b gy oz pa l pb pc">When the widget size mode is SizeMode.Responsive then the GlanceAppWidget provides a UI for a fixed set of sizes.</span><span id="5dd6" class="mu md iq no b gy pd pa l pb pc">SizeMode.Responsive takes a set of fixed sizes from it's constructor.</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/f1fcf1feb6094f00c67ac9a3e349c4bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ycTkNC7ys933CyHDsf6qAQ.gif"/></div></div><p class="oo op gj gh gi oq or bd b be z dk translated">响应大小模式小部件演示</p></figure></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="e904" class="mc md iq bd me mf ob mh mi mj oc ml mm jw od jx mo jz oe ka mq kc of kd ms mt bi translated"><strong class="ak">widget框架的其他更新</strong></h1><p id="9c29" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">除了Glance框架之外，现有的widget框架也得到了一些很好的更新。让我们看看其中的一些。</p><h2 id="ff7a" class="mu md iq bd me mv mw dn mi mx my dp mm la mz na mo le nb nc mq li nd ne ms nf bi translated"><strong class="ak">可扩展小工具预览</strong></h2><ul class=""><li id="2f5b" class="lo lp iq kt b ku ng kx nh la ni le nj li nk lm lt lu lv lw bi translated">在Android 11或更低版本中,<code class="fe nl nm nn no b">android:previewImage</code>用于显示小部件的外观</li><li id="7fae" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">因为它是一个图像，每次我们更新小部件设计时，我们都必须改变图像，这需要一些设计工作。</li><li id="b23a" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">从Android 12开始，小部件预览可以从XML布局中获得，这可以更准确地反映实际小部件的外观</li></ul><pre class="kg kh ki kj gt ov no ow ox aw oy bi"><span id="a1af" class="mu md iq no b gy oz pa l pb pc">&lt;appwidget-provider<br/>    ...<br/>    android:description="<a class="ae ln" href="http://twitter.com/string/app_widget_description" rel="noopener ugc nofollow" target="_blank">@string/app_widget_description</a>"<br/>    android:targetCellWidth="3"<br/>    android:targetCellHeight="3"<br/>    android:previewLayout="<a class="ae ln" href="http://twitter.com/layout/my_widget_preview" rel="noopener ugc nofollow" target="_blank">@layout/my_widget_preview</a>"&gt;<br/>&lt;/appwidget-provider&gt;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/0ca9cc854ff82f751d4aec37038058e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/0*HiJDDi_CLgnUcvik"/></div><p class="oo op gj gh gi oq or bd b be z dk translated"><strong class="bd pf">Ref</strong><a class="ae ln" href="https://developer.android.com/develop/ui/views/appwidgets/enhance" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/develop/ui/views/app widgets/enhance</a></p></figure><h2 id="da8c" class="mu md iq bd me mv mw dn mi mx my dp mm la mz na mo le nb nc mq li nd ne ms nf bi translated"><strong class="ak">widget框架的其他更新</strong></h2><p id="c793" class="pw-post-body-paragraph kr ks iq kt b ku ng jr kw kx nh ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">看看<a class="ae ln" href="https://developer.android.com/develop/ui/views/appwidgets/enhance" rel="noopener ugc nofollow" target="_blank">这里</a>来增强你的<code class="fe nl nm nn no b">app-widgets</code>并探索更多从Android 12开始的widget框架更新。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><p id="05c9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">包含所有代码示例的Repo可在此处获得:</p><div class="pg ph gp gr pi pj"><a href="https://github.com/sridhar-sp/android-playground/tree/main/Glance" rel="noopener  ugc nofollow" target="_blank"><div class="pk ab fo"><div class="pl ab pm cl cj pn"><h2 class="bd ir gy z fp po fr fs pp fu fw ip bi translated">安卓游乐场/主sridhar-sp一览/安卓游乐场</h2><div class="pq l"><h3 class="bd b gy z fp po fr fs pp fu fw dk translated">这个报告包含我创建的示例应用程序，作为探索android新功能的一部分，并记录为博客…</h3></div><div class="pr l"><p class="bd b dl z fp po fr fs pp fu fw dk translated">github.com</p></div></div><div class="ps l"><div class="pt l pu pv pw ps px kp pj"/></div></div></a></div><p id="6733" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里需要注意的一件重要事情是，尽管这种变化看起来像是。一个突破性的改变没有修改任何现有的android窗口小部件框架，整个Glance框架在现有的android窗口小部件框架之上工作。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="2591" class="mc md iq bd me mf ob mh mi mj oc ml mm jw od jx mo jz oe ka mq kc of kd ms mt bi translated">参考</h1><ul class=""><li id="13e6" class="lo lp iq kt b ku ng kx nh la ni le nj li nk lm lt lu lv lw bi translated"><a class="ae ln" href="https://android-developers.googleblog.com/2021/12/announcing-jetpack-glance-alpha-for-app.html" rel="noopener ugc nofollow" target="_blank">https://Android-developers . Google blog . com/2021/12/announcing-jetpack-glance-alpha-for-app . html</a></li></ul></div></div>    
</body>
</html>