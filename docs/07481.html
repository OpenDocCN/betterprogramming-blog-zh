<html>
<head>
<title>How To Improve Your AI-Based Python Trading System: The Alpaca Broker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何改进你的基于人工智能的Python交易系统:羊驼经纪人</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-improve-your-ai-based-python-trading-system-the-alpaca-broker-92c0029bbc45?source=collection_archive---------10-----------------------#2021-01-19">https://betterprogramming.pub/how-to-improve-your-ai-based-python-trading-system-the-alpaca-broker-92c0029bbc45?source=collection_archive---------10-----------------------#2021-01-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cf20" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索免佣金API的可能性</h2></div><p id="0a45" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">编者按:本文并非投资建议，仅供娱乐和教育之用。</em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/d3fb08b213c88a60b9b37331617e9dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fm4pub7DBjTAIRyJ"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">由<a class="ae lv" href="https://unsplash.com/@chrisliverani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯·利维拉尼</a>在<a class="ae lv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="8383" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文从一个样板文件开始，<a class="ae lv" href="https://towardsdatascience.com/how-to-create-a-fully-automated-ai-based-trading-system-with-python-708503c1a907" rel="noopener" target="_blank">一个完全自动化的基于人工智能的交易系统</a>。然而，这不是第二部分——把它想成一个副产品。</p><p id="764f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好了，你已经学习了前面的教程，现在你有了一个非常棒的全自动人工智能交易系统，简称AFAABTS。现在怎么办？现在是时候加强它了，增加更多的资源，更多的复杂性，诸如此类的东西。今天，我们将为羊驼增加更多的风味，羊驼是已经包括在内的两个经纪人之一。</p><p id="6125" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先让我们简单回顾一下:羊驼是什么？根据<a class="ae lv" href="https://alpaca.markets/" rel="noopener ugc nofollow" target="_blank">他们的主页面</a>，是一个股票交易的API:</p><blockquote class="lw"><p id="6ce0" class="lx ly it bd lz ma mb mc md me mf ld dk translated">使用算法进行交易、连接应用程序、构建服务—所有这些都使用免佣金的股票交易API</p></blockquote><p id="d0fc" class="pw-post-body-paragraph ki kj it kk b kl mg ju kn ko mh jx kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">羊驼是注册证券经纪商，也是FINRA和SIPC的成员。他们也在这里，在中等！你可以在羊驼的名字下找到它们。在他们的额外津贴中，他们列出了:</p><ul class=""><li id="bc0a" class="mn mo it kk b kl km ko kp kr mp kv mq kz mr ld ms mt mu mv bi translated">高级交易:支持许多高级投资和交易策略，如保证金或卖空。</li><li id="81ea" class="mn mo it kk b kl mw ko mx kr my kv mz kz na ld ms mt mu mv bi translated">测试:我们这里要用的羊驼纸账户，是一个有实时数据但没有真金白银的测试环境。<a class="ae lv" href="https://alpaca.markets/docs/trading-on-alpaca/paper-trading/" rel="noopener ugc nofollow" target="_blank">与真实交易</a>有一些微小的差异，但无论如何它都是一个很棒的工具。</li><li id="7e21" class="mn mo it kk b kl mw ko mx kr my kv mz kz na ld ms mt mu mv bi translated">多语言:SDK在Python中可用。NET/C#或Go等等。</li><li id="3884" class="mn mo it kk b kl mw ko mx kr my kv mz kz na ld ms mt mu mv bi translated">免佣金:羊驼不收取交易佣金。然而，有一个披露:</li></ul><blockquote class="nb nc nd"><p id="f879" class="ki kj le kk b kl km ju kn ko kp jx kq ne ks kt ku nf kw kx ky ng la lb lc ld im bi translated">没有最小值。免佣金交易是指通过API交易美国上市证券的羊驼自导个人现金经纪账户不收取佣金。<a class="ae lv" href="https://alpaca.markets/learn/regulatory-fees/" rel="noopener ugc nofollow" target="_blank">相关SEC和FINRA费用可能适用。</a></p></blockquote><p id="8b39" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用<code class="fe nh ni nj nk b">alpaca-trade-api</code> <a class="ae lv" href="https://github.com/alpacahq/alpaca-trade-api-python/" rel="noopener ugc nofollow" target="_blank">库</a>，Python SDK，在GitHub中有超过700颗恒星。要安装:</p><pre class="lg lh li lj gt nl nk nm nn aw no bi"><span id="2e36" class="np nq it nk b gy nr ns l nt nu">$ pip install alpaca-trade-api</span></pre><p id="b488" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们快速浏览一下，看看羊驼提供了什么。</p><h2 id="63a9" class="np nq it bd nv nw nx dn ny nz oa dp ob kr oc od oe kv of og oh kz oi oj ok ol bi translated">注册</h2><p id="1af1" class="pw-post-body-paragraph ki kj it kk b kl om ju kn ko on jx kq kr oo kt ku kv op kx ky kz oq lb lc ld im bi translated">通过API完成的所有事情都需要一个API密钥ID和一个密钥，可以在仪表板中找到:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi or"><img src="../Images/a1a20a43dd38b61c758a08b6b6f3f1db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkG8d-5jjfYe5jux2iOssw.png"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">作者图片</p></figure><p id="6229" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从这一点来看，所有动作将具有相同的结构:</p><pre class="lg lh li lj gt nl nk nm nn aw no bi"><span id="31bc" class="np nq it nk b gy nr ns l nt nu">import alpaca_trade_api as alpaca</span><span id="9c33" class="np nq it nk b gy os ns l nt nu">KEY_ID = &lt;&lt;&lt;YOUR KEY ID GOES HERE&gt;&gt;&gt;<br/>SECRET_KEY = &lt;&lt;&lt;YOUR SECRET KEY GOES HERE&gt;&gt;&gt;<br/>BASE_URL = 'https://paper-api.alpaca.markets'</span><span id="a265" class="np nq it nk b gy os ns l nt nu">api = alpaca.REST(KEY_ID, SECRET_KEY, base_url=BASE_URL)</span></pre><p id="ac76" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nh ni nj nk b">api</code>对象是我们将用来访问所有方法的对象。</p><h2 id="22ce" class="np nq it bd nv nw nx dn ny nz oa dp ob kr oc od oe kv of og oh kz oi oj ok ol bi translated">获取帐户信息</h2><p id="957b" class="pw-post-body-paragraph ki kj it kk b kl om ju kn ko on jx kq kr oo kt ku kv op kx ky kz oq lb lc ld im bi translated">使用之前的<code class="fe nh ni nj nk b">api</code>对象，我们可以访问所有的账户信息:</p><pre class="lg lh li lj gt nl nk nm nn aw no bi"><span id="7a22" class="np nq it nk b gy nr ns l nt nu">acc = api.get_account()</span><span id="fa84" class="np nq it nk b gy os ns l nt nu">print(<br/>    f'The buying power is {acc.buying_power} {acc.currency} '<br/>    f'and the equity is {acc.equity} {acc.currency}\n'<br/>    f'The account status is {account.status}'<br/>)</span><span id="8bed" class="np nq it nk b gy os ns l nt nu">---------</span><span id="5a10" class="np nq it nk b gy os ns l nt nu">The buying power is 400000 USD and the equity is 100000 USD<br/>The account status is ACTIVE</span></pre><p id="c863" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还有呢！看一下使用API可以访问的账户的所有属性。</p><h2 id="df1a" class="np nq it bd nv nw nx dn ny nz oa dp ob kr oc od oe kv of og oh kz oi oj ok ol bi translated">获取数据并下订单</h2><blockquote class="nb nc nd"><p id="5608" class="ki kj le kk b kl km ju kn ko kp jx kq ne ks kt ku nf kw kx ky ng la lb lc ld im bi translated">“好吧，鲁本，这一切都很棒，但你能切入正题，告诉我如何使用这个或什么来买卖东西吗？”</p></blockquote><p id="11a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好吧，好吧。让我们开始精彩的部分。</p><p id="ecf9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要知道的第一件事是市场是否开放:</p><pre class="lg lh li lj gt nl nk nm nn aw no bi"><span id="59ee" class="np nq it nk b gy nr ns l nt nu">clock = api.get_clock()</span><span id="0b96" class="np nq it nk b gy os ns l nt nu">if clock.is_open:<br/>    print('Market is open')<br/>else:<br/>    print('Market is closed')</span></pre><p id="b2f3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很简单，对吧？然后我们可以继续检查所有资产的数据。Alpaca与五家交易所合作:ARCA、NYSE、AMEX、NASDAQ和BATS，提供每项资产的以下信息:</p><pre class="lg lh li lj gt nl nk nm nn aw no bi"><span id="0a9c" class="np nq it nk b gy nr ns l nt nu"># Get the list of all active assets<br/>active_assets = api.list_assets(status='active')</span><span id="fd20" class="np nq it nk b gy os ns l nt nu"># Let's check out one of them<br/>print(active_assets[0])</span><span id="16b8" class="np nq it nk b gy os ns l nt nu">---------</span><span id="0cbd" class="np nq it nk b gy os ns l nt nu">Asset({<br/>    'class': 'us_equity',<br/>    'easy_to_borrow': True,<br/>    'exchange': 'ARCA',<br/>    'id': '8649a606-050b-42ef-b8ad-8c5060827c29',<br/>    'marginable': True,<br/>    'name': 'AdvisorShares Dorsey Wright ADR ETF',<br/>    'shortable': True,<br/>    'status': 'active',<br/>    'symbol': 'AADR',<br/>    'tradable': True<br/>})</span></pre><p id="96fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nh ni nj nk b">tradable</code>属性表示资产是否可以在羊驼交易，而<code class="fe nh ni nj nk b">symbol</code>属性则是一个符号！</p><p id="bc57" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">知道了这一点，我们就可以检查特定资产的定价信息(注意，下面的代码几乎是从羊驼文档中摘录的！):</p><pre class="lg lh li lj gt nl nk nm nn aw no bi"><span id="c104" class="np nq it nk b gy nr ns l nt nu"># Get daily price data for GOOG over the last 5 trading days.<br/>barset = self._api.get_barset('GOOG', 'day', limit=5)<br/>bars = barset['GOOG']</span><span id="2c18" class="np nq it nk b gy os ns l nt nu"># See how much GOOG moved in that timeframe.<br/>week_open = bars[0].o<br/>week_close = bars[-1].c<br/>percent_change = (week_close - week_open) / week_open * 100<br/>print(f'GOOG moved {percent_change}% over the last 5 days')</span><span id="da48" class="np nq it nk b gy os ns l nt nu">---------</span><span id="3e75" class="np nq it nk b gy os ns l nt nu">GOOG moved -2.5682613899484377% over the last 5 days</span></pre><p id="0e1e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了这些信息，我们就可以决定是买入、持有还是卖出。这也很简单——同样，这些例子直接来自羊驼科医生。以市价购买一股谷歌股票的市场订单:</p><pre class="lg lh li lj gt nl nk nm nn aw no bi"><span id="55f1" class="np nq it nk b gy nr ns l nt nu">api.submit_order(<br/>    symbol='GOOG',<br/>    qty=1,<br/>    side='buy',<br/>    type='market',<br/>    time_in_force='gtc'<br/>)</span></pre><p id="0c3d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">开市时以特定价格(此处为2000美元)卖出一股谷歌股票的限价单:</p><pre class="lg lh li lj gt nl nk nm nn aw no bi"><span id="0edc" class="np nq it nk b gy nr ns l nt nu">api.submit_order(<br/>    symbol='GOOG',<br/>    qty=1,<br/>    side='sell',<br/>    type='limit',<br/>    time_in_force='opg',<br/>    limit_price=2000<br/>)</span></pre><p id="ccb8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">羊驼还允许您下达<a class="ae lv" href="https://alpaca.markets/docs/api-documentation/how-to/orders/" rel="noopener ugc nofollow" target="_blank">空头订单</a>、<a class="ae lv" href="https://alpaca.markets/docs/trading-on-alpaca/orders/#bracket-orders" rel="noopener ugc nofollow" target="_blank">括号订单</a>或<a class="ae lv" href="https://alpaca.markets/docs/trading-on-alpaca/orders/#trailing-stop-orders" rel="noopener ugc nofollow" target="_blank">追踪止损订单</a>等。</p><h2 id="aae2" class="np nq it bd nv nw nx dn ny nz oa dp ob kr oc od oe kv of og oh kz oi oj ok ol bi translated">检查投资组合</h2><p id="c4ba" class="pw-post-body-paragraph ki kj it kk b kl om ju kn ko on jx kq kr oo kt ku kv op kx ky kz oq lb lc ld im bi translated">为了获得我们拥有的资产的信息，我们需要调用<code class="fe nh ni nj nk b">list_positions</code>方法。对于特定的方法，我们可以使用<code class="fe nh ni nj nk b">get_position</code>，但是请记住，如果我们的投资组合中不存在该头寸，它将抛出<code class="fe nh ni nj nk b">APIError</code>异常。</p><pre class="lg lh li lj gt nl nk nm nn aw no bi"><span id="669d" class="np nq it nk b gy nr ns l nt nu"># All positions<br/>portfolio = api.list_positions()</span><span id="4957" class="np nq it nk b gy os ns l nt nu"># Position in GOOG.<br/>position = api.get_position('GOOG')</span></pre></div><div class="ab cl ot ou hx ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="im in io ip iq"><h1 id="f053" class="pa nq it bd nv pb pc pd ny pe pf pg ob jz ph ka oe kc pi kd oh kf pj kg ok pk bi translated">最后的想法</h1><p id="9af3" class="pw-post-body-paragraph ki kj it kk b kl om ju kn ko on jx kq kr oo kt ku kv op kx ky kz oq lb lc ld im bi translated">羊驼是开发人员的经纪人——或者更好，是编码人员的经纪人。它提供了一个简单而强大的API——足以完成我们想做的几乎任何事情。除此之外，纸质账户是一个方便的测试环境，可以在没有风险的情况下测试我们的策略。在使用真钱之前，记得要彻底测试一切，甚至寻求专业建议。交易不容易——如果容易，每个人都会变得富有！</p><p id="5312" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">和往常一样，你可以<a class="ae lv" href="https://github.com/ruromgar/python-ai-trading-system/blob/master/ai-trading-system/src/application/clients/alpaca_client.py" rel="noopener ugc nofollow" target="_blank">在GitHub里查看代码</a>。</p></div><div class="ab cl ot ou hx ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="im in io ip iq"><h1 id="d4b0" class="pa nq it bd nv pb pc pd ny pe pf pg ob jz ph ka oe kc pi kd oh kf pj kg ok pk bi translated">参考</h1><ol class=""><li id="0a8d" class="mn mo it kk b kl om ko on kr pl kv pm kz pn ld po mt mu mv bi translated">羊驼队，<a class="ae lv" href="https://alpaca.markets/docs/api-documentation/" rel="noopener ugc nofollow" target="_blank"> API文件</a>，羊驼队。</li><li id="71db" class="mn mo it kk b kl mw ko mx kr my kv mz kz na ld po mt mu mv bi translated">R.Romero，<a class="ae lv" href="https://towardsdatascience.com/how-to-create-a-fully-automated-ai-based-trading-system-with-python-708503c1a907" rel="noopener" target="_blank">如何用Python创建一个全自动的基于人工智能的交易系统</a> (2020)，中型</li></ol></div></div>    
</body>
</html>