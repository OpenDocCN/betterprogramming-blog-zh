<html>
<head>
<title>Increase your React + Redux Application Performance With the Reselect Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用重新选择库提高React + Redux应用程序的性能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/increase-your-react-redux-application-performance-with-reselect-library-3f4d632a08c5?source=collection_archive---------1-----------------------#2019-10-02">https://betterprogramming.pub/increase-your-react-redux-application-performance-with-reselect-library-3f4d632a08c5?source=collection_archive---------1-----------------------#2019-10-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d13e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用选择器从React和Redux应用程序中获得更多性能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2b8d162fcaddb5dcebcca9d17cd3798f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZxpnmBWVSOiNQByiTiFJjA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在Redux商店中选择我们州的所有猫狗</p></figure><p id="0c5a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">选择器是从redux存储中“选择”状态的便捷方式。Redux存储保存了我们所有的应用程序逻辑和数据；选择器用于从存储中挑选出特定的状态片段。</p><p id="e7d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您正在使用React和Redux构建应用程序，您可能会从选择器中受益。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="766a" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">选择器长什么样？</h1><p id="f1af" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">在我们深入了解为什么选择器如此方便以及如何使用它们之前，让我们看看没有它们的应用程序是什么样子。我已经创建了我们需要的最基本的东西——一个基本的Redux设置:</p><ul class=""><li id="7665" class="my mz it la b lb lc le lf lh na ll nb lp nc lt nd ne nf ng bi translated">我们有<code class="fe nh ni nj nk b">rootreducer</code>,它目前保存着我们动物的所有数据:</li></ul><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="4f29" class="np mc it nk b gy nq nr l ns nt">const initialState = {<br/>  data: [<br/>    {<br/>      name: "Milton",<br/>      type: "cat",<br/>      age: 4<br/>    },<br/>    {<br/>      name: "Sammy",<br/>      type: "dog",<br/>      age: 2<br/>    },<br/>    {<br/>      name: "Joseph",<br/>      type: "turtle",<br/>      age: 34<br/>    },<br/>    {<br/>      name: "Simon",<br/>      type: "dog",<br/>      age: 8<br/>    }<br/>  ]<br/>};<br/><br/>export default (state = initialState, action) =&gt; {<br/>  switch (action.type) {<br/>    default: {<br/>      return { ...state };<br/>    }<br/>  }<br/>};</span></pre><ul class=""><li id="ea01" class="my mz it la b lb lc le lf lh na ll nb lp nc lt nd ne nf ng bi translated">我们的<code class="fe nh ni nj nk b">rootreducer</code>被传递给商店，商店被传递给<code class="fe nh ni nj nk b">&lt;Provider&gt;</code></li><li id="e4ac" class="my mz it la b lb nu le nv lh nw ll nx lp ny lt nd ne nf ng bi translated">最后，<code class="fe nh ni nj nk b">PetsContainer.js</code>连接到商店，挑选动物，在数据中找到所有的狗，并将它们呈现在屏幕上。</li></ul><p id="00b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，假设我们想从商店里选择所有的狗，并把它们呈现在屏幕上，我们该怎么做呢？一种简单的方法应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/cc3cfc7ff3ac4f35e1f43ab85919c0b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2rYKFed1XATj75P1za_zQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从商店中挑选状态，过滤并找到所有的狗。</p></figure><p id="104d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意到什么奇怪的事了吗？我们在<code class="fe nh ni nj nk b">useSelector</code>回调中进行过滤。如果我们这样做不止一次，我们的应用程序会大大降低速度。更不用说这不是一段好看的代码。如果你熟悉Redux，你会知道我们有reducers来改变和存储状态，动作来触发状态改变。第三个缺失的谜题是选择器。选择器非常适合这里的情况，因为我们需要一种有效的方式从我们的存储中获取数据并呈现它。</p><p id="632f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:我们在这里结合Redux使用React钩子。如果<code class="fe nh ni nj nk b">useSelector</code>挂钩对你来说是新的，不要担心！这里有一篇关于它的文章。</p><div class="ob oc gp gr od oe"><a href="https://itnext.io/how-to-use-redux-with-react-hooks-5422a7ceae6e" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">如何将Redux与React挂钩一起使用</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">React Redux发布了7.1.0版本的钩子。这意味着我们可以使用React的最新最佳实践。</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">itnext.io</p></div></div><div class="on l"><div class="oo l op oq or on os ks oe"/></div></div></a></div></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="51de" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">添加重新选择库</h1><p id="2048" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">Reselect是Redux(以及其他)的一个简单的“选择器”库，灵感来自于<a class="ae oa" href="https://github.com/optimizely/nuclear-js.git" rel="noopener ugc nofollow" target="_blank">核</a>中的getters、<a class="ae oa" href="https://github.com/Day8/re-frame#just-a-read-only-cursor" rel="noopener ugc nofollow" target="_blank">订阅</a>中的<a class="ae oa" href="https://github.com/Day8/re-frame" rel="noopener ugc nofollow" target="_blank">重组</a>以及<a class="ae oa" href="https://github.com/speedskater" rel="noopener ugc nofollow" target="_blank"> speedskater </a>中的<a class="ae oa" href="https://github.com/reduxjs/redux/pull/169" rel="noopener ugc nofollow" target="_blank">提议</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/2f26aa7c7daed51b37b1db8bb57c72eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5pLfBmazkCyaQzDybUwzKw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">重新选择Github页面—<a class="ae oa" href="https://github.com/reduxjs/reselect" rel="noopener ugc nofollow" target="_blank">https://github.com/reduxjs/reselect</a></p></figure><p id="19ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是为什么在React和Redux应用程序中使用选择器是有意义的:</p><ul class=""><li id="1465" class="my mz it la b lb lc le lf lh na ll nb lp nc lt nd ne nf ng bi translated">选择器可以计算派生的数据，允许Redux存储最小可能的状态。</li><li id="06e3" class="my mz it la b lb nu le nv lh nw ll nx lp ny lt nd ne nf ng bi translated">选择器是高效的。除非选择器的一个参数发生更改，否则不会重新计算选择器。</li><li id="4274" class="my mz it la b lb nu le nv lh nw ll nx lp ny lt nd ne nf ng bi translated">选择器是可组合的。它们可以用作其他选择器的输入。</li></ul></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="3941" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">正在安装重新选择库</h1><p id="25c4" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">安装重选库很简单。您可以像安装任何其他NPM软件包一样安装它:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="a0e1" class="np mc it nk b gy nq nr l ns nt">yarn add reselect</span></pre><p id="887b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们有了库，让我们创建一个名为<code class="fe nh ni nj nk b">selectors.js</code>的新文件——这是我们存储所有关于选择器的逻辑的文件。接下来，从重新选择库中导入<code class="fe nh ni nj nk b">createSelector</code>方法:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="6e23" class="np mc it nk b gy nq nr l ns nt">import { createSelector } from "reselect";</span></pre><p id="2879" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了！现在我们可以使用<code class="fe nh ni nj nk b">createSelector</code>方法。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="45c1" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">创建您的第一个选择器</h1><p id="8de2" class="pw-post-body-paragraph ky kz it la b lb mt ju ld le mu jx lg lh mv lj lk ll mw ln lo lp mx lr ls lt im bi translated">选择器很容易理解。<code class="fe nh ni nj nk b">createSelector</code>需要多少参数就拿多少，关键是要明白最后一个参数是用来做过滤/选择的。假设我们想挑选所有的狗，这是我们传递给选择器的信息。</p><ul class=""><li id="c33b" class="my mz it la b lb lc le lf lh na ll nb lp nc lt nd ne nf ng bi translated">将所有宠物作为第一个参数传递给选择器，这些是依赖项。</li><li id="8613" class="my mz it la b lb nu le nv lh nw ll nx lp ny lt nd ne nf ng bi translated">最后一个参数始终是一个回调函数，参数作为之前传递的依赖项。</li></ul><p id="fc50" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是代码的样子:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="d87d" class="np mc it nk b gy nq nr l ns nt">import { createSelector } from "reselect";<br/><br/>const selectAllPets = state =&gt; state.pets.data;<br/><br/>export const selectAllDogs = createSelector(<br/>  selectAllPets,<br/>  allPets =&gt; allPets<br/>);</span></pre><p id="8f87" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，如果我们回到<code class="fe nh ni nj nk b">PetsContainer</code>，我们可以导入<code class="fe nh ni nj nk b">selectAllDogs</code>选择器并将其传递给<code class="fe nh ni nj nk b">useSelector</code> redux挂钩:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/87f6489279de97139d9e45f06cc0c505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZGEp0XnaYXGytCDs901hZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将选择器传递给useSelector钩子</p></figure><p id="f6cb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，我们现在正在让所有的宠物返回。这是因为这正是我们在选择器中所做的。为了返回所有的狗，我们需要在选择器中应用过滤逻辑:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/dc82b2d159b3190edbea8ca942a58b2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0P0X-K6S-q1GFxlohpzmow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对选择器应用过滤逻辑</p></figure><p id="1e67" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意我们现在得到了所有的狗。我们只是渲染狗，而不是在组件内部进行过滤。这是减轻组件负担的好方法。请记住，React组件擅长呈现标记，其他一切都应该在其他地方完成，以减少代码混乱和关注点分离。</p><p id="780e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们甚至可以将选择器作为参数传递给其他选择器。我们如何从商店里挑选所有的狗和猫呢？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/73efc143feab838e5e56e6199a6067f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jAFOHlQDl9keENlJGW6Y7A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">像热土豆一样传递选择器</p></figure><ul class=""><li id="5291" class="my mz it la b lb lc le lf lh na ll nb lp nc lt nd ne nf ng bi translated">首先，我们得到所有的宠物。</li><li id="c596" class="my mz it la b lb nu le nv lh nw ll nx lp ny lt nd ne nf ng bi translated">一旦我们有了所有的宠物，我们就可以过滤找到所有的狗和猫。</li><li id="ce6b" class="my mz it la b lb nu le nv lh nw ll nx lp ny lt nd ne nf ng bi translated">一旦我们选择了所有的狗和猫，我们就通过将选择器作为参数传递来将它们合并到一个选择器中。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/dd1c9be731729a19f876f90b0c50baff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1yH8L1bFtsZU9AuPLNPBkw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">渲染猫和狗</p></figure><p id="8d7b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就对了——漂亮而简单的React组件。请记住，选择器结果是记忆的，这意味着结果存储在内存中，并且将始终返回相同的结果，除非结果发生变化。这极大地提高了性能。如果你对结果是如何被记忆的感到好奇，<a class="ae oa" href="https://stackoverflow.com/a/53070891/5073961" rel="noopener ugc nofollow" target="_blank">阅读这篇StackOverflow帖子</a>进行深入分析。</p><div class="ob oc gp gr od oe"><a href="https://stackoverflow.com/a/53070891/5073961" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">Redux重选记忆化是如何工作的？</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">所以我们有这个选择器来获取VisibleTodoList组件的状态:const mapStateToProps = (state，props) =&gt; {…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">stackoverflow.com</p></div></div><div class="on l"><div class="oy l op oq or on os ks oe"/></div></div></a></div><p id="0bb8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想进一步优化你的代码，<a class="ae oa" href="https://medium.com/better-programming/5-react-performance-tips-f6e65295fba5" rel="noopener">看看我以前的React性能技巧</a>。</p><div class="ob oc gp gr od oe"><a href="https://medium.com/better-programming/5-react-performance-tips-f6e65295fba5" rel="noopener follow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">这些技巧将提升React代码的性能</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">从2500毫秒到1500毫秒的等待时间会对你的UX和转化率产生巨大的影响</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">medium.com</p></div></div><div class="on l"><div class="oz l op oq or on os ks oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://developer.mastercard.com/blog/common-reselect-gotchas" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">常见的重选陷阱</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">Reselect是一个经常和Redux一起使用的记忆库。如果你不熟悉这些库的基础知识，我会…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">developer.mastercard.com</p></div></div><div class="on l"><div class="pa l op oq or on os ks oe"/></div></div></a></div><p id="d0f4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想玩选择器，这里有代码沙箱和源代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="3c4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你是JavaScript新手，想学习这门语言，我建议你从阅读书籍和构建东西开始。从《<a class="ae oa" href="https://amzn.to/2LOkzjj" rel="noopener ugc nofollow" target="_blank"> <em class="pd">一种更聪明的学习JavaScript的方法</em> </a>》一书开始，这里有一个有趣的应用程序列表，可以用来构建。</p><p id="d9e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读，编码快乐。</p></div></div>    
</body>
</html>