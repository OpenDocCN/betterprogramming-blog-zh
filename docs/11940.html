<html>
<head>
<title>Configuring Dexie.js in an Angular Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在角度项目中配置Dexie.js</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/configure-dexie-js-in-angular-project-1e2174a846cf?source=collection_archive---------4-----------------------#2022-04-28">https://betterprogramming.pub/configure-dexie-js-in-angular-project-1e2174a846cf?source=collection_archive---------4-----------------------#2022-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1a38" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">js是IndexedDB的极简包装器</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/caa17934641b71be4afc4e5aededa5f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YBCEY3jNNuVOpbOG"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@halacious?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">哈尔·盖特伍德</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h1 id="7b25" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">索引b</h1><p id="8e00" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">IndexedDB是最流行的浏览器内(客户端)数据库。它以键值格式存储数据。它极大地简化了数据库版本控制任务。这里，表/关系通常被称为<em class="mk">对象存储</em>(或简称为<em class="mk">存储</em>)。我们可以为对象存储创建索引来加速查询。</p><p id="102d" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">它使用客户端机器上的存储来存储其数据库，因此其存储限制取决于通常具有高容量的客户端机器。</p><p id="bccf" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">IndexedDB API是可用的，通常由Javascript访问。然而，为了扩大它的范围，简化过程和增加特性，可以使用几个包装器和节点包。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="d2de" class="kw kx iq bd ky kz mx lb lc ld my lf lg jw mz jx li jz na ka lk kc nb kd lm ln bi translated">Dexie.js</h1><p id="4885" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Dexie.js是IndexedDB的极简包装器。使用IndexedDB是一种简单的方法，可以轻松集成多个前端框架。</p><p id="bef2" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">Dexie.js API减少了样板代码，并在查询格式方面提供了更大的变化。这是一个有良好文档记录的API，可以作为节点包安装。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h2 id="ae11" class="nc kx iq bd ky nd ne dn lc nf ng dp lg lx nh ni li mb nj nk lk mf nl nm lm nn bi translated">安装Dexie.js</h2><ol class=""><li id="42b4" class="no np iq lq b lr ls lu lv lx nq mb nr mf ns mj nt nu nv nw bi translated">打开命令提示符。</li><li id="cad5" class="no np iq lq b lr nx lu ny lx nz mb oa mf ob mj nt nu nv nw bi translated">移动到angular项目父目录。</li><li id="3ce3" class="no np iq lq b lr nx lu ny lx nz mb oa mf ob mj nt nu nv nw bi translated">运行以下命令通过npm安装dexie.js</li></ol><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="64e6" class="nc kx iq od b gy oh oi l oj ok">npm i dexie</span></pre></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h2 id="920d" class="nc kx iq bd ky nd ne dn lc nf ng dp lg lx nh ni li mb nj nk lk mf nl nm lm nn bi translated">在Angular中为Dexie.js创建服务</h2><ol class=""><li id="a0c3" class="no np iq lq b lr ls lu lv lx nq mb nr mf ns mj nt nu nv nw bi translated">打开命令提示符。</li><li id="0b58" class="no np iq lq b lr nx lu ny lx nz mb oa mf ob mj nt nu nv nw bi translated">移动到angular项目父目录。</li><li id="56f5" class="no np iq lq b lr nx lu ny lx nz mb oa mf ob mj nt nu nv nw bi translated">运行以下命令创建一个名为<code class="fe ol om on od b">db</code>的服务:</li></ol><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="bd8f" class="nc kx iq od b gy oh oi l oj ok">ng generate service db</span></pre><p id="c9b6" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">或者</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="731c" class="nc kx iq od b gy oh oi l oj ok">ng g s db</span></pre><p id="70bf" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">将在angular项目的<code class="fe ol om on od b">src/app</code>文件夹中创建两个新文件。</p><ul class=""><li id="c959" class="no np iq lq b lr ml lu mm lx oo mb op mf oq mj or nu nv nw bi translated"><code class="fe ol om on od b">db.service.spec.ts</code></li><li id="34aa" class="no np iq lq b lr nx lu ny lx nz mb oa mf ob mj or nu nv nw bi translated"><code class="fe ol om on od b">db.service.ts</code></li></ul><p id="d841" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">db.service.ts将进一步包含配置、数据库、存储(表)、键等的代码。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h2 id="9e94" class="nc kx iq bd ky nd ne dn lc nf ng dp lg lx nh ni li mb nj nk lk mf nl nm lm nn bi translated">角度服务中的Dexie.js配置</h2><ol class=""><li id="e49b" class="no np iq lq b lr ls lu lv lx nq mb nr mf ns mj nt nu nv nw bi translated"><code class="fe ol om on od b">db.service.ts</code>进口德协</li></ol><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="770b" class="nc kx iq od b gy oh oi l oj ok">import Dexie from 'dexie';</span></pre><p id="2817" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">2.创建一个名为<code class="fe ol om on od b">DbService</code>的类，并继承<code class="fe ol om on od b">Dexie</code>类:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="e1ae" class="nc kx iq od b gy oh oi l oj ok">export class DbService extends Dexie {....}</span></pre><p id="b61f" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">3.创建一个构造函数(使用<code class="fe ol om on od b">constructor</code>方法)并调用<code class="fe ol om on od b">super</code>方法，将数据库的名称作为参数(这里是<code class="fe ol om on od b">DexieDB</code>)。构造函数是类的对象一创建就执行的函数。它用于初始化类的成员变量，并有一些扩展的用法。<code class="fe ol om on od b">super</code>方法用于调用继承类的构造函数(这里是<code class="fe ol om on od b">Dexie</code>)。传递给超方法的参数最终会传递给继承类的构造函数。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="2179" class="nc kx iq od b gy oh oi l oj ok">constructor() {<br/>    super("DexieDB");<br/>    ....<br/>    ....<br/>    ....<br/>}</span></pre><p id="0d7a" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">4.使用Dexie的<code class="fe ol om on od b">version</code>方法定义数据库的版本(这里版本号设为1)并列出所有的存储(表)。虽然IndexedDB是无模式的，但是Dexie.js要求我们预先定义所有字段(<code class="fe ol om on od b">columns</code>)作为主键(或者简单地称为<code class="fe ol om on od b">key</code>或<code class="fe ol om on od b">indices</code>)(我们可能会在以后的查询、搜索、排序中使用)。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="5829" class="nc kx iq od b gy oh oi l oj ok">this.version(1).stores({<br/>    myStore1: '++empId, empName, empSal',<br/>    myStore2: 'compId, compName'<br/>});</span></pre><p id="58ee" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这里，创建了两个名为<code class="fe ol om on od b">myStore1</code>和<code class="fe ol om on od b">myStore2</code>的商店(表)。在<code class="fe ol om on od b">myStore1</code>中，<code class="fe ol om on od b">empId</code>为主键，<strong class="lq ir"> <em class="mk"> ++ </em> </strong>定义为从整数<em class="mk"> 1 </em>开始自动递增。<code class="fe ol om on od b">empName</code>和<code class="fe ol om on od b">empSal</code>是<code class="fe ol om on od b">myStore1</code>的字段，稍后将在应用程序中用于查询、搜索、排序(索引/多个索引)。在<code class="fe ol om on od b">myStore2</code>中，<code class="fe ol om on od b">compId</code>是主键，<code class="fe ol om on od b">compName</code>字段稍后将用于查询、搜索和排序(索引/多个索引)。</p><p id="f6c6" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">5.数据库已创建，但仍需要打开才能进行操作。为此使用Dexie的<code class="fe ol om on od b">open</code>方法。它返回一个承诺，该承诺可用于不同的目的，如填充数据库、用数据库中的记录初始化应用程序等。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="9bc6" class="nc kx iq od b gy oh oi l oj ok">this.open()<br/>.then(data =&gt; console.log("DB Opened"))<br/>.catch(err =&gt; console.log(err.message));</span></pre><p id="9d8a" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">如果数据库成功打开，将执行<code class="fe ol om on od b">then</code>块。如果出现任何错误，将执行<code class="fe ol om on od b">catch</code>程序块。</p><p id="4cb9" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">最终的代码看起来会像这样-</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="os ot l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">db . service . ts(Angular项目中的Dexie.js配置)</p></figure></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h2 id="eb6a" class="nc kx iq bd ky nd ne dn lc nf ng dp lg lx nh ni li mb nj nk lk mf nl nm lm nn bi translated">访问Angular项目组件中的Dexie.js存储(表)</h2><ol class=""><li id="a74f" class="no np iq lq b lr ls lu lv lx nq mb nr mf ns mj nt nu nv nw bi translated">在<em class="mk">中。组件的ts </em>文件，只需导入在<code class="fe ol om on od b">db.service.ts</code>中创建的类，即<code class="fe ol om on od b">DbService</code>类:</li></ol><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="ec53" class="nc kx iq od b gy oh oi l oj ok">import { DbService } from 'db.service';</span></pre><p id="0a27" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">2.在组件类的构造函数中创建一个<code class="fe ol om on od b">DbService</code>类的对象。</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="478a" class="nc kx iq od b gy oh oi l oj ok">....<br/>....<br/>    constructor(private db: DbService) {}<br/>....<br/>....</span></pre><p id="5d09" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">所有的<code class="fe ol om on od b">dexie.js</code> API方法(添加、获取、上传、更新、删除、where等)都可以被这个对象访问。</p><p id="5676" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">3.运行以下代码，在<code class="fe ol om on od b">myStore1</code>商店(表)中添加一条新记录:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="cb08" class="nc kx iq od b gy oh oi l oj ok">addRecord(): void {<br/>    this.db.table('myStore1')<br/>    .add({empName: 'Mohit Kushwaha', empSal: 1000})<br/>    .then(data =&gt; console.log(data))<br/>    .catch(err =&gt; console.log(err.message));<br/>}</span></pre><p id="5db8" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">因为主键<code class="fe ol om on od b">empId</code>是自动递增的，所以我们不需要提供它。它会自动生成。以类似的方式，可以执行所有其他操作。</p><p id="7952" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">要了解更多关于IndexedDB的信息，请访问网站<a class="ae kv" href="https://www.w3.org/TR/IndexedDB/" rel="noopener ugc nofollow" target="_blank">这里</a>。要了解更多关于<code class="fe ol om on od b">dexie.js</code>的信息，请访问官方网站<a class="ae kv" href="https://dexie.org/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>