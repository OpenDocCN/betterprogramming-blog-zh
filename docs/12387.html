<html>
<head>
<title>Getting Started With Basketry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始使用Basketry</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-basketry-fceeb5316ad7?source=collection_archive---------16-----------------------#2022-06-01">https://betterprogramming.pub/getting-started-with-basketry-fceeb5316ad7?source=collection_archive---------16-----------------------#2022-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="82ed" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">任何语言的代码生成</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/94f9ef14c2c7ed3187910a8d24503f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qileWlYj7DQe3I08"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@andreacarole?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">安德里亚·斯库利</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="2f77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Basketry是任何语言的可插拔的、面向服务的代码生成管道。<a class="ae kv" href="https://medium.com/@stevekonves/list/basketry-70b223946fc9" rel="noopener">在Github </a>上阅读更多关于basketh和<a class="ae kv" href="https://github.com/basketry/basketry/wiki" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="eee4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本指南将从Swagger宠物店的例子开始，一步一步地引导您生成新的服务。</p><h1 id="58d3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">先决条件</h1><p id="2d8d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果您还没有，请继续阅读<a class="ae kv" href="https://medium.com/@stevekonves/introducing-basketry-3ff2861a7730" rel="noopener">介绍篮筐</a>。它给出了一个完整的解释，什么是篮筐，它解决什么类型的问题。它还涵盖了将在指南中出现的所有与Basketry相关的术语，比如服务定义、解析器、规则、生成器和中间表示。</p><p id="5370" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将讨论安装包以及创建和运行脚本。本指南假设您已经掌握了NPM或纱线的应用知识，并且知道如何使用首选的包装管理器来执行这些操作。</p><p id="7f7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们将使用Typescript构建我们的服务。本指南假设您熟悉如何设置新项目，或者可以访问现有项目。如果您想使用我个人用于新项目的Typescript项目搭建工具，请查看我的<a class="ae kv" href="https://www.npmjs.com/package/generator-ts-console" rel="noopener ugc nofollow" target="_blank"> Yeoman generator </a>。</p><h1 id="3b24" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">初始设置</h1><h2 id="b837" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">获取服务定义</h2><p id="87fe" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们从下载一个现有的服务定义开始。Swagger.io提供了一个示例Swagger文档，它定义了一个示例宠物店服务:<a class="ae kv" href="https://petstore.swagger.io/v2/swagger.json" rel="noopener ugc nofollow" target="_blank">https://petstore.swagger.io/v2/swagger.json</a>。下载文件名为<code class="fe nb nc nd ne b">swagger.json</code>的文件，并将其放在项目的根文件夹中。</p><h2 id="7b9d" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">安装软件包</h2><p id="6c43" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">首先安装以下软件包:</p><ul class=""><li id="b966" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated"><code class="fe nb nc nd ne b">basketry</code></li><li id="326d" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><code class="fe nb nc nd ne b">@basketry/swagger-2</code></li><li id="48c1" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated"><code class="fe nb nc nd ne b">@basketry/typescript</code></li></ul><p id="9909" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个包包含通过<code class="fe nb nc nd ne b">basketry</code>命令的Basketry CLI。有两种方法可以使用CLI。首先，您可以将所有项目选项作为参数直接传递给CLI。有关这些参数的详细信息，请参见存储库中的自述文件。其次，你可以在项目的根目录下添加一个<code class="fe nb nc nd ne b">basketry.config.json</code>文件，然后不带任何参数地运行<code class="fe nb nc nd ne b">basketry</code>。我们将在本指南中使用配置文件。</p><p id="cdb8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二个包是Swagger 2.0文档的解析器。这个包导出一个默认模块，该模块接受原始的Swagger doc并输出服务的中间表示(IR)。</p><p id="189c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一个包是生成器，它获取IR并输出一个<code class="fe nb nc nd ne b">types.ts</code>文件，该文件包含实现宠物店服务所需的所有接口、类型和枚举。</p><h2 id="a06a" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">创建脚本</h2><p id="c7b5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在<code class="fe nb nc nd ne b">package.json</code>中创建以下脚本来运行Basketry CLI:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="2f48" class="mp lt iq ne b gy nx ny l nz oa">{<br/>  "scripts": {<br/>    "basketry": "basketry",<br/>    "watch:basketry": "basketry --watch"<br/>  }<br/>}</span></pre><p id="bc61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们运行<code class="fe nb nc nd ne b">basketry</code>脚本时，Basketry CLI将查找一个<code class="fe nb nc nd ne b">basketry.config.json</code>文件，以了解使用什么解析器和生成器以及在哪里可以找到Swagger文档。接下来让我们创建它。</p><h2 id="3273" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">创建配置文件</h2><p id="5883" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">将下面的<code class="fe nb nc nd ne b">basketry.config.json</code>文件添加到项目的根目录中:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="bbea" class="mp lt iq ne b gy nx ny l nz oa">{<br/>  "source": "swagger.json",<br/>  "parser": "@basketry/swagger-2",<br/>  "generators": ["@basketry/typescript"],<br/>  "output": "src/petstore"<br/>}</span></pre><p id="ec9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来看看这些设置的作用。</p><p id="f7da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，<code class="fe nb nc nd ne b">source</code>让Basketry知道我们想从哪里加载我们的服务定义。如果您想将<code class="fe nb nc nd ne b">swagger.json</code>重命名为其他名称，请确保在配置中也反映出名称的变化。</p><p id="a9de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，<code class="fe nb nc nd ne b">parser</code>让Basketry知道使用什么模块将Swagger文档解析成IR。管道的其余部分不知道最初的服务定义语言(SDL)是Swagger——生成器(以及我们添加它们时的规则)可以与任何源语言一起工作。为此，我们需要选择一个理解SDL的解析器，这就是我们安装<code class="fe nb nc nd ne b">@basketry/swagger-2</code>的原因。</p><p id="34a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">继续，<code class="fe nb nc nd ne b">generators</code>让Basketry知道如何将IR转换成代码文件。我们可以添加任意多的发电机。首先，我们将只使用<code class="fe nb nc nd ne b">@basketry/typescript</code>。我们将在后面的指南中添加更多内容。</p><p id="6f3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，<code class="fe nb nc nd ne b">output</code>指定我们希望Basketry将生成的文件放在哪里。一些生成器可能会在子文件夹中写入文件；然而，<code class="fe nb nc nd ne b">output</code>文件夹将是所有生成内容的根目录。</p><p id="1676" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于配置文件的更多信息，请参考Basketry wiki。</p><h2 id="db28" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">生成一些代码！</h2><p id="f070" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在运行<code class="fe nb nc nd ne b">basketry</code>命令:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/d3f720b512a5b1d33737ee8c3bdb6473.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*YTPIUiw6fQOPJljFKo-k5A.png"/></div></figure><p id="ee76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以看到它生成了<code class="fe nb nc nd ne b">types.ts</code>。您的项目现在将包含(至少)以下文件:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="b205" class="mp lt iq ne b gy nx ny l nz oa">basketry-example/<br/> ├─ node_modules/<br/> ├─ src/<br/> │  ├─ petstore/<br/> │  │  ├─ v1/<br/> │  │  │  ├─ types.ts<br/> │  ├─ .gitattributes<br/> ├─ basketry.config.json<br/> ├─ package.json<br/> ├─ swagger.json</span></pre><p id="2b9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意<code class="fe nb nc nd ne b">types.ts</code>在一个<code class="fe nb nc nd ne b">v1</code>文件夹中。这是因为Swagger doc有一个版本的<code class="fe nb nc nd ne b">1.0.6</code>(参见<code class="fe nb nc nd ne b">info</code>对象)并且Basketry跟踪源服务的主要版本。正如我们在这里看到的，<code class="fe nb nc nd ne b">@basketry/typescript</code>使用该版本号将文件写入特定于版本的文件夹。</p><p id="7c45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而且就是这么简单！此时，我们有了一个描述我们的宠物店的Swagger文档，然后我们设置Basketry为我们的服务生成Typescript类型。</p><h1 id="89a6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">实施API设计指南</h1><p id="f9fe" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">设计指南有助于在单个服务内部以及由多个团队拥有和维护的多个服务之间提供一致性。这种一致性改善了开发人员的体验，并随着API的成长和成熟而促进了增量更改。</p><p id="c26e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Basketry规则提供了一种简单的方法来将API治理的这个方面添加到您的项目中。</p><h2 id="9822" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">添加标准规则</h2><p id="4e45" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Basketry提供了一套标准规则来帮助您入门。</p><p id="9c42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，安装软件包<code class="fe nb nc nd ne b">@basketry/rules</code>。</p><p id="b1e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，让我们将“字符串ID”规则添加到配置文件中:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="0787" class="mp lt iq ne b gy nx ny l nz oa">{<br/>  "source": "swagger.json",<br/>  "parser": "@basketry/swagger-2",<br/>  "rules": ["@basketry/rules/lib/string-id"],<br/>  "generators": ["@basketry/typescript"],<br/>  "output": "src/petstore"<br/>}</span></pre><p id="4352" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，当我们运行<code class="fe nb nc nd ne b">basketry</code>脚本时，我们会看到以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/7bd4616a6f528916b0389e0d4060d33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*y85YkltnlWZqD2OgEfD8mQ.png"/></div></figure><p id="ca2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个输出让我们知道我们的Swagger doc在五个地方违反了“basketry/string-id”规则。错误输出显示了违反了什么规则、文件路径以及违反的位置，以帮助我们进行修复。</p><p id="a66b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于上下文,“字符串ID”规则要求任何名为<code class="fe nb nc nd ne b">id</code>的属性必须是字符串。(出于安全原因，该规则通常用于要求非顺序id。)</p><p id="976b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们发现了一些违规，让我们回到Swagger doc，找到第一个违规，然后进行更改</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="6f59" class="mp lt iq ne b gy nx ny l nz oa">{ "type": "integer", "format": "int64" }</span></pre><p id="5f2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">收件人:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="5ad5" class="mp lt iq ne b gy nx ny l nz oa">{ "type": "string", "minLength": 12 }</span></pre><p id="1d33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并重新运行<code class="fe nb nc nd ne b">basketry</code>脚本:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/654e511dc3180a0353ce1364be296b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*NOshqZr4o1KrlflnIF31nA.png"/></div></figure><p id="3a6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，我们修复了第一个违规，我们的<code class="fe nb nc nd ne b">types.ts</code>文件已经更新以反映这一变化。</p><p id="b21b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们对剩余的ID属性进行同样的更改，我们应该看到所有的违规都被清除了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/336f8860fa49fad2ee5a2abc701c2c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*V6mffRDHQIoB2t9j5YJsog.png"/></div></figure><h2 id="eec9" class="mp lt iq bd lu mq mr dn ly ms mt dp mc lf mu mv me lj mw mx mg ln my mz mi na bi translated">设置规则选项</h2><p id="091f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们添加标准集中的<code class="fe nb nc nd ne b">description</code>规则，以确保我们向所有内容添加描述:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="59f4" class="mp lt iq ne b gy nx ny l nz oa">{<br/>  "source": "swagger.json",<br/>  "parser": "@basketry/swagger-2",<br/>  "rules": [<br/>    "@basketry/rules/lib/string-id",<br/>    "@basketry/rules/lib/type-description"<br/>  ],<br/>  "generators": ["@basketry/typescript"],<br/>  "output": "src/petstore"<br/>}</span></pre><p id="49a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">错误太多了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/1352299b3c23f03d585fa0d3f7a9435b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*AxFneepv5stkd_5tBZYPbA.png"/></div></figure><p id="0442" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以将一些选项传递给规则，以某种方式修改它们的行为:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="ca79" class="mp lt iq ne b gy nx ny l nz oa">{<br/>  "source": "swagger.json",<br/>  "parser": "@basketry/swagger-2",<br/>  "rules": [<br/>    "@basketry/rules/lib/string-id",<br/>    {<br/>      "rule": "@basketry/rules/lib/description",<br/>      "options": { "severity": "warning" }<br/>    }<br/>  ],<br/>  "generators": ["@basketry/typescript"],<br/>  "output": "src/petstore"<br/>}</span></pre><p id="1865" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，所有的“描述”违规都被报告为警告而不是错误。各种规则允许不同的选项，因此查看<a class="ae kv" href="https://github.com/basketry/rules#readme" rel="noopener ugc nofollow" target="_blank">篮筐规则</a>以获得完整的可用规则及其各自的选项。</p><p id="a426" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以随时参考<a class="ae kv" href="https://github.com/basketry/basketry/wiki" rel="noopener ugc nofollow" target="_blank"> Basketry wiki </a>获取更多的文档和指南。</p></div><div class="ab cl oe of hu og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="ij ik il im in"><p id="cff6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是如何开始编织篮子！</p><p id="0aef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢你看到的，让我知道。如果你认为我值得拥有一个⭐，那就把它加入篮子库吧。</p></div></div>    
</body>
</html>