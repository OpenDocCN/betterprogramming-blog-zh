<html>
<head>
<title>A Best Practice Setup for Git Hooks and ESLint</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Git挂钩和ESLint的最佳实践设置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/best-practice-setup-git-hook-and-eslint-for-teams-and-mono-repositories-8e7bf474f4a7?source=collection_archive---------10-----------------------#2020-02-20">https://betterprogramming.pub/best-practice-setup-git-hook-and-eslint-for-teams-and-mono-repositories-8e7bf474f4a7?source=collection_archive---------10-----------------------#2020-02-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bad4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对于拥有JavaScript/TypeScript mono存储库的团队</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9eb533b2c3b69a29113385b608991418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*58Rbz27TFczdT-ta"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@max_duz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Max Duzij </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="3bae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您正在设置一个由JavaScript/TypeScript项目组成的mono-repo，并且希望与您的团队一起工作，那么您需要正确地设置ESLint。</p><p id="5af0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">已经有像<a class="ae ky" href="https://www.npmjs.com/package/husky" rel="noopener ugc nofollow" target="_blank"> husky </a>和<a class="ae ky" href="https://www.npmjs.com/package/lint-staged" rel="noopener ugc nofollow" target="_blank"> lint-staged </a> <em class="lv"> </em>这样的工具可以用来在git挂钩上设置ESLint，但是对于mono库，<em class="lv"> </em>这些工具在子目录中无法正常工作。</p><p id="2f16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个快速教程，介绍如何在mono-repo中设置预提交git挂钩，以及如何确保团队中的每个人都拥有控制权，从而获得一致的ESLint体验。</p><p id="1b59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们要复习的内容:</p><ul class=""><li id="4bf3" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">在每个TypeScript/JavaScript项目中设置ESLint。</li><li id="06f8" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">设置git挂钩脚本。</li><li id="ea61" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">创建一个团队中每个开发人员第一次使用的init脚本。</li><li id="c93b" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">使脚本文件可执行。</li><li id="67ed" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">把一切都推到远处。</li></ul><p id="4b7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个<a class="ae ky" href="https://github.com/sunnystatue/githook-monorepo-example" rel="noopener ugc nofollow" target="_blank"> GitHub链接</a>是一个示例库，在这里您可以在一个地方获得所有内容。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="3869" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">在每个TypeScript/JavaScript项目中设置ESLint</h1><p id="7a84" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">下面是我们代码库的结构，它由不同的TypeScript/JavaScript项目组成:</p><ul class=""><li id="5ec2" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">后端</li><li id="1698" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">前端</li><li id="c459" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">共享库等。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/47779d82e948caf6f845693d303db3b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*VFJi68K2vTSLHX2vIxtY7Q.png"/></div></figure><p id="2bb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在每个项目中，我们都创建了一个包含ESLint配置的<code class="fe np nq nr ns b">.eslintrc.js</code>文件。在<code class="fe np nq nr ns b">package.json</code> <strong class="lb iu">，</strong>中，我们将会有一个脚本来运行ESLint的那个项目或者子目录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/4aca496d45c5b5b3ea9f87a4cc5a37d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*93OEoHDQJurdNAwa1s16OA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/sunnystatue/githook-monorepo-example/blob/master/frontend/.eslintrc.js" rel="noopener ugc nofollow" target="_blank">https://github . com/sunny statue/git hook-monorepo-example/blob/master/frontend/. eslintrc . js</a></p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/96a31d8a4d989c3b1a324caff4ac36b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*6xJI2uOxG0vx1g7JVYSeKg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/sunnystatue/githook-monorepo-example/blob/master/frontend/package.json" rel="noopener ugc nofollow" target="_blank">https://github . com/sunny statue/git hook-monorepo-example/blob/master/frontend/package . JSON</a></p></figure><p id="c225" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过在<code class="fe np nq nr ns b">package.json</code>中添加那个<code class="fe np nq nr ns b">lint</code> <strong class="lb iu"> </strong>脚本，我们使我们的预提交git钩子脚本能够使用本地项目规格运行ESLint，并独立使用每个项目的<code class="fe np nq nr ns b">node_modules</code> <strong class="lb iu"> </strong>。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="0825" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">设置提交前Git挂钩脚本</h1><p id="d5f2" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">整个事情的目的很简单:当团队中的开发人员决定向stage添加一个文件，然后提交它时，我们在提交过程之前运行ESLint，以确保每个人都提交了高质量的代码。</p><p id="8b67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得一提的是git存储库中钩子的概念。如果你打开<code class="fe np nq nr ns b">.git/hooks</code>文件夹，你会看到不同类型挂钩的不同样品列表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/9b0f998517797cadc1b5718b422068ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0ZypC6zBy2F9IEHDoe1DQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">。git/挂钩</p></figure><p id="72e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建了一个单独的文件夹，并在我们名为<code class="fe np nq nr ns b">git-hooks</code>的代码库中更改了默认的钩子文件夹，以保持钩子在团队中可共享。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/34d5cd7fed4fdc3e10cc24f685737115.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*7hi0kv6holYbIa_N0fHFYA.png"/></div></figure><p id="7b6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们创建预提交，<strong class="lb iu"> </strong>，它将保持我们的提交逻辑。下面是后端部分代码，它与前端代码非常相似:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/d919d77b25dece01de5eb357b83c3158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2MumlhSpXY_7MHKg37izQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/sunnystatue/githook-monorepo-example/blob/master/git-hooks/pre-commit" rel="noopener ugc nofollow" target="_blank">https://github . com/sunny statue/git hook-monorepo-example/blob/master/git-hooks/pre-commit</a></p></figure><p id="9545" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们正在做的事情:</p><ul class=""><li id="b158" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">列出存放在<code class="fe np nq nr ns b">backend/src</code> <strong class="lb iu"> </strong>文件夹中的文件。他们是<code class="fe np nq nr ns b">(js|jsx|tsx|ts)</code>之一。</li><li id="d31d" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">移除前缀<code class="fe np nq nr ns b">backend/src</code>并修复路径字符串。</li><li id="c29c" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">使用<code class="fe np nq nr ns b">--fix</code> <strong class="lb iu"> </strong>选项对这些文件运行后端ESLint。</li><li id="ac7e" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">试图为那些已经修复的人再次登台。</li><li id="ef9b" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">如果ESLint结果未能修复所有错误，我们不提交就退出提交，并打印一条消息告诉开发人员他们需要修复一些东西。</li><li id="2bfc" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">前端基本上是一样的。</li></ul><p id="8eae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们需要一个init脚本作为初始触发器来设置一切。这个脚本文件只包含一行:</p><pre class="kj kk kl km gt ny ns nz oa aw ob bi"><span id="393a" class="oc ms it ns b gy od oe l of og">git config core.hooksPath ./git-hooks</span></pre><p id="6808" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这告诉git为钩子寻找<strong class="lb iu"> </strong> <code class="fe np nq nr ns b">./git-hooks</code>。</p><p id="e908" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。是不是很奇妙？</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="7b1b" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">使脚本文件可执行</h1><p id="e975" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在唯一剩下的事情就是让预提交和初始化<strong class="lb iu"> </strong>文件可执行。不然就不行了。为此，我们运行以下命令:</p><pre class="kj kk kl km gt ny ns nz oa aw ob bi"><span id="b02e" class="oc ms it ns b gy od oe l of og">chmod +x git-hooks/pre-commit</span><span id="6a75" class="oc ms it ns b gy oh oe l of og">chmod +x git-hooks/init</span><span id="09bc" class="oc ms it ns b gy oh oe l of og">git add .</span><span id="179c" class="oc ms it ns b gy oh oe l of og"># make these files executable in git</span><span id="8df0" class="oc ms it ns b gy oh oe l of og">update-index --chmod=+x git-hooks/pre-commit</span><span id="c180" class="oc ms it ns b gy oh oe l of og">update-index --chmod=+x git-hooks/init</span><span id="5db0" class="oc ms it ns b gy oh oe l of og">git commit -m"make init and pre-commit executable"</span></pre></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="0fcc" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">将一切推向远程</h1><p id="e0c8" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在这个阶段，一切都准备好了。如果你从另一个目录或机器拉，唯一要做的就是运行<code class="fe np nq nr ns b">./git-hooks/init</code>。然后，每当开发人员在<code class="fe np nq nr ns b">(js|jsx|tsx|ts)</code> <strong class="lb iu"> </strong>文件中做出更改并试图提交时，ESLint就会针对该文件运行。</p><p id="ba9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个<a class="ae ky" href="https://github.com/sunnystatue/githook-monorepo-example" rel="noopener ugc nofollow" target="_blank"> GitHub链接</a>来查看最初的样本库。</p></div></div>    
</body>
</html>