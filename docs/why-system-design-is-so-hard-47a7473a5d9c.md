# 为什么系统设计这么难？

> 原文：<https://betterprogramming.pub/why-system-design-is-so-hard-47a7473a5d9c>

## 你应该如何处理它？

![](img/9e30fa666ed18068ba7868eff4523e30.png)

Denys Nevozhai 在 [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

不久前，我写了一篇关于[为什么编写面试变得如此困难的文章？](https://medium.com/p/5a8231326299)与编码问题类似，系统设计也是面试过程中的一个重要部分，尤其是当你面试任何后端系统角色的时候。

可以说，系统设计比编码更重要。编码面试通常决定你是否会得到一份工作，而系统设计面试则决定这份工作的级别。对于高级角色来说，有时系统设计甚至比编码还要多。

很多人觉得系统设计面试令人生畏。这包括我自己，以及我与之交谈的许多同事和朋友。今天，我想花点时间来讨论一下为什么系统设计面试这么难。

# 系统设计从何而来

听起来可能很复杂，但系统设计实际上非常简单。任何大型分布式系统都是由服务器(计算机)组成的。每台机器都有三种重要的资源:CPU、内存和磁盘。

问题是这些资源都是有限的。如果我们可以无限扩大规模，那么我们就不必处理很多我们将在系统设计中讨论的问题。

如果我们无法在内存中容纳我们需要的数据，会发生什么？如果我们无法将数据存储在单台机器的磁盘上，会发生什么情况？如果计算非常昂贵，单个机器将永远无法解决问题，该怎么办？所有这些都是我们希望系统中有多台机器的简单原因。

事实上，即使我们可以无限扩展，比如我们拥有一台比我们需要的更多 CPU 内核、更多内存和磁盘存储的机器，我们仍然需要多台机器。那是因为机械从来都不可靠。它们可以在任何给定的时间点断裂。磁盘、CPU 和内存都可能出现故障，机器中的其他粘合组件也是如此。

多台机器通过网络连接。然而，网络连接也不可靠。机器可以用各种协议互相发送包。不幸的是，没有一个协议能够保证成功地传递一个包。

网络和 CPU、内存、磁盘一样，也是一种有限的资源。从拓扑结构上来说，我们还需要考虑如何布局机器和应用程序，以避免网络链路饱和。

我们必须考虑像暴风雨、雷击、洪水、地震等自然灾害。因此，我们引入多个数据中心来处理[灾难恢复](https://en.wikipedia.org/wiki/Disaster_recovery)。当想到多个数据中心或多个地区时，这似乎有些吓人。到一天结束时，唯一显著不同的是网络延迟，其他一切都或多或少相同。

数据经常被复制以获得更高的持久性，不仅跨多台机器，而且跨多个数据中心。这样，当一部分机器停止工作时，我们仍然可以从其他机器上检索数据。

那我们怎么处理不一致呢？如果存储在机器 A 和机器 B 上的相同数据是不同的，该怎么办？我们可以使用主从架构。我们仍然需要决定哪台机器是主要的，哪台是次要的。需要进行[领导人选举](https://aws.amazon.com/builders-library/leader-election-in-distributed-systems/)。然后各种解决共识的方法被开发出来，比如非常著名的 [Paxos 协议](https://martinfowler.com/articles/patterns-of-distributed-systems/paxos.html)。

多台机器的另一个问题是时间同步。每台机器都有自己的时钟。即使我们尽了最大努力来同步它们，但是因为存在网络延迟，所以没有办法做到绝对精确。我们如何知道在某一天谁是第一个预订酒店最后一个房间的人？然后我们需要使用一些[分布式锁](https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html)。

而且到目前为止，上面所有的讨论都只集中在系统本身。但是用户流量我们还没怎么关注。为了减少最终用户的延迟，我们希望将机器部署在离用户更近的地方。它们有时被称为[边缘位置](https://www.lastweekinaws.com/blog/what-is-an-edge-location-in-aws-a-simple-explanation/)，或 [POP(存在点)](https://www.cs.unc.edu/xcms/wpfiles/50th-symp/Moorthy.pdf)。

从一些基本资源(CPU、内存、磁盘、网络)开始，我们讨论了一些系统设计概念。然而，我们只讨论了其中的一小部分，还有很多，例如，DNS、负载平衡器、服务注册和发现、数据库、缓存、分布式消息队列、认证(安全性)，等等。其中很多都是复杂的话题。

这就是系统设计的主要内容——使用大量高级组件来解决资源有限的不可靠机器的问题。

# 广阔的领域

系统设计问题几乎总是表现为一些产品或产品特性。以下是一些例子:

*   在面试 Robinhood 的时候，你可能会被问到如何设计交易系统。
*   在为 Hopper 面试时，你可能会被问到如何设计一个酒店预订系统。
*   在为亚马逊面试时，你可能会被问到如何设计一个在线市场。
*   在网飞面试时，你可能会被问到如何视频推荐系统。
*   在为脸书面试时，你可能会被问到如何设计一个聊天应用程序。
*   …

工程师倾向于询问他们日常工作的系统。另一方面，也不能保证你会被问到团队正在构建的系统，因为他们可能会认为这太容易猜测了。

这是系统设计让人感到如此恐惧的第一个原因。每家公司都在不同的领域。一个领域可能与另一个领域完全不同。我们永远不知道我们会被要求设计什么。根据对可靠性和延迟的要求，我们可以采取的方法可能会大相径庭。

# 与你的工作无关

系统设计面试类似于编码面试，因为它们都与你的日常工作没有直接关系。

对于编码，你可能需要用动态编程和位操作来解决一个图形问题。但是你很少需要在工作中真正实现它。

这类似于系统设计。你可能有多年的系统工程师工作经验，管理一个注重高可靠性和可听度的银行交易系统。你不能在 30 分钟内设计出一个高效的聊天程序，这并不意味着你是一个糟糕的工程师。你可能是一名数据库工程师，正在构建数百万人使用的最高效、最可靠的数据库系统，但你可能不了解也不需要了解不同类型的[负载平衡器](https://www.nginx.com/resources/glossary/load-balancing/)，因为这永远不是你在工作中需要处理的事情。

世界不仅是复杂的，而且是不断发展的。即使你是一个有多年经验的资深软件工程师，也可能对特定类型的系统有深入的了解。但是一般来说，系统设计需要比你的日常工作更广泛的知识。

# 模糊的问题陈述

问题陈述一开始就含糊不清是很常见的。举个例子，

> *面试官:“你如何设计一个部署系统？”*

场景 1:

你想“哦，不，我从来没有听说过部署系统。我如何着手设计一个呢？”你会变得紧张，试着去回想你可能在哪里听说过这个术语。你想不出任何有意义的话来说。你的心脏开始跳动，汗珠开始从你的额头滴下。你希望你能在地上挖一个洞，然后跳进去。就是这样。是时候收拾行李回家了。你想，多可怜啊。

场景 2:

你说“啊哈，我在目前的工作中已经处理过了。我完全知道应该怎样。我们会用詹金斯。它是免费和开源的。我们的代码可以用 Jenkins 来构建和部署。完成了。又快又容易。”一分钟就搞定了。现在怎么办？让我们进入下一个问题？

实际上，采访可能会试图询问消防部门在野火季节有效部署消防员到现场的系统。

以上两种情况有点极端，但希望你能明白它们都不好。

他们故意含糊其辞，以模拟现实世界的工作环境，其中的要求可能并不明确。由候选人提出后续问题进行澄清。

在系统设计面试中，只有一半是关于评估你知识的广度和深度，另一半是关于评估你的沟通技巧。

事实上，你必须通过提问来阐明面试的意图，这会让人感觉很不自然。作为一名候选人，你可能会觉得自己是面试官。这是需要习惯的，需要一些练习。在某种程度上，这甚至像是角色扮演。

如果你不熟悉被询问的系统，你应该问很多问题来了解它是什么，然后找到解决方案。如果你熟悉这个系统，你仍然应该问很多问题，以确保你准确地收集了需求，而不是过早地得出任何结论。

如果你不知道这些期望，你可能会感到困惑。为什么面试官这么势利，问这么奇怪的问题？

# 没有正确的答案

不像编码问题，有一些好的和坏的解决方案，有一个最优解。在系统设计中，几乎没有任何答案是最优解。

比如，最近十年，有很多关于 [NoSQL](https://en.wikipedia.org/wiki/NoSQL) 的炒作。支持 NoSQL 的一个常见理由是因为它比传统的 SQL 数据库更具可伸缩性。然而，同样众所周知的是，拥有数十亿用户的脸书[将其大部分用户数据存储在 MySQL](https://www.youtube.com/watch?v=5RfFhMwRAic)；拥有数十亿月度观众的 YouTube 也[将元数据存储在 MySQL](https://www.youtube.com/watch?v=5yDO-tmIoXY) 中。不要争论 NoSQL 总体上更具可扩展性的事实，同样重要的是要指出这样一个事实，即无论哪种方式都存在争议。

系统设计在某种意义上就像玩乐高。在了解了大规模分布式系统中所有可用的组件之后，设计一个新系统就是在画布上放上盒子，并在它们之间画一些箭头。考生往往过于担心选择最高效的工具来画出最优雅的方框和箭头。尤其是在远程设置中，我们如何在没有白板的情况下进行系统设计面试？我们能用鼠标和键盘有效地画画吗？实际上，能够画出漂亮的图并不是最难的部分。没太大关系。

重要的是解释你为什么选择每一个框，有什么权衡，有什么其他选择，等等。如果你决定使用 [HBase](https://hbase.apache.org/) 作为数据库，你必须解释为什么。为什么不用 [Cassandra](https://cassandra.apache.org/_/index.html) ，为什么不用 [PostgreSQL](https://www.postgresql.org/) ，为什么不用 [Hive](https://hive.apache.org/) ？你如何处理索引和[分片](https://en.wikipedia.org/wiki/Shard_(database_architecture))？你如何避免热键问题？您如何确保系统能够扩展并满足不断增长的需求？你如何处理失败？

系统设计从来都不是为了得到最优解。这是关于理解需求。它是关于提出各种选择和讨论它们的权衡。这是关于知道什么和为什么，并能够很好地沟通。

# 下一步是什么

在编码面试中，你可能会花几个月的时间来准备，但仍然会在面试中失败。那么你可能会开始质疑生命的意义。我为什么要这么做？通过反复练习如何用假想的栅栏[收集雨水(LeetCode 上众所周知的问题)，我给社会带来了什么价值？为什么我没有利用这段时间来学习可以在工作中使用或者可以用来创业的新技术呢？](https://leetcode.com/problems/trapping-rain-water/)

系统设计面试不一样。

许多系统设计面试都集中在现实世界、困难和实际的计算机问题上。而很多这样的问题，如果你不主动去找，可能在工作中永远都不会遇到。

尽管系统设计似乎是一个非常广泛且永无止境的话题，但它也有有限的问题和有限的方法。它们学起来很有趣，学起来也很有用。

通过系统地学习系统设计，你将有可能从一个不同的角度看待你在工作中遇到的问题。当遇到一个问题时，你可以想出两三种不同的方法，并能更好地阐明取舍。你可能会指出更多的失败点，并想出更有效的方法来处理这些失败。

通过解决所有这些假设的可扩展性问题，当你有了一个创业的好主意时，这些知识可以帮助你绕过许多早期的陷阱。希望您不太可能构建一个不可伸缩的系统，并在将来导致许多问题。

系统设计的好处之一是没有限制。随着时间的推移，有新的理论被提出，新的算法被开发，更好的解决方案被实现。让我们敞开心扉。保持饥饿。并且不断学习！

今天到此为止。感谢阅读！我希望通过写一篇关于行为问题的文章来完成这个系列。但那是以后的事了。