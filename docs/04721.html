<html>
<head>
<title>How to Convert to and From JSON Using Swift’s Codable Protocol</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Swift的可编码协议与JSON相互转换</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-convert-to-and-from-json-using-swift-codable-e78bf353fff5?source=collection_archive---------2-----------------------#2020-05-04">https://betterprogramming.pub/how-to-convert-to-and-from-json-using-swift-codable-e78bf353fff5?source=collection_archive---------2-----------------------#2020-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0306" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">轻松地将JSON对象转换成Swift，反之亦然</h2></div><p id="3e74" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">对于本文，我使用了Xcode 11.4.1和Swift 5.2。我假设您熟悉Swift的基础知识。</em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/1bb460b6cc348ebfa4966311b391d284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TrsROX18t7Kuheh7jFQIPQ.jpeg"/></div></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">丹尼尔·安德雷蒂在<a class="ae lv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2113" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了使iOS Swift应用程序能够与服务器通信，我们必须将Swift转换为JSON。在本文中，我们将研究如何将Swift对象转换成JSON格式，或者反过来。为了支持与JSON的相互转换，我们将使用<code class="fe lw lx ly lz b">Codable</code>。</p><p id="8bfb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">Codable</code>是Swift对象可以遵循的类型，允许转换器将对象转换成另一种格式，或者从另一种格式转换成Swift对象。格式可以是任何想要的。苹果已经为可编码类型提供了现成的JSON转换器。</p><p id="9e7f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将学习如何通过模仿一个苹果配件销售应用程序将JSON对象转换成Swift(以及反向转换)。我们将转换代表商家销售的产品的JSON对象。我们还将把订单转换成JSON格式。</p><p id="8d2e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我们将利用Xcode操场。Playgrounds为我们提供了一种简单的方法来创建和测试我们的代码，而不需要运行应用程序的开销。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="90b5" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">如何使用Swift Codable将JSON转换成Swift(反之亦然)</h1><p id="cc7e" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">我们将采取的步骤:</p><ol class=""><li id="8eab" class="ne nf it kk b kl km ko kp kr ng kv nh kz ni ld nj nk nl nm bi translated">创建新的游乐场项目</li><li id="fdce" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld nj nk nl nm bi translated">得到了<code class="fe lw lx ly lz b">products</code> JSON的回应</li><li id="0b9a" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld nj nk nl nm bi translated">使用<a class="ae lv" href="https://developer.apple.com/documentation/swift/decodable" rel="noopener ugc nofollow" target="_blank">可解码的</a>将<code class="fe lw lx ly lz b">products</code> JSON转换为Swift</li><li id="c707" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld nj nk nl nm bi translated">创建<code class="fe lw lx ly lz b">Order</code>对象，并使用Encodable将其转换为JSON</li></ol><p id="1c82" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们开始吧！</p><h2 id="a5aa" class="ns mi it bd mj nt nu dn mn nv nw dp mr kr nx ny mt kv nz oa mv kz ob oc mx od bi translated">1.创建新的游乐场项目</h2><p id="1adf" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">首先让我们打开Xcode。从菜单中选择文件&gt;新建&gt;游乐场…</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/3592d3e372a35c61bab452e1e332ec46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*OSJzXm7ugzuWAiaCj9eBNA.png"/></div></figure><p id="cc55" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当提示“为您的新游乐场选择一个模板”时，选择iOS选项卡下的空白选项。然后单击下一步。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi of"><img src="../Images/a0e13c2e809aa240f614e410faa545d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ydqUSf_svUc6CbRNpJ2xQ.png"/></div></div></figure><p id="8ebc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将文件命名为<code class="fe lw lx ly lz b">codable_json</code>，然后单击创建。</p><h2 id="8aad" class="ns mi it bd mj nt nu dn mn nv nw dp mr kr nx ny mt kv nz oa mv kz ob oc mx od bi translated">2.获得“产品”JSON响应</h2><p id="b0e4" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">对于本文，我们将复制并粘贴商家GET <code class="fe lw lx ly lz b">products</code> API端点的JSON响应。我们不会发出任何网络请求，因为这超出了本文的范围。相反，我们将直接处理服务器返回的响应体。</p><p id="89eb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将以下内容复制并粘贴到<code class="fe lw lx ly lz b">codable_json</code>:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="5138" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的代码将JSON响应字符串分配给一个名为<code class="fe lw lx ly lz b">productsJson</code>的常量。</p><p id="cc64" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JSON响应包含一系列产品。每个产品都有三个属性:<code class="fe lw lx ly lz b">product_id</code>、<code class="fe lw lx ly lz b">name</code>、<code class="fe lw lx ly lz b">price</code>。<code class="fe lw lx ly lz b">product_id</code>是整数，<code class="fe lw lx ly lz b">name</code>和<code class="fe lw lx ly lz b">price</code>是字符串。</p><h2 id="3828" class="ns mi it bd mj nt nu dn mn nv nw dp mr kr nx ny mt kv nz oa mv kz ob oc mx od bi translated">3.使用Decodable将产品JSON转换为Swift</h2><p id="234f" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">接下来，让我们将产品JSON转换成一个Swift对象。我们将首先从创建来自JSON产品阵列的单个产品的Swift表示开始。下面是JSON中的一个产品:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="d2ca" class="ns mi it lz b gy om on l oo op">{<br/>    "product_id": 0,<br/>    "name": "iPhone 11 Clear Case",<br/>    "price": "38.99"<br/>}</span></pre><p id="056d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将以下几行添加到操场:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="ce2a" class="ns mi it lz b gy om on l oo op">struct Product {<br/>}</span></pre><p id="b1e9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">Product</code>结构将代表JSON字符串中的单个产品。</p><p id="7d96" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来让我们添加它的属性。先从<code class="fe lw lx ly lz b">name</code>和<code class="fe lw lx ly lz b">price</code>说起吧。暂时不要担心——我们会回来的。<code class="fe lw lx ly lz b">name</code>和<code class="fe lw lx ly lz b">price</code>都是字符串。在产品结构中，添加以下两行:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="1be9" class="ns mi it lz b gy om on l oo op">let name: String<br/>let price: String</span></pre><p id="703e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们在Swift中有了一个<code class="fe lw lx ly lz b">Product</code> JSON表示。接下来，让我们将产品的JSON表示转换为Swift。苹果提供的JSON到Swift的转换器叫做<code class="fe lw lx ly lz b"><a class="ae lv" href="https://developer.apple.com/documentation/foundation/jsondecoder" rel="noopener ugc nofollow" target="_blank">JSONDecoder</a></code>。之所以叫解码器，是因为从Swift的角度来看，它解码的是JSON。为了让解码器将JSON解码成它的Swift表示，<code class="fe lw lx ly lz b">Product</code>结构必须符合<code class="fe lw lx ly lz b">Decodable</code>。</p><p id="8533" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来将<code class="fe lw lx ly lz b">: Decodable</code>添加到<code class="fe lw lx ly lz b">Product</code>结构声明中。我们的<code class="fe lw lx ly lz b">Product</code>结构应该如下所示:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="b3e4" class="ns mi it lz b gy om on l oo op">struct Product: <!-- -->Decodable {<br/>    let name: String<br/>    let price: String<br/>}</span></pre><p id="816b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们通过添加下面一行代码将JSON转换成<code class="fe lw lx ly lz b">Product</code>:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="ab82" class="ns mi it lz b gy om on l oo op">let products = try! JSONDecoder().decode([Product].self, from: productsJson.data(using: .utf8)!)</span></pre><p id="cfd9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们将Swift产品打印到控制台上。添加以下一行:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="d64d" class="ns mi it lz b gy om on l oo op">print(products)</span></pre><p id="c076" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，单击print语句旁边的蓝色play按钮运行代码。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/b66883d9f98504042a5f6b1c23de28a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:356/format:webp/1*cDkruec8tMNXJd2f7i_lWA.png"/></div><p class="lr ls gj gh gi lt lu bd b be z dk translated">点击蓝色的播放按钮</p></figure><p id="b316" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">控制台应显示如下内容:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi or"><img src="../Images/2dec94579653455d740659edea03d20e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ffMD8tjB8wIqnyhr1oUFhw.png"/></div></div></figure><p id="46f0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了！<code class="fe lw lx ly lz b"><a class="ae lv" href="https://developer.apple.com/documentation/foundation/jsondecoder" rel="noopener ugc nofollow" target="_blank">JSONDecoder</a></code>已经成功地将JSON系列产品转换为Swift系列产品。那很容易！</p><p id="59a0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们将<code class="fe lw lx ly lz b">productId</code>属性添加到Swift <code class="fe lw lx ly lz b">Product</code>中。在<code class="fe lw lx ly lz b">Product</code>结构中添加以下内容:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="c73d" class="ns mi it lz b gy om on l oo op">let productId: Int</span></pre><p id="8aee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，点击<code class="fe lw lx ly lz b">print</code>语句旁边的播放按钮。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi os"><img src="../Images/b6492f0e097486d291e6125e721d0470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xvPHZy20TXHVIoYRY4Dq4g.png"/></div></div></figure><p id="7b83" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您应该会看到与上面截图中相同的错误。发生了什么事？虽然<code class="fe lw lx ly lz b">name</code>和<code class="fe lw lx ly lz b">price</code>属性转换没有问题，但<code class="fe lw lx ly lz b">productId</code>会引发一个问题。</p><p id="32dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里的问题是Swift中的属性名命名为<code class="fe lw lx ly lz b">productId</code>，而JSON的属性名是<code class="fe lw lx ly lz b">product_id</code>。解码器足够智能，可以匹配相等的属性名。然而，JSON属性命名通常遵循<a class="ae lv" href="https://en.wikipedia.org/wiki/Snake_case" rel="noopener ugc nofollow" target="_blank"> snake_case样式</a> ( <code class="fe lw lx ly lz b">product_id</code>)，而Swift遵循<a class="ae lv" href="https://en.wikipedia.org/wiki/Camel_case" rel="noopener ugc nofollow" target="_blank"> camelCase样式</a> ( <code class="fe lw lx ly lz b">productId</code>)。</p><p id="55cf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要解决这个问题，我们可以:</p><ul class=""><li id="d374" class="ne nf it kk b kl km ko kp kr ng kv nh kz ni ld ot nk nl nm bi translated">将Swift中的属性名与JSON对象上的名称相匹配</li><li id="dd91" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld ot nk nl nm bi translated">在Swift对象上创建自定义属性名称映射</li></ul><p id="33c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个变化很容易:<code class="fe lw lx ly lz b">productId</code>在Swift <code class="fe lw lx ly lz b">Product</code>结构中变成了<code class="fe lw lx ly lz b">product_id</code>。再次点击播放按钮。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ou"><img src="../Images/70119804efbd23d88273bc3b95be3309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ZjYC_qF4eWgn8-_v8mL8g.png"/></div></div></figure><p id="2a7a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，我更喜欢保持camelCase的样式，以保持代码在整个代码库中的一致性。在这种情况下，我们必须告诉JSON解码器如何映射属性。在<code class="fe lw lx ly lz b">Product</code>结构中添加以下几行:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="0504" class="ns mi it lz b gy om on l oo op">enum CodingKeys: String, CodingKey {<br/>    case productId = "product_id"<br/>    case name = "name"<br/>    case price = "price"<br/>}</span></pre><p id="8634" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面告诉解码器属性名，或者Swift中的<em class="le">键</em>，在JSON中是等价的。不幸的是，我们不能自定义映射单个属性。因此，当选择自定义名称映射时，我们必须在JSON中声明所有Swift属性及其等价物。</p><p id="ec32" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">再次点击播放按钮，看看它的工作！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ov"><img src="../Images/6910390d14b276ec1aa5c6a2a9d212d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2KXppbweg-rF3RwOoxPaVQ.png"/></div></div></figure><h2 id="5a52" class="ns mi it bd mj nt nu dn mn nv nw dp mr kr nx ny mt kv nz oa mv kz ob oc mx od bi translated">4.创建一个“Order”对象，并使用Encodable将其转换为JSON</h2><p id="8c6d" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">在最后一节中，我们将看看如何将Swift对象转换成JSON。我们将在苹果配件销售商的应用中模仿一个<code class="fe lw lx ly lz b">Order</code>创造。卖方POST <code class="fe lw lx ly lz b">Order</code>端点期望下面创建一个订单:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="c8dd" class="ns mi it lz b gy om on l oo op">{<br/>    products: [ProductQuantity]<br/>}</span></pre><p id="4435" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">卖方API的<code class="fe lw lx ly lz b">ProductQuantity</code>对象如下所示:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="e4c5" class="ns mi it lz b gy om on l oo op">{<br/>    "product_id": 999,<br/>    "quantity": 1<br/>}</span></pre><p id="26b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是一个订单示例，客户希望购买无线充电板(产品ID 1):</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="2def" class="ns mi it lz b gy om on l oo op">{<br/>    "products": [<br/>        {<br/>            "product_id": 1,<br/>            "quantity": 1<br/>        }<br/>    ]<br/>}</span></pre><p id="f57d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们在Swift游乐场重现这一秩序。首先，让我们创建<code class="fe lw lx ly lz b">ProductQuantity</code> Swift表示。添加以下几行:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="4d9a" class="ns mi it lz b gy om on l oo op">struct ProductQuantity {<br/>    let productId: Int<br/>    let quantity: Int<br/>}</span></pre><p id="00af" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，为了允许Swift将 <code class="fe lw lx ly lz b">ProductQuantity</code>转换或<em class="le">编码为JSON，struct必须符合<code class="fe lw lx ly lz b">Encodable</code>。将<code class="fe lw lx ly lz b">ProductQuantity</code>声明改为:</em></p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="a1aa" class="ns mi it lz b gy om on l oo op">struct <!-- -->ProductQuantity: Encodable {</span></pre><p id="d62f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们将<code class="fe lw lx ly lz b">ProductQuantity</code>转换成JSON之前，我们必须确保属性名(或<em class="le">键</em> s)与服务器期望的相匹配。</p><p id="b9cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们之前在将<code class="fe lw lx ly lz b">product</code> JSON转换为Swift时看到的那样，<code class="fe lw lx ly lz b">productId</code>属性名与服务器期望的属性名(即<code class="fe lw lx ly lz b">product_id</code>)不匹配。我们必须再次告诉转换器如何映射属性名。在<code class="fe lw lx ly lz b">ProductQuantity</code>中添加以下内容:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="0c1e" class="ns mi it lz b gy om on l oo op">enum CodingKeys: String, CodingKey {<br/>    case productId = "product_id"<br/>    case quantity = "quantity"<br/>}</span></pre><p id="f8f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，让我们创建一个结构来表示一个<code class="fe lw lx ly lz b">Order</code>。在Playground文件的末尾添加以下行:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="6c29" class="ns mi it lz b gy om on l oo op">struct Order: Encodable {<br/>    let products: [ProductQuantity]<br/>}</span></pre><p id="d554" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们为产品ID为1的无线充电板创建一个订单。添加以下代码行:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="465f" class="ns mi it lz b gy om on l oo op">let order = Order(products: [ProductQuantity(productId: 1, quantity: 1)])</span></pre><p id="62bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们把我们的<code class="fe lw lx ly lz b">order</code>转换成JSON，打印到控制台。添加以下几行:</p><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="6ad3" class="ns mi it lz b gy om on l oo op">let encoder = JSONEncoder()<br/>encoder.outputFormatting = .prettyPrinted<br/>let orderJsonData = try! encoder.encode(order)</span><span id="80ea" class="ns mi it lz b gy ow on l oo op">print(String(data: orderJsonData, encoding: .utf8)!)</span></pre><p id="b77f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面，我们已经创建了一个<code class="fe lw lx ly lz b"><a class="ae lv" href="https://developer.apple.com/documentation/foundation/jsonencoder" rel="noopener ugc nofollow" target="_blank">JSONEncoder</a></code>的实例，并将其格式配置为JSON格式，格式清晰易读，而不是只有一行。然后，我们对订单进行了编码。编码器吐出<code class="fe lw lx ly lz b">Data</code>。因此，我们必须将其转换为<code class="fe lw lx ly lz b">String</code>以便将其打印到控制台。点击新打印声明旁边的播放。</p><p id="7a38" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">结果是:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ox"><img src="../Images/0660ba0ed69251280c68fb6cf0d73946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F3qdpQOT0PGKAFTld_4x_w.png"/></div></div></figure><pre class="lg lh li lj gt oi lz oj ok aw ol bi"><span id="6bab" class="ns mi it lz b gy om on l oo op"><strong class="lz iu">{<br/>    "products" : [<br/>        {<br/>            "product_id" : 1,<br/>            "quantity" : 1<br/>        }<br/>    ]<br/>}</strong></span></pre><p id="b431" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经将Swift订单转换为JSON，并准备发送到服务器！</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="49af" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">摘要</h1><p id="bedb" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">在此，我们了解到:</p><ul class=""><li id="d0f2" class="ne nf it kk b kl km ko kp kr ng kv nh kz ni ld ot nk nl nm bi translated">什么是可编码的</li><li id="5193" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld ot nk nl nm bi translated">如何使用<a class="ae lv" href="https://developer.apple.com/documentation/swift/decodable" rel="noopener ugc nofollow" target="_blank">可解码</a>和<a class="ae lv" href="https://developer.apple.com/documentation/foundation/jsondecoder" rel="noopener ugc nofollow" target="_blank"> JSONDecoder </a>将JSON转换成Swift</li><li id="4613" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld ot nk nl nm bi translated">如何使用<a class="ae lv" href="https://developer.apple.com/documentation/swift/encodable" rel="noopener ugc nofollow" target="_blank"> Encodable </a>和<a class="ae lv" href="https://developer.apple.com/documentation/foundation/jsonencoder" rel="noopener ugc nofollow" target="_blank"> JSONEncoder </a>将Swift转换成JSON</li><li id="9963" class="ne nf it kk b kl nn ko no kr np kv nq kz nr ld ot nk nl nm bi translated">当不使用匹配的属性或键名时，如何定制编码和解码JSON</li></ul></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="30fd" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">最终注释</h1><p id="9bdf" class="pw-post-body-paragraph ki kj it kk b kl mz ju kn ko na jx kq kr nb kt ku kv nc kx ky kz nd lb lc ld im bi translated">你可以在下面找到完整的操场:</p><div class="oy oz gp gr pa pb"><a href="https://github.com/anuragajwani/codable_json" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd iu gy z fp pg fr fs ph fu fw is bi translated">anuragajwani/cotable _ JSON</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">展示如何在Swift中使用Codable的代码。通过创建一个……</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">github.com</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp lp pb"/></div></div></a></div><p id="5c75" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们介绍了如何从JSON转换为对象，或者如何将对象转换为JSON。通过遵循<a class="ae lv" href="https://developer.apple.com/documentation/swift/codable" rel="noopener ugc nofollow" target="_blank">可编码的</a>而不是<a class="ae lv" href="https://developer.apple.com/documentation/swift/encodable" rel="noopener ugc nofollow" target="_blank">可编码的</a>或<a class="ae lv" href="https://developer.apple.com/documentation/swift/decodable" rel="noopener ugc nofollow" target="_blank">可解码的</a>，可以在JSON和对象之间进行双向转换。</p><p id="0e5d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，本文只讨论了Codable的基本用例。然而，事情可能会变得更复杂——例如，在将日期字符串映射到一个<code class="fe lw lx ly lz b"><a class="ae lv" href="https://developer.apple.com/documentation/foundation/date" rel="noopener ugc nofollow" target="_blank">Date</a></code>对象和从一个<code class="fe lw lx ly lz b"><a class="ae lv" href="https://developer.apple.com/documentation/foundation/date" rel="noopener ugc nofollow" target="_blank">Date</a></code>对象映射时。这将是一个有趣的话题。</p></div></div>    
</body>
</html>