# 如何进行出色的代码评审

> 原文：<https://betterprogramming.pub/how-to-give-a-great-code-review-7e32e5ba0771>

## 给予和接受反馈很难，但我们都有相同的目标:变得更好

代码审查是棘手的。他们可能很难付出，而且会耗费很多精力。

是什么让代码评审变得伟大？很高兴你问了。我将向您介绍我进行代码评审的步骤。这是异步评论，就像你在 GitHub 上做的那样。我认为面对面的评论更有趣，但这并不总是你可以采取的方法。

希望您有工具来防止代码评审中的大多数风格和偏好注释。对一个丢失的分号、首选的空白规则、骆驼案或蛇案或其他可以由 linters、prettiers 和公共工具处理的事情进行评论简直是浪费每个人的时间。不要在这上面浪费你的时间。如果你的项目没有任何工具，那么建议一些。

此外，考虑你的评论如何堆叠。不要对一个可能会因为架构建议而改变的方法进行评论。本指南应该给出一些层次来防止这种情况发生。在进入下一层之前，让来自一层的评论得到处理，直到你对它有更好的感觉。多轮代码审查是可以的，但是用大量的建议来压倒某人是很难处理的。这些步骤中的每一步都应该按顺序进行。如果上一步还没有完成，我看不到继续下一步的理由。

重要的是要记住，代码评审不仅仅是在你队友的代码中寻找错误。这些都是学习的机会，抓住可能的疏忽，筛选错误，提出问题，分享领域知识等。团队中的每个人都应该想要同样的东西:高质量的软件。对一组代码关注越多越好。仅仅通过回顾代码，我就学到了不少东西。这应该是一个深思熟虑和有益的过程。

此外，不要害怕在代码评审评论中提出问题或进行对话。我已经从我询问和讨论的代码评审问题中学到了编码技巧和良好的架构。像“接得好！”这样的鼓励性评论也是可以的或者“我很高兴看到它被重构。”这是编程过程的另一部分，而不是一个僵化的发现错误和看起来超级聪明的过程。

# **高级概述**

您首先需要通读拉请求。你应该能够从中看出发生了什么变化，为什么需要变化，以及如何证明变化有效或正在发生。在某些情况下，更改不会产生明显的影响，因此没有什么可测试的。希望该请求能够说明这一点。如果没有，你需要与作者交谈，以确保你理解。这是要求他们澄清描述的好时机。

从这个描述中，您至少应该有足够的理解来测试这个变更集，并证明它工作正常，bug 已经被删除，等等。对于对其他代码影响很小甚至没有影响的更改，您应该有足够的想法来测试一些路径以验证这一点。在某些情况下，它只是“确保测试通过”如果这是你的具体工作领域，你可能知道它会产生什么影响，所以你能够证明这一点。

# **运行代码**

现在您已经对变更集有了正确的理解，您需要拉下分支。不应该跳过这一步，因为验证变更是否如预期的那样进行是您的工作。作为一个编程团队，你的工作就是确保 QA 什么也没发现。如果你没有 QA 团队，你尽可能完整地测试就更重要了。

此外，如果代码不工作，您可能甚至不需要/不想去检查更改。之后值得一看，看看你是否能确定为什么它可能会坏。你已经把它拉下来了，并且把你的注意力放在了这个问题上，所以如果可以的话，建议一下你在哪里看到了一个问题是值得的。我建议至少在评论前快速定位错误，这样你可以让评论更有效率。

# **了解一下变化的范围**

现在您已经将分支拉下，并且您可以验证没有任何东西被破坏，并且代码如预期的那样工作。您需要仔细研究差异，找出变化的实质。很多时候，单行代码几乎没有影响，有时大多数情况下只有几个大块的更改。如果差异很大，一次查看一个提交可能会更好。这个想法是让你的头脑在一个类似于 diff 描述的层次上了解实际的代码变化。您并不是专门寻找编码错误，但是如果有什么东西跳出来，您可以记下来。现在不要对此发表评论。

你要做的是找到代码的架构。不仅仅是变化，所以你需要看到的不仅仅是红色和绿色。这就是为什么在这一步将代码拉下来是有帮助的。您希望找出代码是如何更改的，以及它与周围的代码以及调用它的代码(如果适用)之间的关系。

# **做架构评论**

你想这样做的部分原因是你想知道如何去做。它不像新代码那样需要很长时间，因为很容易从已经编写的代码中进行这样的猜测。你不需要一个如何实现它的 100%的路线图；作者已经这样做了。你想要抽象地看待一个可能的架构选择，这不仅允许你在看到它时提出一些建议，而且可以更好地理解作者为什么会做出他们所做的选择。

如果你对新方法有什么建议，那就提出来吧。伪代码、示例、链接等。在这方面会有很大帮助。如果你没有任何建议，你应该知道为什么他们会选择这样实现它。如果没有，你应该问。

# **对周围代码进行评论**

重要的是要对代码的上下文有一个大致的了解。我在 diff 中看到过一些看起来不错的代码，但是有一个 helper 方法可以做类似的事情。作者采纳了我的意见，对 helper 方法进行了一点重构，以获得一个总体上更好的解决方案。如果我没有看其他代码，我们都会错过这个机会。

我也见过在差异中看起来不错的代码。想象一个总产出为`total + tax`和一些防御性代码，当它没有被定义时，让 tax 为`0`。这似乎是合理的，但这是在一个总结的组成部分。已经有了 subtotal 方法和输出，所以我查看了`getTotal`方法，发现已经添加了 tax，尽管这些都没有包含在更改的代码中。我通过调查**为什么** 需要做出特定的改变而发现了这一点。原来有一个预先存在的错误影响了这一点。该解决方案被重构，以修复该错误并删除导致我查看的代码。

我可以举很多这样的例子。如果你看到一个你不确定的变化，去调查一下。如果您想知道在测试案例中是否有必要将 XYZ 改为 ABC，请将其改回来并进行测试。看看周围的代码。窥探。不要只看绿色的东西。

# **关于这两个步骤**

从较高的层面理解这些变化，并深入研究代码以确定范围和相关代码是非常重要的。显然，这很重要，这样你就可以给出一个好的评论，但它对知识共享也很重要。这一步可以帮助您了解代码并理解正在发生的事情。如果你工作的是代码，你就能跟上速度，这些步骤会更快，因为你对它很熟悉。如果是你不经常使用的代码，你可以通过代码评审来获得系统的知识。

许多公司和团队都在知识共享方面苦苦挣扎。我认为给出好的代码评审是有帮助的。它不仅通过实际观察和理解变更中的代码来共享知识，而且它还为您提供了谁该问哪些问题的具体通讯录。这也有助于看到你在其他作品中可能记得的东西。这将有助于重叠的任务。它可以防止你做额外的工作，或者它可以给你一个在任务实施前可以咨询的人。

这里的最后一点是关于有用的评论。请记住，如果你有例子、链接、参考的最佳实践等，指出一些东西会更有帮助。仅仅提出一些没有建议、伪代码或代码示例的东西就相当于说“我本来可以用不同的方式来做这件事。”这本身对读者帮助不大。关于评论我以后会说的更多。

# **查看代码**

既然代码已经有了一个稳定的架构，并且不需要对它周围的任何东西进行更改，我们就准备好实际审查代码了。我回到 GitHub diff 查看修改和添加的内容。我喜欢传球两次。

第一遍，我对我可能看到的一般编码内容进行评论。我检查是否有任何东西可以改变来帮助澄清，这是我通过阅读代码发现的。如果我在代码中忘记了变量是什么，也许代码的范围太大了，或者变量可以有一个更好的名字。如果我看到很多缩进，我可能会花一点时间关注那个块，看看是否有什么可以简化它。我写了很多 JavaScript，所以如果我看到循环，它会引起我的注意，因为我喜欢更高级的集合方法。如果我看到一个变量被声明，然后构建在一个循环中返回，我可能会看到一个`map`或`reduce`是否可以工作。

在这一步中，包含示例代码更加重要。你已经把分支拉下来了，所以很容易测试出重构的东西。如果你举一个例子，你可以确保你的评论总是清晰的，并且看着同样的事情。有时候我会放不止一个。我可能有一些不同的想法，或者我希望作者能够决定他们最喜欢哪一个，或者我的例子可能会引发一个想法或激发一些良好的对话，从而导致对最佳改进的集体共识。如果你留下了许多建议、例子，并且愿意交谈，你的评论很难被误解。此外，你已经通过在例子上花费时间和精力展示了你对代码库的投入。有时当你开始写一个例子时，你发现你错了，或者你知道了你的问题的答案，所以根本不需要评论。

最后一关是错误和工具可能遗漏的东西。寻找微妙的逻辑错误，可能永远不会命中的分支，以及额外的分号之类的东西。有时候 linter 会忽略一些格式化的东西。这也是仔细检查变量名和范围的好时机。通读一遍，确保所有的东西都流畅、有逻辑、易读。这也是我更深入研究测试的时候。

# **测试实码**

我很难想复习考试。这是我工作中必须做的事情之一。如果测试很难维护或阅读，它们就不会被维护或阅读。寻找可以重构测试和设置的方法。您实际上必须阅读测试，以确保代码可读，并且有意义。考试越复杂，复习越难。

# **需要牢记的事情**

## **范围**

有时变更可能超出给定任务的范围。应该由作者决定是在那时还是以后进行这些修改。你当然可以提出需要做出的改变，你也应该这样做。请注意，这些变化可能会被推迟到下一次。

## **童子军规则**

渐进式重构是必要的。有些人在编码时遵循童子军规则，这意味着他们将总是让代码比他们发现时更干净。这意味着他们可能会以稍微改进代码库为目标重构一些东西。你必须抵制看到另一个重构结果的冲动，坚持让他们这么做。这会把你带到一条严重扩大审查范围的道路上。询问这些事情并建议为未来的工作创建一个标签是很好的。但是，坚持新的重构是增量重构的结果是不行的，除非作者对此持开放态度。

## **明确说出什么是可选的**

不要让读者来解释什么需要改变，什么不需要改变。如果有些东西是可选的或者只是一个注释，那就大声说出来。

## **不要含糊**

评论要具体。留下建议、例子和资源。如果某件事是一种最佳实践，那么链接一些资源对学习者来说是有帮助的。如果某些东西对性能有影响，您应该能够找到原因。

## **不要俯冲和便便**

俯冲和便便是我从一个设计团队那里学到的。当有人进来，对你的设计进行一系列的否定，然后离开。除非你有建议或者解决方案，或者你想说，否则不要发表评论。

## **经常举例**

没有什么比例子更有助于思考过程了。它保证你有一个共同的理解，它可以帮助教别人，它会减少在评论中被问到的问题，它会确保你不会突然出现，这将是一个更积极的评论。

## **为简单的东西尝试建议的改变**

有时，通过 GitHub 上的建议更改功能可以很容易地进行内联更改。作者会看到这一点，并有一个选择，只是接受更改，它会直接作为一个提交。有时间试试吧。

## **不要无缘无故的耽误复习**

如果你阻止了一个评论，确保有一个好的理由。如果你喜欢某样东西，但没有任何可证明的理由，那只是一种偏好。如果你对某件事有强烈的感觉，你需要确保它值得每个人的时间和特性或修复。

## **如果有人反对，作者就赢了**

有时我们会被什么是对的或者什么是最好的方法所困扰。有时作者不同意我们的观点。如果在讨论中你不同意，并且你没有经验证据或者一些可以证明你是对的理由，那么这应该是作者的偏好。纯粹是偏好的链接或例子不算数。给一点没关系。

## **不要绕圈子评论**

如果您已经完成了几轮代码审查，并且代码正在变得更好，那么就不要去管它了。不要总是对你看到的新东西发表新的评论，或者试图让代码 100%完美。

## **友善一点**

对于很多人来说，代码审查会导致焦虑。你说的是某人花费了大量精力的事情。对已经写好的东西提出批评总是很容易的。在评估时，一定要考虑到对方。每次都有积极的体验比害怕代码审查要有益得多。

## **校对**

点击评论上的提交按钮之前要小心。提交前再读一遍。寻找任何可能出错的地方。看看你说“我”和“你”而不是“我们”的频率寻找任何可能包含解决方案或更多建议的评论。阅读这篇文章，以确保你希望有人对你的评论发表评论。

# **更多信息**

我接触到了一篇关于代码评审的两部分文章[。那是在我职业生涯的后期，我已经经历了一段艰难的学习过程。我已经艰难地学会了许多同样的步骤。](https://mtlynch.io/human-code-reviews-1/)

我开始从最差的人那里得到评价。我一点也不开玩笑地说，你可以声明一个真实的陈述，而那个人会为了争论而和你争论。有一天我们说“天空绝对是蓝色的”来证明这一点。这让我非常担心代码审查。我害怕它们，我在它们之间争论。

他被辞退后，我准备和接下来的人争论。令我惊讶的是，他们非常积极和乐于助人。我开始兴奋地想看看我能从代码评审中学到什么。这是一次很棒的经历。

这让我成为了一家新公司的看门人。我们收购了另一家公司，我应该审查任何集成代码，以确保它符合我们的指导方针。我在每篇评论中都提到类似“不要使用单字符变量名”和“五个缩进深度的 for 循环中的 try-catch 块看起来非常复杂”这样的话。我遇到了“不会修复”和“我花了这么长时间让它工作，我不想把它弄糟。”我不知道该怎么办。

这个经历让我尝试从代码评审中学习。它提醒我要考虑对方的感受。一方面是因为我很强硬，另一方面是因为我给那些讨厌这种想法的人写评论。

有很多关于如何做到这一点的信息，这表明这比看起来要难。我努力确保我参与的所有评论都是有趣和有益的。这也应该是你的目标。