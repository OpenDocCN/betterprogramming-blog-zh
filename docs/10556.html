<html>
<head>
<title>3 Vital API Metrics You Should Monitor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您应该监控的3个重要API指标</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/software-engineers-standardize-and-simplify-your-alerts-3-vital-signs-you-need-to-monitor-75802058ea23?source=collection_archive---------11-----------------------#2022-01-14">https://betterprogramming.pub/software-engineers-standardize-and-simplify-your-alerts-3-vital-signs-you-need-to-monitor-75802058ea23?source=collection_archive---------11-----------------------#2022-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1829" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">标准化并简化您的警报</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/655ef847a7cdbe0aacd82af5ba3c6e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IGwqvzgLvly8Wi15"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@dlerman6?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丹尼尔·勒曼</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="1738" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不应该为每个应用程序重新发明警报。</p><ul class=""><li id="45f0" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">有很多警报会给人一种虚假的安全感。事故未被发现是因为基本知识未被涵盖。</li><li id="942d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">更多的警报意味着更多的调整。通常他们没有调整，他们会引起警觉疲劳。</li><li id="b821" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">标准化的生命体征使与其他工程师的交流更加容易。每个人都可以在不了解您的应用程序的情况下理解它们。</li></ul><p id="6c5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于每个API，您需要监控的三个重要特征是:成功率、延迟和QPS。</p><h1 id="4542" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">1.成功率(SR)是您需要监控故障的指标</h1><p id="2885" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">成功率在各原料药中是可比的，因为它使QPS正常化。</p><p id="0993" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">警报音量会随着QPS的变化而变化。你的成功率应该保持稳定。</p><p id="6d9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记得为您的API设定期望并记录SLA。大多数API的SLA应该是3-9(99.9%)或4-9(99.99%)。你的API的上游客户应该知道他们的SLA不可能比你的高，除非他们有退路。</p><p id="6a8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">衡量成功率的最佳方法是导出成功和失败次数。使用此公式:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5ccd" class="ni mh iq ne b gy nj nk l nl nm">success_rate = success / (success + failure)</span></pre><p id="0847" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相对于<code class="fe nn no np ne b">success / qps</code>，我更喜欢这个公式，因为这个公式永远不可能超过100%。如果您的监控系统在导出度量的时间戳方面稍有偏差，您很可能会以<code class="fe nn no np ne b">success &gt; qps</code>结束，在这种情况下，您的成功率将超过100%。</p><p id="2d3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">三个高级提示:</p><ol class=""><li id="78f6" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nq ly lz ma bi translated">来自无效输入的任何错误都不应该算作失败(它们不是应用程序中的错误)</li><li id="d01e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nq ly lz ma bi translated">如果缓慢的请求高于您的SLA，则将其视为错误(您的客户会超时，并认为这是一次失败——您也应该如此)。</li><li id="43ba" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nq ly lz ma bi translated">用至少100个请求来衡量你的成功率。如果您的API每秒调用次数不超过100次，那么您需要在更长的时间内(1-10分钟)进行滚动成功率测试。</li></ol><h1 id="a002" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">2.延迟:用它来捕捉坏代码、坏主机和坏的下游依赖项</h1><p id="a60e" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">延迟可以总结每台主机的行为以及下游主机的行为。</p><p id="9975" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">坏代码会增加所有主机的延迟。坏主机会增加群集中的最大延迟。糟糕的下游依赖关系(如数据库)会导致集群中的一些服务器出现问题。</p><p id="a19a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最好的监控指标是多用途的，可以帮助你避免精神负担过重。</p><p id="a31a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">服务的延迟是使用您需要调整的两个聚合来计算的:</p><ol class=""><li id="f8ca" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nq ly lz ma bi translated">如何合计一台服务器的请求延迟</li><li id="1411" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nq ly lz ma bi translated">如何汇总集群的每服务器指标(1)</li></ol><p id="6383" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个服务器将在一段时间内累计请求的延迟。然后，您的监控系统会将这些每台服务器的指标汇总到集群的汇总统计数据中。</p><p id="3f1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我建议每台服务器监控四个统计数据:p50、p90、p99、p999。当您从集群中的所有服务器汇总这些信息时，请考虑您可以容忍多少服务器处于不良状态。例如，如果您有一个100台服务器的集群，并且您可以容忍10台服务器是坏的，那么使用p90来聚合它们。如果你不能有一个人行为不端，使用最大值。</p><p id="830a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">延迟控制面板和警报经常测量服务群中所有主机的所有延迟的平均值或中值(p50)。这些汇总统计数据都不能可靠地捕捉坏主机或下游依赖项。</p><h1 id="fcc4" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">3.每秒查询数(QPS):意外的QPS下降和峰值是事件的主要指标。</h1><p id="b905" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf na lh li lj nb ll lm ln nc lp lq lr ij bi translated">总是测量你的QPS。</p><p id="f99f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">QPS是你需要与其他工程师交流的最重要的指标之一。你的用例有多少QPS？我的应用程序能处理多少？</p><p id="471e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">QPS的下降和上升通常是由其他系统引起的。但是你需要注意掉线，因为如果你的服务不可用，这可能是你的错。QPS的增加可能会使您的服务或其依赖项过载。</p><p id="67ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用程序需要根据其QPS进行不同的构建和扩展。</p><p id="dbca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要测量每分钟、每小时或每十秒钟的查询量:只测量每秒钟的查询量。QPS是跨服务进行比较的有用指标。如果您的服务每秒处理的请求不少于1个，请将其聚合，然后标准化为秒。</p><p id="5403" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">警惕QPS的最好方法是将其与历史数据进行比较。在过去，我每天和每周都进行监测，以捕捉事故。</p><p id="acc4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于QPS的标准化将帮助您在跨多个API和服务工作时保持理智。</p></div></div>    
</body>
</html>