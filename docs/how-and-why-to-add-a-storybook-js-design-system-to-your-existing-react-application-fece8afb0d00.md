# 如何以及为什么将 Storybook.js 设计系统添加到您现有的 React 应用程序中

> 原文：<https://betterprogramming.pub/how-and-why-to-add-a-storybook-js-design-system-to-your-existing-react-application-fece8afb0d00>

## 现在添加基本的配置和设置，用几个简单的例子，并随着时间的推移逐步改进您的代码库

![](img/62e9f0fd17d38761732394fca6ba424a.png)

由 [Florencia Viadana](https://unsplash.com/@florenciaviadana?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄的照片。

当您构建任何 React 应用程序时，毫无疑问，您的应用程序会跨多个屏幕和视图重用组件。事实上，如果你正确地遵循了原子设计，那么你可能会立即达到这一点。

StorybookJS 是开发、记录和可视化测试代码库中组件的完美工具。

*   当开发人员进入项目或者检查一些新的变更时，可以更容易地看到哪些组件是可用的。
*   它使得修改组件更快，而不必加载整个应用程序来测试简单的更改。
*   以这种方式构建组件使您能够编写更简洁的组件，因为它允许您有意识地构建组件的 API。

遗憾的是，许多团队拖延了太长时间才把故事书添加到他们的应用程序中，因为他们认为他们必须立刻把整个应用程序转移到故事书上。

这不仅是不真实的，而且是反目标的。为什么？

1.  许多组件会过于复杂，并且不会从立即添加到 Storybook 中获益。
2.  目前正在使用一个组件的开发人员会记住它的用例以及上下文，所以他们会知道什么是有意义的。他们应该决定是否添加以及如何添加。

因此，为了尽快开始并*启用我们的团队，*我们应该用最少的时间设置它，用最简单的例子，这样你就可以随着时间的推移学习和发展最佳实践。

今天就开始使用 Storybook，添加你最简单的组件(你的“原子”)并从那里开始。

# 我们如何开始？

## 建立图书馆

这意味着遵循[入门指南](https://storybook.js.org/docs/react/get-started/install)。TL；DR:使用`npx sb init`将样板故事书配置添加到您的 repo 中。

如果你使用定制的网络包，这可能需要一些欺骗。，但是总体设置应该还是很简单的。

## 为原子补充一些琐碎的故事

这些应该是绝对最简单的组件。如果您有时间，您可以迁移一些，但是如果您的团队正处于尝试交付新产品或新特性的紧张状态，我将着重于添加一个示例。

一些建议:排版和按钮是最简单的。不管你在做什么，我相信你有办法在你的应用程序中共享排版风格(全局的，样式化的组件，等等)。).

请将此视为记录您的标题(h1-h6)和各种文本元素的最简单方法，无论您在应用程序中实际会使用它们:

恭喜你！现在，您的应用程序有了一个故事书设计系统。提交，你就可以开始了！

# 工作时开始添加重要的组件

每当您更新一个组件的设计时，向 Storybook 添加一个故事文件是一个很好的做法。在 80%的情况下，添加一个`*.stories.js`只需要几分钟。

> “故事捕捉 UI 组件的呈现状态。开发人员为每个组件编写多个故事，描述一个组件可以支持的所有‘有趣’状态。”— [故事书文档](https://storybook.js.org/docs/react/get-started/whats-a-story)

通常，组件的每个状态都有一个故事:

这是一个故事所能得到的最基本的东西，并且没有利用 Storybook 的附加工具，我将在稍后描述这些工具。

如果一个故事有任何复杂之处，比如依赖于一个你还没有模仿的背景或者其他一些神秘的问题(它们偶尔会出现)，让你的最佳判断来使它工作，而不是完成你的工作。如果只是某个页面上的一些小的内容变化，那么可能不值得分心。

你有两个选择。

## 1.重构组件并导出无状态版本

在构建新组件时，这通常是最好的方法。这些种类的外部依赖通常是无意的。它们在构建时没有考虑重用或模块化。花在重构上的时间可以更容易地展示组件中难以访问的状态，并且可以有效地作为组件的一组可视化单元测试。

一旦您的组件导出了一个功能性的无状态 UI 组件，您就可以将它添加到 Storybook:

在这个例子中，你会注意到我们使用了 [Storybook 的 args](https://storybook.js.org/docs/react/writing-stories/args) 。这些可能会变得复杂，但它们本质上是为特定故事设置道具的一种更便捷的方式。

在这个例子中，Header 组件已经变成了一个无状态组件，两个状态(`header`和`authenticatedHeader`)各有自己的故事，而`userProfile`对象作为道具被传入。

## 2.利用你所拥有的，并成为它的提供者

如果您正在使用的组件是一个更高级的有机体组件，比如具有嵌套连接组件的页面，您可能需要将其包装在一个提供者中。

这可能是依赖关系的模拟实例，甚至可能是真实实例。这意味着您将以类似于组件在应用程序中的使用方式来显示组件，这可能是最简单的工作方式。

例如，假设您正在开发一个 React/Redux 应用程序，并希望添加包含嵌套连接组件和一些 React 路由器链接的页面组件。这将要求您包含一个 Redux 上下文和 React 路由器上下文:

你会注意到我已经和[装饰者](https://storybook.js.org/docs/react/writing-stories/decorators)一起做了这个。这些都是简单的功能，可以修改额外的标记和更多的每个故事。在这种情况下，它为添加多个提供者提供了一种非常简洁的方式。

要显示不同的状态，您可以自己调度简单的事件:

您会注意到，我必须在这里发送一个注销操作。这是因为，在这种情况下，我的每个故事都共享相同的 store 全局实例。

然而，如果我们要更进一步，模仿我们的存储，那么我们可以创建一个重置方法。在这种情况下，我没有时间也没有必要进行模拟——我想让事情变得简单——所以我简单地使用了我现有的商店。

请记住，我们在这里试图务实。我们只是想要一个简单的例子来说明我们的组件是如何使用的。

# 概括起来

您应该将 StorybookJS 添加到您的应用程序中，以便于 React 组件的开发、文档编制和测试。

你今天就应该这样做，从一些简单的现有原子组件开始，比如排版。不要把它变成几个月的努力。

当添加任何开发人员工具时，您应该总是以增量方式进行。开发人员需要时间来适应新的工作流程。像嘲讽这种模式的建立和实现需要时间。就像你的组件本身一样，你的团队在你的设计系统/应用中使用的模式应该随着时间的推移而改进和成熟，从最简单的版本开始。

所以，请走出去，今天就把故事书添加到你的应用程序中。这只需要大约 25 分钟，随着时间的推移，将使您的整个开发流程更好。