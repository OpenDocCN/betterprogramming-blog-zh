<html>
<head>
<title>Write a Script to Back Up Files to Google Drive in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python写一个脚本将文件备份到Google Drive</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/uploading-files-to-google-drive-with-python-d08ae8fcbc49?source=collection_archive---------4-----------------------#2019-12-22">https://betterprogramming.pub/uploading-files-to-google-drive-with-python-d08ae8fcbc49?source=collection_archive---------4-----------------------#2019-12-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4018" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在事情发生之前，备份它！</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/d259f461c79b0cd385ed778eab921d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZA__tJ4qTgd-WafUhutv6w.jpeg"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">照片由<a class="ae kw" href="https://unsplash.com/@hishahadat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">沙哈达特·拉赫曼</a>在<a class="ae kw" href="https://unsplash.com/s/photos/python?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="1bc3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">有一天，我的一位同事问我是否为重要文件和文件夹设置了定期备份。虽然我以前用过Dropbox和Google Drive，但我真的希望能够更精细地控制我想要备份的内容。此外，我对使用Python备份重要文件很感兴趣。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="71f6" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">PyDrive简介</h1><p id="df7e" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated"><code class="fe mx my mz na b">PyDrive</code>是<a class="ae kw" href="https://github.com/google/google-api-python-client" rel="noopener ugc nofollow" target="_blank">Google-API-python-client</a>的包装库，简化了许多常见的Google Drive API任务。虽然<a class="ae kw" href="https://developers.google.com/drive/" rel="noopener ugc nofollow" target="_blank"> Google Drive API </a>为您提供了连接到Drive API端点并进行必要调用的必要功能，但我发现<code class="fe mx my mz na b">PyDrive</code>让生活变得更加简单，尤其是对于喜欢编写较少样板代码的Python开发人员来说，尤其是因为:</p><ul class=""><li id="1f54" class="nb nc iq kz b la lb ld le lg nd lk ne lo nf ls ng nh ni nj bi translated">将<code class="fe mx my mz na b">OAuth2.0</code>简化为几行灵活设置的代码。</li><li id="bd68" class="nb nc iq kz b la nk ld nl lg nm lk nn lo no ls ng nh ni nj bi translated">将驱动API包装到每个资源的类中，使您的程序更加面向对象。</li><li id="5350" class="nb nc iq kz b la nk ld nl lg nm lk nn lo no ls ng nh ni nj bi translated">它有助于除API调用之外的常见操作，如内容获取和分页控制。</li></ul><p id="bee4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">说够了，我们开始吧！</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="c00a" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">证明</h1><p id="8e2b" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">在你做任何事情之前，去你的<a class="ae kw" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">谷歌开发者控制台</a>，你应该会看到一个标题为<code class="fe mx my mz na b">OAuth 2.0 client IDs</code>的部分。点击列表中的一个条目，你会看到许多字段，包括<code class="fe mx my mz na b">Client secret</code>。</p><p id="f058" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果您尚未创建凭证，请单击<code class="fe mx my mz na b">Create credentials</code>按钮并按照说明创建新凭证，然后按照上述步骤找到<code class="fe mx my mz na b">Client secret</code>。下载文件——它应该以<code class="fe mx my mz na b">client_secrets.json</code>的名称存储在本地。请不要提交此文件！</p><p id="5187" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">既然您已经在磁盘上获得了客户端机密文件，那么对驱动器API进行身份验证就很容易了——您将知道为什么:</p><pre class="kh ki kj kk gt np na nq nr aw ns bi"><span id="f1c9" class="nt mb iq na b gy nu nv l nw nx">g_login = GoogleAuth()<br/>g_login.LocalWebserverAuth()<br/>self.drive = GoogleDrive(g_login)</span></pre><p id="7126" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这将在您的web浏览器中自动打开一个窗口，要求您使用创建凭据时使用的帐户登录。单击正确的帐户将完成授权流程，现在您的代码就可以开始使用Google Drive APIs了。</p><p id="ff58" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">接下来，我们将看看如何创建文件和文件夹。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="e67d" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">创建文件夹和文件</h1><p id="dbed" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">文件夹是只包含元数据的文件，可以用来组织Google Drive中的文件。具体来说:</p><ul class=""><li id="1367" class="nb nc iq kz b la lb ld le lg nd lk ne lo nf ls ng nh ni nj bi translated">文件夹是一个MIME类型的文件，没有扩展名。</li><li id="d5d6" class="nb nc iq kz b la nk ld nl lg nm lk nn lo no ls ng nh ni nj bi translated">您可以使用别名<code class="fe mx my mz na b">root</code>来引用提供了文件ID的根文件夹</li></ul><pre class="kh ki kj kk gt np na nq nr aw ns bi"><span id="78f5" class="nt mb iq na b gy nu nv l nw nx">drive_folder = self.drive.CreateFile({<br/>    'title': dir_name,<br/>    "mimeType": "application/vnd.google-apps.folder"<br/>})</span><span id="f581" class="nt mb iq na b gy ny nv l nw nx">drive_folder.Upload()</span></pre><p id="56e3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">文件的创建方式有点类似:</p><pre class="kh ki kj kk gt np na nq nr aw ns bi"><span id="fd18" class="nt mb iq na b gy nu nv l nw nx">f = self.drive.CreateFile({<br/>    'title': "{}".format(filename),<br/>    "parents": [{"id": gdrive_folder_id}]<br/>})<br/>f.SetContentFile(filename.open())<br/>f.Upload()</span></pre><p id="4d8a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">记住——在调用file对象上的<code class="fe mx my mz na b">Upload()</code>方法之前，不会在Google drive上创建文件夹或文件。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="b752" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">MIME类型</h1><p id="6c74" class="pw-post-body-paragraph kx ky iq kz b la ms jr lc ld mt ju lf lg mu li lj lk mv lm ln lo mw lq lr ls ij bi translated">一种<strong class="kz ir">媒体类型</strong>(也称为<strong class="kz ir">多用途互联网邮件扩展或MIME类型</strong>)是一种标准，它指示文档、文件或各种字节的性质和格式。它在IETF的<a class="ae kw" href="https://tools.ietf.org/html/rfc6838" rel="noopener ugc nofollow" target="_blank"> RFC 6838 </a>中被定义和标准化。</p><p id="fc2a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当您在Google Drive上创建文件时，您需要提供文件的正确mime类型——否则，内容将无法正确上传。</p><p id="b9b2" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">有一个很棒的Python库叫做mime-types，可以让你猜测文件的mime类型。</p><pre class="kh ki kj kk gt np na nq nr aw ns bi"><span id="1373" class="nt mb iq na b gy nu nv l nw nx">import mimetypes<br/>mime_type = mimetypes.guess_type(filename)</span></pre><p id="aa79" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">将所有这些放在一起:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="d6ac" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">完整的代码可以在这里找到:<br/><a class="ae kw" href="https://github.com/sauravbiswasiupr/backup-wizard" rel="noopener ugc nofollow" target="_blank">https://github.com/sauravbiswasiupr/backup-wizard</a></p></div></div>    
</body>
</html>