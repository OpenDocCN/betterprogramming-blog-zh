<html>
<head>
<title>Formatting The Apache Kafka Console Consumer Output</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">格式化Apache Kafka控制台消费者输出</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/formatting-apache-kafka-console-consumer-output-db481449d8b5?source=collection_archive---------7-----------------------#2022-02-09">https://betterprogramming.pub/formatting-apache-kafka-console-consumer-output-db481449d8b5?source=collection_archive---------7-----------------------#2022-02-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b061" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">消费所有信息</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d5061609a76e19f611a0d0544fe7d10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*81Ry6N0rc56c6YmI"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">凯文·Ku在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f32d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">任何曾经和Kafka一起工作过的人一定都有一些关于控制台消费者输出的想法。通常，不可避免地会出现至少两个问题:</p><ul class=""><li id="d7e1" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated"><em class="ls">如何打印X？— </em> X可以是“key”、“partition”、“offset”、“timestamp”、“header”..所有可能非常有用但不属于默认输出的位。在2.6及更早的版本中，这是一个更大的问题，因为上面的一些属性根本不可用。</li><li id="9886" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">我该如何在这些乱七八糟的字符中找到我所需要的呢？ —一旦你看到自己想要的东西是什么样子，那种想出如何打印的快乐是短暂的。</li></ul><p id="f81c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你已经谷歌了所有这些，你知道你可以使用<code class="fe mh mi mj mk b"><strong class="ky ir">kafkacat</strong></code>，这是一个完全可行的选择。然而，我给你提供了一个更有创意、更灵活的替代方案。</p><p id="2a83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前所述，就完整性而言，Kafka的最新版本确实提供了通过分别传递每个附加属性来打印记录的更多细节的方法。</p><pre class="kg kh ki kj gt ml mk mm mn aw mo bi"><span id="4407" class="mp mq iq mk b gy mr ms l mt mu">kafka-console-consumer \<br/>  --bootstrap-server localhost:9092 \<br/>  --topic my_topic \<br/>  --property print.offset=true \<br/>  --property print.partition=true \<br/>  --property print.headers=true \<br/>  --property print.timestamp=true \<br/>  --property print.key=true</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/ec76e5e3220e703fa51c6f4486571662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OryyGAfPrrA5FqA8WuxJFA.png"/></div></div></figure><p id="8d76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，如果您被遗留代码所困，或者由于某种原因仍然在旧版本上工作，那么您的选择是非常有限的</p><pre class="kg kh ki kj gt ml mk mm mn aw mo bi"><span id="4306" class="mp mq iq mk b gy mr ms l mt mu">kafka-console-consumer \<br/>  --bootstrap-server localhost:9092 \<br/>  --topic my_topic</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/fcb6680067e27fb86f121709e7f5db54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U7PemiLV2fD_36FdRi0DQA.png"/></div></div></figure><p id="92f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您需要阅读3到4条以上的消息，并且不止一次，那么这两种方式都不太好。相信我，如果你转而盯着这样的东西看，你的眼睛会感谢你的:</p><pre class="kg kh ki kj gt ml mk mm mn aw mo bi"><span id="eef7" class="mp mq iq mk b gy mr ms l mt mu">kafka-console-consumer \<br/>  --bootstrap-server localhost:9092 \<br/>  --topic my_topic \<br/>  --property print.offset=true \<br/>  --property print.partition=true \<br/>  --property print.headers=true \<br/>  --property print.timestamp=true \<br/>  --property print.key=true \<br/>  --formatter my.custom.KafkaMetricsFormatter</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/a88e5fc4fa715cb204f4aad3201d038b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l9nyWPTkN4w5TxIYOPUm6A.png"/></div></div></figure><p id="e6cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我并不是说这种设计是你应该追求的，我想说的是，有一种方法可以以你想要的任何方式格式化输出——添加颜色和间距，为什么不疯狂地使用下划线或加粗。</p><p id="edcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，这非常简单，只需15分钟，从长远来看，可能会为你节省更多时间...或者至少让你对使用游戏机消费者感觉更好，或者只是我？</p><p id="6504" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无论如何，让我们看看如何实现这一点:</p><p id="a79e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，创建一个scala项目，并添加Kafka作为依赖项。</p><pre class="kg kh ki kj gt ml mk mm mn aw mo bi"><span id="202c" class="mp mq iq mk b gy mr ms l mt mu">libraryDependencies += "org.apache.kafka" %% "kafka" % "3.1.0"</span></pre><p id="8531" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其次，创建一个新的scala类，扩展<code class="fe mh mi mj mk b">DefaultMessageFormatter</code> <strong class="ky ir"> </strong>并覆盖<code class="fe mh mi mj mk b">writeTo</code>方法，以你喜欢的任何方式进行格式化。</p><p id="d164" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上述示例的代码如下所示:</p><pre class="kg kh ki kj gt ml mk mm mn aw mo bi"><span id="0168" class="mp mq iq mk b gy mr ms l mt mu">import Console._</span><span id="e79c" class="mp mq iq mk b gy my ms l mt mu">override def writeTo(consumerRecord: ConsumerRecord[Array[Byte], Array[Byte]], output: PrintStream): Unit = {<br/><br/>  def deserialize(deserializer: Option[Deserializer[_]], sourceBytes: Array[Byte], topic: String) = {<br/>    val nonNullBytes = <em class="ls">Option</em>(sourceBytes).getOrElse(<em class="ls">nullLiteral</em>)<br/>    val convertedBytes = deserializer<br/>      .map(d =&gt; utfBytes(d.deserialize(topic, consumerRecord.headers, nonNullBytes).toString))<br/>      .getOrElse(nonNullBytes)<br/>    convertedBytes<br/>  }<br/><br/>  import consumerRecord._<br/><br/>  if (<em class="ls">printTimestamp </em>&amp;&amp; timestampType != TimestampType.<em class="ls">NO_TIMESTAMP_TYPE</em>) {<br/>    output.write(utfBytes(s"<strong class="mk ir">$</strong><em class="ls">CYAN</em>└── <strong class="mk ir">$</strong>timestampType:<strong class="mk ir">$</strong><em class="ls">RESET </em><strong class="mk ir">$</strong>timestamp"))<br/>    output.write(<em class="ls">lineSeparator</em>)<br/>  }<br/><br/>  if (<em class="ls">printPartition</em>) {<br/>    output.write(utfBytes(s"<strong class="mk ir">$</strong><em class="ls">CYAN</em>└── Partition:<strong class="mk ir">$</strong><em class="ls">RESET </em><strong class="mk ir">$</strong>{partition().toString}"))<br/>    output.write(<em class="ls">lineSeparator</em>)<br/>  }<br/><br/>  if (<em class="ls">printOffset</em>) {<br/>    output.write(utfBytes(s"<strong class="mk ir">$</strong><em class="ls">CYAN</em>└── Offset:<strong class="mk ir">$</strong><em class="ls">RESET </em><strong class="mk ir">$</strong>{offset().toString}"))<br/>    output.write(<em class="ls">lineSeparator</em>)<br/>  }<br/><br/>  if (<em class="ls">printHeaders</em>) {<br/>    if (!headers().toArray.isEmpty) {<br/>      output.write(utfBytes(s"<strong class="mk ir">$</strong><em class="ls">CYAN</em>└── Headers:<strong class="mk ir">$</strong><em class="ls">RESET </em>"))<br/>    }<br/>    val headersIt = headers().iterator<br/>    while (headersIt.hasNext) {<br/>      val header = headersIt.next()<br/>      output.write(utfBytes(s"\n\t<strong class="mk ir">$</strong>{header.key()}: "))<br/>      output.write(deserialize(<em class="ls">headersDeserializer</em>, header.value(), topic))<br/>      if (headersIt.hasNext) {<br/>        output.write(<em class="ls">headersSeparator</em>)<br/>      }<br/>    }<br/>    output.write(<em class="ls">lineSeparator</em>)<br/>  }<br/><br/>  if (<em class="ls">printKey</em>) {<br/>    output.write(utfBytes(s"<strong class="mk ir">$</strong><em class="ls">CYAN</em>└── Key:<strong class="mk ir">$</strong><em class="ls">RESET </em>"))<br/>    output.write(deserialize(<em class="ls">keyDeserializer</em>, key, topic))<br/>    output.write(<em class="ls">lineSeparator</em>)<br/>  }<br/><br/>  if (<em class="ls">printValue</em>) {<br/>    output.write(deserialize(<em class="ls">valueDeserializer</em>, value, topic))<br/>    output.write(<em class="ls">lineSeparator</em>)<br/>    output.write(utfBytes(s"---------------"))<br/>    output.write(<em class="ls">lineSeparator</em>)<br/>  }<br/>}<br/><br/>private def utfBytes(str: String) = str.getBytes(StandardCharsets.<em class="ls">UTF_8</em>)</span></pre><p id="45a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第三，通过运行以下命令创建jar:</p><pre class="kg kh ki kj gt ml mk mm mn aw mo bi"><span id="f10a" class="mp mq iq mk b gy mr ms l mt mu">sbt assembly</span></pre><p id="4792" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第四，将生成的jar从<code class="fe mh mi mj mk b">&lt;project&gt;/target/jars/**</code>复制或移动到本地Kafka安装的libs目录中(应该类似于<code class="fe mh mi mj mk b">**/usr/local/Cellar/kafka/3.0.1/libexec/libs/**</code>)。</p><p id="e2fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，只需将它传递给任何Kafka-console-consumer命令即可使用和享受:</p><pre class="kg kh ki kj gt ml mk mm mn aw mo bi"><span id="b8e0" class="mp mq iq mk b gy mr ms l mt mu">--formatter my.custom.KafkaMessageFormatter</span></pre><p id="3b9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里看到完整的参考代码<a class="ae kv" href="https://github.com/IYordanova/KafkaMessageFormatter" rel="noopener ugc nofollow" target="_blank">，或者克隆并按原样使用，或者根据你的喜好进行编辑。</a></p><p id="c692" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，有了这个很酷的控制台输出..消耗所有消息！！</p></div></div>    
</body>
</html>