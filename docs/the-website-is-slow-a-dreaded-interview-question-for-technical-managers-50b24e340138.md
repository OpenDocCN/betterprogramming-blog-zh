# “网站很慢”——这是一个让技术经理害怕的面试问题

> 原文：<https://betterprogramming.pub/the-website-is-slow-a-dreaded-interview-question-for-technical-managers-50b24e340138>

## 了解调查慢速网站的最佳实践

![](img/30ff15c94ea25acee01759f8669329aa.png)

由 [Freepik](https://www.freepik.com/) 上的 [Vectorjuice](https://www.freepik.com/vectorjuice) 拍摄的照片

如果你是一名技术项目经理(TPM)，软件开发经理(SDM)，或者是一名技术领域的经理，你应该会在即将到来的面试中遇到技术问题。最好的问题是开放式的，可以缩小到多个层次，以评估候选人在各种技术方面的知识深度。

我见过许多技术角色被问到的一个常见问题是:

> 你的公司网站很慢。调查根本原因并提出缓解或解决问题的解决方案。

这个问题没有唯一的最佳答案，但是有许多好的实际场景可以和面试官讨论:

# 1.澄清问题

首先，检查网站，验证它确实很慢！帮助您更好地理解问题的可能问题:

*   你的网站的加载时间 [SLA](https://en.wikipedia.org/wiki/Service-level_agreement) (服务水平协议)是多少？也许在你看来并不慢，但是加载时间超过了 SLA。
*   网站是否普遍较慢，或者某些特定模块(如客户评分)的加载时间比预期的长？
*   是一直慢还是某个时间段慢？(例如仅在工作时间)？
*   是否所有设备(台式机、手机、平板电脑等)都很慢。)?
*   对于不同地理位置的用户是否很慢？

你明白了这个想法，我很确定你可以在上面的列表中添加更多。根据对以上任何一个问题的回答，高延迟可能是由不同的根本原因引起的。

# 2.日志/指标

一旦您澄清了问题，开始检查日志和指标是一个好的实践。指标是让您更深入了解服务状态的手段。CPU 使用率、内存消耗、磁盘 I/O、服务器上的请求率、数据库响应延迟以及缓存命中/未命中的数量是开始时要观察的常见因素。您还可以检查服务器日志，查看是否有服务器出现故障，或者确认是否是某些特定的请求导致了问题。

# 3.最近提交

根据我的经验，除非基础设施陈旧或维护不善，否则硬件故障很少发生。此外，与硬件相关的事件可以被快速发现和修复。

大多数新问题都是由使用模式的意外变化(例如，请求数量的突然增加)或“错误提交”引起的！检查事件的开始时间，并确认它不接近最近的部署时间。如果是这样，请检查最近版本中的提交，并评估是否有任何可能导致延迟的提交。

# 4.前端模块

如果网站具有繁重的前端组件或执行复杂的操作，请调查高延迟是否是由前端引起的。有时，像图像、js 和 CSS 文件这样的资源需要很长时间来加载。以下是一些可能的改进:

*   减少资源的大小:调整图像大小，缩小 js 文件，删除不用的代码。
*   缓存大量经常使用的资源，这样就不需要每次加载网站时都从“源服务器”下载资源。内容交付网络([cdn](https://en.wikipedia.org/wiki/Content_delivery_network))非常适合缓存频繁的资源，以减少地理上分散的客户端的下载时间。

![](img/a1c6952e69e1ecf016b15b179c89d510.png)

(左)单服务器分发与(右)CDN 分发方案，照片由 [Kanoha](https://commons.wikimedia.org/w/index.php?title=User:Kanoha&action=edit&redlink=1) 在 [Wikimedia](https://commons.wikimedia.org/wiki/File:NCDN_-_CDN.png) 上拍摄

许多在线服务，如 Google [PageSpeed Insights](https://developers.google.com/speed/pagespeed/insights/) 可以识别网站的前端问题，并提出改进建议。

# 5.后端服务器

高延迟可能是由 web 服务器和其他后端服务引起的。一个设计良好的架构应该有警报，并自动替换不健康的服务器(如果运行在 VM 上)。确保问题确实出在服务器上，而不是运行在服务器上的服务。例如，如果服务导致内存泄漏，即使您更换/重新启动服务器，该问题稍后也会再次出现。

一种常见的情况是，服务器上的负载高于服务器的承受能力，导致处理请求的延迟时间更长。如果您使用一台服务器，可以考虑在“负载平衡器”后面添加更多的服务器，将负载分布在多台机器上。如果在一天中的特定时间出现高负载，请提前计划并在高峰负载期间添加更多机器。如果负载模式是意外的，一种选择是使用自动缩放，根据传入的负载自动缩放。

如果您的服务接收到大量相同的请求，并且您可以容忍短时间内可能的不一致性(最终一致性)，那么可以考虑在您的服务器前面添加一个缓存。

# 6.外部服务

有时，您的服务做得很好，但它必须等待外部依赖项的响应(例如，外部服务处理目录细节，而您的在线商店必须等待在网站上显示商品细节)。在这种情况下，除非外部服务所有者与您合作进行一些调整，否则您什么也做不了。另一个选择是，如果您的需求允许，为外部服务响应添加一个缓存。此外，考虑对其他服务进行异步调用，以避免不必要的响应等待。

# 7.数据库

数据库是系统的重要组成部分，如果在系统架构中没有得到有效的使用，会导致许多问题。谈到高延迟，可以根据根本原因提出可能的解决方案:

*   **伸缩:**在非 SQL 数据库上，可以[水平伸缩](https://en.wikipedia.org/wiki/Scalability#Horizontal_or_scale_out)(添加更多节点)。在 SQL one 上，您可以[垂直扩展](https://en.wikipedia.org/wiki/Scalability#Vertical_or_scale_up)(将数据库服务放在更强大的服务器上)。
*   **分片:**如果数据模型允许，您可以将数据库分成更小的部分，并将每个部分存储在单独的机器上。例如，您可以将北美、欧洲和亚洲用户的配置文件信息存储在不同的数据库中。
*   **副本:**另一个选项是添加一个副本(数据库的副本)，这样负载可以分布在多个副本中，而不是轰击单个实例。在常见的情况下，每次写入都会填充到所有副本，但读取查询可以访问任何副本。一个例子是在每个地理位置都有副本，这样每个读取请求都会到达地理上最近的数据库。
*   **缓存:**如果数据不经常变化，减少数据库负载和响应延迟的一个很好的解决方案是使用像 [Redis](https://en.wikipedia.org/wiki/Redis) 这样的内存缓存。
*   **处理缓慢的查询:**来自应用程序的复杂而缓慢的查询会导致高延迟。例如，如果一个查询需要多个表连接，就会给数据库服务器带来巨大的负载，并增加整体延迟。评估查询的执行时间，并评估是否可以通过添加更多索引、使用更简单的查询甚至重新设计数据模型来改进频繁的复杂查询。
*   **连接池:**可能有大量未使用的数据库连接。设计良好的连接池有助于重用空闲连接，并避免创建新的数据库连接。

# 如何避免类似情况？

一个很好的后续问题是如何避免类似情况在未来再次发生。您可以考虑的一些可能选项包括:

*   **提前计划:**如果你正在开展一项活动，或者你预计网站的负载会很高，你可以提前计划和调整，以免为时过晚。在亚马逊，像黄金日和黑色星期五这样的重大活动，我们提前几个月就计划好了。
*   **添加指标/警报:**尝试添加与服务健康相关的指标/警报，以便立即注意到任何问题。
*   **添加自动回滚:**添加一个自动回滚机制，如果部署后出现问题，可以立即回滚可能有害的版本。
*   **运行负载/性能测试:**偶尔对您的服务运行负载和性能测试，以捕捉您的架构或服务的潜在问题，比如内存泄漏。
*   **添加更多的自动化测试:**增加服务的测试覆盖率，以减少不良提交未被发现的机会。单元测试、集成测试、端到端测试等等可以帮助你实现这个目标。