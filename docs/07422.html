<html>
<head>
<title>Write More Efficient Unix Scripts With Heredoc</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Heredoc编写更高效的Unix脚本</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/write-more-efficient-unix-scripts-with-heredoc-639719d0e660?source=collection_archive---------7-----------------------#2021-01-13">https://betterprogramming.pub/write-more-efficient-unix-scripts-with-heredoc-639719d0e660?source=collection_archive---------7-----------------------#2021-01-13</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="83f4" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">heredoc简介，让脚本更简洁</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/0d16af1b9f3ec45bbf126e424020904c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JdgaXupP8UH1McL7"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@sapegin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Artem Sapegin </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="a072" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一个<a class="ae kz" href="https://en.wikipedia.org/wiki/Here_document" rel="noopener ugc nofollow" target="_blank">这里的文档</a>，通常被称为heredoc，是一段代码，它通过输入流向交互程序或命令发送一个命令列表。您可以在bash、zsh、ksh、csh和许多其他Unix shells中使用它。它通常与<code class="fe lw lx ly lz b">ssh</code>、<code class="fe lw lx ly lz b">sftp</code>、<code class="fe lw lx ly lz b">cat</code>和<code class="fe lw lx ly lz b">tee</code>命令一起使用。</p><p id="57dd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Heredoc是一个强大的工具，可以让您的shell脚本更加整洁和高效。当您想要执行多个命令时，它非常有用。我们将通过简单的例子来介绍它最有用的特性。</p><p id="e112" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们开始吧！</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="69d5" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">句法</h1><p id="8e74" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">Heredoc使用以下形式的语法:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="25f7" class="ni mi iu lz b gz nj nk l nl nm">some command &lt;&lt; delimiter<br/>Heredoc block of code<br/>delimiter</span></pre><p id="0f37" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它需要<code class="fe lw lx ly lz b">&lt;&lt;</code>重定向操作符和一个分隔符标记。分隔符标记可以是任何唯一的标记。通常命名为<code class="fe lw lx ly lz b">EOF</code>或<code class="fe lw lx ly lz b">END</code>。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="c29b" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">示例用法</h1><h2 id="cf13" class="ni mi iu bd mj nn no dn mn np nq dp mr lj nr ns mt ln nt nu mv lr nv nw mx nx bi translated">多行sftp命令</h2><p id="b1bb" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">为了理解使用heredoc的好处，让我们看一下下面的脚本:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div></figure><p id="9200" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该程序执行多个<code class="fe lw lx ly lz b">sftp</code>命令。首先，它在您的本地<code class="fe lw lx ly lz b">tmp</code>目录中创建一个文件。然后，它使用<code class="fe lw lx ly lz b">sftp</code>命令将文件传输到远程服务器。假设您有一个名为<code class="fe lw lx ly lz b">file</code>的远程文件。该脚本将删除它，并用新上传的文件替换它。</p><p id="95c0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">将脚本保存为<code class="fe lw lx ly lz b">.sh</code>文件，并在您的终端中运行。注意，我已经设置了一个SSH密钥来登录我的远程服务器。因此，我不需要提供密码。</p><p id="7561" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这是输出:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="7398" class="ni mi iu lz b gz nj nk l nl nm">$bash simple_script.sh</span><span id="7369" class="ni mi iu lz b gz oa nk l nl nm">sftp&gt; put /tmp/somefile /home/user/file_tmp<br/>sftp&gt; -rm /home/user/file<br/>sftp&gt; rename /home/user/file_tmp /home/user/file<br/>sftp&gt; quit</span></pre><p id="e404" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这种方法没有错。然而，它可以更优雅。</p><p id="37f3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是如何使用heredoc重写脚本:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div></figure><p id="f8aa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">执行脚本:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ny nz l"/></div></figure><p id="8141" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如你所见，结果是一样的。现在比较这两个脚本。第二个更整洁，不是吗？</p><h2 id="4783" class="ni mi iu bd mj nn no dn mn np nq dp mr lj nr ns mt ln nt nu mv lr nv nw mx nx bi translated">使用ssh的多行命令</h2><p id="1c6a" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">让我们看看在使用<code class="fe lw lx ly lz b">ssh</code>时如何利用heredoc的特性。假设您想要执行多个命令(例如，在远程服务器上创建目录)。你会这样做:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="f551" class="ni mi iu lz b gz nj nk l nl nm">ssh -T user@host "mkdir /home/user/dir1"<br/>ssh -T user@host "mkdir /home/user/dir2"</span></pre><p id="1004" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这会有用的。但是，您必须多次执行<code class="fe lw lx ly lz b">ssh</code>命令，效率不是很高。</p><p id="1e76" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Heredoc的做法如下所示:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="202d" class="ni mi iu lz b gz nj nk l nl nm">ssh -T user@host &lt;&lt; EOF<br/>mkdir /home/user/dir1<br/>mkdir /home/user/dir2<br/>EOF</span></pre><h2 id="1b5e" class="ni mi iu bd mj nn no dn mn np nq dp mr lj nr ns mt ln nt nu mv lr nv nw mx nx bi translated">使用cat的多行命令</h2><p id="2af4" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">让我们看看另一个有用的例子。当与<code class="fe lw lx ly lz b">cat</code>命令结合使用时，Heredoc非常方便。您可以将多个命令传递给<code class="fe lw lx ly lz b">cat</code>,并作为单个命令或脚本执行它们:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="90ae" class="ni mi iu lz b gz nj nk l nl nm">cat &lt;&lt; EOF<br/>The current date and time is: $(date)<br/>The current kernel version is: $(uname -r)<br/>The current directory is: $PWD<br/>EOF</span></pre><p id="9de4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">输出:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="3225" class="ni mi iu lz b gz nj nk l nl nm">The current date and time is: Sat Jan 9 16:09:06 CET 2021<br/>The current kernel version is: 19.6.0<br/>The current directory is: /home/user/heredoc</span></pre><p id="f1e2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请记住，如果您引用分隔符，参数将不会被解析:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="2289" class="ni mi iu lz b gz nj nk l nl nm">cat &lt;&lt; "EOF"<br/>The current date and time is: $(date)<br/>The current kernel version is: $(uname -r)<br/>The current directory is: $PWD<br/>EOF</span></pre><p id="ad0f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">输出:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="7af4" class="ni mi iu lz b gz nj nk l nl nm">The current date and time is: $(date)<br/>The current kernel version is: $(uname -r)<br/>The current directory is: $PWD</span></pre><h2 id="c8c6" class="ni mi iu bd mj nn no dn mn np nq dp mr lj nr ns mt ln nt nu mv lr nv nw mx nx bi translated">参数和命令替换</h2><p id="2710" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">Heredoc接受参数和命令替换。例如，我们已经在我们的<code class="fe lw lx ly lz b">sftp</code>程序中使用了<code class="fe lw lx ly lz b">{user}</code>作为参数替换。另一个例子是我们刚刚在上面使用的<code class="fe lw lx ly lz b">$date</code>命令。</p><h2 id="dccb" class="ni mi iu bd mj nn no dn mn np nq dp mr lj nr ns mt ln nt nu mv lr nv nw mx nx bi translated">取消制表符缩进</h2><p id="0799" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">使用heredoc，您可以取消制表符缩进。这可以简单地通过向重定向操作符添加一个<code class="fe lw lx ly lz b">-</code>来完成:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="fd5b" class="ni mi iu lz b gz nj nk l nl nm">cat &lt;&lt;-EOF<br/>First line<br/>      Second line<br/>EOF</span></pre><p id="7389" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这导致:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="28bc" class="ni mi iu lz b gz nj nk l nl nm">First line<br/>Second line</span></pre><h2 id="7285" class="ni mi iu bd mj nn no dn mn np nq dp mr lj nr ns mt ln nt nu mv lr nv nw mx nx bi translated">简洁的评论</h2><p id="9ead" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">heredoc的另一个有用的特性是，你可以让你的脚本中的注释更具可读性。想象一下，你要写一篇很长的评论。通常情况下，你会在每个注释行前面放一个<code class="fe lw lx ly lz b">#</code>符号。Heredoc通过使用如下的<code class="fe lw lx ly lz b">:</code>命令使它变得更加优雅:</p><pre class="kk kl km kn gu ne lz nf ng aw nh bi"><span id="50bc" class="ni mi iu lz b gz nj nk l nl nm">: &lt;&lt;'EOF'<br/>This is a test comment<br/>to demonstrate heredoc<br/>features<br/>EOF</span></pre></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="5a42" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">结论</h1><p id="f1e9" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">在本教程中，我们已经看到了heredoc最强大的特性。</p><p id="86f1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在您知道了如何更高效、更优雅地执行多个命令，编写更可读的注释，以及在heredoc脚本中执行参数和命令替换。</p><p id="4b77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您喜欢这篇文章，您可能会喜欢我关于Unix提示和技巧的文章:</p><div class="ob oc gq gs od oe"><a href="https://medium.com/better-programming/automate-your-scripts-with-expect-9305faa6e2ff" rel="noopener follow" target="_blank"><div class="of ab fp"><div class="og ab oh cl cj oi"><h2 class="bd iv gz z fq oj fs ft ok fv fx it bi translated">使用Expect自动化您的脚本</h2><div class="ol l"><h3 class="bd b gz z fq oj fs ft ok fv fx dk translated">使用Expect脚本语言的强大功能来自动化您的程序</h3></div><div class="om l"><p class="bd b dl z fq oj fs ft ok fv fx dk translated">medium.com</p></div></div><div class="on l"><div class="oo l op oq or on os kt oe"/></div></div></a></div><div class="ob oc gq gs od oe"><a href="https://medium.com/better-programming/lesser-known-but-powerful-unix-commands-to-polish-your-tech-skills-b2ceec3e078a" rel="noopener follow" target="_blank"><div class="of ab fp"><div class="og ab oh cl cj oi"><h2 class="bd iv gz z fq oj fs ft ok fv fx it bi translated">鲜为人知但功能强大的Unix命令来提高您的技术技能</h2><div class="ol l"><h3 class="bd b gz z fq oj fs ft ok fv fx dk translated">带有简单示例的简便bash命令</h3></div><div class="om l"><p class="bd b dl z fq oj fs ft ok fv fx dk translated">medium.com</p></div></div><div class="on l"><div class="ot l op oq or on os kt oe"/></div></div></a></div><p id="0283" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">感谢您的阅读和快乐编码！</p></div></div>    
</body>
</html>