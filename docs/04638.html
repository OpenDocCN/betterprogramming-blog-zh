<html>
<head>
<title>How to Host a Serverless Spring Boot Web App Using AWS Fargate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用AWS Fargate托管无服务器的Spring Boot Web应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-host-a-serverless-springboot-web-application-using-aws-fargate-a3669d9eebd5?source=collection_archive---------5-----------------------#2020-04-27">https://betterprogramming.pub/how-to-host-a-serverless-springboot-web-application-using-aws-fargate-a3669d9eebd5?source=collection_archive---------5-----------------------#2020-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="16cd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">您不必再管理EC2实例了</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1e9dc1c9c01df72316455c1622a6a633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5XljACb9dFW0XWuImTEt5w.png"/></div></div></figure><p id="80cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您知道如何托管您的Spring Boot应用程序，而不用担心创建和维护底层EC2实例，以及如何能够足够快地自动伸缩以服务任何负载吗？你可以用AWS Fargate来做这个。</p><p id="8817" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们来看看。本文分为两部分:</p><ol class=""><li id="54c2" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">创建Springboot应用程序的docker图像，并将其上传到<a class="ae lw" href="https://aws.amazon.com/ecr/" rel="noopener ugc nofollow" target="_blank"> AWS ECR </a>(弹性容器注册中心)。</li><li id="3268" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">使用<a class="ae lw" href="https://docs.aws.amazon.com/AmazonECS/latest/userguide/what-is-fargate.html" rel="noopener ugc nofollow" target="_blank"> AWS Fargate </a>服务您的web应用程序。</li></ol></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="3fcf" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">先决条件</h1><ul class=""><li id="e234" class="ln lo iq kt b ku nb kx nc la nd le ne li nf lm ng lt lu lv bi translated">AWS帐户</li><li id="7755" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ng lt lu lv bi translated">AWS CLI</li><li id="f724" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ng lt lu lv bi translated">一点知识</li><li id="c636" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ng lt lu lv bi translated">码头工人</li><li id="4a64" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ng lt lu lv bi translated">专家</li><li id="2f9a" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ng lt lu lv bi translated">Java 8</li></ul><h2 id="9748" class="nh mk iq bd ml ni nj dn mp nk nl dp mt la nm nn mv le no np mx li nq nr mz ns bi translated">第1部分:创建Springboot应用程序的docker图像，并将其上传到AWS ECR(弹性容器注册中心)</h2><p id="68d5" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nt lc ld le nu lg lh li nv lk ll lm ij bi translated">首先，让我们为您现有的Spring Boot应用程序创建一个Docker文件。对于本文，我已经创建了一个示例Spring Boot web应用程序:<a class="ae lw" href="https://github.com/neyold/springboot-docker-container-demo" rel="noopener ugc nofollow" target="_blank">spring boot-docker-container-demo</a>，docker文件如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="61a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">关于Dockerfile的一些事情</strong></p><p id="d4b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Docker文件使用<em class="ny"> openjdk:8-jdk-alpine </em>作为基础映像。</p><p id="ad3e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">基本映像没有ECS运行状况检查所需的curl程序。它是通过apk命令安装的。</p><p id="6d2d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，cd进入项目目录…</p><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="8802" class="nh mk iq oa b gy oe of l og oh"><strong class="oa ir">$</strong> mvn clean install<br/><strong class="oa ir">$</strong> mvn package<br/><strong class="oa ir">$</strong> docker build -t serverlessdemo .<br/><strong class="oa ir">$</strong> docker images  <strong class="oa ir"># this will show all the docker images &amp; image IDs</strong></span></pre><p id="a020" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以在本地机器上运行docker映像:</p><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="a0bb" class="nh mk iq oa b gy oe of l og oh"><strong class="oa ir">$</strong> docker run -e EXTERNAL_PARAM=external-param1 serverlessdemo</span></pre><p id="fc3c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以找到您的docker容器IP，并在浏览器中试用它:</p><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="cd2f" class="nh mk iq oa b gy oe of l og oh"><strong class="oa ir">$</strong> docker ps  <strong class="oa ir"># get all running container IDs</strong><br/><strong class="oa ir">$</strong> docker inspect <strong class="oa ir">&lt;demo's container ID&gt;</strong></span><span id="22bd" class="nh mk iq oa b gy oi of l og oh"><strong class="oa ir"># find the IP address of the container from the output</strong></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/96dfd248a3874f4ee31bf1f3218cacb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*d_ACv8lWzClTBu03Y-8eTw.png"/></div><p class="ok ol gj gh gi om on bd b be z dk translated">图像:浏览器输出</p></figure><p id="91bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们创建一个AWS弹性容器存储库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/57e9f590e3a8c218c8cf135d20d0f3c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LlBM-H8BH0wkrgbiEuOQ4w.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/c186317a6c4609b2ba026bdae947a62a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tsPbrEsUY6Ue_3cisy9C7w.png"/></div></div></figure><p id="b257" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要访问存储库，您必须安装AWS CLI并用API密钥对其进行配置。参见<a class="ae lw" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html" rel="noopener ugc nofollow" target="_blank">本</a>。</p><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="3df1" class="nh mk iq oa b gy oe of l og oh"><strong class="oa ir"># Login to your ECR repo using docker</strong></span><span id="071b" class="nh mk iq oa b gy oi of l og oh"><strong class="oa ir">$</strong> aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin <strong class="oa ir">&lt;Repo URI&gt;</strong></span></pre><p id="be90" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有关如何登录您的回购的完整指南，请参考<a class="ae lw" href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/Registries.html#registry_auth" rel="noopener ugc nofollow" target="_blank">本</a>。</p><p id="3abf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，标记您的图像，并将其推送到您的回购。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/e3e11829b21d79717fbddff1b81f6026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YiWybLDSObBfylITqWScHg.png"/></div></div></figure><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="308a" class="nh mk iq oa b gy oe of l og oh"><strong class="oa ir">$</strong> docker image tag serverlessdemo <strong class="oa ir">&lt;Repo URI&gt;<br/>$ </strong>docker push <strong class="oa ir">&lt;Repo URI&gt;</strong></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/63c8ac76a8da540b8a636e3d6b42af43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_PRdbusDFU7q9gAZgNd2A.png"/></div></div></figure><p id="3e3e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">太好了，现在您已经将docker图像存储在AWS ECR中了！</p><h2 id="34f5" class="nh mk iq bd ml ni nj dn mp nk nl dp mt la nm nn mv le no np mx li nq nr mz ns bi translated">第2部分:使用AWS Fargate服务您的web应用程序</h2><p id="3ba6" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nt lc ld le nu lg lh li nv lk ll lm ij bi translated">让我们开始吧。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/9820e3d03e574871642811410301f9ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xwOxgrODqAVfuNZ4nu8HAA.png"/></div></div></figure><p id="773c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以分四步启动集群…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/aee4ae57ad573e2fb0b6c05254884cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cSGLuIToMu8k774X9OHCEA.png"/></div></div></figure><p id="18d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">第一步:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/0fda88d27f30d513c8a14647953e84e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GStBY-b3LmnB8LPn-g6jNg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/889d9ec5eeee777d1f9c092c6c38a276.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*4Fr8phphertUfJSzLEGwWQ.png"/></div><p class="ok ol gj gh gi om on bd b be z dk translated">图:标准容器配置</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/63f0e6e71f1aa393860541df56a2726d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lL6pmaGptm4En4pERIlKYQ.png"/></div></div><p class="ok ol gj gh gi om on bd b be z dk translated">图像:高级-&gt;运行状况检查</p></figure><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="0087" class="nh mk iq oa b gy oe of l og oh">Command: CMD-SHELL,curl -f <a class="ae lw" href="http://localhost/welcome" rel="noopener ugc nofollow" target="_blank">http://localhost/welcome</a> || exit 1<br/>Interval: 5<br/>Timeout: 5<br/>Start period: 20  <strong class="oa ir"># Because Spring Boot takes ~20 sec to start up</strong><br/>Retries: 3</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/399162dba6ecd5445fc4f973d8bc26ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3H2C-09beApjyaRnRPCFdQ.png"/></div></div><p class="ok ol gj gh gi om on bd b be z dk translated">图像:高级-&gt;环境</p></figure><pre class="kg kh ki kj gt nz oa ob oc aw od bi"><span id="9d08" class="nh mk iq oa b gy oe of l og oh">CPU Units: 256  <strong class="oa ir"># 256 units represents 0.25 vCPU</strong><br/>EXTERNAL_PARAM - container_param_1</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/0651c7595bda79f580dc36fa23b7d7cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*5UMUFk6U34Ynsy_vg2Jr_Q.png"/></div><p class="ok ol gj gh gi om on bd b be z dk translated">图像:高级-&gt;日志记录</p></figure><p id="d3fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">第二步:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/7b9017269cad170ee8b8f17ee49a7c9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c_OCPBrJObUH3fDN-fuTJQ.png"/></div></div></figure><p id="8f92" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">第三步:给它起个名字</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/093bd04805817636ab03f85efd87671b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r0bF-XUcafTDpuLQw3AfyQ.png"/></div></div></figure><p id="aa5d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">第四步:审核并创建</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/64feedc4bd2eacb891a16add78ae6085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFmWoSA8KZreBNK_OOAFRw.png"/></div></div></figure><p id="9df6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，您的ECS集群已经启动并运行了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/8c6b0775a870db2d75e490ed37dc8c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVc05lJaOS_u5ayZ38Z49w.png"/></div></div><p class="ok ol gj gh gi om on bd b be z dk translated">图:服务状态</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/e4faf824a97cdf175e2988782dbdea2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wdx_w_1PsY2hRA4pT-C3hA.png"/></div></div><p class="ok ol gj gh gi om on bd b be z dk translated">图:负载平衡器URL的浏览器输出</p></figure><p id="f48c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">可以看看AWS CloudWatch里的应用日志。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/f0fafe6d13c6ced13275ab6d960eef92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3QdnNFpgT7WIr4OG-EktA.png"/></div></div><p class="ok ol gj gh gi om on bd b be z dk translated">图片:云观察日志</p></figure><p id="3770" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">根据运行状况检查策略，如果检测到故障，此容器将自动被新容器替换。</p><p id="5e2d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但这还不是全部。您可以配置自动缩放功能来增加或减少容器的数量。</p><p id="4005" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好，我们也这么做吧！</p><p id="251a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，你必须点击更新服务。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/61595063eef477f8871d819cd2980016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXDsi5ef2QVBzPLVl4xAYQ.png"/></div></div></figure><p id="2e41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，直接跳到第3步。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/68fbc1fda3dd3cc136274b76ccfa3417.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KclWDNhWAbNqj1e3_If__Q.png"/></div></div></figure><p id="ca89" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以在此配置最小、所需和最大任务数。任务代表一个容器。</p><p id="0854" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">缩放策略非常重要。您可以尝试这些配置，并为您的使用案例提供最佳值。在给定时间，可以有多个有效的扩展策略。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/d3fffd4e83329ce7c366b369d3bf0c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V8Knwi-xegcx57b3wGhyvg.png"/></div></div></figure><p id="78a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">试用ECS将帮助您找出一些您可以使用的很酷的新技巧。</p><p id="b857" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ECS采用现收现付的模式。您只需为使用的vCPUs和内存数量付费。一旦您完成了试验，记得删除服务和负载平衡器，并停止任务。</p><p id="797c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">谢谢大家！</p></div></div>    
</body>
</html>