<html>
<head>
<title>How To Dockerize Your Flask API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对你的烧瓶API进行分类</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-dockerize-your-flask-api-cc95843ab625?source=collection_archive---------5-----------------------#2022-05-25">https://betterprogramming.pub/how-to-dockerize-your-flask-api-cc95843ab625?source=collection_archive---------5-----------------------#2022-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3135" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索如何通过几个非常简单的步骤对Flask应用程序进行dockerize</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6af6587a2cde00a8fba2ca9d9e6c796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azABJaLHq42UUZy9C3ELMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">docker + flask (python)</p></figure><h1 id="d2ae" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">烧瓶是什么？</h1><p id="2492" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated"><a class="ae mm" href="https://flask.palletsprojects.com/en/2.1.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>是一个Python微型web框架，帮助你以一种快速简单的方式开发轻量级web应用和API。</p><p id="ab06" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">它基于Werkzeg WSGI工具包和Jinja 2模板引擎。</p><h1 id="a70c" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">Docker是什么？</h1><p id="612e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Docker 是一个使用容器来创建、部署和运行应用程序的工具。在本文中，我不会深入探讨容器的好处，因为这需要一些时间，所以我将只关注如何完成它。有关docker的更多信息，请点击<a class="ae mm" href="https://docs.docker.com/get-started/overview/#:~:text=Docker%20is%20an%20open%20platform,ways%20you%20manage%20your%20applications." rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h1 id="3184" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">项目结构</h1><p id="9720" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated"><em class="ms">我们假设我们有一个基本的工作瓶应用程序。</em></p><p id="2da0" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">无论你的应用程序结构是什么，我们都需要一个关于我们项目的文档。通常，我们把它放在根目录下，但这取决于你想如何设置。</p><p id="7eda" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">就本文而言，让我们假设一个简单的设置，如下所示:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="8f59" class="my kz it mu b gy mz na l nb nc">flaskapp<br/>|---app.py<br/>|---Dockerfile<br/>|---requirements.txt</span></pre><p id="0129" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">首先，让我们看看我们的<code class="fe nd ne nf mu b">app.py</code>文件中的一个简单的Flask应用程序:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="88fa" class="my kz it mu b gy mz na l nb nc">from flask import Flask<br/>app = Flask(__name__)</span><span id="4e94" class="my kz it mu b gy ng na l nb nc">@app.route('/')<br/>def hello_world():<br/>    return 'Hello, we have Flask in a Docker container'</span><span id="62dc" class="my kz it mu b gy ng na l nb nc">if __name__ == "__main__":<br/>    app.run(debug=True)</span></pre><p id="05e0" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">现在，我们的<code class="fe nd ne nf mu b">requirements.txt</code>文件:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="ea41" class="my kz it mu b gy mz na l nb nc">Flask==<!-- -->2.1.2</span></pre><p id="afc9" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">好的……现在主要的事情，docker文件。</p><p id="ced4" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">它将包含创建我们的形象所需的所有信息。让我们来看看:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="563d" class="my kz it mu b gy mz na l nb nc">FROM python:3.8-slim-buster</span><span id="eb65" class="my kz it mu b gy ng na l nb nc">WORKDIR /app</span><span id="ad4f" class="my kz it mu b gy ng na l nb nc"><em class="ms"># We copy just the requirements.txt first to leverage Docker cache</em><br/>COPY ./requirements.txt /app/requirements.txt</span><span id="f25f" class="my kz it mu b gy ng na l nb nc">RUN pip install -r requirements.txt</span><span id="3665" class="my kz it mu b gy ng na l nb nc">COPY . /app</span><span id="5ba2" class="my kz it mu b gy ng na l nb nc">ENTRYPOINT <strong class="mu iu">[</strong> "python" <strong class="mu iu">]</strong></span><span id="2b68" class="my kz it mu b gy ng na l nb nc">CMD <strong class="mu iu">[</strong> "app.py" <strong class="mu iu">]</strong></span></pre><p id="6717" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">让我们来看一下这些Docker指令:</p><ol class=""><li id="03ac" class="nh ni it ls b lt mn lw mo lz nj md nk mh nl ml nm nn no np bi translated">Docker文件的第一行告诉Docker我们的新图像基于什么图像。为了简单起见，我们选择了<code class="fe nd ne nf mu b">python:3.8-slim-buster</code>,但是我们可以基于任何其他东西，比如Ubuntu。</li><li id="ecf8" class="nh ni it ls b lt nq lw nr lz ns md nt mh nu ml nm nn no np bi translated"><code class="fe nd ne nf mu b">WORKDIR</code>在docker映像中设置工作目录。以下所有指令都在这个目录中运行。</li><li id="eba1" class="nh ni it ls b lt nq lw nr lz ns md nt mh nu ml nm nn no np bi translated"><code class="fe nd ne nf mu b">RUN</code>运行命令。在这种情况下，<code class="fe nd ne nf mu b">pip install</code>我们的要求。</li><li id="f90f" class="nh ni it ls b lt nq lw nr lz ns md nt mh nu ml nm nn no np bi translated"><code class="fe nd ne nf mu b">COPY</code>将文件从第一个参数复制到第二个参数。</li><li id="ba67" class="nh ni it ls b lt nq lw nr lz ns md nt mh nu ml nm nn no np bi translated"><code class="fe nd ne nf mu b">ENTRYPOINT</code>配置容器作为可执行文件运行，只执行最后一条<code class="fe nd ne nf mu b">ENTRYPOINT</code>指令。</li></ol><h1 id="9e57" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated"><code class="fe nd ne nf mu b">Build the Image</code></h1><p id="bff6" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">剩下的就是使用<code class="fe nd ne nf mu b">docker build</code>来构建我们的图像。我们还将使用<code class="fe nd ne nf mu b">— tag</code>标志来指定图像的名称。</p><p id="eb0d" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">从docker文件所在的目录中，运行以下命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a200" class="my kz it mu b gy mz na l nb nc">docker build --tag my-app .</span></pre><p id="1a9a" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">根据项目的大小和要求，此命令可能需要一些时间。</p><p id="312c" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">构建完成后，我们可以使用以下命令检查映像是否已创建:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3893" class="my kz it mu b gy mz na l nb nc">docker image ls</span><span id="65f7" class="my kz it mu b gy ng na l nb nc">REPOSITORY      TAG       IMAGE ID       CREATED             SIZE<br/>my-app          latest    ef514c013f1a   About an hour ago   812MB</span><span id="1b62" class="my kz it mu b gy ng na l nb nc">...</span></pre><p id="70e1" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">我们的图像应该和我们设置的标签一起出现在这里。</p><h1 id="432f" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">将映像作为容器运行</h1><p id="69fa" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">我们现在可以使用<code class="fe nd ne nf mu b">docker run</code>命令将图像作为容器运行，并指定图像的名称。</p><p id="aef9" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">我们还将传递两个标志:</p><ol class=""><li id="c256" class="nh ni it ls b lt mn lw mo lz nj md nk mh nl ml nm nn no np bi translated"><code class="fe nd ne nf mu b">-d</code>分离标志，表示我们希望docker以分离模式运行。</li><li id="e0b1" class="nh ni it ls b lt nq lw nr lz ns md nt mh nu ml nm nn no np bi translated"><code class="fe nd ne nf mu b">-p 5000:5000</code>端口标志告诉docker我们希望他公开并映射端口<code class="fe nd ne nf mu b">5000</code>，这样我们的应用程序就可以从容器外部访问。</li></ol><p id="ab7b" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">该命令应该如下所示:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f02c" class="my kz it mu b gy mz na l nb nc">docker run -d -p 5000:5000 my-app</span></pre><p id="5571" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">就是这样！让我们试一试。</p><p id="7182" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">打开你的浏览器，点击<code class="fe nd ne nf mu b"><a class="ae mm" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a></code>的API。</p><p id="2072" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">您应该会看到<code class="fe nd ne nf mu b">Hello, we have Flask in a Docker container</code>消息。</p><p id="f34f" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">我们可以使用以下命令来查看哪些容器当前正在运行:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a909" class="my kz it mu b gy mz na l nb nc">docker ps</span></pre><p id="0561" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">要停止正在运行的容器，我们可以运行以下命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d0c8" class="my kz it mu b gy mz na l nb nc">docker stop &lt;container-name&gt;</span></pre><p id="76bf" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">这优雅地停止了容器。一种更积极的阻止集装箱的方法是:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="62dd" class="my kz it mu b gy mz na l nb nc">docker kill &lt;container-name&gt;</span></pre><p id="5efb" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">我们还可以重新启动、暂停和取消暂停容器:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f5fe" class="my kz it mu b gy mz na l nb nc">docker restart &lt;container-name&gt;<br/>docker pause &lt;container-name&gt;<br/>docker unpause &lt;container-name&gt;</span></pre><p id="cd97" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">要查看容器的日志，我们可以使用:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="584d" class="my kz it mu b gy mz na l nb nc">docker logs &lt;container-name&gt;</span></pre><p id="13b2" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">就是这样！</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="7c1a" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">感谢您花时间阅读这篇文章。</p><p id="1d5a" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">你可以在官方<a class="ae mm" href="https://docs.docker.com/language/python/" rel="noopener ugc nofollow" target="_blank">文档</a>中找到更多关于Docker和Python的信息。</p><p id="948c" class="pw-post-body-paragraph lq lr it ls b lt mn ju lv lw mo jx ly lz mp mb mc md mq mf mg mh mr mj mk ml im bi translated">谢谢！</p></div></div>    
</body>
</html>