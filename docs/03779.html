<html>
<head>
<title>Get Started With SwiftUI and Xcode UI Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始SwiftUI和Xcode UI测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-swiftui-xcode-ui-testing-6e9f6e4a8492?source=collection_archive---------2-----------------------#2020-03-04">https://betterprogramming.pub/getting-started-with-swiftui-xcode-ui-testing-6e9f6e4a8492?source=collection_archive---------2-----------------------#2020-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="543c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解开始测试SwiftUI组件有多简单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5aa661d8fe86e77bcfebad1779b78c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YghkNWHoHCOnolCDkCj5w.png"/></div></div></figure><p id="04ed" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">每隔一段时间，从你的项目工作中抽出一点时间后退一步，看看你的开发领域目前发生了什么，这是一个好主意。幸运的是，对于iOS开发者来说，当苹果开始在WWDC发布iOS新功能时，这一时刻(至少)每年都会到来一次。</p><p id="dfac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">苹果在2019年发布的主要公告之一是在iOS开发工具包中添加了<a class="ae ln" href="https://developer.apple.com/xcode/swiftui/" rel="noopener ugc nofollow" target="_blank"> SwiftUI </a>。它并不意味着直接取代UIKit，但它无疑是构建用户界面的一种更现代的方法。这是过去几年中iOS用户界面开发的最大变化之一。</p><p id="b99a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有了创建用户界面的良好的声明方式，我想知道当进行测试驱动开发(TDD)时，生活是否会变得更容易。不必在Storyboard、ViewController和XCTest之间来回切换的前景至少看起来很有吸引力。</p><p id="ef51" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我创建了一个小的测试项目，它将简单地显示一个文本标签，从一个文本字段请求一些输入，并在第三个文本字段中显示结果。一点也不像火箭科学——只是一些入门的东西。我将逐步增加功能，而不是一次全部增加，这样您就可以看到您的测试是如何发展的。这反映了正常开发发生的方式:随着时间的推移，特性得到扩展和添加，测试套件需要相应地更新。</p><p id="d787" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们走吧。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="1359" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">测试项目</h1><p id="b2f0" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">首先，我在新项目选项对话框中创建了一个新的单视图应用<em class="ms"> </em>。我把它命名为<code class="fe mt mu mv mw b">SimpleGreeter</code>——猜猜它会做什么！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/484f59d051c989226f880697442df7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GOO10ZFbOZ1-ckgTsDdkAA.png"/></div></div></figure><p id="3e55" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保为用户界面选择SwiftUI，并勾选包括UI测试选项。在这种情况下，由于应用程序的规模有限，我没有勾选包含单元测试选项，但是如果您愿意，以后添加单元测试是很容易的。</p><p id="2eaa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦您将应用程序保存到一个合理的位置，它应该看起来像这样。如果预览没有显示，请确定您按下了预览窗口右上角的“继续”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/d0cb41d2c326dd14c5073ab073419743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_HjzYaDb-XG3FBOwryigVw.png"/></div></div></figure><p id="2ab9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，在我们开始编写用户界面之前，花一点时间想想我们希望在应用程序中显示什么，以及用户如何交互(我们正在进行测试驱动，对吗？).首先，我想显示一个文本标签，以提供一些说明和一个文本字段，供用户输入他们的姓名。</p><p id="3187" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以切换到<code class="fe mt mu mv mw b">SimpleGreeterUITests.swift</code>文件，并添加一个测试。首先，删除<code class="fe mt mu mv mw b">tearDown</code>和<code class="fe mt mu mv mw b">testLaunchPerformance</code>方法，因为在这个例子中我们不会用到它们。将<code class="fe mt mu mv mw b">testExample</code>方法重命名为类似于<code class="fe mt mu mv mw b">testInitialViewState</code>的名称，以表明这是一个测试用户界面默认状态的方法。此外，请随意删除Xcode为您生成的大量注释。</p><p id="d453" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了填充测试方法，我们将添加四个断言:</p><ul class=""><li id="0bcb" class="mz na iq kt b ku kv kx ky la nb le nc li nd lm ne nf ng nh bi translated">文本标签存在吗？</li><li id="d8dd" class="mz na iq kt b ku ni kx nj la nk le nl li nm lm ne nf ng nh bi translated">文本标签的文本是否正确？</li><li id="a654" class="mz na iq kt b ku ni kx nj la nk le nl li nm lm ne nf ng nh bi translated">文本字段是否存在？</li><li id="18f6" class="mz na iq kt b ku ni kx nj la nk le nl li nm lm ne nf ng nh bi translated">文本字段是否有正确的占位符文本？</li></ul><p id="7eef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您应该会得到这样的结果:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="dbd5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当然，如果您运行这个测试，它将失败，即使有一个文本标签，因为它包含一个不同的文本(“Hello，World！”).所以让我们来解决这个问题，我们将转到我们的<code class="fe mt mu mv mw b">ContentView.swift</code>文件，开始添加一些控件，并确保我们的断言是真实的。</p><p id="e30d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将在<code class="fe mt mu mv mw b">VStack</code>中排列文本标签和文本字段，添加一些填充，并提供合理的标题和占位符。来自文本字段的输入我们将存储在一个名为<code class="fe mt mu mv mw b">name</code>的变量中。目前就是这样——只需关注为通过测试而需要添加的最少功能。你会得到这样的结果:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="ef14" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在再做一次测试，瞧！全线绿色。特别注意<code class="fe mt mu mv mw b">name</code>变量的<code class="fe mt mu mv mw b">@State</code>注释。这向SwiftUI发出信号，每次该值更新时，视图应该相应地更新。</p><p id="705c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但我们还没有完成，现在我们想更新它，以便每次您在文本字段中输入内容时，我们都会在新的文本标签中看到一条问候您的消息。因此，如果我在文本字段中输入“Jony”，我们应该会看到一个标签，上面写着“很高兴见到你，Jony。”同样，我们先做这个测试。返回到<code class="fe mt mu mv mw b">SimpleGreeterUITests.swift</code>文件，添加另一个方法来测试您是否可以点击文本字段，添加一些文本，并查看正确的结果。</p><p id="9e1f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，由于我们将添加另一个文本标签，我们不能简单地通过使用<code class="fe mt mu mv mw b">app.staticTexts.element</code>来引用文本标签，因为这只有在视图上只有一个文本标签时才有效。从文档中:</p><blockquote class="np nq nr"><p id="33c4" class="kr ks ms kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated">"当您期望查询的单个匹配元素，但希望在访问结果之前检查多个不明确的匹配时，请使用<code class="fe mt mu mv mw b">element</code>属性来访问查询的结果。<code class="fe mt mu mv mw b">element</code>属性遍历应用程序的可访问性树，在返回之前检查多个匹配元素，如果没有一个匹配元素，则当前测试失败。</p></blockquote><p id="0c62" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，我们需要区分旧的文本标签和将要添加的新的文本标签。我们可以通过使用<code class="fe mt mu mv mw b">accessibilityIdentifier</code>来做到这一点。这个属性是由<code class="fe mt mu mv mw b">UIAccessibilityIdentification</code>协议提供的，文档中说:</p><blockquote class="np nq nr"><p id="e6c9" class="kr ks ms kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated">标识符可用于唯一标识您使用UI自动化接口编写的脚本中的元素。使用标识符可以避免不恰当地设置或访问元素的可访问性标签。</p></blockquote><p id="8b50" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以这正是Apple认为我们应该用来查询视图中正确元素的属性。这避免了(ab)使用<code class="fe mt mu mv mw b">accessibilityLabel</code>(由屏幕阅读器使用)或检查某些标题或其他文本内容，这些内容在运行时可能会改变或具有意外的值。测试将如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="98ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有趣的是，我们将一个接一个地输入每个字母。<code class="fe mt mu mv mw b">typeText</code>方法接受一个完整的字符串，但是如果你使用它，UI自动化有时会输入太快，一些字符会被忽略，导致测试随机失败。不酷。</p><p id="754f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">同样，这个测试会失败，因为我们没有正确的标签<code class="fe mt mu mv mw b">accessibilityIdentifier</code>，我们没有实现正确的行为。让我们解决这个问题。我们只需在<code class="fe mt mu mv mw b">ContentView.swift</code>中的<code class="fe mt mu mv mw b">VStack</code>底部添加一个新的文本标签，就可以开始了:</p><pre class="kg kh ki kj gt nv mw nw nx aw ny bi"><span id="e298" class="nz lw iq mw b gy oa ob l oc od">Text("Nice to meet you, \(name).")<br/>  .accessibility(identifier: "greetingTextLabel")</span></pre><p id="972c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对吗？嗯，不。因为，是的，你的新测试会通过，但你的第一次测试会失败。这个应用程序有一个不想要的副作用，我们现在有一个额外的文本字段，在它的初始状态说<code class="fe mt mu mv mw b">Nice to meet you, .</code>糟糕！</p><p id="a05d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以我们想解决这些问题:</p><ol class=""><li id="ae73" class="mz na iq kt b ku kv kx ky la nb le nc li nd lm oe nf ng nh bi translated">修复第一个测试(并为新的UI更新它)。</li><li id="8211" class="mz na iq kt b ku ni kx nj la nk le nl li nm lm oe nf ng nh bi translated">确保每当没有输入姓名时(姓名为空)，我们不显示任何问候语。</li></ol><p id="3fbf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了解决第一点，我们将向第一个文本标签添加一个标识符，更新测试以使用它，并为新引入的文本标签添加额外的断言——检查它是否存在以及默认状态是否为空。更新后的测试将如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="b265" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">既然我们已经更新了第一个测试，我们将更新视图的行为来匹配它。我们将引入一个计算属性<code class="fe mt mu mv mw b">greetingText</code>，它要么返回一个空字符串(如果没有输入姓名)，要么返回完整的问候文本。在这里，我使用了Swift 5.1的新特性(<a class="ae ln" href="https://github.com/apple/swift-evolution/blob/master/proposals/0255-omit-return.md" rel="noopener ugc nofollow" target="_blank"> SE-0255 </a>)，其中如果你的方法只包含一个表达式，它也被用作隐式返回。最后的<code class="fe mt mu mv mw b">ContentView</code>是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="b883" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后的<code class="fe mt mu mv mw b">SimpleGreeterUITests</code>看起来像:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="5488" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">结论</h1><p id="5f57" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">最后，这只是使用SwiftUI对Xcode UI测试的一个简单介绍。当然，还可以做更多的事情来改进UI，但它表明，只需很少的努力，您就可以在SwiftUI视图中开始使用界面测试。我认为，到目前为止，做出改变并看到它们在你的应用程序中立即生效并不容易。</p><p id="4368" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，它确实(像任何TDD一样)需要一点纪律和奉献精神。此外，Apple文档在这方面有时提供的支持很少，如果没有对实际原因的清晰描述，测试可能会失败。这可能有点困难，但将来你会感谢你的。</p><p id="52d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你正在开始一个新项目或者刚刚进入SwiftUI，并且你还没有使用UI测试，现在是开始的好时机。</p><p id="f2aa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后一点:在你的视图中使用逻辑(例如<code class="fe mt mu mv mw b">greeterText</code>)当然应该尽可能的避免，这样做只是为了不使这个示例项目复杂化。然而，一旦您开始注意到您的视图中有应用程序逻辑，就考虑切换到基于ViewModel的架构(并且一定要测试它)。</p><p id="b992" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">项目的最终代码可以在<a class="ae ln" href="https://github.com/tieleman/SimpleGreeter" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div></div>    
</body>
</html>