<html>
<head>
<title>How To Build an App With Drag and Drop With Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Angular构建一个带拖拽的App</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-an-app-with-drag-and-drop-with-angular-1c1d29b37d5d?source=collection_archive---------2-----------------------#2019-08-24">https://betterprogramming.pub/how-to-make-an-app-with-drag-and-drop-with-angular-1c1d29b37d5d?source=collection_archive---------2-----------------------#2019-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4663" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建一个具有拖拽功能的待办应用，从待办到完成</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/20b9a37509ff0f3046b64dc54adc3111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWfBc5E7ksvoBUPRJwMWcw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@nordwood?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">诺德伍德主题</a>在<a class="ae ky" href="https://unsplash.com/search/photos/app?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d578" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拖放是许多交互式web应用程序的一项功能。它为用户操作数据提供了一种直观的方式。对于Angular应用程序来说，添加拖放功能很容易。</p><p id="e431" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一部分中，我们将创建一个包含两列的待办事项应用程序:一个<em class="lv">待办事项</em>列和一个<em class="lv">已完成</em>列。您可以在两者之间拖放，将状态从待办事项更改为已完成，反之亦然。</p><p id="8741" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了构建应用程序，我们使用<a class="ae ky" href="https://material.angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular Material </a>库来使应用程序看起来更好，并轻松地为我们的应用程序提供拖放功能。它也将有一个导航菜单和一个顶栏。</p><p id="3f43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了开始构建应用程序，我们通过运行<code class="fe lw lx ly lz b">npm i @angular/cli</code>来安装Angular CLI。我们应该选择包含路由，并在被询问时使用SCSS。</p><p id="7e1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们通过运行<code class="fe lw lx ly lz b">ng new todo-app</code>创建一个新的Angular项目。之后，我们通过运行<code class="fe lw lx ly lz b">npm i@angular/cdk @angular/material @ngrx/store</code>添加我们需要的库。</p><p id="f493" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将把Angular Material和NGRX商店添加到我们的应用程序中。我们将在这个应用程序中广泛使用<a class="ae ky" href="https://facebook.github.io/flux/" rel="noopener ugc nofollow" target="_blank"> Flux </a>。接下来，我们通过运行以下命令来添加组件和服务:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="d656" class="me mf it lz b gy mg mh l mi mj">ng g component addTodoDialog<br/>ng g component homePage<br/>ng g component toolBar<br/>ng g service todo</span></pre><p id="6d1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过运行<code class="fe lw lx ly lz b">ng add @ngrx/store</code>为NGRX存储添加样板文件。</p><p id="5bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以为我们的应用程序构建逻辑。在<code class="fe lw lx ly lz b">add-todo-dialog.component.ts</code>中，我们加上:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="999c" class="me mf it lz b gy mg mh l mi mj">import { Component, OnInit } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { NgForm } from '<a class="ae ky" href="http://twitter.com/angular/forms" rel="noopener ugc nofollow" target="_blank">@angular/forms</a>';<br/>import { MatDialogRef } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/dialog';<br/>import { Store } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { TodoService } from '../todo.service';<br/>import { SET_TODOS } from '../reducers/todo-reducer';</span><span id="3c01" class="me mf it lz b gy mk mh l mi mj"><a class="ae ky" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-add-todo-dialog',<br/>  templateUrl: './add-todo-dialog.component.html',<br/>  styleUrls: ['./add-todo-dialog.component.scss']<br/>})<br/>export class AddTodoDialogComponent implements OnInit {<br/>  todoData: any = &lt;any&gt;{<br/>    done: false<br/>  };</span><span id="fd42" class="me mf it lz b gy mk mh l mi mj">  constructor(<br/>    public dialogRef: MatDialogRef&lt;AddTodoDialogComponent&gt;,<br/>    private todoService: TodoService,<br/>    private store: Store&lt;any&gt;<br/>  ) { }</span><span id="303e" class="me mf it lz b gy mk mh l mi mj">  ngOnInit() {<br/>  }</span><span id="7f34" class="me mf it lz b gy mk mh l mi mj">  save(todoForm: NgForm) {<br/>    if (todoForm.invalid) {<br/>      return;<br/>    }<br/>    this.todoService.addTodo(this.todoData)<br/>      .subscribe(res =&gt; {<br/>        this.getTodos();<br/>        this.dialogRef.close();<br/>      })<br/>  }</span><span id="d081" class="me mf it lz b gy mk mh l mi mj">  getTodos() {<br/>    this.todoService.getTodos()<br/>      .subscribe(res =&gt; {<br/>        this.store.dispatch({ type: SET_TODOS, payload: res });<br/>      })<br/>  }<br/>}</span></pre><p id="82c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码是为对话框编写的，让我们将待办事项添加到列表中，然后获取最新的项目并将其放入存储中。</p><p id="5f58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">add-todo-dialog.component.html</code>中，我们添加:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="bf18" class="me mf it lz b gy mg mh l mi mj">&lt;h2&gt;Add Todo&lt;/h2&gt;<br/>&lt;form #todoForm='ngForm' (ngSubmit)='save(todoForm)'&gt;<br/>    &lt;mat-form-field&gt;<br/>        &lt;input matInput placeholder="Description" required #description='ngModel' name='description'<br/>            [(ngModel)]='todoData.description'&gt;<br/>        &lt;mat-error *ngIf="description.invalid &amp;&amp; (description.dirty || description.touched)"&gt;<br/>            &lt;div *ngIf="content.errors.required"&gt;<br/>                Description is required.<br/>            &lt;/div&gt;<br/>        &lt;/mat-error&gt;<br/>    &lt;/mat-form-field&gt;<br/>    &lt;br&gt;<br/>    &lt;button mat-raised-button type='submit'&gt;Add&lt;/button&gt;<br/>&lt;/form&gt;</span></pre><p id="881a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是添加待办事项的表单。为了简单起见，它只有一个字段，描述。</p><p id="4e37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">add-todo-dialog.component.scss</code>中，为了改变表单字段的宽度，我们输入:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="79c2" class="me mf it lz b gy mg mh l mi mj">form {<br/>  mat-form-field {<br/>    width: 100%;<br/>    margin: 0 auto;<br/>  }<br/>}</span></pre><p id="f328" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们建立我们的主页。这是两个列表将要存放的地方。用户可以在两个列表之间拖放来更改任务的状态。</p><p id="96af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">home-page.component.ts</code>中，我们放入:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="9d6b" class="me mf it lz b gy mg mh l mi mj">import { Component, OnInit } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { MatDialog } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/dialog';<br/>import { AddTodoDialogComponent } from '../add-todo-dialog/add-todo-dialog.component';<br/>import { TodoService } from '../todo.service';<br/>import { Store, select } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { SET_TODOS } from '../reducers/todo-reducer';<br/>import { CdkDragDrop, moveItemInArray, transferArrayItem } from '<a class="ae ky" href="http://twitter.com/angular/cdk" rel="noopener ugc nofollow" target="_blank">@angular/cdk</a>/drag-drop';</span><span id="dfa7" class="me mf it lz b gy mk mh l mi mj"><a class="ae ky" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-home-page',<br/>  templateUrl: './home-page.component.html',<br/>  styleUrls: ['./home-page.component.scss']<br/>})<br/>export class HomePageComponent implements OnInit {<br/>  allTasks: any[] = [];<br/>  todo: any[] = [];<br/>  done: any[] = [];</span><span id="a88a" class="me mf it lz b gy mk mh l mi mj">  constructor(<br/>    public dialog: MatDialog,<br/>    private todoService: TodoService,<br/>    private store: Store&lt;any&gt;<br/>  ) {<br/>    store.pipe(select('todos'))<br/>      .subscribe(allTasks =&gt; {<br/>        this.allTasks = allTasks || [];<br/>        this.todo = this.allTasks.filter(t =&gt; !t.done);<br/>        this.done = this.allTasks.filter(t =&gt; t.done);<br/>      })<br/>  }</span><span id="ec7a" class="me mf it lz b gy mk mh l mi mj">  ngOnInit() {<br/>    this.getTodos();<br/>  }</span><span id="cd71" class="me mf it lz b gy mk mh l mi mj">  openAddTodoDialog() {<br/>    const dialogRef = this.dialog.open(AddTodoDialogComponent, {<br/>      width: '70vw',<br/>      data: {}<br/>    })</span><span id="26e9" class="me mf it lz b gy mk mh l mi mj">  dialogRef.afterClosed().subscribe(result =&gt; {<br/>      console.log('The dialog was closed');<br/>    });<br/>  }</span><span id="9509" class="me mf it lz b gy mk mh l mi mj">  getTodos() {<br/>    this.todoService.getTodos()<br/>      .subscribe(res =&gt; {<br/>        this.store.dispatch({ type: SET_TODOS, payload: res });<br/>      })<br/>  }</span><span id="9ab4" class="me mf it lz b gy mk mh l mi mj">  drop(event: CdkDragDrop&lt;any[]&gt;) {<br/>    if (event.previousContainer === event.container) {<br/>      moveItemInArray(event.container.data, event.previousIndex, event.currentIndex);<br/>    } else {<br/>      transferArrayItem(event.previousContainer.data,<br/>        event.container.data,<br/>        event.previousIndex,<br/>        event.currentIndex);<br/>    }<br/>    let data = event.container.data[0];<br/>    data.done = !data.done;<br/>    this.todoService.editTodo(data)<br/>      .subscribe(res =&gt; {</span><span id="179d" class="me mf it lz b gy mk mh l mi mj">})<br/>  }</span><span id="5b27" class="me mf it lz b gy mk mh l mi mj">  removeTodo(index: number, tasks: any[]) {<br/>    const todoId = tasks[index].id;<br/>    this.todoService.removeTodo(todoId)<br/>      .subscribe(res =&gt; {<br/>        this.getTodos();<br/>      })<br/>  }<br/>}</span></pre><p id="ef4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有处理删除待办事项的函数，我们让用户打开我们之前用<code class="fe lw lx ly lz b">openAddTodoDialog</code>函数构建的<em class="lv">添加待办事项</em>对话框。</p><p id="9b93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户也可以使用<code class="fe lw lx ly lz b">removeTodo</code>功能删除该页面上的待办事项。<code class="fe lw lx ly lz b">drop</code>函数处理列表间的拖放，并切换待办事项的状态。</p><p id="0b5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个顺序很重要。<code class="fe lw lx ly lz b">if...else</code>块应该出现在调用<code class="fe lw lx ly lz b">editTodo</code>函数之前，因为如果不这样的话，这个项目就不会出现在<code class="fe lw lx ly lz b">event.container.data</code>数组中。</p><p id="121e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lw lx ly lz b">removeTodo</code>接受一个<code class="fe lw lx ly lz b">index</code>和一个<code class="fe lw lx ly lz b">tasks</code>列表，因为它同时用于<code class="fe lw lx ly lz b">todo</code>和<code class="fe lw lx ly lz b">done</code>数组。</p><p id="c0af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">home-page.component.html</code>中，我们添加:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="0b3f" class="me mf it lz b gy mg mh l mi mj">&lt;div class="center"&gt;<br/>    &lt;h1&gt;Todos&lt;/h1&gt;<br/>    &lt;button mat-raised-button (click)='openAddTodoDialog()'&gt;Add Todo&lt;/button&gt;<br/>&lt;/div&gt;<br/>&lt;div class="content"&gt;<br/>    &lt;div class="todo-container"&gt;<br/>        &lt;h2&gt;To Do&lt;/h2&gt;</span><span id="0ca6" class="me mf it lz b gy mk mh l mi mj">&lt;div cdkDropList #todoList="cdkDropList" [cdkDropListData]="todo" [cdkDropListConnectedTo]="[doneList]"<br/>            class="todo-list" (cdkDropListDropped)="drop($event)"&gt;<br/>            &lt;div class="todo-box" *ngFor="let item of todo; let i = index" cdkDrag&gt;<br/>                {{item.description}}<br/>                &lt;a class="delete-button" (click)='removeTodo(i, todo)'&gt;<br/>                    &lt;i class="material-icons"&gt;<br/>                        close<br/>                    &lt;/i&gt;<br/>                &lt;/a&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;</span><span id="3012" class="me mf it lz b gy mk mh l mi mj">&lt;div class="done-container"&gt;<br/>        &lt;h2&gt;Done&lt;/h2&gt;</span><span id="4232" class="me mf it lz b gy mk mh l mi mj">&lt;div cdkDropList #doneList="cdkDropList" [cdkDropListData]="done" [cdkDropListConnectedTo]="[todoList]"<br/>            class="todo-list" (cdkDropListDropped)="drop($event)"&gt;<br/>            &lt;div class="todo-box" *ngFor="let item of done; let i = index" cdkDrag&gt;<br/>                {{item.description}}<br/>                &lt;a class="delete-button" (click)='removeTodo(i, done)'&gt;<br/>                    &lt;i class="material-icons"&gt;<br/>                        close<br/>                    &lt;/i&gt;<br/>                &lt;/a&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;</span><span id="0562" class="me mf it lz b gy mk mh l mi mj">&lt;/div&gt;</span></pre><p id="e5da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该模板提供了两个列表，用户可以在这两个列表之间拖放以切换状态。每个列表项还有一个“x”按钮，让用户删除该项。</p><p id="4df4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">home-page.component.scss</code>中，我们添加:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="28cf" class="me mf it lz b gy mg mh l mi mj">$gray: gray;</span><span id="d591" class="me mf it lz b gy mk mh l mi mj">.content {<br/>  display: flex;<br/>  align-items: flex-start;<br/>  margin-left: 2vw;<br/>  div {<br/>    width: 45vw;<br/>  }<br/>}</span><span id="d71c" class="me mf it lz b gy mk mh l mi mj">.todo-container {<br/>  width: 400px;<br/>  max-width: 100%;<br/>  margin: 0 25px 25px 0;<br/>  display: inline-block;<br/>  vertical-align: top;<br/>}</span><span id="6ba1" class="me mf it lz b gy mk mh l mi mj">.todo-list {<br/>  border: solid 1px $gray;<br/>  min-height: 70px;<br/>  background: white;<br/>  border-radius: 4px;<br/>  overflow: hidden;<br/>  display: block;<br/>}</span><span id="5168" class="me mf it lz b gy mk mh l mi mj">.todo-box {<br/>  padding: 20px 10px;<br/>  border-bottom: solid 1px $gray;<br/>  color: rgba(0, 0, 0, 3);<br/>  display: flex;<br/>  flex-direction: row;<br/>  align-items: center;<br/>  justify-content: space-between;<br/>  box-sizing: border-box;<br/>  cursor: move;<br/>  background: white;<br/>  font-size: 14px;<br/>  height: 70px;<br/>}</span><span id="9ad4" class="me mf it lz b gy mk mh l mi mj">.cdk-drag-preview {<br/>  box-sizing: border-box;<br/>  border-radius: 4px;<br/>  box-shadow: 0 5px 5px -3px rgba(0, 0, 0, 2), 0 8px 10px 1px rgba(0, 0, 0, 1), 0 3px 14px 2px rgba(0, 0, 0, 6);<br/>}</span><span id="f5e0" class="me mf it lz b gy mk mh l mi mj">.cdk-drag-placeholder {<br/>  opacity: 0;<br/>}</span><span id="8647" class="me mf it lz b gy mk mh l mi mj">.cdk-drag-animating {<br/>  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);<br/>}</span><span id="279b" class="me mf it lz b gy mk mh l mi mj">.todo-box:last-child {<br/>  border: none;<br/>}</span><span id="9e26" class="me mf it lz b gy mk mh l mi mj">.todo-list.cdk-drop-list-dragging .todo-box:not(.cdk-drag-placeholder) {<br/>  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);<br/>}</span><span id="3b80" class="me mf it lz b gy mk mh l mi mj">.delete-button {<br/>  cursor: pointer;<br/>}</span></pre><p id="60dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置列表和框的样式，使它们有边框和阴影。</p><p id="eecc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们继续为商场添加减速器。我们通过运行<code class="fe lw lx ly lz b">ng g class menuReducer</code>创建一个名为<code class="fe lw lx ly lz b">menu-reducer.ts</code>的文件。</p><p id="d138" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在那里，我们添加:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="2812" class="me mf it lz b gy mg mh l mi mj">export const SET_MENU_STATE = 'SET_MENU_STATE';</span><span id="df0b" class="me mf it lz b gy mk mh l mi mj">export function MenuReducer(state: boolean, action) {<br/>    switch (action.type) {<br/>        case SET_MENU_STATE:<br/>            return action.payload;</span><span id="84f9" class="me mf it lz b gy mk mh l mi mj">        default:<br/>            return state;<br/>    }<br/>}</span></pre><p id="ede7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，我们通过运行<code class="fe lw lx ly lz b">ng g class todoReducer</code>创建一个名为<code class="fe lw lx ly lz b">todo-reducer.ts</code>的文件，并添加:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="7266" class="me mf it lz b gy mg mh l mi mj">const SET_TODOS = 'SET_TODOS';</span><span id="0971" class="me mf it lz b gy mk mh l mi mj">function todoReducer(state, action) {<br/>    switch (action.type) {<br/>        case SET_TODOS:<br/>            state = action.payload;<br/>            return state;<br/>        default:<br/>            return state<br/>    }<br/>}</span><span id="ff05" class="me mf it lz b gy mk mh l mi mj">export { todoReducer, SET_TODOS };</span></pre><p id="534b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">reducers/index.ts</code>中，我们把:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="208d" class="me mf it lz b gy mg mh l mi mj">import { MenuReducer } from './menu-reducer';<br/>import { todoReducer } from './todo-reducer';</span><span id="f3d2" class="me mf it lz b gy mk mh l mi mj">export const reducers = {<br/>  menuState: MenuReducer,<br/>  todos: todoReducer<br/>};</span></pre><p id="a406" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，当我们在<code class="fe lw lx ly lz b">app.module.ts</code>中导入时，变径管可以传递到<code class="fe lw lx ly lz b">StoreModule</code>中。这三个文件一起将创建我们用来存储所有待办任务的存储。</p><p id="9126" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，在<code class="fe lw lx ly lz b">tool-bar.component.ts</code>中，我们放入:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="5986" class="me mf it lz b gy mg mh l mi mj">import { Component, OnInit } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { Store, select } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { SET_MENU_STATE } from '../reducers/menu-reducer';</span><span id="b139" class="me mf it lz b gy mk mh l mi mj"><a class="ae ky" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-tool-bar',<br/>  templateUrl: './tool-bar.component.html',<br/>  styleUrls: ['./tool-bar.component.scss']<br/>})<br/>export class ToolBarComponent implements OnInit {<br/>  menuOpen: boolean;</span><span id="c6dc" class="me mf it lz b gy mk mh l mi mj">  constructor(<br/>    private store: Store&lt;any&gt;<br/>  ) {<br/>    store.pipe(select('menuState'))<br/>      .subscribe(menuOpen =&gt; {<br/>        this.menuOpen = menuOpen;<br/>      })<br/>  }</span><span id="69ac" class="me mf it lz b gy mk mh l mi mj">  ngOnInit() {<br/>  }</span><span id="3508" class="me mf it lz b gy mk mh l mi mj">toggleMenu() {<br/>    this.store.dispatch({ type: SET_MENU_STATE, payload: !this.menuOpen });<br/>  }</span><span id="0b29" class="me mf it lz b gy mk mh l mi mj">}</span></pre><p id="19af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让用户打开和关闭左侧菜单。然后，在<code class="fe lw lx ly lz b">tool-bar.component.html</code>中，我们把:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="ded1" class="me mf it lz b gy mg mh l mi mj">&lt;mat-toolbar&gt;<br/>    &lt;a (click)='toggleMenu()' class="menu-button"&gt;<br/>        &lt;i class="material-icons"&gt;<br/>            menu<br/>        &lt;/i&gt;<br/>    &lt;/a&gt;<br/>    Todo App<br/>&lt;/mat-toolbar&gt;</span></pre><p id="6dab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加顶部工具栏和菜单。</p><p id="97dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">tool-bar.component.scss</code>中，我们添加:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="ef14" class="me mf it lz b gy mg mh l mi mj">.menu-button {<br/>  margin-top: 6px;<br/>  margin-right: 10px;<br/>  cursor: pointer;<br/>}</span><span id="1ee9" class="me mf it lz b gy mk mh l mi mj">.mat-toolbar {<br/>  background: #009688;<br/>  color: white;<br/>}</span></pre><p id="1da2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给我们的菜单按钮和标题文本增加一些间距。</p><p id="f01b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">app-routing.module.ts</code>中，我们将现有代码替换为:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="4c6f" class="me mf it lz b gy mg mh l mi mj">import { NgModule } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { Routes, RouterModule } from '<a class="ae ky" href="http://twitter.com/angular/router" rel="noopener ugc nofollow" target="_blank">@angular/router</a>';<br/>import { HomePageComponent } from './home-page/home-page.component';</span><span id="d4e8" class="me mf it lz b gy mk mh l mi mj">const routes: Routes = [<br/>  { path: '', component: HomePageComponent },<br/>];</span><span id="9d6d" class="me mf it lz b gy mk mh l mi mj"><a class="ae ky" href="http://twitter.com/NgModule" rel="noopener ugc nofollow" target="_blank">@NgModule</a>({<br/>  imports: [RouterModule.forRoot(routes)],<br/>  exports: [RouterModule]<br/>})<br/>export class AppRoutingModule { }</span></pre><p id="1673" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让用户看到主页。</p><p id="a773" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在<code class="fe lw lx ly lz b">app.component.ts</code>中，我们放入:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="6a10" class="me mf it lz b gy mg mh l mi mj">import { Component, HostListener } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { SET_MENU_STATE } from './reducers/menu-reducer';<br/>import { Store, select } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';</span><span id="fef1" class="me mf it lz b gy mk mh l mi mj"><a class="ae ky" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.scss']<br/>})<br/>export class AppComponent {<br/>  menuOpen: boolean;</span><span id="f350" class="me mf it lz b gy mk mh l mi mj">  constructor(<br/>    private store: Store&lt;any&gt;,<br/>  ) {<br/>    store.pipe(select('menuState'))<br/>      .subscribe(menuOpen =&gt; {<br/>        this.menuOpen = menuOpen;<br/>      })<br/>  }</span><span id="a783" class="me mf it lz b gy mk mh l mi mj"><a class="ae ky" href="http://twitter.com/HostListener" rel="noopener ugc nofollow" target="_blank">  @HostListener</a>('document:click', ['$event'])<br/>  public onClick(event) {<br/>    const isOutside = !event.target.className.includes("menu-button") &amp;&amp;<br/>      !event.target.className.includes("material-icons") &amp;&amp;<br/>      !event.target.className.includes("mat-drawer-inner-container")<br/>    if (isOutside) {<br/>      this.menuOpen = false;<br/>      this.store.dispatch({ type: SET_MENU_STATE, payload: this.menuOpen });<br/>    }<br/>  }</span><span id="ca94" class="me mf it lz b gy mk mh l mi mj">}</span></pre><p id="4c43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用户在菜单按钮和菜单之外单击时关闭菜单。在<code class="fe lw lx ly lz b">app.component.html</code>中，我们添加:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="441f" class="me mf it lz b gy mg mh l mi mj">&lt;mat-sidenav-container class="example-container"&gt;<br/>  &lt;mat-sidenav mode="side" [opened]='menuOpen'&gt;<br/>      &lt;ul&gt;<br/>          &lt;li&gt;<br/>              &lt;b&gt;<br/>                  New York Times<br/>              &lt;/b&gt;<br/>          &lt;/li&gt;<br/>          &lt;li&gt;<br/>              &lt;a routerLink='/'&gt;Home&lt;/a&gt;<br/>          &lt;/li&gt;<br/>      &lt;/ul&gt;</span><span id="27ab" class="me mf it lz b gy mk mh l mi mj">&lt;/mat-sidenav&gt;<br/>  &lt;mat-sidenav-content&gt;<br/>      &lt;app-tool-bar&gt;&lt;/app-tool-bar&gt;<br/>      &lt;div id='content'&gt;<br/>          &lt;router-outlet&gt;&lt;/router-outlet&gt;<br/>      &lt;/div&gt;<br/>  &lt;/mat-sidenav-content&gt;<br/>&lt;/mat-sidenav-container&gt;</span></pre><p id="3327" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加菜单、左侧导航和<code class="fe lw lx ly lz b">router-outlet</code>元素，让人们看到我们定义的路线。</p><p id="d99e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">app.component.scss</code>中，我们添加:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="ec7d" class="me mf it lz b gy mg mh l mi mj">#content {<br/>  padding: 20px;<br/>  min-height: 100vh;<br/>}</span><span id="7311" class="me mf it lz b gy mk mh l mi mj">ul {<br/>  list-style-type: none;<br/>  margin: 0;<br/>  li {<br/>    padding: 20px 5px;<br/>  }<br/>}</span></pre><p id="2767" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向页面添加一些填充，并更改左侧菜单中项目的列表样式。</p><p id="f64d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">environment.ts</code>中，我们加上:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="4a0a" class="me mf it lz b gy mg mh l mi mj">export const environment = {<br/>  production: false,<br/>  apiUrl: '<a class="ae ky" href="http://localhost:3000'" rel="noopener ugc nofollow" target="_blank">http://localhost:3000'</a><br/>};</span></pre><p id="a6f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为我们的API添加URL。</p><p id="9605" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">styles.scss</code>中，我们添加:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="1b99" class="me mf it lz b gy mg mh l mi mj">/* You can add global styles to this file, and also import other style files */<br/><a class="ae ky" href="http://twitter.com/import" rel="noopener ugc nofollow" target="_blank">@import</a> "~<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/prebuilt-themes/indigo-pink.css";</span><span id="51cd" class="me mf it lz b gy mk mh l mi mj">body {<br/>  font-family: "Roboto", sans-serif;<br/>  margin: 0;<br/>}</span><span id="c675" class="me mf it lz b gy mk mh l mi mj">form {<br/>  mat-form-field {<br/>    width: 95vw;<br/>    margin: 0 auto;<br/>  }<br/>}</span><span id="7cf5" class="me mf it lz b gy mk mh l mi mj">.center {<br/>  text-align: center;<br/>}</span></pre><p id="c1d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导入<a class="ae ky" href="https://material.io/design/" rel="noopener ugc nofollow" target="_blank">材料设计</a>主题并改变表单字段的宽度。</p><p id="28b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">app.module.ts</code>中，我们将现有代码替换为:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="3dea" class="me mf it lz b gy mg mh l mi mj">import { BrowserModule } from '<a class="ae ky" href="http://twitter.com/angular/platform-browser" rel="noopener ugc nofollow" target="_blank">@angular/platform-browser</a>';<br/>import { NgModule } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { FormsModule } from '<a class="ae ky" href="http://twitter.com/angular/forms" rel="noopener ugc nofollow" target="_blank">@angular/forms</a>';<br/>import { AppRoutingModule } from './app-routing.module';<br/>import { AppComponent } from './app.component';<br/>import { HomePageComponent } from './home-page/home-page.component';<br/>import { StoreModule } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { reducers } from './reducers';<br/>import { MatSidenavModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/sidenav';<br/>import { MatToolbarModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/toolbar';<br/>import { MatInputModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/input';<br/>import { MatFormFieldModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/form-field';<br/>import { ToolBarComponent } from './tool-bar/tool-bar.component';<br/>import { BrowserAnimationsModule } from '<a class="ae ky" href="http://twitter.com/angular/platform-browser" rel="noopener ugc nofollow" target="_blank">@angular/platform-browser</a>/animations';<br/>import { MatButtonModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/button';<br/>import { HttpClientModule } from '<a class="ae ky" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http';<br/>import { MatSelectModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/select';<br/>import { MatCardModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/card';<br/>import { MatListModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/list';<br/>import { MatMenuModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/menu';<br/>import { MatIconModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/icon';<br/>import { MatGridListModule } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>/grid-list';<br/>import { AddTodoDialogComponent } from './add-todo-dialog/add-todo-dialog.component';<br/>import { DragDropModule } from '<a class="ae ky" href="http://twitter.com/angular/cdk" rel="noopener ugc nofollow" target="_blank">@angular/cdk</a>/drag-drop';</span><span id="cf6f" class="me mf it lz b gy mk mh l mi mj"><a class="ae ky" href="http://twitter.com/NgModule" rel="noopener ugc nofollow" target="_blank">@NgModule</a>({<br/>  declarations: [<br/>    AppComponent,<br/>    HomePageComponent,<br/>    ToolBarComponent,<br/>    AddTodoDialogComponent<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    AppRoutingModule,<br/>    StoreModule.forRoot(reducers),<br/>    FormsModule,<br/>    MatSidenavModule,<br/>    MatToolbarModule,<br/>    MatInputModule,<br/>    MatFormFieldModule,<br/>    BrowserAnimationsModule,<br/>    MatButtonModule,<br/>    MatMomentDateModule,<br/>    HttpClientModule,<br/>    MatSelectModule,<br/>    MatCardModule,<br/>    MatListModule,<br/>    MatMenuModule,<br/>    MatIconModule,<br/>    MatGridListModule,<br/>    DragDropModule<br/>  ],<br/>  providers: [</span><span id="b531" class="me mf it lz b gy mk mh l mi mj">],<br/>  bootstrap: [AppComponent],<br/>  entryComponents: [<br/>    AddTodoDialogComponent<br/>  ]<br/>})<br/>export class AppModule { }</span><span id="a73d" class="me mf it lz b gy mk mh l mi mj">text-align: center;<br/>}</span></pre><p id="0a93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lw lx ly lz b">todo.service.ts</code>中，我们输入:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="b197" class="me mf it lz b gy mg mh l mi mj">import { Injectable } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { HttpClient } from '<a class="ae ky" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http';<br/>import { environment } from 'src/environments/environment';</span><span id="ae4b" class="me mf it lz b gy mk mh l mi mj"><a class="ae ky" href="http://twitter.com/Injectable" rel="noopener ugc nofollow" target="_blank">@Injectable</a>({<br/>  providedIn: 'root'<br/>})<br/>export class TodoService {</span><span id="5586" class="me mf it lz b gy mk mh l mi mj">  constructor(<br/>    private http: HttpClient<br/>  ) { }</span><span id="6942" class="me mf it lz b gy mk mh l mi mj">  getTodos() {<br/>    return this.http.get(`${environment.apiUrl}/todos`);<br/>  }</span><span id="f910" class="me mf it lz b gy mk mh l mi mj">  addTodo(data) {<br/>    return this.http.post(`${environment.apiUrl}/todos`, data);<br/>  }</span><span id="1381" class="me mf it lz b gy mk mh l mi mj">  editTodo(data) {<br/>    return this.http.put(`${environment.apiUrl}/todos/${data.id}`, data);<br/>  }</span><span id="5ace" class="me mf it lz b gy mk mh l mi mj">  removeTodo(id) {<br/>    return this.http.delete(`${environment.apiUrl}/todos/${id}`);<br/>  }<br/>}</span></pre><p id="efae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些函数让我们通过向我们的JSON API发出请求来对我们的待办事项进行CRUD操作，我们将使用<a class="ae ky" href="https://github.com/typicode/json-server" rel="noopener ugc nofollow" target="_blank"> JSON Server </a> Node.js包添加该API。</p><p id="197e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据将被保存到一个JSON文件中，所以我们不必让我们自己的后端添加它，来保存一些简单的数据。我们通过运行<code class="fe lw lx ly lz b">npm i -g json-server</code>来安装服务器。</p><p id="f823" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦完成，进入项目目录并运行<code class="fe lw lx ly lz b">json-server --watch db.json</code>。在<code class="fe lw lx ly lz b">db.json</code>中，我们把:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="84e8" class="me mf it lz b gy mg mh l mi mj">{<br/>  "todos": []<br/>}</span></pre><p id="df5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以便我们可以使用这些端点将数据保存到<code class="fe lw lx ly lz b">db.json</code>。</p><p id="b3ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一切完成后，我们得到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/2c8c31361895bc6cb7c921155c7fba61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9gAZTHEpqJ4Yriijwu0u8w.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/2d95589c11e1c76ee77dd41dc04416cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qx7XljD3UwZnv_8fynrRqw.png"/></div></div></figure></div></div>    
</body>
</html>