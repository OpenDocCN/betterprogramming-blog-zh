<html>
<head>
<title>String Encodings Decoded With Elixir</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Elixir解码的字符串编码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/string-encodings-decoded-4818b4e30cb3?source=collection_archive---------17-----------------------#2022-04-12">https://betterprogramming.pub/string-encodings-decoded-4818b4e30cb3?source=collection_archive---------17-----------------------#2022-04-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9156" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">知道弦的工作原理</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0c2829ef06f57b4748713611b70345e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZpG73dJe_naV86m-uXyfcA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">UTF-8是某种无法破解的密码吗？</p></figure><p id="e4c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在是你成为黑暗问号秘密社团成员的时候了。这可能是你需要阅读的编码的最后解释。</p><p id="7814" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我已经和字符串编码纠缠了很多年，但是直到我开始使用长生不老药，我才最终<em class="lu">真正</em>理解它们。我的弦乐启蒙已经过去几年了，但让我与你分享我学到的所有课程，这样你就可以将误解抛诸脑后。下面是我关于字符串和编码的来之不易的知识，我希望有人告诉过我。☯⚡❁♛</p><p id="d793" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在你真正理解编码之前，你需要对字符串数据类型有更好的理解——是的，背景故事是必要的，如果你真的想大吃一惊，我强烈推荐阅读Edaqa Mortoray的“<a class="ae lv" href="https://mortoray.com/2013/11/27/the-string-type-is-broken/" rel="noopener ugc nofollow" target="_blank">字符串类型被破坏</a>”。</p><p id="43a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">需要特别考虑的是，字符串不同于其他任何数据类型。布尔值是简单的开/关；数字可以受其大小的限制(例如8位数字)。但是一根绳子？它可能是无限长的，由几乎任何东西组成。好奇好奇……(酝酿了一下那种困惑)…</p><p id="5ab5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我总觉得围绕软件开发的学术研究完全落后了:你很早就了解了RAM和电路板，但很少(如果有的话)得到关于版本控制系统、如何调试的学术指导，或者任何关于行业状态的真实信息。如果你毕业时获得了计算机科学学位，你可能会不假思索地说出过时的秘传知识(因为你的课程材料可能至少有五年了)，但如果你的生活依赖于它，你可能不知道如何通过编码摆脱真正的软件项目。也许只有疯狂的开发人员面试过程与你每天实际需要知道和做的事情更不同步。</p><p id="c2ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">钻研字符串和编码标志着我第一次回到大学课堂。重要的几点是:</p><ol class=""><li id="5104" class="lw lx it la b lb lc le lf lh ly ll lz lp ma lt mb mc md me bi translated">计算机上的一切都用数字表示(即1和0)</li><li id="6480" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mb mc md me bi translated">你需要知道号码的大小来正确地存储它</li></ol><p id="ad77" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后一个问题比较棘手。为什么？因为你需要知道一个块在哪里结束，下一个块在哪里开始。考虑一个可疑的域名:<code class="fe mk ml mm mn b">penisland.com</code>。如果你知道第一个单词是3个字母长，你就在书写工具和文具的领域。然而，如果你肮脏的头脑猜测第一个单词有5个字母，你就完全到了一个不同的地方。所以重要的一点是…咳咳… <em class="lu">尺寸很重要。</em></p><p id="ed97" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们将此转换为二进制数字，其中8位数字可以是<code class="fe mk ml mm mn b">00000000</code>到<code class="fe mk ml mm mn b">11111111</code>(即0到255)，16位数字可以是<code class="fe mk ml mm mn b">0000000000000000</code>到<code class="fe mk ml mm mn b">1111111111111111</code> (0到65，535)。让我们在二进制背景下重温我们之前的困惑:什么是<code class="fe mk ml mm mn b">0010101000101010</code>？如果我们把它理解为一个16位的数字，那么它就是10，794。如果我们将其解释为两个8位数字，我们将得到42和42。这些是截然不同的答案。好奇，好奇…再多坚持一会儿这种不断增长的困惑…</p><p id="628e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来你需要了解的是<a class="ae lv" href="https://home.unicode.org/" rel="noopener ugc nofollow" target="_blank"> Unicode </a>。这是现实世界中的谷物解码环。而不是简单的旋转密码，其中A=1，B=2，等等。，Unicode为<em class="lu">通用字符编码设定数值，</em>包括<em class="lu">世界上所有书写系统的字符，现代和古代，</em>包括技术符号、标点符号和许多其他用于书写文本的字符。这就像一个谷物解码器环酸…方式。出去。那里。</p><ul class=""><li id="262c" class="lw lx it la b lb lc le lf lh ly ll lz lp ma lt mo mc md me bi translated"><code class="fe mk ml mm mn b">a</code>由数字97表示</li><li id="147c" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mo mc md me bi translated">☮由9774人代表</li><li id="c1ac" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mo mc md me bi">我 is represented by 25,105</li><li id="0a82" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mo mc md me bi translated"><em class="lu">…以此类推… </em></li></ul><p id="15bf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里重要的一点是，你可以输入电脑的每一个可能的字母、数字或符号都有一个与之相关的数字，称为代码点，这都要归功于Unicode标准。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/2ee6335d09dc58e43b291b938d75dee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vkqylxZWnrxS4hNki9YD4g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Unicode奇点:可能是所有人类文明中最重要的约定</p></figure><p id="d7dd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我让你酝酿一下你的困惑，现在我们可以通过一个苏格拉底式的问题来发泄一下:有多少Unicode符号？因为如果我们知道这个“字母表”支持多少个符号，我们就会知道存储相应数字所需的大小。结果发现有超过144，000个字符，涵盖了159种现代和历史文字，以及符号、表情符号、非视觉控制和格式化代码。如果我们做一些快速的数学计算，我们意识到我们可以用大约18位来表示144，000个组合(以及更多)，即2个⁸.这意味着无论你想用什么疯狂的古代语言或符号来表示，你都可以将它们存储为一系列18位数字，Unicode会支持你。</p><p id="f5ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，可以引入查理学家的“二郎神/长生不老药”概念。您有一个表示代码点的整数列表(即数组)。不是“abc”，而是“97，98，99”，所有这些都可以通过Unicode标准翻译。用专业术语来说，Erlang/Elixir charlists是<em class="lu">未编码的</em> <em class="lu">代码点列表</em>。我们可以将任何语言中的任何字母或符号表示为一个数字，而charlist就是这些数字的简单列表。这非常接近一个字符串，唯一的区别是它是未编码的，而字符串是编码的。那么，被编码的东西到底意味着什么？</p><p id="173b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们真的很接近开悟了。多亏了Unicode，我们有了一种用数字表示所有人类知识并以数字形式存储的方法。唯一的问题是每个字符2个⁸+位<em class="lu">占据了很多空间</em>。在大多数情况下，对于拉丁文文本，我们只需要表示127左右的数字…当大多数情况下，7或8位就足够了时，为每个字符分配18位将是一种严重的牺牲。正是这种对效率的追求让我们选择了编码。编码不是要求每个字符有固定的位数，而是通过动态改变使用的位数来节省空间。如果你听说过“可变比特率编码”，这就是他们正在谈论的。这就是为什么mp3或WMA文件小于固定比特率的替代品。</p><p id="9967" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">UTF-8是高效编码字符串的出色解决方案，这一点必须得到认可；还有其他的字符串编码，但是UTF-8是目前网络的主导标准(98%)。我们最终得到的是一个自始至终依赖于8位数字的约定，我们牺牲了几个“头位”来告诉我们每个字符使用了多少字节。这为我们提供了与ASCII的向后兼容性，表示任何Unicode码位的能力，以及自同步的字符边界，因此即使传输被破坏，解码过程通常仍能提供可读的文本——最糟糕的情况是，当遇到无效字符时，会添加一些黑色问号。相比之下，当单个位不合适时，其他编码将灾难性地失败。</p><p id="6a89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我写的帮助我理解发生了什么的灵药包被命名为<a class="ae lv" href="https://hexdocs.pm/xray/" rel="noopener ugc nofollow" target="_blank">x射线</a>，我将在这里演示它的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/f09a0b4916e4ddd0352bf01ac4fa9df1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EKKVcoxtHSzhslAdUgfvtA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">x射线揭示了字符串是如何使用UTF-8编码的</p></figure><p id="b10b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi">Per the Unicode standard, we know that the Chinese symbol for 我 (“I” or “me”) is represented by the number 25,105. It’s curious then, that this becomes encoded as <code class="fe mk ml mm mn b">11100110 10001000 10010001</code> in binary. If this were simply a 24-bit number, it would represent 15,108,241. But because it is encoded, we have to look more closely: the first few bits are regarded as <em class="lu">“header bits”</em> (visible in red in <a class="ae lv" href="https://hexdocs.pm/xray/" rel="noopener ugc nofollow" target="_blank">Xray’s</a> output). The headers tell us how many bytes are going to be used to represent the character (3 in this case). If we drop the header bits from the output and look only at the remaining green bits, we have <code class="fe mk ml mm mn b">0110001000010001</code> which represents (you guessed it) 25,105.</p><p id="357d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Elixir提供了一个很好的窗口来了解字符串是如何工作的，因为您可以很容易地看到它们是整数的文字字符串，并且因为它们是内部UTF-8编码的，所以它们的表示方式不会有任何差异。我不认为我在开始使用Elixir时最终研究字符串和编码是偶然的——它在许多其他语言中并不透明。</p><p id="74d7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想更深入地了解UTF-8解决方案有多棒，我建议你花几分钟时间观看一个关于这个主题的简短视频。下次再见，快乐编码，如果你需要检查一些字符串，请查看<a class="ae lv" href="https://hexdocs.pm/xray/" rel="noopener ugc nofollow" target="_blank">x射线</a>！</p></div></div>    
</body>
</html>