<html>
<head>
<title>Navigation With Jetpack Compose in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中使用Jetpack组合导航</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/navigation-with-jetpack-compose-in-android-ab84d0984ade?source=collection_archive---------6-----------------------#2021-03-31">https://betterprogramming.pub/navigation-with-jetpack-compose-in-android-ab84d0984ade?source=collection_archive---------6-----------------------#2021-03-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ed3c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在可组合函数之间导航，使用自定义对象作为参数，等等</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/37be9de392412bc02359591c78bbeafc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AEjSDq4joYGXub40"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@tak_tag?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">田口孝宏</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="23a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，您将了解如何在Jetpack Compose中实现导航。您还将学习如何在导航时传递原始数据类型和自定义数据对象。</p><p id="e242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">注意:Jetpack Compose最近已转移到测试版。这意味着API结构将不再有任何剧烈的变化。因此，这将是学习如何使用下一代UI套件进行Android开发的大好时机。导航是Android开发中的核心任务之一，所以请欣赏这篇文章。</em></p><p id="da37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">您需要安装北极狐版本的Android Studio Canary才能使用Jetpack Compose Beta。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e7f1" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">介绍</h1><p id="d64f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Jetpack Compose可以与像<code class="fe na nb nc nd b">Fragments</code>这样的Android组件互操作。因此，如果您有一个现有的项目，您决定迁移到Jetpack Compose，那么导航不会有任何变化。</p><p id="003d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您决定迁移整个应用程序，而不使用任何Android组件，比如<code class="fe na nb nc nd b">Fragments</code>，或者创建一个只有组件的全新应用程序，那么本文就是为您准备的。</p><p id="7b7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我们将使用<code class="fe na nb nc nd b">Navigation</code>架构组件来实现屏幕之间的导航。如果你不熟悉，我强烈推荐你阅读下面这篇文章:</p><div class="ne nf gp gr ng nh"><a rel="noopener  ugc nofollow" target="_blank" href="/jitpack-navigation-component-in-android-944165c35f54"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">Android中的JetPack导航组件</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">近十年后，Android团队为开发者引入了一个新的导航系统</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">better编程. pub</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv ks nh"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1c4c" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">在Compose中创建一个具有两个屏幕的应用程序</h1><p id="bcf2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">与传统的Android开发不同，Jetpack Compose没有任何像<code class="fe na nb nc nd b">Fragments</code>和<code class="fe na nb nc nd b">Activities</code>这样的约束。我们可以使用一个可组合的函数来表示屏幕的一部分或者整个屏幕。当你从头开始构建一个项目时，我建议只使用composables，因为这样你就可以利用Compose的力量。</p><p id="397e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更好地理解Jetpack Compose中的导航，让我们构建一个带有两个屏幕的<code class="fe na nb nc nd b">Subscription</code>应用程序:<code class="fe na nb nc nd b"> SubscriptionsListScreen</code>和<code class="fe na nb nc nd b">SubscriptionDetailsScreen</code>。看一下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="663d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这段代码中，我们有三个可组合的函数，代表应用程序中的两个屏幕:</p><ul class=""><li id="9be2" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><code class="fe na nb nc nd b">SubscriptionsListScreen</code>是一个表示订阅列表屏幕的可组合函数，它将订阅列表作为一个参数。</li><li id="d166" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><code class="fe na nb nc nd b">SubscriptionsListItem</code>是一个表示订阅列表项设计的可组合函数，它将<code class="fe na nb nc nd b">Subscription</code>数据类作为参数。</li><li id="0490" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><code class="fe na nb nc nd b">SubscriptionDetailsScreen</code>是一个可组合的函数，表示用户从列表中导航到的订阅的细节，它将<code class="fe na nb nc nd b">Subscription</code>数据类作为参数。</li></ul><p id="76ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，<code class="fe na nb nc nd b">SubscriptionsListScreen</code>和<code class="fe na nb nc nd b">SubscriptionDetailsScreen</code>代表应用程序的列表和详情屏幕。与传统开发相比，它们充当<code class="fe na nb nc nd b">Activity</code>或<code class="fe na nb nc nd b">Fragment</code>布局。同时，<code class="fe na nb nc nd b">SubscriptionsListItem</code>代表屏幕的子部分，类似于<code class="fe na nb nc nd b">RecyclerView</code>适配器项目。</p><p id="a068" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在这里的任务是在列表和细节屏幕之间创建一个导航框架，绕过订阅信息。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="3e8f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">综合</h1><p id="8233" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了让<code class="fe na nb nc nd b">Navigation</code>组件与Compose一起工作，我们必须在dependencies节点下添加下面一行。这将增加导航与可组合函数的兼容性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="184b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">导航框架</h1><p id="a28f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在进入<code class="fe na nb nc nd b">Navigation</code>组件之前，你应该了解一下Android中的<code class="fe na nb nc nd b">remember</code>。在声明式UI系统中，代码本身描述了UI。我们需要描述任何时间点的UI——不仅仅是初始时间。</p><p id="7a86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决这个问题并以最简单的方式有效地维护状态，Jetpack Compose提供了<code class="fe na nb nc nd b">remember</code>。<code class="fe na nb nc nd b">remember</code>基本上在任何给定的时间点跟踪状态。要更好地理解和了解Jetpack Compose中的<code class="fe na nb nc nd b">remember</code>和其他组件，请阅读以下文章:</p><div class="ne nf gp gr ng nh"><a rel="noopener  ugc nofollow" target="_blank" href="/jetpack-compose-components-part-2-2b3eb135d294"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd iu gy z fp nm fr fs nn fu fw is bi translated">Jetpack合成组件(第2部分)</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">查看图标、图像、记忆、间隔、单选按钮、加载器、开关和复选框以及滑块</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">better编程. pub</p></div></div><div class="nq l"><div class="om l ns nt nu nq nv ks nh"/></div></div></a></div><p id="a3ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是时候开始为组件实现导航框架了。通过集成前面提到的库，<code class="fe na nb nc nd b">Navigation</code>组件与开箱即用的组件完全兼容。</p><p id="ca15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先需要了解的是<em class="lv"> </em>创建一个<code class="fe na nb nc nd b">NavHostController</code>来处理<code class="fe na nb nc nd b">ComposeNavigator</code>的添加的<code class="fe na nb nc nd b">rememberNavController</code>可组合函数。这将返回<code class="fe na nb nc nd b">NavHostController</code>，我们可以用它在可组合函数之间导航。</p><pre class="kj kk kl km gt on nd oo op aw oq bi"><span id="0506" class="or me it nd b gy os ot l ou ov">val navController = <em class="lv">rememberNavController</em>()</span></pre><p id="0bea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要创建一个将所有屏幕作为对象的密封类。对于我们的例子，我们有两个对象:<code class="fe na nb nc nd b">SubscriptionsList</code>和<code class="fe na nb nc nd b">SubscriptionDetails</code>。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="04af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是时候创建我们的主可组合函数了，所有的组合屏幕都嵌入在<code class="fe na nb nc nd b">NavHost</code> <em class="lv"> </em>可组合函数中。一旦调用了这个函数，就可以从提供的<code class="fe na nb nc nd b">navController</code>中导航到给定的<code class="fe na nb nc nd b">NavGraphBuilder</code>中的任何可组合组件。在我们的例子中，我们有两个可组合的屏幕，我们需要在<code class="fe na nb nc nd b">NavHost</code>中声明它们，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="f4c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">composable</code>是<code class="fe na nb nc nd b">NavGraphBuilder</code>上的扩展函数，用来给<code class="fe na nb nc nd b">NavGraphBuilder</code>添加一个可组合的。下一步是传递参数。<code class="fe na nb nc nd b">SubscriptionDetailsScreen</code>可组合函数期望<code class="fe na nb nc nd b">Subscription</code>数据类作为参数来显示细节。</p><p id="0e5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，我们需要给我们的<code class="fe na nb nc nd b">MainActivity</code>类中的<code class="fe na nb nc nd b">SubscriptionsMain</code>组件充气。</p><p id="f362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于参数和深层链接支持，<code class="fe na nb nc nd b">composable</code>扩展函数还有两个list类型的参数，默认值为<code class="fe na nb nc nd b">emptyList</code> <em class="lv">。</em>看看功能就有更好的主意了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="3a05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">arguments</code>和<code class="fe na nb nc nd b">deepLinks</code>参数是可选的。在我们的例子中，我们需要将参数传递给细节，但是主屏幕不需要。基本上，我们需要将字符串类型的订阅名称作为参数传递。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="2d5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果你看到我们更新的<code class="fe na nb nc nd b">SubscriptionsMain</code>函数，在details composable中，我们已经将字符串类型的订阅名称声明为一个参数，并且我们正在lambda中使用该参数。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2c15" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">在可组合函数之间导航</h1><p id="3c7b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">一般来说，要在任何Android组件之间导航，我们需要<code class="fe na nb nc nd b">navController</code>。可组合函数也是如此。为了从另一个组件中触发或启动一个组件，我们需要<code class="fe na nb nc nd b">navController</code>。</p><p id="2245" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与传统方法不同，composables还不能找到<code class="fe na nb nc nd b">navController</code>。所以我们需要传递我们在<code class="fe na nb nc nd b">SubscriptionsMain</code>函数中创建的<code class="fe na nb nc nd b">navController</code>。如果一个可组合函数需要触发另一个可组合函数，源可组合函数应该接受<code class="fe na nb nc nd b">navController</code>作为参数。在我们的例子中，<code class="fe na nb nc nd b">SubscriptionsListScreen</code>和<code class="fe na nb nc nd b">SubscriptionsListItem</code>应该有<code class="fe na nb nc nd b">navController</code>。看看更新的组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="92b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要将<code class="fe na nb nc nd b">navController</code>传递给更新的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="9d2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以从订阅列表项导航到详细信息。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b557" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。我们已经学习了如何设置导航框架，以及如何通过参数在屏幕之间导航。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9d8f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">自定义对象作为参数</h1><p id="968a" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">使用Jetpack Compose导航仍然在alpha中，所以像传递<code class="fe na nb nc nd b">parcelable</code>对象这样的特性还不被支持。作为一种变通方法，我们可以将object类转换成一个<code class="fe na nb nc nd b">gson</code>字符串，并在另一端提取对象。</p><p id="824b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要在dependencies节点下添加下面一行，以便在项目中包含<code class="fe na nb nc nd b">gson</code>库:</p><pre class="kj kk kl km gt on nd oo op aw oq bi"><span id="ed10" class="or me it nd b gy os ot l ou ov">implementation <strong class="nd iu">"com.google.code.gson:gson:2.8.6"</strong></span></pre><p id="07f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们需要将自定义对象转换成一个字符串，并将该字符串作为参数传递。看一看:</p><pre class="kj kk kl km gt on nd oo op aw oq bi"><span id="fc93" class="or me it nd b gy os ot l ou ov">val gsonString = Gson().toJson(<strong class="nd iu">subscription</strong>)<br/>navController.<strong class="nd iu"><em class="lv">navigate</em></strong>("details/$<strong class="nd iu">gsonString</strong>")</span></pre><p id="7a0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，我们可以使用<code class="fe na nb nc nd b">fromJson</code>函数获得<code class="fe na nb nc nd b">Subscription</code>类对象。看一看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7eab" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">奖金</h1><p id="84b2" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">要了解有关Jetpack Compose的更多信息，请查看以下文章:</p><ul class=""><li id="ffa0" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/theming-in-jetpack-compose-for-android-667d42b8279c">“Android版Jetpack Compose中的主题化”</a></li><li id="52aa" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/jetpack-compose-components-part-1-a80717dbfb59">“Jetpack合成组件(第1部分)”</a></li><li id="a0e8" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><a class="ae ky" href="https://medium.com/better-programming/jetpack-compose-a-new-and-simple-way-to-create-material-ui-in-android-f49c6fcb448b" rel="noopener">“Jetpack Compose——一种在Android中创建素材UI的简单新方法”</a></li><li id="383c" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><a class="ae ky" href="https://medium.com/android-dev-hacks/jetpack-compose-with-server-driven-ui-396a19f0a661" rel="noopener">“使用服务器驱动的用户界面构建JetPack”</a></li></ul><p id="9195" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前就这些。希望你学到了有用的东西。感谢阅读。</p></div></div>    
</body>
</html>