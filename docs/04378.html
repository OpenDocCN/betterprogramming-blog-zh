<html>
<head>
<title>How to Deploy a React Website on AWS S3 With GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用GitHub操作在AWS S3上部署React网站</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-deploy-a-reactjs-website-on-aws-s3-with-github-ci-f0519d120063?source=collection_archive---------6-----------------------#2020-04-09">https://betterprogramming.pub/how-to-deploy-a-reactjs-website-on-aws-s3-with-github-ci-f0519d120063?source=collection_archive---------6-----------------------#2020-04-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e385" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">持续集成和部署(CI/CD)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3bc421e4595a1f6029ab1d591b903838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAhM8mSm8vlUsJBsmACN5Q.png"/></div></div></figure><p id="9cec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我最近需要部署和托管一个React网站。我一直依赖AWS。在本文中，我将解释如何使用GitHub Actions在AWS S3上部署和托管React网站，以实现应用程序的持续集成和部署(CI/CD)。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="8bf2" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">我们将使用哪些技术和组件？</h1><p id="e011" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">对于本教程，我们需要以下技术:</p><ul class=""><li id="fe7c" class="mr ms iq kt b ku kv kx ky la mt le mu li mv lm mw mx my mz bi translated">反应部署</li><li id="914d" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated">用于托管源代码的GitHub存储库</li><li id="49eb" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated">CI/CD的GitHub操作</li><li id="316c" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated">AWS S3为一个静态网站托管</li></ul><h2 id="bd93" class="nf lv iq bd lw ng nh dn ma ni nj dp me la nk nl mg le nm nn mi li no np mk nq bi translated">先决条件</h2><ul class=""><li id="56a6" class="mr ms iq kt b ku mm kx mn la nr le ns li nt lm mw mx my mz bi translated"><a class="ae nu" href="https://github.com/join" rel="noopener ugc nofollow" target="_blank">一个GitHub账户</a></li><li id="bff8" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><a class="ae nu" href="https://portal.aws.amazon.com/billing/signup" rel="noopener ugc nofollow" target="_blank">AWS账户</a></li><li id="f8f5" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated">React应用程序</li></ul></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="0e52" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">将源代码推送到GitHub</h1><p id="074d" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">为了启用CI，您需要将代码托管在GitHub存储库中。</p><p id="35b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要创建它，在GitHub中，登录后，点击快捷键+按钮，并选择“新建存储库”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/35a9bc2370b3fa8624878cbaebe2d8a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*Dm-S1ZBV3jUPe7tvPaJy-g.png"/></div></figure><p id="5189" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，您应该会看到以下页面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/0cb4c990768e1dda0f86ce4dec4ba9b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CkYMNliNb78ll7rLcfPj5w.png"/></div></div></figure><p id="7e19" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这里，你可以为你的GitHub库选择不同的参数:</p><ul class=""><li id="dd83" class="mr ms iq kt b ku kv kx ky la mt le mu li mv lm mw mx my mz bi translated"><strong class="kt ir">存储库名称</strong>:填写您的项目/子项目的名称</li><li id="69ea" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><strong class="kt ir">描述</strong>:如果您创建一个公共存储库来简要解释它包含的内容，这会很有用</li><li id="e9bf" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><strong class="kt ir">Accessibility——Public或Private </strong>:允许您拥有一个任何人都可以访问的存储库，或者禁止任何人访问，除非您授予他们访问权限(请注意，如果您有一个免费的GitHub帐户，一个私有存储库只能有三个贡献者)</li><li id="4d29" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><strong class="kt ir">用自述文件初始化这个存储库</strong>:我建议你不要选中这个。create-react-app命令通常使用自述文件初始化存储库。</li><li id="14a1" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><strong class="kt ir">添加。gitignore </strong>:和以前一样，我建议选择“None”，因为create-react-app命令会初始化它。</li></ul><p id="d1fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您现在可以创建您的存储库了。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="c4dc" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">将您的应用程序链接到此存储库</h1><p id="6c70" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">现在我们需要在GitHub存储库中托管应用程序的源代码。将这些命令输入到创建应用程序的终端中(使用存储库信息更改粗体参数):</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="43c5" class="nf lv iq ny b gy oc od l oe of">git init<br/>git add .<br/>git commit -m "first commit on Github"<br/>git remote add origin <strong class="ny ir">git@github.com:Thrandread/oagencia.git</strong><br/>git push -u origin master</span></pre><p id="4b9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，您应该看到您的代码托管在GitHub中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/4a867c80ec9895f23d4471f023430a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUbl40hdzJLQt8uIizjI5A.png"/></div></div></figure><p id="81f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们已经通过在GitHub中托管应用程序的代码完成了第一步。我现在将解释如何为这个React应用程序创建和配置AWS S3存储桶。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="f6c0" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">AWS S3铲斗创建</h1><p id="dd24" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">S3存储桶将用于在web上托管应用程序的静态部分(<code class="fe oh oi oj ny b">/build</code>)。要创建它，请先登录AWS控制台，然后导航到S3服务:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/d5d2f7d2d8235006e8a221f709ceca07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E1cshbUC3OIst93biAv1yQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/1576cc997278c1a02630e5e0a1a21eea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5ebDAxXOBc83El_N8jiYA.png"/></div></div></figure><p id="9a0a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如你所看到的，我已经创建了几个AWS S3桶(我已经用灰色框盖住了它们)。</p><p id="b514" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在你进入了S3控制台，点击<code class="fe oh oi oj ny b">Create bucket</code>。会要求您输入存储桶的名称。它必须是全球唯一的，所以我建议您输入您的应用程序将被托管的域名——在我的例子中，它将是<code class="fe oh oi oj ny b"><a class="ae nu" href="https://oagencia.com" rel="noopener ugc nofollow" target="_blank">oagencia.com</a></code>,但是用您自己的替换它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/ac1c782190b5d7437813e95971ca04e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HoEDPuqHgXy08E7Gfa5HMA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/ae5d3fc22f3824016141c5fe5a087021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_D9dMthGfebHYBwZdF-Rtw.png"/></div></div></figure><p id="9fe6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">取消选中“阻止<em class="ol">所有</em>公共访问”参数。由于这个桶将用于托管构建的应用程序，我们需要每个人都能够公开访问该应用程序。</p><p id="f41e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，您可以单击“创建存储桶”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/6f9a449fd9139d67407518dde944e6be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R3JJH-vtP-ENLP_yErgslQ.png"/></div></div></figure><p id="3f41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，通过单击名称选择您的存储桶。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/38c08f251d01fd77ee37f9604c705688.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYs2hg9nQDMUEhaqyDW7sg.png"/></div></div></figure><p id="6704" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">选择“属性”标签，然后选择“静态网站托管”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/21cab0c98e00e9b5b2ecae9a1dc361f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bBoqNSUIpLeSJc0xcfuq_g.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/c62864c7edbd75a1cb65ef9e72b4dc58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BtM-yld5Q4WJpXhCyq5s-w.png"/></div></div></figure><p id="b43e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在此窗口中，选择“使用此存储桶来托管网站”选项在“索引文件”和“错误文件”中填写<code class="fe oh oi oj ny b">index.html</code>，然后保存。</p><p id="5b8b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注意:</strong>同样重要的是要有指向<code class="fe oh oi oj ny b">index.html</code>的错误文档，否则你的应用的React路由器将无法工作！</p><p id="0d65" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您试图访问AWS 提供的<a class="ae nu" href="http://oagencia.com.s3-website.eu-west-3.amazonaws.com" rel="noopener ugc nofollow" target="_blank">端点，您应该得到一个403错误，表示访问被拒绝。要修复它，请导航到“权限”，然后导航到“存储桶策略”在页面底部，单击“策略生成器”</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/8e9758a53eba35a46d6eda49c9bfb8ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UwR2zoycNmvz1oZpDuuibA.png"/></div></div></figure><p id="40df" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您将被重定向到生成该策略的页面。</p><p id="0e8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，选择“S3时段保单”作为保单类型。然后，我们必须按照下面的屏幕截图来定义该语句:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/0628cbd8029002a6b9a23eb3160b7886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KgonDX6r75LXA9SCfu0V9w.png"/></div></div></figure><ul class=""><li id="09a8" class="mr ms iq kt b ku kv kx ky la mt le mu li mv lm mw mx my mz bi translated"><strong class="kt ir">效果</strong>:允许<br/>允许通行。</li><li id="0091" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated">委托人:它将允许每个人都有访问它的能力。</li><li id="3938" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><strong class="kt ir"> AWS服务</strong>:亚马逊S3</li><li id="8c5e" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><strong class="kt ir">动作</strong> : <code class="fe oh oi oj ny b">GetObject</code> <br/>我们希望公众只能获得网站的内容，而不能编辑它。</li><li id="27fe" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><strong class="kt ir">亚马逊资源名称(ARN) </strong> : <code class="fe oh oi oj ny b">arn:aws:s3:::<em class="ol">oagencia.com</em>/*</code> <em class="ol"> <br/> </em>用你的桶名替换<code class="fe oh oi oj ny b"><a class="ae nu" href="https://oagencia.com" rel="noopener ugc nofollow" target="_blank">oagencia.com</a></code>。别忘了在它后面加上<code class="fe oh oi oj ny b">/*</code>，让每个人都可以访问你构建的应用程序的全部内容。</li></ul><p id="f296" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，您可以单击“添加声明”和“生成策略”将打开一个包含您的策略的弹出窗口。复制其内容，将其粘贴到您的S3存储桶的“存储桶策略编辑器”中，然后保存。您应该会看到类似以下截图的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/9e5d4aa323a513f6348a8243726a8200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_pEEakubFEryMtKo5ahIQ.png"/></div></div></figure><p id="ea83" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果您再次尝试访问AWS 提供的<a class="ae nu" href="http://oagencia.com.s3-website.eu-west-3.amazonaws.com" rel="noopener ugc nofollow" target="_blank">端点，您应该会看到404 Not Found错误。这是因为此刻你的桶还是空的。为了解决这个问题，我们必须用GitHub Workflow中的CI来托管构建的应用程序。</a></p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="28ed" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">创建您的GitHub工作流程</h1><p id="8577" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">在这一部分中，我将向您展示如何创建GitHub工作流，该工作流将在对存储库主分支的代码进行修改之后，构建您的应用程序并将其复制到S3存储桶中。</p><p id="1186" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，在<code class="fe oh oi oj ny b">Actions</code>选项卡上转到您之前创建的GitHub存储库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/d6ac44d9513155a28754a96f37cf413a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uF6C3a2k-6_OfzhD9YeI0g.png"/></div></div></figure><p id="ac8f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点按“自己设置工作流程”它将在您的存储库中创建一个文件，您将使用该文件来配置工作流。首先单击“开始提交”和“提交新文件”，将此文件保存到您的存储库中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/df79fb2451819776f53cdbd4970cf0f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uAyrQAo7pdbAzaBtc71KUQ.png"/></div></div></figure><p id="99c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该文件由三个不同的部分组成:</p><ul class=""><li id="3390" class="mr ms iq kt b ku kv kx ky la mt le mu li mv lm mw mx my mz bi translated"><code class="fe oh oi oj ny b">name</code>:您的工作流程的名称。我个人将我的工作流程命名为<code class="fe oh oi oj ny b">Production Build Front</code>。</li><li id="6bcf" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><code class="fe oh oi oj ny b">on</code>:列出将触发工作流运行的动作。保持预先配置的状态:主分支上的push和pull请求将触发工作流执行。</li><li id="32cf" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><code class="fe oh oi oj ny b">jobs</code>:当工作流被触发时，我们将在这里放置我们想要执行的不同命令；</li></ul><p id="6fc2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从删除第19行以下的所有内容开始，因为这些是我们将要构建的步骤。</p><p id="a019" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">工作流必须执行以下操作:</p><ul class=""><li id="c0f7" class="mr ms iq kt b ku kv kx ky la mt le mu li mv lm mw mx my mz bi translated">使用开发应用程序的节点版本</li><li id="b2a9" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated">检查GitHub存储库的内容</li><li id="f04f" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated">安装项目的包依赖项</li><li id="502c" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated">构建优化的生产版本</li><li id="8658" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated">将这个构建部署到您新创建的S3存储桶中</li></ul><h2 id="9dc4" class="nf lv iq bd lw ng nh dn ma ni nj dp me la nk nl mg le nm nn mi li no np mk nq bi translated">1.使用开发应用程序的节点版本</h2><p id="1ac7" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">在第<code class="fe oh oi oj ny b">runs-on: ubuntu-latest</code>行之后，我们将在<code class="fe oh oi oj ny b">strategy</code>中定义应用程序正在使用的节点版本:</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="de6b" class="nf lv iq ny b gy oc od l oe of">strategy:      <br/>  matrix:        <br/>     node-version: [11.x]</span></pre><p id="84b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我的例子中，我的项目是用节点11构建的。这就是我把它放在这里的原因。你可以用你自己的版本替换它，甚至可以放多个。</p><p id="8c2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们现在需要指定工作流程，以便在其步骤中使用该版本:</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="4031" class="nf lv iq ny b gy oc od l oe of">steps:      <br/>  # Use the node version specified in the strategy    <br/>  - name: Use Node.js ${{ matrix.node-version }}      <br/>    uses: actions/setup-node@v1      <br/>    with:        <br/>      node-version: ${{ matrix.node-version }}</span></pre><p id="43cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里做的是名为<code class="fe oh oi oj ny b">Use Node.js 11.x</code> <em class="ol"> </em>(在我的例子中)的步骤将使用您在策略中输入的节点版本。</p><p id="393d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此时，您的工作流文件应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/96f81ac9618fd5f2804d383a95cde1f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_qdtpyiQc3cc8XPNAophBQ.png"/></div></div></figure><h2 id="d99a" class="nf lv iq bd lw ng nh dn ma ni nj dp me la nk nl mg le nm nn mi li no np mk nq bi translated">2.查看GitHub资源库的内容</h2><p id="4458" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">这个工作流需要在构建存储库之前获取它的内容。为此，我们将创建第二个步骤，如下所示:</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="8aa6" class="nf lv iq ny b gy oc od l oe of"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it<br/>- name: Git checkout<br/>  uses: actions/checkout@v2</span></pre><h2 id="b338" class="nf lv iq bd lw ng nh dn ma ni nj dp me la nk nl mg le nm nn mi li no np mk nq bi translated">3.安装项目的包依赖项</h2><p id="404d" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">我们指定了要使用的节点版本。在构建项目之前，我们获得了项目的代码。我们需要通过执行<code class="fe oh oi oj ny b">yarn install</code>命令来安装依赖关系中的所有包。</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="3c4a" class="nf lv iq ny b gy oc od l oe of"># Install packages<br/>- name: Install packages<br/>  run: |<br/>    yarn install</span></pre><p id="9ca3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您的React应用程序不在GitHub存储库的根文件夹中，您可以这样配置这个步骤来导航:(您必须为下面的步骤添加相同的命令)。</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="2546" class="nf lv iq ny b gy oc od l oe of"># Install packages<br/>- name: Install packages<br/>  run: |<br/>   cd react-application-folder/<br/>   yarn install</span></pre><h2 id="fe11" class="nf lv iq bd lw ng nh dn ma ni nj dp me la nk nl mg le nm nn mi li no np mk nq bi translated">4.构建优化的生产版本</h2><p id="f160" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">在将应用程序转移到AWS S3之前，我们必须通过执行<code class="fe oh oi oj ny b">yarn build</code>来创建它的优化版本。</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="a8b2" class="nf lv iq ny b gy oc od l oe of"># Build an optimized production build<br/>- name: Production build      <br/>  run: |        <br/>    unset CI<br/>    yarn build</span></pre><p id="16db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">React对我这边的CI环境有问题。构建期间发生的所有警告都阻止了它。这就是为什么我添加了一个未设置的CI命令(<a class="ae nu" href="https://github.com/facebook/create-react-app/issues/2453" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/create-react-app/issues/2453</a>)。</p><h2 id="2bfd" class="nf lv iq bd lw ng nh dn ma ni nj dp me la nk nl mg le nm nn mi li no np mk nq bi translated">5.将这个构建部署到您新创建的S3存储桶中</h2><p id="66ad" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">最后但同样重要的是，我们必须将生成的构建内容复制到S3存储桶中。</p><p id="b5a4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此，我们将使用Jake Jarvis创建的包S3同步动作。你可以在这里找到它的文档<a class="ae nu" href="https://github.com/marketplace/actions/s3-sync" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="bdbc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后一步的代码将是:</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="8819" class="nf lv iq ny b gy oc od l oe of">    # Deploy to the S3 server<br/>    - name: Deploy to S3<br/>      uses: jakejarvis/s3-sync-action@master<br/>      with:<br/>        args: --acl public-read --delete<br/>      env:<br/>        AWS_S3_BUCKET: ${{ secrets.AWS_PRODUCTION_BUCKET_NAME }}<br/>        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}<br/>        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}<br/>        AWS_REGION: ${{ secrets.AWS_REGION }}<br/>        SOURCE_DIR: "build"</span></pre><p id="db1e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们首先检查S3是否是公共可读的，删除它以前的内容，并粘贴新构建的应用程序。</p><p id="1df7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe oh oi oj ny b">env</code>中，我们指定了多个参数:</p><ul class=""><li id="31f2" class="mr ms iq kt b ku kv kx ky la mt le mu li mv lm mw mx my mz bi translated"><code class="fe oh oi oj ny b">AWS_S3_BUCKET</code>:你的桶名</li><li id="d310" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><code class="fe oh oi oj ny b">AWS_ACCESS_KEY_ID</code>和<code class="fe oh oi oj ny b">AWS_SECRET_ACCESS_KEY</code>:你账户的AWS访问键，允许你在桶上写东西。我会解释如何获得这些。</li><li id="9ea0" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><code class="fe oh oi oj ny b">AWS_REGION</code>:创建存储桶的区域</li><li id="c55d" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><code class="fe oh oi oj ny b">SOURCE_DIR</code>:构建应用的位置。如果您的React应用程序不在GitHub存储库的根文件夹中:</li></ul><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="54e2" class="nf lv iq ny b gy oc od l oe of">SOURCE_DIR: "react-application-folder/build"</span></pre><p id="c0e3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点击<code class="fe oh oi oj ny b">Start commit</code>和<code class="fe oh oi oj ny b">Commit changes</code>保存该文件中的更改。</p><p id="a5c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在你可以看到我们对所有这些参数都使用了GitHub secrets。这些是加密的环境变量。这样做很重要，以便对能够访问您的存储库的人隐藏您的凭证和bucket的每个细节(如果您的GitHub存储库是公开的，这一点很重要)。</p><p id="c801" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要定义这些秘密，请转到<code class="fe oh oi oj ny b">Settings</code>，然后转到<code class="fe oh oi oj ny b">Secrets</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/d5c91af5e45158197436dd0ff128ba08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AZjKww2RC64yGJGZCLSQhA.png"/></div></div></figure><p id="a4ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创造这四个秘密:</p><ul class=""><li id="8ddb" class="mr ms iq kt b ku kv kx ky la mt le mu li mv lm mw mx my mz bi translated"><code class="fe oh oi oj ny b">AWS_PRODUCTION_BUCKET_NAME</code> <strong class="kt ir"> : </strong>你的桶名，<code class="fe oh oi oj ny b"><a class="ae nu" href="https://oagencia.com" rel="noopener ugc nofollow" target="_blank">oagencia.com</a></code>我的情况</li><li id="8b09" class="mr ms iq kt b ku na kx nb la nc le nd li ne lm mw mx my mz bi translated"><code class="fe oh oi oj ny b">AWS_REGION</code>:创建你的木桶的地区— <a class="ae nu" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions" rel="noopener ugc nofollow" target="_blank">你可以在这里找到列表</a></li></ul><p id="840a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要获得访问密钥，请转到AWS控制台，单击您的帐户，然后单击“我的安全凭证”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/cce615024515806296f8bb45cf342a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t1biNabsVoEHxp8c8jZjwA.png"/></div></div></figure><p id="a499" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开“访问密钥(访问密钥ID和秘密访问密钥)”部分，然后单击“创建新的访问密钥”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/73d7fe7269cff80b1c236af99844d958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W__MN69MyMdXoMLrbWlUgg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/c40cd01d684966c746a724f75592fae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cu51nV3kA59FPvsYppiToQ.png"/></div></div></figure><p id="55c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">像这样的弹出窗口应该会打开。复制提供的访问密钥ID，并将其填入<code class="fe oh oi oj ny b">AWS_ACCESS_KEY_ID</code> GitHub secret。对<code class="fe oh oi oj ny b">AWS_SECRET_ACCESS_KEY</code> GitHub秘密的秘密访问密钥做同样的事情。</p><p id="60b0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在您的计算机上下载包含此信息的密钥文件，因为这是以后在需要时找到这些访问的唯一方法。</p><p id="a9f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在一切都配置好了，可以在您的AWS S3 bucket上部署构建的应用程序了。</p><p id="6d4a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了测试它，您现在可以通过在您的GitHub存储库的主分支上提交一个变更来触发您的工作流，看看它是否如预期的那样工作。</p><p id="765c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">转到GitHub中的<code class="fe oh oi oj ny b">Actions</code>选项卡。您应该看到您的工作流正在执行。稍微等一下，它应该是这样显示的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/66fdfb656aeea48c8d63f0d81369990d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9QAooCIQ8ChoOw1_jbS9w.png"/></div></div></figure><p id="927b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果您返回到AWS S3存储区，您可以看到文件已经更新到其中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/be180dfd196d83eeb51282154de1d64b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mrCCQOGeinhp1xo9E-UZTA.png"/></div></div></figure><p id="7de0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并且，如果您最终尝试连接到您的<a class="ae nu" href="http://oagencia.com.s3-website.eu-west-3.amazonaws.com/" rel="noopener ugc nofollow" target="_blank"> S3端点</a>，您应该能够访问您的网站:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/fb3c709fe75b6964d020a1f335a5ff29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QpEqAyAmowkQY5_lEWkWiQ.png"/></div></div></figure></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="017f" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">结论</h1><p id="b198" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">恭喜你！现在，您已经知道如何使用GitHub工作流在AWS S3存储桶上托管React网站。</p><p id="d5b5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在以后的文章中，我将解释如何用Route 53配置一个DNS来链接一个S3桶到你自己的域名。</p></div></div>    
</body>
</html>