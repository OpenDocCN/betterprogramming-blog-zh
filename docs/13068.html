<html>
<head>
<title>How to Run a Flask API Application Container With Gunicorn and Nginx on Podman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Podman上用Gunicorn和Nginx运行Flask API应用容器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-run-a-flask-api-application-container-with-gunicorn-and-nginx-on-podman-6aec86e58b84?source=collection_archive---------7-----------------------#2022-07-25">https://betterprogramming.pub/how-to-run-a-flask-api-application-container-with-gunicorn-and-nginx-on-podman-6aec86e58b84?source=collection_archive---------7-----------------------#2022-07-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="645b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Flask中创建的简要指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/934c286ad28326c52c601bb4a522eaef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1BNl1QMV_bMQMwL2"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@bluewaterglobe?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">瑞典蓝水</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="1aa4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经确定了我们希望如何按照这个<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/organizing-flask-api-with-blueprint-c1c76b025d5d">故事</a>构建我们的应用程序。我改进了应用程序如何使用数据库凭证的代码。Flask在本地运行时使用内置的dev服务器，这不是<a class="ae kv" href="https://flask.palletsprojects.com/en/2.1.x/deploying/" rel="noopener ugc nofollow" target="_blank">推荐</a>用于生产的。</p><p id="37a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您必须为应用程序配置一个WSGI服务器来服务生产流量。有几个可用的WSGI服务器，但是我选择了Gunicorn，因为它比较成熟。然而，Gunicorn主要不是为静态内容和图形服务的。我们应该让行业中的HTTP老大Nginx作为反向代理来处理所有的流量请求和负载平衡，而不是让Gunicorn来处理这些任务。</p><p id="26ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们将在一个podman pod中并排运行两个容器，流量将通过Nginx到达应用程序容器。</p><p id="f43b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面，Dockerfile将基于<code class="fe ls lt lu lv b">ubi/python38</code>映像创建应用程序映像，运行时，gunicorn服务器将按照<code class="fe ls lt lu lv b">appentry.sh</code>文件中的定义启动。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="c575" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Nginx服务器必须配置为向应用程序容器发送流量。在Nginx配置文件中，包含一些配置，告诉Nginx将通过/路由接收的所有流量发送到位于<code class="fe ls lt lu lv b">port 8000</code>的gunicorn服务器。这些配置将按照docker文件添加到Nginx映像中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="dc01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有<code class="fe ls lt lu lv b">govt_structure</code>应用程序和Nginx的代码库和docker文件。我们将在<code class="fe ls lt lu lv b">port 8181</code>上创建一个pod，并将应用程序容器部署到pod。运行以下脚本来执行这些任务:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="a1d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们的应用程序启动并运行，可以在<a class="ae kv" href="http://localhost:8181/sayhello." rel="noopener ugc nofollow" target="_blank">http://localhost:8181/say hello</a>进行测试(<code class="fe ls lt lu lv b">/sayhello</code>只是返回一条消息)。</p><p id="ef60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读。你可以在政府部门的我的<a class="ae kv" href="https://github.com/Wainaina3/publications.git" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中找到完整的代码。</p><p id="d958" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意以下内容:</p><ul class=""><li id="6441" class="ly lz iq ky b kz la lc ld lf ma lj mb ln mc lr md me mf mg bi translated">pip文件内容</li><li id="9203" class="ly lz iq ky b kz mh lc mi lf mj lj mk ln ml lr md me mf mg bi translated">用于提取ubi8/python-38基础映像的Redhat注册表</li><li id="11bd" class="ly lz iq ky b kz mh lc mi lf mj lj mk ln ml lr md me mf mg bi translated">git中没有提交数据库凭据</li><li id="b705" class="ly lz iq ky b kz mh lc mi lf mj lj mk ln ml lr md me mf mg bi translated">使用podman日志<containername>检查日志以防容器崩溃</containername></li></ul></div></div>    
</body>
</html>