<html>
<head>
<title>Create a Swifty Command-Line Tool With ArgumentParser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用ArgumentParser创建一个Swifty命令行工具</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-a-swifty-command-line-tool-with-argumentparser-a6240b512b0b?source=collection_archive---------2-----------------------#2022-10-26">https://betterprogramming.pub/creating-a-swifty-command-line-tool-with-argumentparser-a6240b512b0b?source=collection_archive---------2-----------------------#2022-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="af42" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将笔记保存为文件！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f2be79ff510d3c4c2e43b4c8175c2907.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pS7DKfhdTAxI20nv"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Volodymyr Hryshchenko 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6387" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为iOS开发者，我们每天都在使用终端。很难想象没有Git或CocoaPods这样的命令行工具的编程。</p><p id="206e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">苹果让使用Swift创建自己的命令行工具变得超级简单。在本教程中，让我们深入了解苹果的ArgumentParser框架，并学习如何自己创建一个命令行工具。</p><p id="721f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将看一个简单的例子，并理解创建一个伟大的命令行工具所需的所有部分。最后，我们将讨论作为一名iOS开发人员，这将如何使您受益。</p><h1 id="1516" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">入门指南</h1><p id="7dc7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在本教程中，我们将构建一个命令行工具，使您能够从终端写笔记。它看起来会像这样:</p><p id="0cdb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">clinotes write --file /path/to/save/note/to "This is a note" --force</code></p><p id="c20b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在我的GitHub页面查看完成的项目:</p><div class="mt mu gp gr mv mw"><a href="https://github.com/DavidPiper94/CLINotes" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">GitHub — DavidPiper94/CLINotes</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">这是一个展示如何使用苹果ArgumentParser框架的示例项目。通过…将您的笔记保存为文件</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk kp mw"/></div></div></a></div><p id="29a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，您可以跟随并自己构建项目。在深入研究代码之前，我们需要为我们的命令行工具创建一个新项目。打开Xcode，创建一个新项目，并选择Swift包:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/9c477ca5f8a16d4a5192c7cb510cea69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6EGAsZ8_jpEqSgWHVJrgFA.png"/></div></div></figure><p id="ceff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击下一步。在下一步中，将项目命名为CLINotes，然后单击Create。这将生成一个具有给定名称的新包。</p><p id="0915" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<code class="fe mp mq mr ms b">Package.swift</code>，用以下代码替换其内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="0522" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将一个名为<code class="fe mp mq mr ms b">CLINotes</code>的可执行文件定义为我们包的产品。它还向我们的项目添加了依赖关系<code class="fe mp mq mr ms b">ArgumentParser</code>。</p><p id="8677" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，在组Sources中的组<code class="fe mp mq mr ms b">CLINotes</code>内创建一个名为<code class="fe mp mq mr ms b">main.swift</code>的新文件，暂时保留为空。我们过会儿会看一看它。</p><p id="81e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的项目现在看起来应该与此类似:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/1cc1a90f9861ed08bf6dcb842fc2aca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*OHc8bfm6zl6pX38F8q3XhA.png"/></div></figure><p id="7e4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在一切都设置好了，我们将在接下来的两个部分中开始定义我们的第一个命令和子命令。</p><h1 id="adf3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">定义命令</h1><p id="f867" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">苹果的ArgumentParser框架允许我们将命令行界面定义为简单的Swift类型。所有命令和子命令都被定义为结构，它可以有属性和方法。</p><p id="1c0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它们需要符合<code class="fe mp mq mr ms b">ParsableCommand</code>，该协议是所有命令的基础。让我们从定义我们的第一个命令开始！打开<code class="fe mp mq mr ms b">CLINotes.swift</code>并用以下代码替换其内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="beb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事情是这样的:</p><p id="12fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们从定义顶层命令开始。这是一个名为<code class="fe mp mq mr ms b">CLINotes</code>的结构体，它符合<code class="fe mp mq mr ms b">ParsableCommand</code>。</p><p id="af21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 2</code> —我们将把文件扩展名<code class="fe mp mq mr ms b">.clinote</code>添加到我们的文件中，这样就可以识别由我们的命令行工具创建的笔记。因为我们将在多个地方使用它，所以我们将它存储在属性<code class="fe mp mq mr ms b">fileExtension</code>中。</p><p id="e17e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 3</code> —接下来，我们创建一个<code class="fe mp mq mr ms b">CommandConfiguration</code>。它定义了很多关于你的命令的信息。它可以有许多不同的属性，让我们来看看:</p><ul class=""><li id="90a9" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">commandName</code>:这是您输入命令行来执行命令的名称。如果未设置，将根据结构名称自动生成名称。默认值为<code class="fe mp mq mr ms b">nil</code>。</li><li id="c196" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">abstract</code>:简短的描述应该是一行。更长的描述，可以用<code class="fe mp mq mr ms b">discussion</code>。默认值是一个空字符串。</li><li id="74ef" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">usage</code>:描述如何使用该命令。如果没有设置，自动生成的用法说明将用于帮助消息。默认值为<code class="fe mp mq mr ms b">nil</code>。</li><li id="0bc4" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">discussion</code>:如果你对你的命令有比一行代码<code class="fe mp mq mr ms b">abstract</code>更多的话，你可以通过这个属性来说。默认值是一个空字符串。</li><li id="c377" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">可以对您的命令进行版本化。定义该命令在命令行工具的哪个版本中可用。默认值是一个空字符串。</li><li id="92b5" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">shouldDisplay</code>:显示或隐藏帮助信息中的命令。默认值是<code class="fe mp mq mr ms b">true</code>，所以如果没有改变，会显示一个命令。</li><li id="4ca2" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">subcommands</code>:子命令列表。使用子命令来指定命令，使它们更易于使用。看完<code class="fe mp mq mr ms b">CommandConfiguration</code>我们再来看看如何使用它们。默认值是一个空数组。</li><li id="8c64" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">defaultSubcommand</code>:当用户没有输入子命令时，可以定义子命令。默认值为<code class="fe mp mq mr ms b">nil</code>。</li><li id="9bb7" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">helpNames</code>:这定义了请求帮助的标志名(一种输入类型，我们将在后面的章节中讨论不同的类型)。默认值为<code class="fe mp mq mr ms b">-h</code>和<code class="fe mp mq mr ms b">--help</code>。因此，如果用户输入您的命令名，例如<code class="fe mp mq mr ms b">-h</code>，他们将会看到帮助消息。</li></ul><p id="32e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">都有一个合理的默认值。因此，它们都不是必需的，您很少会用到所有这些属性。通常<code class="fe mp mq mr ms b">commandName</code>、<code class="fe mp mq mr ms b">abstract</code>和——如果需要的话——<code class="fe mp mq mr ms b">subcommands</code>足以提供用户需要的所有信息。</p><h1 id="be59" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">添加子命令</h1><p id="05ce" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们添加一个子命令来进一步指定我们的命令行工具的功能。不过，在<code class="fe mp mq mr ms b">CLINotes.swift</code>中，用下面的代码替换它的内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d4d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 1</code>——我们不需要<code class="fe mp mq mr ms b">CommandConfiguration</code>的很多属性。在我们的示例<code class="fe mp mq mr ms b">commandName</code>、<code class="fe mp mq mr ms b">abstract</code>和<code class="fe mp mq mr ms b">discussion</code>为我们的命令行工具的用户提供了有用的信息。因此，我们保留它们并删除其余的。此外，我们将当前添加的新命令添加到<code class="fe mp mq mr ms b">subcommands</code>。</p><p id="e23e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 2</code>—子命令也是符合<code class="fe mp mq mr ms b">ParsableCommand</code>的结构，就像我们之前创建的顶层命令一样。我们将新的<code class="fe mp mq mr ms b">Write</code>命令放在我们的<code class="fe mp mq mr ms b">CLINotes</code>命令中。A <code class="fe mp mq mr ms b">CommandConfiguration</code>提供了更多信息。</p><h1 id="8665" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">构建和运行命令行工具</h1><p id="7056" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在我们已经准备好了命令，让我们构建并运行我们的程序。</p><p id="262a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是还有最后一件事要做。打开<code class="fe mp mq mr ms b">main.swift</code>，将其内容替换为以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="20ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">main.swift</code>是执行我们命令行工具的主要入口点。通过调用顶层命令中的<code class="fe mp mq mr ms b">main()</code>，我们开始解析并执行输入到命令行中的命令。</p><p id="01d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，打开终端，移动到项目目录并执行以下命令:</p><p id="4326" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">swift build -c release</code></p><p id="4bb9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将构建命令行工具，并在构建目录中创建一个可执行文件。我们可以从那里调用它，但是每次我们想要使用命令行工具时，使用这个路径是非常不方便的。因此，让我们首先将它移动到一个更容易访问的不同位置。为此，请执行以下命令:</p><p id="8507" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">cp -f .build/release/CLINotes /usr/local/bin/CLINotes</code></p><p id="f38f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这会将可执行文件放在二进制目录中，并使其可以从任何地方访问。</p><p id="3bf6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两个命令的输出应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/307a8b8dfeeb910cccd0d068f93cb2aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ePrh18eZF1tNoQtnz8UCg.png"/></div></div></figure><p id="a25a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仍然在终端中，通过输入以下命令来测试您的命令行工具:</p><p id="b06b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">clinotes</code></p><p id="0ac9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将看到以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/26d14e358d9a900632929613d410e9d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DPnXV8OtFb85AWIIU6u3vQ.png"/></div></div></figure><p id="d033" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以从<code class="fe mp mq mr ms b">CommandConfiguration</code>中了解到这里展示的许多内容:</p><ul class=""><li id="8518" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">OVERVIEW</code>显示了我们在<code class="fe mp mq mr ms b">abstract</code>中设置的内容。</li><li id="263b" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">它的下面是<code class="fe mp mq mr ms b">discussion</code>。</li><li id="bcb7" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">因为我们没有覆盖属性<code class="fe mp mq mr ms b">usage</code>，所以它在<code class="fe mp mq mr ms b">USAGE</code>中显示默认值。</li><li id="21d1" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">~显示了一个获得帮助的选项，因为我们没有更改<code class="fe mp mq mr ms b">helpNames</code>的默认值，它是<code class="fe mp mq mr ms b">-h</code>和<code class="fe mp mq mr ms b">--help</code>。</li><li id="edac" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">SUBCOMMANDS</code>列出了一个子命令，就是我们的<code class="fe mp mq mr ms b">Write</code>子命令。</li></ul><p id="5500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以执行<code class="fe mp mq mr ms b">write</code>子命令，这将产生以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/d5e9c81c2e1d2730d4657b266b97624e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kHDoIARzYLDkLbFXFzkEWA.png"/></div></div></figure><p id="5fb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还不能做太多。让我们在下一节中通过添加输入和实现一个<code class="fe mp mq mr ms b">run</code>方法来保存我们的笔记来改变这一点。</p><h1 id="0353" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">添加输入</h1><p id="ba52" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">是时候为我们的命令添加输入了。为此，我们将向命令添加属性，这些属性可以是参数、选项或标志。</p><p id="3399" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">参数是位置输入，这意味着它们在命令中有一个固定的位置，不能以任何其他顺序排列。</p><p id="5991" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选项被命名为输入。您需要在值之前键入他们的名称。这看起来有点像<code class="fe mp mq mr ms b">--file /path/to/file</code>。这要求您记住输入名称，并使命令更冗长，但更灵活，更容易理解。</p><p id="f07b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">标志是二进制输入。它们可以添加到命令中，也可以不添加。上面截图中的选项<code class="fe mp mq mr ms b">--help</code>就是一个例子。你可以看到它要么存在，要么不存在。</p><p id="c061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将命令行工具的输入视为一个名称和值的元组，您可以这样看待三种不同类型的输入:</p><ul class=""><li id="600c" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated">自变量:唯一值</li><li id="b956" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">选项:名称和值</li><li id="a7a9" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">标志:仅名称</li></ul><p id="a1ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要为选项和标志使用一个名称。有五个不同的选项来命名它们:</p><ul class=""><li id="4f49" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">short</code>:仅使用输入名称的第一个字符。例如，在<code class="fe mp mq mr ms b">helpNames</code>中使用此选项时，在<code class="fe mp mq mr ms b">CommandConfiguration</code>中，显示帮助的标志名称将是<code class="fe mp mq mr ms b">-h</code>。另一个很好的例子是用于启用详细输出的<code class="fe mp mq mr ms b">-v</code>。</li><li id="1af9" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">long</code>:这要求你使用一个属性的全名。求助，是<code class="fe mp mq mr ms b">--help</code>。它被转换成小写字母和连字符来分隔较长的名称。<br/>一个叫<code class="fe mp mq mr ms b">filePath</code>的楼盘，长名叫<code class="fe mp mq mr ms b">--file-path</code>。</li><li id="a89f" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">shortAndLong</code>:这是<code class="fe mp mq mr ms b">helpNames</code>的默认值，它允许你使用短格式和长格式，所以在这个例子中是<code class="fe mp mq mr ms b">-h</code>和<code class="fe mp mq mr ms b">--help</code>。</li><li id="ada1" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><code class="fe mp mq mr ms b">customShort</code>和<code class="fe mp mq mr ms b">customLong</code>:这两个选项允许你自定义输入的名称。</li></ul><p id="8258" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是时候给我们的<code class="fe mp mq mr ms b">Write</code>命令添加一些属性了。在其属性<code class="fe mp mq mr ms b">configuration</code>下添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4aec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 1</code> —首先，我们添加输入<code class="fe mp mq mr ms b">filePath</code>，这是保存注释的路径。我们用<code class="fe mp mq mr ms b">customLong</code>来定义它的名字为<code class="fe mp mq mr ms b">file</code>。短名称(<code class="fe mp mq mr ms b">-f</code>)会与我们将添加的最后一个输入冲突，因为<code class="fe mp mq mr ms b">force</code>也以f开头。因此，我们只使用长版本。默认的长名称是<code class="fe mp mq mr ms b">--file-path</code>，为了更方便的输入路径。我们提供自定义名称。</p><p id="39cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 2</code> —因为参数是位置输入，所以我们不需要定义名称选项。相反，我们只添加了<code class="fe mp mq mr ms b">help</code>来向用户解释如何使用这个输入。</p><p id="bebe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 3</code> —为了不意外覆盖现有文件，在写入已经存在的文件路径时，需要使用<code class="fe mp mq mr ms b">-f</code>或<code class="fe mp mq mr ms b">--force</code>。</p><p id="e8e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑一个好的子命令结构，并使用参数、选项和标志来创建一个可用的命令。</p><p id="e51f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构建并再次运行命令行工具。进入<code class="fe mp mq mr ms b">clinotes write --help</code>，你会看到这个输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/f020d8eaed13b653c1f418d9d7f02ee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*haKRPAdlmBSGzGc899iGcw.png"/></div></div></figure><p id="6f5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，即使提供了所有属性的值，也不会发生任何事情。我们仍然需要添加代码来实际保存文件。我们将在下一节中这样做。</p><h1 id="193d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">执行命令</h1><p id="3fdf" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们还不能用命令行工具做太多事情。要改变这一点，请将此方法添加到属性<code class="fe mp mq mr ms b">force</code>下的<code class="fe mp mq mr ms b">Write</code>结构中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2c95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">run</code>是解析命令后自动执行的。事情是这样的:</p><p id="bcab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 1</code> —我们想给我们的命令行工具创建的笔记添加一个通用的文件扩展名。因此，在向文件系统写入内容之前，我们需要将它附加到用户输入的文件路径中。</p><p id="088a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 2</code> —我们使用字符串上的<code class="fe mp mq mr ms b">write(toFile:automatically:encoding)</code>将注释写到给定的文件路径。我们现在使用<code class="fe mp mq mr ms b">try?</code>来消除任何错误。这将在下一节讨论如何处理错误时有所改变。</p><p id="6c50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构建可执行文件并运行命令。我们现在能够从终端为我们的笔记创建文件。但是我们不要就此打住。我们还需要关注另一个重要部分——验证和处理错误。</p><h1 id="14ab" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">验证输入</h1><p id="fd1b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">接下来，让我们探索如何验证输入。在定义命令行工具时，考虑验证是一个重要的部分。虽然你可以试着让你的程序听起来尽可能的好，但是可能会有一些方法输入无效的输入。</p><p id="f8f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Swift的类型系统已经处理了很多错误。尝试为int类型的选项输入一个字符，您会看到一个错误。但是对于其他无效输入，您需要自己进行验证。现在让我们来看看如何做到这一点。</p><p id="ffab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可能出现两种类型的错误:验证错误和运行时错误。验证错误在<code class="fe mp mq mr ms b">validate</code>中抛出，并阻止<code class="fe mp mq mr ms b">run</code>被执行。但是如果用户提供的所有输入都是有效的，那么在执行<code class="fe mp mq mr ms b">run</code>时，您可能仍然会遇到问题。这些是运行时错误。</p><p id="3594" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将此方法添加到<code class="fe mp mq mr ms b">run</code>方法上方的<code class="fe mp mq mr ms b">Write</code>结构中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="39bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 1</code> —实现方法<code class="fe mp mq mr ms b">validate</code>。当执行命令行工具来验证输入时，它将被自动调用。如果有任何事情不符合预期，您可以抛出一个错误。</p><p id="5a49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 2</code> —我们不希望我们的命令行工具的用户错误地覆盖一个文件。因此，在运行该命令之前，我们希望确保添加了标志<code class="fe mp mq mr ms b">--force</code>。如果路径中有文件，则应保存新的注释。</p><p id="9b57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 3</code> —如果用户试图覆盖一个现有的文件，我们抛出一个<code class="fe mp mq mr ms b">ValidationError</code>，其中包含一条向用户解释错误的消息。</p><p id="0578" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像前面一样构建命令行工具，并尝试覆盖现有的注释。您将看到与此类似的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/9a7b6a9c2630cb259d3c37951038f6c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o7dlhP3zBBzA3oDwsDRDVQ.png"/></div></div></figure><p id="072d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很方便，对吧？</p><p id="5ebb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，让我们看看运行时错误。首先添加这个新结构:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8b36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它代表运行时发生的错误。</p><p id="cce5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，用以下代码替换<code class="fe mp mq mr ms b">run</code>方法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="0e79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 1</code> —我们现在使用<code class="fe mp mq mr ms b">do</code>和<code class="fe mp mq mr ms b">catch</code>，而不是使用<code class="fe mp mq mr ms b">try?</code>在向文件写注释时消除错误。</p><p id="1783" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">// 2</code>—当出现任何问题，笔记无法保存时，我们抛出一个<code class="fe mp mq mr ms b">RuntimeError</code>，让用户知道操作失败。</p><p id="a079" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜，命令行工具完成了！🥳</p><h1 id="b193" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">调试命令行工具</h1><p id="7ff7" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">由于没有一个软件可以避免错误，我们需要一种方法来调试命令行工具，就像任何其他应用程序一样。由于我们在命令行中运行可执行文件，它不会在断点处中断，也不会在Xcode的控制台上打印任何内容。</p><p id="b58e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要一点技巧来做到这一点。首先，我们需要编辑方案。单击目标客户，并在下拉列表中选择编辑方案…。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/e4258a0dce799210c57b1313ecad9bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkEaPHU9Eapbn8ttevHEJg.png"/></div></div></figure><p id="6ecf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，切换到左侧菜单中的Run (1)并选择tab Arguments (2)。在启动时传递的参数中，添加以下命令:</p><p id="a7a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">write --file /Desktop/testnote "This is a test note."</code></p><p id="c499" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Xcode中运行命令行工具时，这会使用给定的参数执行write子命令。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/ffd77d796d01e5ca59c22fac07818cf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dsA4ZcTh9q-z4ECv1Ovk_w.png"/></div></div></figure><p id="f3dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在<code class="fe mp mq mr ms b">Write</code>结构中为<code class="fe mp mq mr ms b">validate</code>添加一个断点。</p><p id="81ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Xcode中构建并运行应用程序。它将执行您刚刚定义的命令，并在断点处停止。</p><p id="9940" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是调试命令行工具的方法。您可以在我的GitHub上找到完整的项目:</p><div class="mt mu gp gr mv mw"><a href="https://github.com/DavidPiper94/CLINotes" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">GitHub — DavidPiper94/CLINotes</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">这是一个展示如何使用苹果ArgumentParser框架的示例项目。通过…将您的笔记保存为文件</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk kp mw"/></div></div></a></div><h1 id="2151" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">作为iOS开发者如何受益？</h1><p id="bb1d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">虽然我们看了一个相当简单的小例子，但是您现在已经知道了构建更复杂的命令行工具的一切。</p><p id="1e0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有很多例子可以让你创建自己的工具来简化你的开发工作流程。例如，管理应用程序的资源，如图像和字符串。</p><p id="0199" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个很好的用例是创建一个命令行工具来控制和配置您的iOS应用程序。要了解更多有关如何通过终端在运行时与您的应用程序通信的信息，请查看我在2022年iOS全球开发者峰会上的演讲，我在演讲中展示了我们在Scalable Capital如何创建和使用命令行工具:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi nn l"/></div></figure><h1 id="1348" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">资源</h1><div class="mt mu gp gr mv mw"><a href="https://apple.github.io/swift-argument-parser/documentation/argumentparser" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">证明文件</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">编辑描述</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">apple.github.io</p></div></div></div></a></div><div class="mt mu gp gr mv mw"><a href="https://github.com/DavidPiper94/CLINotes" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">GitHub — DavidPiper94/CLINotes</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">这是一个展示如何使用苹果ArgumentParser框架的示例项目。通过…将您的笔记保存为文件</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk kp mw"/></div></div></a></div><p id="3a83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。敬请关注更多内容。</p></div></div>    
</body>
</html>