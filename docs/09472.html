<html>
<head>
<title>How To Get Data From Snowflake Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python从雪花中获取数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-get-data-from-snowflake-using-python-9f2c08b9ab28?source=collection_archive---------4-----------------------#2021-08-30">https://betterprogramming.pub/how-to-get-data-from-snowflake-using-python-9f2c08b9ab28?source=collection_archive---------4-----------------------#2021-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0c89" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个用Python连接雪花的例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eba87a14ee8e85f7418d096bddc775f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9TBqM25dGbJWroD1"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@aaronburden?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aaron Burden </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><div class="kz la gp gr lb lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq ks lc"/></div></div></a></div><p id="61d7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在之前的帖子中，我们提供了一个<a class="ae ky" href="https://predictivehacks.com/how-to-load-data-from-s3-to-snowflake/" rel="noopener ugc nofollow" target="_blank">如何从S3加载数据到雪花</a>的例子。数据科学家和数据工程师非常熟悉Python和Pandas数据框，因此能够将雪花与Python连接起来是必不可少的。在本教程中，我们将向您展示如何在您的本地环境中用Python从雪花中获取数据。</p><h1 id="8f72" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">雪花数据库和表</h1><p id="06b3" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">对于本教程，我们创建了一个名为<code class="fe nk nl nm nn b">GPIPIS_DB</code>的数据库，其中有一个名为<code class="fe nk nl nm nn b">MYIRISTABLE</code>的表</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/accc4513da03d765695dddc51dc59776.png" data-original-src="https://miro.medium.com/v2/resize:fit:402/format:webp/0*Ei1KLmMC4c0e5g6d.png"/></div></figure><h1 id="7717" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">安装Python库</h1><p id="06c4" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">我们需要安装以下Python库。</p><pre class="kj kk kl km gt np nn nq nr aw ns bi"><span id="f2fd" class="nt mo it nn b gy nu nv l nw nx">pip install snowflake-connector-python<br/>pip install --upgrade snowflake-sqlalchemy<br/>pip install "snowflake-connector-python[pandas]"</span></pre><p id="9dda" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">从雪花到Python有不同的数据获取方式。下面，我们提供一些例子，但是首先，让我们加载库。</p><pre class="kj kk kl km gt np nn nq nr aw ns bi"><span id="fe25" class="nt mo it nn b gy nu nv l nw nx">import snowflake.connector<br/>import pandas as pd<br/>from snowflake.sqlalchemy import URL<br/>from sqlalchemy import create_engine</span></pre><h1 id="0ce4" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">使用“sqlalchemy”以Pandas数据框的形式获取数据</h1><p id="9cd1" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">我们需要创建一个连接引擎，然后运行SQL查询。请注意，帐户id(帐户)，是你在网址上看到的到<code class="fe nk nl nm nn b">.snowflakecomputing.com</code></p><pre class="kj kk kl km gt np nn nq nr aw ns bi"><span id="1e4a" class="nt mo it nn b gy nu nv l nw nx">url = URL(<br/>    user='XXX',<br/>    password='XXX',<br/>    account='&lt;ACCOUNT_ID&gt;',<br/>    warehouse='TEST_WH',<br/>    database='GPIPIS_DB',<br/>    schema='PUBLIC',<br/>    role = 'ACCOUNTADMIN'<br/>)<br/>engine = create_engine(url)</span><span id="6cc8" class="nt mo it nn b gy ny nv l nw nx">connection = engine.connect()</span><span id="ddb7" class="nt mo it nn b gy ny nv l nw nx">query = '''<br/>select * from myiristable<br/>'''</span><span id="3674" class="nt mo it nn b gy ny nv l nw nx">df = pd.read_sql(query, connection)</span><span id="94a6" class="nt mo it nn b gy ny nv l nw nx">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/c8efa6109d5f68361c874dc923a8c1c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/0*kXTIc42MgNKm-9n6.png"/></div></figure><p id="24a5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如我们所看到的，我们设法将雪花表加载到本地环境中。</p><h1 id="a17c" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">使用snowflake.connector和fetch_pandas_all以Pandas数据框的形式获取数据</h1><p id="da47" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">假设您已经安装了<code class="fe nk nl nm nn b">snowflake-connector-python[pandas]</code>，您可以如下加载数据。</p><pre class="kj kk kl km gt np nn nq nr aw ns bi"><span id="b4dd" class="nt mo it nn b gy nu nv l nw nx">conn = snowflake.connector.connect(<br/>    user='XXX',<br/>    password='XXX',<br/>    account='&lt;ACCOUNT_ID&gt;',<br/>    warehouse='TEST_WH',<br/>    database='GPIPIS_DB',<br/>    schema='PUBLIC',<br/>    role = 'ACCOUNTADMIN'<br/>            )</span><span id="9148" class="nt mo it nn b gy ny nv l nw nx">cur = conn.cursor()</span><span id="3694" class="nt mo it nn b gy ny nv l nw nx">sql = "select * from myiristable"<br/>cur.execute(sql)</span><span id="875f" class="nt mo it nn b gy ny nv l nw nx">df = cur.fetch_pandas_all()</span><span id="07d9" class="nt mo it nn b gy ny nv l nw nx">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/d310f2d71e0c5f8e0d2ab84230b2e841.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/0*P8_lieb3pmwxL0YU.png"/></div></figure><h1 id="fef3" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">使用snowflake.connector和from_records以Pandas数据框的形式获取数据</h1><p id="6f81" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">或者，我们可以迭代<code class="fe nk nl nm nn b">cur</code>对象，如下所示:</p><pre class="kj kk kl km gt np nn nq nr aw ns bi"><span id="ad8e" class="nt mo it nn b gy nu nv l nw nx">conn = snowflake.connector.connect(<br/>    user='XXX',<br/>    password='XXX',<br/>    account='&lt;ACCOUNT_ID&gt;',<br/>    warehouse='TEST_WH',<br/>    database='GPIPIS_DB',<br/>    schema='PUBLIC',<br/>    role = 'ACCOUNTADMIN'<br/>            )</span><span id="7713" class="nt mo it nn b gy ny nv l nw nx">cur = conn.cursor()</span><span id="5ea3" class="nt mo it nn b gy ny nv l nw nx">sql = "select * from myiristable"<br/>cur.execute(sql)</span><span id="639b" class="nt mo it nn b gy ny nv l nw nx">df = pd.DataFrame.from_records(iter(cur), columns=[x[0] for x in cur.description])<br/>df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/12d74add1453c93e83be21af41be91c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/0*oD4odDC8hwHa0fgw.png"/></div></figure><h1 id="87ea" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">通过迭代光标获取数据</h1><p id="0e18" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">最后，我们可以通过如下方式迭代光标来获取数据:</p><pre class="kj kk kl km gt np nn nq nr aw ns bi"><span id="8779" class="nt mo it nn b gy nu nv l nw nx">conn = snowflake.connector.connect(<br/>    user='XXX',<br/>    password='XXX',<br/>    account='&lt;ACCOUNT_ID&gt;',<br/>    warehouse='TEST_WH',<br/>    database='GPIPIS_DB',<br/>    schema='PUBLIC',<br/>    role = 'ACCOUNTADMIN'<br/>            )</span><span id="1c7b" class="nt mo it nn b gy ny nv l nw nx">cur = conn.cursor()</span><span id="813d" class="nt mo it nn b gy ny nv l nw nx">sql = "select * from myiristable"<br/>cur.execute(sql)</span><span id="7152" class="nt mo it nn b gy ny nv l nw nx">for record in cur:<br/>    print(record)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/b8c7aa8060104fe13427b9ff36de5e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/0*TDeezsl03Y7A-NBB.png"/></div></figure><p id="8fb3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以获得每列的数据，如下所示:</p><pre class="kj kk kl km gt np nn nq nr aw ns bi"><span id="e87a" class="nt mo it nn b gy nu nv l nw nx">cur.execute(sql)</span><span id="0516" class="nt mo it nn b gy ny nv l nw nx">for i,j,k,l,m in cur:<br/>    print(i,j,k,l,m)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/c94fe0b30152a050a223e8f84487db0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/0*kPeV33DAiucOJ_6V.png"/></div></figure></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="6ca2" class="mn mo it bd mp mq ol ms mt mu om mw mx jz on ka mz kc oo kd nb kf op kg nd ne bi translated">关闭连接</h1><p id="84b0" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">完成后，我们可以关闭连接:</p><pre class="kj kk kl km gt np nn nq nr aw ns bi"><span id="9e98" class="nt mo it nn b gy nu nv l nw nx">conn.close()<br/>connection.close()<br/>cur.close()</span></pre></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="48a2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这篇文章最初由<a class="ae ky" href="https://predictivehacks.com/how-to-get-data-from-snowflake-using-python/" rel="noopener ugc nofollow" target="_blank">预测黑客</a>发布</p></div></div>    
</body>
</html>