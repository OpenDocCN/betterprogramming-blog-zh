<html>
<head>
<title>Coding an Abstraction for React Internationalization Messages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为React国际化消息编写抽象代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-an-abstraction-for-react-internationalization-messages-7054d07af9b7?source=collection_archive---------25-----------------------#2020-01-03">https://betterprogramming.pub/building-an-abstraction-for-react-internationalization-messages-7054d07af9b7?source=collection_archive---------25-----------------------#2020-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d8f6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的应用全球化变得更加简单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/74f39465d25ca5a05cbb10f8cc994d34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tvoN6COgFG9qKqNR"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@kylejglenn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯尔·格伦</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="50a8" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这篇文章最初发表在我的博客上:<a class="ae ky" href="http://leandrotk.github.io/tk/2020/01/building-an-abstraction-for-react-internationalization-messages/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="li iu">构建React国际化消息的抽象</strong> </a>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="727e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我遇到了一个我想要构建的特性，它的一部分包括基于来自API的数据类型呈现国际化文本。这个API可以返回三种类型:<code class="fe mc md me mf b">common</code>、<code class="fe mc md me mf b">password</code>或<code class="fe mc md me mf b">biometry</code>。我们用它来构建我们的<code class="fe mc md me mf b">EntryInfo</code>组件。</p><p id="7c95" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于<code class="fe mc md me mf b">common</code>类型，API响应如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="1907" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">类型为<code class="fe mc md me mf b">common</code>，<code class="fe mc md me mf b">password</code>为<code class="fe mc md me mf b">null</code>，<code class="fe mc md me mf b">ownerName</code>以字符串的形式出现。</p><p id="1c3a" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于<code class="fe mc md me mf b">password</code>型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="09b8" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">类型是<code class="fe mc md me mf b">password</code>，类型<code class="fe mc md me mf b">ownerName</code>是<code class="fe mc md me mf b">null</code>，但是<code class="fe mc md me mf b">password</code>是以字符串的形式出现的。</p><p id="2035" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于<code class="fe mc md me mf b">biometry</code>型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="e625" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">类型为<code class="fe mc md me mf b">biometry</code>，没有<code class="fe mc md me mf b">ownerName</code>和<code class="fe mc md me mf b">password</code>。</p><p id="9884" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这是我们从API收到的三种可能的有效载荷。我需要根据这些数据呈现一个国际化的文本。</p><p id="62ac" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">基于类型和其他值构建消息文本的逻辑是:</p><ul class=""><li id="67b5" class="mi mj it li b lj lk lm ln lp mk lt ml lx mm mb mn mo mp mq bi translated">当<code class="fe mc md me mf b">type</code>为<code class="fe mc md me mf b">'Common'</code>时，渲染<code class="fe mc md me mf b">'Owner {ownerName} will be there'</code>。</li><li id="adef" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated">当<code class="fe mc md me mf b">type</code>为<code class="fe mc md me mf b">'Password'</code>时，渲染<code class="fe mc md me mf b">'Password: {password}'</code>。</li><li id="7f28" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated">当<code class="fe mc md me mf b">type</code>为<code class="fe mc md me mf b">'Biometry'</code>时，渲染<code class="fe mc md me mf b">'Type: biometry'</code>。</li><li id="a3f1" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated">当<code class="fe mc md me mf b">type</code>为<code class="fe mc md me mf b">null</code>时，渲染<code class="fe mc md me mf b">'Call the owner'</code>。</li></ul><p id="d2bd" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">所以，我做的第一件事是建立消息定义:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="4f52" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mc md me mf b">EntryInfo</code>组件类似于:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="8d58" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为了遵循定义的逻辑，我只是添加了一个<code class="fe mc md me mf b">if-elseif-else</code>来使用<code class="fe mc md me mf b">intl.format</code>函数呈现适当的消息。很简单，<code class="fe mc md me mf b">intl.format</code>函数接收适当的消息，返回条目信息文本，并将其传递给组件进行呈现。</p><p id="7c81" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">但是我可以在一个助手函数<code class="fe mc md me mf b">getEntryInfo</code>中将它分离出来，将逻辑从UI组件中分离出来。我也可以将它导出到单元测试中，而不会太复杂。</p><p id="0598" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我还将<code class="fe mc md me mf b">intl</code>对象传递给这个新函数，以返回正确的字符串。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="4570" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这个逻辑可能只是一个对象映射器，而不是if-else或switch-case语句。所以在<code class="fe mc md me mf b">getEntryInfo</code>中只是一个小的重构:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="7f11" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">该类型是硬编码的，因此我们也可以使用枚举来重构这些常量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="faa3" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在我们可以走了。</p><p id="d6b9" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">考虑到<code class="fe mc md me mf b">cohesion</code>，我认为<code class="fe mc md me mf b">getEntryInfo</code>函数确实对组件如何呈现文本消息知道得太多了(通过使用<code class="fe mc md me mf b">intl</code>)。</p><p id="5237" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">一个想法是考虑每个功能的单一责任。</p><p id="1832" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">因此，对于<code class="fe mc md me mf b">getEntryInfo</code>函数，我们可以移除作为依赖项的<code class="fe mc md me mf b">intl</code>参数，并构建消息对象，而不是返回一个字符串。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="7bde" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">并在组件中这样使用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="4f92" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">作为组件重构，我们可以析构消息对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="b5cd" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">它可读性更强，不那么冗长。</p><p id="2f96" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于消息对象，我们可以构建一个简单的函数来处理消息对象的创建:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="e7aa" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">看一下<code class="fe mc md me mf b">values = {}</code>的论证。我们添加这个空对象作为默认值，在<code class="fe mc md me mf b">biometry</code>和<code class="fe mc md me mf b">default</code>情况下不需要传递任何东西。</p><p id="7260" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">没有了<code class="fe mc md me mf b">intl</code>依赖，使用和测试函数就更容易了。它只依赖于数据，不再依赖于依赖关系。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="ae40" class="mw mx it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">最后一部分</h1><p id="45f6" class="pw-post-body-paragraph lg lh it li b lj no ju ll lm np jx lo lp nq lr ls lt nr lv lw lx ns lz ma mb im bi translated">包含所有分离逻辑的完整组件更具内聚性。每个部分都有自己的职责，这有助于减少耦合。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8c25" class="mw mx it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">资源</h1><ul class=""><li id="fe51" class="mi mj it li b lj no lm np lp nt lt nu lx nv mb mn mo mp mq bi translated"><a class="ae ky" href="https://BeginnerJavaScript.com/friend/LEANDRO" rel="noopener ugc nofollow" target="_blank">初学JavaScript </a></li><li id="70f0" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated"><a class="ae ky" href="https://ES6.io/friend/LEANDRO" rel="noopener ugc nofollow" target="_blank">学习ES6 — JavaScript </a></li><li id="d071" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated"><a class="ae ky" href="https://BeginnerJavaScript.com/friend/LEANDRO" rel="noopener ugc nofollow" target="_blank">初学者的反应</a></li><li id="eb84" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated"><a class="ae ky" href="https://AdvancedReact.com/friend/LEANDRO" rel="noopener ugc nofollow" target="_blank">全栈高级反应</a></li><li id="88ce" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated"><a class="ae ky" href="https://www.educative.io/courses/the-road-to-learn-react?aff=x8bV" rel="noopener ugc nofollow" target="_blank">学习之路有什么反应</a></li><li id="bb5f" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated"><a class="ae ky" href="https://www.educative.io/courses/javascript-fundamentals-before-learning-react?aff=x8bV" rel="noopener ugc nofollow" target="_blank">学习反应前的JavaScript基础知识</a></li><li id="b16e" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated"><a class="ae ky" href="https://www.educative.io/courses/reintroducing-react-v16-beyond?aff=x8bV" rel="noopener ugc nofollow" target="_blank">重新推出React: V16及更高版本</a></li><li id="d0f6" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated"><a class="ae ky" href="https://www.educative.io/courses/advanced-react-patterns-with-hooks?aff=x8bV" rel="noopener ugc nofollow" target="_blank">带挂钩的高级反应模式</a></li><li id="020e" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated"><a class="ae ky" href="https://www.educative.io/courses/react-in-patterns?aff=x8bV" rel="noopener ugc nofollow" target="_blank">反应模式</a></li><li id="752f" class="mi mj it li b lj mr lm ms lp mt lt mu lx mv mb mn mo mp mq bi translated"><a class="ae ky" href="https://stackoverflow.com/a/3085419/3159162" rel="noopener ugc nofollow" target="_blank">高内聚低耦合</a></li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><blockquote class="nw"><p id="d4e2" class="nx ny it bd nz oa ob oc od oe of mb dk translated">我希望你喜欢这个内容。<a class="ae ky" href="https://ko-fi.com/teekay" rel="noopener ugc nofollow" target="_blank">支持我在高保真方面的工作</a></p></blockquote><p id="f3e6" class="pw-post-body-paragraph lg lh it li b lj og ju ll lm oh jx lo lp oi lr ls lt oj lv lw lx ok lz ma mb im bi translated">我的<a class="ae ky" href="https://twitter.com/LeandroTk_" rel="noopener ugc nofollow" target="_blank">Twitter</a>&amp;<a class="ae ky" href="https://github.com/LeandroTk" rel="noopener ugc nofollow" target="_blank">Github</a>。☺</p></div></div>    
</body>
</html>