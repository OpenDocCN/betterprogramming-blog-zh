<html>
<head>
<title>3 Misuses of Python List Comprehension to Avoid</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">要避免的Python列表理解的3种误用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/3-misuses-of-python-list-comprehension-to-avoid-54adc312e48c?source=collection_archive---------4-----------------------#2020-06-19">https://betterprogramming.pub/3-misuses-of-python-list-comprehension-to-avoid-54adc312e48c?source=collection_archive---------4-----------------------#2020-06-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dd91" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">仅将其用作创建列表的一种简洁易读的方式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d986af14aa8579e3a36ef2ab91123beb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z8eHmEEqmj9GmyDg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Eric Prouzet 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0c77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">列表是Python中最常用的数据类型之一。</p><p id="aee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一种可变容器数据类型，我们使用列表来保存同类(即相同类型的元素)和异类(即不同类型的元素)数据，包括整数、字符串和自定义对象。这使得列表成为几乎所有项目的灵活数据工具。</p><p id="a353" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当谈到用Python创建一个<code class="fe lv lw lx ly b">list</code>对象时，有几种方便的方法。以下代码显示了创建列表的两个基本选项:</p><ul class=""><li id="22d8" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">列表文字(使用一对方括号将元素括起来)</li><li id="de9a" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">默认构造函数(使用内置的<code class="fe lv lw lx ly b">list()</code>函数)。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">基本列表创建方法</p></figure><p id="189c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在学习了基本的列表创建方法之后，您可能已经学习了创建列表对象的更简洁的方法——列表理解。它的基本语法是:<code class="fe lv lw lx ly b">[expression for item in iterable if condition_eval]</code>。条件部分是可选的——它只是提供了一种过滤某些元素的机制。让我们在下面的代码片段中看看它的用法，后一个代码片段包括一个条件求值:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">列表理解语法</p></figure><p id="a307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所示，列表理解技术为我们创建<code class="fe lv lw lx ly b">list</code>对象提供了非常易读的语法。本质上，创建<code class="fe lv lw lx ly b">odds_squares</code>列表的代码可以使用常规的<code class="fe lv lw lx ly b">for</code>循环来扩展。显然，使用<code class="fe lv lw lx ly b">for</code>循环不如理解列表简洁和直接。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用For循环创建列表</p></figure><p id="4cf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，一旦一些Python学习者熟悉了列表理解，他们就开始尽可能地使用它，这可能导致误用。在这篇文章中，我想回顾三个误用案例和它们相应的最佳实践，希望给你一个更好的使用列表理解的正确方法的想法。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="56e6" class="mw mx it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">1.不使用list()构造函数</h1><p id="3396" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">我们都知道使用list comprehension将从iterable生成一个<code class="fe lv lw lx ly b">list</code>对象。在Python中，许多内置数据类型都是可迭代的，包括字符串。让我们看一个使用<code class="fe lv lw lx ly b">str</code>对象创建列表的例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用字符串列表理解</p></figure><p id="5428" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们想从字符串变量<code class="fe lv lw lx ly b">name</code>中创建一个小写字母列表。事实上，列表理解创建了所需的列表。但是，请考虑以下替代方案。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用列表构造函数理解列表</p></figure><p id="201c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相比于<code class="fe lv lw lx ly b">list</code>理解选项，使用默认构造函数<code class="fe lv lw lx ly b">list()</code>不是更简洁吗？让我们考虑另一个涉及使用内置<code class="fe lv lw lx ly b">range()</code>函数的简单例子，它产生了<code class="fe lv lw lx ly b">range</code>对象Python中另一个常用的iterable:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用列表构造函数理解列表(范围)</p></figure><p id="77ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似于我们之前所做的，我们仍然可以使用<code class="fe lv lw lx ly b">list()</code>构造函数直接从<code class="fe lv lw lx ly b">range</code>对象创建<code class="fe lv lw lx ly b">list</code>对象。下面是第一次误用的最佳实践——忽略使用默认的<code class="fe lv lw lx ly b">list</code>构造函数。</p><p id="82c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="nt">最佳实践# 1: </em> </strong> <em class="nt">如果你从一个iterable创建一个列表，优先使用内置的列表构造函数。</em></p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="3a28" class="mw mx it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">2.冗长的理解</h1><p id="4c75" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">列表理解以其创建<code class="fe lv lw lx ly b">list</code>对象的简洁性而闻名。然而，如果表达式变得太长，我们应该考虑一些可读性更好的替代方法，比如传统的<code class="fe lv lw lx ly b">for</code>循环。假设我们为一些衬衫创建标签，作为不同颜色、尺寸和样式选项的组合。下面是<code class="fe lv lw lx ly b">list</code>的理解方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用嵌套结构列表理解</p></figure><p id="81d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的<code class="fe lv lw lx ly b">list</code>理解涉及到嵌套循环，可能不是最容易读懂的，特别是对于刚接触<code class="fe lv lw lx ly b"><em class="nt">list</em></code> <em class="nt"> </em>理解的人，可能理解嵌套结构有问题。</p><p id="e27e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，根据您的目标受众，我们可能会选择替代方案。例如，我们可以通过分解来重新组织同一个<code class="fe lv lw lx ly b">list</code>理解，如下所示。这是相同的表达式，但是使用了更好的格式来突出嵌套的<code class="fe lv lw lx ly b">for</code>循环。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有嵌套结构的列表理解(格式化)</p></figure><p id="0682" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，下面是一个使用多个<code class="fe lv lw lx ly b">for</code>循环的扩展表单，如果我们想向一些几乎没有编程或Python知识的人展示。有了更明确的<code class="fe lv lw lx ly b">for</code>循环，我们的代码可能更具可读性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用嵌套For循环创建列表</p></figure><p id="e1e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，如果您是在一个更高级的Python开发团队中编写代码，那么您应该通过利用<code class="fe lv lw lx ly b">itertools</code>模块中的<code class="fe lv lw lx ly b">product()</code>函数来考虑以下选项。语法变得更加清晰，如下所示。当然，这仍然是一种<code class="fe lv lw lx ly b">list</code>理解，但是因为使用了方便的内置迭代工具，所以更加简洁。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用迭代工具进行列表理解</p></figure><p id="2e4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="nt">最佳实践2。</em> </strong> <em class="nt">考虑适用的替代方案以最小化嵌套</em> <code class="fe lv lw lx ly b"><em class="nt">for</em></code> <em class="nt">循环的复杂性。</em></p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="7dcb" class="mw mx it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">3.不必要的中介</h1><p id="b4d0" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">列表理解的全部目的是创建一个新的<code class="fe lv lw lx ly b">list</code>对象，由于列表的内存开销，这不是一个自由的操作。因此，如果你不打算对你正在创建的<code class="fe lv lw lx ly b">list</code>对象做任何事情，列表理解肯定不是一个必要的步骤。我们可以几乎100%肯定地说，您的工作可以在没有创建列表的情况下完成。</p><p id="e645" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们考虑下面这个简单的例子。假设我们有两个列表，一个存储所有学生的名字，另一个存储他们相应的姓氏。我们想把他们的名字一个一个打印出来。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">列表理解以创建迭代列表</p></figure><p id="c07e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们创建了一个名为<code class="fe lv lw lx ly b">names</code>的<code class="fe lv lw lx ly b">list</code>对象，并对其进行迭代。然而，从内置的<code class="fe lv lw lx ly b">zip()</code>函数创建的<code class="fe lv lw lx ly b">zip</code>对象本身是一个可迭代的对象，所以我们可以在<code class="fe lv lw lx ly b">for</code>循环中直接使用<code class="fe lv lw lx ly b">zip</code>对象。以下是一个没有<code class="fe lv lw lx ly b">list</code>对象作为中间步骤的更好的解决方案。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">迭代中的Zip对象</p></figure><p id="dff4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一类别中另一个常见的误用是没有使用一个密切相关的技术来列举理解——生成器表达。如果对发电机不太了解，可以参考我之前的<a class="ae ky" href="https://medium.com/swlh/generators-in-python-5-things-to-know-c76a1f60427a" rel="noopener">文章</a>上的题目。本质上，生成器是一个iterable，只有在被请求时才会一次呈现一个值。因此它更加内存友好，避免了存储一个<code class="fe lv lw lx ly b">list</code>对象所需的所有元素。</p><p id="e07c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就语法而言，生成器表达式具有以下形式:<code class="fe lv lw lx ly b">(expression for item in iterable if condition_eval)</code>。正如您所看到的，它的语法与list comprehension非常相似，只是使用了圆括号而不是方括号。请注意这种差异的重要性，因为一个是创建一个<code class="fe lv lw lx ly b">list</code>而另一个是创建一个生成器。</p><p id="ebb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个经典的操作，用于对比列表和生成器之间的差异——计算大量数字的总和，如下所示。如果范围变得很大，发生器仍然可以工作，但列表可能会使您的电脑内存不足。为什么？因为当我们使用list comprehension或任何其他创建方法创建一个<code class="fe lv lw lx ly b">list</code>对象时，我们必须将列表的所有元素存储在内存中，这与生成器相反，生成器一次呈现一个值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">列表理解与生成器表达式</p></figure><p id="34e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="nt">最佳实践# 3 </em> </strong> <em class="nt">:如果你不打算直接操作列表，首先不要使用列表理解来创建列表。</em></p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="2cc0" class="mw mx it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">结论</h1><p id="f217" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">在本文中，我们回顾了一些新的Python程序员在理解列表时可能犯的三个错误。主要的使用原则很简单——<strong class="lb iu">我们只在需要创建和使用结果</strong> <code class="fe lv lw lx ly b"><strong class="lb iu">list</strong></code> <strong class="lb iu">对象</strong>时使用列表理解。然而，我们不应该忘记使用一些内置选项的可能性，比如<code class="fe lv lw lx ly b">list()</code>构造函数和其他可迭代函数(比如<code class="fe lv lw lx ly b">zip</code>对象和<code class="fe lv lw lx ly b">generator</code>)。</p><p id="09a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读这篇文章。以下是几篇其他相关文章:</p><div class="nu nv gp gr nw nx"><a href="https://medium.com/better-programming/9-things-to-know-to-master-list-comprehensions-in-python-8bc0411ec2ed" rel="noopener follow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd iu gy z fp oc fr fs od fu fw is bi translated">掌握Python中列表理解的9件事</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">本教程将帮助你学习Python中列表理解的最常见用法</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">medium.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol ks nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a href="https://towardsdatascience.com/list-comprehension-and-beyond-understand-4-key-related-techniques-in-python-3bff0f0a3ccb" rel="noopener follow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd iu gy z fp oc fr fs od fu fw is bi translated">列表理解和超越——理解Python中的4个关键相关技术</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">它们比你想象的要简单</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">towardsdatascience.com</p></div></div><div class="og l"><div class="om l oi oj ok og ol ks nx"/></div></div></a></div></div></div>    
</body>
</html>