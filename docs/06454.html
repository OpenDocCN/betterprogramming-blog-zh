<html>
<head>
<title>The Roles of Service Mesh and API Gateways in Microservice Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">服务网格和API网关在微服务架构中的作用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-roles-of-service-mesh-and-api-gateways-in-microservice-architecture-f6e7dfd61043?source=collection_archive---------0-----------------------#2020-10-03">https://betterprogramming.pub/the-roles-of-service-mesh-and-api-gateways-in-microservice-architecture-f6e7dfd61043?source=collection_archive---------0-----------------------#2020-10-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9885" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及如何充分利用这两者</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e371aa08e6bb2064b6f8c4f519818805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YtyanRngVWxs3LeQLC77pg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="d738" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您对微服务感兴趣，那么您可能会多次听说这两个术语。人们经常混淆这两者。在本文中，我将详细讨论<em class="lu">服务网格</em>和<em class="lu"> API网关</em>，并讨论何时使用什么。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3d9b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">网络层刷新程序</h1><p id="a6d1" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在深入研究服务网格和API网关之前，让我们回顾一下网络层。以下是OSI网络层模型:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/9275f7f0a4b6131a00df4a49304c90a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-IqORaN_vX1WvpQfbw9Dg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="5b3b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">复习的原因是我们将在接下来的章节中讨论其中的一些层。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d12c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">服务网格</h1><p id="7108" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">一个<em class="lu">服务网格</em>是一种在分布式软件系统中管理服务到服务通信的技术。服务网格管理东西类型的网络通信。<a class="ae na" href="https://en.wikipedia.org/wiki/East-west_traffic" rel="noopener ugc nofollow" target="_blank"> <em class="lu">东西向流量</em> </a>表示数据中心、Kubernetes集群或分布式系统内部的流量。</p><p id="119c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">服务网格由两个重要组件组成:</p><ul class=""><li id="c44e" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">制导机</li><li id="c999" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">数据平面</li></ul><p id="1918" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">驻留在应用旁边的代理被称为<em class="lu">数据平面</em>，而协调代理行为的管理组件被称为<em class="lu">控制平面。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/aa833ae35e2f1ec51301417d891c7977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jP4N2fKtXRf88pgF-ItDNA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">服务网-图片来源:作者</p></figure><p id="6698" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">服务网格允许您将应用程序的业务逻辑从网络、可靠性、安全性和可观察性中分离出来。</p><h2 id="bcdb" class="nq md it bd me nr ns dn mi nt nu dp mm lh nv nw mo ll nx ny mq lp nz oa ms ob bi translated">网络和流量管理</h2><p id="f795" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">服务网格允许您执行动态服务发现。sidecar代理可以帮助您进行负载平衡和速率限制。它可以帮助您进行流量分割，以执行A/B类型的测试，这对于canary版本很有帮助。</p><h2 id="9c30" class="nq md it bd me nr ns dn mi nt nu dp mm lh nv nw mo ll nx ny mq lp nz oa ms ob bi translated">可观察性和可靠性</h2><p id="12d8" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">服务网格支持分布式跟踪，这有助于您进行高级监控(请求数量、成功率和响应延迟)和调试。它甚至能够利用服务对服务的通信来更好地理解通信。</p><p id="44d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为服务网格提供健康检查、重试、超时和电路中断，所以它提高了应用程序的基线可靠性。</p><h2 id="a5b2" class="nq md it bd me nr ns dn mi nt nu dp mm lh nv nw mo ll nx ny mq lp nz oa ms ob bi translated">安全性</h2><p id="5b53" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">服务网格允许服务之间的相互TLS，这有助于提高服务到服务通信的安全性。您还可以实现访问控制列表(ACL)作为安全策略。</p><p id="25e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一个真正的服务网格/边车代理支持广泛的服务并实现L4/L7流量策略。</p><p id="3bf2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">市场上有许多可用的服务网格。以下是其中的一些:</p><ul class=""><li id="127f" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated"><a class="ae na" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a></li><li id="812f" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><a class="ae na" href="https://linkerd.io/" rel="noopener ugc nofollow" target="_blank"> Linkerd </a></li><li id="2ae2" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><a class="ae na" href="https://kuma.io/" rel="noopener ugc nofollow" target="_blank">库马</a></li><li id="4cf3" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><a class="ae na" href="https://www.consul.io/" rel="noopener ugc nofollow" target="_blank">领事</a></li></ul><p id="cb51" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在互联网上找到许多文章，比较上面列出的服务网格。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5ce8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">API网关</h1><p id="2b91" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">API网关充当集群、数据中心或一组分布式服务的单一入口点。在网络拓扑中，它通常被称为<a class="ae na" href="https://en.wikipedia.org/wiki/North-south_traffic" rel="noopener ugc nofollow" target="_blank"> <em class="lu">南北交通</em> </a> <em class="lu">。</em>通常，移动客户端属于这种类型的网络流量。</p><p id="a38c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">人们也很有可能最终使用API网关在部署在同一个数据中心的两个产品之间进行通信。在这种情况下，流量类型可以是东西向。</p><p id="c3b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">API网关接收来自客户端的调用，并将这些调用路由到适当的服务。在这样做的同时，它还可以翻译协议。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/0f6fe38d6fb6e0173e41dc4f94e196ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A2HeIEOzk7xYCAYmRncYZg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="7fad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用API网关有很多好处:</p><ul class=""><li id="5932" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated"><strong class="la iu">抽象:</strong>API网关可以抽象底层微服务的复杂性，并为客户端创建统一的体验</li><li id="d0e5" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu">认证:</strong>API网关可以负责认证，并将令牌信息传递给服务</li><li id="99e0" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu">流量控制:</strong>API网关可以限制入站和出站API流量</li><li id="3c43" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu"> API监控/货币化:</strong>如果您计划将API货币化，API网关可以通过提供监控客户端API请求/响应的功能来帮助您实现这一点</li><li id="b4b7" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu">转换:</strong>API网关可以帮助翻译/转换API请求/响应。它还可以帮助协议翻译。</li></ul><p id="619f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">API网关通常只关注L7策略。</p><h2 id="4be9" class="nq md it bd me nr ns dn mi nt nu dp mm lh nv nw mo ll nx ny mq lp nz oa ms ob bi translated">API网关的类型</h2><p id="ad0a" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">从部署的角度来看，API网关有两种使用方式:</p><ul class=""><li id="6e04" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">内部API网关:充当一组服务或产品范围的网关</li><li id="5393" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu"> Edge API网关:</strong>充当外部组织的消费者或移动客户端的网关</li></ul><p id="88aa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">市场上有许多可用的API网关。以下是其中的一些:</p><ul class=""><li id="a50b" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated"><a class="ae na" href="https://cloud.google.com/apigee" rel="noopener ugc nofollow" target="_blank">顶点</a></li><li id="d348" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><a class="ae na" href="https://konghq.com/kong/" rel="noopener ugc nofollow" target="_blank">孔关口</a></li><li id="10cd" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><a class="ae na" href="https://www.nginx.com/solutions/api-management-gateway/" rel="noopener ugc nofollow" target="_blank"> NGINX的API网关</a></li><li id="74b1" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><a class="ae na" href="https://www.softwareag.com/en_corporate/platform/integration-apis/api-management.html" rel="noopener ugc nofollow" target="_blank">软件公司的API网关</a></li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f76d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么时候用什么</h1><p id="8b84" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">既然你知道什么是服务网格和API网关，让我们试着理解什么时候使用什么。</p><h2 id="f87d" class="nq md it bd me nr ns dn mi nt nu dp mm lh nv nw mo ll nx ny mq lp nz oa ms ob bi translated">何时使用服务网格</h2><ul class=""><li id="c2df" class="nb nc it la b lb mu le mv lh od ll oe lp of lt ng nh ni nj bi translated">当您需要在同一产品范围内实现具有安全性和监控的L4/L7服务通信时</li><li id="4041" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">当您可以为每个服务实例及其副本部署sidecar代理时</li><li id="5527" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">当服务可以共享同一个CA证书以建立安全通信时(这可能无法跨各种产品实现)</li></ul><h2 id="4449" class="nq md it bd me nr ns dn mi nt nu dp mm lh nv nw mo ll nx ny mq lp nz oa ms ob bi translated">何时使用API网关</h2><ul class=""><li id="f17d" class="nb nc it la b lb mu le mv lh od ll oe lp of lt ng nh ni nj bi translated">当您需要跨各种产品实现具有安全性和监控的L7服务通信时</li><li id="ae36" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">当你想把API作为一个产品公开，无论有没有货币化</li><li id="7ea2" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">当您想为开发人员提供API全生命周期管理时</li><li id="3976" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">当您需要翻译服务通信协议时</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="aa97" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">服务网格和API网关一起</h1><p id="2efb" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">服务网格和API网关很有可能共存。下图展示了共存的服务网格和API网关场景:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/27397827ecfd2bf991f55f86cc50357c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ROUp0-7rYZQXWq42l3Yuhg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">服务网格和API网关—图片来源:作者</p></figure><p id="7de0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上图展示了对于一个产品范围，您可以实现一个服务网格(东西向流量)。当需要跨产品通信时，可以使用内部API网关(东西向流量)。当边缘的客户端需要与服务通信时，可以使用边缘API网关(南北流量)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt oh oi oj ok aw ol bi"><span id="23da" class="nq md it oi b gy om on l oo op">Hey, if you enjoyed this story, check out <a class="ae na" href="https://deshpandetanmay.medium.com/membership" rel="noopener">Medium Membership</a>! Just $5/month!</span><span id="f0ce" class="nq md it oi b gy oq on l oo op"><em class="lu">Your membership fee directly supports me and other writers you read. You’ll also get full access to every story on Medium.</em></span></pre></div></div>    
</body>
</html>