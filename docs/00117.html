<html>
<head>
<title>How to Perform SOAP Requests With Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js执行SOAP请求</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-perform-soap-requests-with-node-js-4a9627070eb6?source=collection_archive---------0-----------------------#2018-04-01">https://betterprogramming.pub/how-to-perform-soap-requests-with-node-js-4a9627070eb6?source=collection_archive---------0-----------------------#2018-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2730" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">当你不能休息的时候</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/055dbcd15e3086088a75d09002a816eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXM11-PNKG8x_DcMWAKvqQ.png"/></div></div></figure><h1 id="9edb" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">什么是肥皂？</h1><p id="d3e2" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">SOAP代表简单对象访问协议。基本上是休息前唯一存在的东西。这是一个基于XML的API……在进一步深入之前，要知道REST要好得多。</p><p id="5082" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">SOAP服务器由一种叫做WSDL (Web服务描述语言)的东西组成，它包含一个XML模式来定义什么动作可以发送到服务器。想想REST API文档。</p><div class="mn mo gp gr mp mq"><a href="https://en.wikipedia.org/wiki/SOAP" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">SOAP -维基百科</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">SOAP(最初的简单对象访问协议)是一个消息协议规范，用于交换结构化…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">en.wikipedia.org</p></div></div></div></a></div></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="340e" class="ku kv it bd kw kx ng kz la lb nh ld le jz ni ka lg kc nj kd li kf nk kg lk ll bi translated">如何使用SOAP服务？</h1><p id="cd2d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在花了大约一两个小时在网上寻找仍然有效的SOAP服务后，我终于找到了一个。幸运的是，NOAA仍然有一些使用SOAP的功能性遗留技术。</p><p id="9437" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要使用SOAP API，您需要发送一个POST请求，其中包含一些内容:</p><ul class=""><li id="c29d" class="nl nm it lo b lp mi ls mj lv nn lz no md np mh nq nr ns nt bi translated">右侧标题(通常为两个)</li><li id="2614" class="nl nm it lo b lp nu ls nv lv nw lz nx md ny mh nq nr ns nt bi translated">肥皂信封</li></ul><h2 id="3947" class="nz kv it bd kw oa ob dn la oc od dp le lv oe of lg lz og oh li md oi oj lk ok bi translated">头球</h2><p id="3166" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">对于几乎所有的SOAP请求，您需要以XML格式发送数据:</p><pre class="kj kk kl km gt ol om on oo aw op bi"><span id="7d76" class="nz kv it om b gy oq or l os ot">Content-Type: text/xml;charset=UTF-8</span></pre><p id="ec6b" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">您需要发送的另一个报头是<code class="fe ou ov ow om b">soapAction</code>。现在，不是所有的服务都需要一个<code class="fe ou ov ow om b">soapAction</code>(如果WSDL说<code class="fe ou ov ow om b">soapAction=""</code>)，但是如果SOAP服务提供了多个功能，你通常需要发送它。找到<code class="fe ou ov ow om b">soapAction</code>的方法是“ctrl+f”WSDL或者依赖于API文档(如果有的话),在我看来这很难找到，因为SOAP已经过时了。这是美国国家海洋和大气管理局提供的我将要测试的WSDL。</p><p id="e225" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这里有一个例子<code class="fe ou ov ow om b">soapAction</code>为上述WSDL:</p><pre class="kj kk kl km gt ol om on oo aw op bi"><span id="5679" class="nz kv it om b gy oq or l os ot">soapAction:'https://graphical.weather.gov/xml/DWMLgen/wsdl/ndfdXML.wsdl#LatLonListZipCode'</span></pre><p id="3f1a" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">总之，我们至少需要这两个头，但是您可能还想添加第三个头，以便对一些需要用户代理的外部web服务友好。例如:</p><pre class="kj kk kl km gt ol om on oo aw op bi"><span id="8bb4" class="nz kv it om b gy oq or l os ot">user-agent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.151 Safari/535.19"</span></pre><h2 id="2486" class="nz kv it bd kw oa ob dn la oc od dp le lv oe of lg lz og oh li md oi oj lk ok bi translated">肥皂信封</h2><p id="d51a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">接下来，您需要向服务发送一个SOAP“有效负载”。这是您希望服务在得到您的响应之前使用的数据。我合作过的大多数开发人员都使用一种叫做<a class="ae ox" href="https://www.soapui.org/" rel="noopener ugc nofollow" target="_blank"> SOAP UI </a>的工具来生成他们的有效负载。</p><p id="7f06" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">当您在SOAP UI中输入一个WSDL(本地文件或HTTP URL)时，它会在侧边栏树中生成“SOAP绑定”和测试用例(针对所有的<code class="fe ou ov ow om b">soapActions</code>)。这些是供您的SOAP web服务使用的样板XML模式。你所需要做的就是填写数据。</p><p id="f520" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">对于NOAA服务，我插入了<a class="ae ox" href="https://graphical.weather.gov/xml/SOAP_server/ndfdXMLserver.php?wsdl" rel="noopener ugc nofollow" target="_blank">这个WSDL </a>，并选中了“为SOAP绑定创建测试套件”选项，所有的测试用例都为我呈现出来了。我只需要替换“？”用可接受的数据来消费服务。</p><p id="1823" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><a class="ae ox" href="https://www.youtube.com/watch?v=6BhJhTALOs4" rel="noopener ugc nofollow" target="_blank">使用SOAP UI的视频</a></p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="e4a9" class="ku kv it bd kw kx ng kz la lb nh ld le jz ni ka lg kc nj kd li kf nk kg lk ll bi translated">用Curl测试服务</h1><p id="740f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我想用一些非常简单和原始的东西来测试服务，以确保SOAP UI不会在我面前施展魔法，并完全理解幕后发生的事情。</p><p id="7c10" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我从SOAP UI中复制了<code class="fe ou ov ow om b">LatLonListZipCode<em class="oy"> </em>soapAction</code>的信封，并将其粘贴到一个文件中供<code class="fe ou ov ow om b">curl</code>使用(对于一个长命令来说，以字符串形式传递会更好)。</p><p id="37c7" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">然后，我用有效的邮政编码替换了<code class="fe ou ov ow om b">&lt;zipCodeList&gt;</code>标记之间的<code class="fe ou ov ow om b">?</code>，并运行了以下命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="9014" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">请看，我得到了下面的响应，它给了我正确的经纬度坐标数据！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="3954" class="ku kv it bd kw kx ng kz la lb nh ld le jz ni ka lg kc nj kd li kf nk kg lk ll bi translated">为什么我要用Node？消费像肥皂这样古老的东西？</h1><p id="79f5" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">如果你像我一样在一家大公司工作，你会知道传统技术被推进和维护的时间太长了。我更倾向于使用Node这样的现代工具来完成工作，因为我可以更快地编写更少的代码。</p><p id="ba3d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我的任务是用Java编写旧SOAP服务的集成测试…我鄙视Java。要编写像HTTP请求这样简单的东西，代码实在太多了。我想…我打赌我可以在Node中轻松做到这一点。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="7c39" class="ku kv it bd kw kx ng kz la lb nh ld le jz ni ka lg kc nj kd li kf nk kg lk ll bi translated"><a class="ae ox" href="https://github.com/circa10a/easy-soap-request" rel="noopener ugc nofollow" target="_blank">简单Soap请求节点模块</a></h1><p id="265b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">有几个流行的SOAP node.js模块可供选择来执行SOAP请求，例如:</p><ul class=""><li id="b794" class="nl nm it lo b lp mi ls mj lv nn lz no md np mh nq nr ns nt bi translated"><a class="ae ox" href="https://www.npmjs.com/package/soap" rel="noopener ugc nofollow" target="_blank">肥皂</a></li><li id="4d97" class="nl nm it lo b lp nu ls nv lv nw lz nx md ny mh nq nr ns nt bi translated"><a class="ae ox" href="https://www.npmjs.com/package/strong-soap" rel="noopener ugc nofollow" target="_blank">强力肥皂</a></li><li id="7c24" class="nl nm it lo b lp nu ls nv lv nw lz nx md ny mh nq nr ns nt bi translated"><a class="ae ox" href="https://www.npmjs.com/package/easysoap" rel="noopener ugc nofollow" target="_blank">简易香皂</a></li></ul><p id="3f51" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">但是我设法为我的特定用例找到了所有这些错误的地方。每个都需要太多的代码或者太多的开销。我心想:“我只需要发三个参数，就这样。当我想做一些如此简单的事情时，为什么要为所有模块准备如此大量的文档。”所以…</p><p id="374d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我编写了一个简单的<code class="fe ou ov ow om b">.js</code>文件，使用<a class="ae ox" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>执行POST请求，重新创建了上面的过程，但是我认为“做这么简单的事情，代码还是太多了……”所以我创建了<code class="fe ou ov ow om b">easy-soap-request</code>节点模块。</p><p id="6f80" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">模块没有太多内容，但它提供了“提升力”。这将为那些刚刚了解可怕的遗留SOAP的人节省时间。该模块如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="f2f0" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">该模块接受三个参数(URL、headers、XML ), XML是soap信封。</p><p id="6443" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">它使用较新的异步await语法，所以你可以用你的异步编码和诸如此类的东西得到所有的花式。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="5bc9" class="ku kv it bd kw kx ng kz la lb nh ld le jz ni ka lg kc nj kd li kf nk kg lk ll bi translated">实际使用这个东西</h1><h2 id="9f3b" class="nz kv it bd kw oa ob dn la oc od dp le lv oe of lg lz og oh li md oi oj lk ok bi translated"><strong class="ak"> Node.js用法</strong></h2><p id="ecac" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">首先，您需要通过运行以下命令来安装该模块:</p><pre class="kj kk kl km gt ol om on oo aw op bi"><span id="400b" class="nz kv it om b gy oq or l os ot">npm install easy-soap-request</span></pre><p id="6526" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">接下来，您需要创建一个<code class="fe ou ov ow om b">.js</code>文件，并需要下面第一行中的模块。</p><p id="6ce5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这是一个很好的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="e8cf" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在第11行，我从一个文件中读入XML，因为这将是一个非常长的字符串，但这是您的首选。</p><p id="63c2" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在第15行，通过等待<code class="fe ou ov ow om b">soapRequest</code>函数返回响应体和状态代码，您可以看到我创建了一个“析构”对象。</p><p id="bf1e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">浏览器用法(新)</strong></p><p id="a842" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我甚至经历了学习<a class="ae ox" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> webpack </a>的麻烦，这样你就可以在客户端使用<code class="fe ou ov ow om b">easy-soap-request</code>:</p><p id="2ac1" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><em class="oy">但是要记住，</em><a class="ae ox" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank"><em class="oy">CORS</em></a><em class="oy">有时候会是个问题。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="3245" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在这里你可以找到<a class="ae ox" href="https://github.com/circa10a/easy-soap-request" rel="noopener ugc nofollow" target="_blank">带自述文件的回购</a>和npm 上的<a class="ae ox" href="https://www.npmjs.com/package/easy-soap-request" rel="noopener ugc nofollow" target="_blank">模块。</a></p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="624c" class="ku kv it bd kw kx ng kz la lb nh ld le jz ni ka lg kc nj kd li kf nk kg lk ll bi translated">用摩卡和柴测试</h1><p id="78e0" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">以下是如何在测试框架内执行上述操作的方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oz pa l"/></div></figure></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="2137" class="ku kv it bd kw kx ng kz la lb nh ld le jz ni ka lg kc nj kd li kf nk kg lk ll bi translated">鳍状物</h1><p id="f977" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">感谢阅读，希望你能在不久的将来继续休息！</p></div></div>    
</body>
</html>