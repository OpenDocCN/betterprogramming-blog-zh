<html>
<head>
<title>Native Lazy Loading in the Browser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">浏览器中的本地延迟加载</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/native-lazy-loading-in-the-browser-85dabe6653ed?source=collection_archive---------3-----------------------#2020-05-20">https://betterprogramming.pub/native-lazy-loading-in-the-browser-85dabe6653ed?source=collection_archive---------3-----------------------#2020-05-20</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="b35e" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">我们现在和早期是如何做的</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/fb2329f6a3d7daa94009ef1d33be3fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hA_k1Tueal3Lb7tJ"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Kate Stone Matheson 在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="6e96" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">2019年初听说原生懒加载的时候，我就火上浇油了！Chrome是第一个支持它的浏览器。</p><p id="267e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">快进到2020年初，Edge、Firefox、Chrome、Opera、Android和Android Chrome都支持它。由于目前这种支持已经好了很多，我想是时候写一写了。</p><p id="9501" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我想向您展示在浏览器中延迟加载图像和iframes是多么简单。</p><p id="efc3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是首先，我们将深入了解什么是延迟加载，为什么您想使用它，我们以前是如何做到这一点的，以及您想如何继续做下去。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="d6a9" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">1.什么是懒装？</h1><p id="1334" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">当一个<code class="fe na nb nc nd b">img</code>或<code class="fe na nb nc nd b">iframe</code>标签在HTML中并被浏览器解析时，它将立即加载源代码。这会阻止整个页面完成加载。</p><p id="1769" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这将导致加载页面的时间更长，因此用户与页面交互的时间也更长。我们希望用户尽可能快地与页面交互。</p><p id="0008" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以聪明人想出了懒装。这是一种显示图像并只在用户可见时加载iframes的技术。这将确保用户只下载可见的内容。</p><h2 id="1f78" class="ne me iu bd mf nf ng dn mj nh ni dp mn lj nj nk mp ln nl nm mr lr nn no mt np bi translated">历史</h2><p id="c4b3" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">过去，我们通过滚动事件监听器进行延迟加载。对于每个事件，我们都用图像和iframes检查数组，看它们是否可见。</p><p id="3316" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果它们是可见的，我们必须将属性<code class="fe na nb nc nd b">data-src=" source URL"</code>改为<code class="fe na nb nc nd b">`src=“source URL”</code>。这会在那一刻加载一个图像或页面。</p><p id="ceb5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是滚动事件是非常低效的，因为它在很短的时间内触发了无数的事件。</p><p id="2f50" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们必须计算元素是否可以用<code class="fe na nb nc nd b">getBoundingClientRect()</code>看到。这样做的缺点是，每次调用，都会迫使浏览器重新布局整个页面。</p><p id="6ecf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当时来说，并不理想。但这比通过页面加载来加载所有图像要好，因为这样用户就必须等到页面完全加载完毕。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="432b" class="ne me iu bd mf nf ng dn mj nh ni dp mn lj nj nk mp ln nl nm mr lr nn no mt np bi translated">交叉观察者</h2><p id="e5f9" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">2016年初，Chrome中提供了交叉点观察器。其他浏览器随后跟进。</p><p id="261e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Mozilla Web文档以非常清晰的方式描述了交叉点观察器:</p><blockquote class="nq nr ns"><p id="152f" class="la lb nt lc b ld le jv lf lg lh jy li nu lk ll lm nv lo lp lq nw ls lt lu lv in bi translated">“交集观察器API提供了一种异步观察目标元素与祖先元素或顶级文档的视口的交集的方式。”— <a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" rel="noopener ugc nofollow" target="_blank"> Mozilla文档</a></p></blockquote><p id="a739" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">路口观察者观察你告诉它的东西。它不同于事件。事件不断被触发，即使你没有对它们做任何事情。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="17b9" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">2.原生浏览器延迟加载</h1><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nx ny l"/></div></figure><p id="1d6b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">原生懒人加载超级简单！在你的<code class="fe na nb nc nd b">img</code>或<code class="fe na nb nc nd b">iframe</code>标签上添加一个<code class="fe na nb nc nd b">loading</code>属性。您可以选择值<code class="fe na nb nc nd b">lazy</code>、<code class="fe na nb nc nd b">eager</code>和<code class="fe na nb nc nd b">auto</code>。</p><ul class=""><li id="d9a3" class="nz oa iu lc b ld le lg lh lj ob ln oc lr od lv oe of og oh bi translated"><code class="fe na nb nc nd b">lazy</code>:使用延迟加载。</li><li id="71e6" class="nz oa iu lc b ld oi lg oj lj ok ln ol lr om lv oe of og oh bi translated"><code class="fe na nb nc nd b">eager</code>:直接加载。</li><li id="623b" class="nz oa iu lc b ld oi lg oj lj ok ln ol lr om lv oe of og oh bi translated"><code class="fe na nb nc nd b">auto</code>:浏览器会选择是否懒加载。</li></ul><p id="e836" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这种惰性加载的方式非常简单，使用它是显而易见的。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="d93e" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">3.它是如何工作的？</h1><p id="0dc3" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">如果您想使用延迟加载功能，可以为您的图像或iframes添加一个值为<code class="fe na nb nc nd b">lazy</code>的<code class="fe na nb nc nd b">loading</code>属性:</p><pre class="kk kl km kn gu on nd oo op aw oq bi"><span id="80dd" class="ne me iu nd b gz or os l ot ou">&lt;img src=“imageurl.jpg” loading=“lazy” alt=“...” /&gt;</span></pre><p id="b42a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用这个属性，您将告诉浏览器只在图像对用户可见时才显示它。当它不可见时，它不会下载图像或加载iframe的页面。</p><p id="a3e9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们需要跨多个浏览器的支持，但是并不是所有的浏览器都支持本地延迟加载，所以我们需要一个polyfill。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="fdf2" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">4.使用交叉点观察器回退</h1><p id="f178" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">因为<a class="ae kz" href="https://caniuse.com/#feat=intersectionobserver" rel="noopener ugc nofollow" target="_blank"> Safari(在macOS和iOs上)</a>还不支持原生延迟加载，但是支持交集观察器，所以我们可以使用基于交集观察器的<a class="ae kz" href="https://github.com/mfranzke/loading-attribute-polyfill" rel="noopener ugc nofollow" target="_blank"> polyfill来实现原生延迟加载。</a></p><h2 id="d9a5" class="ne me iu bd mf nf ng dn mj nh ni dp mn lj nj nk mp ln nl nm mr lr nn no mt np bi translated">支持</h2><p id="debf" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">这种polyfill支持大多数现代浏览器。</p><ul class=""><li id="0839" class="nz oa iu lc b ld le lg lh lj ob ln oc lr od lv oe of og oh bi translated">苹果电脑:火狐浏览器，Safari 12，11</li><li id="9cee" class="nz oa iu lc b ld oi lg oj lj ok ln ol lr om lv oe of og oh bi translated">iOS: Safari 12</li><li id="fc73" class="nz oa iu lc b ld oi lg oj lj ok ln ol lr om lv oe of og oh bi translated">Windows: Chrome、Edge、Internet Explorer 11</li></ul><h2 id="fe7c" class="ne me iu bd mf nf ng dn mj nh ni dp mn lj nj nk mp ln nl nm mr lr nn no mt np bi translated">插件</h2><p id="49b4" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">也有一些插件可供PHP和WordPress使用原生惰性加载。</p><ul class=""><li id="30a0" class="nz oa iu lc b ld le lg lh lj ob ln oc lr od lv oe of og oh bi translated"><a class="ae kz" href="https://wordpress.org/plugins/native-lazyload-polyfill/" rel="noopener ugc nofollow" target="_blank"> WordPress插件</a></li><li id="2016" class="nz oa iu lc b ld oi lg oj lj ok ln ol lr om lv oe of og oh bi translated"><a class="ae kz" href="https://github.com/tim-thaler/twig-loading-lazy" rel="noopener ugc nofollow" target="_blank"> PHP分支扩展</a></li><li id="e75f" class="nz oa iu lc b ld oi lg oj lj ok ln ol lr om lv oe of og oh bi translated"><a class="ae kz" href="https://github.com/tim-thaler/craft-twig-loading-lazy" rel="noopener ugc nofollow" target="_blank">工艺树枝装载插件</a></li></ul><h2 id="98bf" class="ne me iu bd mf nf ng dn mj nh ni dp mn lj nj nk mp ln nl nm mr lr nn no mt np bi translated">更多支持</h2><p id="4cb4" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">如果需要支持IE 11，还需要为交集观察者加载一个<a class="ae kz" href="https://github.com/w3c/IntersectionObserver/tree/master/polyfill" rel="noopener ugc nofollow" target="_blank"> polyfill。</a></p><p id="81ed" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我已经写了一篇关于<a class="ae kz" href="https://medium.com/better-programming/lazy-loading-images-with-the-intersection-observer-e8ad57a1682c" rel="noopener">如何使用交叉点观察器来延迟加载你的图像</a>的深入文章。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="9faf" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="7ea8" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">超级棒的是，我们终于在浏览器中加入了原生延迟加载功能！添加polyfill后，我们可以确保所有现代浏览器都可以使用它。</p><p id="085a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你已经在你的网站或网络应用上使用了原生的延迟加载功能了吗？还是有兴趣实施？请在评论中让我知道你的想法，如果你发现了一些秘密。</p><blockquote class="nq nr ns"><p id="473f" class="la lb nt lc b ld le jv lf lg lh jy li nu lk ll lm nv lo lp lq nw ls lt lu lv in bi translated">我在一个不和谐服务器上聚集了一些来自世界各地的<a class="ae kz" href="https://mailchi.mp/fb82491d03f8/dev-by-rayray-discord-community" rel="noopener ugc nofollow" target="_blank">有抱负的开发者，如果你想加入，请随意。</a></p></blockquote></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="056d" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">阅读更多</h1><div class="ov ow gq gs ox oy"><a href="https://medium.com/dev-together/5-steps-give-structure-to-your-development-projects-e1348eb9f17d" rel="noopener follow" target="_blank"><div class="oz ab fp"><div class="pa ab pb cl cj pc"><h2 class="bd iv gz z fq pd fs ft pe fv fx it bi translated">5个步骤为您的开发项目提供结构</h2><div class="pf l"><h3 class="bd b gz z fq pd fs ft pe fv fx dk translated">你不能管理你的编程项目吗？试试这个！</h3></div><div class="pg l"><p class="bd b dl z fq pd fs ft pe fv fx dk translated">medium.com</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm kt oy"/></div></div></a></div><div class="ov ow gq gs ox oy"><a href="https://levelup.gitconnected.com/how-to-build-a-dark-mode-switcher-with-css-variables-ccb13f7441a0" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fp"><div class="pa ab pb cl cj pc"><h2 class="bd iv gz z fq pd fs ft pe fv fx it bi translated">如何用CSS变量构建一个黑暗模式切换器</h2><div class="pf l"><h3 class="bd b gz z fq pd fs ft pe fv fx dk translated">用CSS变量、JavaScript和TypeScript构建一个黑暗模式切换器</h3></div><div class="pg l"><p class="bd b dl z fq pd fs ft pe fv fx dk translated">levelup.gitconnected.com</p></div></div><div class="ph l"><div class="pn l pj pk pl ph pm kt oy"/></div></div></a></div><div class="ov ow gq gs ox oy"><a href="https://medium.com/dev-together/javascript-concepts-you-need-before-starting-w-frameworks-libraries-25a325312b5c" rel="noopener follow" target="_blank"><div class="oz ab fp"><div class="pa ab pb cl cj pc"><h2 class="bd iv gz z fq pd fs ft pe fv fx it bi translated">开始使用框架和库之前需要的JavaScript概念</h2><div class="pf l"><h3 class="bd b gz z fq pd fs ft pe fv fx dk translated">在你熟悉它们之前不要开始</h3></div><div class="pg l"><p class="bd b dl z fq pd fs ft pe fv fx dk translated">medium.com</p></div></div><div class="ph l"><div class="po l pj pk pl ph pm kt oy"/></div></div></a></div><div class="ov ow gq gs ox oy"><a href="https://medium.com/undefined-developer/5-tips-to-make-100daysofcode-effective-for-everyone-3695587aad64" rel="noopener follow" target="_blank"><div class="oz ab fp"><div class="pa ab pb cl cj pc"><h2 class="bd iv gz z fq pd fs ft pe fv fx it bi translated">让100DaysOfCode对每个人都有效的5个技巧！</h2><div class="pf l"><h3 class="bd b gz z fq pd fs ft pe fv fx dk translated">明智地花时间学习编码</h3></div><div class="pg l"><p class="bd b dl z fq pd fs ft pe fv fx dk translated">medium.com</p></div></div><div class="ph l"><div class="pp l pj pk pl ph pm kt oy"/></div></div></a></div></div></div>    
</body>
</html>