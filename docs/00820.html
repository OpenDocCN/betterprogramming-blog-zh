<html>
<head>
<title>Making a Real World Application With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI制作真实世界的应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/making-a-real-world-application-with-swiftui-63a198fc23c9?source=collection_archive---------5-----------------------#2019-07-17">https://betterprogramming.pub/making-a-real-world-application-with-swiftui-63a198fc23c9?source=collection_archive---------5-----------------------#2019-07-17</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="f247" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">第四部分:动画、过渡和手势</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/b9646592fcc9aa3279cff66f7ca6353c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IwFrbAN1DWK518snzYxLuw@2x.png"/></div></div></figure><p id="dfe4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这个故事是关于制作一个真实世界的SwiftUI应用程序的系列文章的第四部分。我建议您先阅读第一、第二和第三部分——它们将为您提供应用程序、其功能、特性和架构的概述。</p><div class="lr ls gq gs lt lu"><a href="https://medium.com/better-programming/making-a-real-world-application-with-swiftui-cb40884c1056" rel="noopener follow" target="_blank"><div class="lv ab fp"><div class="lw ab lx cl cj ly"><h2 class="bd iv gz z fq lz fs ft ma fv fx it bi translated">使用SwiftUI制作真实世界的应用程序</h2><div class="mb l"><h3 class="bd b gz z fq lz fs ft ma fv fx dk translated">第一部分:数据流和冗余</h3></div><div class="mc l"><p class="bd b dl z fq lz fs ft ma fv fx dk translated">medium.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi kt lu"/></div></div></a></div><div class="lr ls gq gs lt lu"><a href="https://medium.com/better-programming/making-a-real-world-application-with-swiftui-ba9e9682889c" rel="noopener follow" target="_blank"><div class="lv ab fp"><div class="lw ab lx cl cj ly"><h2 class="bd iv gz z fq lz fs ft ma fv fx it bi translated">使用SwiftUI制作真实世界的应用程序</h2><div class="mb l"><h3 class="bd b gz z fq lz fs ft ma fv fx dk translated">第二部分:异步数据和远程映像</h3></div><div class="mc l"><p class="bd b dl z fq lz fs ft ma fv fx dk translated">medium.com</p></div></div><div class="md l"><div class="mj l mf mg mh md mi kt lu"/></div></div></a></div><div class="lr ls gq gs lt lu"><a href="https://medium.com/@dimillian/making-a-real-world-application-with-swiftui-3b643ddfae22" rel="noopener follow" target="_blank"><div class="lv ab fp"><div class="lw ab lx cl cj ly"><h2 class="bd iv gz z fq lz fs ft ma fv fx it bi translated">使用SwiftUI制作真实世界的应用程序</h2><div class="mb l"><h3 class="bd b gz z fq lz fs ft ma fv fx dk translated">第三部分:导航和演示</h3></div><div class="mc l"><p class="bd b dl z fq lz fs ft ma fv fx dk translated">medium.com</p></div></div><div class="md l"><div class="mk l mf mg mh md mi kt lu"/></div></div></a></div><p id="1c7c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在本文中，我们将看看动画和手势在<strong class="kx iv"> SwiftUI </strong>中是如何工作的。</p><p id="0fea" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><a class="ae ml" href="https://github.com/Dimillian/MovieSwiftUI" rel="noopener ugc nofollow" target="_blank"> MovieSwiftUI </a>在熟悉的UX中结合了多种手势和动画。我将使用它的电影发现功能，并带您了解它的内部工作原理。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj mm"><img src="../Images/709c0d205188478b690aa29783f873b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*pUZcLMGWApkzECS9cUpbHQ.gif"/></div></figure><h1 id="4ea1" class="mn mo iu bd mp mq mr ms mt mu mv mw mx ka my kb mz kd na ke nb kg nc kh nd ne bi translated">动画片</h1><p id="4c10" class="pw-post-body-paragraph kv kw iu kx b ky nf jv la lb ng jy ld le nh lg lh li ni lk ll lm nj lo lp lq in bi translated">但首先让我给你介绍一下<strong class="kx iv"> SwiftUI </strong>中的动画概念。</p><p id="bf98" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe nk nl nm nn b">.animation()</code>修改器可以添加到任何<code class="fe nk nl nm nn b">View</code>中，在任何之前的修改器之后。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="2850" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">例如，在上面的代码中，我们有一个按钮，您可以打开和关闭它。因为我们在视图上添加了一个.<code class="fe nk nl nm nn b">spring()</code>动画，所以<code class="fe nk nl nm nn b">.scaleEffect()</code>修改器将被动画化。当你点击按钮时，它触发它的动作，这将更新<code class="fe nk nl nm nn b">isOn</code>属性。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nq"><img src="../Images/1cdf66485271a8ba8e03358af4553c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/1*qVaczr6P7SUEQpxoYAus9Q.gif"/></div></figure><p id="5bca" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">还有另一种方法——记住这一点很重要，因为在某些情况下，您可能只想制作一个状态变化的动画，而不想制作其他状态变化的动画。我们可以提供完全相同的效果，但方式稍有不同:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="4567" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<code class="fe nk nl nm nn b">withAnimation()</code>块中包装<code class="fe nk nl nm nn b">@State</code>属性突变使用提供的动画更新视图。通过这种方式，我可以拥有其他对视图有影响的<code class="fe nk nl nm nn b">@State</code>属性，并且在不激活视图的情况下改变它们。</p><p id="36a4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您还可以将动画放在属性中并重复使用，这在动画具有自定义参数时非常有用。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><h1 id="3685" class="mn mo iu bd mp mq mr ms mt mu mv mw mx ka my kb mz kd na ke nb kg nc kh nd ne bi translated">过渡</h1><p id="6b00" class="pw-post-body-paragraph kv kw iu kx b ky nf jv la lb ng jy ld le nh lg lh li ni lk ll lm nj lo lp lq in bi translated">还有另一个你可以与动画结合的特性——过渡。如果您想要在屏幕上和屏幕外转换视图，可以使用这些选项。让我们稍微修改一下我们的按钮，这样当你按下它的时候就会出现一个视图:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nr"><img src="../Images/00843e37fc9290d48df11d817c5001f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*lfKlapE0I9nUtzjyBZJ9vw.gif"/></div></figure><p id="c530" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在让我们看一下代码:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="15db" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们只在状态为on时显示<code class="fe nk nl nm nn b">Text</code>视图“我在这里”,并添加我们的<code class="fe nk nl nm nn b">transition</code>作为修饰符。现在，当我们按下按钮并更新状态时，它会在视图层次结构中添加或删除视图时自动管理转换，并将其与我们的动画相结合。很神奇，不是吗？</p><p id="3f14" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在我们已经看到了基础，让我们再深入一点，看看一个更复杂的例子——上面gif中的例子。</p><h1 id="0206" class="mn mo iu bd mp mq mr ms mt mu mv mw mx ka my kb mz kd na ke nb kg nc kh nd ne bi translated">结合手势和动画</h1><p id="0bc9" class="pw-post-body-paragraph kv kw iu kx b ky nf jv la lb ng jy ld le nh lg lh li ni lk ll lm nj lo lp lq in bi translated">首先，我们将向海报添加一个拖动手势，使其可拖动。为了让初次接触有冲击力，我们将结合一个非常短的长按手势。用户首先必须按下海报，然后他将能够拖动它。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="f1f2" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这个手势可以在我们还体之前定义。所以我们首先初始化我们的<code class="fe nk nl nm nn b">LongPressGesture</code>和<code class="fe nk nl nm nn b">DragGesture</code>，并通过使用。<code class="fe nk nl nm nn b">sequenced</code>功能我们要确保在<code class="fe nk nl nm nn b">dragGesture</code>开始之前<code class="fe nk nl nm nn b">longPressGesture</code>必须被识别。</p><p id="df77" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">你可以看一下Apple的文档来编写手势——我的实现只是他们例子的一个发展。他们会比我更好地解释它是如何工作的。</p><div class="lr ls gq gs lt lu"><a href="https://developer.apple.com/documentation/swiftui/gestures/composing_swiftui_gestures" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab fp"><div class="lw ab lx cl cj ly"><h2 class="bd iv gz z fq lz fs ft ma fv fx it bi translated">编写SwiftUI手势| Apple开发者文档</h2><div class="mb l"><h3 class="bd b gz z fq lz fs ft ma fv fx dk translated">当您同时组合手势修饰符时，SwiftUI必须同时识别所有子手势模式，以便…</h3></div><div class="mc l"><p class="bd b dl z fq lz fs ft ma fv fx dk translated">developer.apple.com</p></div></div></div></a></div><p id="1e03" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们还引用了一个<code class="fe nk nl nm nn b">dragState</code>属性。让我们看看它是如何定义的，因为这是一个重要的部分。这是您稍后将在视图修改器中使用的属性，实际上是在手势旁边设置动画。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="3845" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">所发生的是，我们使用<code class="fe nk nl nm nn b">.updating()</code>回调绑定我们的<code class="fe nk nl nm nn b">dragState</code>属性，并将其设置为所需的值，这样存储在我们视图中的本地状态将反映我们手势的组合和当前状态。</p><p id="e1e5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe nk nl nm nn b">.updating()</code>功能会向您转发两个手势。<code class="fe nk nl nm nn b">.first(true)</code>情况是当长按手势被验证时，而<code class="fe nk nl nm nn b">.second</code>情况让我们在<code class="fe nk nl nm nn b">DragGesture</code>被更新时获得关于它的信息——即当用户在屏幕上拖动附加的视图时。当手势被取消或者当用户完成与我们的视图的交互时，默认情况下，状态被重置为非活动。</p><p id="04cd" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们的<code class="fe nk nl nm nn b">dragState</code>将存储当前的拖动手势转换以及预测的结束位置。</p><p id="75eb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，让我们看看如何将它与我们的视图协调起来:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="3b92" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">正如您在上面的代码中看到的，一旦手势就位，这只是根据手势状态更新视图中的修饰符的问题。现在最有趣的部分是玩<code class="fe nk nl nm nn b">computeOffset()</code>和<code class="fe nk nl nm nn b">computeAngle()</code>功能，如果你想增加一些阻力的话。</p><p id="5e8b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这是来自<strong class="kx iv"> MovieSwiftUI </strong> discover功能的一个小而简化的摘录，但它完全可以工作，并将从手势开始。你可以在这里看到<a class="ae ml" href="https://github.com/Dimillian/MovieSwiftUI/tree/master/MovieSwift/MovieSwift/views/components/discover" rel="noopener ugc nofollow" target="_blank">全部功能的代码</a>。它包括带有缩放效果的堆叠海报，还将向您展示如何检测手势的结束状态。如果用户取消了它，或者如果在左边或右边有足够的速度来触发一个动作。</p><p id="edf3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果我包括这个特性的所有流程和代码，这篇文章就太长了，这就是为什么我只使用了一个简化的例子。</p><p id="250b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<strong class="kx iv"> SwiftUI中，你可以用动画、过渡和手势做许多其他事情。在我看来，简单的声明式API允许我们更快地迭代，并且很容易调整、改变和更新我们的动画和手势。要在<strong class="kx iv"> UIKit </strong>中实现同样的功能，我可能要花很多时间和更多代码。</strong></p><p id="81a3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我在这本集子里还计划了一些文章，但是它们会晚一点来。随着苹果在swift ui API中增加稳定性，它主要是关于如何在相同的目标中提供一个漂亮的macOS UX。目前，<strong class="kx iv"> SwiftUI </strong>还不能在共享的iOS/macOS目标上编译(从beta 3开始)。</p><p id="56ae" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">感谢阅读！</p></div></div>    
</body>
</html>