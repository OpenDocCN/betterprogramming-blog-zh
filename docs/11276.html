<html>
<head>
<title>Store an Array of Custom Data Types in Core Data With Transformable and NSSecureCoding</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Transformable和NSSecureCoding在核心数据中存储一组自定义数据类型</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/store-an-array-of-custom-data-types-in-core-data-with-transformable-and-nssecurecoding-631c565589bb?source=collection_archive---------2-----------------------#2022-03-05">https://betterprogramming.pub/store-an-array-of-custom-data-types-in-core-data-with-transformable-and-nssecurecoding-631c565589bb?source=collection_archive---------2-----------------------#2022-03-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="129c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将用户的图形保存在核心数据中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d2659645cbb8badc29993d160f22d7fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n4yh4MpPG2xRD27y"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">伊利亚·巴甫洛夫在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ba0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可转换属性对于在核心数据中存储非标准对象类型非常有用。</p><p id="ca96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您可以通过将属性类型设置为<code class="fe lv lw lx ly b">Transformable</code>来将<code class="fe lv lw lx ly b">UIImage</code>的实例存储在核心数据中。</p><p id="3dfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将更进一步，看看如何使用Transformable和<code class="fe lv lw lx ly b">NSSecureCoding</code>在核心数据中存储一组自定义数据类型。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="e36f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想象一下，我们希望将用户的绘图存储在一个虚构的绘图应用程序的核心数据中。我们创建了两个类来模拟绘图数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="a763" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的自定义canvas <code class="fe lv lw lx ly b">UIView</code>子类中，我们以这种方式绘制路径:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="e442" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是时候将绘图数据保存在核心数据中了。</p><p id="7de7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们打开我们的<code class="fe lv lw lx ly b">CoreData</code>模型编辑器(扩展名为<code class="fe lv lw lx ly b">.xcdatamodeld</code>的源文件)，为我们的画布实体添加一个名为drawings的属性，然后将其属性类型设置为Transformable。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/22573d4c4f0e8ee785929667583358de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OSexypK83KoxL_arBKUdRw.jpeg"/></div></div></figure><p id="a3ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是现在，我们收到一个警告，上面写着:</p><blockquote class="mj mk ml"><p id="d98a" class="kz la mm lb b lc ld ju le lf lg jx lh mn lj lk ll mo ln lo lp mp lr ls lt lu im bi translated"><code class="fe lv lw lx ly b"><em class="it">Canvas.drawing</em></code> <em class="it">正在使用一个零或不安全的值转换器。请切换到</em> <code class="fe lv lw lx ly b"><em class="it">NSSecureUnarchiveFromDataTransformerName</em></code> <em class="it">或者自定义</em><code class="fe lv lw lx ly b"><em class="it">NSValueTransformer</em></code><em class="it"/><code class="fe lv lw lx ly b"><em class="it">NSSecureUnarchiveFromDataTransformer</em></code>的子类</p></blockquote><p id="6a5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们收到这个警告的原因是，从iOS 13开始，苹果希望我们对我们的自定义CoreData数据类型使用<code class="fe lv lw lx ly b">NSSecureCoding</code>(而不是<code class="fe lv lw lx ly b">NSCoding</code>)以获得更好的安全性。</p><p id="8d67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续让我们的数据模型类符合<code class="fe lv lw lx ly b">NSSecureCoding</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="3a81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有相当多的变化，让我们回顾一些要点。</p><ol class=""><li id="ca90" class="mq mr it lb b lc ld lf lg li ms lm mt lq mu lu mv mw mx my bi translated">我们使我们的模型类成为<code class="fe lv lw lx ly b">NSObject</code>的子类，这样它们可以被序列化。此外，我们使它们符合<code class="fe lv lw lx ly b">NSSecureCoding</code>协议；</li><li id="9edc" class="mq mr it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">我们将静态属性<code class="fe lv lw lx ly b">supportsSecureCoding</code>设置为true</li><li id="d207" class="mq mr it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">当从核心数据中检索数据时，我们使用<code class="fe lv lw lx ly b">decodeObject(of: forKey:)</code>来解码对象；</li><li id="1428" class="mq mr it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">由于<code class="fe lv lw lx ly b">CGPoint</code>不符合<code class="fe lv lw lx ly b">NSSecureCoding</code>协议，我们将其转换为<code class="fe lv lw lx ly b">NSString</code>，然后进行编码。当我们解码它时，我们再把它转换回<code class="fe lv lw lx ly b">CGPoint</code>；</li><li id="8073" class="mq mr it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">由于<code class="fe lv lw lx ly b">Path</code>是一个定制类，我们需要在被解码的对象应该匹配的预期类数组中包含<code class="fe lv lw lx ly b">Path</code>类型。</li></ol><p id="32ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在已经使我们的模型类符合<code class="fe lv lw lx ly b">NSSecureCoding</code>。让我们继续为我们的<code class="fe lv lw lx ly b">drawings</code>属性创建一个<code class="fe lv lw lx ly b">NSSecureUnarchiveFromDataTransformer</code>子类，这样它就知道如何在从核心数据中检索时将其值从<code class="fe lv lw lx ly b">NSData</code>转换为正确的数据类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="f376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们将<code class="fe lv lw lx ly b">Paths</code>类添加到<code class="fe lv lw lx ly b">allowedTopLevelClasses</code>数组中，因为它是值转换过程中的顶级类。我们还创建了一个名为<code class="fe lv lw lx ly b">Register</code>的静态方法，它允许我们将自定义转换器注册到我们的应用程序中，这是我们接下来要做的。</p><p id="c23e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们打开<code class="fe lv lw lx ly b">AppDelegate.swift</code>文件，进行如下更改，以注册我们的自定义转换器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="bf08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们返回到核心数据模型编辑器，并为<code class="fe lv lw lx ly b">drawings</code>属性指定<code class="fe lv lw lx ly b">Transformer</code>和<code class="fe lv lw lx ly b">CustomClass</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/b2d7deccd1e3df6409df5d8e9694d22b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N00nhpHPCE0NxBvsOHnB7A.jpeg"/></div></div></figure><p id="556d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在所有这些步骤之后，我们的应用程序能够将用户的绘图保存在核心数据中。</p></div></div>    
</body>
</html>