<html>
<head>
<title>Build Your Own Multi-Node Kubernetes Cluster with Monitoring</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您自己的带监控的多节点Kubernetes集群</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-your-own-multi-node-kubernetes-cluster-with-monitoring-346a7e2ef6e2?source=collection_archive---------0-----------------------#2019-04-01">https://betterprogramming.pub/build-your-own-multi-node-kubernetes-cluster-with-monitoring-346a7e2ef6e2?source=collection_archive---------0-----------------------#2019-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="358d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Grafana monitoring从头开始构建您自己的多节点Kubernetes集群(BYOC)。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fbfc16ee78b7f6147a7a9bd0f64495bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bxgesSn_TJOzcQoleoOd8A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">斯科特·韦伯在<a class="ae ky" href="https://unsplash.com/s/photos/cluster?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="0446" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://seeloz.com" rel="noopener ugc nofollow" target="_blank"> Seeloz </a>，我们正在构建人工智能，以减少供应链管理中的浪费和低效。我们最近开始探索将我们的大数据管道迁移到Kubernetes。虽然我们强烈建议一家初创公司使用托管的Kubernetes解决方案，但我们已经获得了几个强大的非云虚拟机的访问权限，我们希望加以利用。</p><p id="d3de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将带您从头开始构建自己的多节点Kubernetes集群(BYOC)，包括为您的集群设置网络(通过<a class="ae ky" href="https://github.com/projectcalico/calico/" rel="noopener ugc nofollow" target="_blank"> Calico </a>)和存储卷(通过<a class="ae ky" href="https://storageos.com" rel="noopener ugc nofollow" target="_blank"> StorageOS </a>)。我们还将设置用于可视化编排的Kubernetes仪表盘、<a class="ae ky" href="https://helm.sh" rel="noopener ugc nofollow" target="_blank"> helm </a> /tiller来帮助我们部署预打包的解决方案，以及<a class="ae ky" href="https://prometheus.io" rel="noopener ugc nofollow" target="_blank"> Prometheus </a>和<a class="ae ky" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank"> Grafana </a>来显示您的集群的详细实时监控和警报。</p><p id="7b62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想了解Kubernetes的更多信息，以及它能为您做什么，请查看它们的官方文档:</p><div class="lv lw gp gr lx ly"><a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">什么是Kubernetes？</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">Kubernetes是一个可移植、可扩展的开源平台，用于管理容器化的工作流和服务。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">kubernetes.io</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="49c3" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">集群设计注意事项</h1><h2 id="c6f8" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">集群拓扑和节点数量</h2><p id="ab80" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">您需要做出的第一个决定是您希望构建的集群拓扑类型。最简单的选项只需要一个节点，而可用性最高的拓扑至少需要九个节点。您的决定将基于各种因素，从可用的节点数量到预算限制。您有以下选择:</p><ul class=""><li id="78d0" class="od oe it lb b lc ld lf lg li of lm og lq oh lu oi oj ok ol bi translated"><strong class="lb iu">单节点集群<br/> </strong>不建议为生产构建单节点Kubernetes，例如使用<a class="ae ky" href="https://kubernetes.io/docs/setup/minikube/" rel="noopener ugc nofollow" target="_blank"> MiniKube </a>。使用Kubernetes的一个重要原因是它处理节点故障的能力，因此构建单节点集群就失去了使用Kubernetes的意义。如果您主要想获得容器化的诸多好处，可以考虑只在您的节点或虚拟机上安装Docker，然后使用<a class="ae ky" href="https://docs.docker.com/engine/reference/run/#restart-policies---restart" rel="noopener ugc nofollow" target="_blank">重启策略</a>运行您的服务。</li><li id="501b" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated"><strong class="lb iu">单主机、多节点集群<br/> </strong>这是我们在这篇文章中要关注的内容。这意味着我们将有一个单独的Kubernetes主节点运行在一个节点上，然后有三个或更多的从节点(又名<em class="or"> Minions </em>)，总共最少有四个节点:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/e3b1c0f07f35f40ab1274454ec259081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZ8cm65P2_iLOIo051aWtQ.png"/></div></div></figure><ul class=""><li id="9551" class="od oe it lb b lc ld lf lg li of lm og lq oh lu oi oj ok ol bi translated"><strong class="lb iu"> HA(高可用)集群</strong> <br/>这里有两种选择:堆叠etcd和外部etcd。对于堆叠方法，您至少需要六个节点(三个节点用于控制平面，至少三个节点用于您的爪牙)。对于外部etcd方法，您至少需要九个节点。你可以在这里读到更多关于他们的信息:<a class="ae ky" href="https://kubernetes.io/docs/setup/independent/ha-topology/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/setup/independent/ha-topology/</a></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/9747cab0cd9cabd65faa36c3d4590a5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1mg6ENbrUpYIv9cf46WrFw.png"/></div></div></figure><p id="4463" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一部分中，我们将构建一个单主节点、多节点集群，其中有一个主节点和三个或更多的从节点。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="b2db" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">节点规格</h1><p id="4bef" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">根据官方文档(<a class="ae ky" href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#before-you-begin" rel="noopener ugc nofollow" target="_blank">链接</a>)，集群中的每个节点至少应该有两个CPU和2 GB的RAM。但是根据您打算在节点上运行什么，您可能需要更多。您还必须至少拥有Ubuntu 16.04.6 LTS或CentOS 7.5+(某些附加软件的最低要求)。然而，我们强烈推荐使用Ubuntu 18.04.2 LTS版，因为它有更新的Linux内核版本4.15(你也可以考虑非LTS的Ubuntu 18.10，它有来自<a class="ae ky" href="https://kernelnewbies.org/Linux_4.18" rel="noopener ugc nofollow" target="_blank">内核4.18 </a>的最新容器化改进)。较新的Linux内核包含增强功能，以更好地支持容器世界，这个世界在6年前内核3.10发布时并不存在，CentOS 7.x使用的就是这种形式。话虽如此，本指南是针对使用CentOS 7.6的节点编写的，因为这是虚拟机上提供给我们的版本。指令的主要区别在于使用apt-get而不是yum。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="12e8" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">建立工作关系网</h1><p id="a452" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">你要做的下一个最重要的决定是决定你将使用什么样的网络解决方案。在做出这个决定之前，您甚至不能启动Kubernetes集群。不幸的是，这令人困惑，因为有很长的列表可供选择，而且没有默认的或推荐的列表。虽然有许多官方选项可供选择，但似乎最受欢迎的是印花布、法兰绒和编织网。我们找到了一篇很棒的文章来帮助你做决定:</p><div class="lv lw gp gr lx ly"><a href="https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-36475925a560" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">Kubernetes网络插件(CNI)在10Gbit/s网络上的基准测试结果</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">Kubernetes是一个很棒的集装箱装配工。但是它不管理点对点通信网络。这是…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">itnext.io</p></div></div><div class="mh l"><div class="ou l mj mk ml mh mm ks ly"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/77cbfe9255e3c77df66e4a333d6d275c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1MGlyRyHORwsXAm5HKOrA.png"/></div></div></figure><p id="6d22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文的最后，作者得出结论，最好的整体网络解决方案是<em class="or"> Calico，</em>它不仅具有出色的性能，还具有良好的安全性、资源利用率和安装体验。本指南将向您展示如何将Calico设置为Kubernetes的网络层。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="5978" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">存储卷</h1><p id="cc57" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">最后，为了拥有一个可用的Kubernetes集群，您必须设置一个持久存储类。同样，有一长串选项可供选择(<a class="ae ky" href="https://kubernetes.io/docs/concepts/storage/#types-of-volumes" rel="noopener ugc nofollow" target="_blank">链接</a>)。当我们浏览列表时，我们发现每个选项都有自己的一组约束。例如，如果我们想使用<code class="fe ow ox oy oz b">gcePersistentDisk</code>选项，我们只能在运行我的集群的节点是Google Cloud虚拟机的情况下这样做。同时，Kubernetes强烈反对使用更简单的本地节点存储选项<code class="fe ow ox oy oz b">HostPath</code>:</p><blockquote class="pa pb pc"><p id="a06f" class="kz la or lb b lc ld ju le lf lg jx lh pd lj lk ll pe ln lo lp pf lr ls lt lu im bi translated">主机路径(仅单节点测试—本地存储不受任何支持，在多节点群集中不起作用)</p></blockquote><p id="89f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">浏览所有选项后，最适合我们用例的选项如下:</p><ul class=""><li id="9541" class="od oe it lb b lc ld lf lg li of lm og lq oh lu oi oj ok ol bi translated"><code class="fe ow ox oy oz b"><a class="ae ky" href="https://docs.gluster.org/en/latest/" rel="noopener ugc nofollow" target="_blank">Glusterfs</a></code> <br/>这是一个流行的免费选项，可以将你可能有的任何存储挂载转化为你的pods可以使用的分布式文件系统。</li><li id="d126" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated"><code class="fe ow ox oy oz b"><a class="ae ky" href="https://storageos.com" rel="noopener ugc nofollow" target="_blank">StorageOS</a></code> <br/>该选项最高可免费使用500 GB，但比<code class="fe ow ox oy oz b">Glusterfs</code>或<code class="fe ow ox oy oz b">Portworx</code>更易于设置和使用。StorageOS的主要问题是缺乏对<code class="fe ow ox oy oz b">ReadWriteMany</code>策略的支持，这意味着您不能让多个pod对同一底层存储进行写访问。</li><li id="d552" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">这似乎是另一个不错的选择。但是，它需要在虚拟机上运行几个服务，这是我们希望避免的，而且通常有点繁重。</li></ul><p id="36df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本指南中，我们将使用<code class="fe ow ox oy oz b">StorageOS</code>作为我们的存储卷解决方案，主要是为了简单起见。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="1645" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">设置集群</h1><p id="b5ca" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">下面是您应该在集群中的每个节点上运行的命令。请注意，这些说明假设您有一个CentOS 7+节点。Ubuntu指令大部分是相似的，当然，除了你必须使用apt-get而不是yum。另外一些<code class="fe ow ox oy oz b">kubeadm</code>的安装说明也有点不同，你可以在这里找到:<a class="ae ky" href="https://kubernetes.io/docs/setup/independent/install-kubeadm/" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="7a5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该能够在不做任何更改的情况下将以下内容复制粘贴到一个<code class="fe ow ox oy oz b">CentOS</code>节点上:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="f539" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">sudo</strong> -i                 # Become root<br/><strong class="oz iu">sudo</strong> yum update -y      # Update all packages</span><span id="2ec4" class="nm mv it oz b gy po pl l pm pn"><em class="or"># Install the yum-config-manager and add the repo to install docker<br/></em><strong class="oz iu">sudo</strong> yum install -y yum-utils device-mapper-persistent-data lvm2<br/><strong class="oz iu">sudo</strong> yum-config-manager --add-repo <a class="ae ky" href="https://download.docker.com/linux/centos/docker-ce.repo" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/centos/docker-ce.repo</a><br/> <br/><em class="or"># Configure iptables for Kubernetes<br/></em><strong class="oz iu">cat</strong> &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf<br/>net.bridge.bridge-nf-call-ip6tables = 1<br/>net.bridge.bridge-nf-call-iptables = 1<br/>EOF<br/><strong class="oz iu">sysctl</strong> --system<br/> <br/># Add the kubernetes repo needed to find the kubelet, kubeadm and <strong class="oz iu">kubectl</strong> packages<br/><strong class="oz iu">cat</strong> &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo<br/>[kubernetes]<br/>name=Kubernetes<br/>baseurl=<a class="ae ky" href="https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</a><br/>enabled=1<br/>gpgcheck=1<br/>repo_gpgcheck=1<br/>gpgkey=<a class="ae ky" href="https://packages.cloud.google.com/yum/doc/yum-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/yum/doc/yum-key.gpg</a> <a class="ae ky" href="https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</a><br/>exclude=kube*<br/>EOF<br/> <br/># Set SELinux in permissive mode (effectively disabling it)<br/><strong class="oz iu">setenforce</strong> 0<br/><strong class="oz iu">sed</strong> -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config<br/> <br/># Turn off the swap: Required for Kubernetes to work<br/><strong class="oz iu">sudo</strong> swapoff -a<br/> <br/># Install Kubernetes and Docker<br/><strong class="oz iu">sudo</strong> yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes docker-ce docker-ce-cli containerd.io<br/> <br/># Start Docker<br/><strong class="oz iu">sudo</strong> systemctl enable --now docker<br/> <br/># Start Kubernetes<br/><strong class="oz iu">systemctl</strong> enable --now kubelet</span></pre><h2 id="9805" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">主节点的附加说明</h2><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="7c8c" class="nm mv it oz b gy pk pl l pm pn"><em class="or"># Make sure you are NOT root for these commands! But it must be a sudoer user.</em></span><span id="2c06" class="nm mv it oz b gy po pl l pm pn"><em class="or"># For sanity, just disable the entire firewall until you've figured out exactly what services you'll want to install.<br/></em><strong class="oz iu">systemctl</strong> disable firewalld --now # Disable the firewall</span><span id="6343" class="nm mv it oz b gy po pl l pm pn"><em class="or"># Start kubeadm</em><br/><strong class="oz iu">sudo</strong> kubeadm init --pod-network-cidr=192.168.0.0/16</span><span id="d90e" class="nm mv it oz b gy po pl l pm pn"><em class="or">### NOTE THE OUTPUT: It has the token you need to add workers!!! ###</em></span></pre><p id="a12c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行上面的命令后，在您的输出中，您应该会看到以“kubeadm join”开头的一行。复制这一行—稍后您将需要它来向集群添加节点。</p><h2 id="1262" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">安装Pod网络(Calico)</h2><p id="f588" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">接下来，我们需要在Kubernetes master上安装一个Pod网络。如前所述，我们将使用印花棉布。以下是在您的Kubernetes主机上运行以安装Calico的命令(来自他们的<a class="ae ky" href="https://docs.projectcalico.org/v3.5/getting-started/kubernetes/" rel="noopener ugc nofollow" target="_blank">快速入门</a>):</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="9e14" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> apply -f <a class="ae ky" href="https://docs.projectcalico.org/v3.5/getting-started/kubernetes/installation/hosted/etcd.yaml" rel="noopener ugc nofollow" target="_blank">https://docs.projectcalico.org/v3.5/getting-started/kubernetes/installation/hosted/etcd.yaml</a></span><span id="100e" class="nm mv it oz b gy po pl l pm pn"><strong class="oz iu">kubectl</strong> apply -f <a class="ae ky" href="https://docs.projectcalico.org/v3.5/getting-started/kubernetes/installation/hosted/calico.yaml" rel="noopener ugc nofollow" target="_blank">https://docs.projectcalico.org/v3.5/getting-started/kubernetes/installation/hosted/calico.yaml</a></span></pre><h2 id="fdfc" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">安装Kubernetes仪表板</h2><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="0f57" class="nm mv it oz b gy pk pl l pm pn"><em class="or"># Install the K8s dashboard<br/></em><strong class="oz iu">kubectl</strong> create -f <a class="ae ky" href="https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended/kubernetes-dashboard.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended/kubernetes-dashboard.yaml</a></span><span id="5a29" class="nm mv it oz b gy po pl l pm pn"><em class="or"># Create an admin account called k8s-admin</em><strong class="oz iu"><em class="or"><br/></em>kubectl</strong> --namespace kube-system create serviceaccount k8s-admin<br/><strong class="oz iu">kubectl</strong> create clusterrolebinding k8s-admin --serviceaccount=kube-system:k8s-admin --clusterrole=cluster-admin</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="2900" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">在您的笔记本电脑/工作站上安装kubectl</h1><h2 id="1735" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">马科斯</h2><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="4fad" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">brew</strong> install kubernetes-cli</span></pre><h2 id="eb96" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">人的本质</h2><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="2505" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">sudo</strong> apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https<br/>curl -s <a class="ae ky" href="https://packages.cloud.google.com/apt/doc/apt-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/apt/doc/apt-key.gpg</a> | sudo apt-key add -<br/><strong class="oz iu">echo</strong> "deb <a class="ae ky" href="https://apt.kubernetes.io/" rel="noopener ugc nofollow" target="_blank">https://apt.kubernetes.io/</a> kubernetes-xenial main" | sudo tee -a /etc/apt/sources.list.d/kubernetes.list<br/><strong class="oz iu">sudo</strong> apt-get update<br/><strong class="oz iu">sudo</strong> apt-get install -y kubectl</span></pre><h2 id="be14" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">CentOS</h2><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="d035" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">cat</strong> &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo<br/><em class="or">[kubernetes]<br/>name=Kubernetes<br/>baseurl=</em><a class="ae ky" href="https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64" rel="noopener ugc nofollow" target="_blank"><em class="or">https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</em></a><em class="or"><br/>enabled=1<br/>gpgcheck=1<br/>repo_gpgcheck=1<br/>gpgkey=</em><a class="ae ky" href="https://packages.cloud.google.com/yum/doc/yum-key.gpg" rel="noopener ugc nofollow" target="_blank"><em class="or">https://packages.cloud.google.com/yum/doc/yum-key.gpg</em></a><em class="or"> </em><a class="ae ky" href="https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg" rel="noopener ugc nofollow" target="_blank"><em class="or">https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</em></a><em class="or"><br/>EOF</em><br/><strong class="oz iu">yum</strong> install -y kubectl</span></pre><h2 id="cf6b" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">设置工作站的代理</h2><p id="8a96" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">在你的笔记本电脑上创建一个<code class="fe ow ox oy oz b">~/.kube</code>目录，然后将k8s (Kubernetes)主文件中的<code class="fe ow ox oy oz b">~/.kube/config</code>文件压缩到你的<code class="fe ow ox oy oz b">~/.kube</code>目录中。</p><p id="54d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后获取连接到仪表板所需的身份验证令牌:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="fb67" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> -n kube-system describe secret $(kubectl -n kube-system get secret | grep k8s-admin | awk '{print $1}')</span></pre><p id="8c16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将此令牌存储在安全但容易获取的地方；您将(经常)需要它来访问Kubernetes仪表板。现在启动代理:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="03d6" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> proxy</span></pre><p id="3451" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，转到<br/> <a class="ae ky" href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/" rel="noopener ugc nofollow" target="_blank">打开仪表板:http://localhost:8001/API/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/6d0c62b1bc18c00fee54868daca7559c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Swspv1i85IAx5Cde"/></div></div></figure><p id="7d7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到上面的对话框。选择“令牌”,然后复制粘贴上一步中的令牌并登录。希望这是一次成功！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="b8ec" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">设置您的Minion节点</h1><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="41fe" class="nm mv it oz b gy pk pl l pm pn"><em class="or"># Setup your firewall settings</em><strong class="oz iu"><br/></strong><em class="or">#</em><strong class="oz iu"><em class="or">sudo</em></strong><em class="or"> firewall-cmd --zone=public --add-port=10250/tcp --permanent        # Kubelet API<br/>#</em><strong class="oz iu"><em class="or">sudo</em></strong><em class="or"> firewall-cmd --zone=public --add-port=30000-32767/tcp --permanent  # NodePort Services<br/>#</em><strong class="oz iu"><em class="or">sudo</em></strong><em class="or"> firewall-cmd --reload</em></span><span id="04da" class="nm mv it oz b gy po pl l pm pn"><em class="or"># For sanity, we'll just disable the firewall. Once you know exactly what services you want you can expose desired ports via firewall-cmd.</em><strong class="oz iu"><br/>systemctl</strong> disable firewalld --now   # Disable the firewall<br/> <br/><em class="or"># Now paste the kubeadm join command from the kubeadm init command on master</em><br/><strong class="oz iu">sudo</strong> kubeadm join &lt;master-cluster-ip&gt;:6443 --token &lt;something.token&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;</span></pre><p id="d924" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，init命令的join命令输出会过期。如果您遇到了这种情况，您可以重新生成一个新的join命令，方法是转到您的k8s master并键入以下命令:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="022b" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">sudo</strong> kubeadm token create --print-join-command</span></pre><p id="a7d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对要添加到群集的每个节点重复上述步骤。请注意，join命令对于每个节点都是相同的。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="8332" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">安装舵</h1><p id="5f35" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">Helm就像是Kubernetes的包装经理。它将允许您将一组预打包的Kubernetes对象部署为一个集合，然后您甚至可以轻松地删除名称集合。例如，我们将使用helm来安装StorageOS。要安装helm，只需在您的工作站上运行以下命令:</p><h2 id="bf3d" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">马科斯</h2><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="e98c" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">brew</strong> install kubernetes-helm<br/><strong class="oz iu">helm</strong> init</span></pre><h2 id="ab91" class="nm mv it bd mw nn no dn na np nq dp ne li nr ns ng lm nt nu ni lq nv nw nk nx bi translated">Linux操作系统</h2><p id="8b4f" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">头盔的卡扣包由<a class="ae ky" href="https://github.com/snapcrafters/helm" rel="noopener ugc nofollow" target="_blank">卡扣师</a>维护。</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="932f" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">sudo</strong> snap install helm --classic</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f01c" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">安装存储</h1><p id="d6a8" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">我们将使用头盔安装<code class="fe ow ox oy oz b">storageos</code>。在下面的命令中，用每个节点的<code class="fe ow ox oy oz b">hostnames</code>替换<code class="fe ow ox oy oz b">node1–3</code>:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="0f0d" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">helm</strong> install storageos/storageos --name=storageos --namespace=storageos --set cluster.join="<strong class="oz iu"><em class="or">node1</em></strong>\,<strong class="oz iu"><em class="or">node2</em></strong>\,<strong class="oz iu"><em class="or">node3</em></strong>"<br/>ClusterIP=$(kubectl get svc/storageos --namespace storageos -o custom-columns=IP:spec.clusterIP --no-headers=true)<br/>ApiAddress=$(echo -n "tcp://$ClusterIP:5705" | base64)<br/>kubectl patch secret/storageos-api --namespace storageos --patch "{\"data\": {\"apiAddress\": \"$ApiAddress\"}}"</span></pre><p id="706b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要基于<code class="fe ow ox oy oz b">StorageOS</code>创建一个新的Kubernetes <code class="fe ow ox oy oz b">StorageClass</code>，我们将把它用于我们所有的<code class="fe ow ox oy oz b">PersistentVolume</code>对象。对于这一个，让我们使用Kubernetes仪表板来看看我们如何通过它来部署对象:</p><p id="45fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">启动您的代理:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="c127" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> proxy</span></pre><p id="219e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<a class="ae ky" href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/API/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy</a>。如果您最近没有登录，您将再次看到以下屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/6d0c62b1bc18c00fee54868daca7559c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Swspv1i85IAx5Cde"/></div></div></figure><p id="b9d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再次复制粘贴您之前保存的令牌。如果您丢失了它，只需再次运行以下命令:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="3436" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> -n kube-system describe secret $(kubectl -n kube-system get secret | grep k8s-admin | awk '{print $1}')</span></pre><p id="e95d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录后，按下仪表板右上角的“+ CREATE”按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pq"><img src="../Images/0a42abf53f299684acbe1784274ce49f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kNgu5ryEdXWFOVQlxTQBew.png"/></div></div></figure><p id="58f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在“从文本输入创建”屏幕中，输入以下内容，然后按“上传”按钮:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="31c2" class="nm mv it oz b gy pk pl l pm pn">kind: StorageClass<br/>apiVersion: storage.k8s.io/v1<br/>metadata:<br/>  name: fast<br/>provisioner: kubernetes.io/storageos<br/>parameters:<br/>  pool: default<br/>  description: Kubernetes volume<br/>  fsType: ext4<br/>  adminSecretNamespace: default<br/>  adminSecretName: storageos-secret</span></pre><p id="7125" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，在上面的<code class="fe ow ox oy oz b">StorageClass</code>中，我称之为“快速”,因为我的集群上的存储系统都是固态硬盘。如果对你来说不是这样的，或者如果你有一个组合，最好为每种类型的存储创建一个<code class="fe ow ox oy oz b">StorageClass</code>并适当地命名它。</p><p id="36ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们回到终端，将我们创建的新<code class="fe ow ox oy oz b">StorageClass</code>作为默认终端，这样需要存储类的后续部署就不必明确知道它:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="2c58" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> patch storageclass fast -p '{"metadata":{"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'</span></pre><p id="544d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就完成了<code class="fe ow ox oy oz b">StorageOS</code>的安装。还有一个<code class="fe ow ox oy oz b">StorageOS</code>仪表板，您可以通过运行以下命令来访问它:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="3fdb" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> --namespace storageos port-forward svc/storageos 5705</span></pre><p id="5282" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在只需访问<a class="ae ky" href="http://localhost:5705/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5705 </a>。默认用户名和密码应为“storageos/storageos”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/2b2246da7a36f210a506d179c6b7e55f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gRR3l-Ebo5VH2X4g"/></div></div></figure><p id="8fd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！我们的集群现在可以使用了。接下来，我们将在新集群上部署一个监控解决方案。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f0da" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">设置集群监控</h1><p id="b58f" class="pw-post-body-paragraph kz la it lb b lc ny ju le lf nz jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">现在我们已经有了一个Kubernetes集群，我们需要一个好的监控系统。在本指南中，我们将使用Prometheus来收集所有指标，并使用Grafana来可视化它们。有一个名为<a class="ae ky" href="https://github.com/coreos/prometheus-operator/tree/master/contrib/kube-prometheus" rel="noopener ugc nofollow" target="_blank"> prometheus-operator </a>的伟大项目，它不仅为我们提供Grafana和prometheus，还为我们提供预先构建的仪表盘。首先克隆回购:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="1e88" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">git</strong> clone <a class="ae ky" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:coreos/prometheus-operator.git<br/><strong class="oz iu">cd</strong> prometheus-operator/contrib/kube-prometheus</span></pre><p id="8ec6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，我发现我不得不稍微调整一下，以便保留我在Grafana中所做的任何更改的状态，比如添加用户或安装自定义插件。因此，在开始之前，我将为Grafana创建一个PVC(持久卷声明)。将以下内容应用到您的集群(通过yaml文件或通过复制粘贴到Kubernetes，如前所示):</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="8a94" class="nm mv it oz b gy pk pl l pm pn">kind: PersistentVolumeClaim<br/>apiVersion: v1<br/>metadata:<br/>  name: grafana-pvc<br/>spec:<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  volumeMode: Filesystem<br/>  resources:<br/>    requests:<br/>      storage: 10Gi</span></pre><p id="fbbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要将下面的<code class="fe ow ox oy oz b">initContainer</code>添加到grafana部署的spec部分(位于contrib/kube-Prometheus/manifests/grafana-deployment . YAML):</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="11c9" class="nm mv it oz b gy pk pl l pm pn">initContainers:<br/>  - name: "init-chown-data"<br/>    image: "busybox:1.30.0"<br/>    command: [<br/>      "chown",<br/>      "-R",<br/>      "472:472",<br/>      "/var/lib/grafana"<br/>    ]<br/>    resources:<br/>    volumeMounts:<br/>      - name: "grafana-storage"<br/>        mountPath: /var/lib/grafana</span></pre><p id="917f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在同一个文件的<code class="fe ow ox oy oz b">volumes:</code>部分，对于<code class="fe ow ox oy oz b">grafana-storage</code>它被定义为<code class="fe ow ox oy oz b">emptyDir: {}</code>。我们需要将它改为指向我们创建的<code class="fe ow ox oy oz b">grafana-pvc</code>:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="784d" class="nm mv it oz b gy pk pl l pm pn">volumes:<br/>- persistentVolumeClaim:<br/>    claimName: grafana-pvc<br/>  name: grafana-storage</span></pre><p id="bf5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还必须删除那个<code class="fe ow ox oy oz b">grafana-deployment.yaml</code>文件的<code class="fe ow ox oy oz b">securityContext</code>部分。</p><p id="7eee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！现在，只需使用以下命令将其全部应用到Kubernetes中:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="b972" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> create -f manifests/<br/><strong class="oz iu">sleep</strong> 30<br/><strong class="oz iu">kubectl</strong> create -f manifests/<br/><strong class="oz iu">kubectl</strong> apply -f manifests/<br/><strong class="oz iu">sleep</strong> 30<br/><strong class="oz iu">kubectl</strong> apply -f manifests/<br/><strong class="oz iu">kubectl</strong> --namespace monitoring port-forward svc/prometheus-k8s 9090 &amp;<br/><strong class="oz iu">kubectl</strong> --namespace monitoring port-forward svc/grafana 3000 &amp;<br/><strong class="oz iu">kubectl</strong> --namespace monitoring port-forward svc/alertmanager-main 9093 &amp;</span></pre><p id="a7dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面那个脚本中的休眠是因为，根据它的文档，它说<a class="ae ky" href="https://github.com/coreos/prometheus-operator/tree/master/contrib/kube-prometheus#quickstart" rel="noopener ugc nofollow" target="_blank"><em class="or">这个命令有时可能需要执行两次(以解决竞争情况)</em></a>。</p><p id="6535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要访问prometheus仪表板，请访问<a class="ae ky" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank"> http://localhost:9090 </a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/cb66d2cd03bc79e138a09f30606dfb87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I5mypZPDJvdQ7Rh-"/></div></div></figure><p id="6776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要访问alertmanager仪表板，请访问<a class="ae ky" href="http://localhost:9093/" rel="noopener ugc nofollow" target="_blank"> http://localhost:9093 </a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/bd6bf08154c45d9febc9e59f85a948ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PPuW64IJ19Wx_kZd"/></div></div></figure><p id="08ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，也是最重要的，要访问Grafana，请访问。默认用户名和密码应该是“admin/admin”。</p><p id="ebac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Grafana中，单击一个预先构建的仪表板，例如名为“Kubernetes/Compute Resources/Cluster”的仪表板:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/d6889df53133c375748708ee0e6b6cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6BbR2GSboNgKT9wg"/></div></div></figure><p id="27d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Grafana确实很漂亮，但更酷的是它有如此多的预建插件和仪表盘。一些插件的安装需要你去Grafana机器并把它们安装在插件文件夹中(由于我们通过<code class="fe ow ox oy oz b">StorageOS</code>为Grafana创建的持久卷，我们现在可以做到这一点)。为此，您首先必须通过Kubernetes仪表板或运行以下程序找出Grafana pod的名称:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="2da1" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> --namespace monitoring get pods</span></pre><p id="9ed0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后运行以下命令:</p><pre class="kj kk kl km gt pg oz ph pi aw pj bi"><span id="7d17" class="nm mv it oz b gy pk pl l pm pn"><strong class="oz iu">kubectl</strong> exec --namespace monitoring -t &lt;pod_name&gt; grafana-cli plugins install &lt;plugin_name&gt;</span></pre><p id="659d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>