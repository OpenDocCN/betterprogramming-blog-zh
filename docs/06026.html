<html>
<head>
<title>Build a Continuous Changelog With AWS and Jira</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用AWS和吉拉构建一个连续的变更日志</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-continuous-changelog-with-aws-and-jira-cbf0f10776bb?source=collection_archive---------10-----------------------#2020-08-26">https://betterprogramming.pub/build-a-continuous-changelog-with-aws-and-jira-cbf0f10776bb?source=collection_archive---------10-----------------------#2020-08-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5e9f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">您如何使用CI/CD管理您的发行说明？当然是用自动变更日志！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/158aafa3540ec1bc98427947cd45875d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TC-OarH04WvMMGPe8-dA9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="b461" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以你决定去CI/CD。你阅读了<a class="ae lu" href="https://medium.com/better-programming/are-you-really-ready-for-ci-cd-9a8bf6d01b8a" rel="noopener">关于组织变革的所有内容</a>，了解了开发流程的来龙去脉，并对自己能完成这件事充满信心。</p><p id="1c9f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">恭喜你！</p><p id="7afc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在您设置好管道、记录您的开发实践并开始推进生产之后，仍然有一个主要的难题需要解决:变更日志。</p><p id="7b08" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你是怎么做到的？你会给你的开发团队增加一个每天能跟上5、10、20次生产的技术作家吗？你可以。但是如果有一种自动化的方法呢？</p><p id="3e73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您已经有了一个问题跟踪系统。我们在我的办公室使用吉拉。无论你是使用<a class="ae lu" href="https://www.atlassian.com/software/jira" rel="noopener ugc nofollow" target="_blank">吉拉</a>、<a class="ae lu" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>还是<a class="ae lu" href="https://trello.com/" rel="noopener ugc nofollow" target="_blank">特雷罗</a>来跟踪问题，它们都有一个共同点:webhooks。</p><p id="0722" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当系统中发生某些动作时，这些系统中的每一个都会触发事件。我们将使用它们来自动化我们的变更日志。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8e4b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">建筑</h1><p id="3cff" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">连续变更日志有三种系统:</p><ul class=""><li id="7c52" class="mz na it la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">问题跟踪系统(在本演练中，吉拉)</li><li id="d1c0" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">用于收集、存储和检索变更日志的后端API(内置于AWS中)</li><li id="07c4" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">用户界面</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ff5a2f6a8b36d6a4cdef172fb238fc86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/0*vg6lykB64ZU7fW9z.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="9f14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们的自动化中，事件是这样流动的:</p><ol class=""><li id="c399" class="mz na it la b lb lc le lf lh nb ll nc lp nd lt no nf ng nh bi translated">开发团队将吉拉问题转移到<em class="np">完成</em>状态。吉拉发布到一个包含已关闭问题详细信息的webhook。</li><li id="4390" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt no nf ng nh bi translated"><a class="ae lu" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> AWS API网关</a>直接代理<a class="ae lu" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> DynamoDB </a>来存储细节。</li><li id="6137" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt no nf ng nh bi translated">最终用户加载变更日志页面。该页面请求加载最近的更改。</li><li id="2977" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt no nf ng nh bi translated">AWS API Gateway直接代理DynamoDB从数据库加载详细信息，并在响应中返回它们。</li></ol><p id="3173" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看似简单？确实是！</p><p id="f0aa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从长远来看，这种整合会带来1000倍的回报。这是一个低成本的实施与高回报的价值整合。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e486" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">AWS配置</h1><p id="32bf" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在<a class="ae lu" href="https://github.com/allenheltondev/cicd-changelog" rel="noopener ugc nofollow" target="_blank"> my GitHub repo </a>中，我从上面的架构图中提供了部署微服务的源代码。它使用AWS API Gateway和DynamoDB作为存储和检索数据的两个主要服务。</p><p id="d40c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">后端只有两个端点:一个用来在changelog中创建项目，另一个用来从中加载项目。</p><p id="c300" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">保存和加载在<a class="ae lu" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html" rel="noopener ugc nofollow" target="_blank"> VTL </a>完成，完全省略了对lambda函数的需求。这给了我们最快的响应时间。</p><p id="e55f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我们不希望恶意用户发现我们的API，并在我们的changelog中发布虚假或不适当的更改，所以我们需要添加一个API密钥。我们不能添加标准身份验证来验证我们的用户，因为这些请求将通过webhook发出。</p><p id="1e99" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">吉拉提供了在发布到webhook时包含头的能力，所以我们将利用这一点并包含一个AWS API键。这个键包含在存储库中的CloudFormation脚本中。</p><p id="7e8a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您按照GitHub repo中的自述文件进行操作，您将不费吹灰之力就可以开始运行。它是预先设置好的，所以除了部署到您的AWS帐户之外，不需要任何设置。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9317" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">吉拉构型</h1><p id="6e31" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在我们已经启动并运行了API，是时候配置吉拉来提供changelog数据了。</p><h2 id="d3e0" class="nq md it bd me nr ns dn mi nt nu dp mm lh nv nw mo ll nx ny mq lp nz oa ms ob bi translated">添加自定义字段</h2><p id="5ec8" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们需要添加一个自定义字段到我们的吉拉问题。在吉拉中，导航至设置&gt;吉拉管理&gt;问题。</p><p id="c84e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">查看问题管理页面后，导航至字段&gt;自定义字段&gt;添加自定义字段。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/c4af3685dc523e1805ae77bfad31a351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7gsD1LBeW3cNoUqD.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">吉拉可用的自定义字段类型。</p></figure><p id="6201" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Changelog描述可能有点冗长，所以选择一个文本字段(多行)，将其命名为<code class="fe od oe of og b">Changelog</code>，并添加一个描述，让用户知道他们应该在更改细节中键入的格式。</p><p id="13ef" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，选择您希望changelog字段可见的屏幕。如果你想在你所有的吉拉项目中使用它，选择它们！</p><h2 id="7e52" class="nq md it bd me nr ns dn mi nt nu dp mm lh nv nw mo ll nx ny mq lp nz oa ms ob bi translated">构建webhook</h2><p id="1e98" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">定制字段就绪后，就该构建向webhook发送的自动化触发器了。</p><p id="e168" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在您的吉拉项目中，进入项目设置&gt;项目自动化&gt;创建规则。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/a67de2c7056f21926c50d5e1c124a9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/0*LP5Lf11HVSQiR30j.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可用的触发器类型。</p></figure><p id="f666" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下一个屏幕上，选择<em class="np">问题转换为</em>触发类型，并可选地将<em class="np">从状态</em>和<em class="np">设置为状态</em>。</p><p id="0bc5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:<em class="np">至状态</em>字段应设置为您工作流程中的最终状态。在我的项目中，我们最终的工作流状态是<em class="np">完成</em>。</p><p id="1f98" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦配置好触发器，就该为吉拉设置要采取的动作了。点击<em class="np">新动作</em>调出选项列表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/ccd4c8cb054d9be827ba57241d3df258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/0*Yr5WHk0xWdntd7t7.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可用的通知操作类型。</p></figure><p id="6ea3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">选择<em class="np">发送web请求</em>动作，调出配置屏幕。</p><h2 id="3c08" class="nq md it bd me nr ns dn mi nt nu dp mm lh nv nw mo ll nx ny mq lp nz oa ms ob bi translated">从AWS获取API详细信息</h2><p id="639d" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在我们需要回到AWS控制台。首先，我们需要获得我们创建的webhook的URL。</p><ol class=""><li id="d6d8" class="mz na it la b lb lc le lf lh nb ll nc lp nd lt no nf ng nh bi translated">导航到<a class="ae lu" href="https://console.aws.amazon.com/apigateway/main/apis" rel="noopener ugc nofollow" target="_blank"> API网关控制台</a>并选择Changelog API。</li><li id="990e" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt no nf ng nh bi translated">点击左侧导航栏上的<em class="np">阶段</em>链接，然后点击<em class="np">开发</em>阶段。</li><li id="7215" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt no nf ng nh bi translated">页面顶部会有一个调用URL。获取该值并将其添加到吉拉的Webhook URL字段中。一定要在末尾加上<code class="fe od oe of og b">/details</code>。</li><li id="4204" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt no nf ng nh bi translated">接下来，单击左侧导航栏上的API Keys链接，然后单击<em class="np"> cicd-ApiKey… </em>值。</li><li id="7de7" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt no nf ng nh bi translated">点击<em class="np">显示</em>链接，复制屏幕上显示的数值。</li><li id="2aea" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt no nf ng nh bi translated">回到吉拉，添加一个标题<code class="fe od oe of og b">x-api-key</code>并将API键粘贴到value字段中。</li><li id="392d" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt no nf ng nh bi translated">接下来，配置webhook主体以匹配下图，并点击<em class="np">保存</em>。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/0d8fd4aa98e4d5733d177a6194a67274.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X3dmrDVqdqHNRskU.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在吉拉完成webhook配置。</p></figure><p id="fd39" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下一个屏幕上给你的自动化起一个有意义的名字，点击<em class="np">打开</em>按钮，完成你的集成！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3d76" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">查看您的新变更日志</h1><p id="962e" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">此时，集成和API已经连接，您可以开始关闭问题了！它会自动添加变更日志详细信息以及问题类型和完成日期。</p><p id="5af1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦你有一些问题转移了，让我们看看它是什么样子的。我已经在GitHub repo 中提供了一个框架角度前端，所以你可以马上查看变更日志。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/f5decc41ab1c09428031c50b26d60b45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/0*fkIKELKjKpKgxt7C.png"/></div></figure><p id="16f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">变更日志按天分组，并在基于已关闭的吉拉类型的详细信息旁边有一个图标。对于我的项目，一个<em class="np">新特性</em>吉拉类型将显示<em class="np">新</em>图标，而一个<em class="np"> Bug </em>问题类型显示一个Bug图标。</p><p id="9c24" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些可以根据您的项目进行定制，所以您可以随意使用图标和问题类型。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bdb0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">获得贵组织的支持</h1><p id="d7ca" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我可以在这里打断你，但如果我不谈论这需要的组织治理，我会是什么样的负责任的作家呢？</p><p id="5cca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">遵循这一路线会留下一些问题，您需要由您的组织回答:</p><ul class=""><li id="d4cc" class="mz na it la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">谁写变更日志的细节？科技作家？开发商？</li><li id="b7be" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">关闭问题前是否需要查看变更日志详细信息？</li><li id="850b" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">你能信任开发人员编写面向客户的笔记吗？</li><li id="82b0" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">您希望在变更日志中包含哪些问题类型？</li><li id="d77b" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">你应该以不同的方式显示主要特征吗？</li></ul><p id="cf9a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些是你和你的组织要解决的问题。当然，让开发人员添加细节并完成它是最容易的，但是这是最安全的吗？您希望记录所有更改以供公众查看吗？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d9c2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">试试看！</h1><p id="e2f5" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">这是一个快速的集成设置，并导致一些非常有趣的结果。我希望你尝试一下，给你的项目带来一个连续的变更日志。</p><p id="2b66" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你做这样的事情吗？你会做一些完全不同的事情吗？让我知道你的想法和意见！</p><p id="3f32" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读！</p></div></div>    
</body>
</html>