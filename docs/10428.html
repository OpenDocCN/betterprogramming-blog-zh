<html>
<head>
<title>How To Troubleshoot Slow Linux Servers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何解决Linux服务器运行缓慢的问题</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-troubleshoot-slow-linux-servers-20a4e2843131?source=collection_archive---------5-----------------------#2022-01-06">https://betterprogramming.pub/how-to-troubleshoot-slow-linux-servers-20a4e2843131?source=collection_archive---------5-----------------------#2022-01-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0251" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">快速查明膨胀的资源猪</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/956a86dc485f94e84488cf3ee7253e59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sMr8POFhCJYY7NhrO0e3_w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@pkernstock?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Patrik Kernstock </a>在<a class="ae ky" href="https://unsplash.com/s/photos/servers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="2af2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请求时间太长了。等待时间正在迅速增加。警报被一遍又一遍地发送。它正在发生…</p><p id="db72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的一台Linux机器正在缓慢而痛苦地死去。</p><p id="b651" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们都经历过。这是一个令人伤脑筋的情况。</p><p id="bd57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">诊断缓慢的Linux服务器可能是一个棘手的过程。如果您正在运行大量的生产服务，潜在的问题领域会越来越大。是CPU吗？记忆？磁盘I/O？</p><p id="a4e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看看您可以用来了解落后主机的工具库。找到那些贪婪的资源猪，恢复你的服务器领地的和平与繁荣。</p><h1 id="f5e3" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">使用atop时的CPU使用情况</h1><p id="89fc" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">想尽可能地了解您的系统随时间推移的使用情况吗？想要将所有数据都塞进一个大窗口中吗？<code class="fe mt mu mv mw b">atop</code>计划是为你准备的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/d16fc60c03a46c5a5bceb390742251ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-LAJJqZcUXx1UB01GAMlA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用在覆盆子酱上。Swap不开心。</p></figure><p id="f7a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用atop的众多好处之一是它可以记录主机随时间的性能。默认情况下，它会向您显示10秒钟的使用情况，您可以在时间上向前或向后移动，以查看哪里出现了峰值。这有助于您深入了解瞬态使用情况，这种情况有时会避开常规监控。</p><p id="4b20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，atop将历史数据存储在<code class="fe mt mu mv mw b">/var/log/atop</code>中，因此您可以通过执行以下命令来查看每日快照:</p><pre class="kj kk kl km gt my mw mz na aw nb bi"><span id="07b0" class="nc lx it mw b gy nd ne l nf ng">atop -r /var/log/atop/atop_&lt;timestamp&gt;</span></pre><p id="d041" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你到了<code class="fe mt mu mv mw b">atop</code>，你可以分别使用<code class="fe mt mu mv mw b">t</code>和<code class="fe mt mu mv mw b">T</code>在时间上向前或向后移动。</p><p id="85a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你觉得默认情况下显示器上的所有数据有点拥挤，试着通过<code class="fe mt mu mv mw b">-l</code>标志来限制信息量。</p><p id="df89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用atop是一回事，理解它完全是另一回事。一如既往，查看<a class="ae ky" href="https://linux.die.net/man/1/atop" rel="noopener ugc nofollow" target="_blank">手册</a>了解更多信息。</p><h1 id="d7c5" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">免费时的基本内存使用</h1><p id="e5e2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">记忆问题往往是相当老生常谈的。通常情况下，如果你有一个消耗大量内存的进程，你的机器会很快降级，直到它完全耗尽(如果没有设置限制)。如果发生这种情况，您可能根本无法登录到机器，并可能被迫重新启动它。</p><p id="f292" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您设法在主机耗尽内存之前获得了访问权限，请通过执行以下命令快速查看发生了什么:</p><pre class="kj kk kl km gt my mw mz na aw nb bi"><span id="d6b6" class="nc lx it mw b gy nd ne l nf ng">free -h</span></pre><p id="37ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这应该显示整体内存使用情况，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/9f181b73b1e487399b3dd656aa4ebde0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NNJO71icar7hIlV8a2PkzQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用free显示内存使用情况。</p></figure><p id="73ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您需要查看一段时间内和各个进程的内存使用情况，atop仍然是一个可靠的选择。您可以使用以下命令在atop中查看内存统计信息:</p><pre class="kj kk kl km gt my mw mz na aw nb bi"><span id="a4d8" class="nc lx it mw b gy nd ne l nf ng">atop -m</span></pre><h1 id="92ae" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">ncdu的磁盘使用可视化</h1><p id="56d3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">可怕的磁盘空间问题。通常情况下，您会为磁盘使用率的上升设置警报，并在它变得危险之前发现它，但有时事情会被忽略。日志不会旋转，临时目录会膨胀。当你正在努力确定是什么占据了你所有的空间时，可视化工具可能会有所帮助。</p><p id="038a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Ncurses Disk Usage(或<a class="ae ky" href="https://linux.die.net/man/1/ncdu" rel="noopener ugc nofollow" target="_blank"> ncdu </a>)实用程序在寻找臃肿的路径时是一个令人头疼的问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/f2ca3aa85c64ca608aa25a378664bb2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hwdns9NUrTRtWbEddD3f1Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示文件、目录和总体使用情况的ncdu示例。</p></figure><p id="e970" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个方便的小工具将分析你的文件和目录，然后显示一个用户友好的窗口，突出所有的重量级人物。</p><p id="9ae1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦进入该实用程序，您就可以深入到任何大型目录，以了解是什么在占用磁盘空间。使用箭头键上下移动，并按enter键切换到该目录。</p><p id="9819" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你甚至可以在任何选择上点击<code class="fe mt mu mv mw b">d</code>键，直接从<code class="fe mt mu mv mw b">ncdu</code>控制台删除文件(小心！).</p><h1 id="9daa" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">iotop的I/O指标</h1><p id="4800" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">I/O是一个经常被忽视的性能瓶颈。有时我们会专注于CPU、内存或磁盘使用情况，而实际上是磁盘<em class="lv">吞吐量</em>受到了冲击。虽然您可以使用非常灵活的atop查看I/O统计数据，但我喜欢利用一个不同的实用程序，名为<code class="fe mt mu mv mw b"><a class="ae ky" href="https://linux.die.net/man/1/iotop" rel="noopener ugc nofollow" target="_blank">iotop</a></code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/287ba9c1a75dcd27768abfe199b0504f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yU9aNxhAwooVRksik7X9cw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用iotop的磁盘I/O。</p></figure><p id="6f88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe mt mu mv mw b">iotop</code>,您可以获得一个简单、清晰的磁盘I/O图片，没有任何花哨的东西。这可能是所有需要赶上什么是通过你的宝贝IOPS咀嚼了。执行以下命令，仅查看使用磁盘I/O的顶级进程:</p><pre class="kj kk kl km gt my mw mz na aw nb bi"><span id="9778" class="nc lx it mw b gy nd ne l nf ng">sudo iotop -o</span></pre><h1 id="9b25" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">网络使用与网络猪</h1><p id="ebfe" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">经过一些令人厌烦的故障排除后，您可能会发现这个问题甚至与耗尽的主机资源无关。如果您正在调查处理大量网络流量的应用服务器或主机，您可能会遇到饱和、带宽限制或更糟的情况:恶意活动。</p><p id="9c18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看进程网络使用情况的最简单方法之一是使用<a class="ae ky" href="https://github.com/raboof/nethogs" rel="noopener ugc nofollow" target="_blank"> NetHogs </a>实用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/bb397d6a95419c2669ab978059103973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TydBrv1J8NhYWcXJx7vq9g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示进程及其网络使用情况的NetHogs。</p></figure><p id="06f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你运行NetHogs时，它会给你一个发送或接收网络流量的所有进程的细目分类。您可以看到哪个应用程序正在建立连接，甚至可以看到它所连接的主机。</p><p id="20ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NetHogs不仅可以方便地排除失控网络进程的故障，还可以保证安全性。使用该实用程序，您可以快速了解您的机器正在建立的连接以及它们使用了多少数据。例如，看到某些SSH会话传输大量数据可能是可疑的。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="3b07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！如果你喜欢这篇文章，看看我的另一篇文章:</p><ul class=""><li id="b555" class="ns nt it lb b lc ld lf lg li nu lm nv lq nw lu nx ny nz oa bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/5-basic-linux-disk-management-commands-you-should-know-ee47c49ce6e6"> <em class="lv">你应该知道的5个基本Linux磁盘管理命令</em> </a></li></ul></div></div>    
</body>
</html>