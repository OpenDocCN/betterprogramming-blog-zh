<html>
<head>
<title>How To Reduce Angular Deployment Times by Disabling Differential Loading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何通过禁用差动加载来减少角度展开时间</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-reduce-angular-deployment-times-by-disabling-differential-loading-9215e2702bfb?source=collection_archive---------4-----------------------#2021-03-10">https://betterprogramming.pub/how-to-reduce-angular-deployment-times-by-disabling-differential-loading-9215e2702bfb?source=collection_archive---------4-----------------------#2021-03-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0474" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">部署Angular应用程序时避免不必要的工作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fbfd0873683050669eb80aac5da2c602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kvkDmgg7tTSWHHRM"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@tvick?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">泰勒维克</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="a509" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，软件的运输比过去更频繁了。无论是大公司还是小公司都已经意识到持续部署会带来很多好处，比如更快的反馈循环。多亏了像Netlify这样的平台，web应用可以通过一个全球CDN来运输和服务，而不需要太多的配置。</p><p id="4ecd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">妨碍持续部署的一个因素是长时间的部署。部署需要很长时间的原因有很多:</p><ul class=""><li id="398a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">如果部署过程中涉及大量手动步骤，部署可能会很麻烦。</li><li id="d986" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">部署管道中的不稳定性(例如不稳定的端到端测试)会导致部署失败或严重延迟。</li><li id="f678" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">部署通常涉及需要预先完成的多个步骤(例如，生产就绪构建、运行所有测试、部署到生产前，以及最终到生产)。</li></ul><p id="b049" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把重点放在后一点上。由于有了Angular CLI，Angular应用程序很容易部署。一个简单的命令(<code class="fe mj mk ml mm b"><a class="ae ky" href="https://angular.io/cli/build" rel="noopener ugc nofollow" target="_blank">ng build --prod</a></code>)运行我们的Angular应用程序的完整构建。我们可以将生成的文件上传到托管平台/CDN，或者使用<code class="fe mj mk ml mm b"><a class="ae ky" href="https://angular.io/cli/deploy" rel="noopener ugc nofollow" target="_blank">ng deploy</a></code>通过一个命令来部署我们的文件。</p><p id="943a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于现有的Angular应用程序，我们决定完全忽略对IE11等传统浏览器的支持。想法很简单:构建的代码越少，构建Angular应用程序所需的时间就越少。默认情况下，Angular使用一种叫做<a class="ae ky" href="https://angular.io/guide/deployment#differential-loading" rel="noopener ugc nofollow" target="_blank">差分加载</a>的策略。通过差异加载，我们可以实现高度的浏览器兼容性。</p><p id="793f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过，这种方法也有缺点。因为我们基本上构建每个包两次(一次用于现代浏览器，一次用于遗留浏览器)，这对应用程序的构建时间有明显的影响。此外，我们在CI平台(GitLab CI或GitHub Actions)上浪费了宝贵的管道时间。</p><p id="ed5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能只需要支持相当现代的浏览器(如果您需要支持IE11这样的浏览器，请查看我的文章<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-fix-your-angular-app-when-its-not-working-in-ie11-eb24cb6d9920">关于在Angular应用程序中修复常见的IE11问题</a>)。在这种情况下，我们可以通过加快构建过程从而减少部署时间来节省宝贵的时间。</p><p id="495f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何在Angular项目中禁用差异加载，以加快构建和部署。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="c8aa" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">如何在角度应用中禁用差分加载</h1><ul class=""><li id="d1e7" class="lv lw it lb b lc nm lf nn li no lm np lq nq lu ma mb mc md bi translated">调整<code class="fe mj mk ml mm b">browserslist</code>以仅考虑我们实际想要支持的web浏览器。</li><li id="9677" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">确保我们已经在<code class="fe mj mk ml mm b">tsconfig.json</code>中将<code class="fe mj mk ml mm b">"target": "es2015"</code>指定为目标。</li></ul><p id="e37c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，禁用差异加载只涉及几个步骤。让我们看一下代码。首先，我们调整<code class="fe mj mk ml mm b">browserslist</code>文件，如果您使用Angular CLI创建项目，您应该已经有了这个文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="de22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe mj mk ml mm b">npx browserslist</code>将创建以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/1291df089eb66aa7177e68eaea0c4a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wATZmptgazJMkSLOhEgcQ.png"/></div></div></figure><p id="9310" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有IE11，没有Opera Mini，没有传统的微软Edge。看起来我们只是针对现代浏览器，正如我们所希望的那样。您可以随意改变这些值，并根据自己的需要进行调整。</p><p id="d037" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将<code class="fe mj mk ml mm b">tsconfig.json</code>调整为只针对现代浏览器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="3c84" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">禁用差异加载会有什么不同？</h1><p id="1cd4" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">我们来看看上面的改动效果。首先，我们来看看现状。完整的AOT构建在GitLab CI中花费了大约5.8分钟，在Netlify中花费了大约4.4分钟。您可以在构建日志中看到生成了ES2015和ES5捆绑包:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/36f14621ee4d85ad3445295621ba4b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NBuhoYG3cyoqCo1h2l_zmw.png"/></div></div></figure><p id="b42d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将看看我们的更改如何影响构建和部署时间。完整的AOT构建现在在GitLab CI中只需要大约3.5分钟，在Netlify中只需要大约2.5分钟。您可以在构建日志中看到，没有生成ES5包:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/aed5d4ed29426e2b281fa2cfc9525274.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8Xv-u11ydTcQP33cwTFSg.png"/></div></div></figure><p id="8e23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以进一步验证<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/check-your-javascript-bundles-for-browser-support-d769c1fca4c">您的代码是否针对支持ES2015 </a>的浏览器。我们可以利用es-check这样的库来检查生成的JavaScript包:</p><pre class="kj kk kl km gt nz mm oa ob aw oc bi"><span id="3667" class="od mv it mm b gy oe of l og oh"># should succeed<br/>npx es-check es2015 ./your-dist-folder/*.js --verbose<br/># should fail<br/>npx es-check es5 ./your-dist-folder/*.js --verbose</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="9e2c" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">结论</h1><p id="45a3" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">感谢您阅读这篇关于通过禁用差异加载来加速角度部署的短文。在我的例子中，我的Angular应用程序的部署时间有了显著的改进。只要不需要支持遗留浏览器，这就是加速Angular应用程序构建和部署的一种方式。</p><p id="65e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你还知道其他加快Angular应用程序部署的技巧吗？请在评论中告诉我。</p></div></div>    
</body>
</html>