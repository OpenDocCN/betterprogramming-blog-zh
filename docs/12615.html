<html>
<head>
<title>How I Made My Productivity App Open Faster by Adding It to the System Tray</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何通过将我的生产力应用程序添加到系统托盘中来让它更快地打开</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-made-my-productivity-app-open-faster-by-adding-it-to-the-system-tray-d1d61066534e?source=collection_archive---------10-----------------------#2022-06-16">https://betterprogramming.pub/how-i-made-my-productivity-app-open-faster-by-adding-it-to-the-system-tray-d1d61066534e?source=collection_archive---------10-----------------------#2022-06-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bda7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">调试我的焦点工具的简要指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f2cc67962bde8fafecfb24f4c95a514e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8iZ8PM7ub9CtwJD485w6Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@austindistel" rel="noopener ugc nofollow" target="_blank">奥斯汀·迪斯特尔</a>在<a class="ae kv" href="https://unsplash.com/s/photos/guide?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6805" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上一篇文章的<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/how-i-created-the-focus-app-using-react-and-rust-fd8fd072d1a7">中，我分享了我是如何开始开发一个名为<code class="fe ls lt lu lv b">focus</code>的小型生产力工具的。</a></p><p id="bbfd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个工具的想法很简单:</p><ul class=""><li id="71c4" class="lw lx iq ky b kz la lc ld lf ly lj lz ln ma lr mb mc md me bi translated">我在电脑的任何地方点击键盘快捷键。</li><li id="db7f" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">屏幕中央会弹出一个包含文本输入的窗口。</li><li id="2231" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">当我点击<code class="fe ls lt lu lv b">Enter</code>时，我输入一些我想以后记住的想法/任务。</li><li id="b082" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">弹出窗口消失。</li><li id="8b05" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">我输入的所有想法都被添加到一个文本文件中。该文件的路径由环境变量<code class="fe ls lt lu lv b">FOCUS_TASKS_PATH</code>设置。</li></ul><p id="8650" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我有一个工作版本，但有一个问题:当我点击键盘快捷键时，弹出窗口需要大约两秒钟才能打开并正确呈现。让它更快地“冒出来”。</p><h1 id="6b01" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">为什么慢？只是文字输入吧？</h1><p id="c875" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">根据我对<a class="ae kv" href="https://tauri.studio/v1/guides/architecture/process-model" rel="noopener ugc nofollow" target="_blank"> Tauri的流程模型</a>的理解，当我点击快捷方式时，会发生以下情况:</p><ul class=""><li id="bc2f" class="lw lx iq ky b kz la lc ld lf ly lj lz ln ma lr mb mc md me bi translated">创建了一个核心流程。这是运行Rust代码的进程。</li><li id="82a6" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">一个<code class="fe ls lt lu lv b">webview</code>进程由核心进程创建。这是运行前端代码的那个。</li></ul><p id="a6ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以把<code class="fe ls lt lu lv b">webview</code>想象成一个迷你浏览器，它拥有显示网页和处理交互所需的一切(解析HTML、应用CSS、执行JavaScript等等)。).此外，它还可以与核心进程通信来运行Rust代码。</p><p id="8e30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这解释了为什么启动它需要时间(就像打开Chrome或VSCode需要时间一样)。</p><h1 id="c115" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">怎么让它开的更快？</h1><p id="d8ac" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">我的想法是打开应用程序一次，让它在后台运行，这样当快捷方式被点击时，我们只显示窗口，这应该比从头开始创建它更快。一种方法是将应用程序添加到系统托盘(任务栏上有小图标的部分。你知道你关闭一个应用程序，但仍然发现它的图标告诉你“我还活着！”).</p><h1 id="1163" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">将应用程序添加到系统托盘</h1><p id="48c1" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">通过遵循<a class="ae kv" href="https://tauri.studio/v1/guides/features/system-tray" rel="noopener ugc nofollow" target="_blank">文档</a>，首先，我们需要使用<code class="fe ls lt lu lv b">tauri.conf.json</code>文件在系统托盘上指定我们的应用程序的图标，让我们使用已经存在的Tauri图标(我可能需要为这个应用程序设计一个自定义图标，但现在不是优先事项)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="65de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我修改了<code class="fe ls lt lu lv b">Cargo.toml</code>文件的依赖部分，以包含我的Linux发行版所需要的特性<code class="fe ls lt lu lv b">gtk-tray</code>。</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="48a8" class="nn ml iq lv b gy no np l nq nr">tauri = { version = "1.0.0-rc.11", features = ["api-all", "gtk-tray", "system-tray"] }</span></pre><p id="bc2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们需要编辑<code class="fe ls lt lu lv b">main.rs</code>文件来创建系统托盘，并指定附加到它的菜单项。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="c81d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">make_tray</code>功能创建系统托盘，其菜单包含两个项目:<code class="fe ls lt lu lv b">Hide</code>和<code class="fe ls lt lu lv b">Quit</code>。</p><ul class=""><li id="c8cc" class="lw lx iq ky b kz la lc ld lf ly lj lz ln ma lr mb mc md me bi translated">最初，显示应用程序窗口；我希望能够通过点击<code class="fe ls lt lu lv b">Hide</code>菜单项来隐藏它。然后它的文本应该变成<code class="fe ls lt lu lv b">Show</code>，点击它应该再次显示窗口。</li><li id="c77b" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr mb mc md me bi translated">点击<code class="fe ls lt lu lv b">Quit</code>菜单项应关闭应用程序。</li></ul><p id="3e4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我现在运行应用程序，我会在系统托盘上看到Tauri图标。点击它会显示带有<code class="fe ls lt lu lv b">Hide</code>和<code class="fe ls lt lu lv b">Quit</code>项目的菜单，但点击它们没有任何作用。为了在项目被点击时运行一些代码，我们应该使用<code class="fe ls lt lu lv b">on_system_tray_event</code>方法添加一个事件处理程序:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="acff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们定义<code class="fe ls lt lu lv b">handle_tray_event</code>函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="015d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/6095c5629f906e609d4b54a8bdb39c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sj3nUd9ndK3WISGn.gif"/></div></div></figure><h1 id="7872" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">从前端隐藏窗口</h1><p id="bc49" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">下一步是当输入<code class="fe ls lt lu lv b">Enter</code>时隐藏窗口，而不是关闭应用程序。为此，让我们更新<code class="fe ls lt lu lv b">App</code>组件的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="cf6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，当我输入内容并点击<code class="fe ls lt lu lv b">Enter</code>时，窗口被隐藏，但有两个问题:</p><ol class=""><li id="70d3" class="lw lx iq ky b kz la lc ld lf ly lj lz ln ma lr nt mc md me bi translated">当我点击系统托盘上的图标时，菜单项仍然显示<code class="fe ls lt lu lv b">Hide</code>。</li><li id="47db" class="lw lx iq ky b kz mf lc mg lf mh lj mi ln mj lr nt mc md me bi translated">当窗口再次显示时，我上次键入的文本仍然在那里。</li></ol><p id="e437" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从解决第二个更简单的问题开始。我们所要做的就是在调用<code class="fe ls lt lu lv b">add_task</code>命令后将<code class="fe ls lt lu lv b">content</code>状态设置为空字符串。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="7fbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个问题更棘手。我没有找到使用JavaScript API更改菜单项文本的方法。所以看起来我需要调用Rust code来做到这一点。让我们创建一个新命令<code class="fe ls lt lu lv b">hide_window</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="6c1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并从前端调用它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="ceb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，<code class="fe ls lt lu lv b">hide_window</code>命令接受了一个类型为<code class="fe ls lt lu lv b">AppHandle</code>的参数<code class="fe ls lt lu lv b">app</code>，但是当从Javascript调用它时，我们没有传递任何参数。Tauri将根据参数的类型自动注入参数。</p><h1 id="b2f3" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">显示带有全局快捷方式的窗口</h1><p id="21b2" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">到目前为止，当我键入快捷方式时，我正在运行应用程序的一个新实例，但现在我想只显示隐藏的窗口，而不打开一个全新的实例。Tauri提供了一种<a class="ae kv" href="https://tauri.studio/v1/api/js/modules/globalShortcut" rel="noopener ugc nofollow" target="_blank">注册全局快捷键</a>并在它们被按下时运行自定义代码的方法。</p><p id="825b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们在<code class="fe ls lt lu lv b">tauri.conf.json</code>上启用全局快捷键。下面是如何做到这一点:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="c9cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后通过向<code class="fe ls lt lu lv b">main.tsx</code>文件添加以下代码来注册快捷方式<code class="fe ls lt lu lv b">Alt+Enter</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="1c2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，每次我按下<code class="fe ls lt lu lv b">Alt+Enter</code>时，字符串<code class="fe ls lt lu lv b">Alt+Enter pressed!</code>都应该被登录到控制台。但是它不工作，我不知道为什么…直到我在<code class="fe ls lt lu lv b">tao</code>库:<a class="ae kv" href="https://github.com/tauri-apps/tao/issues/307" rel="noopener ugc nofollow" target="_blank">https://github.com/tauri-apps/tao/issues/307</a>上发现这个公开的问题</p><p id="fda6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Tao是Tauri用来创建和管理窗口的Rust库。根据这个问题，全局快捷方式在Linux上不能正常工作。这就是为什么它对我不起作用！</p><p id="e043" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，如果我想继续开发这个应用程序，我需要实现一个全局快捷方式来在Ubuntu上工作。这就是我将在下一篇文章中做的事情。</p><p id="a5b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再见！</p></div></div>    
</body>
</html>