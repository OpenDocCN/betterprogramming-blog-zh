<html>
<head>
<title>An Introduction to Core Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">核心数据简介</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-light-intro-to-core-data-part-un-e344f9d1528?source=collection_archive---------3-----------------------#2019-05-16">https://betterprogramming.pub/a-light-intro-to-core-data-part-un-e344f9d1528?source=collection_archive---------3-----------------------#2019-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9e2a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">介绍苹果核心数据框架的底层理论</h2></div><h1 id="d8fc" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">概观</h1><p id="6733" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">某些iOS应用程序需要在移动设备上存储数据以供离线使用。比如苹果让你在iTunes上播放下载的音乐，亚马逊的Audible让你不用上网就能听电子书。这些特性之所以能够实现，是因为有一个称为核心数据的客户端缓存框架。在这个由两部分组成的系列中，我们将仔细研究在使用不依赖后端服务器的应用程序时需要理解的理论组件。</p><h1 id="16eb" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">什么是核心数据？</h1><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/ad16f8a23f508043b2406e8d0fff97f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/0*pKj2v1dOFcJu5ICp.png"/></div></figure><blockquote class="mb"><p id="feb6" class="mc md iq bd me mf mg mh mi mj mk ls dk translated">“核心数据是一个框架，用于管理应用程序中的模型层对象”——Apple</p></blockquote><p id="3607" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">模型层对象？框架？如果您是iOS编程或一般编程的新手，您可能会问这些问题。</p><p id="98c2" class="pw-post-body-paragraph kx ky iq kz b la mq jr lc ld mr ju lf lg ms li lj lk mt lm ln lo mu lq lr ls ij bi translated">让我们来定义这些术语:“<strong class="kz ir"> <em class="mv">框架</em></strong>”—这是一组预定义的方法、类和模块，我们可以在高层次上使用它们来处理核心数据，而不用担心完全靠我们自己来构建它。在iOS编程中，苹果提供了一个框架。在面向对象编程中，<strong class="kz ir"> <em class="mv">模型层对象</em> </strong>是指将数据封装成<strong class="kz ir"> <em class="mv">模型</em> </strong>的应用组件。例如，具有名称、id、电子邮件和密码属性的用户模型。</p><p id="8f04" class="pw-post-body-paragraph kx ky iq kz b la mq jr lc ld mr ju lf lg ms li lj lk mt lm ln lo mu lq lr ls ij bi translated">本质上，核心数据为我们提供了一组预定义的模块，我们可以用它们来创建、读取、更新和删除持久层中的对象。</p><h1 id="24c1" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">SQLite和核心数据</h1><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/a085c707c271c44bf2c0c6da437f2ed9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJ9yGBmJjj9ZaQdcqDMdbQ.png"/></div></div></figure><p id="48e4" class="pw-post-body-paragraph kx ky iq kz b la mq jr lc ld mr ju lf lg ms li lj lk mt lm ln lo mu lq lr ls ij bi translated">请记住，核心数据本身并不是MongoDB或SQL之类的数据库。相反，它使用每个iOS设备自带的内置数据库系统<a class="ae nb" href="https://www.sqlite.org/index.html" rel="noopener ugc nofollow" target="_blank"> SQLite </a>。核心数据是管理对象图的框架，而SQLite是实际的关系数据库。你可以在这里阅读更多关于这个<a class="ae nb" href="https://cocoacasts.com/what-is-the-difference-between-core-data-and-sqlite/" rel="noopener ugc nofollow" target="_blank">的内容。现在让我们深入核心数据框架的主要组件。</a></p><h1 id="e125" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">实体</h1><p id="00c8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">实体是在对象图中表示的类。它有名称、属性和(可选的)关系。创建的每个实体都是<a class="ae nb" href="https://developer.apple.com/documentation/coredata/nsentitydescription" rel="noopener ugc nofollow" target="_blank"> NSEntityDescription </a>类的一个实例，我们将在第2部分中更详细地讨论这个实例。例如，看看下面的类声明:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="6b01" class="pw-post-body-paragraph kx ky iq kz b la mq jr lc ld mr ju lf lg ms li lj lk mt lm ln lo mu lq lr ls ij bi translated">我们希望使用核心数据在本地存储每个餐馆和所有者对象，以供离线使用。为此，我们必须在对象图中创建它们，如下所示:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ne"><img src="../Images/7a18cc26f90cc29f4138107c4fe94e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mY_wjKlm9-Ei_3EPdoLL4Q.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">对象图中餐馆实体的表示。</p></figure><p id="ed75" class="pw-post-body-paragraph kx ky iq kz b la mq jr lc ld mr ju lf lg ms li lj lk mt lm ln lo mu lq lr ls ij bi translated">这是您需要了解的关于核心数据中的实体的最基本的知识。在本文的第二部分，我们将研究如何创建一个功能完整的核心数据应用程序。现在让我们看看如何在代码中操作这些实体。例如，我们可以显示一个充满商品和商店的表格视图。</p><h1 id="97d2" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">对象图</h1><p id="c4f3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Xcode为开发人员提供了一个界面，可以在类似数据库的视图中查看每个实体及其关系。这被称为对象图，当你点击“xcdatamodeld”文件时可以看到。对象图对很多事情都很有用，包括查看和编辑实体、创建实体之间的关系，以及我们将在本文的第2部分研究的许多其他功能。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nj"><img src="../Images/e5dcd63772f93866df926eefbf48dfe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VMk5IdZYWvBlR17q.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">对象图的Xcode表示。</p></figure><h1 id="053f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">核心数据堆栈</h1><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nk"><img src="../Images/b27f0b8e0e9067491cf9a2c8882f4119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*no4WS_j7FwTwDR1_"/></div></div></figure><p id="5f83" class="pw-post-body-paragraph kx ky iq kz b la mq jr lc ld mr ju lf lg ms li lj lk mt lm ln lo mu lq lr ls ij bi translated">把核心数据栈想象成一个运行游戏的主要玩家团队。有4个主要组件我们必须注意:<strong class="kz ir"> <em class="mv">持久容器，托管</em> </strong> <strong class="kz ir"> <em class="mv">对象模型</em> </strong>，<strong class="kz ir"> <em class="mv">托管</em> </strong> <strong class="kz ir">对象上下文</strong>，<strong class="kz ir"> <em class="mv">存储协调器</em> </strong>。每个组件都有特定的任务，并与其他组件协调以支持核心数据。让我们来看看每一个。</p><h2 id="b517" class="nl kg iq bd kh nm nn dn kl no np dp kp lg nq nr kr lk ns nt kt lo nu nv kv nw bi translated">持久容器</h2><p id="c215" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">持久容器是更高层次的抽象类，它封装了核心数据栈中最重要的组件。用持久性容器创建核心数据栈可以让您轻松地与核心数据进行交互。这是框架对持久容器的声明:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nx"><img src="../Images/35303a4b05f06807553a5c18c446e5d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7OZqQgxCmXhlNtsCQxFvg.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">苹果的NSPersistentContainer接口。</p></figure><p id="3b52" class="pw-post-body-paragraph kx ky iq kz b la mq jr lc ld mr ju lf lg ms li lj lk mt lm ln lo mu lq lr ls ij bi translated">我们将详细讨论其中的每一项，但以下是一般概念:</p><ul class=""><li id="e902" class="ny nz iq kz b la mq ld mr lg oa lk ob lo oc ls od oe of og bi translated">名字:无论你给自己起什么名字。xcdatamodeld”。</li><li id="8532" class="ny nz iq kz b la oh ld oi lg oj lk ok lo ol ls od oe of og bi translated">viewContext:这允许我们保存、删除和获取数据。</li><li id="afa2" class="ny nz iq kz b la oh ld oi lg oj lk ok lo ol ls od oe of og bi translated">managedObjectModel:表示我们在内存中创建的实体。</li><li id="4e16" class="ny nz iq kz b la oh ld oi lg oj lk ok lo ol ls od oe of og bi translated">persistentStoreCoordinator:帮助上下文和存储进行通信。</li></ul><blockquote class="mb"><p id="0839" class="mc md iq bd me mf mg mh mi mj mk ls dk translated">NSPersistentContainer通过处理托管对象模型、持久性存储协调器和托管对象上下文的创建，简化了核心数据堆栈的创建和管理—苹果公司</p></blockquote><h2 id="a490" class="nl kg iq bd kh nm om dn kl no on dp kp lg oo nr kr lk op nt kt lo oq nv kv nw bi translated">托管对象模型</h2><p id="eaeb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">接下来，我们有了托管对象模型(NSManagedObjectModel)。这是。xcdatamodeld文件。这是因为当您从存储中获取数据(在创建和保存之后)时，核心数据需要一种在代码中表示它的方式，以便您可以显示、更新或删除它。</p><blockquote class="mb"><p id="813d" class="mc md iq bd me mf or os ot ou ov ls dk translated">“托管对象模型允许核心数据从持久性存储中的记录映射到您在应用程序中使用的托管对象。”—苹果公司</p></blockquote><p id="c76c" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">这里的主要情况是，所有的实体以及它们的属性和关系都由托管对象模型来表示。你可以阅读<a class="ae nb" href="https://developer.apple.com/documentation/coredata/nsmanagedobjectmodel" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多信息。</p><h2 id="2114" class="nl kg iq bd kh nm nn dn kl no np dp kp lg nq nr kr lk ns nt kt lo nu nv kv nw bi translated">托管对象上下文</h2><p id="0751" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在处理数据存储时，有不同类型的操作。我们可以创建、读取、更新、保存和删除数据。这就是托管对象上下文发挥作用的地方。您的应用程序的业务层通过对象上下文与核心数据堆栈进行交互，每当我们需要对存储中的数据进行更改时，对象上下文又会保留对持久性存储协调器的引用。我们将在本文的第2部分研究如何使用对象上下文执行CRUD操作。</p><h2 id="d478" class="nl kg iq bd kh nm nn dn kl no np dp kp lg nq nr kr lk ns nt kt lo nu nv kv nw bi translated">持久存储协调器</h2><p id="339c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后但同样重要的是持久的协调者。这充当了核心数据栈和存储(数据库)之间的桥梁。当一个对象上下文请求获取数据库中的所有项时，持久化协调器从SQLite存储中加载这些项，并将它们传递回对象上下文。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ow"><img src="../Images/76add6dd7ac1cb8990cc1e8a5e32848d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOqMzugP-vGeXqMU44-fIg.png"/></div></div><p class="nf ng gj gh gi nh ni bd b be z dk translated">持久存储协调器是核心数据栈和存储(SQLite)之间的链接。</p></figure><h1 id="756c" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">结论</h1><p id="1cb0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们已经了解了很多关于核心数据框架的知识。这将极大地帮助我们在第2部分中创建核心数据应用程序，因为我们已经知道每个类和组件是做什么的。核心数据是iOS工程师必须理解和使用的最复杂的框架。耐心点，很快你就会把这些点连接起来！</p></div></div>    
</body>
</html>