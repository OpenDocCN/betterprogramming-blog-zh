<html>
<head>
<title>How Passwordless SSH Login Works</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无密码SSH登录的工作原理</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-passwordless-ssh-login-works-711cb9af235?source=collection_archive---------13-----------------------#2020-06-23">https://betterprogramming.pub/how-passwordless-ssh-login-works-711cb9af235?source=collection_archive---------13-----------------------#2020-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f2b8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">安全是我的激情</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b0a3e7d2fddcf590620b6ebf485f20c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MLxSwUfHRK3KBVRNpyhrYw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本·加勒特在<a class="ae ky" href="https://unsplash.com/s/photos/gate?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9188" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.ssh.com/ssh/" rel="noopener ugc nofollow" target="_blank"> SSH </a>(安全外壳)是一个用于远程管理Linux系统的协议。显然，它是安全的，但是如果我告诉你，你可以通过禁用密码使它更加安全呢？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d68f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">无密码？</h1><p id="4761" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">是的，你没听错:无密码。使用它，您可以运行:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c77c" class="ne md it na b gy nf ng l nh ni">user@client:$ ssh user@server<br/>// connecting<br/><a class="ae ky" href="https://everyday.codes/cdn-cgi/l/email-protection" rel="noopener ugc nofollow" target="_blank">user@server</a>:$</span></pre><p id="00ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这很方便。但这不仅仅是为了方便和安全:一个绝对需要它的任务是自动化。如果您想要您的脚本(部署、维护等。)要执行任何与SSH相关的任务，您需要启用它。</p><p id="8901" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是你可能想知道它怎么可能是安全的。没有什么比一个长密码更能保护你了？理论上，是的。在实际操作中，真的很容易泄露密码，忘记密码，在其他地方使用密码，或者使用容易被黑客攻击的常用密码。</p><p id="6877" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而无密码则可以免疫各种攻击，只要你自己的系统没有被攻破或者你的攻击者没有量子计算机。公平地说，当我们得到量子计算机时，没有什么是安全的，所以让我们暂时忽略它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e6dc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">它是如何工作的？</h1><p id="f4b5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，你必须理解什么是公钥/私钥。私钥是非常长的随机位流(最常用的是2，048位)。私钥是保密的，永远不会离开客户端(您的PC)。公钥是另一种比特流，它是私钥<em class="nj"> </em>的派生物。也就是说，您可以从私钥生成唯一的公钥，但不能从公钥获得私钥:这是一个单向过程。</p><p id="3a84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">把它想象成人类的指纹。指纹可以用来(在某种程度上)唯一地识别人类，但是你不能仅仅根据他们的指纹来再造一个人。因此，您的公钥对每个人都可用，并且存储在客户机和服务器上。</p><p id="85cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，你为什么需要这双鞋呢？我不会在这里讨论高等数学，也没有必要。不过，你需要明白的是，这些配对有一个独特的特征。使用公钥，您可以加密(或签名)任何消息，只有使用私钥才能解密。换句话说，任何拥有你的公钥的人都可以给你发送只有你能阅读的加密信息。</p><p id="e77d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">听起来很酷，不是吗？而且，不限于SSH。这一原则在我们周围的许多应用中使用，包括HTTPS、FTPS、PGP(电子邮件加密)和许多其他应用。</p><p id="449c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果SSH服务器保存了您的公钥(这很重要)，它可以像这样认证您:</p><ol class=""><li id="7f92" class="nk nl it lb b lc ld lf lg li nm lm nn lq no lu np nq nr ns bi translated">使用您的公钥加密消息，并将其发送给客户端。</li><li id="6646" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated">客户端使用自己的私钥解密消息，并将其发送回去。</li><li id="ba25" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu np nq nr ns bi translated">服务器确保消息被正确解密，如果是，则验证用户。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/7916abe48a9028279fb2c3ba276ec61a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*kpYA5Oc9rp8dwzTJ"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供</p></figure><p id="6d81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，您仍然使用一个密码，只是一个更复杂的密码(稍后会详细介绍)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a4e4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何设置无密码SSH</h1><p id="2461" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，您必须创建一个公钥/私钥对。在我们这样做之前，让我们首先确保您没有覆盖任何现有的。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5fb4" class="ne md it na b gy nf ng l nh ni">$ ls ~/.ssh</span></pre><p id="b133" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在输出中看到任何<code class="fe nz oa ob na b">id_rsa.pub</code>文件，跳到下一步。如果没有，或者如果您看到一个错误，您将需要生成一个密钥对。为此，请运行:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b9ef" class="ne md it na b gy nf ng l nh ni">$ ssh-keygen</span></pre><p id="0a96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据您的发行版，这个工具可能包含也可能不包含。如果没有，就用你选择的软件包管理器来安装它。<code class="fe nz oa ob na b">ssh-keygen</code>会问你一些事情:</p><ul class=""><li id="bc0c" class="nk nl it lb b lc ld lf lg li nm lm nn lq no lu oc nq nr ns bi translated">要保存的文件名—保留默认值。</li><li id="9f98" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu oc nq nr ns bi translated">密码短语—这可用于通过密码保护私钥。这将帮助您以便利和自动化为代价实现最高的安全性。留空表示无密码，或输入一个密码。</li></ul><p id="de2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，您的公钥将保存在<code class="fe nz oa ob na b">~/.ssh/id_rsa.pub</code>中，您可以继续下一步。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bd85" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将公钥复制到SSH服务器</h1><p id="3851" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这里有许多方法。最简单的方法是使用<code class="fe nz oa ob na b">ssh-copy-id</code>工具。如果没有安装，使用您选择的软件包管理器安装它，或者继续第二种方法。一旦可用，您可以像这样使用该工具:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7314" class="ne md it na b gy nf ng l nh ni">$ ssh-copy-id -i ~/.ssh/id_rsa.pub user@server</span></pre><p id="371c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分别用用户名和主机替换<code class="fe nz oa ob na b">user</code>和<code class="fe nz oa ob na b">server</code>。然后会提示您在服务器上输入密码，就像常规的SSH连接一样。完成后，该工具会将您的公钥复制到服务器，SSH无密码认证现在可以工作了！</p><p id="acaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的系统上没有<code class="fe nz oa ob na b">ssh-copy-id</code>,还有另一种方法，只使用内置命令。首先，确保服务器上存在<code class="fe nz oa ob na b">.ssh</code>文件夹:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9db7" class="ne md it na b gy nf ng l nh ni">$ ssh user@server mkdir -p .ssh</span></pre><p id="03fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在远程服务器上执行<code class="fe nz oa ob na b">mkdir -p .ssh</code>。<code class="fe nz oa ob na b">-p</code> argument的意思是如果不存在就去创造，这正是我们想要的。创建文件夹后，您可以像这样上传您的密钥:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b9b6" class="ne md it na b gy nf ng l nh ni">$ cat ~/.ssh/id_rsa.pub | ssh user@server 'cat &gt;&gt; .ssh/authorized_keys'</span></pre><p id="515a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个命令将获取<code class="fe nz oa ob na b">~/.ssh/id_rsa.pub</code>的内容，并通过管道将它们发送到在服务器上执行的命令<code class="fe nz oa ob na b">cat &gt;&gt; .ssh/authorized_keys</code>。在其中，<code class="fe nz oa ob na b">cat</code>将把密钥转发给<code class="fe nz oa ob na b">.ssh/authorized_keys</code>文件。如果不存在，将创建它，如果存在，将在它后面追加一行。就是它了——您现在可以开始使用无密码SSH登录了！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7996" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">禁用密码登录</h1><p id="b7af" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">尽管您已经启用了无密码登录，但仍然不安全。为了真正安全，您需要完全禁用密码登录。</p><p id="134b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">小心行事。如果禁用密码并丢失私钥，您将无法登录。一个好的做法是打印出您的私钥，并将其存储在某个安全的地方。</p><p id="155d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，打开并编辑<code class="fe nz oa ob na b">/etc/ssh/sshd_config</code>,并进行以下更改:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="35e1" class="ne md it na b gy nf ng l nh ni">ChallengeResponseAuthentication no</span></pre><p id="0e9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将禁用质询响应。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d1e6" class="ne md it na b gy nf ng l nh ni">PasswordAuthentication no</span></pre><p id="14b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将禁用密码。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8269" class="ne md it na b gy nf ng l nh ni">UsePAM no</span></pre><p id="1877" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将禁用PAM(可插拔身份验证模块)。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7596" class="ne md it na b gy nf ng l nh ni">PermitRootLogin no</span></pre><p id="5e49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将禁止以<code class="fe nz oa ob na b">root</code>身份登录(确保您在<code class="fe nz oa ob na b">sudoers</code>组中！)</p><p id="26b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，通过运行以下命令重新加载配置:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f32b" class="ne md it na b gy nf ng l nh ni">$ systemctl reload ssh</span></pre><p id="ae5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果不起作用，用<code class="fe nz oa ob na b">sshd</code>替换<code class="fe nz oa ob na b">ssh</code>(在CentOS/RHEL/Fedora上)。就是这样，您的SSH连接非常安全！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0b06" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结束语</h1><p id="15a9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢您的阅读，希望您喜欢这篇文章。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4e48" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">资源</h1><ul class=""><li id="88a7" class="nk nl it lb b lc mu lf mv li od lm oe lq of lu oc nq nr ns bi translated"><code class="fe nz oa ob na b">man ssh</code></li><li id="73cf" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu oc nq nr ns bi translated"><a class="ae ky" href="https://ssd.eff.org/en/module/deep-dive-end-end-encryption-how-do-public-key-encryption-systems-work" rel="noopener ugc nofollow" target="_blank">深入探讨端到端加密</a></li><li id="d7b5" class="nk nl it lb b lc nt lf nu li nv lm nw lq nx lu oc nq nr ns bi translated"><a class="ae ky" href="https://levelup.gitconnected.com/user-management-in-linux-explained-825b8a518abc" rel="noopener ugc nofollow" target="_blank">Linux中的用户管理讲解</a></li></ul></div></div>    
</body>
</html>