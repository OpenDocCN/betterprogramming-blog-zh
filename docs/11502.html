<html>
<head>
<title>A Jokingly Simple Go Web Server To Deliver Chuck Norris Jokes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个提供查克·诺里斯笑话的简单的网络服务器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-jokingly-simple-go-web-server-f03b6315a5fb?source=collection_archive---------7-----------------------#2022-03-25">https://betterprogramming.pub/a-jokingly-simple-go-web-server-f03b6315a5fb?source=collection_archive---------7-----------------------#2022-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ec9e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">查克·诺里斯不写代码——他盯着它直到它自己写出来</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c5a49d9bd8a39f87a1407ce9040026bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_MeCOZ8oA_PtoXzWAyGf2A.jpeg"/></div></div></figure><p id="8cbe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Go是一种优秀的后端语言，具有强大的包支持，使得系统构建变得容易。再加上良好的运行时性能，我们就拥有了构建一个简单的、接近生产就绪的web服务器所需的所有工具(这恰好是书呆子Chuck Norris的笑话)。</p><p id="ead8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了简洁起见，我省略了一些，但是完整的(可部署的)代码库可以在这里找到。</p><h1 id="0d6d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">积木</h1><p id="180d" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">web服务器需要两样东西——供客户机与之交互的API，以及处理客户机使用服务器的任何事情的逻辑。我们将从开发API开始。</p><p id="473c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在Go中构建web <em class="mp">东西</em>时，我们经常使用<code class="fe ml mm mn mo b">net/http</code>包，这次也不例外——它提供了构建我们的服务器所需的一切。我们将在<code class="fe ml mm mn mo b">/</code>上监听，但是这个概念可以扩展到你选择的任何<a class="ae ln" href="https://blog.hubspot.com/marketing/parts-url" rel="noopener ugc nofollow" target="_blank">子目录</a>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="bd5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ml mm mn mo b">net/http</code>提供开箱即用的并发请求处理，因此我们可以高效地工作，而不必太费力地思考。我们使用<code class="fe ml mm mn mo b">http.HandleFunc</code>将我们的函数设置为各个子目录上的请求，而<code class="fe ml mm mn mo b">ListenAndServe</code>会将这些请求定向到它们在所提供的<code class="fe ml mm mn mo b">port</code>上的处理程序，直到它停止或出现错误。</p><p id="c717" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们必须设置逻辑来处理这些请求。对于这个例子来说,<code class="fe ml mm mn mo b">handleGetJoke</code>是大部分业务逻辑的所在。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="2620" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这里，我们必须生成一个在笑话中使用的名称(代替“Chuck Norris”，只是为了让事情更有趣一点)。然后，我们会用那些名字组成一个笑话，最后我们会把完成的笑话返回给客户端。</p><p id="c83b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ml mm mn mo b">r</code>表示我们从客户端获得的请求，而<code class="fe ml mm mn mo b">w</code>是我们生成并返回的响应。</p><p id="d6db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请注意，我们已经将名称和笑话生成分别抽象为一个模块化的包<code class="fe ml mm mn mo b">names</code>和<code class="fe ml mm mn mo b">jokes</code>。构建模块化服务有很多好处。它缩小了职责范围，简化了交换库，使测试编写更容易，允许更具协作性的开发环境，并减少了开发人员扩展或调试服务所需的认知负荷。让这些模块化组件实现一个公共接口会更好，但那是以后的事了。</p><p id="c4a6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用randomuser.me为<code class="fe ml mm mn mo b">names</code>包生成我们的名字。以下要点主要是发出一个API请求，然后处理返回的JSON数据。<code class="fe ml mm mn mo b">GetNew()</code>通过调用支持函数来处理业务逻辑。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="62d2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ml mm mn mo b">simplehttpget</code>是使用<code class="fe ml mm mn mo b">http.Client</code>的薄包装，在<a class="ae ln" href="https://github.com/swayne275/joke-web-server" rel="noopener ugc nofollow" target="_blank">全回购</a>中可以看到更多细节。</p><p id="d553" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们将使用<a class="ae ln" href="http://www.icndb.com" rel="noopener ugc nofollow" target="_blank">互联网Chuck Norris数据库</a>使用我们上面生成的名字生成一个笑话。如上所述，<code class="fe ml mm mn mo b">GetNew()</code>是这个包的入口点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="4717" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">同样，这主要是提供一个名称，发出一个API请求，并解析结果。一旦你编写了一些API客户端/消费者，你会开始注意到一些常见的模式。注意，struct字段是公共的——这是<code class="fe ml mm mn mo b">json</code>包编组/解组数据所必需的。</p><h1 id="5ff9" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">运行服务器</h1><p id="8098" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">终于到了<code class="fe ml mm mn mo b">main()</code>吸引人的时刻:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="b343" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为我们已经用多个包构建了这个服务器，所以运行起来非常简洁。我们选择一个端口，调用<code class="fe ml mm mn mo b">StartServer</code>，如果我们得到任何错误，就会惊慌失措(还记得我怎么写的吗，这是<em class="mp">接近</em>生产就绪？您很可能希望在现实世界中优雅地处理这个错误)。</p><p id="30a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在剩下的就是在这个目录的根目录下打开一个终端并运行<code class="fe ml mm mn mo b">go run main.go</code>。然后你可以在网页浏览器中访问<code class="fe ml mm mn mo b">localhost:5000</code>，在每次刷新时看到一个自定义的查克·诺里斯笑话！</p><p id="9d00" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您看到如下消息:</p><p id="af8b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ml mm mn mo b">panic: Could not start client API server on port 5000: listen tcp :5000: bind: address already in use</code></p><p id="dd19" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用端口<code class="fe ml mm mn mo b">5000</code>可能会有其他的东西。将<code class="fe ml mm mn mo b">main.go</code>中的<code class="fe ml mm mn mo b">port</code>常量更改为其他值，然后重试！</p><h1 id="5f24" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">停止服务器</h1><p id="ce7e" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">要结束这个笑话，你可以在运行服务器的窗口中使用<code class="fe ml mm mn mo b">ctrl-c</code>。这将释放资源(如服务器监听的端口)并退出程序。</p><h1 id="bd4d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">包扎</h1><p id="388f" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我希望这是有教育意义和一点点乐趣。我计划围绕这一点构建一个系列，其中我将描述Docker设置(包含在repo中)，并探索几个用于构建简单UI的Go包。一如既往，请给我留下反馈，告诉我如何改进这一点！</p><h1 id="9fa2" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">更多即将推出…</h1><p id="6ddf" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我打算继续这个系列，并将保持下面的链接更新。未来的主题包括探索Go框架来构建前端！</p><p id="2f9d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，你可以继续阅读如何<a class="ae ln" href="https://medium.com/@swayne275/dockerizing-a-go-app-45ca034263ca" rel="noopener">对应用</a>进行Dockerize。请留下您还想阅读的反馈！</p></div></div>    
</body>
</html>