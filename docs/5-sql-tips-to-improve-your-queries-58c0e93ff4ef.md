# 改善查询的 5 个 SQL 技巧

> 原文：<https://betterprogramming.pub/5-sql-tips-to-improve-your-queries-58c0e93ff4ef>

## 代码中的细微变化会带来很大的不同

![](img/1d1578fa87352f5132227dc3f39d5acb.png)

图片由 Freepik 上的 [Freepik](https://www.freepik.com/author/freepik) 提供。

SQL 通常是一种自学语言。它的简单性和快速的学习曲线使它成为进入数据科学的完美语言。

然而，这可能会带来一些你可能没有意识到的重要缺点。

我们都像任何初学者一样，开始编写相当糟糕的查询。这使得我们在掌握 SQL 的旅程开始时就养成了一些坏习惯，这些坏习惯可能会一直伴随我们到最后。

您可能会想，我已经掌握了 SQL，并且编写了非常酷的查询。即使我确实有一些小的坏习惯，为什么我应该停止做它们？这样做有几个原因:

1.  作为一名专业人员，你的编码风格是你能给人的最好的第一印象。没有清晰结构的杂乱查询是缺乏改进动力的专业人员的明显标志。
2.  不遵循逻辑的查询更难共享和重用。在团队中工作时，这一点尤为重要。由于每个人都有自己的编码习惯，总有一天别人会不理解你的查询。总是试图标准化你的编码风格。
3.  写得不好的查询更难扩展和改进。难以阅读和理解的查询在扩展时更容易失败。没有清晰数据源或结构的查询很难用新数据来改进和增强。
4.  你的坏习惯会蔓延开来，对你易受影响的队友产生不良影响，尤其是在你手下有低年级学生的时候。保持团队的风格和语法标准对于保持工作的有序性至关重要。

就像细微的改进可以提升您的查询一样，从长远来看，细微的坏习惯会降低代码的质量和清晰度。

这就是为什么你应该停止做这五个常见的 SQL 坏习惯。

# 1.开始形成你的疑问

缩进和空白对于给我们的查询提供结构是必要的。这是 SQL 的一个基本概念。我们来分解一下这个想法。

我将从一个完全极端的例子开始——为了说明这一点，编写这样的查询对我来说非常困难:(。

第一个查询不包含缩进或空格。

所以…只是让我知道，阅读上面的查询的体验如何？很有挑战性，是吧？我保证我曾经和一个完全的天才一起工作过，他编写了这样的 SQL 代码。

很疯狂，对吧？所以现在，让我们添加一些缩进来增加趣味。

我很确定这个查询有缩进更容易阅读，对吗？我们快速一瞥就能明白。让我们添加一些额外的空白。

现在，它是完美的！我们可以理解查询中的不同层次，理解它并不需要太多的努力。

# 2.总是用大写字母写 SQL 语法

有一种非书面的——甚至是书面的！SQL 语法用大写字母书写的规律。

让我们从一个基本的开始:对 SQL 关键字[使用大写字母](https://www.w3schools.com/sql/sql_ref_keywords.asp)，对表和列使用小写字母。我强烈建议也用大写字母写 SQL 函数[。](https://www.w3schools.com/sql/sql_ref_mysql.asp)

这意味着，任何不是表名或列名的内容都需要大写。这包括 SQL 关键字和 SQL 函数。

让我们使用这个新逻辑重复前面的查询。

更好，对吧？现在，任何与数据字段世界相关的人都可以马上理解这个查询。

# 3.还在用 SELECT * FROM？你应该现在就和它分手！

另一个常见的坏习惯——老实说，我的罪恶快感——是使用神奇的`*` SQL 命令。我知道使用它是非常诱人的，而且每当我们进行快速查询来检查一些直觉时，它都非常有用。

然而，作为最佳实践，总是用一个能够改善响应时间的`select` 语句来检索必要的列。

这意味着我们在编写查询的最终版本时都应该避免它，以避免错误。把所有的柱子都带在身边会让它们更容易失败。当我们失去对携带哪些列的控制时，很容易得到一些我们不想要的额外数据或得到一些重复的列，这可能会混淆我们的代码。

这就是为什么要避免这样做:

开始这样做更好:

所以现在，我打赌你在想…当然，我仍然可以使用`* EXCEPT()`来确保我留下了我不再需要的列。

我们可以做得更好。

也要避免使用`EXCEPT`。它带来了与`*`相同的问题，因为你不能确定哪些列被携带——你只需要确定你想留下的那些列。

# 4.停止使用过多的子查询。多使用 CTE

您应该开始避免在每个时态表或 CTE 中使用多个子查询。让我们举一个例子来说明这个观点:

现在，假设我们有一个包含一家公司所有工资的表，这家公司在两个不同国家的四个城市经营。我们想比较整个公司、两个国家和所有四个城市的平均工资。我们如何做到这一点？

首先，我们可以编写一个包含两个子查询的查询，计算所有三个平均工资。

然而，这是完全错误的。我可能同意你的观点，这个例子是相当虚构的，但是，在同一个时态表中使用几个子查询总是有诱惑力的。

这就是我们的`WITH`命令和 cte 发挥关键作用的地方。当在时态表中分离子查询时，我们可以创建更直观的查询，并且可以重用。并在最终查询中选择所有期望的数据。

如果你想进一步了解如何使用`WITH`和时态表，你可以在我之前的故事中得到详细的解释:

[](/how-to-structure-readable-and-reusable-sql-queries-623485ac4a36) [## 如何构造可读和可重用的 SQL 查询

### 模块化的重要性

better 编程. pub](/how-to-structure-readable-and-reusable-sql-queries-623485ac4a36) 

# 5.总是给你的每一列起一个有逻辑的名字

当创建查询时，我们可以简单地继续使用数字来携带列。

我们不应该这样做，而应该根据我们对它们的期望来命名它们。这将使编辑查询变得容易，并在不丢失逻辑的情况下扩展我们的查询。

保持 SQL 查询的顺序和逻辑总是有益的。认识并自我纠正自己的 SQL 坏习惯可以帮助你成为一名更专业、更自信、更高效的 SQL 程序员。

# 结论

SQL 很棒。它是数据分析、数据科学和任何其他数据相关领域的基础之一，并且将一直存在。

这就是为什么您应该在编码时注意保持良好的风格，并提高您的 SQL 技能。在本文中，我总结了编写 SQL 的最常见的最佳实践。

希望这对提高你的 SQL 技能有所帮助！:)

数据总是有更好的主意——相信它。