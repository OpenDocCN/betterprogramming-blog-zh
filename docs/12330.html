<html>
<head>
<title>How To Render And Serve HTML Template Pages With C++</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用C++渲染和提供HTML模板页面</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-render-and-serve-html-template-pages-with-c-af45dd39ec3e?source=collection_archive---------2-----------------------#2022-05-28">https://betterprogramming.pub/how-to-render-and-serve-html-template-pages-with-c-af45dd39ec3e?source=collection_archive---------2-----------------------#2022-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a2f6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在本文中，我将向您展示如何使用C++和Cinatra和Ginger库，通过一个简单的HTTP服务器来呈现HTML模板并提供服务。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9863be0657ca157fd3b9d783eb0f6091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xGnXoLdX-teY6Y6G"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">凯特·汤森在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="ac75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不久前，我写了两篇关于如何用Golang从模板中呈现HTML的文章。如果你有兴趣，你可以在这里找到他们<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-generate-html-with-golang-templates-5fad0d91252"/>和<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-render-html-pages-with-gin-for-golang-9cb9c8d7e7b6"/>。尝试过之后，我决定看看我是否能在没有太大困难的情况下用C++做类似的事情。这篇文章就是这个实验的结果。</p><p id="5c0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我设法找到了用于创建简单的HTTP服务器和呈现模板的仅头文件库。我选择Cinatra 作为HTTP框架，选择Ginger 作为HTML模板。</p><p id="6289" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我从Github下载了这两个库。在Cinatra页面上，提到需要安装Boost，所以我也安装了。我在下面讨论如何做到这一点。</p><p id="4e55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个例子，我将创建一个简短的程序，它将服务于一个列出六种产品的产品页面。实际的CSS和JavaScript来自于<a class="ae ky" href="https://www.youtube.com/watch?v=OAPRagDr4pU" rel="noopener ugc nofollow" target="_blank">web designer先生的伟大教程</a>。本教程中的HTML已经过修改，可以作为Ginger库的模板使用。你可以在视频下面找到这个项目需要的CSS、JavaScript和图片文件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ad43" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">我的设置</h1><p id="525f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">C++最大的困难之一是正确设置所有的库和路径。通过一些修补，我想出了下面的解决方案，似乎在我的系统上工作。即使它可能不会马上为你工作，我相信它至少会给你一些启发，告诉你如何让它在你的系统上工作。</p><h2 id="72d7" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">MSYS2和GCC</h2><p id="1480" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我运行的是Windows 11。为了安装C++编译器，我决定使用MSYS2，它捆绑了GCC。一旦安装了MSYS2，我就创建了一个指向GCC二进制文件所在目录的路径。我将这个路径添加到了Windows的环境变量中。为了测试这是否有效，我打开了一个Windows命令提示符(不是MSYS提示符——我不会用它),然后输入<code class="fe nl nm nn no b">gcc --version</code>。如果安装正确，并且在windows环境变量中输入了正确的路径，应该会返回安装的GCC版本。</p><h2 id="29f0" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">促进</h2><p id="14c8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Boost是一个非常有用的免费C++库集合。如果你想使用Cinatra库，这也是必要的。</p><p id="0a5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我下载了最新的Windows zip文件，并将其解压缩到一个有足够空间的驱动器上。我系统上库的路径是<code class="fe nl nm nn no b">D:\boost_1_79_\boost_1_79_0</code>。对于您的系统，这可能有所不同。</p><p id="aa67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不完全确定当只为Cinatra使用Boost时，是否有必要使用<code class="fe nl nm nn no b">bootstrap.bat</code>批处理文件安装Boost，但我还是做了。起初，我总是在试图运行<code class="fe nl nm nn no b">bootstrap.bat</code>时出错。我发现在我的例子中，因为我使用MSYS2的GCC，我需要编辑批处理文件。所以在<code class="fe nl nm nn no b">bootstrap.bat</code>里我找了<code class="fe nl nm nn no b">call .\build.bat</code>，改成了<code class="fe nl nm nn no b">call .\build.bat gcc</code>。现在，批处理文件运行无误，并且安装了Boost。</p><h2 id="db5a" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">目录结构</h2><p id="6b90" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于这个项目，我创建了以下目录结构。我把Cinatra和Ginger的头文件库放在一个名为<code class="fe nl nm nn no b">/include</code>的子目录中。</p><p id="3a09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我创建了一个<code class="fe nl nm nn no b">/static</code>子目录，在其中添加了必要的图像、CSS和JavaScript文件。最后，我创建了一个名为<code class="fe nl nm nn no b">/templates</code>的子目录来保存HTML模板。</p><p id="1e8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nl nm nn no b">/www</code>子目录由Cinatra Toolkit自动创建。对于这个项目，这里没有文件。</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="d6c8" class="mz md it no b gy nt nu l nv nw">D:.<br/>│   c.exe<br/>│   cinatra.cpp<br/>│<br/>├───include<br/>│   │   cinatra.hpp<br/>│   │   ginger.h<br/>│   │<br/>│   └───cinatra<br/>│           client_factory.hpp<br/>│           connection.hpp<br/>│           cookie.hpp<br/>│           define.h<br/>│           dh1024.pem<br/>│           function_traits.hpp<br/>│           gzip.hpp<br/>│           http_cache.hpp<br/>│           http_client.hpp<br/>│           http_parser.hpp<br/>│           http_router.hpp<br/>│           http_server.hpp<br/>│           io_service_pool.hpp<br/>│           itoa.hpp<br/>│           itoa_jeaiii.hpp<br/>│           mime_types.hpp<br/>│           modern_callback.h<br/>│           multipart_parser.hpp<br/>│           multipart_reader.hpp<br/>│           picohttpparser.h<br/>│           render.h<br/>│           request.hpp<br/>│           response.hpp<br/>│           response_cv.hpp<br/>│           response_parser.hpp<br/>│           router.hpp<br/>│           server.crt<br/>│           server.key<br/>│           session.hpp<br/>│           session_manager.hpp<br/>│           sha1.hpp<br/>│           smtp_client.hpp<br/>│           upload_file.hpp<br/>│           uri.hpp<br/>│           url_encode_decode.hpp<br/>│           use_asio.hpp<br/>│           utils.hpp<br/>│           websocket.hpp<br/>│           ws_define.h<br/>│<br/>├───static<br/>│   ├───css<br/>│   │       style.css<br/>│   │<br/>│   ├───images<br/>│   │       1.png<br/>│   │       2.png<br/>│   │       3.png<br/>│   │       4.png<br/>│   │       5.png<br/>│   │       6.png<br/>│   │<br/>│   └───js<br/>│           script.js<br/>│<br/>├───templates<br/>│       product.html<br/>│<br/>└───www</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ccf8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">程序代码</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="22b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面，我将检查代码。如果你以前学过一点C++的话，这其实很容易理解。</p><p id="78ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第14行，我们创建了一个HTTP服务器。</p><p id="a667" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第17–71行，我们为六种产品创建了一些虚拟数据。我们将这些数据放入名为<code class="fe nl nm nn no b">xs</code>的地图矢量中。</p><p id="f6b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第73行，我们告诉服务器在<code class="fe nl nm nn no b">0.0.0.0:8080</code>监听，这实际上对应于<code class="fe nl nm nn no b">localhost:8080</code>。</p><p id="456f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第74–92行，使用<code class="fe nl nm nn no b">set_http_handler()</code>为<code class="fe nl nm nn no b">/index</code>路径创建了一个接受GET和POST方法的HTTP路由处理程序。这个函数的第二个参数是lambda函数。注意，如果我们想在lambda函数中使用向量<code class="fe nl nm nn no b">xs</code>,我们需要将它作为参数发送给该函数。</p><p id="13e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第76–78行，我们创建了一个映射<code class="fe nl nm nn no b">t</code>，它将包含模板中使用的变量。</p><p id="40a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第80–82行，模板被打开并添加到一个名为<code class="fe nl nm nn no b">ss</code>的<code class="fe nl nm nn no b">stringstream</code>中。</p><p id="c8f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第84行，我们为Ginger模板渲染引擎的输出创建了一个名为<code class="fe nl nm nn no b">output</code>的<code class="fe nl nm nn no b">stringstream</code>。</p><p id="f62b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第85–89行，我们尝试使用映射<code class="fe nl nm nn no b">t</code>中的变量将流<code class="fe nl nm nn no b">ss</code>中的模板呈现到输出流<code class="fe nl nm nn no b">output</code>中。如果这样做不成功并返回一个错误，那么我们捕获这个错误并将其输出到标准的C错误输出流。</p><p id="e185" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第91行，创建了一个响应，其中包括在<code class="fe nl nm nn no b">output</code>中最终呈现的HTML模板。</p><p id="4a11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第95行，我们注册了保存静态资产的目录。这是保存CSS、图像和JavaScript文件(在它们各自的子目录中)所需要的。</p><p id="b910" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第97行，我们运行服务器。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1f28" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">模板</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="4022" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我将解释模板的一些特性。我不会谈论实际使用的HTML网上有很多地方可以找到更多关于它的信息。</p><p id="299d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与Go语言中的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-templates-in-golang-46194c677c7d">标准模板引擎</a>相比，Ginger模板可用的操作有些有限。例如，在使用<code class="fe nl nm nn no b">$if</code>语句或添加自定义函数映射时，不可能放置等式运算符。然而，对于许多目的来说，这并不重要，因为可能不需要这些操作。</p><p id="ef5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Ginger的语法规范可以在这里找到<a class="ae ky" href="https://github.com/melpon/ginger#template-syntax-specification" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2a9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第13行，我们使用<code class="fe nl nm nn no b">${title}</code>变量在这里打印标题。</p><p id="ed12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第15–21行，for循环用于打印出现在<code class="fe nl nm nn no b">xs</code>向量中的每个产品。在这个循环中，我们使用<code class="fe nl nm nn no b">x</code>变量来表示每个产品。为了获得产品<code class="fe nl nm nn no b">x</code>中的字段，我们可以编写<code class="fe nl nm nn no b">${x.&lt;field&gt;}</code>，其中<code class="fe nl nm nn no b">&lt;field&gt;</code>可以是<code class="fe nl nm nn no b">num</code>、<code class="fe nl nm nn no b">img</code>、<code class="fe nl nm nn no b">name</code>、<code class="fe nl nm nn no b">price</code>等等。</p><p id="292c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第25–45行，类似的事情发生了。这是弹出窗口。在这里，在第31–35行，我们还包含了一些<code class="fe nl nm nn no b">$if</code>语句，这样我们就可以显示每个产品的星号。我们在这里只能使用布尔值，所以我们需要在将乘积向量传递给模板之前，为乘积向量中的每个星设置布尔值。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5621" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">编译和运行代码</h1><p id="c0b6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了编译上面的源代码，我打开Windows命令提示符并编写以下代码:</p><pre class="kj kk kl km gt np no nq nr aw ns bi"><span id="f961" class="mz md it no b gy nt nu l nv nw">gcc cinatra.cpp -lstdc++ -lwsock32 -lws2_32 -I D:/boost_1_79_0/boost_1_79_0 -L D:/boost_1_79_0/boost_1_79_0/libs -o c.exe</span></pre><p id="f751" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我花了一段时间才找到要添加哪些标志以及如何包含目录。注意，我已经包含了用于我的Boost安装的“通用包含”目录<code class="fe nl nm nn no b">-I</code>和“库”<code class="fe nl nm nn no b">-L</code>。</p><p id="ffd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要运行可执行文件，只需编写:<code class="fe nl nm nn no b">c.exe</code></p><p id="bc6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以去<code class="fe nl nm nn no b">localhost:8080/index</code>看看结果。</p><div class="kj kk kl km gt ab cb"><figure class="nz kn oa ob oc od oe paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/89a32b26a56327476f62583821d8b656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*K0F-Q5AeKAAsl1fMvaU3BA.png"/></div></figure><figure class="nz kn oa ob oc od oe paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/08591c8635568675b59c9f1d3222414f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*8O27rSTufEJXIxGqd4z-jQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk of di og oh translated">在左侧，您可以看到产品概述，在右侧可以看到特定产品的弹出窗口</p></figure></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cda7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><p id="b934" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=OAPRagDr4pU" rel="noopener ugc nofollow" target="_blank">“具有快速查看产品预览弹出效果的响应式产品卡”，网页设计师先生</a></p></div></div>    
</body>
</html>