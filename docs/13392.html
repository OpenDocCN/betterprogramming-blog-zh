<html>
<head>
<title>The Site Is HTTPS, so I’m Safe, Right?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地点是HTTPS，所以我是安全的，对吗？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-site-is-https-so-im-safe-right-fc452ce79da7?source=collection_archive---------5-----------------------#2022-08-23">https://betterprogramming.pub/the-site-is-https-so-im-safe-right-fc452ce79da7?source=collection_archive---------5-----------------------#2022-08-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4582" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你可能认为你不需要担心中间人(MITM)攻击，但手机应用程序或嵌入式网站呢？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/62b82d3ce4887234c0fa1b4dced19568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*WpDD4PJqDexQJWhT.jpg"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">imgflip.com</p></figure><h1 id="4304" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">什么是中间人攻击？</h1><p id="6d2f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">由于MITM攻击的风险，公共互联网连接本质上是不安全的。我不是说你不应该使用公共wifi连接。不过，下次你在星巴克或机场时，你应该格外小心地采取VPN等预防措施，并避免访问可能暴露敏感个人信息的网站。如果你经常旅行，考虑投资一个<a class="ae mf" href="https://www.pcmag.com/picks/the-best-mobile-hotspots" rel="noopener ugc nofollow" target="_blank">便携式wifi热点</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/b8d99f1d132f4b60218dc446997f59e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*iVaIJTs0mIgzOKrbhEULgw.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">本地中间人攻击公共wifi</p></figure><p id="face" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">MITM袭击是如何进行的？</p><ol class=""><li id="d604" class="mm mn iq ll b lm mh lp mi ls mo lw mp ma mq me mr ms mt mu bi translated">攻击者执行ARP中毒(例如，ARP欺骗)攻击，将wifi路由器的IP地址映射到攻击者机器的mac地址。现在，不知情用户的流量将被发送给攻击者。如果攻击者也连接到同一个wifi路由器，这种攻击很容易执行。</li><li id="60da" class="mm mn iq ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">用户请求web服务器，但不知不觉地与攻击者的机器通信。攻击者可以读取请求头和未加密的请求。</li><li id="b862" class="mm mn iq ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">攻击者将用户的请求转发给web服务器。web服务器不知道正在发生攻击。</li><li id="c3a7" class="mm mn iq ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">web服务器处理用户的请求。同样，攻击者可以读取响应报头和未加密的流量。</li><li id="a1fe" class="mm mn iq ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">攻击者将来自web服务器的响应转发给用户。该网页将为用户正常加载，就好像攻击者不存在一样。</li></ol><p id="6949" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">此时，攻击者已经成功地将自己插入到您和web服务器之间。最常推荐的降低MITM风险的解决方案是避免不使用TLS的网站(例如，不使用HTTPS的网站)。但是，当你加载一个HTTPS网站时，会发出一系列的web请求来加载HTML、CSS JavaScript、图像和其他资产，但这些并不能保证是HTTPS。</p><p id="9f5a" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">幸运的是，对于大多数现代浏览器来说，包括谷歌Chrome，我们不需要担心这个<a class="ae mf" href="https://security.googleblog.com/2019/10/no-more-mixed-messages-about-https_3.html" rel="noopener ugc nofollow" target="_blank">，因为81版</a>。在2020年的这一变化后，如果你访问一个HTTPS网站，Chrome将自动升级对HTTPS的HTTP请求，如果升级失败，就会阻止这些请求。此设置可针对每个网站进行配置，因为有些网站可能不支持自动将流量升级到HTTPS。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/281e5888046d82fda0df830c8a2461a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*XrUz6k1k4mRHs2LwxUSYRA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">在Chrome中导航到站点设置的屏幕截图</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/5cab8e02d8ca47ccdefdbf30ee7f933b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*5rLvpMPOeRT9ADoeWqCIOg.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">如何在Chrome中打开/关闭不安全内容设置的屏幕截图</p></figure><p id="2fa8" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">看一下这个示例网站。尝试在启用和不启用不安全内容设置的情况下加载(当然，如果您使用的是安全连接)。网址在这里:</p><div class="nc nd gp gr ne nf"><a href="https://googlesamples.github.io/web-fundamentals/fundamentals/security/prevent-mixed-content/active-mixed-content.html" rel="noopener  ugc nofollow" target="_blank"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd ir gy z fp nk fr fs nl fu fw ip bi translated">活动混合内容示例</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">通过HTTP查看页面— HTTPS活动混合内容的几个示例。当在HTTPS浏览时，大多数浏览器会屏蔽这个…</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">googlesamples.github.io</p></div></div></div></a></div><p id="f71a" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">如果您打开Chrome dev tools并导航到网络面板，您可以在最初的HTTPS请求之后看到9个额外的内容请求，其中3个请求(以红色突出显示)是不安全的。</p><p id="2e98" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">这些网站被称为混合内容网站，因为加载整个网页需要发出HTTP和HTTPS请求。幸运的是，大多数浏览器已经阻止加载后台HTTP内容。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/8868afd07dea545e0638b6ca236796ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*2B2Lfcbo9A3cw8yEazHAgQ.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Chrome开发工具中的网络面板截屏阻止了三个HTTP请求</p></figure><p id="31b8" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">如果这些请求没有被阻止并保持不加密，您的数据可能会面临严重的风险，因为缺乏加密会使您容易受到MITM攻击。我们已经讨论了MITM攻击是如何工作的，但是攻击者在恶意地将他们的系统放在“中间”之后会做什么呢？这里有几个漏洞:</p><ol class=""><li id="0856" class="mm mn iq ll b lm mh lp mi ls mo lw mp ma mq me mr ms mt mu bi translated">数据暴露:攻击者可以查看未加密的内容，其中可能包含私人信息。即使它不包含个人信息，数据的性质也可能使用户的私生活受到不必要的审查，并且在某些制度下，被用来审查或限制公民自由。例如，HTTPS并不总是要求像图像这样的被动内容。尽管如此，如果攻击者从宗教、约会或色情网站截取图像，那么他们就可以了解到用来伤害用户的个人信息。</li><li id="24ef" class="mm mn iq ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">代码注入:攻击者用恶意内容替换良性的web内容。在上面的例子中，由于<code class="fe np nq nr ns b">simple-example.js</code>是未加密的，攻击者可以用任意的JavaScript替换代码。注入恶意JavaScript可能会被用来利用其他系统漏洞，例如简单地提取数据或危害用户的浏览器，甚至整个系统。</li></ol><h1 id="b361" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">前4名最受欢迎的浏览器是安全的！</h1><p id="386b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">今天，最新版本的Chrome、Safari、Edge和Firefox在访问由HTTPS保护的网站时可以抵御中间人攻击，因为它们防止了上述混合内容MITM漏洞。</p><p id="f1a4" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">然而，如果你属于使用三星互联网、Opera或UC浏览器的8%,那么我很抱歉——你需要自己验证。主要的风险存在于被归类为“其他”的浏览器的长尾中因为他们的投资和审查要少得多，所以我不会认为他们最近采用了这样的安全特性。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi nt"><img src="../Images/bd4ad676df5c8379fd95fdc4a89d03de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LlwuRvlUuaQcKcDhZiL27A.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated"><a class="ae mf" href="https://gs.statcounter.com/browser-market-share#monthly-202107-202207-bar" rel="noopener ugc nofollow" target="_blank">去年StatCounter浏览器的市场份额</a></p></figure><p id="35ef" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">例如，如果您从上面访问相同的活动混合内容URL，UC浏览器会下载JavaScript并立即运行它，而不会发出警告。这款应用的全称是<a class="ae mf" href="https://play.google.com/store/apps/details?id=com.UCMobile.intl&amp;hl=en_US&amp;gl=US" rel="noopener ugc nofollow" target="_blank"> UC浏览器——安全、快速、私密</a>。如果你的网络中有攻击者，那就不安全，也不私密。UC浏览器占全球浏览器的近1%，而<a class="ae mf" href="https://gs.statcounter.com/browser-market-share/all/china/#monthly-202107-202207-bar" rel="noopener ugc nofollow" target="_blank">约占中国用户的12%。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/826293683d37ec31c1b1a076f5431bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Yg-3UQfn9xD4-bgdmZQY7Q.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Android上的<a class="ae mf" href="https://play.google.com/store/apps/details?id=com.UCMobile.intl&amp;hl=en_US&amp;gl=US" rel="noopener ugc nofollow" target="_blank"> UC浏览器-安全、快速、私密</a>截图</p></figure><h1 id="d96f" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">Android和iOS应用安全吗？</h1><p id="82a3" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">不一定！你可能不像你想象的那么安全，无论你是在打发时间，玩flappy bird或tower defense游戏，还是浏览令人麻木的社交媒体应用程序。TLS不保证从iOS或Android应用程序到其应用程序的web服务器的通信是安全的。</p><p id="7173" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">苹果和谷歌都强烈鼓励开发者实施安全最佳实践，但他们允许开发者选择退出HTTPS安全保证。与上面例子中的Chrome浏览器不同，这些设置是由开发者控制的，而不是用户。</p><p id="55a1" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">苹果和谷歌都允许开发者对应用程序进行配置，以不加密和明文的方式进行通信。iOS将此称为“例外”，暗示这可能不会被永久允许。</p><p id="98df" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">此配置的<a class="ae mf" href="https://developer.android.com/guide/topics/manifest/application-element#usesCleartextTraffic" rel="noopener ugc nofollow" target="_blank"> Android安全文档</a>:</p><blockquote class="nz oa ob"><p id="5260" class="lj lk oc ll b lm mh jr lo lp mi ju lr od mj lu lv oe mk ly lz of ml mc md me ij bi translated">指示应用程序是否打算使用明文网络流量，如明文HTTP。针对API级别27或更低的应用程序的默认值是<code class="fe np nq nr ns b">"true"</code>。针对API级别28或更高的应用默认为<code class="fe np nq nr ns b">"false"</code>。</p></blockquote><p id="dbc9" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">这里有一篇类似的<a class="ae mf" href="https://www.hackingwithswift.com/example-code/system/how-to-handle-the-https-requirements-in-ios-with-app-transport-security" rel="noopener ugc nofollow" target="_blank">文章，记录了iOS </a>的流程。</p><h1 id="631e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">我们在Android上找个例子吧！</h1><p id="bf30" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在Android上检查网络流量不像桌面客户端上的Chrome工具那样简单。我不能仅仅打开Chrome开发者工具中的网络标签来检查流量。它需要很大的努力来设置，所以我不会在这里详细介绍。如果你对这个主题的文章感兴趣，请留下你的评论。</p><p id="6a3a" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">首先，我下载并设置了PortSwigger的<a class="ae mf" href="https://portswigger.net/burp/communitydownload" rel="noopener ugc nofollow" target="_blank"> Burp Suite安全测试工具包</a>，它有一个免费的商业版，功能稍有限制。我用USB线将一台Android设备连接到我的MacBookPro上，并配置了一个HTTPS代理。你可以按照<a class="ae mf" href="https://blog.nviso.eu/2020/11/19/proxying-android-app-traffic-common-issues-checklist" rel="noopener ugc nofollow" target="_blank">这篇关于代理Android应用流量的教程</a>来获得详细的设置说明。</p><p id="0c40" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">本质上，我在我的android手机上执行MITM攻击，除了使用USB电缆，而不是像前面的例子中的ARP欺骗。</p><p id="2da9" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">在没有任何前期研究的情况下，我从谷歌Play商店搜索并下载了几个不受欢迎的新闻应用。试了三次后，我成功了。应用程序“<a class="ae mf" href="https://play.google.com/store/apps/details?id=info.newsapps.russianews&amp;hl=en_US&amp;gl=US" rel="noopener ugc nofollow" target="_blank">俄罗斯新闻|俄罗斯&amp;世界新闻头条</a>”几乎专门通过HTTP进行通信。查看以下流量:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nu nv di nw bf nx"><div class="gh gi og"><img src="../Images/22c381e14ae61a62ee76a18c9ea847fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VKLGE9EOFb3u3CZqfPebzw.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">截至2022年8月21日，Burp套件拦截“俄罗斯新闻|俄罗斯和世界新闻头条”android应用程序流量的截图</p></figure><p id="9f78" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">请注意，在应用程序中下载或加载内容时没有安全警告。在我的网络上运行MITM攻击的攻击者将能够拦截、读取和修改任何这些请求。</p><h1 id="dd85" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">一个人能做什么？</h1><p id="76af" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">太好了，应用不一定安全。太好了，不清楚哪些应用程序是安全的，哪些是不安全的。你不应该期望在将一个应用程序放入你的常规滚动循环之前执行深入的安全分析。你应该做两件事:</p><ol class=""><li id="8090" class="mm mn iq ll b lm mh lp mi ls mo lw mp ma mq me mr ms mt mu bi translated">仅使用受信任的网络。你应该连接到当地潜水酒吧的无线网络吗？也许不是。如果你在旅行时需要用笔记本电脑上网，就用手机做热点，或者买个便携wifi热点。</li><li id="43d7" class="mm mn iq ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">下载一个可信的VPN，并让它一直开着。ExpressVPN、NordVPN等。有很多选择。做一些研究，选择一个最适合你的。</li><li id="6d31" class="mm mn iq ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">避免应用内浏览器。除了安全，如果你重视你的隐私，那么无论如何你都应该避免它们。参见"<a class="ae mf" href="https://www.theverge.com/2022/8/19/23312725/in-app-browser-tracking-facebook-instagram-privacy-tool" rel="noopener ugc nofollow" target="_blank">该网站揭露了抖音和Instagram的应用内浏览器可能追踪的令人毛骨悚然的事情</a>"</li></ol><h1 id="9f7f" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">包裹</h1><p id="feaa" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我希望这篇文章在某种程度上揭示了MITM是一种攻击，攻击面在哪里，以及如何保护自己。您可能会惊讶地发现，android和iOS应用程序不如在您的网络浏览器中浏览安全。我很期待Android和iOS未来的安全改进。</p><p id="ed97" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">我怀疑他们正在努力消除这些漏洞，并通过要求所有应用程序流量都是HTTPS来保护用户。然而，这可能需要时间，因为应用程序经常调用可能不支持HTTPS的第三方服务。在那之前，使用VPN并保持安全。</p><p id="1e04" class="pw-post-body-paragraph lj lk iq ll b lm mh jr lo lp mi ju lr ls mj lu lv lw mk ly lz ma ml mc md me ij bi translated">如果我错过了什么，请告诉我。我保证我做到了。</p></div></div>    
</body>
</html>