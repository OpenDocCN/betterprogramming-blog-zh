<html>
<head>
<title>Build a Customer Service Chatbot Using Python, Flask, and Pinecone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python、Flask和Pinecone构建一个客户服务聊天机器人</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-customer-service-chatbot-using-python-flask-and-pinecone-85c151aa6b0?source=collection_archive---------8-----------------------#2021-07-27">https://betterprogramming.pub/build-a-customer-service-chatbot-using-python-flask-and-pinecone-85c151aa6b0?source=collection_archive---------8-----------------------#2021-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fd47" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用AI/ML应用相似性搜索</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5b18c691cdbf22c1ca3b6563b699ec80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jgrUQdPr2PxdO6em"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@kimileee?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> kimi lee </a>拍摄的照片</p></figure><p id="d58f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相似性搜索是机器学习领域的一个子集，用于查找与原始输入密切相关的项目。对于产品、音乐或电影推荐来说，它非常有用。你看了网飞电视台的<em class="lv">办公室</em>，所以这里有一些你可能喜欢的其他节目。你经常在Spotify上听Bayside，所以去看看其他的流行朋克乐队吧。</p><p id="370c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相似性搜索也可用于自动化客户支持。如果当客户提问时，您可以很容易地找到以前问过的类似问题和答案来帮助他们，会怎么样？</p><p id="9f85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将构建一个Python Flask应用程序，它使用<a class="ae ky" href="https://www.pinecone.io/" rel="noopener ugc nofollow" target="_blank">松果</a>——一个托管相似性搜索服务——来完成这一任务。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f295" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">动机和实际应用</h1><p id="715d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在我们进入演示应用程序之前，让我们花一分钟来检查一下我们试图解决的问题。</p><p id="051a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设你是一家拥有数千甚至数百万客户的大公司的高管。您的客户支持团队日复一日地被反复询问同样的问题。为了节省时间和金钱，您可以通过拥有良好的面向公众的文档和FAQ页面来简化您的支持流程。</p><p id="2bf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是您如何确保客户找到他们需要的信息呢？毕竟，创建文档只是成功的一半。</p><p id="33d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多公司采用的一种方法是使用客户服务聊天机器人。当顾客第一次发起对话时，他们是在和机器人聊天。客户输入他们的问题，机器人试图帮助解决他们的问题。如果机器人能够以准确、相关的问题和答案做出响应，那么客户也许能够自己解决他们的问题。</p><p id="4c59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这不起作用，那么客户可以要求与能够提供帮助的真人交谈。人工智能和机器学习不能解决我们所有的问题——至少现在还不能。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="22ae" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">演示应用概述</h1><p id="56a3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在让我们来看看我们的演示应用程序。下面你可以看到该应用程序如何工作的简短动画。用户输入一个问题并提交表单，然后出现相关的问题，希望能够回答用户最初的问题。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/5433d7ad14b0547c6e145f7a09f71cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*FO0RASRUfe1EdbOK"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">演示应用程序—客户服务聊天机器人</p></figure><p id="24bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很漂亮，对吧？那么这一切是如何运作的呢？</p><p id="f79d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在开发这个应用的过程中，我们首先从Quora上找到了一个由问题和答案组成的数据集。这个数据集包含数十万个问题，但我们只使用了前5万个。</p><p id="97f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们把这些问题放在一个嵌入模型中，来创建所谓的向量嵌入。</p><p id="7fe2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个<a class="ae ky" href="https://www.pinecone.io/learn/vector-embeddings/" rel="noopener ugc nofollow" target="_blank">矢量嵌入</a>本质上是一个数字列表，为机器学习算法提供元数据，以确定各种输入之间的相似性。</p><p id="43b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用了<a class="ae ky" href="https://nlp.stanford.edu/projects/glove/" rel="noopener ugc nofollow" target="_blank">平均单词嵌入模型</a>。然后，我们将这些向量嵌入到由松果管理的索引中。</p><p id="f39f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当用户提交他们的问题时，会向一个API端点发出请求，该端点使用Pinecone的SDK来查询矢量嵌入的索引。</p><p id="cd67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">端点返回五个类似的问题，这些结果在应用程序的UI中显示给用户。</p><p id="9ff9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说，pine cone——作为一个可管理的相似性搜索解决方案——提供了返回推荐的引擎。你只需要带来你的矢量嵌入，它是通过嵌入模型运行数据生成的。</p><p id="b3fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想自己尝试一下，你可以在GitHub 上找到这个应用的代码。<code class="fe nb nc nd ne b">README</code>包含如何在您自己的机器上本地运行应用程序的说明。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a182" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">演示应用程序代码演练</h1><p id="4ef3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在，我们已经理解了项目背后的动机，并对应用程序的工作方式有了一个较高的概述，让我们深入实际代码，看看在引擎盖下发生了什么。</p><p id="d028" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，所有的后端代码都在<code class="fe nb nc nd ne b">app.py</code>文件中，我们在下面完整地复制了它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="5bf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们一个方法一个方法一行一行地分析这里发生的事情。</p><p id="0d7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第1–11行，我们导入了应用程序的依赖项。我们的应用依赖于以下内容:</p><ul class=""><li id="c4a9" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated"><code class="fe nb nc nd ne b">dotenv</code>用于从<code class="fe nb nc nd ne b">.env</code>文件中读取环境变量</li><li id="fd94" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nb nc nd ne b">flask</code>用于web应用程序设置</li><li id="79df" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nb nc nd ne b">json</code>用于使用JSON</li><li id="5358" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nb nc nd ne b">os</code>也用于获取环境变量</li><li id="54cc" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nb nc nd ne b">pandas</code>用于处理数据集</li><li id="12c3" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nb nc nd ne b">pinecone</code>用于使用松果SDK</li><li id="4ea4" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nb nc nd ne b">requests</code>请求API下载我们的数据集</li><li id="479c" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated"><code class="fe nb nc nd ne b">sentence_transformers</code>对于我们的嵌入模型</li></ul><p id="da19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第13行，我们提供了一些样板代码来告诉Flask我们的应用程序的名称。</p><p id="b289" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第15–18行，我们定义了一些将在应用程序中使用的常量。其中包括松果索引的名称、存储问题数据的目录、数据集的文件名以及下载数据集的URL。</p><p id="eb97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第20–23行，我们的<code class="fe nb nc nd ne b">initialize_pinecone</code>方法从<code class="fe nb nc nd ne b">.env</code>文件中获取我们的API密钥，并使用它来初始化松果。</p><p id="03ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第25–27行，我们的<code class="fe nb nc nd ne b">delete_existing_pinecone_index</code>方法在松果实例中搜索与我们正在使用的名称相同的索引(“问答聊天机器人”)。如果找到一个现有的索引，我们就删除它。</p><p id="83c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第29–33行，我们的<code class="fe nb nc nd ne b">create_pinecone_index</code>方法使用我们选择的名称(“问答聊天机器人”)、“余弦”接近度度量和一个碎片创建了一个新的索引。</p><p id="d720" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第35–41行，如果需要的话，我们的<code class="fe nb nc nd ne b">download_data</code>方法下载Quora问答对的数据集。如果文件已经存在于<code class="fe nb nc nd ne b">tmp</code>目录中，那么我们就使用那个文件。</p><p id="d0bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第43–50行，我们的<code class="fe nb nc nd ne b">read_tsv_file</code>方法使用<code class="fe nb nc nd ne b">pandas</code>库读取TSV文件，并将每一行插入数据帧。我们还会删除数据集中发现的任何重复问题。</p><p id="def8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第52–57行，我们的<code class="fe nb nc nd ne b">create_and_apply_model</code>方法使用<code class="fe nb nc nd ne b">sentence_transformers</code>库来处理平均单词嵌入模型。然后，通过使用我们的模型对每个问题进行编码，我们为每个问题创建一个向量嵌入。向量嵌入然后被插入松果索引。</p><p id="3df2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，当后端应用程序启动时，我们描述的每个方法都在第77–82行被调用。这项工作为我们基于用户输入实际查询松果索引的最后一步做准备。</p><p id="0989" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第84–94行，我们为我们的应用程序定义了两条路径:一条到主页，一条到API端点。主页提供了<code class="fe nb nc nd ne b">index.html</code>模板文件以及JS和CSS资产，API端点提供了查询松果索引的搜索功能。</p><p id="1d27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，在第59–75行，我们的<code class="fe nb nc nd ne b">query_pinecone</code>方法获取用户的输入，将其转换为矢量嵌入，然后查询松果索引来查找类似的问题。当点击<code class="fe nb nc nd ne b">/api/search</code>端点时调用该方法，这在用户提交新的搜索查询时发生。</p><p id="d742" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于视觉学习者来说，这里有一个图表概述了该应用程序的工作原理:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/e17c657924c842dbbc0fbb5d1ef91238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PF1k9vbT9N2m6zCF"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">应用架构和用户体验</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8680" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">示例场景</h1><p id="5c26" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">那么，把这些放在一起，用户体验是什么样的呢？</p><p id="86ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户可以访问我们的网站，输入问题“如何学习Python”，找到过去被问过的类似问题，然后点击链接查看Quora上的问题和答案。</p><p id="dbfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按照我们的客户服务场景，用户可能会问一个关于如何使用我们公司产品的问题，找到类似的问题，单击一个链接，并被定向到一个有帮助的支持页面来回答他们的问题，所有这些都不需要与支持代表进行交互。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0caa" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="6c76" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们现在已经创建了一个简单的Python应用程序来解决现实世界中的问题。为了让这个应用程序更好，我们可以在每次提问时在我们的索引中加入新的问题和答案。</p><p id="6422" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用客户反馈来微调模型，以了解返回的结果是否相关。毕竟，反馈有助于模型更好地提供有用的结果。</p><p id="4caa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个故事的寓意应该很清楚:相似性搜索有助于为你的客户提供更好的结果。作为一项托管服务，Pinecone使得基于向量的推荐系统易于生产。</p></div></div>    
</body>
</html>