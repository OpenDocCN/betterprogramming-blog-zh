<html>
<head>
<title>Swift Enums, Mind the Gap: EnumKit to the Rescue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">迅速Enums，小心差距:EnumKit救援</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swift-enums-mind-the-gap-3573378d2d9f?source=collection_archive---------4-----------------------#2019-08-18">https://betterprogramming.pub/swift-enums-mind-the-gap-3573378d2d9f?source=collection_archive---------4-----------------------#2019-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="beb4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">轻松匹配枚举案例，提取它们的相关值，转换它们，等等。使用EnumKit</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/700cb558cf59dfb7155d85adccb1f796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4wBu1CBWKt53hBVwcIKFmQ.jpeg"/></div></div></figure><p id="d834" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Swift中的枚举非常强大。凭借其能够拥有关联值的超能力，enums为Swift用户提供了一个全新的用例类别。</p><p id="4c63" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们使用枚举来表达错误、事件、动作、输入和输出。然而，要访问一个枚举事例的关联值，并不像访问一个结构或类的变量那样简单。</p><p id="7e48" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在MERLin中，我们使用枚举来描述模块中可能发生的事件。</p><p id="7e1e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我邀请您阅读<a class="ae lq" href="https://medium.com/better-programming/events-driven-architecture-in-ios-with-merlin-63d211e64698" rel="noopener">Events-Driven Architecture in iOS with MERLin</a>以了解更多关于什么是事件和模块的信息，但是现在，我将只把事件定义为:</p><p id="9224" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">系统发送的一种信息，用来通知收听者状态的变化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lr ls l"/></div><p class="lt lu gj gh gi lv lw bd b be z dk translated">描述可在电影详细信息页面上生成的事件的简单枚举</p></figure><p id="0ab5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">今天，我们知道了两种访问枚举相关值的方法:</p><ul class=""><li id="8deb" class="lx ly it kw b kx ky la lb ld lz lh ma ll mb lp mc md me mf bi translated">使用switch语句。</li><li id="d482" class="lx ly it kw b kx mg la mh ld mi lh mj ll mk lp mc md me mf bi translated">使用模式匹配。</li></ul><p id="7d73" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用开关或模式匹配并没有错，但有时，在我们的算法中，我们可能对一个特定的情况感兴趣。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="fd75" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">只有一个case和default的开关有点让人心烦，那么模式匹配只适用于if和guard语句。这两种模式在反应式环境中都是丑陋的，并且可能会经常重复。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="1617" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在假设在您的算法中，您对验证事件不是<strong class="kw iu"> </strong> <code class="fe ml mm mn mo b">rated</code>感兴趣。</p><p id="4228" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个问题只能用除了排除情况之外的所有情况的开关来解决。在这种用例中，模式匹配变得完全无用，除非您愿意让一个空的if包含所有的else逻辑，因为它不会返回一个我们可以取反的布尔值。</p><p id="59eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于<code class="fe ml mm mn mo b">MovieDetailPageEvent</code>的具体情况，我们可以使枚举符合<code class="fe ml mm mn mo b">Equatable</code>并有更好的代码，但这并不总是容易或可能的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/b4c1cab2872eb96a5cb48609edeef122.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*dIRDuQnRpH12JMsMopWXTg.png"/></div></figure><p id="b330" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/gringoireDM/EnumKit" rel="noopener ugc nofollow" target="_blank"> EnumKit </a>是一个非常轻量级的库，旨在使enum能够轻松地访问和转换相关值，匹配enum事例，并处理enum事例集合。</p><p id="234b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你需要做的就是让你的枚举符合标记协议<code class="fe ml mm mn mo b">CaseAccessible</code>，它没有一致性要求。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="e73d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用<code class="fe ml mm mn mo b">CaseAccessible</code>，提取一个关联值就像访问一个数组值一样简单:<code class="fe ml mm mn mo b">event[case: MovieDetailPageEvent.rated]</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="c5aa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于<code class="fe ml mm mn mo b">CaseAccessible</code>是一个协议，我们也可以编写扩展来更好地支持其他数据结构中的枚举，如array、observable (RxSwift)和publisher (Combine)。</p><p id="9b44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">EnumKit配备了对<code class="fe ml mm mn mo b">Sequence</code>的扩展，扩展到enum case函数的数组，如<code class="fe ml mm mn mo b">compactMap</code>、<code class="fe ml mm mn mo b">flatMap</code>、<code class="fe ml mm mn mo b">forEach</code>和<code class="fe ml mm mn mo b">filter</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="9081" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">联合收割机的扩展<code class="fe ml mm mn mo b">Publisher</code>在分支中准备就绪，RxSwift的扩展在<a class="ae lq" href="https://github.com/gringoireDM/RxEnumKit" rel="noopener ugc nofollow" target="_blank"> RxEnumKit </a>中可用。</p><p id="ae40" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们来看看我们之前用observable的例子用EnumKit会是什么样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="8642" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">EnumKit还提供了一种通过下标更新关联值的简单机制。</p><p id="9ff7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对相关值的访问是Swift中一项长期要求的功能。虽然可能需要一点时间来商定将这一特性融入语言的方法，但EnumKit现在已经可以在<a class="ae lq" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>和<a class="ae lq" href="https://github.com/apple/swift-package-manager" rel="noopener ugc nofollow" target="_blank"> SwiftPM </a>上使用了。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="f00b" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">限制</h1><p id="e3d0" class="pw-post-body-paragraph ku kv it kw b kx np ju kz la nq jx lc ld nr lf lg lh ns lj lk ll nt ln lo lp im bi translated">不幸的是，EnumKit并不完美。虽然它经过了100%的单元测试，但是在模式匹配和相关值的提取方面存在一些限制，我想在这里说明一下:</p><ul class=""><li id="8aab" class="lx ly it kw b kx ky la lb ld lz lh ma ll mb lp mc md me mf bi translated">它不能很好地处理过载的情况。在某些情况下，与同名枚举事例的模式匹配会导致Xcode崩溃。</li><li id="ef7f" class="lx ly it kw b kx mg la mh ld mi lh mj ll mk lp mc md me mf bi translated">关联值不能包含闭包。提取会成功，但是使用以这种方式提取的闭包可能会导致崩溃。</li></ul><p id="b4ee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">尽管有这些限制，EnumKit还是极大地改进了我们使用enums的方式。如果您正在使用<code class="fe ml mm mn mo b">CaseAccessible</code>，只要确保您有唯一命名的枚举案例，没有闭包作为参数。</p></div></div>    
</body>
</html>