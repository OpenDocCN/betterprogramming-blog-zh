<html>
<head>
<title>Storing Data on Ethereum Blockchain With Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js在以太坊区块链上存储数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/storing-data-on-ethereum-blockchain-with-node-js-643cb2961ebc?source=collection_archive---------5-----------------------#2022-01-19">https://betterprogramming.pub/storing-data-on-ethereum-blockchain-with-node-js-643cb2961ebc?source=collection_archive---------5-----------------------#2022-01-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fe9b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以有组织和面向模型的方式使用以太坊区块链作为持久存储，而无需编写自定义智能合约</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e4afbe7d6f9e70ce88907a671ea9cd57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aRnz6XwgAU2sTHOg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@kanchanara?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kanchanara </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="2ae2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们正处于2022年初，每个人都在谈论互联网上的“下一件大事”:Web 3。但是大部分谈论NFT、加密资产、替代币和区块链技术的人并不真正知道他们如何在实践中使用它们，他们也不知道它们的真正能力。</p><p id="ea03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文是一个演练，将帮助您理解区块链和智能合约的一些基本概念。它还将提供一个实际操作指南，实际使用以太坊区块链来存储结构化数据，就像您使用经典的SQL数据库或不太经典的非SQL数据库一样。</p><p id="77f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，您就可以利用区块链，并在下一个web应用程序中积极地使用它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="be88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们记住区块链是什么:</p><blockquote class="mc"><p id="ac0d" class="md me it bd mf mg mh mi mj mk ml lu dk translated">一个<!-- -->区块链通俗地说就是一种<strong class="ak"> <em class="mm">分布式数据库</em> </strong> <em class="mm">，比其他数据库提供更多的透明性和更多的安全性</em>。</p></blockquote><p id="80e7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这意味着它们的主要作用是存储数据。</p><h1 id="4447" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">为什么专门用以太坊区块链？</h1><p id="d1a2" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">以太坊区块链是令人惊奇的，因为它是第一个提供通过智能契约和它们背后的语言在其上运行代码的能力的区块链。</p><p id="2caa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，即使对于有经验的开发人员来说，Solidity smart contracts也可能是一个真正的地狱，因为它们有一些主要的技术缺陷(至少目前是这样)。</p><p id="b9d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中最重要的如下:</p><ol class=""><li id="aeca" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">Solidity中智能合约的开发非常耗时，</li><li id="a751" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">智能合同不容易测试</li><li id="8a02" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">Solidity不支持许多不同的数据类型。</li><li id="9515" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">Solidity只支持开发人员可以传递给函数的有限数量的参数</li><li id="7528" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">坚固性缺乏面向对象的概念。它更像是一种非常原始的编程语言，而不是一种允许更复杂的数据结构和功能的现代语言。</li></ol><p id="e8d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，以太坊智能合约对于各种应用仍然非常有用，从复杂的拍卖场景和分散的web应用到简单的数据存储。</p><h1 id="908a" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">热气球:拼图中缺失的部分</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/36d01b7c2e5c6041494b68ad5f77a4d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*uBM8X3K-QSIYj4_eUxsHQg.png"/></div></figure><p id="b819" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">复杂、难以开发、测试和维护的智能合约与以太坊区块链在基于JS的网络应用中的实际使用之间的差距被<a class="ae ky" href="https://github.com/petrosDemetrakopoulos/ethairballoons" rel="noopener ugc nofollow" target="_blank"> EthAir Balloons </a>所掩盖。</p><p id="1a93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">EthAir Balloons是以太坊区块链的一个严格类型的ORM(对象关系映射器)库。它允许开发人员以一种有组织和面向模型的方式使用以太坊区块链作为持久存储，而无需编写定制的复杂智能合约。我们可以说它对于基于以太坊的区块链就像Mongoose对于MongoDB一样。</p><p id="012b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，EthAir气球并不限制开发者只能使用以太坊区块链<em class="oe">。该库可以用于任何基于以太坊的区块链(可以是私有的，也可以是公共的)。</em></p><p id="5db0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，如果你想在以太坊区块链上试验<code class="fe of og oh oi b">EthAirBalloons</code>和数据存储，我强烈建议在以太坊区块链的私有实例中进行任何测试和试验(你可以使用<code class="fe of og oh oi b"><a class="ae ky" href="https://www.npmjs.com/package/ganache-cli" rel="noopener ugc nofollow" target="_blank">ganache-cli</a></code>工具在本地运行一个)。这是因为，公共以太坊区块链将对每次写、更新和删除操作收取大量的交易费(称为“gas”)。</p><p id="b5d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是理论部分已经说得够多了:让我们来看看实际情况。</p><h1 id="6543" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">在区块链上存储数据</h1><p id="bf16" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">本文的这一部分假设您熟悉JavaScript和Node.js的基本概念。</p><p id="8157" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们通过在终端上键入以下命令来创建一个新的节点项目:</p><pre class="kj kk kl km gt oj oi ok ol aw om bi"><span id="d6c5" class="on mt it oi b gy oo op l oq or">mkdir ethereum_data_storage<br/>cd ethereum_data_storage<br/>npm init</span></pre><p id="2084" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成向导，它将询问关于项目的更多信息(名称、版本、许可证、作者等)。</p><p id="f6fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后通过在项目的根目录下执行下面几行来安装<code class="fe of og oh oi b">EthairBalloons</code>、Express库和<code class="fe of og oh oi b">body-parser</code>。为了将数据的CRUD操作公开为REST API调用，我们将使用express。</p><pre class="kj kk kl km gt oj oi ok ol aw om bi"><span id="8468" class="on mt it oi b gy oo op l oq or">npm i --save ethairballoons<br/>npm i --save express<br/>npm i --save body-parser</span></pre><p id="9b5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完库之后，我们需要创建一个名为<code class="fe of og oh oi b">index.js</code> <strong class="lb iu"> </strong>的文件和一个名为<strong class="lb iu"> </strong> contracts <strong class="lb iu">的目录。</strong>这是存储自动生成的可靠性合同的地方。</p><pre class="kj kk kl km gt oj oi ok ol aw om bi"><span id="f853" class="on mt it oi b gy oo op l oq or">touch index.js<br/>mkdir contracts</span></pre><p id="883d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe of og oh oi b">index.js</code>文件中，我们应该添加以下几行，以便导入项目的各种依赖项，并声明我们希望存储在区块链上的数据模型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">依赖关系和模型声明</p></figure><p id="b23e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在前8行中，我们导入并声明API的依赖项。</p><p id="d96a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第10行，我们仅使用两个参数启动了一个<code class="fe of og oh oi b">ethairballoons</code>(或者我喜欢称之为<code class="fe of og oh oi b">ethAirBalloonsProvider</code>)的实例:</p><p id="20e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.我们想要使用的以太坊区块链提供商的URL(在这个例子中它被设置为一个本地的<code class="fe of og oh oi b">ganache-cli</code>提供商)，</p><p id="4767" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.我们希望保存自动生成的模型智能合约的路径。</p><p id="47ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在提供者初始化之后，我们可以使用<code class="fe of og oh oi b">createSchema()</code>函数创建新的数据模式，并以JS对象格式传递模式细节(第12–29行)。当然，开发人员可以(按照建议)将模式定义保存在单独的JSON文件中，然后使用文件顶部的<code class="fe of og oh oi b">require()</code>语句导入它们。</p><p id="8bfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们的数据模式已经设置好了，是时候在区块链中部署它了，在这一点上，我想记住我们是在本地<code class="fe of og oh oi b">ganache-cli</code>实例(这是一个以太坊区块链模拟器)中完成的，而不是在实际的以太坊网络中。</p><p id="5160" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于交易费用可能很高，强烈建议只在区块链私人以太坊部署<code class="fe of og oh oi b">EthAirBalloons</code>模型或在本地使用<code class="fe of og oh oi b">ganache-cli</code>。</p><p id="292d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现这一点，我们在API上声明了一个新的端点，名为<code class="fe of og oh oi b">GET /deploy</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="5816" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，当这个端点被调用时，一个新的智能契约将基于我们之前声明的模式自动生成和部署，而不需要编写任何代码。</p><p id="11df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此函数(<code class="fe of og oh oi b">Car.deploy</code>)返回一个布尔值，表明部署是否成功；如果部署成功，则返回一个错误对象，该对象将不被定义。部署完成后，我们可以调用模型的其他功能。</p><h2 id="14e5" class="on mt it bd mu ou ov dn my ow ox dp nc li oy oz ne lm pa pb ng lq pc pd ni pe bi translated">CRUD操作</h2><p id="f026" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">如前所述，<code class="fe of og oh oi b">EthairBalloons</code>完全支持所有CRUD(创建、更新、删除)操作，甚至更多。</p><p id="f5bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了创建、更新和删除我们声明的模型的一个实例之外，<code class="fe of og oh oi b">EthairBalloons</code>还提供了通过Id查找一个实例和查找模型的所有当前存储的实例的能力。</p><p id="e649" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">公开CRUD操作的端点如下面的代码所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><h1 id="8583" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">运行本地以太网模拟器</h1><p id="0441" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">在本地运行服务器之前，使用众所周知的<code class="fe of og oh oi b">node .</code>命令，我们应该启动<code class="fe of og oh oi b">ganache-cli</code>(假设它已经安装，如果没有，您可以很容易地找到如何安装它<a class="ae ky" href="https://www.npmjs.com/package/ganache-cli" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="3f66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当运行<code class="fe of og oh oi b">ganache-cli</code>时，我们必须确保它是用足够的资金初始化的，以支持我们想要通过CRUD API和<code class="fe of og oh oi b">EthairBalloons</code>完成的所有事务。因此，我们将参数<code class="fe of og oh oi b">-l</code> ( <code class="fe of og oh oi b">gasLimit</code>)设置为80000000000000，这对于一些创建和更新操作来说足够了。最终的命令应该如下所示:</p><pre class="kj kk kl km gt oj oi ok ol aw om bi"><span id="468a" class="on mt it oi b gy oo op l oq or">ganache-cli -l 800000000000000</span></pre><p id="65d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您已经准备好调用API的端点来生成智能合约并将其部署到以太坊区块链，然后创建、更新、删除和查找您的模型的任何实例。</p><h1 id="b082" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">就这样</h1><p id="8357" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">我希望你会觉得它很有趣，并希望它在未来的项目中有用！你可以在这个<a class="ae ky" href="https://github.com/petrosDemetrakopoulos/ethairballoons-CRUD-API" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>上找到完整的项目。不要犹豫问与<a class="ae ky" href="https://github.com/petrosDemetrakopoulos/ethairballoons" rel="noopener ugc nofollow" target="_blank">热气球</a>相关的问题。</p></div></div>    
</body>
</html>