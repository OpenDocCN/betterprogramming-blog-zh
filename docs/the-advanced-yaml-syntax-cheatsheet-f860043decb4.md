# 高级 YAML 语法备忘单

> 原文：<https://betterprogramming.pub/the-advanced-yaml-syntax-cheatsheet-f860043decb4>

## 查看验证器、解析器、分隔符、指令等等

![](img/773ced76b622712304c8fcf65630e420.png)

作者照片。

YAML (YAML 不是标记语言)是一种数据序列化语言，用于创建键值对配置文件和应用程序 API。它是 JSON 的超集，使用换行符和空白进行格式化，以提高可读性。

虽然不是日常使用的技术，但它是 Ansible 等许多现代技术的重要基础，因此是高薪开发人员角色的先决条件。

今天，我们将帮助你完善你的 YAML 知识，这样你就能给下一位面试官留下深刻印象。

新来 YAML 吗？在继续之前，你可能想让[快速浏览一下这篇文章](/yaml-tutorial-get-started-with-yaml-in-5-minutes-549d462972d8)。

以下是我们今天要讲的内容:

*   验证器和解析器
*   锚点和别名
*   计划
*   转义序列
*   分隔符和指令
*   包扎

# 验证器和解析器

虽然 YAML 比 XML 可读性更好，但是很容易忽略格式错误，比如多行部分的空格数或者忘记换行符。这可能会给 YAML 解析器带来巨大的错误，该解析器会将 YAML 解释成更多机器可读的动作。

手工很难发现解析错误，所以许多开发人员选择使用 web 验证器或 linter。这些工具会检查您的 YAML 文档并突出显示任何潜在的错误，以确保您在投入使用之前拥有有效的 YAML。

最流行的验证器是 YAMLLint，这是一个免费的开源工具，可以在你的浏览器或 GitHub 上找到。YAMLLint 被认为是最方便的 linter，因为它提供了错误高亮、复制/粘贴 YAML 的自动格式化和自动纠正选项。

# 锚点和别名

锚和别名是 YAML 构造，允许您减少重复语法并扩展现有数据节点。您可以在实体上放置锚点(`&`)来标记多行部分。然后，您可以使用别名(`*`)在文档中调用该锚来引用该部分。锚点和别名对大型项目非常有帮助，因为它们减少了额外线条造成的视觉混乱。

别名本质上充当“见上”命令，使程序暂停标准遍历，返回到锚点，然后在完成锚定部分后继续标准遍历。如果你熟悉面向对象的编程设计，你会对锚有宾至如归的感觉。

下面，`build-test`锚从第 3 行开始，在第 13 行和第 15 行被别名调用:

# 覆盖和扩展

您也可以通过在别名前输入`<<:`来调整锚。在这下面，你可以写下任何想要的改变。如果新映射具有相同的名称，映射将被覆盖；如果名称不同，映射将在以后添加。

# 计划

模式是 YAML 1.2 中的规则集，它告诉加载器/解析器 YAML 文件的每个部分在实际命令中转换成什么。它们本质上是一组用于处理人类可读的 YAML 标签的`if` / `then`语句的集合。例如，YAML 核心模式声明`!!str my string`和`my string`是等价的，应该被解析为相同的动作。

通用 YAML 有一个默认的模式，而许多特殊用途的模式适合某些特殊的场景。您甚至可以在 JSON 模式存储上创建自己的定制模式或下载其他用户的模式。

当配置文件包含自定义对象时，或者如果您希望创建特定于语言的对象序列化，自定义架构会很有帮助。

YAML 的三种默认模式是:

*   Failsafe —一个极简模式，只支持字符串(`!!str`)、映射(`!!map`)和序列(`!!seq`)标签。由于其简单性，Failsafe 保证可以与任何 YAML 文档一起工作，但是它不支持任何复杂的标签。
*   JSON:一个基础模式，旨在可靠地解析等价的 YAML 和 JSON 文件，得到相同的最终结果。这是最常用的模式，也是大多数模式的起点。它支持所有故障保护标签，以及布尔(`!!bool`)、空(`!!null`)、整数(`!!int`)和浮点(`!!float`)。
*   核心:默认的 YAML 模式，在 YAML 端扩展了匹配标准。它本质上是 JSON 模式的一个不那么固执己见的版本。例如，JSON 接受符合标准“匹配:`true` | `false`”的布尔值。相比之下，Core 的布尔接受形式如下:"`true`|`True`|`TRUE`|`false`|`False`|`FALSE`"

# 转义序列

YAML 的可读语法之所以可行，是因为它在方括号或花括号之类的行内语法标记上使用了缩进和空白。然而，在引号标量中使用特殊字符时，这可能会变得很困难。

YAML 提供了转义序列，允许您指示字符应该被解释为特殊字符还是标量的一部分。例如，您可以使用`&#x20;`转义一个空格，以创建一个值为`“ “`的字符串。

转义序列有三种类型:

*   实体转义，这允许您通过空格(`&#x20;`)、冒号(`&#58;`)或&符号(`&amp;`)来使用语法上重要的字符。
*   Unicode 转义，它允许您通过直接从键值对的 Unicode 列表中调用它们的惟一键来添加空格(`\u0020`)、单引号(`\u0027`)或双引号(`\u0022`)。
*   引用转义，允许您使用附加引号显示引用的句子。例如，双引号可以显示在单引号(`‘ “quote” ’`)中，嵌套在另一组双引号(`“abc “quote” cba”`)中，或者嵌套在单引号(`‘ ‘quote’ ’`)中。

注意:YAML 转义序列的完整列表可以在官方的 YAML 规范中找到。

# 分隔符和指令

你可能已经注意到所有的 YAML 文档都是以`---`开头的。这通知解析器这个数据是一个单独的块，但是为了提高效率，它是作为同一个请求的一部分发送的。

另一个更高级的分隔符是`...`，它标志着一个文档的结束。文档结束分隔符后面必须跟有文档开始分隔符(`---`)或一组指令。指令是由`%`标记的已定义设置，位于文档之前，其后是`---`。

这意味着需要`...`和`---`来标记指令空间的边界。当前的两个指令是`%YAML`，它允许您为即将到来的文档设置 YAML 版本，以及`%TAGS`，它允许您为将在文档中使用的标签创建定制的快捷方式。

指令只在特殊情况下有用，比如使用一个太大而无法更新的旧 YAML 文档。通常，您不需要指令或文档分隔符。

```
doc 1 
... %TAG !foo! !foo-types/ -------- doc 2
```

# 时间戳

Timestamp 是一种有用的数据类型，它允许您将时间存储为一个单元，而不是不同数字的集合。它由`!!timestamp`数据标签标记，可以保存各种级别的特异性，例如简单(`yyyy/mm/dd`)或精确到几分之一秒(`2001-12-15T2:59:43.10`)。你也可以用空格分隔日期和时间，让时间戳更易读，就像`2001-12-15 2:59:43.10`。

所有时间戳都记录为协调世界时(UTC ),除非在时间戳末尾指定了另一个时区。您可以通过包括比 UTC 早或晚多少小时来定义时区。

例如，我可以将时间戳设置为太平洋标准时间(PST ),并在末尾加上一个`-8`:

```
2001-12-15 2:59:43.10 -8`.
```

这类似于 JavaScript 或 Python 等流行编程语言中使用的`DateTime`，除了它如何处理时区。`DateTime`默认记录主机服务器时区中列出的时间。

如果使用本地时区之外的网络，这可能会导致问题。每次调用日期时，计算机都需要转换为 UTC，然后转换为目标时区，从而降低了处理速度。

# 包扎

干得好，解决了这个高级 YAML 语法。虽然 YAML 可能看起来像是一个利基技能，但它是市场上许多工作的先决条件。然而，大多数编码面试不会包括 YAML。

展示你的 YAML 知识的最好方式是在一个组合项目中使用它，或者能够展示过去使用该技术的经验。

快乐学习！