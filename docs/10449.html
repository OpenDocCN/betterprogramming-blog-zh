<html>
<head>
<title>My Top 10 Pandas Functions for Preparing Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的10大熊猫函数用于准备数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/my-top-10-pandas-functions-for-preparing-data-3ec7a1451a84?source=collection_archive---------4-----------------------#2022-01-08">https://betterprogramming.pub/my-top-10-pandas-functions-for-preparing-data-3ec7a1451a84?source=collection_archive---------4-----------------------#2022-01-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b089" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">因为我想用尽可能少的工作创建有用、准确的分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/15c50d1e6fd83b6802bc88fb5dd8aaa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7j-hIVG0r_9NR_Si"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sincerelymedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">真诚媒体</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6900" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">遗憾的是，对数据集进行有用的分析很少像将数据下载到您选择的平台、创建一些图表或指标，并使用结果来帮助和通知决策制定这样简单。</p><p id="e387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据是杂乱的，它来自多个地方，可能充满噪音或完全缺失。有时我们需要创建新的列，设置标志，或者删除特定的行，然后才能进入下一步。</p><p id="757f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是来自熊猫图书馆的10个操作，至少在我写的每一个脚本中都出现了一个，如果不是更多的话。虽然这些操作中的许多都可以在excel中完成，但是为什么不让熊猫帮你完成这些艰苦的工作呢？</p><h1 id="6c0a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak"> 1。将表格合并在一起</strong></h1><p id="4035" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可能需要连接查找表中的数据，或者根据一些共同的东西(如名称或时间戳)将多个来源合并到一个地方。类似于excel中的<code class="fe ms mt mu mv b">vlookup</code>,但可以在大型数据集上快速完成，用一个命令连接多个列。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="75df" class="na lw it mv b gy nb nc l nd ne">df3 = pd.merge(df1,df2, on = 'Datapoint', how = 'left')</span></pre><p id="42e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于开始合并的更多信息，请参考我以前的<a class="ae ky" href="https://medium.com/@hollydalligan/vlookups-are-cancelled-why-python-pandas-are-a-much-better-way-to-merge-data-dbce0126166a" rel="noopener">文章</a>。</p><h1 id="723d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak"> 2。堆叠数据帧</strong></h1><p id="b2c0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">当列名匹配时，垂直堆栈工作得最好。例如，您可能在不同的时间填写了许多excel模板，通过将它们连接起来，您可以将它们都放在一个地方，以备查询。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="b6d8" class="na lw it mv b gy nb nc l nd ne">vertical_stack = pd.concat([df1, df2], axis=0)    </span></pre><h1 id="b8cb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak"> 3 </strong>。<strong class="ak">用零替换空值或NaNs</strong></h1><p id="aa51" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">根据您的数据源，空白记录可能显示为null或<code class="fe ms mt mu mv b">NaN</code>(不是数字)，实际上，可能意味着缺少记录，或者可能意味着“没有”或零。重要的是要检查和澄清，以免不正确地歪曲你的结果。</p><p id="8f41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在一次分析多个数据集时尤其重要，因为不同数据集的定义可能不同。不幸的是，如果你做一些数值运算，比如求和，并且该列至少包含一个NaN，熊猫就不会玩球。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="d58d" class="na lw it mv b gy nb nc l nd ne"># change null to 0 <br/>df5.loc[df5['column1'].isnull(),   'column1'] = 0</span><span id="7857" class="na lw it mv b gy nf nc l nd ne"># change nan to 0 <br/>df['column1'] = df['column1'].fillna(0)</span></pre><p id="6b9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的例子用0填充，但是你可以用任何你想要的填充。</p><h1 id="6fa0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">4.删除缺少数据或包含nan的行</h1><p id="7253" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">与其替换丢失的值或NaN，您可能希望将它们完全删除。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="a967" class="na lw it mv b gy nb nc l nd ne">df.dropna(axis=0, how="any", inplace=True)</span></pre><p id="a7d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">语法<code class="fe ms mt mu mv b">how=’any’</code>删除<em class="ng">中至少有一列</em>有缺失/ NaN数据的行。您还可以编辑输入以删除以下行:</p><p id="8bd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">-有<em class="ng">所有</em>列缺失/ NaN <br/> -有<em class="ng">至少x个</em>列缺失/ NaN <br/> -有<em class="ng">特定</em>列缺失/ NaN</p><p id="750e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加<code class="fe ms mt mu mv b">axis = 1</code>将应用相同的方法，但是应用于列而不是行。一篇包含更多信息的精彩文章可以在<a class="ae ky" href="https://towardsdatascience.com/how-to-drop-rows-in-pandas-dataframes-with-nan-values-in-certain-columns-7613ad1a7f25" rel="noopener" target="_blank">这里</a>找到。</p><h1 id="fedd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak"> 5。删除前导和尾随空格</strong></h1><p id="35e0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">值前或值后的空格会非常烦人，尤其是当你意识到它们时已经太晚了。下面的代码去掉了这两个部分，运行起来很快，如果我打算使用字符串搜索或其他依赖于格式一致性的东西，我会尝试使用并记住作为标准来运行它。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="37a4" class="na lw it mv b gy nb nc l nd ne">df1['State'] = df1['State'].str.strip()</span></pre><h1 id="2c43" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak"> 6。检查缺失的时间戳或行</strong></h1><p id="942d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">信号丢失、错误、文件放错地方都会导致数据丢失。这些行可能仍然存在空值，或者它们可能完全丢失。时间序列数据的一个示例是:如果系统每分钟记录一次，但暂停了5分钟，则这5分钟可能会显示为时间戳，或者完全消失并显示为时间跳跃。</p><p id="6881" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您知道您的输出集应该是什么样子，您可以创建一个虚拟集，然后将您的实际数据加入其中；比较两者，了解什么是现在，什么不是。</p><p id="0de9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不仅仅适用于时间序列，例如，您可能从数百个不同的资产中收集数据，很难通过肉眼轻易看出是否有任何数据丢失。加入到你已知的资产列表中，将很容易突出任何没有包括在内的资产。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="8caf" class="na lw it mv b gy nb nc l nd ne">time_range = pd.date_range(startdate , enddate, freq='1min')<br/>         ts =   pd.DataFrame(time_range)<br/>         ts.rename(columns = {ts.columns[0]:'timestamp'},   inplace = True)<br/>## now complete a merge to join the sets together</span></pre><h1 id="f6d9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">7。删除重复</h1><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4359" class="na lw it mv b gy nb nc l nd ne">df.drop_duplicates(subset=['PersonId', 'RecordDate'], keep='last')</span></pre><p id="5819" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个不言自明。将此与排序结合起来，智能地删除某些重复项(例如最早或最新的记录)。</p><h1 id="eeea" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">8.基于多个条件设置新的列值</h1><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="cf53" class="na lw it mv b gy nb nc l nd ne">df.loc[(df.AvgProduction&gt; 1000000) &amp; (df.Age &gt; 5), 'Category'] = 'Priority 1'</span></pre><p id="78ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用按位运算符(&amp; and |而不是<code class="fe ms mt mu mv b">AND</code>和<code class="fe ms mt mu mv b">OR</code>)构建您需要的任何标准。</p><h1 id="e663" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">9.基于字符串匹配过滤数据</h1><p id="4eac" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">您可能只对分析特定的资产类型感兴趣，或者从第8点开始，您可能已经设定了识别“可能的错误数据”的标准。现在很容易隔离这些记录，以便进一步调查或删除。</p><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="c8e9" class="na lw it mv b gy nb nc l nd ne">df1 = df[df[‘Flag’].str.contains(“CHECK ME NOW”)]</span></pre><p id="8a9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以过滤现有的<code class="fe ms mt mu mv b">DataFrame</code>，或者将过滤后的数据插入新的【】(如上图)。</p><h1 id="7007" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">10。跨列聚合</h1><pre class="kj kk kl km gt mw mv mx my aw mz bi"><span id="4540" class="na lw it mv b gy nb nc l nd ne">df['StateAverage'] = df_mo[['school1', 'school2','school3', 'school4']].mean(axis=1)</span></pre><p id="700a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">平均值、总和、最大值/最小值通常是我们在后面的分析中使用的信息。通常在excel中手动完成这一步骤，效果很好。但是，如果这是一个可重复的过程(如月度报告),或者如果它是一个加载到excel中很慢或不切实际的大型数据集，那么在pandas中这样做尤其有意义。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="89e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我常用的一些操作，希望对你有用。感谢阅读。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><div class="kj kk kl km gt no"><a href="https://medium.com/@hollydalligan/membership" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">通过我的推荐链接加入Medium-Holly Dalligan</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ks no"/></div></div></a></div></div></div>    
</body>
</html>