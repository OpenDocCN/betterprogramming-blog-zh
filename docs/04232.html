<html>
<head>
<title>A Hands-On Guide to Container Orchestration With Docker Swarm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker Swarm容器编排实践指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/hands-on-guide-containers-orchestration-with-docker-swarm-27b3d64826c9?source=collection_archive---------7-----------------------#2020-03-31">https://betterprogramming.pub/hands-on-guide-containers-orchestration-with-docker-swarm-27b3d64826c9?source=collection_archive---------7-----------------------#2020-03-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a9f0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">熟悉Docker</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cf29d49e2afe8793d0f9fad6af9e9385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eVY-TcTQ8isILMsLy0wGBA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">码头工人群</p></figure><p id="bb7a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">容器已经成为当今IT和软件行业中最流行的概念之一。在行业层面，需要快速部署高度可用和可伸缩的应用程序。这就是像Docker Swarm或Kubernetes这样的容器编排系统发挥作用的地方。</p><p id="dd4b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">像往常一样，这篇文章将是一个循序渐进的实践指南。我们还将利用我们在<a class="ae lr" href="https://medium.com/@mewejp/how-to-build-and-publish-a-spring-boot-apps-image-using-dockerfile-28d0d1b3940e" rel="noopener">上一篇文章</a>中构建的图像。</p><p id="803c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我们将:</p><ul class=""><li id="843c" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">建立一个Docker集群</li><li id="1528" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">使用命令行和Docker编写YAML文件来部署服务</li><li id="6bff" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">展示部署的应用程序的高可用性</li><li id="5adb" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq lx ly lz ma bi translated">使用<a class="ae lr" href="https://github.com/dockersamples/docker-swarm-visualizer" rel="noopener ugc nofollow" target="_blank"> Docker Swarm Visualizer </a>查看集群节点和服务</li></ul><p id="3b5a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在开始设置我们的环境和在集群中部署应用程序之前，让我们先定义一些贯穿本文的基本术语。如果你只对例子感兴趣，你可以跳过介绍。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="f019" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">介绍</h1><h2 id="7013" class="nf mo iq bd mp ng nh dn mt ni nj dp mx le nk nl mz li nm nn nb lm no np nd nq bi translated">Docker容器编排或Docker群</h2><p id="b354" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">Docker引擎内置的集群管理和编排功能被称为<em class="nw"> Docker Swarm。</em>它在Docker社区和企业版中都有提供。Docker主机或节点的群集群是以群模式运行的高可用性服务器集群。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/43f8eb3a879ef247d6c38f4d0d222e31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXukk6ijtqSNNgueDa6B_g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">群集节点和服务概述</p></figure><h2 id="5486" class="nf mo iq bd mp ng nh dn mt ni nj dp mx le nk nl mz li nm nn nb lm no np nd nq bi translated">结节</h2><p id="a916" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">一个<em class="nw">节点</em>是一个物理主机，或者它可以是云中的一个虚拟机，或者是运行Docker的虚拟机管理程序。管理器节点根据服务副本的数量向工作器分配任务。</p><h2 id="ac9c" class="nf mo iq bd mp ng nh dn mt ni nj dp mx le nk nl mz li nm nn nb lm no np nd nq bi translated">服务</h2><p id="f46f" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">一个<em class="nw">服务</em>是在管理器或工作者节点上执行的任务的定义。这是swarm系统的中心结构，也是用户与Swarm交互的主要根源。</p><h2 id="2e5d" class="nf mo iq bd mp ng nh dn mt ni nj dp mx le nk nl mz li nm nn nb lm no np nd nq bi translated">工作</h2><p id="2269" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">一个<em class="nw">任务</em>携带一个Docker容器和在容器内运行的命令。</p><h2 id="63a7" class="nf mo iq bd mp ng nh dn mt ni nj dp mx le nk nl mz li nm nn nb lm no np nd nq bi translated"><strong class="ak"> Docker撰写</strong></h2><p id="8673" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">根据官方文件:</p><blockquote class="ny nz oa"><p id="03fe" class="kv kw nw kx b ky kz jr la lb lc ju ld ob lf lg lh oc lj lk ll od ln lo lp lq ij bi translated">Docker Compose是一个用于定义和运行多容器Docker应用程序的工具。使用Compose，您可以使用YAML文件来配置应用程序的服务。然后，只需一个命令，您就可以从您的配置中创建和启动所有服务。”</p></blockquote><p id="850d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<a class="ae lr" href="https://docs.docker.com/engine/swarm/key-concepts/" rel="noopener ugc nofollow" target="_blank">官方文档</a>中了解更多基础术语。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="4a80" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">环境设置</h1><p id="35a7" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">我的设置包括:</p><ol class=""><li id="684b" class="ls lt iq kx b ky kz lb lc le lu li lv lm lw lq oe ly lz ma bi translated">在VMware Fusion中运行的三台虚拟机(VM)。我们可以安装任何虚拟机管理程序(VMware Workstation、Hyper-V等。).我选择将我的虚拟机命名为<code class="fe of og oh oi b">DC-N1</code>、<code class="fe of og oh oi b">DC-N2</code>和<code class="fe of og oh oi b">DC-N3</code>，就像“Docker集群节点1、2和3”你可以随意命名你的主机。</li><li id="ad7c" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq oe ly lz ma bi translated">每个虚拟机都安装了Ubuntu server OS 18.04.3(可以安装任何系统)。</li><li id="f9dc" class="ls lt iq kx b ky mb lb mc le md li me lm mf lq oe ly lz ma bi translated">每个虚拟机都安装了Docker。如果您没有Docker，请从<a class="ae lr" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank">这个网站</a>下载并在您的系统上安装Docker。</li></ol><p id="5b67" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是我在VMware Fusion中设置的虚拟机。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/7ccf133aa105f65b1a1ab265ccdb5642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GogGPk7x784evohuuC0p6Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">集群节点配置</p></figure><p id="923d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面的屏幕显示了我的每台主机中的Docker版本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/28bab89f4c87f01d35c2bc25cbf16645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zL8ShQqoQlXgutyh3edRew.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Docker引擎版本</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="52c4" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">初始化集群</h1><p id="42c9" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">设置和配置Docker群组非常简单。首先要做的是初始化Docker Swarm集群。打开一个Bash终端，在第一个节点或选择作为管理器的节点中键入下面的命令。在我们的例子中，我们将选择<code class="fe of og oh oi b">DC-N1</code> <strong class="kx ir"> </strong>作为管理节点。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="a248" class="nf mo iq oi b gy op oq l or os">docker swarm init</span></pre><p id="b357" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你的结果可能和我的相似。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="09d2" class="nf mo iq oi b gy op oq l or os"><strong class="oi ir">scalp@dcn1</strong>:<strong class="oi ir">~</strong>$ docker swarm init</span><span id="10fe" class="nf mo iq oi b gy ot oq l or os">Swarm initialized: current node (v375eb32g1k7vlm5uh96yzxhg) is now a manager.</span><span id="0d4c" class="nf mo iq oi b gy ot oq l or os">To add a worker to this swarm, run the following command:</span><span id="989f" class="nf mo iq oi b gy ot oq l or os">docker swarm join --token SWMTKN-1-1rgg6ldnnblce80kuyfdnpx9cvvdoymy0uouiyk65nv2b8i4gi-dywj1wnks23dzwvf2vr2aqiic 172.16.203.138:2377</span><span id="efde" class="nf mo iq oi b gy ot oq l or os">To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.</span></pre><p id="8468" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的结果告诉我们Swarm模式已经初始化，这个节点(主机)现在是管理器。它还向我们展示了如何加入这个集群中的工人。</p><p id="35c7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这样，我们就创建了我们的集群。让我们通过键入Bash终端来验证节点。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="dcf4" class="nf mo iq oi b gy op oq l or os">docker node ls</span></pre><p id="5736" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你的结果可能和我的类似。它告诉我们该节点是一个管理器并且是活动的。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="87fa" class="nf mo iq oi b gy op oq l or os"><strong class="oi ir">scalp@dcn1</strong>:<strong class="oi ir">~</strong>$ docker node ls</span><span id="3c34" class="nf mo iq oi b gy ot oq l or os">ID  HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS  ENGINE VERSION</span><span id="9a35" class="nf mo iq oi b gy ot oq l or os">v375eb32g1k7vlm5uh96yzxhg *   dcn1  Ready Active   Leader  19.03.5</span></pre><p id="5354" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，让我们向集群添加其他节点(工作节点)。</p><p id="097f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">提示:</strong>如果您没有为了添加一个worker而复制上面的Swarm初始化命令的结果，您仍然可以通过运行下面的命令来显示它，以带回指令。运行后我们要做的就是复制命令并粘贴到其他节点。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="5c9b" class="nf mo iq oi b gy op oq l or os"><strong class="oi ir">scalp@dcn1</strong>:<strong class="oi ir">~</strong>$ docker swarm join-token worker</span><span id="6f92" class="nf mo iq oi b gy ot oq l or os">To add a worker to this swarm, run the following command:</span><span id="3f8d" class="nf mo iq oi b gy ot oq l or os">docker swarm join --token SWMTKN-1-1rgg6ldnnblce80kuyfdnpx9cvvdoymy0uouiyk65nv2b8i4gi-dywj1wnks23dzwvf2vr2aqiic 172.16.203.138:2377</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="4c21" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">将其他节点加入集群</h1><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="a5dd" class="nf mo iq oi b gy op oq l or os"><strong class="oi ir">scalp@dcn2</strong>:<strong class="oi ir">~</strong>$ docker swarm join --token SWMTKN-1-1rgg6ldnnblce80kuyfdnpx9cvvdoymy0uouiyk65nv2b8i4gi-dywj1wnks23dzwvf2vr2aqiic 172.16.203.138:2377</span><span id="100b" class="nf mo iq oi b gy ot oq l or os">This node joined a swarm as a worker.</span><span id="d461" class="nf mo iq oi b gy ot oq l or os"><strong class="oi ir">scalp@dcn3</strong>:<strong class="oi ir">~</strong>$ docker swarm join --token SWMTKN-1-1rgg6ldnnblce80kuyfdnpx9cvvdoymy0uouiyk65nv2b8i4gi-dywj1wnks23dzwvf2vr2aqiic 172.16.203.138:2377</span><span id="9e14" class="nf mo iq oi b gy ot oq l or os">This node joined a swarm as a worker.</span></pre><p id="918e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">既然另外两个节点已经加入了集群，让我们回到管理节点，再次键入<code class="fe of og oh oi b">docker node ls</code>。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="3cd6" class="nf mo iq oi b gy op oq l or os"><strong class="oi ir">scalp@dcn1</strong>:<strong class="oi ir">~</strong>$ docker node ls</span><span id="0e99" class="nf mo iq oi b gy ot oq l or os">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><span id="0414" class="nf mo iq oi b gy ot oq l or os">v375eb32g1k7vlm5uh96yzxhg *   dcn1                Ready               Active              Leader              19.03.5</span><span id="fce0" class="nf mo iq oi b gy ot oq l or os">fnb1v6vstratuscp2f6ysqow8     dcn2                Ready               Active                                  19.03.5</span><span id="83d4" class="nf mo iq oi b gy ot oq l or os">ue1jk0odnt0ldm4xk9d2o3kc0     dcn3                Ready               Active                                  19.03.5</span></pre><p id="38c9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以注意到我们有三个节点:一个管理节点和两个工作节点——它们都是活动的。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="497f" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">部署服务</h1><p id="85be" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">为了部署一个高度可用和可伸缩的应用程序，我们将使用一个服务。我们将使用的图片来自发布到Docker Hub的<a class="ae lr" href="https://medium.com/@mewejp/how-to-build-and-publish-a-spring-boot-apps-image-using-dockerfile-28d0d1b3940e" rel="noopener">上一期教程</a>。</p><p id="02b6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在manager节点(<code class="fe of og oh oi b">DC-N1</code>)中，打开一个Bash终端并输入下面的命令，这将创建一个名为<code class="fe of og oh oi b">appsvc</code>的服务，它有六个副本并使用映像<code class="fe of og oh oi b">pasciano007/sample:1.0</code>。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="55f1" class="nf mo iq oi b gy op oq l or os">docker service create --name appsvc --replicas=6 --publish published=8080,target=8080  pasciano007/sample:1.0</span></pre><h2 id="bbde" class="nf mo iq bd mp ng nh dn mt ni nj dp mx le nk nl mz li nm nn nb lm no np nd nq bi translated">查看结果</h2><p id="33a5" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">要查看新创建的服务，请在节点3中键入以下命令。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="1397" class="nf mo iq oi b gy op oq l or os">docker service ls</span></pre><p id="6424" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要查看每个节点中创建的容器，请运行以下命令:</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="26f5" class="nf mo iq oi b gy op oq l or os">docker ps</span></pre><p id="2252" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你的结果可能和我的相似。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/089ecfe1a13b4387ae75358eee472d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MCzMMx7Jq5ZMNw3mdAzmXw.png"/></div></div></figure><p id="3265" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用端口8080上的任何节点IP地址，可以在浏览器中访问部署的高度可用和可扩展的应用程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/9e359a3485671a77ae1c9099bd9753ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1bbOEZgo6Auh_KShA-dMg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在浏览器中访问部署的应用程序</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="e444" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">使用Docker Swarm Visualizer查看节点</h1><p id="7f54" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">为了获得我们的Swarm集群节点的图形视图，我们可以使用开源的Docker Swarm Visualizer。</p><p id="5637" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">运行Docker Swarm Visualizer最简单的方法是在容器中运行它。只需在您的管理器节点(<code class="fe of og oh oi b">DC-N1</code>)中运行以下命令。由于端口8080已经被前面的部署使用，我们将把端口5000暴露给Docker Swarm Visuailzer容器的主机。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="e2bb" class="nf mo iq oi b gy op oq l or os">docker run -it -d -p 5000:8080 -v /var/run/docker.sock:/var/run/docker.sock dockersamples/visualizer</span></pre><p id="e46b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们可以使用manager节点的IP地址在浏览器中查看我们的集群节点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/7152e51ab151a5b4b49b687dfd87fd67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuKZuLyKHLLPlfMD-Jd0Hw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Docker Swarm Visualizer显示集群节点和服务</p></figure><h2 id="4af9" class="nf mo iq bd mp ng nh dn mt ni nj dp mx le nk nl mz li nm nn nb lm no np nd nq bi translated">使用UCP管理节点</h2><p id="e2f7" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">如果你有Docker的企业版，那么<a class="ae lr" href="https://docs.docker.com/ee/ucp/" rel="noopener ugc nofollow" target="_blank">通用控制平面</a>是内置的。这是在浏览器中管理整个集群的一种更强大的方式。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="e12c" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">部署服务的最佳和最专业的方式</h1><p id="e755" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">在企业级，服务的部署是使用一个<code class="fe of og oh oi b">docker-compose</code> <strong class="kx ir"> </strong> YAML <strong class="kx ir"> </strong>文件或<code class="fe of og oh oi b">docker-stack</code> YAML文件来完成的。我们可以在一个<code class="fe of og oh oi b">docker-compose.yml</code>文件中创建服务，而不是运行上述所有命令来创建服务。Spring Boot应用程序和Docker Swarm Visualizer可以一次性部署。</p><p id="7976" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面完整的<code class="fe of og oh oi b">docker-compose</code> YAML文件展示了如何部署服务。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ox oy l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">docker-compose.yml</p></figure><p id="0d25" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要部署服务，打开Bash终端并运行以下命令:</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="af67" class="nf mo iq oi b gy op oq l or os">docker stack deploy --compose-file docker-compose.yml appstack</span></pre><p id="fe94" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在Docker Swarm Visualizer中查看创建的服务:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/1c8fc8d957b9aa08a2a885b841c1cb2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SATGTJF_oaXYHwOKoPd_hg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Sprint Boot app服务和Docker Swarm Visualizer服务</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="3e6e" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">高可用性演示</h1><p id="63f6" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">为了展示我们集群的高可用性，我们将模拟一次故障。为此，让我们通过在节点3中运行下面的命令来停止在节点3中运行的Docker服务(<code class="fe of og oh oi b">DC-N3</code>)。询问时键入您的密码。</p><pre class="kg kh ki kj gt ol oi om on aw oo bi"><span id="555a" class="nf mo iq oi b gy op oq l or os">sudo systemctl stop docker</span></pre><p id="3d6e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，Docker Swarm可视化工具如下所示。正如我们所看到的，节点3中的红色表示该节点有问题。在我们的例子中，Docker守护进程已经停止。</p><p id="f2ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是Docker能够重启在节点3上运行的所有三个服务，并将它们分布在节点1和节点2上的集群中，因此我们仍然可以拥有在部署服务时设置的六个副本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/4527ac130965015efa82a211d130d042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XSCXdtrgC2JzximCgMXzkg.png"/></div></div></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="2bf2" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">结论</h1><p id="8beb" class="pw-post-body-paragraph kv kw iq kx b ky nr jr la lb ns ju ld le nt lg lh li nu lk ll lm nv lo lp lq ij bi translated">哎呀！仅此而已。我们已经到了尽头。</p><p id="3a26" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢你的时间，我希望你能从这篇文章中学到一些东西。接下来，我将发表另一篇文章，展示如何在一个<a class="ae lr" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>集群中做同样的事情。</p></div></div>    
</body>
</html>