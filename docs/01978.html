<html>
<head>
<title>Flutter Automated Tests — Getting Started</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振自动测试——开始</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/flutter-automated-tests-get-started-424aec9430b3?source=collection_archive---------9-----------------------#2019-10-28">https://betterprogramming.pub/flutter-automated-tests-get-started-424aec9430b3?source=collection_archive---------9-----------------------#2019-10-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="656d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">自动化单元和部件测试一览</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e05b1ef3cd664f577a430853859e8fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o9YAsoC1gST26b3wVNnsGg.jpeg"/></div></div></figure><p id="4493" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">软件开发中的自动化测试有助于你在发布应用程序之前发现它的错误和其他问题。这对于大型应用程序尤其有用，因为手动测试每个部分是不可能的。</p><p id="01f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">幸运的是，Flutter有不同类型的测试可供我们选择。</p><ul class=""><li id="5b1d" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><a class="ae lw" href="https://flutter.dev/docs/testing#unit-tests" rel="noopener ugc nofollow" target="_blank">单元测试</a></li><li id="b515" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://flutter.dev/docs/testing#widget-tests" rel="noopener ugc nofollow" target="_blank">小工具测试</a></li><li id="3145" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://flutter.dev/docs/testing#integration-tests" rel="noopener ugc nofollow" target="_blank">集成测试</a></li></ul><p id="fac6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我们将关注单元和小部件测试。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="ef68" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">单元测试</h1><p id="caaf" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nd lc ld le ne lg lh li nf lk ll lm ij bi translated">单元测试是将你的代码分解成简单的部分(单元)<em class="ng">，</em>，然后这些部分被测试。这些单元通常是函数、方法、类，甚至是变量。我们来试试吧！</p><p id="8183" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，您应该将<a class="ae lw" href="https://api.flutter.dev/flutter/flutter_test/flutter_test-library.html" rel="noopener ugc nofollow" target="_blank"> <em class="ng"> flutter_test </em> </a>包安装在您的<code class="fe nh ni nj nk b">pubspec.yaml</code>文件中的开发依赖项中。</p><p id="8068" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你正在构建一个不依赖于Flutter的<a class="ae lw" href="https://dart.dev/" rel="noopener ugc nofollow" target="_blank"> Dart </a>应用，你可以安装<a class="ae lw" href="https://github.com/dart-lang/test" rel="noopener ugc nofollow" target="_blank">测试</a> <strong class="kt ir"> <em class="ng"> </em> </strong>包作为开发依赖。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/86531975344aadc7ea45479c343078fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*7Z8L9vUu3TMo7RCFWBaOCQ.png"/></div><p class="nm nn gj gh gi no np bd b be z dk translated">颤振_测试依赖。</p></figure><p id="134a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，用你想要测试的代码创建一个类，我把它命名为mine <code class="fe nh ni nj nk b">we.dart</code> <strong class="kt ir"> <em class="ng">，</em> </strong>，<strong class="kt ir"> <em class="ng"> </em> </strong>也为这个类创建了测试文件，我把它命名为mine <code class="fe nh ni nj nk b">we_test.dart</code>。<strong class="kt ir"> <em class="ng"> <br/> </em> </strong>你的代码所在的文件可以在<code class="fe nh ni nj nk b">lib/</code> <strong class="kt ir"> </strong>文件夹中，你的测试应该在根目录下的<code class="fe nh ni nj nk b">tests/</code> <strong class="kt ir"> </strong>文件夹中。</p><p id="0f42" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们要测试的类中的代码如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/7b6e8ca091fca0591696c3b840835252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDmSzM_suy_dKxd5xuLYEw.png"/></div></div><p class="nm nn gj gh gi no np bd b be z dk translated">我们要测试的代码we.dart</p></figure><p id="a17a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里，我们有一个简单的类，有一个方法和一个字符串实例。调用字符串<code class="fe nh ni nj nk b">text</code> <strong class="kt ir"> <em class="ng"> </em> </strong>后，应该使用传递给<code class="fe nh ni nj nk b">populateText()</code> <strong class="kt ir"> </strong>方法的参数之和对其进行编辑。</p><p id="d81f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的测试文件如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/03705f851233107346f57313518f8d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TTBd4tVmCmOSvpuh0p7GIg.png"/></div></div><p class="nm nn gj gh gi no np bd b be z dk translated">我们的测试文件we_test.dart</p></figure><p id="6ae5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们导入flutter_test包和我们想要测试的类。然后，我们开始写作。</p><p id="ff70" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们从flutter_test包中的<code class="fe nh ni nj nk b">test()</code> <strong class="kt ir"> </strong>方法开始。该方法接受两个参数。第一，测试的描述，第二，运行测试的函数。</p><p id="bfdb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里，我们首先将导入的类<code class="fe nh ni nj nk b">WeTest()</code> <em class="ng">，</em>设置为一个变量，然后我们调用<code class="fe nh ni nj nk b">populateText</code>方法，传入两个和三个参数。因此，我们期望求和的结果是5。</p><p id="97da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们从flutter_test调用<code class="fe nh ni nj nk b">expect()</code>方法，该方法用于<em class="ng">断言</em> <strong class="kt ir"> </strong>我们正在测试的单元与代码运行时返回的匹配。这两个分别称为<em class="ng">实际</em>和<em class="ng">匹配器</em>。</p><p id="8829" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果它们匹配，那么我们的测试通过，如果不匹配，那么测试失败。</p><h2 id="bee8" class="ns mk iq bd ml nt nu dn mp nv nw dp mt la nx ny mv le nz oa mx li ob oc mz od bi translated">运行测试</h2><p id="4f03" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nd lc ld le ne lg lh li nf lk ll lm ij bi translated">您可以通过打开测试文件(<code class="fe nh ni nj nk b">we_test.dart</code>)来运行测试，然后在<a class="ae lw" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>上从调试器运行debug。</p><p id="0b1b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者，在您的终端中运行<code class="fe nh ni nj nk b">flutter test test/we_test.dart</code>。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="44fb" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">小部件测试</h1><p id="772a" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nd lc ld le ne lg lh li nf lk ll lm ij bi translated">小部件测试正如它们所暗示的那样:<em class="ng">测试小部件。</em></p><p id="3988" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">小部件测试不同于单元测试，因为它们需要与单元测试中不同的类和函数。这些工具是<code class="fe nh ni nj nk b">flutter_test</code>包的一部分。</p><p id="392c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们开始吧！</p><p id="427b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此时，您应该已经通过您的<code class="fe nh ni nj nk b">pubspec.yaml</code> <em class="ng"> </em>文件安装了<code class="fe nh ni nj nk b">flutter_test</code>包。</p><p id="cf36" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们需要小部件进行测试，因此我们将创建一个包含一些简单小部件的屏幕:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/7eac9e9b445c4613e8d2cedad5872d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5AGOHjeBi48gBtP4gyQz5g.png"/></div></div><p class="nm nn gj gh gi no np bd b be z dk translated">屏幕上有我们的小工具。</p></figure><p id="30b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">输出是一个带有文本字段(和控制器)、一个<code class="fe nh ni nj nk b">RaisedButton</code>和一个文本小部件(用于显示输入的文本)的屏幕。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/880bc230c1c754a0260c941a5bed2e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4gHUjpfTKNv1QvLA_-Pngw.png"/></div></div><p class="nm nn gj gh gi no np bd b be z dk translated">它看起来像什么。</p></figure><p id="44be" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们有了小部件，让我们编写测试:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/f0ea2d3b8250343e7b26037af88d73d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V55tT4ZTLkxeygdNvjskDQ.png"/></div></div><p class="nm nn gj gh gi no np bd b be z dk translated">小部件测试。</p></figure><p id="2ef7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">很快，您应该开始发现这与我们之前编写的单元测试之间的差异。</p><ol class=""><li id="5069" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm oh lt lu lv bi translated">为每个测试创建一个新的<code class="fe nh ni nj nk b"><a class="ae lw" href="https://api.flutter.dev/flutter/flutter_test/WidgetTester-class.html" rel="noopener ugc nofollow" target="_blank">WidgetTester</a></code>的<code class="fe nh ni nj nk b">testWidgets()</code>函数，在单元测试中用来代替<code class="fe nh ni nj nk b">test()</code>函数。</li><li id="1188" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm oh lt lu lv bi translated"><code class="fe nh ni nj nk b"><a class="ae lw" href="https://api.flutter.dev/flutter/flutter_test/Finder-class.html" rel="noopener ugc nofollow" target="_blank">Finder</a></code>，用于定位各个小部件。</li><li id="307a" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm oh lt lu lv bi translated">匹配器(<code class="fe nh ni nj nk b">findsOneWidget</code>、<code class="fe nh ni nj nk b">findsNothing</code>、<code class="fe nh ni nj nk b">findsNwidgets</code>)，我们用它来验证小部件。</li><li id="a741" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm oh lt lu lv bi translated"><code class="fe nh ni nj nk b">pump()</code>，Flutter用它来构建一个小部件。你也可以为动画之类的东西设置持续时间。</li></ol><h2 id="07d9" class="ns mk iq bd ml nt nu dn mp nv nw dp mt la nx ny mv le nz oa mx li ob oc mz od bi translated">这是怎么回事？</h2><ul class=""><li id="55fa" class="ln lo iq kt b ku nb kx nc la oi le oj li ok lm ls lt lu lv bi translated">首先，我们使用了<code class="fe nh ni nj nk b">testWidgets()</code>函数，并为这个测试传递了一个描述，而<code class="fe nh ni nj nk b">WidgetTester</code>将用于每个测试用例。</li><li id="e459" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">然后，我们通过调用<code class="fe nh ni nj nk b">pumpWidget()</code>来构建小部件。</li><li id="ef62" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">我们第一次使用<code class="fe nh ni nj nk b">Finder</code>类是为了在屏幕上找到凸起的按钮。我们在这里使用了<code class="fe nh ni nj nk b">byType()</code>方法，但是我们还可以尝试更多的方法，稍后我将通过使用<code class="fe nh ni nj nk b">find.byKey()</code>来展示这些方法，以找到分配了键的文本字段。</li><li id="6c49" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">接下来，我们试着测试一下<code class="fe nh ni nj nk b">TextField</code>。首先，我们验证有一个带有<code class="fe nh ni nj nk b">find.byKey()</code>查找器和<code class="fe nh ni nj nk b">findsOneWidget</code>匹配器的<code class="fe nh ni nj nk b">TextField</code>，然后触发视图的重建。</li><li id="9f05" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">从<code class="fe nh ni nj nk b"><a class="ae lw" href="https://api.flutter.dev/flutter/flutter_test/WidgetTester-class.html" rel="noopener ugc nofollow" target="_blank">WidgetTester</a></code>调用<code class="fe nh ni nj nk b">enterText()</code>方法允许Flutter将文本输入到找到的<code class="fe nh ni nj nk b">TextField</code>中，然后再次重建视图。</li><li id="1b7d" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated">最后，我们让Flutter检查打印在屏幕上的文本是否与上一步中输入的文本相同。</li></ul><p id="cc33" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过您的编辑器运行测试或在您的终端中运行<code class="fe nh ni nj nk b">flutter test test/widget_test.dart</code>。这个测试应该会通过，但是玩玩它，看看事情会以不同的方式发生。</p><p id="695f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，查看所使用的类中的所有方法和示例。</p><p id="5250" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">作为这方面的延续，我可能会写一些关于模拟互联网调用和集成测试的文章。</p></div></div>    
</body>
</html>