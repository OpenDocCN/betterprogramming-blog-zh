<html>
<head>
<title>How to Test Push Notifications on the iOS Simulator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在iOS模拟器上测试推送通知</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-test-push-notifications-on-the-ios-simulator-9b5062519622?source=collection_archive---------19-----------------------#2020-02-11">https://betterprogramming.pub/how-to-test-push-notifications-on-the-ios-simulator-9b5062519622?source=collection_archive---------19-----------------------#2020-02-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9674" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何在iOS模拟器中测试远程推送通知，而无需Xcode 11.4中的实际设备</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b19c5e88218b19dd04e276fce30f7ec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*51_0gaHyz6LzZoiJ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@cebbbinghaus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯托弗·罗宾·艾宾浩斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄。</p></figure><p id="ad82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在iOS模拟器中测试推送通知使得添加远程通知支持变得更加容易。您经常需要迭代很多次来验证您的代码是否按预期运行。</p><p id="0377" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Xcode 11.4之前，我们不得不使用第三方应用程序，如<a class="ae ky" href="https://github.com/noodlewerk/NWPusher" rel="noopener ugc nofollow" target="_blank"> NWPusher </a>和实际设备来测试功能，如<a class="ae ky" href="https://www.avanderlee.com/swift/rich-notifications/" rel="noopener ugc nofollow" target="_blank">丰富通知</a>。尽管这样做效果很好，但在iOS模拟器上快速迭代总是更好。Xcode 11.4通过新添加的<code class="fe lv lw lx ly b">simctl</code>命令使这成为可能。让我们开始吧！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1a70" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">启用使用推送通知的权限</h1><p id="d0d6" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在我们开始测试远程推送通知之前，确保您获得了在iOS模拟器上接收通知的正确权限是很重要的。</p><p id="8da1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">否则，您可能最终调试出通知没有出现的原因，却发现这是因为缺少权限。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="4c6f" class="nh mh it ly b gy ni nj l nk nl">let center = UNUserNotificationCenter.current()<br/>center.requestAuthorization(options: [.alert, .sound]) { granted, error in<br/>    // If `granted` is `true`, you're good to go!<br/>}</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="a4a7" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">从终端向iOS模拟器发送推送通知</h1><p id="40b7" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">测试简单推送通知的最简单方法是利用<a class="ae ky" href="https://github.com/AvdLee/Poes" rel="noopener ugc nofollow" target="_blank"> Poes </a>。这是一个简单的命令行工具，它为新的<code class="fe lv lw lx ly b">simctl push</code>命令添加了一个包装器。</p><p id="cc3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用<a class="ae ky" href="https://github.com/yonaskolb/mint" rel="noopener ugc nofollow" target="_blank"> Mint </a>安装Poe:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="4aff" class="nh mh it ly b gy ni nj l nk nl">$ mint install AvdLee/Poes</span></pre><p id="a5e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，您可以轻松发送如下通知:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="daa7" class="nh mh it ly b gy ni nj l nk nl">$ Poes --bundle-identifier com.wetransfer.app --verbose<br/>Generated payload:<br/><br/>{<br/>  "aps" : {<br/>    "alert" : {<br/>      "title" : "Default title",<br/>      "body" : "Default body"<br/>    },<br/>    "mutable-content" : false<br/>  }<br/>}<br/><br/>Sending push notification...<br/>Push notification sent successfully</span></pre><p id="e6b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这消除了自己创建有效负载JSON文件的麻烦，并允许您在应用程序中测试推送通知时快速迭代。</p><p id="ce85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Poes使用了新的<code class="fe lv lw lx ly b">xcrun simctl push</code>命令，并在它周围添加了一个小包装器，以基于输入参数生成JSON有效负载。为了充分理解这意味着什么，我将向你解释如何在没有Poe的情况下测试推送通知。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="ce49" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用Xcode命令行工具测试推送通知</h1><p id="ae36" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">Xcode命令行工具允许您从终端使用模拟器。你可以启动模拟器，触发通用链接，等等。其中一个命令允许您向iOS模拟器发送推送通知:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="424d" class="nh mh it ly b gy ni nj l nk nl">$ xcrun simctl push --help<br/>Send a simulated push notification<br/>Usage: simctl push &lt;device&gt; [&lt;bundle identifier&gt;] (&lt;json file&gt; | -)<br/><br/>	bundle identifier<br/>	     The bundle identifier of the target application<br/>	     If the payload file contains a 'Simulator Target Bundle' top-level key this parameter may be omitted.<br/>	     If both are provided this argument will override the value from the payload.<br/>	json file<br/>	     Path to a JSON payload or '-' to read from stdin. The payload must:<br/>	       - Contain an object at the top level.<br/>	       - Contain an 'aps' key with valid Apple Push Notification values.<br/>	       - Be 4096 bytes or less.<br/><br/>Only application remote push notifications are supported. VoIP, Complication, File Provider, and other types are not supported.</span></pre><p id="b35d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令要求您传入几个参数:</p><ul class=""><li id="e8c9" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><code class="fe lv lw lx ly b">&lt;device&gt;</code> —只需将其设置为<em class="nv">启动</em>即可使用开放模拟器。您还可以使用通过<code class="fe lv lw lx ly b">xcrun simctl list devices | grep Booted</code>命令获得的设备标识符。</li><li id="0939" class="nm nn it lb b lc nw lf nx li ny lm nz lq oa lu nr ns nt nu bi translated"><code class="fe lv lw lx ly b">&lt;bundle identifier&gt;</code> <strong class="lb iu"> — </strong>将此项设置为您正在测试推送通知的应用的捆绑包标识符。</li><li id="7e89" class="nm nn it lb b lc nw lf nx li ny lm nz lq oa lu nr ns nt nu bi translated"><code class="fe lv lw lx ly b">&lt;json file&gt;</code> <strong class="lb iu"> — </strong>这应该指向磁盘上包含推送通知细节的JSON文件。您也可以使用<code class="fe lv lw lx ly b">stdin</code>来提供JSON内容。</li></ul><p id="a11d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行的示例可能如下所示:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="f8f2" class="nh mh it ly b gy ni nj l nk nl">$ xcrun simctl push booted com.wetransfer.app payload.json <br/>Notification sent to 'com.wetransfer.app'</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/8b074e66b441c8bb22d38cbd58dae91d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/0*9sP_KTlXZfv3xBg5.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在iOS模拟器上测试推送通知</p></figure><p id="e3c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，我们使用保存到<code class="fe lv lw lx ly b">payload.json</code>文件中的以下JSON:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="3d49" class="nh mh it ly b gy ni nj l nk nl">{<br/>    "aps": {<br/>        "alert": {<br/>            "body": "Gerard added something new - take a look",<br/>            "title": "Photos"<br/>        }<br/>    }<br/>}</span></pre><p id="e7a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在苹果官方文档页面<a class="ae ky" href="https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CreatingtheNotificationPayload.html" rel="noopener ugc nofollow" target="_blank">阅读更多关于有效载荷JSON的可能性和结构，创建远程通知有效载荷</a>。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="e57b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用APNS文件测试推送通知</h1><p id="b5f5" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在iOS模拟器上测试推送通知的另一个选项是将APNS文件拖到iOS模拟器中。</p><p id="d51c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个APNS文件看起来与JSON有效负载文件几乎一样，但是添加了一个描述要使用的包标识符的<code class="fe lv lw lx ly b">Simulator Target Bundle</code>键:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="4a87" class="nh mh it ly b gy ni nj l nk nl">{<br/>    "Simulator Target Bundle": "com.wetransfer.app",<br/>    "aps": {<br/>        "alert": {<br/>            "body": "Gerard added something new - take a look",<br/>            "title": "Photos"<br/>        }<br/>    }<br/>}</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="605b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">共享存储库中的APNS文件</h1><p id="b76a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">将APNS文件提交到存储库可以让您和您的同事轻松测试应用程序的常见推送通知。您可以为每种类型的通知保存一个配置。例如，我们决定为Collect by WeTransfer应用程序保存一个配置，以发送包含图像的推送通知:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="441c" class="nh mh it ly b gy ni nj l nk nl">{<br/>    "Simulator Target Bundle": "com.wetransfer.app",<br/>    "aps": {<br/>        "alert": {<br/>            "body": "Gerard added something new - take a look",<br/>            "title": "Photos"<br/>        },<br/>        "category": "file_added",<br/>        "mutable-content": 1<br/>    },<br/>    "image_url": "https://assets.website-files.com/5e1c6cdadb4d52399503394c/5e31fc43e7c7eca12dd4228d_5e1c6cdadb4d527592033a11_Hero%402x%20(1).png",<br/>    "event_type": "file_added"<br/>}</span></pre><p id="26ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每当我们需要测试这个特定的推送通知时，我们可以简单地将APNS文件拖到模拟器中。请注意，我们在这里使用了丰富的通知。这些细节在这篇博文中有所解释。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="516c" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="17a2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在iOS模拟器上测试推送通知现在已经成为一件简单的事情。有三种不同的方式触发远程推送通知:</p><ul class=""><li id="6647" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">使用<a class="ae ky" href="https://github.com/AvdLee/Poes" rel="noopener ugc nofollow" target="_blank"> Poes命令行工具</a>轻松生成JSON有效负载</li><li id="71e9" class="nm nn it lb b lc nw lf nx li ny lm nz lq oa lu nr ns nt nu bi translated">引用本地JSON有效负载文件</li><li id="3fa4" class="nm nn it lb b lc nw lf nx li ny lm nz lq oa lu nr ns nt nu bi translated">将APNS文件拖到模拟器中</li></ul><p id="9bbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Poes可以非常容易地进行快速测试，而一个APNS文件添加到你的存储库中可以使你的应用程序很容易迭代常见的推送通知。</p><p id="6569" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想进一步改进您的工作流程，请查看<a class="ae ky" href="https://www.avanderlee.com/category/workflow/" rel="noopener ugc nofollow" target="_blank">工作流程类别页面</a>。请随时留下您的评论、建议或反馈。</p><p id="2f70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢谢！</p></div></div>    
</body>
</html>