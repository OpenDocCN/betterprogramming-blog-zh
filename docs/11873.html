<html>
<head>
<title>Joining Tables in SQL Queries for Extracting Data in a Lake</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在提取湖泊数据的SQL查询中连接表</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/joining-tables-in-sql-queries-for-extracting-data-in-a-lake-9c0811267419?source=collection_archive---------11-----------------------#2022-04-22">https://betterprogramming.pub/joining-tables-in-sql-queries-for-extracting-data-in-a-lake-9c0811267419?source=collection_archive---------11-----------------------#2022-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6329" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为可持续ETL设置框架</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ffcb162accd3261ed418b5acbe74cfc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GFO1u0m-C8lGq2IY"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@sunday_digital?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Nastuh Abootalebi </a>拍摄的照片</p></figure><p id="9e14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在一次与领导层的会议中，一位最终用户向我提出了她一直在考虑的一个分析工具的想法。她与我分享了一份电子表格，其中包括一些手动输入的数据和她的愿景。我采取了重要举措，向她提问，以了解这种新分析工具的业务目的。</p><p id="8496" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我不处理抵押贷款，我的公司也不处理，但在我职业生涯的头几年，我帮助人们支付他们的业务改造或搬迁到一个新的地区。抵押贷款数据模拟了与最近提交给我的一个项目相关的业务挑战。</p><p id="7cf7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我现在有了最终用户希望获得的目标，所以是时候开始评估可用的数据了。在我的角色中，我通过Microsoft SQL Server Management Studio访问数据集市。</p><p id="5fc0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从那里，我开始为我的数据湖中的第一个SQL查询创建框架，写出以下语句:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="59fe" class="lx ly iq lt b gy lz ma l mb mc">SELECT<br/>FROM<br/>WHERE<br/>GROUP BY</span></pre><p id="7d0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的绝大多数查询中，这四个语句提供了一个框架来编写一个查询，我可以在屏幕共享期间重新访问、与他人共享并轻松引用。</p><p id="23d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此时，我不是寻找特定的数据字段开始填充，而是评估数据库中的特定表，寻找那些与我的目标最相关的表。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="6b7e" class="lx ly iq lt b gy lz ma l mb mc">SELECT<br/>FROM <br/>MortgageLoanListings AS ML<br/>JOIN MortgageRatesTable AS MRT<br/>    ON ML.RatingIndex=MRT.RatingIndex<br/>INNER JOIN OfficeBridge as OB<br/>    ON OB.OfficeId=ML.OfficeIdJOIN AccountInformationTable AS AC<br/>    ON ML.AccountNumber=AC.AccountNumberWHERE<br/>GROUP BY</span></pre><p id="596f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于我的格式，请注意每个SQL语句都是大写的。任何审查您的代码的人都可以发现各种语句，以进行更改并提供反馈。此外，请注意缩进为您提供了另一种更易于阅读的工具。</p><p id="bd4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我还必须提到我的模式。您经常会在湖中浏览数据表，发现没有一个数据元素与另一个表中的任何数据元素完全一致。</p><p id="67bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">准备好花时间寻找数据的正确连接。通常，我们可以用桥表建立这些联系。这些将数据排列在多个链中，这些链仍然相互连接，这就形成了雪花模式的起点。</p><p id="60df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为添加我想要查询的数据字段之前的最后一步，我定位将过滤我的数据的数据字段。这是运行查询的重要一步，因为您可能会节省几个小时等待查询返回与您无关的结果。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="f7c0" class="lx ly iq lt b gy lz ma l mb mc">SELECTFROM <br/>MortgageLoanListings AS ML<br/>JOIN MortgageRatesTable AS MRT<br/>    ON ML.RatingIndex=MRT.RatingIndexJOIN AccountInformationTable AS AC<br/>    ON ML.AccountNumber=AC.AccountNumberWHERE<br/>   OB.OfficeName='Pittsburgh'GROUP BY</span></pre><p id="a726" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经熟悉了可用的数据表，连接并过滤了正确的数据，我们可以开始选择我们需要的数据了。</p><p id="96bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，我可能会找到这个项目的一些表，但是我将对我的SELECT语句以及我连接的表进行一些更改。</p><p id="28b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我可能会在连接所有数据的雪花模式的中心更改主表，只是发现键排列得更好。但这是第一次迭代</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="8bd0" class="lx ly iq lt b gy lz ma l mb mc">SELECT<br/>OB.OfficeName,<br/>MRT.MortgageRatesTable,<br/>AC.AccountCustomerName,<br/>SUM(ML.MortgageNumber)FROM <br/>MortgageLoanListings AS ML<br/>JOIN MortgageRatesTable AS MRT<br/>    ON ML.RatingIndex=MRT.RatingIndexJOIN AccountInformationTable AS AC<br/>    ON ML.AccountNumber=AC.AccountNumberWHERE<br/>   OB.OfficeName='Pittsburgh'GROUP BY<br/>OB.OfficeName,<br/>MRT.MortgageRatesTable,<br/>AC.AccountCustomerName,<br/>SUM(ML.MortgageNumber)</span></pre><p id="4309" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过以上内容，您会注意到我用层次结构对select语句进行了排序。</p><p id="0ccc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每当您发现数据在最终产品上的显示方式存在差异时，最好能够轻松识别哪个数据更好。客户可以有多个抵押贷款。</p><p id="4664" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这对于不希望滚动查看Stella Thompson的第一笔抵押贷款、房屋净值信用额度和度假房屋抵押贷款来查看她总共欠了多少钱的最终用户来说可能很麻烦。</p><p id="407d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">汇总这些数据是使用SUM完成的。从那里可以在<code class="fe md me mf lt b">GROUP BY</code>语句中重复这个层次。</p><p id="dc3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我生成了SQL查询，我就将数据加载到Power BI中，并使用一个过程创建一个交互式可视化，在这个过程中，我定期会见几个最终用户，获得反馈，多次回去编辑我的查询，并在最终产品发布之前制作许多版本。</p><p id="63ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想重新整理一下我在那次会议上与领导层和最终用户的对话。这是进行开放式对话的重要一步。这样做不仅能给我需要的反馈，还能让多个团队注意到我的工作。对我来说，有了这个通知，我就有能力掌控我设计工具的许多方式。我在那种力量中茁壮成长。</p></div></div>    
</body>
</html>