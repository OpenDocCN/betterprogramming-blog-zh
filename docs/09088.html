<html>
<head>
<title>Create Custom API Endpoints in Nuxt.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Nuxt.js中创建自定义API端点</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-custom-api-endpoints-in-nuxt-js-57d2f713df95?source=collection_archive---------5-----------------------#2021-07-14">https://betterprogramming.pub/create-custom-api-endpoints-in-nuxt-js-57d2f713df95?source=collection_archive---------5-----------------------#2021-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0676" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何在Nuxt.js中创建自定义API</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d6e395b02008c61431185d0ec687e2df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cgdfvxTXj6yzCAgr"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">道格拉斯·洛佩斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="5141" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您知道可以在<a class="ae kv" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> Nuxt.js </a>中创建自定义API端点吗？这意味着您不必运行独立的服务器。相反，您可以在您的Nuxt应用程序中直接这样做！</p><p id="3af8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，您将看到如何做到这一点。您将创建一个简单的Express服务器，它带有一个端点，允许您从数据库中获取数据。</p><p id="2212" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看如何设置自定义API服务器！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="fd06" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">serverMiddleware属性</h1><p id="edad" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Nuxt有一个名为<code class="fe mw mx my mz b">serverMiddleware</code>的属性，允许您在应用程序内部创建额外的API路由。</p><p id="19f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它是如何工作的？Nuxt创建了一个<code class="fe mw mx my mz b">connect</code>的实例，它是Node.js的中间件层，由于有了<code class="fe mw mx my mz b">connect</code>实例，你可以创建一个具有不同端点的自定义API。</p><p id="b0b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您希望将API放在与Nuxt应用程序相同的位置时，<code class="fe mw mx my mz b">serverMiddleware</code>属性非常方便。当您想要构建一个概念验证或者当您有一个小的API时，它也是一个有用的特性。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e5eb" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">如何创建API</h1><p id="8420" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">第一步是在项目的根目录下创建一个新文件夹。按如下方式创建新文件夹:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="c5e0" class="ne ma iq mz b gy nf ng l nh ni">mkdir api</span></pre><p id="b514" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个文件夹中，创建一个名为<code class="fe mw mx my mz b">courseAPI.js</code>的新文件。<code class="fe mw mx my mz b">courseAPI.js</code>文件是构建Express服务器的地方。</p><p id="b1d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这个例子，让我们假设您有一个存储web开发课程的数据库。因此，您将构建一个允许您从数据库中检索所有课程的端点。</p><p id="e334" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开文件<code class="fe mw mx my mz b">courseAPI.js</code>并编写以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="5ccf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这段代码中发生了很多事情。你是:</p><ul class=""><li id="167a" class="nl nm iq ky b kz la lc ld lf nn lj no ln np lr nq nr ns nt bi translated">导入构建API服务器所需的包(<code class="fe mw mx my mz b">Express</code>和<code class="fe mw mx my mz b">graphql-request</code>)。</li><li id="4d14" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">创建一个新的Express实例并使用<code class="fe mw mx my mz b">express.json()</code>中间件。</li><li id="04fd" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">创建一个传递虚拟端点的新GraphQLClient实例。</li><li id="fac9" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">构建<code class="fe mw mx my mz b">/getCourses</code>端点。</li><li id="536e" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">使用新创建的GraphQLClient发出请求，同时传递<code class="fe mw mx my mz b">allCourses</code>查询。</li><li id="0a0a" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">从数据库中返回课程。</li><li id="ef81" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">正在导出应用程序。</li></ul><p id="f284" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在Nuxt中有了一个简单的Express服务器。下一步是注册<code class="fe mw mx my mz b">serverMiddleware</code>。转到<code class="fe mw mx my mz b">nuxt.config.js</code>文件并添加以下属性:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="9bc2" class="ne ma iq mz b gy nf ng l nh ni">export default {<br/>  serverMiddleware: ['~/server-middleware/courseAPI.js']<br/>}</span></pre><p id="8923" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果您启动应用程序并转到<code class="fe mw mx my mz b">/getCourses</code>路线，您应该会看到数据库中的所有课程。</p><p id="5983" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nz">注意:如果要添加特定的路径或前缀如</em> <code class="fe mw mx my mz b"><em class="nz">/api</em></code> <em class="nz">，需要使用对象形式并指定路径。下面的代码片段演示了带有特定路径的对象表单。</em></p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="f177" class="ne ma iq mz b gy nf ng l nh ni">export default {<br/>  serverMiddleware: [<br/>    { path: '/api', handler: '~/server-middleware/courseAPI.js' }<br/>  ]<br/>}</span></pre><p id="1f13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，您将看到没有对象表单的第一个选项。但是，请随意使用适合您需求的选项。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1318" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">如何使用API端点</h1><p id="6f96" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">既然已经有了自定义API端点，就可以开始使用它了。下面的代码说明了获取数据的一种方式。</p><p id="a04d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的组件从数据库中获取课程，并将它们呈现在页面上。这是非常基本的，其目的是简单地说明如何使用自定义端点。在现实生活中，你可以用更好的方式呈现数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="9049" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">值得注意的是，在现实世界的应用程序中，您不会硬编码URL。同样，当你使用<code class="fe mw mx my mz b">fetch</code>钩子时，你需要传递绝对URL。所以像<code class="fe mw mx my mz b">fetch('/getCourses')</code>这样的操作会给你一个错误。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="fef4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="3a9e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在本文中，您在Nuxt中构建了一个简单的Express服务器。但是，您可以在它的基础上创建一个更复杂的API。</p><p id="2b42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是问题是——特别是如果它是一个复杂的API——这是正确的方法吗你想在Nuxt里面有API吗？</p><p id="18ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有几点需要考虑，比如:</p><ul class=""><li id="86c8" class="nl nm iq ky b kz la lc ld lf nn lj no ln np lr nq nr ns nt bi translated">扩展API</li><li id="7c43" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">具有单一故障点</li></ul><p id="ca94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>