<html>
<head>
<title>How to Hide Your API Keys</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何隐藏你的API键</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-hide-your-api-keys-c2b952bc07e6?source=collection_archive---------0-----------------------#2019-06-25">https://betterprogramming.pub/how-to-hide-your-api-keys-c2b952bc07e6?source=collection_archive---------0-----------------------#2019-06-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b265" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过保护您的API密钥来防止盗窃</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0181e8bb2a04979c9fda22c8213be9f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ou27uef_kSZs9WBJhQ1Wnw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@mr_williams_photography?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">迈卡·威廉姆斯</a>在<a class="ae ky" href="https://unsplash.com/search/photos/safe?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="87b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，在使用Google Cloud API进行一个项目时，我收到了来自Google的提醒:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/eb1cb8e8868908fb4c3a90aa04098442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*N6iV9TadJ_2u-s9grI_HPg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">谷歌提醒我，我的API密匙正在世界的某个地方游荡。</p></figure><p id="5f97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，我上传了我的API密匙到我的GitHub——一个初学者的错误。不幸的是，我并不是唯一对此一无所知的人，因为<a class="ae ky" href="https://medium.com/@morgannegagne/a-very-expensive-aws-mistake-56a3334ed9ad" rel="noopener">去年有人从她的GitHub上偷走了AWS API密匙，这位熨斗学校的校友被罚款7000美元</a>。互联网上到处都是这种<a class="ae ky" href="https://www.quora.com/My-AWS-account-was-hacked-and-I-have-a-50-000-bill-how-can-I-reduce-the-amount-I-need-to-pay" rel="noopener ugc nofollow" target="_blank">故事</a>！有一些软件在网络上爬行(尤其是通过GitHub ),渴望找到零散的API密钥。那么，我们如何保持安全呢？</p><p id="0d5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇博文中，我介绍了在React、Rails、Heroku和Netlify上隐藏API密钥。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="c414" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">我已经把我的API密匙推到Github了，现在怎么办？</h1><p id="89d7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">嗯，首先，不要慌。你应该尽快修改API密匙，或者像Malcolm Laing在评论中建议的那样:</p><blockquote class="nc nd ne"><p id="499e" class="kz la nf lb b lc ld ju le lf lg jx lh ng lj lk ll nh ln lo lp ni lr ls lt lu im bi translated">如果在某个时候您将API密钥提交给了git repo，那么您应该删除它的所有痕迹。您可以通过使用git rebase并删除添加键的提交来实现这一点。</p></blockquote></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f043" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">HTML:对API键设置限制</h1><p id="0700" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">像Google Cloud和AWS这样的服务使得对API密匙的使用设置限制成为可能。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/aefd2dbbf185d04ffecbb4ec96550b10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZMO_rI-QmTJqs41e1H5dA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不同限制场景的谷歌备忘单</p></figure><p id="00bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，密钥可能只在给定的URL中使用(因此窃取它没有任何作用)。<strong class="lb iu">当您的API密钥用在前端或HTML文件中时，这一点尤其重要——似乎没有令人满意的方法来加密它。</strong>设定每日/总资金使用限额也不是一个坏主意，即使其他安全措施已经到位。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="d913" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">前端:隐藏你的钥匙(反应)</h1><p id="11fc" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">除了保护API密钥，我们还可以隐藏它。按照下面的步骤在React应用程序中完成。</p><p id="048e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">重要！如果您使用create-react-app创建了React应用程序，请注意，您的env变量将成为构建的一部分，这意味着它们将对检查您的文件的任何人公开。在开发阶段，您仍然可以遵循下面的步骤，这样您的API密钥就不会进入github。然后，在部署您的页面之前，删除<code class="fe nk nl nm nn b">.env</code>文件并使用平台的密钥管理系统(参见下面的Heroku和Netlify)。</strong></p><ol class=""><li id="b0fb" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated"><strong class="lb iu">创建一个名为。env放在项目目录的根目录下。</strong></li></ol><p id="d57c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是应用程序的树形图:</p><pre class="kj kk kl km gt nx nn ny nz aw oa bi"><span id="6482" class="ob me it nn b gy oc od l oe of">- your_project_folder<br/>  - node_modules<br/>  - public<br/>  - src<br/>  - .env         <strong class="nn iu">&lt;-- create it here</strong><br/>  - .gitignore<br/>  - package-lock.json<br/>  - package.json</span></pre><p id="60e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。在里面。env文件，将</strong> <code class="fe nk nl nm nn b"><strong class="lb iu">REACT_APP_</strong></code> <strong class="lb iu">添加到您选择的API键名前，并分配给它。</strong></p><p id="5a48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nk nl nm nn b">REACT_APP_</code>实际上是<code class="fe nk nl nm nn b">create-react-app</code>用来识别这些变量的工具。</p><pre class="kj kk kl km gt nx nn ny nz aw oa bi"><span id="a951" class="ob me it nn b gy oc od l oe of">// .env</span><span id="a3d5" class="ob me it nn b gy og od l oe of">API_KEY=your_api_key            <strong class="nn iu">&lt;-- nope, this won't work</strong><br/>REACT_APP_API_KEY=your_api_key  <strong class="nn iu">&lt;-- yes!</strong></span><span id="e853" class="ob me it nn b gy og od l oe of">// Example:<br/>// REACT_APP_GOOGLE_API_KEY=123456</span></pre><p id="de8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。添加。env文件到您的。gitignore文件。</strong></p><p id="0ab9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你不希望这个文件被提交到gitHub！</p><pre class="kj kk kl km gt nx nn ny nz aw oa bi"><span id="3278" class="ob me it nn b gy oc od l oe of">// .gitignore<br/><br/># api keys<br/>.env       <strong class="nn iu">&lt;-- add this line</strong><br/><br/># dependencies<br/>/node_modules<br/>...</span></pre><p id="f241" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在你存了钱之后。gitignore，运行<code class="fe nk nl nm nn b">$ git status</code>来确保。env不在要提交的更改列表中。</p><p id="8cbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。通过</strong> <code class="fe nk nl nm nn b"><strong class="lb iu">process.env</strong></code> <strong class="lb iu">对象访问API键。</strong></p><p id="4fb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要检查您是否可以访问您的API密钥，请转到您的<code class="fe nk nl nm nn b">App.js</code>文件，并在<code class="fe nk nl nm nn b">require</code>语句下方的顶部添加<code class="fe nk nl nm nn b">console.log</code>。保存文件并重新加载页面后，如果控制台日志没有显示您的API密钥，请尝试重新启动react服务器。当然，确保在提交代码之前删除<code class="fe nk nl nm nn b">console.log</code>行。</p><pre class="kj kk kl km gt nx nn ny nz aw oa bi"><span id="e932" class="ob me it nn b gy oc od l oe of">// src/App.js</span><span id="4531" class="ob me it nn b gy og od l oe of">import React, { Component } from 'react';<br/>import './App.css';</span><span id="2b85" class="ob me it nn b gy og od l oe of">console.log(process.env.REACT_APP_GOOGLE_API_KEY)</span><span id="2e97" class="ob me it nn b gy og od l oe of">class App extends Component {<br/>...}</span></pre><p id="dfd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，请注意，虽然网络爬虫很可能不会获得您的API密钥，但这种解决方案不会隐藏您的API密钥。正如Malcolm Laing在评论中指出的，密钥可能会出现在你的网络请求中。因此，如果您希望完全屏蔽您的密钥，您应该创建一个后端来代理您的请求，并将API密钥存储在那里。</p><p id="ef12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，这种解决方案也可能不是最佳的，因为您如何保护对代理请求的后端的访问呢？还是要将这个后端端点公开？”正如<a class="na nb ep" href="https://medium.com/u/32acc0f9e4e6?source=post_page-----c2b952bc07e6--------------------------------" rel="noopener" target="_blank"> Exadra37 </a>在这篇博文的评论部分所言。在他们的解释中，他们推荐使用反向代理方法——你可以通过查看评论部分和阅读Paulo Renato的这篇文章<a class="ae ky" href="https://blog.approov.io/using-a-reverse-proxy-to-protect-third-party-apis" rel="noopener ugc nofollow" target="_blank">来了解更多信息。在完全透明的情况下，反向代理解决方案仍然容易受到攻击，因为您仍然需要在客户端使用API密钥来保护对它的访问。Exadra37指出:</a></p><blockquote class="nc nd ne"><p id="4afc" class="kz la nf lb b lc ld ju le lf lg jx lh ng lj lk ll nh ln lo lp ni lr ls lt lu im bi translated">反向代理方法的优势在于，现在您的第三方API密钥在您控制的环境中，因此您可以采用尽可能多的API安全措施层，以防止您付费的第三方服务被滥用。</p></blockquote><p id="c3df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这超出了我的专业范围，这也是我个人在这个问题上不持立场的原因。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="dc0c" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">后端:保护Rails上的API键</h1><p id="a395" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了保护你在Rails应用上的秘密，像<a class="ae ky" href="https://github.com/laserlemon/figaro" rel="noopener ugc nofollow" target="_blank"> Figaro </a>这样的工具已经为你准备好了。您仍然需要处理一个. env文件和一个. yaml文件。让我们来看一下这些步骤:</p><ol class=""><li id="f4ab" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">将宝石添加到宝石文件中。</li></ol><p id="c0b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">照常营业:</p><pre class="kj kk kl km gt nx nn ny nz aw oa bi"><span id="bdda" class="ob me it nn b gy oc od l oe of">// Gemfile</span><span id="8967" class="ob me it nn b gy og od l oe of">gem 'figaro' <strong class="nn iu">&lt;-- add this</strong></span></pre><p id="a1dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，<code class="fe nk nl nm nn b">bundle install.</code></p><p id="aa59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。通过终端</strong>安装Figaro</p><p id="ceee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建<code class="fe nk nl nm nn b">application.yaml</code>文件(并将其添加到。gitignore给你！):</p><pre class="kj kk kl km gt nx nn ny nz aw oa bi"><span id="d8c8" class="ob me it nn b gy oc od l oe of">$ bundle exec figaro install</span></pre><p id="1079" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。现在，转到</strong> <code class="fe nk nl nm nn b"><strong class="lb iu">./config/application.yml</strong></code> <strong class="lb iu">并添加密钥:</strong></p><pre class="kj kk kl km gt nx nn ny nz aw oa bi"><span id="440b" class="ob me it nn b gy oc od l oe of"># config/application.yml<br/>google_api_key: '123456'</span></pre><p id="be31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。将这些键作为环境变量添加。</strong></p><p id="1fce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以在您的应用程序中轻松访问它们，就像这样:</p><pre class="kj kk kl km gt nx nn ny nz aw oa bi"><span id="2450" class="ob me it nn b gy oc od l oe of">GOOGLE_API_KEY = ENV['<!-- -->google_api_key<!-- -->']</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="113e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">部署:隐藏Heroku上的API密钥</h1><p id="ae0e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">太好了，你的应用程序正在工作！你已经部署了，但是因为。gitignore。env文件没有到达Heroku。转到应用程序的<a class="ae ky" href="https://dashboard.heroku.com/apps/[APP-NAME]/settings" rel="noopener ugc nofollow" target="_blank">设置</a>并选择此选项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/ea3b712d23990c3ed2f1f55e39c63fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rin7ziZlDxBAr43BQnXgFw.png"/></div></div></figure><p id="b72b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击后，你将有可能把你所有的秘密告诉Heroku:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/9973b1be3787ece6391630df173e51d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hW-lVoX9p-c5719zOCrP1w.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6f85" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">部署:在Netlify上隐藏API密钥</h1><p id="bcde" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了在网络生活中使用你的秘密，去<strong class="lb iu">设置&gt;构建&amp;部署&gt;环境&gt;环境变量</strong>。在这里，添加你的变量，就像你在。环境文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/d116eb2dcc65b619d8bcd3057243aef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F82srh14d1NyhjGR1Ul1eg.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="2187" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！注意安全。</p></div></div>    
</body>
</html>