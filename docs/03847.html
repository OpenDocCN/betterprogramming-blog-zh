<html>
<head>
<title>The Top 4 Misuses of Lambdas in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中Lambdas的4大误用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-top-4-misuses-of-lambdas-in-python-e419f426b74f?source=collection_archive---------4-----------------------#2020-03-09">https://betterprogramming.pub/the-top-4-misuses-of-lambdas-in-python-e419f426b74f?source=collection_archive---------4-----------------------#2020-03-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1387" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python lambdas的最佳实践</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/86a9fc75a84039d7ccef53ac365f0119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0DZieY6EVfk1bej_ohZ7Lw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·施诺布里奇在<a class="ae ky" href="https://unsplash.com/s/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9e52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">被认为是非常Python化的，lambdas是Python编程中最受欢迎的特性之一。以至于许多Python程序员都想尽可能地使用它们。</p><p id="1864" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，lambdas具有使我们的代码简洁的优势，但是在我们的项目中过度使用它们会导致误用，降低我们代码的可读性和可维护性。</p><p id="32f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始探究这些误用是什么之前，让我们先快速回顾一下什么是lambdas。如果你非常了解他们，你可以跳到下一部分。</p><p id="e57f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Lambdas也称为lambda函数，是匿名函数，接受任意数量的参数，但只有一个表达式。它们的声明由关键字<code class="fe lv lw lx ly b">lambda</code>表示。基本语法如下。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="72d8" class="md me it ly b gy mf mg l mh mi">lambda arguments: expression</span></pre><p id="0569" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Lambdas最适合于需要小功能并且只使用一次的地方。lambdas的一个常见用法是将其设置为内置<code class="fe lv lw lx ly b">sorted()</code>函数中的<code class="fe lv lw lx ly b">key</code>参数。这里有一个例子。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="309b" class="md me it ly b gy mf mg l mh mi">&gt;&gt;&gt; students = [('Mike', 'M', 15), ('Mary', 'F', 14), ('David', 'M', 16)]<br/>&gt;&gt;&gt; sorted(students, key=lambda x: x[2])<br/>[('Mary', 'F', 14), ('Mike', 'M', 15), ('David', 'M', 16)]<br/># The students are sorted by age</span></pre><p id="e3a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多教程已经很好地解释了lambda是什么以及在哪里可以使用lambda，因此，没有充分的理由在这里重复它们。</p><p id="6eb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，本文的目的是<strong class="lb iu"> </strong>向您展示lambdas最常见的误用，以便当您在下面列出的场景之外的其他场景中使用它们时，您可能会正确地使用它们。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="626d" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">1.重复发明</h1><p id="dfe0" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">lambdas的第一个误用是忽略现有的内置函数。</p><p id="09b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还是以<code class="fe lv lw lx ly b">sorted()</code>函数为例。假设我们有一个字符串列表，我们想根据它们的长度对它们进行排序。</p><p id="fa5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，lambda函数<code class="fe lv lw lx ly b">lambda x: len(x)</code>有效，但是直接使用内置的<code class="fe lv lw lx ly b">len()</code>函数怎么样？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="71d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是另一个使用<code class="fe lv lw lx ly b">max()</code>函数的例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4da8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最佳实践#1:在编写自己的lambdas之前，首先考虑内置函数。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="7ed5" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">2.将它赋给一个变量</h1><p id="fd6c" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">我在一些教程中看到过lambda对变量的赋值，包括我的一些教程，但它主要是为了向初学者展示lambda本质上是函数。</p><p id="4442" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，一些初学者可能认为这是很好的实践，认为lambdas只是声明短函数的一种方便的方式。下面的代码片段向您展示了这种误用。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="92b1" class="md me it ly b gy mf mg l mh mi">&gt;&gt;&gt; divide_two_numbers = lambda x, y: x / y<br/>&gt;&gt;&gt; divide_two_numbers(4, 5)<br/>0.8</span></pre><p id="f9be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么要避免这种情况？如果你还记得上面提到的，lambda应该只使用一次，因此没有理由把lambda赋给一个变量。</p><p id="dbe7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们确实需要使用相关的功能，我们应该使用<code class="fe lv lw lx ly b">def</code>关键字来声明一个常规函数，如下所示。</p><p id="0cde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你觉得这个简单的函数用两行代码不酷，我们可以用一行来重写:<code class="fe lv lw lx ly b">def divide_two_numbers_fun(x,y): return x / y</code>，工作方式也一样。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="d833" class="md me it ly b gy mf mg l mh mi">&gt;&gt;&gt; def divide_two_numbers_fun(x,y): <br/>...     return x / y<br/>... <br/>&gt;&gt;&gt; divide_two_numbers_fun(7, 8)<br/>0.875</span></pre><p id="5b33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">避免将lambda赋给变量的主要原因是出于调试/维护的目的，尤其是在生产/团队合作环境中。</p><p id="4e79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用一个简单的例子来看看可能会发生什么。在真实情况下，事情可能会复杂得多。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="73cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在上面看到的，通过正则函数的声明，我们确切地知道是哪个函数导致了错误。相比之下，使用lambdas，它只告诉我们有一个lambda导致了错误。</p><p id="1720" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么没有显示函数名？</p><p id="a0ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为lambdas是匿名函数，它们都共享同一个名字— <code class="fe lv lw lx ly b">&lt;lambda&gt;</code>。你能想象如果你的同事发现几十个<code class="fe lv lw lx ly b">&lt;lambda&gt;</code>有错误会有多沮丧吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/b9d3f3a115d106e89d55979fe7632e01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhWGGV529d1o0PL8Vw5MAQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4785077" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae ky" href="https://pixabay.com/users/geralt-9301/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4785077" rel="noopener ugc nofollow" target="_blank"> Gerd Altmann </a></p></figure><p id="1954" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最佳实践#2: <strong class="lb iu"> </strong>当函数需要多次使用时，编写一个常规函数，而不是lambda。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0284" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">3.不适当地过度使用高阶函数</h1><p id="e9d7" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">当我们说高阶函数时，我们指的是通过将函数作为参数或通过返回函数来对其他函数进行操作的函数。</p><p id="76e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与当前主题相关的函数有<code class="fe lv lw lx ly b">map()</code>、<code class="fe lv lw lx ly b">filter()</code>、<code class="fe lv lw lx ly b">reduce()</code>，这些函数在很多关于lambdas的教程中都或多或少的使用过。但是这导致了lambdas和高阶函数的某种误用。</p><p id="9236" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于演示的目的，我将在本教程中只使用<code class="fe lv lw lx ly b">map()</code>函数，但是同样的原理也适用于其他高阶函数。</p><p id="b440" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们有一个整数列表，我们想要一个由它们的平方组成的列表。使用带有<code class="fe lv lw lx ly b">map()</code>函数的lambda将如下所示。</p><p id="99ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将获得一个迭代器——来自<code class="fe lv lw lx ly b">map()</code>函数的map对象，然后，为了将它转换成一个列表，我们需要在这个迭代器上调用<code class="fe lv lw lx ly b">list()</code>函数。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="cf6e" class="md me it ly b gy mf mg l mh mi">&gt;&gt;&gt; numbers = [1, 2, 3, 5, 8]<br/>&gt;&gt;&gt; squares = list(map(lambda x: x * x, numbers))<br/>&gt;&gt;&gt; squares<br/>[1, 4, 9, 25, 64]</span></pre><p id="b2af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，同样的功能可以通过列表理解方便地实现——不需要高阶函数或lambdas。简洁易读多了，不是吗？</p><p id="c2c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，掌握列表理解是另一个“Pythonic特性”主题，需要另一个教程。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="394d" class="md me it ly b gy mf mg l mh mi">&gt;&gt;&gt; numbers = [1, 2, 3, 5, 8]<br/>&gt;&gt;&gt; squares = [x * x for x in numbers]<br/>&gt;&gt;&gt; squares<br/>[1, 4, 9, 25, 64]</span></pre><p id="1f00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最佳实践#3:考虑用列表理解替换高阶函数。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="376d" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">4.表达太繁琐</h1><p id="5547" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">这种情况比前几次更少见。但一些程序员只是尽可能使用lambdas来编写最Pythonic化的代码。它有时有一个代价——可读性。</p><p id="b510" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们有一个字符串列表，我们需要使用一个奇怪的要求对它们进行排序:单词中不同元音的数量。在<code class="fe lv lw lx ly b">sorted()</code>函数中使用lambda将如下所示。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="c86c" class="md me it ly b gy mf mg l mh mi">&gt;&gt;&gt; texts = ['iiiii', 'bag', 'beto', 'blackboard', 'sequoia']<br/>&gt;&gt;&gt; sorted(texts, key=lambda x: len(set([l for l in list(x) if l in ['a','e','i','o','u']])))<br/>['iiiii', 'bag', 'beto', 'blackboard', 'sequoia']</span></pre><p id="5078" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它像预期的那样工作，但是它肯定不是最可读的代码。下面的代码怎么样？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d694" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，我们需要多写几行代码，但是新代码的可读性不是更好吗？</p><p id="14e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最佳实践#4:如果lambda的表达式太麻烦，就写一个正则函数。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3927" class="mq me it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">外卖食品</h1><p id="14a7" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">对于Python初学者来说，Lambdas一直是一个困难的话题，他们一开始会不惜一切代价避免使用它们。</p><p id="6214" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">过了一段时间，当他们的恐惧消失了，他们开始学习兰姆达斯，并发现他们并不真的很难。然后他们开始使用兰姆达斯，但不幸的是，有些人可能使用他们太多，导致各种各样的误用，如上所述。</p><p id="f538" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章可以帮助解决这些问题。</p><p id="2d65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过避免这些误用并遵循最佳实践技巧，我敢打赌，正确使用lambdas的Python代码将具有更好的可读性和可维护性。</p></div></div>    
</body>
</html>