<html>
<head>
<title>Create and Deploy a Web App to the Cloud With Python in 20 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python在20分钟内创建并部署一个Web应用到云</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-and-deploy-a-web-app-to-the-cloud-with-python-in-20-minutes-7e628b28325d?source=collection_archive---------14-----------------------#2021-02-11">https://betterprogramming.pub/create-and-deploy-a-web-app-to-the-cloud-with-python-in-20-minutes-7e628b28325d?source=collection_archive---------14-----------------------#2021-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b39d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Flask、Postgres和Heroku构建健壮的应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6f065749bdf12434477f97b897096815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QA65sJJamg6qjJvOAyx9wg.png"/></div></div></figure><p id="45aa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您一直在寻找将您的第一个web应用程序部署到云中，那么这篇文章就是为您准备的！</p><p id="e1eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本教程中，我将展示如何制作下面GIF中显示的web应用程序和数据库，以及如何将其部署到Heroku，以便任何人都可以使用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ln"><img src="../Images/1d85a6b1e6c5119acee033499a7baa3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*U7tD0ekj7BJsVfw9XYdDXw.gif"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">SQL编辑器:<a class="ae ls" href="https://arctype.com/?utm_campaign=postgres-heroku&amp;utm_medium=blog&amp;utm_source=medium" rel="noopener ugc nofollow" target="_blank"> Arctype </a></p></figure><p id="14b5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">文章分为三个部分:</p><ol class=""><li id="345a" class="lt lu iq kt b ku kv kx ky la lv le lw li lx lm ly lz ma mb bi translated">创建Flask应用程序(用于提交表单的web应用程序)</li><li id="b5c3" class="lt lu iq kt b ku mc kx md la me le mf li mg lm ly lz ma mb bi translated">用Python建立Postgres数据库(存储提交的表单中的数据)</li><li id="8a91" class="lt lu iq kt b ku mc kx md la me le mf li mg lm ly lz ma mb bi translated">将应用程序部署到Heroku(将应用程序托管在云中，这样任何人都可以使用它)</li></ol><p id="6cc1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在每一节的开始，我提供了对每种技术的简要概述，所以如果您不熟悉其中的一些技术，请不要害怕。</p><p id="338b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你在学习教程的过程中遇到任何问题，我们已经为新程序员创建了一个不和谐频道来回答任何问题:<a class="ae ls" href="https://discord.gg/YaZQzBen" rel="noopener ugc nofollow" target="_blank">在这里加入</a>。</p><h2 id="0697" class="mh mi iq bd mj mk ml dn mm mn mo dp mp la mq mr ms le mt mu mv li mw mx my mz bi translated">技术要求</h2><p id="4ae1" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">本指南面向熟悉编程和使用命令行的初级到中级程序员。</p><p id="bc7c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您需要具备以下条件才能开始:</p><ul class=""><li id="3c8f" class="lt lu iq kt b ku kv kx ky la lv le lw li lx lm nf lz ma mb bi translated"><strong class="kt ir"> PostgreSQL </strong>:你需要<a class="ae ls" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">下载PostgreSQL</a>并安装在你的本地电脑上</li><li id="b834" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><strong class="kt ir"> Python 3.6或更新版本</strong>:不同版本和操作系统的Python安装程序可从这里<a class="ae ls" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank">下载</a></li><li id="9369" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><strong class="kt ir"> Heroku账号</strong>:如果你还没有的话，你需要<a class="ae ls" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">创建一个免费的Heroku账号</a>。这是我们将部署Flask应用程序并将其连接到远程Postgres数据库的地方。</li></ul><p id="9f2b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦安装了以上所有组件，我们就可以开始设置我们的开发环境了。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="cb0b" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">为注册表单创建Flask应用程序</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/33afe0ff93d1f165b392968f1ffde634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OlgwAPO5tjo_ToVE.gif"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">SQL编辑器:<a class="ae ls" href="https://arctype.com/?utm_campaign=postgres-heroku&amp;utm_medium=blog&amp;utm_source=medium" rel="noopener ugc nofollow" target="_blank"> Arctype </a></p></figure><p id="bbe1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本节中，我们将创建如上所示的Flask应用程序。</p><p id="abc9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我已经创建了一个示例Flask应用程序，它呈现一个简单的注册表单，用于从用户那里收集信息。</p><p id="2c8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Flask是用Python编写的最流行的web框架之一。我首先创建的Flask应用程序向在<code class="fe nz oa ob oc b">app/routes.py</code>文件中定义的端点发出请求，以检索显示在注册表单中的数据。</p><p id="847f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，它使用<a class="ae ls" href="https://jinja.palletsprojects.com/en/2.11.x/templates/" rel="noopener ugc nofollow" target="_blank"> Jinja模板库</a>呈现包含在<code class="fe nz oa ob oc b">Template</code>文件夹中的HTML页面。</p><p id="b1d2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">与其从头开始，不如让我们复制我通过克隆GitHub repo创建的Flask应用程序。</p><p id="19cd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开一个命令行工具，并运行以下命令:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="f139" class="mh mi iq oc b gy oh oi l oj ok">git clone https://github.com/ToluClassics/Web_Registration_Form.git<br/>cd web_registration_form</span></pre><p id="3aa0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您曾经迷路，您可以在这里查看已完成的项目:<a class="ae ls" href="https://github.com/ToluClassics/flask_postgres" rel="noopener ugc nofollow" target="_blank">烧瓶-postgres app </a>。</p><p id="48f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们将为这个项目创建一个虚拟环境，并安装所需的依赖项。<em class="ol">虚拟环境</em>是不同Python项目的隔离环境。它们有助于将不同项目之间的包和依赖关系分开。</p><p id="52a4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">根据计算机的操作系统，运行以下命令:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="3c5b" class="mh mi iq oc b gy oh oi l oj ok">Windows:<br/><strong class="oc ir">$</strong> python3 -m venv env<br/><strong class="oc ir">$</strong> source env/scripts/activate<br/>(env) $ pip install -r requirements.txt</span><span id="64a4" class="mh mi iq oc b gy om oi l oj ok">MacOS and UNIX:<br/><strong class="oc ir">$</strong> python -m venv env<br/><strong class="oc ir">$</strong> source env/bin/activate<br/>(env) $ pip install -r requirements.txt</span></pre><p id="4a75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了测试我们的环境是否设置正确，让我们尝试在虚拟环境中输入<code class="fe nz oa ob oc b">flask run</code>来启动应用程序。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="3fe9" class="mh mi iq oc b gy oh oi l oj ok">(env) derekxiao@Dereks-MBP Web_Registration_Form % flask run<br/> * Environment: production<br/>   WARNING: This is a development server. Do not use it in a production deployment.<br/>   Use a production WSGI server instead.<br/> * Debug mode: off<br/> * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)</span></pre><p id="de9d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，您可以在任何浏览器中输入上面的网址并查看网页表单。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="d400" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">为登记表添加输入验证</h1><p id="77d5" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">为了更熟悉代码，让我们向表单类添加输入验证。</p><p id="e04d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们希望我们的应用程序能够防止用户用相同的用户名或电子邮件地址多次填写表格。</p><p id="e021" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过<code class="fe nz oa ob oc b">wtforms</code>，您可以创建一个自定义验证器，通过创建一个名为<code class="fe nz oa ob oc b">validate_&lt;field_name&gt;</code>的方法，该验证器会自动添加到每个字段中。在<code class="fe nz oa ob oc b">app/form.py</code>文件中，增加两种方式:<code class="fe nz oa ob oc b">validate_email</code>和<code class="fe nz oa ob oc b">validate_username</code>。我们将查询<code class="fe nz oa ob oc b">Registrations</code>表(我们稍后将创建该表)、用户名和用户输入的电子邮件。如果它返回一个值，我们将引发一个验证错误。</p><p id="d3b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开<code class="fe nz oa ob oc b">form.py</code>文件，从<code class="fe nz oa ob oc b">models.py</code>文件导入<code class="fe nz oa ob oc b">Registrations</code>(我们稍后会添加该文件)。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="9e23" class="mh mi iq oc b gy oh oi l oj ok">from app.models import Registration</span></pre><p id="c86b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe nz oa ob oc b">RegistrationForm</code>类中，添加以下验证方法:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="64eb" class="mh mi iq oc b gy oh oi l oj ok">def validate_email(self, email):<br/>	user = Registration.query.filter_by(email = email.data).first()<br/>	if user is not None:<br/>		raise ValidationError('Please use a different email address')<br/>    <br/>def validate_username(self, username):<br/>	user = Registration.query.filter_by(username = username.data).first()<br/>	if user is not None:<br/>		raise ValidationError('Please use a different email address')</span></pre><p id="60d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们添加<code class="fe nz oa ob oc b">models.py</code>文件，这样我们就可以测试输入验证了。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="aa3d" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">创建PostgreSQL数据库</h1><p id="32a4" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">首先，我们需要创建<code class="fe nz oa ob oc b">models.py</code>将连接到的数据库。</p><p id="1dd2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于本教程，我们将使用PostgreSQL数据库。PostgreSQL是一个开源的对象关系数据库。最棒的是:它是完全免费的。</p><p id="131d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们首先创建一个新的Postgres数据库来存储提交的注册表单中的数据。如果你已经有一个Postgres数据库，请随意跳到下一部分，开始将你的Flask应用程序连接到数据库。</p><p id="9f1e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您还没有，请<a class="ae ls" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">下载并在您的计算机上安装Postgres </a>。</p><p id="dce8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在打开一个新的命令行窗口，输入<code class="fe nz oa ob oc b">psql</code>。<code class="fe nz oa ob oc b">psql</code>是一个基于终端的界面，用于管理您的Postgres数据库。</p><p id="b155" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行命令<code class="fe nz oa ob oc b">create database [database name];</code>创建一个新的数据库。</p><p id="1e25" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是管理数据库的常用<code class="fe nz oa ob oc b">psql</code>命令列表:</p><ul class=""><li id="6a5a" class="lt lu iq kt b ku kv kx ky la lv le lw li lx lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">\l</code>:列出所有可用的数据库</li><li id="ed24" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">dt</code>:列出所有表格</li><li id="b370" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">\d table_name</code>:描述一个表格，显示其列、列类型等。</li><li id="3731" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">\du</code>:列出所有用户及其角色</li><li id="4915" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">\?</code>:获取所有psql命令的列表</li><li id="33df" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">\q</code>:退出psql终端</li></ul><p id="1857" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者，您可以避免记忆不同的psql命令，并使用Arctype的<a class="ae ls" href="https://arctype.com/?utm_campaign=postgres-heroku&amp;utm_medium=blog&amp;utm_source=medium" rel="noopener ugc nofollow" target="_blank">免费sql编辑器</a>，它为管理Postgres和MySQL数据库提供了一个现代化的界面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/25c60aa523d1e03c3d06759246345892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NGuWfCAl7gkFOPavD4BmTQ.gif"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">SQL编辑器:<a class="ae ls" href="https://arctype.com/?utm_campaign=postgres-heroku&amp;utm_medium=blog&amp;utm_source=medium" rel="noopener ugc nofollow" target="_blank"> Arctype </a></p></figure></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="9076" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">将Flask应用程序连接到本地Postgres数据库</h1><p id="ce66" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">接下来，我们将创建到新Postgres数据库的数据库连接，该数据库将在我们的<code class="fe nz oa ob oc b">models.py</code>文件中使用。首先，需要安装三个软件包:</p><ul class=""><li id="2cd7" class="lt lu iq kt b ku kv kx ky la lv le lw li lx lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">flask-sqlalchemy</code>:用于管理数据库的Python扩展</li><li id="fdb5" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">flask-migrate</code>:用于对现有数据库进行更新</li><li id="20dc" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">Pyscopg2</code>:Python的PostgreSQL数据库适配器</li></ul><p id="b360" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在激活的虚拟环境终端中，运行<code class="fe nz oa ob oc b">(env) $ pip install flask-sqlalchemy flask-migrate pyscopg2</code>安装上面列出的包。如果你在安装<code class="fe nz oa ob oc b">pyscopg2</code>时遇到错误，你可能需要安装<code class="fe nz oa ob oc b">psycopg2-binary</code>来代替。</p><p id="2017" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在接下来的部分中，我将展示如何使用每个包来配置和集成Postgres数据库和Flask应用程序。最终结果将是一个Flask应用程序，它能够向Postgres表添加新条目。</p><h2 id="dc9c" class="mh mi iq bd mj mk ml dn mm mn mo dp mp la mq mr ms le mt mu mv li mw mx my mz bi translated">使用SQLAlchemy从Python管理Postgres数据库</h2><p id="7d00" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated"><a class="ae ls" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank"> SQLAlchemy </a>是一个库，它提供了无缝集成Python程序和数据库的方法。我们将使用SQLAlchemy作为对象关系映射器，将Python类转换成Postgres数据库中的表。</p><p id="f883" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Flask-SQLAlchemy自动将创建的模型翻译成任何数据库的语法(在我们的例子中是Postgres)。</p><p id="dfc9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了从应用程序中与我们的数据库进行交互，我们需要向配置文件中添加以下配置变量:</p><ul class=""><li id="a6fe" class="lt lu iq kt b ku kv kx ky la lv le lw li lx lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">SQLALCHEMY_DATABASE_URI</code>:这是连接字符串，告诉我们的Flask应用程序要连接到哪个数据库。Postgres数据库连接字符串的常见形式是<code class="fe nz oa ob oc b">postgresql://localhost/[YOUR_DATABASE_NAME]</code>。如果你的Postgres用户有密码，你需要使用不同的<a class="ae ls" href="https://www.postgresql.org/docs/9.3/libpq-connect.html#:~:text=The%20general%20form%20for%20a,param1%3Dvalue1%26...%5D&amp;text=Percent%2Dencoding%20may%20be%20used,words%20listed%20in%20Section%2031.1." rel="noopener ugc nofollow" target="_blank"> URI变体</a>。</li><li id="45a3" class="lt lu iq kt b ku mc kx md la me le mf li mg lm nf lz ma mb bi translated"><code class="fe nz oa ob oc b">SQLALCHEMY_TRACK_MODIFICATIONS</code>:我们将它设置为<code class="fe nz oa ob oc b">False</code>，这样我们就不会在每次修改应用程序时收到来自Flask的警告</li></ul><p id="c8c9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要进行上述更改，请打开<code class="fe nz oa ob oc b">config.py</code>文件，并将以下变量添加到<code class="fe nz oa ob oc b">Config</code>类中:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="b248" class="mh mi iq oc b gy oh oi l oj ok">SQLALCHEMY_DATABASE_URI = os.environ.get('SQLALCHEMY_DATABASE_URI') or \<br/>    'postgresql://localhost/[YOUR_DATABASE_NAME]'<br/><br/>SQLALCHEMY_TRACK_MODIFICATIONS = False</span></pre><p id="12e6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在下一个会话中，我们将使用<code class="fe nz oa ob oc b">flask-migrate</code>包无缝地处理对数据库结构的更改。</p><h2 id="2dfd" class="mh mi iq bd mj mk ml dn mm mn mo dp mp la mq mr ms le mt mu mv li mw mx my mz bi translated">设置Flask-Migrate以管理数据库结构</h2><p id="c7a1" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">当我们扩展应用程序时，我们可能需要在不丢失数据库中所有数据的情况下对表进行结构性修改。<a class="ae ls" href="https://flask-migrate.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> Flask-Migrate </a>是一个Python扩展，它使用Alembic自动处理SQLAlchemy数据库迁移。它还支持多数据库迁移和其他功能。</p><p id="60b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们将添加一个表示数据库的数据库对象，并创建一个migration类的实例来处理数据库迁移。</p><p id="8d26" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开<code class="fe nz oa ob oc b">app/ __init__.py</code>，导入<code class="fe nz oa ob oc b">flask_migrate</code>和<code class="fe nz oa ob oc b">SQLAlchemy</code>包:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="b265" class="mh mi iq oc b gy oh oi l oj ok">from flask_migrate import Migrate<br/>from flask_sqlalchemy import SQLAlchemy</span></pre><p id="44a0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后添加以下变量:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="9ca8" class="mh mi iq oc b gy oh oi l oj ok">db = SQLAlchemy(app) ## Create DB object<br/>migrate = Migrate(app,db) ## Create migration object</span></pre></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="cb7a" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">设置PostgreSQL数据库模型</h1><p id="2bb6" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">现在我们终于准备好创建<code class="fe nz oa ob oc b">models.py</code>文件来建立我们的数据库模型。数据库模型用于表示数据库中的表及其结构；它们决定了表的模式。</p><p id="b50b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">models.py</code>将定义我们的表的结构和其他必要的表信息。我们需要创建一个模型(类),其属性与我们打算存储在数据库表中的数据字段相同。</p><p id="4ef2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，用注册表单中每个数据字段的属性创建一个类:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="a8d9" class="mh mi iq oc b gy oh oi l oj ok">class Registration(db.Model):<br/>    id = db.Column(db.Integer, primary_key = True)<br/>    first_name = db.Column(db.String(64))<br/>    last_name = db.Column(db.String(64))<br/>    username = db.Column(db.String(64))<br/>    company = db.Column(db.String(64))<br/>    contact_no = db.Column(db.String(64))<br/>    email = db.Column(db.String(120), index=True, unique=True)<br/>    <br/>    def __repr__(self):<br/>        return '&lt;User {}&gt;'.format(self.username)</span></pre><p id="ab6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后一步是将模型导入到<code class="fe nz oa ob oc b">app\ __init__.py</code>文件:<code class="fe nz oa ob oc b">from app import models</code>。</p><p id="7a2d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您正在使用自己的数据库，我们已经创建了一个免费工具来<a class="ae ls" href="https://blog.arctype.com/erd-builder?utm_campaign=postgres-heroku&amp;utm_medium=blog&amp;utm_source=dev.to" rel="noopener ugc nofollow" target="_blank">设计数据库模式</a>。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="e261" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">使用Flask在Postgres中创建新的注册表</h1><p id="bb4d" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">接下来，我们将通过在虚拟环境中运行<code class="fe nz oa ob oc b">flask db init</code>从命令行实例化数据库。</p><p id="185b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，确保在运行这个命令之前设置了您的<code class="fe nz oa ob oc b">FLASK_APP</code>环境变量。您可以运行以下命令进行检查:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="b168" class="mh mi iq oc b gy oh oi l oj ok">(env) $ python                   <br/>Python 3.8.2 (default, Dec 21 2020, 15:06:04) <br/>[Clang 12.0.0 (clang-1200.0.32.29)] on darwin<br/>Type "help", "copyright", "credits" or "license" for more information.<br/>&gt;&gt;&gt; import os<br/>&gt;&gt;&gt; print(os.environ['FLASK_APP'])<br/>app.py<br/>&gt;&gt;&gt; quit()</span></pre><p id="ec69" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行<code class="fe nz oa ob oc b">flask db init</code>之后，您应该会看到以下输出:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="2e04" class="mh mi iq oc b gy oh oi l oj ok">(env)  $ flask db init<br/>	Creating directory /Users/mac/Desktop/Web_Registration_Form/migrations ...  done<br/>  Creating directory /Users/mac/Desktop/Web_Registration_Form/migrations/versions ...  done<br/>  Generating /Users/mac/Desktop/Web_Registration_Form/migrations/script.py.mako ...  done<br/>  Generating /Users/mac/Desktop/Web_Registration_Form/migrations/env.py ...  done<br/>  Generating /Users/mac/Desktop/Web_Registration_Form/migrations/README ...  done<br/>  Generating /Users/mac/Desktop/Web_Registration_Form/migrations/alembic.ini ...  done<br/>  Please edit configuration/connection/logging settings in<br/>  '/Users/mac/Desktop/Web_Registration_Form/migrations/alembic.ini' before proceeding.</span></pre><p id="99e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从命令日志中，我们可以看到在我们的应用程序中已经创建了一个<code class="fe nz oa ob oc b">migrations</code>文件夹。该文件夹包含在数据库中迁移表和更新表模式所需的文件。</p><p id="ae85" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们有了一个<code class="fe nz oa ob oc b">migrations</code>存储库，是时候使用<code class="fe nz oa ob oc b">flask-migrate</code>扩展将<code class="fe nz oa ob oc b">Registration</code>表迁移到数据库中了。</p><p id="b45a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保您的Postgres服务器已启动；然后运行<code class="fe nz oa ob oc b">flask db migrate</code>命令，将我们的SQLAlchemy数据库自动迁移到我们之前在配置文件中使用URI分配的Postgres数据库。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="3e79" class="mh mi iq oc b gy oh oi l oj ok">(env)  $ flask db migrate -m "registrations table"<br/>INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.<br/>INFO  [alembic.runtime.migration] Will assume transactional DDL.<br/>INFO  [alembic.autogenerate.compare] Detected added table 'registration'<br/>INFO  [alembic.autogenerate.compare] Detected added index 'ix_registration_email' on '['email']'<br/>  Generating /Users/mac/Desktop/Web_Registration_Form/migrations/versions/eccfa5d8a3f6_registrations_table.py ...  done</span></pre><p id="74a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">flask db migrate</code>不对数据库进行任何更改，它只生成迁移脚本。为了进行更改，我们使用<code class="fe nz oa ob oc b">flask db upgrade</code>命令。您也可以使用<code class="fe nz oa ob oc b">flask db downgrade</code>恢复更改。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="c6b4" class="mh mi iq oc b gy oh oi l oj ok">(env) $ flask db upgrade<br/>INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.<br/>INFO  [alembic.runtime.migration] Will assume transactional DDL.<br/>INFO  [alembic.runtime.migration] Running upgrade  -&gt; eccfa5d8a3f6, registrations table</span></pre><p id="76ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们可以打开<a class="ae ls" href="https://arctype.com/?utm_campaign=postgres-heroku&amp;utm_medium=blog&amp;utm_source=medium" rel="noopener ugc nofollow" target="_blank"> Arctype </a>并检查该表是否成功迁移到本地Postgres数据库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/ed671ae4064456466782fa4b8d3fd333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S6wltTnfuc4N6QEVzKODSQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">SQL编辑器:<a class="ae ls" href="https://arctype.com/?utm_campaign=postgres-heroku&amp;utm_medium=blog&amp;utm_source=medium" rel="noopener ugc nofollow" target="_blank"> Arctype </a></p></figure></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="56e6" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">从Postgres中的Flask应用程序插入数据</h1><p id="8b54" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">在本节中，我们将更新route函数，将从网页收集的数据添加到数据库中。</p><p id="d985" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们将通过在<code class="fe nz oa ob oc b">app\routes.py</code>文件中包含我们的数据库实例和表模型来更新我们的导入:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="9633" class="mh mi iq oc b gy oh oi l oj ok">from app.models import Registration<br/>from app import db<br/>from flask import redirect, url_for</span></pre><p id="3abb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在route函数中，我们将创建一个<code class="fe nz oa ob oc b">Registration</code>类的实例，并用从表单中收集的信息更新它。然后，我们继续向数据库添加并提交实例。</p><p id="29da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe nz oa ob oc b">routes.py</code>中的<code class="fe nz oa ob oc b">index()</code>函数内添加如下if语句:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="5c32" class="mh mi iq oc b gy oh oi l oj ok">if form.validate_on_submit(): <br/>        reg_form = Registration(username=form.username.data,email=form.email.data, first_name=form.first_name.data,last_name=form.last_name.data, company=form.company.data,contact_no=form.contact_no.data)<br/>        db.session.add(reg_form)<br/>        db.session.commit()<br/>        return redirect(url_for('index'))</span></pre></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="4b4e" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">测试Flask应用程序是否正在Postgres中插入数据</h1><p id="f114" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">在部署到Heroku之前，让我们在本地再测试一次我们的应用程序:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="91b7" class="mh mi iq oc b gy oh oi l oj ok">(env) $ flask run<br/> * Environment: production<br/>   WARNING: This is a development server. Do not use it in a production deployment.<br/>   Use a production WSGI server instead.<br/> * Debug mode: off<br/> * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)</span></pre><p id="19d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">导航到<code class="fe nz oa ob oc b"><a class="ae ls" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/</a></code>，并提交表单。</p><p id="f006" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">提交表单后，您可以通过检查<a class="ae ls" href="https://arctype.com/?utm_campaign=postgres-heroku&amp;utm_medium=blog&amp;utm_source=medium" rel="noopener ugc nofollow" target="_blank"> Arctype </a>中的<code class="fe nz oa ob oc b">Registrations</code>表来检查是否有新条目添加到您的数据库中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/20d72f934525ac0e12f678659f6ffc62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yBNN_o9nX-0gjCV86r-r6Q.gif"/></div></div></figure></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="86d8" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">将Flask应用程序和Postgres数据库部署到Heroku</h1><p id="4f90" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">现在我们已经在本地测试了我们的应用程序，是时候将应用程序和我们的Postgres数据库部署到Heroku了，这样我们就可以从任何地方访问它。</p><p id="1179" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一步是<a class="ae ls" href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener ugc nofollow" target="_blank">下载并安装Heroku CLI </a>。</p><p id="7b55" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们可以用<code class="fe nz oa ob oc b">Heroku login</code>从命令行登录Heroku。</p><p id="5821" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦我们登录，我们可以<a class="ae ls" href="https://devcenter.heroku.com/articles/creating-apps" rel="noopener ugc nofollow" target="_blank">用<code class="fe nz oa ob oc b">Heroku create [app-name]</code>在Heroku </a>上创建一个新的应用程序。Heroku应用程序位于全局名称空间中，因此，您需要为您的应用程序选择一个唯一的名称。如果您没有为您的应用程序指定名称，Heroku将为您的应用程序生成一个随机名称。</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="3f6b" class="mh mi iq oc b gy oh oi l oj ok">(env) $ Heroku create arctype-registration-app<br/>Creating ⬢ arctype-registration-app... done<br/>https://arctype-registration-app.herokuapp.com/ | https://git.heroku.com/arctype-registration-app.git</span></pre><p id="9283" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行<code class="fe nz oa ob oc b">pip freeze &gt; requirements.txt</code>来更新需求文件。这使用下面的格式<code class="fe nz oa ob oc b">&lt;process type&gt;: &lt;command&gt;</code>定义了流程。因为我们的应用程序包含一个web服务器(<code class="fe nz oa ob oc b">gunicorn</code>)，所以进程类型是<code class="fe nz oa ob oc b">web</code>，这个命令将启动gunicorn服务器。因此，我们需要在终端上运行下面的命令来创建Procfile:</p><p id="efe9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">echo web: gunicorn app:app &gt; Procfile</code></p><p id="1998" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Heroku为其PostgreSQL产品提供了不同的服务计划。为您的应用程序选择一个计划取决于您的应用程序的特性及其服务停机时的带宽。在本教程中，我们将使用<code class="fe nz oa ob oc b"><a class="ae ls" href="https://devcenter.heroku.com/articles/heroku-postgres-plans#hobby-tier" rel="noopener ugc nofollow" target="_blank">hobby-dev</a></code> <a class="ae ls" href="https://devcenter.heroku.com/articles/heroku-postgres-plans#hobby-tier" rel="noopener ugc nofollow" target="_blank">计划</a>，它是免费的，并且服务于我们需要它的目的。</p><p id="e435" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们将使用<code class="fe nz oa ob oc b">heroku addons:create heroku-postgresql:hobby-dev --app app-name</code>命令为我们的应用程序创建一个<code class="fe nz oa ob oc b">hobby-dev</code> Postgres数据库:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="bba5" class="mh mi iq oc b gy oh oi l oj ok">(env) $ heroku addons:create heroku-postgresql:hobby-dev --app arctype-registration-app<br/>Creating heroku-postgresql:hobby-dev on ⬢ arctype-registration-app... free<br/>Database has been created and is available<br/> ! This database is empty. If upgrading, you can transfer<br/> ! data from another database with pg:copy<br/>Created postgresql-slippery-96960 as DATABASE_URL<br/>Use heroku addons:docs heroku-postgresql to view documentation</span></pre><p id="a1cd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">关于使用Postgres数据库的更多信息可以在这里找到。</p><p id="0417" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们已经为Heroku上的应用程序创建了一个远程Postgres数据库，我们需要用新的数据库URI更新<code class="fe nz oa ob oc b">config.py</code>文件中的<code class="fe nz oa ob oc b">SQLALCHEMY_DATABASE_URI</code>变量。为了检索远程数据库URI，我们将使用<code class="fe nz oa ob oc b">heroku config --app app-name</code>命令。</p><p id="0f2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">URI更新后，最后一步是将我们的应用程序部署到Heroku的服务器上。</p><p id="a2ac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们将提交所有文件，并将它们推送到Heroku master分支。运行<code class="fe nz oa ob oc b">git add .</code>和<code class="fe nz oa ob oc b">git commit -m “heroku commit”</code>，然后运行<code class="fe nz oa ob oc b">git push heroku main</code>部署到Heroku。</p><p id="336c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您的应用程序现已在<code class="fe nz oa ob oc b"><a class="ae ls" href="https://app-name.herokuapp.com" rel="noopener ugc nofollow" target="_blank">https://your-app-name.herokuapp.com</a></code>上线。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/bfa16e1380e8007c290500a310172834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jniLyns4Daombj6l"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">云端托管的Flask web应用</p></figure></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="b157" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">将表从本地Postgres数据库迁移到Heroku</h1><p id="a1a4" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">最后一步是将我们在本地Postgres数据库中创建的<code class="fe nz oa ob oc b">Registrations</code>表迁移到新的Heroku数据库实例。我们可以通过从Heroku Python终端运行<code class="fe nz oa ob oc b">db create_all()</code>来做到这一点:</p><pre class="kg kh ki kj gt od oc oe of aw og bi"><span id="bc63" class="mh mi iq oc b gy oh oi l oj ok">(env) $ heroku run python<br/>Running python on ⬢ arctype-registration-app... up, run.9023 (Free)<br/>Python 3.6.12 (default, Sep 29 2020, 17:50:28) <br/>[GCC 9.3.0] on linux<br/>Type "help", "copyright", "credits" or "license" for more information.<br/>&gt;&gt;&gt; from app import db<br/>&gt;&gt;&gt; db.create_all()</span></pre><p id="8913" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要检查是否成功创建了<code class="fe nz oa ob oc b">Registrations</code>表，请从Arctype连接到Heroku数据库，您应该会看到<code class="fe nz oa ob oc b">Registrations</code>表。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="9a20" class="nn mi iq bd mj no np nq mm nr ns nt mp jw nu jx ms jz nv ka mv kc nw kd my nx bi translated">恭喜你！</h1><p id="74c1" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">现在，您自豪地拥有了一款网络应用，任何人只要能上网，就能在世界任何地方使用它。让我们缩小范围，回顾一下我们涵盖的内容:</p><ol class=""><li id="5eda" class="lt lu iq kt b ku kv kx ky la lv le lw li lx lm ly lz ma mb bi translated">Flask应用程序如何工作</li><li id="86c9" class="lt lu iq kt b ku mc kx md la me le mf li mg lm ly lz ma mb bi translated">创建Postgres数据库</li><li id="afa0" class="lt lu iq kt b ku mc kx md la me le mf li mg lm ly lz ma mb bi translated">使用SQLAlchemy在Python中创建数据库模型</li><li id="2e3f" class="lt lu iq kt b ku mc kx md la me le mf li mg lm ly lz ma mb bi translated">使用flask-migrate在Python中迁移数据库</li><li id="c0ca" class="lt lu iq kt b ku mc kx md la me le mf li mg lm ly lz ma mb bi translated">从Flask应用程序向Postgres数据库插入数据</li><li id="7c49" class="lt lu iq kt b ku mc kx md la me le mf li mg lm ly lz ma mb bi translated">将Flask应用程序和Postgres数据库部署到Heroku</li></ol><p id="2dc5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Flask、Postgres和Heroku是快速创建健壮web应用程序的强大组合。</p><p id="a410" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在去创建你自己的网络应用，如果你遇到困难，你可以加入<a class="ae ls" href="https://discord.gg/YaZQzBen" rel="noopener ugc nofollow" target="_blank"> Discord社区</a>，从其他开发者那里获得帮助。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="9866" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ol">原载于2021年2月11日https://arctype.com</em><em class="ol"/><a class="ae ls" href="https://blog.arctype.com/postgres-heroku/" rel="noopener ugc nofollow" target="_blank"><em class="ol">。</em></a></p></div></div>    
</body>
</html>