<html>
<head>
<title>Python Geo Data Visualization With Kepler.gl</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Kepler.gl实现Python地理数据可视化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/geo-data-visualization-with-kepler-gl-fbc15debbca4?source=collection_archive---------1-----------------------#2022-06-11">https://betterprogramming.pub/geo-data-visualization-with-kepler-gl-fbc15debbca4?source=collection_archive---------1-----------------------#2022-06-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="95be" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在几分钟内启动并运行Python web服务</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cef6128156f02b809bf6303158f80695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DqVc88HVcyh-zxpo"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@kikisad?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Killian Cartignies </a>拍摄的照片</p></figure><p id="a0d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您曾经处理过任何类型的地理数据，那么您应该知道仅仅盯着CSV、表格或JSON格式的数据并不是非常有用。你需要把它放在地图上，以便查看它并找出任何模式。这可能不是收集见解的全部方式的结束，你仍然需要做适当的分析或/和运行你的ML模型，但这是绝对必须的。</p><h1 id="2a28" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">开普勒. gl是什么？</strong></h1><p id="a069" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Kepler.gl 是优步的开源项目(GitHub <a class="ae kv" href="https://github.com/keplergl/kepler.gl" rel="noopener ugc nofollow" target="_blank"> link here </a>)，用于创建高性能和数据无关的web应用程序。它建立在<a class="ae kv" href="https://www.mapbox.com" rel="noopener ugc nofollow" target="_blank"> Mapbox </a>之上，可以处理大型数据集，在配置想要可视化的内容和方式方面提供了很大的灵活性。</p><p id="213d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它使用图层作为基本构建模块，允许您创建交互式地图，您可以添加、移除、显示和隐藏图层，以及更改图层的外观。这是一个超级基本的例子，使用了来自<a class="ae kv" href="https://data.world" rel="noopener ugc nofollow" target="_blank"> data.world </a>的公共飞行数据集:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/773b5d2d5b0aa84552957c6d6c7fcd6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_e1dxvDdVdLPPPz4wnt4MQ.png"/></div></div></figure><p id="c807" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如你所看到的，你可以布置网格，点，拱门/线，多边形，甚至做一个3D地图。您可以通过多种方式进行非常精细的过滤(在数据集允许的范围内):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/459251e4e1c2b44cbbc4fe7634a89e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*Jjyno4N-OyKXJe3E91sbJg.png"/></div></figure><p id="3629" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在这里展示的数据集只有37，042行，但我已经用数百万行进行了测试，它处理得相当好。地理计算经过GPU加速以获得更好的性能。</p><p id="be1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://eng.uber.com/keplergl/" rel="noopener ugc nofollow" target="_blank">这里</a>也是优步工程博客上的一篇很棒的文章，里面有很多关于如何表示数据的例子和更多关于开普勒的细节。</p><h1 id="77ea" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">开普勒. gl的使用方法？</h1><ul class=""><li id="3f00" class="mr ms iq ky b kz mk lc ml lf mt lj mu ln mv lr mw mx my mz bi translated">在他们的<a class="ae kv" href="https://kepler.gl/demo" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">演示页面</strong> </a>上传一个数据集——如果你想看看这是什么，或者如果你需要一个一次性的快速方法来可视化适量的非敏感数据，这是一个好办法。</li><li id="38e1" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">作为一个<a class="ae kv" href="https://docs.kepler.gl/docs/api-reference/get-started" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> react组件</strong></a>——如果你想把这个功能嵌入到你现有的项目中，这会给你很多控制权(对状态、数据流、外观等)。只是做:</li></ul><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="e6fc" class="nk lt iq ng b gy nl nm l nn no">npm install kepler.gl</span></pre><ul class=""><li id="0ad6" class="mr ms iq ky b kz la lc ld lf np lj nq ln nr lr mw mx my mz bi translated">作为一个<a class="ae kv" href="https://docs.kepler.gl/docs/keplergl-jupyter" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> python模块</strong></a>——如果你是一个非前端专家，你需要快速完成工作，除了地图之外没有太多花哨的UI组件，这就是你要的。首先，运行:</li></ul><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="fdfa" class="nk lt iq ng b gy nl nm l nn no">pip install keplergl</span></pre><p id="b543" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这最后一个是我将快速浏览的内容，以演示如何快速启动并运行一个令人印象深刻的MVP应用程序，并向不耐烦的利益相关者或客户展示您的数据。</p><h1 id="9c9f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用开普勒的Python模块创建web应用程序</h1><p id="2053" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我将做一些快速的假设——假设你对python、pandas和fast API有所了解(不需要成为专家也能理解)。</p><h2 id="4561" class="nk lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">1)让我们导入我们需要的内容:</h2><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="8b60" class="nk lt iq ng b gy nl nm l nn no">import uvicorn<br/>import pandas as pd<br/>from keplergl import KeplerGl <br/>from fastapi import FastAPI<br/>from fastapi.responses import HTMLResponse</span></pre><h2 id="1e3e" class="nk lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">2)加载您的数据:</h2><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="8006" class="nk lt iq ng b gy nl nm l nn no"># load a csv file<br/>df = pd.read_csv('my_data.csv')<br/># or a json file<br/>df = pd.read_json('my_data.json')</span></pre><p id="c523" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，这可能会超过一个文件，所以只需要在一个循环中这样做，并像这样组合每个文件产生的<code class="fe od oe of ng b">dataframes</code>:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="b286" class="nk lt iq ng b gy nl nm l nn no">all_data = pf.concat([all_data, df])</span></pre><h2 id="84d9" class="nk lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">3)初始化Kepler.gl映射:</h2><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="0746" class="nk lt iq ng b gy nl nm l nn no">kepler = KeplerGl(config=my_map_config)</span></pre><p id="eb1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里的配置是您可能需要做一点调整，以便正确地适应您的任何用例。</p><p id="3d9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要做到这一点，至少对于纯粹的表示方面来说，最好的方法是使用笔记本来快速加载数据并根据需要进行定制，然后导出配置并将其应用到您的项目中。从更实用的角度来看，您也可以手动或以编程方式调整相关参数。</p><p id="6497" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">配置示例如下所示:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="73fb" class="nk lt iq ng b gy nl nm l nn no">config = {<br/>  "version": "v1",<br/>  "config": {<br/>     "visState": {<br/>        "filters": [<br/>            {<br/>              "<strong class="ng ir">dataId</strong>": ["my_data"],<br/>              "id": "11111",<br/>              "<strong class="ng ir">name</strong>": ["some_col_name"],<br/>              "type": "multiSelect",<br/>              "value": [],<br/>              "enlarged": False,<br/>              "plotType": "histogram",<br/>              "animationWindow": "free",<br/>              "yAxis": None,<br/>              "speed": 1,<br/>            }<br/>        ],<br/>        "layers": [<br/>            {<br/>              "id": "22222",<br/>              "type": "point",<br/>              "config": {<br/>                  "<strong class="ng ir">dataId</strong>": "my_data",<br/>                  "label": "my_data",<br/>                  "color": [30, 150, 190],<br/>                  "highlightColor": [252, 242, 26, 255],<br/>                  "isVisible": True,<br/>                  "visConfig": {<br/>                      "radius": 5,<br/>                      "fixedRadius": False,<br/>                      "opacity": 0.8,<br/>                      "outline": False,<br/>                      "thickness": 2,<br/>                      "strokeColor": None,<br/>                       ...<br/>                   },<br/>                   "hidden": False<br/>              }<br/>           }  <br/>         ],<br/>         "interactionConfig": {<br/>             "tooltip": {<br/>                 "fieldsToShow": {<br/>                     "my_data": [<br/>                         {"name": "col_1", "format": None},<br/>                         {"name": "col_2", "format": None}  <br/>                    ]<br/>                 },<br/>                 "compareMode": False,<br/>                 "compareType": "absolute",<br/>                 "enabled": True,<br/>             },<br/>             "brush": {"size": 0.5, "enabled": False},<br/>             "geocoder": {"enabled": False},<br/>             "coordinate": {"enabled": False},<br/>         },<br/>         "layerBlending": "normal",<br/>         "splitMaps": [],<br/>         "animationConfig": {"currentTime": None, "speed": 1},<br/>     },<br/>     "mapState": {<br/>         "bearing": 0,<br/>         "dragRotate": False,<br/>         "latitude": 40.710394,<br/>         "longitude": -74.000288,<br/>         "pitch": 0,<br/>         "zoom": 12.41,<br/>         "isSplit": False,<br/>     },<br/>     "mapStyle": {<br/>         "styleType": "dark",<br/>         "topLayerGroups": {},<br/>         "visibleLayerGroups": {<br/>             "label": True,<br/>             "road": True,<br/>             "border": False,<br/>             "building": True,<br/>             "water": True,<br/>             "land": True,<br/>             "3d building": False,<br/>         },<br/>         "threeDBuildingColor": [<br/>             9.665468314072013,<br/>             17.18305478057247,<br/>             31.1442867897876,<br/>         ],<br/>         "mapStyles": {},<br/>      },<br/>  },<br/>}</span></pre><p id="b092" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本上，有三个主要部分— <code class="fe od oe of ng b">visState</code>、<code class="fe od oe of ng b">mapState</code>和<code class="fe od oe of ng b">mapStyle</code>。</p><p id="8cb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe od oe of ng b"><strong class="ky ir">MapState</strong></code>用于定义你每次重新加载页面时在世界地图上的起始位置，即起始/默认位置。</p><p id="b8ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe od oe of ng b"><strong class="ky ir">MapStyles</strong></code>设置KeplerGl应用程序的一般主题。它有几个预设选项可用，如黑暗，静音夜，光，静音光和卫星。</p><p id="2a68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe od oe of ng b"><strong class="ky ir">VizState</strong></code>是比较有意思的一个。它定义了<strong class="ky ir"> <em class="og">层</em> </strong>(无论是点、六边形、线等)以及每个层使用的数据集——注意，我用粗体显示了dataId，这是您将数据与配置绑定的方式，将在下一节中显示一个示例。您还可以定义<strong class="ky ir"> <em class="og">过滤器</em> </strong>，这些过滤器可以应用于一个或多个集合，并基于数据集中一个或多个字段。此外，在这里你可以定义你想要在工具提示(或者其他交互式选项)中显示什么以及如何显示。</p><h2 id="2958" class="nk lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">4)把你的数据传给开普勒</h2><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="06da" class="nk lt iq ng b gy nl nm l nn no"># the name here should match the dataId in the config<br/>kepler.add_data(data=all_data, name="my_data")</span></pre><h2 id="bebe" class="nk lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">5)将地图转换成HTML</h2><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="b3f5" class="nk lt iq ng b gy nl nm l nn no">kepler_html = kepler._repr_html_()</span></pre><h2 id="f853" class="nk lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">6)启动您的应用程序并返回生成的HTML</h2><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="1623" class="nk lt iq ng b gy nl nm l nn no">app = FastAPI()</span><span id="c2d1" class="nk lt iq ng b gy oh nm l nn no">@app.get("/")<br/>async def index():<br/>   return HTMLResponse(content=kepler_html, status_code=200)</span><span id="2c6b" class="nk lt iq ng b gy oh nm l nn no">if __name__ == "__main__":<br/>   uvicorn.run("web_app:app", host="X", port="X")</span></pre><h2 id="f0fd" class="nk lt iq bd lu ns nt dn ly nu nv dp mc lf nw nx me lj ny nz mg ln oa ob mi oc bi translated">7)从中获得乐趣</h2><p id="d43b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">..感谢您的阅读！</p></div></div>    
</body>
</html>