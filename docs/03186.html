<html>
<head>
<title>CGAffineTransforms, Arcs, and Quad Curves in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI中的cgaffinite变换、圆弧和四次曲线</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/cgaffinetransforms-arcs-and-quad-curves-in-swiftui-41e1dbfe6161?source=collection_archive---------11-----------------------#2020-01-27">https://betterprogramming.pub/cgaffinetransforms-arcs-and-quad-curves-in-swiftui-41e1dbfe6161?source=collection_archive---------11-----------------------#2020-01-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6176" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让创建自定义形状不那么令人生畏</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/088b2df523e3810acff18bc6d198bc85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eTO6mXghvch5e04nwrBiRw.png"/></div></div></figure><p id="d62c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我最近发现自己需要一个可定制的弹出气泡，可以指向上、下、左或右。看起来相对简单的事情最终变成了一个大难题。单独画矩形的圆角是绝对痛苦的。因为我可能不是第一个尝试这样做的人，所以我决定分享这个关于绘制弹出气泡的教程——希望能让一些读者省心。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="61aa" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">入门指南</h1><p id="5e85" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">让我们声明一个名为<code class="fe mu mv mw mx b">PopupBubble</code>的形状，并添加一些可定制的属性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="db6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">几乎所有前进的东西都在我们的<code class="fe mu mv mw mx b">path(in rect:)</code>函数中。为了启动这个函数，我们将设置一些变量。前两个，<code class="fe mu mv mw mx b">rect</code> <em class="na"> </em>和<em class="na"> </em> <code class="fe mu mv mw mx b">fit(CGPoint)</code> <em class="na">，</em>将在本教程稍后相关。我们还为箭头大小创建了一个属性。请注意，用于计算箭头宽度的权重可以根据您的喜好进行调整。我发现811/2000的比例最符合我想要达到的外观。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5ee2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将首先绘制圆角矩形来开始我们的路径。这将在四个弧段中完成。下面显示了我们正在绘制的弧的顺序以及它们相应的开始和结束角度。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/65825cc9c5fbb462e82fb6617cd4b5de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M5c1GNmqGAOLaJ9fEooitA.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">虚线在弧的中心点相交。</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="7ce6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="na">看起来像顺时针方向的圆弧</em> <strong class="kw iu"> <em class="na">并不是SwiftUI中的</em> </strong> <em class="na">一条。</em></p><p id="1f38" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你正从上述角度思考，不知道它到底有什么意义——省省力气吧。它们只有在翻转Y坐标平面并减去90度(0.5*pi弧度)时才有意义。由于我们稍后将调换飞机，我选择让角度保持原样。</p><p id="6a6a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们可以开始绘制我们的路径。请务必将我们绘制的任何<em class="na"> </em> <code class="fe mu mv mw mx b"><em class="na">C</em>GPoint</code>包含在我们的fit函数中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="9228" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们的圆角矩形完成了，让我们继续画箭头。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="c4fb" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">画箭头</h1><p id="bb7c" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">我们首先需要的是一些权重，可以应用到箭头的高度和宽度来计算箭头的路径。这样，箭头的形状将在不同的箭头高度上保持一致。下面是我使用的权重，以及描述这些权重将调整的点的图表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/274a8d3479cbdd5a300f7f108bb2c1c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*InH6j9ojDTmvhkRrM4MGMA.png"/></div></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">我们的箭头路径中的每个重量都是通过简单地插入不同的重量来计算的，直到它看起来像我想要的那样。</p></figure><p id="89ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们继续绘制线段。下图显示了我们将要绘制的不同部分。如您所见，步骤6、8和10是四次曲线(控制点用虚线表示)。剩余的线段是简单的线段。第十步，完成我们的路径。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/9b42fc075ecbb08063eaa51ccf18b62a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4diGOPrF9gKrjq8Otx3QCg.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="88c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就完成了一个指向顶部边缘的弹出气泡。最难的部分完成了！现在，让我们修改这个泡泡，这样我们也可以选择其他的边。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="fc70" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">创建动态箭头边缘</h1><p id="b760" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">不要为每条边绘制新的弹出气泡，让我们简单地调整进入每个气泡路径的变量，然后应用给定特定边的变换。</p><p id="e878" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了保持形状的角和箭头的纵横比，我们需要绘制一个箭头在前沿的弹出气泡。为此，我们将翻转输入<code class="fe mu mv mw mx b">rect</code>的原点和大小。让我们更新我们的<code class="fe mu mv mw mx b">rect</code>变量和<code class="fe mu mv mw mx b">fit(CGPoint)</code>函数来转置这些值。回到我们的<code class="fe mu mv mw mx b">path(in rect:)</code>函数的顶部，在我们声明路径之前，在我们的属性末尾添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="af4a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">改变我们的路径<code class="fe mu mv mw mx b">rect</code>需要改变我们的弧线角度。下图显示了每一步的顺序和角度方向的变化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/ed647123630acc81a407713a6ea2a62b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0iTAtJ9R8gQHvrje0x1lWQ.png"/></div></div></figure><p id="836b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如你在上面看到的，我们的第一个角度现在看起来像我们之前的第三个角度在相反的方向移动。我们的第二个角度看起来像我们之前的第二个角度在相反的方向移动。让我们更新我们的arc变量来反映这些变化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="e210" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此时，您应该能够显示一个弹出气泡形状，其箭头位于前缘或顶部边缘。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="afd1" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">最后的步骤</h1><p id="2f85" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">如果<code class="fe mu mv mw mx b">arrowEdge</code>设置为<code class="fe mu mv mw mx b">.trailing</code>或<code class="fe mu mv mw mx b"><em class="na">.bottom</em></code>，让我们通过添加一些简单的变换来翻转弹出气泡的方向来完成我们的形状。用下面的代码替换我们函数的最后一行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5649" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就完成了我们的定制形状！让我们更新我们的<code class="fe mu mv mw mx b">ContentView</code>来看看它的运行情况:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/41895c9b5ac14378e71c3b8f5079d8ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fhR_p-ZfPveKZNiZs9ym5g.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="82e1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我希望你喜欢这个教程！</p></div></div>    
</body>
</html>