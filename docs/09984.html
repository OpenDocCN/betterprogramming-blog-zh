<html>
<head>
<title>When Not To Use DI, IoC, and IoC Containers in .NET C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">中何时不使用DI、IoC和IoC容器。NET C#</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/when-not-to-use-di-ioc-and-ioc-containers-f95881d0fe0?source=collection_archive---------3-----------------------#2021-11-10">https://betterprogramming.pub/when-not-to-use-di-ioc-and-ioc-containers-f95881d0fe0?source=collection_archive---------3-----------------------#2021-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="9c73" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">最佳实践</h2><div class=""/><div class=""><h2 id="dc7d" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">知道什么时候DIs不是正确的解决方案，以及在什么情况下使用更好的设计。NET C#</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/986e0488d675136f2d14f89c2517f86b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4Yg3_dF_lF0P9CxY"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">奥拉夫·阿伦斯·罗特内在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="7ebe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我多年的软件工程师工作中，我遇到过很多我看不懂代码的情况。</p><p id="a8bc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我认为这是源于我缺乏知识或者我的技能不够敏锐，这总是促使我学习更多。</p><p id="cd30" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，在年复一年的学习和实施之后，我惊讶地发现我仍然不时地面临着同样的问题。为什么当了12年多的软件工程师后，我仍然有同样的问题？！</p><p id="3513" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有人可能会回答这个问题，可能你正在看的代码实在是太糟糕了，这就是为什么它对任何人来说都很难理解，甚至对编写它的人来说也是如此。</p><p id="4b5c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不幸的是，没有。相信我，我希望这是答案，但这不是我说的情况。我所指的代码实际上，以今天的标准来看，是完美的。</p><p id="4c26" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后呢？！！</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt ml"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">订阅艾哈迈德的时事通讯？</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz lb ml"/></div></div></a></div></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="a748" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">这个发现</h1><p id="70d5" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">当我仔细研究它，并投入一些安静的时间做这件事时，我发现了我作为软件工程师一生中最重要的发现之一。</p><p id="9fdd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">依赖注入(DI) </strong>、<strong class="lk jd">反转控制(IoC) </strong>和<strong class="lk jd"> IoC容器</strong>是我们的朋友，但就像生活中的一切一样，如果你滥用它们，你会得到你从未希望得到的东西。</p><p id="a902" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在DI和IoC容器出现之前，管理不同模块/类之间的依赖关系简直是地狱，这就是为什么我们在定义这些依赖关系时更加小心谨慎。在开始实现之前，我们通常会对每个模块/类的依赖性考虑两次甚至更多。</p><p id="ecad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，现在有了DI、IoC和IoC容器之后，定义依赖关系变得像呼吸一样，当你实际上不认识它时，你就隐含地这么做了。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/dfbe75ff83f33df3e348d25dcfdb7b64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M9w--A8DMr9xJixu-jfMxA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@timmossholder?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">蒂姆·莫斯霍尔德</a>在<a class="ae lh" href="https://unsplash.com/s/photos/what?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="4e99" class="na nb it bd nc nd ny nf ng nh nz nj nk ki oa kj nm kl ob km no ko oc kp nq nr bi translated">现在怎么办？</h1><p id="6974" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">为了理解我真正的意思，我将带你看一个实际的例子。我知道你喜欢编码，那么，为什么不开始编码，看看它是如何工作的呢？</p><h2 id="cde5" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">但是，免责声明！</h2><ol class=""><li id="3485" class="oo op it lk b ll ns lo nt lr oq lv or lz os md ot ou ov ow bi translated">您将看到的代码并不完美。出于演示的目的，我们有意忽略了一些最佳实践，以便将您的注意力集中在本文中我们所要介绍的其他最佳实践上。</li><li id="4b39" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">在软件中，总有妥协的余地，90%的时候你可以有自己的设计限制。因此，请研究您会在代码中找到什么，分析它，看看什么适合您自己的情况。</li><li id="312f" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">我不是税务方面的专家，对税务也没有任何实际经验。因此，请原谅我在代码中发现的虚假的临时计算🙂</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/e866e1a73c5335e49394afb581ab064c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81oVjlRcufPVKjZ2kuWXqg.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@ffstop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">摄影师</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="00ba" class="na nb it bd nc nd ny nf ng nh nz nj nk ki oa kj nm kl ob km no ko oc kp nq nr bi translated">在代码车道上绊倒</h1><p id="c5f6" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">我们这里的简单例子是关于计算税收的软件。我们有两种类型的固定税；增值税和收入。</p><p id="7d7f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们开始实现代码。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="ae5d" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">伊洛格</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="a675" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="3e2a" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">这是界面<code class="fe pi pj pk pl b">ILogger</code>。</li><li id="bf52" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">它代表了我们在解决方案中可能拥有的所有记录器。</li><li id="24d7" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">它只定义了一个头为<code class="fe pi pj pk pl b">double void LogMessage(string message);</code>的方法。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="8922" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">itax计算器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="2673" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="4bf6" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">这是<code class="fe pi pj pk pl b">ITaxCalculator</code>的界面。</li><li id="f2a6" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">它代表了我们在解决方案中可以使用的所有税收计算器。</li><li id="1f89" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">它只定义了一个带有头文件<code class="fe pi pj pk pl b">double CalculateTaxPerMonth(double monthlyIncome);</code>的方法。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="15e5" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">控制台记录器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="eb4a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="6a28" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">这是一个实现<code class="fe pi pj pk pl b">ILogger</code>的<code class="fe pi pj pk pl b">ConsoleLogger</code>类。</li><li id="2583" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">它包装了<code class="fe pi pj pk pl b">System.Console</code>类并使用它写入控制台。这并不是完美的实现，但是对于现在来说已经足够了，以便将您的注意力集中在当前的范围上。</li><li id="1dfd" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">如果你想了解更多更好的设计和实现，可以查看这个故事:<a class="ae lh" href="https://itnext.io/how-to-fully-cover-net-c-console-application-with-unit-tests-446927a4a793?sk=63c75b56de78903f09f0d0116df5fe3a" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">如何全面覆盖。带有单元测试的. NET C#控制台应用程序</strong> </a>。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="aae7" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">收入计算器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="bcb9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="5ac0" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">这是一个实现了<code class="fe pi pj pk pl b">ITaxCalculator</code>的<code class="fe pi pj pk pl b">IncomeTaxCalculator</code>类。</li><li id="f529" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">它依赖于<code class="fe pi pj pk pl b">ILogger</code>来记录一些关于计算的重要信息。</li><li id="2ec8" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">这就是为什么<code class="fe pi pj pk pl b">ILogger</code>被注入到构造函数中。</li><li id="5640" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">在<code class="fe pi pj pk pl b">CalculateTaxPerMonth</code>方法实现中，我们只是使用注入的<code class="fe pi pj pk pl b">ILogger</code>进行计算并记录消息。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="9402" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">增值税计算器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="3219" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="6c2a" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">这是一个实现了<code class="fe pi pj pk pl b">ITaxCalculator</code>的<code class="fe pi pj pk pl b">VatTaxCalculator</code>类。</li><li id="d652" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">它依赖于<code class="fe pi pj pk pl b">ILogger</code>来记录一些关于计算的重要信息。</li><li id="6783" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">这就是为什么<code class="fe pi pj pk pl b">ILogger</code>被注入到构造函数中。</li><li id="957b" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">在<code class="fe pi pj pk pl b">CalculateTaxPerMonth</code>方法实现中，我们只是使用注入的<code class="fe pi pj pk pl b">ILogger</code>进行计算并记录消息。</li><li id="bd7e" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">不同的是，这里的计算更加复杂，需要3个步骤来完成计算，并且每一步我们都需要记录重要的信息。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="5427" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">程序</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="3609" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="3466" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">这就是<code class="fe pi pj pk pl b">Program</code>类。它是整个应用程序的主要入口点，顺便说一下，这是一个C#控制台应用程序。</li><li id="29b3" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">我们使用的是<strong class="lk jd"> AutoFac IoC容器</strong>，所以你需要从Nuget包管理器安装它。</li><li id="7d4d" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">在<code class="fe pi pj pk pl b">Main</code>方法中，我们做的第一件事是初始化IoC容器，定义我们的抽象-实现对，并创建我们的IoC容器范围。</li><li id="fdbe" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">在这个范围内，我们正在解析一个<code class="fe pi pj pk pl b">ILogger</code>的实例，以及所有可用的<code class="fe pi pj pk pl b">ITaxCalculator</code>实现的列表。</li><li id="f807" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">然后，我们将使用所有的税收计算器来计算所有税收的总和。</li><li id="bf26" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">最后记录一条消息。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="077d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当运行应用程序时，我们将得到下图中的结果。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pm"><img src="../Images/10baffbeb4b2013d51dd88b7733164ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*41n7dWFsAQJ0a0kdoJ0HLA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</p></figure><p id="9de6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">太好了，应用程序正在按预期工作，我们已经定义了我们的依赖项，我们正在使用DI、IoC和IoC容器……完美。</p><p id="d1d3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">好吧，你可能会发现这很完美，而且容易阅读和理解。然而，如果你有太多的模块，太多的记录器，太多的计算器，…</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pn"><img src="../Images/ae5e9d94cffdf159967b7a8f1545f6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kewz0xLvwocuc8INzphzmA.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@emilymorter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">艾米丽·莫特</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="20b5" class="na nb it bd nc nd ny nf ng nh nz nj nk ki oa kj nm kl ob km no ko oc kp nq nr bi translated">如果呢？</h1><ul class=""><li id="f42f" class="oo op it lk b ll ns lo nt lr oq lv or lz os md po ou ov ow bi translated">你想控制整个记录过程的带宽？每小时记录的行数？</li><li id="935e" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md po ou ov ow bi translated">您想将您的设计迁移到微服务吗？</li><li id="0c4e" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md po ou ov ow bi translated">日志记录服务已关闭，您希望跟踪丢失的日志</li><li id="43cc" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md po ou ov ow bi translated">你想使用类似消息总线的东西吗？</li></ul><p id="80bf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">如果……</strong></p><p id="929e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们有很多“如果”<strong class="lk jd">、</strong>不要误解我的意思，我知道这些不是需求的一部分。所以，我不怪你在设计中没有考虑到这些。</p><p id="eeb1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，我担心的是:</p><ol class=""><li id="e716" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">这种设计还不能满足这些需求。</li><li id="ad96" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">你需要应用太多的改变来适应新的需求。</li><li id="0a39" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">即使你没有把记录器和计算器设计成独立的微服务，这也不意味着税收计算器应该依赖于记录器。</li><li id="c67d" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">计算器可以使用记录器，但是，如果记录器不在，它也应该能够完成它的工作。</li><li id="ef9a" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">我听到有人说，然后我们可以修改实现，使日志记录器为可选的，检查它是通过还是空等等，…</li><li id="f333" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">即使我们应用了这个，除了糟糕的实现和检查空值之外，…计算器模块/类仍然知道一些不合逻辑的叫做logger的东西。</li><li id="75d4" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">此外，使用当前的设计，您无法将计算和记录消息分开。此外，没有一个控制点来监控来自所有计算器的信息流。这使您失去了进行聚合、应用阈值等的优势</li><li id="da9d" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">此外，如果有人新加入团队并开始研究代码，他最终会看到一个巨大的不合逻辑的依赖关系网。</li></ol><p id="ed6a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">再说一次，我知道你不应该基于对未来50年的梦想来应用复杂的设计。然而，当实际应用简单的最佳实践会使整个设计更加健壮和可靠时，我们有时会把事情过分简化。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pp"><img src="../Images/7cbd2c433ed89561b2b5f3ed36934077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DuX2nElelM-EdLVXNRNh3g.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@sharonmccutcheon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">莎伦·麦卡琴</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="b8b3" class="na nb it bd nc nd ny nf ng nh nz nj nk ki oa kj nm kl ob km no ko oc kp nq nr bi translated">然后呢？</h1><p id="fb2b" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">你能做的只是简单地改变你思考依赖的方式。</p><p id="3388" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">是的，我们知道依赖是与实现相联系的，而不是与抽象相联系的。但是，你认为实现<code class="fe pi pj pk pl b">IncomeTaxCalculator</code>应该依赖于记录器吗？</p><p id="e51f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我可以理解，实现了<code class="fe pi pj pk pl b">IRepository</code>接口的<code class="fe pi pj pk pl b">SQLDatabaseRepository</code>类实现将——根据定义——依赖于某个打开和关闭SQL数据库连接的模块。这是一件你可以完全信任地轻易说出的事情。</p><p id="f520" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，在相同的信任级别下，你不能轻易地说同一个<code class="fe pi pj pk pl b">SQLDatabaseRepository</code>类实现依赖于一个日志模块，对吗？</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pq"><img src="../Images/890530a187fb2daae3b33578a95b07f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6uIuw4sz1wysSVUxVAUiJw.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@silvanarnet?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Silvan Arnet </a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><h1 id="d082" class="na nb it bd nc nd ny nf ng nh nz nj nk ki oa kj nm kl ob km no ko oc kp nq nr bi translated">靶心</h1><h2 id="bb7e" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">怎么做才是对的？</h2><p id="1318" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">只要对设计做些简单的改变，我们就能实现它。所以，让我们深入研究代码。</p><h2 id="78c8" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">itax计算器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="9716" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="563c" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">我们对<code class="fe pi pj pk pl b">ITaxCalculator</code>接口进行了修改。</li><li id="4455" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">我们定义了一个<code class="fe pi pj pk pl b">TaxCalculationReportReadyEventHandler</code>类型的委托。</li><li id="5fd7" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">我们在接口中将一个新成员定义为类型为<code class="fe pi pj pk pl b">TaxCalculationReportReadyEventHandler</code>的事件。</li><li id="87f4" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">每当任何税收计算器中的日志消息准备就绪时，该事件将用于向任何订阅者发出消息。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="f80a" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">TaxCalculatorBase</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="69a8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="7733" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">我们为所有的<code class="fe pi pj pk pl b">ITaxCalculators</code>实现定义了新的基类<code class="fe pi pj pk pl b">TaxCalculatorBase</code>。</li><li id="1ec2" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">该类将提供受保护的<code class="fe pi pj pk pl b">OnTaxCalculationReportReady</code>方法的通用实现，该方法负责内部触发<code class="fe pi pj pk pl b">TaxCalculationReportReady</code>事件。这是微软建议的最佳实践之一。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="90cb" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">收入计算器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="f94f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="9373" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">现在<code class="fe pi pj pk pl b">IncomeTaxCalculator</code>类扩展了<code class="fe pi pj pk pl b">TaxCalculatorBase</code>类而不是<code class="fe pi pj pk pl b">ITaxCalculator</code>接口。</li><li id="aa2f" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">它不再像在旧实现中那样依赖于<code class="fe pi pj pk pl b">ILogger</code>接口。</li><li id="c49c" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">现在，每当它需要报告消息时，就会触发<code class="fe pi pj pk pl b">TaxCalculationReportReady</code>事件，而不是直接使用<code class="fe pi pj pk pl b">ILogger</code>接口的实例。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="1590" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">增值税计算器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="ca7f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">与<code class="fe pi pj pk pl b">IncomeTaxCalculator</code>类相同的变化。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="17ac" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">程序</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="7236" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们在这里可以注意到:</p><ol class=""><li id="a670" class="oo op it lk b ll lm lo lp lr pf lv pg lz ph md ot ou ov ow bi translated">这里的主要变化是为每个<code class="fe pi pj pk pl b">ITaxCalculator</code>接口实现订阅<code class="fe pi pj pk pl b">TaxCalculationReportReady</code>事件。</li><li id="a9f5" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">并以集中的<code class="fe pi pj pk pl b">LogTaxReport</code>方式处理。</li><li id="381a" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">现在，关于税收计算和记录需求的知识就在正确的地方。</li><li id="f15a" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">我们现在可以轻松控制解决方案中的不同模块，收集所有需要的信息，做出集体决策，…</li><li id="2705" class="oo op it lk b ll ox lo oy lr oz lv pa lz pb md ot ou ov ow bi translated">简单地说，把你自己击倒，你可以做任何你想做的事。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="c109" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">运行该应用程序，我们将得到如下图所示的结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pm"><img src="../Images/10baffbeb4b2013d51dd88b7733164ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*41n7dWFsAQJ0a0kdoJ0HLA.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a></p></figure><p id="45f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，现在我们有了相同的结果，但具有不同的设计和扩展功能。</p><p id="852d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们可以轻松地修改设计，添加我们在上面的“假设”部分中希望的新功能，简单明了…</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pr"><img src="../Images/209d99e4bb363b45f81e070cb1f35eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ld5f5azd239xkp1E3RCqtQ.jpeg"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@sirtook?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">格雷瓜尔·贝托</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d456" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我想强调一点——在软件世界里，你每天都在成长，你应该始终关注下一步该学什么。学习永远不嫌晚。</p><p id="968e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，希望你觉得读这个故事和我写它一样有趣。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="2369" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="8b0a" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">如果您还不是<strong class="lk jd">媒介</strong>会员，您可以使用<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="lk jd">我的推荐链接</strong> </a>，这样我可以从<strong class="lk jd">媒介</strong>中获得您的一部分费用，您无需支付任何额外费用。<br/>▎订阅<a class="ae lh" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"> <strong class="lk jd">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他很酷的东西直接发送到您的收件箱。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="8869" class="od nb it bd nc oe of dn ng og oh dp nk lr oi oj nm lv ok ol no lz om on nq iz bi translated">想多看作者？</h2><div class="ps pt gp gr pu ml"><a href="https://levelup.gitconnected.com/covariance-and-contravariance-in-net-c-c2b8576b2155" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">中的协方差和逆变。NET C#</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">很难理解吗？让我为你简化它。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mu l"><div class="pv l mw mx my mu mz lb ml"/></div></div></a></div></div></div>    
</body>
</html>