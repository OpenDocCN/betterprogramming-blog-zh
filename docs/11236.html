<html>
<head>
<title>D3 and React-Native — An Essential Guide to Line Graphs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">D3和React-Native——线图的基本指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/d3-and-react-native-an-essential-guide-to-line-graphs-dc1ce392b440?source=collection_archive---------4-----------------------#2022-03-01">https://betterprogramming.pub/d3-and-react-native-an-essential-guide-to-line-graphs-dc1ce392b440?source=collection_archive---------4-----------------------#2022-03-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9e7a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在React Native中制作漂亮的动画线形图的指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/628266a2ce71e1fa0018762fc42dc1fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*etw5z11s3mQYd5Bd8Coj7g.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@isaacmsmith?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">艾萨克·史密斯</a>在<a class="ae kv" href="https://unsplash.com/s/photos/graph?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="30d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">D3.js是我们在React-Native(甚至可能是所有移动开发)中用于创建图表和数据可视化的最好、最强大的工具📈。如果你有任何疑问，我推荐你去看看<a class="ae kv" href="https://www.d3-graph-gallery.com" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">【D3】画廊</strong> </a> <strong class="ky ir">。</strong></p><p id="a312" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图库中惊人的多样性展示了D3在可视化数据方面的多功能性。如果你想完全自由地决定你的数据可视化是什么样子，D3是一个不错的选择。</p><p id="f07c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我写这篇文章的灵感是因为D3折线图上没有太多的资源，更不用说D3和React-Native了。我假设这篇文章的读者已经熟悉React-Native中的SVG动画。</p><p id="0658" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果没有，你可以从我的上一篇文章中了解它们。我希望这篇文章可以作为React-Native开发人员的指南，帮助他们了解D3，并开始制作漂亮的图表。</p><h2 id="93b2" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">我们在建造什么？</h2><p id="4f58" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">和我的操作指南一样，我喜欢从展示我们正在构建的东西开始。我们将创建您在下面的GIF中看到的折线图，并在折线图之间添加动画。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/469793851eb2c37d31032ac56f7dfce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*-cKL6jc53A9ftlWy5E1YAA.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们在iOS上运行的最终结果</p></figure><h2 id="da9c" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">入门</strong></h2><p id="242a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">与我的其他教程不同，我将从样板文件开始。如果你想跟着做，你可以在这里克隆<a class="ae kv" href="https://github.com/friyiajr/D3LineChartSample" rel="noopener ugc nofollow" target="_blank">启动项目。此时您应该在<code class="fe mr ms mt mu b">main</code>分支中。</a></p><p id="69c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不需要设置任何东西，因为我已经为您安装了ReAnimated和SVG库。你所需要做的就是在你的终端中从项目的根目录运行<code class="fe mr ms mt mu b">yarn install</code>，然后运行<code class="fe mr ms mt mu b">cd ios &amp;&amp; pod install</code>。如果你卡住了，想查看解决方案，查看<code class="fe mr ms mt mu b">solution</code>分支。</p><p id="42bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，样板文件并不包括所有的导入。在VSCode编辑器中使用<code class="fe mr ms mt mu b">cmd + .</code>时，您需要导入库值。到目前为止，您的项目应该是一个带有一些按钮的空卡片，如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/0f72e1ee1181ef141ab51502c143806d.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*uyFm_sO2cLIQfz1E02_Pag.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">启动在iOS上运行的画布</p></figure><h2 id="46d8" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">熟悉数据</strong></h2><p id="377e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">让我们从熟悉我们的数据结构开始。每个点都有这些值:</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="869c" class="ls lt iq mu b gy na nb l nc nd">export type DataPoint = {<br/>  date: string;<br/>  value: number;<br/>};</span><span id="85df" class="ls lt iq mu b gy ne nb l nc nd">export const originalData: DataPoint[] = [<br/>  {date: '2000-02-01T05:00:00.000Z', value: 250},<br/>  {date: '2000-02-02T05:00:00.000Z', value: 300.35},<br/>  {date: '2000-02-03T05:00:00.000Z', value: 150.84},<br/>  ...</span></pre><p id="6f27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个应用程序的所有数据都可以在<code class="fe mr ms mt mu b">src</code>目录下的<code class="fe mr ms mt mu b">Data.ts</code>文件中找到。请注意，日期是以ISO-8601字符串格式保存的。这是因为ReAnimated for Android不能很好地处理JavaScript日期对象。稍后将我们的日期传递给<code class="fe mr ms mt mu b">ReAnimated</code>的唯一方式将是ISO日期字符串的形式。我们的值是代表实际金额的数字。</p><h2 id="700a" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">组织我们的数据</h2><p id="3e36" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">为了构建一个图表，我们需要组织我们的数据，以便D3可以处理它。最好的开始方式是创建一个方法，用我们在<code class="fe mr ms mt mu b">App.tsx</code>文件中处理过的图表数据返回一个对象。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="afe8" class="ls lt iq mu b gy na nb l nc nd">const makeGraph = (data: DataPoint[]) =&gt; {};</span></pre><p id="a2ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步我们将计算数据集中的最大值和最小值。这些值用于构成我们图表的y域。这很容易做到，我们只需将数据值输入到<code class="fe mr ms mt mu b">Math.max</code>和<code class="fe mr ms mt mu b">Math.min</code>方法中。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="4337" class="ls lt iq mu b gy na nb l nc nd">const max = Math.max(...data.map(val =&gt; val.value));<br/>const min = Math.min(...data.map(val =&gt; val.value));</span></pre><p id="eb51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，创建y轴就像调用D3库中的<code class="fe mr ms mt mu b">scaleLinear</code>一样简单。注意范围内<code class="fe mr ms mt mu b">GRAPH_HEIGHT</code>的使用。这将确保我们所有的数据点都映射到屏幕上的y坐标，该坐标不大于图形的高度。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="0efa" class="ls lt iq mu b gy na nb l nc nd">const y = scaleLinear().domain([0, max]).range([GRAPH_HEIGHT, 35]);</span></pre><p id="12f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于x轴，我们知道我们的数据总是15天，所以我们将分别在每月的第一天和第十五天设置起点和终点。注意范围内<code class="fe mr ms mt mu b">GRAPH_WIDTH</code>的使用。像y轴一样，它将我们的值映射到屏幕上的x坐标，并确保它们不大于图形的宽度。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="01dc" class="ls lt iq mu b gy na nb l nc nd">const x = scaleTime()<br/>    .domain([new Date(2000, 1, 1), new Date(2000, 1, 15)])<br/>    .range([10, GRAPH_WIDTH - 10]);</span></pre><p id="b544" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们通过使用D3的<code class="fe mr ms mt mu b">line</code>函数创建折线图来结束。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="bf94" class="ls lt iq mu b gy na nb l nc nd">const curvedLine = line&lt;DataPoint&gt;()<br/>    .x(d =&gt; x(new Date(d.date)))<br/>    .y(d =&gt; y(d.value))<br/>    .curve(curveBasis)(data);</span></pre><p id="22eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们从函数中返回<code class="fe mr ms mt mu b">max</code>、<code class="fe mr ms mt mu b">min</code>和<code class="fe mr ms mt mu b">curvedLine</code>值。他们很快就会被用来绘制我们的图表。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="3680" class="ls lt iq mu b gy na nb l nc nd">return {<br/>    max,<br/>    min,<br/>    curve: curvedLine!,<br/> };</span></pre><p id="8931" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，我们的<code class="fe mr ms mt mu b">makeGraph</code>函数应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="c296" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated"><strong class="ak">绘制图形</strong></h2><p id="ebd7" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">接下来我们要做的是绘制图表。让我们从将第一个数据集添加到<code class="fe mr ms mt mu b">App.tsx</code>中的图形数据集数组开始。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="8109" class="ls lt iq mu b gy na nb l nc nd">const graphData: GraphData[] = [makeGraph(originalData)];</span></pre><p id="1134" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为<code class="fe mr ms mt mu b">graphData</code>已经被传递到了<code class="fe mr ms mt mu b">LineChart</code>组件中，让我们跳回到<code class="fe mr ms mt mu b">LineChart.tsx</code>文件中。从分解方法头中的所有组件值开始。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="2375" class="ls lt iq mu b gy na nb l nc nd">const LineChart: FC&lt;LineChartProps&gt; = ({<br/>  height,<br/>  width,<br/>  data,<br/>  bottomPadding,<br/>  leftPadding,<br/>}) =&gt; {</span></pre><p id="fc44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们之前调用<code class="fe mr ms mt mu b">line</code>方法时，D3接受一组域和范围值，并使用它们来构建一个SVG路径。我们的图表实际上只是一个显示在屏幕上的SVG。为了托管我们的线图，我们将SVG画布添加到我们的<code class="fe mr ms mt mu b">LineChart</code>组件中。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="0dbb" class="ls lt iq mu b gy na nb l nc nd">&lt;Animated.View style={styles.chartContainer}&gt;<br/>  &lt;Svg width={width} height={height} stroke="#6231ff"&gt;&lt;/Svg&gt;<br/>&lt;/Animated.View&gt;</span></pre><p id="040a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一点上，我们将看到我们的图表捕捉到其适当的高度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/74161960d6c80ba8926d5c19e9561bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*5lrj-qC1cutF-exPc7sKqQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在iOS上运行的已调整大小的画布</p></figure><p id="ea2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们将添加一些网格线，使图表更加突出。我们可以通过画几条SVG线来做到这一点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="3926" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意这里使用的<code class="fe mr ms mt mu b">x1</code>、<code class="fe mr ms mt mu b">x2</code>、<code class="fe mr ms mt mu b">y1</code>和<code class="fe mr ms mt mu b">y2</code>值。x或y的第一个值是线条起点的坐标。坐标的第二个值是您希望线条结束的位置。我们的结果将是这个空图表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/49e1513caf661ac3bd624251fa5f23cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*nl8bFCBAqDE8QmpeIejs_Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">iOS上带有图形线条的画布</p></figure><p id="98e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，时刻到了，让我们把图表放到画布上。将以下代码添加到文件中我们之前绘制的线条下。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="16ee" class="ls lt iq mu b gy na nb l nc nd">&lt;Path d={data[0].curve} strokeWidth="2" /&gt;</span></pre><p id="59ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果将是如下所示的图形。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/436c05e2c0e1cf466f8e13eb437469ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*FcbXZIyiV-iukeEIokpgPg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在iOS上运行的简单图形</p></figure><p id="661e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，您为<code class="fe mr ms mt mu b">LineChart</code>组件编写的代码应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="dcf4" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">制作多个图形的动画</h2><p id="cd4f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">太令人兴奋了！我们不仅在屏幕上绘制了我们的图表，而且我们还能够添加好的测量指南。</p><p id="599f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文的下一阶段将关注多折线图之间的切换以及这些转换的动画效果。这一部分之所以成为可能，是因为React Native animations的教父William Candillon创作的TypeScript库。</p><p id="b4bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要开始我们的图表动画制作过程，请返回到<code class="fe mr ms mt mu b">App.tsx</code>，将其他数据集添加到我们的图表数组中:</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="74c3" class="ls lt iq mu b gy na nb l nc nd">const graphData: GraphData[] = [<br/>  makeGraph(originalData),<br/>  makeGraph(animatedData),<br/>  makeGraph(animatedData2),<br/>  makeGraph(animatedData3),<br/>];</span></pre><p id="2420" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还需要在<code class="fe mr ms mt mu b">makeGraph</code>的曲线属性上运行redash <code class="fe mr ms mt mu b">parse</code>，并相应地调整您的类型。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="2be4" class="ls lt iq mu b gy na nb l nc nd">import {parse, Path as RePath} from 'react-native-redash';<br/>...<br/>export type GraphData = {<br/>  ...<br/>  curve: RePath;<br/>};</span><span id="5de6" class="ls lt iq mu b gy ne nb l nc nd">const makeGraph = (data: DataPoint[]) =&gt; {<br/>  ...<br/>  return {<br/>    max,<br/>    min,<br/>    curve: parse(curvedLine!),<br/>  };<br/>};</span></pre><p id="32a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">导航回您的<code class="fe mr ms mt mu b">LineChart.tsx</code>文件，并为您当前选择的图形创建一个<code class="fe mr ms mt mu b">sharedValue</code>。这也是制作一个可以在图形之间转换的函数(无需动画)的好时机。总的来说，代码应该是这样的:</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="f509" class="ls lt iq mu b gy na nb l nc nd">const selectedGraph = useSharedValue(data[0]);<br/>const onQuarterTapped = (quarter: number) =&gt; {<br/>  selectedGraph.value = data[quarter - 1];<br/>};<br/>const animatedProps = useAnimatedProps(() =&gt; {<br/>  return {<br/>    d: selectedGraph.value.curve,<br/>  };<br/>});<br/>const q1Tapped = () =&gt; onQuarterTapped(1);<br/>const q2Tapped = () =&gt; onQuarterTapped(2);<br/>const q3Tapped = () =&gt; onQuarterTapped(3);<br/>const q4Tapped = () =&gt; onQuarterTapped(4);</span></pre><p id="087a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您也可以将这些函数添加到文件底部的按钮部分:</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="68c5" class="ls lt iq mu b gy na nb l nc nd">&lt;ButtonSection<br/>  q1Tapped={q1Tapped}<br/>  q2Tapped={q2Tapped}<br/>  q3Tapped={q3Tapped}<br/>  q4Tapped={q4Tapped}<br/>/&gt;</span></pre><p id="061e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，您的代码将是这样的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="f5d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一点上，你将有一个图表，可以在图形之间跳转，如下图所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/1f72a78cc402f7566ba10c8b9cdefe08.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*HT5e7JGB6-sq0zdYE82QLQ.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在Android上运行的预动画图表</p></figure><p id="0df3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">显然，这看起来有点怪异，所以现在让我们添加动画。回到<code class="fe mr ms mt mu b">LineChart.tsx</code>,我们为当前图添加一个状态，我们正在转换的图，以及我们转换的状态。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="e758" class="ls lt iq mu b gy na nb l nc nd">const selectedGraph = useSharedValue(data[0]);<br/>const previousGraph = useSharedValue({...data[0]});<br/>const isAnimationComplete = useSharedValue(true);<br/>const transition = useSharedValue(1);</span></pre><p id="05cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要更新<code class="fe mr ms mt mu b">animatedProps</code>来反映这些图表之间的转换。新代码如下所示:</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="c614" class="ls lt iq mu b gy na nb l nc nd">const animatedProps = useAnimatedProps(() =&gt; {<br/>  return {<br/>    d: mixPath(<br/>      transition.value,<br/>      previousGraph.value.curve,<br/>      selectedGraph.value.curve,<br/>    ),<br/>  };<br/>});</span></pre><p id="4720" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意函数<code class="fe mr ms mt mu b">mixPath.</code>的使用这个<code class="fe mr ms mt mu b">redash</code>函数用从0到1的动画值插入两条路径。让我们通过更新我们的<code class="fe mr ms mt mu b">onQuarterTapped</code>函数来完成从一个状态到下一个状态的动画。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="23f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码做了很多事情，所以我在这里将它分解。首先，我们有一个if语句，如果已经有一个动画在进行中，它会阻止新的动画出现。</p><p id="0a7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果没有活动的动画，我们将选定的图形设置为我们点击的图形。</p><p id="2231" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此时，我们使用<code class="fe mr ms mt mu b">withTiming</code>将过渡值慢慢增加到1，这允许<code class="fe mr ms mt mu b">mixPath</code>将图表动画化。最后，当动画完成时，我们将<code class="fe mr ms mt mu b">isAnimationComplete</code>设置为true，这样用户可以自由地再次点击按钮并转换到另一个图表。</p><h2 id="84b8" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">奖励:动画文本</h2><p id="7466" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">最后，让我们将屏幕顶部的文本动画化，在这里我们可以看到金额。首先向<code class="fe mr ms mt mu b">makeGraph</code>函数添加一个<code class="fe mr ms mt mu b">mostRecent</code>属性。你可以这样做:</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="dc6d" class="ls lt iq mu b gy na nb l nc nd">const makeGraph = (data: DataPoint[]) =&gt; {<br/>  ...<br/>  return {<br/>    max,<br/>    min,<br/>    curve: parse(curvedLine!),<br/>    mostRecent: data[data.length - 1].value,<br/>  };<br/>};</span></pre><p id="da39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们可以在<code class="fe mr ms mt mu b">LineChart.tsx</code>中创建一个派生的值，这样这个字符串对UI线程是可见的。</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="ee71" class="ls lt iq mu b gy na nb l nc nd">const mostRecent = useDerivedValue(() =&gt; {<br/>  return `$${selectedGraph.value.mostRecent}`;<br/>});</span></pre><p id="b0c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们可以使用<code class="fe mr ms mt mu b">react-native-redash</code>中的<code class="fe mr ms mt mu b">ReText</code>在UI上显示值:</p><pre class="kg kh ki kj gt mw mu mx my aw mz bi"><span id="12c7" class="ls lt iq mu b gy na nb l nc nd">&lt;View style={styles.titleContainer}&gt;<br/>  &lt;Text style={styles.titleText}&gt;FACEBOOK&lt;/Text&gt;<br/>  &lt;ReText style={styles.priceText} text={mostRecent} /&gt;<br/>&lt;/View&gt;</span></pre><p id="b081" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们完成的代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="e3cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们最终的结果是这张GIF中的图表</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/d22781cbaf4f973c7023262637a79a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*oFVLYyNQlW1RrPsHXyqwNQ.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们在Android上运行的最终结果</p></figure><h1 id="8dd1" class="nm lt iq bd lu nn no np lx nq nr ns ma jw nt jx md jz nu ka mg kc nv kd mj nw bi translated">最后的想法</h1><p id="6fbd" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">哇，这是一个艰难的时刻！D3无疑有一个陡峭的学习曲线，有时会有点棘手。我希望通过这篇文章，你能够完成这个练习，并了解更多关于如何使用它。</p><p id="45b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望看到React-Native社区围绕这项技术团结起来，并更多地展示我们可以添加到应用程序中的有趣图表。下次再见，快乐编码。</p></div></div>    
</body>
</html>