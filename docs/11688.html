<html>
<head>
<title>Learn Advanced Full-Text Searches With MongoDB Atlas Search</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MongoDB Atlas Search学习高级全文搜索</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/learn-advanced-full-text-searches-with-mongodb-atlas-search-5e4b51719427?source=collection_archive---------5-----------------------#2022-04-08">https://betterprogramming.pub/learn-advanced-full-text-searches-with-mongodb-atlas-search-5e4b51719427?source=collection_archive---------5-----------------------#2022-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f70b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们用MongoDB搜索而不是Elasticsearch</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/64af0b31f2eee4153f4fc75ae65cf8c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F-KMVOuy3gGY2sMr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">丹尼尔·勒曼在Unsplash的照片。</p></figure><p id="47cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在<a class="ae ky" href="https://lynn-kwong.medium.com/learn-powerful-full-text-searches-with-mongodb-atlas-search-e3fee4fcc324" rel="noopener">之前的文章</a>中了解到的，我们现在可以使用MongoDB Atlas Search运行全文搜索查询。如果你正在实现一个搜索引擎，并且还没有决定使用哪个工具，MongoDB Atlas Search可能是传统工具如<a class="ae ky" href="https://www.elastic.co/what-is/elasticsearch" rel="noopener ugc nofollow" target="_blank"> Elasticsearch </a>的一个很好的替代品。在本帖中，我们将介绍MongoDB Atlas Search的一些高级设置和搜索查询。你会发现它们与Elasticsearch中的同行非常相似。这是因为，在幕后，<a class="ae ky" href="https://lucene.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Lucene </a>被用作Elasticsearch和MongoDB的核心。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="71f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应该注意的是，只有当您的MongoDB数据库由MongoDB Atlas托管时，MongoDB Atlas搜索才可用。如果您在本地管理MongoDB服务器，则它不可用。</p><p id="8484" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将继续使用我们一直在做的<code class="fe mc md me mf b">products</code>数据库中的<code class="fe mc md me mf b"><a class="ae ky" href="https://gist.github.com/lynnkwong/a05a96e76551e49df3a1defc93423ad4" rel="noopener ugc nofollow" target="_blank">laptops</a></code>集合，因为产品名称和属性是演示全文搜索的好例子。</p><p id="35d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你之前没有用过MongoDB Atlas，建议用<a class="ae ky" href="https://lynn-kwong.medium.com/how-to-use-mongodb-atlas-to-manage-your-server-and-data-d97a6e7663c5" rel="noopener">这篇文章</a>快速入门。如果您想跟进，请下载这个JSON文件<a class="ae ky" href="https://gist.github.com/lynnkwong/a05a96e76551e49df3a1defc93423ad4" rel="noopener ugc nofollow" target="_blank">并使用下面的命令将数据导入MongoDB Atlas。如果你还没有安装<code class="fe mc md me mf b">mongoimport</code>，请跟随</a><a class="ae ky" href="https://www.mongodb.com/docs/database-tools/installation/installation-linux/" rel="noopener ugc nofollow" target="_blank">这个链接</a> k下载并安装MongoDB数据库工具。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="9ba3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，您需要为自己的案例更改用户名、密码和集群名称。如果您有网络连接问题，记得检查您的IP地址是否被添加到Atlas UI中的IP访问列表。</p><p id="dae5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当运行上述命令时，您将在MongoDB Atlas中自动创建<code class="fe mc md me mf b">products</code>数据库和<code class="fe mc md me mf b">laptops</code>集合，其中包含200个笔记本电脑文档，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="992f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们创建一个用于全文搜索的Atlas搜索索引。您可以使用Atlas UI、Atlas Search API或MongoDB CLI创建一个Atlas搜索索引。最简单的方法是使用Atlas UI，因为您不需要指定集群元数据，如公钥/私钥、集群名称、组id等。</p><p id="0f5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Atlas UI中，找到您的组织、项目和集群。如果您只有一个集群，那么当您打开Atlas UI时，它已经显示在那里了。单击集群名称以打开控制面板，您可以在其中找到“搜索”选项卡。单击它打开用于创建搜索索引的页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/664de5f4e6d5b674d4ac2f5584da27e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DTr9ytoeiK5c1dyI.png"/></div></figure><p id="41ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在点击“创建搜索索引”按钮，为我们在<code class="fe mc md me mf b">products</code>数据库中的<code class="fe mc md me mf b">laptops</code>集合创建一个搜索索引。会打开这样一个页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/902afb8ea48cc50cdf22fe8190ab2557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*N0OYyWv65t2a0izE.png"/></div></figure><p id="0679" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建议选择“JSON编辑器”,因为那里可以有更高级的配置。除此之外，MongoDB Atlas Search几乎所有的文档都使用JSON配置。因此，最好从一开始就熟悉JSON的设置。</p><p id="a3a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个高级教程中，我们将使用静态映射。实际上，还建议使用静态映射，这样您就可以选择要索引哪些字段以及如何索引它们。您可以使用高级设置，如自动完成和带有静态映射的同义词。<code class="fe mc md me mf b">laptops</code>系列的映射文档是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="1c1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于索引定义的一些重要注意事项:</p><ul class=""><li id="3e2d" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu mo mp mq mr bi translated">当文档被索引时使用<code class="fe mc md me mf b">analyzer</code>，而<code class="fe mc md me mf b">searchAnalyzer</code>用于分析搜索查询。它们通常是相同的。默认的也是最常用的分析器是<code class="fe mc md me mf b">lucene.standard</code>，它将一个字符串小写，并通过空格和标点符号将其拆分成记号。此外，删除了常见的停用词，如<em class="ms">中的</em>、<em class="ms">中的</em>、<em class="ms">中的</em>等。</li><li id="6fac" class="mj mk it lb b lc mt lf mu li mv lm mw lq mx lu mo mp mq mr bi translated">我们指定<code class="fe mc md me mf b">dynamic</code>是<code class="fe mc md me mf b">false</code>，所以我们需要明确指定每个字段的映射。</li><li id="836c" class="mj mk it lb b lc mt lf mu li mv lm mw lq mx lu mo mp mq mr bi translated"><code class="fe mc md me mf b">name</code>字段有两种索引类型，一种是常规的<code class="fe mc md me mf b">string</code>，另一种是<code class="fe mc md me mf b">autocomplete</code>，支持随类型搜索查询。自动完成类型有自己的设置，但是默认设置在大多数情况下应该足够了。</li><li id="c927" class="mj mk it lb b lc mt lf mu li mv lm mw lq mx lu mo mp mq mr bi translated"><code class="fe mc md me mf b">attributes</code>字段是一个文档数组。Atlas搜索只需要数组元素的数据类型。</li></ul><p id="5610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的是，请注意我们需要在<strong class="lb iu"> same database </strong>中为同义词定义创建一个单独的集合。您可以使用<code class="fe mc md me mf b">mongosh</code>运行以下命令来创建<code class="fe mc md me mf b">synonyms</code>集合:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="7485" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，<code class="fe mc md me mf b">synonyms</code>集合应该在与要搜索的目标集合相同的数据库中创建，并且与索引定义中的<code class="fe mc md me mf b">synonyms</code>字段同名。</p><p id="434e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同义词有两种，分别是<code class="fe mc md me mf b">equivalent</code>和<code class="fe mc md me mf b">explicit</code>。对于一个<code class="fe mc md me mf b">equivalent</code>类型，所有的同义词都是等价的，并且可以互换。然而，对于<code class="fe mc md me mf b">explicit</code>类型，这只是一个方向，即只有<code class="fe mc md me mf b">input</code>字段中的单词可以被<code class="fe mc md me mf b">synonyms</code>字段中的单词替换，而不是相反。因此，如果你搜索“联想”，只包含“ThinkPad”而没有“Lenovo”的笔记本电脑将被返回。但如果搜索“ThinkPad”，只包含“Lenovo”而不包含“ThinkPad”的，则不会返回。后面我们会用一个例子来看。</p><p id="548c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建完<code class="fe mc md me mf b">synonyms</code>集合后，您可以继续创建搜索索引，如上所示。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="4bac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在已经创建了搜索索引，我们可以继续创建和运行全文搜索查询。使用静态映射，包括像自动完成和同义词这样的高级设置，我们不能使用Atlas UI中的“搜索测试器”来运行复杂的查询，而是需要使用带有<code class="fe mc md me mf b">mongosh</code>或驱动程序的聚合管道。在这篇文章中，我们将使用<code class="fe mc md me mf b">mongosh</code>,因为它不局限于特定的编程语言，因此更加通用。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="d12b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">搜索1:使用自动完成功能进行搜索:</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><pre class="kj kk kl km gt my mf mz na aw nb bi"><span id="6457" class="nc nd it mf b gy ne nf l ng nh">[<br/>  { _id: 2, name: 'Lenovo IdeaPad Model 2', score: 1 },<br/>  { _id: 8, name: 'Lenovo ThinkPad Model 8', score: 1 }<br/>]</span></pre><p id="029e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<code class="fe mc md me mf b">autocomplete</code>操作符来执行随键入搜索的查询。<code class="fe mc md me mf b">path</code>字段指定要搜索的字段，它应该具有如上所示定义的<code class="fe mc md me mf b">autocomplete</code>类型。如果你想了解更多关于MongoDB Atlas搜索聚合查询的基本语法，请查看<a class="ae ky" href="https://lynn-kwong.medium.com/learn-powerful-full-text-searches-with-mongodb-atlas-search-e3fee4fcc324" rel="noopener">这篇文章</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="9202" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">搜索2:使用自动完成加模糊搜索功能。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><pre class="kj kk kl km gt my mf mz na aw nb bi"><span id="3439" class="nc nd it mf b gy ne nf l ng nh">[<br/>  { _id: 2, name: 'Lenovo IdeaPad Model 2', score: 1 },<br/>  { _id: 8, name: 'Lenovo ThinkPad Model 8', score: 1 }<br/>]</span></pre><p id="81af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个查询与上面的查询有相同的结果，这意味着模糊搜索和自动完成功能工作正常。注意，我们为<code class="fe mc md me mf b">fuzzy</code>指定了<code class="fe mc md me mf b">maxEdits</code>和<code class="fe mc md me mf b">prefixLength</code> <a class="ae ky" href="https://www.mongodb.com/docs/atlas/atlas-search/autocomplete/#options" rel="noopener ugc nofollow" target="_blank">选项</a>，这样我们就不会得到太多与此查询无关的结果。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="dc5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">搜索三:用同义词搜索。</strong></p><p id="d508" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们先试着用<em class="ms">等价的</em>同义词进行搜索。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><pre class="kj kk kl km gt my mf mz na aw nb bi"><span id="264a" class="nc nd it mf b gy ne nf l ng nh">[<br/>  { _id: 134, name: 'Apple MacBook Model 134', score: 1.738951921463012 },<br/>  { _id: 184, name: 'Apple MacBook Model 184', score: 1.738951921463012 }<br/>]</span></pre><p id="d317" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以尝试用“MacBook”、“Macintosh”或“Mac”搜索，总会得到相同的结果，因为它们是等价的同义词，可以互换。</p><p id="1e5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们尝试用<em class="ms">显式</em>同义词进行搜索:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><pre class="kj kk kl km gt my mf mz na aw nb bi"><span id="6be7" class="nc nd it mf b gy ne nf l ng nh">[<br/>  { _id: 97, name: 'ThinkPad T480 Model 97' },<br/>  { _id: 40, name: 'Lenovo T480 Model 40' },<br/>  { _id: 117, name: 'Lenovo ThinkPad T480 Model 117' }<br/>]</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><pre class="kj kk kl km gt my mf mz na aw nb bi"><span id="16db" class="nc nd it mf b gy ne nf l ng nh">[<br/>  { _id: 97, name: 'ThinkPad T480 Model 97' },<br/>  { _id: 117, name: 'Lenovo ThinkPad T480 Model 117' }<br/>]</span></pre><p id="7013" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个例子演示了“ThinkPad”可以被“Lenovo”搜索，但反之则不行。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="8c5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">搜索4:用短语搜索。</strong></p><p id="54ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时，我们希望搜索一个有序的术语序列，它必须与输入查询中指定的完全一致。这可以通过<code class="fe mc md me mf b">phrase</code>操作器实现。让我们分别使用<code class="fe mc md me mf b">text</code>和<code class="fe mc md me mf b">phrase</code>操作符搜索“联想T480 ”,您会立即看到不同之处:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><pre class="kj kk kl km gt my mf mz na aw nb bi"><span id="75f2" class="nc nd it mf b gy ne nf l ng nh">[<br/>  { _id: 40, name: 'Lenovo T480 Model 40' },<br/>  { _id: 117, name: 'Lenovo ThinkPad T480 Model 117' },<br/>  { _id: 97, name: 'ThinkPad T480 Model 97' },<br/>  ...<br/>]</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><pre class="kj kk kl km gt my mf mz na aw nb bi"><span id="37e0" class="nc nd it mf b gy ne nf l ng nh">[ { _id: 40, name: 'Lenovo T480 Model 40' } ]</span></pre><p id="6883" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe mc md me mf b">phrase</code>操作符只返回一个结果，因为它要求搜索字符串中的标记在结果文档中以相同的顺序出现。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="1357" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">搜索5:将多个运算符组合在一起。</strong></p><p id="a115" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们学习使用<code class="fe mc md me mf b">compound</code>操作符将多个操作符组合在一起。如果你对Elasticsearch有所了解，你会发现语法非常相似。我们还在MongoDB Atlas Search中使用了<code class="fe mc md me mf b">must</code>、<code class="fe mc md me mf b">mustNot</code>、<code class="fe mc md me mf b">should</code>和<code class="fe mc md me mf b">filter</code>子句。</p><p id="6bd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们找到所有仍有库存的惠普笔记本电脑:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><pre class="kj kk kl km gt my mf mz na aw nb bi"><span id="2be4" class="nc nd it mf b gy ne nf l ng nh">[<br/>  { _id: 200, name: 'HP ZBook Model 200', quantity: 8 },<br/>  { _id: 196, name: 'HP ZBook Model 196', quantity: 4 }<br/>]</span></pre><p id="dec5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">奇怪的是，<code class="fe mc md me mf b"><a class="ae ky" href="https://www.mongodb.com/docs/atlas/atlas-search/equals/#std-label-equals-ref" rel="noopener ugc nofollow" target="_blank">equals</a></code>操作符只能处理<em class="ms">布尔值</em>和<em class="ms"> objectId </em>值。因此，我们需要使用<a class="ae ky" href="https://www.mongodb.com/docs/atlas/atlas-search/range/#std-label-range-ref" rel="noopener ugc nofollow" target="_blank">范围</a>运算符来检查数量是否为0。</p><p id="99c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们编写一个更复杂的查询来查找满足以下条件的笔记本电脑:</p><ul class=""><li id="e2ce" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu mo mp mq mr bi translated">品牌不是苹果。</li><li id="0e50" class="mj mk it lb b lc mt lf mu li mv lm mw lq mx lu mo mp mq mr bi translated">仍有现货。</li><li id="ae04" class="mj mk it lb b lc mt lf mu li mv lm mw lq mx lu mo mp mq mr bi translated">内存为32GB或存储容量为1TB</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="b7e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哇哦。如此简单的搜索问题会变得非常复杂。与Elasticsearch类似，如果某个字段包含一组嵌套文档，我们很容易陷入这样的问题(“bool/compound hell”)。然而，一旦你知道了模式，它实际上并不复杂。只是写起来有点繁琐。</p><p id="3668" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此复合搜索查询的要点:</p><ul class=""><li id="d441" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu mo mp mq mr bi translated"><code class="fe mc md me mf b">filter</code>条款与<code class="fe mc md me mf b">must</code>具有相同的效力。但是，它不用于计算最终的搜索分数。如果你想提高某个领域的分数，你需要使用<code class="fe mc md me mf b">must</code>子句，而不是<code class="fe mc md me mf b">filter</code>。此外，值得指出的是<code class="fe mc md me mf b">mustNot</code>也不会影响搜索分数。它的工作原理类似于<code class="fe mc md me mf b">filter</code>从句的否定。</li><li id="340f" class="mj mk it lb b lc mt lf mu li mv lm mw lq mx lu mo mp mq mr bi translated"><code class="fe mc md me mf b">should</code>子句，顾名思义，指定了应该满足的条件，因此是可选的。然而，我们可以使用<code class="fe mc md me mf b">minimumShouldMatch</code>选项来指定返回一个结果需要满足多少可选条件。</li><li id="f5bb" class="mj mk it lb b lc mt lf mu li mv lm mw lq mx lu mo mp mq mr bi translated">我们可以在<code class="fe mc md me mf b">compound</code>操作符中使用<code class="fe mc md me mf b">compound</code>操作符。这就是事情开始变得复杂的地方。然而，我们应该记住嵌套的<code class="fe mc md me mf b">compound</code>操作符与顶级操作符的工作方式完全相同。它通常用于包含嵌套文档数组的字段，如本例中的<code class="fe mc md me mf b">attributes</code>字段。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="d2de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们演示了如何使用静态映射创建MongoDB Atlas搜索索引。引入了一些特殊的设置，如自动完成随键入搜索和同义词搜索。我们还介绍了一些常见的搜索查询，从基本到高级，可以在您的实际工作中直接使用。</p><p id="9afd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于嵌套字段的搜索，即那些值是文档数组的字段，不要被看似复杂的查询吓倒。只要您知道<code class="fe mc md me mf b">compound</code>操作符是如何工作的，您就可以自己构建强大的查询，使用<code class="fe mc md me mf b">must</code>、<code class="fe mc md me mf b">mustNot</code>、<code class="fe mc md me mf b">should</code>和<code class="fe mc md me mf b">filter</code>子句作为构建块。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="b600" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相关文章:</p><ul class=""><li id="359b" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu mo mp mq mr bi translated"><a class="ae ky" href="https://lynn-kwong.medium.com/how-to-do-basic-full-text-searches-in-mongodb-48b17242676?source=your_stories_page----------------------------------------" rel="noopener">如何在MongoDB中进行基本的全文搜索</a></li></ul></div></div>    
</body>
</html>