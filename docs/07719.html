<html>
<head>
<title>How To Push a Docker Image to Amazon ECR With Jenkins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Jenkins将Docker图像推送到亚马逊ECR</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-push-a-docker-image-to-amazon-ecr-with-jenkins-ed4b042e141a?source=collection_archive---------1-----------------------#2021-02-12">https://betterprogramming.pub/how-to-push-a-docker-image-to-amazon-ecr-with-jenkins-ed4b042e141a?source=collection_archive---------1-----------------------#2021-02-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6471" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建和配置AWS，并使用Jenkins推送它</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7dcde038009949e8bca9f99719c8718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MZDWUHUr8cKXatIW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马特·斯卡兰迪斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="9cf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一年前，我的网站在Heroku上运行。因为Heroku不允许在同一个实例上有多个应用程序，我不得不每月支付两次7美元(后端和前端应用程序)。对于每一个额外的应用程序，这将花费我每月另外7美元。</p><p id="00ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我确信内部部署会便宜很多，所以我拿了一台旧笔记本电脑，安装了所有的东西。在配置了Linux和docker-compose之后，我的网站终于又开始运行了。这让我每个月节省了14美元。</p><p id="b837" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直到出现问题。你不希望发生的问题。您可能也会遇到的问题:</p><ul class=""><li id="df66" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">电源故障</li><li id="2f55" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">WiFi连接中断</li><li id="1cd1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">配置问题</li></ul><p id="7776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，出于必要，唯一可用的选择是回到云中以提高稳定性。但这一次，它将是一个不同于Heroku的云提供商。将我的Docker映像推送到云中是这个解决方案的第一部分。这就是这篇文章的全部内容:将Docker图像推送到像Amazon AWS ECR这样的云存储库中。</p><p id="cd22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我向你保证:这篇文章只会占用你几分钟的时间。我们将处理部署到ECR的三个步骤:</p><ul class=""><li id="72d8" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">创建AWS ECR存储库。</li><li id="b5df" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在Jenkins中配置AWS凭证。</li><li id="ecd2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">创建一个与Jenkins一起推动的构建步骤。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="9617" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">创建AWS ECR存储库</h1><p id="e2e8" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">第一步很简单:您所要做的就是登录AWS开发人员控制台，并转到您的AWS服务弹性容器注册中心(AWS ECR)。</p><p id="9ba0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个服务中，您将创建一个Docker容器存储库，正如您将在提供的屏幕截图中看到的那样。你不必担心让所有的默认设置都开着。他们没有隐性成本。</p><p id="e94e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要填写的唯一字段是“docker存储库名称”选择一个像“网站前端”或更适合你的应用程序的名字。点击“创建存储库”，您将有一个存储库来推送Docker图像。</p><p id="5c9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很简单，对吧？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/21488a3a65da302b343aee1f9b1a4eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*N3m9mApkwF3-E4NeMUlIBw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建仓库AWS菜单</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8ec9" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">在Jenkins中配置AWS凭据</h1><p id="bb6e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">你可以使用亚马逊ECR <a class="ae ky" href="https://plugins.jenkins.io/amazon-ecr/" rel="noopener ugc nofollow" target="_blank">插件</a>在Jenkins中存储你的亚马逊AWS凭证，并且你可以通过使用CloudBees Docker构建和发布<a class="ae ky" href="https://plugins.jenkins.io/docker-build-publish/" rel="noopener ugc nofollow" target="_blank">插件</a>来使用它们。在继续本节的其余部分之前，请确保安装了这两个插件。</p><p id="524c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的仪表板中，添加AWS凭据。</p><p id="1684" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="no">注意:确保不要将你的个人信息透露给整个公司，因为你可能会因此惹上麻烦。如果你在一个组织内这样做，建议你也创建一个单独的IAM用户，只允许访问ECR。想象一下，有人登录了你的AWS账户，并可能花了很多钱。他们最终会找你来付账。</em></p><p id="4bd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须填写四个字段:</p><ul class=""><li id="fda9" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">在Jenkins内部使用的ID</li><li id="31e5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">描述—这给出了关于Jenkins中的凭证的信息。</li><li id="9bd9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">您的AWS访问密钥ID</li><li id="d3ec" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">您的AWS秘密访问密钥</li></ul><p id="4b3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，您可以按“OK ”,并且您将能够通过引用Jenkins ID在您的管道中使用凭证！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/90b50a6b8f585feba3bd4a3d353369d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*toK_T9R97asH-JzaWn4vGQ.png"/></div></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0590" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">创建一个与Jenkins一起推动的构建步骤</h1><p id="c52a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在一切都配置好了，您只需要对您的开发管道做一个小的调整。如何在Angular中建立这样一个管道的例子可以在本文中找到。</p><p id="243d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在最后一个阶段，我们将命名为“部署”，我们将添加一个脚本，将Docker映像推送到Amazon ECR。</p><p id="186a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了如何实现这一点。确保用正确的配置替换所有内容:</p><ul class=""><li id="07af" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">您的AWS账号— <code class="fe nq nr ns nt b">&lt;aws-account-number&gt;</code></li><li id="fb27" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">您所在的地区— <code class="fe nq nr ns nt b">ecr-repository-server&gt;</code></li><li id="0bd6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">您的詹金斯证书ID — <code class="fe nq nr ns nt b">&lt;jenkins-aws-ID&gt;</code></li><li id="00b7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">您的Docker存储库名称— <code class="fe nq nr ns nt b">&lt;ecr-repository-name&gt;</code></li><li id="9167" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">您的标签<code class="fe nq nr ns nt b">&lt;tag&gt;</code>(例如，最新的)</li></ul><p id="f8be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！每当管道到达“部署”阶段，您的映像将被推向ECR！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/ead17d75aac10c73ee28eb2002d0dcb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FxWEtgGJbZCcvh4qK3nwVA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在詹金斯部署阶段</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="30ee" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">包扎</h1><p id="323a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在本文中，我们看到了一种通过使用Jenkins将Docker图像直接推送到Amazon ECR的方法。如果你不想为亚马逊CodeBuild或CodeDeploy之类的服务付费，那就没必要。</p><p id="415c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章是关于重用你已经拥有的东西。不要让云提供商限制你。如果您需要您的管道100%在线，您仍然可以在以后切换到AWS或不同的云提供商提供的服务！</p><p id="d6f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，该解决方案允许您将Docker图像推送到云中，而不需要额外的成本，并且完全保留在Amazon AWS的免费层中。很快，我会写更多关于你可以在云端用这些Docker映像做什么的文章！</p><p id="1bd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将向您展示如何使用这些Docker图像在Amazon EC2实例中建立您的网站，并将您的总云成本降低到每月仅几美元。</p><p id="c75f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">敬请期待！</p></div></div>    
</body>
</html>