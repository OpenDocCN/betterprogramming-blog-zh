<html>
<head>
<title>Which Should You Use: Asynchronous Programming or Multi-Threading?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你应该使用哪个:异步编程还是多线程？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/which-should-you-use-asynchronous-programming-or-multi-threading-7435ec9adc8e?source=collection_archive---------2-----------------------#2020-05-01">https://betterprogramming.pub/which-should-you-use-asynchronous-programming-or-multi-threading-7435ec9adc8e?source=collection_archive---------2-----------------------#2020-05-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="18e0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">差异、常见误解和Python示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6eddaf6676813d8e21ab9fc2426e2167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G-JcOwcbJfFe70evn2FoNA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="ece4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">说到软件工程，这两个概念经常会有点混淆。它们都是<a class="ae lu" href="https://en.wikipedia.org/wiki/Concurrency_(computer_science)" rel="noopener ugc nofollow" target="_blank">并发、</a>的形式，但它们的含义不同，应用方式也不同，或者在相同的场景中使用也不同。</p><p id="b55d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">简单的解释就是t <a class="ae lu" href="https://stackoverflow.com/questions/34680985/what-is-the-difference-between-asynchronous-programming-and-multithreading" rel="noopener ugc nofollow" target="_blank"> hreading是关于工人的；异步是关于任务的</a>。但是让我们稍微探索一下。</p><p id="49a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">类似地，假设我们想做一份鸡蛋和烤面包的早餐。我们会怎么做？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d552" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">同步方法</h1><p id="f554" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">最简单的方法是按顺序进行:</p><ol class=""><li id="64f0" class="mz na it la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">拿出鸡蛋、面包和平底锅，打开炉子。</li><li id="7a0a" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">把鸡蛋敲碎，倒进锅里。</li><li id="285c" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">等鸡蛋煮完。</li><li id="afff" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">取出鸡蛋，加入调味料。</li><li id="ff84" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">将面包放入烤面包机。</li><li id="ccc0" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">等待烤面包机完成。</li><li id="1376" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">拿出烤面包。</li></ol><p id="7fba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">早餐总时间:15分钟。</p><p id="fd0a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">够简单吧？如果我们说以这种方式烹饪鸡蛋类似于执行一个程序，我们会说这是一种<a class="ae lu" href="https://stackoverflow.com/questions/748175/asynchronous-vs-synchronous-execution-what-does-it-really-mean" rel="noopener ugc nofollow" target="_blank">同步方式</a>烹饪鸡蛋。</p><p id="a2bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们有一个人做所有的任务，在一系列(<a class="ae lu" href="https://en.wikipedia.org/wiki/Serialism" rel="noopener ugc nofollow" target="_blank">串行</a>)。我们按顺序进行每一步，不完成最后一步就不能进入下一步。一个更技术性的定义是，每个任务都被阻止执行前一个步骤，并且都是由一个工人完成的。不做好最后一步，我们就无法前进。在这个例子中，我们是计算机的中央处理器<a class="ae lu" href="https://en.wikipedia.org/wiki/Central_processing_unit" rel="noopener ugc nofollow" target="_blank">或CPU。完成的每一个任务都是一个人(一个CPU)完成的。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6d917ab6291e7094edc8c231af0d5df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tqb0_sHBGF4TlSWPDY7j7w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">单线程同步方式做早餐</p></figure><p id="6766" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好酷，我们煮了鸡蛋。但是如果我们想让早晨过得更快呢？你可能会对自己说，“我不会等我的鸡蛋吃完再把面包放进去。”</p><p id="9ca5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你现在像个工程师一样思考了。让我们再试一次，但这一次，我们决定要同时煮鸡蛋和烤面包，并默默地感谢烤面包计时器的发明者。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3188" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">异步方式</strong></h1><p id="8aae" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们仍然可以让一个人做所有的事情，但是我们可以在等待另一个任务完成的同时做一个单独的任务。看起来是这样的:</p><ol class=""><li id="1158" class="mz na it la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">拿出鸡蛋、面包和平底锅，打开炉子。</li><li id="2d46" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">把鸡蛋敲碎，倒进锅里。</li><li id="c9bc" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">等鸡蛋煮完。</li><li id="a87b" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">将面包放入烤面包机。</li><li id="7c6a" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">等待烤面包机完成。</li><li id="2e88" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated"><strong class="la iu">鸡蛋煮熟后</strong>，取出鸡蛋，加入调味料。</li><li id="5d00" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated"><strong class="la iu">一旦吐司完成</strong>，取出吐司。</li></ol><p id="79b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">早餐总时间:八分钟。</p><p id="e2d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看起来都是一样的步骤，对吧？除了一个重大升级。我们没有吃完鸡蛋然后开始烤面包，而是在等鸡蛋吃完的时候把烤面包放进去。我们仍然只有一个工人在做所有的任务，但是他们现在正在异步地做这件事。现在，只有两个任务来实现异步似乎不太可能，你可以想象一下，如果有成千上万的鸡蛋和烤面包，成千上万的煎锅和烤面包机，一次做一个任务会有多么荒谬！</p><p id="70f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是<a class="ae lu" href="https://en.wikipedia.org/wiki/Asynchrony_(computer_programming)" rel="noopener ugc nofollow" target="_blank">异步</a>工程的最大优势之一。通常我们不得不等待一个不受我们控制的动作完成。在这种情况下，它在等待鸡蛋和吐司煮熟。我们可以拥有这个星球上最有效率和最好的厨师，但在大多数情况下，这些鸡蛋只能坐着等着完成。等待这些数据被处理类似于<a class="ae lu" href="https://en.wikipedia.org/wiki/Input/output" rel="noopener ugc nofollow" target="_blank">输入/输出(I/O) </a>，当我们在构建需要大量I/O等待的东西时，这是使用异步编程的最佳时机。</p><p id="40e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们进行API调用，必须从用户那里获得输入，或者类似的事情，不管我们有多少处理器或者我们的计算机有多快，我们都必须等待。我们必须等待API调用完成，等待用户输入信息。这不在我们的控制范围之内，不是变得更快或投入资源就能有任何影响的事情。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2d83677693c39d5d7ffb03a7ab0d2fc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WXtQa9WJYl96TjkCB2Fu9w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">单线程异步方式做早餐</p></figure><p id="1152" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了！现在我们有两种制作鸡蛋的方法。但是假设我们的室友凯文想帮忙做鸡蛋。这会是什么样子？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e199" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">多线程方法</strong></h1><ol class=""><li id="9fd8" class="mz na it la b lb mu le mv lh nn ll no lp np lt ne nf ng nh bi translated">拿出鸡蛋、面包和平底锅，打开炉子。</li><li id="9207" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">把鸡蛋敲碎，倒进锅里。<strong class="la iu"> 1。凯文把面包放进烤面包机。</strong></li><li id="85cf" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">等鸡蛋煮完。<strong class="la iu"> 2。凯文等待吐司完成。</strong></li><li id="c154" class="mz na it la b lb ni le nj lh nk ll nl lp nm lt ne nf ng nh bi translated">取出鸡蛋，加入调味料。<strong class="la iu"> 3。凯文拿出烤面包。</strong></li></ol><p id="252b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">早餐总时间:八分钟。</p><p id="c885" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们有两个人在做早餐，每个人都被分配了一系列的任务。这是同步<a class="ae lu" href="https://en.wikipedia.org/wiki/Multithreading_(computer_architecture)" rel="noopener ugc nofollow" target="_blank">多线程</a>的一个例子，因为你和Kevin都不会同时执行多个任务(包括等待)。</p><p id="c06e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在计算机科学中，一个进程可以有一个或多个线程。在这种情况下，我们有两个线程(人)。你可以在这里了解更多关于什么是线程<a class="ae lu" href="https://www.computerhope.com/jargon/t/thread.htm" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="845c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能会说:“嗯，我只有在有两个人在的情况下才能做两个人的早餐。”电脑也是一样。如果您的计算机有足够的资源，您只能使用多线程。多线程通常用于计算更复杂、需要更多资源的任务，或者出于许多其他原因。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b9ee6b01a6dad5bcc4b83d31686e77c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQOr-cdzcg2S3bqQLMjcvg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">多线程同步烹饪早餐的方法</p></figure><p id="69f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://www.quora.com/What-is-the-difference-between-asynchronous-programming-and-multi-threading" rel="noopener ugc nofollow" target="_blank">那么多线程和异步哪个更好</a>？这确实取决于很多因素，但如果你了解它们是如何工作的，那应该会给你一些关于使用哪一个的见解。<a class="ae lu" href="https://stackify.com/when-to-use-asynchronous-programming/" rel="noopener ugc nofollow" target="_blank">它有很多I/O吗？也许可以试试异步。计算量大吗？也许可以试试多线程。根据语言的不同，编写多线程应用程序比异步应用程序要容易得多，但这一点需要记住。能不能搭建一个</a><a class="ae lu" href="https://codewala.net/2015/07/29/concurrency-vs-multi-threading-vs-asynchronous-programming-explained/" rel="noopener ugc nofollow" target="_blank">多线程异步系统</a>？当然啦！通常，这两个词会相互串联使用。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="618c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Python示例</h1><p id="9b0f" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">让我们看看上面的三个例子(单线程同步、单线程异步和多线程同步)如何在Python例子中工作。</p><p id="5421" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看看使用Python包装器<code class="fe nq nr ns nt b">pip install alpha_vantage</code>从<a class="ae lu" href="https://www.alphavantage.co/" rel="noopener ugc nofollow" target="_blank"> Alpha Vantage </a> API获取股票数据的几种不同方法</p><h2 id="40fb" class="nu md it bd me nv nw dn mi nx ny dp mm lh nz oa mo ll ob oc mq lp od oe ms of bi translated">同步的</h2><p id="7668" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们想要得到四个tickerss，<code class="fe nq nr ns nt b">'AAPL', ‘GOOG’, ‘TSLA', ‘MSFT'</code>的当前价格，并且只有当我们得到所有四个ticker时才打印出来。最简单的方法是使用一个<code class="fe nq nr ns nt b">for</code>循环。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="3a0e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是最蛮力的方式。一旦我们从API调用中得到一个值(在<code class="fe nq nr ns nt b">`ts.get_quote_endpoint(symbol)`</code>中完成),我们就把它打印出来，然后开始下一个符号。</p><p id="480f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是在了解了异步和多线程之后，我们知道我们可以在等待返回值的同时启动另一个API调用。</p><h2 id="19e6" class="nu md it bd me nv nw dn mi nx ny dp mm lh nz oa mo ll ob oc mq lp od oe ms of bi translated">异步的</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="210e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Python中，我们有关键字<code class="fe nq nr ns nt b">await</code>和<code class="fe nq nr ns nt b">async</code>，它们给了我们异步编程的新力量。这些是Python 3.5中的新特性，所以如果您仍在使用Python 2，就需要进行更新。反正很多Python 2都在贬值，所以请更新。</p><p id="b862" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里发生的事情可能有点令人困惑，所以让我们来分析一下。<code class="fe nq nr ns nt b">loop</code>是处理器在等待任务和执行其他任务之间不断循环的地方。这是为了不断检查任务(在我们的例子中是一个API调用)是否完成。</p><p id="3807" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nq nr ns nt b">tasks</code>变量是方法调用的列表。我们将这些任务放在一个为asyncio收集的列表中，称为<code class="fe nq nr ns nt b">group1</code>，然后在<code class="fe nq nr ns nt b">loop.run_until_complete</code>中运行它们。这比我们最初的同步版本快得多，因为我们可以进行多个API调用，而不必等待每个调用完成。</p><p id="06e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:Asyncio在Python笔记本中是奇怪的，更多信息见这里的<a class="ae lu" href="https://stackoverflow.com/questions/47518874/how-do-i-run-python-asyncio-code-in-a-jupyter-notebook" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="fec7" class="nu md it bd me nv nw dn mi nx ny dp mm lh nz oa mo ll ob oc mq lp od oe ms of bi translated">多线程</h2><p id="69d0" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我已经写了一些关于多线程的更深入的文章，所以如果你想了解更多，看看Python中的一些例子，<a class="ae lu" href="https://medium.com/alpha-vantage/data-is-taking-to-long-to-get-back-d48e3bf8f59b" rel="noopener">查看这个链接</a>来了解更多！</p><h2 id="f8b3" class="nu md it bd me nv nw dn mi nx ny dp mm lh nz oa mo ll ob oc mq lp od oe ms of bi translated">关于Python的一个简短说明…</h2><p id="2fa1" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">对于初学者来说，文章结束了！但是对于更高级的用户来说，python上有点星号。说到多线程，Python实际上和其他语言有点不同。从技术上讲，它是并发运行的，而不是并行运行的，这是由它的创建方式决定的。这使得它非常适合I/O工作，但不适合需要高计算能力的任务。你可以通过<a class="ae lu" href="https://medium.com/@nhumrich/asynchronous-python-45df84b82434" rel="noopener">这篇文章</a>更深入地了解这些概念。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="851a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还有几个层面需要学习，比如什么是并行，每个应用程序的更深层次的交互，如何同步线程和通道，以及每种语言如何以不同的方式处理它们。</p><p id="9ad5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">觉得我错过了什么吗？不明白什么？请在下面留下您的问题、评论或见解！</p></div></div>    
</body>
</html>