<html>
<head>
<title>Why Do We Need Message Broker?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我们需要消息代理？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/why-do-we-need-message-broker-7382ce0e46c6?source=collection_archive---------3-----------------------#2022-01-25">https://betterprogramming.pub/why-do-we-need-message-broker-7382ce0e46c6?source=collection_archive---------3-----------------------#2022-01-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9f6e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索message broker的不同用例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9c3b4bd9de4355709e76121a3c28b43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*esgCAcF4lkp6R7Ru"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯蒂娜·特里普科维奇在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在生产中使用微服务架构有时会很有挑战性，尤其是在成功传递每一条消息时。这就是为什么我今天想写关于消息代理的文章。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="56b7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是消息代理，我们为什么需要它们？</h1><p id="87ef" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了让两个应用程序相互交流，我们首先需要一些接口。没有它，他们就不可能交流。这就是为什么我们需要定义接口。因此，定义包括传输方式和传输协议选择，如HTTP、MQTT或SMTP。</p><p id="27e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，有必要就消息结构达成一致。只要两个系统都同意标准的消息结构，它们就可以独立于系统中各自的实现来交换数据。只要接口保持相同的结构，系统的实现就可以随着时间而改变。</p><p id="090c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">消息代理是所有消息发送的中介。因此，我们实现了发射机和接收机之间的额外去耦。发送者向消息代理发送消息，消息代理将消息传递给接收者。这里的一个关键优势是消息代理不需要知道消费者在网络中的位置。</p><p id="4e28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，消息代理充当一个缓冲区——它将保存消息，直到消费者准备好工作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1642" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">建筑差异</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/548b434ca69ebefc90d61a5792f9ed01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wnnk2KxxB-rO1jjxJpxl7A.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="82a1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">两种架构的优缺点</h1><h2 id="ab1a" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated"><strong class="ak">无代理架构</strong></h2><p id="51c5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">优势:</p><ul class=""><li id="9c6d" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">由于在服务之间直接交换消息，减少了网络流量和延迟。</li><li id="e30b" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">它消除了Message Broker成为性能瓶颈和单点故障的可能性。</li><li id="741d" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">复杂性降低，因为不需要配置和维护消息代理。</li></ul><p id="cf85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">缺点:</p><ul class=""><li id="9961" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">每个服务必须知道其他服务的位置。</li><li id="4c09" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">如果发送方或接收方在交换过程中失败，可能会丢失消息。</li><li id="4289" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">实现保证消息传递的机制更具挑战性。</li></ul><h2 id="d0fd" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated"><strong class="ak">基于代理的架构</strong></h2><p id="c6a5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">优势:</p><ul class=""><li id="ade1" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">松散耦合——客户端发出请求，不需要知道其他服务——因此它不需要使用发现机制来查找其他服务实例的位置。</li><li id="4bc1" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">消息缓冲—代理是消息的缓冲区，直到消息被处理。只要对话发生，HTTP(请求/响应协议)上的同步消息交换双方都必须可用。消息传递不是这种情况；消息被排队，直到消费者准备好才被处理。示例:即使订购服务很慢或停止，在线商店也可以接受订单，因为订单在消息代理中排队，可以在服务再次可用时处理。</li><li id="dacb" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">更灵活的沟通</li></ul><p id="2f25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">缺点:</p><ul class=""><li id="ba80" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">潜在的性能瓶颈—消息代理可能是一个性能瓶颈。然而，现代消息代理是为可伸缩性而设计的。</li><li id="4ec0" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">潜在的单点故障——消息代理必须可以连续访问。但是现代的消息代理是为HA设计的。</li><li id="4558" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">额外的操作复杂性——消息代理是系统中必须安装、配置和维护的另一个组件。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2eb5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">消息代理的示例</h1><ul class=""><li id="6824" class="nm nn it lb b lc mu lf mv li oa lm ob lq oc lu nr ns nt nu bi translated">ActiveMQ</li><li id="d725" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">兔子q</li><li id="c9e6" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">阿帕奇卡夫卡</li><li id="0e99" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">或者像AWS Kinesis或AWS SQS这样的基于云的信息系统。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="180d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">选择消息代理时需要考虑什么？</h1><ul class=""><li id="4ec2" class="nm nn it lb b lc mu lf mv li oa lm ob lq oc lu nr ns nt nu bi translated">支持的编程语言——理想情况下，您应该选择一个支持许多不同语言的代理。</li><li id="3f43" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">支持的消息传递标准——消息代理支持各种标准，如AMQP和STOMP，还是它是专有的？</li><li id="6c2d" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">消息排序—代理是否保持传入消息的顺序？</li><li id="7752" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">交付保证—代理是否保证消息被交付？</li><li id="8857" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">持久性——消息是否保存在磁盘上，并因此在代理失败后仍然存在？</li><li id="bd7d" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">持久性——当消费者重新连接到消息代理时，他们会收到中断期间发生的所有消息吗？</li><li id="152b" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">可伸缩性—代理的可伸缩性如何？</li><li id="4795" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">延迟—什么是端到端延迟？</li><li id="11b3" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">竞争消费者——消息代理支持竞争消费者吗？</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eb7c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">权衡取舍</h1><p id="c9a8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">每个经纪人都有不同的权衡。因此，非常低的延迟可能与无序的消息、没有传递保证以及仅存储在RAM中有关。将消息保存在磁盘上会永久存储它们，但可能会增加延迟。选择合适的代理取决于需求。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="098e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">泛称</h1><h2 id="3d48" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated"><strong class="ak">点对点</strong></h2><p id="6460" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们用一个小例子来解释一下。</p><p id="7b03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="od">假设珊卓去邮局给亚力克斯寄了一封信。当她投递的时候她得到一张收据，并且当信到达的时候亚历克斯不必在家。但是桑德拉相信这封信将来会寄到的。</em></p><p id="9d64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，邮政服务充当分发机制，并保证消息的传递。使用邮局时，发送和接收邮件是分开的。</p><p id="eb72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">队列充当一个先进先出(FIFO)缓冲区，多个接收者可以订阅该缓冲区。队列将尝试在消费者中公平地分发消息。但是，只有一个消费者会收到该消息。</p><p id="e652" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，队列被称为持久的。持久性被理解为保证消息保持很长时间，直到消费者从队列中取走它。这确保了消息只被处理一次。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="9683" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated"><strong class="ak">发布-订阅</strong></h2><p id="41f3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><em class="od">麦克斯正在参加一个电话会议。只要他参加会议，他什么都能听到。当他断开连接时，他什么也听不到。</em></p><p id="bbe1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">会议充当广播机制。说话的人并不关心有多少人拨进来听。该系统确保每个拨入的参与者都能听到正在说的话。</p><p id="360a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在经典的消息传递系统中，所谓的“主题”代表发布-订阅变体。“主题”提供了与上述会议示例相同类型的广播可能性。当消息被发送到一个主题时，它被分发给所有订阅的消费者。</p><p id="65d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，主题不是永久的。如在电话会议示例中，如果消费者离线，则消息不会被转发。只有那些有联系的消费者才能听到。</p><p id="b0d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当消息是非正式的并且损失不显著时，使用这种变体。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="c2c4" class="na md it bd me nb nc dn mi nd ne dp mm li nf ng mo lm nh ni mq lq nj nk ms nl bi translated"><strong class="ak">混合动力车型</strong></h2><p id="a16e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">实际上，混合模式时有发生。例如，当多个系统需要一个消息的副本，同时又需要永久保存消息以防丢失时。</p><p id="4a01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这些情况，消息必须像主题一样分发。每条消息都被发送到对其感兴趣的特定系统。这些收件人可以定义将接收消息的其他消费者。</p><p id="c384" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">混合模型的一个例子是ActiveMQ和Kafka。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="61f4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">要考虑</h1><p id="bcb0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您不想丢失消息，必须将它们写入磁盘，但是应该注意，写入磁盘比写入RAM慢100到1000倍。</p></div></div>    
</body>
</html>