<html>
<head>
<title>How to Test Solidity Smart Contracts With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python测试Solidity智能合约</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-test-solidity-smart-contracts-with-python-c2b85dd37d04?source=collection_archive---------9-----------------------#2022-02-28">https://betterprogramming.pub/how-to-test-solidity-smart-contracts-with-python-c2b85dd37d04?source=collection_archive---------9-----------------------#2022-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f4d1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Pytest满怀信心地部署智能合约</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9c745c6680dfeb786564823d323f9990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C4skKYpfgPGXmBbjvCvPXg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:麦康夫兹(<a class="ae kv" href="https://pixabay.com/users/maiconfz-1424200/" rel="noopener ugc nofollow" target="_blank">https://pixabay.com/users/maiconfz-1424200/</a>)</p></figure><p id="71de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">智能合约的设计是不可变的。这意味着，一旦智能合约被部署到区块链，就不可能更新源代码。嗯，不完全是这样。智能合约可以通过一个<a class="ae kv" href="https://docs.openzeppelin.com/upgrades-plugins/1.x/" rel="noopener ugc nofollow" target="_blank"> OpenZeppelin </a>插件转换成代理，其中原始合约指向合约的最新版本。但是，如果一开始就可以避免版本控制，不是更好吗？</p><p id="31fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Rinkeby和Kovan等测试网络是在实时区块链上验证合同功能的便捷方式。但是试图手动验证每个场景既耗时又乏味。在你的<a class="ae kv" href="https://soliditylang.org/" rel="noopener ugc nofollow" target="_blank">可靠性</a>合同代码到达区块链之前发现它的问题不是很好吗？相反，我们可以用基于Python的开发和测试框架<a class="ae kv" href="https://github.com/eth-brownie/brownie" rel="noopener ugc nofollow" target="_blank"> Brownie </a>来评估我们的智能合约。我们将很快对此进行深入研究！</p><p id="e714" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近我一直在学习帕特里克·柯林斯的以太坊发展课程。下面的代码片段在<a class="ae kv" href="https://youtu.be/M576WGiDBdQ?t=17208" rel="noopener ugc nofollow" target="_blank"> freeCodeCamp.org的YouTube视频</a>中有深入的探讨。</p><p id="e133" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来看看智能合同的例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="ab81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b"><strong class="ky ir">SimpleStorage</strong></code>包含一个人可以添加到合同中的功能，以及他们最喜欢的号码。</p><p id="12f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了实现这一点，有一些功能，包括具有<code class="fe ls lt lu lv b">store()</code>和<code class="fe ls lt lu lv b">retrieve()</code>功能的<em class="ly"> </em>。让我们用Python测试这个简单的例子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="f8fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过在<code class="fe ls lt lu lv b">Brownie</code> <strong class="ky ir"> </strong>框架中编写一个测试来评估智能合约在区块链上更新存储的能力。通过遵循<a class="ae kv" href="https://docs.pytest.org/en/7.0.x/" rel="noopener ugc nofollow" target="_blank"> pytest </a>的排列、动作和断言约定，我们将编写一个测试来完成以下任务:</p><ul class=""><li id="24d0" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">将智能联系人部署到区块链(排列)</li><li id="1523" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">将数值写入合同(act)</li><li id="8328" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">从协定(断言)中检索(相同的)数值</li></ul><p id="340c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，这里的客户端帐户是由Brownie提供的。为了更快地执行测试，我们的测试框架使用了<a class="ae kv" href="https://docs.soliditylang.org/en/v0.6.0/introduction-to-smart-contracts.html#the-ethereum-virtual-machine" rel="noopener ugc nofollow" target="_blank">以太坊虚拟机</a>和一个本地区块链。</p><p id="8600" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">调用<code class="fe ls lt lu lv b">test_updating_storage()</code>就像在终端上运行<code class="fe ls lt lu lv b">brownie test</code> <em class="ly"> </em>命令一样简单:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/96d7affca9d05b2c2875bf7970676dda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*acbKeL-l77gTHueSX7Rj6w.png"/></div></div></figure><p id="470d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为测试通过了，所以我们确信我们的<code class="fe ls lt lu lv b">SimpleStorage</code> <strong class="ky ir"> </strong>智能合同可以在几秒钟内完成部署、写入和读取。</p><p id="387c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们继续在合同中添加功能，我们会马上知道上面的核心功能是否意外受损。</p><p id="02fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要详细了解如何设置Brownie并在框架中添加测试，请查看YoutTube上Patrick视频课程的第5课。</p><pre class="kg kh ki kj gt mo lv mp mq aw mr bi"><span id="8233" class="ms mt iq lv b gy mu mv l mw mx"><strong class="lv ir">Want to Connect?</strong></span><span id="e8b6" class="ms mt iq lv b gy my mv l mw mx">I’m <a class="ae kv" href="https://jordan.cassady.me" rel="noopener ugc nofollow" target="_blank">Jordan</a>, a developer based in the Bay Area, California. 🌉 I can help your team achieve their test automation goals, improve code quality and increase developer satisfaction. Check out my work, or contact me @ <a class="ae kv" href="https://jordan.cassady.me" rel="noopener ugc nofollow" target="_blank">jordan.cassady.me</a>.</span></pre></div></div>    
</body>
</html>