<html>
<head>
<title>How to Handle File Inputs With JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript处理文件输入</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/handling-file-inputs-with-javascript-9f2d3a007f05?source=collection_archive---------0-----------------------#2020-04-15">https://betterprogramming.pub/handling-file-inputs-with-javascript-9f2d3a007f05?source=collection_archive---------0-----------------------#2020-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3da7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">接受用户上传的内容</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/14961cf2e08440418b9d7c72cea9e3a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfYhovNQ_dLT8jpTllVmmA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">米歇尔·帕兹在<a class="ae ky" href="https://unsplash.com/s/photos/elevator?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="3069" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多web应用程序需要文件输入来处理前端的文件或将它们上传到后端。</p><p id="f28e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看看如何添加一个文件输入，然后用JavaScript处理输入的文件。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f596" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">访问选定的文件</h1><p id="b343" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">给定以下HTML，我们可以从文件输入中访问文件，如下所示:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="01dd" class="ne md it na b gy nf ng l nh ni">&lt;input type="file" id="input"&gt;</span></pre><p id="f8e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以通过编写以下内容来获取选择的文件:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e82e" class="ne md it na b gy nf ng l nh ni">const fileInput = document.getElementById('input');<br/>fileInput.onchange = () =&gt; {<br/>  const selectedFile = fileInput.files[0];<br/>  console.log(selectedFile);<br/>}</span></pre><p id="685c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们用事件处理程序监听了文件输入的change事件。然后在事件处理程序中，我们通过访问<code class="fe nj nk nl na b">files</code>属性来获取文件，这个属性是一个对象，第一个文件的键为0。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7ec9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">处理多个文件</h1><p id="3c1e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以通过编写下面的代码来创建一个选择多个文件的文件输入。在HTML中，我们写道:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7a72" class="ne md it na b gy nf ng l nh ni">&lt;input type="file" multiple id="input"&gt;</span></pre><p id="4c0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在JavaScript代码中，我们编写以下内容:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="3b80" class="ne md it na b gy nf ng l nh ni">const fileInput = document.getElementById('input');<br/>fileInput.onchange = () =&gt; {<br/>  const selectedFiles = [...fileInput.files];<br/>  console.log(selectedFiles);<br/>}</span></pre><p id="39f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个例子和第二个例子的区别在于，我们向文件输入添加了<code class="fe nj nk nl na b">multiple</code>属性。</p><p id="f29a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在<code class="fe nj nk nl na b">onchange</code>处理程序中，我们用spread操作符将<code class="fe nj nk nl na b">files</code>对象转换成一个数组，以便更容易地操作项目。</p><p id="f165" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl na b">selectedFile</code>应该有一个文件对象数组。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c005" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">动态添加更改监听器</h1><p id="bd9d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们还可以使用<code class="fe nj nk nl na b">addEventListener</code>将同一个监听器附加到文件输入，如下所示:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="e67f" class="ne md it na b gy nf ng l nh ni">const fileInput = document.getElementById('input');</span><span id="1c9e" class="ne md it na b gy nm ng l nh ni">const handleFiles = () =&gt; {<br/>  const selectedFiles = [...fileInput.files];<br/>  console.log(selectedFiles);<br/>}</span><span id="98b4" class="ne md it na b gy nm ng l nh ni">fileInput.addEventListener("change", handleFiles);</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dd52" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">获取关于所选文件的信息</h1><p id="f3dc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以从一个文件中获取各种属性来获得关于它们的信息。</p><p id="7064" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以遍历如下选择的文件:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="251c" class="ne md it na b gy nf ng l nh ni">const fileInput = document.getElementById('input');</span><span id="fb24" class="ne md it na b gy nm ng l nh ni">fileInput.onchange = () =&gt; {<br/>  const selectedFiles = [...fileInput.files];<br/>  for (const f of selectedFiles) {<br/>    console.log(f);<br/>  }<br/>}</span></pre><p id="67d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件对象中包含的一些属性包括:</p><ul class=""><li id="0f03" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated"><code class="fe nj nk nl na b">name</code> —只读字符串形式的文件名。这只是文件名，没有路径信息。</li><li id="a7c8" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated"><code class="fe nj nk nl na b">size</code> —文件的大小，为只读的64位整数</li><li id="ced4" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated"><code class="fe nj nk nl na b">type</code> —文件的MIME类型，为只读字符串，如果类型无法确定，则为空字符串</li></ul><p id="1a80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，给定以下HTML，我们可以如下所示显示上传文件的文件大小:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="96f6" class="ne md it na b gy nf ng l nh ni">&lt;input type="file" multiple id="input"&gt;<br/>&lt;p&gt;&lt;/p&gt;</span></pre><p id="ebbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过访问每个file对象的<code class="fe nj nk nl na b">size</code>属性来显示每个文件的文件大小，如下所示:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="091c" class="ne md it na b gy nf ng l nh ni">const fileInput = document.getElementById('input');<br/>const p = document.querySelector('p');</span><span id="7f7d" class="ne md it na b gy nm ng l nh ni">fileInput.onchange = () =&gt; {<br/>  const selectedFiles = [...fileInput.files];<br/>  p.textContent = selectedFiles.map(s =&gt; s.size).join(', ');<br/>}</span></pre><p id="f474" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在file对象中可以使用<code class="fe nj nk nl na b">size</code>属性。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c426" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">通过click()方法使用隐藏的文件输入元素</h1><p id="1e14" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以用文件输入对象的<code class="fe nj nk nl na b">click</code>方法触发一个文件选择对话框打开。</p><p id="ee28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以隐藏文件输入，并使用一些其他元素来打开文件输入选择对话框。</p><p id="25be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以通过编写以下HTML来实现这一点:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="da88" class="ne md it na b gy nf ng l nh ni">&lt;input type="file" multiple id="input" style='display:none;'&gt;<br/>&lt;button&gt;Upload File&lt;/button&gt;</span></pre><p id="663d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以添加以下JavaScript来单击文件输入，以打开文件选择对话框，并听取文件输入的更改，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="8e24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前面的例子和这个例子之间的唯一区别是，我们添加了一个按钮元素，当用:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="50c6" class="ne md it na b gy nf ng l nh ni">const button = document.querySelector('button');</span><span id="1881" class="ne md it na b gy nm ng l nh ni">button.onclick = () =&gt; {<br/>  fileInput.click();<br/>}</span></pre><p id="d518" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件输入侦听器的工作方式与其他示例相同。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b714" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用拖放选择文件</h1><p id="aa75" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们还可以通过添加拖放侦听器，将文件拖动到一个框中来选择文件。</p><p id="3fc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建一个文件拖放区div，我们可以编写以下HTML:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="28a8" class="ne md it na b gy nf ng l nh ni">&lt;div id='dropbox'&gt;&lt;/div&gt;</span></pre><p id="9a18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以把它放大，用下面的CSS添加一个背景色:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c383" class="ne md it na b gy nf ng l nh ni">#dropbox {<br/>  width: 500px;<br/>  height: 500px;<br/>  background-color: green;<br/>}</span></pre><p id="bcb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在JavaScript代码中，我们可以添加以下拖放事件处理程序来处理文件放置，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="b342" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl na b">dragenter</code>和<code class="fe nj nk nl na b">dragover</code>处理程序只是为了阻止默认动作和停止事件传播。</p><p id="4689" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl na b">drop</code>处理程序具有获取被丢弃文件的逻辑。<code class="fe nj nk nl na b">e.dataTransfer</code>属性有<code class="fe nj nk nl na b">files</code>属性，里面有文件。它是一个类似数组的对象，所以我们可以把它展开成一个数组。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9253" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="ca3e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以通过将输入的类型设置为<code class="fe nj nk nl na b">file</code>来获得带有文件输入的文件。此外，我们可以使用drop listener来获取放入元素中的文件。</p><p id="bfba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl na b">files</code>对象是一个类似数组的对象，拥有文件数据，包括名称、大小和类型。</p></div></div>    
</body>
</html>