<html>
<head>
<title>Volumes and Logs in MySQL Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MySQL Docker中的卷和日志</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/volumes-and-logs-in-mysql-docker-61122f8c1d84?source=collection_archive---------2-----------------------#2020-04-11">https://betterprogramming.pub/volumes-and-logs-in-mysql-docker-61122f8c1d84?source=collection_archive---------2-----------------------#2020-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3881" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">学习设置数据和配置卷以及检查MySQL Docker容器的日志</em></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi gj"><img src="../Images/b141853373618426d97e148e5b6322cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YU2JSnCZpti8gsgymFgcTA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://www.pickpik.com/closeup-photography-brown-wooden-yearly-paper-88087" rel="noopener ugc nofollow" target="_blank"> PickPik </a>拍摄</p></figure><p id="ff78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在一个Docker容器中运行MySQL，那么两件事非常重要:卷和日志。在本文中，我们将详细讨论它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="aa7e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">卷</strong></h1><p id="2179" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">卷是保存Docker容器生成和使用的数据的首选机制。</p><p id="394d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于MySQL Docker容器，有两个重要因素:数据和配置文件。为数据和配置准备好容量是非常重要的，这样无论MySQL容器发生任何变化或灾难，您的数据和配置文件都是安全的。让我们看看如何设置它。</p><p id="1248" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，创建一个目录<code class="fe mz na nb nc b">docker</code>，我们将在其中保存我们的<code class="fe mz na nb nc b">docker-compose.yml</code>文件。然后，在这个目录中创建两个目录，<code class="fe mz na nb nc b">data</code>和<code class="fe mz na nb nc b">config</code>。在这里，我们将分别保存数据和配置文件。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="daf1" class="nh md it nc b gy ni nj l nk nl">mkdir docker<br/>cd docker<br/>mkdir data config</span></pre><p id="e7f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们回到<code class="fe mz na nb nc b">docker</code>目录，并创建一个<code class="fe mz na nb nc b">docker-compose.yml</code>文件。写下以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="ba1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您注意到这个文件的卷部分，我们有一个我们系统的映射本地目录，它是我们刚才用容器中的数据目录和配置文件创建的。为了更清楚地说明这一点，首先看一下volumes部分的第一行。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="1951" class="nh md it nc b gy ni nj l nk nl">- "./config/my.conf:/etc/mysql/conf.d/config-file.cnf"</span></pre><p id="4cfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分号的右边是配置文件的默认位置，MySWL容器的<code class="fe mz na nb nc b">config-file.cnf</code>、<em class="no">、</em>——我们用分号左边指定的本地文件对其进行映射。因此文件<code class="fe mz na nb nc b">./config/my.conf</code> <em class="no"> </em>现在将成为激活的配置文件。我们可以根据您的意愿更改MySWL容器的配置。现在，我将在位于<code class="fe mz na nb nc b">./config</code>目录的<code class="fe mz na nb nc b">my.conf</code>文件中包含以下内容:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="5df4" class="nh md it nc b gy ni nj l nk nl">[mysqld]<br/>bind-address            = 0.0.0.0<br/>max_connections         = 505<br/>max_user_connections    = 500</span></pre><p id="66dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看卷部分的第二行:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="e657" class="nh md it nc b gy ni nj l nk nl">- "<!-- -->./data<!-- -->:/var/lib/mysql:rw"</span></pre><p id="8963" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以MySQL表和其他表的所有数据都驻留在容器内的<code class="fe mz na nb nc b">/var/lib/mysql</code>处。我们将它与本地目录<code class="fe mz na nb nc b">./data</code>进行映射，因此我们可以控制数据。<code class="fe mz na nb nc b">:rw</code>也被指定为提供对容器的这个目录的读写访问。</p><p id="ab9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拥有数据卷为我们提供了更改MySQL版本的数据安全性和灵活性，并且它还可以在灾难发生时保护数据。这一点非常重要。</p><p id="a121" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我们用下面的命令运行这个容器，我们将得到一个功能齐全的MySQL容器，其中映射了卷。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="859e" class="nh md it nc b gy ni nj l nk nl">docker-compose up -d</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="77d4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">日志</strong></h1><p id="7284" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在Docker容器上运行MySQL时，另一个需要注意的重要事情是日志。</p><p id="98a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日志为我们提供了MySQL容器内部正在发生的事情的详细概述，并且它们是调试可能出现的问题的很好的工具。访问Docker容器的日志非常容易。检查日志的一般语法是:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="8e12" class="nh md it nc b gy ni nj l nk nl">docker-compose <!-- -->logs [options] [SERVICE...]</span><span id="555b" class="nh md it nc b gy np nj l nk nl">Options:<br/>    --no-color          Produce monochrome output.<br/>    -f, --follow        Follow log output.<br/>    -t, --timestamps    Show timestamps.<br/>    --tail="all"        Number of lines to show from the end of the    logs each container.</span></pre><p id="af76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们可以使用下面的命令来查看我们刚刚创建的MySQL容器的日志:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="8a98" class="nh md it nc b gy ni nj l nk nl">docker-compose <!-- -->logs -f mysqldb</span></pre><p id="0eef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了理解这一点，MySQL服务的名称是<code class="fe mz na nb nc b">mysqldb</code>，我使用的是选项<code class="fe mz na nb nc b">-f</code>，所以当我查看它时，日志会跟随最近的变化。你也可以尝试探索其他的选择。这个命令应该会给出如下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/5a85877eae27637853ccb6f9dea2aed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Vywl_9ihIF9ozmHPNeFTg.png"/></div></div></figure><p id="18dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，这会给你任何和所有的信息，警告，错误等。相信我，它们会证明非常有用。我想我们已经到了尽头。希望这有用。感谢阅读。</p></div></div>    
</body>
</html>