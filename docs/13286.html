<html>
<head>
<title>Create Live Activities and Dynamic Island With ActivityKit on iOS 16</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS 16上使用ActivityKit创建实时活动和动态岛</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-live-activities-with-activitykit-on-ios-16-beta-4766a347035b?source=collection_archive---------2-----------------------#2022-08-15">https://betterprogramming.pub/create-live-activities-with-activitykit-on-ios-16-beta-4766a347035b?source=collection_archive---------2-----------------------#2022-08-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c701" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在你的锁屏和动态岛中获得实时更新</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/30be02b8d625ddd78771751f02548697.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*U0Jl0OFGJcuoNr7xRtCG5A.png"/></div></figure><pre class="kg kh ki kj gt kn ko kp kq aw kr bi"><span id="6957" class="ks kt iq ko b gy ku kv l kw kx">API support iOS 16.1+ Beta iPadOS 16.1+ Beta Mac Catalyst 16.1+ Beta</span><span id="0665" class="ks kt iq ko b gy ky kv l kw kx">The final code has been updated for the iPhone 14 series that supports Dynamic Island.</span></pre><p id="5a5c" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">如果你是一个一直关注苹果创新的严格开发者，你一定听说过最近的“在锁屏和有直播活动的动态岛中显示直播数据”。</p><p id="8c60" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">苹果在几周前宣布了它，然后我听到了关于它的消息。</p><p id="79a2" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">苹果为它提供了一个新的框架，名为ActivityKit。使用ActivityKit，您可以在iPhone锁屏和动态岛中以实时活动的形式分享应用程序的实时更新。</p><p id="052e" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">实时活动在锁定屏幕上使用<a class="ae lv" href="https://developer.apple.com/documentation/WidgetKit" rel="noopener ugc nofollow" target="_blank"> WidgetKit </a>功能和<a class="ae lv" href="https://developer.apple.com/documentation/SwiftUI" rel="noopener ugc nofollow" target="_blank"> SwiftUI </a>作为其用户界面。</p><blockquote class="lw lx ly"><p id="95d7" class="kz la lz lb b lc ld jr le lf lg ju lh ma lj lk ll mb ln lo lp mc lr ls lt lu ij bi translated">ActivityKit的角色是处理每个实时活动的生命周期:您使用它的API来请求、更新和结束一个实时活动。—苹果公司</p></blockquote><p id="ff76" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">让我们想象一个运动app。这个应用程序用户可能想要跟踪足球比赛的目标和其他统计数据:传球，射门等。，在iPhone锁定屏幕上。</p><p id="a21f" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">另一个例子可能是送餐应用程序。你知道比萨饼消费者可能是不耐烦的用户。无需打开应用程序，应用程序用户就可以在iPhone锁屏上关注披萨快递员。另一个可能是杂货应用。</p><p id="1068" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">对于示例来说，这就足够了。好了，让我们开始现场活动编码。</p><h1 id="9ab5" class="md kt iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">如何编写实时活动应用程序</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mu"><img src="../Images/86533e285d2af183580e368bf397efbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6BSqhFs5rxUFSW7I9P2DBw.jpeg"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">照片由<a class="ae lv" href="https://unsplash.com/@jamesyarema?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">詹姆斯·亚雷马</a>在<a class="ae lv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0cb9" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们必须创建一个小部件来配置ActivityKit。它类似于小部件扩展。</p><p id="06d5" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们将使用<a class="ae lv" href="https://developer.apple.com/documentation/SwiftUI" rel="noopener ugc nofollow" target="_blank"> SwiftUI </a>和<a class="ae lv" href="https://developer.apple.com/documentation/WidgetKit" rel="noopener ugc nofollow" target="_blank"> WidgetKit </a>来创建实时活动的用户界面。Live Activities的工作方式类似于Widget Extension，支持Widget和Live Activities之间的代码共享。</p><p id="134e" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">然而，与小部件相比，实时活动使用不同的机制来接收更新。</p><blockquote class="lw lx ly"><p id="6de8" class="kz la lz lb b lc ld jr le lf lg ju lh ma lj lk ll mb ln lo lp mc lr ls lt lu ij bi translated">实时活动通过ActivityKit或接收远程推送通知从您的应用程序接收更新的数据，而不是使用时间轴机制。—苹果公司</p></blockquote><h1 id="3fa4" class="md kt iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated"><strong class="ak">重要提示</strong></h1><p id="257a" class="pw-post-body-paragraph kz la iq lb b lc nd jr le lf ne ju lh li nf lk ll lm ng lo lp lq nh ls lt lu ij bi translated">现场活动仅在iPhone上可用。</p><p id="ccf5" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">Live Activities和ActivityKit不会包含在iOS 16的初始公开发布版本中，但会在今年晚些时候的更新中公开提供(计划在iOS 16.1中提供)。一旦公开发布，您就可以将包含实时活动的应用程序提交到App Store。</p><p id="de1f" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我将创建一个杂货交付应用程序。然后，我将为交付进度的实时活动创建一个ActivityKit小部件。</p><p id="09e9" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">如果您已经在应用程序中提供了微件，您可以将实时活动的用户界面代码添加到现有的微件扩展中，并且可以在微件和实时活动之间重用代码。</p><p id="e668" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">不要忘记，尽管实时活动利用了widgets的功能，但它们不是小部件。实时活动不使用时间轴机制来提供用户界面。</p><h1 id="4ed5" class="md kt iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">创建应用程序</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ni"><img src="../Images/b4b1b76fec37c96ed53dae8ed993246c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vdgMELKl6dbtw_rL"/></div></div><p class="mz na gj gh gi nb nc bd b be z dk translated">由<a class="ae lv" href="https://unsplash.com/@mr_fresh?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Yura Fresh </a>在<a class="ae lv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e2f0" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我将允许用户通过在锁屏和动态岛中跟踪交付进度的按钮开始实时活动。</p><ul class=""><li id="1ac4" class="nj nk iq lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">按照导航用SwiftUI创建一个单独的app，然后命名为<code class="fe ns nt nu ko b">GroceryDeliveryApp</code>。</li></ul><p id="6f63" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><em class="lz"> Xcode - &gt;文件- &gt;新建- &gt;项目- &gt; App </em></p><ul class=""><li id="3ffd" class="nj nk iq lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">将以下键添加到应用程序的<code class="fe ns nt nu ko b">info.plist</code>中，并设置为是。</li></ul><p id="ce91" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><code class="fe ns nt nu ko b">NSSupportsLiveActivities</code></p><p id="6b0a" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">此键将支持应用程序进行实时活动。</p><ul class=""><li id="5f19" class="nj nk iq lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">配置应用程序后，我们必须创建一个小部件扩展。</li></ul><p id="a199" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">按照导航创建一个小部件扩展，然后将其命名为<code class="fe ns nt nu ko b">DeliveryTrackWidget</code>。</p><p id="a783" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><em class="lz">项目导航器- &gt;选择项目- &gt;从目标列表中添加目标- &gt; Widget扩展</em></p><ul class=""><li id="8f7a" class="nj nk iq lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">将下面的键添加到扩展<code class="fe ns nt nu ko b">info.plist</code>中，并将其设置为YES。</li></ul><p id="7589" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><code class="fe ns nt nu ko b">NSSupportsLiveActivities</code></p><p id="e03e" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">该键将支持实时活动的扩展。</p><p id="cf7d" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">一旦创建了应用程序和微件扩展，您就可以随心所欲地进行设计了。</p><div class="kg kh ki kj gt ab cb"><figure class="nv kk nw nx ny nz oa paragraph-image"><img src="../Images/74b08f50f66f1d27fa50ae55dd4b5338.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*t2vGpvPN7E5NHR7sBS1M1A.png"/></figure><figure class="nv kk nw nx ny nz oa paragraph-image"><img src="../Images/03037f98b58c224850213f6110c54d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*-bQcLaMUNWAfhu7iyctDnQ.png"/></figure></div><div class="ab cb"><figure class="nv kk nw nx ny nz oa paragraph-image"><img src="../Images/27282ebd76473c84d84be4fd05de2dac.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*_AGqksy0CfPNxB1eukwp1w.png"/></figure><figure class="nv kk nw nx ny nz oa paragraph-image"><img src="../Images/f1fd88330482c38db87b7a040a535cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*MXeSpvGmLJU8B1SMWq6yjQ.png"/></figure></div><p id="a935" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">首先我们需要创建一个<code class="fe ns nt nu ko b">ActivityAttributes</code>。</p><p id="d9b7" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们使用<code class="fe ns nt nu ko b">ActivityAttributes</code>来标识一个实时活动。然后，我们使用<code class="fe ns nt nu ko b">ContentState</code>来指定动态内容。我用下面的代码创建了一个<code class="fe ns nt nu ko b">ActivityAttributes</code>结构:</p><pre class="kg kh ki kj gt kn ko ob bn oc od bi"><span id="0f91" class="oe kt iq ko b be of og l oh kx">import SwiftUI<br/>import ActivityKit<br/><br/>struct GroceryDeliveryAppAttributes: ActivityAttributes {<br/>    public typealias LiveDeliveryData = ContentState<br/><br/>    public struct ContentState: Codable, Hashable {<br/>        var courierName: String<br/>        var deliveryTime: Date<br/>    }<br/>    var numberOfGroceyItems: Int<br/>}</span></pre><p id="6e36" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">然后，我们需要用<code class="fe ns nt nu ko b">Activity</code>类创建一个实时活动请求。<code class="fe ns nt nu ko b">Activity</code>类接受<code class="fe ns nt nu ko b">ActivityAttributes</code>结构的通用类型。<br/>注意，如果要更新或结束这个活动，必须在这里传递<code class="fe ns nt nu ko b">pushType</code>值。</p><p id="f17e" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><code class="fe ns nt nu ko b">pushType</code>令牌值代表通过苹果推送服务(APS)系统更新你在特定iOS设备上的活动。您的应用程序将在活动请求之后接收一个push令牌来设置APS协议，然后您将能够通过APS发送活动更新有效负载。</p><p id="a20c" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">请注意，ActivityKit更新和远程推送通知更新的动态数据大小不能超过4KB。</p><p id="ae1e" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我用下面的代码创建了一个<code class="fe ns nt nu ko b">ActivityAttributes</code>结构:</p><pre class="kg kh ki kj gt kn ko ob bn oc od bi"><span id="c3d6" class="oe kt iq ko b be of og l oh kx">let attributes = GroceryDeliveryAppAttributes(numberOfGroceyItems: 12)<br/>let contentState = GroceryDeliveryAppAttributes.LiveDeliveryData(courierName: "Mike", deliveryTime: .now + 120)<br/>do {<br/>    let _ = try Activity&lt;GroceryDeliveryAppAttributes&gt;.request(<br/>        attributes: attributes,<br/>        contentState: contentState,<br/>        pushType: nil)<br/>} catch (let error) {<br/>    print(error.localizedDescription)<br/>}</span></pre><p id="0be4" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">确保有现场活动。不要忘记，用户可以在iPhone上的设置应用程序中选择停用应用程序的实时活动。</p><p id="fa9e" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">如果您想检测实时活动是否可用，以及用户是否允许您的应用程序使用实时活动，您可以使用<code class="fe ns nt nu ko b">areActivitiesEnabled</code>和<code class="fe ns nt nu ko b">activityEnablementUpdates</code>来完成。</p><p id="7dbe" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">此外，要观察正在进行的实时活动的状态，您可以使用<code class="fe ns nt nu ko b">activityStateUpdates</code>。</p><p id="8d9a" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">一旦您创建了一个实时活动，您可以通过<code class="fe ns nt nu ko b">ContentState</code>更新或结束它。</p><p id="fc7d" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我用以下代码更新并结束了一个现场活动:</p><pre class="kg kh ki kj gt kn ko ob bn oc od bi"><span id="df23" class="oe kt iq ko b be of og l oh kx">let updatedStatus = GroceryDeliveryAppAttributes.LiveDeliveryData(courierName: "Adam",<br/>                                                                              deliveryTime: .now + 150)<br/>await activity.update(using: updatedStatus)</span></pre><pre class="oi kn ko ob bn oc od bi"><span id="9f56" class="oe kt iq ko b be of og l oh kx">await activity.end(dismissalPolicy: .immediate)</span></pre><p id="0658" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">稍后可以用<code class="fe ns nt nu ko b">.after(_ date: Date)</code>代替<code class="fe ns nt nu ko b">.immediate</code>结束直播活动。</p><p id="a5be" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">每个活动都有一个<a class="ae lv" href="https://developer.apple.com/documentation/activitykit/activity/pushtokenupdates-swift.property" rel="noopener ugc nofollow" target="_blank"> pushTokenUpdates </a>通过远程推送通知来更新其内容。您可以使用<code class="fe ns nt nu ko b">pushToken</code>数据更新实时活动的内容。在这种情况下，您的应用程序必须注册到APNS才能获得远程推送通知。如果您不熟悉远程推送通知，请阅读<a class="ae lv" href="https://developer.apple.com/documentation/usernotifications" rel="noopener ugc nofollow" target="_blank">用户通知</a>框架的文档。</p><p id="a71a" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">远程推送通知有效负载应该与您的动态数据属性部分相匹配。一个示例推送通知负载应该类似于下面的JSON:</p><pre class="kg kh ki kj gt kn ko ob bn oc od bi"><span id="21b6" class="oe kt iq ko b be of og l oh kx"><br/>{<br/>    "aps": {<br/>        "timestamp": 1660435557,<br/>        "event": "update",<br/>        "content-state": {<br/>            "courierName": "Adam",<br/>            "deliveryTime": 1660435557<br/>        }<br/>    }<br/>}</span></pre><h1 id="b1e1" class="md kt iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">实时活动要求和限制</h1><p id="3f22" class="pw-post-body-paragraph kz la iq lb b lc nd jr le lf ne ju lh li nf lk ll lm ng lo lp lq nh ls lt lu ij bi translated">除非您的应用程序或用户终止活动，否则实时活动最多可持续八小时。超过此限制后，系统会自动终止它。当实时活动结束时，系统会立即将其从动态岛中移除。但是，实时活动会保留在锁定屏幕上，直到用户删除它，或者在系统删除它之前最多再保留四个小时。</p><p id="ae34" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">因此，实时活动在锁定屏幕上最多保留12个小时。</p><p id="4a27" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">直播活动适合锁屏和动态岛。锁定屏幕视图出现在所有升级到iOS 16.1及以上版本的设备上。</p><pre class="kg kh ki kj gt kn ko kp kq aw kr bi"><span id="68da" class="ks kt iq ko b gy ku kv l kw kx">Devices that support the Dynamic Island display Live Activities using the following views: </span><span id="fef8" class="ks kt iq ko b gy ky kv l kw kx">A compact leading view,<br/>A compact trailing view, <br/>A minimal view, <br/>An expanded view</span></pre><p id="35a8" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">当一个人触摸并保持动态岛中的紧凑或最小视图时，以及当实时活动更新时，扩展视图出现。在不支持动态岛的未锁定设备上，扩展视图显示为实时活动更新的横幅。<br/>为了确保系统能够显示您在每个位置的实时活动，您必须支持所有视图。</p><p id="b1db" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">当我们更新一个实时活动时，<code class="fe ns nt nu ko b">ActivityConfiguration</code>返回<code class="fe ns nt nu ko b">ActivityAttributes</code>来更新小部件用户界面。<code class="fe ns nt nu ko b">ActivityConfiguration</code>提供了访问<code class="fe ns nt nu ko b">ActivityAttributes</code>的动态数据(<code class="fe ns nt nu ko b">ContentState</code>)和静态数据的上下文。</p><p id="8e84" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我用下面的代码创建了实时活动的用户界面:</p><pre class="kg kh ki kj gt kn ko ob bn oc od bi"><span id="df00" class="oe kt iq ko b be of og l oh kx">//<br/>//  DeliveryTrackWidget.swift<br/>//  DeliveryTrackWidget<br/>//<br/>//  Created by Batikan Sosun on 13.08.2022.<br/>//<br/><br/>import ActivityKit<br/>import WidgetKit<br/>import SwiftUI<br/><br/>@main<br/>struct Widgets: WidgetBundle {<br/>    var body: some Widget {<br/>        if #available(iOS 16.1, *) {<br/>            GroceryDeliveryApp()<br/>        }<br/>    }<br/>}<br/><br/>@available(iOSApplicationExtension 16.1, *)<br/>struct GroceryDeliveryApp: Widget {<br/>    <br/>    var body: some WidgetConfiguration {<br/>        ActivityConfiguration(for: GroceryDeliveryAppAttributes.self) { context in<br/>            LockScreenView(context: context)<br/>        } dynamicIsland: { context in<br/>            DynamicIsland {<br/>                DynamicIslandExpandedRegion(.leading) {<br/>                    dynamicIslandExpandedLeadingView(context: context)<br/>                 }<br/>                 <br/>                 DynamicIslandExpandedRegion(.trailing) {<br/>                     dynamicIslandExpandedTrailingView(context: context)<br/>                 }<br/>                 <br/>                 DynamicIslandExpandedRegion(.center) {<br/>                     dynamicIslandExpandedCenterView(context: context)<br/>                 }<br/>                 <br/>                DynamicIslandExpandedRegion(.bottom) {<br/>                    dynamicIslandExpandedBottomView(context: context)<br/>                }<br/>                <br/>              } compactLeading: {<br/>                  compactLeadingView(context: context)<br/>              } compactTrailing: {<br/>                  compactTrailingView(context: context)<br/>              } minimal: {<br/>                  minimalView(context: context)<br/>              }<br/>              .keylineTint(.cyan)<br/>        }<br/>    }<br/>    <br/>    <br/>    //MARK: Expanded Views<br/>    func dynamicIslandExpandedLeadingView(context: ActivityViewContext&lt;GroceryDeliveryAppAttributes&gt;) -&gt; some View {<br/>        VStack {<br/>            Label {<br/>                Text("\(context.attributes.numberOfGroceyItems)")<br/>                    .font(.title2)<br/>            } icon: {<br/>                Image("grocery")<br/>                    .foregroundColor(.green)<br/>            }<br/>            Text("items")<br/>                .font(.title2)<br/>        }<br/>    }<br/>    <br/>    func dynamicIslandExpandedTrailingView(context: ActivityViewContext&lt;GroceryDeliveryAppAttributes&gt;) -&gt; some View {<br/>        Label {<br/>            Text(context.state.deliveryTime, style: .timer)<br/>                .multilineTextAlignment(.trailing)<br/>                .frame(width: 50)<br/>                .monospacedDigit()<br/>        } icon: {<br/>            Image(systemName: "timer")<br/>                .foregroundColor(.green)<br/>        }<br/>        .font(.title2)<br/>    }<br/>    <br/>    func dynamicIslandExpandedBottomView(context: ActivityViewContext&lt;GroceryDeliveryAppAttributes&gt;) -&gt; some View {<br/>        let url = URL(string: "LiveActivities://?CourierNumber=87987")<br/>        return Link(destination: url!) {<br/>            Label("Call courier", systemImage: "phone")<br/>        }.foregroundColor(.green)<br/>    }<br/>    <br/>    func dynamicIslandExpandedCenterView(context: ActivityViewContext&lt;GroceryDeliveryAppAttributes&gt;) -&gt; some View {<br/>        Text("\(context.state.courierName) is on the way!")<br/>            .lineLimit(1)<br/>            .font(.caption)<br/>    }<br/>    <br/>    <br/>    //MARK: Compact Views<br/>    func compactLeadingView(context: ActivityViewContext&lt;GroceryDeliveryAppAttributes&gt;) -&gt; some View {<br/>        VStack {<br/>            Label {<br/>                Text("\(context.attributes.numberOfGroceyItems) items")<br/>            } icon: {<br/>                Image("grocery")<br/>                    .foregroundColor(.green)<br/>            }<br/>            .font(.caption2)<br/>        }<br/>    }<br/>    <br/>    func compactTrailingView(context: ActivityViewContext&lt;GroceryDeliveryAppAttributes&gt;) -&gt; some View {<br/>        Text(context.state.deliveryTime, style: .timer)<br/>            .multilineTextAlignment(.center)<br/>            .frame(width: 40)<br/>            .font(.caption2)<br/>    }<br/>    <br/>    func minimalView(context: ActivityViewContext&lt;GroceryDeliveryAppAttributes&gt;) -&gt; some View {<br/>        VStack(alignment: .center) {<br/>            Image(systemName: "timer")<br/>            Text(context.state.deliveryTime, style: .timer)<br/>                .multilineTextAlignment(.center)<br/>                .monospacedDigit()<br/>                .font(.caption2)<br/>        }<br/>    }<br/>}<br/><br/><br/><br/><br/><br/>@available(iOSApplicationExtension 16.1, *)<br/>struct LockScreenView: View {<br/>    var context: ActivityViewContext&lt;GroceryDeliveryAppAttributes&gt;<br/>    var body: some View {<br/>        VStack(alignment: .leading) {<br/>            HStack {<br/>                VStack(alignment: .center) {<br/>                    Text(context.state.courierName + " is on the way!").font(.headline)<br/>                    Text("You ordered \(context.attributes.numberOfGroceyItems) grocery items.")<br/>                        .font(.subheadline)<br/>                    BottomLineView(time: context.state.deliveryTime)<br/>                }<br/>            }<br/>        }.padding(15)<br/>    }<br/>}<br/><br/>struct BottomLineView: View {<br/>    var time: Date<br/>    var body: some View {<br/>        HStack {<br/>            Divider().frame(width: 50,<br/>                            height: 10)<br/>            .overlay(.gray).cornerRadius(5)<br/>            Image("delivery")<br/>            VStack {<br/>                RoundedRectangle(cornerRadius: 5)<br/>                    .stroke(style: StrokeStyle(lineWidth: 1,<br/>                                               dash: [4]))<br/>                    .frame(height: 10)<br/>                    .overlay(Text(time, style: .timer).font(.system(size: 8)).multilineTextAlignment(.center))<br/>            }<br/>            Image("home-address")<br/>        }<br/>    }<br/>}</span></pre><p id="7d99" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">参考:<a class="ae lv" href="https://developer.apple.com/documentation/activitykit/displaying-live-data-on-the-lock-screen-with-live-activities" rel="noopener ugc nofollow" target="_blank">苹果文档</a></p><p id="c578" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">请注意，如果实时活动的高度超过160点，系统可能会将其截断。</p><p id="fed4" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">以下是Github<a class="ae lv" href="https://github.com/batikansosun/iOSLiveActivitiesLockScreen" rel="noopener ugc nofollow" target="_blank">上的完整代码链接。</a></p><p id="2e06" class="pw-post-body-paragraph kz la iq lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">感谢阅读。</p><pre class="kg kh ki kj gt kn ko kp kq aw kr bi"><span id="9acd" class="ks kt iq ko b gy ku kv l kw kx"><strong class="ko ir">Want to Connect?</strong></span><span id="95d3" class="ks kt iq ko b gy ky kv l kw kx">Let’s connect on Twitter <a class="ae lv" href="http://twitter.com/batikansosun" rel="noopener ugc nofollow" target="_blank">@batikansosun</a>.</span></pre></div></div>    
</body>
</html>