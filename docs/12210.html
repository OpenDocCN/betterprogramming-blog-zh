<html>
<head>
<title>Modest Architectures</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">朴素的建筑</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/designing-and-building-modest-architectures-2a0a9978234b?source=collection_archive---------5-----------------------#2022-05-19">https://betterprogramming.pub/designing-and-building-modest-architectures-2a0a9978234b?source=collection_archive---------5-----------------------#2022-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="529c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">可靠结果的有趣方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/03bb342f15403231e9dbadfe0b87b363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9J6wnL8tU9Ma31_rZU-7g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">克里斯托夫·马克西米利安在<a class="ae kv" href="https://unsplash.com/s/photos/modest-clothes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="174f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一篇关于我应用于我构建的一切的原则的短文——无论是类接口、web API、<a class="ae kv" href="https://en.wikipedia.org/wiki/Infrastructure_as_code" rel="noopener ugc nofollow" target="_blank">作为代码</a> (IaC)模板的基础设施，还是架构设计。</p><p id="07d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我没想到会这样。我在考虑构建好的IaC模板的原则，但是我很快意识到这些是我经常使用的一般原则。我整理了一个列表，取第一个字母，用<a class="ae kv" href="https://wordfinder.yourdictionary.com/" rel="noopener ugc nofollow" target="_blank"> WordFinder </a>得到一个单词。我被这个词有多好逗乐了:</p><blockquote class="ls lt lu"><p id="9168" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">谦虚——不想谈论你的能力或成就，不想说你擅长某事，即使你擅长——用来表示赞同。<strong class="ky ir"><br/><br/></strong><em class="iq">——</em><a class="ae kv" href="https://www.ldoceonline.com/dictionary/modest" rel="noopener ugc nofollow" target="_blank"><em class="iq">朗文当代英语词典</em> </a></p></blockquote><p id="d42c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些原则是:</p><ul class=""><li id="827f" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">有意义的默认值</li><li id="42c3" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">正交性</li><li id="8d76" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">证明文件</li><li id="18b3" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">展开性</li><li id="cb10" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">安全性</li><li id="add1" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">易测性</li></ul><p id="54cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们在这里，又一个助记首字母缩略词。总有地方容纳新的。</p><h1 id="dbc5" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">原则</h1><p id="f677" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我们先来讲讲原理。为了让您开心，我将提供IaC领域的例子来说明它们是非常通用的。</p><h2 id="10c1" class="nk mo iq bd mp nl nm dn mt nn no dp mx lf np nq mz lj nr ns nb ln nt nu nd nv bi translated">有意义的默认值</h2><blockquote class="ls lt lu"><p id="d758" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">简单的事情应该简单，复杂的事情应该可能。<br/>T22【艾伦凯】T23】</p></blockquote><p id="c3be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有意义的默认帮助你最小化使用你的人工制品所需的摩擦。与API设计一样，考虑Python中的<a class="ae kv" href="https://www.w3schools.com/python/ref_list_sort.asp" rel="noopener ugc nofollow" target="_blank">排序</a>方法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c1d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，默认情况下，<code class="fe ny nz oa ob b">sort</code>按升序返回项目。您可以通过提供非默认参数来请求降序，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="30f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">类似地，在IaC世界中——想象你有一个包含几十个参数的大型云结构堆栈。为了论证起见，<a class="ae kv" href="https://kolomiets.github.io/quickstart-jaeger/#_parameter_reference" rel="noopener ugc nofollow" target="_blank">杰格快速启动有50多辆</a>。尽管如此，所有参数都有默认值，如果您想尝试快速入门，您不必更改它们。这种无摩擦的体验建立了信心，并刺激了进一步的实验。</p><h2 id="42e6" class="nk mo iq bd mp nl nm dn mt nn no dp mx lf np nq mz lj nr ns nb ln nt nu nd nv bi translated">正交性</h2><p id="36c9" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">正交性是软件设计中的一个重要原则。正如<a class="ae kv" href="https://en.wikipedia.org/wiki/Orthogonality_(programming)" rel="noopener ugc nofollow" target="_blank">维基百科所定义的</a>，正交运算只改变一件事而不影响其他事。一个传统的例子是<a class="ae kv" href="https://en.wikipedia.org/wiki/Pure_function" rel="noopener ugc nofollow" target="_blank">纯函数</a>——纯函数没有副作用，因此，更容易组合多个函数并对它们进行推理。</p><p id="077f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">IaC示例可能更难理解。假设我们有一个提供以下选项的大型基础架构部署:</p><ul class=""><li id="fdbe" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">DNS:已禁用/私有托管区域/公共托管区域</li><li id="9dc8" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">存储后端:内存存储/弹性搜索</li><li id="ef22" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">导出度量:禁用/启用</li></ul><p id="2892" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些是正交选项，您可以根据需要混合和搭配它们，并且您将始终获得有效的组合:</p><ul class=""><li id="72af" class="lz ma iq ky b kz la lc ld lf mb lj mc ln md lr me mf mg mh bi translated">无DNS配置+内存存储+禁用指标</li><li id="124d" class="lz ma iq ky b kz mi lc mj lf mk lj ml ln mm lr me mf mg mh bi translated">公共DNS +弹性搜索+启用指标</li></ul><p id="d97f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑正交性进行IaC设计通常会产生更易于测试和支持的解决方案，因为所有特性都是独立的。</p><h2 id="428e" class="nk mo iq bd mp nl nm dn mt nn no dp mx lf np nq mz lj nr ns nb ln nt nu nd nv bi translated">证明文件</h2><p id="00ba" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">文档是软件工程中最被忽视的领域之一。好的文档是非常困难的，而且(几乎)没有人喜欢写它。还不清楚哪个更具挑战性——创建复杂的代码还是为其编写有意义的文档。</p><p id="e02e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要说明的是，我所说的文档并不是指这样的注释:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="9c31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">琐碎的事情不需要解释。它更多地是关于一些更复杂的片段，如果不了解一些背景信息，你很难理解:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="dcdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像其他事情一样，知道需要记录什么来自实践。你需要写(和读！)很多文档才知道好是什么样子的。如果有疑问，向一个假想的朋友(或一只<a class="ae kv" href="https://en.wikipedia.org/wiki/Rubber_duck_debugging" rel="noopener ugc nofollow" target="_blank">鸭子</a>)解释你的代码，并想想那些可能让他们惊讶的事情(虽然不确定鸭子是否有眉毛)。</p><p id="bf01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在IaC领域，文档也扮演着核心角色。有多少次你看到模板带有未记录的参数，所以你不得不猜测你可以使用的正确值？你猜错了多少次？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/c7dedae7ce447a310ae2eb519d3b8ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9GEbmVLHvbX2dG3xP09Ig.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">没有参数文档的云形成模板</p></figure><p id="397e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将参数进行逻辑分组，并提供有意义的描述和链接到客户可以获得更多信息的网页，这样会更好吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/e5fe4f17ca8c9015660d32c5f8d627cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klMoBQgiYQh1H1b1NQgI-w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个更加完美的版本，参数被分组并记录在案</p></figure><p id="27a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还记得你最后一次抱怨缓慢的移动应用程序，不直观的用户界面，或者蹩脚的错误信息吗？这就是你的队友在使用IaC模板时的感受。</p><p id="13ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">做得更好；他们活该！</p><h2 id="9519" class="nk mo iq bd mp nl nm dn mt nn no dp mx lf np nq mz lj nr ns nb ln nt nu nd nv bi translated">展开性</h2><p id="482f" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">无论是设计一个将被你的队友使用的类，还是构建一个大规模的微服务架构，可扩展性都是你可能需要考虑的事情。很可能，你还没有预想到所有可能的使用场景，所以创建一个开放的解决方案会让你长期受益。</p><blockquote class="ls lt lu"><p id="9960" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">这里的Open是为了O in<a class="ae kv" href="https://en.wikipedia.org/wiki/SOLID" rel="noopener ugc nofollow" target="_blank">SOLID</a>——另一个流行的记忆术，你可能想在下次面试时记住。如果你也和你的面试官谈论谦虚的原则，(对双方来说)会很有趣。</p></blockquote><p id="a658" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">来自IaC领域的一个例子:假设您为一个产品构建基础设施，并部署其他团队将使用的资源——VPC、安全组、IAM角色等。后来，另一个团队想要在VPC部署微服务。他们可能需要一个VPC ID、一个子网列表，可能还需要一个安全组来附加到他们的服务。团队检索这些信息的流程是什么？</p><p id="5dd3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">他们可以打开AWS控制台，获取标识符/arn，并将它们硬编码到服务配置文件中。如果您有多个环境(开发/测试/生产)——让他们为每个环境重复这个过程(并运行)。</p><p id="4ed7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们当然可以做得更好。如果作为IaC实现的一部分，我们提供一组带有所有必要标识符的SSM参数会怎么样呢？然后，服务团队可以使用定义良好的参数名导入他们需要的位。将这些参数视为您的IaC“公共接口”——一旦发布，您必须维护它们并确保向后兼容性。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/c3fcfb4cff14adb91226afcb43e9543b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cp_hC40g2QoGCwJkxKhOIw.png"/></div></div></figure><h2 id="4192" class="nk mo iq bd mp nl nm dn mt nn no dp mx lf np nq mz lj nr ns nb ln nt nu nd nv bi translated">安全性</h2><p id="1b19" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">安全是一个包罗万象的原则。如果不知道从哪里入手，就从安全入手。</p><p id="7998" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不过说真的，不管你在构建什么，你都需要考虑安全性。从静态代码分析、容器运行时安全工具、网络扫描器、日志分析、异常检测和IaC安全工具——范围非常广泛。<a class="ae kv" href="https://www.thoughtworks.com/radar" rel="noopener ugc nofollow" target="_blank"> Thoughtworks技术雷达</a>是一个很好的起点。</p><h2 id="983f" class="nk mo iq bd mp nl nm dn mt nn no dp mx lf np nq mz lj nr ns nb ln nt nu nd nv bi translated">易测性</h2><p id="05ca" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我认为这些年来我们已经取得了很大的进步——即使是传说中的<a class="ae kv" href="https://stackoverflow.com/questions/67299/is-unit-testing-worth-the-effort" rel="noopener ugc nofollow" target="_blank">单元测试也值得努力吗</a> StackOverflow问题已经停止征求意见了。</p><p id="036a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了最后一个适度的原则，让我们假设如下:测试是好的，自动化测试更好。</p><p id="8faf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可测试性设计意味着您的产品可以在开发过程中或者由您的客户在集成过程中进行有效的测试。考虑客户可能希望针对您开发的类/API/IaC/架构进行的负载/集成测试。</p><p id="62a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">继续我们的IaC示例，您可以做很多事情来使您的IaC代码可测试。从IaC提供者的单元测试开始，考虑参数和目标区域的不同组合的实际部署测试。如果您需要支持非标准地区，如中国或GovCloud，这一点尤为重要。下面是一个<a class="ae kv" href="https://github.com/aws-ia/taskcat" rel="noopener ugc nofollow" target="_blank"> TaskCat </a>测试文件的例子(来自<a class="ae kv" href="https://github.com/kolomiets/quickstart-jaeger" rel="noopener ugc nofollow" target="_blank"> quickstart-jaeger库</a>):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="4a1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无论你在做什么，都有一个测试的方法。</p><h1 id="8e49" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">结论</h1><p id="908c" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">谦虚并不总是一个好的生活策略，但是设计和建造谦虚的建筑是你应该考虑的事情。为这种恶作剧的胡言乱语道歉。我很快会带着对分布式跟踪和OpenTelemetry更严肃的想法回来。</p></div></div>    
</body>
</html>