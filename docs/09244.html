<html>
<head>
<title>Create a Slack Bot for Bitcoin Price Updates Using GCP Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GCP云功能创建一个用于比特币价格更新的Slack Bot</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-slack-bot-for-bitcoin-price-updates-using-gcp-cloud-functions-a672fc34287c?source=collection_archive---------6-----------------------#2021-08-02">https://betterprogramming.pub/create-a-slack-bot-for-bitcoin-price-updates-using-gcp-cloud-functions-a672fc34287c?source=collection_archive---------6-----------------------#2021-08-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b31d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在不到15分钟的时间内构建您自己的机器人</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/453f87ffc2929c6681fdd50cf09faaf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z2mfx2BLgY0DE8_7"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="55ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个Slack bot，它将使用云函数告诉您当前的加密值，这是一种在云上部署您的函数和运行代码的无服务器方式。</p><h1 id="5528" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">A.在新的松弛工作区中创建机器人</h1><h2 id="f71e" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤1:创建或登录时差</h2><p id="c765" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated"><a class="ae ky" href="https://slack.com/signin#/signin" rel="noopener ugc nofollow" target="_blank">创建/登录到不同的slack工作区</a>，在这里我们将创建我们的bot并为它选择一个工作区名称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/11f691833e13610b33d1a284daf63134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsSkAC5U68jZUcngZJ3FqA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您现在已登录到新的工作区！</p></figure><h2 id="acfe" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">第二步:创建一个Slack应用程序</h2><p id="5dc9" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">让我们来看看松弛的API<a class="ae ky" href="https://api.slack.com/apps?new_app=1" rel="noopener ugc nofollow" target="_blank">https://api.slack.com/apps</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/442ad5198be30ce62b162e466dcb9c55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a1JMFN4PeCpdBHwIUKQpLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="c4f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<em class="ng">创建新应用，</em>选择<em class="ng">从头创建</em>并给它命名。</p><h2 id="f5e5" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤3:添加Bot权限</h2><p id="fde5" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">转到OAuth &amp; Permissions选项卡，向下滚动到Scopes。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/48920c2eca5c924d4b5933324644083d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1t2Q5jy_E44uxCNkc8wHLQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="4e41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在添加你的机器人需要访问的所有权限。仔细阅读你提供给机器人访问的所有作用域的描述。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a334c76cd9579f4710eda30efa89d29d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4qsZ6VBhPVB8-gKuKbwOA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><h2 id="d7db" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤4:启用事件订阅</h2><p id="6c1d" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">在左侧，转到事件订阅并启用事件。</p><p id="2ecd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，从Subscribe to Bot Events中选择我们想要订阅的所有事件。事件订阅将确保slack在事件发生时向提供的链接发送事件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/675090a9e88576ddcfad5f0472d21838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUG9Zv14UANgY9jpAxZPYg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="80c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在停在这里。我们现在需要保持链接为空。</p><p id="9d39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Slack通过发送带有挑战参数的请求来授权我们提供的链接，应用程序必须用挑战参数来响应。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="d314" class="lv lw it bd lx ly nr ma mb mc ns me mf jz nt ka mh kc nu kd mj kf nv kg ml mm bi translated">B.利用GCP云功能</h1><p id="6580" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">如果您已经习惯使用gcloud CLI，您可以在本地IDE中编写代码，并从<code class="fe nw nx ny nz b">gcloud functions deploy</code>命令部署它。</p><p id="23df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以转到云控制台，创建一个内嵌的模板化云函数。无论哪种方式，代码的结构都是一样的。现在让我们使用内联模板化的方法。</p><h2 id="b989" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">第一步:登录或注册GCP</h2><p id="6c1f" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated"><a class="ae ky" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">使用信用卡或借记卡登录或注册</a>Google cloud console进行免费试用。创建一个项目，并为该项目启用开单。转到云功能并启用API，同时启用云构建和部署。</p><h2 id="90e0" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤2:创建一个云函数</h2><p id="9ef8" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">现在，只需点击谷歌云功能控制台上的创建云功能。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/662702edfee0d0fe74c7120fcff2a9a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cck4U_uGYOF6Ztgj2Dr37g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="ee60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在trigger中，选择allow un authenticated invocations并点击save和next。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/a740b1f4a5edad5eb3f597e73168c735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kvEOBGb-MbVgaAajdF7zkA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><h2 id="9cc4" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤3:从行内编辑器中修改源代码</h2><p id="cfb0" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">选择你觉得合适的运行时，我们将暂时使用Go 1.13运行时。</p><p id="bd5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为Slack将使用一个带有挑战参数的请求来调用触发器URL，所以我们将首先获取请求，将请求体解码成一个map，并写回挑战参数。</p><p id="0d04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在内联代码模板中，用下面的实现替换现有的HelloWorld实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="906c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在只需部署该功能。转到函数名，函数的触发器URL是您需要添加到slack的事件和订阅中的请求URL。</p><p id="019b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">*Edit:在部署之前，一定要从代码中删除“io”和“html”导入，否则Go可能会抛出未使用的导入错误。</p><p id="cd9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果应用程序能够成功地使用质询参数进行响应，请求URL应该会获得批准。这基本上意味着slack向您的URL发送了一些请求，您需要用challenge参数进行响应，而您做到了！</p><p id="ef45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保您需要订阅的bot事件都被选中。如果没有，则添加并保存它们。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/ddcaeb312782547d4b8f99644080ee77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qjggfqhKUUOUS5RbeNu6VQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="dca5" class="lv lw it bd lx ly nr ma mb mc ns me mf jz nt ka mh kc nu kd mj kf nv kg ml mm bi translated">C.将Slack bot安装到工作区，并将bot添加到Slack通道</h1><p id="b947" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">在Slack API中，转到应用程序的基本信息，并将应用程序安装到新创建的工作区。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/e4edc220afd4b4f2f4abbfb5b6a9cf9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zDFHnfkdzH6WywwxNseNRw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="3a0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将应用程序安装到工作空间时，您应该能够在OAuth &amp; Permissions中看到一个令牌。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/48920c2eca5c924d4b5933324644083d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1t2Q5jy_E44uxCNkc8wHLQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure><p id="3431" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在slack上，转到您希望slack机器人能够访问的通道，并邀请机器人进入该通道。参考下图添加机器人到一个频道。或者，你可以在频道上输入/邀请，它会给你以下选项。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/085d7d2018fee04931a5f3ee4c60c9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NGYJ4KxJVnVuXzQddcUB9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</p></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="c8eb" class="lv lw it bd lx ly nr ma mb mc ns me mf jz nt ka mh kc nu kd mj kf nv kg ml mm bi translated">D.向Slack发布消息</h1><p id="e58c" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">现在，应用程序已经添加到一个频道，您可以尝试从终端发出curl请求，以检查机器人是否已添加。</p><h2 id="2c4a" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤1:检查松弛的现有通道</h2><p id="de25" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">使用slack令牌(在OAuth &amp; Permissions选项卡中)<strong class="lb iu"> </strong>向slack发出curl请求，作为slack bot的载体授权。</p><p id="a17c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">*编辑:试试下面的卷发</p><pre class="kj kk kl km gt oh nz oi oj aw ok bi"><span id="8556" class="mn lw it nz b gy ol om l on oo">curl --location --request GET ‘<a class="ae ky" href="https://slack.com/api/conversations.list'" rel="noopener ugc nofollow" target="_blank">https://slack.com/api/conversations.list'</a> \<br/> --header ‘Authorization: Bearer &lt;token&gt;’ \<br/> --data-raw ‘’</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="7eb9" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤2:向Slack发出一个curl请求，发布一条定制消息</h2><p id="e652" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">用slack令牌向slack<a class="ae ky" href="https://slack.com/api/chat.postMessag" rel="noopener ugc nofollow" target="_blank">https://slack.com/api/chat.postMessag</a>e发出curl请求，向slack<a class="ae ky" href="https://api.slack.com/messaging/sending#publishing" rel="noopener ugc nofollow" target="_blank">发布消息</a>。从上面的响应中获取通道名称。</p><p id="20bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">*编辑:试试下面的卷发</p><pre class="kj kk kl km gt oh nz oi oj aw ok bi"><span id="715d" class="mn lw it nz b gy ol om l on oo">curl --location --request POST ‘<a class="ae ky" href="https://slack.com/api/chat.postMessage'" rel="noopener ugc nofollow" target="_blank">https://slack.com/api/chat.postMessage'</a> \<br/> --header ‘Authorization: Bearer &lt;token&gt;’ \<br/> --header ‘Content-Type: application/json’ \<br/> --data-raw ‘{<br/>“channel”: “&lt;channel-name&gt;”,<br/>“text”: “Hello World :tada:”<br/>}’</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="fb05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该能够看到slack bot发布到频道。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/794b544d4365611040a7f43efc1af082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lp4nJwxq7JgAn33gfaElGA.png"/></div></div></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="dc70" class="lv lw it bd lx ly nr ma mb mc ns me mf jz nt ka mh kc nu kd mj kf nv kg ml mm bi translated">E.将消息发布到时差，作为对消息事件的回复</h1><p id="6cb3" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">既然您已经确保了bot令牌工作正常，并且您能够使用curl在频道上发布消息，那么是时候从我们创建的云功能应用程序中发布消息了。</p><h2 id="81c0" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤1:分析事件回调请求</h2><p id="0440" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">在添加了松弛bot的松弛通道上键入任何文本，然后按enter键。让我们检查云函数日志选项卡上的最后请求日志，并分析触发我们函数的slack <a class="ae ky" href="https://api.slack.com/events/message.channels" rel="noopener ugc nofollow" target="_blank">事件</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="352b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们知道类型将是event_callback，在事件内部，我们不应该有bot_id，因为我们将由用户而不是bot来回复消息。ts值本质上是消息的ID，保证在通道或会话的上下文中是唯一的。</p><h2 id="6ef7" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤2:在响应编写器中不添加重试标头</h2><p id="c1f8" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">Slack重试发送到触发器url的事件回调，以防它没有立即获得200响应。为了防止这种情况，我们需要在我们的响应中设置<strong class="lb iu"> X-Slack-No-Retry </strong>报头。</p><h2 id="42c2" class="mn lw it bd lx mo mp dn mb mq mr dp mf li ms mt mh lm mu mv mj lq mw mx ml my bi translated">步骤3:发送对时差消息的答复</h2><p id="c0e6" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">我们需要编辑之前创建的云函数，并稍微调整一下源代码，以符合我们对用户消息事件触发器的条件检查。</p><ol class=""><li id="64e0" class="oq or it lb b lc ld lf lg li os lm ot lq ou lu ov ow ox oy bi translated">要检查事件回调是否来自用户:</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="19d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.现在让我们从发送给我们函数的事件中获取所有需要的值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="6aac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.随后，让我们再次检查在slack上发布消息的curl请求。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="2360" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们前面所讨论的，ts值本质上是消息的ID，保证在通道或会话的上下文中是唯一的。我们将使用ts值来回复与触发我们应用程序的事件相同的消息。</p><p id="a86d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.不要忘记添加标题！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="1a0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们把它们放在一起。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">接收slack发送的回调事件并发送消息作为回复的云函数</p></figure><p id="74fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在通道上发送任何消息后，您应该能够看到slack bot回复。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/829350d9606173ea4ed05e4d6da79063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kwy8hsvijjfn4G2Rk-_rXg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输出</p></figure><p id="ee46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">酷，你创建了一个slack机器人来自动回复你在slack上的对话！有点孤独，但是很酷！</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="d20d" class="lv lw it bd lx ly nr ma mb mc ns me mf jz nt ka mh kc nu kd mj kf nv kg ml mm bi translated">f:集成CoinGecko API</h1><p id="fefe" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">现在，我们需要将我们的云功能与来自CoinGecko或其他加密API的响应集成在一起。CoinGecko是免费且易于使用的，所以我们就用它吧。</p><p id="a5d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看我们将使用的CoinGecko API</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="e872" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们看到这是一个简单的GET调用，我们可以用它来获取比特币的美元值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">coin gecko api调用</p></figure><p id="e779" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过将<code class="fe nw nx ny nz b">respString</code>添加到我们的slack请求正文(<code class="fe nw nx ny nz b">reqBody</code>)来发布<code class="fe nw nx ny nz b">respString</code>，现在发布我们的slack线程。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/b7ffd347b3cf893025d7f815ee2a7792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5mKWD2KAWiFcy8b2CKiG3g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输出</p></figure><p id="3481" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">酷！现在我们有了一个机器人，可以用当前的比特币价值来回复我们在slack上发布的任何消息。</p><p id="4417" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以对其进行定制，使其只响应调用机器人并在其中提到加密货币的消息。</p><p id="9a28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尝试使用CoinGecko API。它支持许多加密货币和转换货币。</p><p id="7393" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以参考这个GitHub <a class="ae ky" href="https://github.com/Sampriti-Mitra/cloud-functions/blob/master/cloud_functions/slack_app.go" rel="noopener ugc nofollow" target="_blank">链接</a>来获得完整的代码。</p><p id="2897" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。下次见！</p></div></div>    
</body>
</html>