<html>
<head>
<title>How to Use Proxies in Geotargeting Web Scraping With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python在地理定位Web抓取中使用代理</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-proxies-in-geotargeting-web-scraping-ae9effa8b28f?source=collection_archive---------10-----------------------#2022-05-04">https://betterprogramming.pub/how-to-use-proxies-in-geotargeting-web-scraping-ae9effa8b28f?source=collection_archive---------10-----------------------#2022-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8114" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过代理为您的应用获取准确的数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bd0af9562b416e5c1e71dac89ebb54b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KYxgxVALWBFv4w_i.jpg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由Pixabay的<a class="ae ky" href="https://pixabay.com/illustrations/cloud-data-internet-connection-4828224/" rel="noopener ugc nofollow" target="_blank"> kreatikar </a>拍摄</p></figure><p id="23ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代理是介于你和目标网站之间的东西。当你用代理抓取网站时，用来抓取目标网站的是代理的IP，而不是你的。</p><p id="e8c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的应用程序严重依赖于web抓取，出于各种原因，您可能会希望使用代理。其中之一是地理定位，这意味着我们希望从特定的地区或国家抓取目标网站，而不是从我们的本地IP。这对于在线零售商来说尤其重要，因为他们通常会在不同的地区展示不同的内容。</p><p id="42ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将通过<code class="fe lv lw lx ly b">requests</code>和<code class="fe lv lw lx ly b">Scrapy</code>库介绍在Python中使用web抓取代理的不同方式。测试的免费代理和生产的专用代理都将被引入。</p><p id="c5da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">免费代理适合测试，通常只用于测试。这是因为免费代理通常由许多用户共享。因此，性能远远低于专用的，你可以很容易被禁止。此外，如果使用了不良代理，还会有安全问题。</p><p id="1879" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，专用代理都是商业性的，根据计划的不同，可能会相当昂贵。然而，它们更加安全和稳定，通常应该用于生产。尽管如此，不要担心，这篇文章中介绍的都有免费试用计划，你不必为学习目的支付任何费用。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="6759" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">准备</h1><p id="7d18" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">首先，我们需要安装网页抓取的软件包。我们将为本文安装<code class="fe lv lw lx ly b">requests</code>和<code class="fe lv lw lx ly b">Scapy</code>库。建议<a class="ae ky" href="https://medium.com/codex/how-to-create-virtual-environments-with-venv-and-conda-in-python-31814c0a8ec2" rel="noopener">创建一个虚拟环境</a>并在那里安装软件包，这样它们就不会搞乱系统库。</p><p id="b50e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了简单起见，我们将使用<code class="fe lv lw lx ly b"><a class="ae ky" href="https://medium.com/codex/how-to-create-virtual-environments-with-venv-and-conda-in-python-31814c0a8ec2" rel="noopener">conda</a></code>来创建虚拟环境。此外，我们将安装<a class="ae ky" href="https://ipython.org/" rel="noopener ugc nofollow" target="_blank"> iPython </a>，以便更方便地交互式运行Python代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="76f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以开始用Python写一些测试代码了。为了测试请求库，我们可以直接在iPython上运行代码。不过，对于Scrapy web scraping框架来说，最好还是在某个IDE里写代码，比如<a class="ae ky" href="https://levelup.gitconnected.com/some-tips-to-make-your-vs-code-more-efficient-db77ec7071f8" rel="noopener ugc nofollow" target="_blank"> VS Code </a>。</p><p id="fae5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先尝试在不使用代理的情况下进行基本的抓取。我们将刮<a class="ae ky" href="https://httpbin.org/ip" rel="noopener ugc nofollow" target="_blank">https://httpbin.org/ip</a>并且得到我们的IP。在iPython中运行以下代码，或者直接将其作为脚本运行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="46ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用Scrapy框架进行抓取，我们需要首先创建一个抓取项目和一个蜘蛛:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="49ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Scrapy框架，代码也非常简单。在蜘蛛文件<code class="fe lv lw lx ly b">proxy_tutorial/spiders/ipinfo.py</code>中添加以下代码。请注意，应该按照指定更新<code class="fe lv lw lx ly b">start_urls</code>以获取IP地址。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0d5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在运行蜘蛛来获取您的IP地址:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="76dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，<code class="fe lv lw lx ly b">-L</code>选项用于静音抓取过程的日志记录。使用请求模块可以获得相同的结果。现在让我们使用一个代理，看看会发生什么神奇的事情。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="f5f0" class="nf mh it bd mi ng nh dn mm ni nj dp mq li nk nl ms lm nm nn mu lq no np mw nq bi translated">共享/免费代理</h2><p id="5cf8" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">网上有一些免费的共享代理服务。一个值得推荐的是Webshare，它是一个著名的代理提供商，因此使用起来很安全。它有一个免费的计划，包括在不同国家的10个代理，是完美的测试目的。此外，如果你想要更好的代理服务，你可以将你的计划升级为付费的私人计划或专用计划。</p><p id="9242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您登录Webshare时，您会看到您的免费代理列表如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/12d6cc67f52d19d0188db72fb3796b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*5ieV7kl87xovkXU2zGxuHQ.png"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="b1e8" class="nf mh it bd mi ng nh dn mm ni nj dp mq li nk nl ms lm nm nn mu lq no np mw nq bi translated">对请求库使用共享代理</h2><p id="1f41" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在让我们在web抓取中使用共享代理。如上图所示，将<em class="ns">用户名</em>、<em class="ns">密码</em>、<em class="ns">代理地址、</em>和<em class="ns">端口</em>替换为您自己的，然后您将看到代理的IP，而不是如上图所示的您的IP:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="f5b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，在代理中，我们需要一个分别用于HTTP和HTTPS请求的代理。但是，它们的值是一样的，都是以<code class="fe lv lw lx ly b">http</code>开头。它是带有认证信息的代理的URL。这个语法是requests库所需要的，但是Scrapy框架不需要，我们很快就会看到。</p><p id="42d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在<a class="ae ky" href="https://ipinfo.io" rel="noopener ugc nofollow" target="_blank"> https://ipinfo.io </a>或其他类似的在线IP服务上查看您的代理IP的地理位置。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="5969" class="nf mh it bd mi ng nh dn mm ni nj dp mq li nk nl ms lm nm nn mu lq no np mw nq bi translated">为Scrapy框架使用共享代理</h2><p id="6738" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">使用Scrapy框架，我们可以用两种方式添加代理。首先，我们可以用<code class="fe lv lw lx ly b">meta</code>请求参数来添加它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="29b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，我们可以在定制的中间件中添加代理。在我们简单的Scrapy项目文件夹中，有一个名为<code class="fe lv lw lx ly b">middlewares.py</code>的文件，其中有许多样板代码。将它们全部删除，并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c2e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要让中间件中指定的代理真正工作，注释掉或删除上面添加的<code class="fe lv lw lx ly b">start_requests</code>函数。然后将下面的代码添加到<code class="fe lv lw lx ly b">settings.py</code>中。为了简单起见，您也可以删除<code class="fe lv lw lx ly b">settings.py</code>中的样板代码，只保留这里显示的内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0369" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意代理中间件的顺序很重要，自定义中间件应该放在内置的<code class="fe lv lw lx ly b">HttpProxyMiddleware</code>之前，否则它不能正常工作。</p><p id="6101" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们再次运行蜘蛛时，我们看到它也显示了代理的IP地址:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="deeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用如上所示的免费或共享代理，我们将总是从代理的相同IP抓取网站，因此也很容易被阻止。要解决这个问题，你应该有大量的代理，并定期更新/轮换。</p><p id="e9e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一项要求很高且耗时的工作。第一次可能很有趣，但如果你每天都要做，那就一点也不有趣了。因此，对于生产使用，我们通常应该寻找具有良好支持的商业解决方案，这样我们就不需要担心代理更新和轮换。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="6140" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">专用/智能代理服务</h1><p id="e442" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在让我们检查一些专用的代理服务。有相当多的代理提供商提供专门的代理，也为你自动和智能地管理IP轮换。举几个例子，有<a class="ae ky" href="https://www.zyte.com/" rel="noopener ugc nofollow" target="_blank"> Zyte </a>、<a class="ae ky" href="https://www.scraperapi.com/" rel="noopener ugc nofollow" target="_blank">scrape pi</a>、<a class="ae ky" href="https://lynn-kwong.medium.com/how-to-scrape-javascript-webpages-using-proxycrawl-in-python-a4de7182d996" rel="noopener"> ProxyCrawl </a>等。这三个提供商都有免费试用计划，你可以玩几天来学习。要获得详尽的列表，你可以在网上查看<a class="ae ky" href="https://www.webscrapingapi.com/best-proxies-web-scraping/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>或其他类似文章。代理提供商的排名非常主观，你应该仔细检查和比较，选择最适合你的需求和预算的。</p><p id="e28a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在本帖中介绍Zyte和ScraperAPI，因为它们价格相对低廉，文档也非常好。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="bbcd" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">Zyte智能代理管理器</h1><p id="285c" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">Zyte是由上面介绍的流行的抓取框架Scrapy的同一组开发人员开发的。因此，Zyte和Scrapy的集成是原生的，做起来非常简单。如果你在项目中使用Scrapy，Zyte可以成为第一个考虑的代理提供商。</p><p id="2d3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，Zyte是一个独立的代理服务，可以独立于Scrapy工作。因此，我们也可以将Zyte与请求库一起使用。用法与上面的共享代理非常相似:</p><p id="0ef9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用Zyte智能代理管理器，您需要在Zyte<a class="ae ky" href="https://www.zyte.com/smart-proxy-manager/" rel="noopener ugc nofollow" target="_blank">创建一个帐户，并添加您的信用卡以获得14天的试用期。在试用期结束或您过度使用配额之前，不会向您收费。因此，请密切关注您的使用情况，并记住在您完成测试后取消订阅。</a></p><p id="6ffb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成注册后，您将进入“智能代理管理器入门”页面，在这里您可以设置一些“配置设置”。要稍后打开此页面，您可以单击左侧导航栏中“智能代理管理器”下的“API访问”选项卡。</p><p id="ed7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于地理定位抓取，您需要为每个地区创建一个帐户。在这里的演示中，将创建两个帐户，一个用于美国，另一个用于英国。将为每个帐户自动生成一个API密钥。现在让我们分别在requests和Scrapy框架中使用API键。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/3064317b22952c62b2284d3c950393c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jr4jIQ7IUIVkU48s62Coig.png"/></div></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="5445" class="nf mh it bd mi ng nh dn mm ni nj dp mq li nk nl ms lm nm nn mu lq no np mw nq bi translated">对请求库使用Zyte代理</h2><p id="d036" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">对于请求库，我们需要下载抓取HTTPS网页的证书。下载名为<code class="fe lv lw lx ly b">zyte-proxy-ca.crt</code>的证书并保存在您的电脑上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/67d3af80f288faf6f42385fe182a6586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VBtpNPVCYAAJckOy5_fD4g.png"/></div></div></figure><p id="ddb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们再刮一下<a class="ae ky" href="https://httpbin.org/ip" rel="noopener ugc nofollow" target="_blank">https://httpbin.org/ip</a>看看代理的IP:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0a52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应该注意的是，当我们用请求库发出HTTPS请求时，我们需要指定参数<code class="fe lv lw lx ly b">verify</code>。该值是您刚刚下载的证书文件<code class="fe lv lw lx ly b">zyte-proxy-ca.crt</code>的路径。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="b09a" class="nf mh it bd mi ng nh dn mm ni nj dp mq li nk nl ms lm nm nn mu lq no np mw nq bi translated">为Scrapy框架使用Zyte代理</h2><p id="e04d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">由于Scrapy和Zyte都是由同一家公司开发的，所以在Scrapy框架内使用Zyte非常简单。但是，首先，您需要在您的虚拟环境中安装Zyte智能代理管理器中间件:</p><pre class="kj kk kl km gt nv ly nw nx aw ny bi"><span id="a955" class="nf mh it ly b gy nz oa l ob oc">$ <strong class="ly iu">pip install scrapy-zyte-smartproxy</strong></span></pre><p id="37ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后您需要将Zyte智能代理管理器中间件添加到您的<code class="fe lv lw lx ly b">settings.py</code>文件中的<code class="fe lv lw lx ly b">DOWNLOADER_MIDDLEWARES</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="95fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，您需要删除上面添加的定制代理中间件。订单值610由Zyte 的<a class="ae ky" href="https://scrapy-zyte-smartproxy.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">官方文档提供。</a></p><p id="beb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，您可以在<code class="fe lv lw lx ly b">setttings.py</code>中全局启用Zyte智能代理，或者只为特定的蜘蛛启用它。</p><p id="cf8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">settings.py</code>中启用Zyte:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="3025" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为特定的蜘蛛启用Zyte:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="476e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两种方法都可以，你可以选择一个适合你的需要。当我们现在运行蜘蛛时，我们也可以看到代理的IP。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a6aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，当你多次运行蜘蛛时，每次都会得到一个不同的IP，由Zyte智能旋转。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="375d" class="nf mh it bd mi ng nh dn mm ni nj dp mq li nk nl ms lm nm nn mu lq no np mw nq bi translated">谢尔普拉皮</h2><p id="004b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我想介绍的第二个专用代理提供者是ScraperAPI。它可能是Zyte的潜在替代品，因为对于业余爱好来说，它在<a class="ae ky" href="https://www.scraperapi.com/pricing/" rel="noopener ugc nofollow" target="_blank">相对便宜</a>，在<a class="ae ky" href="https://www.scraperapi.com/documentation/" rel="noopener ugc nofollow" target="_blank">有非常好的文档</a>。此外，用单个参数抓取JavaScript网页也很方便。缺点是拥有地理定位功能并不便宜。尽管如此，如果您的抓取项目没有地理定位的要求，这可能是一个可行的选择。一旦您学会了如何使用本文中介绍的免费和专用代理，您就可以非常容易地开始使用任何代理提供商。</p><p id="0148" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要测试ScraperAPI，可以在ScraperAPI的<a class="ae ky" href="https://www.scraperapi.com/" rel="noopener ugc nofollow" target="_blank">主页</a>点击“免费试用”。在那里，您可以获得5000个免费API积分。与Zyte不同，免费试用不需要信用卡。</p><p id="b6fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注册并登录后，您将进入ScraperAPI仪表板，在这里您可以看到API密钥和一些示例代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/98c86cfc3e5cfe57f07a9b8a0fa588c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YS33InaAueBvOeJDwcK9Ew.png"/></div></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="0602" class="nf mh it bd mi ng nh dn mm ni nj dp mq li nk nl ms lm nm nn mu lq no np mw nq bi translated">对请求库使用ScraperAPI代理</h2><p id="878c" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">使用ScraperAPI有多种方式，我们将坚持使用代理模式，因为它是通用的，因此对于不同的代理提供者来说是相似的。在ScraperAPI中使用请求库的代码与上面显示的Zyte智能代理非常相似，只是有一些特定于提供者的设置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="b36a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此处的主题演讲:</p><ul class=""><li id="2632" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated">要启用地理定位特性，我们需要在代理中指定<code class="fe lv lw lx ly b">country_code</code>。要检查其他自定义参数，请查看<a class="ae ky" href="https://www.scraperapi.com/documentation/" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</li><li id="8b0b" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated">当使用ScraperAPI时，我们必须为请求库指定<code class="fe lv lw lx ly b">verify=False</code>。对于您的情况，这可能是也可能不是一个问题，这取决于您正在搜索的网站。</li></ul></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="c155" class="nf mh it bd mi ng nh dn mm ni nj dp mq li nk nl ms lm nm nn mu lq no np mw nq bi translated">将Scrapy代理用于Scrapy框架</h2><p id="df39" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">要将Scrapy与Scrapy一起使用，我们不能像启用Zyte智能代理一样启用它，而是需要像启用Webshare的免费代理一样启用它。这是因为Zyte是Scrapy原生的，其他代理提供商都是Scrapy的第三方。</p><p id="50da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在<code class="fe lv lw lx ly b">start_requests</code>方法中添加代理，或者通过如上所示的定制代理中间件。为简单起见，我们将在这里向<code class="fe lv lw lx ly b">start_requests</code>方法添加代理:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="3987" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，类似于Webshare免费代理，我们只需要为Scrapy添加一个HTTP代理。当我们现在运行这个蜘蛛时，我们可以获得代理的IP:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="1dd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将国家代码指定为法国，只是为了确保代理按预期工作。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="5cd8" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="243c" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在本文中，我们介绍了在web抓取中使用代理的不同方式。你可以使用免费的代理来学习和测试。但是，当它用于生产时，您需要考虑使用一个能够提供智能IP轮换并为您节省大量维护时间的专用服务器。</p><p id="16c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">市场上有大量的代理提供商。它们之间的主要区别是地理位置覆盖范围、IP池的大小和速度，这些共同决定了价格。您需要自己仔细检查和比较它们，选择最适合您的需求和预算的一个。</p><p id="a794" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你碰巧使用Scrapy框架进行网页抓取，Zyte智能代理可能是一个不错的选择，因为它易于使用，并且具有相对经济的计划。顺便说一下，如果你只是想做一些测试，不要忘记取消订阅Zyte智能代理，否则，试用期过后，你将被收费。</p></div></div>    
</body>
</html>