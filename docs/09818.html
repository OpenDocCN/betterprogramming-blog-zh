<html>
<head>
<title>What is an Event in Solidity?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是固体中的事件？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-is-an-event-in-solidity-420caeb38859?source=collection_archive---------0-----------------------#2021-10-17">https://betterprogramming.pub/what-is-an-event-in-solidity-420caeb38859?source=collection_archive---------0-----------------------#2021-10-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2677" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">事件概念简明指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ce00a915c18ab5be375211228f6fbfec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*028tff0-C5eRCMCKrcRuoQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="5053" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">简而言之，<strong class="kx ir">事件</strong>是与客户端应用程序或前端网站通信的方式，表明区块链上发生了一些事情。</p><p id="bbe2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就我个人而言，当我能够理解一个真实世界的用例时，我对概念理解得最好。下面是创建和发出事件的示例:</p><p id="f8ce" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要声明新事件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lr"><img src="../Images/c87b98c17e07a9e58286d43898ff1637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-cQf52f4pjDSdQZcAmrMQ.png"/></div></div></figure><p id="fe94" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后发出事件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/c6fa4dad2d7b7250d4a3a7cccded3d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QYntPQvgOWVo6xaNUijmTw.png"/></div></div></figure><p id="ee6e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本例中，当用户使用<code class="fe lt lu lv lw b">deposit</code>函数向智能合约发送Ether时，会发出<code class="fe lt lu lv lw b">Deposit</code>事件。</p><p id="502a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该事件包含三个值:存放的地址、存放的乙醚量以及用户进行存放的时间。</p><p id="c214" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe lt lu lv lw b">msg.sender</code>和<code class="fe lt lu lv lw b">msg.value</code>是全局变量，指定发送的以太网的发件人地址和数量。<code class="fe lt lu lv lw b">block.timestamp</code>是一种使用当前块的生成时间来近似当前时间的方法。</p><h1 id="18d9" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">为什么使用事件？</h1><p id="f47f" class="pw-post-body-paragraph kv kw iq kx b ky mp jr la lb mq ju ld le mr lg lh li ms lk ll lm mt lo lp lq ij bi translated">以上面的例子为例，假设您想要在客户端应用程序上显示一个确认存款的警告。这可以通过读取存款事件发出的数据轻松完成。</p><p id="6d84" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是对Solidity中<strong class="kx ir">事件</strong>的一个非常基本的总结。如果你想看上面例子中事件和日志的用例，请继续阅读！</p><pre class="kg kh ki kj gt mu lw mv mw aw mx bi"><span id="c526" class="my ly iq lw b gy mz na l nb nc">async function deposit(amount) {</span><span id="9727" class="my ly iq lw b gy nd na l nb nc">// Web3 connection and contract initialization code...</span><span id="9b8b" class="my ly iq lw b gy nd na l nb nc">  const ethIn = ethers.utils.parseEther(amount)<br/>  const tx = await contract.deposit({value: ethIn})<br/>  const receipt = await tx.wait()<br/>  const data = receipt.logs[0].data<br/>  <br/>  const [depositAmount, time] = ethers.utils.defaultAbiCoder.decode(<br/>    ['uint256', 'uint256'], data<br/>  )</span><span id="6e74" class="my ly iq lw b gy nd na l nb nc">  alert(`Successful deposit of ${depositAmount.toString()} at time ${time}`)</span><span id="1530" class="my ly iq lw b gy nd na l nb nc">}</span></pre><p id="1a2c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的函数接收一定量的乙醚，并调用智能合约上的存款函数。<code class="fe lt lu lv lw b">receipt</code>保存交易回单的数据。<code class="fe lt lu lv lw b">receipt.logs[0].data</code>分解<code class="fe lt lu lv lw b">receipt</code>并允许用户访问由我们的存款事件发出的数据。</p><p id="9235" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些数据以编码的散列形式返回，在当前形式下用处不大。幸运的是，<strong class="kx ir"> ethers </strong>库有一个内置的编码。</p><p id="e91d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe lt lu lv lw b">defaultAbiCoder.decode()</code>接受两个参数。第一个是发出数据的值类型。对于我们来说<code class="fe lt lu lv lw b">etherAmount</code>和<em class="ne">时间</em>都是uint256类型。**编入索引的事件值不会出现在记录的数据中，更多信息请另找时间* *。第二个参数是我们想要解码的数据散列。</p><p id="ff34" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们显示一个带有解码数据的警报。</p></div></div>    
</body>
</html>