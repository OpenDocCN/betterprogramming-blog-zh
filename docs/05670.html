<html>
<head>
<title>Awesome Kubernetes Command-Line Hacks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可怕的Kubernetes命令行黑客</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/awesome-kubernetes-command-line-hacks-8bd3604e394f?source=collection_archive---------4-----------------------#2020-07-27">https://betterprogramming.pub/awesome-kubernetes-command-line-hacks-8bd3604e394f?source=collection_archive---------4-----------------------#2020-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7699" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">给你像专业人士一样学习的建议</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d6d29ee01034d0c8a873ac0f147a05f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4ve38-UVey9BKYr1"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@arget?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">目标</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">未飞溅</a>上拍照。</p></figure><p id="9ed1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Kubernetes管理员将大部分时间花在键入<code class="fe lv lw lx ly b">kubectl</code>命令和编写YAML清单文件上。然而，有经验的Kubernetes管理员与新手的区别在于他们利用<code class="fe lv lw lx ly b">kubectl</code>的方式。</p><p id="d849" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一些节省宝贵时间和充分利用<code class="fe lv lw lx ly b">kubectl</code>的建议。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="48a6" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用别名</h1><p id="7a99" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">每个有经验的系统管理员都会使用别名。这有助于他们节省键入命令的宝贵时间。例如，大多数系统管理员不输入<code class="fe lv lw lx ly b">ls -l</code>，而是使用<code class="fe lv lw lx ly b">ll</code>。同样，对于Kubernetes，您可以使用以下有用的别名。</p><h2 id="2526" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">k代表kubectl</h2><p id="1f07" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">用<code class="fe lv lw lx ly b">k</code>代替<code class="fe lv lw lx ly b">kubectl</code>。如果你能用一个字母做同样的事情，为什么要输入一个七个字母的单词呢？</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="54b3" class="nd mh it ly b gy nt nu l nv nw">alias k=kubectl</span></pre><h2 id="0aeb" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">kubectl像专业人士一样进行模拟演练</h2><p id="bc44" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">键入整个<code class="fe lv lw lx ly b">dry-run</code>标志可能会很累——尤其是当您在一天中多次运行它时。像下面这样简单的别名可以让你的生活变得更容易:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="0bde" class="nd mh it ly b gy nt nu l nv nw">alias kdr='kubectl --dry-run=client -o yaml'</span></pre><p id="6198" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你只需将你的YAML文件收好:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="2ea0" class="nd mh it ly b gy nt nu l nv nw">kdr run nginx --image=nginx &gt; nginx.yaml</span></pre><h2 id="01da" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">轻松应用和删除</h2><p id="11a5" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">同样，您不需要在每次应用或删除配置时输入完整的<code class="fe lv lw lx ly b">kubectl apply</code>或<code class="fe lv lw lx ly b">kubectl delete</code>。请使用下面的别名:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="d194" class="nd mh it ly b gy nt nu l nv nw">alias kap='kubectl apply'<br/>alias kd='kubectl delete'</span></pre><h2 id="6e8c" class="nd mh it bd mi ne nf dn mm ng nh dp mq li ni nj ms lm nk nl mu lq nm nn mw no bi translated">像巫师一样用busybox进行冒烟测试</h2><p id="7152" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为了进行冒烟测试，我们大多数人键入以下命令:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="3988" class="nd mh it ly b gy nt nu l nv nw">kubectl run busybox-test --image=busybox -it --rm --restart=Never -- &lt;command&gt;</span></pre><p id="29fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那是少数。想象一下，如果你每天需要打差不多100次，那有多痛苦。下面的别名可以很好地简化它:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="979f" class="nd mh it ly b gy nt nu l nv nw">alias kbb='kubectl run busybox-test --image=busybox -it --rm --restart=Never --'</span></pre><p id="255b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后简单地使用:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="dcea" class="nd mh it ly b gy nt nu l nv nw">kbb &lt;command&gt;</span></pre><p id="d46b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，您可以根据一天中最常运行的命令来虚构您的别名。下面是我常用的一些:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="a1aa" class="nd mh it ly b gy nt nu l nv nw">alias kdb='kubectl describe'<br/>alias kl='kubectl logs'<br/>alias ke='kubectl exec -it'</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="8d91" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">对kubectl命令使用Bash自动完成功能</h1><p id="be1c" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">有多少次你在输入<code class="fe lv lw lx ly b">kubectl</code>命令时按下TAB键，然后意识到它不起作用？好吧，这里有个窍门。您可以在您的<code class="fe lv lw lx ly b">.bashrc</code>文件中安装一个bash autocomplete插件，它会非常好用。</p><p id="8e4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，请使用以下命令:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="9120" class="nd mh it ly b gy nt nu l nv nw">echo "source &lt;(kubectl completion bash)" &gt;&gt; ~/.bashrc</span></pre><p id="3dd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这非常有用，节省了大量时间，因为您现在可以通过简单地按TAB键来自动完成命令。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b088" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">不要从头开始创建YAML清单</h1><p id="5429" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">从头开始创建YAML清单既耗时又容易出错，尽管使用声明性YAML文件进行生产是一种最佳实践，但这并不意味着您需要手动创建它们。</p><p id="07d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">利用<code class="fe lv lw lx ly b">dry-run</code>标志从命令性命令中生成YAML文件。使用我描述的<code class="fe lv lw lx ly b">kdr</code>别名来加快体验。</p><p id="5d80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这不仅会节省宝贵的时间，还会让你的体验没有错误和压力。节省下来的时间，你可以投入更多的时间来解决实际问题。</p><p id="4252" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管理员使用这种方法面临的一个问题是，并不是所有的Kubernetes资源都有命令式的命令行等价物。但是您可以使用与配置最匹配的资源来生成YAML。</p><p id="8e27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果你想生成一个<code class="fe lv lw lx ly b">DaemonSet</code>，你可以用<code class="fe lv lw lx ly b">kubectl dry-run</code>一个<code class="fe lv lw lx ly b">Deployment</code>，然后根据<code class="fe lv lw lx ly b">DaemonSet</code>规范修改它。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="4a2d" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用kubectl解释</h1><p id="e368" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">kubectl explain</code>比在在线文档中来回跳转更有帮助。它很容易理解，并为您提供了关于资源规格的足够信息。</p><p id="6e34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，让我们用<code class="fe lv lw lx ly b">kubectl dry-run</code>创建一个pod，然后使用<code class="fe lv lw lx ly b">kubectl explain</code>来理解如何向pod添加资源请求和限制。</p><p id="7d11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">声明别名:</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="2d55" class="nd mh it ly b gy nt nu l nv nw">$ alias k='kubectl'<br/>$ alias kdr='kubectl --dry-run=client -o yaml'</span></pre><p id="e06d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们使用<code class="fe lv lw lx ly b">dry-run</code>生成pod清单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="5681" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到资源部分在pod的<code class="fe lv lw lx ly b">spec.containers</code>部分中。现在让我们运行<code class="fe lv lw lx ly b">kubectl explain</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="1939" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，这些信息足够让你开始了。您可以检查<code class="fe lv lw lx ly b">requests</code>和<code class="fe lv lw lx ly b">limits</code>规格，查看可能的值和相关细节。</p><pre class="kj kk kl km gt np ly nq nr aw ns bi"><span id="babf" class="nd mh it ly b gy nt nu l nv nw">$ k explain pod.spec.containers.resources.requests<br/>$ k explain pod.spec.containers.resources.limits</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="212c" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">JSON路径非常棒</h1><p id="e393" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">JSON路径乍一看似乎很可怕，但是相信我，一旦你掌握了窍门，它们一点也不难。您可以简单地使用<code class="fe lv lw lx ly b">kubectl explain</code>和JSON路径来对<code class="fe lv lw lx ly b">kubectl</code>输出进行高级操作。例如，您可以使用JSON路径从部署中获取pod名称，并将它们提供给单元测试脚本。</p><p id="b97c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用JSON路径的高级排序来减少大量开销(例如，手动查找和过滤)。</p><p id="59f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是来自kubectl cheatsheet 的一些例子，列出了使用JSON路径的多种方式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="0362" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="c4d0" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">这些建议可以帮助你在Kubernetes的职业生涯中走得更远，并彻底享受你的Kubernetes体验。你可以有自己的创新方法来简化你的工作，并且可以随意使用任何能简化你工作的方法。</p><p id="16e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。我希望你喜欢这篇文章。</p></div></div>    
</body>
</html>