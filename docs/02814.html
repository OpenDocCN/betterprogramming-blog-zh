<html>
<head>
<title>Getting Started with GraphQL (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GraphQL入门(第2部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-graphql-5cd8e7c66909?source=collection_archive---------21-----------------------#2020-01-02">https://betterprogramming.pub/getting-started-with-graphql-5cd8e7c66909?source=collection_archive---------21-----------------------#2020-01-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3e8c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">后端</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0d6ed6728d49f0ce2f036755796f2b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2OocTN9awG2iOFvS4Lbow.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">查尔斯在<a class="ae kv" href="https://unsplash.com/s/photos/netflix?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0f4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">这是GraphQL入门系列的第2部分。我们将使用GraphQL构建一个网飞克隆。可以在这里</em>  <em class="ls">查看试玩app </em> <a class="ae kv" href="https://jflix.herokuapp.com/#/" rel="noopener ugc nofollow" target="_blank"> <em class="ls">。源代码可在</em> </a><a class="ae kv" href="https://github.com/ioneone/Jflix" rel="noopener ugc nofollow" target="_blank"> <em class="ls">这里</em> </a> <em class="ls">。你也可以在这里</em>  <em class="ls">玩玩demo app的graphiql </em> <a class="ae kv" href="https://jflix.herokuapp.com/graphql" rel="noopener ugc nofollow" target="_blank"> <em class="ls">。</em></a></p><h2 id="1692" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">索引</h2><ul class=""><li id="fec9" class="mm mn iq ky b kz mo lc mp lf mq lj mr ln ms lr mt mu mv mw bi translated"><a class="ae kv" href="https://medium.com/@ionejunhong/getting-started-with-graphql-a1cc7951ef39" rel="noopener">第1部分:简介</a></li><li id="e0ff" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">第2部分:后端(你在这里)</li><li id="69fb" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">第三部分:前端</li><li id="382a" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" href="https://medium.com/@ionejunhong/getting-started-with-graphql-a281b14a560d" rel="noopener">第4部分:基本特征</a></li><li id="d778" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" href="https://medium.com/@ionejunhong/getting-started-with-graphql-77f03d611136" rel="noopener">第5部分:部署</a></li></ul></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="01ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">访问Github repo <a class="ae kv" href="https://github.com/ioneone/Jflix" rel="noopener ugc nofollow" target="_blank">这里</a>查看完整代码。我使用本教程作为参考:</p><div class="nj nk gp gr nl nm"><a href="https://www.udemy.com/course/graphql-with-react-course/" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd ir gy z fp nr fr fs ns fu fw ip bi translated">带React的GraphQL:完整的开发人员指南</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">如果你厌倦了绞尽脑汁试图找出使用哪种类型的后端服务器，这是一门课程…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">www.udemy.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa kp nm"/></div></div></a></div><p id="320c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将通过构建一个允许用户观看他们喜欢的电影和电视剧的web应用程序来学习GraphQL，特别是GraphQL的JavaScript实现。这有点像网飞的复制品。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/d4aa0b8b5e1ad235830e941ddaf485b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oXBGHkwgK8yIs92Xp4Ct2g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这是我们想要建立的东西(顺便说一句，你是一部好电视剧)</p></figure><p id="ac93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这一部分，我们将在后端工作。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="f789" class="oc lu iq bd lv od oe of ly og oh oi mb jw oj jx me jz ok ka mh kc ol kd mk om bi translated">引入节点</h1><p id="5a3b" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">我们将使用<a class="ae kv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> NodeJS </a>构建后端。Node是一个允许我们在浏览器之外执行JavaScript代码的平台。npm是JavaScript的一个包管理器。让我们用这个命令初始化我们的项目:</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="33fa" class="lt lu iq or b gy ov ow l ox oy">npm init</span></pre></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="b840" class="oc lu iq bd lv od oe of ly og oh oi mb jw oj jx me jz ok ka mh kc ol kd mk om bi translated">Express简介</h1><p id="cdb0" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">我们将使用<a class="ae kv" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> expressJS </a>来帮助我们构建后端。Express是NodeJS的web应用框架。这有助于我们轻松快速地构建后端。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="e102" class="lt lu iq or b gy ov ow l ox oy">npm install --save express</span></pre><p id="5b42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个名为<code class="fe oz pa pb or b">backend/server.js</code>的文件，并插入以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="dc9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您可以用这个命令运行服务器。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="1b31" class="lt lu iq or b gy ov ow l ox oy">node backend/server.js</span></pre><h1 id="4793" class="oc lu iq bd lv od pe of ly og pf oi mb jw pg jx me jz ph ka mh kc pi kd mk om bi translated">介绍巴别塔</h1><p id="9f9d" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">我们将在我们的项目中安装巴别塔。Babel是一个编译器，可以让你把ECMAScript编译成CommonJS。NodeJS需要用CommonJS标准编写的JavaScript。我用ES6更舒服，所以我需要这个。我用<a class="ae kv" href="https://medium.com/@pativancarrasco/why-your-es6-syntax-doesnt-work-in-node-js-and-how-to-fix-it-161f0708f1ad" rel="noopener">这个</a>作为安装的参考。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="3ee4" class="lt lu iq or b gy ov ow l ox oy">npm install --save-dev @babel/core @babel/cli @babel/preset-env @babel/node</span></pre><p id="4959" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在创建一个名为<code class="fe oz pa pb or b">.babelrc</code>的文件，并插入下面的代码。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="6865" class="lt lu iq or b gy ov ow l ox oy">{<br/>  "presets": [<br/>    "@babel/preset-env"<br/>  ]<br/>}</span></pre><p id="3f1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这基本上告诉Babel我们想要使用最新的JavaScript语法。现在，您可以使用以下命令运行服务器:</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="78f7" class="lt lu iq or b gy ov ow l ox oy">babel-node backend/server.js</span></pre></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="50ca" class="oc lu iq bd lv od oe of ly og oh oi mb jw oj jx me jz ok ka mh kc ol kd mk om bi translated">Nodemon简介</h1><p id="5bad" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">Nodemon是一个实用程序，它监视我们项目文件的变化，并自动为我们重启服务器。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="fc3a" class="lt lu iq or b gy ov ow l ox oy">npm install --save-dev nodemon</span></pre><p id="d6b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以使用以下命令运行服务器:</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="f67d" class="lt lu iq or b gy ov ow l ox oy">nodemon --exec babel-node backend/server.js</span></pre><h1 id="97e4" class="oc lu iq bd lv od pe of ly og pf oi mb jw pg jx me jz ph ka mh kc pi kd mk om bi translated">TypeScript简介</h1><p id="fe17" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">我是TypeScript的忠实粉丝，所以我们也将使用它。TypeScript强制JavaScript的类型检查。原来巴贝尔也支持这一点。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="693f" class="lt lu iq or b gy ov ow l ox oy">npm install --save-dev @babel/preset-typescript</span></pre><p id="5bdd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更新<code class="fe oz pa pb or b">.babelrc</code>如下:</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="0dfb" class="lt lu iq or b gy ov ow l ox oy">{<br/>  "presets": [<br/>    "@babel/preset-env",<br/>    "@babel/preset-typescript"<br/>  ]<br/>}</span></pre><p id="27b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加<code class="fe oz pa pb or b">.tsconfig.json</code>用于类型脚本配置:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="158a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以使用以下命令运行服务器:</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="b6a3" class="lt lu iq or b gy ov ow l ox oy">nodemon --exec babel-node backend/server.ts --extensions '.ts,.tsx'</span></pre></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="12be" class="oc lu iq bd lv od oe of ly og oh oi mb jw oj jx me jz ok ka mh kc ol kd mk om bi translated">带Express的GraphQL</h1><p id="181f" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">我们将使用<a class="ae kv" href="https://github.com/graphql/express-graphql" rel="noopener ugc nofollow" target="_blank"> graphql-express </a>来集成express和graphql。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="569a" class="lt lu iq or b gy ov ow l ox oy">npm install --save graphql-express</span></pre><p id="c1c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们告诉express将所有GraphQL请求导航到<code class="fe oz pa pb or b">/graphql</code>端点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="a8e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们需要明确地告诉GraphQL我们有什么数据类型，如何访问它们，以及它们之间的关系是什么。</p><h2 id="98c3" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">设置模式</h2><p id="7213" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">我们需要从npm安装<code class="fe oz pa pb or b">graphql</code>。这是GraphQL的JavaScript实现。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="f800" class="lt lu iq or b gy ov ow l ox oy">npm install --save graphql</span></pre><p id="03a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们有<code class="fe oz pa pb or b">Movie</code>模型(我们稍后将创建这个模型)。现在，为了简单起见，假设它有<code class="fe oz pa pb or b">id</code>、<code class="fe oz pa pb or b">title</code>、<code class="fe oz pa pb or b">description</code>和<code class="fe oz pa pb or b">released_year</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="b6ac" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">设置数据库</h2><p id="a089" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">转到mLab，为这个项目创建一个mongoDB。我们可以使用免费版本。一旦创建，插入一个超级用户，然后复制MongoDB URI。现在数据库创建好了，我们知道了它的位置，我们想建立一个到它的连接。我们将使用<code class="fe oz pa pb or b">mongoose</code>来帮助我们做到这一点。我借鉴了<a class="ae kv" href="https://mongoosejs.com/docs/" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="a168" class="lt lu iq or b gy ov ow l ox oy">npm install --save mongoose</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="6e0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们实际上创建了<code class="fe oz pa pb or b">Movie</code>模型。我们还插入一部假电影，<code class="fe oz pa pb or b">Cat Wars</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="2142" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">返回模式</h2><p id="b7c0" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">好了，我们的数据库准备好了。在GraphQL的世界里，所有的数据只是一个节点。我们需要告诉GraphQL如何找到一个给定ID的<code class="fe oz pa pb or b">Movie</code>节点。这被称为<strong class="ky ir">根查询</strong>。这充当了数据的入口点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/b037e1466bf31a5afd620a652c220806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vRL1q8aImpzIOqMEDGqHPA.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="b10a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们用刚刚定义的这个根查询创建GraphQL模式，并将其插入到<code class="fe oz pa pb or b">graphqlHTTP</code>配置中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="4afb" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">图形ql</h2><p id="3aba" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">好了，我们已经完成了GraphQL的最小设置。让我们看看查询<code class="fe oz pa pb or b">movie()</code>是否真的有效。我们用<code class="fe oz pa pb or b">graphiql</code>来核对一下。GraphQL是开发人员与graph QL服务器交互的用户界面。启动服务器并转到<code class="fe oz pa pb or b">/graphql</code>端点。你也可以点击这里查看Jflix的GraphQL服务器<a class="ae kv" href="https://jflix.herokuapp.com/graphql" rel="noopener ugc nofollow" target="_blank">来使用它！</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/e2636d1dbaa5b239014f38f4e7a63d11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WzdVn3EmJ5YOVjLcUzNelQ.png"/></div></div></figure><p id="9c8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到mLab控制台检查我们之前插入的假数据的ID。然后在左侧面板中，我们可以如下调用<code class="fe oz pa pb or b">movie()</code>查询。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="8da3" class="lt lu iq or b gy ov ow l ox oy"># input<br/>query {<br/>  movie(_id: "5e0d381b19ea52948f1efa86") {<br/>    title<br/>    description<br/>  }<br/>}</span><span id="898e" class="lt lu iq or b gy pl ow l ox oy"># output<br/>{<br/>  "data": {<br/>    "movie": {<br/>      "title": "Cat Wars",<br/>      "description": "The cats are taking over the world"<br/>    }<br/>  }<br/>}</span></pre><p id="2eb8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">厉害！如您所见，由于GraphQL，我们可以在请求中添加<code class="fe oz pa pb or b">released_year</code>或删除<code class="fe oz pa pb or b">description</code>，而无需更改后端代码。我们得到了我们想要的——不多也不少。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="bc25" class="oc lu iq bd lv od oe of ly og oh oi mb jw oj jx me jz ok ka mh kc ol kd mk om bi translated">更多模式</h1><p id="4479" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">我们现在将添加更多的东西到我们的模式中，使它更有趣。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pm"><img src="../Images/f88994244d8ce688ffede7676085f163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eN-5n35maCN0n0UIKdvcAQ.png"/></div></div></figure><ul class=""><li id="9237" class="mm mn iq ky b kz la lc ld lf pn lj po ln pp lr mt mu mv mw bi translated">每部电影都有成熟度分级和电影类型</li><li id="2a87" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">每个系列都有成熟度等级和系列类型</li><li id="3a08" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">每个成熟度等级都有许多电影和连续剧</li><li id="ca61" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">每种电影类型都有许多电影</li><li id="e44c" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated">每个系列类型都有许多系列</li></ul><p id="ede1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是上面模式的mongoose实现。我用<a class="ae kv" href="http://learnmongodbthehardway.com/schema/schemabasics/" rel="noopener ugc nofollow" target="_blank">这个</a>作为如何在mongoDB中做多对多关系的参考(和MySQL略有不同)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="c0a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们需要告诉GraphQL这些新模式的类型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="e6b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意我们对<code class="fe oz pa pb or b">fields</code>使用了箭头函数。这允许我们引用<code class="fe oz pa pb or b">MovieType</code>中的<code class="fe oz pa pb or b">MaturityRatingType</code>。如GraphQL <a class="ae kv" href="https://graphql.org/graphql-js/type/" rel="noopener ugc nofollow" target="_blank">文档</a>中所述:</p><blockquote class="pq pr ps"><p id="01a7" class="kw kx ls ky b kz la jr lb lc ld ju le pt lg lh li pu lk ll lm pv lo lp lq lr ij bi translated">当两个类型需要相互引用，或者一个类型需要在一个字段中引用自己时，您可以使用一个函数表达式(也称为闭包或thunk)来提供这些字段。</p></blockquote><h2 id="92c9" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">更多根查询</h2><p id="7403" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">我们还将添加更多的根查询，以便GraphQL可以从不同的位置遍历数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h2 id="8caf" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">别名</h2><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="d6dc" class="lt lu iq or b gy ov ow l ox oy"># input<br/>query {<br/>  getAllMovies {<br/>    ...<br/>  },<br/>  getMovieById(_id: ...) {<br/>    ...<br/>  }<br/>}</span><span id="c8a0" class="lt lu iq or b gy pl ow l ox oy"># output<br/>{<br/>  "data": {<br/>    "getAllMovies": [<br/>      ...<br/>    ],<br/>    "getMovieById": {<br/>      ...<br/>    }<br/>  }<br/>}</span></pre><p id="3c81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将查询的名称改为更具描述性的名称(<code class="fe oz pa pb or b">movie</code>现在是<code class="fe oz pa pb or b">getMovieById</code>，但是响应JSON看起来并不好。我们可以使用alias来修复它，如下所示:</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="1111" class="lt lu iq or b gy ov ow l ox oy"># input<br/>query {<br/>  movies: getAllMovies {<br/>    ...<br/>  },<br/>  movie: getMovieById(_id: ...) {<br/>    ...<br/>  }<br/>}</span><span id="8f57" class="lt lu iq or b gy pl ow l ox oy"># output<br/>{<br/>  "data": {<br/>    "movies": [<br/>      ...<br/>    ],<br/>    "movie": {<br/>      ...<br/>    }<br/>  }<br/>}</span></pre><p id="bc30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有关别名的官方文档，请参见<a class="ae kv" href="https://graphql.org/learn/queries/#aliases" rel="noopener ugc nofollow" target="_blank">本</a>。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="c7b7" class="oc lu iq bd lv od oe of ly og oh oi mb jw oj jx me jz ok ka mh kc ol kd mk om bi translated">变化</h1><p id="c628" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">在GraphQL中，GET请求被称为<strong class="ky ir">查询</strong>。其他的一切(比如POST、DELETE)都被称为<strong class="ky ir">突变</strong>(因为你是在突变数据库)。在上一节中，我们完成了用GraphQL设置所有GET请求。现在，我们希望能够使用GraphQL通过突变向数据库插入数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="1b56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们添加电影或系列时，不要忘记将它的id添加到<code class="fe oz pa pb or b">MovieGenre/SeriesGenre</code>和<code class="fe oz pa pb or b">MaturityRating</code>型号中。一旦我们定义了我们的<code class="fe oz pa pb or b">Mutation</code>类型，让GraphQL知道它的存在。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pc pd l"/></div></figure></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="aaa3" class="oc lu iq bd lv od oe of ly og oh oi mb jw oj jx me jz ok ka mh kc ol kd mk om bi translated">测试看看是否一切正常</h1><p id="017a" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf on lh li lj oo ll lm ln op lp lq lr ij bi translated">去graphql创建一些假数据:</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="7323" class="lt lu iq or b gy ov ow l ox oy"># input<br/>mutation {<br/>  genre1: addMovieGenre(name:"Thriller") {<br/>    _id<br/>    name<br/>  },<br/>  genre2: addMovieGenre(name:"Adventures") {<br/>    _id<br/>    name<br/>  },<br/>  maturity_rating: addMaturityRating(name: "G") {<br/>    _id,<br/>    name<br/>  }<br/>}</span></pre><p id="31b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记下响应中的<code class="fe oz pa pb or b">_id</code>字段。然后添加新电影。</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="9988" class="lt lu iq or b gy ov ow l ox oy"># input<br/>mutation {<br/>  addMovie(<br/>    title:"Cat Wars 2", <br/>    description: "Cats are taking over the universe", <br/>    released_year: 2020,<br/>    maturity_rating_id: "5e0e40847db1059e2e896b96",<br/>    genre_ids: [<br/>      "5e0e404c7db1059e2e896b95",<br/>      "5e0e40997db1059e2e896b97"<br/>    ]<br/>  ) {<br/>    _id<br/>    title<br/>    maturity_rating {<br/>      _id<br/>      name<br/>    }<br/>    genres {<br/>     _id<br/>      name<br/>    }<br/>  }<br/>}</span></pre><p id="7170" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您应该会看到这样的响应:</p><pre class="kg kh ki kj gt oq or os ot aw ou bi"><span id="5784" class="lt lu iq or b gy ov ow l ox oy">{<br/>  "data": {<br/>    "addMovie": {<br/>      "_id": "5e0e41645dad6a9e7fd196e8",<br/>      "title": "Cat Wars 2",<br/>      "maturity_rating": {<br/>        "_id": "5e0e40847db1059e2e896b96",<br/>        "name": "G"<br/>      },<br/>      "genres": [<br/>        {<br/>          "_id": "5e0e404c7db1059e2e896b95",<br/>          "name": "Thriller"<br/>        },<br/>        {<br/>          "_id": "5e0e40997db1059e2e896b97",<br/>          "name": "Adventures"<br/>        }<br/>      ]<br/>    }<br/>  }<br/>}</span></pre><p id="ed44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了——看起来突变和查询都工作正常！</p></div></div>    
</body>
</html>