<html>
<head>
<title>Web Scraping Behind Authentication With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python进行身份验证后的Web抓取</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/web-scraping-behind-authentication-with-python-be5f82eb85f0?source=collection_archive---------1-----------------------#2020-03-06">https://betterprogramming.pub/web-scraping-behind-authentication-with-python-be5f82eb85f0?source=collection_archive---------1-----------------------#2020-03-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2bb0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何登录您的自动化并继续刮擦</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fcaff726dc7759513c74aa9eaa8c9246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MeqRtlH2XhwnN-srifKjWA.png"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="1767" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">目标</h1><p id="1b85" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">这个简短指南的目标是在登录网页时进行刮擦。我将使用GitHub网页作为本指南，因为它可能是大多数阅读本文的人所熟悉的。</p><p id="c5c2" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">这种方法并不适用于所有的网页，而且每个站点的身份验证都是不同的，但是如果您自己尝试的话，这可能是一个好的开始。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="914a" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">准备文件</h1><p id="8553" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">如前所述，我将使用Python和<code class="fe mu mv mw mx b">requests</code>库来完成这个任务。在本指南中，我将只关注这一点。</p><p id="9e85" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">创建一个文件，我暂且称之为<code class="fe mu mv mw mx b">scrape.py</code>。安装必要的需求(嗯，只有<code class="fe mu mv mw mx b">requests</code>)并导入它们。</p><p id="1771" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">用<code class="fe mu mv mw mx b">pip install requests</code>安装<code class="fe mu mv mw mx b">requests</code>，用<code class="fe mu mv mw mx b">import requests</code>导入到你的文件中。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="2e6b" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">会议</h1><p id="9248" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">我们将在请求中使用一个<code class="fe mu mv mw mx b">Session</code>对象来持久化用户会话。该会话稍后用于发出请求。</p><p id="b542" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">然后，对于每个即将到来的请求，所有cookies都将在会话中保持不变。也就是说，如果我们登录，会话将会记住我们，并将其用于我们未来的所有请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/0b6fce4015106370b28a856dcf108925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ETcMs82vyhHVtWmUm78nxg.png"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="2d42" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">获取我们需要的数据</h1><p id="22ca" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">好了，基本上，我们需要知道什么数据传递给哪个URL。这将在Chrome中完成。</p><p id="7164" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">我们需要知道两件事:</p><ul class=""><li id="358a" class="mz na it lv b lw mp lz mq mc nb mg nc mk nd mo ne nf ng nh bi translated"><code class="fe mu mv mw mx b">POST</code>请求(登录)将被发送到的URL。</li><li id="d419" class="mz na it lv b lw ni lz nj mc nk mg nl mk nm mo ne nf ng nh bi translated">将发送的有效负载或数据。</li></ul><p id="7526" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">让我们打开开发人员工具，转到<code class="fe mu mv mw mx b">Network</code>选项卡并登录，这样我们就可以获取URL。</p><p id="35ee" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">一个小技巧是转到登录网址，清除网络标签，这样所有以前的请求都会消失，这样你的登录请求可能会出现在顶部。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ea8c201db1f0584fee5fd4813e0e391f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/0*fDSxZ3r4llcnbF_O.png"/></div></figure><p id="abf1" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">箭头指向<code class="fe mu mv mw mx b">clear</code>按钮，而正方形标记登录请求。单击它以获取有关它的信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/8d27ca7245c697cabf4e9a23b3b6ba48.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/0*P5-2jPEfebBU-FlK.png"/></div></figure><p id="d968" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">URL清楚地显示为<code class="fe mu mv mw mx b"><a class="ae np" href="http://www.github.com/session" rel="noopener ugc nofollow" target="_blank">www.github.com/session</a></code>，所以让我们保存它。这是我们的第一个请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/1d8f6668715aff0f5d77429d0170dc18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWVEDV0R6j8paZa4piroyg.png"/></div></div></figure><p id="f9b2" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">这是行不通的，因为我们没有发送正确的数据。让我们向下滚动之前捕获的会话请求，查看发送的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/1f7bb6c0d6f82119e32359a4c5ba3a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*09h2bGIdmKtiGf6P.png"/></div></div></figure><p id="d48e" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">我确实删除了一些我的个人数据。但是这是我们在发出请求时需要传递的大量数据。然而，有一个很好的工具可以使用。你可以在curl.trillworks.com<a class="ae np" href="https://curl.trillworks.com/" rel="noopener ugc nofollow" target="_blank">找到它。</a></p><p id="1cf1" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">有了这个，您就可以复制请求，并获得发出请求所需的所有数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/7673643cb67a0878cb1d36e23ce1340b.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/0*bsXDxwaA6YVOchUM.png"/></div></figure><p id="c6da" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">复制请求数据并将其粘贴到链接的左侧字段中。您将得到一个完整的请求，包括标题和cookies，都在右边。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/befcf8cd5b9a12b1c44e3078aa69a9fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*skIEdTZqxRfA3tw3.png"/></div></div></figure><p id="dae8" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">所以我们需要两样东西，T0和T1。让我们把这两个粘贴到我们的Python文件中。你也可以拿头球，但我现在不会。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/d4edf3d81b921069bcc397f5a8423ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qDFGdssAvaCNAwF1nkBAQ.png"/></div></div></figure><p id="b9d3" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">所以，我们基本上只是把它们传递到请求中。我们现在不会对这个响应做太多，所以如果你不想的话，你甚至不需要把它保存到一个变量中。</p><p id="fe60" class="pw-post-body-paragraph lt lu it lv b lw mp ju ly lz mq jx mb mc mr me mf mg ms mi mj mk mt mm mn mo im bi translated">现在你基本上完成了第一部分。您已请求登录。您在同一脚本中提出的所有其他请求将被视为已登录。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="8594" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">已登录</h1><p id="fced" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">因此，现在我们已经登录，例如，我们可以向私有回购发出请求。我将向这个特定博客的存储库发出请求，因为它在我的GitHub上是私有的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/573256a16260da5c716d6ecf486cced5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rkqc_lA-8Itg3BtFAd6usQ.png"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="c2c1" class="lb lc it bd ld le lf lg lh li lj lk ll jz lm ka ln kc lo kd lp kf lq kg lr ls bi translated">擦</h1><p id="e75b" class="pw-post-body-paragraph lt lu it lv b lw lx ju ly lz ma jx mb mc md me mf mg mh mi mj mk ml mm mn mo im bi translated">现在，真正的刮削。本指南不会涉及这一点。但是如果你愿意，你可以看看我的<a class="ae np" href="https://www.banjocode.com/web-scraping/" rel="noopener ugc nofollow" target="_blank">其他指南</a>关于如何用<a class="ae np" href="https://www.crummy.com/software/BeautifulSoup/doc" rel="noopener ugc nofollow" target="_blank">美汤</a>刮痧。很容易从你离开的地方重新开始。</p></div></div>    
</body>
</html>