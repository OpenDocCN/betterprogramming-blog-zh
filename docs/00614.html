<html>
<head>
<title>SwiftUI: Understanding Declarative Programming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI:理解声明式编程</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swiftui-understanding-declarative-programming-aaf05b2383bd?source=collection_archive---------3-----------------------#2019-06-19">https://betterprogramming.pub/swiftui-understanding-declarative-programming-aaf05b2383bd?source=collection_archive---------3-----------------------#2019-06-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/06aa0812af4a0a480454dfeb7b519427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LrHx1MuJvt9OZh-ChJUPkQ.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="6be5" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">被声明式编程搞糊涂了？别担心，这不难理解。</h2></div><p id="1606" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">据苹果公司称，SwiftUI是一个令人惊叹的声明式编程框架，用于在iOS和其他苹果平台上构建用户界面。盒子上是这么写的。</p><p id="9bf9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">但是“声明性”是什么意思呢？</p><p id="33ed" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">好吧，我们可以从辩论声明式编程与命令式编程开始，但这只是进一步的争论，因为我们现在需要定义术语“命令式”。</p><p id="92b1" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">相反，我更喜欢简单地替换我原来句子中的一个词。</p><p id="8f0c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">SwiftUI是一个惊人的<em class="lp">功能</em>编程环境，用于构建用户界面。</p><p id="eb61" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">所以让我们看看这个定义，看看它会把我们带到哪里。</p><h1 id="3b1d" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">函数式编程</h1><p id="c0d9" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">有些人看到“函数式编程”这几个字就开始担心。</p><p id="2677" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这主要是因为太多的函数式程序员开始抛出像<em class="lp">纯函数</em>这样的短语或者像<em class="lp">单子</em>和<em class="lp"> lambdas </em>这样的术语，然后开始在白板上描述这一切背后的数学…这时你的眼睛开始变得呆滞，你开始寻找最近的出口。</p><p id="e713" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">别担心，我们不会在这里这么做。</p><p id="8e01" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">毕竟我们已经知道什么是功能了。函数基本上是封装的代码块，接受值并返回结果。完成了。</p><p id="608b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在SwiftUI中，这些函数返回定义我们的用户界面的片段和部分。或者换句话说，我们使用那些函数来<em class="lp">声明</em>我们的接口。</p><p id="e360" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">开始有意义了吗？</p><h1 id="bdf0" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">视图</h1><p id="a6a8" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">在SwiftUI中，构成我们界面的大部分部分被称为视图。有文字吗？这是一个观点。一个图像？另一种观点。是列表吗？你猜对了。这是一个视图列表。</p><p id="154e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">但是不像UIKit严重超载的Objective-C调度UI视图，SwiftUI视图实际上只是一些小信息，当它们组合在一起时，<em class="lp">描述了我们的界面。</em></p><p id="7f7f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们如何将它们结合在一起？</p><h1 id="59f5" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">Win的嵌套函数</h1><p id="47af" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">函数式编程的另一个方面是，我们通常将函数嵌套在函数中。我们在SwiftUI中也是这样做的。</p><p id="3fc7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">先别走！</p><p id="d67e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这可能看起来很奇怪，但是如果你停下来考虑一下，你已经习惯于用这些术语思考了。我们的UINavigationController包含一个UITableView，其列表包含UITableViewCells，后者可能包含包含UILabels和UIButtons的UIStackViews。</p><p id="35ff" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一个界面元素包含其他元素，其他元素包含其他元素，直到瞧！我们已经描述了我们的界面，这是下一个屏幕，我们在这里做同样的事情。</p><p id="1326" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在下面的SwiftUI示例中，视图主体返回的接口归结为一个包含列表的NavigationView，其元素是HStack视图，后者又包含一个图像和一些文本。</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="5440" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">语法可能看起来有点奇怪，但Swift 5.1中的一些新功能支持这一点。</p><p id="8952" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">嘣。我们刚刚用15行代码声明了我们的第一个全功能SwiftUI接口。</p><h1 id="a11e" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">修饰语</h1><p id="8dbe" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">“坚持住，老兄！”你说。“没那么快。如果我希望我的文本是红色的怎么办？我需要一个标题，而不是正文，还有……”</p><p id="9f1c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">明白了。您想要修改默认的外观。</p><p id="90b6" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">那么我们该怎么做呢？</p><p id="c453" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">修饰符。</p><p id="71c4" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">是的，是我安排的。但这是苹果公司使用的术语，也很合适，所以我们将坚持使用它。</p><p id="053d" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">从概念的角度来看，修饰符是一个视图上的操作符，它返回另一个视图。可以无限修改(或者直到内存用完😉).</p><p id="9f56" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">从实践的角度来看，你所做的一切都是使用SwiftUI的视图和操作符来描述SwiftUI的界面，用几乎<em class="lp">完全</em>相同的术语来描述另一个开发者的界面。</p><p id="4255" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">“我希望我的免责声明文本在那里，使用脚注字体和大小，并使其成为次要颜色，以便它在黑暗模式下工作。”</p><p id="0889" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这是一个有两个修饰符的界面元素。</p><pre class="mn mo mp mq gt mt mu mv mw aw mx bi"><span id="854e" class="my lr je mu b gy mz na l nb nc">Text("Your mileage my vary.")<br/>    .font(.footnote)<br/>    .foregroundColor(.secondary)</span></pre><p id="b780" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">向SwiftUI描述上面的接口，它会完成剩下的工作，根据字体大小和应用程序运行的设备，用适当的填充和间距来布局文本。</p><p id="bded" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">它会自动处理动态文本和可访问性字体大小。它会自动交换颜色，使其在亮暗模式下看起来都正确。它支持国际化和文本方向。</p><p id="fb6b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">简而言之，它尽最大努力管理繁琐的小细节，并在你界面的每一个元素和部分上做到这一点。这让开发人员可以专注于应用程序的功能、业务逻辑和数据。</p><p id="df21" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">说到这个…</p><h1 id="a50e" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">我们的数据呢？</h1><p id="55e7" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">大多数应用都是关于数据的。有时数据内置于应用程序中，如我们上面的免责声明示例所示，但通常情况下，我们的数据来自外部来源、数据库、API，有时甚至来自直接输入应用程序的信息。</p><p id="08eb" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">当我们在SwiftUI中定义一个用户界面元素时，我们也告诉该元素在哪里可以找到它需要的数据。有时这些信息是静态的，就像上面显示的文本视图中的字符串。</p><p id="d76c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">有时这些信息是由我们的数据驱动的。在下面的例子中，我们修改了我们的列表视图，当它在应用程序的其他地方初始化时，使用传递给它的数据。</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="1176" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">要列出的第一个参数告诉它在哪里可以找到数据。</p><p id="19d5" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">List将从数组中取出每个元素，并将其传递给闭包，闭包又用它来构建并返回显示该元素的视图。</p><p id="a2ba" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">所有这些都不需要数据源或代理。上面的代码可以是你的应用程序中一个完整的工作屏幕。</p><h1 id="8514" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">动态数据</h1><p id="b169" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">有时我们的信息是动态的，会发生变化，我们的界面也应该相应地调整。</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="80e2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">上面的实现实际上与第一个相同，但是有一个主要的区别，那就是将<code class="fe nd ne nf mu b">@Binding</code>属性包装器添加到我们的列表和标题变量中。</p><p id="22fe" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><em class="lp"> Binding </em>告诉SwiftUI监视列表数组的变化。如果它的所有者更新了数组的内容，他们会通知我们，我们的列表视图会自动更新和呈现。</p><p id="3e23" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">您应该注意到List是一个非常聪明的小视图。如果列表的所有者插入一个项目并删除另一个项目，在了解到列表发生变化时，将扫描更新的列表，将其与以前的列表进行比较，然后为您生成正确的插入和删除动画。</p><p id="a564" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">另外，请注意，我们现在也在导航栏中传递我们想要的标题。title变量也是绑定的，所以无论何时数据发生变化，我们的标题栏都会自动更新。</p><p id="a1bc" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">绑定只是在SwiftUI中管理和维护应用程序的<em class="lp">状态</em>的方法之一。对所有这些的全面讨论超出了本文的范围，所以请继续关注。</p><h1 id="bb2c" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">环境</h1><p id="defd" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">应该提到的另一个方面是<em class="lp">的环境</em>。</p><p id="258a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在SwiftUI中，<em class="lp">环境</em>是一组全局变量，用于描述应用程序运行的环境。比如我们是处于光明模式还是黑暗模式？目前的垂直尺寸等级是多少？横向？</p><p id="2742" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">可以查询这些变量来确定设备和应用程序的当前状态，以便您可以在正确的时间做正确的事情。</p><p id="0a46" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">您还可以将您自己的信息添加到环境中，并在以后的视图层次结构中访问它。</p><pre class="mn mo mp mq gt mt mu mv mw aw mx bi"><span id="bd27" class="my lr je mu b gy mz na l nb nc">@EnvironmentObject var settings: UserSettings<br/>@Environment(\.colorScheme) var colorScheme: ColorScheme</span></pre><p id="245c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">同样，这有点超出了本文的范围，但是您需要知道它就在那里。</p><h1 id="4aee" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">在后台</h1><p id="fdd6" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">所以，你<em class="lp">声明</em>你的接口，你将SwiftUI指向你的数据…swift ui完成剩下的工作。</p><p id="1a61" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">每个视图、其修改器的状态、其数据以及环境的当前状态被组合起来，并积极地缩减为一组布局和渲染命令。然后将结果呈现给用户。</p><p id="a940" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">然后SwiftUI等待数据的更改。如果出现这种情况，SwiftUI会遍历受影响的视图并构建一个新的布局树，将发现的任何更改与当前树进行比较，然后呈现视图中需要更新的部分。</p><p id="c821" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这使得SwiftUI比UIKit快得惊人。其实大部分的视图和动画渲染都是直接用Metal完成的。</p><h1 id="db87" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">动画？</h1><p id="d048" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">是的，在SwiftUI中制作动画很容易。事实上，确定视图状态转换可能需要什么动画被直接构建到树比较过程中。</p><p id="f1ac" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一些动画，像列表插入和删除以及那些与视图修改器状态改变有关的动画，被直接构建到系统中。</p><p id="c56c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如果需要的话，可以对它们进行修改和定制。</p><h1 id="93cc" class="lq lr je bd ls lt lu lv lw lx ly lz ma kk mb kl mc kn md ko me kq mf kr mg mh bi translated">完成块</h1><p id="a802" class="pw-post-body-paragraph kt ku je kv b kw mi kf ky kz mj ki lb lc mk le lf lg ml li lj lk mm lm ln lo im bi translated">原来如此。希望你现在明白了苹果所说的SwiftUI是一个新的、<em class="lp">声明性的</em>编程框架，用于在iOS和其他苹果平台上构建用户界面的意思。</p><p id="bda7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">而且这个<em class="lp">惊人的</em>修饰词【原文如此】是当之无愧的。</p><p id="66fb" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一如既往，请在下面留下任何问题或评论，我将尽我所能回答它们，无论是直接回答还是在以后的文章中回答。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><p id="be78" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">SwiftUI系列继续推出:</p><ul class=""><li id="bbfd" class="nn no je kv b kw kx kz la lc np lg nq lk nr lo ns nt nu nv bi translated"><a class="ae nw" href="https://medium.com/@michaellong/swiftui-deep-inside-navigationview-4d25d57a236c" rel="noopener"> SwiftUI:深度导航视图</a></li><li id="8ced" class="nn no je kv b kw nx kz ny lc nz lg oa lk ob lo ns nt nu nv bi translated"><a class="ae nw" href="https://medium.com/better-programming/best-practices-in-swiftui-composition-282b02772a24" rel="noopener">swift ui组合的最佳实践</a></li><li id="2d31" class="nn no je kv b kw nx kz ny lc nz lg oa lk ob lo ns nt nu nv bi translated"><a class="ae nw" href="https://medium.com/swlh/deep-inside-views-state-and-performance-in-swiftui-d23a3a44b79" rel="noopener">swift ui</a>的深度观点、状态和表现</li></ul></div></div>    
</body>
</html>