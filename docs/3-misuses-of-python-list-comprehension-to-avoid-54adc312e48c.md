# 要避免的 Python 列表理解的 3 种误用

> 原文：<https://betterprogramming.pub/3-misuses-of-python-list-comprehension-to-avoid-54adc312e48c>

## 仅将其用作创建列表的一种简洁易读的方式

![](img/d986af14aa8579e3a36ef2ab91123beb.png)

Eric Prouzet 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

列表是 Python 中最常用的数据类型之一。

作为一种可变容器数据类型，我们使用列表来保存同类(即相同类型的元素)和异类(即不同类型的元素)数据，包括整数、字符串和自定义对象。这使得列表成为几乎所有项目的灵活数据工具。

当谈到用 Python 创建一个`list`对象时，有几种方便的方法。以下代码显示了创建列表的两个基本选项:

*   列表文字(使用一对方括号将元素括起来)
*   默认构造函数(使用内置的`list()`函数)。

基本列表创建方法

在学习了基本的列表创建方法之后，您可能已经学习了创建列表对象的更简洁的方法——列表理解。它的基本语法是:`[expression for item in iterable if condition_eval]`。条件部分是可选的——它只是提供了一种过滤某些元素的机制。让我们在下面的代码片段中看看它的用法，后一个代码片段包括一个条件求值:

列表理解语法

如上所示，列表理解技术为我们创建`list`对象提供了非常易读的语法。本质上，创建`odds_squares`列表的代码可以使用常规的`for`循环来扩展。显然，使用`for`循环不如理解列表简洁和直接。

使用 For 循环创建列表

然而，一旦一些 Python 学习者熟悉了列表理解，他们就开始尽可能地使用它，这可能导致误用。在这篇文章中，我想回顾三个误用案例和它们相应的最佳实践，希望给你一个更好的使用列表理解的正确方法的想法。

# 1.不使用 list()构造函数

我们都知道使用 list comprehension 将从 iterable 生成一个`list`对象。在 Python 中，许多内置数据类型都是可迭代的，包括字符串。让我们看一个使用`str`对象创建列表的例子。

使用字符串列表理解

在上面的代码中，我们想从字符串变量`name`中创建一个小写字母列表。事实上，列表理解创建了所需的列表。但是，请考虑以下替代方案。

使用列表构造函数理解列表

相比于`list`理解选项，使用默认构造函数`list()`不是更简洁吗？让我们考虑另一个涉及使用内置`range()`函数的简单例子，它产生了`range`对象 Python 中另一个常用的 iterable:

使用列表构造函数理解列表(范围)

类似于我们之前所做的，我们仍然可以使用`list()`构造函数直接从`range`对象创建`list`对象。下面是第一次误用的最佳实践——忽略使用默认的`list`构造函数。

***最佳实践# 1:*** *如果你从一个 iterable 创建一个列表，优先使用内置的列表构造函数。*

# 2.冗长的理解

列表理解以其创建`list`对象的简洁性而闻名。然而，如果表达式变得太长，我们应该考虑一些可读性更好的替代方法，比如传统的`for`循环。假设我们为一些衬衫创建标签，作为不同颜色、尺寸和样式选项的组合。下面是`list`的理解方法。

用嵌套结构列表理解

上面的`list`理解涉及到嵌套循环，可能不是最容易读懂的，特别是对于刚接触`*list*` 理解的人，可能理解嵌套结构有问题。

因此，根据您的目标受众，我们可能会选择替代方案。例如，我们可以通过分解来重新组织同一个`list`理解，如下所示。这是相同的表达式，但是使用了更好的格式来突出嵌套的`for`循环。

具有嵌套结构的列表理解(格式化)

例如，下面是一个使用多个`for`循环的扩展表单，如果我们想向一些几乎没有编程或 Python 知识的人展示。有了更明确的`for`循环，我们的代码可能更具可读性。

使用嵌套 For 循环创建列表

然而，如果您是在一个更高级的 Python 开发团队中编写代码，那么您应该通过利用`itertools`模块中的`product()`函数来考虑以下选项。语法变得更加清晰，如下所示。当然，这仍然是一种`list`理解，但是因为使用了方便的内置迭代工具，所以更加简洁。

使用迭代工具进行列表理解

***最佳实践 2。*** *考虑适用的替代方案以最小化嵌套* `*for*` *循环的复杂性。*

# 3.不必要的中介

列表理解的全部目的是创建一个新的`list`对象，由于列表的内存开销，这不是一个自由的操作。因此，如果你不打算对你正在创建的`list`对象做任何事情，列表理解肯定不是一个必要的步骤。我们可以几乎 100%肯定地说，您的工作可以在没有创建列表的情况下完成。

让我们考虑下面这个简单的例子。假设我们有两个列表，一个存储所有学生的名字，另一个存储他们相应的姓氏。我们想把他们的名字一个一个打印出来。

列表理解以创建迭代列表

在上面的代码中，我们创建了一个名为`names`的`list`对象，并对其进行迭代。然而，从内置的`zip()`函数创建的`zip`对象本身是一个可迭代的对象，所以我们可以在`for`循环中直接使用`zip`对象。以下是一个没有`list`对象作为中间步骤的更好的解决方案。

迭代中的 Zip 对象

这一类别中另一个常见的误用是没有使用一个密切相关的技术来列举理解——生成器表达。如果对发电机不太了解，可以参考我之前的[文章](https://medium.com/swlh/generators-in-python-5-things-to-know-c76a1f60427a)上的题目。本质上，生成器是一个 iterable，只有在被请求时才会一次呈现一个值。因此它更加内存友好，避免了存储一个`list`对象所需的所有元素。

就语法而言，生成器表达式具有以下形式:`(expression for item in iterable if condition_eval)`。正如您所看到的，它的语法与 list comprehension 非常相似，只是使用了圆括号而不是方括号。请注意这种差异的重要性，因为一个是创建一个`list`而另一个是创建一个生成器。

下面是一个经典的操作，用于对比列表和生成器之间的差异——计算大量数字的总和，如下所示。如果范围变得很大，发生器仍然可以工作，但列表可能会使您的电脑内存不足。为什么？因为当我们使用 list comprehension 或任何其他创建方法创建一个`list`对象时，我们必须将列表的所有元素存储在内存中，这与生成器相反，生成器一次呈现一个值。

列表理解与生成器表达式

***最佳实践# 3*** *:如果你不打算直接操作列表，首先不要使用列表理解来创建列表。*

# 结论

在本文中，我们回顾了一些新的 Python 程序员在理解列表时可能犯的三个错误。主要的使用原则很简单——**我们只在需要创建和使用结果** `**list**` **对象**时使用列表理解。然而，我们不应该忘记使用一些内置选项的可能性，比如`list()`构造函数和其他可迭代函数(比如`zip`对象和`generator`)。

感谢阅读这篇文章。以下是几篇其他相关文章:

[](https://medium.com/better-programming/9-things-to-know-to-master-list-comprehensions-in-python-8bc0411ec2ed) [## 掌握 Python 中列表理解的 9 件事

### 本教程将帮助你学习 Python 中列表理解的最常见用法

medium.com](https://medium.com/better-programming/9-things-to-know-to-master-list-comprehensions-in-python-8bc0411ec2ed) [](https://towardsdatascience.com/list-comprehension-and-beyond-understand-4-key-related-techniques-in-python-3bff0f0a3ccb) [## 列表理解和超越——理解 Python 中的 4 个关键相关技术

### 它们比你想象的要简单

towardsdatascience.com](https://towardsdatascience.com/list-comprehension-and-beyond-understand-4-key-related-techniques-in-python-3bff0f0a3ccb)