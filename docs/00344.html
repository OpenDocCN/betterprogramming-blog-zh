<html>
<head>
<title>Build a Basic Login Form With Spring Security, Thymeleaf, and Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Spring Security、百里香和Java构建一个基本的登录表单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/spring-security-basic-login-form-7c8f6e6e9f56?source=collection_archive---------0-----------------------#2019-04-25">https://betterprogramming.pub/spring-security-basic-login-form-7c8f6e6e9f56?source=collection_archive---------0-----------------------#2019-04-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b38e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简化登录表单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/10b235da2fc238ba3bfa8d600cb1e56b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s_tdoD-VtbXYiM2V"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@aniket940518?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aniket Bhattacharya </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="05a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Java开发者们好！如果您正在开发基于Spring boot的应用程序，<a class="ae ky" href="https://spring.io/projects/spring-security" rel="noopener ugc nofollow" target="_blank"> Spring Security </a>是保护基于Spring的应用程序的事实上的标准。</p><p id="79af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个简短的教程中，我们将学习使用Spring Boot、Spring Security和百里香构建一个基本的登录表单。</p><p id="bbab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们简要介绍一些不太感兴趣的项目文件:</p><ul class=""><li id="86cf" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe me mf mg mh b"><em class="mi">Application.java</em></code> <em class="mi"> </em>包含了我们的main方法和<code class="fe me mf mg mh b">@SpringBootApplication</code>注释。启动spring boot应用程序的标准方式。</li><li id="4c25" class="lv lw it lb b lc mj lf mk li ml lm mm lq mn lu ma mb mc md bi translated">一个CSS样式表位于<code class="fe me mf mg mh b">src/main/resources/static/css/</code>下，使演示更加漂亮</li><li id="4ded" class="lv lw it lb b lc mj lf mk li ml lm mm lq mn lu ma mb mc md bi translated">一些百里香HTML模板也可以在<code class="fe me mf mg mh b">src/main/resources/</code>下找到，用于演示目的</li><li id="60c1" class="lv lw it lb b lc mj lf mk li ml lm mm lq mn lu ma mb mc md bi translated">最后是位于<code class="fe me mf mg mh b">src/main/resources</code>下的<code class="fe me mf mg mh b"><em class="mi">application.properties</em></code>文件，在这里我们可以将配置参数传递给我们的spring boot应用程序。配置选项的完整列表可在<a class="ae ky" href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到</li></ul><h1 id="2c31" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">属国</h1><p id="7800" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">与所有的Spring boot应用程序一样，有许多“Starter”库可以轻松地将jar添加到您的类路径中:</p><ul class=""><li id="27d5" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe me mf mg mh b">spring-boot-starter-parent </code> —引入所有必需的spring依赖项并管理它们的版本</li><li id="be93" class="lv lw it lb b lc mj lf mk li ml lm mm lq mn lu ma mb mc md bi translated"><code class="fe me mf mg mh b">spring-boot-starter-thymeleaf</code> —添加百里香叶-spring5和百里香叶-extras-Java 8时间依赖关系(<a class="ae ky" href="http://www.thymeleaf.org/" rel="noopener ugc nofollow" target="_blank">更多关于百里香叶</a>)</li><li id="efd5" class="lv lw it lb b lc mj lf mk li ml lm mm lq mn lu ma mb mc md bi translated"><code class="fe me mf mg mh b">spring-boot-starter-security </code> —添加spring-security-config、spring-security-web和spring-aop依赖项</li><li id="9519" class="lv lw it lb b lc mj lf mk li ml lm mm lq mn lu ma mb mc md bi translated"><code class="fe me mf mg mh b">spring-boot-starter-test</code> —增加弹簧靴测试、junit、<a class="ae ky" href="http://hamcrest.org/" rel="noopener ugc nofollow" target="_blank"> hamcrest </a>和<a class="ae ky" href="https://site.mockito.org/" rel="noopener ugc nofollow" target="_blank"> mockito </a></li><li id="c203" class="lv lw it lb b lc mj lf mk li ml lm mm lq mn lu ma mb mc md bi translated"><code class="fe me mf mg mh b">spring-security-test </code> —增加了模拟用户和用户角色的功能</li></ul><p id="1623" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是完整的pom.xml文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/1.basic-form-login" rel="noopener ugc nofollow" target="_blank"> pom.xml </a></p></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="377d" class="mo mp it bd mq mr nu mt mu mv nv mx my jz nw ka na kc nx kd nc kf ny kg ne nf bi translated">MvcConfig</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/1.basic-form-login" rel="noopener ugc nofollow" target="_blank">MvcConfig.java</a></p></figure><p id="ae7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">MvcConfig.java</code>类实现了Spring的<code class="fe me mf mg mh b"><em class="mi">WebMvcConfigurer</em></code> <em class="mi"> </em>接口。这允许你覆盖<code class="fe me mf mg mh b"><em class="mi">addViewControllers</em></code>(以及其他)方法，这是一种配置简单自动控制器的方法。在这个例子中，我们将它们映射到我们的百里香视图中(在<code class="fe me mf mg mh b">src/main/resources</code>下)。</p><h1 id="cb01" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">WebSecurityConfig</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/1.basic-form-login" rel="noopener ugc nofollow" target="_blank">WebSecurityConfig.java</a></p></figure><p id="15fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个类中发生了很多事情，因为它包含了启用和配置我们的基本登录表单的主要安全配置。</p><p id="891c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">扩展<code class="fe me mf mg mh b">WebSecurityConfigurerAdapter</code> <br/>另一个抽象基类，允许你覆盖spring security默认配置的某些方面。在我们的例子中，我们将覆盖方法<code class="fe me mf mg mh b">configure</code>。</p><p id="9480" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">configure(HttpSecurity http)</code>方法<br/>注意传递给这个方法的参数。有几种不同的<code class="fe me mf mg mh b">overloaded</code>配置方法。我们将特别覆盖和配置<code class="fe me mf mg mh b"><em class="mi">HttpSecurity</em></code> <em class="mi"> </em></p><ul class=""><li id="2a8e" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe me mf mg mh b"><em class="mi">authorizeRequests()</em></code> —允许我们配置web服务器上要保护的资源。从我们的示例代码中可以看到，我们允许对CSS目录进行不安全的访问，并要求所有其他资源都是安全的，只能由经过身份验证的用户访问。</li><li id="7248" class="lv lw it lb b lc mj lf mk li ml lm mm lq mn lu ma mb mc md bi translated"><code class="fe me mf mg mh b">formLogin()</code>告诉spring security我们希望使用一个登录表单。如果认证成功，我们提供我们想要重定向到的URL，最后，我们允许访问登录和注销端点。</li><li id="d9d9" class="lv lw it lb b lc mj lf mk li ml lm mm lq mn lu ma mb mc md bi translated">我们正在禁用默认情况下启用的跨站点请求伪造保护。我们将在本系列的后面讨论这一点。</li></ul><p id="d019" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">configureGlobal</code> <strong class="lb iu"> </strong>方法<br/>该方法允许我们在整个应用程序中全局自动连接一个<code class="fe me mf mg mh b"><em class="mi">AuthenticationManager</em></code>类。对于这个例子，我们使用一个用户和一个用户角色的基本内存方法。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="fca8" class="mo mp it bd mq mr nu mt mu mv nv mx my jz nw ka na kc nx kd nc kf ny kg ne nf bi translated">百里香命名空间</h1><p id="7d49" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在我们的<code class="fe me mf mg mh b">login.html</code>文件中需要注意一些事情:</p><p id="bcdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">spring-security名称空间:</p><pre class="kj kk kl km gt nz mh oa ob aw oc bi"><span id="2c74" class="od mp it mh b gy oe of l og oh">&lt;html  xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"&gt;</span></pre><p id="732e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">thymeleaf</code>动作指示表单向提供的URL(/log in)发出POST请求:</p><pre class="kj kk kl km gt nz mh oa ob aw oc bi"><span id="e5b7" class="od mp it mh b gy oe of l og oh">&lt;form th:action="@{/login}" method="post" class="form login"&gt;</span></pre><p id="d837" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">thymeleaf</code>如果条件可以检查URL参数，出错并注销响应，如果返回true则显示内容:</p><pre class="kj kk kl km gt nz mh oa ob aw oc bi"><span id="a2b4" class="od mp it mh b gy oe of l og oh">&lt;div class="text--center" th:if="${param.error}"&gt; Invalid username and password. &lt;/div&gt; &lt;div class="text--center" th:if="${param.logout}"&gt; You have been logged out. &lt;/div&gt;</span></pre><p id="3aa3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">百里香网站<a class="ae ky" href="http://www.thymeleaf.org/doc/tutorials/2.1/thymeleafspring.html#handling-the-command-object" rel="noopener ugc nofollow" target="_blank">上的完整列表</a></p><h1 id="eb6c" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">单元测试</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/1.basic-form-login" rel="noopener ugc nofollow" target="_blank">ApplicationTests.java</a></p></figure><p id="8be2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">@ExtendWith(SpringExtension.class)</code> <br/>告诉JUnit5在Spring的测试支持下运行单元测试</p><p id="45b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">@SpringBootTest</code> <br/>作为春季开机app运行。即装入<code class="fe me mf mg mh b">application.properties</code>和弹簧豆</p><p id="6fa9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">@AutoConfigureMockMvc</code> <br/>创建一个名为MockMvc的测试助手类。我们可以模拟一个前端客户端从这里向服务器发出请求。</p><p id="02aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">@WithMockUser</code> <br/>提供了模仿某些用户的能力——在我们的例子中是一个经过认证的用户。</p><p id="2859" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe me mf mg mh b">FormLoginRequestBuilder</code> <br/>一个工具类，允许我们创建基于表单的登录请求。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="89c5" class="mo mp it bd mq mr nu mt mu mv nv mx my jz nw ka na kc nx kd nc kf ny kg ne nf bi translated">演示</h1><p id="bc93" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">要运行这个演示，你可以在<a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/1.basic-form-login" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到这个例子的完整代码</p><p id="98ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<code class="fe me mf mg mh b">Application.java</code>类并右键单击run。端口<code class="fe me mf mg mh b">8080</code>需要在您的机器上可用才能开始演示。如果不是，您可以使用以下命令在application.properties文件中更改此默认值:</p><pre class="kj kk kl km gt nz mh oa ob aw oc bi"><span id="9e6f" class="od mp it mh b gy oe of l og oh">server.port=8081</span></pre><p id="52c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将它设置为您想要的任何值。</p><p id="fd8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以观看这个短片:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi nm l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://youtu.be/aQ6QTQdCfeQ" rel="noopener ugc nofollow" target="_blank">演示</a></p></figure><p id="8e49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。接下来，我们将讨论spring security的用户角色，以及基于用户权限隐藏和显示网站内容的能力。</p><div class="oj ok gp gr ol om"><a rel="noopener  ugc nofollow" target="_blank" href="/spring-security-user-roles-and-thymeleaf-extras-c10113d4ad75"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">Spring Security —用户角色和百里香附加功能</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">基于spring用户角色显示和隐藏内容</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">better编程. pub</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa ks om"/></div></div></a></div></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="5549" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不是中等会员？支持我成为其中一员:</p><div class="oj ok gp gr ol om"><a href="https://mwhyte.dev/membership" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">通过我的推荐链接加入Medium迈克尔威特</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">mwhyte.dev</p></div></div><div class="ov l"><div class="pb l ox oy oz ov pa ks om"/></div></div></a></div></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="96ed" class="mo mp it bd mq mr nu mt mu mv nv mx my jz nw ka na kc nx kd nc kf ny kg ne nf bi translated">资源</h1><div class="oj ok gp gr ol om"><a href="https://github.com/mwhyte-dev/spring-security/tree/1.basic-form-login" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">GitHub-mwhyte-dev/spring-security at 1 . basic-form-log in</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">github.com</p></div></div><div class="ov l"><div class="pc l ox oy oz ov pa ks om"/></div></div></a></div><div class="oj ok gp gr ol om"><a href="https://spring.io/projects/spring-security" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">春天安全</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">提高您的Java代码水平，探索Spring能为您做什么。</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">spring.io</p></div></div></div></a></div><div class="oj ok gp gr ol om"><a href="https://www.thymeleaf.org/doc/articles/springsecurity.html" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">百里香+ Spring安全集成基础</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">你有没有换成百里香，但是你的登录和错误页面还在用JSP？在本文中，我们将了解如何…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">www.thymeleaf.org</p></div></div><div class="ov l"><div class="pd l ox oy oz ov pa ks om"/></div></div></a></div></div></div>    
</body>
</html>