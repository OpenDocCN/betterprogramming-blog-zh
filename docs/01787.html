<html>
<head>
<title>CI/CD for Docker Using GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作的Docker的CI/CD</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/github-actions-for-docker-eaf22bbcc879?source=collection_archive---------5-----------------------#2019-10-14">https://betterprogramming.pub/github-actions-for-docker-eaf22bbcc879?source=collection_archive---------5-----------------------#2019-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1909" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在项目中配置GitHub操作，以构建Docker映像并将其推送到Docker Hub。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2daa8f5fca58e95fdcd198ae58a5bf8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hs6Z3huLHFY_M6MYtuyBnQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图像鸣谢- Docker，Unsplash</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ky kz l"/></div></figure><p id="fbdd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae lw" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>，为GitHub上的项目添加CI/CD工作流的自动化工具，目前已有beta版。</p><p id="bfd1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">尽管离公开发布还有一个多月的时间，但在11月13日<strong class="lc iu">，</strong> GitHub marketplace已经看到了许多帮助几乎所有主要平台的CI/CD的行动。</p><p id="2b6d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="lx">注意:在本文中，我们将讨论在使用Docker的项目中集成CI/CD工作流的各个步骤。我们将关注使用docker的项目中的GitHub actions配置——Docker是什么及其用途的基础知识不在本文讨论范围之内。</em></p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="3fbe" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated"><strong class="ak">先决条件</strong></h1><p id="0cb9" class="pw-post-body-paragraph la lb it lc b ld mx ju lf lg my jx li lj mz ll lm ln na lp lq lr nb lt lu lv im bi translated">本教程假设您知道docker是如何工作的，并且有一个使用它的项目。确保项目的根文件夹中有<code class="fe nc nd ne nf b">Dockerfile</code> <em class="lx"> </em>。这里使用的示例项目是一个非常基本的项目，只有一个Python文件。完整的代码可以从<a class="ae lw" href="https://github.com/nabilnalakath/docker-githubaction" rel="noopener ugc nofollow" target="_blank"> github库下载。</a></p><p id="5f93" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你还没有注册，请在这里注册GitHub Actions公测<a class="ae lw" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="18f6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">首先，我们将介绍在项目中配置GitHub操作所需的基本步骤。这对于在任何平台上运行的所有项目都是常见的。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="a49a" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">1.创建项目并添加工作流文件</h1><p id="45cb" class="pw-post-body-paragraph la lb it lc b ld mx ju lf lg my jx li lj mz ll lm ln na lp lq lr nb lt lu lv im bi translated">第一个明显的步骤是创建一个GitHub项目，并将您的Flutter项目与资源库连接起来。</p><p id="9d10" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您已经成功完成了Actions beta的注册过程，您应该能够在pull requests的右侧看到您的项目的新的<em class="lx"> Actions </em> <strong class="lc iu"> </strong>选项卡<strong class="lc iu"> </strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/8ea220c3f2be5529257324da2e9b8c2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TUxEFkKXBJifbOmYoI1jGg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">存储库中的“操作”选项卡。</p></figure><p id="a7c7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">GitHub为许多最流行的平台提供了预定义的工作流，你也可以在可视化编辑器中定制或创建全新的工作流。</p><p id="ffc5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">不过在这个项目中，我们将采用手动方式，通过工作流命令创建一个YAML文件。</p><p id="21b7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在Pytho项目的根文件夹中，创建一个新文件夹<code class="fe nc nd ne nf b">.github</code>，并创建子文件夹<code class="fe nc nd ne nf b">workflows</code>。这是我们的工作流YAML文件将驻留的地方。</p><p id="3770" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">一个项目可以有多个工作流文件，如构建、发布等。，但是为了简单起见，我们将在这个项目中只使用一个文件。在工作流文件夹中创建一个名为<code class="fe nc nd ne nf b">main.yml</code>的最终文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/972fefb98d52b219fc001081b88a2efa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*po3XiWSCFw5CNa249MS_uw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建GitHub文件夹并添加工作流文件</p></figure></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="51e9" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">2.编写命令</h1><p id="9560" class="pw-post-body-paragraph la lb it lc b ld mx ju lf lg my jx li lj mz ll lm ln na lp lq lr nb lt lu lv im bi translated">现在我们必须在main.yml文件中添加一个命令来执行所需的操作。以下是<code class="fe nc nd ne nf b">main.yml.</code>的完整代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni kz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">main.yml</p></figure><p id="db8b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了更好地理解，我们将详细介绍每一行及其用法:</p><p id="9fef" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nc nd ne nf b">line 1</code>:您希望在“操作”选项卡中显示的工作流名称。</p><p id="bf6a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nc nd ne nf b">line 2</code>:当有人将代码推送到我们的回购协议时，我们希望触发我们的工作流。</p><p id="998f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nc nd ne nf b">lines 3–6</code>:我们正在定义一个在<code class="fe nc nd ne nf b">ubuntu-latest</code>上运行的作业。每个作业都在虚拟环境的一个新实例中运行。一个作业可以包含一个或多个<code class="fe nc nd ne nf b">steps</code>。</p><p id="2b23" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这是我们工作流程的第一步。我们使用一个名为<a class="ae lw" href="https://github.com/actions/checkout" rel="noopener ugc nofollow" target="_blank"><em class="lx">check out</em></a><em class="lx">的GitHub动作从我们的存储库中提取源代码。</em>此操作将您的存储库签出到<code class="fe nc nd ne nf b">$GITHUB_WORKSPACE</code>，以便您的工作流可以访问存储库的内容。</p><p id="b026" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nc nd ne nf b">lines 8–9</code>:这里我们使用GitHub动作<a class="ae lw" href="https://github.com/marketplace/actions/publish-docker" rel="noopener ugc nofollow" target="_blank"> <em class="lx">发布docker </em> </a>，它构建一个docker映像并将其推送到docker hub。</p><p id="2edf" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nc nd ne nf b">lines 8–9</code>:这里我们使用GitHub动作<a class="ae lw" href="https://github.com/marketplace/actions/publish-docker" rel="noopener ugc nofollow" target="_blank"><em class="lx">publish docker</em></a><em class="lx">，</em>构建docker映像并推送到docker hub。</p><p id="4545" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe nc nd ne nf b">lines 8–9</code>:这里我们定义了推送到docker hub所需的参数:</p><ul class=""><li id="ad80" class="nj nk it lc b ld le lg lh lj nl ln nm lr nn lv no np nq nr bi translated"><strong class="lc iu"> name </strong>是您希望推送至docker hub的映像或存储库的名称。</li><li id="ebca" class="nj nk it lc b ld ns lg nt lj nu ln nv lr nw lv no np nq nr bi translated"><strong class="lc iu">用户名</strong>注册中心的登录用户名(docker hub用户名)。</li><li id="844e" class="nj nk it lc b ld ns lg nt lj nu ln nv lr nw lv no np nq nr bi translated"><strong class="lc iu">密码</strong>注册表的登录密码(docker hub密码)。</li></ul></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="ff35" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">3.添加密钥</h1><p id="f23c" class="pw-post-body-paragraph la lb it lc b ld mx ju lf lg my jx li lj mz ll lm ln na lp lq lr nb lt lu lv im bi translated">你可能想知道:我们不能在yml文件中直接提到用户名和密码，因为这对安全非常不利。</p><p id="ec6d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">因此，我们将这些凭证添加到我们项目的秘密中。</p><p id="834f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要添加它，请转到位于<code class="fe nc nd ne nf b">&lt;repo url&gt;/settings/secrets</code>的项目的存储库设置。在<em class="lx">机密</em>选项卡中，从您的工作流文件中添加同名的机密密钥(<code class="fe nc nd ne nf b"><em class="lx">DOCKER_USERNAME</em></code>和<code class="fe nc nd ne nf b"><em class="lx">DOCKER_PASSWORD</em></code>)并粘贴值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/c8f0cfa0028052ff27b188d8ef045174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fPyXvcv1VaMPSzpsnl3Atw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在存储库设置中添加新的密钥。</p></figure><p id="9af8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">就是这样——只需提交您的代码并推送它。这将触发docker构建并自动推送图像—根据您的项目大小，在几分钟内即可完成。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="e228" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">4.检查工作流执行和图像</h1><p id="c099" class="pw-post-body-paragraph la lb it lc b ld mx ju lf lg my jx li lj mz ll lm ln na lp lq lr nb lt lu lv im bi translated">一旦您推送了代码，您可以通过转到<code class="fe nc nd ne nf b">&lt;repo URL&gt;/actions</code>来检查工作流的执行情况，并通过转到<code class="fe nc nd ne nf b"><a class="ae lw" href="https://cloud.docker.com/repository/" rel="noopener ugc nofollow" target="_blank">https://cloud.docker.com/repository/</a></code>来查看图像</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/b828aa1925fc6da6280925a605a0b63c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WMZtn-vVGpEpJXKvO_ZGlA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为推送事件执行的工作流命令</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/61ff8c23ee3eb340dbb0acb4da86bbb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8pfAxPi5AzpmC0YAPrJ1KQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Docker hub上从GitHub推送的docker图片。</p></figure></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><p id="3398" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">就是这样！</p><p id="61ff" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我正在计划另一篇关于将Docker图像直接推送到实时web项目中以更新它们的文章。当我完成的时候，我会更新这里的链接。</p><p id="fc77" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">同时，如果你是docker的新手，可以去看看playwithdocker的<a class="ae lw" href="https://labs.play-with-docker.com/" rel="noopener ugc nofollow" target="_blank"><em class="lx"/></a><em class="lx">，</em>网站，它会给你一个在线的<em class="lx"> </em>游乐场来探索docker，还有<a class="ae lw" href="http://dockerlabs.collabnix.com/" rel="noopener ugc nofollow" target="_blank">http://dockerlabs.collabnix.com/</a>的各种教程。</p></div></div>    
</body>
</html>