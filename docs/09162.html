<html>
<head>
<title>Stop Committing Sensitive Data to Your Git Repository</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止向您的Git存储库提交敏感数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/stop-committing-sensitive-data-to-your-git-repository-d2f7dd69232f?source=collection_archive---------9-----------------------#2021-07-21">https://betterprogramming.pub/stop-committing-sensitive-data-to-your-git-repository-d2f7dd69232f?source=collection_archive---------9-----------------------#2021-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d52c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何解决此问题的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d70085c1f4493b309ddf49b20ac3c862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zz0ztGgICt0z192EqInOWg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/es-es/@pixabay?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>在<a class="ae ky" href="https://www.pexels.com/es-es/foto/logotipo-de-seguridad-60504/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a>上拍摄。</p></figure><p id="47c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我很少在代码中看到密码或敏感信息。但是我经常看到的是提交给存储库的<code class="fe lv lw lx ly b">.properties</code>文件中的数据库访问密钥、SSH密钥、服务器证书密钥或其他资源访问密钥。</p><p id="4f01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将密码等敏感信息放入<code class="fe lv lw lx ly b">.properties</code>文件或代码本身的问题是，如果有人访问我们的存储库，他们将访问我们的资源。例如，我们确实可以通过IP地址来限制访问，但是最好从一开始就做好事情。</p><p id="ce1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能没有注意到，从一开始就有一个文件，其中包含您的应用程序的属性以及对数据库或其他资源的访问数据。</p><p id="4651" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，从您的<code class="fe lv lw lx ly b">.properties</code>文件中删除敏感信息并再次提交给Git是不够的，因为Git保留了该文件的历史记录，并且该信息仍然在以前的版本中。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="7183" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">解决这个烂摊子</h1><p id="f182" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">一旦我们意识到我们搞砸了，并且我们的密钥遍布Git历史，我们只能以最好的方式删除这些密钥。</p><p id="db65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直到不久前，做这件事还是相当乏味的。要重写Git历史，您必须使用命令<code class="fe lv lw lx ly b"><a class="ae ky" href="https://git-scm.com/docs/git-filter-branch" rel="noopener ugc nofollow" target="_blank">git filter-branch</a></code>，它为您更改的现有提交和任何相关提交更改sha。这样做很痛苦。</p><p id="23c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种更简单快捷的方法是使用由开源社区构建和维护的开源<a class="ae ky" href="https://rtyley.github.io/bfg-repo-cleaner/" rel="noopener ugc nofollow" target="_blank"> BFG回购清理器</a>工具。</p><p id="81db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你应该做的第一件事是为你的回购创建一个备份，以防出现问题。什么都不会发生，但是…你永远不知道。</p><p id="60c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，我们已经创建了包含我们的回购的文件夹的副本，所以让我们继续。</p><p id="aa06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先从删除当前敏感信息开始。</p><p id="09d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，要删除包含敏感数据的文件，并保持最新提交不变，请执行以下操作:</p><ol class=""><li id="2540" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated">从GitHub 上的<a class="ae ky" href="https://rtyley.github.io/bfg-repo-cleaner/" rel="noopener ugc nofollow" target="_blank"> BFG回购清理器下载jar文件。</a></li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/7d3d410da4299a2ad5ca43ccca3aae84.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*YQtQaFflbI2HNHtE5Ctwag.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可执行的jar文件</p></figure><p id="0d2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.为了方便起见，将其复制到您的项目文件夹中。完成后，您可以删除它，以免将其上传到存储库。</p><p id="f5a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.从文件中删除敏感数据，如应用程序的数据库密码。</p><p id="3aa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.提交更改。</p><p id="0147" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.执行以下命令:</p><p id="0791" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nd">默认情况下，这个命令从所有Git历史(您所在的分支)中删除我们指定为参数的文件。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">执行该实用程序。</p></figure><p id="abee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.现在，您必须将您的更改强制推送至您的存储库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">强制推送</p></figure><p id="9105" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7.如果您现在检查文件在Git历史中的更改，您将会看到您的密码已经消失，因为Git历史中唯一保留的记录是您最后一次提交的内容。</p><p id="f62c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">8.将应用程序配置为从例如外部文件中读取这些属性。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="56c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:默认情况下，BFG实用程序不会修改主分支上最新提交的内容，即使它会清除之前的所有提交。</p><p id="d682" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做是为了避免中断应用程序部署，因为最后一次提交是我们在运行应用程序时使用的。因此，该工具不会通过回购历史将其删除。</p><p id="8b0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总之，我们遵循了以下步骤:</p><ul class=""><li id="43e1" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nq nk nl nm bi translated">我们从文件中删除了敏感信息，然后在没有该信息的情况下提交。</li><li id="c4ea" class="ne nf it lb b lc nr lf ns li nt lm nu lq nv lu nq nk nl nm bi translated">我们清理了Git历史，将这些属性和敏感数据提取到Git存储库外部的一个外部文件中，最后配置应用程序来使用它们。例如，您可以将属性文件存储在部署应用程序的机器上，但是要记住保护这个文件。</li></ul></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="62d3" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="b0e1" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">犯这个错误是经常发生的事情。很容易忘记将项目属性保存在项目本身中，然后提交给g it的风险。</p><p id="3d88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有其他方法可以解决这个问题，比如使用Git命令<code class="fe lv lw lx ly b">git filter-branch</code>，但是这要繁琐复杂得多。在本文中，我展示了使用BFG工具解决这个问题是多么容易。</p><p id="8ac2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不管怎样，如果你想在你的项目中包含敏感信息的文件，你可以通过使用<code class="fe lv lw lx ly b"><a class="ae ky" href="https://git-scm.com/docs/gitignore" rel="noopener ugc nofollow" target="_blank">gitignore</a></code>命令忽略它，永远不要把这种类型的文件提交给Git repo(例如，我们可以忽略所有带有<code class="fe lv lw lx ly b">.properties</code>扩展名的文件)。</p><p id="922f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你觉得这有用！</p></div></div>    
</body>
</html>