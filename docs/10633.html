<html>
<head>
<title>A Look at CurrentValueSubject in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的CurrentValueSubject概览</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/currentvaluesubject-in-swift-16dabeed575?source=collection_archive---------10-----------------------#2022-01-19">https://betterprogramming.pub/currentvaluesubject-in-swift-16dabeed575?source=collection_archive---------10-----------------------#2022-01-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c00e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在iOS中使用联合发布器</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9339896587a12aa9e026028da97cc316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTypUJC7ZITLh8oVxSt2sA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@uxindo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">印尼UX</a>在<a class="ae kv" href="https://unsplash.com/s/photos/user-experience?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="90de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">苹果宣布新的两个发布者采用Combine框架分别是<code class="fe ls lt lu lv b">CurrentValueSubject</code>、<code class="fe ls lt lu lv b">PassthroughSubject</code>。</p><p id="f60f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些也称为定制发布者，iOS开发人员可以创建并使用它们来绑定、订阅原始-非原始类型。</p><p id="6896" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个故事中，我将用一个例子来解释什么是<code class="fe ls lt lu lv b">CurrentValueSubject</code>。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="7e2e" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">CurrentValueSubject</h1><p id="c6f5" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">它是一个具有初始值的自定义发布者。</p><p id="8faf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们设想一个屏幕，它将根据来自web服务的即将到来的数据显示一个空视图或非空列表。个人认为，在iOS项目中很难管理这些状态。</p><p id="960b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，由于国家驱动的发展<strong class="ky ir">，</strong>这比以前容易多了。让我们看看<code class="fe ls lt lu lv b">CurrentValueSubject</code> <strong class="ky ir"> </strong>如何<strong class="ky ir"> </strong>防止可能的国家驱动开发错误。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><p id="6aee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将定义一个名为<code class="fe ls lt lu lv b">Serializable</code>的协议，它在SwiftUI列表视图中既可识别又可解码。</p><p id="fff6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个定义之后，让我们定义一个名为<code class="fe ls lt lu lv b">Model</code>的结构，它符合<code class="fe ls lt lu lv b">Serializable</code>和<code class="fe ls lt lu lv b">ServiceResponseState</code>以满足状态驱动的开发。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="0d03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们创建一个满足定制发布者及其功能的视图模型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="f349" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，在<code class="fe ls lt lu lv b">listDidLoad()</code> <strong class="ky ir">中，</strong> <code class="fe ls lt lu lv b">send()</code> <strong class="ky ir"> </strong>因为<code class="fe ls lt lu lv b">CurrentValueSubject</code> <strong class="ky ir">的整理订阅事件被调用了两次。</strong></p><p id="acc9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，正如我们在下面的控制台中看到的，虽然在调用<code class="fe ls lt lu lv b">send(.finished)</code>之后调用了<code class="fe ls lt lu lv b">resetState()</code> <strong class="ky ir"> </strong>，但是在sink closure中，并没有因为订阅终止而发生任何变化。</p><p id="fcb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可以防止在这种状态管理过程中出现任何错误。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/a58964c334b2e177e8f831d75049b218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fCgWhZDhm6HxrQ_6-FBv1A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">安慰</p></figure><p id="4d72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在Swift编程语言的组合框架中看到了<code class="fe ls lt lu lv b">CurrentValueSubject</code>的力量。我猜，使用这种棘手的东西是惊人的。</p></div></div>    
</body>
</html>