# 用 React 挂钩清除 API 调用

> 原文：<https://betterprogramming.pub/clean-api-call-with-react-hooks-3bd6438a375a>

## 用简洁、干净和可重用的代码使 API 调用在整个应用程序中更加一致

![](img/3403fba8e6bd3c11620e7297f9ed8bc1.png)

照片由[胡安乔·哈拉米略](https://unsplash.com/@juanjodev02?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

调用 API 是任何现代 web 应用程序中最常见的事情。当谈到与 API 对话时，大多数时候我们需要做许多重复的事情，比如从 API 调用中获取数据，处理成功或错误的情况，等等。

当调用成百上千个 API 调用时，我们总是不得不做那些繁琐的任务。我们可以通过对这些准系统 API 调用进行更高层次的抽象来有效地处理这些事情，而在一些小型应用程序中，有时我们甚至不在乎。

*当我们开始在现有功能的基础上添加新功能，而没有以有效和可重用的方式处理 API 调用时，问题就来了。在这种情况下，对于所有这些 API 调用相关的重复，我们最终会在整个应用程序中产生大量重复的代码。*

在 React 中，我们有不同的调用 API 的方法。现在我们大多使用反应钩。有了 React 钩子，不管应用程序的规模有多大，都可以在整个应用程序中以一种非常干净和一致的方式处理 API 调用。因此，让我们看看如何使用 React 钩子为一个简单的 web 应用程序创建一个干净的、可重用的 API 调用层。

我为这个博客使用了一个代码沙箱，你可以在这里得到。

从 JsonPlaceholder 获取帖子数据

我知道上面的例子不是最好的代码，但至少它是有效的代码。我以后会努力改进的。现在，我们可以只关注调用 API 的最基本的事情。

在这里，您可以尝试从 [JsonPlaceholer](https://jsonplaceholder.typicode.com/) 获取帖子数据。这些是调用 API 最常见的步骤，比如请求数据、处理加载、成功和错误情况。

如果我们试图从同一个组件调用另一个 API，那会是什么样子呢？让我们看看。

从 JsonPlaceholder 获取帖子和评论数据

现在它变得疯狂了！为了调用两个简单的 API，我们做了大量的重复工作。从顶层来看，组件什么也不做，只是发出两个 GET 请求，并处理成功和错误情况。对于每个请求，它保持三种状态，如果我们有更多的调用，这三种状态会定期增加。

让我们进行重构，以减少重复，提高代码的可重用性。

# 步骤 1:为冗余的 API 请求代码创建一个挂钩

到目前为止，我们所做的大部分重复都是关于请求数据、处理异步事务、处理错误、成功和加载状态。把这些东西封装在一个钩子里怎么样？

我们在`handleComments`和`handlePosts`中做的唯一独特的事情是调用不同的端点。其余的事情都差不多。所以我们可以创建一个钩子来为我们处理多余的工作，从外部我们会让它知道调用哪个 API。

在这里，这个`request`功能与我们在`handlePosts`和`handleComments`上所做的相同。唯一的区别是，它调用了一个异步函数`apiFunc`，我们将把它作为这个钩子的参数提供。这个`apiFunc`是我们需要的所有 API 调用中唯一独立的东西。

使用钩子，让我们改变我们在`App`组件中的旧代码，就像这样:

用钩子调用帖子和评论 API

现在的代码怎么样？没有任何重复和重复的 API 调用处理的东西不是很美吗？

让我们从当前代码开始继续我们的旅程。我们可以让`App`组件更优雅。现在它知道了 API 调用的底层库的很多细节。它不应该知道这些。所以，这是下一步…

# 步骤 2:一个组件应该只承担一项责任

我们的 App 组件太了解 API 调用机制了。它的职责应该只是请求数据。如何在幕后请求数据，it 不应该关心这个。

我们将从`App`组件中提取与 API 客户端相关的代码。此外，我们将根据 API 资源对所有与 API 请求相关的代码进行分组。这是我们的 API 客户端:

API 客户端

注释资源的所有 API 调用将位于以下文件中:

注释资源的详细信息

posts 资源的所有 API 调用都放在以下文件中:

发布资源的详细信息

最后，`App`组件如下所示:

具有两个 API 调用的应用程序组件

现在它不知道 API 是如何被调用的。明天，如果我们想将 API 调用库从`axios`更改为`fetch`或其他，我们的`App`组件代码不会受到影响。我们可以改变代码形式`client.js`这就是抽象的美妙之处。

除了 API 调用的抽象之外，`App` component 不适合显示帖子和评论的列表。它是一个高级组件。它不应该处理这种低级的数据插值的事情。

所以我们应该把这个数据显示相关的东西移到另一个底层组件。在这里，我将它们直接放在应用程序组件中，只是为了演示的目的，而不是为了分散与组件组合相关的事情的注意力。

clean-API-call-with-react-hooks

# 最后的想法

React 库提供了基于应用需求使用任何第三方库的灵活性。因为它没有任何预定义的架构，所以不同的团队/开发人员采用不同的方法来开发 React 应用程序。没有好坏之分。我们根据我们的需求/选择来选择开发实践。有一件事是无法选择的，那就是编写干净且可维护的代码。