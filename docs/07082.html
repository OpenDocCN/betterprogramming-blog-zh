<html>
<head>
<title>Midnight Hack 4: Automating Spotify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">午夜黑客4:自动化Spotify</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/midnight-hack-episode-4-automating-spotify-mapping-spotify-functions-to-keyboard-shortcuts-3ea5302bb2cb?source=collection_archive---------9-----------------------#2020-12-04">https://betterprogramming.pub/midnight-hack-episode-4-automating-spotify-mapping-spotify-functions-to-keyboard-shortcuts-3ea5302bb2cb?source=collection_archive---------9-----------------------#2020-12-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5eec" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将Spotify功能映射到键盘快捷键</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/efa5b1e01da7f324881b8f688af02ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OtaS_CK6UPLMtuaOoCs7Ag.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:作者via <a class="ae kv" href="https://www.spotify.com/in/" rel="noopener ugc nofollow" target="_blank"> Spotify </a>和<a class="ae kv" href="https://pixabay.com/illustrations/hacker-hack-security-cyber-4685929/" rel="noopener ugc nofollow" target="_blank">黑客Hack Security——pix abay上的免费图片</a></p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="8ff7" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">TLDR；</h1><p id="b6dd" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">如果你不想通读整篇文章，这里是我们正在建设的。我们正在建立一个自动化管道，根据按下的快捷键，自动将当前播放的Spotify曲目保存到用户播放列表中。执行是独立于设备的，这意味着您可以在手机上播放曲目，在电脑上按下Alt+1，您可以将曲目添加到播放列表1，或者使用Alt+2，您可以将其添加到播放列表2。</p><p id="6925" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">执行也是一个后台进程，所以它不会影响您的活动工作窗口或您在计算机上正在做的任何工作。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="9423" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">好了，我们开始吧。</p><p id="0e26" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我为什么需要这个？我做了一些基础工作。当你在工作时，为了切换到Spotify，点击歌曲上的三个点，找到我想添加到的播放列表，并将其保存到一个播放列表，这花了我大约13秒。让我们把它四舍五入到十秒钟，因为我是一只树懒。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/452d031e28c339907a5f6d5332dd13fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ke7R7fwaTfdjzmdMkbJ7YA.png"/></div></div></figure><p id="4501" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">对于我的播放列表中所有的912首歌曲，总共有2.53个小时我可以用来思考我在做什么。</p><p id="2e3b" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">此外，切换应用程序来完成这项任务有点不方便。所以让我们来自动化这个。我们是这样做的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/a56297a2c10a623646dbe0bb0f6a99ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cuQVlhCvfp29xRhuBCKsog.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">开发流程</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="a518" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">1.获取Spotify API密钥</h1><p id="3c2d" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">转到<a class="ae kv" href="https://developer.spotify.com/dashboard/applications" rel="noopener ugc nofollow" target="_blank">https://developer.spotify.com/dashboard/applications</a>并创建一个新应用程序。保存<code class="fe my mz na nb b">client_id</code>和<code class="fe my mz na nb b">client_secret</code>。</p><p id="7388" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">转到“编辑设置”并添加一个重定向网址，如<a class="ae kv" href="https://example.com/callback" rel="noopener ugc nofollow" target="_blank">https://example.com/callback</a>。这将用于OAuth和生成用户令牌。</p><p id="65d5" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">因为我们只需要生成一次用户令牌，所以不需要一个活动的服务器来捕获重定向的URL。我们可以复制重定向的URL并创建一个用户令牌。下一步会有更多的介绍。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/a315ea11e81b3b36991966497b9ebbe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-2hOeyWhX-6Z5TZGMGczw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕上显示程序运行的图片</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="e499" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">2.生成热键-播放列表映射配置</h1><p id="bec0" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">现在我们有了<code class="fe my mz na nb b">client_id</code>和<code class="fe my mz na nb b">client_secret</code>，我们可以得到一个用户令牌、一个用户播放列表列表和播放列表id。我使用了一个名为<a class="ae kv" href="https://spotipy.readthedocs.io/en/2.16.1/" rel="noopener ugc nofollow" target="_blank"> spotipy </a> <strong class="lx ir"> <em class="nd">的Spotify Python库。</em> </strong></p><p id="8853" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我创建了一个小脚本来验证用户，列出用户播放列表，并提示用户选择他们想要将热键映射到的播放列表。我用过Alt+num，但是可以是你想要的任何东西。</p><p id="74df" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">同样的要点如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="9692" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">该脚本生成一个配置文件<code class="fe my mz na nb b">playlist_mapping.config</code> <strong class="lx ir">，</strong>，用于在保存曲目时查找热键播放列表。</p><p id="87d5" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">下面是该脚本实际运行的样子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/bd0b7c552093bcca567a15eaf4a475f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*ThklxIY6yYt1fEgjfm2r1A.gif"/></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="2616" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">3.自动热键脚本</h1><p id="31fe" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">为了监控热键触发器，我们需要一个输入监控服务。自动热键是一个非常好的工具。一旦自动热键脚本运行，它会监控热键并触发AHK脚本中指定的适当操作。另外，你也可以在启动时添加AHK脚本，这样你就不必每次启动电脑时都运行AHK脚本。</p><p id="4055" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">有多种方法可以做到这一点，但我使用了<code class="fe my mz na nb b">Run</code> <strong class="lx ir"> <em class="nd"> </em> </strong>命令，它运行特定目录中的可执行文件或程序。</p><p id="c275" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">以下是cmd格式:</p><p id="2df3" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"><hotkey>:【运行】，<command_to_execute>，<dir_to_execute_in/></command_to_execute></hotkey></p><p id="731f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这是我的剧本:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a937" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"><code class="fe my mz na nb b">!</code>代表<em class="nd"> Alt </em>。所以，当我按Alt+1时，AHK脚本触发了<code class="fe my mz na nb b">D:\_DEV_\Python\spotify_auto_playlist</code>目录中的<code class="fe my mz na nb b">python3w spotify_api.py 1</code> <strong class="lx ir"> </strong>命令。</p><p id="2930" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">注意，我用的是<code class="fe my mz na nb b">python3w</code> <strong class="lx ir"> </strong>而不是<code class="fe my mz na nb b">python3</code>。<code class="fe my mz na nb b">python3w</code>在后台运行脚本。</p><p id="347c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">保存脚本后，右键单击并运行服务。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="e96a" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">4.将当前曲目保存到播放列表的Python脚本</h1><p id="d5db" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">这个脚本从AHK脚本接收一个位置参数，用来标识热键。通过Spotify API使用我们在第一步中生成的热键-播放列表查找配置和当前曲目ID，我们可以将当前曲目添加到用户之前定义的任何播放列表中。</p><p id="8e57" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">剧本是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="ecff" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">就是这样。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="478d" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">这是实际使用的产品</h1><p id="21c2" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">在左侧，我们有应用程序日志，它显示按下的热键和关于哪个曲目被保存到哪个播放列表的信息。在右边，我们有Spotify桌面播放器。</p><p id="0d6b" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这里展示的应用日志和Spotify播放器只是为了演示。这首歌可以在你的手机上播放，如果你按Alt+1，它会将当前播放的曲目保存到用户在第一个槽中定义的播放列表中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh nf l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Spotify播放列表自动化演示的屏幕截图</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="7d2d" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">如果您有任何建议或意见，请写在下面。</p></div></div>    
</body>
</html>