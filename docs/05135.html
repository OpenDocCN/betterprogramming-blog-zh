<html>
<head>
<title>Exploring the Firebase Remote Config</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Firebase远程配置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exploring-firebase-remote-config-51f9cf88a8d0?source=collection_archive---------1-----------------------#2020-06-14">https://betterprogramming.pub/exploring-firebase-remote-config-51f9cf88a8d0?source=collection_archive---------1-----------------------#2020-06-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6ac0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">基于存储在Firebase中的远程配置更改应用程序的行为</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f12ec7df039bbcfb9f2981c3128d00c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nODI3cUV9-zHjDERNzYGug.png"/></div></div></figure><h1 id="a73b" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">介绍</h1><p id="823f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><a class="ae mi" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase </a>是一个移动和网络应用开发平台，由Firebase，Inc .于2011年开发，后于2014年被谷歌收购。截至2020年3月，Firebase平台拥有19款产品，被超过150万个app使用。如今，Firebase对于Android开发者来说已经变得非常必要。</p><p id="90c8" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">谷歌的Firebase有很多功能可以帮助构建更好的应用程序——通过监控和提高应用程序质量等。</p><p id="3b92" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">它在一个屋檐下有许多功能，如远程配置、崩溃分析、分析、云消息等。</p><p id="2479" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">Firebase的每一个元素都非常容易学习，也非常重要。对于想要托管自己的网站以展示其产品组合或其他任何东西的小开发人员来说，<a class="ae mi" href="https://firebase.google.com/products/hosting" rel="noopener ugc nofollow" target="_blank"> Firebase托管</a> <strong class="lo iu"> </strong>是一种功能，通过它，您可以在遵循几个步骤后的几分钟内轻松托管一个网站，并且最初是免费的。看看我两年前在Firebase上主持的<a class="ae mi" href="https://androidappz.co.in/" rel="noopener ugc nofollow" target="_blank">作品集</a>。</p><p id="6e6e" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">现在让我们深入了解一下<em class="mo">远程配置的概念。</em></p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="d34b" class="ku kv it bd kw kx mw kz la lb mx ld le jz my ka lg kc mz kd li kf na kg lk ll bi translated">我们为什么需要它？</h1><p id="c469" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">Firebase Remote Config是一项云服务，我们可以通过它改变我们应用程序的行为和外观<strong class="lo iu"> </strong>，而无需发布应用程序更新，没有任何成本，并且每日活跃用户数量不限。它也被推荐用于应用程序更新检查的使用。</p><p id="6f42" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在使用远程配置时，我们创建应用内默认值来控制应用的行为和外观。稍后，我们可以使用Firebase控制台来更新这些值，并使用远程Config REST API来覆盖所有应用程序用户或部分用户的应用程序内默认值。</p><p id="acba" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">简单来说，在服务器端，我们可以维护所需值的键值对，而在客户端，当我们处理Rest APIs时，我们可以获取这些值，并使用它们来更新应用程序或更改应用程序的外观或行为。</p><p id="5c4f" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">我们的应用程序控制何时应用更新，它可以频繁地检查更新并应用它们，对性能的影响可以忽略不计。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="13b9" class="ku kv it bd kw kx mw kz la lb mx ld le jz my ka lg kc mz kd li kf na kg lk ll bi translated">它是如何工作的？</h1><p id="9db6" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">远程配置包括一个客户端库，可以处理重要的任务，如获取参数值并缓存它们，同时还可以让我们控制何时激活或获取新值<em class="mo"> </em>，以便它们影响我们应用程序的用户体验。这让我们可以通过控制任何更改的时间来保护我们的应用体验。</p><p id="cbaf" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">远程配置客户端库<code class="fe nb nc nd ne b">get</code>方法为参数值提供了单一的访问点。我们的应用程序使用与获取应用程序内默认值相同的逻辑来获取服务器端值，因此我们可以向应用程序添加远程配置功能，而无需编写大量代码。</p><p id="bae4" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">要覆盖应用程序内的默认值，可以使用Firebase控制台或远程配置后端API来创建与应用程序中使用的参数同名的参数。</p><p id="c457" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">对于每个参数，您可以设置一个服务器端默认值来覆盖应用程序内默认值，也可以创建条件值来覆盖满足特定条件的应用程序实例的应用程序内默认值。下图显示了参数值在远程配置后端和我们的应用程序中的优先级:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/a840524a182351a9bd0f122de9c8c003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*UAZaCJbqF7UuidReon1osg.png"/></div></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="ac0a" class="ku kv it bd kw kx mw kz la lb mx ld le jz my ka lg kc mz kd li kf na kg lk ll bi translated">如何使用它</h1><p id="b97d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">需要遵循四个简单的步骤:</p><ul class=""><li id="e330" class="ng nh it lo b lp mj ls mk lv ni lz nj md nk mh nl nm nn no bi translated">添加必需的<strong class="lo iu">依赖项</strong></li><li id="782b" class="ng nh it lo b lp np ls nq lv nr lz ns md nt mh nl nm nn no bi translated"><strong class="lo iu">在定义我们需求的应用内设置默认参数值</strong></li><li id="f433" class="ng nh it lo b lp np ls nq lv nr lz ns md nt mh nl nm nn no bi translated"><strong class="lo iu">添加和更新</strong>服务器端默认和条件参数值</li><li id="beb7" class="ng nh it lo b lp np ls nq lv nr lz ns md nt mh nl nm nn no bi translated">添加逻辑到<strong class="lo iu">获取、激活并获取参数值</strong></li></ul><p id="00fe" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">让我们通过一个用例来更好地理解这一点，比如更改欢迎屏幕图像。假设有一个应用程序在闪屏上显示一个图像，几天后，我想改变那个图像。在这里，我不需要发布应用程序更新。让我们看看如何使用远程配置来实现这一点。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="2f51" class="ku kv it bd kw kx mw kz la lb mx ld le jz my ka lg kc mz kd li kf na kg lk ll bi translated">履行</h1><h2 id="0e81" class="nu kv it bd kw nv nw dn la nx ny dp le lv nz oa lg lz ob oc li md od oe lk of bi translated"><strong class="ak">第一步</strong></h2><p id="3852" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">如果你还没有，<a class="ae mi" href="https://firebase.google.com/docs/android/setup" rel="noopener ugc nofollow" target="_blank">将Firebase添加到你的Android项目中</a>。</p><p id="1af4" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">然后让我们在应用程序级<code class="fe nb nc nd ne b">build.gradle</code> ( <code class="fe nb nc nd ne b">app/build.gradle</code>)中添加远程配置依赖。</p><pre class="kj kk kl km gt og ne oh oi aw oj bi"><span id="64e6" class="nu kv it ne b gy ok ol l om on">implementation 'com.google.firebase:firebase-config-ktx:19.1.4'<br/>implementation 'com.google.firebase:firebase-analytics-ktx:17.4.3'</span></pre><p id="b10a" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">对于远程配置，Google Analytics需要将应用实例的<a class="ae mi" href="https://firebase.google.com/docs/remote-config/parameters#conditions_rules_and_conditional_values" rel="noopener ugc nofollow" target="_blank">有条件定向到用户属性、受众和Firebase预测。确保在你的项目中启用谷歌分析。</a></p><h2 id="bbef" class="nu kv it bd kw nv nw dn la nx ny dp le lv nz oa lg lz ob oc li md od oe lk of bi translated"><strong class="ak">第二步</strong></h2><p id="c82e" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">设置应用内默认参数值。我们可以在远程配置对象中设置应用程序内的默认参数值，这样我们的应用程序在连接到远程配置后端之前就可以正常运行，因此如果在后端没有设置默认值，默认值也是可用的。</p><ol class=""><li id="7e2a" class="ng nh it lo b lp mj ls mk lv ni lz nj md nk mh oo nm nn no bi translated">使用存储在应用程序的<code class="fe nb nc nd ne b">res/xml</code>文件夹中的<code class="fe nb nc nd ne b">Map</code>对象或<strong class="lo iu"> </strong> <a class="ae mi" href="https://developer.android.com/guide/topics/resources/providing-resources.html" rel="noopener ugc nofollow" target="_blank"> XML资源文件</a>定义一组参数名称和默认参数值。远程配置快速启动示例应用程序使用一个<a class="ae mi" href="https://github.com/firebase/quickstart-android/blob/master/config/app/src/main/res/xml/remote_config_defaults.xml" rel="noopener ugc nofollow" target="_blank"> XML文件</a>来定义默认的参数名称和值。</li><li id="f29a" class="ng nh it lo b lp np ls nq lv nr lz ns md nt mh oo nm nn no bi translated">使用<code class="fe nb nc nd ne b"><a class="ae mi" href="https://firebase.google.com/docs/reference/android/com/google/firebase/remoteconfig/FirebaseRemoteConfig#setDefaultsAsync(int)" rel="noopener ugc nofollow" target="_blank">setDefaultsAsync(int)</a></code>将这些值添加到<code class="fe nb nc nd ne b">remoteConfig</code>对象中，如图所示:</li></ol><pre class="kj kk kl km gt og ne oh oi aw oj bi"><span id="f377" class="nu kv it ne b gy ok ol l om on">val remoteConfig = Firebase.remoteConfig<br/>remoteConfig.setDefaultsAsync(R.xml.remote_config_defaults)</span></pre><p id="b2c2" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在我们的例子中，右击<code class="fe nb nc nd ne b">res</code> <strong class="lo iu"> </strong>文件夹，如果不存在就添加<code class="fe nb nc nd ne b">xml</code>文件夹。然后，添加一个属性名为<code class="fe nb nc nd ne b">welcome_image</code>的XML文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/24fce5b14f533c3b0b42dfb4461de868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6QmEtsX3HKKfQUtHWvgTA.png"/></div></div></figure><p id="3fca" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">这里，根据需求，我们可以添加任意数量的参数。</p><h2 id="b6c2" class="nu kv it bd kw nv nw dn la nx ny dp le lv nz oa lg lz ob oc li md od oe lk of bi translated"><strong class="ak">第三步</strong></h2><p id="aac1" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在远程配置后端设置参数值。现在是时候添加和更新我们的价值观了。从<a class="ae mi" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>中，打开您的项目，然后从左侧菜单的<strong class="lo iu"> </strong>增长<strong class="lo iu"> </strong>部分中选择远程配置<strong class="lo iu"> </strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/0053d9acdd66fe86529f3622c49f2032.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*IKkXyZ2mOVeprveSWJAOBA.png"/></div></figure><p id="509a" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">我们必须填写“参数键”和“默认值”最后，不要忘记点击“发布更改”以使我们的更改生效。使用与应用内<code class="fe nb nc nd ne b">welcome_image</code>相同的键添加参数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/cd81dce0f113ac2c0a160d28d004ebba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*khGvQO5ExEWuBPMtBoJS6w.png"/></div></div></figure><p id="c278" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">接下来，点击“添加参数”你会看到下面的屏幕。点击右上角<strong class="lo iu"> </strong>的“发布更改”按钮，使您的更改生效。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/74478bf7df2b09f6211830eafee0bbab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0QD15tNei73Cxwfj_2Q_Q.png"/></div></div></figure><p id="54a1" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">一旦成功添加，它将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/272bd727ce59f42842fe930aeb8f3487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJr0E_gqjGmZ_LjztVzbdA.png"/></div></div></figure><p id="fa2d" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">现在我们完成了服务器端的工作。</p><h2 id="adaf" class="nu kv it bd kw nv nw dn la nx ny dp le lv nz oa lg lz ob oc li md od oe lk of bi translated">奖金</h2><p id="4c93" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们可以添加依赖于平台的参数、参数的格式等。要对现有远程配置参数执行百分比卷展栏，请向参数添加一个新条件，该条件包含“随机百分位数的用户”条件，且%值设置为10%:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/390d92fd3d171a0344e8689f54ebae8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MaHLssrs41KBm5-h_SJglQ.png"/></div></div></figure><p id="f5d6" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">点击"<a class="ae mi" href="https://firebase.google.com/docs/remote-config/use-cases" rel="noopener ugc nofollow" target="_blank">查看更多关于如何为不同用例添加不同参数的选项，我可以用远程配置做些什么？</a>”</p><h2 id="9a45" class="nu kv it bd kw nv nw dn la nx ny dp le lv nz oa lg lz ob oc li md od oe lk of bi translated"><strong class="ak">第四步:</strong></h2><p id="3f5e" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">从应用程序端，从远程配置中获取最新的值，并更新应用程序的外观。这可以通过使用一个<code class="fe nb nc nd ne b">singleton</code>类或者在应用程序类中来实现</p><ol class=""><li id="2b6a" class="ng nh it lo b lp mj ls mk lv ni lz nj md nk mh oo nm nn no bi translated">要从远程配置后端获取参数值，调用<code class="fe nb nc nd ne b"><a class="ae mi" href="https://firebase.google.com/docs/reference/android/com/google/firebase/remoteconfig/FirebaseRemoteConfig#fetch()" rel="noopener ugc nofollow" target="_blank">fetch()</a></code>方法。您在后端设置的任何值都被获取并存储在远程配置对象中。</li><li id="ca31" class="ng nh it lo b lp np ls nq lv nr lz ns md nt mh oo nm nn no bi translated">要使获取的参数值对您的应用程序可用，请调用<code class="fe nb nc nd ne b"><a class="ae mi" href="https://firebase.google.com/docs/reference/android/com/google/firebase/remoteconfig/FirebaseRemoteConfig#activate()" rel="noopener ugc nofollow" target="_blank">activate()</a></code>方法。</li><li id="135f" class="ng nh it lo b lp np ls nq lv nr lz ns md nt mh oo nm nn no bi translated">如果您想在一次调用中获取并激活值，您可以使用一个<code class="fe nb nc nd ne b">fetchAndActivate()</code>请求从远程配置后端获取值，并使它们对应用程序可用:</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="4e73" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">将来，如果我们想更改欢迎屏幕上的图像，我们只需更改Firebase控制台中的URL。你还可以做更多的事情，所以在<a class="ae mi" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase </a>网站上查看事情的完整列表。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="b9cd" class="ku kv it bd kw kx mw kz la lb mx ld le jz my ka lg kc mz kd li kf na kg lk ll bi translated">参考</h1><ul class=""><li id="6309" class="ng nh it lo b lp lq ls lt lv ox lz oy md oz mh nl nm nn no bi translated"><a class="ae mi" href="https://www.youtube.com/watch?v=XbNcQqoi_S8&amp;feature=emb_logo" rel="noopener ugc nofollow" target="_blank">“Android远程配置入门</a>”通过Firecasts</li><li id="57b5" class="ng nh it lo b lp np ls nq lv nr lz ns md nt mh nl nm nn no bi translated"><a class="ae mi" href="https://firebase.google.com/docs/remote-config/use-config-android" rel="noopener ugc nofollow" target="_blank">“Android上的Firebase远程配置入门”</a>通过Firebase文档</li></ul></div></div>    
</body>
</html>