<html>
<head>
<title>A Look at the New ‘Switch’ Expressions in Java 14</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">看看Java 14中新的“开关”表达式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-look-at-the-new-switch-expressions-in-java-14-ed209c802ba0?source=collection_archive---------0-----------------------#2020-03-07">https://betterprogramming.pub/a-look-at-the-new-switch-expressions-in-java-14-ed209c802ba0?source=collection_archive---------0-----------------------#2020-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d792" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">举了很多例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a8c194d35365da6cfafd2b8d6584892e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-Q-AdaKiUj3W7S7N"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@karim_manjra?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡里姆·曼吉拉</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f58a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Java 14准备在2020年3月17日发布。新版本的Java包含了一个有趣的Java语言更新:新的<code class="fe lv lw lx ly b">switch</code>表达式。让我们看看如何使用新的<code class="fe lv lw lx ly b">switch</code>表达式，它们提供了什么样的优势，以及什么可能会出错。最后，我们将解决一个关于<code class="fe lv lw lx ly b">switch</code>表达的棘手问题。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="f003" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">经典的“转换”语句</h1><p id="2cb3" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">Java中<code class="fe lv lw lx ly b">switch</code>语句的当前设计遵循C和C++等语言。它只作为一个语句工作，默认情况下支持失败语义。下面是一个带有枚举的经典<code class="fe lv lw lx ly b">switch</code>语句的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="24dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能已经注意到了上面示例中的许多case和break语句。这些语句引入了一些视觉噪声，使代码变得不必要地冗长。这种视觉噪音可能会掩盖错误，如遗漏break语句，这将意味着意外失败。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="70ec" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">新的“开关”表达式</h1><p id="2d6c" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">Java 14扩展了<code class="fe lv lw lx ly b">switch</code>,因此它既可以用作语句，也可以用作表达式。特别是，新的Java引入了以下内容:</p><ul class=""><li id="8b1c" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">一种新形式的<code class="fe lv lw lx ly b">switch</code>标签<code class="fe lv lw lx ly b">case ... -&gt;</code>，如果标签匹配，则只执行标签右边的代码。<code class="fe lv lw lx ly b">case ... -&gt;</code>标签右边的代码可能是一个表达式、一个块或一个throw语句。</li><li id="b795" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">一个新的<code class="fe lv lw lx ly b">yield</code>语句产生一个值，该值成为封闭的<code class="fe lv lw lx ly b">switch</code>表达式的值</li><li id="6cc2" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">每个案例中有多个常量，用逗号分隔</li></ul><p id="cdf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了新的Java 14，可以同时使用传统的<code class="fe lv lw lx ly b">case ... :</code>标签和新的<code class="fe lv lw lx ly b">case ... -&gt;</code>标签。重要的是传统标签仍然默认支持fall through，但新标签不需要。</p><p id="4f8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何用新的<code class="fe lv lw lx ly b">switch</code>表达式重写上面的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="2df8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个简单的例子只需一条命令就可以编译和运行(多亏了JEP 330，它允许从Java 11开始启动单文件源代码程序):</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="4922" class="nx mh it ly b gy ny nz l oa ob">$ java WhoIsWho.java<br/>Mozart was a composer<br/>Dali was a painter<br/>Dostoevsky was a writer</span></pre><p id="b0cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到几个case语句已经合并，代码不再使用break语句。结果，<code class="fe lv lw lx ly b">print()</code>方法变得更短，看起来更好。</p><p id="cf10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的例子展示了一个多行的<code class="fe lv lw lx ly b">default</code>块，它使用新的<code class="fe lv lw lx ly b">yield</code>语句来产生一个值。请注意，<code class="fe lv lw lx ly b">Person</code>枚举中有几个新常量没有被<code class="fe lv lw lx ly b">switch</code>表达式中的<code class="fe lv lw lx ly b">case</code>标签覆盖:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a8a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是程序打印出来的内容:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="7cd0" class="nx mh it ly b gy ny nz l oa ob">$ java WhoIsWho.java <br/>Mozart was a composer <br/>Dali was a painter <br/>Oops! I don't know about Einstein <br/>Einstein was a ...</span></pre><p id="1a59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一个例子展示了如何用新的<code class="fe lv lw lx ly b">switch</code>表达式实现<code class="fe lv lw lx ly b">factorial</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="65a7" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">重要细节</h1><p id="4413" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">关于新的<code class="fe lv lw lx ly b">switch</code>表达式，有几件重要的事情需要了解。</p><p id="938d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先要知道的是一个<code class="fe lv lw lx ly b">switch</code>表达式的情况必须是详尽的。换句话说，对于所有可能的值，必须有一个匹配的<code class="fe lv lw lx ly b">switch</code>标签。让我们向枚举添加一个新元素，看看会发生什么:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ea40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编译将立即失败，并显示以下错误消息:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="3e94" class="nx mh it ly b gy ny nz l oa ob">$ java InvalidWhoIsWho.java<br/>InvalidWhoIsWho.java:19: error: the switch expression does not cover all possible input values<br/>         String title = switch (person) {<br/>                        ^<br/>1 error<br/>error: compilation failed</span></pre><p id="6afd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加一个简单的<code class="fe lv lw lx ly b">default</code>案例让Java编译器很高兴:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="65f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，除非使用枚举，并且一个<code class="fe lv lw lx ly b">switch</code>表达式的情况覆盖了所有常量，否则在<code class="fe lv lw lx ly b">switch</code>表达式中需要一个<code class="fe lv lw lx ly b">default</code>子句。</p><p id="93f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二件要记住的事情是一个<code class="fe lv lw lx ly b">switch</code>表达式必须要么正常完成，要么抛出一个异常。让我们来看看下面的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="9832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们试图编译这段代码，Java编译器会立即抱怨:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="6bec" class="nx mh it ly b gy ny nz l oa ob">InvalidSwitchExpressionWithoutDefault.java:8: error: the switch expression does not cover all possible input values<br/>        return switch (n) {<br/>               ^<br/>1 error<br/>error: compilation failed</span></pre><p id="44f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，添加一个<code class="fe lv lw lx ly b">default</code>案例使其工作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c0d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要记住的第三件重要的事情是<code class="fe lv lw lx ly b">yield</code>现在是一个受限标识符。特别是，这意味着名为<code class="fe lv lw lx ly b">yield</code>的类变得非法:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="2549" class="nx mh it ly b gy ny nz l oa ob">$ cat YieldClassName.java <br/>class yield {}<br/>$ javac YieldClassName.java<br/>YieldClassName.java:1: error: 'yield' not allowed here<br/>class yield {<br/>      ^<br/>  as of release 13, 'yield' is a restricted type name and cannot be used for type declarations<br/>1 error<br/>error: compilation failed</span></pre><p id="3af4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，允许使用<code class="fe lv lw lx ly b">yield</code>作为变量或方法名:</p><pre class="kj kk kl km gt nt ly nu nv aw nw bi"><span id="43db" class="nx mh it ly b gy ny nz l oa ob">$ cat ValidUseOfYieldWord.java <br/>public class ValidUseOfYieldWord {<br/>    void yield() {<br/>        int yield = 0;<br/>    }<br/>}<br/>$ javac ValidUseOfYieldWord.java &amp;&amp; echo ok || echo failed<br/>ok</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b7a2" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="3e96" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">以下是作者对新的<code class="fe lv lw lx ly b">switch</code>表达的看法:</p><blockquote class="oc od oe"><p id="b149" class="kz la of lb b lc ld ju le lf lg jx lh og lj lk ll oh ln lo lp oi lr ls lt lu im bi translated">"这些变化将简化日常编码."</p></blockquote><p id="72a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="4ec4" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">奖金</h1><p id="d3af" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">你认为会发生什么？以下是选项:</p><ol class=""><li id="1ff3" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu oj nl nm nn bi translated">编译错误。</li><li id="02b9" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu oj nl nm nn bi translated">运行时错误。</li><li id="4b98" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu oj nl nm nn bi translated"><code class="fe lv lw lx ly b">Oops</code>是打印出来的。</li><li id="a5d7" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu oj nl nm nn bi translated"><code class="fe lv lw lx ly b">OopsOops</code>被打印出来</li><li id="dda8" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu oj nl nm nn bi translated"><code class="fe lv lw lx ly b">Forty-two</code>被打印出来。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="97af" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">资源</h1><ul class=""><li id="0459" class="nf ng it lb b lc my lf mz li ok lm ol lq om lu nk nl nm nn bi translated"><a class="ae ky" href="https://openjdk.java.net/jeps/361" rel="noopener ugc nofollow" target="_blank"> JEP 361:开关表达式</a></li><li id="faef" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><a class="ae ky" href="https://openjdk.java.net/projects/jdk/14/" rel="noopener ugc nofollow" target="_blank"> OpenJDK 14时间表和增强功能列表</a></li></ul></div></div>    
</body>
</html>