<html>
<head>
<title>How To Document REST APIs With OpenAPI (AKA Swagger)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用OpenAPI(又名Swagger)记录REST APIs</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-document-your-rest-api-with-openapi-aka-swagger-b0bcc118ebe7?source=collection_archive---------4-----------------------#2021-04-15">https://betterprogramming.pub/how-to-document-your-rest-api-with-openapi-aka-swagger-b0bcc118ebe7?source=collection_archive---------4-----------------------#2021-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0975" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用OpenAPI为您的API创建一流的文档</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/66fd97c0c0b4547e40d32f97126eb9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*696b8c1D3sNERWluJ0G7sA.jpeg"/></div></div></figure><p id="7628" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您是一名开发人员，您可能不止一次地使用过REST API。如果您有，您可能会知道使用一个糟糕的文档化(或者更糟，没有文档化)的API是多么痛苦。由于这个原因，当我们设计API时，很重要的一点是做好文档记录。这样，您将使想要使用它的开发人员和您未来的自己的生活变得更加轻松。</p><p id="21cd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记录REST APIs最流行的标准之一是<a class="ae lq" href="https://swagger.io/specification/" rel="noopener ugc nofollow" target="_blank"> OpenAPI </a>，通常称为Swagger，尽管它也是您用来创建和查看这些文档的工具的名称。OpenAPI文档是用JSON或YAML编写的，描述了如何使用API公开的端点，以及其他细节，如认证机制。从这个文档中，可以生成用户友好的HTML文档，以及各种编程语言和框架中的客户机和服务器存根。</p><p id="d5aa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最棒的是，这一切都可以免费完成。今天，我将向您展示如何使用YAML风格的OpenAPI为图书图书馆编写一个虚拟API。我们的库API将只提供基本的CRUD操作:</p><ul class=""><li id="81b7" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">把所有能找到的书都拿来</li><li id="9717" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">GET /books/{id}</code>:获取具有特定ID的书籍的详细信息</li><li id="5bc3" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">GET /books/search</code>:获取所有符合搜索条件的书籍(书名、作者……)</li><li id="5d6b" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">POST /books</code>:创建一本新书</li><li id="53a9" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">PUT /books/{id}</code>:用特定的ID更新图书的详细信息</li><li id="15bb" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">DELETE /books/{id}</code>:删除具有特定ID的图书</li></ul><p id="094a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于图书的创建、修改和删除，将需要一个API键。我们的<code class="fe ma mb mc md b">book</code>对象也将非常简单，具有以下属性:</p><ul class=""><li id="4955" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">ID</code>:唯一标识符</li><li id="f7c8" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">Title</code></li><li id="2ea3" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">Author</code></li><li id="8146" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">Year</code>(可选)</li><li id="2f5f" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">Pages</code>(可选)</li><li id="b08f" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><code class="fe ma mb mc md b">TypeOfBook</code>(可选):可以是以下之一:小说、百科、漫画、传记、历史。</li></ul><p id="3716" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你准备好写你的第一个OpenAPI文档了吗？我们走吧！</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8001" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">关于API的基本信息</h1><p id="8dd1" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">我们的OpenAPI文档应该从我们正在使用的OpenAPI规范的版本、关于API的基本信息以及服务器的位置开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="02f1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">大多数REST APIs需要某种类型的认证。在我们的例子中，我们将选择一个简单的API键，它将作为查询字符串发送给那些需要身份验证的操作(创建、修改和删除一本书):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="6b6a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">数据模型(模式)的定义</h1><p id="74a8" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">现在我们来定义一下之前讲过的<code class="fe ma mb mc md b">Book</code>数据模型。正如我们所说，一本书应该有一个id，一个标题和一个作者。可选地，它可以有出版年份、页数和书籍类型(小说、百科全书、漫画、传记或历史)。在<code class="fe ma mb mc md b">components</code>标签中，在与<code class="fe ma mb mc md b">securitySchemes</code>相同的层次上，我们可以定义我们的<code class="fe ma mb mc md b">Book</code>模式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="a99c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意，由于ID将由系统自动分配给新书，所以它没有按照要求进行设置，即使API返回的任何<code class="fe ma mb mc md b">Book</code>对象都有一个ID。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="5782" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">端点的定义</h1><h2 id="0b8d" class="np mr it bd ms nq nr dn mw ns nt dp na ld nu nv nc lh nw nx ne ll ny nz ng oa bi translated">获取/书籍</h2><p id="5c6e" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">让我们从最简单的开始。唯一可能的响应是一个HTTP 200，用一个JSON数组保存图书馆中所有可用的书籍，作为我们之前定义的<code class="fe ma mb mc md b">Book</code>模式的对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="7c18" class="np mr it bd ms nq nr dn mw ns nt dp na ld nu nv nc lh nw nx ne ll ny nz ng oa bi translated">获取/books/{id}</h2><p id="6b2b" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">如果我们只是想获得某本书的详细信息呢？在路径中定义一个参数<code class="fe ma mb mc md b">id</code>,然后添加一个404响应错误，以防没有具有所请求ID的图书:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="6985" class="np mr it bd ms nq nr dn mw ns nt dp na ld nu nv nc lh nw nx ne ll ny nz ng oa bi translated">获取/书籍/搜索</h2><p id="8175" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">对于搜索端点，参数将是可选的，并将作为查询字符串发送。还要注意，我们不会定义404响应——因此，如果没有符合搜索条件的书籍，我们的API将简单地返回一个空的JSON数组:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="cee3" class="np mr it bd ms nq nr dn mw ns nt dp na ld nu nv nc lh nw nx ne ll ny nz ng oa bi translated">邮件/书籍</h2><p id="c612" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">当调用这个方法时，客户机将使用先前定义的<code class="fe ma mb mc md b">Book</code>模式，在POST请求体中以JSON对象的形式发送新书细节。由于这是一个<code class="fe ma mb mc md b">write</code>操作，用户将需要使用有效的API密钥进行认证，以执行该调用(标签<code class="fe ma mb mc md b">security</code>)。最后，回想一下现在是如何定义三种可能的响应代码的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="b7f5" class="np mr it bd ms nq nr dn mw ns nt dp na ld nu nv nc lh nw nx ne ll ny nz ng oa bi translated">PUT /books/{ <em class="ob"> id </em> }</h2><p id="6e9c" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">正如我们对<code class="fe ma mb mc md b">GET /books/{id}</code>端点所做的那样，这里我们从一个路径参数中获取要修改的图书的id，并从请求体中获取新数据，如<code class="fe ma mb mc md b">POST /books</code>所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="b685" class="np mr it bd ms nq nr dn mw ns nt dp na ld nu nv nc lh nw nx ne ll ny nz ng oa bi translated">删除/books/{id}</h2><p id="092d" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">与上一个示例相同，但没有请求体:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="b4f7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我已经用一些非常简单的例子介绍了OpenAPI规范的基本方面。当然，OpenAPI提供了更多的特性——我鼓励你阅读官方文档并在阅读完之后继续学习。我还想向您推荐一些使用OpenAPI的有趣工具:</p><ul class=""><li id="61f2" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><a class="ae lq" href="https://marketplace.visualstudio.com/items?itemName=42Crunch.vscode-openapi" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> OpenAPI (Swagger)编辑器</strong> </a>对<a class="ae lq" href="http://code.visualstudio.com" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码的扩展</a>:它审查你的OpenAPI代码，提出建议，允许你预览它在Swagger UI中的样子…</li><li id="6707" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><a class="ae lq" href="https://swagger.io/tools/swagger-ui/" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu"/></a>:Swagger UI可以在云上免费获得，也可以下载到你的计算机上，Swagger UI会将你的JSON或YAML代码转换成非常友好的HTML文档，你甚至可以从中试用API。</li><li id="aeba" class="lr ls it kw b kx me la mf ld mg lh mh ll mi lp lw lx ly lz bi translated"><a class="ae lq" href="https://swagger.io/tools/swagger-codegen/" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">Swagger Codegen</strong></a>:这个工具可以把你的OpenAPI文档转换成各种编程语言和框架下的服务器端和客户端的存根(skeleton)。</li></ul><p id="766e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我还想与你分享<a class="ae lq" href="https://gist.github.com/gbarreiro/9c40f219b4e832dabd690f4a9a0205be" rel="noopener ugc nofollow" target="_blank">我们通过这篇文章创建的完整OpenAPI文档</a>，并展示它在Swagger UI中的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/a55c061c16b37b9fb2f5a3030eae8db1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*knDiOIgaz9QViAgysTRc3g.png"/></div></div><p class="od oe gj gh gi of og bd b be z dk translated">关于API、服务器列表、认证按钮和端点列表的基本信息</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/847cf1368c31fc708b2ae0389fd2bee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wd4iloQ74ubKBApu4YabZA.png"/></div></div><p class="od oe gj gh gi of og bd b be z dk translated">POST /books端点</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/6bd580e7819acd587f8d480400d943d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hEioQl6r5lRvfrDkWt3o7w.png"/></div></div><p class="od oe gj gh gi of og bd b be z dk translated">GET /books/search端点</p></figure></div></div>    
</body>
</html>