<html>
<head>
<title>Measurements in Swift: Enhanced and Simplified Again</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的测量:再次增强和简化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/measurements-in-swift-enhanced-simplified-again-7095b4600f58?source=collection_archive---------12-----------------------#2022-01-09">https://betterprogramming.pub/measurements-in-swift-enhanced-simplified-again-7095b4600f58?source=collection_archive---------12-----------------------#2022-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="31c2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们利用泛型的力量来避免重复代码</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/30204ff4f0048265ccc053dd292212eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*guFFKNdeeiu1jfvyOaIy-w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@yer_a_wizard?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">弗勒</a>在<a class="ae kv" href="https://unsplash.com/s/photos/measures?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3081" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为什么我不能这么做？有了Xcode自动完成功能的帮助？</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="83e6" class="lx ly iq lt b gy lz ma l mb mc">let v: Velocity = 55(.kilometers, per: .hours)<br/>print(v * 2 * 2(.hours)) // -&gt; 220 km</span></pre><p id="768c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">原来你可以！只需将这个<a class="ae kv" href="https://github.com/wildthink/anymeasure" rel="noopener ugc nofollow" target="_blank">包</a>添加到您的项目中，并开始编码。</p><p id="a2da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想知道一些背景故事和更多的细节，请继续读下去。</p><p id="5281" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您还没有阅读Swift: Simplified 中的<a class="ae kv" href="https://medium.com/@jasonj_2009/measurement-in-swift-simplified-30207fd8282c" rel="noopener"> Measurement，这只是2分钟的时间，作为早期作品，它为随后的改进和更新奠定了基础。</a></p><p id="bb57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">显然，我有一个性格缺陷，这使得我很难对不太好的解决方案感到满意。它不仅使我能够清晰简洁地写作，还能从一个特定的解决方案扩展到一个更一般的解决方案。</p><p id="a294" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑到支持简单的<code class="fe md me mf lt b">Measurements</code>(如前所述)很容易，我真的想将这种模式扩展到复合单位度量，或者至少扩展到更常见的<code class="fe md me mf lt b">Ratio</code>。</p><p id="cb49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每次我开始创建一个新的单元组合集合时，我都会对创建新组合的重复性感到不满。代码并不多，但足以扰乱调用站点，让我不得不寻找解决方案。</p><p id="5c6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，经过更多的思考和与泛型的激烈争论，我解决了这个问题；事实证明，你可以做到这一点，只需添加很少的东西。</p><p id="80cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，我刚想出自己的解决方案，就发现<code class="fe md me mf lt b"><a class="ae kv" href="https://github.com/Flight-School/Rate/blob/master/Sources/Rate/Rate.swift" rel="noopener ugc nofollow" target="_blank">Rate.swift</a></code>在一个更干净的地方。所以我使用了它，只是按照我用于标准<code class="fe md me mf lt b">Measurements</code>的模式做了一些小的扩展。</p><p id="f637" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">诀窍是使用标准度量<code class="fe md me mf lt b">Unit</code>创建一个通用结构。添加<code class="fe md me mf lt b">addition</code>、<code class="fe md me mf lt b">subtraction</code>和<code class="fe md me mf lt b">multiplication</code>的方法以及适当重载的操作符，您就可以开始比赛了。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="93dd" class="lx ly iq lt b gy lz ma l mb mc">public struct Ratio&lt;Numerator, Denominator&gt;<br/>where Numerator: Unit, Denominator: Unit {<br/>   /// The value of the numerator unit per single denominator unit.<br/>   public var value: Double<br/> <br/>   /// The numerator unit.<br/>   public var numeratorUnit: Numerator<br/>   <br/>   /// The denominator unit.<br/>   public var denominatorUnit: Denominator<br/>   <br/>   /// The ratio symbol.<br/>   public var symbol: String {<br/>       return "\(self.numeratorUnit.symbol)/\(self.denominatorUnit.symbol)"<br/>   }<br/>}</span></pre><p id="7ed1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了<code class="fe md me mf lt b">typealias</code>和明智的使用<code class="fe md me mf lt b">callAsFunction</code>来启用<code class="fe md me mf lt b">2(.hours)</code>语法，我们可以使用所有开箱即用的<code class="fe md me mf lt b">Foundation</code>度量单位。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="4f0e" class="lx ly iq lt b gy lz ma l mb mc">typealias Velocity = Measurement&lt;Ratio&lt;UnitLength, UnitDuration&gt;&gt;<br/>​<br/>public extension BinaryFloatingPoint {<br/>   func callAsFunction &lt;N: Dimension, D: Dimension&gt;(<br/>       _ numerator: N, per denominator: D)<br/>   -&gt; Ratio&lt;N,D&gt; {<br/>       Ratio&lt;N, D&gt;(value: Double(self), unit: numerator, per: denominator)<br/>   }<br/>}<br/>...</span></pre><p id="908a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">真的没有比这更多的了。对于更多的数据类型来说，这几乎是一个清洗和重复的过程。参考<a class="ae kv" href="https://github.com/wildthink/anymeasure" rel="noopener ugc nofollow" target="_blank"> GitHub项目</a>获得完整的源代码和可以包含在项目中的包。</p><p id="320a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我从许许多多的贡献者那里学到了很多。对他们，我说“谢谢”。对于你，读者，我期待着你的反馈，并希望你继续保持好奇和参与。</p><h1 id="b6ed" class="mg ly iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">信用和资源</h1><ul class=""><li id="ba37" class="mx my iq ky b kz mz lc na lf nb lj nc ln nd lr ne nf ng nh bi translated">完整的包可以在<a class="ae kv" href="https://github.com/wildthink/anymeasure" rel="noopener ugc nofollow" target="_blank"> AnyMeasure.git </a>获得。</li><li id="4019" class="mx my iq ky b kz ni lc nj lf nk lj nl ln nm lr ne nf ng nh bi translated">感谢<a class="ae kv" href="https://github.com/Flight-School/Rate" rel="noopener ugc nofollow" target="_blank">飞行学院Rate.swift </a></li></ul></div></div>    
</body>
</html>