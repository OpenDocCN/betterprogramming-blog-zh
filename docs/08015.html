<html>
<head>
<title>What You Need To Know About CORS and Vue.js To Increase Browser Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于CORS和Vue.js你需要知道什么来增加浏览器的安全性</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-you-need-to-know-about-cors-and-vue-to-boost-browser-security-7c216252b20d?source=collection_archive---------3-----------------------#2021-03-16">https://betterprogramming.pub/what-you-need-to-know-about-cors-and-vue-to-boost-browser-security-7c216252b20d?source=collection_archive---------3-----------------------#2021-03-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="114f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用CORS框架增强您的浏览器端保护</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0757cd6b0ea770b519c565c81a3c0e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7hiUxMo2jc-zqUB0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@headwayio?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">车头时距</a>对<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">车头时距</a>拍照。</p></figure><p id="9513" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这周我在开发一个前端应用程序，发现了一些CORS错误。我以前遇到过这些错误，但是我从来没有真正想过为什么跨域共享是危险的。</p><p id="1633" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我知道这与安全有关，但细节对我来说有点模糊。所以，我决定研究一下，写一篇关于CORS的深度文章，并提供一些例子。</p><p id="4309" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="055c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">什么是CORS？</strong></h1><p id="c602" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">CORS主张跨产地资源共享。它是一种机制，允许服务器指示哪些其他域可以访问它们的资源。</p><p id="2ad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">资源可以是任何东西。一个图像、一个API请求，甚至加载一个外部iframe。</p><p id="ec52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我创建了一个图表，概述了在互联网上搜索猫图片时可能发生的(简化的)真实世界CORS场景:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/ebc32f965cb5bfb59ad05aeec6aa14e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*mJZWmhsQVdHBoLSSSoPDGQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f216" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">建立一个CORS范例</h1><p id="8e48" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">猫是伟大的，但让我们建立自己的简单的例子。我将在Node.js中创建一个quote API。这个API有一个单独的<code class="fe na nb nc nd b">GET /quote</code>端点，它返回一个鼓舞人心的报价。</p><p id="533e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我创建了这个返回报价的小节点脚本。它使用<a class="ae ky" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a>来创建服务器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="425b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过使用<code class="fe na nb nc nd b">curl</code>调用API来测试它是否工作:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="67b7" class="nk md it nd b gy nl nm l nn no">curl localhost:3000/quote</span><span id="20e1" class="nk md it nd b gy np nm l nn no">{"quote": "The way to get started is to quit talking and begin doing."}</span></pre><p id="6641" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，目前还没有问题。简单的API可以工作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1a1b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">从浏览器调用API</h1><p id="caa8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先要理解的是，CORS只影响来自浏览器的请求。这就是为什么我们简单的<code class="fe na nb nc nd b">curl</code>请求没有任何问题——我们没有使用网络浏览器。</p><p id="aa17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个调用我们的API的非常简单的Vue应用程序。我还将安装Axios，这是一个执行HTTP请求的包:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="c1df" class="nk md it nd b gy nl nm l nn no">vue create cors-test<br/>cd cors-test<br/>npm i axios</span></pre><p id="3b03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我修改了<code class="fe na nb nc nd b">App.vue</code>文件来调用我们的报价API:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="4862" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Vue有专门的开发服务器。运行以下命令时:</p><pre class="kj kk kl km gt ng nd nh ni aw nj bi"><span id="8089" class="nk md it nd b gy nl nm l nn no">npm run serve</span></pre><p id="67cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Vue将启动一个简单的网络服务器，监听端口<code class="fe na nb nc nd b">8080</code>并为前端服务。这对于简单的开发来说是非常好的，但是当我们调用我们的API时会遇到问题。</p><p id="ae48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们打开<a class="ae ky" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/10e3afdf45172debfd8ca1a13b50af2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kOgfT9hgSAAwXxF2sfHo6g.png"/></div></div></figure><p id="2585" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到没有加载报价，浏览器给出了一个CORS错误。这是因为<code class="fe na nb nc nd b">http://localhost:8080</code>和<code class="fe na nb nc nd b">http://localhost:3000</code>被认为是不同的域，因此CORS策略开始起作用。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cec8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何修复CORS错误</h1><p id="0791" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有多种方法可以修复CORS错误。</p><h2 id="a03a" class="nk md it bd me nr ns dn mi nt nu dp mm li nv nw mo lm nx ny mq lq nz oa ms ob bi translated">1.允许来自服务器的CORS请求</h2><p id="f27e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用<code class="fe na nb nc nd b">Access-Control-Allow-Origin</code>头，我们可以指定哪些来源可以使用我们的API。</p><p id="51db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将它设置为<code class="fe na nb nc nd b">http://localhost:8080</code>以允许我们的Vue应用程序调用它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="058b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们再试一次！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/0f66c587dc8dc5af53b182b796818c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZPg75rgw4l4cfFaJHMpaQ.png"/></div></div></figure><p id="53d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到浏览器被允许访问API。</p><p id="0c3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，您也可以指定一个通配符<code class="fe na nb nc nd b">*</code>来允许任何域访问API。</p><h2 id="0af0" class="nk md it bd me nr ns dn mi nt nu dp mm li nv nw mo lm nx ny mq lq nz oa ms ob bi translated">2.发展代理人</h2><p id="dbd7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在开发过程中，您经常会看到后端服务器与前端服务器运行在不同的端口上。</p><p id="654e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的例子也是如此，前端服务器运行在<code class="fe na nb nc nd b">localhost:8080</code>上，后端服务器运行在<code class="fe na nb nc nd b">localhost:3000</code>上。</p><p id="5fc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在生产环境中，我们可能会将这些应用程序部署到同一个域中(<code class="fe na nb nc nd b">quotes.org</code>服务于前端应用程序，<code class="fe na nb nc nd b">quotes.org/api</code>服务于API)。在这种情况下，生产环境中不会出现CORS问题，因为所有东西都在同一个域中。</p><p id="10af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于CORS问题只存在于开发服务器上的情况，我们可以设置一个开发代理:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/128d922e8890344f38ce23f038f55974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*WsMLakT_XQ0N4LptDJlfpA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="8818" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要设置这个代理系统，我们可以在Vue项目的根目录下创建一个<code class="fe na nb nc nd b">vue.config.js</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="3539" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们还应该更改<code class="fe na nb nc nd b">App.vue</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a19b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当运行所有内容时，我们再次在浏览器中看到一个报价！</p><p id="05e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://cli.vuejs.org/config/#devserver-proxy" rel="noopener ugc nofollow" target="_blank">查看Vue文档</a>，了解调整本地代理服务器的所有方法。</p><h2 id="015b" class="nk md it bd me nr ns dn mi nt nu dp mm li nv nw mo lm nx ny mq lq nz oa ms ob bi translated">3.生产代理</h2><p id="633c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设quote API是由一家名为Quote Inc .的公司开发的，在这种情况下，您无法访问源代码。</p><p id="fb10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以像我们在上一步中所做的那样在您的Vue应用程序上设置代理，但是一旦您将应用程序部署到生产环境中，这将不再有效，因为您不再使用Vue dev服务器。</p><p id="bbb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在有很多方法可以解决这个问题。您可以在您的产品Nginx或Apache配置文件中设置一个代理。</p><p id="963b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决这个问题的另一种方法是从您自己的本地API“转发”API请求。例如，在我们的节点服务器中，我们可以保留<code class="fe na nb nc nd b">Get /quote</code>端点，并从那里简单地调用Quote Inc. API。</p><p id="24f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们不会遇到任何CORS问题，因为我们是从节点服务器(而不是从浏览器)调用API的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="707d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们仍然可以从浏览器中使用对CORS不友好的报价公司API！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="00aa" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么CORS甚至在那里？</h1><p id="25de" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">解决CORS问题可能有点令人头痛。为什么它会在那里？</p><p id="859c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要知道的最重要的一点是，浏览器在发出请求时会自动向服务器发送cookie数据。这意味着，如果您登录脸书并访问malicious-cats.com，卡特彼勒网站可能会向脸书发送跨网站请求。</p><p id="6207" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设malicious-cats.com试图代表您向<code class="fe na nb nc nd b">facebook.com/post-message</code>端点发送一个请求，在您的墙上写了一个帖子，说“我爱Mali couss-cats . com！”</p><p id="06e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使malicious-cats.com不能查看您的脸书饼干，它仍然可以使用它们，因为浏览器会将它们附加到对facebook.com的请求中。</p><p id="36cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个稍微简化的例子。现在有更多的安全措施来阻止这种情况，比如<a class="ae ky" href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" rel="noopener ugc nofollow" target="_blank"> CSRF </a>或者<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials" rel="noopener ugc nofollow" target="_blank">访问控制-允许-凭证</a>标题。但它确实说明了允许CORS请求的基本危险。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6f5f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="3d27" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们已经了解了CORS请求到底是什么，如何修复最常见的错误，以及为什么要创建这个系统。</p><p id="a3fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想了解更多关于CORS的信息，我会推荐关于这个主题的<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank">优秀的MDN Web Docs </a>页面。</p><p id="341b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快乐编码！</p></div></div>    
</body>
</html>