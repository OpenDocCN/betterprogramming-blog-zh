<html>
<head>
<title>Using a Match Text Action With RegEx Versus Repeat With Each Loop in Shortcuts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对快捷方式中的每个循环使用正则表达式的匹配文本操作与重复操作</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-a-match-text-action-with-regex-versus-repeat-with-a-each-loop-in-shortcuts-709a3ee6f51?source=collection_archive---------11-----------------------#2022-07-12">https://betterprogramming.pub/using-a-match-text-action-with-regex-versus-repeat-with-a-each-loop-in-shortcuts-709a3ee6f51?source=collection_archive---------11-----------------------#2022-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4903" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">简化字符串处理</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bdd6b5675bcdffcda223cf2970d2910e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6uLzP5bz8moST6d_dF4qsw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者截图</p></figure><h1 id="7c80" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">背景</h1><p id="8e7e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">一段时间以来，我一直在我的提醒和联系人中使用可变数据，以允许Shortcuts应用程序根据这个特定提醒或联系人的值进行处理。</p><p id="7350" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">可变数据的例子有:</p><h2 id="f756" class="mo kw iq bd kx mp mq dn lb mr ms dp lf lw mt mu lh ma mv mw lj me mx my ll mz bi translated"><strong class="ak">提醒示例</strong></h2><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="908f" class="mo kw iq nb b gy nf ng l nh ni">$Duration: 5<br/>$Duration: 10 min</span></pre><h2 id="9d5b" class="mo kw iq bd kx mp mq dn lb mr ms dp lf lw mt mu lh ma mv mw lj me mx my ll mz bi translated"><strong class="ak">联系示例</strong></h2><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="043a" class="mo kw iq nb b gy nf ng l nh ni">$Automation: { “HolidaysToGreet”: [“Easter”, “Mother’s Day”, “Thanksgiving Day”, “Christmas”], “OpeningText”: [“Hi”, “Hey”, “Hello”]}</span></pre><p id="dea5" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">提醒示例用于将我计划阅读的文章提醒从最短到最长排序，或者为我的家务创建一个日历事件，从所需的开始时间开始，以适当的长度规划我的一天并划分任务。</p><p id="a9b8" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">联系人示例处理日历中的全天事件，将向适当的联系人发送问候。是的，假日可以被包含在<code class="fe nj nk nl nb b">Find Reminders</code>动作的过滤器中，但是<code class="fe nj nk nl nb b">OpeningText</code>不能(目前)被轻易拉出。</p><h1 id="9bd1" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">代码示例</h1><p id="6148" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">以前，获取所需数据的方法基本如下(我将重点关注提醒用例，因为这是我最近使用的用例):</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="9d24" class="mo kw iq nb b gy nf ng l nh ni">If "Reminder.Notes" contains "$Duration" {<br/>Get "Notes" from "Reminder"<br/>    Split "Notes" by "New Lines"<br/>    Repeat with each item in "Split Text" {<br/>        if "Repeat Item" begins with "$Duration" {<br/>            Split "Repeat Item" by "Custom" ": "<br/>            Get "Last Item" from "Split Text"<br/>            Number "Item From List"<br/>            // … further processing that doesn’t get changed …<br/>        }<br/>    }<br/>}</span></pre><p id="0b16" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这不仅是丑陋的，它是非常多圈，嵌套很深。它还可能执行额外的循环(并减慢处理速度)，因为在提取所需的行和值时没有转义。</p><p id="2a62" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">通过使用带有正则表达式<code class="fe nj nk nl nb b">(?&lt;=\$Duration: )[0–9]*(?=[;|\s| ?min])</code>的<code class="fe nj nk nl nb b">Match Text</code>动作，我可以将上面的动作改为:</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="7598" class="mo kw iq nb b gy nf ng l nh ni">If "Reminder.Notes" contains "$Duration" {<br/>    Get "Notes" from "Reminder"<br/>    Match "(?&lt;=\$Duration: )[0–9]*(?=[;|\s| ?min])" (Case Sensitive set to "Off")<br/>    Number "Matches"<br/>    // … further processing that wasn’t changed<br/>}</span></pre><p id="e9be" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这种变化更加清晰，因为快捷方式不需要循环和查找变量数据。但是RegEx字符串匹配的是什么并不是一目了然的。</p><p id="21e7" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这个正则表达式特定于这个用例。它不适用于contact示例，也不适用于所用变量名称的更改(在这个示例中—文章提醒排序，阅读时间来自文章文本的网页，并通过单独的快捷方式添加为注释)。</p><h1 id="0e4e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">正则表达式解释</h1><p id="04e4" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这个RegEx字符串使用几个特性来只提取数字持续时间值。</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="a2a9" class="mo kw iq nb b gy nf ng l nh ni">(?&lt;=\$Duration: )[0–9]*(?=[;|\s| ?min])</span></pre><p id="6779" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">分解字符串，有3个重要部分。<br/> 1。<code class="fe nj nk nl nb b">(?&lt;=\$Duration: )</code> <br/> 2。<code class="fe nj nk nl nb b">[0–9]*</code> <br/> 3。<code class="fe nj nk nl nb b">(?=[;|\s| ?min])</code></p><h2 id="91d6" class="mo kw iq bd kx mp mq dn lb mr ms dp lf lw mt mu lh ma mv mw lj me mx my ll mz bi translated">第一部分(<code class="fe nj nk nl nb b">(&lt;?≤\$Duration: )</code>)</h2><p id="cc7f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这是“积极的回顾”文本必须出现在所需值之前。这可以根据用例进行更改，变得更加灵活。当我考虑如何存储更复杂的数据时，我会将它作为一个独特的字符串(可能是<code class="fe nj nk nl nb b">&lt;$?&gt;</code>或类似的字符串)来充当“开始标签”</p><h2 id="397d" class="mo kw iq bd kx mp mq dn lb mr ms dp lf lw mt mu lh ma mv mw lj me mx my ll mz bi translated">第二部分(<code class="fe nj nk nl nb b">[0–9]*</code>)</h2><p id="8db5" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这将只查找开始序列和结束序列之间的数字。为了使它更通用，我将把<code class="fe nj nk nl nb b">[0–9]*</code>改为<code class="fe nj nk nl nb b">.*</code>,这种改变将接受开始和结束标记之间的任何字符串。</p><p id="6265" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">对这部分正则表达式字符串的另一个考虑是确保它跨多行工作，因为整齐地打印复杂数据有助于确保准确性。我会用一个“从输入中获取字典”动作来跟踪复杂的数据结构，以使快捷方式的其他部分更容易访问</p><h2 id="f5a8" class="mo kw iq bd kx mp mq dn lb mr ms dp lf lw mt mu lh ma mv mw lj me mx my ll mz bi translated">第三部分(<code class="fe nj nk nl nb b">(?=[;|\s|min]</code></h2><p id="f0a3" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这是一种“积极的前瞻”或者之前提到的“结束标签”。在这种情况下，它寻找分号(<code class="fe nj nk nl nb b">;</code>)、任何空格或<code class="fe nj nk nl nb b">min</code> ute中的“min”。这种样式逻辑的一个好处是<code class="fe nj nk nl nb b">6min</code>和<code class="fe nj nk nl nb b">6 min</code>都将返回<code class="fe nj nk nl nb b">6</code>作为匹配的文本。为了与之前可能出现的开始标记保持一致，我将使用类似于<code class="fe nj nk nl nb b">&lt;/$?&gt;</code>的东西来与&lt; abbr title= "标准通用标记语言"&gt; SGML &lt; /abbr &gt;结构保持一致。</p><h1 id="eea6" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">包裹</h1><p id="a89f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在小地方使用正则表达式有助于在自动化过程中简化查找所需值的过程。Regex非常灵活，非常强大。但这也带来了搜索内容某种程度的不透明。</p><p id="5d44" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">我用来帮助开发正则表达式字符串的工具是<a class="ae nm" href="https://regex101.com/" rel="noopener ugc nofollow" target="_blank"> regex101 </a>。该站点可以帮助开发过程和学习过程，因为它解释了正则表达式解析器所经历的步骤，各种控制字符的含义，并显示了解析器检查示例文本的结果。</p><div class="nn no gp gr np nq"><a href="https://regex101.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ir gy z fp nv fr fs nw fu fw ip bi translated">regex101:构建、测试和调试regex</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">正则表达式测试器，语法高亮，解释，PHP/PCRE，Python，GO，JavaScript的备忘单…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">regex101.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe kp nq"/></div></div></a></div><p id="4f77" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">希望本文已经介绍并帮助解释了对您的处理的一种可能的增强。我认为这应该不仅仅适用于苹果生态系统中的快捷方式应用程序。给你一个新的工具来缩短甚至简化你的处理过程。</p></div></div>    
</body>
</html>