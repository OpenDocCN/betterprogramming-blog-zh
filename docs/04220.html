<html>
<head>
<title>How to Build SimonSez With Notifications, SwiftUI, and Combine — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用通知、SwiftUI和组合构建SimonSez第1部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-simonsez-with-notifications-swiftui-and-combine-b143920261c3?source=collection_archive---------21-----------------------#2020-03-30">https://betterprogramming.pub/how-to-build-simonsez-with-notifications-swiftui-and-combine-b143920261c3?source=collection_archive---------21-----------------------#2020-03-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2155" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何构建一个简单的网络游戏的第1部分</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5ae8e15a119ccee3b0ec1f203700aa31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9JxnJrV9s6fJAVqV"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sxriptx?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> S X R I P T X </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄。</p></figure><p id="2a1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最讨厌的事情之一是阅读一篇基于iOS Y和Swift X的文章，但读到一半时却发现它已经过时了。所以预先警告:这是写在iOS 13和Swift 5上的。</p><p id="c748" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我过去一两周写的一系列文章中，我讲述了如何通过苹果接收，更重要的是发布远程通知。我使用了三种主要类型:提醒、徽章和声音。我顺便提到了iOS 12中引入的一个新功能(临时通知)。</p><p id="ac98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，临时通知实际上根本不是一种新类型。它们是一种无需实际请求即可请求允许发送通知的方式。这个想法很简单:在你做任何事情之前，不要问你是否可以发送通知，你可以要求他们是可接收的。iOS批准了它，并默默地交付它们。这个想法是你以后会要求完全的许可。</p><p id="d9d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们根据西蒙说的话(有时称为简单的西蒙说的话)构建一个游戏来尝试一下。我将使用临时通知。严格来说，这不是它们的目的，但我在这里很有创意。</p><p id="41f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个项目，将其命名为SimonSez，并将这段代码添加到<code class="fe lv lw lx ly b">appDelegate</code>中。将通知推送到目标的签名&amp;功能下的功能。您还需要添加CloudKit，因为我们也将使用它——尽管比WotsApp中要少得多。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="5b23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将配置临时通知，这意味着您可以发送通知，但他们不会被看到。它仍然会向控制台报告一个十六进制注册密钥，您需要注意。</p><p id="992c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的计划是永远不要求发送提醒、徽章或声音作为通知。我们只是希望有一种方式可以无声地互相传递信息。这里有一个警告:不要被这种想法冲昏了头脑。我敢肯定，您可以向某人发送的静默通知的数量是有限的。由于你只能用你的Apple ID为所有通知创建两个推送ID，你应该谨慎使用。</p><p id="863b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到计划上来。我想创建一个简单的按钮板。你按顺序按下它们，然后挑战另一个玩家重复这个顺序，比如红色、红色—蓝色—绿色、绿色、绿色—黄色。</p><p id="1d75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要开始游戏，我们需要共享我在启动时创建的通知ID令牌(您注意到的那个)。我们通过CloudKit实现在另一个项目中这样做了，但是这次我不想使用完整的CloudKit。对于一个简单的游戏来说，这感觉有点过了，而且你可能已经通过阅读其他系列发现了，这是一个很大的工作量。让我们保持简单，使用键值存储。毕竟，我们只是在分享一个游戏的十六进制令牌。我开始做一些你永远不应该做的事情:在一个我称为<code class="fe lv lw lx ly b">Common.swift</code>的文件中定义几个全局变量:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="2ce3" class="mf mg it ly b gy mh mi l mj mk">var coder: String!<br/>var token: String!<br/>var quest: String = ""</span></pre><p id="919b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们快速构建使用键值存储来共享代码的方法。将这些助手方法添加到我们称为<code class="fe lv lw lx ly b">Storage.swift</code>的新类中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="864a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这段代码中，我们通过订阅密钥更改来初始化该类。这触发了一个方法来刷新我们界面上的选择器列表(稍后将会显示)以显示新的键。我们还创建了一个方法来做同样的事情，因为订阅有时可能有点棘手。</p><p id="3a04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他方法有内务处理、保存密钥、检索密钥和删除密钥。接下来，创建第二个类，将其命名为<code class="fe lv lw lx ly b">Crypto.swift</code>，并将该方法输入其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="aae4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将生成我们的随机密钥，以便其他玩家可以在我们加入游戏时找到我们。我们使用一周中的某一天来帮助我们维护表。我们的想法是只在表中保存今天的键。我们干脆放弃其他所有的日子。注意:这并不适用于全球。显然，澳大利亚现在是星期一，远早于美国的星期一。作为一种增强，我们应该给我们的键添加一个时区。</p><p id="3e43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要为远程通知编写代码。理论上，我们可以简单地在表视图中显示十六进制键，但是它们有64个字符长，在现实生活中完全不切实际。我们将它们与我们生成的随机代码配对。</p><p id="0b56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经在WotsApp的文章中介绍了这方面的内容，但是我想我应该在这里重温一下。</p><p id="2871" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">若要通过Apple使用发布通知，您需要创建一个证书。我们首先登录您的Apple帐户，获取一个私钥，您将使用该私钥作为发布通知请求的一部分。打开web浏览器并登录您的Apple Developer帐户。在“概述”页面上，您将看到我们正在寻找的名为“证书、标识符和配置文件”的选项卡。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a5f5bab222f589cdef5c1f537ce2d03d.png" data-original-src="https://miro.medium.com/v2/resize:fit:60/0*V780WP7KUkw5DaAQ"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/65648df2aa5f780fc5ec06f319100906.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/0*pTvsUoTxI80MEcJJ.png"/></div></figure><p id="d96a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击它，然后单击左侧选项卡中名为“Keys”的项目。在那里，你可以点击蓝色圆圈中的白色加号。您应该会发现自己看到的配置屏幕看起来很像这样。请记住，您只能创建两个APNS类型的密钥，所以要明智地使用它们。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/61dc82ddd778e78320ab310b1287c7d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6A8OulA-RJvi57sxjFV3-Q.png"/></div></div></figure><p id="4464" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击注册，稍等片刻。注册后，请特别注意将出现在页面上的密钥ID。你以后会需要它的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/f725b23b27e5800be65bddf875a6f2fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3UCtLn5KgSmeJGKCciI2BA.png"/></div></div></figure><p id="b06f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好，现在下载你的签名。它将包含在扩展名为. p8的文件中。标准OS X上的应用程序都不理解什么是. p8文件，你将无法正常打开它。前往“下载”,右键单击该文件，然后用“文本编辑”应用程序打开它。不，不推荐使用它来打开. p8文件，但它可以工作。</p><p id="bcef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其内容应该如下所示:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="678f" class="mf mg it ly b gy mh mi l mj mk">-----BEGIN PRIVATE KEY-----<br/>MIGTAgVAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQgl8Kij2y6acAgp1FZ<br/>BHqI6T/Bv4bBgndxuVr1IfuYhemgBgYIKoZIzj0DAQehRANCAASweAt5jGR5H1Vf<br/>QmlPyVVa2hn8jPLxdg0wHyP/xpXbJ5kGunlkXomLh8k+d31tWKKQF2QTzPCzckyi<br/>p0aHWAWG<br/>-----END PRIVATE KEY-----</span></pre><p id="4fe8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是您将用来加密发送给Apple的信息的秘密私钥。回到编码。重新打开SimonSez项目，创建另一个名为<code class="fe lv lw lx ly b">RemoteNotifications.swift</code>的类。将密钥文件的内容添加到其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="0193" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，那是三段引文。你需要所有的东西。现在，我认为一些读者可能会发现最可怕的部分:我们需要一个第三方库来做这件事。我们要找的库是IBM写的。谷歌“swift jwt库”点击<a class="ae ky" href="https://github.com/IBM-Swift/Swift-JWT" rel="noopener ugc nofollow" target="_blank">链接</a>，你会在GitHub中看到这个库:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/2362bc4003e446ca3e4a7c81a6875627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y3nPTAF0Wgpo714A57aexw.png"/></div></div></figure><p id="88ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">复制URL并移回Xcode项目。点击蓝色项目图标，然后点击Swift Packages选项卡。当它下载各种软件包时，您应该会看到几个这样的窗口。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/a723203714663693b174bf048f3a7fb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MiXvJnHJVNj828VP6mfdmA.png"/></div></div></figure><p id="666b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下载完成后，您只需点击完成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/659af66a4428a935989e3962d11d5240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bOTZ1HLueaaiyLCeGAWazw.png"/></div></div></figure><p id="583e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设一切正常，您的项目现在应该包含了<code class="fe lv lw lx ly b">SwiftJWT</code>库。回到<code class="fe lv lw lx ly b">RemoteNotifications</code>类并导入你的新库。编译它只是为了检查一切工作正常。您应该不会收到任何错误。别担心，那是最伤脑筋的部分。现在应该是一帆风顺了…嗯，差不多了。</p><p id="94c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是创建一个我们可以发布到苹果通知服务器的有效负载。JSON有效负载。这是给你的项目的。没什么特别的。这是一个普通的JSON通知对象。尽管我应该补充一点，它不需要提醒、徽章或声音。它只是发布一些数据——一个SimonSez数据包。JSON中有一个特殊的标签<code class="fe lv lw lx ly b">“content-available”:1</code>告诉它这一点。</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="368f" class="mf mg it ly b gy mh mi l mj mk">let jsonObject: [String: Any] = ["aps":["content-available":1],"SimonSez":"1,2,2,3,3,3,4"]</span></pre><p id="ff1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在为了确保你没有在这里打错任何东西，把这段代码添加到你的<code class="fe lv lw lx ly b">RemoteNotification</code>类中:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="38ec" class="mf mg it ly b gy mh mi l mj mk">func postNotification(postTo: String, jsonObject:[String: Any]) {<br/>let valid = JSONSerialization.isValidJSONObject(jsonObject)print("valid ",valid)<br/>if !valid {return}</span></pre><p id="1ad7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快速前进，您现在已经准备好使用IBM库了。通过将这段代码添加到您的<code class="fe lv lw lx ly b">RemoteNotification.swift</code> <code class="fe lv lw lx ly b">postNotification</code>方法中，定义组成JSON web令牌的三个部分中的两个:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="ce12" class="mf mg it ly b gy mh mi l mj mk">let myHeader = Header(typ: "JWT", kid: "DNU7997F")<br/>let myClaims = ClaimsStandardJWT(iss: "*", sub: nil, aud: nil, exp: nil, nbf: nil, iat: Date() , jti: nil)<br/>let myJWT = JWT(header: myHeader, claims: myClaims)</span></pre><p id="5666" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有两个字段需要与所示代码不同的值。<code class="fe lv lw lx ly b">kid:</code>是您的私钥的密钥ID，我们前面已经描述过了。而<code class="fe lv lw lx ly b">iss:</code>属性是你的团队ID，你应该可以在苹果账户会员页面下找到。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/8c8d5fdd9fab51c81c02ac2eae849874.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RKVChteqy_4FzKuiYMX_w.png"/></div></div></figure><p id="19c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义了前两部分之后，现在需要使用您的私钥来构建第三部分。这是您的JSON web令牌。</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="bf5f" class="mf mg it ly b gy mh mi l mj mk">let privateKeyAsData = privateKey.data(using: .utf8)<br/>let signer = JWTSigner.es256(privateKey: privateKeyAsData!)<br/>let jwtEncoder = JWTEncoder(jwtSigner: signer)</span></pre><p id="b65f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个谜题的最后一步是打电话给苹果公司的APNS服务部。一些附加说明:</p><ul class=""><li id="de73" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">代码中显示的URL是针对沙箱的。你需要用一个稍微不同的来制作。</li><li id="8144" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">这里提到的令牌是我们向Apple注册设备时获取的64个字符的字符串。它被打印到控制台上。</li><li id="74be" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><code class="fe lv lw lx ly b">apns-topic</code>是项目的包标识符，<code class="fe lv lw lx ly b">jwtString</code>是我们刚刚构建的JSON web令牌(在我们的例子中是<code class="fe lv lw lx ly b">ch.cqd.SimonSez</code>):</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="eb86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在这里添加了一个额外的例程来帮助您理解从服务器返回的任何HTTP响应。只有一件事要做:添加<code class="fe lv lw lx ly b">RemoteNotifications</code>类的<code class="fe lv lw lx ly b">URLSessionDelegateto</code>；</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="e67c" class="mf mg it ly b gy mh mi l mj mk">class PostController: NSObject,URLSessionDelegate {</span></pre><p id="d7d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是等等，在我们继续讨论SwiftUI之前，我们还需要担心一些方法。让我们停下来看看我们想要发送的JSON消息。我们的计划是将此作为背景信息发送。我说过这不是警报。是数据。</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="c38b" class="mf mg it ly b gy mh mi l mj mk">private var jsonObject: [String: Any] = ["aps":["content-available":1],"SimonSez":"1,2,2,3,3,3,4"]</span></pre><p id="728f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现这一点，我们需要为我们的项目添加一个额外的新功能。点击蓝色项目图标，添加背景模式作为一项功能，并勾选远程通知。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/bd561f169db2a739975717202b9f4b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v2_8noi8EvPIpfYgfGJo5Q.png"/></div></div></figure><p id="fe1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在回到你的<code class="fe lv lw lx ly b">appDelegate.swift</code>，把这个方法加进去。它将捕获您发送的通知:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="d1dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SimonSez数据包是一个简单的数字串，代表您按下的按钮，您将要求您的同事回忆起来。</p><p id="6a2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也需要让与你同事的联系变得更容易，所以让我们准备第二个数据包，以便在你们中的一方看到另一方时确认/交换详细信息:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="8483" class="mf mg it ly b gy mh mi l mj mk">let jsonObject: [String: Any] = ["aps":["content-available":1],"token":token!,"code":self.code]</span></pre><p id="d43d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个包包含几个变量，这些变量将包含您的随机代码和要共享的令牌。它也是一个数据包。这一个的计划是当另一方收到时产生一个警报，这样你们两个都知道你们在同一页上。这也是给他们你的地址并决定谁先走的好方法！</p><p id="13b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要另一种类型的数据包—一种交换位置的数据包—以便在甲方挑战乙方之后，乙方可以挑战甲方:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="14f9" class="mf mg it ly b gy mh mi l mj mk">let jsonObject: [String: Any] = ["aps":["content-available":1],"Toogle":true]</span></pre><p id="addb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，假设您从未离开过<code class="fe lv lw lx ly b">AppDelegate.swift</code>并且刚刚发布了<code class="fe lv lw lx ly b">didReceiveNotification</code>方法，您将处于编辑和添加一些对这些数据包的解释的有利位置。修改后的方法应该是这样的。注意:严格来说，我不需要guard声明，但是把它放进去是个好习惯，因为没有它你会通不过App Store的审查！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="50c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它是做什么的？根据哪个包被发送出去，它触发不同的组合<code class="fe lv lw lx ly b">PassThroughSubjects</code>，这里有一个稍微复杂一点的方法——<code class="fe lv lw lx ly b">execAfterDelay</code>，这是一个递归方法，用于发送有延迟的<code class="fe lv lw lx ly b">PassThroughSubjects</code>。它用于将刚刚按下的按钮序列回复给其他玩家:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="61ba" class="np mg it bd nq nr ns nt nu nv nw nx ny jz nz ka oa kc ob kd oc kf od kg oe of bi translated">结论</h1><p id="93de" class="pw-post-body-paragraph kz la it lb b lc og ju le lf oh jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">继续阅读<a class="ae ky" href="https://medium.com/better-programming/how-to-build-simonsez-with-notifications-swiftui-and-combine-part-2-de717b1c53d5" rel="noopener">第二部分</a>，看看所有这些方法是如何一起创建我们的简单游戏的。</p></div></div>    
</body>
</html>