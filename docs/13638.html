<html>
<head>
<title>Deploying a WASM-Powered React App on Vercel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Vercel上部署基于WASM的React应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploying-a-wasm-powered-react-app-on-vercel-cf3cae2a75d6?source=collection_archive---------8-----------------------#2022-09-13">https://betterprogramming.pub/deploying-a-wasm-powered-react-app-on-vercel-cf3cae2a75d6?source=collection_archive---------8-----------------------#2022-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="963a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让您的WASM反应应用程序走向世界的一步一步的指南！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3cc393ba6607c3c3ca6d18d8f4400ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6tuxtUT3MUZC0g98zg6ctw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="d612" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在过去的几周里，我一直在开发一个React应用，用Rust编写的函数为它增压。现在，首先，一点背景…</p><h1 id="3a63" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">什么是Web组装？</h1><p id="e09a" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">根据webassembly.org的说法，它被定义如下</p><blockquote class="mo mp mq"><p id="55d2" class="kv kw mr kx b ky kz jr la lb lc ju ld ms lf lg lh mt lj lk ll mu ln lo lp lq ij bi translated">WebAssembly(缩写为<em class="iq"> Wasm </em>)是一种基于堆栈的虚拟机的二进制指令格式。Wasm被设计为编程语言的可移植编译目标，支持客户端和服务器应用程序在web上的部署。</p></blockquote><p id="56fd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">简而言之，你可以用C++、Rust之类的静态编译语言来编译你的高性能代码，或者采用web汇编格式。它具有高度的可移植性，并有望以本机速度执行。</p><p id="f51c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不用说，我对这项相对较新的技术感到非常兴奋。因此，我创建了一个React应用程序，它使用web汇编代码作为“伪后端”。虽然，对我来说，有人可能会说这是一个大材小用，但这仍然是一个很好的学习机会。</p><p id="bd99" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们从指南开始。</p><h1 id="b7e2" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">目录结构</h1><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="73be" class="na ls iq mw b gy nb nc l nd ne">src/<br/>└── components<br/>    ├── ComposePrompt<br/>    ├── Controls<br/>    ├── Edge<br/>    ├── Node<br/>    └── styles<br/>wasm-parser/<br/>└── src/</span></pre><p id="6788" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如您所料，项目中有两个不同的子包:</p><ul class=""><li id="ab99" class="nf ng iq kx b ky kz lb lc le nh li ni lm nj lq nk nl nm nn bi translated">由create-react-app创建的包。它由npm管理，将有一个关联的<code class="fe no np nq mw b">package.json</code>。</li><li id="cc0d" class="nf ng iq kx b ky nr lb ns le nt li nu lm nv lq nk nl nm nn bi translated">该库由cargo-wasm-parser创建和管理。在这个目录中，可以指定需要编译成web程序集的Rust代码。</li></ul><h1 id="2ddb" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">在React上调用WASM函数</h1><p id="6996" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">各种详细的<a class="ae nw" href="https://tkat0.github.io/posts/how-to-create-a-react-app-with-rust-and-wasm" rel="noopener ugc nofollow" target="_blank">文章</a>解释了如何从javascript调用web汇编编译函数，反之亦然。在任何情况下，我将总结概括的细节。</p><h2 id="6945" class="na ls iq bd lt nx ny dn lx nz oa dp mb le ob oc md li od oe mf lm of og mh oh bi translated">货物库— <a class="ae nw" href="https://github.com/mukkund1996/composed/blob/master/wasm-parser/src/parser.rs" rel="noopener ugc nofollow" target="_blank"> wasm-parser </a></h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="1e96" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">函数<code class="fe no np nq mw b">generate_configuration</code>是从React客户端调用的。在函数之前使用的宏——<code class="fe no np nq mw b">wasm_bindgen</code>——支持JS和WASM编译的代码之间的高级交互。</p><h2 id="f190" class="na ls iq bd lt nx ny dn lx nz oa dp mb le ob oc md li od oe mf lm of og mh oh bi translated">编译到WASM</h2><p id="503e" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">Rust库可以使用wasm-pack工具编译成WASM。为了方便起见，可以将build命令直接添加到npm <code class="fe no np nq mw b">package.json</code>文件中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="3ba6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，需要将编译后的包指定为节点包的依赖项。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="4f27" class="na ls iq bd lt nx ny dn lx nz oa dp mb le ob oc md li od oe mf lm of og mh oh bi translated"><a class="ae nw" href="https://medium.com/p/cf3cae2a75d6/edit#:~:text=https%3A//github.com/mukkund1996/composed/blob/master/src/components/ComposedFlow.js" rel="noopener">反应客户端</a></h2><p id="4dd8" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在客户端，通过从先前添加到<code class="fe no np nq mw b">package.json</code>文件的依赖项中导入WASM编译的函数，可以很容易地调用它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h1 id="b4ae" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">部署到Vercel</h1><p id="1125" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">现在是部署你的应用程序的有趣部分，让每个人都可以享受它。对于这个例子，我使用Vercel作为平台来建立一个连续的部署管道，并随后部署我的应用程序的生产版本。为了避免供应商锁定，可以遵循相同的过程将其部署在其他平台上。</p><h2 id="bbf4" class="na ls iq bd lt nx ny dn lx nz oa dp mb le ob oc md li od oe mf lm of og mh oh bi translated">创建一个Vercel帐户</h2><ul class=""><li id="fefb" class="nf ng iq kx b ky mj lb mk le ok li ol lm om lq nk nl nm nn bi translated">第一步是在Vercel上创建一个帐户，并将其链接到<a class="ae nw" href="https://vercel.com/docs/concepts/git/vercel-for-github" rel="noopener ugc nofollow" target="_blank"> GitHub </a>。这确保了最新的更改反映在已部署的版本中。<strong class="kx ir">注意</strong>:这不一定是生产中的最佳选择，但对于业余爱好项目来说已经足够了。</li><li id="e454" class="nf ng iq kx b ky nr lb ns le nt li nu lm nv lq nk nl nm nn bi translated">从Vercel上生成的存储库列表中添加GitHub项目。</li><li id="1107" class="nf ng iq kx b ky nr lb ns le nt li nu lm nv lq nk nl nm nn bi translated">根据您的前端客户端所基于的框架选择模板。在我的例子中，我使用了create-react-app模板。</li></ul><h2 id="4102" class="na ls iq bd lt nx ny dn lx nz oa dp mb le ob oc md li od oe mf lm of og mh oh bi translated">修改构建步骤</h2><p id="c061" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">我们需要覆盖默认的构建步骤来构建WASM编译的代码并将其链接到您的React客户端。为了简化和标准化构建步骤，我创建了一个定制的bash脚本，可以运行该脚本来完成产品构建。我将在下面解释每个步骤:</p><h2 id="2446" class="na ls iq bd lt nx ny dn lx nz oa dp mb le ob oc md li od oe mf lm of og mh oh bi translated">安装铁锈</h2><p id="7b98" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">Vercel使用<a class="ae nw" href="https://vercel.com/docs/concepts/deployments/troubleshoot-a-build#build-image" rel="noopener ugc nofollow" target="_blank">亚马逊Linux 2 </a>作为其环境的基础映像。在我们可以编译到WASM之前，必须在环境中安装Rustup。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="77d2" class="na ls iq bd lt nx ny dn lx nz oa dp mb le ob oc md li od oe mf lm of og mh oh bi translated">安装wasm包</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="2b00" class="na ls iq bd lt nx ny dn lx nz oa dp mb le ob oc md li od oe mf lm of og mh oh bi translated">构建WASM包</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="7002" class="na ls iq bd lt nx ny dn lx nz oa dp mb le ob oc md li od oe mf lm of og mh oh bi translated">完成生产构建</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h1 id="e024" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">瞧啊。你完了。</h1><p id="7b07" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">如果构建日志是干净的，并且您没有任何错误，那么您的基于WASM的React应用程序现在应该已经部署好了！</p></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt mv mw mx my aw mz bi"><span id="976c" class="na ls iq mw b gy nb nc l nd ne"><strong class="mw ir">Want to Connect?</strong></span><span id="b06b" class="na ls iq mw b gy ou nc l nd ne">Thank you for reading my article. You can also find me on <a class="ae nw" href="https://www.linkedin.com/in/mukkundsunjii/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> and my work on <a class="ae nw" href="https://github.com/mukkund1996" rel="noopener ugc nofollow" target="_blank">GitHub</a>.</span></pre></div></div>    
</body>
</html>