<html>
<head>
<title>Write a Custom Gradle Plugin for Your Android App (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为你的Android应用编写一个定制的Gradle插件(第1部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/write-a-custom-gradle-plugin-part-1-22b37c3b7326?source=collection_archive---------8-----------------------#2020-12-30">https://betterprogramming.pub/write-a-custom-gradle-plugin-part-1-22b37c3b7326?source=collection_archive---------8-----------------------#2020-12-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="60b3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用定制的Gradle插件增强您的应用</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d79046288206d8bec09e39ca328daa0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ib0shjyBKuTK8TANmrprnw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:<a class="ae kv" href="https://wallpaperaccess.com/" rel="noopener ugc nofollow" target="_blank">https://wallpaperaccess.com/</a></p></figure><p id="56f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个Gradle插件可以非常强大，做很多事情。它可以执行自定义任务，保持应用程序的Gradle文件干净，还有很多更多。这个博客系列涵盖了如何用Kotlin编写一个简单的定制Gradle插件和单元测试。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5c5c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">先决条件</h1><p id="3747" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">要开发一个定制的Gradle插件，你需要有Java/Kotlin、Gradle和Android应用程序开发的经验。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="f287" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将解释如何创建一个带有简单输出的Gradle插件。我将在本系列的后面添加更多的细节。</p><h2 id="02fb" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">设置</h2><p id="9bfe" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">以下是创建Gradle插件的步骤:</p><ul class=""><li id="0af7" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated">从这个<a class="ae kv" href="https://www.jetbrains.com/idea/download/" rel="noopener ugc nofollow" target="_blank">链接</a>下载并安装IntelliJ IDE。</li><li id="be99" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated">打开IDE，从左侧面板点击Gradle，选择Kotlin/JVM选项，如下所述。此外，如果您希望您的<code class="fe nx ny nz oa b">build.gradle</code>文件在Kotlin中，请选择<strong class="ky ir"> Kotlin DSL </strong>构建脚本。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/45052c69eadaf741c31b66b7c15fe6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zW7vmkN4KY6ts1pa"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建一个Gradle项目</p></figure><p id="c8a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输入Gradle插件名称并指定项目目录，然后单击Finish。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/1b1a1e4612a4aeb235e8b1c489831cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o3l8NmMD6CI8HBG-"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输入插件名称和位置</p></figure><p id="91eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦Gradle下载完成，项目准备就绪，目录将如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/b7a7683421691d3975d88de287c9d2b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/0*Wkwbz1W9NTk9iTKN"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">项目目录结构</p></figure><p id="3eef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在将依赖项添加到项目中。更新<code class="fe nx ny nz oa b">build.gradle.kts</code>如下图:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="cfaf" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">现在我们已经准备好了设置。让我们开始写一些代码:</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/9584ae058584569339c380c4f1b30713.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*xIOuDtzYqAHFUi8J5DU3kA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">为插件创建一个包目录</p></figure><p id="229b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们为插件创建一个包。这里我们用Kotlin写插件。所以我们将把这个包添加到Kotlin目录中。</p><p id="370a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个扩展<code class="fe nx ny nz oa b">Plugin&lt;Project&gt;</code>的类。这是插件的入口点。当我们从应用程序运行此插件时，将会打印以下消息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="f3cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的代码中，我创建了一个名为<code class="fe nx ny nz oa b">SampleTask</code>的任务，它将打印<code class="fe nx ny nz oa b">Hello there!</code></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="bc1f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">打包插件</h1><p id="e955" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">有三种打包插件的方法。</p><ul class=""><li id="3142" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated">构建脚本</li><li id="89f1" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><code class="fe nx ny nz oa b">buildSrc</code> <strong class="ky ir"> </strong>项目</li><li id="4180" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated">独立项目</li></ul><p id="f326" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，我们将为这个插件创建一个独立的项目。要了解更多其他方式，请参考下面的<a class="ae kv" href="https://docs.gradle.org/current/userguide/custom_plugins.html#sec:packaging_a_plugin" rel="noopener ugc nofollow" target="_blank">链接</a>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="2a90" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">连接插件</h1><p id="f5f4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">要运行这个插件，我们需要提供服务定位器，Gradle将通过这个定位器找到它的ID。</p><p id="3d45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，这将与<code class="fe nx ny nz oa b">build.gradle.kts</code> <strong class="ky ir"> <em class="mw"> </em> </strong>同名。为此，在<code class="fe nx ny nz oa b">build.gradle.kts</code>中添加以下代码行:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/ad8a74e87e17859d52ce348335ea6282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-sVRV4Uoh07dmjF_zbOCFg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">为Gradle插件添加服务定位器</p></figure><p id="0837" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我们将插件作为一个独立的项目使用。要将这个插件添加到项目中，我们必须将其导出为jar。为此，我们将使用本地目录路径导出插件。为此，在<code class="fe nx ny nz oa b">build.gradle.kts</code>中包含以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="4c98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最终的<code class="fe nx ny nz oa b">build.gradle.kts</code>会是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="7a37" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">将插件导出为Jar</h1><p id="d1cb" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">要从插件源代码创建jar，单击面板右侧，双击uploadArchives。它将在给定的目录路径下导出插件。(<em class="mw"> local_jar_path </em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/8e1e453c7e9e1903e04de3238f8e2ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*cT8c2i_tnZCKANf3bXQhCw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">导出插件</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="171e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">将插件集成到应用程序中</h1><p id="9be4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">将插件添加到根级(项目级)<code class="fe nx ny nz oa b">build.gradle</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="2750" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将插件依赖关系添加到模块级(应用级)<code class="fe nx ny nz oa b">build.gradle</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="dbb3" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">我们完成了。让我们测试一下插件</h1><p id="a8c9" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">一旦我们将插件集成到应用程序中，我们将能够在应用程序的Gradle task选项卡下看到任务:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/3c98fa72c8e2b96c6269fa613f573a73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*58ueMy6qXHi90Qp8F4DyEQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">应用程序中的自定义梯度任务</p></figure><p id="3e87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要运行该任务，我们只需双击该任务或使用Gradle命令:</p><pre class="kg kh ki kj gt ok oa ol om aw on bi"><span id="5319" class="mx ma iq oa b gy oo op l oq or">./gradlew SampleTask</span></pre><h2 id="5c5f" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated"><strong class="ak">输出</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/c1093910f2b8ebadda2576c6207aee0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*z7unHP_nMPfZ0Jq5bOLc2w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">任务的输出。</p></figure><p id="5682" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下一部分，我将更深入地讨论Gradle任务，以及如何为插件添加配置。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="c2a1" class="mx ma iq bd mb my mz dn mf na nb dp mj lf nc nd ml lj ne nf mn ln ng nh mp ni bi translated">参考</h2><div class="ot ou gp gr ov ow"><a href="https://docs.gradle.org/current/userguide/custom_plugins.html" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">开发定制的Gradle插件</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">除了作为独立项目编写的插件之外，Gradle还允许你提供用任何一种语言编写的构建逻辑…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">docs.gradle.org</p></div></div></div></a></div></div></div>    
</body>
</html>