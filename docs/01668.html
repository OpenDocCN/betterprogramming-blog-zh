<html>
<head>
<title>CI/CD for Flutter Apps Using GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub动作的Flutter应用程序的CI/CD</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ci-cd-for-flutter-apps-using-github-actions-b833f8f7aac?source=collection_archive---------2-----------------------#2019-10-03">https://betterprogramming.pub/ci-cd-for-flutter-apps-using-github-actions-b833f8f7aac?source=collection_archive---------2-----------------------#2019-10-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1909" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">该项目在flutter.io上为一个flutter项目配置GitHub操作，以测试、构建和发布一个APK。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/656c649f55bc79be5a10a7a37e0cdd95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ytax01u_fYvZZ5WsJ5UAMQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub对颤振的作用。</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ky kz l"/></div></figure><blockquote class="la lb lc"><p id="c2e0" class="ld le lf lg b lh li ju lj lk ll jx lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">该项目现已在颤振官网<a class="ae ma" href="https://flutter.dev/docs/deployment/cd" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> <em class="it">持续部署</em> </strong> </a>版块中精选。</p></blockquote><p id="2925" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">为GitHub上的项目添加CI/CD工作流的自动化工具GitHub Actions 目前已推出测试版。(<strong class="lg iu">更新- Github Actions现已正式退出测试</strong>)</p><p id="bfd1" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">尽管离11月13日<strong class="lg iu"/>的公开发布还有一个多月的时间，GitHub marketplace已经看到了许多帮助几乎所有主要平台的CI/CD的行动。</p><p id="2b6d" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">在本文中，我们将讨论为一个<a class="ae ma" href="https://flutter.dev" rel="noopener ugc nofollow" target="_blank"> Flutter </a>应用程序集成CI/CD工作流的各个步骤。</p><p id="1691" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">注册GitHub Actions公测版，如果你还没有注册的话- <a class="ae ma" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="2bcd" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">1.创建GitHub项目</h1><p id="6faf" class="pw-post-body-paragraph ld le it lg b lh nd ju lj lk ne jx lm mb nf lp lq mc ng lt lu md nh lx ly lz im bi translated">显而易见的第一步是创建一个GitHub项目，并将您的Flutter项目与资源库连接起来。</p><p id="9d10" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">如果您已经成功完成了Actions beta的注册过程，您应该能够在pull requests的右侧看到一个新的<em class="lf"> Actions </em> <strong class="lg iu"> </strong>选项卡<strong class="lg iu"> </strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e010732b2e45405b91c8f548ba8f2448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DBU6hKPv91L0X_sqAn1l2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">存储库中的“操作”选项卡。</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="d752" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated"><strong class="ak"> 2。添加工作流文件</strong></h1><p id="a7c7" class="pw-post-body-paragraph ld le it lg b lh nd ju lj lk ne jx lm mb nf lp lq mc ng lt lu md nh lx ly lz im bi translated">GitHub为目前最流行的平台提供了许多预定义的工作流，您也可以在可视化编辑器中定制或创建全新的工作流。</p><p id="ffc5" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">但是，在这个项目中，我们将遵循使用工作流命令创建YAML文件的手动方法。</p><p id="21b7" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">在您的Flutter项目的根文件夹中，创建一个新文件夹<code class="fe nj nk nl nm b">.github</code>和一个子文件夹<code class="fe nj nk nl nm b">workflows</code>。这是我们的工作流YAML文件将驻留的地方。</p><p id="3770" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">一个项目可以有多个工作流文件，如构建、发布等。，但是为了简单起见，我们将在这个项目中只使用一个文件。在工作流文件夹中创建一个名为<code class="fe nj nk nl nm b">main.yml</code>的最终文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/8c6af5d9c3cfdada9f41f34500947730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XhlRw-8D9gAeuV_psXSXXA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建GitHub文件夹并添加工作流文件</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="aefa" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">3.<strong class="ak">写命令</strong></h1><p id="712f" class="pw-post-body-paragraph ld le it lg b lh nd ju lj lk ne jx lm mb nf lp lq mc ng lt lu md nh lx ly lz im bi translated">我们定义的第一件事是我们希望触发工作流的事件。这可以是任何GitHub事件，如push、pull_request、create等。，根据您的要求。</p><p id="14da" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">在这个项目中，我们将使用push事件。我们还可以向工作流添加一个名称来标识它。这里是<code class="fe nj nk nl nm b">main.yml.</code>的完整代码，为了更好地理解，我们将仔细检查每一行及其用法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no kz l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">main.yml</p></figure><p id="7c3c" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">line 1</code>:当有人将代码推送到我们的repo时，我们希望触发我们的工作流。</p><p id="fae5" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">lines 3–6</code>:我们正在定义一个在<code class="fe nj nk nl nm b">ubuntu-latest</code>上运行的作业<code class="fe nj nk nl nm b">Build APK</code>。每个作业都在虚拟环境的一个新实例中运行。一个作业可以包含一个或多个<code class="fe nj nk nl nm b">steps</code>。</p><p id="0a8a" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">这是我们工作流程的第一步。我们将从我们的存储库中提取源代码，为此，我们将使用一个名为<a class="ae ma" href="https://github.com/actions/checkout" rel="noopener ugc nofollow" target="_blank"><em class="lf">check out</em></a><em class="lf">的GitHub动作。</em>该操作将您的存储库签出到<code class="fe nj nk nl nm b">$GITHUB_WORKSPACE</code>，以便您的工作流可以访问存储库的内容。</p><p id="e829" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">lines 9-11</code>:在第二步中，我们将使用另一个GitHub动作设置构建Android应用程序所需的Java环境，名为<a class="ae ma" href="https://github.com/actions/setup-java" rel="noopener ugc nofollow" target="_blank"><em class="lf">setup-Java</em></a><em class="lf">。</em></p><p id="f248" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">lines 12–14</code>:这里我们使用GitHub action <a class="ae ma" href="https://github.com/marketplace/actions/flutter-action" rel="noopener ugc nofollow" target="_blank"> <em class="lf">颤振-action </em> </a> <strong class="lg iu"> </strong>，其中<strong class="lg iu"> </strong>设置了一个颤振环境供actions使用。</p><p id="74dd" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">line 15</code>:获取Flutter项目的依赖关系。</p><p id="d38a" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">line 16</code>:运行颤振测试。</p><p id="d8bf" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">line 16</code>:建立app的调试APK。<code class="fe nj nk nl nm b">—- split-per-abi</code>用于构建多个APK，避免构建一个胖APK，其中包含为<em class="lf">所有</em>目标ABI编译的代码</p><p id="53f6" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">line 17</code>:使用GitHub动作<a class="ae ma" href="https://github.com/marketplace/actions/create-release" rel="noopener ugc nofollow" target="_blank"> <em class="lf">创建发布</em> </a> <em class="lf">将APK推送到存储库的发布。</em> <strong class="lg iu"> </strong>这里，我们在构建和指定<code class="fe nj nk nl nm b">*.apk</code>之后指定apk存放的路径，以确保两个apk都被推送到release。</p><p id="a0bd" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">secrets.TOKEN</code> <strong class="lg iu"> </strong>是一个API令牌，授予对存储库的访问权。在下一步中，我们将创建一个并将其添加到我们的项目中。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="88ab" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">4.添加GitHub令牌</h1><p id="13bd" class="pw-post-body-paragraph ld le it lg b lh nd ju lj lk ne jx lm mb nf lp lq mc ng lt lu md nh lx ly lz im bi translated">我们大多数人都会在某个时候创建一个GitHub令牌来访问存储库，如果你没有，这个过程非常简单直接。</p><ul class=""><li id="20b9" class="np nq it lg b lh li lk ll mb nr mc ns md nt lz nu nv nw nx bi translated">转到GitHub设置中的<a class="ae ma" href="https://github.com/settings/tokens" rel="noopener ugc nofollow" target="_blank">个人访问令牌</a>部分。</li><li id="a50c" class="np nq it lg b lh ny lk nz mb oa mc ob md oc lz nu nv nw nx bi translated">生成一个可以访问存储库的新令牌，并复制其值。</li><li id="98b5" class="np nq it lg b lh ny lk nz mb oa mc ob md oc lz nu nv nw nx bi translated">在<code class="fe nj nk nl nm b">&lt;repo url&gt;/settings/secrets</code>转到项目的存储库设置。在<em class="lf"> Secrets </em>选项卡中，从您的工作流文件(本项目中为<code class="fe nj nk nl nm b">TOKEN</code>)中添加一个具有相同令牌名称的新秘密，并粘贴令牌值。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/d2b5032498de900dce7552f341992b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NzWFHJPtnujzjCpmjxZKsw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在存储库设置中添加新令牌。</p></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="87b3" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">5.用标签推送代码</h1><p id="82ba" class="pw-post-body-paragraph ld le it lg b lh nd ju lj lk ne jx lm mb nf lp lq mc ng lt lu md nh lx ly lz im bi translated">一旦我们创建了工作流文件并向我们的项目添加了令牌，我们就可以用release标签将代码推送到GitHub并触发工作流。</p><p id="7ce1" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">在您的本地项目中，提交所有文件，包括<code class="fe nj nk nl nm b">main.yml</code> <strong class="lg iu"> </strong>和<strong class="lg iu"> </strong>使用<code class="fe nj nk nl nm b">git tag</code>命令添加一个新的<strong class="lg iu"> </strong>标签，并将代码与标签一起推送。</p><p id="d97c" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">示例:</p><p id="d55c" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">git tag v1.0</code></p><p id="67c1" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated"><code class="fe nj nk nl nm b">git push origin v1.0</code></p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="c798" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">在GitHub中查看工作流和发布</h1><p id="d946" class="pw-post-body-paragraph ld le it lg b lh nd ju lj lk ne jx lm mb nf lp lq mc ng lt lu md nh lx ly lz im bi translated">一旦你推送了代码，你就可以通过<code class="fe nj nk nl nm b">&lt;repo URL&gt;/actions</code>看到工作流程，通过<code class="fe nj nk nl nm b">&lt;repo URL&gt;/releases</code>看到发布文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/1aae5f8965771cc78447837f67f27cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zia8T7hIqmBt4FkwntJLFA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">触发的工作流历史记录</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/1c3b82d4cd3a5950750553383ca46c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fEwNPbQzdMq8ztAG9q_FOg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为推送事件执行的工作流命令</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/9ea78cbddbf27dd2ad78bf4506010084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ziE03b5Dtz-5rvyyZXRufw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">存储库的发布部分中的apk</p></figure><p id="aad0" class="pw-post-body-paragraph ld le it lg b lh li ju lj lk ll jx lm mb lo lp lq mc ls lt lu md lw lx ly lz im bi translated">就是这样。你可以在<a class="ae ma" href="https://github.com/nabilnalakath/flutter-githubaction" rel="noopener ugc nofollow" target="_blank"> GitHub </a> <strong class="lg iu">上找到该项目的完整源代码。如果你有任何问题，请在评论区发表。</strong></p></div></div>    
</body>
</html>