<html>
<head>
<title>How To Control a SpriteKit Game Using SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用SwiftUI控制SpriteKit游戏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-swiftui-games-using-spritekit-ii-fa0e5df8648b?source=collection_archive---------9-----------------------#2021-06-24">https://betterprogramming.pub/build-swiftui-games-using-spritekit-ii-fa0e5df8648b?source=collection_archive---------9-----------------------#2021-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c29d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用SpriteKit和SwiftUI开发游戏</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5d3909091070eba99c1ab05aada38720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A50chliE__q3pazb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@rihok?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Riho Kroll </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="7042" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近发表了一篇关于结合SwiftUI使用SpriteKit的文章。我很高兴地说，它很受欢迎:</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/build-swiftui-games-using-spritekit-deb069535765"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">使用SpriteKit构建SwiftUI游戏</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">SwiftUI、SpriteKit和缺失触摸手势</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">better编程. pub</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="4527" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在其中，我创建了一个简单的游戏，使用SpriteKit游戏场景的矩阵和一些SwiftUI代码来排列它们。应用程序的重点是用SpriteKit控制SwiftUI界面。</p><p id="a6b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我想做相反的事情。我将使用一个单一的游戏场景，这次是在SwiftUI界面中，但重点是SwiftUI控制sprite kit——无论如何在某种程度上。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="76dc" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">旅程</h1><p id="8305" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">让我们构建一个游戏，玩家需要在物体飞来时接住它们。我将把iOS设备分成两个屏幕。顶部的屏幕是显示器，而下面的是控制面(我需要为本文改变方向)。</p><p id="9dc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">游戏场景代码与我在另一篇文章开始时使用的版本略有不同，因为我想更新<code class="fe nr ns nt nu b">GameScene</code>而不需要它自己重绘。此外，我必须在类中添加几个控制变量，以便于SwiftUI代码和<code class="fe nr ns nt nu b">GameScene</code>之间的同步。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="1acd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nr ns nt nu b">ContentView</code>中的SwiftUI代码显然也大不相同，本文详细介绍了我为<code class="fe nr ns nt nu b">drag</code>手势所需的模板代码。我用这个手势直接更新精灵的位置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="07b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在下面的动画GIF中看到最终结果。创建这样一个简单的界面证明了苹果的框架是多么强大。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/b86e9d4e3ba574f9df2412df4f1bf35f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tJkbWyysDaNhfm_TVDUVsQ.gif"/></div></div></figure><p id="f7e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">复制代码并尝试一下。这很有趣，但需要微调。滞后不是很理想，但是还可以。这使得它更具挑战性，尽管我很容易失去我的方块这一事实有点致命。</p><p id="feec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，我需要做的第一件事就是修改消失法案。我在<code class="fe nr ns nt nu b">GameScene</code>中添加了几行代码来解决这个问题:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="4c63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我这样做是为了宽度和高度，确保我悬停的红色框停留在屏幕上——即使当我拖动得有点太过，嗯，热情了。</p><p id="8566" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我应该在这里提到，我也考虑过<code class="fe nr ns nt nu b">SKActions</code>，找到了<a class="ae ky" href="https://medium.com/hackernoon/a-guide-to-spritekit-actions-c20b079f5398" rel="noopener">Jeremy Jacobson</a>的这篇文章，并尝试使用与<code class="fe nr ns nt nu b">drag</code>手势相对的按钮，但感觉不对，我又回到了<code class="fe nr ns nt nu b">drag</code>。</p><p id="67f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我需要改变游戏启动和实际进展的方式。我也需要在界面上添加一些按钮。我还想增加一些精灵。我想让它看起来更圆一些。此时的目标是达到这个阶段:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/a68ee7e80c7183e6fc604beaa681a27a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BZOZYuq27XqqFv5NbWd16w.gif"/></div></div></figure><p id="a646" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我是怎么做到的？首先，我给<code class="fe nr ns nt nu b">ContentView</code>(我的标准SwiftUI应用)添加了两个按钮。然后，我添加了一个布尔变量来开始创建绿色小石头，并将它链接到按钮动作。我还把我现在的绿色控制表面改成了圆角矩形，并给<code class="fe nr ns nt nu b">SpriteView</code>添加了一个圆角矩形遮罩。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="c54a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我移动到我的<code class="fe nr ns nt nu b">GameScene.swift</code>上，添加代码来创建绿色的盒子(石头)并将它们随机放置在屏幕的顶部(在动画GIF中的左边)。我给<code class="fe nr ns nt nu b">GameScene</code>添加了物理元素，最后设置了方块，这样当它们碰到台面时就会消失。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="040e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，我减缓了重力，这样绿色的岩石就不会移动得太快，我就可以避开或者抓住它们。如果你想让它更有挑战性，你要找的线是这条:</p><pre class="kj kk kl km gt oa nu ob oc aw od bi"><span id="5799" class="oe mv it nu b gy of og l oh oi">PhysicsWorld.gravity = CGVector(dy:0, dx:0.1)</span></pre><p id="da03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我游戏的目标是移动红色方块，这样我就能抓住绿色的石头。接下来要做的工作是添加碰撞检测。我开始也给我的红色方块一个物理实体，尽管我确保关闭了所述节点上的重力。我用这两行来做:</p><pre class="kj kk kl km gt oa nu ob oc aw od bi"><span id="672d" class="oe mv it nu b gy of og l oh oi">box.physicsBody = SKPhysicsBody(rectangleOf: CGSize(width: 40, height: 40))<br/>box.physicsBody?.affectedByGravity = false</span></pre><p id="a8f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我可以抓住绿色的小石头了——至少这两个方块是相互作用的。</p><p id="7965" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是在积木碰撞时做些什么。要做到这一点，我需要使用委托协议，向我们的<code class="fe nr ns nt nu b">GameScene</code>添加一个扩展，在这个扩展中，我添加代码来删除绿色石头，如果它击中红色方块。我们的游戏看起来会像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/031ba73fa7178e1921a4320dd90ec6ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cV_uZG4bZkzGyOB1hg7hDQ.gif"/></div></div></figure><p id="534e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我快好了。现在我需要一些动态的东西，当你抓住绿盒子的时候，它会显示进度。我在这篇文章的<a class="ae ky" href="https://medium.com/codex/gradient-in-sprite-kit-84e4b3092778" rel="noopener">中看到了一个由</a><a class="ny nz ep" href="https://medium.com/u/b7bdb0fad1c4?source=post_page-----fa0e5df8648b--------------------------------" rel="noopener" target="_blank"> Artturi Jalli </a>提出的极好的精灵纹理建议/扩展，并将这个想法应用到了游戏中。</p><p id="23d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我编辑了<code class="fe nr ns nt nu b">GameScene</code>,这样盒子和石头碰撞时都会被删除。后者只是作为另一块落下的绿色岩石重新出现。前者也是，但是使用了我刚刚提到的前一篇文章中记录的方法。</p><p id="083e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我添加了一个<code class="fe nr ns nt nu b">gameOver</code>变量来计算碰撞发生的次数，以及一个随着次数增加而应用的纹理数组。纹理基本上是将块从红色变成绿色。如果一块绿色的石头砸到你，而你没有红色的石头，那么游戏就结束了。这是最后一场比赛:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/26a72a72fd96f33735c25865477b54e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3kbuOHbIyoPI_sluU4SLGA.gif"/></div></div></figure><p id="b568" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在游戏结束的场景中，红色的盒子和绿色的石头都不会回来。</p><p id="07e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们介绍了在SwiftUI中创建一个<code class="fe nr ns nt nu b">GameScene</code>，通过SwiftUI中的控件控制所述的<code class="fe nr ns nt nu b">GameScene</code>，以及一些有用的SpriteKit编码技术。下面是<code class="fe nr ns nt nu b">GameScene</code>的最终代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="1578" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而<code class="fe nr ns nt nu b">ContentView</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h2 id="dbc0" class="oe mv it bd mw oj ok dn na ol om dp ne li on oo ng lm op oq ni lq or os nk ot bi translated">额外学分</h2><p id="db2c" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">你可以改变游戏的动态。也许你可以让绿色的石头掉得更快。也许你可以添加多个绿色岩石。也许你可以把绿色的石头变大。也许把你的红盒子变大。也许你可以改变相关的形状。你可以加一个计时器。你可以将控制界面从<code class="fe nr ns nt nu b">drag</code>改为按钮甚至滑块。你可以改变绿色盒子的方向，让它们朝多个方向落下。你甚至可以添加一些声音，跟随大卫·派珀的这篇文章。如果你非常有信心，你可以在不同的设备之间拆分控制视图和显示视图。我不久前写的这篇文章描述了如何做到这一点。这个简单的想法有很大的潜力。</p><p id="f4ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说到这里，我将结束这篇文章。我希望你在里面剪切并粘贴了插图代码，并尝试创建你自己的游戏版本。</p><div class="lv lw gp gr lx ly"><a href="https://marklucking.medium.com" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">马克·卢金-中号</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">style关键字出现在Swift的许多结构中。我认为这是一个很少有人真正使用的工具，这是一个…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">marklucking.medium.com</p></div></div><div class="mh l"><div class="ou l mj mk ml mh mm ks ly"/></div></div></a></div></div></div>    
</body>
</html>