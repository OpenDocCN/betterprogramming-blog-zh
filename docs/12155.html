<html>
<head>
<title>Serving and Deploying ML Models With Seldon Core on Kubernetes 2022</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes 2022上使用Seldon Core服务和部署ML模型</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/serving-deploying-ml-models-with-seldon-core-on-kubernetes-2022-eb459bb4d47a?source=collection_archive---------8-----------------------#2022-05-16">https://betterprogramming.pub/serving-deploying-ml-models-with-seldon-core-on-kubernetes-2022-eb459bb4d47a?source=collection_archive---------8-----------------------#2022-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7cd1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Kubernetes下部署Ml模型作为微服务</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/32d19e46260b9d04ef06e9bb60fa5701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ZfdQ6P8VDrG2lZ1-BSLJbQ.jpeg"/></div></figure><p id="0af2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在数据科学领域，我们曾经听说预处理需要80%的时间，并且它是机器学习管道中成功的ML模型的最重要的任务，但是当我们需要将“成功的”ML模型部署到生产中时，80%到90%的ML训练模型从未投入生产，这是由于许多因素(数据的一致变化，模型退化)或者甚至有时它在intern上表现良好，但是一旦我们部署该模型，我们就会失去准确性(例如，我们有图像分类；我们的模型是在猫和狗上训练的，但是我们给他一张大象的图片)。此外，模型部署是一项艰巨的任务，需要花费大量的资源和时间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lj"><img src="../Images/fd9479b0753d6a690a271ae84d94dc5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IXT9T8dK3jSPgRihQfrPag.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated"><strong class="bd ls">来源:</strong> <a class="ae lt" href="https://www.phdata.io/blog/what-is-the-cost-to-deploy-and-maintain-a-machine-learning-model/" rel="noopener ugc nofollow" target="_blank"> phdata.io博客</a></p></figure><p id="6042" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们认识到MLOps方法在当今机器学习项目中的重要性，特别是CI/CD/CT(持续集成、开发和培训)使这项任务变得更加容易和流畅。<br/>例如，我们正在尝试对一幅猫或狗的图像进行分类，我们已经训练了五个模型，但是随着数据的不断变化，我们可能会有一个新的模式显示出来，我们的模型在尝试对它进行分类时遇到了困难，所以我们必须花很短的时间根据新的输入训练新的模型，然后在没有问题或人们在生产中识别它的情况下部署它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lu"><img src="../Images/4c54ec2321556a7583bbfec32b5a553e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oy4TjGPGGk0Q01trQ2IngQ.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">Mlops堆栈</p></figure><p id="f3a4" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们还可以通过三个阶段(数据处理、数据建模和操作化)来定义MLOps管道。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lv"><img src="../Images/ae6b089ffc1b17924afbb5a15b3ca9ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AWqg0HUzxs9d8rtXDs1K7g.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">MlOps管道</p></figure><p id="af81" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们将致力于模型服务和部署部分，为了处理这个重要的任务，我们将使用Seldon Core，它是一个成熟的开源工具，包含重要的文档。在本教程中，我们将部署一个在MNIST数据集上训练的基本CNN模型。</p><h2 id="f47f" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated">什么是模特服务？</h2><p id="d83d" class="pw-post-body-paragraph kn ko iq kp b kq mp jr ks kt mq ju kv kw mr ky kz la ms lc ld le mt lg lh li ij bi translated">一旦我们开发出一个机器学习模型，我们就需要将它部署到生产中，允许最终用户从移动应用程序或浏览器的API访问它，以便应用程序可以将人工智能融入他们的系统。模型服务是至关重要的，因为一个企业不能在不使其产品可访问的情况下向大量用户提供人工智能产品。在生产中部署机器学习模型还涉及资源管理和模型监控，包括操作统计和模型漂移。</p><h2 id="478d" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated">塞尔顿核心</h2><blockquote class="mu mv mw"><p id="3537" class="kn ko mx kp b kq kr jr ks kt ku ju kv my kx ky kz mz lb lc ld na lf lg lh li ij bi translated">Seldon处理成千上万个生产机器学习模型的扩展，并提供开箱即用的高级机器学习功能，包括高级度量、请求日志、解释器、离群点检测器、A/B测试、Canaries等。</p></blockquote><p id="c83d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">需求</strong> —在本教程中，我们需要一个谷歌云账户，这样我们就可以用Docker将我们训练过的MNIST分类器保存在一个谷歌桶和一个可用的Kubernetes环境(Minikube或Kind)中。</p><h2 id="6048" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated">迷你库贝</h2><blockquote class="mu mv mw"><p id="5798" class="kn ko mx kp b kq kr jr ks kt ku ju kv my kx ky kz mz lb lc ld na lf lg lh li ij bi translated">Minikube对于K8s初学者来说是一个很好的工具，它是一个本地的Kubernetes环境，有简单易学的基本命令。<br/>我们将使用Docker容器来启动我们的Kubernetes集群。</p></blockquote><p id="b4d0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">安装Minikube </strong> —我们可以从他们的官方文档网站<a class="ae lt" href="https://minikube.sigs.k8s.io/docs/start/" rel="noopener ugc nofollow" target="_blank">这里</a>安装，我们可以通过命令<code class="fe nb nc nd ne b">kubectl version</code>验证是否安装好</p><h2 id="922e" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated">码头工人</h2><blockquote class="mu mv mw"><p id="3042" class="kn ko mx kp b kq kr jr ks kt ku ju kv my kx ky kz mz lb lc ld na lf lg lh li ij bi translated"><em class="iq"> Docker是一个开发、发布和运行应用程序的开放平台。Docker使您能够将应用程序从基础设施中分离出来，这样您就可以快速交付软件</em></p></blockquote><p id="086f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">安装docker </strong> —如果没有安装<strong class="kp ir"> Docker </strong>，<a class="ae lt" href="https://docs.docker.com/desktop/windows/install/" rel="noopener ugc nofollow" target="_blank">点击这里</a>安装。</p><p id="30c8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一旦我们设置好环境，我们就可以安装Seldon Core，但它需要验证一些先决条件:</p><ul class=""><li id="7847" class="nf ng iq kp b kq kr kt ku kw nh la ni le nj li nk nl nm nn bi translated">Kubernetes集群版本等于或高于1.18</li><li id="e098" class="nf ng iq kp b kq no kt np kw nq la nr le ns li nk nl nm nn bi translated">在我们的例子中，安装方法是Helm 3.0或更高版本</li><li id="cbec" class="nf ng iq kp b kq no kt np kw nq la nr le ns li nk nl nm nn bi translated">从外部访问我们不同集群服务的入口(Istio 1.5或Ambassador v1)</li></ul><h2 id="f846" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated">舵</h2><blockquote class="mu mv mw"><p id="039b" class="kn ko mx kp b kq kr jr ks kt ku ju kv my kx ky kz mz lb lc ld na lf lg lh li ij bi translated">Helm是一个Kubernetes部署工具，用于为Kubernetes集群自动创建、打包、配置和部署应用程序和服务。我们可以根据您的操作系统从<a class="ae lt" href="https://helm.sh/docs/intro/install/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir">这里</strong> </a>安装它，我们需要将它添加到我们的环境变量中，这样我们就可以启动我们的<strong class="kp ir">舵</strong>命令。</p></blockquote><h2 id="96a3" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated">伊斯迪奥</h2><blockquote class="mu mv mw"><p id="5833" class="kn ko mx kp b kq kr jr ks kt ku ju kv my kx ky kz mz lb lc ld na lf lg lh li ij bi translated">Istio扩展了Kubernetes，使用强大的特使服务代理建立了一个可编程的、应用感知的网络。Istio可处理Kubernetes和传统工作负载，为复杂的部署带来标准、通用的流量管理、遥测和安全性。我们可以从这里的<a class="ae lt" href="https://istio.io/latest/docs/setup/getting-started/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir">安装</strong> </a> <strong class="kp ir">。</strong></p></blockquote><p id="a74d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在一切都是古驰，我们可以开始安装谢顿核心，但首先，我们将在我们的K8s集群中为它创建一个<code class="fe nb nc nd ne b">namespace</code>。</p><p id="7d2f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">要启动我们的K8s集群，我们可以从以下内容开始:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="8acf" class="lw lx iq ne b gy nx ny l nz oa">minikube start</span></pre><p id="e0c1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们可以通过<code class="fe nb nc nd ne b">minikube status</code>验证一切是否正常</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ob"><img src="../Images/1bf979f2a727e47d0ef783a4c30a07ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SaEdBBUATcjB3eg6NG_dxw.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">Minikube状态</p></figure><p id="d08e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然后我们可以用<code class="fe nb nc nd ne b">kubectl create namespace seldon-system</code>创建我们的名称空间，你可以给它起任何你想要的名字，但是最好是用这个名字。</p><p id="ed28" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在我们将安装我们的工具:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="2812" class="lw lx iq ne b gy nx ny l nz oa">helm install seldon-core seldon-core-operator \<br/> — repo <a class="ae lt" href="https://storage.googleapis.com/seldon-charts" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/seldon-charts</a> \<br/> — set usageMetrics.enabled=true \<br/> — set istio.enabled=true \<br/> — namespace seldon-system</span></pre><p id="15ce" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果你使用的是Windows命令行，你可以用<code class="fe nb nc nd ne b">^</code>来改变<code class="fe nb nc nd ne b">\</code></p><p id="40c3" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们可以通过检查管理<code class="fe nb nc nd ne b">seldon-core</code>的pod的健康状况来验证它:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="aa72" class="lw lx iq ne b gy nx ny l nz oa">kubectl get pods -n seldon-system</span></pre><h2 id="611d" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated"><strong class="ak">训练MNIST分类器</strong></h2><p id="3147" class="pw-post-body-paragraph kn ko iq kp b kq mp jr ks kt mq ju kv kw mr ky kz la ms lc ld le mt lg lh li ij bi translated">我们将创建自己的CNN基本模型来对我们从0到9的不同数字进行分类。让我们创建一个新的python文件，我们将其命名为<code class="fe nb nc nd ne b">mnist_predict.py</code> <em class="mx">。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="78c3" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们的模型将保存在我们的文件夹<code class="fe nb nc nd ne b">saved_model</code>中，然后我们将通过google bucket将它存储在我们的Google存储中。要创建你的Google bucket，你可以勾选<a class="ae lt" href="https://cloud.google.com/storage/docs/creating-buckets?hl=en" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><p id="8b16" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">由于分类器是用Tensorflow软件包训练的，我们必须创建一个名为<strong class="kp ir"> <em class="mx"> 1、</em> </strong>的新目录，并将我们训练好的模型保存在那里。我们要像这样的东西。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/8b461c15ca7b0d55fe59d68148e4522d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xK3laeDM-SGcpVj0avySOg.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">Google bucket概述</p></figure><h2 id="2cab" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated">服务帐户</h2><blockquote class="mu mv mw"><p id="7d9a" class="kn ko mx kp b kq kr jr ks kt ku ju kv my kx ky kz mz lb lc ld na lf lg lh li ij bi translated">服务帐户是一种特殊类型的非人类特权帐户，用于执行应用程序和运行自动化服务、虚拟机实例和其他进程。服务帐户可以是特权本地帐户或域帐户，在某些情况下，它们可能具有域管理特权。</p></blockquote><p id="298c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们将创建一个GCP和一个JSON键，所以我们可以从不同的API访问我们的存储模型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi of"><img src="../Images/74282d0201040968e53c2195b154974c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*06z6xRIXPNr-fOUk4Ifj-g.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi og"><img src="../Images/80ea1806b40f537d5fbd6d8c98eb3b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*An5VoIa6hYRiT9OQG7NnTg.png"/></div></div></figure><p id="9678" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">指定服务帐户的唯一名称后，我们只需点击Done按钮，然后生成JSON文件，该文件将允许我们访问存储的MNIST分类器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oh"><img src="../Images/bcb4ba6a66b385fdb82977d27978909a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GRF2_xHO3m_4QGPVACIXLw.png"/></div></div></figure><p id="dc77" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们创建一个新的关于JSON扩展的键。此外，我们只需下载我们的JSON文件，用一个简单的名字如<code class="fe nb nc nd ne b">seldon-credentials</code>重命名它，并把它放在同一个目录中。</p><p id="7db0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让我们创造我们的秘密:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="2778" class="lw lx iq ne b gy nx ny l nz oa">kubectl create secret generic user-gcp-name --from-file=gcloud-application-credentials.json=&lt;LOCALFILE&gt;</span></pre><p id="9737" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我们的例子中，我们的<code class="fe nb nc nd ne b">LOCALFILE</code>将是<code class="fe nb nc nd ne b">seldon-credentials</code>，用户名可以是任何东西。</p><p id="6f55" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们的服务帐户可以通过YAML文件创建:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="5a78" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe nb nc nd ne b">kubectl apply -f serviceaccount.yaml</code></p><p id="64ec" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，我们负责部署Ml模型的很少部署对象替换了<code class="fe nb nc nd ne b">gs://&lt;your_bucket_name&gt;/mnist</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="8cee" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe nb nc nd ne b">kubectl apply -f seldondeployment.yaml</code></p><p id="63b8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">最后但同样重要的是，我们将创建入口文件，该文件将允许我们通过不同的外部服务访问我们部署的模型。</p><p id="3288" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们将不得不用<code class="fe nb nc nd ne b">kubectl get svc</code>检查我们的新服务，并把它放入我们的配置YAML文件中的服务名参数。<br/>对于您的<code class="fe nb nc nd ne b">host</code>参数，您可以只放入<code class="fe nb nc nd ne b">localhost</code>或者在您的<code class="fe nb nc nd ne b">/etc/hosts</code>文件中定义一个自定义的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="1ecb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们通过相同的命令创建入口:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="9343" class="lw lx iq ne b gy nx ny l nz oa">kubectl apply -f ingress.yaml</span></pre><p id="f912" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，既然一切正常，我们可以得到我们的辅导成果，这就是预测。</p><p id="cb64" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让我们最后看一下我们的数据集:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="fa9e" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated"><strong class="ak">通过Rest webservice进行预测</strong></h2><p id="af8a" class="pw-post-body-paragraph kn ko iq kp b kq mp jr ks kt mq ju kv kw mr ky kz la ms lc ld le mt lg lh li ij bi translated">我们创建了两个函数，一个用于查看我们选择的要预测的MNSIT数字，最后一个用于其余部分的预测。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/13f19289de3374aa69246fd3bf4774f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*iDFewVvgS5Rk99msJ5TlUg.png"/></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">要预测的输出列表</p></figure><p id="e6b2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们必须将我们的pod进行端口转发，以便我们可以访问群集外部的mnist分类器，这可以通过以下方式完成:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="0a77" class="lw lx iq ne b gy nx ny l nz oa">kubectl port-forward pods/pod-name desired-port-number:9000</span></pre><p id="5a6e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">因为这是一个Rest预测，所以可以使用9000端口来完成，并且您可以使用<code class="fe nb nc nd ne b">kubectl get pods</code> <br/>来获得pod名称。我们选择端口号9500作为所需的端口号，我们的预测可以这样完成:</p><pre class="kg kh ki kj gt nt ne nu nv aw nw bi"><span id="e790" class="lw lx iq ne b gy nx ny l nz oa">result = rest_predict_request("mnist.plz:9500", data) <br/>result</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oj"><img src="../Images/82dfc42fb12fdb94e726a4f8f3c52810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tBme63p60X8lbvQDcnT9og.png"/></div></div><p class="lo lp gj gh gi lq lr bd b be z dk translated">模型预测法</p></figure><p id="3dd9" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">值字段总共有十个值(用逗号分隔)。第一个值表示图像为“0”的概率，第二个值表示图像为“1”的概率，依此类推。</p><p id="6dff" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">因此，第九个值表示该图片是“8”的最高概率，我们可以看到该模型表现良好，因为数字8预测分数是99%的可靠准确度。</p><h1 id="535b" class="ok lx iq bd ly ol om on mb oo op oq me jw or jx mh jz os ka mk kc ot kd mn ou bi translated">结论</h1><p id="6440" class="pw-post-body-paragraph kn ko iq kp b kq mp jr ks kt mq ju kv kw mr ky kz la ms lc ld le mt lg lh li ij bi translated">在本教程结束时，我们能够将我们的模型部署为Kubernetes下的微服务。</p><p id="0cc6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Seldon Core支持许多我在本文中没有提到的高级特性，但是我鼓励您仔细阅读该项目的<a class="ae lt" href="https://docs.seldon.io/projects/seldon-core/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">大量文档</a>，以便更好地理解它的整体设计和丰富的特性集。</p><p id="c5e9" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我会写更多关于谢顿核心的文章，阐述不同的复杂推论部分，并挑战它的不同特性。小心点！！</p><h1 id="0f5b" class="ok lx iq bd ly ol om on mb oo op oq me jw or jx mh jz os ka mk kc ot kd mn ou bi translated">参考</h1><ol class=""><li id="4a0f" class="nf ng iq kp b kq mp kt mq kw ov la ow le ox li oy nl nm nn bi translated"><a class="ae lt" href="https://docs.seldon.io/projects/seldon-core/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">谢顿核心——谢顿核心文件</a></li><li id="85af" class="nf ng iq kp b kq no kt np kw nq la nr le ns li oy nl nm nn bi translated"><a class="ae lt" href="https://minikube.sigs.k8s.io/docs/" rel="noopener ugc nofollow" target="_blank">欢迎光临！| minikube (k8s.io) </a></li><li id="3f15" class="nf ng iq kp b kq no kt np kw nq la nr le ns li oy nl nm nn bi translated"><a class="ae lt" href="https://cloud.google.com/storage/docs/creating-buckets?hl=en" rel="noopener ugc nofollow" target="_blank">创建存储桶|云存储|谷歌云</a></li></ol></div></div>    
</body>
</html>