<html>
<head>
<title>How to Proxy Into an NFT Minting DAO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何代理成NFT铸造刀</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-proxy-into-an-nft-minting-dao-51f5a574a007?source=collection_archive---------12-----------------------#2022-09-21">https://betterprogramming.pub/how-to-proxy-into-an-nft-minting-dao-51f5a574a007?source=collection_archive---------12-----------------------#2022-09-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4d24" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">组织NFT收藏从铸造刀与小代理合同</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f80a835ab9a051667a434a84290fc190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TQ_dCuHIIAGEcVvzu7PgMw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">现有第三方智能合约的概念性代理视图。照片由Pixabay.com<a class="ae kv" href="https://pixabay.com/users/geralt-9301/" rel="noopener ugc nofollow" target="_blank">geralt</a>提供。</p></figure><p id="7fb8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不可变生态系统DAO(或不可变DAO)是由<a class="ae kv" href="https://immutablesoft.org" rel="noopener ugc nofollow" target="_blank"> ImmutableSoft </a>创建的一个小型智能合同集合，这是一个开放的公益501(c)(3)非营利组织。加入这个开放DAO的成员可以保护他们的数字所有权，并向用户许可他们创作的最终用户权利。</p><p id="284f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过将他们的数字创作的文件校验和(SHA256)记录在NFT铸造的链上，由数字创作者的钱包签名的带有时间戳且不可变的交易记录证明了第一出处，这是证明所有权的关键一步。</p><p id="44e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最初设计用于保护面向公众的文件/软件发布，伪造和欺诈吸引了传统的NFT创作者到我们的DAO。关于这一运动的更多信息，请参见NFTs 中的<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/creator-provenance-within-nfts-7353e9e435c0">创建者出处。本文继续我们的DAO之旅，描述我们的成员如何部署他们自己的智能契约代理来区分他们的NFT的特定集合的细节。</a></p><p id="5b3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于NFT收藏来说，当在我们的dApp(即NFT观众和第三方交易所)之外观看用不变刀铸造的艺术NFT时，问题就出现了。由于历史原因(元数据标准)，ERC721智能合约函数成为“集合”名称。我们的DAO的每个成员都铸造了它们自己唯一的NFT——成员ID嵌入在每个铸造的<code class="fe ls lt lu lv b">tokenId</code>中(参见<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/serializing-data-within-large-integers-433684c8e7cd">在大整数内序列化数据</a>)。</p><p id="c792" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，由于所有DAO成员的所有NFT都是由同一个智能契约创建的，所以它们都出现在第三方交换(OpenSea、Rarible等)的同一个“集合”中。).这可能会给高端NFT艺术品拍卖等带来不太好的体验(至少可以这么说)。</p><p id="6df2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然为ERC721 <code class="fe ls lt lu lv b">name()</code>函数添加一个可选的<code class="fe ls lt lu lv b">tokenId</code>参数或者一个新的函数<code class="fe ls lt lu lv b">collectionName(tokenId)</code>会很好，但这可能不会在任何时候支持NFT minting DAOs的出现。作为一个迫切需要解决的问题，我们通过允许不可变DAO的成员部署一个小的智能契约来解决这个问题，这个小的智能契约覆盖集合“name”，但是代理所有其他智能契约ERC721对相关DAO智能契约的调用(在本例中是<a class="ae kv" href="https://immutablesoft.github.io/ImmutableEcosystem/docs/CreatorToken.html" rel="noopener ugc nofollow" target="_blank"> CreatorToken </a>)。</p><p id="dea4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，通过代理智能合约地址查看“集合”的第三方将看到唯一的集合名称，并且只看到特定于该集合的NFT。令牌实现的其他部分也可以被覆盖。如果需要，这个代理可以作为将NFT完全移出DAO的基础(带有escape子句的代理)。</p><p id="d225" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于代理和可升级智能合约已经讨论了很多；然而，这种类型的代理不太复杂，因为主数据总是驻留在DAO智能契约上，而不是代理上。这意味着，与可升级代理不同，不使用<code class="fe ls lt lu lv b">delegateCall()</code>。</p><p id="4176" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相反，用DAO主契约的地址初始化代理(参见Polygonscan上的<a class="ae kv" href="https://polygonscan.com/address/0x02a5d5c9c22eedfabe54c42cd81f907ffb27567c#readProxyContract" rel="noopener ugc nofollow" target="_blank"> CreatorToken </a>)允许每个ERC721令牌接口函数将调用代理到不可变的DAO智能契约中。这在很大程度上是一对一的关系。</p><p id="c9f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要进行一次性初始化，以便用不可变的DAO智能契约和实体和产品id(在DAO中定义)来配置代理，从而限制代理集合。但是，ERC721和相关的可枚举接口，如<code class="fe ls lt lu lv b">totalSupply()</code>、<code class="fe ls lt lu lv b">tokenByIndex()</code>、<code class="fe ls lt lu lv b">balanceOf()</code>和<code class="fe ls lt lu lv b">tokenOfOwnerByIndex()</code>不是一一对应的可翻译接口。这些ERC721标准函数必须只返回不可变DAO中对应于特定创建者的产品(即这个集合)的NFT的子集。为了实现上述所有四(4)个核心函数，我们创建了一个内部函数来支持所有变量，从计算令牌数到哪个索引对应哪个令牌。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="5503" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个代理智能契约很小，部署起来也不贵。对于可扩展性，代理本身可以是可升级的智能合约。这种双重代理是首选的NFT收集可能变形，改变或以其他方式开放进一步发展。上述NFT集合的DAO代理需要进行初始化更改，以继承基于<a class="ae kv" href="https://www.openzeppelin.com/" rel="noopener ugc nofollow" target="_blank"> OpenZeppelin </a>的可升级性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="c344" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个代理的最终目标是将来自DAO的令牌ID转换成只使用发布ID，而不与实体和产品标识符序列化。序列化的DAO标记是非常大的整数，使用NFT查看器或交换无法兼容或理解。删除序列化允许NFT代理令牌标识符从1开始，并按照本机ERC721令牌的预期时间顺序排列。为了做到这一点，我们添加了一个助手函数<code class="fe ls lt lu lv b">idToDAO()</code>,并使用它从代理翻译到对DAO的每个后续调用。代理NFT集合现在在第三方交换机上与本机令牌无法区分。</p><pre class="kg kh ki kj gt ly lv lz ma aw mb bi"><span id="ba2d" class="mc md iq lv b gy me mf l mg mh">  /// <a class="ae kv" href="http://twitter.com/notice" rel="noopener ugc nofollow" target="_blank">@notice</a> Convert tokenID from this proxy to ImmutableSoft DAO<br/>  /// <a class="ae kv" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> tokenId The proxy identifier (only release id)<br/>  /// <a class="ae kv" href="http://twitter.com/return" rel="noopener ugc nofollow" target="_blank">@return</a> The CreatorToken (ImmutableSoft) token Id<br/>  function idToDAO(uint256 tokenId)<br/>    public view returns (uint256)<br/>  {<br/>    return ((_entity &lt;&lt; commonInterface.EntityIdOffset()) &amp;<br/>            commonInterface.EntityIdMask()) |<br/>           ((_product &lt;&lt; commonInterface.ProductIdOffset()) &amp;<br/>            commonInterface.ProductIdMask()) |<br/>           ((tokenId &lt;&lt; commonInterface.ReleaseIdOffset()) &amp;<br/>            commonInterface.ReleaseIdMask());<br/>  }</span><span id="3b19" class="mc md iq lv b gy mi mf l mg mh">  /// <a class="ae kv" href="http://twitter.com/notice" rel="noopener ugc nofollow" target="_blank">@notice</a> Look up the release URI from the token Id<br/>  /// <a class="ae kv" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> tokenId The unique token identifier<br/>  /// <a class="ae kv" href="http://twitter.com/return" rel="noopener ugc nofollow" target="_blank">@return</a> the file name and/or URI secured by this token<br/>  function tokenURI(uint256 tokenId) public view<br/>      returns (string memory)<br/>  {<br/>    return creatorToken.tokenURI(idToDAO(tokenId));<br/>  }<br/>...</span></pre><p id="b85a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用这个代理来覆盖<code class="fe ls lt lu lv b">tokenURI()</code>也是可能的。这有助于法律契约，其中不可变的道NFT保护私有文件(签署的契约等)。)和PoE哈希。然而，代理智能合约返回由第三方验证私有文件的证书的公共NFT元数据图像。请参阅我们的另一篇文章<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/ricardian-contract-interoperability-9b9e2919dc43">李嘉图合同互操作性</a>，了解有关该合同服务提供商场景的更多信息。</p><p id="292d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个重要的用例是游戏物品，例如，一个<code class="fe ls lt lu lv b">tokenURI()</code>可以被重载以允许整个收藏库URI的动态变化。有了对<code class="fe ls lt lu lv b">tokenURI()</code>的覆盖，可以为代理所有者添加一个新的<code class="fe ls lt lu lv b">setTokenBaseURI()</code>功能，通过一个调用将他们游戏的所有NFT移动到一个新的web2域，借鉴了ERC1155标准的效率。</p><p id="dd80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过一个基本集合URI，令牌id(或者来自不可变DAO私有文件的尾随文件名)被添加到URI基本集合中，并由<code class="fe ls lt lu lv b">tokenURI()</code>输出。代理所有者负责托管web2 URI端点，该端点提供用于显示此NFT的JSON元数据详细信息。一些项目可能还希望以某种方式公开<code class="fe ls lt lu lv b">mint()</code>,以加强NFT创建的一致性和/或简化与DAO相比的接口。</p><p id="2e61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要查看完整的实现，可以在我们的核心GitHub库找到<a class="ae kv" href="https://github.com/ImmutableSoft/ImmutableEcosystem/blob/master/contracts/CollectionProxy.sol" rel="noopener ugc nofollow" target="_blank">。由于实体和产品标识符是在部署时定义的，因此每个人都可以使用相同的智能合约，而无需进行更改。我们以一个示例结束，展示了一个客户使用<code class="fe ls lt lu lv b">10_deploy_collection_proxy.js</code>部署脚本部署他们自己的代理。</a></p><p id="12c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的示例成员已经注册了他们的实体名称，并在市场中创建了一个产品。创建的产品的Developers选项显示唯一的和不可变的实体和产品编号，分别是值二(2)和零(0)。从我们的dApp看这张图片。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mj"><img src="../Images/811556a1bef73cccd0239fdb98710ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_TF-x_9R6EItiBoYo1qFvw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">DAO用户在dApp的Developers选项卡上发现他们的实体和产品标识符。</p></figure><p id="72ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们克隆存储库，并使用命令提示符(本例中为MS Windows)安装与NPM的依赖关系。这需要NPM，所以确保NPM已经安装在您的开发系统上，或者在继续之前安装。</p><pre class="kg kh ki kj gt ly lv lz ma aw mb bi"><span id="7fae" class="mc md iq lv b gy me mf l mg mh">D:\&gt;git clone <a class="ae kv" href="https://github.com/ImmutableSoft/ImmutableEcosystem.git" rel="noopener ugc nofollow" target="_blank">https://github.com/ImmutableSoft/ImmutableEcosystem.git</a><br/>Cloning into 'ImmutableEcosystem'...<br/>remote: Enumerating objects: 803, done.<br/>remote: Counting objects: 100% (85/85), done.<br/>remote: Compressing objects: 100% (60/60), done.<br/>Receiving objects:  98% (787/803), 10.53 MiB | 10.52 MiB/sremote: Total 803 (delta 44), reused 42 (delta 24), pack-reused 718<br/>Receiving objects: 100% (803/803), 14.72 MiB | 10.65 MiB/s, done.<br/>Resolving deltas: 100% (451/451), done.</span><span id="c064" class="mc md iq lv b gy mi mf l mg mh">D:\&gt;cd ImmutableEcosystem</span><span id="6177" class="mc md iq lv b gy mi mf l mg mh">D:\ImmutableEcosystem&gt;npm install<br/>...<br/>D:\ImmutableEcosystem&gt;truffle compile --all<br/>...<br/>D:\&gt;</span></pre><p id="4864" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果最后一步出现错误，请确保为NPM全球安装了truffle(<code class="fe ls lt lu lv b">npm install -g truffle</code>)。一旦合同被编译，我们打开部署文件<code class="fe ls lt lu lv b">10_deploy_collection_proxy.js</code>，并将初始化参数(下面粗体部分)更改为我们唯一的实体和这个集合的产品标识符。</p><p id="e185" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本例中，集合名称是“Computer Systems”，令牌符号是“CSI”，不可变的DAO实体是two (2)和product zero (0)(见上图)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="b02c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦部署文件被更改，最后一步就是在EVM网络(在这个例子中是Polygon Mainnet)上只运行这个部署。您需要用您的钱包恢复字填充<code class="fe ls lt lu lv b">secrets.json</code>，以便用正确的私钥签署智能合约部署交易。</p><p id="21ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请确保在部署后从该文件中删除恢复单词——不要将它们提交给git存储库。</p><p id="c41d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">建议使用没有高加密价值(只有gas)的钱包来部署和管理智能合同所有权，以避免您的开发系统成为黑客的目标。</p><pre class="kg kh ki kj gt ly lv lz ma aw mb bi"><span id="499c" class="mc md iq lv b gy me mf l mg mh">D:\&gt;ImmutableEcosystem&gt;truffle migrate --f 10--to 10--compile-none --skip-dry-run --network polygon_mainnet</span></pre><p id="a687" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用上面输出的已部署代理智能合约地址，浏览您最喜欢的第三方NFT交易所，在新集合名称下只能看到该产品的NFTs。请注意，部署将要求代理所有者与向不可变DAO注册的实体id的wallet地址相同。这将有助于保护代理生态系统。参见上面的源代码链接，了解我们如何做到这一点的细节。</p><p id="b83f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，一个DAO成员可以部署的代理数量没有限制。尽管如此，每个产品必须是唯一的产品，并且所有产品都必须是该产品的注册实体地址所拥有的产品(并且DAO产品的名称必须与集合名称相匹配！).carpe partem for DAO minted collections代理智能合约！</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="08ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这条穿越区块链丛林的小路，请留下你的评论。</p></div></div>    
</body>
</html>