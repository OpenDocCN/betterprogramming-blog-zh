<html>
<head>
<title>How to Run a Simple Flask Application in a Container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在容器中运行一个简单的Flask应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-run-a-simple-flask-application-in-a-container-691fbbd91fcf?source=collection_archive---------15-----------------------#2022-08-03">https://betterprogramming.pub/how-to-run-a-simple-flask-application-in-a-container-691fbbd91fcf?source=collection_archive---------15-----------------------#2022-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="62c5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">面向各种操作系统的开发人员</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/afcb23c4267248157d17dff641f36e93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q_dqBcbDUzwZVYyA"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@williamtm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">威廉·胡克</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0991" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您正在测试一个理论，并希望快速启动一个Python应用程序容器。也许您只是在学习如何将一个简单的Python应用程序容器化。欢迎阅读这篇文章，在这里我们将做到这一点。</p><p id="beec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一件事是保持我们家的秩序。在您的工作站上安装Python。我假设您使用的是基于Unix的系统。</p><p id="9cac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个文件夹来托管应用程序，并创建第一个<code class="fe ls lt lu lv b">main.py</code>文件。因为我们不想将我们的应用程序与系统范围的Python库混合在一起，所以安装pipenv使我们能够在当前目录下安装这个应用程序的包。然后我们将使用pipenv安装flask、gunicorn和requests包。这将创建一个包含应用程序依赖关系的Pipfile。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="aa47" class="ma mb iq lv b gy mc md l me mf">$ mkdir singlepageflask </span><span id="be75" class="ma mb iq lv b gy mg md l me mf">$ touch main.py</span><span id="3b21" class="ma mb iq lv b gy mg md l me mf">#install pipenv<br/>$ python3 -m pip install pipenv</span><span id="79cc" class="ma mb iq lv b gy mg md l me mf"># install dependencies; flask, gunicorn and requests packages<br/>$ python3 -m pipenv install flask gunicorn requests</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="1ebb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将创建一个入口脚本，在您想要运行此应用程序时使用。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="caee" class="ma mb iq lv b gy mc md l me mf">$ touch appentry.sh<br/>$ chmod +x appentry.sh</span></pre><p id="94d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加以下内容，以便在脚本运行时启动gunicorn wsgi服务器。gunicorn命令只是调用<code class="fe ls lt lu lv b">main.py</code>文件中的app变量，并监听<code class="fe ls lt lu lv b">port 8000</code>上的所有地址。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="c7ac" class="ma mb iq lv b gy mc md l me mf">#!/bin/bash<br/>python3 -m gunicorn main:app -w 2 --threads 2 -b 0.0.0.0:8000</span></pre><p id="c97e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过运行<code class="fe ls lt lu lv b">./appentry.sh</code>进行本地测试。</p><p id="17a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试docker文件在本地运行后，创建一个docker文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="f2c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，在我们的<code class="fe ls lt lu lv b">appentry.sh</code>中，我们声明我们的应用程序应该从任何地址<code class="fe ls lt lu lv b">0.0.0.0</code>监听。这将使容器能够接受来自外部的请求。</p><p id="f668" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Podman构建应用程序并启动容器，同时将主机<code class="fe ls lt lu lv b">port 8000</code>映射到容器<code class="fe ls lt lu lv b">port 8000</code>。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="3c45" class="ma mb iq lv b gy mc md l me mf">#build the container image<br/>$ podman build -t singlepage .</span><span id="a580" class="ma mb iq lv b gy mg md l me mf">#start a container using the image and map to host on port 8000<br/>$ podman run -d -p 8000:8000 --name singlepage singlepage</span><span id="e998" class="ma mb iq lv b gy mg md l me mf">#Test the endpoint;<br/>$ curl http://localhost:8000/jokeme</span></pre><p id="7536" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过向<code class="fe ls lt lu lv b"><a class="ae kv" href="http://localhost:8000/jokeme" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/jokeme</a></code>发送请求，使用curl命令或您最喜欢的API测试应用程序从您的工作站测试应用程序。</p><p id="a8a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在我位于<a class="ae kv" href="https://github.com/Wainaina3/publications.git" rel="noopener ugc nofollow" target="_blank"> branch singleflask </a>的git仓库中找到完整的代码。</p><p id="fb4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于Windows用户，您可能会遇到容器找不到<code class="fe ls lt lu lv b">appentry.sh</code>脚本的问题。这是因为windows使用CRLF行尾，而Unix(容器是基于Unix的)使用LF行尾。</p><p id="c65a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，当您在windows上创建脚本并尝试在容器上运行它时，它无法正确解释脚本，从而导致令人困惑的“没有找到这样的文件或目录”错误。</p><p id="74ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要纠正这一点，请将<code class="fe ls lt lu lv b">appentry.sh</code>脚本的行尾从CRLF转换为LF。</p></div></div>    
</body>
</html>