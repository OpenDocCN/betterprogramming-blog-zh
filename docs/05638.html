<html>
<head>
<title>Cleaning Code, Refactoring in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">清理代码，在SwiftUI中重构</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/cleaning-code-refactoring-in-swiftui-6e288a05bc2d?source=collection_archive---------8-----------------------#2020-07-23">https://betterprogramming.pub/cleaning-code-refactoring-in-swiftui-6e288a05bc2d?source=collection_archive---------8-----------------------#2020-07-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="88ce" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过一个代码重构的例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/91ccac40e03e697b81a0abf41d64a0bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zQ3R5UfSW6sAH5zH"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@jstrippa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">詹姆斯哈里森</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="b918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们在开发一个虚构的客户简报时，尝试使用一些更好的编码实践。</p><p id="14ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">注意:我使用的是运行SwiftUI 2.0的Xcode测试版。如果你想浏览这些例子，你也需要同样的东西。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="aaca" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">案情摘要</h1><p id="d7b0" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我将使这变得简单明了，因为这是一个教程。这份简报需要五个盒子——一个大的在中间，四个小的在边缘。点击时，所有五个框都应该向其中一个较小的框的方向移动，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/98d9b70b78fee45a593127f4b3cdfeb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/1*qgpyDL8RdUk5eRtjXrouww.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">客户的简报</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="077a" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">解决方案</h1><p id="38b9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这看起来很容易。这是我们完成这项工作的代码初稿。一个快速简单的实现。注意，主循环的主体大约有45行。这是我们重构时需要解决的问题:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6341" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好吧，那我们是怎么做到的？嗯，我们简单地在一些<code class="fe nd ne nf ng b">ZStacks</code>中创建了五个矩形，并添加了一些<code class="fe nd ne nf ng b">onTapGestures</code>来在它们被点击时移动这些框。现在让我们试着让这段代码变得更好。</p><p id="8f37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以做的第一件事是确保我们没有使用幻数(即文字数字)。我们可以在代码中用常量替换它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="94cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个看起来更好。没有所有数字的点缀，代码可读性要高得多。此外，您现在可以更好地理解这些数字所代表的含义。</p><p id="6810" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来呢？浏览代码，有很多内容在重复。我们可以排除重新绘制方框的因素，并引入一个结构来激活手势:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="f68f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个看起来更好。正文现在减少到25行。我们能做得更多吗？嗯，我真的不喜欢用那些数学来移动那些<code class="fe nd ne nf ng b">@State</code>变量的盒子。我想要一些稍微明显的东西，所以我创建了一个enum并将代码放入方法本身。使用枚举可以让事情变得更加明显。</p><p id="9b10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还在principle结构的范围内移动了绘制框的方法，因为我最初是在顶层声明它们的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="acd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个稍微好一点，但是我们没有在主循环上节省太多。接下来呢？我们需要微调封装，因为它的正式名称是。我添加了<code class="fe nd ne nf ng b">public</code>和<code class="fe nd ne nf ng b">private</code>，让它变得非常明显。</p><p id="ba86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还考虑了对齐的方向，因为我想在流程中引入一个循环，并减少传递给它的参数数量。对齐可以直接映射到方向，所以这正是我所做的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8e0e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="21a3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这就把我带到了结尾。虽然我们从55行开始，到110行结束，但是几乎所有的初始行都在主循环中——这个循环占用了不止一个屏幕。相比之下，我们的主循环现在只包含11行代码，它的逻辑使得理解正在发生的事情更加容易。</p><p id="d359" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后说一句:我确实试图将角点<code class="fe nd ne nf ng b">var</code>和<code class="fe nd ne nf ng b">align</code>构造成私有的。然而，我当时无法编译它，因为预览抱怨保护水平。我注释掉了预览，并能够采取这最后一步。遗憾的是，这个问题说明预览版确实存在一些弊端。</p><p id="95cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保持冷静，继续编码。</p></div></div>    
</body>
</html>