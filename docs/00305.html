<html>
<head>
<title>Build System in Xcode 10 — Issues Faced and their Solutions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Xcode 10中的构建系统——面临的问题及其解决方案</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-systems-issues-and-solutions-in-xcode-10-6708d1613ef3?source=collection_archive---------0-----------------------#2019-03-14">https://betterprogramming.pub/build-systems-issues-and-solutions-in-xcode-10-6708d1613ef3?source=collection_archive---------0-----------------------#2019-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4fbc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Info.plists、Cocoapods、运行脚本等等</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6af4c368d6a4a680e9cf4df8af3b8c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eRJG_mAbzcuEifM0qpQdtw.png"/></div></div></figure><p id="9b15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">随着Xcode 10的推出，我们引入了一个新的编译和构建代码的构建系统。这个新的构建系统提供了改进的可靠性和构建性能，并且它捕捉到了遗留构建系统所没有的项目配置问题。</p><p id="1f64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">新的构建系统主要包括-</p><ul class=""><li id="abfc" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">使用共享设置</li><li id="ab34" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">新构建系统</li><li id="e058" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">遗留构建系统(这是一个很酷的名字！)</li></ul><p id="5627" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">尽管新的生成系统与现有项目兼容，但出于以下原因，有些项目可能需要更改:</p><ul class=""><li id="b024" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">新的构建系统对构建中元素之间的循环进行了更严格的检查，以防止不必要的重建。</li><li id="be67" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">由多个生成命令生成的生成中的任何单个文件都是错误的。例如，如果两个目标都从shell脚本阶段声明了相同的输出文件，那么必须将输出文件声明到单个目标中。</li><li id="610d" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如果shell脚本生成的输出文件用作构建中其他地方的输入(例如，另一个shell脚本的输入)，则该输出必须由生成它的脚本声明为显式输出，否则构建系统可能会在文件生成之前尝试搜索该文件，从而导致构建失败。</li><li id="7447" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">新的构建系统不支持在始终搜索用户路径(<code class="fe mb mc md me b">ALWAYS_SEARCH_USER_PATHS</code>)设置为<code class="fe mb mc md me b">YES</code>时生成的旧标题映射。相反，将<code class="fe mb mc md me b">ALWAYS_SEARCH_USER_PATHS</code>设置为<code class="fe mb mc md me b">NO</code>，并迁移到使用现代的头包含语法。将项目存储库中任何需要的头文件添加到Xcode项目中，以确保它们可用于#include(通过项目范围的头文件映射)。对项目标题使用引号样式的include ( <code class="fe mb mc md me b">"example.h"</code>)并对系统标题保留尖括号include ( <code class="fe mb mc md me b">&lt;example.h&gt;</code>)。</li><li id="d628" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">新的构建系统在运行shell脚本构建阶段时将<code class="fe mb mc md me b">undefined_arch</code>作为<code class="fe mb mc md me b">ARCH</code>环境变量的值传递。该值以前没有很好地定义。依赖于该值的任何shell脚本必须对正在构建的所有已定义架构正确运行，可通过<code class="fe mb mc md me b">ARCHS</code>环境变量获得。</li><li id="a9fa" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">新的构建系统使用“清理构建文件夹”行为。不支持传统的“清理”行为。</li></ul><p id="0712" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在Xcode项目中，如果我们转到Xcode -&gt;文件-&gt;项目/工作区设置，我们会发现类似这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/2efa82fd6efa0ed27e9ab65798ace45f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*MGJork1xyinvPMP7uN1fqA.png"/></div><p class="mg mh gj gh gi mi mj bd b be z dk translated"><strong class="bd mk"> Xcode - &gt;文件- &gt;项目/工作区</strong></p></figure><p id="462e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">配置为使用遗留构建系统的项目将在Activity视图中显示一个橙色的锤子图标:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/2afdf53b2482a4f9e7c1bac304a27ae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*2-T2la0APV2m5klkhwUasQ.png"/></div></figure><p id="acc1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以根据需求在遗留和新构建系统之间切换。</p><p id="0349" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">新的构建系统并行运行目标和构建阶段，以加速整体的快速构建。一旦从Xcode激活，我们将开始获得好处以及与我们的iOS项目中的新构建系统相关的问题。</p><p id="2215" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们面临很多问题，尤其是在不是Xcode 10而是Xcode以前版本的项目中。这些问题会对项目的构建产生负面影响——可能会弹出错误，不必要地中止特定项目的构建。</p><p id="5df6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Xcode新构建系统强调的一些最常见的错误以及当前解决这些错误的方法如下。</p><h1 id="6214" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">1.信息。Plist</h1><p id="1a24" class="pw-post-body-paragraph kr ks iq kt b ku ne jr kw kx nf ju kz la ng lc ld le nh lg lh li ni lk ll lm ij bi translated">当使用新的构建系统构建iOS项目时，info.plist文件开始出现几个问题。下面是一些关于新构建系统和Info.plist文件的规则。</p><h2 id="3b77" class="nj mn iq bd mo nk nl dn ms nm nn dp mw la no np my le nq nr na li ns nt nc nu bi translated"><strong class="ak">解决方法</strong></h2><ul class=""><li id="27e1" class="ln lo iq kt b ku ne kx nf la nv le nw li nx lm ls lt lu lv bi translated">在任何目标的复制捆绑资源构建阶段都不应该有plist文件，否则新的构建系统将无法构建应用程序。此外，如果文件被多次复制到包中，它也不起作用。</li><li id="816f" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">新的构建系统在干净构建和增量构建中具有不同的运行Info.plist步骤的优先级。在干净构建中，info.plist步骤在处理资源之后，链接故事板之前。对于增量构建，它在签名前运行。</li><li id="c0b0" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如果目标只有Info.plist值，没有任何Xcode引用的文件夹，Xcode构建系统会导致构建失败。</li></ul><h1 id="894b" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">2.椰子足类</h1><p id="2b70" class="pw-post-body-paragraph kr ks iq kt b ku ne jr kw kx nf ju kz la ng lc ld le nh lg lh li ni lk ll lm ij bi translated">使用CocoaPods的iOS项目引入了一些问题。以下是一些常见问题。</p><h2 id="bfa6" class="nj mn iq bd mo nk nl dn ms nm nn dp mw la no np my le nq nr na li ns nt nc nu bi translated">工作区</h2><ul class=""><li id="fb1e" class="ln lo iq kt b ku ne kx nf la nv le nw li nx lm ls lt lu lv bi translated">除非我们执行干净的构建，否则开发单元不会更新。embed pods框架构建阶段执行不可靠。Github上有一个关于这个<a class="ae ny" href="https://github.com/CocoaPods/CocoaPods/issues/8073" rel="noopener ugc nofollow" target="_blank">的问题。</a></li><li id="d364" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">应用程序的存档可能会失败，或者应用程序中可能会有古怪的行为-一些Cocoapods相关的构建阶段脚本不能可靠地运行。</li></ul><p id="0509" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">简而言之，Cocoapods和新的构建系统不能很好地协同工作。</p><h1 id="da31" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">3.运行脚本阶段</h1><p id="3629" class="pw-post-body-paragraph kr ks iq kt b ku ne jr kw kx nf ju kz la ng lc ld le nh lg lh li ni lk ll lm ij bi translated">使用新的构建系统，您可能会遇到运行脚本阶段开始失败或给出不稳定结果的问题。是有原因的。</p><p id="0e0e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在Xcode 10中，运行-脚本-构建阶段改进了很多。然而，我们必须通过为运行脚本阶段指定一些输入文件来帮助构建过程。如果我们为运行脚本阶段指定了输入文件，这对于构建系统决定是否需要为依赖的目标构建运行脚本是很重要的。Xcode构建系统试图并行运行一些任务，如果运行脚本阶段的输入还没有生成，那么构建系统会变得混乱并失败。</p><h2 id="488b" class="nj mn iq bd mo nk nl dn ms nm nn dp mw la no np my le nq nr na li ns nt nc nu bi translated">工作区</h2><p id="f104" class="pw-post-body-paragraph kr ks iq kt b ku ne jr kw kx nf ju kz la ng lc ld le nh lg lh li ni lk ll lm ij bi translated">在适用的情况下，向运行脚本提供输入文件总是一个好主意。当输入文件的数量增加时，Xcode 10为我们提供了一种在。xcfilelist格式。我们可以在构建阶段添加这个文件作为文件列表输入。<em class="nz">当没有输入文件</em>、输入文件改变或输出文件丢失时，Xcode构建系统将一直运行这个构建阶段。重要的是添加那些文件，以避免在不需要的时候为所有的增量构建运行这个阶段。</p><h1 id="c2bd" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">4.清理生成文件夹操作</h1><p id="b127" class="pw-post-body-paragraph kr ks iq kt b ku ne jr kw kx nf ju kz la ng lc ld le nh lg lh li ni lk ll lm ij bi translated">在新的构建系统中，Xcode的清理操作已经被<em class="nz">弃用</em>，并且引入了清理构建文件夹操作。此操作会从iOS应用程序中移除所有派生数据，从头开始创建更干净的构件。这意味着如果你使用Cocoapods，它将从头开始重新构建所有的框架，并导致构建iOS项目的巨大延迟。如果你使用Carthage和预建的框架，它不会对你有太大影响。如果你有建造部落的习惯，你需要格外小心等待。您可能还会面临Xcode索引速度慢的问题。</p><h1 id="66b0" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">5.XCCONFIG文件</h1><p id="0331" class="pw-post-body-paragraph kr ks iq kt b ku ne jr kw kx nf ju kz la ng lc ld le nh lg lh li ni lk ll lm ij bi translated">你们中的大多数人可能正在使用。xcconfig文件，以便为特定目标将Xcode构建设置保存在一个地方。xcconfig文件中的条件变量赋值可能不会按预期工作，从而导致生成失败。</p><h2 id="2374" class="nj mn iq bd mo nk nl dn ms nm nn dp mw la no np my le nq nr na li ns nt nc nu bi translated">工作区</h2><p id="a48f" class="pw-post-body-paragraph kr ks iq kt b ku ne jr kw kx nf ju kz la ng lc ld le nh lg lh li ni lk ll lm ij bi translated">为了检查你的xcconfig文件，Apple建议运行一个命令，如果这个命令显示任何警告或错误，我们需要修复它以获得稳定的版本。命令是:</p><p id="eadb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mb mc md me b">defaults write com.apple.dt.XCBuild EnableCompatibilityWarningsForXCBuildTransition -bool YES</code></p><p id="1202" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这在Xcode 10中是默认设置的，所以我们迟早要更新我们的构建过程来适应新的构建系统。当然，它将为应用程序带来许多配置增强！</p><p id="ca1d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">务必阅读并分享！！</p></div></div>    
</body>
</html>