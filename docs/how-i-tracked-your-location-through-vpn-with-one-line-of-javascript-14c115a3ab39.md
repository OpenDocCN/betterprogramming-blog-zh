# 使用一行 JavaScript 通过 VPN 跟踪位置

> 原文：<https://betterprogramming.pub/how-i-tracked-your-location-through-vpn-with-one-line-of-javascript-14c115a3ab39>

## 利用国际化 API

![](img/f37e9db826a613d8f89b30a72e93b8fd.png)

杰佛森·桑多斯在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

浏览器是用户和他们的服务之间的主要连接点。因此，为保护它们付出巨大努力就不足为奇了。

一段时间以前，浏览器因为为开发者提供了更多的功能来创造更新更好的网络体验而备受推崇。自从科技巨头被曝光收集用户信息并跟踪每一个行动，甚至通过不同的网站，这种情绪已经发生了变化。

这种认识引发了浏览器 API 开发人员和跟踪脚本开发人员之间的军备竞赛。从那时起，你的浏览器有越多的功能和选项，你就有越多的选项来更精细地跟踪每个用户。

追踪用户的最简单方法之一是将数据存储在 cookies 或本地存储中。你需要做的就是放一个足够大的随机值，用户就被唯一跟踪了。

然而，这也带来了一些挑战。例如，这些数据可能会超时，并在浏览器重新启动或私人选项卡关闭后被删除。此外，在西方国家，用户必须明确允许通过这种方式被跟踪，因此这可能会使这些企图变得相当明显。

有一种追踪方法是这些方法都做不到的，那就是追踪用户的实际位置。现在很多人使用 VPN 都有很好的理由，他们可以给你一点额外的隐私。一个问题是，它可能会弄乱一些关于你的网站使用的统计数据，并使你的浏览器会话更难安全。

假设您正在登录您的银行网站。登录后，您的银行会存储您的 IP 地址，甚至可能会尝试估计您的位置。突然，另一个连接与您的会话令牌一起出现，但这一次它来自世界的另一端。这有两个看似合理的原因:

*   你的帐户刚刚被泄露了
*   您刚刚启用了从其他地方出现的 VPN

你的银行应该怎么做？禁止该会话并要求用户再次登录。从长远来看，这可能会让 VPN 给人们带来更多不便。允许连接吗？每年有成千上万的人受到这种方案的影响，这种额外的安全措施可以为他们节省大量的时间、精力和金钱。

拥有用户位置的真实统计数据是一场隐私噩梦，但有时这可能会有很大帮助。这就是为什么我开始挖掘浏览器 API，并试图创建一个庞大的表格，列出它们可能向开发人员公开的所有内容。

我的第一个想法是:键盘布局。不是所有的键盘布局在确定位置上都非常有用。几乎所有的开发者都在全球范围内使用美国布局，但它给出了一个参考点。如果有人使用德语键盘布局登录，两秒钟后突然加载了另一个页面，而他们使用的是匈牙利语布局，这确实很可疑。

令我最惊讶的是，我发现了更好的东西。

每个现代浏览器中都嵌入了一个名为 Intl 的 API。这是一个国际化 API，它提供了显示为每个用户的语言习惯定制的数据的函数。例如，它有一个名为`NumberFormat`的类，该类根据当地习俗格式化要显示的数字类型 JavaScript 对象。

```
Intl.NumberFormat().format(3.6) // '3.6' or '3,6'
```

这个指标的“分辨率”不够高，不足以确定关于用户的更多信息，所以在进一步挖掘之后，我发现了一些更有趣的东西。

**时区。**

例如，在现代系统中，他们不再需要人们输入你与 CET 或 UTC 相差多少小时。相反，他们会问你你国家的首都或者附近的主要城市。浏览器可以查询这些数据，并将其传递给我们的 JavaScript 代码，代码只有一行:

```
const tz = Intl.DateTimeFormat().resolvedOptions().timeZone
```

在我的例子中，它返回`Europe/Budapest`。这并不精确，但是你可以看到，通过这一条信息，我们知道我们的用户位于欧洲匈牙利布达佩斯附近的某个地方。如果他们暴露给我们的 IP 地址来自美国德克萨斯州的一家小型电信公司，这可能会引发一些危险信号。

我们如何利用这些知识？

我在 GitHub 上准备了一个简短的演示，供大家试用:

[](https://github.com/dubniczky/VPN-Detect) [## GitHub - dubniczky/VPN-Detect:使用 JavaScript 在浏览器中检测 WPN

### VPN 检测在浏览器中使用 JavaScript 创建一个帐户并将 API 密钥复制到 detect.js…

github.com](https://github.com/dubniczky/VPN-Detect) 

你可以按照指示打开页面，然后玩一玩，看看它如何试图预测你的真实位置，以及你当时是否在使用 VPN。改变你的位置，打开和关闭你的 VPN，看看真正的效果。

解决问题的最佳方案通常都很简单。事实上，这个非常简单。

我希望你已经学到了一些东西。黑客快乐！