<html>
<head>
<title>Do Not Burn Your CPU Working With CSS Animations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不要燃烧你的CPU处理CSS动画</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/do-not-burn-you-cpu-working-with-css-animations-e4d19069fb0f?source=collection_archive---------3-----------------------#2019-12-19">https://betterprogramming.pub/do-not-burn-you-cpu-working-with-css-animations-e4d19069fb0f?source=collection_archive---------3-----------------------#2019-12-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dda5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在懒惰加载你的图片和css动画时要小心</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e2255232efd27b3d1ffa73b53f260bc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EPYRlMh6i9rFEGqxnaWMrg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">制造者在<a class="ae ky" href="https://unsplash.com/s/photos/css?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@nesabymakers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> NESA的照片</a></p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/8771d609b1bc7fb6ad0187612f5f58aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*J98mCnvfAo9YDWB-3pAByQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将笔记本电脑变成煎锅的动画</p></figure><p id="df70" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">嘿，大家都在看这个！最近，在处理惰性加载图像时，我遇到了一个问题，这个问题后来被证明是一个非常大的警告，在处理CSS动画时绝对需要考虑。</p><p id="88d1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">上面这个动画——一个简单的延迟加载图像的预加载动画——确实引起了一些麻烦。</p><p id="0b27" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这里，我想分享一些发现，见解，以及一些你在一个页面上处理大量CSS动画时可能会遇到的警告。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ea36" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">问题:无限循环动画</h1><p id="a310" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">长话短说，问题是有一些加载动画。这些是关键帧CSS动画，在加载图像之前显示闪烁效果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/311419b446fb99d4895066fed613f89b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PlpVdxR2taEgyoAeZRcJpQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们用于图像加载的闪烁动画</p></figure><p id="1441" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当开发人员和产品所有者意识到打开主页是将笔记本电脑变成直升机崇拜者，并且电池在大约30-40分钟内逐渐耗尽时，问题就出现了。</p><p id="fd84" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们开始挖掘，发现了这个:</p><p id="9b2e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们在页面上有20-50个无限循环动画，将MacBook Pro 2019 (i7)上的CPU在空闲网页上提升到60%。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="560a" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">那是怎么发生的？</h1><p id="4f5e" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">所以，最初的想法是为了节省一些流量，并在<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" rel="noopener ugc nofollow" target="_blank">十字路口观察器</a>的帮助下，让载入图像变得更慢。</p><p id="3999" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这是一个可靠和可持续的解决方案，所以它存在了一段时间，然后，为了改善UX，有一个设计决定，在未加载的图像上制作一个初始加载动画，当图像被请求但尚未显示给用户时，这是一种占位符，就像文章开头的那个。</p><p id="e591" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">听起来不错——你两全其美，既节省交通费用，又有好的UX。但是在主页上，我们恰好在某个时候有几个物品转盘，总共有120个物品。</p><p id="209a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">并且在99.9%的访问中，只显示了每个转盘的前5到10个元素。其他100个项目每秒钟循环一次CSS动画<em class="na">。</em></p><p id="d2e8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">事实上，对我来说这听起来很疯狂，但是想想它是如何一步一步地出现的，就有些道理了。当然，这不是故意的，但在某些时候，有一些稻草压断了骆驼的背，现在我们想解决这个问题。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="487a" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">显示优点的东西</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/677d53de32086ccbda54e51c43d3ef55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tA6LKtJOTYae7DSSD58ONg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">包含20个动画的空闲页面上的Chrome CPU使用情况-在MacBook Pro 2019 (i7)上测试</p></figure><p id="1cb8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这里，我创建了一个带有几个示例页面的<a class="ae ky" href="https://github.com/starikovm/cpu-usage-of-css-animations" rel="noopener ugc nofollow" target="_blank"> repo，这样您就可以检查每个页面的CPU使用情况，并看到不同之处。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="d55f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">解决办法</h1><p id="6818" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">对于旋转木马的初始情况，它结束得非常快速和简单——我们删除了动画以避免任何额外的缩放资源消耗。</p><p id="cc53" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然而，我想更深入地调查这个案子:</p><p id="20a4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在<a class="ae ky" href="https://en.clusterjobs.de" rel="noopener ugc nofollow" target="_blank"> clusterjobs.de </a>网站上，我们有一个招聘列表，上面有很多公司的logos都是惰性的。</p><p id="eade" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">提高加载占位符性能的第一个尝试是使用<code class="fe nb nc nd ne b">translateZ(0)</code>将动画关键帧移动到它们自己的复合层。简而言之，使用它将使浏览器使用GPU而不是CPU来制作动画。</p><p id="ec38" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">建议本身是针对<a class="ae ky" href="https://stackoverflow.com/questions/13176746/css-keyframe-animation-cpu-usage-is-high-should-it-be-this-way" rel="noopener ugc nofollow" target="_blank">这个栈溢出问题</a>给出的。</p><p id="8aa7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">还有就是这篇<a class="ae ky" href="https://www.smashingmagazine.com/2016/12/gpu-animation-doing-it-right/" rel="noopener ugc nofollow" target="_blank">好文章</a>关于GPU如何用于浏览器动画。免责声明—这里也有很多警告，主要是内存消耗。</p><p id="c66d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最后，在性能和用户体验之间，我们选择了性能，完全删除了动画，但提高了图像加载的阈值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/0ecd7f70ff746abc99d287388a42ccf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MLD_xx1TGxCTIx0zd38flg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">慢速3G节流网络上的延迟加载图像</p></figure><p id="71ac" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你可以在这里查看经验:<a class="ae ky" href="https://en.clusterjobs.de/search/react berlin" rel="noopener ugc nofollow" target="_blank">clusterjobs.de/search/react柏林</a>。这个想法是，当一个图像在用户视图的最低点达到200像素时，就开始加载，这样用户就可以更快地看到它了。</p><p id="9830" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">上面的例子是针对移动网络的，但是在没有节流的情况下，没有实际的闪烁，并且看不到延迟加载的事实。</p><p id="81e2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为此，您可以使用<a class="ae ky" href="https://github.com/aFarkas/lazysizes" rel="noopener ugc nofollow" target="_blank"> lazysizes </a>库。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f7b3" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="a9e9" class="pw-post-body-paragraph la lb it lc b ld mv ju lf lg mw jx li lj mx ll lm ln my lp lq lr mz lt lu lv im bi translated">最后我真的很惊讶，掉进那个陷阱有多容易，有多少人没有意识到。</p><p id="e43f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">动画确实对用户体验有影响，可以增加网站的趣味性，但过度使用或意外创建大量动画可能会给手机甚至笔记本电脑用户带来非常糟糕和令人不安的体验。</p><p id="1e00" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我的同事们说，从帖子开始就有100个动画的主页真的让笔记本电脑疯狂，电池泄漏得非常快。</p><p id="2a47" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">所以，我给自己上的一课是比平时更频繁地记住表演。</p><p id="3cac" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">例如，用一个简单的GIF代替生成CSS关键帧，延迟加载动画的例子可能完全不成问题。</p><p id="068c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">另一方面，如果它对页面来说确实是独一无二的，而且用CSS会更流畅，我还是会用CSS。</p></div></div>    
</body>
</html>