<html>
<head>
<title>Automate Your Scripts With Expect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Expect自动化您的脚本</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/automate-your-scripts-with-expect-9305faa6e2ff?source=collection_archive---------4-----------------------#2020-10-29">https://betterprogramming.pub/automate-your-scripts-with-expect-9305faa6e2ff?source=collection_archive---------4-----------------------#2020-10-29</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="615f" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用Expect脚本语言的强大功能来自动化您的程序</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/55e1368e8867bad8c6a39103e8c35096.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P0KtHGsZ7WT2gbz-"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">杰克·吉文斯在Unsplash上的照片</p></figure><p id="28b3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Expect是一种强大的脚本语言，可以与任何需要用户交互的程序交互。例如，如果您想自动运行一个程序，该程序要求最终用户键入一个密码并提供一些参数，Expect可以为您实现自动化。它的工作方式是，它期待输入并提供响应，而无需您键入任何内容。您可以将它与您的shell脚本集成在一起，以获得更高效的结果。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="c816" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">常见使用案例</h1><p id="a689" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Expect脚本的一些最强大的用例包括:</p><ul class=""><li id="ddb0" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">使用SSH连接到远程服务器</li><li id="6ef3" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">使用SCP传输文件</li><li id="df20" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">打印网络响应时间</li><li id="d6a9" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">执行<code class="fe no np nq nr b">fsck</code>命令来验证您的文件系统</li></ul><p id="daf9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这个简短的教程中，我们将了解如何登录到远程服务器并执行指定的脚本。</p><p id="7e27" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们开始吧！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="8dcf" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">安装Expect</h1><p id="bdb0" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">请注意，本教程是为基于Unix的操作系统编写的。</p><p id="69c4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一些基于Unix的系统已经包含了Expect。通过在您的终端中执行以下命令来检查它是否已安装:</p><p id="b80c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe no np nq nr b">which expect</code></p><p id="f2cf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您需要安装它，请根据您的操作系统执行以下命令之一:</p><ul class=""><li id="d6aa" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">对于Ubuntu发行版:</li></ul><pre class="kk kl km kn gu ns nr nt nu aw nv bi"><span id="bcd0" class="nw me iu nr b gz nx ny l nz oa">apt-get install expect</span></pre><ul class=""><li id="02cd" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">对于Red Hat发行版:</li></ul><pre class="kk kl km kn gu ns nr nt nu aw nv bi"><span id="96fc" class="nw me iu nr b gz nx ny l nz oa">yum install expect</span></pre><ul class=""><li id="c1a0" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">对于MAC OS——最简单的方法是使用<a class="ae kz" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">自制软件</a>:</li></ul><pre class="kk kl km kn gu ns nr nt nu aw nv bi"><span id="8893" class="nw me iu nr b gz nx ny l nz oa">brew install expect</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="74aa" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">创建一个Expect脚本SSH程序</h1><p id="182b" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">假设您想要执行一个bash脚本，如果一个特定的程序已经完成了它的输出，它会向管理员发送一封电子邮件。</p><ul class=""><li id="ab7a" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">创建一个名为<code class="fe no np nq nr b">autoexecutor.exp</code>的文件。</li><li id="f7fa" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">放以下内容。(代码解释在下面。)</li></ul><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ob oc l"/></div></figure><ul class=""><li id="a2eb" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">确保Expect命令路径与您的路径匹配。我的情况是<code class="fe no np nq nr b">#!/usr/bin/expect</code>。</li><li id="ffd5" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">我们声明我们期望的变量。该程序需要一个主机名、一个用户名、一个密码和我们想要在给定的远程服务器上执行的脚本的名称。它们将作为命令行参数被接收。</li><li id="ca59" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><code class="fe no np nq nr b">spawn</code> <strong class="lc iv"> </strong>命令用于启动一个脚本或程序，在这里是SSH。</li><li id="4c09" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">有时提示被定制得不同，如果我们不知道确切的提示，自动登录可能会有困难。使用<code class="fe no np nq nr b">set prompt</code>设置提示是一个很好的做法。</li><li id="780d" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><code class="fe no np nq nr b">interact</code> <strong class="lc iv"> </strong>命令从键盘读取输入，并返回当前进程的stdout和stderr。</li><li id="c20b" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><code class="fe no np nq nr b">-o</code>标志将任何随后的键-体对应用到当前进程的输出。</li><li id="66c0" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">在读取字符时，<code class="fe no np nq nr b">-nobuffer</code>标志输出与模式匹配的字符。基本上，它回应了这个模式。</li><li id="5bbe" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><code class="fe no np nq nr b">-re</code> <strong class="lc iv"> </strong>标志表示正则表达式模式。</li><li id="17c6" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><code class="fe no np nq nr b">return</code> <strong class="lc iv"> </strong>命令使交互返回给它的调用者。</li><li id="9f00" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><code class="fe no np nq nr b">send</code> <strong class="lc iv"> </strong>命令，顾名思义，向我们的程序发送一个回复—在本例中，是密码和远程命令。我们还使用它在脚本结束时退出服务器。</li><li id="2373" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">发送输入字符时，<code class="fe no np nq nr b">“\r”</code>用来表示返回字符。</li><li id="7795" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><code class="fe no np nq nr b">expect</code>命令等待输入。</li><li id="4116" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated"><code class="fe no np nq nr b">eof</code> <strong class="lc iv"> </strong>表示脚本结束。</li></ul><p id="56de" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过提供必要的参数来运行脚本。我们假设<code class="fe no np nq nr b">sendmail.sh</code> shell脚本存在于远程服务器上:</p><p id="55bf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe no np nq nr b">expect autoconnector.exp myhost myuser mypass /home/sendmail.sh</code></p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="9b55" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="1e28" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">我们已经看到，无论何时需要用户交互，Expect都是自动化脚本的强大工具。</p><p id="5a0a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望你学到了新的东西。感谢阅读和快乐编码！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="2342" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">参考</h1><ul class=""><li id="c2c4" class="na nb iu lc b ld mv lg mw lj od ln oe lr of lv nf ng nh ni bi translated">【https://linux.die.net/man/1/expect】</li></ul></div></div>    
</body>
</html>