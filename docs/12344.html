<html>
<head>
<title>How To Use Coverage and Test Reporters With LWC Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用LWC笑话利用报道和考验记者</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-coverage-and-test-reporters-with-lwc-jest-c40caedbf439?source=collection_archive---------8-----------------------#2022-05-30">https://betterprogramming.pub/how-to-use-coverage-and-test-reporters-with-lwc-jest-c40caedbf439?source=collection_archive---------8-----------------------#2022-05-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8fff" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为Lightning Web组件生成测试结果和代码覆盖报告</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4698bb610ff84d6af9f89d7e6aa33ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pE3gRDp9DDa2vkwM2aDWxQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Lightning web组件的LCOV HTML代码覆盖率报告示例</p></figure><p id="3275" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae lu" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>是一个JavaScript测试框架，适用于不同类型的项目，包括Angular、React以及Salesforce Lightning Web组件。尽管在Salesforce生态系统中，与<a class="ae lu" href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_code_coverage_intro.htm" rel="noopener ugc nofollow" target="_blank"> Apex代码覆盖率</a>相比，LWC单元测试及其覆盖率与部署无关，但在我看来，高覆盖率的良好测试对于确保UI中的高代码质量也很重要。</p><p id="89b2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">已经有很多关于Lightning Web组件Jest测试的优秀指南。因此，我想把重点放在本指南中的测试结果和覆盖率报告部分。</p><p id="82ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，让我们开始吧。</p><h1 id="2fa3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">默认LWC Jest配置</h1><p id="06ee" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">创建新的SFDX项目时，LWC单元测试的默认Jest配置位于项目根目录中，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="1efa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您保持这个配置不变，那么您可以使用下面的命令来计算当前已存在的LWC测试类的相应代码覆盖率:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="192c" class="mz lw it mv b gy na nb l nc nd">sfdx-lwc-jest --coverage</span></pre><p id="7223" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果<a class="ae lu" href="https://www.npmjs.com/package/@salesforce/sfdx-lwc-jest" rel="noopener ugc nofollow" target="_blank"> sfdx-lwc-jest </a>没有全局安装，只是作为当前项目的一个依赖项，您也可以在<code class="fe ne nf ng mv b">package.json</code>文件中添加相应的脚本，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/d6671ce268d559cf92e0b7d824d98d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nb75pBKM-HY1ZHb2H7oq6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">package.json中LWC测试执行的脚本</p></figure><p id="853d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后可以执行这些脚本，例如，如下所示:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="5989" class="mz lw it mv b gy na nb l nc nd">npm run test:unit:coverage</span></pre><p id="4035" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在运行命令并完成所有测试的执行之后，计算出的代码覆盖率会在终端中输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/aba6b98fe3a309c0410aa4a9ec651960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8YHwyzVm3qLsVq8TvyXU3g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">LWC代码覆盖的终端输出</p></figure><p id="93ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，在项目的<code class="fe ne nf ng mv b">/coverage</code>目录中会自动生成一个LCOV覆盖报告。然而，在一些项目中，您可能需要以其他格式生成的代码覆盖率和测试结果，例如使用Cobertura或JUnit，以便能够在自动化管道运行中使用它们进行报告或发布。</p><p id="e6e8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，在下一节中，我们将看看如何为SFDX项目扩展LWC Jest的默认配置。</p><h1 id="60dc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">高级LWC Jest配置</h1><p id="1e10" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在上一节中，我们看到了所提供的LWC Jest默认配置的可能性。但是，参考官方文档，可以用各种选项覆盖或扩展配置(<a class="ae lu" href="https://jestjs.io/docs/configuration" rel="noopener ugc nofollow" target="_blank">配置Jest </a>)。如果这样做，还可以使用前面提到的记者Cobertura、JUnit，甚至其他。</p><p id="d942" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，要使用Cobertura或其他覆盖报告程序和格式，您只需将下面一行添加到现有的<code class="fe ne nf ng mv b">jest.config.js</code>配置文件中:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="2156" class="mz lw it mv b gy na nb l nc nd">coverageReporters: ['clover', 'json', 'text', 'lcov', 'cobertura'],</span></pre><p id="d4bf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果以这种方式扩展配置，这将自动导致在<code class="fe ne nf ng mv b">/coverage</code>目录中指定报告类型的额外输出。</p><p id="39b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要启用JUnit支持，还需要一个名为<a class="ae lu" href="https://www.npmjs.com/package/jest-junit" rel="noopener ugc nofollow" target="_blank"> jest-junit </a>的额外npm包，它可以作为项目的开发依赖项安装，如下所示:</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="9ce0" class="mz lw it mv b gy na nb l nc nd">npm i jest-junit --save-dev</span></pre><p id="09ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了自动使用Jest这个报告器，还必须将它添加到<code class="fe ne nf ng mv b">jest.config.js</code>配置文件中。包含所有调整的最终Jest配置将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="0429" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从现在开始，下面的两个目录将会自动填充我们每次测试执行的测试报告。<code class="fe ne nf ng mv b">/coverage</code>目录包含所有与代码覆盖相关的信息，而<code class="fe ne nf ng mv b">/tests</code>目录包含所有最新测试执行的一般结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/8907afe92624dd03c85ca869e90d38e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GVnwd_KQW_aOua32a0Vqg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生成了包含最新LWC测试执行结果的目录</p></figure><h1 id="bb54" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在CI / CD自动化中使用测试报告</h1><p id="ed2c" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">之前，我们看到了如何为Lightning Web组件生成各种格式的测试结果和代码覆盖报告。现在它们有几种用途。例如，上面显示的配置可以在CI / CD管道中使用，以向代码分析工具(如<a class="ae lu" href="https://sonarcloud.io/" rel="noopener ugc nofollow" target="_blank"> SonarCloud </a>)发布代码覆盖信息，甚至使测试结果在管道运行中直接可见。以<a class="ae lu" href="https://azure.microsoft.com/en-us/services/devops/pipelines/" rel="noopener ugc nofollow" target="_blank"> Azure Pipelines </a>为例，让我们看看后者是如何工作的。</p><h2 id="956e" class="mz lw it bd lx nk nl dn mb nm nn dp mf lh no np mh ll nq nr mj lp ns nt ml nu bi translated">Azure管道使用示例</h2><p id="4654" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">Azure Pipelines是微软Azure DevOps工具套件中的CI / CD自动化解决方案，可用于构建、测试和部署您的代码。当然，这并不意味着是Azure Pipelines的指南，但是，让我们看看如何为LWC测试执行和结果报告添加相应的任务，作为一个例子。</p><p id="b7b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们假设我们有一个CI管道，它根据一个pull请求自动执行，我们希望看到每个管道运行相应的测试结果以及计算出的代码覆盖率。</p><p id="309e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们需要运行我们的测试来生成我们的报告，就像我们之前在本地所做的那样。管道的设计以YAML格式定义。在我们的YAML管道定义文件中，我们可以添加下面的任务来执行LWC测试，它再次使用了之前在我们的<code class="fe ne nf ng mv b">package.json</code>中定义的脚本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="8985" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个任务执行所有的测试，即使一些测试失败也不会中止，因为我们当然对所有最终可能失败的测试感兴趣。</p><h2 id="7ae1" class="mz lw it bd lx nk nl dn mb nm nn dp mf lh no np mh ll nq nr mj lp ns nt ml nu bi translated">Azure管道中的JUnit测试报告</h2><p id="739b" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">为了发布我们当前测试执行的总体结果，我们只需要向我们的管道定义文件添加另一个任务。此任务自动搜索指定的结果文件，并为当前管道运行发布它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="d116" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下一次运行管道时，我们将看到一个新的“测试”选项卡，根据我们生成的测试报告，结果将以如下格式显示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/4fb52e2a16e85c1ca9a9928c36d8108a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SL7f0bDMDWkITi3tKWXOmw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Azure Pipelines中的示例JUnit测试报告</p></figure><h2 id="9d81" class="mz lw it bd lx nk nl dn mb nm nn dp mf lh no np mh ll nq nr mj lp ns nt ml nu bi translated">Azure管道中的Cobertura代码覆盖报告</h2><p id="f3aa" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">除了我们测试的一般结果，我们当然也对它们各自的代码覆盖率感兴趣。Azure Pipelines中也有相应的任务，我们可以将它添加到我们的管道定义中。此任务还接收格式规范以及结果文件的相应路径:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="3890" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在下一次管道执行之后，该任务还会创建一个新的标签为“Coverage”的选项卡，它还会很好地为当前运行格式化我们的LWC测试的相应代码覆盖率。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/0f3934e83efd6acec583800c4ea04af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQlcOx6Ng6n442zYjSNhIQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Azure Pipelines中的示例Cobertura代码覆盖报告</p></figure><h1 id="1687" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="33f1" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在本指南中，我们已经了解了如何使用LWC Jest来生成不同类型的测试结果和代码覆盖率报告，以及如何在CI/CD过程中使用它们。当然，这不仅适用于Azure管道，如这里的例子所示，也适用于其他管道解决方案，如<a class="ae lu" href="https://support.atlassian.com/bitbucket-cloud/docs/get-started-with-bitbucket-pipelines/" rel="noopener ugc nofollow" target="_blank"> Bitbucket管道</a>、<a class="ae lu" href="https://docs.github.com/en/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>或<a class="ae lu" href="https://docs.gitlab.com/ee/ci/quick_start/" rel="noopener ugc nofollow" target="_blank"> GitLab CI/CD </a>。</p><p id="0add" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我在GitHub上的一个存储库中，本指南中显示的测试配置也可以作为参考，以及它在GitHub操作中的使用，包括在个人SonarCloud项目中自动发布测试结果。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="00a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">前面提到的GitHub资源库和SonarCloud项目可以在这里找到:</p><div class="oe of gp gr og oh"><a href="https://github.com/svierk/awesome-lwc-collection" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">github-svierk/awesome-LWC-collection:⚡️一个现成的Lightning Web组件集合…</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">该存储库应该提供一个现成的Lightning Web组件集合，可能对您的SFDX项目有所帮助…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://sonarcloud.io/project/overview?id=svierk_awesome-lwc-collection" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">sonar cloud-svierk/awesome-LWC-collection</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">这个项目包含了仓库awesome-lwc-collection的全部代码分析结果。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">sonarcloud.io</p></div></div></div></a></div></div></div>    
</body>
</html>