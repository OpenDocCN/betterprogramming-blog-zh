<html>
<head>
<title>5 Best Practices for Infrastructure As Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基础设施代码的5个最佳实践</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-best-practices-for-infrastructure-as-code-82bd5ce12a79?source=collection_archive---------12-----------------------#2022-01-17">https://betterprogramming.pub/5-best-practices-for-infrastructure-as-code-82bd5ce12a79?source=collection_archive---------12-----------------------#2022-01-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="05ab" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">#3 —确保IaC的模块化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1ab0ae3ee4381e62984ec78e9cd3327f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7ZtR8_XEAy9B7tq3"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">罗曼·辛克维奇在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="aa92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有云实现的核心——基础设施即代码。这是一个许多开发人员、系统管理员和企业都很熟悉的术语，然而<a class="ae kv" href="https://www.cloudbees.com/blog/the-fear-of-automation" rel="noopener ugc nofollow" target="_blank">他们中的许多人仍然害怕</a>迁移到基于云的基础设施上。</p><p id="e121" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在当今快速发展的世界中，我们需要能够让我们以更透明的方式管理云基础架构的工具。IaC允许将基础设施资源和配置参数视为可编程对象，并能够通过代码控制它们。然而，在资源不足或缺乏指导的情况下，这不是一件可以轻易解决的事情。</p><p id="dd6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过实施正确的实践，IaC可以通过自动化提高生产率。通过减少手动工作和提高效率，这可以为您的企业带来显著的财务节约。没有将IaC作为一个概念来使用的组织正在错过更好地交付稳定环境和额外安全优势的机会。IaC市场在不断发展，为商业挑战提供新的解决方案，因此跟上该领域的趋势至关重要。</p><p id="d7a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想更好地理解这个非常强大的概念，请继续阅读——这篇文章将深入探讨基础设施作为代码的一些最佳实践。</p><h1 id="239f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是作为代码的基础设施？</h1><p id="2506" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">IaC可以定义为用简单的代码行取代IT资源管理和配置所需的手动工作的过程。过去，基础架构主要是一个手动过程，您需要手动创建虚拟机、更新其软件以及配置您的设置和文件，这是一个昂贵且缓慢的过程。</p><p id="a2c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">IaC允许您创建一个描述您需要什么的文件，并让IaC工具为您工作。每个IaC工具都使用不同的格式，有些依赖于特定领域语言(DSL ),有些则使用标准的模板格式，比如YAML和JSON。</p><p id="4565" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">IaC有许多好处—它可以提高it运营的速度、效率、一致性和安全性，同时最大限度地降低人为错误的风险。这种方法通过自动化将所有耗时的任务减少到几分钟。IaC可以跨各种环境实施，从多云和混合云部署到DevOps管道。</p><p id="4c1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了IaC，系统可以很容易地复制，是一次性的，一致的，过程是可重复的，而设计是不断变化的。这些是这一方法的核心原则——这是克服这一领域挑战的直接结果。如果建立不当，IaC可能会导致一些问题，如服务器蔓延、配置漂移、雪花服务器和脆弱的基础架构。这就是为什么我们需要将基础设施作为代码来实现一些最佳实践。</p><h1 id="f9e2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">基础设施作为代码最佳实践</h1><p id="90b9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了在您的组织中最大化IaC的好处，了解更多并实现一些经过验证的实践是很有用的。本节描述了基础设施作为代码的一些常规实践。</p><h1 id="eb21" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">#1 —不变性是关键</h1><p id="f25f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">不可变的IaC声明每个组件都是根据精确的规范构建的，没有个别偏差或修正的余地。服务器或虚拟机在部署后从不修改和更新，这可以降低故障率，提高安全性，并使跟踪和记录更改变得更容易。</p><p id="706a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">IaC中不变性的主要原因是避免<a class="ae kv" href="https://victorops.com/blog/how-configuration-drift-affects-incident-response-engineers" rel="noopener ugc nofollow" target="_blank">配置漂移</a>——跨配置项和环境的不一致性，这可能会给您的业务带来不愉快的结果。一旦需要改变，你应该避免局部雪花重新配置和调整一个正在运行的系统，尽管这很诱人。</p><p id="53ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种做法允许一致性和更高级别的支持，同时消除了服务器修补和其他相关问题。所有更改都应通过配置文件进行，然后在需要更新时重新部署。</p><h1 id="c12f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">#2 —为IaC提供版本控制</h1><p id="b0f0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当涉及到配置文件时，IaC中的版本控制尤其重要。如果您可以对任何其他代码进行版本控制，为什么不可以对它们进行同样的控制呢？IaC文件需要与它们帮助管理的IT环境一起更新。通过这种实践，您可以轻松地跟踪、管理和恢复对系统的任何潜在更改，并增强可跟踪性和可见性。</p><p id="0ce5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为IaC提供版本控制在需要调试和诊断问题，或者可能恢复到以前版本的情况下特别有用。这种实践还允许版本控制系统在提交变更时自动触发操作，这是实现持续集成和持续交付管道的关键。</p><p id="3436" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">市场上有许多版本控制、变更跟踪和源代码管理工具可能适合您的需求。一些包括GitHub、GitLab、BitBucket、Azure DevOps Server等，它们可以连接到您选择的IaC工具。</p><h1 id="850f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">#3 —确保IaC的模块化</h1><p id="5a78" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">小的变化和<a class="ae kv" href="https://microtica.com/blog/everything-about-microservices/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=iac&amp;utm_content=iac_bestpractices" rel="noopener ugc nofollow" target="_blank">微服务</a>总是比大批量的工作和庞大的整体代码更容易管理。在可以一个接一个地制作、测试和投入使用的模块中找到增量变化总是很方便的。这与微服务架构密切相关，微服务架构允许以众多可部署单元的形式开发、管理和维护应用程序。</p><p id="9adc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试一个小的变化并确保它是可靠的更容易(也更少的工作),修复或逆转一个小的变化更快。试图在单个文件中定义所有内容不如将配置的每个方面分解到不同的文件中有效，这样可以更容易地更新配置的一部分，而不影响其他部分。</p><p id="a44b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="http://shellfu.com/rule-of-modularity-applied-to-infrastructure-as-code/" rel="noopener ugc nofollow" target="_blank">模块化</a>的一些优势包括限制配置变更的数量、更多的可访问性控制和高效的依赖性管理。和许多好的实践一样，你只需要养成做正确事情的习惯。</p><h1 id="6900" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">#4 —利用持续测试、集成和部署的优势</h1><p id="7476" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">基础设施团队可以从软件开发中借鉴的最重要的IaC最佳实践之一是有效测试。在进行增量变更的同时，每天与代码一起运行几十次测试是高质量工作流的关键。应该对基础设施配置进行测试，以最大限度地降低部署过程中出现问题的风险。</p><p id="c803" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每次对配置代码进行更改时，都可以运行许多测试类型，例如单元、集成、回归测试等等。通过实现一个可靠的持续集成过程，您能够在不同的环境中多次提供配置模板，例如开发、测试和QA。这增加了测试、安全和开发之间的协作，从而可以在开发生命周期的早期识别潜在的错误。</p><h1 id="3959" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">#5 —小心IaC中的硬编码秘密</h1><p id="f265" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在IaC代码中公开凭据会给组织带来巨大的风险。拥有硬编码的秘密意味着潜在地向攻击者提供密码和身份验证措施的失败。一个好的做法是避免将这些秘密保存在推送到基于web的服务(如版本控制系统)的文件中，而不使用安全的秘密存储。</p><p id="5d70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">理想情况下，最好首先防止硬编码的秘密进入主分支。但是，如果忽略了这一点，那么扫描IaC中暴露的凭证是至关重要的。有<a class="ae kv" href="https://bridgecrew.io/blog/checkov-secrets-scanning-find-exposed-credentials-in-iac/" rel="noopener ugc nofollow" target="_blank">多种技术</a>可用于识别代码中的秘密，如扫描正则表达式(其他秘密的模式)、关键字(与“密码”等秘密相关的词)和基于熵的扫描(区别于真实语言的词)。不要忽视在主分支和版本历史中扫描硬编码秘密的重要性——它与在初始评估中扫描<a class="ae kv" href="https://microtica.com/blog/security-misconfigurations-with-gitops/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=iac&amp;utm_content=iac_bestpractices" rel="noopener ugc nofollow" target="_blank"> IaC安全错误配置</a>一样重要。</p><h1 id="5f66" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">最后的话</h1><p id="b419" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们希望您了解了更多关于IaC最佳实践的知识。作为代码的基础设施正在缓慢但肯定地成为组织自动化和提高交付质量的规范。一旦您以正确的方式设置了IaC环境，您将开始看到更好的开发过程的结果。</p></div></div>    
</body>
</html>