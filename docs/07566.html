<html>
<head>
<title>How To Query Pandas Data Frames Using SQL Syntax</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用SQL语法查询熊猫数据框</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/sql-with-pandas-data-frames-5192e274c8aa?source=collection_archive---------12-----------------------#2021-01-27">https://betterprogramming.pub/sql-with-pandas-data-frames-5192e274c8aa?source=collection_archive---------12-----------------------#2021-01-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6e78" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用pandasql包运行查询</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/598d4d22b3a5333d406d5e4b87a99673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ac9aZ1fur6pdgPjy"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">杰斯·贝利在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><div class="kz la gp gr lb lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq ks lc"/></div></div></a></div><p id="ccb6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在以前的文章中，我们提供了如何执行高级<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>操作的示例，如<a class="ae ky" href="https://predictivehacks.com/reshape-pandas-data-frames/" rel="noopener ugc nofollow" target="_blank">重塑pandas数据帧</a>、<a class="ae ky" href="https://predictivehacks.com/pandas-how-to-assign-values-based-on-multiple-conditions-of-different-columns/" rel="noopener ugc nofollow" target="_blank">基于多个条件赋值</a>、<a class="ae ky" href="https://predictivehacks.com/dplyr-like-pipes-for-data-manipulation-in-python-using-pandas/" rel="noopener ugc nofollow" target="_blank">在pandas </a>中使用dplyr管道等。</p><p id="1ace" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">然而，有时编写一个简单的SQL查询更方便。下面，我们将向您展示如何使用SQL语法轻松查询pandas数据框。如果你熟悉R，我们将使用的包类似于<code class="fe mn mo mp mq b">sqldf</code>。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="48d2" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">pandasql</h1><h2 id="718a" class="nq mz it bd na nr ns dn ne nt nu dp ni ma nv nw nk me nx ny nm mi nz oa no ob bi translated">装置</h2><p id="8a01" class="pw-post-body-paragraph lr ls it lt b lu oc ju lw lx od jx lz ma oe mc md me of mg mh mi og mk ml mm im bi translated">我们可以下载如下软件包:</p><pre class="kj kk kl km gt oh mq oi oj aw ok bi"><span id="d32b" class="nq mz it mq b gy ol om l on oo">pip install -U pandasql</span></pre><h2 id="2c21" class="nq mz it bd na nr ns dn ne nt nu dp ni ma nv nw nk me nx ny nm mi nz oa no ob bi translated">生成样本数据</h2><p id="85d5" class="pw-post-body-paragraph lr ls it lt b lu oc ju lw lx od jx lz ma oe mc md me of mg mh mi og mk ml mm im bi translated">出于演示目的，我们将生成两个数据帧:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/834990ad202c7195faaffc4884130b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/0*S0gqRZ4zG83R8imI.png"/></div></figure><h2 id="eea1" class="nq mz it bd na nr ns dn ne nt nu dp ni ma nv nw nk me nx ny nm mi nz oa no ob bi translated">使用SQL查询熊猫数据框</h2><p id="4092" class="pw-post-body-paragraph lr ls it lt b lu oc ju lw lx od jx lz ma oe mc md me of mg mh mi og mk ml mm im bi translated">让我们看看如何查询数据框。</p><p id="3ccc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">pandasql中使用的主要函数是<code class="fe mn mo mp mq b">sqldf</code>。<code class="fe mn mo mp mq b">sqldf</code>接受两个参数:</p><ul class=""><li id="1c8d" class="os ot it lt b lu lv lx ly ma ou me ov mi ow mm ox oy oz pa bi translated">SQL查询字符串</li><li id="9f33" class="os ot it lt b lu pb lx pc ma pd me pe mi pf mm ox oy oz pa bi translated">一组会话/环境变量(<code class="fe mn mo mp mq b">locals()</code>或<code class="fe mn mo mp mq b">globals()</code>)</li></ul><p id="63ba" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以键入以下命令，以避免每次想要运行查询时都指定该命令:</p><pre class="kj kk kl km gt oh mq oi oj aw ok bi"><span id="c56c" class="nq mz it mq b gy ol om l on oo">from pandasql import sqldf<br/>pysqldf = lambda q: sqldf(q, globals())</span></pre><p id="0657" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们按性别和观察次数得出<code class="fe mn mo mp mq b">my_df</code>数据框每一栏的平均分数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/d39671cc38e129669680e2fd3e6e63bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/0*OtieoQ8SsJ1cOTVJ.png"/></div></figure><p id="2271" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在假设我们想将这个表与性别表连接起来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/0bc5bcf4decbce514b865071931f2b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*sgHBRRwPf6vI--Fr.png"/></div></figure><p id="0edd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">注意，输出是一个熊猫数据框。它可以这样储存:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="d473" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">sqldf</h1><p id="f59f" class="pw-post-body-paragraph lr ls it lt b lu oc ju lw lx od jx lz ma oe mc md me of mg mh mi og mk ml mm im bi translated">我们还可以使用一个包装器来对<code class="fe mn mo mp mq b">pandas.DataFrame</code>对象(Python)运行SQL (SQLite)查询。</p><h2 id="2689" class="nq mz it bd na nr ns dn ne nt nu dp ni ma nv nw nk me nx ny nm mi nz oa no ob bi translated">装置</h2><p id="cd2c" class="pw-post-body-paragraph lr ls it lt b lu oc ju lw lx od jx lz ma oe mc md me of mg mh mi og mk ml mm im bi translated">我们可以安装它:</p><pre class="kj kk kl km gt oh mq oi oj aw ok bi"><span id="a243" class="nq mz it mq b gy ol om l on oo">pip install sqldf</span></pre><p id="bef9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要求是:</p><ul class=""><li id="8096" class="os ot it lt b lu lv lx ly ma ou me ov mi ow mm ox oy oz pa bi translated">Python &gt;= 3.5</li><li id="925c" class="os ot it lt b lu pb lx pc ma pd me pe mi pf mm ox oy oz pa bi translated">熊猫&gt; = 1.0</li></ul><h2 id="d859" class="nq mz it bd na nr ns dn ne nt nu dp ni ma nv nw nk me nx ny nm mi nz oa no ob bi translated">使用SQL查询熊猫数据框</h2><p id="283b" class="pw-post-body-paragraph lr ls it lt b lu oc ju lw lx od jx lz ma oe mc md me of mg mh mi og mk ml mm im bi translated">让我们提供与上面相同的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/8f8859aff8b44651ac61d373cb88336d.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/0*_Eu4st0igVgkt0xo.png"/></div></figure><p id="1f3d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">注意<code class="fe mn mo mp mq b">sqldf</code>的括号有问题。显然，您也不能运行子查询。在GitHub 上随意看看更多的例子<a class="ae ky" href="https://github.com/christophelebrun/sqldf/blob/master/demo/SQLDF_demo.ipynb" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><div class="kj kk kl km gt lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="pj l ln lo lp ll lq ks lc"/></div></div></a></div></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="9558" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="pk">原载于</em> <a class="ae ky" href="https://predictivehacks.com/sql-with-pandas-data-frames/" rel="noopener ugc nofollow" target="_blank"> <em class="pk">预测黑客</em> </a> <em class="pk">。</em></p></div></div>    
</body>
</html>