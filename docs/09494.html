<html>
<head>
<title>Exploring SwiftUI Map Custom Annotations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索SwiftUI地图自定义注释</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exploring-swiftui-map-custom-annotations-fbe1af3d2297?source=collection_archive---------9-----------------------#2021-08-31">https://betterprogramming.pub/exploring-swiftui-map-custom-annotations-fbe1af3d2297?source=collection_archive---------9-----------------------#2021-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6271" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">切换注释、设置导航等</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cdc0ac52d37e00a98a74afe3cc41467a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jWwt3OtbKUP80ZlWYXnaRw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@waldemarbrandt67w" rel="noopener ugc nofollow" target="_blank"> Waldemar Brandt </a>在<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="1568" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不久前，我们在SwiftUI中探索了Mapview。这一次，我们将研究如何创建自定义地图注释、限制以及如何克服其中的一些限制。</p><p id="43e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在地图上放置注释，就像标记一个特定的地方，是在我们的iOS应用程序中显示地图时最关键的任务之一。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="26c9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">地图注释协议</h1><p id="a36f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在SwiftUI中使用自定义地图注释时，我们需要查看<code class="fe mz na nb nc b"><a class="ae ky" href="https://developer.apple.com/documentation/mapkit/mapannotation" rel="noopener ugc nofollow" target="_blank">MapAnnotation</a></code>。我们可以完全按照我们想要的方式定制它，然后把它放在地图上。</p><p id="9d12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提醒一下，要在地图上显示注释，我们需要一个符合<code class="fe mz na nb nc b">Identifiable</code>协议的地点列表，然后在数组中初始化<code class="fe mz na nb nc b">Map</code>视图时使用它。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="cb26" class="nh md it nc b gy ni nj l nk nl">struct Place: Identifiable {<br/>  let id = UUID()<br/>  var name: String<br/>  var coordinate: CLLocationCoordinate2D<br/>}</span><span id="bc67" class="nh md it nc b gy nm nj l nk nl">struct ContentView: View {<br/>  @State private var region = MKCoordinateRegion(center: CLLocationCoordinate2D(latitude: 40.748433, longitude: -73.985656), span: MKCoordinateSpan(latitudeDelta: 0.01, longitudeDelta: 0.01))<br/>  <br/>  var empireStateBuilding =<br/>  Place(name: "Empire State Building", coordinate: CLLocationCoordinate2D(latitude: 40.748433, longitude: -73.985656))<br/>  <br/>  var body: some View {<br/>    Map(coordinateRegion: $region,<br/>        annotationItems: [empireStateBuilding]<br/>    ) { place in<br/>      // ... create a custom MapAnnotation<br/>    }<br/>  }<br/>}</span></pre><p id="9a70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是创建自定义地图注记的时候了。让我们创建一个自定义视图，以便我们可以重用它。我们可以使用SFSymbols填充的地图圆，并在底部放置一个大头针来精确显示确切位置。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="240c" class="nh md it nc b gy ni nj l nk nl">struct PlaceAnnotationView: View {<br/>  var body: some View {<br/>    VStack(spacing: 0) {<br/>      Image(systemName: "mappin.circle.fill")<br/>        .font(.title)<br/>        .foregroundColor(.red)<br/>      <br/>      Image(systemName: "arrowtriangle.down.fill")<br/>        .font(.caption)<br/>        .foregroundColor(.red)<br/>        .offset(x: 0, y: -5)<br/>    }<br/>  }<br/>}</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/c5679881b1ca6acac4b61d3f7da7cafa.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/format:webp/0*iHWd8KPC8vntull_.png"/></div></figure><p id="2844" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以在‘Map’闭包块中使用它了。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="f79a" class="nh md it nc b gy ni nj l nk nl">Map(coordinateRegion: $region,<br/>        annotationItems: [empireStateBuilding]<br/>    ) { place in<br/>      MapAnnotation(coordinate: place.coordinate) {<br/>        PlaceAnnotationView()<br/>      }<br/>    }</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/cd29c1c619207fb7a0f28ac90871d02c.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/0*jJkol1C9L24h51Q2.png"/></div></figure><p id="c039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当放大或缩小时，我们看到注释被精确地放置在帝国大厦所在的位置。</p><p id="1bef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在地图上有了注释之后，我们希望以某种方式与它进行交互。让我们在接下来的章节中探索如何显示注释标题以及点击它时的导航。</p><h1 id="5622" class="mc md it bd me mf np mh mi mj nq ml mm jz nr ka mo kc ns kd mq kf nt kg ms mt bi translated">显示和隐藏注释标题</h1><p id="5f2f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了显示(和隐藏)注释标题，我们需要将它包含在自定义注释视图中，因为我们是手动构造的。</p><p id="071d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在<code class="fe mz na nb nc b">PlaceAnnotationView</code> <code class="fe mz na nb nc b">VStack</code>中添加标题，并在用户点击时显示或隐藏它。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="86a9" class="nh md it nc b gy ni nj l nk nl">struct PlaceAnnotationView: View {<br/>  @State private var showTitle = true<br/>  <br/>  let title: String<br/>  <br/>  var body: some View {<br/>    VStack(spacing: 0) {<br/>      Text(title)<br/>        .font(.callout)<br/>        .padding(5)<br/>        .background(Color(.white))<br/>        .cornerRadius(10)<br/>        .opacity(showTitle ? 0 : 1)<br/>      <br/>      Image(systemName: "mappin.circle.fill")<br/>        .font(.title)<br/>        .foregroundColor(.red)<br/>      <br/>      Image(systemName: "arrowtriangle.down.fill")<br/>        .font(.caption)<br/>        .foregroundColor(.red)<br/>        .offset(x: 0, y: -5)<br/>    }<br/>    .onTapGesture {<br/>      withAnimation(.easeInOut) {<br/>        showTitle.toggle()<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="6a9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用视图状态变量并相应地更改不透明度，使其以动画形式出现和消失。这会给人一种额外的感觉。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nu"><img src="../Images/31573030d1a65a61fbd5e375cc6c1f55.png" data-original-src="https://miro.medium.com/v2/format:webp/1*b31hiO4ynbDLRrXWEFF4aQ.png"/></div></figure><p id="b74b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个选项是始终显示注释标题。在这种情况下，我们的应用程序用户不用点击就能明白这是什么地方。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="46b9" class="nh md it nc b gy ni nj l nk nl">struct PlaceAnnotationView: View {<br/>  let title: String<br/>  <br/>  var body: some View {<br/>    VStack(spacing: 0) {<br/>      Text(title)<br/>        .font(.callout)<br/>        .padding(5)<br/>        .background(Color(.white))<br/>        .cornerRadius(10)<br/>      <br/>      Image(systemName: "mappin.circle.fill")<br/>        .font(.title)<br/>        .foregroundColor(.red)<br/>      <br/>      Image(systemName: "arrowtriangle.down.fill")<br/>        .font(.caption)<br/>        .foregroundColor(.red)<br/>        .offset(x: 0, y: -5)<br/>    }<br/>  }<br/>}</span></pre><h1 id="e0aa" class="mc md it bd me mf np mh mi mj nq ml mm jz nr ka mo kc ns kd mq kf nt kg ms mt bi translated">从地图注记导航</h1><p id="b024" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当用户点击注释时，我们希望导航到不同的视图，并在地图上显示关于这个地方的额外信息。为此，我们可以将定制注释视图放在<code class="fe mz na nb nc b">NavigationLink</code>中，然后导航到位置细节视图。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="5fd0" class="nh md it nc b gy ni nj l nk nl">MapAnnotation(coordinate: place.coordinate) {<br/>  NavigationLink {<br/>    LocationDetailsView(place: place)<br/>  } label: {<br/>    PlaceAnnotationView(title: place.name)<br/>  }<br/>}</span></pre><p id="0aaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击注释后，用户将被带到详细信息屏幕。就是这样！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/4c1005e212abd003b99ca9f0abd772e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/0*eU4zUTZejZZS60fm.gif"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ccae" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="d45b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在iOS应用程序中使用地图视图时，使用注释在地图上标记一个地方是一项重要功能。在许多情况下，我们希望使用定制的注释视图来实现。</p><p id="e05f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用SwiftUI，我们可以创建自定义注释，并以直观的方式在地图上显示它们。使用这种方法非常好，因为我们拥有所有SwiftUI特性，比如堆栈、导航等等。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="99dd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">链接</h1><ul class=""><li id="d9d7" class="nw nx it lb b lc mu lf mv li ny lm nz lq oa lu ob oc od oe bi translated"><a class="ae ky" href="https://github.com/fassko/SwiftUIMapCustomAnnotations" rel="noopener ugc nofollow" target="_blank">样本代码</a></li><li id="b2d2" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated"><a class="ae ky" href="https://developer.apple.com/documentation/mapkit/mapannotation" rel="noopener ugc nofollow" target="_blank">地图标注文档</a></li><li id="94fe" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated"><a class="ae ky" href="https://developer.apple.com/documentation/mapkit/mapannotationprotocol" rel="noopener ugc nofollow" target="_blank">地图标注协议文档</a></li><li id="0163" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=vfWxwDfX30I" rel="noopener ugc nofollow" target="_blank">在SwiftUI中为地图添加注释</a></li><li id="23a4" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated"><a class="ae ky" href="https://swiftuirecipes.com/blog/map-with-annotations-in-swiftui" rel="noopener ugc nofollow" target="_blank">swift ui中带注释的地图</a></li><li id="df46" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated"><a class="ae ky" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-show-annotations-in-a-map-view" rel="noopener ugc nofollow" target="_blank">如何在地图视图中显示注释</a></li><li id="c405" class="nw nx it lb b lc of lf og li oh lm oi lq oj lu ob oc od oe bi translated"><a class="ae ky" href="https://www.appcoda.com/swiftui-map/" rel="noopener ugc nofollow" target="_blank">如何使用SwiftUI地图和注释</a></li></ul></div></div>    
</body>
</html>