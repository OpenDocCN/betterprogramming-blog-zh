<html>
<head>
<title>How to Copy Text and Images to the Clipboard in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中将文本和图像复制到剪贴板</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-copy-text-and-images-to-the-clipboard-in-javascript-9a5f5ddf2cdc?source=collection_archive---------6-----------------------#2021-10-13">https://betterprogramming.pub/how-to-copy-text-and-images-to-the-clipboard-in-javascript-9a5f5ddf2cdc?source=collection_archive---------6-----------------------#2021-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="980a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用异步剪贴板API轻松地将内容复制到剪贴板</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ad83ddad169c05b7de2719b2a1f79de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-FWwCYHym9tpDE5UEzExew.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">插图由<a class="ae ky" href="https://undraw.co/illustrations" rel="noopener ugc nofollow" target="_blank"> unDraw </a>绘制</p></figure><p id="47e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将通过使用相对较新的<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API" rel="noopener ugc nofollow" target="_blank">异步剪贴板API </a>来查看一种简单的复制剪贴板中的文本的方法和一种不太一致的复制图像到用户剪贴板的方法。</p><p id="ab36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand" rel="noopener ugc nofollow" target="_blank">document.execCommand</a></code>过去被广泛用于将文本复制到用户的剪贴板上，但是不鼓励使用它<em class="lz"/>，它可能随时停止工作！</p><h1 id="4204" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">许可</h1><p id="3599" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">如果你只是写一个用户的剪贴板，你不需要担心浏览器的权限。</p><p id="17fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，有两件事你需要记住:</p><ol class=""><li id="aced" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated">你的网站应该在HTTPS提供服务</li><li id="f43a" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">仅当页面是活动的浏览器选项卡时，才授予剪贴板访问权限</li></ol><p id="b313" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从剪贴板中读取总是需要许可的，但是我们将在另一篇文章中对此进行更深入的探讨。</p><h1 id="ad7c" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">将文本复制到剪贴板</h1><p id="aeb0" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">将文本复制到剪贴板相当快速简单:</p><pre class="kj kk kl km gt nl ly nm nn aw no bi"><span id="8eeb" class="np mb it ly b gy nq nr l ns nt">await navigator.clipboard.writeText("text to copy!");</span></pre><p id="a19d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！真的！</p><p id="c575" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了web和浏览器支持，您可以捕捉旧浏览器中可能出现的任何错误，并调用<code class="fe lv lw lx ly b">document.execCommand</code>作为后备。请注意<code class="fe lv lw lx ly b">document.execCommand</code>不被鼓励，可能随时停止工作！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="92a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，如果您在Gatsby中将它用作事件监听器，您可能需要在该函数的开头添加一个<code class="fe lv lw lx ly b">window</code> check语句:</p><pre class="kj kk kl km gt nl ly nm nn aw no bi"><span id="935d" class="np mb it ly b gy nq nr l ns nt">if (typeof window === 'undefined') return false</span></pre><h1 id="36fb" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">将图像复制到剪贴板</h1><p id="ca53" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">将图像复制到剪贴板，看起来与上面的复制文本有点不同，因为在将图像写入剪贴板之前，我们需要将图像转换成一个<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" rel="noopener ugc nofollow" target="_blank">Blob</a></code>对象。</p><p id="e494" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本质上，我们需要创建一个<code class="fe lv lw lx ly b">Blob</code>对象，首先从网络中获取它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="507b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">警告:不建议从<code class="fe lv lw lx ly b">&lt;canvas&gt;</code>元素创建<code class="fe lv lw lx ly b">Blob</code>对象！如果你仍然感兴趣，尽管看看<a class="ae ky" href="https://stackoverflow.com/a/40903325/7380613" rel="noopener ugc nofollow" target="_blank">这个堆栈溢出回答</a>，并确保你理解它如何工作以及使用它时会有什么问题。</p><h1 id="ea4e" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">将图像斑点复制到剪贴板(Chrome)</h1><p id="2234" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">使用上述任何方法生成图像斑点后，我们可以将斑点复制到剪贴板，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="21a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你问我的话，上面的实现有几个问题，这让我们想到了剪贴板API的局限性。</p><h1 id="df24" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">限制</h1><h2 id="b07a" class="np mb it bd mc nw nx dn mg ny nz dp mk li oa ob mm lm oc od mo lq oe of mq og bi translated">Chrome与Safari</h2><p id="58a8" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">第一个问题是，Safari需要不同的逻辑，因为当你创建一个新的<code class="fe lv lw lx ly b">ClipboardItem</code>如<code class="fe lv lw lx ly b">{'&lt;IMAGE MIME TYPE&gt;': Blob}</code>时，Chromium浏览器需要一个<code class="fe lv lw lx ly b">Blob</code>类型，另一方面，Safari需要一个未解析的<code class="fe lv lw lx ly b">Promise</code>返回一个<code class="fe lv lw lx ly b">Blob</code>对象，如<code class="fe lv lw lx ly b">{'&lt;IMAGE MIME TYPE&gt;': Promise&lt;Blob&gt;}</code>。否则，您会得到如下所示的错误:</p><pre class="kj kk kl km gt nl ly nm nn aw no bi"><span id="adf3" class="np mb it ly b gy nq nr l ns nt">NotAllowedError — “The request is not allowed by the user agent or the platform in the current context, possibly because the user denied permission.”</span></pre><p id="3a4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于上述原因，如果不首先创建它的<code class="fe lv lw lx ly b">Blob</code>，就无法知道图像是什么mime类型。因此，对于Safari实现，我们可以从它的URL获取图像扩展，并使用它来创建它的mime类型，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="e557" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提示:查看<a class="ae ky" href="https://gist.github.com/charisTheo/4981233128637fabec0121e90778aef8" rel="noopener ugc nofollow" target="_blank">这个要点</a>是关于用JavaScript检测Safari浏览器的实用函数。</p><p id="880c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">带有未解决的<code class="fe lv lw lx ly b">Promise</code>的最终实现将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="ab26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，对所有浏览器来说，你不必支持一长串的mime类型，因为正如我们马上会看到的，只支持几个类型</p><h1 id="26a5" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">支持的Mime类型</h1><p id="0817" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">目前只有<code class="fe lv lw lx ly b">'text/plain'</code>和<code class="fe lv lw lx ly b">'image/png'</code>在Chrome和Safari中都实现。我希望这个名单会越来越长，但目前只有这两个从它看起来的样子。</p><p id="6071" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，SVG有一个变通方法，因为它们可以作为<code class="fe lv lw lx ly b">'text/plain'</code>而不是<code class="fe lv lw lx ly b">'image/svg+xml'</code>被复制。所以Chrome的实现应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><blockquote class="oh oi oj"><p id="5ae4" class="kz la lz lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">关于多mime类型复制的更多信息，请看Thomas Steiner的这篇文章。</p></blockquote><h1 id="89c8" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">浏览器支持</h1><p id="eda8" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">最后，尽管上面列出的选项有限，浏览器支持看起来还不错:</p><ul class=""><li id="57e9" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu on nd ne nf bi translated">用于复制文本的<code class="fe lv lw lx ly b">writeText</code>在所有主流浏览器上都支持<a class="ae ky" href="https://caniuse.com/mdn-api_clipboard_writetext" rel="noopener ugc nofollow" target="_blank"/></li><li id="6b34" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu on nd ne nf bi translated">用于复制图像的<code class="fe lv lw lx ly b">write</code>是所有主流浏览器都支持的<a class="ae ky" href="https://caniuse.com/mdn-api_clipboard_write" rel="noopener ugc nofollow" target="_blank"/>，除了需要一些自定义逻辑的Firefox</li></ul><h1 id="a144" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">现场演示和代码</h1><p id="7f32" class="pw-post-body-paragraph kz la it lb b lc ms ju le lf mt jx lh li mu lk ll lm mv lo lp lq mw ls lt lu im bi translated">如需现场演示，请访问<a class="ae ky" href="https://uncovered-bubble-lens.glitch.me" rel="noopener ugc nofollow" target="_blank">网站</a>并找到Glitch 上的<a class="ae ky" href="https://glitch.com/edit/#!/uncovered-bubble-lens" rel="noopener ugc nofollow" target="_blank">代码。</a></p><h1 id="4edc" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">进一步阅读</h1><ul class=""><li id="af75" class="mx my it lb b lc ms lf mt li oo lm op lq oq lu on nd ne nf bi translated"><a class="ae ky" href="https://www.w3.org/TR/clipboard-apis/#async-clipboard-api" rel="noopener ugc nofollow" target="_blank">异步剪贴板API </a> — W3C工作草案</li><li id="0d47" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu on nd ne nf bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API" rel="noopener ugc nofollow" target="_blank">异步剪贴板API </a> — MDN文档</li><li id="c1dc" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu on nd ne nf bi translated"><a class="ae ky" href="https://web.dev/async-clipboard/" rel="noopener ugc nofollow" target="_blank">解除阻止剪贴板访问</a> — web.dev</li><li id="c793" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu on nd ne nf bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand" rel="noopener ugc nofollow" target="_blank">弃用</a> <code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand" rel="noopener ugc nofollow" target="_blank">document.execCommand</a></code> <a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand" rel="noopener ugc nofollow" target="_blank">方法</a></li><li id="5b3b" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu on nd ne nf bi translated"><code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/writeText" rel="noopener ugc nofollow" target="_blank">navigator.clipboard.writeText</a></code> - <a class="ae ky" href="https://caniuse.com/mdn-api_clipboard_writetext" rel="noopener ugc nofollow" target="_blank">浏览器支持</a></li><li id="c6ee" class="mx my it lb b lc ng lf nh li ni lm nj lq nk lu on nd ne nf bi translated"><code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/write" rel="noopener ugc nofollow" target="_blank">navigator.clipboard.write</a></code> - <a class="ae ky" href="https://caniuse.com/mdn-api_clipboard_write" rel="noopener ugc nofollow" target="_blank">浏览器支持</a></li></ul></div></div>    
</body>
</html>