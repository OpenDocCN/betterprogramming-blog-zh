<html>
<head>
<title>GIS Project With Python and GeoPandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和GeoPandas的GIS项目</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/gis-project-with-geopandas-56a83aa89dbc?source=collection_archive---------9-----------------------#2022-01-28">https://betterprogramming.pub/gis-project-with-geopandas-56a83aa89dbc?source=collection_archive---------9-----------------------#2022-01-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="17d3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个完全用Python实现的GIS项目</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d47e33ba2855c05db50ec7927c912402.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gjNFRjBCM4UX0uPGUYt1-Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@geojango_maps" rel="noopener ugc nofollow" target="_blank"> GeoJango地图</a> s在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="6dff" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">序文</h1><p id="1543" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一些背景信息……我最近注册了<a class="ae ky" href="https://www.statisticswithoutborders.org/" rel="noopener ugc nofollow" target="_blank">无国界统计组织</a>的志愿者，该组织提供统计和数据科学方面的公益服务。</p><p id="d4c7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">作为一名热衷于环境责任、社会公平和可持续发展的数据分析师/科学家，我觉得将我的技能用于社会公益是有意义的。这个项目是为芝加哥400人服务的，他们代表有前科的芝加哥人进行竞选活动。目标是创建静态和web地图，为有前科的芝加哥人勾勒出流放区。我决定挑战自己，在这个项目中完全使用Python，这样它可以部署在Github上，并与其他想做同样事情的人共享代码。</p><p id="b347" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，我很难找到任何能够涵盖完整GIS地图所需所有方面的Python GIS教程。我想为那些希望摆脱桌面GIS系统束缚的人们提供这一点。</p><p id="a4d5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在手续都办完了…让我们来点代码吧！</p><h2 id="b7f7" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">获取数据</h2><p id="ffe6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我需要做的第一件事是获取数据。芝加哥有一个<a class="ae ky" href="https://data.cityofchicago.org/" rel="noopener ugc nofollow" target="_blank">开放数据门户</a> (ODP)，里面有大量免费提供的信息。放逐区分为两个不同的类别:一个是住房放逐(人们不能居住)，另一个是公共放逐(人们不能在场)。</p><p id="5c52" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我将在这里坚持住房驱逐代码，项目代码的全部可以在我的GitHub <a class="ae ky" href="https://github.com/justinm0rgan/chicago400" rel="noopener ugc nofollow" target="_blank"> repo </a>中查看。住房驱逐地理需要，包括学校，公园和日托中心。</p><p id="6b65" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">从ODP中获得数据后，就可以使用GeoPandas作为地理数据框架(GDF)将数据导入Python，并在同一个坐标参考系统(CRS)中获取所有数据。</p><p id="dc45" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于这个项目，我选择将它们全部投射在EPSG:WGS 84区32616号zone 16N区。有关基本的导入和CRS转换，请参见下面的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将ShapeFile作为地理数据框架导入并设置CRS</p></figure><h2 id="8e02" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">探索性数据分析</h2><p id="7263" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一旦数据作为GDF和CRS集导入到Python环境中，我就需要执行某种探索性数据分析(EDA)来获得可视化效果。</p><p id="ded4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，我想根据底图预览芝加哥的边界。为此，我们可以结合使用<a class="ae ky" href="https://contextily.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">包和GeoPandas <code class="fe ng nh ni nj b">.plot()</code>方法。上下文为底图切片提供了许多选项，但我觉得<code class="fe ng nh ni nj b">Stamen.TonerLite</code>最适合这张地图。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可自定义上下文底图</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/777642c04052ca5e81fb01bfe9d9dadd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*IJiP9R31W9KpRnU7nLa8gg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">芝加哥边界w/ StamenToner Lite底图</p></figure><p id="d163" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在确认这一工作并找到一个好的图块底图后，我开始预览其他各种GDF(为了简洁起见，这里没有画出来)。</p><p id="8178" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">其中包括:</p><ul class=""><li id="ffea" class="nl nm it lt b lu mn lx mo ma nn me no mi np mm nq nr ns nt bi translated"><em class="nu">租金中位数</em></li><li id="5895" class="nl nm it lt b lu nv lx nw ma nx me ny mi nz mm nq nr ns nt bi translated"><em class="nu">学校</em></li><li id="baf1" class="nl nm it lt b lu nv lx nw ma nx me ny mi nz mm nq nr ns nt bi translated"><em class="nu">日托</em></li><li id="3274" class="nl nm it lt b lu nv lx nw ma nx me ny mi nz mm nq nr ns nt bi translated"><em class="nu">自行车路线</em></li><li id="c170" class="nl nm it lt b lu nv lx nw ma nx me ny mi nz mm nq nr ns nt bi translated"><em class="nu">林业</em></li><li id="4780" class="nl nm it lt b lu nv lx nw ma nx me ny mi nz mm nq nr ns nt bi translated"><em class="nu">公园</em></li><li id="809f" class="nl nm it lt b lu nv lx nw ma nx me ny mi nz mm nq nr ns nt bi translated"><em class="nu">空地(林荫大道)</em></li></ul><h1 id="aa75" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">GIS操作</h1><h2 id="d130" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">剪辑到芝加哥</h2><p id="5dd7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一些GDF是针对伊利诺伊州内的更大区域的，因此它们需要被剪切到芝加哥。下面您可以看到使用GeoPandas将一个几何图形裁剪到另一个几何图形的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/9f5e99f11fcecf351000b7fea67d9b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*3GAcxVvaJlFWA2RLA-x0Og.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将学校剪贴到芝加哥边界</p></figure><h2 id="00c0" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">缓冲几何图形</h2><p id="7ee1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">住房驱逐法规定，被判有罪的人不能住在学校、公园或日托设施500英尺以内。因此，下一步是缓冲各自的形状文件。Chicago400需要一个视觉效果来探索将500英尺的缓冲区减少到250英尺的差异，因此也完成了这项工作。由于CRS设置为米，我必须将英尺转换为米，也就是1英尺等于0.3048米</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d1ca" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要预览缓冲的几何图形，我们可以使用GeoPandas绘制它。图例必须用<code class="fe ng nh ni nj b"><a class="ae ky" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.patches.Patch.html" rel="noopener ugc nofollow" target="_blank">mpatches</a></code>构造，因为简单地利用<code class="fe ng nh ni nj b">.plot()</code>方法的内置图例参数不会产生包含多个图层的图例。</p><p id="0f89" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，您可以看到专用于指北针和比例尺的代码部分。这些方面需要特意添加自己的代码部分，但对于构建专业外观的地图来说是必不可少的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/577e0141491b35449fcc5354da85ad6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uUikHpOI0zUkf33vIHGCYg.png"/></div></div></figure><h2 id="210e" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">解散(一元联盟)和联盟GDF的</h2><p id="acac" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">下一步是将每个GDF融合到其一个几何图形中，并将其合并，使我们能够在美国社区调查(ACS)2012-16年租金中位数数据上进行分层。</p><p id="4196" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要在GeoPandas中实现这一点，可以执行以下命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="8c2a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">结果是一个GDF包含所有GDF的一个多重多边形集合。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/403696007c0dbad666b5a9cb380821c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*hYKPgkPuI4fZVSKLZRaIUw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">单一多面GDF</p></figure><h1 id="02f2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">等值区域图</h1><p id="346f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在，我们已经解散并执行了公园、学校和日托中心的联合，我们可以将它们绘制为一个几何图形，并引入ACS中值租金数据。</p><p id="3fbb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这将让我们了解有前科的人可以住在哪里，以及特定人口普查区域的可负担性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/441e5c7a6e208ec36feb48d3a877399b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nct2YpO1_4RsY7PZTx17iQ.png"/></div></div></figure><h2 id="2d5a" class="ms la it bd lb mt mu dn lf mv mw dp lj ma mx my ll me mz na ln mi nb nc lp nd bi translated">传说</h2><p id="d727" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在上面地图的代码中，我必须结合两种不同类型的图例。</p><ol class=""><li id="ac3e" class="nl nm it lt b lu mn lx mo ma nn me no mi np mm oe nr ns nt bi translated">使用来自<code class="fe ng nh ni nj b">.plot()</code>方法的默认<code class="fe ng nh ni nj b">legend = True</code>参数</li><li id="919c" class="nl nm it lt b lu nv lx nw ma nx me ny mi nz mm oe nr ns nt bi translated">使用<code class="fe ng nh ni nj b">maptches.Patch()</code>方法并用<code class="fe ng nh ni nj b">add_artist()</code>将其添加到底图中。</li></ol><p id="d441" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ng nh ni nj b">legend = true</code>方法允许我们从<code class="fe ng nh ni nj b">mapclassify</code>开始用<code class="fe ng nh ni nj b">UserDefined()</code>休息。但是，如果我们愿意，我们可以使用其他类型的分段，即自然分段或Jenks，但我希望指定分段的值，为最终用户提供一种快速简单的方法来分析中值租金数据。</p><p id="8467" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要设置用户定义的断点，可以简单地将其添加到<code class="fe ng nh ni nj b">bins</code>参数中，然而，要获取和格式化所有边界，需要添加更多的Python代码。你可以在下面的代码中的<code class="fe ng nh ni nj b"># format legend numbers</code>注释下看到前面提到的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="1910" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="0db4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">该项目的目的是仅使用Python而不是桌面系统来实现一个标准的GIS项目。我对结果非常满意。你可以在我的GitHub repo <a class="ae ky" href="https://github.com/justinm0rgan/chicago400" rel="noopener ugc nofollow" target="_blank">这里</a>查看所有代码的笔记本和关于项目范围的更多细节。</p></div></div>    
</body>
</html>