<html>
<head>
<title>5 Tools and Techniques for Better Python Project Setups</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5种更好的Python项目设置工具和技术</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/tools-and-technics-for-better-project-setup-9909abca263f?source=collection_archive---------15-----------------------#2022-04-04">https://betterprogramming.pub/tools-and-technics-for-better-project-setup-9909abca263f?source=collection_archive---------15-----------------------#2022-04-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="919f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们创建一个设计良好的Python项目。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/23d9df1831bb459f0ea963ca36d0cd36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4xmhYcGtoute7Zkq"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@octadan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">屋大维丹</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h1 id="cba5" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">1.为了编写更好的代码并避免常见错误</h1><p id="40b7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有时，当我们向应用程序添加新功能时，会影响现有代码或破坏其功能。</p><p id="0e67" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了避免这种情况，我们会编写单元测试，并且每次都运行它们，以确保我们添加的新功能不会对应用程序造成损害。</p><p id="6040" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">关于测试，有一些库和框架可以用来编写更好的测试并轻松运行它们，比如<a class="ae kv" href="https://docs.pytest.org/" rel="noopener ugc nofollow" target="_blank"> Pytest </a>和<a class="ae kv" href="https://tox.wiki/" rel="noopener ugc nofollow" target="_blank"> tox </a>。</p><p id="8922" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Pytest不仅可以帮助我们运行测试，还可以配置如何运行测试、运行哪些文件等。Pytest有一个配置文件pytest.ini，您可以在其中描述其配置，例如哪个版本应该是pytest，或者哪些是如下所示的测试文件。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="522c" class="mu kx iq mq b gy mv mw l mx my"># pytet.ini<br/>[pytest]<br/>minversion = 6.0<br/>addopts = -ra -q — cov=src — cov-report=html<br/>python_files = test_*.py</span></pre><p id="de04" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，它还具有集成功能，其中之一是将<a class="ae kv" href="https://github.com/nedbat/coveragepy" rel="noopener ugc nofollow" target="_blank">覆盖率</a>与pytest集成在一起的<a class="ae kv" href="https://github.com/pytest-dev/pytest-cov" rel="noopener ugc nofollow" target="_blank"> pytest-cov </a>，覆盖率可以通过提供关于应用程序的哪个部分被测试覆盖以及哪个部分没有被测试覆盖的信息来帮助我们，它还提供各种格式的覆盖率报告，如XML、JSON、HTML，并显示测试覆盖了多少百分比的代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/428eaa15d6c8d0aa828525c7a1c6cce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i55BWlIEaP8xRxdQyVNnKQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">截图来自<a class="ae kv" href="https://coverage.readthedocs.io/en/6.3.2/" rel="noopener ugc nofollow" target="_blank">https://coverage.readthedocs.io/en/6.3.2/</a></p></figure><p id="0305" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Tox是一个通用的<code class="fe na nb nc mq b">virtualenv</code>管理和测试命令行工具。<br/>使用不同的Python版本和解释器检查您的包是否正确安装<br/>在每个环境中运行您的测试，配置您选择的测试工具<br/>作为持续集成服务器的前端，极大地减少样板文件并合并CI和基于shell的测试。<br/> Tox也有它的配置文件。</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="2baa" class="mu kx iq mq b gy mv mw l mx my">[tox]<br/>isolated_build = True<br/><br/>envlist =<br/>    py{38}<br/><br/>[testenv]<br/>usedevelop = true<br/>deps =<br/>    -r src/requirements_dev.txt</span></pre><p id="94db" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这些工具可以帮助您确保所做的任何更改都不会影响之前完成的功能。</p><h1 id="9da3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">2.如何避免代码气味</h1><p id="4807" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有时代码中可能会有未使用的变量，或者编写的代码风格无法对应PEP8规则。这里静态代码分析器来帮助我们。<br/>这里有几个静态代码分析器及其配置示例。<br/> <a class="ae kv" href="https://github.com/PyCQA/pylint" rel="noopener ugc nofollow" target="_blank"> Pylint </a>，<a class="ae kv" href="https://github.com/pycqa/flake8" rel="noopener ugc nofollow" target="_blank"> Flake8 </a>，<a class="ae kv" href="http://www.mypy-lang.org/" rel="noopener ugc nofollow" target="_blank"> MyPy </a>。<br/>这些工具可以帮助我们避免死代码、不适用的代码(例如违反PEP-8规则)、代码中未使用的变量等...<br/> Pylint配置:创建<code class="fe na nb nc mq b">.pylintrc</code>文件</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="a9b8" class="mu kx iq mq b gy mv mw l mx my">[MESSAGES CONTROL]<br/>disable=<br/>    missing-docstring,<br/>    too-few-public-methods</span><span id="8771" class="mu kx iq mq b gy nd mw l mx my">[REPORTS]<br/>output-format=colorized<br/>files-output=no<br/>reports=no<br/>evaluation=10.0 - ((float(5 * error + warning + refactor + convention) / statement) * 10)</span></pre><p id="1d43" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Flake8配置:创建<code class="fe na nb nc mq b">.flake8</code>文件</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="6435" class="mu kx iq mq b gy mv mw l mx my">[flake8]<br/>ignore = E203, E266, E501, W503, F403, F401, E402<br/>max-line-length = 120<br/>max-complexity = 18<br/>select = B,C,E,F,W,T4,B9<br/>exclude =<br/>    .git,<br/>    tests</span></pre><p id="125e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这些类型的工具可以帮助你为整个应用程序定义一种代码风格，开发者将会保留它！</p><h1 id="b093" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">3.如何避免破坏工作应用程序</h1><p id="a314" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">想象一下，有人在没有运行所有测试和静态代码分析器的情况下推送代码，这可能会影响现有的特性。<br/>所以为了避免这种情况，pre-commit来帮我们了。<br/> Pre-commit是一个框架，它创建git挂钩来确保您的代码是按照您定义的代码风格编写的。<br/>它扫描你的源代码并运行你将在预提交配置文件中定义的所有检查器:<code class="fe na nb nc mq b">.pre-commit-config.yaml</code></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="369c" class="mu kx iq mq b gy mv mw l mx my">repos:<br/>  - repo: 'https://gitlab.com/pycqa/flake8'<br/>    rev: 3.8.2<br/>    hooks:<br/>      - id: flake8<br/>        name: Style Guide Enforcement (flake8)<br/>        args:<br/>          - '--max-line-length=120'<br/>  - repo: 'https://github.com/pre-commit/mirrors-mypy'<br/>    rev: v0.720<br/>    hooks:<br/>      - id: mypy<br/>        name: Optional Static Typing for Python (mypy)</span></pre><p id="d3e5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这些类型的工具可以帮助您避免git存储库中的有害代码。</p><h1 id="4baa" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">4.漏洞扫描</h1><p id="6292" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">每个应用程序都可能被黑客攻击，存在数据泄露或源代码泄露、数据加密、应用程序崩溃或任何其他有害事情的风险。<br/>漏洞扫描有一堆工具，但我们还是来看看<a class="ae kv" href="https://www.sonarqube.org/" rel="noopener ugc nofollow" target="_blank"> Sonarqube </a>。Sonarqube是一个开源的强大的代码质量和安全扫描工具，也是这个行业的领先工具之一。<br/>详见<a class="ae kv" href="https://docs.sonarqube.org/latest/" rel="noopener ugc nofollow" target="_blank">官方文件</a>。<br/>您可以使用Docker镜像设置本地Sonarqube服务器，并定义<code class="fe na nb nc mq b">sonar-project.properties</code></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="f5f6" class="mu kx iq mq b gy mv mw l mx my"># must be unique in a given SonarQube instance</span><span id="fadd" class="mu kx iq mq b gy nd mw l mx my">sonar.projectKey=python_app_blueprint</span><span id="69b0" class="mu kx iq mq b gy nd mw l mx my"># --- optional properties ---</span><span id="53c7" class="mu kx iq mq b gy nd mw l mx my"># defaults to project key</span><span id="a751" class="mu kx iq mq b gy nd mw l mx my">#sonar.projectName=My project</span><span id="37d5" class="mu kx iq mq b gy nd mw l mx my"># defaults to 'not provided'</span><span id="0308" class="mu kx iq mq b gy nd mw l mx my">#sonar.projectVersion=1.0</span><span id="12bd" class="mu kx iq mq b gy nd mw l mx my"># Path is relative to the sonar-project.properties file. Defaults to .</span><span id="3f44" class="mu kx iq mq b gy nd mw l mx my">#sonar.sources=.<br/></span><span id="5973" class="mu kx iq mq b gy nd mw l mx my"># Encoding of the source code. Default is default system encoding</span><span id="bbdd" class="mu kx iq mq b gy nd mw l mx my">#sonar.sourceEncoding=UTF-8</span></pre><h1 id="d3a7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">5.构建您的应用程序</h1><p id="4d3f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">你可能读过SRP——单一责任原则和变量命名，所以它们不仅仅是关于python、java、c#或任何其他语言的编程，它们是通用原则，几乎在任何地方都有效，甚至在文件夹创建中。</p><p id="1153" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">因此，最好将您的应用程序拆分到不同的文件夹中，并给它们指定相应的名称，并将您的数据分开存储。<br/>例如:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="a3d4" class="mu kx iq mq b gy mv mw l mx my">├── LICENSE<br/>├── Makefile<br/>├── project.toml<br/>├── pytest.ini<br/>├── README.md<br/>├── setup.cfg<br/>├── setup.py<br/>├── sonar-project.properties<br/>├── .ci<br/>│   ├── some_pipeline.yaml<br/>│   ├── scripts<br/>├── src<br/>│   ├── app<br/>│   ├── requirements_dev.txt<br/>│   └── requirements.txt<br/>├── tests<br/>│   ├── integration<br/>│   │   └── __inti__.py<br/>│   └── unit<br/>│       └── __init__.py<br/>└── tox.ini</span></pre></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="b193" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这里有一个<a class="ae kv" href="https://github.com/aram2726/python_application_blueprint" rel="noopener ugc nofollow" target="_blank">示例应用蓝图</a>。感谢阅读。</p></div></div>    
</body>
</html>