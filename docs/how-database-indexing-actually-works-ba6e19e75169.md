# 数据库索引的实际工作方式

> 原文：<https://betterprogramming.pub/how-database-indexing-actually-works-ba6e19e75169>

## 一个强大概念的简要概述

![](img/fc49a49e5e7997a0971d759e5eec6020.png)

[Chiara F](https://unsplash.com/@quasichiara?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 在 [Unsplash](https://unsplash.com/s/photos/bookmarks?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍照。

数据库的特点是有组织地存储数据。存储对于数据的存放位置有特定的结构。每种数据库类型都有自己的数据存储格式。它们针对特定的用例进行了调整和优化。在下面的示例中，我们有一个包含汽车信息的数据库:

![](img/a66e3ab677a89004bebda0f490e987c5.png)

包含汽车的数据库表示例

这看起来不错，很容易通过它导航。但你有没有问过自己，这些数据实际上是如何存储的？

# 内存储器

每个数据库都存储在一个应用了特定编码和格式的文件中。为了简单起见，让我们假设一个数据库由一个 CSV 文件支持。看起来是这样的:

```
ID,Brand,Model,Color,Price
1,Ford,Focus,Grey,42000
2,Toyota,Prius,White,40500
3,BMW,M5,Red,60000
4,Audi,A3,Black,38000
5,Toyota,Camry,White,51500
6,VW,Golf,Grey,32000
```

这看起来很简单。只用六个条目进行查找不成问题。你能想象如果你有 100，000 个条目吗？浏览文件会变得非常慢。查询时间与文件大小成比例增加。当我们知道数据库会随着时间的推移而增长时，我们需要找到一个解决方案。

拯救指数来了。

# 数据库索引

数据库索引是一种数据结构，用于加速检索数据的操作。它看起来像什么？

如果我们需要在`ID 6`之前从我们的表中检索一辆汽车，直接跳到相应的行会更快，而不需要遍历其余的行。这是索引的主要思想。我们还需要保存指向相应条目的偏移量。

实现这一点的最简单的方法是在 hash 中为每个条目保留一个偏移量。键是我们要索引的列的值(在本例中，它是 ID 列)。哈希值是数据库文件中的偏移量。对于`ID = 1`，偏移量为`0`。对于`ID = 2`，偏移量为`24`。它可能看起来像这样:

```
Hash Index {1:0, 2:24, 3:51, 4:70, 5:92, 6:118} 1 => {0}         --------->   1,Ford,Focus,Grey,42000   
2 => {24}        --------->   2,Toyota,Prius,White,40500
3 => {51}        --------->   3,BMW,M5,Red,60000
4 => {70}        --------->   4,Audi,A3,Black,38000
5 => {92}        --------->   5,Toyota,Camry,White,51500
6 => {118}       --------->   6,VW,Golf,Grey,32000
```

添加索引后，通过 ID 查询汽车将更快返回结果。检索请求转到散列索引，并获取相应 ID 的偏移量。然后，它开始从必要的条目处的偏移量读取数据库文件。

索引是实现唯一性约束的适当方式。当您希望保证某一列中的值是唯一的时，就需要对该列建立索引。否则，每个插入操作都将卡在检查新数据是否已经存在上。

也可能有多个索引。如果我们需要任何其他列的快速查询，我们也可以在其上添加一个索引。例如，我们可以添加一个颜色索引，并通过颜色查询快车。但是每个新的索引都会给数据库带来额外的成本。

# 指数成本

首先，每个索引散列都需要额外的内存。我们添加的索引越多，使用的内存就越多。记住只在经常查询的列上添加索引是很重要的。否则，索引每一列将消耗大量内存。

其次，对于快速读取操作，写入操作会稍微慢一些。每当我们向表中添加一个条目时，我们还必须在散列索引中创建一个条目。类似的情况也适用于更新或删除数据。这是我们必须处理的权衡。

# 外卖食品

*   数据库索引是提高读取查询的好方法。
*   对于唯一性约束，对列进行索引是必要的。
*   随着每个新的索引，更多的内存将被消耗。
*   添加索引会影响写入和更新操作。

这就是简单散列索引的工作方式。使用数据库索引还有许多其他方法，比如排序字符串表或 B 树。它们使用更复杂的逻辑和优化的结构来实现更好的性能结果。

然而，保存偏移的想法保持不变。通过正确使用索引，您将能够在使用数据库时达到一个新的水平。