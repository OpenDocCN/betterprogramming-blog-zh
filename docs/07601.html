<html>
<head>
<title>Build Your Own Tesla Car Game With Just 60 Lines of Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">只需60行Python代码就能构建自己的特斯拉汽车游戏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-your-own-tesla-with-just-60-lines-of-python-3e80c69625a?source=collection_archive---------7-----------------------#2021-02-01">https://betterprogramming.pub/build-your-own-tesla-with-just-60-lines-of-python-3e80c69625a?source=collection_archive---------7-----------------------#2021-02-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7588" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">程序员拥有免费制作任何东西的工具</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3334cacd7ee7e183936d8e21ed1f6fd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cfq2waBikT5KKL5rkOr1Uw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://carcody.com/can-you-push-start-an-automatic-car/" rel="noopener ugc nofollow" target="_blank"> Carcody </a>，由作者编辑</p></figure><p id="da25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">短期来看，我讨厌埃隆·马斯克。</p><p id="b0c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">长期:我不能停止爱他。因为现在我还未成年，不能用他的任何产品。*迪斯科里的悲伤歌曲*</p><p id="29f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但不管怎样，我现在想开特斯拉。我去了<a class="ae ky" href="https://www.programming-hero.com/" rel="noopener ugc nofollow" target="_blank">我的团队</a>。他们让我吃惊。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8251" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">这个项目是关于什么的？</h1><ol class=""><li id="f786" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">学习建造自动驾驶汽车的基本但至关重要的知识(虚拟展示)。</li><li id="7dc9" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">通过用60行Python构建一辆自动驾驶汽车，了解运动、轨迹检测、方向检测和Elon财富秘密检测的基本原理—免费。</li><li id="a039" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">你会变得更聪明，就像埃隆·马斯克一样(你的朋友会嫉妒)。</li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="df61" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先决条件</h1><p id="208f" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">姐姐，你不需要任何东西来跟踪埃隆。老弟，对你来说有两个简单的先决条件:</p><ul class=""><li id="331a" class="mu mv it lb b lc ld lf lg li nn lm no lq np lu nq nc nd ne bi translated">在你的系统中安装<a class="ae ky" href="https://www.python.org/download/releases/3.0/" rel="noopener ugc nofollow" target="_blank">最新版本的Python </a>。</li><li id="fa3e" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nq nc nd ne bi translated">选择一个你觉得舒服的代码编辑器(PyCharm和代码比较酷)。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3ca5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">自动驾驶汽车的核心特征</h1><ul class=""><li id="9fea" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nq nc nd ne bi translated">首先，它可以在没有任何人类交互的情况下自动驾驶。</li><li id="1912" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nq nc nd ne bi translated">第二，如果路上有任何障碍，或者是路的尽头，或者是停车信号，它可以停止行驶。</li><li id="abe1" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nq nc nd ne bi translated">第三，它可以检测道路，并据此轮流。</li><li id="966e" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nq nc nd ne bi translated">第四，它可以自己到达目的地。</li></ul><p id="dfc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理解这四个核心特征，你就可以开始这个项目了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7c23" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">让我们跳过无聊的部分</h1><p id="f66a" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们需要创建一个有一些道路、汽车、转弯和障碍物的项目。这几乎就像设计一个游戏。</p><p id="3391" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，Python提供了一个名为<a class="ae ky" href="https://www.pygame.org/news" rel="noopener ugc nofollow" target="_blank"> pygame </a>的第三方模块，这是一组为编写视频游戏而设计的Python模块。这允许你用Python语言创建全功能的游戏和多媒体程序。</p><p id="979a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为它是第三方模块，我们需要先安装它，然后才能使用它。打开您的终端，输入以下命令来安装pygame:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="9eb9" class="nw md it ns b gy nx ny l nz oa">pip install pygame</span></pre><p id="1624" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装后，我们只需将该模块导入到我们的项目中，就可以访问该模块提供的各种功能:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="cf34" class="nw md it ns b gy nx ny l nz oa">import pygame</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ec6c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">让我们从有趣的代码开始</h1><p id="f7da" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们将用五个简单的步骤来完成这个项目。会很有趣的。</p><h2 id="9e72" class="nw md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">第一步。启动pygame</h2><p id="6202" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">从我的<a class="ae ky" href="https://github.com/programmer-karim/self-driving-car.git" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中获取资源，我们将一起跟进。</p><p id="8e5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些资源包含六种不同类型的赛道，汽车将在这些赛道上行驶。第六部有点难，但是和它一起工作会很有趣。</p><p id="c707" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一条赛道很简单:我们将有一条直路，我们必须在这条路上驾驶我们的赛车。</p><p id="d905" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从第一个轨道开始，我们需要做三件事:</p><ol class=""><li id="40c1" class="mu mv it lb b lc ld lf lg li nn lm no lq np lu nb nc nd ne bi translated">初始化pygame模块</li><li id="b49f" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">创建所需大小的窗口</li><li id="5cbf" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">加载轨道图像并将其添加到窗口中</li></ol><p id="69d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将从导入pygame模块开始:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="3a62" class="nw md it ns b gy nx ny l nz oa">import pygame</span></pre><p id="c82c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用模块前，请对其进行初始化:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="e2fd" class="nw md it ns b gy nx ny l nz oa">pygame.init():</span></pre><p id="30f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们使用<code class="fe om on oo ns b">display()</code>方法创建基本的pygame窗口。<code class="fe om on oo ns b">display</code>方法将简单地创建一个空窗口，我们可以在其中放置我们的元素。但是我们需要定义我们需要创建的窗口的大小。我们可以使用<code class="fe om on oo ns b">set_mode()</code>方法来做到这一点。</p><p id="b9cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe om on oo ns b">set_mode()</code>方法中，我们将以像素为单位的窗口大小作为Python元组来传递，该元组表示窗口的XY坐标。一个<a class="ae ky" href="https://www.w3schools.com/python/python_tuples.asp" rel="noopener ugc nofollow" target="_blank"> Python元组</a>是有效Python数据类型的逗号分隔元素的集合，用括号括起来，比如:()。</p><p id="0590" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们有了窗口，我们就可以加载图像并使用pygame提供的<code class="fe om on oo ns b">image</code>模块创建图像表面对象。图像表面在<a class="ae ky" href="https://www.pygame.org/docs/ref/image.html" rel="noopener ugc nofollow" target="_blank">字节缓冲区</a>内共享数据。没有图像类。图像作为曲面对象加载:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="ba32" class="nw md it ns b gy nx ny l nz oa">window = pygame.display.set_mode((1200, 400))<br/>track = pygame.image.load("track1.png")</span></pre><p id="2003" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe om on oo ns b">image</code>模块是pygame的必需依赖项，它提供了<code class="fe om on oo ns b">load()</code>方法，通过创建图像表面对象来加载传递的图像。</p><p id="50dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">方法<code class="fe om on oo ns b">blit()</code> — <em class="op"> blit </em>代表<em class="op"> </em> block image transfer —将一个表面的内容复制到另一个表面上。我们需要传递表面图像对象和我们想要在窗口中放置图像的位置。最后，我们可以使用<code class="fe om on oo ns b">update()</code>方法更新空窗口。</p><p id="f436" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述代码产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/f83c8d5f37b0d80f4f69231a8a2cf1bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WbsErnVS1_DSBSDU"/></div></div></figure><p id="e57a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经有了赛道，让我们添加赛车。我们将遵循与轨道相同的方法:使用<code class="fe om on oo ns b">blit()</code>加载图像并将其传输到窗口:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="2a65" class="nw md it ns b gy nx ny l nz oa">import pygame<br/>pygame.init()<br/>window = pygame.display.set_mode((1200, 400))<br/>track = pygame.image.load("track1.png")<br/>while True:<br/>    window.blit(track, (0, 0))<br/>    pygame.display.update()</span></pre><p id="10ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们添加汽车图像时，我们必须调整它的大小以符合我们的要求，因为默认的图像大小可能不合适。我们可以使用<code class="fe om on oo ns b">transform</code>模块的<code class="fe om on oo ns b">scale()</code>方法来调整图像的大小，并将图像对象和新的大小作为元组作为参数传递。</p><p id="b892" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述代码产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/302064a83a00acb778ac8799f9b38933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xn-UDXNU5l9gqryG"/></div></div></figure><p id="4c6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步完成。在第二步中，我们将在赛道上驾驶汽车，并在需要时停下来。</p><h2 id="6d5d" class="nw md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated"><strong class="ak">第二步。驾驶和控制汽车</strong></h2><p id="e800" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在赛道上驾驶赛车超级容易。</p><p id="f8b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们只需要改变汽车的Y坐标，它就会开始移动。简单的逻辑是在循环中减少两三个点的Y值，使其在Y轴上向上移动，让我们感觉汽车在移动:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="8fe7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们简单地将变量<em class="op"> </em> <code class="fe om on oo ns b">‘car_x’</code> <em class="op"> </em>和<code class="fe om on oo ns b">‘car_y’</code>的值作为汽车在<code class="fe om on oo ns b">blit()</code>方法中的位置传递，而不是像前面那样直接将<a class="ae ky" href="https://en.m.wikipedia.org/wiki/Hard_coding" rel="noopener ugc nofollow" target="_blank">的值硬编码为</a>的值。</p><p id="96be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，为了控制pygame中元素的移动并使它们可见，我们需要在每次迭代中引入一点延迟。这可以使用pygame中的<code class="fe om on oo ns b">time</code>模块来完成。</p><p id="ff77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。如果你现在运行代码，汽车就会移动。Whroom…！</p><p id="6af4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是有一个问题。赛车冲出了赛道，冲出了屏幕。一旦它到达路/道的尽头，我们需要停下来。为此，我们的汽车需要检测周围环境并做出相应的反应。</p><p id="7656" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在汽车上创建一个圆圈，作为摄像头:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="ca81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们简单地使用了一些数学知识，并用Python的<code class="fe om on oo ns b">draw</code>模块创建了这个圆。</p><p id="7497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe om on oo ns b">circle()</code>方法有几个参数:首先是窗口对象，然后是RGB格式的颜色、圆的位置和圆的大小。</p><p id="ff31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，有两行是我们计算和分配圆的坐标的地方，也就是说，我们需要汽车前面的圆，所以我们给汽车位置的XY坐标添加了固定值15:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="9093" class="nw md it ns b gy nx ny l nz oa">cam_x = car_x + 15<br/>cam_y = car_y + 15</span></pre><p id="db64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面更新的代码产生以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/8ea527ea6623b39cba8482f8d0e30f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tUKtmoPdmnU6WVGa"/></div></div></figure><p id="cce2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在有相机了。当您运行代码时，您会注意到相机贴在汽车上，工作正常。</p><p id="262f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在最后的部分是让赛车检测到赛道的终点。既然我们有相机，我们需要让它看得更远一点。如果白色轨迹结束，我们停止驾驶汽车。</p><p id="3896" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们声明一个变量<code class="fe om on oo ns b">focus_dis</code>,并给它赋值25。这意味着它将负责预见未来25步。然后我们做一点数学:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="bfab" class="nw md it ns b gy nx ny l nz oa">up_px = window.get_at((cam_x, cam_y - focal_dis))[0]<br/>    if up_px == 255:<br/>        car_y = car_y - 2</span></pre><p id="c486" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过使用当前位置值并检查前方轨道是否为白色(255代表白色)来获得前方轨道的位置。如果是这样的话，我们才移动汽车。</p><p id="e8f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，如果你注意到，当我们得到pygame窗口，我们的光标仍然在加载。我们将使用以下代码来消除它:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="de0e" class="nw md it ns b gy nx ny l nz oa">for event in pygame.event.get():<br/>        if event.type == pygame.QUIT:<br/>            drive = False</span></pre><p id="5cc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。现在我们的车停在了轨道的尽头。下面是完整的更新代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="0d5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它会产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/d3c8abdbd2e0a81c5f2dc75070bae105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i7zT6hfMiDx7PKCT"/></div></div></figure><p id="37d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哇！那是我们自己的无人驾驶汽车。</p><p id="17e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是:上面的代码不仅能够检测道路的尽头，还能检测是否有任何障碍(就像下面的track 2图像所示):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/661c7b64c63609abb7d524eec451436d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6NnybxZin016fh1A"/></div></div></figure><p id="f4af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的第二跑道有路障。但是我们的特斯拉可以探测到。它看到前面的车道是红色的而不是白色的，所以它停止了行驶。</p><p id="20a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，只需将轨道中的图像更改为<code class="fe om on oo ns b">‘track2.png’</code>:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="4e20" class="nw md it ns b gy nx ny l nz oa">track = pygame.image.load("track2.png")</span></pre><p id="b232" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们再次执行代码。它产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/29dba9b0d87daf021326dc6e1d3c02d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5KZ3qanlKGxnMSYI"/></div></div></figure><p id="a36c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看，我们的车停下来了！我们摇滚。(眨眼)</p><h2 id="02af" class="nw md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">第三步。处理转弯</h2><p id="0f46" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们更进一步。让我们试试将<code class="fe om on oo ns b">‘track3.png’</code>作为我们的赛道:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="236a" class="nw md it ns b gy nx ny l nz oa">track = pygame.image.load(“track3.png”)</span></pre><p id="9bce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行代码会产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/407e2052564f84dee74fd1ac60f0a590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CniJB9T6g_MAe8f2"/></div></div></figure><p id="0b5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它工作正常。但是现在，我们面临另一个挑战:以一种能够转弯的方式旋转汽车。</p><p id="9c07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哦，请理解这一点:在我们转弯之前，我们的汽车应该知道在那个特定的转弯之后有一条道路/轨道。所以在这个场景中，无论何时车停下来，我们都需要看右边。</p><p id="e676" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的汽车停在一个特定的点上，从这里开始它必须水平行驶——也就是说，在X轴方向上，而我们的Y轴将保持不变。为此，我们将定义另一个负责看到右侧的变量<code class="fe om on oo ns b">‘right_px’</code>，就像我们对<code class="fe om on oo ns b">‘up_px’</code>所做的那样:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="7db7" class="nw md it ns b gy nx ny l nz oa">right_px = window.get_at((cam_x + focal_dis, cam_y))[0]</span></pre><p id="a2e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，X轴+焦距和Y轴将保持不变。</p><p id="1cba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们定义一个变量<code class="fe om on oo ns b">‘direction’</code>，它将跟踪汽车必须移动的方向，让我们将其初始化为<code class="fe om on oo ns b">‘up’</code>:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="d866" class="nw md it ns b gy nx ny l nz oa">direction = ‘up’</span></pre><p id="2e3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将有一个<code class="fe om on oo ns b">if</code>条件来防止我们的<code class="fe om on oo ns b">up_px</code>等于255——也就是说，它不应该是一个白色轨道。如果<code class="fe om on oo ns b">right_px</code>等于255，这意味着右侧有一条白色赛道，需要转弯:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="9534" class="nw md it ns b gy nx ny l nz oa"># change direction (take a turn)<br/>    if up_px != 255 and right_px == 255:<br/>        direction = 'right'</span></pre><p id="2393" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。我们有检查<code class="fe om on oo ns b">up_px</code>是否是白色的<code class="fe om on oo ns b">if</code>条件，如果是，它将在Y轴移动汽车，记得吗？现在我们简单的加一个<code class="fe om on oo ns b">elif</code>条件，让我们的车向右拐:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="d74a" class="nw md it ns b gy nx ny l nz oa"># drive<br/>    if up_px == 255:<br/>        car_y = car_y - 2<br/>    elif direction == 'right' and right_px == 255:<br/>        car_x = car_x + 2</span></pre><p id="9765" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码现在产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/85367ba87f1d1050d62af36fc5e9d67d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B_qXsvcHGyxnZ5_9"/></div></div></figure><p id="1462" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在一定程度上满足了目的，赛车也在向右转。但是我们也需要旋转汽车，对吗？</p><p id="082f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe om on oo ns b">rotate()</code>方法来做到这一点。它需要两个参数:需要旋转的对象和角度。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="8ead" class="nw md it ns b gy nx ny l nz oa">car = pygame.transform.rotate(car, -90)</span></pre><p id="e5cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但当你这样做时，你会注意到车上的摄像头会粘在后面，而我们需要它在前面。为了解决这个问题，让我们定义一个初始化为零的变量<code class="fe om on oo ns b">‘cam_x_offset = 0’</code>。因为我们稍后会更改这个变量的值，所以我们只将这个变量定义为0。这个变量将决定摄像机的位置。所以当我们转弯的时候，我们也需要改变这个变量的值。</p><p id="d907" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，让我们检查一下我们的条件中方向的值。以下是更新后的条件语句:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="8c83" class="nw md it ns b gy nx ny l nz oa"># change direction (take turn)<br/>    if direction == 'up' and up_px != 255 and right_px == 255:<br/>        direction = 'right'<br/>        cam_x_offset = 30<br/>        car = pygame.transform.rotate(car, -90)</span></pre><p id="3167" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们完了。现在应该可以正常工作了。以下是到目前为止更新的全部代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="a2e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/691f3c678ac6ca56b243f62805bc4fbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OYLUiGzGPYjz2USu"/></div></div></figure><p id="cb42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">耶！那有效！</p><h2 id="a1af" class="nw md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">第四步。新轨道—向下移动</h2><p id="efbe" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在，让我们向前看，检查第4曲目:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="2961" class="nw md it ns b gy nx ny l nz oa">track = pygame.image.load("track4.png")</span></pre><p id="33dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/edaa63943ed5da318e4dfc6edaa76f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0NjHvCznD5GTZOfw"/></div></div></figure><p id="451e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它工作得很好，但这一次，我们需要我们的相机向下看(在输出中可以看到，我们有一个向下的轨迹)，我们的汽车需要再次转弯。现在你知道该怎么做了，对吧？</p><ol class=""><li id="c893" class="mu mv it lb b lc ld lf lg li nn lm no lq np lu nb nc nd ne bi translated">旋转汽车。</li><li id="0a58" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">创建<code class="fe om on oo ns b">down_px</code>变量向下看。</li><li id="f9ea" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">设置<code class="fe om on oo ns b">cam_y</code>偏移，设置相机在Y轴上的偏移。</li></ol><p id="6226" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这么简单，对吧？</p><p id="62e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是经过上述更改的更新代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="3891" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行它会产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/8bd43fdd7dcd3f1750a4f7f907b08a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sR1sqhQfD554SQAo"/></div></div></figure><p id="9cf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">耶！我们的自动驾驶汽车已经在学习自动驾驶了。</p><h2 id="c608" class="nw md it bd me ob oc dn mi od oe dp mm li of og mo lm oh oi mq lq oj ok ms ol bi translated">第五步。新赛道——最终之路</h2><p id="8adb" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">现在，让我们继续，检查第5首曲目:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="15cf" class="nw md it ns b gy nx ny l nz oa">track = pygame.image.load("track5.png")</span></pre><p id="41be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/bf75f9c85e27867183e81d55a95bbfd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zfvHyrQLGxBzyNzS"/></div></div></figure><p id="7373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的车左转之前，它一直工作得很好。我们的车现在可以上下左右移动。现在，我们需要做同样的改变，并处理条件，使我们的车左转。为什么离开？假设你在车里(绿点是前面的摄像头)。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="451a" class="nw md it ns b gy nx ny l nz oa">elif direction == 'down' and down_px != 255 and right_px == 255:<br/>        direction = 'right'<br/>        car_y = car_y + 30<br/>        cam_x_offset = 30<br/>        cam_y_offset = 0<br/>        car = pygame.transform.rotate(car, 90)</span></pre><p id="219e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这会让我们的车左转。让我们看看输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/8dc837875c2ff5c925b9aed96781d80a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jjMPvX8FEosNA6tH"/></div></div></figure><p id="9a48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们做到了。现在最后一件事就是再次制作方向<code class="fe om on oo ns b">up</code>并处理好车和相机位置。</p><p id="0c0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样的条件是:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="dc1b" class="nw md it ns b gy nx ny l nz oa">elif direction == 'right' and right_px != 255 and up_px == 255:<br/>        direction = 'up'<br/>        car_x = car_x + 30<br/>        cam_x_offset = 0<br/>        car = pygame.transform.rotate(car, 90)</span></pre><p id="73b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们执行代码来查看输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/b90c45eef6757a4dceae05a0862e2c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*08Uvu7xsr7pt3b5t"/></div></div></figure><p id="4d52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有用！我们已经处理了所有的方向，现在我们的汽车将能够在任何赛道上自动驾驶。试试<code class="fe om on oo ns b">‘track6’</code>来验证一下。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="2f22" class="nw md it ns b gy nx ny l nz oa">track = pygame.image.load("track6.png")</span></pre><p id="2a16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终执行会产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/122f180e7427d94249e184beec6f29be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EsUhBOGulZRBFTJb"/></div></div></figure><p id="f4d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哇，我们做到了。你有自己的无人驾驶汽车。你奶奶和埃隆·马斯克会为你骄傲的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c992" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">整码</strong></h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="f107" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">程序员总能免费得到任何东西。特斯拉也不例外。享受旅程。</p></div></div>    
</body>
</html>