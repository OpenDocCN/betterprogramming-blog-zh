<html>
<head>
<title>What Are Microservices All About?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务是怎么回事？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-are-microservices-all-about-578b563edaef?source=collection_archive---------9-----------------------#2021-07-01">https://betterprogramming.pub/what-are-microservices-all-about-578b563edaef?source=collection_archive---------9-----------------------#2021-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ce6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">微服务架构速成班</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/97baba2b2ed84328e19a90c9d307adce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g4DFUqwiPc-e-pAr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卡尔·海尔达尔在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="49ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">微服务目前风靡一时。我所看到的每一个地方，组织都在采用微服务架构，并投入大量资金将他们古老的巨石转化为闪亮的新服务。</p><p id="92f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有人说这只是一种趋势。不是所有的单片都需要成为微服务。哪怕只是一个趋势，我也不抱怨。软件世界的趋势出现和消失基本上意味着我不会很快丢掉工作。</p><p id="e9f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但这是一个有趣的问题，所以让我们稍微分解一下，好吗？</p><p id="ce09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一想到微服务，我就想到人。在你说我疯了之前听我说完！</p><p id="6e4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">微服务是一种将领域知识和业务规则保存在一个地方的方法。这样，每个服务(或人员)都有一个他们知道如何做得最好的任务，而不是一个服务(或人员)什么都知道。这是构建系统的深度优先方法。</p><p id="5303" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对我来说，突出的一点是对界限分离的令人不安的关注。这些界限必须源于业务领域。例如，如果您有一小部分来自服务A的逻辑要在服务B中执行，那么您不能在服务B中复制该代码！你必须问服务A，得到答案，然后再往前走。</p><p id="7a35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，通过将业务领域放在一个地方，我们简化了应用程序中业务规则和知识的维护。但是我们最终使应用程序本身变得更复杂了。就像他们说的，有得有失。</p><p id="eea9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这使得微服务能够很好地与他们工作的组织一起发展。随着业务的变化，支持业务的微服务也必须做出同样的反应。</p><p id="798e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在似乎是给出定义的最佳时机。</p><p id="65de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">微服务(也称为微服务架构)是一种架构风格，它将应用程序构建为一组服务，这些服务:</p><ul class=""><li id="2c5c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">高度可维护和可测试</li><li id="7d80" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">松散耦合</li><li id="4eb3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">可独立部署</li><li id="562e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">围绕业务能力组织</li><li id="9e03" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">由一个小团队拥有</li></ul><p id="823e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把这个再打开一点。</p><h1 id="1165" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">为什么更好？</h1><h2 id="4be3" class="nb mk it bd ml nc nd dn mp ne nf dp mt li ng nh mv lm ni nj mx lq nk nl mz nm bi translated"><strong class="ak">在SOC上吸毒过量</strong></h2><p id="df1f" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我已经唠叨过通过使用微服务分离了哪些问题。关注点分离(SOC)是这个架构的核心。从此以后，关于每一项改进的每一个决定都将源于您的关注点在应用程序中是如何定义的。</p><p id="0e75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从微服务的消费者那里抽象出特定功能/关注点的知识，使得微服务具有一致性。在契约(服务与外界交互的方式)改变之前，服务内部的任何改变都是高度孤立的。这在理论上确保了服务内部的任何改变都是独立的。</p><p id="d83e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这对开发应用程序的开发人员来说是个好消息，因为这意味着有限的集成测试就足够了。耶！</p><h2 id="5443" class="nb mk it bd ml nc nd dn mp ne nf dp mt li ng nh mv lm ni nj mx lq nk nl mz nm bi translated"><strong class="ak">更快的部署</strong></h2><p id="bd02" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">由于是业务中的变化触发了应用程序中的变化，因此将它放在单独的小仓库中可以确保只需最少的变化就能实现结果。</p><p id="c4ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个服务由一组开发人员(或一两个开发人员)独立管理，从而加快部署速度。</p><p id="5bd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可能会减少向it部门提议机会的周期时间。</p><h2 id="0d15" class="nb mk it bd ml nc nd dn mp ne nf dp mt li ng nh mv lm ni nj mx lq nk nl mz nm bi translated"><strong class="ak">权力下放弹性和绩效</strong></h2><p id="4783" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">既然我们已经反复讨论了分离点，让我们享受一下它给开发者带来的一点好处。</p><p id="252e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">技术人员不再受限于整个应用程序使用的工具。开发人员有更多的自由来选择合适的工具，而不是被应用程序中使用的工具所束缚。这从您使用的数据库模式反映到应用层本身。一切都是分开的。</p><p id="47d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从语言、框架、辅助服务，一切都可以在不牺牲功能的情况下得到最大程度的优化。这就是做一份工作的意义，而且要做好！</p><p id="10d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">微服务的另一个优势是可以在一个地方进行更改，而且只能在一个地方。在<a class="ae ky" href="https://samnewman.io/books/building_microservices/" rel="noopener ugc nofollow" target="_blank">山姆·纽曼的同一主题的书</a>中提到的黄金法则:</p><blockquote class="ns nt nu"><p id="ab6d" class="kz la nv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">"你能在不改变任何其他东西的情况下，改变一个服务并单独部署它吗？"</p></blockquote><h2 id="9feb" class="nb mk it bd ml nc nd dn mp ne nf dp mt li ng nh mv lm ni nj mx lq nk nl mz nm bi translated"><strong class="ak">轻松调试和测试变更</strong></h2><p id="ebdc" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我们将围绕边界和分离点讨论一会儿。你现在应该感觉到一个主题了。我们知道，我们希望我们的界限清晰明确。</p><p id="7afc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如何在代码中加强边界呢？您编写的测试用例一旦变更违反了边界就会中断。这意味着你需要一个自动化的测试套件，它是密封的并且不断更新。这将使您的微服务极具弹性，并且您的更改非常可靠。</p><p id="2e75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些契约也应该在代码中被很好地记录，这样新的开发者就知道他们也必须执行它。</p><h2 id="9c42" class="nb mk it bd ml nc nd dn mp ne nf dp mt li ng nh mv lm ni nj mx lq nk nl mz nm bi translated"><strong class="ak">根据需要放大和缩小</strong></h2><p id="9f66" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">开发人员希望使用率随着时间的推移而增加，并在设计时考虑到这一点，通常会设计出更好的产品。在分布式计算世界中，最好的扩展方式是<a class="ae ky" href="https://www.esds.co.in/blog/vertical-scaling-horizontal-scaling/#sthash.EvmvMvuS.dpbs" rel="noopener ugc nofollow" target="_blank">水平扩展</a>。</p><p id="caf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拥有设计精良的小型微服务有助于实现这一结果。功能X增加了流量？只需添加更多实例来处理负载。当负荷恢复正常时，缩小比例。这是魔法还是什么？</p><h1 id="102c" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">它会变得多么糟糕</h1><p id="519a" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">以上几点都会让生活无限美好。也许是太好了。</p><p id="009f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在理论上非常合理。但是微服务之旅是漫长而艰难的，充满了障碍和潜在的陷阱。如果开发人员不小心的话，这会使它变得更麻烦，得不偿失。</p><h2 id="78cb" class="nb mk it bd ml nc nd dn mp ne nf dp mt li ng nh mv lm ni nj mx lq nk nl mz nm bi translated"><strong class="ak">设计时没有考虑到失败</strong></h2><p id="4694" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">当服务失败时会发生什么？或者一个节点出故障了？还是数据中心崩溃？</p><p id="a42f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果所有依赖的服务都随之崩溃，整个系统可能会在几秒钟内崩溃。这不仅意味着您的用户需要大量的停机时间，也意味着您组织的声誉损失。</p><p id="cda9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数类似的问题可以通过适当的线程池管理、负载平衡和错误处理来缓解。虽然每个场景的技术细节都不同，但重要的是要用“失败是不可避免的”这句话来设计。</p><p id="ce51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">失败时有发生。但是一个考虑到失败的设计可以确保服务不会崩溃，不会影响到其他所有东西，而是以一种次优的方式运行。这方面的一个例子是，如果搜索网飞，那么屏幕上的电影仍然可以观看。</p><h2 id="168b" class="nb mk it bd ml nc nd dn mp ne nf dp mt li ng nh mv lm ni nj mx lq nk nl mz nm bi translated"><strong class="ak">没有严格执行的合同</strong></h2><p id="3b6c" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">API契约或边界是这种架构模式的核心。如果这一界限随着时间的推移而被侵蚀，或者从一开始就没有得到执行，那么就不会有什么好结果。</p><p id="20bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">微服务的内部实现不应该影响服务的客户。如果没有在自动化测试中恰当地覆盖，这样的漏洞是很难被发现的。</p><p id="5566" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种糟糕的契约是随着时间的推移逐渐消失的契约。最初，您可能有一个精心选择的、文档记录良好的合同，它同样适用于它所服务的所有下游系统。因此，该契约易于维护→1:N O(N)。</p><p id="3119" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是随着时间的推移，随着应用程序的发展，声音最大的下游系统请求进入服务的特殊窗口。随着时间的推移，您最终会延长合同并为各种下游系统进行定制。合同变成→N:N O(N)</p><p id="8200" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，虽然在理论上，一个严格执行的合同似乎很容易实现，但组织动力学在它在系统中的适用性方面起着关键作用。</p><h2 id="1cdc" class="nb mk it bd ml nc nd dn mp ne nf dp mt li ng nh mv lm ni nj mx lq nk nl mz nm bi translated"><strong class="ak">强大的监控和DevOps培养(更多研究)</strong></h2><p id="f3cb" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">要获得微服务架构的全部优势，需要严格的监控。在这一点上不能偷工减料。围绕监测的文化必须是主动的，而不是被动的。问题应该在发生时就被发现，而不是在用户报告影响时。</p><p id="81b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了监控之外，强大的部署管道使得特性的更新、集成和发布变得快速而简单。缓慢的部署和发布周期绝不应该成为我们用不属于现有微服务的功能堵塞现有微服务的理由。如果在需要的时候提供新的服务是如此痛苦，以至于开发人员不愿意这样做，那么随着时间的推移，这个架构将会崩溃。</p><h1 id="c40a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">结论</strong></h1><p id="b84c" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">微服务已经存在，并且被世界上越来越多的组织所采用。它需要的不仅仅是顶尖的开发实践，还有纪律和承诺。这些服务的维护是它们长期保持高性能和有用的关键。因此，它不仅仅是一个技术实现范例，它将定义开发和运营团队如何在一个组织内工作。</p></div></div>    
</body>
</html>