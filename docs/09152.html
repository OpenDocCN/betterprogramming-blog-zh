<html>
<head>
<title>How To Configure Placeholder Image Fallbacks for PWAs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为PWAs配置占位符图像回退</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-configure-placeholder-image-fallbacks-for-pwas-bab216e0031e?source=collection_archive---------11-----------------------#2021-07-20">https://betterprogramming.pub/how-to-configure-placeholder-image-fallbacks-for-pwas-bab216e0031e?source=collection_archive---------11-----------------------#2021-07-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b8b3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过添加图像占位符来创建类似本机应用程序的pwa，以防找不到原始图像</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bd8c2928d25857a0be0e1d99553c7d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vnTMjeY1evAz5em2MP9D9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://undraw.co/illustrations" rel="noopener ugc nofollow" target="_blank">插画</a>。</p></figure><p id="7f6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您还想添加离线功能，构建PWA有时会变得有点复杂。虽然建立良好的离线体验需要时间，但您可能会发现更多的方法来增强用户的离线体验。其中一种方法是确保每个图像都有一个占位符图像，作为在出现错误、缓存失效或网络状况不佳时的备用图像。</p><p id="a9c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们希望避免的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/1b9353bd1c3af23020b703124e457bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*f_mk8pCKX56ALtFebDz2OA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如果由于某种原因，您的原始图像不可用，就会发生这种情况。</p></figure><p id="b1da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图像不可用的情况:</p><ul class=""><li id="7d30" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">缓存的图像已过期。</li><li id="0922" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">用户离线，但没有图像被缓存。</li><li id="cd88" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">用户第一次导航到一个离线页面，图像不是预先缓存就是在运行时缓存。</li><li id="775d" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">由于重命名错误，未找到原始图像。</li><li id="f930" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">图像被意外地从CMS中删除，但仍在网站上使用。</li></ul><p id="edea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了修复这种糟糕的用户体验，我们需要“保护”我们的PWA，防止图像从网络或缓存中不可用！</p><p id="c0b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示一种简单的方法，在您的web应用程序中的任何地方包含这些占位符图像，甚至不需要接触您的原始应用程序代码！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/0f0e55343c457e592eae943428932741.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*LjGtSZF1A5ZWgONAqO1XtQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://thegoodmobileui.com/#/screenshot/makemytrip-images-placeholders" rel="noopener ugc nofollow" target="_blank"> MakeMyTrip示例</a>占位符图片截图</p></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="79fa" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">输入服务人员</h1><p id="79f4" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">为了在不接触应用程序代码的情况下，使这项功能简单易行，我们将使用一名服务人员。</p><p id="49de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">服务工作者在这里有用的原因是因为它的性质:服务工作者充当客户端(网站)与网络和缓存之间的代理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://www.wisdomgeek.com/development/web-development/service-worker-progressive-web-applications/"><div class="gh gi no"><img src="../Images/028def44c98a786080fdda0a1fffa49b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HA8iQNLCphXh9wTp.jpeg"/></div></a><p class="ku kv gj gh gi kw kx bd b be z dk translated">服务工作者充当客户端(网站)与网络和缓存之间的代理。图由<a class="ae ky" href="https://zhuanlan.zhihu.com/p/54004486" rel="noopener ugc nofollow" target="_blank"> Fundebug </a>绘制。</p></figure><p id="d6ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于服务人员的HTTP请求拦截功能，我们将在应用程序中添加以下逻辑:</p><ol class=""><li id="1cba" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu np mc md me bi translated">一旦用户登陆页面，注册一个服务人员。</li><li id="6de4" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu np mc md me bi translated">预缓存占位符图像，以便将其保存在用户的设备上。</li><li id="26cf" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu np mc md me bi translated">监听客户端图像请求(例如，<code class="fe nq nr ns nt b">img</code>的<code class="fe nq nr ns nt b">src</code>属性将触发一个请求)。</li><li id="89f8" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu np mc md me bi translated">在服务人员内部，检查网络中是否存在映像。</li><li id="9849" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu np mc md me bi translated">如果没有，检查它是否存在于缓存中。</li><li id="675c" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu np mc md me bi translated">如果它也不存在，用预先缓存的占位符图像来响应。</li></ol></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="1bd1" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">好吧，现在怎么办？</h1><h2 id="ab43" class="nu ms it bd mt nv nw dn mx nx ny dp nb li nz oa nd lm ob oc nf lq od oe nh of bi translated">1.注册服务人员</h2><p id="7da7" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">您可以在您的<code class="fe nq nr ns nt b">index.html</code>文件或<code class="fe nq nr ns nt b">app.js</code>文件中注册服务人员。如果您还没有注册服务人员，这将是您必须在应用程序代码中进行的唯一<em class="og">更改</em>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="67df" class="nu ms it bd mt nv nw dn mx nx ny dp nb li nz oa nd lm ob oc nf lq od oe nh of bi translated">2.预缓存占位符图像</h2><p id="b0e1" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">对于预缓存，更安全的做法是使用工具箱工具<a class="ae ky" href="https://developers.google.com/web/tools/workbox/guides/precache-files#generating_a_precache_manifest" rel="noopener ugc nofollow" target="_blank">生成预缓存清单</a>，并确保您的占位符图像包含在清单文件中。无论哪种方式，请仔细检查URL是否与正确的图像匹配。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="95bd" class="nu ms it bd mt nv nw dn mx nx ny dp nb li nz oa nd lm ob oc nf lq od oe nh of bi translated">3.监听任何图像获取事件</h2><p id="d9ff" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">根据您的要求，选择您希望有占位符后备图像的图像。</p><p id="88fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nq nr ns nt b">HANDLER</code>通常是工具箱策略应该去的地方，但是这一次，我们将使用一些更加定制的东西。</p><pre class="kj kk kl km gt oj nt ok ol aw om bi"><span id="fd56" class="nu ms it nt b gy on oo l op oq">/* <!-- -->service-worker.js<!-- --> */</span><span id="1ccc" class="nu ms it nt b gy or oo l op oq">workbox.routing.registerRoute(<br/>  /\.(?:webp|png|jpg|jpeg|svg)$/,<br/>  /* &lt;HANDLER&gt; */<br/>)</span></pre><h2 id="880a" class="nu ms it bd mt nv nw dn mx nx ny dp nb li nz oa nd lm ob oc nf lq od oe nh of bi translated">4.检查网络和缓存中的图像</h2><p id="24c5" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我们仍将使用<a class="ae ky" href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies#stale-while-revalidate" rel="noopener ugc nofollow" target="_blank"> stale-while-revalidate策略</a>，但仅当在缓存或网络中找到映像时。如果没有找到，我们抛出一个<code class="fe nq nr ns nt b">Error</code>,稍后我们捕获并处理它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="b6dd" class="nu ms it bd mt nv nw dn mx nx ny dp nb li nz oa nd lm ob oc nf lq od oe nh of bi translated">5.用占位符图像响应</h2><p id="b498" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在捕捉到获取错误并知道在网络或缓存中没有找到请求的图像后，我们可以继续前进，用占位符图像来响应。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="71bf" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">把所有的放在一起</h1><p id="eab6" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">综上所述，我们将在你的<code class="fe nq nr ns nt b">service-worker.js</code>文件中得到如下代码，你的应用程序代码没有任何变化:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="dabc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这是一个相对容易和快速的实现，这样你的用户就不用看着那些没有对齐的丢失图像的盒子了。相反，他们将在你的PWA中享受到更像本地应用的感觉。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="4657" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">进一步阅读</h1><ul class=""><li id="3e93" class="lw lx it lb b lc nj lf nk li os lm ot lq ou lu mb mc md me bi translated"><a class="ae ky" href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-ux" rel="noopener ugc nofollow" target="_blank">离线UX考虑事项</a> —谷歌开发者</li><li id="f954" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" rel="noopener ugc nofollow" target="_blank">缓存API文档</a> — MDN文档</li><li id="16bf" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><a class="ae ky" href="https://developers.google.com/web/fundamentals/instant-and-offline/web-storage/cache-api" rel="noopener ugc nofollow" target="_blank">使用缓存API </a> —谷歌开发者</li><li id="0ccd" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><a class="ae ky" href="https://medium.com/@charistheodoulou/7c00c478d39b?source=friends_link&amp;sk=414f61ce6a9b9d612be1d617217422ad" rel="noopener">使用服务工作者和缓存API的缓存处理</a> —中等</li><li id="3598" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><a class="ae ky" href="http://pwa.js.org/" rel="noopener ugc nofollow" target="_blank"> PWA维客</a></li></ul></div></div>    
</body>
</html>