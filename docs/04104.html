<html>
<head>
<title>How to Containerize and Deploy Apps With Docker and Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Docker和Heroku封装和部署应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-containerize-and-deploy-apps-with-docker-and-heroku-b1c49e5bc070?source=collection_archive---------1-----------------------#2020-03-24">https://betterprogramming.pub/how-to-containerize-and-deploy-apps-with-docker-and-heroku-b1c49e5bc070?source=collection_archive---------1-----------------------#2020-03-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="111f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建、对接和部署Rails和PostgreSQL应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b6e924fe08ecbe9654e33a2ac68ed177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7izzw31SonfW_xqEVgQIMg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">托德·克雷文在Unsplash<a class="ae ky" href="https://unsplash.com/s/photos/whale?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">上的照片</a></p></figure><p id="82b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将学习在<a class="ae ky" href="https://www.docker.com/why-docker" rel="noopener ugc nofollow" target="_blank"> Docker </a>中开发应用程序，并通过构建一个简单的Rails/ <a class="ae ky" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>笔记应用程序部署到<a class="ae ky" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>。如果您从本文中复制并粘贴，您甚至不需要了解Rails就能做到。</p><p id="1b93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的一切应该适用于其他web开发框架，比如<a class="ae ky" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>。</p><p id="b461" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">声明:本教程的部分内容深受Docker Rails文档和Heroku容器注册文档的启发。我试图将它们结合在一起，并添加一些web dev，这样你就可以在Heroku上从一无所有到一个可用的容器化Rails应用程序。</p><p id="8b4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还为可能不直观的步骤添加了解释。我希望您能够将学到的知识应用到自己的应用中。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d8fb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Docker简介</h1><h2 id="fbe2" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">Docker是什么？</h2><p id="c01b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Docker是操作系统级虚拟化，允许通过容器化将应用从环境中分离出来。</p><p id="cdcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">容器附带了打包在一起的库和依赖项，可以在任何其他Linux机器上运行。</p><p id="b02b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你过去使用过vagger、VirtualBox或VMWare，你会发现Docker更轻更快。</p><h2 id="b15d" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">为什么Docker会改变游戏规则？</h2><ul class=""><li id="7cac" class="nl nm it lb b lc ng lf nh li nn lm no lq np lu nq nr ns nt bi translated">调试更容易，因为您的整个团队都在一个配置完全相同的环境中工作，而不管笔记本电脑和操作系统有何不同。不再有“它在我的笔记本电脑上工作。”</li><li id="4886" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">整个开发环境可以签入到源代码控制中，使团队中的新开发人员更容易上手。</li><li id="aff3" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">部署速度快得惊人，因为每个进程都有一个容器，并且每个进程只在必要时才重新构建。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eb7e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用Docker建立一个基本的应用</h1><p id="0112" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">导航到您编写代码的目录，并为此项目创建一个新目录。我们称我们的为<code class="fe nz oa ob oc b">rails-on-docker</code>。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="ce36" class="mu md it oc b gy oh oi l oj ok">mkdir <!-- -->rails-on-docker</span></pre><p id="daa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nz oa ob oc b">cd</code>进入项目目录，并在您喜欢的代码编辑器中打开它。和往常一样，我用的是<a class="ae ky" href="https://atom.io/" rel="noopener ugc nofollow" target="_blank"> Atom </a>。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="4b56" class="mu md it oc b gy oh oi l oj ok">cd rails-on-docker<br/>atom .</span></pre><h2 id="b79f" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">Dockerfile文件</h2><p id="d799" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated"><code class="fe nz oa ob oc b">Dockerfile</code>定义依赖关系并包含构建映像的命令。容器是图像的一个实例。在命令行上运行<code class="fe nz oa ob oc b">docker images</code>将显示所有本地图像。</p><p id="1cc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建<code class="fe nz oa ob oc b">Dockerfile</code>。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="8d49" class="mu md it oc b gy oh oi l oj ok">touch Dockerfile</span></pre><p id="af7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并粘贴以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="2997" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">Gemfile</h2><p id="4896" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">一个<code class="fe nz oa ob oc b">Gemfile</code>描述了Ruby程序的依赖关系。创建一个<code class="fe nz oa ob oc b">Gemfile</code>。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="ac57" class="mu md it oc b gy oh oi l oj ok">touch Gemfile</span></pre><p id="b4c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并粘贴以下内容:</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="7137" class="mu md it oc b gy oh oi l oj ok">source 'https://rubygems.org'<br/>gem 'rails', '~&gt;5'</span></pre><p id="99b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们初始化Rails应用程序时，这个文件将被清除并重新创建，但我们现在需要它来安装Rails。</p><h2 id="4adc" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">Gemfile.lock</h2><p id="bdd2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">创建没有任何内容的<code class="fe nz oa ob oc b">Gemfile.lock</code>。Bundler在这个文件中记录了安装的Ruby库的确切版本。在Rails开发中，您通常不会接触到这个文件，但是Docker需要它。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="5e83" class="mu md it oc b gy oh oi l oj ok">touch Gemfile.lock</span></pre><h2 id="bb93" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">entrypoint.sh</h2><p id="4964" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">创建<code class="fe nz oa ob oc b">entrypoint.sh</code>。这修复了一个Rails问题，如果有一个<code class="fe nz oa ob oc b">server.pid</code>存在，它会阻止服务器重新启动。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="0d1b" class="mu md it oc b gy oh oi l oj ok">touch entrypoint.sh</span></pre><p id="7d1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">粘贴在下面。这将删除<code class="fe nz oa ob oc b">server.pid</code>进程(如果存在的话);否则，服务器将无法启动。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="4555" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">docker-compose.yml</h2><p id="e38d" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated"><code class="fe nz oa ob oc b">docker-compose.yml</code>描述您的应用中的服务，例如<code class="fe nz oa ob oc b">web</code>、<code class="fe nz oa ob oc b">db</code>或<code class="fe nz oa ob oc b">redis</code>，它们在构建时都以单独的容器结束。创建此文件。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="17c3" class="mu md it oc b gy oh oi l oj ok">touch docker-compose.yml</span></pre><p id="c414" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">粘贴以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><h2 id="5cb5" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">构建应用程序</h2><p id="8d51" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">运行此程序来构建应用程序。这将为web构建图像，然后在容器中运行<code class="fe nz oa ob oc b">rails new</code>。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="c5e4" class="mu md it oc b gy oh oi l oj ok">docker-compose run web rails new . --force --no-deps --database=postgresql</span></pre><p id="03c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，您需要在任何传统的Rails命令前面加上前缀<code class="fe nz oa ob oc b">rake...</code>。</p><p id="2ef5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了一个新的<code class="fe nz oa ob oc b">Gemfile</code>，再次构建图像。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="1376" class="mu md it oc b gy oh oi l oj ok">docker-compose build</span></pre><p id="fcb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Rails应用程序中，更新<code class="fe nz oa ob oc b">/config/database.yml</code>,如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="fa85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意<code class="fe nz oa ob oc b">url: &lt;%= ENV[‘DATABASE_URL’] %&gt;</code>对于生产非常重要，因为<code class="fe nz oa ob oc b">DATABASE_URL</code>是在添加Postgres附加组件后Heroku赋予数据库URL的名称。</p><p id="127c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建数据库。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="0b2c" class="mu md it oc b gy oh oi l oj ok">docker-compose run web rake db:create</span></pre><p id="a49f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">启动应用程序。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="8427" class="mu md it oc b gy oh oi l oj ok">docker-compose up</span></pre><p id="59fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，您应该能够在本地浏览器中导航到<a class="ae ky" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，并看到应用程序正在运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/73cfea6461534fbc11039b5eb9633bf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MoFegdmP4rQmTSGhNJr-Tw.png"/></div></div></figure><p id="3027" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要停止应用程序，运行<code class="fe nz oa ob oc b">docker-compose down</code>或者直接终止终端中正在运行的进程。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7cf9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将基本应用程序部署到Heroku</h1><p id="029b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">这需要一个Heroku账户。</p><p id="a246" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从命令行登录Heroku。然后登录Heroku的容器注册表。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="8fae" class="mu md it oc b gy oh oi l oj ok">heroku login<br/>heroku container:login</span></pre><p id="6bfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Heroku上为您的应用创建一个应用。当你这样做的时候，记下它给你的应用名称。稍后您将需要它来在Heroku的控制台中配置正确的应用程序。这些名字通常都很古怪——我的名字是<code class="fe nz oa ob oc b">serene-stream-37066</code>。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="edbe" class="mu md it oc b gy oh oi l oj ok">heroku create</span></pre><p id="5c41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建一个映像，并将其推送到容器注册表中。第一次运行它可能需要10分钟(如果你的家庭网络和我的一样慢的话)。但是随后的运行只需要几秒钟。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="1bc8" class="mu md it oc b gy oh oi l oj ok">heroku container:push web</span></pre><p id="9ab7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">先前的命令把图像放在Heroku上。现在将图片发布到Heroku上的应用程序中。将流量重定向到它。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="3420" class="mu md it oc b gy oh oi l oj ok">heroku container:release web</span></pre><p id="427a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在浏览器中打开应用程序。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="cdc6" class="mu md it oc b gy oh oi l oj ok">heroku open</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/417606a567e0d84e14dd200c219df671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zkNqaVFa-TOb3w2SWBXkQ.png"/></div></div></figure><p id="4d59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哦，不。我们的应用程序运行在Heroku上，但我们有一个问题。那是因为我们还需要做一件事。</p><p id="7f83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://dashboard.heroku.com/apps" rel="noopener ugc nofollow" target="_blank"> Heroku </a>中添加Postgres插件。导航至<a class="ae ky" href="https://dashboard.heroku.com/apps" rel="noopener ugc nofollow" target="_blank"> Heroku </a>并点击您创建的应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/3f49bfc70cef767ba97057318ef78652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XTS8E47Yxsix3oPobia5wg.png"/></div></div></figure><p id="2fa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击资源。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/5beaa13376e9ad2807b2c1a10b332c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F9BJ0sStv82UaC1v8PIWDQ.png"/></div></div></figure><p id="2f96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在参考资料中，搜索“postgres”并点击Heroku Postgres。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/b22f512215580db0cbf5bdbcc6e16729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lk00xdQNo36AEJ_lVATA1A.png"/></div></div></figure><p id="8cce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将其添加到您的应用程序中。单击设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/81318e09e97a4781e280224b0d50bbc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RqYQ9lGDGxL3PEX5ONPKMg.png"/></div></div></figure><p id="102b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还记得我们之前在Rails应用中设置<code class="fe nz oa ob oc b">&lt;%= ENV[‘DATABASE_URL’] %&gt;</code>的时候吗？Heroku现在用关键字<code class="fe nz oa ob oc b">DATABASE_URL</code>将这个数据库的URL设置为一个环境变量。</p><p id="658f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们应该能够刷新我们的应用程序，瞧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/65ce7c731b8aab2afbe445330562dd3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0Iye3AINbf8F6VU9oW9Ug.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="aa28" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更新Rails应用程序</h1><p id="11dc" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">如果我们让它像这样，我们不能肯定我们在Heroku上的容器化应用程序可以正确地利用我们设置的数据库。所以让我们再深入一点。</p><p id="2a33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管我讨厌Rails搭建(太多的cruft)，但还是用它来快速实例化我们的应用程序的模型、视图和迁移文件。</p><p id="20b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意这是以<code class="fe nz oa ob oc b">docker-compose run web</code>命令为前缀的。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="efac" class="mu md it oc b gy oh oi l oj ok">docker-compose run web rails g scaffold Note header:string body:string</span></pre><p id="75f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在修改<code class="fe nz oa ob oc b">/config/routes.rb</code>,如下图所示。这会将Notes索引视图设置为应用程序的根URL。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="4cd4" class="mu md it oc b gy oh oi l oj ok">Rails.application.routes.draw do<br/>  resources :notes<br/>  root 'notes#index'<br/>end</span></pre><p id="2fc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在重建部署，并将生产指向新映像。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="0614" class="mu md it oc b gy oh oi l oj ok">heroku container:push web<br/>heroku container:release web</span></pre><p id="86a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">迁移Heroku上的数据库。这是必需的，因为我们已经推出了一个迁移文件。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="fb2e" class="mu md it oc b gy oh oi l oj ok">heroku run rake db:migrate</span></pre><p id="0e83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想在本地运行迁移，您应该做<code class="fe nz oa ob oc b">docker-compose run web rake db:migrate</code>。</p><p id="2ede" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并查看Heroku中的应用程序。</p><pre class="kj kk kl km gt od oc oe of aw og bi"><span id="c06c" class="mu md it oc b gy oh oi l oj ok">heroku open</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/0d37d40bc4c9df8ade30950d5d795fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ilvkTz05fXtFFsQQzBivw.png"/></div></div></figure><p id="25cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嘣！现在创建一些笔记来庆祝(并确保它有效)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d3a2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="5c08" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">你做到了！您已经构建了一个Rails应用程序，将其容器化，并部署到Heroku。虽然这是一个非常简单的应用程序，但你现在已经有了Docker做什么和如何使用它的框架。</p><p id="0e63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想要一个挑战，尝试为<code class="fe nz oa ob oc b">redis</code>添加另一个服务，它可以处理后台工作，比如向新注册的用户发送确认电子邮件。</p></div></div>    
</body>
</html>