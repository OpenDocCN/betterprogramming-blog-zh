# 你真的是 API 第一还是只是觉得？

> 原文：<https://betterprogramming.pub/are-you-really-api-first-or-do-you-just-think-it-24ffc47ec7ea>

## API 优先涉及的过程变化和文化变化一样多

![](img/e03d15e77679271ffbdc120125e0071f.png)

照片由[苏三·李](https://unsplash.com/@blackodc?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)在 [Unsplash](https://unsplash.com/s/photos/network?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 拍摄

我最近有机会会见了 API 领域的[波兹曼](https://www.postman.com)高管和其他行业领袖。这是一次可怕的、令人兴奋的、又令人谦卑的经历。我们谈论了从开发者体验到 API 生命周期到 API 优先开发，甚至是 API 前景的未来。

太棒了。

我毫不掩饰我对两件事充满热情:无服务器和 API。置身于最热情的 API 负责人中间令人振奋。

当我们开始围绕 API 优先开发展开对话时，一些事情引起了我的注意。多年来，我一直在谈论 API 优先，并认为我正在这样做，但当我们谈论实现的细微差别时，我很快意识到我认为这是一个谎言。

好吧，不是真的撒谎，但是我被误解了。我发现你可能和我一样有错误的印象。

所以让我们来讨论一下，弄清楚你是真的在开发 API 优先，还是你只是认为你是。

# 什么是 API 优先？

我永远不会像《邮差》中的[金巷](https://twitter.com/kinlane)那样解释这一点。他可以在 13 分钟内解释成为 API 第一公司的所有方面。

高层次的，API 优先意味着你优先考虑你的 API 作为你的产品。您在它们的设计、实现、安全性和可发现性中加入了有意的策略。

虽然这些特征听起来像是需要重点关注的显而易见的组成部分，但它实际上是区分因素。

传统上，你会看到一些公司将设计、安全性、可发现性等重点放在他们正在构建的应用程序上。这意味着他们向客户提供的全栈应用。这本质上不是问题，但它不是 API 优先的。

使用 API-first，上下文就是您的 API。这是用来操纵你的系统的机制。你把你的重点放在那里，这样集成商就有和你一样的系统钥匙(除了一些例外)。

> *API-first 是一种思维方式的转变，从为你的消费者构建定制的应用程序到让他们自己构建。*

消除您创建和维护定制应用的麻烦。为用户提供有意义的开发者体验，他们会以你意想不到的方式改变你的系统。

如果你认为你已经这样做了，那么我也是。让我们来讨论一下这一切在日常生活中意味着什么。

# 那是什么意思？

当将 API 优先的开发付诸实践时，您必须做出的标准流程更改中的细节真正浮出水面。需要改变的不仅仅是事件的顺序，还有组织工作的努力。

## 定义工作

定义了 API-first 第一阶段。API 开发的定义阶段不仅仅涉及开发人员。它涉及到业务和产品单元与开发一起工作，以清楚地定义这个 API 想要带来的功能。

*你在努力解决什么业务问题？涉及哪些数据实体？这些实体的生命周期是什么？*

更详细的问题——这应该是一个补丁还是一个 PUT，我们应该如何构造端点格式，以及我们如何处理分页——应该已经在您的[治理模型](https://blog.postman.com/platform-api-governance/#api-design-consistency)中得到回答和定义。

如果您还没有合适的治理模型，这将是一个很好的起点。如果您不知道从哪里开始构建治理模型，您可以使用[Postman Open Technologies Governance Rules](https://www.postman.com/postman/workspace/postman-open-technologies-governance-rules/overview)集合作为基础。

治理规则意味着被迭代。所以，找到你喜欢的，进行修改，解决任何新出现的问题。

重要的是你从某个地方开始。

无论您是从头开始创建一个全新的 API，还是向现有 API 添加功能，以这种方式处理工作都是一样的。第一步是让小组成员一起讨论业务目标，并清楚地定义问题领域。

## 拆分故事

当我第一次开始使用我的 API-first 版本时，我的印象是它意味着我必须首先处理端点故事。

> *API 优先并不意味着简单地在你的 UI 故事之前做你的 API 故事*

事实上，在 API 优先的开发中同时处理 UI 和 API 实现是完全可行的。

您的第一组故事是构建出 [API 规范](https://www.openapis.org/)，其中包括端点、模式以及请求和响应的示例。一旦这些完成，你就可以[创建一个模拟服务器](https://learning.postman.com/docs/designing-and-developing-your-api/mocking-data/setting-up-mock/)，它将以预期的格式返回假数据。

记住这一点，当您开始 API 的真正实现时，您的 UI 开发就可以开始了。请记住，使用这种开发方法，您将 API 视为您的产品。基于它构建的任何 UI 都是增值的。

## 测试和监控

弹性和健壮性是 API 开发的关键成功指标。为了测试这些组件，您的 API 应该有各种不同的测试，以不同的方式对它们进行测试。

*   契约测试—验证 API 接受并在请求和响应中返回正确的模式
*   性能测试——确保您的 API 在预期的时间内返回响应
*   安全测试—确定您的 API 是否具有正确的数据和端点访问控制
*   端到端测试—在系统中运行工作流，以确保不同的业务目标可以完成

您不仅应该对您的 API 进行这些测试，还需要有一种方法来确保它们不会抛出错误。使用任何种类的 [APM](https://www.dynatrace.com/news/blog/what-is-apm-2) ，像 [DataDog](https://www.datadoghq.com/) 、 [New Relic](https://newrelic.com/) ，甚至 [Postman](https://learning.postman.com/docs/monitoring-your-api/intro-monitors/) 来监控你的测试的成功率，并在某些东西停止工作时通知适当的团队。

> *将自动化 API 测试作为 done 定义的一部分，表明您正在做 API 优先的正确工作。*

如果您没有在开发周期中运行这些测试，那么您需要开始了。合同测试和性能测试[可以动态生成。但是对于端到端的测试，你需要有意识的手工操作来运行真实的场景。](/dynamic-test-generation-with-open-api-spec-3-0-10dacd7866c2)

你越能自动化你的消费者正在运行的场景，你就越有可能不会推出一个[突破性的变化](https://blog.postman.com/how-to-catch-breaking-changes-before-they-happen/)。

## 使您的 API 可被发现

当我管理一个云原生开发团队时，我们会完成一个新 API 的工作，然后继续下一个故事。我公司周围的其他团队不知道有新的 API，即使他们发现了，也不知道如何找到它并与之集成。

见鬼，即使是我团队中的开发人员也很难找到 API 的细节。

这是因为我们没有使我们的 API 可被发现。

想象一下，你正在出售你的房子，你的房地产经纪人把它列在他们的网站上。他们不会在你的院子里放一个标志，也不会在社交媒体上做广告。很有可能你的房子在任何合理的时间内都卖不出去。这是因为它不可被发现。

买家应该如何找到你的房子？他们一定要知道才能看你房产经纪人的网站吗？那是不会发生的。

同样的事情也适用于构建 API。你需要把它放在人们知道的地方，然后大肆宣传。

如果有人问你在哪里可以找到你的 API 的文档，或者你有什么可用的 API，你可以认为这是一个危险信号，表明你在可发现性方面做得不够好。

Postman 有一个[公共网络](https://blog.postman.com/postman-public-api-network-is-now-the-worlds-largest-public-api-hub/)和一个[私有网络](https://blog.postman.com/new-private-api-network-for-easier-discovery/)，让你可以轻松地在外部和内部共享你的 API。

# 结论

API 优先意味着把你的 API 当成你的产品。

要做到这一点，你的关注点和重点必须改变。你不会根据你认为用户应该点击的位置来驱动设计决策。相反，您正在考虑如何轻松地让集成商将请求链接在一起，以完成一个业务场景。

跨组织工作，以有意义的方式设计你的 API 规范。重复设计，直到你满意为止。在规范完成之前，不要开始编写代码。

重新关注监控能力。改变你对完成的定义。不要接受任何需要在每次变更时进行手动测试的东西。自动化测试，并在测试失败时通知团队。

让世界知道你做了什么。把你的 API 放在一个容易被发现的网络中。当你的 API 做好了，不要依赖口碑和部落知识。您的开发团队无法扩展。他们不能开发新的 API，也不能宣传他们已经完成的 API。

这种开发方法感觉像是颠倒了标准开发。这是件好事。

> 颠覆推动创新。

通过将您的组织转向关注 API 和开发人员体验，您打开了从未想过可能的事情的大门。

人是有创造力的。如果你给他们你的 API 的钥匙，他们会让它做你从来没有想过的事情。这就是我们在这里的目的。

编码快乐！