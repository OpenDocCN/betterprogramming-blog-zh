<html>
<head>
<title>GraphQL Essentials You Need to Know as an iOS Developer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为iOS开发人员，您需要了解的GraphQL基本知识</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/graphql-essentials-you-need-to-know-as-an-ios-developer-fe9c42bbbeb2?source=collection_archive---------17-----------------------#2020-04-14">https://betterprogramming.pub/graphql-essentials-you-need-to-know-as-an-ios-developer-fe9c42bbbeb2?source=collection_archive---------17-----------------------#2020-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1902" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">作为移动开发者如何用好GraphQL</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fa4ad6ec0dedc2326080bc7230395c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JILOgn9tLoMbrhVN"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">刘易斯·恩古吉在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="b39d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，GraphQL是一种描述如何请求数据的API设计范例。它是目前更广为人知的REST方法的替代方案。最初，GraphQL是由脸书在2015年开发并开源的。从那以后，它被许多公司采用。他们选择GraphQL而不是REST的原因是，GraphQL通过让客户端能够定义他们需要的来自服务器的确切数据，消除了REST的低效。</p><p id="d68f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将为您提供GraphQL的基本知识——尤其是作为一名iOS开发人员您需要知道的知识。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9afc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">GraphQL的第一印象</h1><p id="cce8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于GraphQL如何工作的第一印象，让我们看一个与REST相比如何使用GraphQL的例子。</p><p id="6e6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您正在实现一家宠物店的前端，并且您想要显示一个用户所下订单的概览。</p><p id="1805" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">REST API会公开多个端点，每个端点返回特定的信息。因此，通过使用REST API，您可以拥有以下端点:</p><ul class=""><li id="0302" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">/orders</code>获取所有订单的基本信息。</li><li id="ea91" class="mz na it lb b lc nm lf nn li no lm np lq nq lu ne nf ng nh bi translated"><code class="fe ni nj nk nl b">/order/[id]</code>获取特定订单的详细信息。</li></ul><p id="3ce4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您从<code class="fe ni nj nk nl b">/orders</code>端点获得的信息可能不足以满足前端需求，因为您希望在订单概览中直接显示一些细节。要使用REST实现这一点，您可以:</p><ol class=""><li id="d76c" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu nr nf ng nh bi translated">为每个订单发送一个额外的请求，将更多的细节加载到<code class="fe ni nj nk nl b">/order/[id]</code>端点。</li><li id="3641" class="mz na it lb b lc nm lf nn li no lm np lq nq lu nr nf ng nh bi translated">或者要求后端团队向<code class="fe ni nj nk nl b">/orders</code>端点添加更多数据。</li></ol><p id="655f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">两种方式都不理想。对于第一种方法，您最终会向服务器发送大量请求。对于第二种方法，每次前端需求改变时，您可能需要改变后端。</p><p id="1175" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">GraphQL来拯救。</p><p id="2a7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与REST相比，GraphQL APIs只公开一个端点。您可以精确地指定您需要的数据。通过使用GraphQL，您可以在GraphQL查询中定义订单所需的所有细节字段。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/c85e88e27e8ea24e18fadf02703e9073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uXJhuiK-tkCnvts3Ic8Dnw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GraphQL查询的示例。</p></figure><p id="f98c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您将向服务器发送一个带有该查询的请求，并准确地获得您定义的数据——不多也不少。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4d8c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">GraphQL作为服务器端运行时</h1><p id="5bfa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作为一名iOS开发人员，您不一定需要了解GraphQL如何在服务器端实现的所有细节。所以我在这里就不赘述了。</p><p id="e770" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是，GraphQL不依赖于任何特定的框架、编程语言或数据库。您可以将GraphQL更多地视为现有后端实现和客户端之间的一层。</p><p id="29b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多不同的编程语言都支持GraphQL，包括Swift。例如，<a class="ae ky" href="https://github.com/GraphQLSwift/Graphiti" rel="noopener ugc nofollow" target="_blank"> Graphiti </a>是一个用于构建GraphQL模式的Swift库。要让GraphQL服务在服务器上运行，需要为每个可以访问的数据片段定义所谓的解析器。解析器是一种方法，它告诉GraphQL如何以及在哪里获取您所请求的数据(例如，通过访问现有的数据库)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eae2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">GraphQL基本概念</h1><h2 id="7f22" class="nt md it bd me nu nv dn mi nw nx dp mm li ny nz mo lm oa ob mq lq oc od ms oe bi translated">问题</h2><p id="9712" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在上面的例子中，我们已经看到了一个简短形式的GraphQL查询。查询用于从服务器获取数据，就像REST中的get请求一样。让我们看看查询的基本部分:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/c7fcae432f80a7bbe3309a2b42fe0879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sz8z4iQ8oGZXCi0ybtBy-A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GraphQL查询的基本部分。</p></figure><p id="bf56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在这里使用了长形式的查询，并将其命名为<code class="fe ni nj nk nl b">Order</code>。在生产应用程序中，您通常会使用这种长格式来增加代码的可读性。</p><p id="7843" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了能够重用查询，GraphQL提供了变量，您可以将这些变量作为参数传递到查询中。在我们的示例中，订单的<code class="fe ni nj nk nl b">id</code>作为参数传入。参数后面的感叹号<code class="fe ni nj nk nl b">!</code>表示它是必需的。没有它，参数将是可选的。</p><p id="cc53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">字段是您所请求的数据单元，最终作为字段出现在您的JSON响应数据中。因此，对于上面的查询，您将得到如下所示的JSON响应:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/9f515ece01e8fbe9544f0364b3621787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9VSRL299OBnWCDrOgh5kw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GraphQL查询的JSON响应。</p></figure><h2 id="75f3" class="nt md it bd me nu nv dn mi nw nx dp mm li ny nz mo lm oa ob mq lq oc od ms oe bi translated">突变</h2><p id="b95f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当使用API时，您还需要改变、删除或创建新数据。作为REST中POST、PUT和DELETE请求的等价物，GraphQL中使用了所谓的<code class="fe ni nj nk nl b">mutations</code>。</p><p id="7400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">突变由与查询相同的部分组成。创建新秩序的一个变种可能是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/1db54fac0386ab5839f6ceb54f925ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jiHmYFzmJ8wGhaf8IQwLlg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GraphQL突变的例子。</p></figure><p id="b012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，创建订单所需的订单数据作为类型为<code class="fe ni nj nk nl b">OrderInput</code>的参数传入。与查询一样，您可以定义应该在响应中返回的字段。上面的变异将返回新创建的订单的<code class="fe ni nj nk nl b">id</code>。</p><h2 id="d00e" class="nt md it bd me nu nv dn mi nw nx dp mm li ny nz mo lm oa ob mq lq oc od ms oe bi translated">GraphQL模式和浏览器</h2><p id="b9cd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">作为一个前端开发人员，你需要知道你可以要求什么样的数据，你可以选择哪些字段。这就是模式的由来。每个GraphQL服务都定义了一组类型，这些类型完整地描述了您作为客户端可以查询或变更的所有可能的数据。当您向该服务发送查询时，它将根据该模式执行，以检查它是否有效。</p><p id="8801" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了探索这种模式，GraphQL服务通常会提供一个类似graph QL的浏览器浏览器。使用GraphiQL，您可以针对服务编写和测试您的查询。它提供文档并支持在您键入时进行调试，给出提示并指出错误。在下面的图片中，你可以看到GitHub的GraphiQL服务来探索他们的API:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/83f664f9a0b15c25e44a18a2f3001601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VYR2_E31i-t8U42v.gif"/></div></div></figure><h2 id="5a92" class="nt md it bd me nu nv dn mi nw nx dp mm li ny nz mo lm oa ob mq lq oc od ms oe bi translated">碎片</h2><p id="404e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是我想介绍的最后一个GraphQL概念。片段是可重用的单元，可以在构建更复杂的查询时使用。例如，您可以将订购产品背后的供应商提取到一个单独的片段中，以便在不同的查询中重用它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/7ca809e279c2c3d2746d808f81d2a59d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JHPnB83MWvEGv9YOytlRDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GraphQL片段的示例。</p></figure><p id="016a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提取订单时，您现在可以像这样使用定义的片段:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/ada328996232d0a791451c80f7215abf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3mZWPzZ4KwJHLz7OhB5xQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">GraphQL片段的用法示例。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3c52" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">iOS中的GraphQL</h1><p id="64c1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了能够从iOS应用程序向GraphQL服务发送请求，您可以使用与发送REST请求相同的工具自己构建请求。</p><p id="8fa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，为了发送GraphQL查询，您可以在HTTP GET请求的query参数中发送查询及其变量:</p><pre class="kj kk kl km gt ok nl ol om aw on bi"><span id="0b69" class="nt md it nl b gy oo op l oq or"><a class="ae ky" href="http://myapi/graphql?query={me{name...}}&amp;variables={...}" rel="noopener ugc nofollow" target="_blank">http://myapi/graphql?query={me{name...}}&amp;variables={...}</a></span></pre><p id="5628" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者在POST请求的正文中发送:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/75b78ce24376fc28224f8404b8ab2bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tGeQVJHTUyKaxb0MmzzUmQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">POST请求正文中的GraphQL查询。</p></figure><p id="fbe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是与GraphQL服务通信的一个更简单的方法是使用类似于<a class="ae ky" href="https://github.com/apollographql/apollo-ios" rel="noopener ugc nofollow" target="_blank"> Apollo iOS Client </a>的库。这个网络库是专门为使用GraphQL而设计的。您需要做的只是提供GraphQL服务的模式文件。然后，该库将根据您定义的查询生成强类型的Swift文件，因此您可以轻松地使用它们进行请求。</p><p id="b201" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是用Apollo发送请求的一个例子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/407f2bd6cfd9bca87c2b65ccdccb3e52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KllBQ4LU2NiyVThF6w_aJQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Apollo iOS客户端向GraphQL服务发送请求。</p></figure><p id="0294" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你感兴趣，你可以在下一篇文章中阅读更多关于如何使用Apollo iOS客户端的内容。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="70a7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="4374" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我希望这是对GraphQL世界的良好介绍。如果你想采取下一步行动，我建议你试试<a class="ae ky" href="https://developer.github.com/v4/explorer/" rel="noopener ugc nofollow" target="_blank"> GitHub的GraphQL explorer </a>，通读他们的文档，尝试不同类型的查询。这将让您很好地了解GraphQL在实践中是如何工作的。</p><p id="e3e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，你也可以通过阅读<a class="ae ky" href="https://graphql.org/learn/" rel="noopener ugc nofollow" target="_blank">官方文档</a>来深入了解GraphQL的概念。</p><p id="89f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你有任何问题或反馈吗？请在评论中告诉我。</p></div></div>    
</body>
</html>