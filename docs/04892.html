<html>
<head>
<title>The Proper Way to Start a Django Project With GraphQL (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用GraphQL启动Django项目的正确方法(第1部分)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/proper-way-to-start-a-django-project-with-graphql-6e230d4b4d2c?source=collection_archive---------13-----------------------#2020-05-19">https://betterprogramming.pub/proper-way-to-start-a-django-project-with-graphql-6e230d4b4d2c?source=collection_archive---------13-----------------------#2020-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ef9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">创建带认证的简单待办应用程序—基本设置</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/5c63acf00277c662fb96b2ff7fafea0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1X0-98EiQNkwBJj2vnTTqQ.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@cdr6934?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯里德</a>在<a class="ae kz" href="https://unsplash.com/s/photos/python-code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="894d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="lw">这是一系列文章中的第一篇，我们将创建一个现代的web应用程序，提供一个简单的带身份验证的待办事项应用程序，包括一个公开GraphQL API端点的Django后端，以及一个具有渐进式web应用程序功能的Next.js、React和Material UI前端。</em></p><p id="5f53" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">今天我们将创建一个基本的Django应用程序，它公开了一个GraphQL端点。在我们深入细节之前，让我们回顾一下几个概念:</p><ul class=""><li id="aeb9" class="lx ly it lc b ld le lg lh lj lz ln ma lr mb lv mc md me mf bi translated"><a class="ae kz" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>是一个高级Python Web框架，鼓励快速开发和干净、实用的设计—<a class="ae kz" href="http://djangoproject.com" rel="noopener ugc nofollow" target="_blank">djangoproject.com</a></li><li id="f27f" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><a class="ae kz" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a>是一种用于API的查询语言，也是一种用现有数据完成这些查询的运行时语言——<a class="ae kz" href="http://djangoproject.com" rel="noopener ugc nofollow" target="_blank">graphql.org</a></li><li id="ec75" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated"><a class="ae kz" href="https://graphene-python.org/" rel="noopener ugc nofollow" target="_blank"> Graphene </a>是一个在Python中快速构建GraphQL APIs的库。<a class="ae kz" href="https://docs.graphene-python.org/projects/django/en/latest/" rel="noopener ugc nofollow" target="_blank"> Graphene-Django </a>构建在Graphene之上，提供了一些额外的抽象，使得将GraphQL功能添加到您的Django项目变得很容易——<a class="ae kz" href="http://djangoproject.com" rel="noopener ugc nofollow" target="_blank">graphene-python.org</a></li></ul><p id="2cb7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我快速解释一下为什么为后端开发Django加石墨烯堆栈是有意义的。Django是一个流行的web框架。事实上，在最近几年排名前五的web框架(Spring、Django、Rails、Laravel和Express)中，Django是仅次于Spring的第二强。GraphQL被认为是表述性状态转移(REST)的下一个迭代，它有其局限性(后面会有更多介绍)。Graphene是开发人员想用Django公开GraphQL端点时使用的事实上的库。将所有这些放在一起，我们就有了一个现代而强大的后端起点。</p><p id="1d7f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在无聊的东西已经过时了，让我们开始研究代码吧！</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="0918" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">开始之前</h1><p id="360d" class="pw-post-body-paragraph la lb it lc b ld nk ju lf lg nl jx li lj nm ll lm ln nn lp lq lr no lt lu lv im bi translated">在深入Django之前，让我们先安装一个现代版本的Python和一个虚拟环境<a class="ae kz" href="https://docs.python.org/3/tutorial/venv.html" rel="noopener ugc nofollow" target="_blank">来运行我们的应用程序。为此，我们首先安装</a><a class="ae kz" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank"> Homebrew </a>，一个用于macOS(或Linux)的包管理器:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="012a" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">$ </strong>/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"</span></pre><p id="7a9b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后我们安装Python 3.x:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="1010" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">$ </strong>brew install python3</span></pre><p id="b0fd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，我们将安装一个名为<code class="fe nz oa ob nq b"><a class="ae kz" href="https://virtualenvwrapper.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">virtualenvwrapper</a></code>的库，这使得使用虚拟环境变得容易:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="6979" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">$ </strong>pip install virtualenvwrapper</span></pre><p id="8fcf" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后我们给<code class="fe nz oa ob nq b">~/.bashrc</code>(或<code class="fe nz oa ob nq b">~/.zshrc</code>)添加必要的配置:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="6641" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要激活<code class="fe nz oa ob nq b">virtualenvwrapper</code> <em class="lw">，</em>只需退出你的终端然后重新打开，或者运行<code class="fe nz oa ob nq b">source ~/.zshrc</code>。现在，让我们创建一个虚拟环境来应对:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="7919" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">$</strong> mkvirtualenv -p python3 mybackend</span></pre><p id="2f5a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">一旦该命令运行，您应该会看到您的提示更改为:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="757d" class="nu mt it nq b gy nv nw l nx ny">(mybackend) $</span></pre><p id="7dc1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这意味着您的虚拟环境是活动的，您运行的任何pip/Python命令都将使用该环境。您可以通过运行<code class="fe nz oa ob nq b">deactivate</code>来取消激活当前环境，并通过<code class="fe nz oa ob nq b">workon mybackend</code>重新激活它。恭喜你，你现在已经准备好开始你的Django项目了！</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="7861" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">Django入门</h1><p id="e728" class="pw-post-body-paragraph la lb it lc b ld nk ju lf lg nl jx li lj nm ll lm ln nn lp lq lr no lt lu lv im bi translated">如果你对Django完全陌生，你应该遵循他们的<a class="ae kz" href="https://www.djangoproject.com/start/" rel="noopener ugc nofollow" target="_blank">入门指南</a>。但是很快，我们首先安装Django:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="e45b" class="nu mt it nq b gy nv nw l nx ny">(mybackend) <strong class="nq iu">$</strong> pip install Django</span></pre><p id="fd38" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后我们创建我们的项目:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="ec2c" class="nu mt it nq b gy nv nw l nx ny">(mybackend) <strong class="nq iu">$ </strong>django-admin startproject mybackend</span></pre><p id="b9e8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您应该得到这样的文件夹结构:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="02de" class="nu mt it nq b gy nv nw l nx ny">mybackend/<br/>    manage.py<br/>    mybackend/<br/>        __init__.py<br/>        settings.py<br/>        urls.py<br/>        asgi.py<br/>        wsgi.py</span></pre><p id="a273" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来要做的是运行数据库迁移并启动开发服务器:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="6daa" class="nu mt it nq b gy nv nw l nx ny">(mybackend) <strong class="nq iu">$ </strong>cd mybackend<br/>(mybackend) mybackend <strong class="nq iu">$ </strong>python manage.py migrate<br/>(mybackend) mybackend <strong class="nq iu">$ </strong>python manage.py runserver</span></pre><p id="5814" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在访问<a class="ae kz" href="http://127.0.0.1:8080/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000/ </a>，Django应该上了。如果一切都按预期运行，那么继续冻结您的pip依赖项:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="d975" class="nu mt it nq b gy nv nw l nx ny">(mybackend) mybackend <strong class="nq iu">$ </strong>pip freeze &gt; requirements.txt</span></pre><p id="e441" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，任何签出您的代码(包括您的部署脚本)的人都可以运行<code class="fe nz oa ob nq b">pip install -r requirements.txt</code>来复制您的环境。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="18d4" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">设置代码样式工具</h1><p id="1b12" class="pw-post-body-paragraph la lb it lc b ld nk ju lf lg nl jx li lj nm ll lm ln nn lp lq lr no lt lu lv im bi translated">我知道，现在您已经启动并运行了后端服务器，您很高兴能够加入GraphQL支持！但是在我们进行任何实际的编码之前，建立一些通过林挺和自动格式化来加强代码质量的自动化工具是一个好主意。</p><p id="9828" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我坚信使用这样的工具，即使你是一个项目中唯一的开发者。他们解决了在微小的代码风格决策上花费时间的麻烦，使您的代码在整个项目中保持一致，并偶尔通过静态分析捕捉bug。所有这些都使得在时机成熟时，让下一个开发人员加入项目变得更加自然。它也很容易设置。</p><p id="0541" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们将使用三个公共库来实现这个目标:<code class="fe nz oa ob nq b"><a class="ae kz" href="https://flake8.pycqa.org/en/latest/" rel="noopener ugc nofollow" target="_blank">flake8</a></code>、<code class="fe nz oa ob nq b"><a class="ae kz" href="https://timothycrosley.github.io/isort/" rel="noopener ugc nofollow" target="_blank">isort</a></code>和<code class="fe nz oa ob nq b"><a class="ae kz" href="https://black.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">black</a></code>。<code class="fe nz oa ob nq b">flake8</code>是Python的林挺工具(类似于JS的<code class="fe nz oa ob nq b">ESLint</code>),<code class="fe nz oa ob nq b">black</code>是代码格式化程序(类似于JS的<code class="fe nz oa ob nq b">Prettier</code>),<code class="fe nz oa ob nq b">isort</code>是一个漂亮的小库，它将根据相关性对你的导入进行排序。当我们谈论最佳实践时，让我们也初始化一个git存储库，并通过一个方便命名的库<code class="fe nz oa ob nq b"><a class="ae kz" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">pre-commit</a></code>将这些林挺工具与预提交挂钩:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="4959" class="nu mt it nq b gy nv nw l nx ny">(mybackend) mybackend <strong class="nq iu">$ </strong>pip install isort flake8 black pre-commit seed-isort-config flake8-bugbear<br/>(mybackend) mybackend <strong class="nq iu">$ </strong>pip freeze &gt; requirements.txt<br/>(mybackend) mybackend <strong class="nq iu">$ </strong>git init</span></pre><p id="60e6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">并创建一个<code class="fe nz oa ob nq b">.gitignore</code>文件来忽略特定的文件:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="1046" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，在项目根目录下创建一个<code class="fe nz oa ob nq b">.pre-commit-config.yaml</code>,使用:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="a5e8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">项目根目录下的<code class="fe nz oa ob nq b">.flake8</code>文件包含:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="d17e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后运行以下命令:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="0f52" class="nu mt it nq b gy nv nw l nx ny">(mybackend) mybackend <strong class="nq iu">$ </strong>pre-commit install<br/>(mybackend) mybackend <strong class="nq iu">$ </strong>pre-commit run --all-files</span></pre><p id="e2f4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下次您将文件提交给Git时，这些工具将自动运行并抱怨您的代码(或者在可能的情况下自动修复)。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="f815" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">集成石墨烯</h1><p id="2e17" class="pw-post-body-paragraph la lb it lc b ld nk ju lf lg nl jx li lj nm ll lm ln nn lp lq lr no lt lu lv im bi translated">既然我们已经启动并运行了应用程序，让我们来集成石墨烯。假设这是你第一次将Graphene用于Django plus GraphQL，浏览一下他们的文档是个好主意。要安装，只需运行:</p><pre class="kk kl km kn gt np nq nr ns aw nt bi"><span id="c974" class="nu mt it nq b gy nv nw l nx ny">(mybackend) mybackend <strong class="nq iu">$ </strong>pip install graphene-django<br/>(mybackend) mybackend <strong class="nq iu">$ </strong>pip freeze &gt; requirements.txt</span></pre><p id="dbec" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后，在<code class="fe nz oa ob nq b">mybackend/settings.py</code>处将<code class="fe nz oa ob nq b">graphene_django</code>添加到<code class="fe nz oa ob nq b">INSTALLED_APPS</code>中:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="4883" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后将<code class="fe nz oa ob nq b">graphql</code> URL添加到您的<code class="fe nz oa ob nq b">mybackend/url.spy</code>中:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="1502" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最后，在<code class="fe nz oa ob nq b">mybackend/settings.py</code>中定义您的模式位置，如下所示:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="5ec7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">并在<code class="fe nz oa ob nq b">mybackend/schema.py</code>创建最基本的模式:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="27d3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，如果您通过<code class="fe nz oa ob nq b">python manage.py runserver</code>运行您的开发服务器并访问<a class="ae kz" href="http://localhost:8000/graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/graph QL</a>，您应该能够看到GraphQL API浏览器。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="22fb" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">后续步骤</h1><p id="7c57" class="pw-post-body-paragraph la lb it lc b ld nk ju lf lg nl jx li lj nm ll lm ln nn lp lq lr no lt lu lv im bi translated">现在，您有了一个能够服务于GraphQL端点的适当的Django设置。</p><p id="7597" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，我们将开始实现项目中著名的<code class="fe nz oa ob nq b"><a class="ae kz" href="http://todomvc.com/" rel="noopener ugc nofollow" target="_blank">TodoMVC</a></code>的查询和变化。请务必<a class="ae kz" href="https://medium.com/@cansinyildiz/introduction-to-graphql-with-django-and-graphene-part-2-5fe08f2d637a" rel="noopener">看一看</a>！</p></div></div>    
</body>
</html>