<html>
<head>
<title>How To Serve Your Angular Application Over HTTPS Using ng serve</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用发球法在HTTPS上空发球</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-serve-your-angular-application-over-https-using-ng-serve-240e2c2e0a5d?source=collection_archive---------2-----------------------#2021-01-14">https://betterprogramming.pub/how-to-serve-your-angular-application-over-https-using-ng-serve-240e2c2e0a5d?source=collection_archive---------2-----------------------#2021-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1ef5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">配置Angular CLI，通过安全的HTTPS连接在本地为您的应用提供服务</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/52c54977270cfe7b066c028fbd72b233.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXfP0OlB-oVHrNQS9iKVkA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来源:作者</p></figure><p id="af4d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://www.w3.org/2001/tag/doc/web-https" rel="noopener ugc nofollow" target="_blank">保障网络安全</a>已经成为浏览器开发者多年来的主要目标之一。提供一个私密和安全的通信渠道是这项工作的首要任务。这样的安全通道需要保证机密性、完整性和真实性，这些属性只能通过加密通信来实现。</p><p id="9929" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">HTTPS是安全网络的关键组成部分之一。它对客户端和web服务之间发送的几乎所有信息进行加密，从而为用户和网站之间的通信提供安全连接。HTTPS变得如此重要，以至于许多最近的浏览器功能(例如，地理定位和服务人员——查看此<a class="ae lr" href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts/features_restricted_to_secure_contexts" rel="noopener ugc nofollow" target="_blank"> MDN文档</a>获取完整列表)——只能在安全上下文中启用。</p><p id="0370" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是如果你正在这里阅读这篇文章，你已经对HTTPS很熟悉了，而且你想<em class="ls">切入正题</em>。您已经知道何时以及为什么要使用它，以及何时对使用它进行例外处理(我猜是您的本地开发环境😉).</p><p id="1abd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当在HTTPS上运行本地主机应用程序时，维护自签名证书可能会很麻烦。在安全连接是必须的特定情况下，这是一个你必须处理的麻烦。</p><p id="7ee7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些情况的几个例子可以是:</p><ul class=""><li id="aea2" class="lt lu iq kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated">使用Lighthouse测试渐进式网络应用程序(Lighthouse将为不通过安全连接提供服务的PWA返回较低的分数)</li><li id="42f0" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">与要求客户端在HTTPS上运行的服务集成(例如，脸书登录API或Okta)</li><li id="d473" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">使用<code class="fe mh mi mj mk b"><a class="ae lr" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Privacy_and_security" rel="noopener ugc nofollow" target="_blank">getUserMedia</a></code>从某个用户设备获取流(只能在<a class="ae lr" href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts" rel="noopener ugc nofollow" target="_blank">安全上下文</a>中使用)</li></ul><p id="bbb2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使本地web服务器能够通过HTTPS提供内容的过程将因服务器而异。但是，使用Angular CLI可以非常直接地做到这一点。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="8414" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">发球</h1><p id="fddd" class="pw-post-body-paragraph kv kw iq kx b ky nk jr la lb nl ju ld le nm lg lh li nn lk ll lm no lo lp lq ij bi translated"><code class="fe mh mi mj mk b">ng serve</code>是Angular CLI中预装的专用开发服务器。它提供了大量的功能，使您的开发过程更加顺畅。</p><p id="f977" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在另一篇文章中，我描述了如何更改默认<code class="fe mh mi mj mk b">ng serve</code>的主机和端口——当默认端口(<code class="fe mh mi mj mk b">4200</code>)已经在使用中或者您有多个Angular应用程序同时在本地运行时特别有用。</p><div class="np nq gp gr nr ns"><a href="https://hicaro.medium.com/angular-cli-ng-serve-custom-host-and-port-f7db5e15802a" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">如何更改角连接服务的默认主机和端口</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">是否要设置自定义主机和端口以覆盖ng serve的默认配置？</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">hicaro.medium.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og kp ns"/></div></div></a></div><p id="5c82" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mh mi mj mk b">ng serve</code>实现现成的内置SSL支持。您需要做的就是提供三个配置属性，然后通过<code class="fe mh mi mj mk b"><a class="ae lr" href="https://localhost:4200/" rel="noopener ugc nofollow" target="_blank">https://localhost:4200</a></code>访问您的应用程序(假设您在端口4200上运行它)。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="858e" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">1.创建证书</h1><p id="1d18" class="pw-post-body-paragraph kv kw iq kx b ky nk jr la lb nl ju ld le nm lg lh li nn lk ll lm no lo lp lq ij bi translated">重要的事情先来。要通过HTTPS运行本地应用程序，首先需要在本地机器上生成并信任一个自签名证书。</p><p id="a50f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上一篇文章中，我介绍了如何创建可信的自签名证书颁发机构和域名证书。如果你已经有了这个基础，你可以跳过阅读。否则，请查看下面的文章来生成您的本地主机证书。</p><div class="np nq gp gr nr ns"><a href="https://medium.com/better-programming/how-to-create-trusted-ssl-certificates-for-your-local-development-13fd5aad29c6" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">如何为您的本地开发创建可信SSL证书</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">生成可信的自签名SSL证书，以便在本地开发中启用HTTPS</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">medium.com</p></div></div><div class="ob l"><div class="oh l od oe of ob og kp ns"/></div></div></a></div></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="96c5" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">2.角度CLI</h1><p id="5c64" class="pw-post-body-paragraph kv kw iq kx b ky nk jr la lb nl ju ld le nm lg lh li nn lk ll lm no lo lp lq ij bi translated">一旦生成并信任了证书，剩下唯一要做的事情就是让Angular CLI知道它。有两种方法可以实现它:<em class="ls">命令行选项</em>或<em class="ls">配置文件默认值</em>。</p><h2 id="349b" class="oi mt iq bd mu oj ok dn my ol om dp nc le on oo ne li op oq ng lm or os ni ot bi translated"><strong class="ak">命令行选项</strong></h2><p id="583a" class="pw-post-body-paragraph kv kw iq kx b ky nk jr la lb nl ju ld le nm lg lh li nn lk ll lm no lo lp lq ij bi translated"><code class="fe mh mi mj mk b">ng serve</code>接受三个内置标志来支持SSL:</p><ul class=""><li id="2ab5" class="lt lu iq kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated"><code class="fe mh mi mj mk b">--ssl</code>:布尔值，决定是否启用或禁用SSL默认为<code class="fe mh mi mj mk b">false</code></li><li id="17f2" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated"><code class="fe mh mi mj mk b">--ssl-cert</code>:证书的相对路径</li><li id="4413" class="lt lu iq kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated"><code class="fe mh mi mj mk b">--ssl-key</code>:私钥的相对路径</li></ul><p id="070c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，启用SSL的命令如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><h2 id="2618" class="oi mt iq bd mu oj ok dn my ol om dp nc le on oo ne li op oq ng lm or os ni ot bi translated"><strong class="ak"> Angular CLI配置文件默认值</strong></h2><p id="5241" class="pw-post-body-paragraph kv kw iq kx b ky nk jr la lb nl ju ld le nm lg lh li nn lk ll lm no lo lp lq ij bi translated">如果您不太喜欢在脚本中添加命令行参数，或者您更喜欢在终端中键入<code class="fe mh mi mj mk b">ng serve</code>的简洁外观，这一节就是为您准备的！</p><p id="f12e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">角度CLI 6+ </strong></p><p id="41fa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">默认情况下，以下配置将使用SSL启动开发服务器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="8dd1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您想按需打开和关闭SSL，当您想在HTTPS上运行<code class="fe mh mi mj mk b">ng serve</code>时，您可以从<code class="fe mh mi mj mk b">serve</code>选项中删除<code class="fe mh mi mj mk b">"ssl": true</code>行，并在您的命令中添加<code class="fe mh mi mj mk b">--ssl</code>标志。通过留下密钥和证书路径，Angular CLI确切地知道在哪里可以找到这些文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><h2 id="ad13" class="oi mt iq bd mu oj ok dn my ol om dp nc le on oo ne li op oq ng lm or os ni ot bi translated"><strong class="ak">角度指示器&lt; 6 </strong></h2><p id="dae3" class="pw-post-body-paragraph kv kw iq kx b ky nk jr la lb nl ju ld le nm lg lh li nn lk ll lm no lo lp lq ij bi translated">从版本5过渡到版本6时，Angular CLI配置格式发生了变化。在Angular CLI版本6之前，配置将添加如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ou ov l"/></div></figure><p id="7daf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就是这样！您的设置过程已经结束。您有一个自签名证书，并且知道如何使用它来通过Angular CLI启用SSL。</p><p id="ba2b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下一步是在浏览器中检查它。你可以打开网址<code class="fe mh mi mj mk b"><a class="ae lr" href="https://localhost:4200" rel="noopener ugc nofollow" target="_blank">https://localhost:4200</a></code>，看到你的应用程序在HTTPS本地提供。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/d2f1a8230045d38081dece168332b384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GVwRb_eJ7VP_3Rk0qcfVrg.png"/></div></div></figure></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="8cc5" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">结论</h1><p id="7248" class="pw-post-body-paragraph kv kw iq kx b ky nk jr la lb nl ju ld le nm lg lh li nn lk ll lm no lo lp lq ij bi translated">现在，您应该能够使用自己可信的自签名证书，通过HTTPS本地服务您的Angular应用程序。这是一个您可以随意使用的漂亮而方便的特性。我个人的偏好是使用配置文件来包含我的私钥和证书路径，然后按需启用SSL。</p><p id="bebd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">需要注意的是，这种设置仅适用于本地开发。您应该在面向公众的应用程序中使用由可信证书颁发机构签名的证书。<a class="ae lr" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">让我们加密</a>是当今做这件事的一个很好的资源。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="7bcc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就这些了，伙计们！我希望你喜欢阅读，这篇文章对你有帮助。</p></div></div>    
</body>
</html>