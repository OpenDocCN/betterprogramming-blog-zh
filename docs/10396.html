<html>
<head>
<title>Build a SwiftUI PreviewProvider for UIKit Views</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为UIKit视图构建SwiftUI PreviewProvider</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swiftui-preview-provider-for-uikit-3dd089d77915?source=collection_archive---------8-----------------------#2022-01-04">https://betterprogramming.pub/swiftui-preview-provider-for-uikit-3dd089d77915?source=collection_archive---------8-----------------------#2022-01-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fb9b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">查看UIKit ViewController即时变化的简单方法——实时和按需</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/46c745e7a8ec0e11bd12225aa734ff69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QLUjIXB7hVrCxcPoSXa8Vw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">所有图片由作者提供</p></figure><p id="fa2d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你试过SwiftUI吗？你没发现它是如此令人愉快和容易共事吗？</p><p id="76c4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，在UIKit视图中，如果您在代码库中进行原型设计，每次都必须重新编译和构建项目，才能在模拟器中看到结果。但在SwiftUI中，无需重新构建即可按需查看更改，这是如此令人愉快。</p><p id="9052" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们可以为我们的UIKit组件做一些类似的事情呢？像预览或热重新加载UIKit更改一样，无需耗时的构建和编译过程。</p><p id="caaa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本质上，我们希望使用SwiftUI为我们的UIKit视图创建一个实时预览系统。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="3d35" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有很多方法可以让这个过程变得更简单，比如简单的注释，比如<code class="fe ly lz ma mb b">@IBDesignable</code> <strong class="kx ir">、</strong> <code class="fe ly lz ma mb b">@IBInspectable</code> <strong class="kx ir"> </strong>等等。</p><p id="9189" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是如果你有使用这些方法的经验，有时它会出错，并由于合理的原因导致一些编译错误，有时它不是最好的方法。</p><p id="da9a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以在这篇文章中，你将学习一种新的更简单的方法来立即看到你的变化。如果你用过SwiftUI，你应该已经知道了，但是我们给它加了一点小技巧，这样它就可以和UIKit一起工作了。</p><h1 id="3103" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">SwiftUI: PreviewProvider</h1><p id="447f" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated"><code class="fe ly lz ma mb b"><a class="ae mz" href="https://developer.apple.com/documentation/swiftui/previewprovider" rel="noopener ugc nofollow" target="_blank">PreviewProvider</a></code>是一种在Xcode中生成视图预览的协议类型。它包含一个名为<code class="fe ly lz ma mb b">Previews</code>的关联类型，该类型属于<code class="fe ly lz ma mb b">View</code>类型。<code class="fe ly lz ma mb b">View</code>是一个SwiftUI视图，我们将<code class="fe ly lz ma mb b">return</code>让<code class="fe ly lz ma mb b">PreviewProvider</code>显示——我们稍后会看到。</p><p id="d8eb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在创建了一个符合这个协议的对象之后，我们将传递我们希望在预览中看到的视图。它会自动弹出一个分割视图，如下图所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/bf62088654a8dbccd40f7b0c6e36aa19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xOVl5URWTfEPpiCn2ocNgQ.png"/></div></div></figure><p id="e361" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果预览没有加载，不用担心:只需使用下面的键盘快捷键来查看重置实时预览:</p><pre class="kg kh ki kj gt nb mb nc nd aw ne bi"><span id="b81a" class="nf md iq mb b gy ng nh l ni nj"><strong class="mb ir">⌘ + ⌥ + Return (Command + option + Return)</strong></span></pre><p id="ad4e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意:如果您看不到，请确保单击显示在预览内容右上角的resume按钮，这意味着它正在工作并向您显示实时内容。</p><h1 id="4191" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">UIKit: PreviewProvider</h1><p id="d0d2" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">现在我们知道了<code class="fe ly lz ma mb b">PreviewProvider</code>及其在SwiftUI中的工作原理，我们如何在UIKit中实现它呢？</p><p id="0cbd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">答案很简单:我们必须将UIKit代码库转换成SwiftUI能够理解的东西，并使用SwiftUI <code class="fe ly lz ma mb b">PreviewProvider</code>来查看内容的现场模拟。猜猜是怎么回事？</p><h2 id="ce9c" class="nf md iq bd me nk nl dn mi nm nn dp mm le no np mo li nq nr mq lm ns nt ms nu bi translated">如何将UIKit内容转换成SwiftUI内容？</h2><p id="c18a" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">这比你想象的要容易得多。不要把它复杂化。我们需要的只是流行的<code class="fe ly lz ma mb b">UIViewControllerRepresentable</code>协议。</p><p id="8329" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe ly lz ma mb b">UIViewControllerRepresentable</code>充当桥梁，帮助将UIViewController转换为SwiftUI视图。你猜到我们打算做什么了吗？</p><h2 id="5e09" class="nf md iq bd me nk nl dn mi nm nn dp mm le no np mo li nq nr mq lm ns nt ms nu bi translated">履行</h2><p id="c413" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">现在我们已经了解了SwiftUI中的<code class="fe ly lz ma mb b">UIViewControllerRepresentable</code> <strong class="kx ir"> </strong>和<strong class="kx ir"> </strong> <code class="fe ly lz ma mb b">PreviewProvider</code> <strong class="kx ir"> </strong>，让我们动手实践一下吧。</p><h2 id="c086" class="nf md iq bd me nk nl dn mi nm nn dp mm le no np mo li nq nr mq lm ns nt ms nu bi translated">UIKit控制器</h2><p id="0a75" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">让我们创建一个简单的UIKit控制器(<code class="fe ly lz ma mb b">UIViewController</code>)，它包含一些UI修改:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="a25c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们运行这个<code class="fe ly lz ma mb b">ViewController</code>，您会看到类似这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/bca1d3db7038c521ec6239f18ef5c137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-aav-Jh0JOBWazsmDMZPGg.png"/></div></div></figure><p id="9c9f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们创建一个SwiftUI <code class="fe ly lz ma mb b">Preview</code>。我们将在UIKit UI中进行的任何更改都可以简单地实时显示，我们不必像以前那样进行构建和编译。</p><h2 id="d677" class="nf md iq bd me nk nl dn mi nm nn dp mm le no np mo li nq nr mq lm ns nt ms nu bi translated">将此UIViewController转换为SwiftUI控制器</h2><p id="7a96" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">我们简单地从我们的控制器中创建一个符合<code class="fe ly lz ma mb b">UIViewControllerRepresentable</code>的对象，使它对SwiftUI可读。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="0961" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上面的代码中:</p><ul class=""><li id="d6ac" class="ny nz iq kx b ky kz lb lc le oa li ob lm oc lq od oe of og bi translated"><code class="fe ly lz ma mb b">canImport(SwiftUI)</code>用于确保其仅针对支持SwiftUI的iOS版本进行编译。</li><li id="60c3" class="ny nz iq kx b ky oh lb oi le oj li ok lm ol lq od oe of og bi translated">确保它只在我们的调试环境中运行。</li></ul><p id="8622" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe ly lz ma mb b">MakeUIViewController(context: Context)</code> <strong class="kx ir"> </strong>函数中，您应该简单地实例化您想要在预览中看到的控制器。这里我只是实例化了我的<code class="fe ly lz ma mb b">Main</code>故事板。</p><h2 id="e78c" class="nf md iq bd me nk nl dn mi nm nn dp mm le no np mo li nq nr mq lm ns nt ms nu bi translated">使用PreviewProvider预览我们的UIViewController</h2><p id="7166" class="pw-post-body-paragraph kv kw iq kx b ky mu jr la lb mv ju ld le mw lg lh li mx lk ll lm my lo lp lq ij bi translated">现在我们已经有了<code class="fe ly lz ma mb b">UIViewController</code>并且已经将它转换成SwiftUI控制器，我们只需要为我们的<code class="fe ly lz ma mb b">PreviewProvider</code>添加几行代码。</p><p id="a8ed" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe ly lz ma mb b">#endif</code>前添加以下代码行:</p><pre class="kg kh ki kj gt nb mb nc nd aw ne bi"><span id="08dd" class="nf md iq mb b gy ng nh l ni nj">struct ViewController_Preview: PreviewProvider {<br/>    static var previews: some View {<br/>         ViewControllerRepresentable()    <br/>    }<br/>}</span></pre><p id="5f7b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">完整的代码应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="8c03" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们已经有了完整的代码库，你可以看到点播的<code class="fe ly lz ma mb b">UIKit UIViewController</code> <strong class="kx ir"> </strong>的直播预告<strong class="kx ir"> </strong>。试着稍微修改一下用户界面，注意一下立竿见影的效果。告别耗时的搭建过程。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/6f2938e433675186d203b544a550f6f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NMi7aptErn1IqLV9iBUQow.png"/></div></div></figure><p id="6605" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">目前就这些。感谢阅读。您可以查看下面的完整源代码:</p><div class="on oo gp gr op oq"><a href="https://github.com/EmadBeyrami/UIKitPreviews" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd ir gy z fp ov fr fs ow fu fw ip bi translated">GitHub-EmadBeyrami/uikit previews</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">github.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe kp oq"/></div></div></a></div></div></div>    
</body>
</html>