<html>
<head>
<title>How to Use SwiftUI Table and Charts to Display Housing Data in macOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用SwiftUI表格和图表在macOS中显示住房数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-table-from-swiftui-4-to-display-housing-data-ace1b1c616d9?source=collection_archive---------7-----------------------#2022-09-28">https://betterprogramming.pub/using-table-from-swiftui-4-to-display-housing-data-ace1b1c616d9?source=collection_archive---------7-----------------------#2022-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7403" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用SwiftUI 4的强大功能</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a0ec585b4b8ff9a97877681b3b3038b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yJJQtKsL8JAzpYrqXDNgSg.jpeg"/></div></div></figure><p id="84ce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在之前的一篇文章中，我写了一个CSV解析器。一个示例应用程序用于解析从Zillow检索的住房数据。在接下来的几章中，我们将编写一个应用程序来显示表格和图表中的数据。</p><p id="fb40" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我会把它分成小块。第一章是关于数据解析。第2章将介绍SwiftUI表类。第3章将全部关于SwiftUI图表。</p><h1 id="fabd" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">第1章:概述和模型</h1><h2 id="10e5" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">挑战</h2><p id="88f3" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">住房数据很大。编写本文时的CSV是909行x 265列。我们的想法是看看SwiftUI在处理大数据时有什么限制。目标是只使用SwiftUI，不使用UIKit。</p><p id="3220" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在此过程中，我们将讨论SwiftUI表格和图表的局限性，并围绕它们进行设计。</p><h2 id="dc64" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">快速规范和设计</h2><p id="279d" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">目标是能够选择不同的住房区域，并在图表上进行比较。住房区域将以表格形式呈现，图表数据将用于SwiftUI 4的图表。我们将保持设计的简单性，在表格上方有一个图表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/4127f6ab6ed2796be5377c7a97d2f986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iFPWGeta63M-Iytccm6ouA.png"/></div></div></figure><p id="e140" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所有数据都将从Zillow的住房数据中检索。我们将逐月观察美国和主要大都市地区的房屋定价中值。</p><p id="9f3e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个项目将需要macOS Ventura和最新的XCode 14测试版。在撰写本文时，两者都处于测试阶段。</p><h2 id="80d0" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">Xcode项目</h2><ol class=""><li id="fcd9" class="my mz iq kt b ku ms kx mt la na le nb li nc lm nd ne nf ng bi translated">打开XCode 14。</li><li id="e457" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">使用单元测试创建一个新的SwiftUI项目。</li></ol><h2 id="42a2" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">添加CSV解析器</h2><p id="66b6" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">在上一篇文章中，我写了一个命令行CSV解析器。我已经把它变成了一个名为EasyCVS的包，可以用来解析CSV文件。要添加包，请执行以下操作:</p><ol class=""><li id="4ae9" class="my mz iq kt b ku kv kx ky la nm le nn li no lm nd ne nf ng bi translated">从文件菜单中选择添加包</li><li id="3fd6" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">将https://github.com/scottandrew/EasyCSV.git放入搜索框</li><li id="38fe" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">按“添加包”。</li></ol><h2 id="b504" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">逗号分隔值（csv）文件格式</h2><pre class="kg kh ki kj gt np nq nr ns aw nt bi"><span id="e99d" class="mg lp iq nq b gy nu nv l nw nx">RegionID,SizeRank,RegionName,RegionType,StateName,2018-01-31,...<br/>102001,0,United States,Country,,271600.0,...<br/>394913,1,"New York, NY",Msa,NY,517967.0,...<br/>753899,2,"Los Angeles-Long Beach-Anaheim, CA",Msa,CA,798670.0,...</span></pre><ul class=""><li id="dd13" class="my mz iq kt b ku kv kx ky la nm le nn li no lm ny ne nf ng bi translated">第0行是列标题。数据从第1行开始。</li><li id="162e" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm ny ne nf ng bi translated">列0 =区域id的整数</li><li id="f080" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm ny ne nf ng bi translated">第1列=尺寸等级的整数</li><li id="c223" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm ny ne nf ng bi translated">第2列=字符串形式的区域名称</li><li id="39f5" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm ny ne nf ng bi translated">第3列=字符串形式的区域类型</li><li id="0f4f" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm ny ne nf ng bi translated">第4列=字符串形式的州名或null</li><li id="4432" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm ny ne nf ng bi translated">第5列到最后一列是表示中间价格的double值或null。</li></ul><h2 id="aa28" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">价格数据</h2><p id="4a29" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">创建<code class="fe nz oa ob nq b">PriceData.swift</code>文件来存储数据的中间价格和日期。如果没有数据，可以有空列，因此<code class="fe nz oa ob nq b">value</code>属性需要是可选的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="7753" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob nq b">PriceData</code>需要是<code class="fe nz oa ob nq b">Identifiable</code>，这样对于一个系列来说才是唯一的。所以这个日期将被用作我们的身份证。</p><h2 id="8109" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">区域数据</h2><p id="d7e3" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">创建<code class="fe nz oa ob nq b">RegionData.swift</code>并添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="a6e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">区域数据将有助于定义表中的行。每个地区的<code class="fe nz oa ob nq b">PriceData</code>将被绘制成图表。初始化器将获取一行数据，并从头部获取日期数组。</p><p id="9d9c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有一个<code class="fe nz oa ob nq b">ColumnIndex</code>枚举来定义行中值的索引。注意这里有一个<code class="fe nz oa ob nq b">firstDate</code>的索引，这是用于价格数据的第一列的索引。最棘手的部分是将日期映射到中间价格。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="c4ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了创建<code class="fe nz oa ob nq b">PriceData</code>数组，我们从<code class="fe nz oa ob nq b">dateStartIndex</code>中取值到数据数组的末尾。我们将使用<code class="fe nz oa ob nq b">zip</code>来组合这些值，然后将结果映射到一个<code class="fe nz oa ob nq b">PriceData</code>结构。</p><p id="b6b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">字符串上的<code class="fe nz oa ob nq b">.toDouble</code>和<code class="fe nz oa ob nq b">.toInt</code>调用在这里是为了方便。助手将尝试从字符串创建一个<code class="fe nz oa ob nq b">Int</code>或<code class="fe nz oa ob nq b">Double</code>。如果失败，将引发错误。用以下代码创建一个<code class="fe nz oa ob nq b">String+Utility.swift</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="a3e6" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">HousingDataParser</h2><p id="fdcd" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">需要一个小的解析引擎来处理从数据行(字符串数组)到数组<code class="fe nz oa ob nq b">HousingData</code>的转换。</p><p id="236b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建一个具有两个函数的<code class="fe nz oa ob nq b">RegionDataParser.swift</code>文件<code class="fe nz oa ob nq b">parse(url:)</code>将用于解析数据。<code class="fe nz oa ob nq b">extractDataColumns(from)</code>将用于创建与日期匹配的值，并为区域创建值数组。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="9997" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">代码中有趣的是第一列0是标题。我们想从标题中提取日期。如果我们缺少日期，或者不能解析日期，就会抛出一个错误。假设CSV中有相同数量的日期和中值。</p><h2 id="c84d" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">解析器的单元测试</h2><p id="6f1c" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">解析器需要用一些样本数据进行测试。我从Zillow下载了一些<a class="ae ln" href="https://files.zillowstatic.com/research/public_csvs/zhvi/Metro_zhvi_uc_sfr_tier_0.33_0.67_sm_sa_month.csv?t=1660691326" rel="noopener ugc nofollow" target="_blank">样本数据</a>来使用。我将该文件重命名为TestData.json。</p><ol class=""><li id="b563" class="my mz iq kt b ku kv kx ky la nm le nn li no lm nd ne nf ng bi translated">解析文件</li><li id="b477" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">验证区域的数量。</li><li id="6e57" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">验证包含一些空列的两个区域。</li><li id="7f1a" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">验证每行中值的数量。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h1 id="bd77" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">第2章:数据模型和表</h1><h2 id="8caf" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">预览数据</h2><p id="0f05" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">要使图表与预览一起工作，我们需要一些数据。我将创建一个包含住房数据子集的本地CSV文件。</p><ol class=""><li id="47a6" class="my mz iq kt b ku kv kx ky la nm le nn li no lm nd ne nf ng bi translated">右键单击项目树中的<code class="fe nz oa ob nq b">Preview Content</code>文件夹</li><li id="df2b" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">从模板选取器的另一个组中选择“空”。</li><li id="ba2f" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">将文件命名为PreviewData.csv</li><li id="ff6c" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">复制TestData.csv文件的前两行。</li><li id="80f1" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">从TestData.csv的数据中复制Indianapolis。这有空列，所以它是很好的预览数据。</li></ol><h2 id="a18a" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">视图模型</h2><p id="806e" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">我将使用一个light <code class="fe nz oa ob nq b">ViewModel</code>来包装我们的解析器并管理我们的数据加载。视图应该是关于查看获取的数据。有几个目标:</p><ul class=""><li id="75c9" class="my mz iq kt b ku kv kx ky la nm le nn li no lm ny ne nf ng bi translated">我们希望从Zillow异步加载最新数据。</li><li id="f799" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm ny ne nf ng bi translated">我们想让视图模型在SwifUI的预览中表现良好。</li></ul><p id="6807" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将创建一个新的<code class="fe nz oa ob nq b">HousingDataModel.swift</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><ol class=""><li id="3ca8" class="my mz iq kt b ku kv kx ky la nm le nn li no lm nd ne nf ng bi translated">将类包装在<code class="fe nz oa ob nq b">@MainActor</code>属性中，这保证了发布的数据通知发生在主线程上。</li><li id="e142" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">检查代码是否在SwiftUI预览中运行。如果是，我们将加载预览CSV文件。否则，从互联网加载数据。</li><li id="56ae" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">以保证加载最新的数据。URL的<code class="fe nz oa ob nq b">t</code>参数是今天的纪元日期(自1970年以来的日期),为整数。<code class="fe nz oa ob nq b">TimeInterval</code>是一个<code class="fe nz oa ob nq b">Double</code>来对它进行类型转换，我将从<code class="fe nz oa ob nq b">Double</code>创建一个<code class="fe nz oa ob nq b">Int</code></li></ol><h2 id="8048" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">住房数据视图(第一遍)</h2><p id="0d16" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">我将在视图中快速浏览第一遍，以确保解析工作正常。在此之前，我们需要确保我们可以在应用程序中接收来自互联网的数据。</p><ol class=""><li id="9fb1" class="my mz iq kt b ku kv kx ky la nm le nn li no lm nd ne nf ng bi translated">导航到住房数据目标</li><li id="8220" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">在<em class="oe">签名&amp;功能</em>面板中，勾选<em class="oe">传出连接(客户端)</em>复选框。</li></ol><p id="b7f4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我要把<code class="fe nz oa ob nq b">ContentView</code>改名为<code class="fe nz oa ob nq b">HousingDataView</code>。</p><ol class=""><li id="e464" class="my mz iq kt b ku kv kx ky la nm le nn li no lm nd ne nf ng bi translated">打开<code class="fe nz oa ob nq b">ContentView.swift</code>文件。</li><li id="ce1f" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">选择<code class="fe nz oa ob nq b">ContentView</code>类名并点击右键。</li><li id="e50e" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">从上下文菜单中选择<em class="oe">重构- &gt;重命名</em>。</li><li id="3867" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">HousingDataView类型</li></ol><p id="a9a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将重命名<code class="fe nz oa ob nq b">ContentView.swift</code>文件和视图结构。现在我想清理预览类以保持一致性。将<code class="fe nz oa ob nq b">ContentView_Preview</code>重命名为<code class="fe nz oa ob nq b">HousingDataView_Preview</code></p><p id="ceff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将保留示例代码，但更改“Hello World”文本字段，使其显示已解析的行数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><ol class=""><li id="c4e6" class="my mz iq kt b ku kv kx ky la nm le nn li no lm nd ne nf ng bi translated">观察<code class="fe nz oa ob nq b">HousingModel</code>的变化</li><li id="8ff1" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">用解析的行数替换“Hello World”文本</li><li id="39ea" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">当视图被加载时，使用<code class="fe nz oa ob nq b">.task</code>修饰符来异步加载我们的数据。出现错误时，将显示“哎呀”。这很快就会得到解决。</li></ol><p id="df62" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当预览视图时，将显示3。当应用程序运行时，数据加载后，该值将更新为908。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/0f70fc93f1df5a34d05e7dbd0902aabc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n-djHz967q9A8HcOUrjhww.png"/></div></div><p class="og oh gj gh gi oi oj bd b be z dk translated">SwiftUI预览</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/10571ca59bdc8a43b29ba448754d2d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVjGaYq9FMI0NHjHWjravw.png"/></div></div><p class="og oh gj gh gi oi oj bd b be z dk translated">运行应用程序</p></figure><h2 id="0389" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">SwiftUI表</h2><p id="2a70" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">从SwiftUI 3开始，表就在SwiftUI中了。SwiftUI中表的限制是它们限于10列。因此，我们不能构建显示所有列的滚动电子表格视图。为了解决这个限制，应用程序将在表中显示等级、地区名称、地区类型和州。</p><p id="6796" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">表包含一组使用TableColumnBuilder构建的列。如果值为<code class="fe nz oa ob nq b">String</code>或支持<code class="fe nz oa ob nq b">StringProtocol</code>，则TableColumns可以直接链接到RegionData属性。如果该值是可选的或者不符合<code class="fe nz oa ob nq b">StringProtocol</code>，则需要创建一个视图。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><ol class=""><li id="a5d8" class="my mz iq kt b ku kv kx ky la nm le nn li no lm nd ne nf ng bi translated">对于非可选的字符串数据，创建一个直接指向行区域中的属性的表列。</li><li id="f4a7" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">对于区域的类型(枚举)和等级(整数),插入带有给定值的文本字段。我们可以在这里返回任何SwiftUI视图。</li><li id="7836" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">对于可选的状态，需要插入一个带有值或空文本的文本视图。即使没有数据，列中也必须有视图。</li><li id="a351" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm nd ne nf ng bi translated">除“名称”列之外的所有列都有一个设定的宽度。</li></ol><p id="316c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于“预览”设置为处理数据，因此该表显示在带有3个测试行的“预览”中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/a1101f1e857e64c065d483b3b266ce2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyrrbV8PpruiFyTWGG201g.png"/></div></div><p class="og oh gj gh gi oi oj bd b be z dk translated">SwiftUI预览</p></figure><p id="fe8d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行该应用程序将允许您滚动浏览所有区域数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/977fd49babc1355e01d0e76dce517b5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hWPehdEwAKpaTr22KiOJmA.png"/></div></div><p class="og oh gj gh gi oi oj bd b be z dk translated">运行应用程序</p></figure><h2 id="5ccd" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">处理抛出的错误</h2><p id="a650" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">在本文的开头，我用打印“oops”的打印语句处理了数据获取中的任何错误。我认为显示一般性错误的警告会更好。</p><p id="212f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我将添加一个新的私有状态变量来触发警报的可见性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="d457" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当捕捉到错误时，<code class="fe nz oa ob nq b">.task</code>修改器需要将<code class="fe nz oa ob nq b">showError</code>标志设置为真。仅仅设置布尔值就可以了，因为SwiftUI保证视图的<code class="fe nz oa ob nq b">body</code>构建在主线程上。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="c026" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了显示警告，我将在<code class="fe nz oa ob nq b">VStack</code>中添加一个<code class="fe nz oa ob nq b">.alert</code>修饰符。这将只显示一个基本的警告，并在单击“确定”按钮时消除它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="e7c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完整的<code class="fe nz oa ob nq b">HousingDataView</code>视图现在看起来如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h1 id="3b87" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">第3章:图表和拆分视图</h1><h2 id="280d" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">一点重构</h2><p id="8a2c" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">为了稍微清理一下代码，我将把列表和图表代码移到两个视图构建器中。</p><p id="9375" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开<code class="fe nz oa ob nq b">HousingDataView.swift</code>文件，我将创建一个新的<code class="fe nz oa ob nq b">table</code>视图构建器，并将表创建代码移入其中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="5bf1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我还将创建一个空的<code class="fe nz oa ob nq b">chart</code>视图构建器，暂时返回一个简单的<code class="fe nz oa ob nq b">Rectangle</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="609d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将把这些放在一个<code class="fe nz oa ob nq b">VSplitView.</code>中，这允许用户通过上下拖动分割器的条来控制可以看到多少胶带和图形。我将用包含对<code class="fe nz oa ob nq b">chart</code>和<code class="fe nz oa ob nq b">table</code>的调用的<code class="fe nz oa ob nq b">VSplitView</code>来替换<code class="fe nz oa ob nq b">VStack</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="1e8a" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">表格选择和焦点</h2><p id="c7e3" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">我无法在图表中显示所有900多行。当试图在线图中绘制大量数据集时，图表将无法读取，SwiftUI会崩溃。为了解决这个问题，我将选择的数量限制为10个。我将添加一个状态变量来收集选定的条目id。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="67ad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里一个有趣的问题是选择是在一个集合中，而不是在一个数组中。因此，当添加新项目时，选择的顺序可以改变。没有简单的方法可以解决这个问题，不需要大量的预订，因为<code class="fe nz oa ob nq b">Set</code>是一个有序的集合。我想尽可能简单。</p><p id="892d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我需要告诉表在哪里存储选择。我将选择指向<code class="fe nz oa ob nq b">$selectedItems</code>,这样每当一个项目的选择改变时，表格将更新所选择的项目集。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="2125" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在加载之后，我想做的另一件事是确保表成为焦点视图，并且第一项被选中。首先，我将添加一个焦点状态变量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="f880" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">表格需要一个<code class="fe nz oa ob nq b">focused</code>视图修饰符，它根据<code class="fe nz oa ob nq b">inFocus</code>标志告诉视图它的焦点状态。这里是完成的<code class="fe nz oa ob nq b">Table</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="f361" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下载完数据后，我将更新<code class="fe nz oa ob nq b">VSplitView</code>上的<code class="fe nz oa ob nq b">task</code>修饰符来选择列表中的第一项，并使表格成为焦点视图。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="ce58" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">图表</h2><p id="4ca7" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">我将创建一个简单的折线图，只画出所选行的点。需要记住的一点是，行存储在一个集合中，这是Swift UI的表所要求的。因为集合是一个无序的集合，所以画线的顺序可能会改变。</p><p id="0673" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将在一个<code class="fe nz oa ob nq b">if</code>语句中包装矩形，检查是否有实际数据。如果没有数据，我将返回一个300单位高的空的<code class="fe nz oa ob nq b">Rectangle</code>。否则，我将放入一个带有一些填充的图表，并将最小和理想高度设置为300个单位。</p><p id="cd25" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于每一个选定的项目，我会映射每个金额。X值是数据的月份和年份。Y值将是平均房价。我将让swift UI根据行的城市自动给每一行和图例值着色。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="2ced" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">限制数量选择</h2><p id="72c3" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">在文章的顶部，我说我想将选择的项目限制在10个。我需要存储用户试图选择10个以上项目时可以使用的最后选择的行。我将向<code class="fe nz oa ob nq b">HousingDataModel</code>添加一个公共的<code class="fe nz oa ob nq b">lastSelection</code>属性</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="9808" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe nz oa ob nq b">VStack</code>的结尾，我会添加一个修饰符，当<code class="fe nz oa ob nq b">selectedItems</code>改变时会被调用。逻辑很简单:</p><ul class=""><li id="07f6" class="my mz iq kt b ku kv kx ky la nm le nn li no lm ny ne nf ng bi translated">如果所选项目计数小于或等于10，则将该选择存储为模型中的最后一个选择。</li><li id="a852" class="my mz iq kt b ku nh kx ni la nj le nk li nl lm ny ne nf ng bi translated">如果选择的项目计数大于10，我将选择恢复到保存在模型中的最后一个集合。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="9794" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在运行应用程序将从Zillow加载最新数据，并在我们的表中绘制所选行。如果您看到选择的顺序与挑选的顺序不匹配，请记住，这是因为表选择存储在一个无序的集合中，其顺序没有保证。</p><h1 id="c1e9" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结论</h1><p id="8986" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">即使有表格和图表的限制。运行一个简单的应用程序很容易，它可以下载数据，在一个有多个选择的表格中显示数据，并在图表中绘制数值。最终的项目可以在<a class="ae ln" href="https://github.com/scottandrew/HousingData.git" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div></div>    
</body>
</html>