<html>
<head>
<title>Build a Real-Time Note-Taking App in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript构建一个实时笔记应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-real-time-note-taking-app-in-javascript-bc6e8d149d51?source=collection_archive---------4-----------------------#2021-07-05">https://betterprogramming.pub/build-a-real-time-note-taking-app-in-javascript-bc6e8d149d51?source=collection_archive---------4-----------------------#2021-07-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="af63" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用Supabase的实时引擎和Next.js的强大功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/93a31a661c85b66c82ca035a65759d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H0VwgRGzjjoisxnS"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@thoughtcatalog" rel="noopener ugc nofollow" target="_blank">思想目录</a>上的<a class="ae ky" href="http://unsplash.com" rel="noopener ugc nofollow" target="_blank"> <em class="kz"> Unsplash </em> </a> <em class="kz">。</em></p></figure><p id="ab7f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/build-a-note-taking-app-with-google-authentication-in-next-js-f0835d14034e">要使用Next.js </a>构建笔记应用程序，您需要遵循以下步骤:</p><ul class=""><li id="3a0c" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">使用<a class="ae ky" href="https://next-auth.js.org/" rel="noopener ugc nofollow" target="_blank"> NextAuth </a>构建您的登录系统。</li><li id="619b" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">将其绑定到MongoDB，以便将您的用户保存在数据库中。</li><li id="5161" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">如果你想要实时同步，那么写一个事件系统。如果发生数据库事件，这将触发一个事件。通过此方法，您的应用程序可以在每次事件发生时显示更改。</li></ul><p id="ba96" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">虽然这看起来很容易，但是编写事件监听器并不容易。这可能会导致难以维护的低效代码。</p><p id="625b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这就是Supabase 的用武之地。它是Firebase的开源竞争对手，为你的应用繁荣提供了许多你需要的服务。如果您选择Supabase作为您的笔记应用程序，您将执行以下操作:</p><ul class=""><li id="9714" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">使用在几行代码中提供许多第三方授权提供者的<a class="ae ky" href="https://supabase.io/docs/guides/auth" rel="noopener ugc nofollow" target="_blank"> Auth </a>服务。</li><li id="f037" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">使用<a class="ae ky" href="https://supabase.io/docs/guides/database#realtime" rel="noopener ugc nofollow" target="_blank">实时引擎</a>，它为你处理实时的麻烦。所有你需要做的就是告诉你的前端显示任何变化，如果一个事件发生。</li></ul><p id="e196" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你想了解更多关于这个库的信息，请查看这篇由<a class="mk ml ep" href="https://medium.com/u/ca10c2ee6015?source=post_page-----bc6e8d149d51--------------------------------" rel="noopener" target="_blank">勤奋开发者</a>撰写的文章。</p><p id="ed40" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在本文中，您将在Supabase中构建一个带身份验证的笔记应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/8241793179e781094b92101cf8d0b784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/1*DTMT3E25fu9PbbMOobF2EA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">本文的结果</p></figure><p id="6c96" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">它还将使用Supabase的实时API，以便Next.js可以在不刷新页面的情况下呈现新的注释:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/356af2c6d26ffab8396a680d54d628a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_7fiVh9SLIUe7zyzQ92B-A.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实时演示</p></figure><p id="0966" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们开始吧！</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="bea8" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">先决条件</h1><p id="92bc" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">在进入本文的实质性内容之前，您首先需要创建一个活动的Supabase项目。</p><h2 id="e40a" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">创建您的Supabase项目</h2><p id="9eef" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">为此，请转到<a class="ae ky" href="https://app.supabase.io/" rel="noopener ugc nofollow" target="_blank"> Supabase项目页面</a>并点击“新建项目”在那里，创建您的凭证:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/9f4dac9bc67152ca1db2c8f579516b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CbYYVgjegjpetA5avJ5Yaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建您的凭据</p></figure><p id="1428" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">完成后，进入“设置”，然后点击“API”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/98d03cf611e2fd9e50496ec7255b812a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MBtPY7Qj69FEDYWPHGuq_g.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">API面板</p></figure><p id="7ca4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在“API”面板中，复制您的<code class="fe og oh oi oj b">URL</code>和<code class="fe og oh oi oj b">anon public</code>键:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/ac4b7337176e25c64b3e67ff1a814fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QEZBzbG0gwG42TPVOY3v7A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">取回你的钥匙</p></figure><p id="2fbd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后转到你的Next.js项目，像这样把它们粘贴到<code class="fe og oh oi oj b">.env.local</code>中:</p><pre class="kj kk kl km gt ol oj om on aw oo bi"><span id="e2d8" class="ns mw it oj b gy op oq l or os">NEXT_PUBLIC_SUPABASE_URL = SupabaseURL<br/>NEXT_PUBLIC_SUPABASE_ANON_KEY = AnonPublicKey</span></pre><p id="1ce7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在让我们配置我们的Google OAuth屏幕。</p><h2 id="eae0" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">谷歌认证</h2><p id="9105" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">转到您的<a class="ae ky" href="https://console.cloud.google.com/apis/credential" rel="noopener ugc nofollow" target="_blank"> Google Cloud控制台</a>并创建一个新的OAuth客户端ID。在“授权重定向URIs”部分，输入<code class="fe og oh oi oj b">your Supabase Project URL + /auth/v1/callback</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/899c9db43b8b34d9f302e52cced1e471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HLxXMF6HF_VpvCA4T02S3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">“授权重定向URIs”页面</p></figure><p id="da77" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最后，你必须在Supabase中输入你的谷歌证书。为此，返回到Supabase面板，将您的密钥粘贴到“授权设置”页面中的“启用谷歌”部分。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/3ad6f3a3839677646fda883745fdf09b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*w-SKbyeWEmKp7dz9PaWoYQ.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">粘贴Google keys</p></figure><p id="1c30" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在让我们为我们的项目编码我们的登录系统。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="885c" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">谷歌认证</h1><p id="80cd" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated"><em class="ov">注意:对于本文，我们将只做客户端认证。如果你想深入了解Supabase中的认证，可以查看</em> <a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-get-google-oauth-in-supabase-with-next-js-56220c59d5a6"> <em class="ov">这篇文章</em> </a> <em class="ov">。</em></p><h2 id="0fb6" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">模块安装和项目设置</h2><p id="8744" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">对于这个项目，我们需要以下包:</p><ul class=""><li id="908a" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated"><code class="fe og oh oi oj b">@supabase/supabase-js</code>:该项目的核心库。</li><li id="165b" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><code class="fe og oh oi oj b">@supabase/ui</code>:为我们的应用程序提供一组我们需要的UI组件。</li><li id="bfcf" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><code class="fe og oh oi oj b">formik</code>:我们将使用表单来捕捉用户输入。福米克图书馆将负责处理提交的表格。</li></ul><p id="7dd1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要安装这些依赖项，请运行以下终端命令:</p><pre class="kj kk kl km gt ol oj om on aw oo bi"><span id="57e1" class="ns mw it oj b gy op oq l or os">npm i @supabase/supabase-js @supabase/ui formik</span></pre><p id="c77d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">第二步，在您的<code class="fe og oh oi oj b">pages/index.js</code>文件中，删除<code class="fe og oh oi oj b">div</code>标签之间的所有代码。最后，<code class="fe og oh oi oj b">index.js</code>应该是这样的:</p><pre class="kj kk kl km gt ol oj om on aw oo bi"><span id="973f" class="ns mw it oj b gy op oq l or os">export default function Home() {<br/>  return &lt;div&gt;&lt;/div&gt;;<br/>}</span></pre><p id="a549" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们讨论一下项目结构。</p><h2 id="1655" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">项目文件结构</h2><p id="0867" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">在Next.js项目目录中，创建以下文件夹:</p><ul class=""><li id="54e8" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated"><code class="fe og oh oi oj b">utils</code>:这将保存实用程序功能和Supabase客户端配置。</li><li id="d4f2" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><code class="fe og oh oi oj b">components</code>:这将包含我们的定制组件。</li></ul><p id="a999" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最后，项目的结构应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/5d9996865d5834f6e218ac50ec6c1dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*6tpCmU1tCerONrC5IHU8IA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">项目文件结构</p></figure><p id="a2aa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">太好了！在下一节中，我们将配置我们的Supabase客户端。</p><h2 id="ec39" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">超级配置</h2><p id="5f54" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">在您的<code class="fe og oh oi oj b">utils</code>目录中，创建一个名为<code class="fe og oh oi oj b">supabaseClient.js</code>的文件。在这里，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="ec78" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第3-4行:从<code class="fe og oh oi oj b">.env.local</code>获取我们的客户端密钥。</li><li id="85ef" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第5行:将这些值传递给<code class="fe og oh oi oj b">createClient</code>函数。这将初始化我们的Supabase实例。</li><li id="93d0" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第7行:导出这个Supabase配置，这样我们就可以在我们的项目中使用它。</li></ul><p id="73e7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在下一部分中，我们将编写帮助用户登录和退出应用程序的代码。</p><h2 id="93de" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">认证实用程序功能</h2><p id="9e10" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">在你的<code class="fe og oh oi oj b">utils</code>文件夹中，创建一个名为<code class="fe og oh oi oj b">authentication.js</code>的文件。在这里，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="db8e" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第2行:调用<code class="fe og oh oi oj b">auth.signIn</code>函数。这将使用户使用他们的Google帐户登录。</li><li id="6241" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第7行:让用户注销他们的帐户。</li></ul><p id="4d1a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们完事了。现在让我们设置我们的身份验证定制组件。</p><h2 id="3ef2" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">自定义身份验证组件</h2><p id="e691" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">在你的<code class="fe og oh oi oj b">components</code>文件夹中，创建一个名为<code class="fe og oh oi oj b">Container.js</code>的文件。在该文件中，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="cd59" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第7行:<code class="fe og oh oi oj b">Auth.useUser</code>钩子将检索用户的数据。</li><li id="61c4" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第10行:如果用户已经登录，那么显示他们的名字。</li><li id="b3f1" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第13行:单击时，调用<code class="fe og oh oi oj b">signOut</code>方法。</li><li id="215f" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第14行:允许用户进入<code class="fe og oh oi oj b">/note</code>路线。我们稍后将处理这条路线。</li><li id="7dae" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第17行:如果用户没有登录，显示这个组件的子元素。</li></ul><p id="a6a9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">第二步，转到<code class="fe og oh oi oj b">pages/_app.js</code>并修改代码，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="2037" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第6-8行:<code class="fe og oh oi oj b">Auth</code>组件使用<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/reacts-context-api-explained-baebcee39d2f"> React的上下文API </a>发送用户和当前会话数据。这将保持路由之间的用户会话。</li></ul><p id="85c3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">太好了！现在让我们构建我们的登录界面。</p><h2 id="2406" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">构建我们的登录UI</h2><p id="8d44" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">在<code class="fe og oh oi oj b">/pages/index.js</code>中，进行以下导入:</p><pre class="kj kk kl km gt ol oj om on aw oo bi"><span id="ef9d" class="ns mw it oj b gy op oq l or os">import { Button } from "@supabase/ui";<br/>import supabaseClient from "../utils/supabaseClient";<br/>import Container from "../components/Container";<br/>import signIn from "../utils/authentication";</span></pre><p id="e0fd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，找到您的<code class="fe og oh oi oj b">return</code>块:</p><pre class="kj kk kl km gt ol oj om on aw oo bi"><span id="0c36" class="ns mw it oj b gy op oq l or os">return &lt;div&gt;&lt;/div&gt;;</span></pre><p id="7ca1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">像这样修改它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="f460" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第3行:将我们的Supabase实例作为道具提供给<code class="fe og oh oi oj b">Container</code>组件。</li><li id="1cd2" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第4行:单击时，调用<code class="fe og oh oi oj b">signIn</code>方法。</li></ul><p id="82cd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">运行代码。这将是结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/3c7d8f8309b750fd41718def70456b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/1*cZr1Kf6QXfBJTlg1SidfOA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的结果</p></figure><p id="2e17" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">太好了！我们的代码有效。在下一部分，我们将围绕它构建笔记应用程序。</p><p id="2900" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最后，<code class="fe og oh oi oj b">/pages/index.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="ffe5" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">笔记功能</h1><p id="80de" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">在编写一些代码之前，我们首先必须配置我们的数据库。</p><h2 id="039a" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">数据库配置</h2><p id="bc45" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">导航到您的Supabase项目，然后单击“SQL”选项卡打开SQL编辑器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/08659077caa71159af7cf00171f5279f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sn_v46130U8XZyKAvOzY7w.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">转到SQL编辑器</p></figure><p id="b766" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这里，编写以下SQL代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="796f" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第3行:我们的<code class="fe og oh oi oj b">notes</code>表将有一个<code class="fe og oh oi oj b">user_id</code>字段，它将链接到<code class="fe og oh oi oj b">auth.users</code>表。因此，这允许我们构建一个关系表。</li><li id="e503" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第4-5行:它还有一个类型为<code class="fe og oh oi oj b">text</code>的<code class="fe og oh oi oj b">heading</code>和<code class="fe og oh oi oj b">body</code>字段。</li><li id="9cb2" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第8行:<a class="ae ky" href="https://supabase.io/docs/learn/auth-deep-dive/auth-row-level-security" rel="noopener ugc nofollow" target="_blank">启用行级安全</a>。这是构建策略所必需的。</li><li id="e66c" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第10-17行:创建<a class="ae ky" href="https://supabase.io/docs/guides/auth#policies" rel="noopener ugc nofollow" target="_blank">超级策略</a>。总之，它告诉Supabase用户只能对自己的记录执行数据库操作。</li></ul><p id="359e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">完成后，我们现在需要配置我们的表来使用<a class="ae ky" href="https://supabase.io/docs/guides/database#realtime" rel="noopener ugc nofollow" target="_blank">实时</a> API。为此，请执行以下步骤:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/8aa2787c785fdd2915de6eb0fa7bdb6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*dRcYJzQl4h2YeBGM_5YKYA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">为我们的表启用实时</p></figure><p id="50fc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这意味着用户每删除或添加一条记录，Supabase都会通知app。这样，应用程序可以显示这些变化，而无需刷新网页。</p><p id="9d86" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们完事了。现在让我们开始为我们的应用程序编写额外的助手函数。他们将在我们的数据库上执行CRUD操作。</p><h2 id="17ca" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">效用函数</h2><p id="efca" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">在你的<code class="fe og oh oi oj b">utils</code>文件夹中，创建一个名为<code class="fe og oh oi oj b">note.js</code>的文件。在这里，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="b0fb" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第4-7行:从<code class="fe og oh oi oj b">notes</code>表中取出用户的记录，然后按照升序<code class="fe og oh oi oj b">id</code>排序。</li><li id="e76c" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第13-16行:在表格中插入一个注释。</li><li id="2de6" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第24-27行:找到带有所需<code class="fe og oh oi oj b">id</code>的注释，然后删除它。</li></ul><p id="95db" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">完成后，现在是时候构建一个允许用户创建笔记的界面了。</p><h2 id="b008" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">AddForm组件</h2><p id="5f4e" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">转到您的<code class="fe og oh oi oj b">/components/</code>目录并创建一个名为<code class="fe og oh oi oj b">AddForm.js</code>的文件。在这里，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="b0e9" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第8-9行:<code class="fe og oh oi oj b">body</code>和<code class="fe og oh oi oj b">heading</code>文本字段的占位符值将为空。</li><li id="2d26" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第11-13行:当用户提交表单时，调用<code class="fe og oh oi oj b">add</code>方法。这将把记录插入数据库。</li><li id="0ba5" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第16-17行:创建我们的<code class="fe og oh oi oj b">heading</code>和<code class="fe og oh oi oj b">body</code>文本字段。</li></ul><p id="05b0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在我们的<code class="fe og oh oi oj b">AddForm</code>组件已经完成，是时候创建一个GUI让用户阅读和删除他们的笔记了。</p><h2 id="766a" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">注释页和启用订阅</h2><p id="1a4d" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">在您的<code class="fe og oh oi oj b">/pages</code>文件夹中，创建一个名为<code class="fe og oh oi oj b">note.js</code>的文件。在这里，编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="01d8" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第8-10行:创建钩子来存储用户的注释，这样我们就可以将它们显示到DOM中。</li><li id="87cb" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第14-18行:从数据库获取数据，并将结果存储到<code class="fe og oh oi oj b">data</code>钩子中。</li><li id="d5d3" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第21-30行:<a class="ae ky" href="https://supabase.io/docs/reference/javascript/subscribe" rel="noopener ugc nofollow" target="_blank">订阅</a>数据库<code class="fe og oh oi oj b">notes</code>表中的实时变化。如果用户创建了一个记录(一个<code class="fe og oh oi oj b">INSERT</code>事件)，那么将新记录存储到<code class="fe og oh oi oj b">newData</code>钩子中。此外，如果用户删除一条记录(一个<code class="fe og oh oi oj b">DELETE</code>事件)，那么将<code class="fe og oh oi oj b">deletedData</code>的值设置为被删除的笔记。</li></ul><p id="fa24" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们现在需要编写逻辑来处理记录的创建或删除。为此，在<code class="fe og oh oi oj b">pages/note.js</code>中添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="1344" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第2-3行:当组件第一次挂载时，运行<code class="fe og oh oi oj b">getData</code>函数并运行我们的订阅方法。</li><li id="652c" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第6行:取消实时订阅。这将防止内存泄漏。</li><li id="3cfe" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第12-14行:如果<code class="fe og oh oi oj b">newData</code>不是<code class="fe og oh oi oj b">null</code>，则将<code class="fe og oh oi oj b">newData</code>的值加到<code class="fe og oh oi oj b">data</code>数组中。</li><li id="3f4e" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第19行:如果<code class="fe og oh oi oj b">deletedData</code>有一个值，那么从<code class="fe og oh oi oj b">data</code>数组中删除相关的项目。</li></ul><p id="7402" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们剩下要做的就是渲染界面。为此，在<code class="fe og oh oi oj b">/pages/note.js</code>中编写以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><ul class=""><li id="4ab8" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">第3行:呈现<code class="fe og oh oi oj b">AddForm</code>元素，并将我们的用户数据作为道具传入。</li><li id="c830" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第5-10行:在我们的<code class="fe og oh oi oj b">data</code>数组上调用<code class="fe og oh oi oj b">map</code>方法，并显示每一项的<code class="fe og oh oi oj b">heading</code>、<code class="fe og oh oi oj b">body</code>和<code class="fe og oh oi oj b">id</code>字段。</li><li id="9bd1" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">第11行:单击时，删除有问题的注释。</li></ul><p id="3376" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">运行代码并转到<code class="fe og oh oi oj b">/note</code>目录。结果应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/4986bb83e1e85338425782bf9bcb51b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/1*ocK-HSLz4uAmK3Ip5vwWIQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码的输出</p></figure><p id="8aa3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们完事了。要显示实时功能，请打开同一个应用程序的两个实例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/2353e4db6d00c4b29deed69b0919fae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Vb4d1iOzs4Bx8sIqa8TGQg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实时作品！</p></figure><p id="3b54" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">请注意，我们不必刷新应用程序来查看我们的更改。这证明了Supabase的实时工作零缺陷！</p><p id="acd5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最后，<code class="fe og oh oi oj b">/pages/note.js</code>应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="aadd" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">额外资源</h1><h2 id="4704" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">GitHub知识库</h2><p id="fd0e" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">这个应用程序的代码。</p><h2 id="5cf9" class="ns mw it bd mx nt nu dn nb nv nw dp nf lj nx ny nh ln nz oa nj lr ob oc nl od bi translated">进一步阅读</h2><ul class=""><li id="baa8" class="lw lx it lc b ld nn lg no lj pd ln pe lr pf lv mb mc md me bi translated"><a class="ae ky" href="https://github.com/supabase/supabase/tree/master/examples/nextjs-todo-list" rel="noopener ugc nofollow" target="_blank"> Next.js和Supabase待办事项</a></li><li id="027f" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><a class="ae ky" href="https://dev.to/ftonato/realtime-subscriptions-using-vue-supabase-1e11" rel="noopener ugc nofollow" target="_blank">使用Vue + Supabase的实时订阅</a></li><li id="cfc2" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=LUMxJ4w-MUU" rel="noopener ugc nofollow" target="_blank">带授权和实时的松弛克隆</a></li></ul></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="e3de" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">结论</h1><p id="2aa4" class="pw-post-body-paragraph la lb it lc b ld nn ju lf lg no jx li lj np ll lm ln nq lp lq lr nr lt lu lv im bi translated">Supabase是一个易于使用的库，它包含了大量的特性来帮助开发者获得更好的体验。由于Supabase运行在开源上，所以对于喜欢在应用程序中使用开放技术的程序员来说，这是一个很好的选择。如果你有一个需要认证和其他特性的项目，那么Supabase非常适合你的工具箱。</p><p id="1916" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">非常感谢您的阅读！</p></div></div>    
</body>
</html>