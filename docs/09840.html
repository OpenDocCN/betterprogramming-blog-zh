<html>
<head>
<title>How to Update the State Of a Widget From Another Widget In Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Flutter中从另一个小部件更新一个小部件的状态</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-update-the-state-of-a-widget-from-another-widget-in-flutter-25922ca5dd78?source=collection_archive---------0-----------------------#2021-10-20">https://betterprogramming.pub/how-to-update-the-state-of-a-widget-from-another-widget-in-flutter-25922ca5dd78?source=collection_archive---------0-----------------------#2021-10-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d9c1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们在Flutter的底层设置状态管理</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/74aa6cd811faa6aa3506687300ae7338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8-VRNwWh4qj5fjum"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@joyreal328?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Joy Real </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="6a55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我正在开发一个Flutter to do应用程序，这时我意识到我想把我的<code class="fe lv lw lx ly b">NewToDo</code>小部件移到一个<code class="fe lv lw lx ly b"><a class="ae ky" href="https://api.flutter.dev/flutter/material/showModalBottomSheet.html" rel="noopener ugc nofollow" target="_blank">showModalBottomSheet</a></code>中。下面是当前UI的gif。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/0cfbc327841f7cd17315414aa32e93d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/1*1r-pqnMmuFRcJ5fjL-mVIQ.gif"/></div></figure><p id="2ab1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理想情况下，当用户在<code class="fe lv lw lx ly b">title</code>字段中输入任何内容时,“添加到待办事项”按钮应该被激活。</p><p id="ec16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我遇到的问题是<code class="fe lv lw lx ly b">title</code>的状态值是在<code class="fe lv lw lx ly b">MyApp</code>小部件中管理的(因为我也允许编辑功能，而编辑按钮不是我的<code class="fe lv lw lx ly b">NewToDo</code>的一部分)，由于某种原因<code class="fe lv lw lx ly b">NewToDo</code>没有获得更新后的状态。我在StackOverflow 上询问了这个问题，得到了一个非常简洁的解决方案。</p><p id="0a09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是<code class="fe lv lw lx ly b">MyApp</code>中<code class="fe lv lw lx ly b">FloatingActionButton</code>的代码:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="0d4e" class="me mf it ly b gy mg mh l mi mj">floatingActionButton: FloatingActionButton(<br/>  onPressed: () {<br/>    showModalBottomSheet&lt;void&gt;(<br/>      context: context,<br/>      builder: (BuildContext context) {<br/>        return NewToDo(titleController, contentController, _addTodo, _clear, _todo);<br/>      });<br/>    }<br/>  },<br/>  child: const Icon(Icons.add),<br/>  backgroundColor: Colors.deepPurple,<br/>),</span></pre><p id="0cb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以基本上发生的事情是<code class="fe lv lw lx ly b">NewToDo</code>能够知道状态何时改变，因为它正在被传递。</p><p id="bc4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我知道这一点，因为当你在标题文本输入中输入一些东西时，按钮不会激活，如果我输入一些东西，然后关闭模态并重新打开它，按钮就会被激活。</p><p id="24a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题是<code class="fe lv lw lx ly b">NewToDo</code>不知道重新渲染，因为它被包裹在<code class="fe lv lw lx ly b">showModalBottomSheet</code>的<code class="fe lv lw lx ly b">builder</code>中。</p><p id="a78d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b"><a class="ae ky" href="https://api.flutter.dev/flutter/widgets/Builder-class.html" rel="noopener ugc nofollow" target="_blank">builder</a></code>是一个回调函数，主要用于获取或构建一个子部件。您可以在许多小部件上看到这个属性，它可以用来返回子小部件，而不必导入和实例化无状态小部件。</p><p id="5225" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于<code class="fe lv lw lx ly b">NewToDo</code>被包装在另一个构建器中，并且具有与父小部件不同的上下文，因此当状态被更新时，<code class="fe lv lw lx ly b">NewToDo</code>不会重新构建。</p><p id="526e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，我是如何解决这个问题的呢？嗯，有一件事需要提及，在我的<code class="fe lv lw lx ly b">NewToDo</code>小部件中，我使用了一个<code class="fe lv lw lx ly b"><a class="ae ky" href="https://api.flutter.dev/flutter/material/TextField-class.html" rel="noopener ugc nofollow" target="_blank">TextField</a></code>来捕获标题数据。</p><p id="65ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的<code class="fe lv lw lx ly b">TextField</code>小部件中，使用一个<code class="fe lv lw lx ly b"><a class="ae ky" href="https://api.flutter.dev/flutter/widgets/TextEditingController-class.html" rel="noopener ugc nofollow" target="_blank">TextEditingController</a></code>来跟踪放入标题<code class="fe lv lw lx ly b">TextField</code>中的值。这个控制器是<em class="mk"> listenable </em>，这意味着它可以用来告诉客户端一个对象被更新了(即状态)。</p><blockquote class="ml mm mn"><p id="db72" class="kz la mk lb b lc ld ju le lf lg jx lh mo lj lk ll mp ln lo lp mq lr ls lt lu im bi translated">关于<code class="fe lv lw lx ly b">TextField</code>和<code class="fe lv lw lx ly b">TextEditingController</code>以及状态管理的更多信息，请查看我之前的<a class="ae ky" href="https://levelup.gitconnected.com/text-input-with-flutter-3a395c70c2e8" rel="noopener ugc nofollow" target="_blank">博文</a>。</p></blockquote><p id="ed11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我需要做的就是包装<code class="fe lv lw lx ly b">NewToDo</code>就是所谓的<code class="fe lv lw lx ly b"><a class="ae ky" href="https://api.flutter.dev/flutter/widgets/ValueListenableBuilder-class.html" rel="noopener ugc nofollow" target="_blank">ValueListenableBuilder</a></code>。这意味着如果它正在监听的值发生变化，这个<code class="fe lv lw lx ly b">builder</code>可以重建它的子节点(在本例中为<code class="fe lv lw lx ly b">NewToDo</code>)。</p><p id="b14d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们更新后的<code class="fe lv lw lx ly b"><a class="ae ky" href="https://api.flutter.dev/flutter/material/FloatingActionButton-class.html" rel="noopener ugc nofollow" target="_blank">FloatingActionButton</a></code>的样子:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="9383" class="me mf it ly b gy mg mh l mi mj">floatingActionButton: FloatingActionButton(<br/>  onPressed: () {<br/>    showModalBottomSheet&lt;void&gt;(<br/>      context: context,<br/>      builder: (BuildContext context) {<br/>        <strong class="ly iu">return ValueListenableBuilder(<br/>          valueListenable: titleController,<br/>          builder: (context, _content, child) {</strong><br/>            return NewToDo(titleController, contentController, _addTodo, _clear, _todo);<br/>          <strong class="ly iu">});</strong><br/>      });<br/>  },<br/>  child: const Icon(Icons.add),<br/>  backgroundColor: Colors.deepPurple,<br/>),</span></pre><p id="8c88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的<code class="fe lv lw lx ly b">FloatingActionButton</code>的这个更新部分将我们的<code class="fe lv lw lx ly b">NewToDo</code>小部件包装在一个<code class="fe lv lw lx ly b">ValueListenableBuilder</code>中，该小部件将<code class="fe lv lw lx ly b">titleController</code>作为<code class="fe lv lw lx ly b"><a class="ae ky" href="https://api.flutter.dev/flutter/widgets/ValueListenableBuilder/valueListenable.html" rel="noopener ugc nofollow" target="_blank">valueListenable</a></code>属性的值。</p><p id="d977" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着我们的构建器将专门监听我们的<code class="fe lv lw lx ly b">titleController</code>的更新，它是分配给标题<code class="fe lv lw lx ly b">TextField</code>的<code class="fe lv lw lx ly b">TextEditingController</code>实例。</p><p id="602f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还有另一个<code class="fe lv lw lx ly b">builder</code>属性，它允许我们在<code class="fe lv lw lx ly b">ValueListenableBuilder</code>中构建一个封装在监听器中的子部件。在我们的例子中，子部件是<code class="fe lv lw lx ly b">NewToDo</code>。</p><p id="13f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们看看我们的应用程序是如何工作的，我已经使用了一个<code class="fe lv lw lx ly b">ValueListenableBuilder</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/5ca19f7b0d43c7e1e4fb0f324359c1db.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/1*nlts4zWoCVsuzwAqt5KAaA.gif"/></div></figure><p id="c4ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了一个构建器，它监听一个要更新的特定值，<code class="fe lv lw lx ly b">NewToDo</code>随着<code class="fe lv lw lx ly b">MyApp</code>的<code class="fe lv lw lx ly b">title</code>状态值一起更新。完美！</p><p id="2e4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你看到了我是如何为待办事项应用解决其中一个问题的。请继续关注我的下一篇帖子，关于我遇到的其他一些问题以及我是如何解决它们的！</p><p id="c86f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程的所有代码都在<a class="ae ky" href="https://github.com/macro6461/flutter_to_do" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="919c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://matt-croak.medium.com/membership" rel="noopener"> <strong class="lb iu"> <em class="mk">升级您的免费Medium会员资格</em> </strong> </a> <em class="mk">并接收各种出版物上数千名作家的无限量、无广告的故事。这是一个附属链接，你的会员资格的一部分帮助我为我创造的内容获得奖励。</em></p><p id="1e7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mk">你也可以</em> <a class="ae ky" href="https://matt-croak.medium.com/subscribe" rel="noopener"> <strong class="lb iu"> <em class="mk">通过电子邮件</em> </strong> </a> <em class="mk">订阅，当我发布新内容时，你会收到通知！</em></p><p id="5f80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢谢你！</p><h1 id="4af0" class="my mf it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">API参考</h1><ol class=""><li id="da05" class="np nq it lb b lc nr lf ns li nt lm nu lq nv lu nw nx ny nz bi translated"><a class="ae ky" href="https://api.flutter.dev/flutter/material/showModalBottomSheet.html" rel="noopener ugc nofollow" target="_blank">显示模型底部表API </a></li><li id="afc3" class="np nq it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><a class="ae ky" href="https://api.flutter.dev/flutter/material/TextField-class.html" rel="noopener ugc nofollow" target="_blank"> TextField类</a></li><li id="1dc9" class="np nq it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><a class="ae ky" href="https://api.flutter.dev/flutter/widgets/TextEditingController-class.html" rel="noopener ugc nofollow" target="_blank"> TextEditingController类</a></li><li id="a823" class="np nq it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><a class="ae ky" href="https://api.flutter.dev/flutter/widgets/ValueListenableBuilder-class.html" rel="noopener ugc nofollow" target="_blank"> ValueListenableBuilder类</a></li><li id="ddeb" class="np nq it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><a class="ae ky" href="https://api.flutter.dev/flutter/material/FloatingActionButton-class.html" rel="noopener ugc nofollow" target="_blank">浮动操作按钮类</a></li><li id="7da3" class="np nq it lb b lc oa lf ob li oc lm od lq oe lu nw nx ny nz bi translated"><a class="ae ky" href="https://api.flutter.dev/flutter/widgets/ValueListenableBuilder/valueListenable.html" rel="noopener ugc nofollow" target="_blank">valuelistanable属性</a></li></ol></div></div>    
</body>
</html>