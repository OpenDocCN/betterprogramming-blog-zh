<html>
<head>
<title>Five Minute Kubernetes Installation With k3OS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用k3OS安装Kubernetes五分钟</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/k3s-k3os-kubernetes-docker-containers-installation-setup-cluster-ee9ccfd51a4d?source=collection_archive---------2-----------------------#2021-06-11">https://betterprogramming.pub/k3s-k3os-kubernetes-docker-containers-installation-setup-cluster-ee9ccfd51a4d?source=collection_archive---------2-----------------------#2021-06-11</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="dba9" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用Rancher以Kubernetes为中心的操作系统快速启动和运行</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/1ab441e15896c4d6c40d3acc585a8d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvOXW-DiPwdmn95F1IzEHQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">K3S Kubernetes分布图(图片由Rancher Labs提供)</p></figure><h1 id="bed4" class="kz la iu bd lb lc ld le lf lg lh li lj ka lk kb ll kd lm ke ln kg lo kh lp lq bi translated">k3OS:Kubernetes的Linux发行版</h1><p id="e881" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi translated">k <a class="ae mn" href="https://k3os.io" rel="noopener ugc nofollow" target="_blank"> 3OS </a>是一个精简的、易于维护的操作系统，用于运行Kubernetes节点。它由<a class="ae mn" href="https://rancher.com/about" rel="noopener ugc nofollow" target="_blank"> Rancher Labs </a>(现在是<a class="ae mn" href="https://www.suse.com/products/suse-rancher" rel="noopener ugc nofollow" target="_blank"> SUSE </a>的一部分)积极开发和维护，顾名思义，它运行<a class="ae mn" href="https://rancher.com/products/k3s/" rel="noopener ugc nofollow" target="_blank"> K3s </a> Kubernetes发行版(也是Rancher所有)。</p><blockquote class="mo mp mq"><p id="04f2" class="lr ls mr lt b lu ms jv lw lx mt jy lz mu mv mc md mw mx mg mh my mz mk ml mm in bi translated">K3s是CNCF官方沙盒项目，提供轻量级但功能强大的认证Kubernetes分发版，专为资源受限的远程位置或物联网设备上的生产工作负载而设计。它被打包成一个ISO版本，您可以将其安装在您最喜欢的虚拟化基础设施上，也可以安装在裸机上。如果您像我一样使用VMWare的ESXi，请确保为初始安装指定虚拟机的操作系统“Ubuntu Linux (64位)”。虚拟机启动并运行后，您将看到以下消息:</p></blockquote></div><div class="ab cl na nb hy nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="in io ip iq ir"><h1 id="bbbf" class="kz la iu bd lb lc nh le lf lg ni li lj ka nj kb ll kd nk ke ln kg nl kh lp lq bi translated">k3OS的VMware ESXi操作系统类型选择(图片由作者提供)</h1><p id="72b2" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi translated">然后可以切换到“其他4.x Linux (64位)”。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nm"><img src="../Images/8fedcf2d91230d8bb4a2df48d9674d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sVoet2UH3mgKRA3B-6OatA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">一旦你打开虚拟机，你会看到一个典型的引导程序屏幕，你可以直接在你连接的存储器上安装k3OS。</p></figure><p id="5ea9" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">k3OS开机画面(图片由作者提供)</p><p id="661d" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">选择第二个选项，自动安装不会超过五分钟。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nn"><img src="../Images/47ebd60fd325be0934152e4a76a3a67c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhiV9cKFI7b4L6gRGq_hkg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><em class="mr">注意:如果您计划创建一个多节点集群(见下文)，请为“集群令牌”输入一个您能记住的值，因为您以后会需要它。</em></p></figure><p id="b4b4" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">网络设置</p><p id="162f" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">由于k3OS不是普通的Linux发行版，某些网络配置任务可能并不简单，除非你确切地知道去哪里看。以下部分描述了定制您的环境的一些基本配置。</p><h1 id="6654" class="kz la iu bd lb lc ld le lf lg lh li lj ka lk kb ll kd lm ke ln kg lo kh lp lq bi translated">主机名更改</h1><p id="c74e" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi translated">在k3OS中，对<code class="fe oa ob oc od b">/etc</code>的更改不会在重启后持续。因此，您需要更改k3OS配置文件，这些文件会在每次引导时生成<code class="fe oa ob oc od b">/etc</code>。要保持对主机名的更改，您可以使用以下命令发出更改:</p><h2 id="5965" class="no la iu bd lb np nq dn lf nr ns dp lj ma nt nu ll me nv nw ln mi nx ny lp nz bi translated">要真正看到您的主机名被更改，您需要使用以下命令重新启动:</h2><p id="c99f" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi translated">或者，您可以用这个条目创建<code class="fe oa ob oc od b">/var/lib/rancher/k3os/config.yaml</code>:</p><pre class="kk kl km kn gu oe od of og aw oh bi"><span id="0afb" class="no la iu od b gz oi oj l ok ol">sudo vi /var/lib/rancher/k3os/hostname</span></pre><p id="1806" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">识别和更改网络</p><pre class="kk kl km kn gu oe od of og aw oh bi"><span id="9ef2" class="no la iu od b gz oi oj l ok ol">sudo reboot</span></pre><p id="4645" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">k3OS使用<a class="ae mn" href="https://en.wikipedia.org/wiki/ConnMan" rel="noopener ugc nofollow" target="_blank"> ConnMan </a>，因此网络管理应该通过<code class="fe oa ob oc od b">connmanctl</code>命令进行:</p><pre class="kk kl km kn gu oe od of og aw oh bi"><span id="4c2e" class="no la iu od b gz oi oj l ok ol">hostname: myhostname</span></pre><h2 id="edaa" class="no la iu bd lb np nq dn lf nr ns dp lj ma nt nu ll me nv nw ln mi nx ny lp nz bi translated"><code class="fe oa ob oc od b">sudo connmanctl services</code>:为您提供所有可用网络的列表。</h2><p id="21ef" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi translated"><code class="fe oa ob oc od b">sudo connmanctl config NETWORK --ipv4 manual IP NETMASK GATEWAY --nameservers DNS:</code> <em class="mr"> </em>允许您定义一个静态IPv4地址。</p><p id="496f" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated"><code class="fe oa ob oc od b">sudo connmanctl config NETWORK — ipv6 off</code>:允许您关闭IPv6。</p><p id="1b69" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated"><code class="fe oa ob oc od b">sudo service connman restart</code>:重启ConnMan使你的修改生效。</p><p id="b953" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">SSH访问</p><p id="52dd" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">要对k3OS安装启用SSH访问，您需要将您的公共SSH RSA密钥添加到您的安装中。为此，创建<code class="fe oa ob oc od b">/var/lib/rancher/k3os/config.yaml</code>并将您的键设置为:</p><h2 id="6148" class="no la iu bd lb np nq dn lf nr ns dp lj ma nt nu ll me nv nw ln mi nx ny lp nz bi translated">可以用用户<code class="fe oa ob oc od b">rancher</code>SSH进入k3OS。</h2><p id="681e" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi translated">通过kubectl远程访问</p><pre class="kk kl km kn gu oe od of og aw oh bi"><span id="1625" class="no la iu od b gz oi oj l ok ol">ssh_authorized_keys:<br/>- ssh-rsa AAAAB3Nza...</span></pre><p id="8ef7" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">要远程连接到在k3OS中运行的K3s，您可以从<code class="fe oa ob oc od b">/etc/rancher/k3s/k3s.yaml</code>下载集群配置。将YAML文件复制到您的<code class="fe oa ob oc od b">kubectl</code>的主机上，并可选地更改集群名称，以便您可以正确地识别它(如果您使用kubens/kubectx工具，就像我之前在<a class="ae mn" rel="noopener ugc nofollow" target="_blank" href="/4-kubernetes-cli-gems-c47a72e6fab0"> 4 Kubernetes CLI Gems </a>中所写的那样，这将非常有用)。</p><h1 id="0fca" class="kz la iu bd lb lc ld le lf lg lh li lj ka lk kb ll kd lm ke ln kg lo kh lp lq bi translated">Kubernetes仪表板</h1><p id="ec28" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi translated">K3s没有附带仪表板应用程序，因此您可以安装Kubernetes附带的标准仪表板应用程序。</p><h1 id="7ce8" class="kz la iu bd lb lc ld le lf lg lh li lj ka lk kb ll kd lm ke ln kg lo kh lp lq bi translated">首先，确定您想要使用的Kubernetes仪表板版本:<br/><a class="ae mn" href="https://github.com/kubernetes/dashboard/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes/dashboard/releases</a></h1><p id="6dc4" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi translated">然后安装它，例如</p><p id="93f4" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">在远程访问控制面板之前，您需要一个具有适当权限的用户以及该用户的令牌。您可以通过创建一个包含以下内容的<code class="fe oa ob oc od b">dashboard-admin.yaml</code> YAML文件来创建用户并提供必要的权限:</p><p id="2ecf" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">接下来，使用以下内容导入它:</p><pre class="kk kl km kn gu oe od of og aw oh bi"><span id="1943" class="no la iu od b gz oi oj l ok ol">sudo k3s kubectl create -f <a class="ae mn" href="https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml</a></span></pre><p id="2b91" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated"><code class="fe oa ob oc od b">sudo k3s kubectl create -f dashboard-admin.yaml</code></p><pre class="kk kl km kn gu oe od of og aw oh bi"><span id="293b" class="no la iu od b gz oi oj l ok ol">apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  name: admin-user<br/>  namespace: kubernetes-dashboard<br/>---<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>kind: ClusterRoleBinding<br/>metadata:<br/>  name: admin-user<br/>roleRef:<br/>  apiGroup: rbac.authorization.k8s.io<br/>  kind: ClusterRole<br/>  name: cluster-admin<br/>subjects:<br/>- kind: ServiceAccount<br/>  name: admin-user<br/>  namespace: kubernetes-dashboard</span></pre><p id="11f1" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">在您可以远程访问控制面板之前，您需要找到您刚刚创建的用户的令牌:</p><p id="5179" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">要从您的<code class="fe oa ob oc od b">kubectl</code>主机访问仪表板，通过发出以下命令启动K3s的代理:</p><p id="e594" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">然后，您可以在此处使用上述令牌访问仪表板:</p><pre class="kk kl km kn gu oe od of og aw oh bi"><span id="b941" class="no la iu od b gz oi oj l ok ol">sudo k3s kubectl -n kubernetes-dashboard describe secret admin-user-token | grep '^token'| awk -F ' ' '{print $2}'</span></pre><p id="3d13" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">在K3s上运行的Kubernetes仪表盘(图片由作者提供)</p><pre class="kk kl km kn gu oe od of og aw oh bi"><span id="3701" class="no la iu od b gz oi oj l ok ol">kubectl proxy</span></pre><p id="cfdc" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">使用额外的代理节点扩展集群</p><pre class="kk kl km kn gu oe od of og aw oh bi"><span id="c2b0" class="no la iu od b gz oi oj l ok ol"><a class="ae mn" href="http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</a></span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj om"><img src="../Images/8624c2dd9047043f7376821a153c523e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QXU64zpZdNCeAc-SDJ29VQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">向k3OS集群添加额外的代理节点非常简单。用k3OS的ISO引导一个新的虚拟机，而不是选择<code class="fe oa ob oc od b">server</code>，选择<code class="fe oa ob oc od b">agent</code>安装:</p></figure><h1 id="0d71" class="kz la iu bd lb lc ld le lf lg lh li lj ka lk kb ll kd lm ke ln kg lo kh lp lq bi translated">将代理节点添加到集群中(图片由作者提供)</h1><p id="21fe" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi translated">您需要提供创建第一个节点时记录的集群密码，以及Kubernetes API监听的URL。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj on"><img src="../Images/47610c48da01d42a989be0a0cecf53b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FfAGPRpi-KYU1k8qa2osOw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">摘要</p></figure><p id="e605" class="pw-post-body-paragraph lr ls iu lt b lu ms jv lw lx mt jy lz ma mv mc md me mx mg mh mi mz mk ml mm in bi translated">k3OS是由Rancher Labs创建的最小操作系统，它允许您基于K3s创建生产级Kubernetes集群。在虚拟化环境或裸机中安装集群只需几分钟。本指南为您提供了一些基本设置的快速参考，您可能希望在集群启动后进行调整。</p><h1 id="627b" class="kz la iu bd lb lc ld le lf lg lh li lj ka lk kb ll kd lm ke ln kg lo kh lp lq bi">Summary</h1><p id="0e90" class="pw-post-body-paragraph lr ls iu lt b lu lv jv lw lx ly jy lz ma mb mc md me mf mg mh mi mj mk ml mm in bi">k3OS is a minimal operating system, created by Rancher Labs, that allows you to create a production-grade Kubernetes cluster based on K3s. Installing the cluster in a virtualised environment or bare metal takes just a few minutes. This guide provided you a quick reference into some of the basic settings you might want to tune once your cluster is up.</p></div></div>    
</body>
</html>