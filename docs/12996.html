<html>
<head>
<title>Learn How to Build, Test and Deploy a Bookstore App With React 18, Vite, and Netlify Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解如何使用React 18、Vite和Netlify功能构建、测试和部署书店应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/learn-how-to-build-test-and-deploy-a-bookstore-app-with-react-18-vite-and-netlify-functions-1e1050c8711?source=collection_archive---------9-----------------------#2022-07-18">https://betterprogramming.pub/learn-how-to-build-test-and-deploy-a-bookstore-app-with-react-18-vite-and-netlify-functions-1e1050c8711?source=collection_archive---------9-----------------------#2022-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9a14" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">探索这些强大程序的深入指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/173daebd645a04e6b6681ac6d38da563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U-kGVmQNgaBnOA_CDBGXMQ.png"/></div></div></figure><p id="87f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>于2011年在脸书(现为<a class="ae ln" href="https://about.facebook.com/" rel="noopener ugc nofollow" target="_blank"> Meta </a>)出现，并继续快速发展，获得了一个重要的生态系统，在其基础上有各种各样的插件和UI框架。</p><p id="51cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本指南将详细介绍使用最新的React 18创建一个工作示例书店单页面应用程序并使用<a class="ae ln" href="https://vitejs.dev/" rel="noopener ugc nofollow" target="_blank"> Vite </a>运行它的步骤。它还包括添加定制状态管理解决方案和使用<a class="ae ln" href="https://github.com/molefrog/wouter" rel="noopener ugc nofollow" target="_blank"> wouter </a>库进行路由的细节。</p><p id="7a0a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这篇文章是我们最近在这个博客上发表的文章的翻版。两者的结果是一样的(一个我们称之为Middlemarch的书店单页应用程序)。然而，本教程还包含一个使用无服务器功能的后端解决方案。</p><p id="e31d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是我们将在本教程中重点关注的主要任务:</p><ol class=""><li id="7559" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">用Vite引导应用程序框架</li><li id="d07a" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">使用wouter库管理路线</li><li id="dca6" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">创建内部状态管理工具</li><li id="cb83" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">创建并运行<a class="ae ln" href="https://functions.netlify.com/" rel="noopener ugc nofollow" target="_blank">网络功能</a></li><li id="34ee" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">用Nightwatch编写React组件测试</li><li id="40b4" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">使用Nightwatch编写并运行自动化的端到端测试</li><li id="f00f" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">用Github动作构建和部署应用程序</li></ol><p id="e20f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一项大工程，但它准确地描述了整个开发周期。该应用程序将被部署到Netlify。如果你渴望马上开始编码，你想马上投入进去，你可以让项目启动并运行:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="9fdb" class="mh mi iq md b gy mj mk l ml mm">git clone https://github.com/pineviewlabs/middlemarch-react<br/>cd middlemarch-react<br/>npm install<br/>npm start</span></pre><p id="9cad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者在<a class="ae ln" href="https://github.com/pineviewlabs/middlemarch-react" rel="noopener ugc nofollow" target="_blank">https://github.com/pineviewlabs/middlemarch-react</a>分叉项目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/a5163405ebf2737f81bda105c3e046bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M6OCXPQJ-CQd0KiWyZwIew.png"/></div></div></figure><h1 id="2cde" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">步骤1——用Vite引导应用程序框架</h1><p id="20b3" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">我们将使用<code class="fe nk nl nm md b"><a class="ae ln" href="https://github.com/vitejs/vite/tree/main/packages/create-vite#readme" rel="noopener ugc nofollow" target="_blank">create-vite</a></code> CLI来引导基本结构和依赖关系。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="a1c2" class="mh mi iq md b gy mj mk l ml mm">npm create vite middlemarch -- --template react</span></pre><p id="76bd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后按照最后出现的说明进行操作，例如:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="6ddd" class="mh mi iq md b gy mj mk l ml mm">Scaffolding project in /home/projects/middlemarch...</span><span id="8d41" class="mh mi iq md b gy nn mk l ml mm">Done. Now run:</span><span id="280e" class="mh mi iq md b gy nn mk l ml mm">  cd middlemarch<br/>  npm install<br/>  npm run dev</span></pre><p id="7174" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">文件夹结构可能类似于:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="bed5" class="mh mi iq md b gy mj mk l ml mm">/<br/> ├── src/<br/> |    ├── App.css<br/> |    ├── App.jsx<br/> |    ├── favicon.ico<br/> |    ├── index.css<br/> |    ├── logo.svg<br/> |    └── main.jsx<br/> ├─── .gitignore<br/> ├─── index.html<br/> ├─── package.json<br/> └─── vite.config.js</span></pre><p id="fb91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们不需要<code class="fe nk nl nm md b">App.css</code>和<code class="fe nk nl nm md b">logo.svg</code>，所以你可以马上删除它们。我们需要做的最后一件事是用这些脚本替换默认脚本:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="2a74" class="mh mi iq md b gy mj mk l ml mm">{<br/>  "scripts": {<br/>    "vite:start": "vite",<br/>    "vite:build": "vite build"<br/>  }<br/>}</span></pre><blockquote class="no np nq"><p id="30e1" class="kr ks nr kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated">我们添加了<code class="fe nk nl nm md b">vite:</code>前缀来区分前端构建部分和无服务器功能。以后再说。</p></blockquote><h1 id="888c" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">准备App.jsx文件</h1><p id="b099" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">至此，我们已经准备好了开发环境。让我们深入研究React并更新<code class="fe nk nl nm md b">App.jsx</code>文件以匹配以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><blockquote class="no np nq"><p id="d4f0" class="kr ks nr kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated">StrictMode突出了应用程序中的潜在问题，您可能没有注意到这些问题。将整个应用程序包装在其中是一个很好的做法。</p></blockquote><p id="bac6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，运行npm <code class="fe nk nl nm md b">vite:start</code>脚本，让应用程序在<code class="fe nk nl nm md b"><a class="ae ln" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code>运行。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="dad3" class="mh mi iq md b gy mj mk l ml mm">npm run vite:start</span></pre><p id="70b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此时，您将看到一个空页面，在<code class="fe nk nl nm md b">#root</code>下有<code class="fe nk nl nm md b">&lt;main&gt;</code>元素。下一步是编写包含实际内容的页面，以便在浏览器中看到一些内容。</p><h1 id="b678" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">步骤2-添加路线</h1><p id="a83d" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">是时候创建我们的应用程序的主要路线了。在React中，每个页面只是一个单独的组件。对于此应用，我们将考虑以下组件:</p><ul class=""><li id="8d70" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm nx lu lv lw bi translated">主页——将在<code class="fe nk nl nm md b">/</code>基本URL提供的第一个页面</li><li id="974d" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm nx lu lv lw bi translated">购物车—包含产品列表的页面；它只对已登录的用户可用</li><li id="57da" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm nx lu lv lw bi translated">登录—登录表单</li><li id="582d" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm nx lu lv lw bi translated">注册—用户注册表单</li></ul><p id="7e1b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了简单起见，我将只向您展示主页的完整实现。但是你可能总是会去<a class="ae ln" href="https://github.com/pineviewlabs/middlemarch-react" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>查看应用程序的最终源代码。</p><p id="830d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">整个应用程序将具有以下标记:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/aa2ec6444d52f591ef89ce823c0eb43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*kxrPubz0NlKn257s2U6jBQ.png"/></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">页面标记</p></figure><p id="0606" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们创建页眉和页脚组件，它们在每一页上都保持不变:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="fb86" class="mh mi iq md b gy mj mk l ml mm">mkdir src/components<br/>mkdir src/components/Header<br/>mkdir src/components/Footer<br/>touch src/components/Header/index.jsx<br/>touch src/components/Footer/index.jsx</span></pre><p id="acb9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我使用Unix的<a class="ae ln" href="https://en.wikipedia.org/wiki/Touch_(command)" rel="noopener ugc nofollow" target="_blank"> touch </a>命令创建文件，使用<a class="ae ln" href="https://en.wikipedia.org/wiki/Mkdir" rel="noopener ugc nofollow" target="_blank"> mkdir </a>创建目录。您可以使用自己的编辑器或IDE来完成这些任务。</p><p id="a9e2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe nk nl nm md b">Header/index.jsx</code>文件中，添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><blockquote class="no np nq"><p id="304b" class="kr ks nr kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated">您可能会注意到这里有一个未知的<code class="fe nk nl nm md b"><a class="ae ln" href="https://github.com/molefrog/wouter#link-hrefpath-" rel="noopener ugc nofollow" target="_blank">Link</a></code>标签和<code class="fe nk nl nm md b">wouter</code>导入。它是wouter库提供的导航组件之一，触发从<code class="fe nk nl nm md b">href</code>属性到URL的导航。我们将很快报道那个图书馆。</p></blockquote><p id="4b21" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">而<code class="fe nk nl nm md b">Footer/index.jsx</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="d9ed" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，我们需要将它们包含在应用程序入口点中。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="8388" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">页面内容将在<code class="fe nk nl nm md b">main</code>元素中呈现。您可能会注意到，我们为Home和Footer组件文件声明了文件扩展名。区分本地文件和外部依赖项是很有用的，尽管这是完全可选的，并且只取决于您的偏好。</p><h1 id="1bab" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">沃特是什么？</h1><p id="33f1" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">Wouter是React和<a class="ae ln" href="https://preactjs.com/" rel="noopener ugc nofollow" target="_blank"> Preact </a>的最小路由器实现。您已经看到了<code class="fe nk nl nm md b">Link</code>组件，它只是引擎盖下的<code class="fe nk nl nm md b">&lt;a&gt;</code>元素。</p><p id="69de" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在是时候引入<code class="fe nk nl nm md b">Route</code>组件了，如果URL属性匹配当前的<code class="fe nk nl nm md b">location.pathname</code>值，它将呈现一个声明的组件。</p><p id="dbcd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们再次修改<code class="fe nk nl nm md b">App.jsx</code>组件并声明路线，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="0bc2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们正在使用wouter的另一个组件— <a class="ae ln" href="https://github.com/molefrog/wouter#switch-" rel="noopener ugc nofollow" target="_blank">交换机</a>，它执行排他路由。这意味着只有第一个匹配的路线会被渲染。</p><p id="2aea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，我们必须为每个页面提供默认标记。代码如下:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="a405" class="mh mi iq md b gy mj mk l ml mm">export default () =&gt; &lt;div&gt;&lt;/div&gt;;</span></pre><p id="3391" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后剩下的就是主页了。编辑<code class="fe nk nl nm md b">src/pages/Home/index.jsx</code>文件并添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="7bb2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，为了简洁起见，我们将省略搜索功能。您可能会注意到新的<code class="fe nk nl nm md b">useBooks</code>导入——这是一个定制的钩子，它将管理应用程序的全球图书数据。既然提到了，那就进行到状态管理部分吧。</p><h1 id="bc30" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">步骤3——使用上下文+钩子进行状态管理</h1><p id="dcd6" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">React有大量的状态管理库，它们背后有各种各样的想法。它们中的每一个都值得探索，但是在这个小应用程序中，我们不需要添加另一个依赖项，也不需要编写复杂的逻辑来存储我们的数据，数据只是一个包含可用书籍的对象数组。React已经有了API，我们可以用它来简洁地实现它。</p><h1 id="7df8" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">实现“useBooks”挂钩</h1><p id="aaaa" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">我们将使用<a class="ae ln" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">上下文</a>来全局存储数据，并使用钩子将数据传递给需要它的组件。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="2f0d" class="mh mi iq md b gy mj mk l ml mm">mkdir src/cache<br/>touch src/cache/books.jsx</span></pre><p id="04d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是实现这一点的步骤:</p><ol class=""><li id="ca46" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">创建上下文—不导出，并且是该模块的私有内容。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="e311" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2.创建提供者组件—默认情况下导出。</p><p id="5a54" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这定义了我们将要存储数据的状态，并返回带有值和状态dispatcher的上下文<code class="fe nk nl nm md b">Provider</code>。最后一点，我们需要分派状态更改，尽管它不会直接暴露给组件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="74d7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">3.创建钩子。<br/>钩子使用上下文并返回一个新的数组和修改状态的有用方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><blockquote class="no np nq"><p id="7353" class="kr ks nr kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated"><code class="fe nk nl nm md b">useBooks</code>钩子导出一个元组(两个条目的数组)，其中第一个条目是books数组，第二个条目是描述与books数组交互的可用方式的方法集合。</p></blockquote><p id="fb3a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">目前获取<code class="fe nk nl nm md b">/api/books</code> URL错误。当我们为它提供无服务器功能时，它就会工作。</p><p id="cfb2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要使用books状态，我们需要使用规则根据<a class="ae ln" href="https://reactjs.org/docs/context.html#examples" rel="noopener ugc nofollow" target="_blank">上下文用组件包装应用程序，如下所示:</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h1 id="212f" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">步骤4 —使用Netlify创建无服务器功能</h1><p id="20ee" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">无服务器功能是一个相对较新的概念，其思想是将运行和维护服务器端任务委托给云计算服务，只专注于编写代码。一些服务提供商提供这一功能，包括Netlify、Vercel、Render、Azure或Cloudflare。</p><p id="2fb4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于这个例子，我们将使用Netlify的功能，但是您可以选择您最喜欢的提供商。</p><p id="6cef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是一切工作的模式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/13c8223ba373f7620d596c27b332f83f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*42Hc7cSK9FhsLFjG1pjDPw.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">Netlify CLI工作原理的简单描述。</p></figure><h1 id="a43a" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">安装Netlify CLI</h1><p id="2abb" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">首先，我们必须安装<a class="ae ln" href="https://www.npmjs.com/package/netlify-cli" rel="noopener ugc nofollow" target="_blank"> Netlify CLI </a>并创建<code class="fe nk nl nm md b">netlify.toml</code>配置文件:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="db51" class="mh mi iq md b gy mj mk l ml mm">npm i -D netlify-cli<br/>touch netlify.toml</span></pre><p id="b280" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">需要Netlify CLI来模拟FaaS(功能即服务)环境并测试我们的功能。CLI还负责运行应用程序。</p><p id="ad92" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将调整Netlify的配置文件，以便它知道如何运行Vite开发服务器，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h1 id="7f13" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">添加lowdb数据库</h1><p id="4f7e" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">现在让我们用数据创建模拟文件。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="1a73" class="mh mi iq md b gy mj mk l ml mm">mkdir data<br/>touch data/db.json</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="7b43" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好了，让我们继续函数。默认情况下，Netlify会在<code class="fe nk nl nm md b">netlify/functions</code>目录中搜索它们。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="bacc" class="mh mi iq md b gy mj mk l ml mm">mkdir -p netlify/functions<br/>touch netlify/functions/books.js</span></pre><p id="6762" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">编辑<code class="fe nk nl nm md b">netlify/functions/books.js</code>，增加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="f98d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们使用<a class="ae ln" href="https://github.com/typicode/lowdb" rel="noopener ugc nofollow" target="_blank"> lowdb </a>包来读取JSON文件。当然，你可以直接使用<code class="fe nk nl nm md b">fs.promises.readFile</code>并从文件中读取。但这是一个例子，在现实世界的应用程序中，你将有一个数据库，你将不得不使用数据库驱动程序，所以这个例子告诉你这是可能的。</p><h1 id="f0fa" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">添加用户验证</h1><p id="65e4" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">无服务器功能允许你实现复杂的行为，如用户认证。如果你检查当前应用程序的源代码，你会看到两个页面:<br/>-<a class="ae ln" href="https://github.com/pineviewlabs/middlemarch-react/blob/main/src/pages/SignIn/index.jsx" rel="noopener ugc nofollow" target="_blank">sign in/index . jsx</a>-<br/>-<a class="ae ln" href="https://github.com/pineviewlabs/middlemarch-react/blob/main/src/pages/Register/index.jsx" rel="noopener ugc nofollow" target="_blank">Register/index . js</a></p><p id="9f11" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以及对应的功能:<br/>-<a class="ae ln" href="https://github.com/pineviewlabs/middlemarch-react/blob/main/netlify/functions/login.js" rel="noopener ugc nofollow" target="_blank">log in . js</a><br/>-<a class="ae ln" href="https://github.com/pineviewlabs/middlemarch-react/blob/main/netlify/functions/register.js" rel="noopener ugc nofollow" target="_blank">register . js</a>。</p><p id="e4b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要创建帐户，您必须传递电子邮件和密码。后者将在服务器上被散列，散列将被保存到数据库中。在哈希函数中添加一个所谓的“salt”是一个很好的做法，它应该是私有的。</p><p id="e0a9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此，我们将创建包含<code class="fe nk nl nm md b">PASSWORD_SECRET</code>变量的<code class="fe nk nl nm md b">.env</code>文件，我们将把它用作“salt”</p><p id="ec1e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是<code class="fe nk nl nm md b">.env.example</code>文件的内容。对于本地开发，将其重命名为<code class="fe nk nl nm md b">.env</code>，并填写以下内容:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="b6be" class="mh mi iq md b gy mj mk l ml mm">VITE_AUTH_KEY = 'your_super_secret_auth_key'<br/>PASSWORD_SECRET = 'super_secret_password_salt'</span></pre><p id="89a1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nk nl nm md b">VITE_AUTH_KEY</code>环境变量用于“记住我”功能。</p><h1 id="e45f" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">在Netlify中配置环境变量</h1><p id="fa98" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">在Netlify中运行时，使用管理UI定义上述环境变量:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/1f7a8e0d4c0b43d4bd7a5a5dbf48633f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QspcbgTHgtkmf51Y_gWt9g.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated"><a class="ae ln" href="https://app.netlify.com/sites/middlemarch/settings/deploys#environment" rel="noopener ugc nofollow" target="_blank">https://app . netlify . com/sites/middle March/settings/deployed # environment</a></p></figure><h1 id="3e87" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">步骤5 —用Nightwatch.js测试React组件</h1><p id="9ae0" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">组件测试是一种UI测试，其中组件被隔离呈现，没有应用程序组件的其余部分，以验证其功能。这通常是发生在端到端测试步骤之前的测试策略，我们将在下一节中详细阐述。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/e0eb9b76de2c324c9fc475c72f5d8b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QI5z8ln6ryeNjoeKaOeTKw.png"/></div></div></figure><h1 id="52c4" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">安装Nightwatch.js</h1><p id="3b88" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">我们将使用<a class="ae ln" href="https://nightwatchjs.org/" rel="noopener ugc nofollow" target="_blank"> Nightwatch </a>进行组件和端到端测试。向您的项目添加Nightwatch测试的最简单的方法是使用<code class="fe nk nl nm md b">create-nightwatch</code> init工具。</p><p id="bf2b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">只需从项目的根文件夹中运行以下命令，并遵循以下步骤:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="6d5a" class="mh mi iq md b gy mj mk l ml mm">npm init nightwatch@latest</span></pre><h1 id="2190" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">安装@nightwatch/react插件</h1><p id="64bf" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">Nightwatch支持使用@nightwatch/react测试React组件，它在内部使用<a class="ae ln" href="https://github.com/nightwatchjs/vite-plugin-nightwatch" rel="noopener ugc nofollow" target="_blank">Vite-plugin-night watch</a>Vite插件。</p><p id="672b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要安装它，请运行:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="eeb9" class="mh mi iq md b gy mj mk l ml mm">npm i -D @nightwatch/react</span></pre><p id="e9b0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在您运行了<code class="fe nk nl nm md b">npm init nightwatch</code>命令之后，您应该有一个生成的<code class="fe nk nl nm md b">nightwatch.conf.js</code>文件。</p><p id="dc72" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您需要编辑它，并让Nightwatch知道React组件测试插件已安装:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h1 id="a3e1" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">编写您的第一个组件测试</h1><p id="bb96" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">现在应该有一个<code class="fe nk nl nm md b">tests</code>目录了。我们可以添加我们的第一个组件测试。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="f5d4" class="mh mi iq md b gy mj mk l ml mm">mkdir tests/component<br/>touch tests/component/basic.js</span></pre><p id="2750" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它应包含以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><blockquote class="no np nq"><p id="c858" class="kr ks nr kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated">Nightwatch.js使用与<a class="ae ln" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"> Mocha </a>或<a class="ae ln" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>相同的<code class="fe nk nl nm md b">BDD</code>语法。你甚至可以在Nightwatch中使用Mocha作为测试运行程序，但是为了简单起见，我们不打算这么做。</p></blockquote><p id="5710" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为我们正在发出网络请求，所以我们必须在测试时模拟它。这就是为什么我们必须使用<a class="ae ln" href="https://nightwatchjs.org/api/mockNetworkResponse.html#apimethod-container" rel="noopener ugc nofollow" target="_blank">browser . mocknowleresponse</a>方法来伪造响应，因为组件测试不涉及运行的服务器。</p><p id="f90e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，你可能会注意到，<code class="fe nk nl nm md b">/tests/component/Books.jsx</code>路径。这是我们必须创建的一个测试组件，以便能够单独测试组件。原因是我们使用上下文来存储应用程序的数据。</p><p id="fefd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">根据<a class="ae ln" href="https://reactjs.org/docs/context.html#contextprovider" rel="noopener ugc nofollow" target="_blank"> React的规则</a>，如果上下文的提供者不在树中，我们就不能使用上下文。因此，如果我们想要测试某个组件，并且它通过钩子使用一些上下文(我们已经创建了一个:<code class="fe nk nl nm md b">useBooks</code>)，我们必须首先用相应的提供者包装它。</p><p id="3a54" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们创建一个用于测试的组件。我们将测试主页。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h1 id="c2c7" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">运行您的第一个组件测试</h1><p id="c4b2" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">现在可以用下面的命令在Chrome中运行上面的测试了:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="9ea8" class="mh mi iq md b gy mj mk l ml mm">npx nightwatch tests/component/basic.js --env chrome</span></pre><p id="b640" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果不想看到打开的浏览器，可以传递<code class="fe nk nl nm md b">--headless</code>参数(使用Safari时不可用)。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="56ec" class="mh mi iq md b gy mj mk l ml mm">npx nightwatch tests/component/basic.js --env chrome --headless</span></pre><blockquote class="no np nq"><p id="bf41" class="kr ks nr kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated">React中的组件测试目前只适用于Chrome和Edge浏览器。</p></blockquote><h1 id="9543" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">扩展组件测试</h1><p id="cfff" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">目前，测试没有任何帮助。让我们扩展一下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="a28a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这里，我们创建了一个简单的测试来检查页面上元素和内容的存在。我们已经将组件安装重构到了<code class="fe nk nl nm md b">before</code>钩子中，所以我们可以在<code class="fe nk nl nm md b">it</code>块中进行唯一的检查。</p><h1 id="12c1" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">模仿网络请求</h1><p id="f2b1" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">我们必须在测试时模拟<code class="fe nk nl nm md b">/api/books</code>网络请求，以确保来自服务器端组件的可靠结果。</p><p id="33e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是为什么我们使用了Nightwatch提供的<a class="ae ln" href="https://nightwatchjs.org/api/mockNetworkResponse.html#apimethod-container" rel="noopener ugc nofollow" target="_blank">browser . mocknowledge response</a>方法来伪造响应，因为组件测试不涉及正在运行的服务器。</p><h1 id="40d2" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">步骤6——使用Nightwatch添加端到端测试</h1><p id="4566" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">端到端测试(E2E)有助于验证应用程序中最重要的流程。幸运的是，我们不需要安装额外的工具来实现E2E测试，因为我们的项目中已经有了Nightwatch(安装说明见上一步)。</p><p id="04f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于与W3C web driver API和Selenium T8的集成，Nightwatch可以在所有主流浏览器上运行测试。它还允许您使用分布式云测试平台，如<a class="ae ln" href="https://www.browserstack.com/" rel="noopener ugc nofollow" target="_blank"> BrowserStack </a>、<a class="ae ln" href="https://saucelabs.com/" rel="noopener ugc nofollow" target="_blank"> SauceLabs </a>、<a class="ae ln" href="https://crossbrowsertesting.com/" rel="noopener ugc nofollow" target="_blank">crossbrowsertest</a>或<a class="ae ln" href="https://www.lambdatest.com/" rel="noopener ugc nofollow" target="_blank"> LambdaTest </a>。</p><blockquote class="no np nq"><p id="7920" class="kr ks nr kt b ku kv jr kw kx ky ju kz ns lb lc ld nt lf lg lh nu lj lk ll lm ij bi translated">对于运行端到端测试，您应该首先构建应用程序，然后用本地Vite服务器为其提供服务。这是尽可能模拟生产环境所必需的。</p></blockquote><p id="a03c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要构建和运行应用程序，请使用netlify本地开发服务器:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="9144" class="mh mi iq md b gy mj mk l ml mm">npx netlify dev</span></pre><p id="db58" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者简单地说:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="4c73" class="mh mi iq md b gy mj mk l ml mm">npm start</span></pre><h1 id="305a" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">创建您的第一个端到端测试</h1><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="5875" class="mh mi iq md b gy mj mk l ml mm">mkdir tests/e2e<br/>touch tests/e2e/HomePage.js</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="e486" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该测试验证页面是否显示并包含我们之前看到的书籍信息。</p><h1 id="25e3" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">运行您的第一个端到端测试</h1><p id="d716" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">使用以下命令运行测试:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="2272" class="mh mi iq md b gy mj mk l ml mm">npx nightwatch tests/e2e/HomePage.js --env firefox</span></pre><p id="0c33" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果需要，您可以使用另一个或多个浏览器。只要确保你已经安装了相应的驱动程序。</p><p id="c5c9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在Firefox、Chrome和Safari中并行运行测试。代码如下:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="f3df" class="mh mi iq md b gy mj mk l ml mm">npx nightwatch tests/e2e/HomePage.js --env firefox,chrome,safari</span></pre><h1 id="1fbd" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">步骤7——添加与GitHub动作的持续集成</h1><p id="82c6" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">我们差不多完成了。剩下的最后一件事是添加CI来自动运行针对下一个变更的测试。</p><p id="b337" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要做的是在<code class="fe nk nl nm md b">.github/workflows</code>目录下创建<code class="fe nk nl nm md b">main.yaml</code>文件，内容如下。</p><p id="b7ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用Xvfb在Github Actions工作流中运行Chrome中的测试。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="7ba5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们完了。GitHub Actions将对每个pull请求在三个独立的环境中运行测试。</p><h1 id="7b12" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">从这里去哪里</h1><p id="5319" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">如果你想深入研究，你可以去https://github.com/pineviewlabs/middlemarch-react的<a class="ae ln" href="https://github.com/pineviewlabs/middlemarch-react" rel="noopener ugc nofollow" target="_blank">探索代码或者克隆并在本地运行它。</a></p><p id="12e4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">也可以访问<a class="ae ln" href="https://middlemarch-react.netlify.app/" rel="noopener ugc nofollow" target="_blank">https://middle March-react . net lify . app</a>看看结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/0be51620cd2a0dd19491c85052806823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrReAkWrVYEPMPIBBrKvuQ.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">米德尔马契反应网络应用程序。</p></figure><h1 id="5e5a" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">获得支持</h1><h1 id="3d42" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">反应和受伤</h1><ul class=""><li id="c9fd" class="lo lp iq kt b ku nf kx ng la oh le oi li oj lm nx lu lv lw bi translated"><a class="ae ln" href="https://reactjs.org/community/support.html" rel="noopener ugc nofollow" target="_blank"> React社区</a></li><li id="88ef" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm nx lu lv lw bi translated"><a class="ae ln" href="https://github.com/molefrog/wouter/issues" rel="noopener ugc nofollow" target="_blank"> Wouter Github问题</a></li></ul><h1 id="336c" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">网络功能</h1><ul class=""><li id="aed5" class="lo lp iq kt b ku nf kx ng la oh le oi li oj lm nx lu lv lw bi translated"><a class="ae ln" href="https://docs.netlify.com/functions/overview/" rel="noopener ugc nofollow" target="_blank">网络功能文档</a></li><li id="b65a" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm nx lu lv lw bi translated"><a class="ae ln" href="https://answers.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify的社区论坛</a></li></ul><h1 id="c3e3" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">LowDB</h1><ul class=""><li id="24e4" class="lo lp iq kt b ku nf kx ng la oh le oi li oj lm nx lu lv lw bi translated"><a class="ae ln" href="https://github.com/typicode/lowdb/issues" rel="noopener ugc nofollow" target="_blank"> Lowdb Github问题</a></li></ul><h1 id="9cbf" class="mo mi iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">守夜人. js</h1><p id="4923" class="pw-post-body-paragraph kr ks iq kt b ku nf jr kw kx ng ju kz la nh lc ld le ni lg lh li nj lk ll lm ij bi translated">要获得与Nightwatch相关的一切支持，您可以访问以下渠道:</p><ul class=""><li id="d7fa" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm nx lu lv lw bi translated"><a class="ae ln" href="https://github.com/nightwatchjs/nightwatch" rel="noopener ugc nofollow" target="_blank"> GitHub讨论</a></li><li id="d47c" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm nx lu lv lw bi translated"><a class="ae ln" href="https://labs.pineview.io/build-test-and-deploy-an-app-react18-vite-netlify-nightwatch/Nightwatch.js%20chat%20server" rel="noopener ugc nofollow" target="_blank"> Nightwatch.js聊天服务器</a>上不和谐</li></ul></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><p id="46bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文原载于<a class="ae ln" href="https://labs.pineview.io/build-test-and-deploy-an-app-react18-vite-netlify-nightwatch/" rel="noopener ugc nofollow" target="_blank">https://labs . pineview . io</a>。</p></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><p id="e6d0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您阅读文章。我希望它能指导你完成整个开发周期，或者给你另一个视角，让你知道如何把事情做得更好。开心点，注意安全。</p></div></div>    
</body>
</html>