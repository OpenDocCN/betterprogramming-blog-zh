<html>
<head>
<title>GraphQL Data Fetching with Apollo Client in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中使用Apollo客户端获取GraphQL数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/fetching-data-from-a-graphql-api-in-react-ad003edc4e7b?source=collection_archive---------7-----------------------#2020-12-08">https://betterprogramming.pub/fetching-data-from-a-graphql-api-in-react-ad003edc4e7b?source=collection_archive---------7-----------------------#2020-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4fcd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">旅程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d273ce18d0be0b191b164235daca8a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FnXx4Br6Qm9vSMNk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢克·切瑟在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a359" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将通过一些例子来说明如何使用<a class="ae ky" href="https://www.apollographql.com/docs/react/" rel="noopener ugc nofollow" target="_blank"> Apollo客户端</a>状态管理库从React项目中的<a class="ae ky" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL API </a>获取和显示数据。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="808c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置</h1><p id="d2c7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在我们开始全面了解Apollo客户端之前，让我们先创建一个React项目，或者您可以使用下一个基础React项目，因为我们下面要探索的代码就是基于它的。</p><div class="mz na gp gr nb nc"><a href="https://github.com/drac94/react-ts-sb-sc-boilerplate" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">drac 94/react-ts-s b-sc-样板文件</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ks nc"/></div></div></a></div><p id="9c82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想了解关于这个基础项目的更多信息，请不要忘记查看我解释了包括哪些内容以及它如何帮助您简化项目的文章。</p><div class="mz na gp gr nb nc"><a href="https://medium.com/better-programming/7-things-every-react-project-should-start-with-21f7570a7a4b" rel="noopener follow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">每个React项目应该从7件事开始</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">从一开始就让您的项目变得简单</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">medium.com</p></div></div><div class="nl l"><div class="nr l nn no np nl nq ks nc"/></div></div></a></div><p id="49ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用下面的命令克隆它:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="ffe5" class="nx md it nt b gy ny nz l oa ob">git clone <a class="ae ky" href="https://github.com/drac94/react-ts-sb-sc-boilerplate.git" rel="noopener ugc nofollow" target="_blank">https://github.com/drac94/react-ts-sb-sc-boilerplate.git</a> react-graphql</span></pre><p id="c5dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如开始时提到的，为了能够连接到GraphQL API，我们将利用Apollo客户端库，它为我们提供了许多好处，如内存缓存、本地状态管理等。</p><p id="0df8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要安装这个库，我们需要在终端中运行下一个命令:</p><pre class="kj kk kl km gt ns nt nu nv aw nw bi"><span id="b412" class="nx md it nt b gy ny nz l oa ob">cd react-graphql<br/>yarn add <a class="ae ky" href="http://twitter.com/apollo/client" rel="noopener ugc nofollow" target="_blank">@apollo/client</a> graphql</span></pre><p id="a2d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完成后，我们就可以开始配置React项目了。</p><p id="ec01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们的例子，我们将使用<a class="ae ky" href="https://github.com/trevorblades/countries" rel="noopener ugc nofollow" target="_blank"> Countries GraphQL API </a>，它为我们提供了关于国家、大洲和语言的信息</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="12b5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">客户</h1><p id="259c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们的第一步是使用以下代码创建一个连接到API的客户端:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="67c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们做了什么？</p><ul class=""><li id="5010" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated"><strong class="lb iu">第1行</strong>:我们导入了设置应用程序所需的东西，包括客户端、缓存机制和提供者</li><li id="3294" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">第3-5行</strong>:我们创建了一个新的<code class="fe os ot ou nt b">ApolloClient</code>，将API的URL设置为<code class="fe os ot ou nt b">uri</code>参数和<code class="fe os ot ou nt b">cache</code>对象</li><li id="daa3" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">第10行</strong>:我们用<code class="fe os ot ou nt b">ApolloProvider</code>包装了我们的应用程序，我们将刚刚创建的<code class="fe os ot ou nt b">client</code>设置为初始值</li></ul><p id="36c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们的React项目就可以开始获取数据了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a768" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">这些疑问</h1><p id="84f7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">下一步是定义我们将用来获取所需数据的查询。为此，让我们创建一个新文件，我们将在其中定义特定视图所需的所有查询。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="8bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个查询将获取一个国家列表，列表中的每个国家对象都有一个<code class="fe os ot ou nt b">name</code>属性。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f78f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">景色</h1><p id="d965" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后，我们使用刚刚定义的查询获取视图中的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="b08d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里发生了什么？</p><ul class=""><li id="4634" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated"><strong class="lb iu">线3 </strong>:我们进口了<code class="fe os ot ou nt b"><a class="ae ky" href="https://www.apollographql.com/docs/react/data/queries/#executing-a-query" rel="noopener ugc nofollow" target="_blank">useQuery</a></code>挂钩</li><li id="5d35" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">第6行</strong>:我们导入了在<code class="fe os ot ou nt b">App.query.ts</code>中定义的查询</li><li id="0703" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">第13行</strong>:触发了<code class="fe os ot ou nt b">useQuery</code>钩子，查询通过</li></ul><p id="b474" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe os ot ou nt b">useQuery</code>钩子返回一个包含三个主要属性的对象——<code class="fe os ot ou nt b">loading</code>、<code class="fe os ot ou nt b">error</code>和<code class="fe os ot ou nt b">data</code>——我们将根据查询的状态使用它们来呈现不同的UI元素</p><ul class=""><li id="45bf" class="oe of it lb b lc ld lf lg li og lm oh lq oi lu oj ok ol om bi translated"><strong class="lb iu">第15行</strong>:如果<code class="fe os ot ou nt b">loading</code>为<code class="fe os ot ou nt b">true</code>，我们渲染一条<code class="fe os ot ou nt b">loading…</code>消息</li><li id="2db4" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">第16行</strong>:如果<code class="fe os ot ou nt b">loading</code>是<code class="fe os ot ou nt b">false</code>并且<code class="fe os ot ou nt b">error</code>不是未定义的，我们显示一条错误信息</li><li id="e9c8" class="oe of it lb b lc on lf oo li op lm oq lq or lu oj ok ol om bi translated"><strong class="lb iu">第17-28行</strong>:最后，如果<code class="fe os ot ou nt b">loading</code>为假，<code class="fe os ot ou nt b">error</code>未定义，并且<code class="fe os ot ou nt b">data</code>不为空或未定义，我们循环显示结果——在本例中是国家的名称</li></ul><p id="9fa7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在应该在浏览器中看到一个国家列表。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f4c0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">变量</h1><p id="aa52" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果我们需要向查询传递变量呢？假设我们想要获取某个特定国家的信息。</p><p id="8339" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从定义查询开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="0e74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们分析这个查询，我们可以看到现在我们正在传递一个名为<code class="fe os ot ou nt b">code</code>的变量。它的类型是<code class="fe os ot ou nt b">ID!</code>，这是一个强制<code class="fe os ot ou nt b">!</code>。</p><p id="49f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们称之为在我们看来。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="e8a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的关键部分在第16行，我们通过发送一个<code class="fe os ot ou nt b">variables</code>对象作为<code class="fe os ot ou nt b">useQuery</code>钩子的第二个参数来定义<code class="fe os ot ou nt b">code</code>变量的值。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c027" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">懒惰</h1><p id="9d57" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">前面的两个查询都是在视图呈现时执行的，但是有时我们会希望在用户做出动作时调用我们的API，比如单击按钮。这在Apollo客户端中也是可能的——我们只需要使用<code class="fe os ot ou nt b"><a class="ae ky" href="https://www.apollographql.com/docs/react/api/react/hooks/#uselazyquery" rel="noopener ugc nofollow" target="_blank">useLazyQuery</a></code>钩子而不是<code class="fe os ot ou nt b">useQuery</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="cdb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们再看看第16行，这里我们使用了<code class="fe os ot ou nt b">useLazyQuery</code>钩子，它返回一个数组，数组的第一项是一个函数，我们可以在需要的时候调用它来获取数据。</p><p id="6e28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一次我们获取数据，直到用户点击按钮，而不是在最初的渲染。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fa3c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="8548" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们看到，借助Apollo Client，只需很少的代码，我们就可以配置React项目，通过GraphQL API获取数据，但这只是冰山一角——我们还可以做更多的事情。我们还可以使用它进行突变，我们可以创建和使用本地查询和突变，我们可以跟踪网络状态或修改本地状态等。</p><p id="a383" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，我们有了一个完整的状态管理库，允许我们使用GraphQL，因此选项可能是无穷无尽的。感谢阅读。</p></div></div>    
</body>
</html>