<html>
<head>
<title>Building a React Components Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建React组件库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-react-components-library-6a05c2bca538?source=collection_archive---------7-----------------------#2019-08-19">https://betterprogramming.pub/building-a-react-components-library-6a05c2bca538?source=collection_archive---------7-----------------------#2019-08-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e212" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">第2部分—测试组件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f7a33fa229b367d61c321d88c7fe7afd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-pK5gQ89kMnzGLgmNhvFrw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">笑话和反应测试库</p></figure><p id="1dca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是本系列的第二部分。在<a class="ae lu" href="https://medium.com/@tomasz.fiechowski/building-a-react-components-library-f5a390d5973d" rel="noopener">第一部分</a>中，我们构建了库的框架，设置了开发环境，并添加了第一个基本组件。没有测试就没有好的库，现在就来添加吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b318" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试库</h1><p id="a75f" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">为了测试我们的组件，我们将使用<a class="ae lu" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>和<a class="ae lu" href="https://github.com/testing-library/react-testing-library" rel="noopener ugc nofollow" target="_blank"> React测试库</a>。</p><p id="8c7e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们安装它们:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c1f3" class="ne md it na b gy nf ng l nh ni">npm install --save-dev @testing-library/react jest</span></pre><p id="e5da" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，将<code class="fe nj nk nl na b">"test": "jest"</code>脚本添加到<code class="fe nj nk nl na b">package.json</code>中，这样我们可以轻松地运行测试。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0350" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">基本测试</h1><p id="fe29" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">编写一个简单的基本测试不需要任何配置。默认情况下，扩展名为<code class="fe nj nk nl na b">*.test.js</code>的文件被认为是测试套件。</p><p id="b71e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们直接开始创建一个测试文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/components/按钮. test.js</p></figure><p id="7d49" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个简单的测试中，我们检查传递给<code class="fe nj nk nl na b">Button</code>的文本是否被呈现。</p><p id="ea56" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果没有找到期望的文本，<code class="fe nj nk nl na b">getByText</code>函数将抛出一个错误，从而使测试用例失败。这种情况下我们不需要任何<code class="fe nj nk nl na b">expect</code>。</p><p id="94e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们第一次进行测试。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0d2f" class="ne md it na b gy nf ng l nh ni">$ npm test</span><span id="f70f" class="ne md it na b gy no ng l nh ni">PASS  src/components/Button.test.js<br/>  Button<br/>    ✓ should display text (23ms)</span><span id="1e2c" class="ne md it na b gy no ng l nh ni">Test Suites: 1 passed, 1 total<br/>Tests:       1 passed, 1 total<br/>Snapshots:   0 total<br/>Time:        1.945s<br/>Ran all test suites.</span></pre><p id="6d2d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">是的，测试通过了！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="759b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">与组件交互</h1><p id="dde3" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们编写的第一个测试非常简单。现在让我们与组件进行一些交互！</p><p id="d54a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们做一些测试驱动的开发，并在使<code class="fe nj nk nl na b">Button</code>真正可点击之前编写测试:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/components/按钮. test.js</p></figure><p id="3aa3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里发生了什么？首先，我们创建了<code class="fe nj nk nl na b">onClickMock</code> Jest mock函数，并将其作为<code class="fe nj nk nl na b">onClick</code> prop传递给<code class="fe nj nk nl na b">Button</code>。我们稍后将检查它是否被真正调用。</p><p id="96f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与第一个测试相反，我们不能直接使用从<code class="fe nj nk nl na b">render</code>函数返回的<code class="fe nj nk nl na b">container</code>。<a class="ae lu" href="https://testing-library.com/docs/react-testing-library/api#container" rel="noopener ugc nofollow" target="_blank">顾名思义，它只包含我们的组件</a>。</p><p id="6207" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们从<code class="fe nj nk nl na b">container.firstChild</code>获得它，然后使用<code class="fe nj nk nl na b">fireEvent</code>来模拟组件上的点击。</p><p id="4288" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们检查是否真正调用了<code class="fe nj nk nl na b">onClickMock</code>函数。如果是，这意味着我们的<code class="fe nj nk nl na b">Button</code>组件响应点击事件。</p><p id="6f81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在让我们检查测试的输出:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="bf66" class="ne md it na b gy nf ng l nh ni">● Button › should handle click events</span><span id="b571" class="ne md it na b gy no ng l nh ni">  expect(jest.fn()).toBeCalled()</span><span id="4776" class="ne md it na b gy no ng l nh ni">  Expected mock function to have been called, but it was not called.</span></pre><p id="20a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不出所料，测试现在失败了。</p><p id="958a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">是时候修复<code class="fe nj nk nl na b">Button</code>并使其可点击了。系好安全带，前方极限编程。</p><p id="7539" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们用一个疯狂的<code class="fe nj nk nl na b">onClick</code>处理程序来扩展我们的按钮:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/components/Button.js</p></figure><p id="eafa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">重新运行测试:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="76bd" class="ne md it na b gy nf ng l nh ni">$ npm test</span><span id="47e6" class="ne md it na b gy no ng l nh ni">PASS  src/components/Button.test.js<br/>  Button<br/>    ✓ should display text (25ms)<br/>    ✓ should handle click events (9ms)</span><span id="2858" class="ne md it na b gy no ng l nh ni">Test Suites: 1 passed, 1 total<br/>Tests:       2 passed, 2 total<br/>Snapshots:   0 total<br/>Time:        1.212s<br/>Ran all test suites.</span></pre><p id="da81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">绿色！TDD为了胜利！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2f57" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试样式规则</h1><p id="de99" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在某些情况下，我们可能希望检查给定的组件是否应用了正确的CSS规则。为了方便和易用，我们将安装暴露<code class="fe nj nk nl na b">toHaveStyleRule</code>助手<a class="ae lu" href="https://jestjs.io/docs/en/using-matchers" rel="noopener ugc nofollow" target="_blank">匹配器</a>的<code class="fe nj nk nl na b">jest-emotion</code>插件。</p><p id="5598" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们用<code class="fe nj nk nl na b">npm install --save-dev jest-emotion</code>安装它并创建两个配置文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/setupTests.js</p></figure><p id="7af9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这使得<code class="fe nj nk nl na b">toHaveStyleRule</code>在每次测试中都可以在全球范围内使用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">jest.config.js</p></figure><p id="bf10" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二个将Jest指向测试环境设置后需要运行的设置文件(基本上，当<code class="fe nj nk nl na b">expect</code>可用时)。</p><p id="759f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">配置Jest后，让我们向按钮测试添加一个测试:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/components/按钮. test.js</p></figure><p id="b1af" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们通过查找给定的文本并检查它的<code class="fe nj nk nl na b">text-transform</code> CSS属性是否有合适的值来获取组件。</p><p id="26ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行测试:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b3b0" class="ne md it na b gy nf ng l nh ni">$ npm test          <br/>                 <br/> PASS  src/components/Button.test.js<br/>  Button<br/>    ✓ should display text (25ms)<br/>    ✓ should handle click events (8ms)<br/>    ✓ should make text uppercase (5ms)</span><span id="8079" class="ne md it na b gy no ng l nh ni">Test Suites: 1 passed, 1 total<br/>Tests:       3 passed, 3 total<br/>Snapshots:   0 total<br/>Time:        2.045s<br/>Ran all test suites.</span></pre><p id="743a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完美！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1a7c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="a3d7" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我们将测试库添加到我们的项目中，并使用它们为<code class="fe nj nk nl na b">Button</code>组件编写几个测试。</p><p id="3e89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们检查了<code class="fe nj nk nl na b">Button</code>是否被正确渲染，以及它是否可点击。最后，我们添加了<code class="fe nj nk nl na b">toHaveStyleRule</code>助手来轻松检查CSS规则，并使用它来检查<code class="fe nj nk nl na b">Button</code>是否使文本大写。</p><p id="b2d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">干得好！这部分到此为止！</p><p id="d11b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完整的代码可以在<a class="ae lu" href="https://github.com/tfiechowski/react-sample-components-library" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>中找到。您可以查看<code class="fe nj nk nl na b">part2</code>标签(<code class="fe nj nk nl na b">git checkout part2</code>)来查看本部分的完整示例。</p><h1 id="a368" class="mc md it bd me mf np mh mi mj nq ml mm jz nr ka mo kc ns kd mq kf nt kg ms mt bi translated">下一个</h1><p id="76e4" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">在接下来的部分中，我们将把这个库发布到<a class="ae lu" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>中，然后将文档的自动部署添加到GitHub页面中。</p><p id="15c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关于出版图书馆的部分可以在这里找到。</p></div></div>    
</body>
</html>