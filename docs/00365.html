<html>
<head>
<title>Spring Security — Redirect Based on User Roles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Security —基于用户角色的重定向</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/spring-security-redirect-based-on-user-roles-cb847ab6df35?source=collection_archive---------0-----------------------#2019-05-03">https://betterprogramming.pub/spring-security-redirect-based-on-user-roles-cb847ab6df35?source=collection_archive---------0-----------------------#2019-05-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="831d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">基于spring用户角色将用户定向到页面</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c96896770fb25c199471492fa4a42e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*edT4cNGhUTXQXdvP"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚历山大·席默克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6aa9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，我们已经构建了一个基本的spring boot应用程序，启用了spring安全性，并创建了一个基本的登录表单。在上一课中，我们对第一课进行了扩展，添加了不同的用户角色，并根据这些角色显示和隐藏前端内容<a class="ae ky" href="https://mwhyte.dev/spring-security-user-roles-and-thymeleaf-extras-c10113d4ad75" rel="noopener ugc nofollow" target="_blank">(用户角色和百里香附加)。</a></p><p id="19d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我们将了解在不同角色的用户登录后，如何将他们重定向到不同的页面。</p><h1 id="662b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Admin.html</h1><p id="c4c8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在前面例子的基础上，我们现在创建了一个名为<code class="fe ms mt mu mv b">admin.html</code>的新HTML文件。当管理员用户登录时，我们会将他们重定向到这个新页面。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/3.redirect-based-on-role" rel="noopener ugc nofollow" target="_blank">源代码</a></p></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="48fa" class="lv lw it bd lx ly nf ma mb mc ng me mf jz nh ka mh kc ni kd mj kf nj kg ml mm bi translated">MvcConfig</h1><p id="551b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">现在，为了提供新的<code class="fe ms mt mu mv b">admin.html</code>页面，我们必须将这个页面添加到我们的<code class="fe ms mt mu mv b">MvcConfig</code>类中。</p><p id="6790" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和前面的例子一样，这是通过创建一个类、扩展<code class="fe ms mt mu mv b">WebMvcConfigurerAdapter</code>和覆盖<code class="fe ms mt mu mv b">addViewControllers</code>方法来实现的。这次添加了我们应用程序的所有早期页面和新的管理页面:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/3.redirect-based-on-role" rel="noopener ugc nofollow" target="_blank">源代码</a></p></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="0a38" class="lv lw it bd lx ly nf ma mb mc ng me mf jz nh ka mh kc ni kd mj kf nj kg ml mm bi translated">WebSecurityConfig</h1><p id="7bd7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu">建造师</strong></p><p id="75ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">决定当不同的用户角色登录时做什么。我们已经创建了一个类型为<code class="fe ms mt mu mv b">AuthenticationSuccessHandler</code>的新字段。我们通过构造函数注入来设置这个新的配置bean。</p><p id="35c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">配置方法</strong></p><p id="ee6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个方法负责显式地覆盖和配置<code class="fe ms mt mu mv b">HttpSecurity</code>。从上一个例子中，我们添加了两行。</p><p id="5d83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们在<code class="fe ms mt mu mv b">authorizeRequests</code>部分下添加了一个新的antMatcher，我们告诉spring security只允许拥有<code class="fe ms mt mu mv b">"ADMIN”</code>角色的用户访问所有以<code class="fe ms mt mu mv b">“/admin”</code>开始的端点:</p><pre class="kj kk kl km gt nk mv nl nm aw nn bi"><span id="c970" class="no lw it mv b gy np nq l nr ns">.antMatchers("/admin").hasRole("ADMIN")</span></pre><p id="bf4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其次，我们在<code class="fe ms mt mu mv b">formLogin</code>部分下添加了我们的<code class="fe ms mt mu mv b">CustomAuthenticationSuccessHandler</code>,告诉spring security询问这个<code class="fe ms mt mu mv b">CustomAuthenticationSuccessHandler</code>在成功登录时该做什么:</p><pre class="kj kk kl km gt nk mv nl nm aw nn bi"><span id="8838" class="no lw it mv b gy np nq l nr ns">.successHandler(authenticationSuccessHandler)</span></pre><h2 id="6756" class="no lw it bd lx nt nu dn mb nv nw dp mf li nx ny mh lm nz oa mj lq ob oc ml od bi translated"><strong class="ak">配置全局方法</strong></h2><p id="4542" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><code class="fe ms mt mu mv b">configureGlobal</code>方法是我们的用户内存注册表。我们添加了两个用户。一个扮演主要的<code class="fe ms mt mu mv b">USER</code>角色，另一个扮演<code class="fe ms mt mu mv b">ADMIN</code>角色。</p><p id="b97b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/3.redirect-based-on-role" rel="noopener ugc nofollow" target="_blank">源代码</a></p></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="3668" class="lv lw it bd lx ly nf ma mb mc ng me mf jz nh ka mh kc ni kd mj kf nj kg ml mm bi translated">customauthenticationsuccesshandle</h1><p id="07ef" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">正如您在下面的示例代码中看到的，这个类实现了springs <code class="fe ms mt mu mv b">AuthenticationSuccessHandler</code>类并覆盖了<code class="fe ms mt mu mv b">onAuthenticationSuccess</code>方法。</p><p id="d6c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦用户成功登录，就会调用<code class="fe ms mt mu mv b">onAuthenticationSuccess</code>，并检查用户的角色。如果用户的角色是<code class="fe ms mt mu mv b">admin</code>，我们重定向到<code class="fe ms mt mu mv b">/admin</code> HTTP端点；否则，我们将它们重定向到<code class="fe ms mt mu mv b">/index</code>端点。</p><p id="41fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此时，我们的<code class="fe ms mt mu mv b">MvcConfig</code>接管并基于我们之前创建的viewController提供正确的HTML页面。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/3.redirect-based-on-role" rel="noopener ugc nofollow" target="_blank">源代码</a></p></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="74b8" class="lv lw it bd lx ly nf ma mb mc ng me mf jz nh ka mh kc ni kd mj kf nj kg ml mm bi translated">演示</h1><p id="f14c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">检查<a class="ae ky" href="https://github.com/mwhyte-dev/spring-security/tree/3.redirect-based-on-role" rel="noopener ugc nofollow" target="_blank">出源代码</a>，打开应用类，右键运行演示。</p><p id="f504" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要开始这个示例，您的机器上需要有端口8080。如果不是，您可以使用以下命令在application.properties文件中更改此默认值:</p><pre class="kj kk kl km gt nk mv nl nm aw nn bi"><span id="fa7e" class="no lw it mv b gy np nq l nr ns">server.port=8081</span></pre><p id="ccf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将它设置为您想要的任何值。</p><p id="f1a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以观看这个短片:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe mx l"/></div></figure></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="8b05" class="lv lw it bd lx ly nf ma mb mc ng me mf jz nh ka mh kc ni kd mj kf nj kg ml mm bi translated">单元测试</h1><p id="8f16" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">与往常一样，我们修改并添加了一些额外的测试来涵盖新功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="df80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们正在使用的Spring测试支持的快速回顾:</p><ul class=""><li id="0050" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu ok ol om on bi translated"><code class="fe ms mt mu mv b">@ExtendWith(SpringExtension.class)</code> —告诉JUnit5在Spring的测试支持下运行单元测试</li><li id="dd48" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated"><code class="fe ms mt mu mv b">@SpringBootTest </code> —作为spring boot app运行。即装载<code class="fe ms mt mu mv b">application.properties</code>和弹簧豆</li><li id="a3c2" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated"><code class="fe ms mt mu mv b">@AutoConfigureMockMvc </code> —创建一个名为MockMvc的测试助手类。我们可以模拟一个前端客户端从这里向服务器发出请求。</li><li id="22e0" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated"><code class="fe ms mt mu mv b">@WithMockUser </code> —提供模拟某些用户的能力，在我们的例子中是经过身份验证的用户。</li><li id="b6fa" class="of og it lb b lc oo lf op li oq lm or lq os lu ok ol om on bi translated"><code class="fe ms mt mu mv b">FormLoginRequestBuilder </code> —允许我们创建基于表单的登录请求的实用程序类。</li></ul></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><p id="bf74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将讨论spring security的跨站点请求伪造(CSRF)保护。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><p id="569d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不是中等会员？支持我成为其中一员:</p><div class="ot ou gp gr ov ow"><a href="https://mwhyte.dev/membership" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">通过我的推荐链接加入Medium迈克尔威特</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">mwhyte.dev</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk ks ow"/></div></div></a></div></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="6588" class="lv lw it bd lx ly nf ma mb mc ng me mf jz nh ka mh kc ni kd mj kf nj kg ml mm bi translated">资源</h1><div class="ot ou gp gr ov ow"><a href="https://github.com/mwhyte-dev/spring-security/tree/3.redirect-based-on-role" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">GitHub-mwhyte-dev/spring-security at 3 . redirect-based-on-role</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">github.com</p></div></div><div class="pf l"><div class="pl l ph pi pj pf pk ks ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a rel="noopener  ugc nofollow" target="_blank" href="/spring-security-basic-login-form-7c8f6e6e9f56"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">用Spring Security、百里香和Java构建一个基本的登录表单</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">简化登录表单</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">better编程. pub</p></div></div><div class="pf l"><div class="pm l ph pi pj pf pk ks ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a rel="noopener  ugc nofollow" target="_blank" href="/spring-security-user-roles-and-thymeleaf-extras-c10113d4ad75"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">Spring Security —用户角色和百里香附加功能</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">基于spring用户角色显示和隐藏内容</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">better编程. pub</p></div></div><div class="pf l"><div class="pn l ph pi pj pf pk ks ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://spring.io/projects/spring-security" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">春天安全</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">提高您的Java代码水平，探索Spring能为您做什么。</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">spring.io</p></div></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://www.thymeleaf.org/doc/articles/springsecurity.html" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">百里香+ Spring安全集成基础</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">你是否已经切换到百里香，但你的登录和错误页面仍然使用JSP？在本文中，我们将了解如何…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">www.thymeleaf.org</p></div></div><div class="pf l"><div class="po l ph pi pj pf pk ks ow"/></div></div></a></div></div></div>    
</body>
</html>