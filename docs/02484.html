<html>
<head>
<title>How To Create a Simple Store in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular中创建一个简单的商店</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-simple-store-in-angular-577a8f21a3d6?source=collection_archive---------7-----------------------#2019-12-03">https://betterprogramming.pub/how-to-create-a-simple-store-in-angular-577a8f21a3d6?source=collection_archive---------7-----------------------#2019-12-03</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="50cf" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">用单一的事实来源增强你的应用</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/4c8dfa814c9ebcdc78137aaa25322ff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S8fiIJgsUlnXMNvvzjCPTA.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">大卫·巴图斯在pexels.com拍摄的照片</p></figure><p id="1245" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">创建应用程序时，我必须面对的最大挑战之一是确保它不会在互联网中断的情况下崩溃。</p><p id="ff67" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这主要可以通过某种本地应用存储将API调用减少到最小来实现。在这些情况下，重要的是要有一个保存所有主要设置和数据的地方。</p><p id="5cbf" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">应用程序的这一部分被称为<em class="lv">商店</em>，作为单一的事实来源，允许我们独立于API调用，并在组件之间有更好的数据流。</p><p id="a6ed" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在本文中，我们将使用我最喜欢的Angular状态管理库<a class="ae lw" href="https://www.ngxs.io/" rel="noopener ugc nofollow" target="_blank"> NGXS </a>构建一个简单的存储。我将在文章末尾链接到示例的完整代码。</p></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="5604" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">第一步。安装软件包</h1><p id="519d" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">为了拥有创建商店所需的所有模块，我们需要安装软件包:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">安装NGXS软件包的npm脚本</p></figure><p id="b780" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">要安装的第一个包是基本的NGXS商店库，但我认为第二个包是开发的基础。</p><p id="8ada" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">正如我们将在后面看到的，<em class="lv"/><a class="ae lw" href="https://www.npmjs.com/package/@ngxs/devtools-plugin" rel="noopener ugc nofollow" target="_blank">dev tools-plugin</a>，连同<a class="ae lw" href="http://extension.remotedev.io/" rel="noopener ugc nofollow" target="_blank"> Redux DevTools扩展</a>，将允许我们从浏览器实时调试商店。</p><p id="1992" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">然后，我们可以将下载的NGXS模块包含在我们的应用程序模块中，指定我们将它们作为单例注入应用程序根:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">在app.module中注入NGXS模块</p></figure></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="c6e2" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">第二步。创建列表状态</h1><p id="9b0f" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">我们将要创建的状态将存储一个简单的待办事项列表。我们将能够添加新元素以及删除旧元素。</p><p id="d8fc" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们将开始为我们的<code class="fe nd ne nf ng b">ListState</code> <em class="lv">，</em>定义一个模型，其中我们将声明状态必须有两个属性:一个表示我们的待办事项列表的项目数组和一个存储我们添加到列表中的最后一个元素的变量。</p><p id="7d0d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">此外，我们将定义一组缺省值，用这些值来初始化状态。在这种情况下，我们将为列表使用一个空数组，并将<code class="fe nd ne nf ng b">null</code>作为最后添加的项的值:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">ListStateModel和默认值。</p></figure><p id="51c2" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们现在可以通过将新创建的状态添加到<code class="fe nd ne nf ng b">app.module</code>的导入中的<code class="fe nd ne nf ng b">NgXsModule.forRoot</code>方法来激活它:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">状态注入</p></figure><p id="31c0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果我们为应用程序提供服务，然后打开Redux DevTools扩展，我们应该能够看到应用程序的初始状态已经设置为默认值。</p><p id="71ef" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">此外，左侧的列将在每次向存储分派操作时记录一条消息，也就是说，每次我们请求存储更新它包含的值时记录一条消息。</p><p id="9785" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在这种情况下，消息<code class="fe nd ne nf ng b">@@INIT</code>告诉我们状态已经成功初始化。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nh"><img src="../Images/c630ffd1c12c42bf433fce4945ef7c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*icJJ7C6EiX8uWUfkIlQyCQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Chrome中的Redux DevTools扩展</p></figure></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="2dce" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">第三步。添加更新状态的操作</h1><p id="ad1a" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">在这一点上，我们需要工作的方法将允许我们通过改变我们的状态来编辑我们的待办事项列表。</p><p id="5878" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们可以从创建一个<code class="fe nd ne nf ng b">list.actions.ts</code>文件开始，在这个文件中，我们将定义当一个特定的动作被分派时我们将看到的消息，以及它将采用的有效负载的类型。动作的有效负载就是我们想要用来编辑状态的数据。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">列表状态的操作</p></figure><p id="0ed7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在这种情况下，动作<code class="fe nd ne nf ng b">AddListItem</code>将拥有一个包含要添加到列表中的新项目的字符串作为有效负载。同样，<code class="fe nd ne nf ng b">DeleteListItem</code>将拥有一个包含要删除的项目的字符串作为有效负载。</p><p id="665e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">下一步是声明链接到<code class="fe nd ne nf ng b">list.tate.ts</code>中的动作的方法。方法<code class="fe nd ne nf ng b">addListItem</code>将获取当前状态，然后将有效载荷添加到<code class="fe nd ne nf ng b">list</code>数组中。</p><p id="c941" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">方法<code class="fe nd ne nf ng b">removeListItem</code> <em class="lv"> </em>将获取当前状态，并过滤<code class="fe nd ne nf ng b">list</code> <em class="lv"> </em>以创建一个新数组，其中不包含要删除的项。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">下面声明的操作方法</p></figure><p id="e10a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们还声明了一个名为<code class="fe nd ne nf ng b">SelectAllItems</code> <em class="lv">，</em>的方法，它是一个状态选择器，允许我们在应用<em class="lv">的任何地方订阅<code class="fe nd ne nf ng b">list</code> <em class="lv"> </em>。</em></p></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="9007" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">第四步。调度操作</h1><p id="ab4b" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">此时，一切都处于准备使用状态。在我的例子中，我在登录页面上设置了一个输入字段来输入我的新待办事项。我也有一个“添加项目”按钮和一个“查看列表”按钮，将路由到列表视图。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ni"><img src="../Images/e64431372c3421bda014386f800d1c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJLJ5fUilER5wHBoykwUuQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">登录页面上的输入字段</p></figure><p id="2b2a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在<code class="fe nd ne nf ng b">list-input.component</code>中，要使用状态，我们需要在构造函数中初始化它。然后，我们可以调用商店的方法<code class="fe nd ne nf ng b">dispatch</code>来调度一个动作:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">从list-input.component调度操作</p></figure><p id="b9d0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们还可以使用Redux DevTools查看商店更新。事实上，如果我们在输入框中输入<em class="lv">购买面包</em>并点击<em class="lv">添加项目</em>，我们将会看到当<code class="fe nd ne nf ng b">[List] Add List Item</code> <em class="lv"> </em>动作被分派时，该项目被添加到我们的商店待办事项列表中。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nj"><img src="../Images/c8f11ddc7eabd2a48cd396a7f23fa88a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MbHXDXvZBAx4bBVBsXhLQA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Redux DevTools中的调度操作</p></figure></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="447c" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">第五步。从状态中读取值</h1><p id="332e" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">NGXS还使得从应用程序的任何组件中读取存储值变得很容易。</p><p id="ed18" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">让我们假设我们已经在我们的列表中添加了三四个待办事项，我们希望最终在另一条路线中可视化它。我们可以实例化状态，并使用一个<code class="fe nd ne nf ng b">Select</code> <em class="lv"> </em>语句来获得我们的列表的可观察值。</p><p id="7684" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">不订阅可观察对象，我们可以简单地通过HTML中的<code class="fe nd ne nf ng b">async</code> <em class="lv"> </em>管道读取它的值。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">从商店中选择列表作为可观察对象</p></figure><p id="7bbd" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">呈现后，我们将能够看到从商店中抓取的列表并与之交互:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nk"><img src="../Images/f313b429527a2712b8efa0e9721e83f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tTrFR7a4e2Do_TmnaGUEzA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">异步管道魔法！</p></figure></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><h1 id="4dc6" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated"><strong class="ak">结论</strong></h1><p id="9723" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">在本文中，我们看到了如何从头开始创建一个简单的NGXS商店。</p><p id="e4da" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这是一个用状态管理库可以实现的小例子。很明显，你可以用NGXS做更多的事情来改进你的应用程序，我建议你看看官方的<a class="ae lw" href="https://www.ngxs.io/" rel="noopener ugc nofollow" target="_blank">文档</a>来获得一些惊人的提示和技巧！</p><p id="a2ad" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">此外，检查我在GitHub上的<a class="ae lw" href="https://github.com/alessiaAmitrano/ngxsDemo" rel="noopener ugc nofollow" target="_blank"> NGXS演示</a> repo，让这段代码在你的PC上运行！</p><p id="718a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">希望有用！</p></div><div class="ab cl lx ly hy lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu nl"><a href="https://medium.com/better-programming/how-i-got-rid-of-state-observables-in-angular-2c69cbbbbd0e" rel="noopener follow" target="_blank"><div class="nm ab fp"><div class="nn ab no cl cj np"><h2 class="bd iv gz z fq nq fs ft nr fv fx it bi translated">我是如何在Angular中消除状态可观测量的</h2><div class="ns l"><h3 class="bd b gz z fq nq fs ft nr fv fx dk translated">我不会回去的</h3></div><div class="nt l"><p class="bd b dl z fq nq fs ft nr fv fx dk translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz kt nl"/></div></div></a></div><div class="oa ob gq gs oc nl"><a href="https://medium.com/better-programming/a-new-way-of-dispatching-actions-with-ngxs-for-angular-7541f0adb812" rel="noopener follow" target="_blank"><div class="nm ab fp"><div class="nn ab no cl cj np"><h2 class="bd iv gz z fq nq fs ft nr fv fx it bi translated">一种利用Ngxs为Angular调度动作的新方法</h2><div class="ns l"><h3 class="bd b gz z fq nq fs ft nr fv fx dk translated">用这个新的库整理你的代码</h3></div><div class="nt l"><p class="bd b dl z fq nq fs ft nr fv fx dk translated">medium.com</p></div></div><div class="nu l"><div class="od l nw nx ny nu nz kt nl"/></div></div></a></div></div></div>    
</body>
</html>