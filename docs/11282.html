<html>
<head>
<title>Build Your Own useTranslation Hook With Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Next.js构建自己的useTranslation挂钩</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-your-own-usetranslation-hook-with-next-js-2c65017d323a?source=collection_archive---------8-----------------------#2022-03-05">https://betterprogramming.pub/build-your-own-usetranslation-hook-with-next-js-2c65017d323a?source=collection_archive---------8-----------------------#2022-03-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2af4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这就是我如何建立我的网站</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c133af678247c136eba1e806ab590903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TFTVijx3KXdFuPYMWksrWQ.jpeg"/></div></div></figure><p id="7240" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你曾经做过React应用程序的本地化工作，那么你可能知道<a class="ae ln" href="https://react.i18next.com/" rel="noopener ugc nofollow" target="_blank"> react-18next </a>这是解决这类问题的标准方法。</p><p id="0049" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一方面，对于Next.js，我们可以使用具有类似概念的<a class="ae ln" href="https://github.com/vinissimus/next-translate" rel="noopener ugc nofollow" target="_blank"> next-translate </a>。我在建立自己的网站时发现了这个库，因为我想支持意大利语和英语，所以我必须了解这个库是如何工作的，但是在阅读文档时，我认为像我这样的小网站使用这样一个复杂的库是多余的。</p><p id="72a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为什么不开发我自己的<code class="fe lo lp lq lr b">useTranslation</code>钩子，只使用一堆JSON文件来存储翻译呢？我就是这样建立我的网站的。</p><p id="254e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我解释一下我是怎么做的，这比你想象的要简单。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="d864" class="lz ma iq bd mb mc md dn me mf mg dp mh la mi mj mk le ml mm mn li mo mp mq mr bi translated">在Next.js中添加本地化</h2><p id="549c" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">首先，我们需要添加我们想要支持的语言环境。在本例中，我将为意大利语和英语添加国际化，并将英语设置为用户访问网站时的默认语言。</p><p id="ba02" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是预期的行为:</p><ul class=""><li id="9c60" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated">英语翻译</li><li id="16af" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><code class="fe lo lp lq lr b">mywebsite.com/en</code> = &gt;英文翻译</li><li id="d267" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><code class="fe lo lp lq lr b">mywebsite.com/it</code> = &gt;意大利语翻译</li></ul><p id="269f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在Next.js中，我们有一个<code class="fe lo lp lq lr b">next.config.js</code>文件，应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="3da6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，有了<code class="fe lo lp lq lr b">it</code>和<code class="fe lo lp lq lr b">en</code>地区，它就变成了</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="d20e" class="lz ma iq bd mb mc md dn me mf mg dp mh la mi mj mk le ml mm mn li mo mp mq mr bi translated">准备翻译</h2><p id="c3a8" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">下一步，让我们为要在网站上展示的文本写翻译。</p><p id="ccab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在路径<code class="fe lo lp lq lr b">public/static/locales</code>中创建两个文件:<code class="fe lo lp lq lr b">it.js</code>和<code class="fe lo lp lq lr b">en.js</code></p><pre class="kg kh ki kj gt nn lr no np aw nq bi"><span id="8793" class="lz ma iq lr b gy nr ns l nt nu">pages/<br/>public/<br/>├─ static/<br/>│  ├─ locales/<br/>│  │  ├─ it.js<br/>│  │  ├─ en.js<br/>next.config.js/<br/>....</span></pre><p id="0f60" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如您所猜测的，<code class="fe lo lp lq lr b">it.js</code>文件将包含所有意大利语翻译和<code class="fe lo lp lq lr b">en.js</code>英语翻译。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="652c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当然，如果您只有文本字符串，您可以使用JSON文件而不是Javascript来存储翻译。在我的例子中，我使用Javascript文件来更好地控制数据，您将在最后一节中读到更多相关内容。</p><h2 id="d1aa" class="lz ma iq bd mb mc md dn me mf mg dp mh la mi mj mk le ml mm mn li mo mp mq mr bi translated">创建useTranslation挂钩</h2><p id="7723" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">现在是时候创建我们的自定义React钩子来使用这些翻译了。在项目和文件<code class="fe lo lp lq lr b">useTranslation.jsx</code>的根目录下创建<code class="fe lo lp lq lr b">hooks</code>文件夹</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="ee2e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">仅此而已，这是本教程中你将看到的最难的部分！如果你已经用过React钩子，你就已经知道是怎么回事了，否则，让我来解释一下。</p><p id="929c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如您所见，我们正在导入意大利语和英语翻译文件，并将它们存储到<code class="fe lo lp lq lr b">TRANSLATIONS</code>常量中。</p><pre class="kg kh ki kj gt nn lr no np aw nq bi"><span id="2ee4" class="lz ma iq lr b gy nr ns l nt nu">import en from "../public/static/locales/en";<br/>import it from "../public/static/locales/it";<br/><br/>const TRANSLATIONS = { en, it };</span></pre><p id="e7f4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要检测用户的当前地区，为此我们使用从<code class="fe lo lp lq lr b">next/router</code>导入的Next.js路由器。<code class="fe lo lp lq lr b">locale</code>常量包含当前的区域设置，可以是<code class="fe lo lp lq lr b">it</code>或<code class="fe lo lp lq lr b">en</code>。</p><pre class="kg kh ki kj gt nn lr no np aw nq bi"><span id="df33" class="lz ma iq lr b gy nr ns l nt nu">const router = useRouter();<br/>const { locale, asPath } = router;</span></pre><p id="7f78" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">函数<code class="fe lo lp lq lr b">setLocale</code>只是通过使用Next.js路由器改变URL的区域设置，这意味着<code class="fe lo lp lq lr b">setLocale("it")</code>将用户导航到<code class="fe lo lp lq lr b">mywebsite.com/it</code>并将所有网站切换到意大利语。</p><pre class="kg kh ki kj gt nn lr no np aw nq bi"><span id="db82" class="lz ma iq lr b gy nr ns l nt nu">const setLocale = (locale) =&gt; router.push(asPath, asPath, { locale });</span></pre><p id="0f28" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在这个<code class="fe lo lp lq lr b">useTranslation</code>钩子的核心思想是<code class="fe lo lp lq lr b">t</code>函数:它接收一个键，并使用该键和当前的区域设置访问<code class="fe lo lp lq lr b">TRANSLATIONS</code>对象。</p><pre class="kg kh ki kj gt nn lr no np aw nq bi"><span id="aba2" class="lz ma iq lr b gy nr ns l nt nu">const t = (keyString) =&gt; TRANSLATIONS[locale][keyString];</span></pre><p id="77db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，如果当前区域设置是<code class="fe lo lp lq lr b">en</code>并且我们传递了键<code class="fe lo lp lq lr b">WELCOME_MSG</code>，它将访问存储在<code class="fe lo lp lq lr b">TRANSLATIONS[en][WELCOME_MSG]</code>中的值，该值等于<code class="fe lo lp lq lr b">"Welcome to my website!"</code></p><h2 id="58ec" class="lz ma iq bd mb mc md dn me mf mg dp mh la mi mj mk le ml mm mn li mo mp mq mr bi translated">如何使用钩子</h2><p id="a244" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">最后，要显示<code class="fe lo lp lq lr b">WELCOME_MSG</code>文本，我们可以写:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="b07d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果用户更改了网站的本地化，此文本将自动刷新以显示正确的字符串。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="8840" class="lz ma iq bd mb mc md dn me mf mg dp mh la mi mj mk le ml mm mn li mo mp mq mr bi translated">最佳化</h2><p id="b261" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">还有一些优化的空间，例如我们可以使用React <code class="fe lo lp lq lr b">useCallback</code> hook来包装内部的useTranslation函数，这样如果没有任何变化，它们就不会重新呈现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="b5b3" class="lz ma iq bd mb mc md dn me mf mg dp mh la mi mj mk le ml mm mn li mo mp mq mr bi translated">高级用例</h2><p id="5da7" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">正如我已经提到的，我选择使用Javascript文件来存储所有的翻译，以便对数据有更多的控制。你可能在想“为什么？只是文字！”</p><p id="fa32" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">嗯，在我的情况下，我需要根据当前用户的本地化显示不同的组件，例如意大利语翻译应该是红色，而英语翻译应该是绿色。这种行为很容易获得，只需将React组件代码写入本地化文件，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="84f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们可以这样使用<code class="fe lo lp lq lr b">t</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="fd9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">伙计们，我希望这是一个有趣的教程，我想帮助新手，让他们知道即使像国际化这样“晦涩”的东西也可以变得容易，不需要复杂的库。</p><p id="78ea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，如果你想看看这个代码的真实例子，你可以看看GitHub库，里面有我的个人网站<a class="ae ln" href="https://github.com/a-chris/achris.me" rel="noopener ugc nofollow" target="_blank"> achris.me </a>的代码，我一直在使用我自己的<code class="fe lo lp lq lr b">useTranslation</code>钩子。</p><p id="cbeb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本教程的代码可以在我的存储库中找到:</p><div class="nv nw gp gr nx ny"><a href="https://github.com/a-chris/use-translation-example" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ir gy z fp od fr fs oe fu fw ip bi translated">GitHub-a-Chris/use-translation-example:如何在Next.js中构建自己的useTranslation钩子…</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">这是一个用create-next-app引导的Next.js项目。这个项目已经建成的一个例子，而我是…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om kp ny"/></div></div></a></div></div></div>    
</body>
</html>