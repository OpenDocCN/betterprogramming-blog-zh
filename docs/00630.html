<html>
<head>
<title>How To Fetch Data From an API With React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用React钩子从API获取数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-fetch-data-from-an-api-with-react-hooks-9e7202b8afcd?source=collection_archive---------0-----------------------#2019-06-21">https://betterprogramming.pub/how-to-fetch-data-from-an-api-with-react-hooks-9e7202b8afcd?source=collection_archive---------0-----------------------#2019-06-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e5a0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">功能数据提取</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6a41cc44de078d4d27e01590b3101e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nOGQSh43UdYwy9l9_qoWkg.png"/></div></div></figure><p id="893e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">React钩子让我们不用使用类语法就可以编写纯函数组件。通常，但不总是，我们必须写的代码越少，我们构建应用程序的速度就越快。</p><p id="e079" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你是钩子的新手，可以看看这篇教程中关于钩子的介绍。</p><div class="lq lr gp gr ls lt"><a href="https://medium.com/better-programming/demystifying-react-hooks-a0b56a6254c2" rel="noopener follow" target="_blank"><div class="lu ab fo"><div class="lv ab lw cl cj lx"><h2 class="bd iu gy z fp ly fr fs lz fu fw is bi translated">揭秘React挂钩</h2><div class="ma l"><h3 class="bd b gy z fp ly fr fs lz fu fw dk translated">钩子如何节省你的时间并提高你代码库的质量</h3></div><div class="mb l"><p class="bd b dl z fp ly fr fs lz fu fw dk translated">medium.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh ks lt"/></div></div></a></div><p id="b2ee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae mi" href="https://trevorlasn.medium.com/membership" rel="noopener">使用我的推荐链接</a>随时成为中级会员。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="32b3" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">第一步。从类到功能组件的重构</h1><p id="ef24" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">以这个简单的基于类的React组件为例。我们使用钩子的第一步是将其重构为一个功能组件。记住，你只能对功能组件使用钩子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="174e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">组件有一个<code class="fe np nq nr ns b">hasError</code>和一个<code class="fe np nq nr ns b">planets</code>状态。如果组件挂载了，我们调用<a class="ae mi" href="https://swapi.co/" rel="noopener ugc nofollow" target="_blank">星球大战API </a>并获取信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/d013aa8f949f240c031bc8b80519cb40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6rQrIcpkumrUlkyrNcSXbg.png"/></div></div><p class="nu nv gj gh gi nw nx bd b be z dk translated">使用获取API和React类组件获取数据</p></figure><p id="8a16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是我们如何将组件转换成功能组件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="e74e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Tada！带有挂钩的功能组件。不过，只有一个问题。钩子没有生命周期效果，比如<code class="fe np nq nr ns b">componentDidMount</code>或者<code class="fe np nq nr ns b">componentWillMount</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/6ab6d11829d511704a988bd221a447d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9PshF_8R3gLvKPEaJZaWNg.png"/></div></div><p class="nu nv gj gh gi nw nx bd b be z dk translated">在功能组件中使用componentDidMount</p></figure><p id="4bbe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在要干嘛？</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="1464" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">第二步。使用效果</h1><p id="5773" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated"><a class="ae mi" href="https://reactjs.org/docs/hooks-effect.html" rel="noopener ugc nofollow" target="_blank">效果挂钩</a>允许您在功能组件中执行副作用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/524285689b064be55014f7ad66a85fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OldgvU3HE3vVIZoI_OPKow.png"/></div></div></figure><p id="2dbc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">数据获取、设置订阅和手动更改React组件中的DOM都是副作用的例子。</p><p id="29ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe np nq nr ns b">useEffect</code>是一个React钩子，它接受回调作为第一个参数。在第一个参数中，我们执行所有与效果相关的任务。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="733d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从React包中导入<code class="fe np nq nr ns b">useEffect</code>，用新的吊钩替换<code class="fe np nq nr ns b">componentWillMount</code>。</p><p id="958c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe np nq nr ns b">useEffect</code>是做什么的？</p><p id="e960" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过使用这个钩子，你告诉React你的组件需要在渲染之后做一些事情。React将记住您传递的函数(我们称之为“效果”)，并在执行DOM更新后调用它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/b8d19e30cf6850f07f8f42b9db5bd249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7DbkKhnLVyg27Oio3X5xAA.png"/></div></div><p class="nu nv gj gh gi nw nx bd b be z dk translated">使用<code class="fe np nq nr ns b">useState to fetch data</code></p></figure><p id="aac6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好了，我们继续编译。但是为什么状态还是我们的初始状态<code class="fe np nq nr ns b">{}</code>？</p><p id="f12e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">简单，功能组件内部没有<code class="fe np nq nr ns b">this.setState({})</code>功能。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="06d6" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">第三步。从this.setState({})移动到Hooks</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="8895" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意我们是如何在回调函数中放置函数的。该函数被命名为<code class="fe np nq nr ns b">fetchData</code>,并完全按照它的名字来做。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/be6ed0421bba9c10e4353817375ac454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nkCG-DNN6-BABAQnI03WzA.png"/></div></div><p class="nu nv gj gh gi nw nx bd b be z dk translated">用钩子获取数据</p></figure><p id="e674" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果这看起来更复杂，我向你保证它不是。就像我们如何在<code class="fe np nq nr ns b">componentDidMount</code>中编写函数一样，我们在<code class="fe np nq nr ns b">useEffect</code>钩子中也是如此。</p><p id="f221" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了说明它实际上有多简单，让我们将<code class="fe np nq nr ns b">fetchData</code>完全移出钩子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="631c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">而且还能用！这里什么都没有。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/08f53f8ab5868e270e76b7d29eb9d267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UVZPaHCL5uVIQszG9K1Pfg.png"/></div></div><p class="nu nv gj gh gi nw nx bd b be z dk translated">用钩子获取数据</p></figure><p id="9a8b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你对解释<code class="fe np nq nr ns b">useEffect</code>钩子的深度文章感兴趣，我推荐从这篇文章开始<a class="ae mi" href="https://daveceddia.com/useeffect-hook-examples/" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="lq lr gp gr ls lt"><a href="https://daveceddia.com/useeffect-hook-examples/" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab fo"><div class="lv ab lw cl cj lx"><h2 class="bd iu gy z fp ly fr fs lz fu fw is bi translated">useEffect挂钩如何工作</h2><div class="ma l"><h3 class="bd b gy z fp ly fr fs lz fu fw dk translated">想象一下:你有一个非常好的功能组件，然后有一天，你需要给它添加一个生命周期方法…</h3></div><div class="mb l"><p class="bd b dl z fp ly fr fs lz fu fw dk translated">daveceddia.com</p></div></div><div class="mc l"><div class="od l me mf mg mc mh ks lt"/></div></div></a></div><p id="6d51" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:如果您希望<code class="fe np nq nr ns b">useEffect</code>的行为类似于<code class="fe np nq nr ns b">componentDidMount</code>生命周期事件，请传递一个数组作为第二个参数，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="dd43" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将第二个参数视为该效果的<em class="oe">依赖项</em>。如果自上次以来其中一个依赖关系发生了变化，该效果将再次运行。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="dacd" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">恭喜</h1><p id="51dc" class="pw-post-body-paragraph ku kv it kw b kx ni ju kz la nj jx lc ld nk lf lg lh nl lj lk ll nm ln lo lp im bi translated">感谢阅读！</p><p id="5a6f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">附言:寻找更多的编码思路？永远不要耗尽编码的想法，永远不要。</strong> <a class="ae mi" href="https://gumroad.com/l/IuqKc" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">在这里获取权限来一堆前端挑战被我。</strong> </a></p><p id="d7f2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在代码沙箱中玩原始代码<a class="ae mi" href="https://codesandbox.io/s/react-hooks-api-6juq5" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="lq lr gp gr ls lt"><a href="https://codesandbox.io/s/react-hooks-api-6juq5" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab fo"><div class="lv ab lw cl cj lx"><h2 class="bd iu gy z fp ly fr fs lz fu fw is bi translated">react-hooks-api - CodeSandbox</h2><div class="ma l"><h3 class="bd b gy z fp ly fr fs lz fu fw dk translated">为web应用程序定制的在线代码编辑器</h3></div><div class="mb l"><p class="bd b dl z fp ly fr fs lz fu fw dk translated">codesandbox.io</p></div></div><div class="mc l"><div class="of l me mf mg mc mh ks lt"/></div></div></a></div><p id="c162" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae mi" href="https://trevorlasn.medium.com/membership" rel="noopener">使用我的推荐链接</a>随时成为中级会员。你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事</p></div></div>    
</body>
</html>