# 是你犯了这些 SQL 连接错误吗？

> 原文：<https://betterprogramming.pub/are-you-making-these-sql-join-mistakes-920a9f7678ac>

## 两个常见错误及如何避免

![](img/aa71759b6b0dd3a32e64751dca767863.png)

照片由[娜塔莉·佩迪戈](https://unsplash.com/es/@nataliepedigo?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

当我在 SQL 查询中出错时，通常会在某处涉及到一个连接。幸运的是，我经常犯同样的错误，所以在这篇文章中，我将分享两个最常见的连接错误和一些避免它们的技巧。

# 错误 1:加入一些不独特的东西

## 例子

假设您有一个名为`cities`的表，其中包含一个城市及其人口的列表。您想要显示相同的信息，但是要添加国家名称，该名称不在表`cities`中。

幸运的是，您还有一个包含国家及其国内生产总值信息的表`gdp`。

这是您正在寻找的国家名称！您决定使用该查询对该表进行连接。

迟早，你会意识到你的桌子充满了重复。

不是四行，而是十二行！

## 如何避免那个错误？

您使用键`country_id`加入，该键在左边的表中是唯一的，但在右边的表中不是。事实上，不是每个国家一行，而是每个国家和年份一行。因为表中有三年，所以将行数乘以三。

在执行连接时，应该始终检查键是否是唯一的。如果没有，一个简单的子查询可以解决这个问题:

这给了我们想要的结果:

不要忘记在执行连接之前和之后检查行数。这可以防止您在几天或几个月后找到重复的内容！

# 错误 2:加入而不是联合

## 例子

你的利益相关者想知道他们的网站表现如何。他们有两张空桌子。

一个包含每个国家和设备的会话数量:

另一个存储关于国家和人口的信息:

您的利益相关者希望能够查询一个表来回答这两个问题:

*   每个国家每天有多少人访问该网站？
*   每个国家有多少用户，他们使用什么设备？

对你来说似乎很明显，你需要连接这两个表，你马上就开始了。当然，连接键将是国家。

结果如下:

你的股东不高兴。他们尝试运行以下查询来获取每个国家的人口:

得到了一个完全错误的结果:

你试着安抚他们。您知道窗口函数，所以您可以修复它，并根据国家的行数划分人口，或者甚至根据用户数量分配人口份额。

但是你的涉众对这个解决方案不满意。他们不希望您做出这样的假设，并且他们认为与特定国家和设备的人口发生冲突是没有意义的。这到底是什么意思？

## 如何避免那个错误？

这种错误通常来自于我们想要一个漂亮的表格，每条信息都在同一行，即使这些信息没有共同点。

在我们的例子中，我们可以联合这两个表来回答涉众的问题。看起来是这样的:

你的表格可能没那么漂亮，但它不包含虚假信息。

您可以使用两个简单的查询来回答利益相关者的问题。代码如下:

用户的比例在起作用。您现在可以检查每个国家和设备的用户:

有时候，最好的连接就是根本不连接！

希望这篇文章能帮助你在以后的工作中发现和避免加入错误！你最常犯的连接错误是什么？