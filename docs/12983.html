<html>
<head>
<title>Build a Slack App To Know What Your Teammates Are Listening on Spotify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个Slack应用程序，了解你的队友在Spotify上听什么</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-slack-app-for-spotify-with-go-64ff71959bd1?source=collection_archive---------3-----------------------#2022-07-17">https://betterprogramming.pub/building-a-slack-app-for-spotify-with-go-64ff71959bd1?source=collection_archive---------3-----------------------#2022-07-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5c33" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Go的Slack-Spotify集成</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/bacda76aa57ace1be54d4002ec25a8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*VG9TmNAI5ogjHOojdEOexg.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Spotify for Slack</p></figure><p id="b639" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我喜欢Discord的Spotify功能，你可以看到其他人在听什么。在之前的公司用的比较多，现在用Slack。</p><p id="f6fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">可惜Slack没有那样的原生功能。所以我决定为它开发我自己的slack应用程序(<a class="ae ln" href="https://github.com/o-mago/spotify-status" rel="noopener ugc nofollow" target="_blank">https://github.com/o-mago/spotify-status</a>)。</p><p id="fc06" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是不和谐的特点，我启发建立自己的懈怠。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/1f2944aba472fbaa1606f05af592a7ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*gW-qslQCntHj20DfSwcmTg.jpeg"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Discord的Spotify功能</p></figure><p id="7ff3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我将展示如何使用这些技术从基础上构建应用程序，并使用<strong class="kt ir">零成本</strong>进行部署:</p><ul class=""><li id="6098" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><a class="ae ln" href="https://go.dev/" rel="noopener ugc nofollow" target="_blank">出发</a></li><li id="70b8" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://www.heroku.com/platform" rel="noopener ugc nofollow" target="_blank"> Heroku </a></li><li id="8bc1" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://newrelic.com/" rel="noopener ugc nofollow" target="_blank">新遗迹</a></li><li id="601b" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">码头工人</a></li><li id="2821" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://developer.spotify.com/documentation/web-api/" rel="noopener ugc nofollow" target="_blank"> Spotify Web API </a></li><li id="4813" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://api.slack.com/" rel="noopener ugc nofollow" target="_blank">松弛API </a></li><li id="2c68" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a></li></ul><h1 id="923b" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">索引</h1><ul class=""><li id="e248" class="lp lq iq kt b ku mv kx mw la mx le my li mz lm lu lv lw lx bi translated"><a class="ae ln" href="#8989" rel="noopener ugc nofollow">构建App </a> <br/> - <a class="ae ln" href="#996c" rel="noopener ugc nofollow">理念</a> <br/> - <a class="ae ln" href="#3a55" rel="noopener ugc nofollow">架构</a>-<br/>-<a class="ae ln" href="#51b6" rel="noopener ugc nofollow">服务器</a>-<br/>-<a class="ae ln" href="#6b08" rel="noopener ugc nofollow">处理程序</a>-<br/>-<a class="ae ln" href="#654a" rel="noopener ugc nofollow">服务</a>-<br/>-<a class="ae ln" href="#8940" rel="noopener ugc nofollow">仓库</a>-<br/>-<a class="ae ln" href="#d69a" rel="noopener ugc nofollow">实体</a> <br/> - <a class="ae ln" href="#5919" rel="noopener ugc nofollow">部署</a></li><li id="eca7" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="#fc03" rel="noopener ugc nofollow">结论</a></li><li id="2607" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="#9abe" rel="noopener ugc nofollow">设置服务</a><br/>-<a class="ae ln" href="#c7e3" rel="noopener ugc nofollow">Heroku</a><br/>-<a class="ae ln" href="#3269" rel="noopener ugc nofollow">新遗迹</a> <br/> - <a class="ae ln" href="#94be" rel="noopener ugc nofollow">面向开发者的Spotify</a></li></ul><h1 id="8989" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">构建应用程序</h1><h2 id="996c" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">想法</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/b5e234f669ea1690ce38a0ea85e96899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*Pxs5xf9NhfqTnUNYzQjY_g.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">流量</p></figure><p id="5431" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该应用程序的想法是将用户正在听的歌曲与他/她的空闲状态同步。为此，该应用程序将每X秒运行一次cronjob。它将验证用户是否正在Spotify上听一些东西，并将状态更改为类似这样的内容:<em class="nn">:Spotify-e moji:song _ name-singer</em>。</p><p id="e224" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但我们必须注意几点:</p><ul class=""><li id="8415" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated">应用程序必须只改变用户的状态，如果当前状态是空白的。我们不想覆盖用户设置的另一个状态。我经常将我的状态更改为“正在吃午饭”，但我仍然喜欢听Spotify，我不希望我的状态更改为我的歌曲。</li><li id="5c53" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">该应用程序必须在停止Spotify播放器后清除状态，但前提是当前状态是由我们的Slack应用程序设置的。我们不想清除用户或另一个Slack应用程序设置的状态。</li><li id="0909" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">松弛状态文本最多包含100个字符:<a class="ae ln" href="https://api.slack.com/docs/presence-and-status#user-presence-and-status__custom-status__reading-statuses" rel="noopener ugc nofollow" target="_blank">https://API . slack . com/docs/presence-and-status # user-presence-and-status _ _ custom-status _ _ reading-status</a></li><li id="ba6e" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">我们必须将cronjob时间定义为一个不太大的间隔，以便与Spotify保持同步，但它不需要太小，因为一首歌平均播放3分钟。10秒是一个很好的间隔</li></ul><p id="73cf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还需要一个应用程序的登录页面，用户将应用程序添加到他/她的工作区，并允许应用程序连接到Spotify帐户。</p><p id="e936" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在用户允许我们的应用程序访问他/她的数据后，我们需要将用户的信息(来自slack和spotify)存储在数据库中，以让cronjob工作。</p></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="7dc0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们开始聚会吧。我们将使用Go构建我们的应用程序。完整的app可以在<a class="ae ln" href="https://github.com/o-mago/spotify-status" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">这里</strong> </a>找到。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/2b10f0f847de9cf516879be477373a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/1*G72as1x_ynxAw9g0_gxvww.gif"/></div></figure><p id="2e26" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用默认的Go <strong class="kt ir"> net/http </strong>来服务我们的应用程序和一些外部库:</p><ul class=""><li id="82ef" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><a class="ae ln" href="https://github.com/go-gorm/gorm" rel="noopener ugc nofollow" target="_blank">奥姆</a>:奥姆</li><li id="849c" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://github.com/zmb3/spotify" rel="noopener ugc nofollow" target="_blank">zm B3/Spotify</a>:Spotify API库</li><li id="5afa" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://github.com/golang/oauth2" rel="noopener ugc nofollow" target="_blank"> oauth2 </a>:处理Spotify访问令牌</li><li id="a56b" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://github.com/robfig/cron" rel="noopener ugc nofollow" target="_blank"> robfig/cron </a>:创建我们的用户状态更新例程</li><li id="6663" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://github.com/newrelic/go-agent" rel="noopener ugc nofollow" target="_blank">新遗迹/围棋代理</a>:围棋新遗迹代理</li><li id="3943" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><a class="ae ln" href="https://github.com/slack-go/slack" rel="noopener ugc nofollow" target="_blank">松弛/松弛</a>:松弛API</li><li id="e667" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">g <a class="ae ln" href="https://github.com/google/uuid" rel="noopener ugc nofollow" target="_blank"> oogle/uuid </a>:为我们的用户表生成id</li></ul><h2 id="3a55" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">体系结构</h2><p id="fc2e" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">我试图在这里达到某种层次的干净架构，在不同层之间分割代码(允许关注点分离，SoC)。我们的核心应用是一个三层架构，包含<code class="fe nz oa ob oc b">handlers</code>、<code class="fe nz oa ob oc b">services</code>和<code class="fe nz oa ob oc b">repositories</code>:</p><ul class=""><li id="d401" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><strong class="kt ir">处理程序</strong>:它们是接收请求、解析参数并在需要时调用服务的前线。</li><li id="2878" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><strong class="kt ir">服务</strong>:它们包含我们的“业务”逻辑(在我们的例子中，设置用户的空闲状态)并在必要时调用存储库。</li><li id="a508" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><strong class="kt ir">存储库</strong>:它们将完成我们的逻辑(服务)和数据源(在本例中是我们的PostgreSQL DB)之间的接口</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/64d2469ce765dacfce0a5e802ce48364.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*LHb3jmdXR3GRQI0Criwilg.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">应用程序结构</p></figure><p id="d183" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将为我们的实体创建两个包:<code class="fe nz oa ob oc b">domain</code>和<code class="fe nz oa ob oc b">db_entities</code>。</p><ul class=""><li id="82b6" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><strong class="kt ir">域</strong>:它是与我们的“业务”逻辑相关的实体，只包含带有必要字段的结构。<em class="nn">服务</em>层将只接收和发送域实体。它有更全面的语言，与ou的“业务”规则相关联</li><li id="f15c" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><strong class="kt ir">db _ entities</strong>:这是我们的DB表的模型，它的所有列和函数都用来转换<em class="nn"> db_entities - &gt;域</em>或<em class="nn">域- &gt; db_entities。</em></li></ul><p id="5c82" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">OBS:在我们的例子中，域和db_entities将具有相同的结构。但这并不是总会发生的事情。这取决于领域建模。</p><p id="a489" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好吧…我知道这对于一个简单的Slack应用程序来说太复杂了，确实如此。</p><p id="2d81" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我的第一个方法是只使用一个文件，但这是一个烂摊子。所以我决定重构它，为了研究的目的，试着给混乱创造一些秩序。此外，我将在本文的结尾考虑一些改进，如果我们需要添加更多的功能，拥有一个更坚实的架构将会有所帮助。</p><h2 id="51b6" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">计算机网络服务器</h2><p id="b921" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">首先我们将创建一个<code class="fe nz oa ob oc b">src</code>文件夹和一个名为<code class="fe nz oa ob oc b">server.go</code>的文件。它将是我们的<code class="fe nz oa ob oc b">main</code>包，一个将被编译成可执行程序的包。在里面我们会做一些事情:</p><ul class=""><li id="4d44" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated">获取我们的环境变量:</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="ce27" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">New Relic、Slack、Spotify和数据库凭据将在本文接下来的部分中完成设置后找到。由于Heroku为我们的应用程序分配了一个随机端口，因此需要使用这个名称的<strong class="kt ir">端口</strong>环境变量。</p><p id="68c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">设置新遗迹:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="15c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">设置数据库并运行迁移。我们将使用<a class="ae ln" href="https://gorm.io/index.html" rel="noopener ugc nofollow" target="_blank"> gorm </a>作为我们的orm:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="55af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建spotify验证器，以获取用户的Spotify播放器信息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="61c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建<strong class="kt ir">处理程序</strong>、<strong class="kt ir">服务</strong>和<strong class="kt ir">存储库</strong>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="266e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建cron以更新用户状态:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="0e62" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建服务器多路复用器(我们不需要默认处理程序)，添加处理程序并开始监听。我们需要4条路线:</p><ul class=""><li id="c06c" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">/slackAuth</code>:用户允许我们的app后，Slack调用的回调路径</li><li id="8046" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">/callback</code>:用户允许我们的应用后，Spotify调用的回拨路径</li><li id="89c8" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">/users</code>:新遗迹使用的路线，以ping我们的应用程序，并阻止它睡眠</li><li id="42ad" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><strong class="kt ir"> / </strong>:为我们的静态文件提供服务的路径(登录页面)</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="f7fd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如你所见，我们将在服务器上提供静态文件。它是网站根路径上的登陆页面。我决定用我们的API来服务它，而不是为我们的前端创建另一个项目。这不是一个好的做法，但页面太简单了，我不想在这一点上增加更多的复杂性。</p><p id="35b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">静态网站基本就是一个HTML文件和CSS。这只是我们添加到松弛时间按钮的一个页面。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi og"><img src="../Images/b12d5b243efd7ceed9d42301cb4388d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZVlCRM4RVjeFzG3lr69Img.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Slack应用程序登录页面</p></figure><h2 id="6b08" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">经理人</h2><p id="5d7a" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">正如我们之前看到的，我们有4个路由器，一个仅用于静态文件，其他的需要处理程序。</p><ul class=""><li id="988a" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><strong class="kt ir">新遗迹健康处理器</strong>:</li></ul><p id="38d8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这只是一个ping处理程序</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="ca73" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><strong class="kt ir">松弛回调处理器</strong>:</li></ul><p id="fa17" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它将使用我们的slack应用凭证和用户单击Add to Slack按钮后生成的代码来检索用户数据(使用POST请求Slack API): slack用户id和访问令牌。</p><p id="ee17" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，处理程序将重定向到Spotify Auth URL，将该用户信息(id和访问令牌)设置为Cookies。这样，我们可以在Spotify回调处理程序中检索这些信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="4433" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><strong class="kt ir"> Spotify回调处理程序</strong>:</li></ul><p id="f06f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它将检索用Cookies设置的Slack用户数据。此外，我们将把Spotify认证页面(用户被重定向)代码换成访问令牌。Spotify库中的这个方法<code class="fe nz oa ob oc b">Token(state string, r *http.Request) (*oauth2.Token, error)</code> <strong class="kt ir"> </strong>还会检查我们在<code class="fe nz oa ob oc b">server.go</code> <strong class="kt ir"> </strong>文件上生成的状态。通过这种方式，我们可以防止诸如跨站点请求伪造之类的攻击。</p><p id="61c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有了Slack和Spotify的用户数据，我们最终可以将用户添加到我们的数据库中。但是如果你记得我们的架构，我们需要先调用服务层。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="654a" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">服务</h2><p id="177e" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">app有两种服务方式:<code class="fe nz oa ob oc b">AddUser</code>和<code class="fe nz oa ob oc b">ChangeUserStatus</code></p><ul class=""><li id="300a" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">AddUser</code>:</li></ul><p id="0e09" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里我们为<code class="fe nz oa ob oc b">users</code>表主键生成一个UUID(通用唯一标识符)。在我们调用存储库在我们的数据库上创建用户之后。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="f536" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">ChangeUserStatus</code> <strong class="kt ir"> : </strong></li></ul><p id="c660" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是我们app的核心功能。它将检索我们数据库中的所有用户，迭代，然后为每个用户创建一个goroutine。</p><p id="4a8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我知道，我知道…你在想“随着用户数量的增长，我们可能会遇到一些问题”，你是对的(我将在本文的最后一节讨论这个问题)。但我决定不处理它，因为我的想法是只在公司内部使用这个应用程序，用户不超过100人。</p><p id="3294" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe nz oa ob oc b">goroutine</code>中，我们将检查用户是否在玩游戏，并且检查当前的空闲状态。我们只能在两种情况下更改状态:</p><ul class=""><li id="d01b" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated">更新Spotify歌曲的状态:如果用户正在播放歌曲，并且状态表情符号为空或为<code class="fe nz oa ob oc b">:spotify:</code></li><li id="f483" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">清除状态:如果用户没有在播放歌曲，并且状态表情符号是<code class="fe nz oa ob oc b">:spotify:</code></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="8940" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">仓库</h2><p id="d66c" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">有两种存储库方法:<code class="fe nz oa ob oc b">CreateUser</code>和<code class="fe nz oa ob oc b">SearchUsers</code></p><ul class=""><li id="a045" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">CreateUser</code>:</li></ul><p id="7096" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果用户存在，我们尝试获取用户，否则创建用户。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="dea9" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">SearchUsers</code>:</li></ul><p id="dc32" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该存储库从数据库中检索所有用户</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="d69a" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">实体</h2><p id="d93a" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">将有两个实体:<code class="fe nz oa ob oc b">domain.User</code>和<code class="fe nz oa ob oc b">db_entities.User</code></p><ul class=""><li id="e042" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">domain.User</code>:</li></ul><p id="55f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">用于内部服务</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="7f15" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">db_entities.User</code>T19:</li></ul><p id="6a45" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们数据库中用户表的模型。并且还包含与<code class="fe nz oa ob oc b">domain.User</code>之间的转换</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="9a2b" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated"><strong class="ak">运行app </strong></h2><p id="c9f1" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">为了运行我们的应用程序，我创建了一个<code class="fe nz oa ob oc b">Dockerfile</code>和<code class="fe nz oa ob oc b">docker-compose</code>:</p><p id="3511" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">给Mac M1用户的一个免费提示:在docker文件的顶部添加<code class="fe nz oa ob oc b">--platform=linux/amd64</code>,否则Heroku会抛出一个错误</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="3641" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，要在本地运行，导出所有环境变量并运行<code class="fe nz oa ob oc b">docker compose up</code>。</p><h2 id="5919" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">部署</h2><p id="6fe0" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">我们将使用Heroku容器将我们的应用程序作为容器部署在Heroku上。因此，需要创建3个文件:</p><ul class=""><li id="ba87" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">Procfile</code> <strong class="kt ir"> : </strong></li></ul><p id="a3fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个文件通知Heroku启动dyno时要运行的命令</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="c157" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">heroku.yml</code>:</li></ul><p id="214a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它定义了我们在Heroku上的应用程序的构建选项</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><ul class=""><li id="a948" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">deployHeroku.sh</code>:</li></ul><p id="cff0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">简化部署的shell脚本(在运行之前导出环境变量)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><h1 id="fc03" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">结论</h1><p id="f2fe" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">最终，我们有了一个工作正常、简单、免费的slack应用程序，它可以将你的Slack状态与Spotify同步。</p><p id="2e4a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是…我们可以改变这里的一些事情。考虑到可扩展性，添加功能并使其更加安全可靠。如果我们的应用程序变得流行起来会怎么样…</p><h2 id="8423" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">新功能</h2><ul class=""><li id="bfd0" class="lp lq iq kt b ku mv kx mw la mx le my li mz lm lu lv lw lx bi translated">使用命令与他人共享您正在听的内容</li><li id="2120" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">开始倾听工作区的其他人在听什么</li><li id="a263" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">使用命令控制Spotify</li></ul><h2 id="9057" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">可靠性和安全性改进</h2><ul class=""><li id="6000" class="lp lq iq kt b ku mv kx mw la mx le my li mz lm lu lv lw lx bi translated">允许用户在删除应用程序时从我们的数据库中排除他的数据</li><li id="b9b9" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">对用户进行分页以更新状态，而不是检索所有状态</li><li id="6742" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">为登录页面创建另一个项目，为静态网站创建不同的部署。该网页将包含更多关于应用程序的信息</li><li id="791b" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated">例如，使用AES加密对数据库中的用户数据进行加密(我们需要解密我们的数据，以便从Spotify和Slack中检索用户信息)</li></ul><p id="264b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，但同样重要的是，在下一节中，我将描述如何设置我们需要的服务来使其工作(Heroku，New Relic，Spotify For Developers和Slack App)。</p><h1 id="9abe" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">设置服务</h1><h2 id="c7e3" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">赫罗库</h2><p id="4097" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">我们将创建一个新的免费Heroku应用程序。它会给我们这样的地址:<app-name> .herokuapp.com(例如<code class="fe nz oa ob oc b">spotify-status-slack.herokuapp.com</code>)</app-name></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/b0c45738dcf8637906dd8b16267d4742.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*4ftuI2y5qCi1UxRgu871Lg.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Heroku面板</p></figure><p id="f21b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">和以及两个资源:</p><ul class=""><li id="f264" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated">它用有限的资源创建了一个aws postgres免费数据库，但它将满足我们的目的</li><li id="9f39" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">New Relic APM</code>:它将被用于ping我们的应用程序并保持其活动，因为Heroku，在免费计划中，如果它在30分钟内没有收到任何请求，就会将应用程序置于睡眠状态</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi om"><img src="../Images/b9ef6464b4bd4c8ebb63de5829c2940b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_9ZRozpQeE0UL_DNLXgbA.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Heroku资源</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi on"><img src="../Images/59e0f239b863e554be42b85c4f586bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UuwJxk1KiBgaQ_wSsP5grQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">数据库凭据</p></figure><h2 id="3269" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">新遗迹</h2><p id="3b37" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">我们将在新遗迹中创建一个新的合成监视器，型号为<code class="fe nz oa ob oc b">Availability</code>。该监视器将每隔1分钟(可以是少于30分钟的任何时间)仅ping我们将为其构建的端点</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oo"><img src="../Images/1cf0fb94ac50da3151c296993f6195b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6n8x_YL6EtCGZ5CJO_cNuQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">新遗迹面板</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi op"><img src="../Images/454ca98059356084d574d66b7ab9ed44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M9R6CKoZLvjXS5KhBeuHPg.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">可用性监视器</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oq"><img src="../Images/6dad372c0f4f22f8050245be13a06918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aYA5KKDLF5cGbCErNrVGpA.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">监视器设置</p></figure><h2 id="94be" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">面向开发者的Spotify</h2><p id="5a19" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">首先，我们必须创建我们的Spotify开发者帐户，并在平台内创建我们的应用程序，以便获得我们的<code class="fe nz oa ob oc b">Client ID</code>和<code class="fe nz oa ob oc b">Client Secret</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi or"><img src="../Images/9c6d58ac780888c496bcfbb1d70922ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDWYX90C2ThPZjTN-oy2-Q.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Spotify开发者面板</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi os"><img src="../Images/c3ec9f6d18935d04a70a050053685b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LgKcygtRIhGYwpwXLacm0Q.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">面向开发者的Spotify应用程序屏幕</p></figure><p id="b3fe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还必须提供一个重定向网址后，用户允许我们的应用程序访问他/她的Spotify帐户信息</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi ot"><img src="../Images/9f1c29e770384bc94783531bb9c0d89f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzM6K-ySvTCMNxrdB_WHNg.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">设置模式</p></figure><h2 id="3538" class="na me iq bd mf nb nc dn mj nd ne dp mn la nf ng mp le nh ni mr li nj nk mt nl bi translated">Slack应用</h2><p id="13fd" class="pw-post-body-paragraph kr ks iq kt b ku mv jr kw kx mw ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">我们将开始为开发创建一个新的工作空间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi ou"><img src="../Images/4b92412fe8ed2edd05a39a7d490d6931.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9q-5WtZn5NmFsPdkRDFVXA.png"/></div></div></figure><p id="0c39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，让我们从头开始创建我们的应用程序，命名它并选择我们之前创建的工作区</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi ov"><img src="../Images/46dacfebd7c7b74784410e02f55986df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fh5QFqGIlcvP_Is6xNcWxQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi ow"><img src="../Images/d1e049a11c43e408d328f13576c06349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8hgjLdQwzEYXVLqiUBRxQQ.png"/></div></div></figure><p id="3b7b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要为应用程序配置权限:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi ox"><img src="../Images/ebc79fb72830a9150f4f13db16de5c12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJKjONhA8COx0cTsrGltMg.png"/></div></div></figure><p id="fdf8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要提供一个URL来重定向slack permission网站，允许用户在工作区尝试安装应用程序(这将是我们创建服务器并将其部署在heroku上后的最终URL):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oy"><img src="../Images/673e1fe5e246cb265dcb7bdb41412dd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VM8lxdcTBPZTCBlhwlkwcg.png"/></div></div></figure><p id="6421" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">范围是指我们需要用户在安装应用程序时允许我们的权限。</p><ul class=""><li id="17e6" class="lp lq iq kt b ku kv kx ky la lr le ls li lt lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">user.profile.read</code>:允许我们获取用户状态</li><li id="dae3" class="lp lq iq kt b ku ly kx lz la ma le mb li mc lm lu lv lw lx bi translated"><code class="fe nz oa ob oc b">user.profile.write</code>:它允许我们为用户在Spotify上正在听的歌曲设置用户状态</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oz"><img src="../Images/f1a0edd825fada8c4c24f16aa10d1c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTkuRQuAOFxjgP3I1O0Xxg.png"/></div></div></figure><p id="59bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了分发该应用程序，我们将把这个预制的<code class="fe nz oa ob oc b">Add to Slack</code>按钮片段添加到我们的网站上。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi pa"><img src="../Images/32208bbdf4dd87ec74f58e37564b0479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Ibn9ZgUEDSoMf9Skp0qYw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi pb"><img src="../Images/fa879f65e88cfe2ec3ecbaefe1bb5e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L6vy76-OsZyO_Qj4v4RO2w.png"/></div></div></figure><p id="8554" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还需要为应用程序提供我们的网址(heroku为我们生成的最终网址)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi ca"><img src="../Images/6afef1c246cdfd12980d2612d6d32fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Bi-a95FyOhfcW4hkc00yQ.png"/></div></div></figure><p id="b79d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为我们将有一个登录页面，所以我们将选择<code class="fe nz oa ob oc b">Install from your landing page</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi pc"><img src="../Images/7c7f0fc74ac3ebb5cd4d7370b30195da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*orgO_kC0-5PL4cmeVZZxEA.png"/></div></div></figure><p id="7f30" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一切就绪！</p></div></div>    
</body>
</html>