<html>
<head>
<title>Data Wrangling in the Command Line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">命令行中的数据争论</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/data-wrangling-in-the-command-line-af35a609c5f1?source=collection_archive---------6-----------------------#2022-11-13">https://betterprogramming.pub/data-wrangling-in-the-command-line-af35a609c5f1?source=collection_archive---------6-----------------------#2022-11-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="08d1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习如何使用Unix Power Tools在命令行中获取和操作数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5596356db41235dd2d1c72d046448c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6Bgj26d66uexRwqOKqRug.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">所有图片由作者提供</p></figure><p id="fdff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本教程中，我们将探讨使用命令行工具的高效方法，以及数据科学家、数据工程师和其他数据相关人员如何利用Linux终端的能力进行数据辩论。</p><p id="8fe4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如今，从事数据工作的人可以从大量令人兴奋的技术和编程语言中进行选择，用于数据争论、操作和解释，如Python、R、Julia和Apache Spark。也许我们会想到下面这个问题:</p><p id="dabc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为什么您仍然应该关心一项在七十年代开发的用于执行这些数据密集型任务的旧技术呢？</p><p id="c589" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">命令行有什么是其他技术和编程语言所没有的？</p><p id="6bcb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">数据分析是一个令人兴奋的领域，通常需要尖端技术来适当地“提炼石油”，但不幸的是，许多人和公司认为您需要新技术来处理数据争论和数据操作等任务，尽管有许多事情可以通过使用命令行来完成。不仅如此，它只需要很少的设置，有时可以更有效地实现。</p><p id="d864" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您将需要深入了解Linux命令，以认识到命令行不仅仅用于安装软件、配置系统和搜索文件。有一些神奇而有用的工具，比如<code class="fe lr ls lt lu b">curl</code>、<code class="fe lr ls lt lu b">head</code>和<code class="fe lr ls lt lu b">sort</code>，可以帮助你获取、组织和操作数据，就像你在Pandas或Spark中所做的那样。这些是命令行工具的例子，它们将数据作为输入，对其进行处理，并打印结果。Ubuntu附带了相当多以前安装的程序。在本文中，我们将使用其中一个命令行工具，这是一个Python包，你可以通过<code class="fe lr ls lt lu b">pip</code>像安装任何其他包一样安装，这就是所谓的<code class="fe lr ls lt lu b">csvkit</code>。</p><h1 id="44a7" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">获取数据</h1><p id="3283" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">获取数据然后争论是非常耗时的，那么为什么不在终端中用最简单的方式来表达呢？我们将使用<code class="fe lr ls lt lu b">curl</code>从<a class="ae ms" href="https://randomuser.me/documentation" rel="noopener ugc nofollow" target="_blank">随机用户生成器API </a>下载假数据，然后我们将使用一个非常好的命令行工具，名为<a class="ae ms" href="https://github.com/sharkdp/bat" rel="noopener ugc nofollow" target="_blank"> bat </a>，它是一个<code class="fe lr ls lt lu b">cat</code>克隆，允许您突出显示语法和其他一些很酷的功能。我们还将使用<a class="ae ms" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank"> jq </a>，这是一个对JSON文件进行操作的强大工具。</p><p id="af73" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">获取随机数据的命令如下:</p><pre class="kg kh ki kj gt mt lu mu mv aw mw bi"><span id="f8b8" class="mx lw iq lu b gy my mz l na nb">curl -s "<a class="ae ms" href="https://randomuser.me/api/1.2/?results=5&amp;seed=foobar" rel="noopener ugc nofollow" target="_blank">https://randomuser.me/api/1.2/?results=5&amp;seed=foobar</a>" &gt; users.json</span></pre><p id="a957" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可能已经注意到，<code class="fe lr ls lt lu b">curl </code>下载API返回的原始JSON。没有进行任何解释，响应内容立即打印在标准输出上。在本例中，我们使用重定向操作符(<code class="fe lr ls lt lu b">&gt;</code>)以JSON格式保存响应。</p><p id="2618" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae ms" href="https://en.wikipedia.org/wiki/Man_page" rel="noopener ugc nofollow" target="_blank">手册页</a>的一个非常好的选项是<a class="ae ms" href="https://tldr.sh/" rel="noopener ugc nofollow" target="_blank"> tldr </a>，它为您提供了关于特定Linux命令的上下文，并提供了该命令的示例和可能的用法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/279412d5e3487ea9244d2ff9fa51058b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fZrARpTVd43Cq4NQQS17pw.png"/></div></div></figure><p id="b42d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将检查之前使用<code class="fe lr ls lt lu b">bat</code>命令生成的JSON文件。以下是输出结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/c837b7316b2813594776b80b18935be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XjzNAzk0JJ5msqR8gJsqMw.png"/></div></div></figure><p id="38df" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以添加一个管道到<code class="fe lr ls lt lu b">jq</code>，并以更好的输出可视化JSON文件，而不是重定向API响应以保存到<code class="fe lr ls lt lu b">users.json</code>文件:</p><pre class="kg kh ki kj gt mt lu mu mv aw mw bi"><span id="3c7b" class="mx lw iq lu b gy my mz l na nb">curl -s "<a class="ae ms" href="https://randomuser.me/api/1.2/?results=5&amp;seed=foobar" rel="noopener ugc nofollow" target="_blank">https://randomuser.me/api/1.2/?results=5&amp;seed=foobar</a>" | jq .</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/ea3237818a8f44ccfcf98c6af705f5b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbwO8Qm0kZBmww2YqKU1Mw.png"/></div></div></figure><p id="8b3d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以将提取的JSON文件中的重定向操作符传递给<code class="fe lr ls lt lu b">jq</code>,然后获取JSON中的电子邮件，而不是像前面的步骤那样获取一些虚拟数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/78131602ee2aefcb9d98dcf9188553b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*gNNtvEBrD9Ye9hgjc7ryug.png"/></div></figure><h1 id="8cb6" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">数据操作</h1><p id="1554" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">出于数据操作的目的，我们已经解析并转换为CSV格式的数据集似乎有点小，因此我们将使用<code class="fe lr ls lt lu b">curl</code>从外部存储库下载另一个数据集:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/cceea488ef9830eaf0b73c209ba8cca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upy8s1v3JdTcgXSya6p1Fw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自作者</p></figure><p id="10cf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后检查CSV文件的第一行:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/34394b684b5f2f7672905df44e34b457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x98Bgp3kW7OQ6y-4ZZFUtQ.png"/></div></div></figure><p id="404c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了生成这个CSV文件的一些统计数据，我们将使用一个非常方便的命令行工具，名为<a class="ae ms" href="https://csvkit.readthedocs.io/en/1.0.2/tutorial/1_getting_started.html" rel="noopener ugc nofollow" target="_blank"> csvkit </a>。通过运行以下命令，它可以作为任何其他Python包从您的终端安装:</p><pre class="kg kh ki kj gt mt lu ni bn nj nk bi"><span id="c26f" class="nl lw iq lu b be nm nn l no nb">sudo pip install csvkit</span></pre><p id="e68b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">csvkit的第一个有用特性是<em class="np">in csv</em>，它允许您在命令行中将Excel格式的文件转换为CSV格式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/b891bca79e05087e2062e3d9d44fb38c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*JZtJra2bI76CGTuRgzdIjg.png"/></div></figure><p id="bc9e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上面的截图中，我们将Excel文件转换为CSV文件，然后将输出保存到CSV文件。既然我们已经有了一些可以使用的数据，我们可能会想在Excel或Google Docs中打开它，但是如果我们能在命令行中查看一下不是很好吗？为此，我们有<em class="np"> csvlook </em>。有了它，我们可以通过管道连接到less选项，并生成我们先前下载的文件的良好输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/eaa129c8c12d31de6033911313cbf6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dLYcI1fGKNzya4JrCOyPEA.png"/></div></div></figure><p id="a2cf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还可以结合使用<em class="np"> csvcut </em>和<em class="np"> csvstat </em>工具来获得CSV数据集的一些漂亮的统计数据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/6a8f048a7c0767cb99fc6340e60b348d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*n4xho4g_C5umUyhSvCp05A.png"/></div></figure><p id="5238" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果在这个1261行的数据集中，我们需要查看对应于特定城市的记录，那么我们应该使用csvkit的<em class="np"> csvgrep </em>工具。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/70bac8373994dceeae7db6fef1abf727.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*SnQNQmiTSfXReW-mPXE-zA.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/1a355dc5dfc9ecb1c81c70325e535ec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KeJAeZwU0M1YyRijWD77AA.png"/></div></div></figure><h1 id="9c63" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">查询CSV数据</h1><p id="ad71" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">csvkit有一个名为<em class="np"> sql2csv的命令行工具。</em>它可以通过一个通用接口与许多数据库协同工作，包括MySQL、Oracle、PostgreSQL、SQLite、Microsoft SQL Server和Sybase。顾名思义，sql2csv以csv格式输出文件。</p><p id="c65a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将使用<code class="fe lr ls lt lu b">wget</code> <em class="np"> </em>命令行工具下载一个示例SQLite数据库，然后在同一个目录中解压缩它的内容。之后，我们将获得一个. db文件，以便使用sql2csv进行分析:</p><pre class="kg kh ki kj gt mt lu ni bn nj nk bi"><span id="b2bd" class="nl lw iq lu b be nm nn l no nb">wget https://www.sqlitetutorial.net/wp-content/uploads/2018/03/chinook.zip</span></pre><p id="fe74" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该数据库包含一家音乐商店的11个数据表，我们将在终端中直接探索和检索SQL表，而无需连接SQL客户端。很酷，不是吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/b1cd86e1b7be566fb5ae602c623439e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*usJwKMItHpY6uAjvRDKAhQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自大数据和商业智能，Packt</p></figure><p id="ff6a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要向sql2csv传递两个参数，<code class="fe lr ls lt lu b">--db</code>和<code class="fe lr ls lt lu b">--query</code>，就像在sql编辑器中一样。正如我们在<a class="ae ms" href="https://en.wikipedia.org/wiki/Entity%E2%80%93relationship_model" rel="noopener ugc nofollow" target="_blank"> ERD </a>中注意到的，有<code class="fe lr ls lt lu b">artists</code>和<code class="fe lr ls lt lu b">albums</code>表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/6e6856c2be38b2585870a4bd66f79973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VC6fXhtNHkZwcj3SABkbJQ.png"/></div></div></figure><p id="b5cb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以通过主键<code class="fe lr ls lt lu b">ArtistId</code>连接两者，并为每个<code class="fe lr ls lt lu b">Artist</code>对应的<code class="fe lr ls lt lu b">Title</code>带来一个包含以下内容的表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/409dd3774676855359a4328da8dcc6c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VK69zLlkalgtyV2yoo1wfA.png"/></div></div></figure><p id="bbbe" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">csvsql工具允许您通过运行以下代码行从CSV文件创建数据库表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/cb2287bbf1ea81a1d923ec3f817e513c.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*-Hm3vaYn4cUrTWkQwZ0r9w.png"/></div></figure><p id="5e7f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的语法将生成CSV文件的create table语句，但是真正创建数据库表的是下面的语句:</p><pre class="kg kh ki kj gt mt lu ni bn nj nk bi"><span id="2173" class="nl lw iq lu b be nm nn l no nb">csvsql --db sqlite:///crime.db --insert crime.csv</span></pre><h1 id="7b7a" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">最后的想法</h1><p id="c318" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">在本教程中，我们学习了数据人员可以在日常工作中使用的多种有用的命令行工具。它们功能强大，安装简单，因此掌握Linux命令行对每个数据科学家和数据工程师的职业生涯都是一个加分项。</p><p id="dfa6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在下面的链接中，我将为您留下一个极好的资源，让您了解更多关于命令行工具的信息:</p><div class="nz oa gp gr ob oc"><a href="https://github.com/jeroenjanssens/data-science-at-the-command-line" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">GitHub-jeroen janssens/命令行数据科学:命令行数据科学</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">github.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq kp oc"/></div></div></a></div></div></div>    
</body>
</html>