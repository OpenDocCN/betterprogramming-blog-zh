<html>
<head>
<title>iOS-factor: Best Practices for Building High-Quality iOS Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS因素:构建高质量iOS应用的最佳实践</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ios-factor-best-practices-for-building-high-quality-ios-apps-4046b1dd72d4?source=collection_archive---------4-----------------------#2019-08-07">https://betterprogramming.pub/ios-factor-best-practices-for-building-high-quality-ios-apps-4046b1dd72d4?source=collection_archive---------4-----------------------#2019-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3d96" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">每个主题都包含一个因素，描述了iOS应用程序开发的理想状态</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5db2c6a74d173388731f94995c4c426d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f6TYEJYmMlZZixL1"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">埃米尔·普林特在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b1d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那种感觉，当你从Git中取出旧项目时，它不能编译…</p><p id="6e34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">即使这个项目在App Store，“生产就绪”，之前的开发者也没有维护好。可能的原因有很多—弃用<a class="ae kv" href="https://developer.apple.com/swift/" rel="noopener ugc nofollow" target="_blank"> Swift </a>版本、外部依赖、证书缺失……</p><p id="8c67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://ios-factor.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> iOS-factor </em> </a>的灵感来自著名的<a class="ae kv" href="https://www.12factor.net/" rel="noopener ugc nofollow" target="_blank">十二因子App框架</a>，<br/>一种编写高质量web服务的方法论。iOS-factor使用相同的结构和相似的原则，重新编写并应用于iOS应用程序开发流程。</p><p id="f601" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它旨在为构建高端iOS应用程序提供一组最佳实践。</p><p id="0789" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个主题都包含一个因素，该因素描述了iOS应用程序开发流程的某个类别的理想状态。</p><p id="c344" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文是一个总结。也可以看<a class="ae kv" href="https://ios-factor.com/" rel="noopener ugc nofollow" target="_blank">全系列</a>。这个项目是由费利克斯·克劳斯发起的。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="8909" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">TL；速度三角形定位法(dead reckoning)</h1><ol class=""><li id="0f7b" class="ms mt iq ky b kz mu lc mv lf mw lj mx ln my lr mz na nb nc bi translated"><a class="ae kv" href="https://ios-factor.com/dependencies" rel="noopener ugc nofollow" target="_blank">依赖关系</a>:显式声明并隔离依赖关系。</li><li id="410e" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated"><a class="ae kv" href="https://ios-factor.com/config" rel="noopener ugc nofollow" target="_blank">配置</a>:代码中没有配置，附带默认配置，允许OTA更新。</li><li id="e33c" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated"><a class="ae kv" href="https://ios-factor.com/dev-prod-parity" rel="noopener ugc nofollow" target="_blank">开发/生产对等</a>:让开发、测试和生产尽可能相似。</li><li id="7377" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated"><a class="ae kv" href="https://ios-factor.com/deployment" rel="noopener ugc nofollow" target="_blank">部署</a>:自动化您的部署，这样您就可以从任何机器上发布它。</li><li id="5a03" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated"><a class="ae kv" href="https://ios-factor.com/prefer-local-over-remote" rel="noopener ugc nofollow" target="_blank">更喜欢本地而不是远程</a>:让iOS应用足够智能，尽可能不使用后端。</li><li id="0c59" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated"><a class="ae kv" href="https://ios-factor.com/backwards-compatible-apis" rel="noopener ugc nofollow" target="_blank">向后兼容的API</a>。</li><li id="ad7d" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated"><a class="ae kv" href="https://ios-factor.com/app-versioning" rel="noopener ugc nofollow" target="_blank">应用版本化</a>:自动化应用的内部版本号和版本号以保持一致性。</li><li id="9a7d" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated"><a class="ae kv" href="https://ios-factor.com/rollbacks" rel="noopener ugc nofollow" target="_blank">回滚</a>:恢复导致问题的构建。</li><li id="9855" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated"><a class="ae kv" href="https://ios-factor.com/persistence-of-data" rel="noopener ugc nofollow" target="_blank">数据的持久性</a>:存储数据时遵循苹果指南。</li></ol></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="1822" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">1.属国</h1><p id="4bd5" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">理想情况下，您的构建工具从不依赖于系统级包的隐式存在。</p><p id="6e6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它通过依赖项声明清单完整准确地声明所有依赖项。这包括<a class="ae kv" href="https://developer.apple.com/xcode/" rel="noopener ugc nofollow" target="_blank"> Xcode </a>、<a class="ae kv" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>和<a class="ae kv" href="https://fastlane.tools/" rel="noopener ugc nofollow" target="_blank"> fastlane </a>的确切版本。</p><p id="b89d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">显式依赖声明的好处是，它简化了新开发人员对应用程序的设置，以及拥有一个可靠的构建系统，该系统还能够以可重复的方式再次运行过去的构建。</p><p id="b500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于iOS开发不能容器化，就像web开发的情况一样，我们仅限于使用第三方工具来满足这一需求，直到苹果提供官方解决方案。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="96b2" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">2.配置</h1><p id="490e" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">应用程序有时会将配置作为常量存储在代码中。这违反了iOS-factor，它要求将配置与代码严格分离。配置在不同的部署中有很大的不同，代码则没有。</p><p id="bb94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有许多方法可以在构建时注入配置值:</p><ul class=""><li id="3594" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr no na nb nc bi translated">配置文件(如<a class="ae kv" href="https://www.json.org/" rel="noopener ugc nofollow" target="_blank"> JSON </a>或<a class="ae kv" href="https://yaml.org/" rel="noopener ugc nofollow" target="_blank"> YAML </a>文件)。</li><li id="179a" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated"><a class="ae kv" href="https://github.com/orta/cocoapods-keys" rel="noopener ugc nofollow" target="_blank"> CocoaPods-keys </a>在构建期间正确隐藏密钥并将其应用到您的iOS应用程序。</li><li id="7bcb" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">定制解决方案(例如，使用构建阶段)。</li></ul><p id="d554" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于iOS平台上的部署比服务器部署慢得多，您可能需要一种快速更新空中配置(OTA)的方式来快速响应问题。</p><p id="2d8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">OTA配置更新功能强大，允许您立即:</p><ul class=""><li id="484b" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr no na nb nc bi translated">运行A/B测试，以便仅为部分活动用户启用某些功能或UI更改。</li><li id="18c5" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">旋转API密钥。</li><li id="8537" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">更新已更改的web主机或其他URL。</li><li id="2547" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">远程禁用功能或隐藏按钮。</li></ul><p id="b351" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">实现配置OTA更新的潜在方法:</p><ul class=""><li id="073c" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr no na nb nc bi translated">实施您自己的解决方案。</li><li id="73a0" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">专有web服务，如<a class="ae kv" href="https://firebase.google.com/docs/remote-config/" rel="noopener ugc nofollow" target="_blank"> Firebase远程配置</a>。</li><li id="2b36" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">像<a class="ae kv" href="https://github.com/rwbutler/FeatureFlags" rel="noopener ugc nofollow" target="_blank">这样的开源服务标志着</a>。</li></ul></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="22e9" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">3.开发/生产平价</h1><p id="af1f" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">从历史上看，开发(开发人员在他们的本地机器上对应用程序进行实时编辑)和生产(应用程序部署在应用程序商店上，由最终用户访问)之间有很大的差距。</p><ul class=""><li id="e7eb" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr no na nb nc bi translated"><strong class="ky ir">时间差:</strong>一个开发人员可能需要几天、几周甚至几个月的时间来开发代码。</li><li id="1c42" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated"><strong class="ky ir">人员缺口:</strong>所有iOS开发者写代码，只有一个人知道如何部署app。</li><li id="fdb1" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated"><strong class="ky ir">工具差距:</strong>开发人员可能正在使用一个运行不同版本的临时服务器。开发人员可能会使用与部署版本不同的Xcode版本。</li></ul><p id="26f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">iOS-factor应用程序旨在通过缩小开发和生产之间的差距来实现<a class="ae kv" href="https://avc.com/2011/02/continuous-deployment/" rel="noopener ugc nofollow" target="_blank">持续部署</a>。</p><p id="b792" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看看上面描述的三个差距:</p><ul class=""><li id="d61c" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr no na nb nc bi translated">让时间差距变小。开发人员可能会编写代码并在几天后部署。</li><li id="40ee" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">让人员差距变小。编写代码的开发人员密切参与部署它，并观察它在生产中的行为。要做到这一点，最好的方法是完全自动化你的iOS应用程序的发布过程，并将技术诀窍放在代码声明中，而不是文档中。</li><li id="79a0" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">使工具间隙变小。让开发和生产尽可能相似。遵循iOS-factor的<a class="ae kv" href="https://ios-factor.com/dependencies" rel="noopener ugc nofollow" target="_blank">依赖关系</a>因素的原则，使用<code class="fe np nq nr ns b">.xcode-version</code>文件，并明确定义所有其他依赖关系。</li></ul></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="291d" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">4.部署</h1><p id="da80" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">如<a class="ae kv" href="https://ios-factor.com/dependencies" rel="noopener ugc nofollow" target="_blank">依赖性</a>因素中所述，代码库应该包括构建、测试和发布iOS应用程序所需的所有依赖性。</p><p id="5c73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不幸的是，因为Xcode必须在macOS上运行，所以我们不能使用<a class="ae kv" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>或容器。</p><p id="e5f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目前，作为iOS开发者，我们可以采取的最佳方法是:</p><ul class=""><li id="4eef" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr no na nb nc bi translated">使用<a class="ae kv" href="https://github.com/krausefx/xcode-install" rel="noopener ugc nofollow" target="_blank"> Xcode::Install </a>自动安装Xcode。</li><li id="ab08" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">利用一个<a class="ae kv" href="https://github.com/fastlane/ci/blob/master/docs/xcode-version.md" rel="noopener ugc nofollow" target="_blank">。xcode版本文件</a>指定确切的Xcode版本。</li><li id="a0e7" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">在配置文件中定义所有依赖关系(参见d <a class="ae kv" href="https://ios-factor.com/dependencies" rel="noopener ugc nofollow" target="_blank">依赖关系</a>因素)。</li><li id="3ad0" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">使用像<a class="ae kv" href="https://fastlane.tools/" rel="noopener ugc nofollow" target="_blank"> fastlane </a>这样的部署工具来自动化整个部署过程。</li><li id="b443" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">自动化代码签名(例如<a class="ae kv" href="https://codesigning.guide/" rel="noopener ugc nofollow" target="_blank"> codesigning.guide </a>)。</li><li id="8086" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">经常部署，最好是每周一次。</li></ul></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="1a85" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">5.更喜欢本地而不是远程</h1><p id="af9e" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">近年来，一些开发团队已经开始使用需要更少开发工作的方法，以牺牲用户的应用程序体验为代价。他们将更多的逻辑转移到远程后端，并让iOS应用程序成为显示服务器结果的瘦客户端。</p><p id="b0fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当应用程序在互联网连接不太好的情况下使用时，这种方法会让用户感到沮丧。</p><p id="9713" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于各种原因，应用程序应该尽可能多地在设备上执行业务逻辑和计算:</p><ul class=""><li id="fa00" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr no na nb nc bi translated">隐私:避免向远程服务器发送数据。</li><li id="a506" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">速度:向服务器发送数据并等待响应需要时间，并且可能会失败(例如不稳定的WiFi)。</li><li id="8cbb" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">数据使用:用户通常有每月数据限制。</li><li id="ba71" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">扩展:如果你的应用流行，你有责任扩展后端服务。</li><li id="b988" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">电池寿命:使用移动数据对电池寿命来说是昂贵的。</li><li id="77c0" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">可靠性:一些国家仍然有不可靠的LTE/3G连接。</li></ul><p id="5942" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你的应用程序需要互联网连接(例如社交网络应用程序或拼车应用程序)，你的应用程序应该仍然可以在没有互联网连接的情况下工作(只读模式)，以访问历史数据(例如最近的骑行，最近的直接消息)。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="d1ef" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">6.向后兼容的API</h1><p id="c763" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">虽然大多数最终用户会在几周内更新到最新版本，但总有一小部分用户不会。</p><p id="777e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本的概念是，不要更新现有的API，而是添加一个新的API，让它们并行运行。</p><pre class="kg kh ki kj gt nt ns nu nv aw nw bi"><span id="56cf" class="nx mb iq ns b gy ny nz l oa ob">https://your-api.com/1.0/drivers.json<br/>https://your-api.com/1.1/drivers.json</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="9308" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">7.应用版本控制</h1><p id="8f06" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">版本号和内部版本号一起工作，唯一地识别应用的特定应用商店提交<strong class="ky ir"> : </strong></p><ul class=""><li id="91c4" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr no na nb nc bi translated">版本号(<code class="fe np nq nr ns b">CFBundleShortVersionString</code> ) —在Xcode中显示为<code class="fe np nq nr ns b">Version</code>。它也被称为营销版本:对最终用户可见的版本。它必须在每次公共应用商店发布时递增。</li><li id="ce66" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">构建号(<code class="fe np nq nr ns b">CFBundleVersion</code> ) —在Xcode中显示为<code class="fe np nq nr ns b">Build</code>:一个递增的数字。</li></ul><p id="52ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在今天的iOS开发过程中，没有理由手动更改这些数字。</p><p id="1899" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不需要使用第三方工具，Xcode内置了一个叫做<code class="fe np nq nr ns b">agvtool</code>的工具。(<a class="ae kv" href="https://developer.apple.com/library/content/qa/qa1827/_index.html" rel="noopener ugc nofollow" target="_blank">更多详情</a>)。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="ff45" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">8.卷回</h1><p id="2ad0" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">App Store本身不允许回滚，因此本节将描述如何使用现有的技术实现类似的结果。</p><p id="28c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用分阶段发布，您可以从活动用户的一个子集开始，慢慢地将一个构建推广到生产。</p><p id="591b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种方法的主要好处是内置了在大量用户使用之前暂停部署的方法，允许您替换二进制文件。</p><p id="ddcc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，即使是分阶段发布，也没有办法完全撤销一个构建。</p><p id="1b36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与分阶段发布一样，App Store和<a class="ae kv" href="https://developer.apple.com/testflight/" rel="noopener ugc nofollow" target="_blank"> TestFlight </a>版本只能通过以下方式更新:</p><ol class=""><li id="6a47" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr mz na nb nc bi translated">在版本控制系统中返回到您想要回滚到的状态。</li><li id="2403" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">增加项目的版本号或内部版本号。</li><li id="71be" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">构建和共同设计您的应用程序。</li><li id="fcb2" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">通过测试服务或应用商店分发你的应用。</li><li id="9c5a" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">用户必须更新他们手机上的应用程序。</li></ol><p id="c03c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上述步骤可以手动完成，但是，建议完全自动化该过程，以便您可以快速做出反应。</p><p id="3dd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">替代方案:放弃旧建筑:</p><ol class=""><li id="c4b8" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr mz na nb nc bi translated">访问引入回归之前的旧构建(<code class="fe np nq nr ns b">.ipa</code>文件)。</li><li id="81ab" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">更新<code class="fe np nq nr ns b">Info.plist</code>文件中的版本/内部版本号。</li><li id="399e" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">放弃构建。</li><li id="d7d8" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr mz na nb nc bi translated">将其作为新版本分发。</li></ol><p id="0236" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，重新签名iOS应用程序通常会带来更多问题，尤其是因为Xcode命令行工具没有提供好的方法来做到这一点。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="9eaa" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">9.数据的持久性</h1><p id="162b" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">根据苹果的指导方针存储数据和配置对于应用的生命周期至关重要，特别是在iCloud sync、升级到新手机以及从备份恢复手机时。</p><p id="a888" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保您遵循苹果官方的<a class="ae kv" href="https://developer.apple.com/icloud/documentation/data-storage/index.html" rel="noopener ugc nofollow" target="_blank"> iOS数据存储指南</a>:</p><ul class=""><li id="0f89" class="ms mt iq ky b kz la lc ld lf nl lj nm ln nn lr no na nb nc bi translated"><code class="fe np nq nr ns b">Documents</code>:将此目录用于用户生成的内容，它将被备份。</li><li id="342d" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated"><code class="fe np nq nr ns b">Caches</code>:将该目录用于可以重新生成的数据。</li><li id="1e9c" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated"><code class="fe np nq nr ns b">tmp</code>:使用这个目录存放临时文件。</li><li id="68fb" class="ms mt iq ky b kz nd lc ne lf nf lj ng ln nh lr no na nb nc bi translated">利用文件的<code class="fe np nq nr ns b">do not back up</code>属性。</li></ul><p id="18c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要在这些目录中存储敏感的用户信息(如密码或会话)。相反，使用<a class="ae kv" href="https://developer.apple.com/documentation/security/keychain_services" rel="noopener ugc nofollow" target="_blank">钥匙串API </a>。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="29ad" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">结论</h1><p id="d77d" class="pw-post-body-paragraph kw kx iq ky b kz mu jr lb lc mv ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">这是一个活项目，由iOS开发社区维护。</p><p id="bd0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在<a class="ae kv" href="https://github.com/ios-factor/ios-factor.com" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到完整的源代码，更新现有页面，或者添加新的因素。</p></div></div>    
</body>
</html>