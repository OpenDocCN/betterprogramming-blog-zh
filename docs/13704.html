<html>
<head>
<title>Implement Core Spotlight in a SwiftUI App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SwiftUI应用中实施Core Spotlight</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implement-core-spotlight-in-a-swiftui-app-859cb703f55d?source=collection_archive---------6-----------------------#2022-09-18">https://betterprogramming.pub/implement-core-spotlight-in-a-swiftui-app-859cb703f55d?source=collection_archive---------6-----------------------#2022-09-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="69bf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第1部分，共2部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/27f16dbd714f2d5ab33509e8cc236a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AD6zBUpnf2W221eut7Go4Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·温克勒在<a class="ae kv" href="https://unsplash.com/s/photos/magnifying-glass?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5347" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Spotlight是苹果设备上功能强大的搜索系统，我们都喜欢使用它来从我们最喜爱的应用程序中快速找到我们的内容，并与它们进行互动。</p><p id="15f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过使用<a class="ae kv" href="https://developer.apple.com/documentation/corespotlight" rel="noopener ugc nofollow" target="_blank"> Core Spotlight API </a>，您的应用程序还可以利用这一强大的搜索引擎的力量，使其内容可以快速轻松地访问(以及更多)。在Spotlight上发布你的应用程序内容不仅能给用户带来很好的体验，还能立即增加你的应用程序的多样性。</p><p id="0a19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个由两部分组成的系列是一个全面而简单的指南，将帮助您使用SwiftUI应用程序中的核心Spotlight API，在苹果设备上充分利用Spotlight search的强大功能。</p><p id="5189" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第1部分中，我们将介绍一些基本内容，包括:</p><ol class=""><li id="647d" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">索引:在Spotlight搜索中显示您的应用数据</li><li id="f45a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">删除:从Spotlight搜索中移除您的应用数据</li><li id="e828" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">处理:处理用户在Spotlight搜索项目上的点击</li></ol><p id="5a40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第2部分的后面，我们将讨论一些高级主题，包括spotlight搜索结果的自定义操作、自定义预览、继续应用内搜索等等。</p><blockquote class="mg mh mi"><p id="8972" class="kw kx mj ky b kz la jr lb lc ld ju le mk lg lh li ml lk ll lm mm lo lp lq lr ij bi translated">请注意:本文不是为了使用Core Spotlight来索引核心数据项。如果这是您的使用案例，我建议您观看本课程:</p></blockquote><div class="mn mo gp gr mp mq"><a href="https://developer.apple.com/videos/play/wwdc2021/10098/" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd ir gy z fp mv fr fs mw fu fw ip bi translated">在Spotlight中展示应用数据- WWDC21 -视频-苹果开发者</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">在Spotlight中，只需两行代码，即可了解核心数据如何从您的应用中呈现数据。学习如何…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">developer.apple.com</p></div></div></div></a></div><p id="f5d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们开始吧！</p><h1 id="7e2a" class="mz na iq bd nb nc nd ne nf ng nh ni nj jw nk jx nl jz nm ka nn kc no kd np nq bi translated">1)索引:在Spotlight搜索中显示你的应用数据</h1><p id="0365" class="pw-post-body-paragraph kw kx iq ky b kz nr jr lb lc ns ju le lf nt lh li lj nu ll lm ln nv lp lq lr ij bi translated">让我们从一个新的示例项目开始。</p><ul class=""><li id="1e7d" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nw ly lz ma bi translated">首先，要使用核心Spotlight API，我们需要导入它:</li></ul><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="911f" class="oc na iq ny b gy od oe l of og"><strong class="ny ir">import</strong> CoreSpotlight</span></pre><ul class=""><li id="3f47" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nw ly lz ma bi translated">接下来，让我们定义一些将在应用程序和Spotlight搜索中显示的示例应用程序数据。您的代码看起来会像这样:</li></ul><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="f7ef" class="oc na iq ny b gy od oe l of og"><strong class="ny ir">import</strong> SwiftUI<br/><strong class="ny ir">import</strong> CoreSpotlight</span><span id="8c79" class="oc na iq ny b gy oh oe l of og"><strong class="ny ir">struct</strong> ContentView: View {<br/>    // Sample app-data<br/>    <strong class="ny ir">let</strong> appData = [102, 503, 653, 998, 124, 587, 776, 354, 449, 287]</span><span id="ecb1" class="oc na iq ny b gy oh oe l of og"><strong class="ny ir">    var</strong> body: <strong class="ny ir">some</strong> View {<br/>    }<br/>}</span></pre><ul class=""><li id="15fa" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nw ly lz ma bi translated">现在，让我们创建一个基本的UI，在列表中显示我们的应用程序数据。我们还将创建一个索引数据的按钮。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/ce4d9a7820f4dbda9cf93d4014c47288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjkBPU3xeRUbl-YHKmCh4A.png"/></div></div></figure><p id="8a57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的基础工作已经就绪。然而，如果你点击“索引数据”按钮，什么也不会发生，因为<code class="fe oj ok ol ny b">indexData()</code>方法现在是空的。现在是时候编写代码来索引我们的数据并自动显示在Spotlight搜索中了！</p><p id="60d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了索引数据，Core Spotlight使用一个名为<code class="fe oj ok ol ny b">CSSearchableItem</code>的特殊对象。我们的app-data是一个由10个元素组成的数组，因此要对它们进行索引，我们必须创建10个相应的CSSearchableItems。所以，让我们从为它创建一个数组开始。</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="0a07" class="oc na iq ny b gy od oe l of og"><strong class="ny ir">func</strong> indexData() {<br/>    <strong class="ny ir">var</strong> searchableItems = [CSSearchableItem]()<br/>}</span></pre><p id="e71d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们通过设置特定元素的属性来控制在Spotlight search中显示哪些数据。这也是使用一个名为<code class="fe oj ok ol ny b">CSSearchableItemAttributeSet</code>的专用对象来完成的。一个基本的实现是:</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="8c42" class="oc na iq ny b gy od oe l of og">appData.forEach {<br/>    <strong class="ny ir">let</strong> attributeSet = CSSearchableItemAttributeSet(contentType: .content)<br/>    attributeSet.displayName = $0.description<br/>}</span></pre><p id="f527" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们使用这个属性集来创建<code class="fe oj ok ol ny b">CSSearchableItem</code>对象，附加到我们之前定义的数组，最后提交它进行索引。瞧，我们完成了！</p><p id="164e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以最后，<code class="fe oj ok ol ny b">indexData()</code>方法看起来会像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="4cc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然大部分都很简单，但我想再解释一下<code class="fe oj ok ol ny b">CSSearchableItem</code>对象的创建。</p><p id="3c88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe oj ok ol ny b">CSSearchableItem</code>初始化器有三个参数:</p><ol class=""><li id="bae7" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><code class="fe oj ok ol ny b">uniqueIdentifier</code>:用于给被索引的元素一个唯一的id。虽然这是一个可选属性，但建议您设置它，因为它还用于通过标识项目来处理用户交互。</li><li id="bdae" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe oj ok ol ny b">domainIdentifier</code>:用于以有意义的方式对数据进行分组。例如:一个音乐应用程序可能会使用域id，如“歌曲”、“专辑”等。虽然这是一个可选属性，但通常建议设置它。</li><li id="bce7" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><code class="fe oj ok ol ny b">attributeSet</code>:我们传递我们在这里创建的<code class="fe oj ok ol ny b">CSSearchableItemAttributeSet</code>对象。</li></ol><p id="6702" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在Spotlight search中索引应用程序数据的代码现在已经可以使用了。如果我们点击“索引数据”按钮，然后在Spotlight中搜索，我们应该能够在结果中看到我们索引的应用程序内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/53ad714dab189a4f5ceb5785180891d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fzW4SS9XsEcObjhDB6lzJg.png"/></div></div></figure><p id="9a80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用属性集来改变我们的应用程序在Spotlight中显示的数据。例如，如果我们设置我们的<code class="fe oj ok ol ny b">attributeSet</code>的<code class="fe oj ok ol ny b">thumbnailData</code>和<code class="fe oj ok ol ny b">phoneNumbers</code>属性，搜索结果看起来像:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/2411bd5cb6039e7109aa1889736d5423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-rWSCu2m3VpEWLH6pFJMA.jpeg"/></div></div></figure><h1 id="fbf8" class="mz na iq bd nb nc nd ne nf ng nh ni nj jw nk jx nl jz nm ka nn kc no kd np nq bi translated">2.删除:从Spotlight搜索中移除您的应用数据</h1><p id="ce3d" class="pw-post-body-paragraph kw kx iq ky b kz nr jr lb lc ns ju le lf nt lh li lj nu ll lm ln nv lp lq lr ij bi translated">从Spotlight index中删除/移除应用数据相当简单:</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="88f6" class="oc na iq ny b gy od oe l of og"><strong class="ny ir">func</strong> deleteData() {<br/>  CSSearchableIndex.default()<br/>    .deleteSearchableItems(withDomainIdentifiers: ["sample"])<br/>}</span></pre><p id="df26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你开始在Xcode中输入代码，你会意识到(由于自动完成)有多种方法可以删除可搜索的项目。</p><p id="9c5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面是一个例子，您可以删除一组特定的域标识符的可搜索项目。由于我们在索引时使用了相同的域标识符(“sample”)，这将删除我们的示例应用程序中所有被索引的项目。</p><h1 id="5b30" class="mz na iq bd nb nc nd ne nf ng nh ni nj jw nk jx nl jz nm ka nn kc no kd np nq bi translated">3.处理:处理用户在Spotlight搜索项目上的点击</h1><p id="a92b" class="pw-post-body-paragraph kw kx iq ky b kz nr jr lb lc ns ju le lf nt lh li lj nu ll lm ln nv lp lq lr ij bi translated">每当用户点击你的应用程序的Spotlight搜索结果时，系统会通过<code class="fe oj ok ol ny b">NSUserActivity</code>通知这一点以及一些有用的信息。</p><p id="ecf8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了让你的应用程序获得相关的NSUserActivity，SwiftUI有一个名为<code class="fe oj ok ol ny b">onContinueUserActivity</code>的修饰符。像这样把它应用到你的主视图上:</p><pre class="kg kh ki kj gt nx ny nz oa aw ob bi"><span id="0bed" class="oc na iq ny b gy od oe l of og">.onContinueUserActivity(CSSearchableItemActionType, perform: handleSpotlight)</span></pre><p id="cf80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe oj ok ol ny b">CSSearchableItemActionType</code>是核心Spotlight API的一部分(因此确保导入它)。这确保了<code class="fe oj ok ol ny b">handleSpotlight</code>方法只接收Spotlight交互的NSUserActivity。</p><blockquote class="mg mh mi"><p id="ba27" class="kw kx mj ky b kz la jr lb lc ld ju le mk lg lh li ml lk ll lm mm lo lp lq lr ij bi translated">额外提示:要获得多个用户活动，您将使用相应的键多次应用此修改器。</p></blockquote><p id="2e2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们看看<code class="fe oj ok ol ny b">handleSpotlight</code>方法包含了什么:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="9735" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用您在这里接收的NSUserActivity对象，您可以检索您在索引数据时创建<code class="fe oj ok ol ny b">CSSearchableItem</code>对象时传递的<code class="fe oj ok ol ny b">uniqueIdentifier</code>。</p><p id="6cd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过这种方式，你可以识别点击的元素，然后根据你的应用程序的用例来处理它。</p><p id="c6fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在附带的<a class="ae kv" href="https://github.com/yugantarjain/Core-Spotlight-in-SwiftUI-Part-1" rel="noopener ugc nofollow" target="_blank"> GitHub项目</a>中，实现了导航到所选元素的详细视图的最常见处理场景，供您参考。</p></div><div class="ab cl op oq hu or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ij ik il im in"><p id="7e96" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读！我希望你觉得这篇文章有用、简单、有趣。</p></div></div>    
</body>
</html>