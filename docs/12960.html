<html>
<head>
<title>Create a Geolocation-enabled Photo Manager Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python创建支持地理定位的照片管理器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/geolocation-enabled-photo-manager-using-pytho-df6e2b75a06e?source=collection_archive---------8-----------------------#2022-07-14">https://betterprogramming.pub/geolocation-enabled-photo-manager-using-pytho-df6e2b75a06e?source=collection_archive---------8-----------------------#2022-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cd0f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在这篇博文中，我使用Python和PostGIS数据库创建了一个应用程序来帮助排序我的照片库。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cb3f6ad1e8f980fff0f0611073026218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z23-msQMIGZzpBV5GIDIPg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在DBeaver CE中查看的数据库记录显示了距离珀斯市50公里以内的照片位置。</p></figure><h1 id="2d00" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">问题陈述</h1><p id="75ad" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我最近在笔记本电脑上重新安装了操作系统，并将不同设备上的各种备份照片放在一个位置。由此产生的文件夹看起来像一个绝对的混乱。不同的手机和其他设备有不同的备份，其中一些具有非常复杂的文件夹结构。而且除了几个专题文件夹名，所有照片都是完全没有排序的。</p><p id="ca05" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">我真的对手工分类不感兴趣，并认为这将是一个编写我一直在考虑的照片管理应用程序的好机会。我对这个应用程序有以下要求:</p><ul class=""><li id="818d" class="mo mp iq lp b lq mj lt mk lw mq ma mr me ms mi mt mu mv mw bi translated">它必须接受命令行参数，这样我才能在bash脚本中使用它</li><li id="9d32" class="mo mp iq lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">它必须基于一个数据库来存储所有必要的信息</li><li id="5bc3" class="mo mp iq lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">我需要能够通过日期和位置排序和定位照片</li><li id="0546" class="mo mp iq lp b lq mx lt my lw mz ma na me nb mi mt mu mv mw bi translated">我希望能够识别照片中的人和各种物体，并根据这些来过滤照片</li></ul><p id="e1a0" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在这篇博文中，我将展示如何从照片中提取必要的元数据，创建和填充PostGIS数据库，并能够按位置查询图像。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="76fe" class="kv kw iq bd kx ky nj la lb lc nk le lf jw nl jx lh jz nm ka lj kc nn kd ll lm bi translated">提取元数据</h1><p id="7b1f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在之前的博文中，我描述了如何从照片中提取和使用地理位置数据:</p><div class="no np gp gr nq nr"><a rel="noopener  ugc nofollow" target="_blank" href="/visualising-photo-geolocation-data-using-python-73ac47059112"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">使用Python可视化照片地理定位数据</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">让我们利用exif和follow Python包</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">better编程. pub</p></div></div><div class="oa l"><div class="ob l oc od oe oa of kp nr"/></div></div></a></div><p id="2074" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">主要的区别是，在那个例子中，我在Jupyter笔记本上运行代码，但是对于这个项目，我需要将它转换成一个更加模块化的代码。如果你想详细了解地理位置数据是如何存储在照片中的，以及需要做哪些处理，请参考上面链接的帖子。</p><p id="d536" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">代码的第一部分是一个简单的dataclass，它将查找指定文件夹中的所有图像文件。这里我使用<code class="fe og oh oi oj b">attrs</code>模块来实现dataclass，因为它比标准库data class有更好的性能。我还缓存了该属性，这样每次调用它时就不会重新计算。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="5915" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">该类默认搜索所有常见的(和一些不常见的)图像扩展，但这种行为可以在创建实例时改变。</p><p id="99eb" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">下一部分是负责从图像中实际提取元数据的类。特别是，我将提取以下元数据:位置(纬度、经度、高度)、时间戳、gps_accuracy、照片的方向以及相机/手机的品牌和型号。这里，在大多数情况下，我所有照片的gps_accuracy和照片的方向都是空白的，但我仍在提取它，以防将来会有用。</p><p id="d70a" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">坐标被转换成十进制使用相同的函数，我在以前的博客文章中使用，所以你可以参考那里的更多细节。</p><p id="62e2" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">除了主<code class="fe og oh oi oj b">MetadataExtractor</code>类，我还定义了几个数据类作为接口，以实现一致的数据格式并简化输入。dataclass <code class="fe og oh oi oj b">RawCoordinates</code>用于存储从图像中提取的原始坐标，其中纬度和经度以整数元组(弧度的度、分和秒)的形式存储，并附有相关的半球参考。</p><p id="55c8" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">最终的输出数据存储在一个<code class="fe og oh oi oj b">PhotoData</code>类对象中，该类对象的大多数参数都带有预定义的值。您可以将它们设置为您喜欢的任何值，但只需确保纬度和经度的默认值在(-180，180)范围之外。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="1ff0" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">所以这负责所有的元数据提取。对于我在几十个文件夹中收集的大约10，000张照片，数据提取需要大约25秒。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="2735" class="kv kw iq bd kx ky nj la lb lc nk le lf jw nl jx lh jz nm ka lj kc nn kd ll lm bi translated">PostGIS数据库</h1><h2 id="59df" class="om kw iq bd kx on oo dn lb op oq dp lf lw or os lh ma ot ou lj me ov ow ll ox bi translated">安装</h2><p id="d982" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这里的首要任务是在localhost上建立一个PostgreSQL数据库。我正在使用Fedora，所以我使用了以下官方文档:</p><div class="no np gp gr nq nr"><a href="https://docs.fedoraproject.org/en-US/quick-docs/postgresql/" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">一种数据库系统</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">postgresql服务器使用两个主要配置文件sudo gedit/var/lib/pgsql/data/pg _ HBA . conf和edit host…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">docs.fedoraproject.org</p></div></div></div></a></div><p id="bd26" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">对于Windows，可在以下位置获得设置说明:</p><div class="no np gp gr nq nr"><a href="https://www.microfocus.com/documentation/idol/IDOL_12_0/MediaServer/Guides/html/English/Content/Getting_Started/Configure/_TRN_Set_up_PostgreSQL.htm" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">在Windows上设置PostgreSQL数据库</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">使用导航打开主题要将媒体服务器与PostgreSQL数据库一起使用，您必须下载并安装PostgreSQL…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">www.microfocus.com</p></div></div><div class="oa l"><div class="oy l oc od oe oa of kp nr"/></div></div></a></div><p id="0aac" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">一旦完成，您还需要安装PostGIS扩展，在普通的Linux发行版上可以使用:</p><p id="8f9e" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><code class="fe og oh oi oj b">sudo dnf install postgis</code></p><p id="a125" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><code class="fe og oh oi oj b">sudo apt install postgis</code></p><p id="3a43" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">对于Windows，您可以从以下官方网站下载安装程序:</p><div class="no np gp gr nq nr"><a href="https://postgis.net/windows_downloads/" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">Windows下载</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">如果您在使用这些包(安装程序和buildbot二进制文件)时需要帮助，请询问我们的用户邮件列表。如果…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">postgis.net</p></div></div><div class="oa l"><div class="oz l oc od oe oa of kp nr"/></div></div></a></div><p id="8fc4" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">最后，我们使用<code class="fe og oh oi oj b">psql</code>创建一个新的数据库，添加一个PostGIS扩展，并创建一个运行脚本的用户，在我的例子中这个用户叫做<code class="fe og oh oi oj b">gis</code>:</p><p id="3264" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><code class="fe og oh oi oj b">sudo -U postgres psql</code></p><p id="1bfb" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">现在，一旦进入<code class="fe og oh oi oj b">psql</code>提示:</p><pre class="kg kh ki kj gt pa oj pb pc aw pd bi"><span id="cc1b" class="om kw iq oj b gy pe pf l pg ph">CREATE DATABASE photo;<br/>CREATE USER gis WITH PASSWORD gis;<br/>\connect photo<br/>CREATE EXTENSION postgis;<br/>ALTER SCHEMA public OWNER TO gis;</span></pre><p id="7009" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这通常就足够了，但是如果您不断遇到认证问题，您可能需要编辑PostgreSQL配置文件(如上述指南中所述)并将<code class="fe og oh oi oj b">ident</code>登录方法更改为<code class="fe og oh oi oj b">md5</code>。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h2 id="cb2f" class="om kw iq bd kx on oo dn lb op oq dp lf lw or os lh ma ot ou lj me ov ow ll ox bi translated">创建模式</h2><p id="f274" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">目前，我正在创建一个只有3个表的相对简单的模式。核心表“image”将保存关于照片的所有关键信息，包括路径和所有提取的元数据。它还通过一个中间表与“对象”表有多对多的关系。未来的“对象”表将包含照片中识别的对象的信息，并允许按对象/人进行搜索和过滤。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/c2e10d78d00879df74847b76f8903885.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*ZI-E5RGfW2Oyl58BtBM_9w.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">示例数据库模式。</p></figure><p id="ed56" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">“image”表还有一个对图像路径的独特约束，因为我想避免数据的意外重复。</p><p id="0c36" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">我们将使用<code class="fe og oh oi oj b">sqlalchemy</code>和<code class="fe og oh oi oj b">geoalchemy2</code>来创建模式。对于位置数据，我们将使用来自<code class="fe og oh oi oj b">geoalchemy</code>的<code class="fe og oh oi oj b">Geometry</code>类型。这里，由于我们有3D坐标，我们不能使用常规的<code class="fe og oh oi oj b">POINT</code>对象，而是需要<code class="fe og oh oi oj b">POINTZ</code>，它专门存储第三个坐标中的高度数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="8bfb" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">“object”表将是未来博客文章的重点，目前，它将简单地存储一个惟一的id、一种类型的对象(汽车、人等)。)、对象的名称以及我们将与之匹配的对象的单独存储的提取图像的路径。</p><p id="8ae1" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">此外，请注意我创建的<code class="fe og oh oi oj b">Settings</code>类，在它变得麻烦之前，将所有的应用程序设置保存在一个地方。目前，它只包含连接字符串，但是将来可以很容易地添加其他设置。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="52bb" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">运行这个db_schema脚本应该会创建一个如上图所示的模式。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h2 id="f70c" class="om kw iq bd kx on oo dn lb op oq dp lf lw or os lh ma ot ou lj me ov ow ll ox bi translated">数据库API</h2><p id="8625" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">最后，我们需要创建一个API来简化与数据库的交互。我们将再次使用<code class="fe og oh oi oj b">sqlalchemy</code>，在这个阶段，我们只需要一种方法就可以将数据填充到数据库中。</p><p id="a5fc" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">API方法将获取一个<code class="fe og oh oi oj b">PhotoData</code>对象列表，从它们创建新记录，并在运行完整个列表后提交会话。以前，我对缺失数据使用默认值，以避免类型提示中不必要的复杂性。现在，当填充数据时，我正在检查这些默认值，并在最终的数据库记录中将它们设置为<code class="fe og oh oi oj b">NULL</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="c6f8" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">我们现在可以测试结果。为此，我们在<code class="fe og oh oi oj b">db_api.py</code>中添加了以下代码。代码将首先从选定的文件夹中获取图像路径，然后我们创建一个<code class="fe og oh oi oj b">MetadataExtractor</code>类的实例，并从图像中获取所有元数据。最后，我们将所有数据上传到数据库:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="a3a4" class="kv kw iq bd kx ky nj la lb lc nk le lf jw nl jx lh jz nm ka lj kc nn kd ll lm bi translated">想象结果</h1><p id="98a2" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">既然一切都已说了，做了，我们可以可视化我们的数据。我推荐使用<a class="ae pj" href="https://dbeaver.io/" rel="noopener ugc nofollow" target="_blank"> DBeaver </a>，因为它附带了免费的地图服务，并且适用于大多数操作系统。</p><p id="f313" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在“图像”表中，双击“位置”列中的一个值将在右侧显示一个映射扩展，您可以在其中选择几个可用的映射引擎之一。</p><p id="4118" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在我的例子中，选择一个记录子集显示了下面的映射:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/161b6f21bf28f91fa0a502f024431490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9nj-O7A8n5Or-Qmfme05hw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">数据库中照片子集的位置。</p></figure><p id="ba9c" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">看起来我在澳大利亚拍了一些照片，也在香港拍了一些。</p><p id="325a" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">我们也可以开始搜索和过滤数据。例如，我可能想要查看从西澳大利亚珀斯市中心100公里范围内拍摄的所有照片。为此，PostGIS提供了大量预定义的可用功能。</p><p id="4a75" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在这种情况下，我将使用<code class="fe og oh oi oj b">ST_DistanceSphere()</code>来计算地球表面球面上两点之间的距离。完整的查询将是:</p><pre class="kg kh ki kj gt pa oj pb pc aw pd bi"><span id="949c" class="om kw iq oj b gy pe pf l pg ph">SELECT * FROM image WHERE ST_DistanceSphere(location, 'POINTZ(-31.95 115.86 0)') &lt;= 100000</span></pre><p id="458d" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">其中(-31，95，115.86，0)是珀斯市中心的坐标。</p><p id="7b0d" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">结果是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cb3f6ad1e8f980fff0f0611073026218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z23-msQMIGZzpBV5GIDIPg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">华盛顿珀斯附近的照片位置。</p></figure><p id="f952" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">现在我们知道这一切都在按预期工作，我们可以添加一个API方法，它将完成过滤出所需图片并将结果复制到磁盘上的一个文件夹中的关键部分。新方法的代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="79dd" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">目前，我们只能按位置和日期范围搜索照片，因此该方法需要输入位置和离位置的距离、开始/结束日期，最后是要复制搜索结果的文件夹。</p><p id="036e" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">当创建一个<code class="fe og oh oi oj b">query</code>时，我们使用相同的<code class="fe og oh oi oj b">ST_DistanceSphere</code>函数来查找从一个特定位置到我们传递输入位置参数的位置的距离。</p><p id="2f12" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">现在使用这种方法，我们可以通过运行以下命令在数据库中复制与以前相同的搜索结果:</p><pre class="kg kh ki kj gt pa oj pb pc aw pd bi"><span id="81ed" class="om kw iq oj b gy pe pf l pg ph">api = DbApi()</span><span id="03f2" class="om kw iq oj b gy pl pf l pg ph">res = api.select_files_and_output(location=(-31.95, 115.86, 0), distance_km=100)</span></pre><p id="40e0" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">唯一不同的是，现在定位的照片将被复制到<code class="fe og oh oi oj b">/home/pavel/Pictures/temp</code>。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="509a" class="kv kw iq bd kx ky nj la lb lc nk le lf jw nl jx lh jz nm ka lj kc nn kd ll lm bi translated">结论</h1><p id="f4da" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">正如开始提到的，我还计划添加搜索特定对象/人的功能，并以类似的方式输出结果，几周后我将在另一篇博客文章中分享。</p><p id="66bd" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">现在，我希望这篇文章展示一些与PostGIS数据库和图像地理定位数据交互的实际工作示例。</p><p id="afb6" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">代码库位于以下位置:</p><div class="no np gp gr nq nr"><a href="https://github.com/pavelcherepan/gisterical/tree/master" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">GitHub-pavelcherepan/gisterial at master</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div><div class="oa l"><div class="pm l oc od oe oa of kp nr"/></div></div></a></div></div></div>    
</body>
</html>