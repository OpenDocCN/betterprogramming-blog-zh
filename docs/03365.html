<html>
<head>
<title>Stop Using If-Else and Start Using When in Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止使用If-Else，开始使用When in Kotlin</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/stop-using-if-else-and-start-using-when-in-kotlin-96485c2a51d2?source=collection_archive---------7-----------------------#2020-02-05">https://betterprogramming.pub/stop-using-if-else-and-start-using-when-in-kotlin-96485c2a51d2?source=collection_archive---------7-----------------------#2020-02-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8975" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Kotlin中的“when”是传统if-else的优雅版本。它提供了优于if-else的可读性和简洁性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c02376275b09992ddefc3d32f7b55d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aphjo-AV1YjZz9kW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@camylla93?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Camylla Battani </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="e287" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="e137" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通常，我们的应用程序需要根据输入的类型来决定做什么。</p><p id="4f76" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这样做的传统方式是使用多个<code class="fe ms mt mu mv b">if else</code>语句——与我们感兴趣的不同输入类型的数量一样多，加上一个可选的默认情况或<code class="fe ms mt mu mv b">else</code>。如果您来自Java，那么您可能已经使用了<code class="fe ms mt mu mv b">switch case</code>语句来实现这一点。</p><p id="04d8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这样做的“现代”方式就像Scala中的<code class="fe ms mt mu mv b">match case</code>和Kotlin中的<code class="fe ms mt mu mv b">when</code>。与传统的<code class="fe ms mt mu mv b">if else</code>或<code class="fe ms mt mu mv b">switch case</code>语句相比，它们的好处是更干净、更简洁、可读性更强。</p><p id="4b97" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这个简短的教程中，我们将学习如何在Kotlin中使用<code class="fe ms mt mu mv b">when</code>语句。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="f5ba" class="kz la it bd lb lc nd le lf lg ne li lj jz nf ka ll kc ng kd ln kf nh kg lp lq bi translated">基本用途</h1><p id="eea1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe ms mt mu mv b">when</code>的基本用途是根据输入值决定如何处理输入。一个典型的例子是一个应用程序，它接受一个数字，并根据这个值对它做一些事情。</p><p id="0bba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这就是在<code class="fe ms mt mu mv b">when</code>语句中的写法:</p><pre class="kj kk kl km gt ni mv nj nk aw nl bi"><span id="4269" class="nm la it mv b gy nn no l np nq">when {<br/>    number &lt; 0 -&gt; <em class="nr">println</em>("please enter a positive number")<br/>    number == 0 -&gt; <em class="nr">println</em>("try any higher number than 0")<br/>    number % 2 == 0 -&gt; <em class="nr">println</em>("event")<br/>    else -&gt; <em class="nr">println</em>("it's an odd number")<br/>}</span></pre><p id="aac3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">很干净，简洁，可读性强，不是吗？</p><p id="b0a2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果将上述语句写成一个<code class="fe ms mt mu mv b">if else</code>语句，它看起来会像这样:</p><pre class="kj kk kl km gt ni mv nj nk aw nl bi"><span id="8fe9" class="nm la it mv b gy nn no l np nq">if (number &lt; 0) {<br/>    <em class="nr">println</em>("please enter a positive number")<br/>} else if (number == 0) {<br/>    <em class="nr">println</em>("try any higher number than 0")<br/>} else if (number % 2 == 0) {<br/>    <em class="nr">println</em>("event")<br/>} else {<br/>    <em class="nr">println</em>("it's an odd number")<br/>}</span></pre><p id="1d1a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们是否都同意<code class="fe ms mt mu mv b">when</code>版本比<code class="fe ms mt mu mv b">if else</code>优雅得多？</p><p id="9003" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意:<code class="fe ms mt mu mv b">when</code>执行第一个匹配的分支(或条件)。所以，条件的顺序很重要。最终，如果没有一个条件匹配，那么它将转到<code class="fe ms mt mu mv b">else</code>分支并执行它。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="922d" class="kz la it bd lb lc nd le lf lg ne li lj jz nf ka ll kc ng kd ln kf nh kg lp lq bi translated">不管有没有争论</h1><p id="c66b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">有了Kotlin的<code class="fe ms mt mu mv b">when</code>，我们也可以给它传递一个参数。让我们看一个如何做到这一点的例子:</p><pre class="kj kk kl km gt ni mv nj nk aw nl bi"><span id="dc17" class="nm la it mv b gy nn no l np nq">when (statusCode) {<br/>    200 -&gt; println("all good")    <br/>    400 -&gt; <em class="nr">println</em>("it's a bad request")<br/>    404 -&gt; <em class="nr">println</em>("that page is not found")<br/>    else -&gt; <em class="nr">println</em>("something went wrong")<br/>}</span></pre><p id="b607" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这个例子中，Kotlin知道我们试图将<code class="fe ms mt mu mv b">statusCode</code>的值与我们在<code class="fe ms mt mu mv b">when</code>子句的条件中指定的值相匹配。因此，Kotlin将此解释为<code class="fe ms mt mu mv b">statusCode == 400</code>，以此类推，直到如果没有匹配到任何内容，则到达<code class="fe ms mt mu mv b">else</code>条件。</p><p id="2585" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">另一件要注意的事情是，我们可以给一个变量赋值，作为<code class="fe ms mt mu mv b">when</code>的参数。让我们看看这意味着什么:</p><pre class="kj kk kl km gt ni mv nj nk aw nl bi"><span id="9183" class="nm la it mv b gy nn no l np nq">data class Payload(val message: String,<br/>                   val statusCode: Int)<br/><br/>val payload = Payload("hello world", 200)<br/><br/>when (val statusCode = payload.statusCode) {<br/>    200 -&gt; <em class="nr">println</em>("all good $statusCode")<br/>    400 -&gt; <em class="nr">println</em>("it's a bad request $statusCode")<br/>    404 -&gt; <em class="nr">println</em>("that page is not found $statusCode")<br/>    else -&gt; <em class="nr">println</em>("something went wrong $statusCode")<br/>}</span></pre><p id="3cef" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我们在<code class="fe ms mt mu mv b">when</code>子句中的多个(如果不是全部)条件中使用同一个变量时，这很有用。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="eaa8" class="kz la it bd lb lc nd le lf lg ne li lj jz nf ka ll kc ng kd ln kf nh kg lp lq bi translated">聪明的演员</h1><p id="3dc0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在某些情况下，我们的应用程序可能接受不同类型的输入(即<code class="fe ms mt mu mv b">Any</code>类型的输入),下一个动作完全基于该输入类型。</p><p id="a22c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一个真实的用例是我们的应用程序使用来自Kafka主题的消息，该主题有多种事件类型(称为<code class="fe ms mt mu mv b">union</code>类型)。我们的<code class="fe ms mt mu mv b">when</code>表达式应该是这样的:</p><pre class="kj kk kl km gt ni mv nj nk aw nl bi"><span id="77a8" class="nm la it mv b gy nn no l np nq">when(event) {<br/>    is CustomerSignUp -&gt; println("create a new customer ${event.customerId}")<br/>    is PurchaseIsMade -&gt; println("charge customer account ${event.accountNo}")<br/>    is EmailIsUpdated -&gt; println("send a verification email to ${event.email}")<br/>    else -&gt; println("unrecognised event $event. ignoring...")<br/>}</span></pre><p id="7777" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果我们将鼠标悬停在<code class="fe ms mt mu mv b">when</code>子句内的事件上，我们的ide(假设是IntelliJ)将提示我们智能转换已应用于该事件。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="9523" class="kz la it bd lb lc nd le lf lg ne li lj jz nf ka ll kc ng kd ln kf nh kg lp lq bi translated">多行语句</h1><p id="0b66" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果需要，我们可以在<code class="fe ms mt mu mv b">when</code>子句中编写多行语句。让我们来看一个例子:</p><pre class="kj kk kl km gt ni mv nj nk aw nl bi"><span id="4c22" class="nm la it mv b gy nn no l np nq">when(event) {<br/>    is CustomerSignUp -&gt; {<br/>        println("create a new customer ${event.customerId}")<br/>        customerTable.save(event)<br/>    }<br/>    is PurchaseIsMade -&gt; {<br/>        println("charge customer account ${event.accountNo}")<br/>        customerService.charge(event)<br/>    }<br/>    is EmailIsUpdated -&gt; {<br/>        println("send a verification email to ${event.email}")<br/>        customerTable.update(event)<br/>    }<br/>    else -&gt; println("unrecognised event $event. ignoring...")<br/>}</span></pre><p id="9cbc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这很方便，尤其是当我们需要对正在处理的值做一些事情的时候。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="911a" class="kz la it bd lb lc nd le lf lg ne li lj jz nf ka ll kc ng kd ln kf nh kg lp lq bi translated">作为一种表达</h1><p id="3963" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以使用<code class="fe ms mt mu mv b">when</code>语句作为表达式来给变量赋值。让我们看一个简单的例子。</p><pre class="kj kk kl km gt ni mv nj nk aw nl bi"><span id="b8a6" class="nm la it mv b gy nn no l np nq">val code: Int = when (command) {<br/>    "FAILED" -&gt; 0<br/>    "SUCCESS" -&gt; 1<br/>    "RETRY" -&gt; 8<br/>    else -&gt; 99<br/>}</span></pre><p id="c94d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在上面的表达式中，我们正在检查<code class="fe ms mt mu mv b">command</code>的值，并基于此，给我们的<code class="fe ms mt mu mv b">code</code>变量赋值。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="1b22" class="kz la it bd lb lc nd le lf lg ne li lj jz nf ka ll kc ng kd ln kf nh kg lp lq bi translated">包裹</h1><p id="5fd1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe ms mt mu mv b">when</code>语句是Kotlin提供的一个很棒的控制流，是传统<code class="fe ms mt mu mv b">if else</code>语句的一个很好的替代。当我们有很多条件要检查某个值时，值得考虑使用<code class="fe ms mt mu mv b">when</code>而不是<code class="fe ms mt mu mv b">if else</code>。</p><p id="341a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我们开始用<code class="fe ms mt mu mv b">when</code>替换长的<code class="fe ms mt mu mv b">if else</code>语句时，我们的代码可读性肯定会提高。</p><p id="04ad" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">就是这样！</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/7ddbe53159f1493a643746cb7a3d3f6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZzLKnbwPlRRYH22I"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@bel2000a?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">贝琳达·费因斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div></div>    
</body>
</html>