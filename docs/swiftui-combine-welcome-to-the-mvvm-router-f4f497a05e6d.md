# 欢迎使用 SwiftUI 和 Combine 的 MVVM 路由器

> 原文：<https://betterprogramming.pub/swiftui-combine-welcome-to-the-mvvm-router-f4f497a05e6d>

## 充满希望的观点模型

![](img/92cc39df39efe226e6ba8211f7f2c9e6.png)

SpaceX 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的

大家好。像你们中的许多人一样，我最近开始了我在 SwiftUI 和 Combine 的新的陌生世界中的旅程，我必须说，我在很大程度上非常享受这一旅程。是的，它当然是新的，它是华而不实的，它是年轻的，但它也充满了承诺(结合，眨眼眨眼)。我真的希望这些工具能够很好地成熟起来，并有足够的动力为我们 iOS 开发者留下来。

但是让我们不要分心，而是专注于本文的目标。与任何新工具一样，需要反复试验才能找到使用它们的最佳方式，并从中获得最大收益。随着强大的力量而来的是伟大…(耳边的低语告诉我，我走在正确的道路上)。

在本文中，您将看到我对 SwiftUI 的 MVVM 实现的看法，并将其结合到一个非常简单的项目中。

您将在项目中找到的所有工具和模块都是为了展示我们如何实现著名的 MVVM 模式，同时避免新的 iOS 语言编码工具带来的一些陷阱。

但是少说话，多显示代码。

# 示例项目

如前所述，为本文创建的项目非常简单。

这些工具和特性的实现还远没有准备好投入生产，它们只是作为一个示例和基础，供进一步改进时参考。

源代码可以在这里找到: [SpaceXSwiftUICombine](https://github.com/lukacs-m/SpaceXMVVMSwiftUICombine/tree/master) 。

主要目标是向用户显示 SpaceX 的所有发射，同时添加一些小的数据处理功能(搜索和过滤)。

下面是您通过挖掘源代码可以找到的内容:

*   组合网络
*   数据真实的单一来源(组合工具的组合/依赖注入)
*   集中式路由协调器
*   大量的依赖注入
*   许多协议:0
*   一些搜索和过滤功能

但是总的来说，核心结构应该与您可能已经熟悉的以前的 MVVM 实现非常相似。

# 这种 MVVM 路由器的主要特点

## 集中式路由协调器

如果您已经使用过 SwiftUI，那么您一定很早就注意到视图之间的耦合非常紧密。导航链接或工作表通常通过名称调用导航流中的下一个视图。这使得导航的任何未来变化都非常复杂(尤其是在复杂的应用导航环境中)。我的方法是尝试将路由集中在一个地方，可以共享或传递给任何视图模型。

正如您在上面的代码中看到的，mainRouter 基于有助于解耦视图的协议。这可以通过在视图模型中设置一个路由器，并在视图中需要时调用它来实现，如下两个示例所示。

瞧，你的视图忘记了“routeToLaunches()”或“routeToRockets()”代表什么。

这也适用于需要数据共享的路由，正如您看到的到“DetailLaunchView”的路由

## 数据真实的单一来源

这个特性很容易通过依赖注入、使用特定的数据管理存储库以及组合来实现。

它不是新的，但是很好用。

与路由协议一样，我们利用协议的力量来减少耦合。存储库可以通过依赖注入传递到应用程序的任何部分。只需订阅协议中声明的发布者，您就可以访问最新、最新鲜的数据流。

例子胜过千言万语:

1.  声明您的数据共享存储库
2.  注入组件
3.  订阅&分配或使用发送的数据。与@Published 变量结合使用效果非常好。
4.  然后，您可以对数据应用所需的转换
5.  随心所欲地在本地数据上应用这些更改。

总的来说，用 SwiftUI 和 Combine 以及某种 DI 实现这些类型的技术是轻而易举的。如果你觉得懒，有太多的依赖注入库应该会有帮助(Resolve、SwiftInject 等等)。

## 数据处理的容易程度

作为最后一点，我想快速回顾一下 SwiftUI 和 Combine 之间已经存在的良好共生关系。

为此，您只需关注一个非常简单的搜索和过滤栏的实现。

上面是一个显示 space X 发射的简单网格视图。

1.  视图和视图模型之间的绑定。在本例中，是 TextField 内容和 viewModel 查询变量。
2.  视图和 viewModel 筛选器之间的绑定。
3.  将 Gridview 显示的数据链接到 viewModel 启动。

接下来，让我们看看如何在 viewModel 中处理传入的数据。

神奇的事情发生在 filteredLaunchesPublisher 变量中。组合、去抖、处理和分配。在很少的几行代码中，我们对数据进行了全功能的搜索和过滤。

1.  @Published variables 有助于 viewModel 和视图之间的数据绑定。
2.  创建用于处理数据的发布者。在这种情况下，它是我们的真理主流的组合:启动、查询和应用过滤器。
3.  将处理发布者分配给局部有界变量以显示最新数据。

# 可以尝试的一些技巧和窍门

我将用我在使用 SwiftUI 和 Combine 时获得的一些提示和技巧来结束这篇文章。

## 分配强引用

首先，似乎 combine assign 在元素之间创建了一个强引用。为了解决这个问题，forums.swift.org 有人想出了一段很棒的代码。我建议用那个。

## 惰性加载导航链接子视图

另一个奇怪的发现是 NavigationLink destination 中的视图集并不总是延迟加载的。事实上，似乎恰恰相反。这可能会导致你的应用程序在启动时加载大量数据。StackOverflow 再次成为我们的朋友。我们的一个同事想出了一小段很好的代码来解决这个问题。你可以在这里找到更多信息[。诀窍是:](https://medium.com/better-programming/swiftui-navigation-links-and-the-common-pitfalls-faced-505cbfd8029b)

然后，你像这样使用它:

```
NavigationLink(destination: **LazyView**( ** Put your destination view **)) { ** NavigationLink UI ** }
```

我希望这个关于如何用 SwiftUI 和 Combine 实现 MVVM 的概述对您有所帮助。我希望它给了你一些好的想法，并澄清了你的任何问题。

如果您想了解特定主题的更多信息，请随时联系我们。我也总是希望讨论如何改进、修改或补充之前讨论过的话题。