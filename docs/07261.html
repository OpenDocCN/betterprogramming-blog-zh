<html>
<head>
<title>Time Series Modeling Using Auto Arima With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Auto Arima和Python进行时间序列建模</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-auto-arima-with-python-e482e322f430?source=collection_archive---------0-----------------------#2020-12-24">https://betterprogramming.pub/using-auto-arima-with-python-e482e322f430?source=collection_archive---------0-----------------------#2020-12-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2feb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">auto_arima简介</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a74468f3f2fe9703fcb3e8308b5568d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ielCQOo9ogx3DIrf"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@sieuwert?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sieuwert Otterloo </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e6aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://pypi.org/project/pmdarima/" rel="noopener ugc nofollow" target="_blank"> Pmdarima </a>(金字塔-arima)统计库是为Python时间序列分析而设计的。<code class="fe lv lw lx ly b">auto_arima</code>是本库的自动arima函数，创建该函数是为了根据确定的标准(如AIC、BIC等)找到最佳订单和最佳季节性订单。，并在指定的参数限制内，使最佳模型适合单变量(单变量)时间序列。</p><p id="1725" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pmdarima需要特定的Python包。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="867f" class="md me it ly b gy mf mg l mh mi">!pip install pmdarima<br/>from pmdarima.arima import auto_arima</span></pre><ul class=""><li id="8529" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu mo mp mq mr bi translated"><a class="ae ky" href="https://github.com/numpy/numpy" rel="noopener ugc nofollow" target="_blank"> Numpy </a> ( &gt; =1.17.3)</li><li id="98dd" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://github.com/scipy/scipy" rel="noopener ugc nofollow" target="_blank"> SciPy </a> ( &gt; =1.3.2)</li><li id="cf26" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://github.com/scikit-learn/scikit-learn" rel="noopener ugc nofollow" target="_blank">Scikit-learn</a>(&gt;= 0.22)</li><li id="7717" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://github.com/pandas-dev/pandas" rel="noopener ugc nofollow" target="_blank">熊猫</a> ( &gt; =0.19)</li><li id="81a6" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://github.com/statsmodels/statsmodels" rel="noopener ugc nofollow" target="_blank">统计模型</a> ( &gt; =0.11)</li></ul><p id="f004" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模型结果高度依赖于参数设置，这可以在<a class="ae ky" href="https://alkaline-ml.com/pmdarima/0.9.0/modules/generated/pyramid.arima.auto_arima.html" rel="noopener ugc nofollow" target="_blank">文档</a>中详细查看。在本教程中，我们使用<code class="fe lv lw lx ly b">auto_arima</code>检查时间序列建模的机制，因为参数设置会根据数据集和预测预期而变化。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="3891" class="ne me it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">概观</h1><p id="787f" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">在本教程中，我们对2012年至2018年间的时间序列进行建模，以预测德克萨斯州奥斯汀未来36个月的房地产价值。</p><p id="6583" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们开始熟悉我们的<a class="ae ky" href="https://github.com/ulkuguneysu/Time_Series_Analysis/tree/master/CSV_Files" rel="noopener ugc nofollow" target="_blank"> Zillow </a>数据集，它提供了14，733个条目的RegionID，RegionName(邮政编码)，City，State，Metro，County Name，SizeRank和每月销售价格的信息。</p><p id="2242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更好地理解，我们将数据集分成子集，并将邮政编码限制在德克萨斯州的奥斯汀地区。然后，我们使用<a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>数据框架进行探索性数据分析。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/6327f4d23cedcfa84583de9133dd4461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYdAlPBu_tM0b7vXeftBHA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">38行x 272列</p></figure><p id="9012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于时间序列建模，我们需要将pandas数据框架转换为单变量时间序列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/54e4684be92bfc97571b8e1a93c8d364.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*OhDCDua2-Hgw8qrqM9FsqA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">265行x 1列</p></figure></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="b0cc" class="ne me it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">建模</h1><p id="bb6e" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">我们选取2012年至2018年的时间序列进行建模。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/5fe4099e2034aaac06eb94ddfe2cb7ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*RDuoqEsuY00DKcVNBSx-Yg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">德克萨斯州奥斯汀市Plotly Express散点图</p></figure><h2 id="eaad" class="md me it bd nf od oe dn nj of og dp nn li oh oi np lm oj ok nr lq ol om nt on bi translated">平稳性检查</h2><p id="3ff4" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">为了更好地理解如何设置<code class="fe lv lw lx ly b">auto_arima</code>参数限值，我们检查了时间序列的趋势、季节性、分解、残差、自相关和偏自相关。</p><ol class=""><li id="c575" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu oo mp mq mr bi translated">使用滚动统计和Dickey-Fuller测试检查平稳性</li></ol><p id="5460" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">滚动统计提供了直观的支持，而Dickey-Fuller测试计算测试统计、p值、临界值、滞后数和使用的观察值。Dickey-Fuller检验的零假设是时间序列不是平稳的。如果检验统计量小于临界值，p值小于α(通常为0.05)，我们拒绝零假设，称序列是平稳的。</p><p id="7e96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果时间序列不是平稳的，可以采用不同的方法来处理这个问题:对数变换、差分、减去滚动平均值、求平方根等。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="d692" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.使用来自<code class="fe lv lw lx ly b">statsmodels.tsa.seasonal</code>的<code class="fe lv lw lx ly b">seasonal_decomposition()</code>进行分解，以可视化趋势、季节性和残差。我们继续对残差进行平稳性检查，看看在趋势和季节性被去除后我们的时间序列是否平稳。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="7182" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.绘制自相关和偏自相关图。这些图提供了关于(p，d，q)的信息，这是建模的基本顺序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="1d1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于平稳性检查，我们确认我们的数据不是平稳的。我们在开始建模之前应用对数变换。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/1f9cb93a128d78808a5e318e00e37ed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2XqiN-9LjEp9HfojWyK_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">德克萨斯州奥斯汀2012-2018年房地产价值</p></figure><h2 id="240d" class="md me it bd nf od oe dn nj of og dp nn li oh oi np lm oj ok nr lq ol om nt on bi translated">列车测试分离</h2><p id="f73a" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">训练测试分割可能因时间序列的大小而异。我们设定了0.8/0.2的火车测试尺寸。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/9be6db3bf77f2ddfa530f153185183d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KuIrxZUD5U4KxiBmR_c82A.png"/></div></div></figure><h2 id="919f" class="md me it bd nf od oe dn nj of og dp nn li oh oi np lm oj ok nr lq ol om nt on bi translated">Auto_arima模型</h2><p id="a280" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">我们使用<code class="fe lv lw lx ly b">auto_arima</code>功能拟合模型来训练集合。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="1783" class="md me it ly b gy mf mg l mh mi">model = auto_arima(train, start_p=0, start_q=0)<br/>model.summary()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/e0223dad3c2082b519c377799235c6a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_TwkxHDWEE_l1K5Oz_GOqQ.png"/></div></div></figure><p id="c29b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">summary</code>属性提供了关于我们模型的所有信息。我们看到我们的模型使用(4，1，0)进行(p，d，q)排序。我们看到系数、p值、AIC和BIC，它们提供了模型是否良好的信息。</p><p id="99b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">plot_diagnostics()</code>绘制标准化残差的诊断图。这将提供以下信息:</p><ul class=""><li id="2fb4" class="mj mk it lb b lc ld lf lg li ml lm mm lq mn lu mo mp mq mr bi translated">一段时间内的标准化残差</li><li id="a8f4" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">直方图加上标准化残差的估计密度，以及标绘的正常(0，1)密度以供参考</li><li id="3956" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">正常Q-Q图，带正常参考线</li><li id="9486" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">相关图</li></ul><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="10b4" class="md me it ly b gy mf mg l mh mi">model.plot_diagnostics()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/d7ac200aa4d2b4a207c3fef8e682435e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yS7oF4a65Xu4tFgNxo3nLw.png"/></div></div></figure><h2 id="c5bf" class="md me it bd nf od oe dn nj of og dp nn li oh oi np lm oj ok nr lq ol om nt on bi translated">模型预测</h2><p id="5647" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">get_forecast()</code>和<code class="fe lv lw lx ly b">conf_int()</code>内置方法来预测我们的模型。<code class="fe lv lw lx ly b">forecast_to_df</code>函数将<code class="fe lv lw lx ly b">model</code>和<code class="fe lv lw lx ly b">steps</code>作为输入，并返回一个带有预测的数据帧，以列的形式显示置信下限和置信上限。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="b031" class="md me it ly b gy mf mg l mh mi"># Returns a dataframe<br/>pred_df = forecast_to_df(model, steps = len(test))</span></pre><h2 id="7fa8" class="md me it bd nf od oe dn nj of og dp nn li oh oi np lm oj ok nr lq ol om nt on bi translated">模型验证</h2><p id="0826" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">对于模型验证，我们使用均方误差(MSE是可选选项)。根据MSE值，我们可以看到我们的模型拟合得有多好。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="f09f" class="md me it ly b gy mf mg l mh mi">pred = pred_df['pred'] </span><span id="422f" class="md me it ly b gy ov mg l mh mi"><em class="ow"># Calculate MSE</em> <br/>mse = mean_squared_error(pred, test) </span></pre><p id="3518" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">绘制带有预测和置信区间的训练测试数据，以可视化我们的预测有多好。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/a7ebb30986b8895c8e88227c2aec7ca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fV8N17pGW-5rE3LLa3EPnA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">自动Arima模型验证</p></figure><h2 id="4864" class="md me it bd nf od oe dn nj of og dp nn li oh oi np lm oj ok nr lq ol om nt on bi translated">未来预测</h2><p id="ab43" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">对于未来的预测，将上面的模型与我们的时间序列进行拟合。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="c325" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">得到<code class="fe lv lw lx ly b">summary()</code>和<code class="fe lv lw lx ly b">plot_diagnostics()</code>用于模型的统计和标准化残差。使用上面给定的<code class="fe lv lw lx ly b">forecast_to_df</code>函数进行未来预测。(根据我们希望预测的未来几个月来确定<code class="fe lv lw lx ly b">steps</code>参数。)使用<code class="fe lv lw lx ly b">plot_train_test_pred <strong class="lb iu">function</strong></code> <strong class="lb iu"> <em class="ow"> </em> </strong>以置信区间可视化36个月未来预测的训练测试分割。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/095366151576bd6eca915d074cb13a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gk8mn0M404sdLBpDAo8VUA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">36个月期间的自动Arima预测</p></figure><p id="2ea2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图显示了对数变换时间序列的未来预测。应用<code class="fe lv lw lx ly b">numpy.exp</code>以获得真实值。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="593e" class="ne me it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">来源</h1><ul class=""><li id="37e7" class="mj mk it lb b lc nv lf nw li oy lm oz lq pa lu mo mp mq mr bi translated"><a class="ae ky" href="https://github.com/ulkuguneysu/Time_Series_Analysis" rel="noopener ugc nofollow" target="_blank">https://github.com/ulkuguneysu/Time_Series_Analysis</a></li><li id="a8f0" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://alkaline-ml.com/pmdarima/about.html" rel="noopener ugc nofollow" target="_blank">https://alkaline-ml.com/pmdarima/about.html</a></li><li id="e934" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://learn.co/" rel="noopener ugc nofollow" target="_blank">熨斗学校</a></li><li id="1ed3" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated">【https://pypi.org/project/pmdarima/】</li><li id="602d" class="mj mk it lb b lc ms lf mt li mu lm mv lq mw lu mo mp mq mr bi translated"><a class="ae ky" href="https://www.statsmodels.org/stable/user-guide.html#time-series-analysis" rel="noopener ugc nofollow" target="_blank">https://www . stats models . org/stable/user-guide . html #时序分析</a></li></ul></div></div>    
</body>
</html>