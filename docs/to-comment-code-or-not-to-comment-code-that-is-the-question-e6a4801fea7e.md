# 注释代码，还是不注释代码，这是一个问题

> 原文：<https://betterprogramming.pub/to-comment-code-or-not-to-comment-code-that-is-the-question-e6a4801fea7e>

## 从表面上看，这似乎是一个细节，但是许多人热衷于代码是否应该被注释

![](img/997e6dbf8160c3c37c64b47d9ce80c6e.png)

写代码注释有时候是不是感觉很拖沓？来源: [IRCat on Pixabay](https://pixabay.com/photos/cat-red-cat-red-headed-cat-kitten-4037007/)

你喜欢用代码写注释吗？还是你反对他们？这个问题没有明确、简单的答案。除了同样令人困惑的问题——代码中大括号的最佳位置在哪里——我们可能永远也找不到一个永久的、确定的答案。但我的经验是，许多人只是选择一方，并坚持这一点。在这篇文章中，我想考虑辩论的双方。

# 可读性并不总是最重要的

在我们进入辩论之前，我想离题说一下可读性。易读性并不是一个普遍的愿望。我记得和一个学术文献背景的同事讨论一篇研究论文。她问我对这张纸的想法；我说读起来一点都不容易。她回答说:“是的，你需要努力学习课文。”显然，以这种方式写作在她的领域是一种常见的方法，是值得钦佩而不是责备的。

编程领域的一个类似案例是“裸机”编程，用于高频交易、实时和类似的应用程序，在这些应用程序中，高速和低延迟是至关重要的。例如，您可以用打包到数组中的原始数据替换对象和字段，这样数据就可以很容易地并行化，并由并行 CPU 或 GPU 在没有共享或争用的情况下快速执行。

您可以将您的数组数据打包在顺序字边界上，这与您的服务器的内存读取架构完全一致，以便最大限度地减少缓存未命中和随后从主内存(甚至更糟，从磁盘)读取的次数！或者您甚至可以为一两个关键部分编写汇编代码。

在这些编程应用程序中，可读性远远排在高性能之后。如果您必须在可读性更强的代码或更快更精简的代码之间做出选择，您几乎总是会选择后者。关键是可读性并不总是第一位的。即使我们这些不在这些领域工作的普通人也会偶尔发现自己处于这样一种情况，一个简单的解决方案太慢或者占用太多内存，所以我们需要一个不太明显但是更有效的方法。在某个地方，这需要解释。

# 反评论阵营

人们不写评论的常见原因包括:

*   好的代码应该是自文档化的。如果你不能通过阅读理解代码，那么代码是不好的，应该重写。像变量和方法名的良好选择、简单的算法等等都属于这一类。
*   依赖注释的代码把注释当作拐杖；代码本身是复杂的或结构不良的，因此需要重写。
*   随着代码的不断变化，注释通常不会更新，因此会失去同步。过时的注释对代码所做的事情给出了错误或误导性的描述，因为与注释最初编写时相比，代码现在做了一些不同的事情。
*   对于简单而言，编写良好的代码注释只是复制代码本身，这已经很明显了。一个简单的 getter 方法就是一个例子；在这种情况下，注释“获取字段 X”是多余的。
*   不同程序员之间的注释质量差异很大，并且不像可执行代码那样严格，比如单元测试、预提交挂钩或自动化代码质量分析。
*   写注释会减慢你的速度，分散你的注意力，使你不能专注于代码本身。

# 支持评论的阵营

人们撰写评论时引用的常见原因包括:

*   注释揭示了代码的意图。我们上面提到的题外话是一个很好的例子——如果代码不明显，那么注释会以一种更易读的方式揭示其目的。
*   注释记录业务规则。例如，一段代码可能会声明答案是 42，但通常它不会弄清楚*为什么*答案是 42。很可能企业是基于某种商业理由做出这个决定的。因此，应该将它记录在一个持久的、容易找到的地方，并防止任何人无意中违反规则。对此，注释通常是理想的。
*   注释记录流程。与上一点类似，如果您的代码遵循一个过程或一系列步骤，那么很容易以一种更加人性化的格式描述每个步骤和任何依赖关系。
*   Javadoc、JSDoc 等的生成。放在方法、字段和类上的注释可以转换成 HTML 文档，既可以在网上阅读，也可以从 IDE 中访问。文档记录良好的代码变成了一个黑匣子，您可以放心地使用它，而不必查看源代码内部来弄清楚(这很容易变得像从毛衣边缘拆开一根线一样！)这对于一个 API 特别有用；我敢肯定，你已经使用过一些有良好文档记录且易于遵循的 API 或库，而其他的就不那么好了，需要大量的挖掘、探测和令人沮丧的搜索(这会占用*大量的*时间)。
*   注释通常比代码更快更容易阅读。团队可以依靠写得很好的注释以简单的方式解释代码，即使代码很复杂(我们前面关于可读性的讨论就是一个很好的例子)。注释写得慢的另一面是，通常它们读起来比它们所伴随的代码快得多。
*   写评论有助于你发现思维中的陷阱和假设。在编写注释时——尤其是 Javadoc 注释——我经常发现我所注释的代码实际上并不像我最初认为的那么简单。它可能有前提条件，需要特定格式的数据，在某些条件下失败，或者做出其他假设。写评论让我思考这些局限性。它经常提示我重新构建代码的这一部分，以解决这些限制，除非我真的必须考虑两次，否则我不会考虑两次——一次是在编写代码时，另一次是在编写注释时。
*   它帮助你记住别人——甚至是你——在写代码时在想什么。代码可能是多年前的，作者可能已经离开了组织，或者可能是针对外部 API 的客户编程。注释提供了一个“自助式”模型来回答关于代码的问题。当你对那段代码的记忆已经褪色的时候，这是特别有用的；它确实帮了我很多次！

# 可读性问题

可读性是代码及其意图中反复出现的主题。这就是为什么我之前跑题到它的相对优先级。可能需要做出权衡，这的确是一门艺术。例如，为了揭示方法或类的意图，很容易对其进行冗长的命名。(甚至有一个项目[在 Spring](https://gist.github.com/thom-nic/2c74ed4075569da0f80b) 中寻找最长的类名，它以拥有非常长的自记录类名而闻名)。

关键是，我们不能只是说“写更多可读的、自我注释的代码！”因为经常有好的理由阻碍。以前有“逻辑设计”vs“物理设计”的概念，相信代码+注释也可以这么看。仅仅为了避免原则上的评论而强迫逻辑层(即意图)与物理层(即执行)同构可能是麻烦的并且对性能有害。

这变成了一种权衡:原则与实用性，它取决于上下文和判断。如果你可以用一种自我注释的方式来组织你的代码，而另一种方式性能更好，但是需要注释来解释它，你会选择哪种方式？这真的取决于具体情况。

# 那么…哪个更好呢？

是评论很多，一点点，还是完全不评论，这是个人的选择。我不打算反驳我上面列出的任何论点，因为对它们的支持者来说，它们都是有效的理由。这真的是一个“托马托”和“托马托”风格的决策。

我要说的是，一个团队需要有一个统一的政策来保持一致性。随着时间的推移，每个人都做自己的事情的代码库往往看起来杂乱且不一致，因此更难阅读。如果你的政策是不发表评论，那么对于一些开发者来说，留下一些别人可以忽略的评论还是很容易的。但是如果你的政策是自由地使用注释，但是一些开发人员忘记或者拒绝这样做，那么对于他们依赖那些注释的队友来说，这就成了一个问题。

就我个人而言，我遇到过后一种情况，团队的政策是自由评论，但一些新成员质疑其必要性。他们列举了我在上面的反对意见列表中列出的所有理由。尽管这是一项由来已久的团队政策，但他们为变革进行了长期而激烈的争论。很难反驳他们的论点，因为在他们看来，他们的批评是正确的。

最终，长期争论通常会以“你必须发表评论，因为这是老板为团队制定的政策，你必须像其他人一样遵守它”而告终当时这看起来像是一个不令人满意的决议，但是正如我提到的，评论归结为个人选择。随着时间的推移，那些团队成员最终因为各种原因离开了；希望他们能找到更适合他们的新团队。

从上面的讨论中你可能会注意到，不同的主题似乎在每个阵营中都引起了共鸣:反对评论者似乎更关注单个开发人员的生产力和专业知识，而支持评论者似乎更关注团队整体的利益和效用。关于评论规则的个人主义和集体主义是思考选择的一种有趣方式。

也许你可以在我上面的例子中看到这种紧张；随着争论的升级，那些对被迫写评论感到最委屈的开发人员确实倾向于自我中心的观点。(这并不是说所有的反评论者都是这样，只是在那些例子中他们碰巧是。)这是值得思考的事情，尤其是在集体代码所有权的背景下。

是否评论的选择最终是个人的选择。没有一个“真正的”客观答案，而是根据你自己的情况、需求和偏好做出的判断。我的希望是，无论你选择什么，你仍然可以看到对方的(有效的)优点，这有助于为你的团队提供一个政策，每个人都可以团结起来。

到目前为止，我还没有透露我的选择:我评论(主要在 Javadoc 和 JSDoc 级别)。我要求我领导的团队也发表意见。

附注:这篇文章的灵感来自于[梅格娜·巴韦](https://medium.com/u/aa12f3a5ed91?source=post_page-----e6a4801fea7e--------------------------------)对[这篇文章](/one-habit-to-be-a-better-developer-a64e02b04cec)的评论。