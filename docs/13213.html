<html>
<head>
<title>How I Optimized Gas Fee Costs Spent on Ethereum by 75%</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何将花在以太坊上的汽油费优化了75%</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-optimized-gas-costs-by-75-b850ac3cff72?source=collection_archive---------6-----------------------#2022-08-08">https://betterprogramming.pub/how-i-optimized-gas-costs-by-75-b850ac3cff72?source=collection_archive---------6-----------------------#2022-08-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a93b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">优化示例NFT项目</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f918628e9673eb3061b20b0cf56d5149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4UBAcIBBwClEPVkw"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@micheile?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> micheile dot com </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f69d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在以太坊区块链上，每笔交易都要花费一笔“汽油费”。作为开发人员，我们的目标是尽可能降低交易成本。</p><p id="552c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将讨论如何配置hardhat来报告天然气成本，以及如何配置Solidity的内置优化器来降低天然气成本。</p><p id="9401" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将从我即将出版的书“启动NFT集合的开发者指南”中优化一个样本NFT项目。</p><h1 id="98e8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">气体记者</h1><p id="c5d8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在我们打开优化器之前，让我们先测量一下当前的天然气成本，以便为我们提供一个比较基准。我们需要首先安装和配置<code class="fe mp mq mr ms b">hardhat-gas-reporter</code>插件。</p><p id="f9eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">hardhat-gas-reporter</code>插件覆盖了哈德哈特的<code class="fe mp mq mr ms b">npx hardhat test</code>命令，并跟踪测试中调用的每个函数的平均油价。</p><p id="fe60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可能已经猜到了——使用gas reporter需要对您的项目进行自动化测试！</p><ul class=""><li id="cd7a" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr my mz na nb bi translated">运行<code class="fe mp mq mr ms b">npm install hardhat-gas-reporter</code>安装插件。</li><li id="3678" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">在你的hardhat配置文件中，通过添加<code class="fe mp mq mr ms b">require("hardhat-gas-reporter")</code>在文件顶部导入插件</li><li id="ebb4" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">将以下块添加到从该文件导出的设置中:</li></ul><pre class="kg kh ki kj gt nh ms ni nj aw nk bi"><span id="9858" class="nl lt iq ms b gy nm nn l no np">gasReporter: {<br/>  outputFile: "gas-report.txt",<br/>  enabled: process.env.REPORT_GAS !== undefined,<br/>  currency: "USD",<br/>  noColors: true,<br/>  coinmarketcap: process.env.COIN_MARKETCAP_API_KEY || "",<br/>  token: "ETH"<br/>}</span></pre><p id="92a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了让gas reporter为我们提供每笔交易的货币成本，我们需要一个<a class="ae kv" href="https://coinmarketcap.com/" rel="noopener ugc nofollow" target="_blank"> CoinMarketCap </a> API密匙，可以从他们的网站上免费获得。</p><p id="9b4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">继续将下面几行添加到您的<code class="fe mp mq mr ms b">.env</code>文件中:</p><pre class="kg kh ki kj gt nh ms ni nj aw nk bi"><span id="0d05" class="nl lt iq ms b gy nm nn l no np">REPORT_GAS=true<br/>COIN_MARKETCAP_API_KEY=[YOUR-API-KEY]</span></pre><p id="c75e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们通过<code class="fe mp mq mr ms b">npx hardhat test</code>再次运行我们的测试。气体报告器插件将接管并记录每个函数调用中使用的气体，并将结果输出到<code class="fe mp mq mr ms b">gas-report-txt</code>文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/df9fba4c28cb40b28b3a5f7d7dd468ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mGGpyvj8k-yo1jxoUlcdbw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">气体报告(未优化)</p></figure><p id="7366" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这份报告对于估算您的合同部署到生产环境的成本以及部署后每笔交易的成本非常有用。</p><p id="2654" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它还为我们提供了一个基准，我们可以用它来衡量我们的气体优化工作！</p><h1 id="ae67" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">坚固性优化器</h1><p id="84aa" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们配置solidity编译器，通过调整<code class="fe mp mq mr ms b">hardhat.config.js</code>中的hardhat配置中的<code class="fe mp mq mr ms b">solidity</code>行来优化我们的代码:</p><pre class="kg kh ki kj gt nh ms ni nj aw nk bi"><span id="4816" class="nl lt iq ms b gy nm nn l no np">solidity: {<br/>    version: "0.8.9",<br/>    settings: {<br/>        optimizer: {<br/>            // Toggles whether the optimizer is on or off. <br/>            // It's good to keep it off for development <br/>            // and turn on for when getting ready to launch.<br/>            enabled: true,</span><span id="a2d1" class="nl lt iq ms b gy nr nn l no np">            // The number of runs specifies roughly how often <br/>            // the deployed code will be executed across the <br/>            // life-time of the contract.<br/>            runs: 300,<br/>        }<br/>    },<br/>}</span></pre><p id="258f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了打开优化器，我们唯一的配置选项是<code class="fe mp mq mr ms b">runs</code>参数。</p><p id="df7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从坚固性文档中:</p><blockquote class="ns nt nu"><p id="612f" class="kw kx nv ky b kz la jr lb lc ld ju le nw lg lh li nx lk ll lm ny lo lp lq lr ij bi translated">运行次数大致规定了在合同的生命周期中，所部署代码的每个操作码的执行频率。这意味着它是代码大小(部署成本)和代码执行成本(部署后的成本)之间的权衡参数。</p></blockquote><p id="3546" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">200或300次运行是一个合理的默认值，但是我鼓励您尝试不同的值，看看它如何影响部署和事务成本，并为您的项目选择最合适的值。</p><p id="5c2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这又是同一个报告，但是打开了优化器。请注意汽油价格的下降:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/a2ca0f00fbe82506d5f6af22863abb47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*37S19spMjBMIs-lrt6uUjQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">打开优化器后的气体报告</p></figure><p id="09ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p><pre class="kg kh ki kj gt nh ms ni nj aw nk bi"><span id="9cc9" class="nl lt iq ms b gy nm nn l no np">If you'd like to get a head-start on learning to code an NFT Collection from scratch, check out my book: "<a class="ae kv" href="https://book.michaelstivala.com/" rel="noopener ugc nofollow" target="_blank">A developer's guide to launching an NFT Collection</a>" - use this link for 10% off!</span><span id="6b57" class="nl lt iq ms b gy nr nn l no np"><a class="ae kv" href="https://twitter.com/MichaelStivala" rel="noopener ugc nofollow" target="_blank">Follow me on twitter</a> for more blockchain-related tips and tricks, and to follow along as I use my software development skills to build $10k/month in passive income.</span></pre></div></div>    
</body>
</html>