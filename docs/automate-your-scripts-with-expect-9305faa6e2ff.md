# 使用 Expect 自动化您的脚本

> 原文：<https://betterprogramming.pub/automate-your-scripts-with-expect-9305faa6e2ff>

## 使用 Expect 脚本语言的强大功能来自动化您的程序

![](img/55e1368e8867bad8c6a39103e8c35096.png)

杰克·吉文斯在 Unsplash 上的照片

Expect 是一种强大的脚本语言，可以与任何需要用户交互的程序交互。例如，如果您想自动运行一个程序，该程序要求最终用户键入一个密码并提供一些参数，Expect 可以为您实现自动化。它的工作方式是，它期待输入并提供响应，而无需您键入任何内容。您可以将它与您的 shell 脚本集成在一起，以获得更高效的结果。

# 常见使用案例

Expect 脚本的一些最强大的用例包括:

*   使用 SSH 连接到远程服务器
*   使用 SCP 传输文件
*   打印网络响应时间
*   执行`fsck`命令来验证您的文件系统

在这个简短的教程中，我们将了解如何登录到远程服务器并执行指定的脚本。

我们开始吧！

# 安装 Expect

请注意，本教程是为基于 Unix 的操作系统编写的。

一些基于 Unix 的系统已经包含了 Expect。通过在您的终端中执行以下命令来检查它是否已安装:

`which expect`

如果您需要安装它，请根据您的操作系统执行以下命令之一:

*   对于 Ubuntu 发行版:

```
apt-get install expect
```

*   对于 Red Hat 发行版:

```
yum install expect
```

*   对于 MAC OS——最简单的方法是使用[自制软件](https://brew.sh/):

```
brew install expect
```

# 创建一个 Expect 脚本 SSH 程序

假设您想要执行一个 bash 脚本，如果一个特定的程序已经完成了它的输出，它会向管理员发送一封电子邮件。

*   创建一个名为`autoexecutor.exp`的文件。
*   放以下内容。(代码解释在下面。)

*   确保 Expect 命令路径与您的路径匹配。我的情况是`#!/usr/bin/expect`。
*   我们声明我们期望的变量。该程序需要一个主机名、一个用户名、一个密码和我们想要在给定的远程服务器上执行的脚本的名称。它们将作为命令行参数被接收。
*   `spawn` 命令用于启动一个脚本或程序，在这里是 SSH。
*   有时提示被定制得不同，如果我们不知道确切的提示，自动登录可能会有困难。使用`set prompt`设置提示是一个很好的做法。
*   `interact` 命令从键盘读取输入，并返回当前进程的 stdout 和 stderr。
*   `-o`标志将任何随后的键-体对应用到当前进程的输出。
*   在读取字符时，`-nobuffer`标志输出与模式匹配的字符。基本上，它回应了这个模式。
*   `-re` 标志表示正则表达式模式。
*   `return` 命令使交互返回给它的调用者。
*   `send` 命令，顾名思义，向我们的程序发送一个回复—在本例中，是密码和远程命令。我们还使用它在脚本结束时退出服务器。
*   发送输入字符时，`“\r”`用来表示返回字符。
*   `expect`命令等待输入。
*   `eof` 表示脚本结束。

通过提供必要的参数来运行脚本。我们假设`sendmail.sh` shell 脚本存在于远程服务器上:

`expect autoconnector.exp myhost myuser mypass /home/sendmail.sh`

# 结论

我们已经看到，无论何时需要用户交互，Expect 都是自动化脚本的强大工具。

我希望你学到了新的东西。感谢阅读和快乐编码！

# 参考

*   【https://linux.die.net/man/1/expect】