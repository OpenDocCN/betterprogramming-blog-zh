<html>
<head>
<title>Publish Node Packages to GitHub Packages With Azure Pipelines and Lerna.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure管道和Lerna.js将节点包发布到GitHub包</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/publish-node-packages-to-github-packages-with-azure-pipelines-and-lerna-js-de784d290674?source=collection_archive---------6-----------------------#2022-03-05">https://betterprogramming.pub/publish-node-packages-to-github-packages-with-azure-pipelines-and-lerna-js-de784d290674?source=collection_archive---------6-----------------------#2022-03-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9d40" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">发布节点包的实践指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5b773f4fef8d0f53f8af6554cb4622ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Wi2yIg7yDfdN4VtH.png"/></div></div></figure><p id="9499" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我们将研究两种将Node.js包发布到GitHub包的方法；和NPM一起出版，然后是勒纳。</p><p id="22c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/cjh-cloud/github-node-package" rel="noopener ugc nofollow" target="_blank">本文中使用的代码可以在这里找到。</a></p><h1 id="1f2d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">使用Azure Pipelines和NPM将节点包发布到GitHub包</h1><h2 id="6463" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">图书馆</h2><p id="7573" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">创建一个名为“GitHub Packages”的库(在一个新的Azure DevOps项目中)，使用变量<code class="fe mx my mz na b">GH_TOKEN</code>和一个具有<code class="fe mx my mz na b">write:packages</code>权限的GitHub个人认证令牌的值。通过单击挂锁图标设置此变量secret的值🔒。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/ce427aedb0876ee87c155f6bd0052203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LtoEdrhQLyoDWiI0WwZA5g.png"/></div></div></figure><h2 id="5626" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">密码</h2><p id="12fc" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated"><code class="fe mx my mz na b">.azure/publish.yml</code> —该文件定义管道，安装Node.js 14.x并创建一个<code class="fe mx my mz na b">.npmrc</code>文件，将GitHub Packages注册表设置为发布包的目的地，运行<code class="fe mx my mz na b">npm publish</code>发布该包。</p><pre class="kg kh ki kj gt nc na nd ne aw nf bi"><span id="2083" class="mg lp iq na b gy ng nh l ni nj">name: Publish Node GitHub Package<br/><br/>trigger:<br/>  - main<br/><br/>pr: none<br/><br/>variables:<br/>  - group: GitHub Packages<br/>  - name: vmImageName<br/>    value: 'ubuntu-latest'<br/><br/>stages:<br/>  - stage: Publish<br/>    displayName: Publish GitHub Package<br/>    jobs:<br/>    - job: Publish<br/>      displayName: Publish Job<br/>      pool:<br/>        vmImage: $(vmImageName)<br/>      steps:<br/>      - task: NodeTool@0<br/>        inputs:<br/>          versionSpec: '14.x'<br/>        displayName: 'Install Node.js version 14.x'<br/><br/>      - bash: |<br/>          echo //npm.pkg.github.com/:_authToken=${GH_TOKEN} &gt; ~/.npmrc<br/>          npm publish<br/>        env:<br/>          GH_TOKEN: $(GH_TOKEN)</span></pre><p id="2236" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mx my mz na b">package.json</code> —添加一个<code class="fe mx my mz na b">publishConfig</code>部分来定义要发布到的GitHub注册表</p><pre class="kg kh ki kj gt nc na nd ne aw nf bi"><span id="b807" class="mg lp iq na b gy ng nh l ni nj">"publishConfig": {<br/>  "registry": "https://npm.pkg.github.com/[User or Org name]"<br/>},</span></pre><h1 id="b39d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">使用Lerna发布版本</h1><p id="fe66" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">源代码可以在这里找到:<a class="ae ln" href="https://github.com/cjh-cloud/github-node-package" rel="noopener ugc nofollow" target="_blank">https://github.com/cjh-cloud/github-node-package</a></p><h2 id="fc85" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">图书馆</h2><p id="b088" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">这与上面使用的库很大程度上是相同的，但是增加了<code class="fe mx my mz na b">GH_USER</code>，它只是GitHub用户的包注册中心的用户名，用来发布Node.js包。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/e69e7fd9ebe154ceb3f6e43206b478fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IcFCTm2x09JI2l4M6hfdMg.png"/></div></div></figure><h2 id="85f7" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">密码</h2><p id="ac92" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated"><code class="fe mx my mz na b">package.json</code> —同上，增加了<code class="fe mx my mz na b">publishConfig</code>部分。</p><p id="3687" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mx my mz na b">.azure/publish.yml</code> —这个管道还有几个步骤:</p><ul class=""><li id="4c56" class="nk nl iq kt b ku kv kx ky la nm le nn li no lm np nq nr ns bi translated">检出<code class="fe mx my mz na b">main</code>分支</li><li id="8b96" class="nk nl iq kt b ku nt kx nu la nv le nw li nx lm np nq nr ns bi translated">配置Git凭证，以便Lerna可以制作Git标记并释放</li><li id="c101" class="nk nl iq kt b ku nt kx nu la nv le nw li nx lm np nq nr ns bi translated">Boostrap Lerna(为所有软件包安装节点模块)</li><li id="7f6a" class="nk nl iq kt b ku nt kx nu la nv le nw li nx lm np nq nr ns bi translated">用<code class="fe mx my mz na b">--registry https://npm.pkg.github.com</code>将包发布到GitHub包</li></ul><pre class="kg kh ki kj gt nc na nd ne aw nf bi"><span id="7821" class="mg lp iq na b gy ng nh l ni nj">name: Publish Node GitHub Package<br/><br/>trigger:<br/>  - main<br/><br/>pr: none<br/><br/>variables:<br/>  - group: GitHub Packages<br/>  - name: vmImageName<br/>    value: 'ubuntu-latest'<br/><br/>stages:<br/>  - stage: Publish<br/>    displayName: Publish GitHub Package<br/>    jobs:<br/>    - job: Publish<br/>      displayName: Publish Job<br/>      pool:<br/>        vmImage: $(vmImageName)<br/>      steps:<br/><br/>      - bash: git checkout main<br/>        displayName: 'Checkout main branch' # to avoid detached head<br/><br/>      - bash: |<br/>          git config user.name "$GH_USER"<br/>          git remote rm origin &amp;&amp; git remote add origin https://random_str:${GH_TOKEN}@github.com/${GH_USER}/github-node-package.git &amp;&amp; git fetch<br/>        displayName: 'Configure git'<br/>        env:<br/>          GH_TOKEN: $(GH_TOKEN)<br/><br/>      - task: NodeTool@0<br/>        inputs:<br/>          versionSpec: '14.x'<br/>        displayName: 'Install Node.js version 14.x'<br/><br/>      - bash: yarn install<br/>        displayName: Install Yarn dependencies<br/><br/>      - bash: yarn lerna bootstrap<br/>        displayName: Bootstrap Lerna<br/><br/>      - bash: |<br/>          echo //npm.pkg.github.com/:_authToken=${GH_TOKEN} &gt; ~/.npmrc<br/>          yarn lerna publish --yes --exact --conventional-commits --force-publish --create-release github --registry https://npm.pkg.github.com/<br/>        env:<br/>          GH_TOKEN: $(GH_TOKEN)</span></pre><p id="60b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望你觉得这有用！</p></div></div>    
</body>
</html>