<html>
<head>
<title>4 JavaScript Promise Methods — All, AllSettled, Any, and Race</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">4个JavaScript Promise方法— All、AllSettled、Any和Race</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-javascript-promise-methods-all-allsettled-any-and-race-ba0e0c8c034e?source=collection_archive---------10-----------------------#2022-02-08">https://betterprogramming.pub/4-javascript-promise-methods-all-allsettled-any-and-race-ba0e0c8c034e?source=collection_archive---------10-----------------------#2022-02-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e6e7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的异步代码更上一层楼</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/65b06f9a7ec73573d89f8bfc93c361a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tgkgiMfdsEbeov7w"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安迪·赫尔曼万在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="5c70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">承诺对于处理JavaScript中的异步操作非常有用。正确理解和使用它们是有效执行异步操作的基本技能。</p><p id="46b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想分享我在日常工作中使用的4种有希望的方法。在进入实际的方法之前，理解我们如何在顺序/串行和并行流中运行承诺是很重要的。</p><p id="35f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑一个函数，它返回一个1秒钟后解决的承诺。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="3c97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何在连续流中运行承诺</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="5f35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第2行，我们创建了一个承诺并等待它完成，然后在第3行开始另一个承诺。由于在第一个承诺得到解决之前，我们不会创建第二个承诺，所以总的执行时间大约是2秒。</p><p id="1a06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果我们同时取消两个承诺，然后等到两个都解决了呢</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="6bbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第3行和第4行几乎同时启动了两个承诺。在第5行，我们只是确保第5行之后的代码不会被执行，直到<code class="fe lx ly lz ma b">p1</code>和<code class="fe lx ly lz ma b">p2</code>被解析。由于两个承诺同时运行，所以总执行时间大约为1秒。</p><p id="8bfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一张图片可以让这个概念变得非常清晰</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/b8ab9cd692681c73734bed537966a6ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ekI-7xsEWM-FVYynCFRC0Q.png"/></div></div></figure><p id="e706" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有五个异步任务。</p><p id="0c64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在左边:</p><ul class=""><li id="92ea" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">任务是并行启动的。</li><li id="96c9" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">总执行时间是最长任务的时间。</li></ul><p id="37d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在右边:</p><ul class=""><li id="c603" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">任务陆续拉开序幕。</li><li id="afb6" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">总执行时间是所有任务的总时间。</li></ul><p id="9e4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，承诺在创建时就开始了它们的任务。<code class="fe lx ly lz ma b">Promise.all</code>只是等待，直到所有给定的承诺都得到解决。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="3b87" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">承诺。所有</h1><p id="6e9a" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated"><code class="fe lx ly lz ma b">Promise.all</code>方法接受一个承诺数组，并返回一个承诺，该承诺解析为一个输入承诺结果数组。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="99fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lx ly lz ma b">Promise.all</code>当输入中的任何给定承诺失败时，立即拒绝。例如</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="e650" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为<code class="fe lx ly lz ma b">p1</code>被拒绝了<code class="fe lx ly lz ma b">Promise.all</code>不会在意其他的承诺，直接跳到catch块。</p><h2 id="c51e" class="nu my it bd mz nv nw dn nd nx ny dp nh li nz oa nj lm ob oc nl lq od oe nn of bi translated">使用承诺。所有时候</h2><ul class=""><li id="3a4c" class="mc md it lb b lc np lf nq li og lm oh lq oi lu mh mi mj mk bi translated">你只关心所有承诺的成功结果。</li><li id="63ac" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">您的代码依赖于多个相关的异步任务才能正常工作。因此，与其串行运行这些任务，不如并行启动它们，然后用一个<code class="fe lx ly lz ma b">Promise.all</code>等待它们的执行</li></ul><h1 id="59af" class="mx my it bd mz na oj nc nd ne ok ng nh jz ol ka nj kc om kd nl kf on kg nn no bi translated">承诺。都解决了</h1><p id="77ca" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated"><code class="fe lx ly lz ma b">Promise.allSettled</code>接受一个承诺数组并返回一个承诺，该承诺总是解析为一个包含输入承诺结果的对象数组。</p><p id="76fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lx ly lz ma b">Promise.allSettled</code>类似于<code class="fe lx ly lz ma b">Promise.all</code>,除了它返回一个承诺，无论输入承诺中的任何一个或全部被满足或拒绝，该承诺都会被解决。</p><p id="c34e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lx ly lz ma b">Promise.allSettled</code>的解析值是一个具有状态(或者是<code class="fe lx ly lz ma b">fullfilled</code>或者是<code class="fe lx ly lz ma b">rejected</code>)的对象数组，以及单个承诺的解析值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="b8fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于<code class="fe lx ly lz ma b">Promise.allSettled</code>总是解析，我们必须手动检查每个输入承诺的解析状态，以检查是否有任何承诺失败。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="0ac6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在上面的代码片段中使用了数组析构。不懂的话，<a class="ae ky" href="https://javascript.plainenglish.io/javascript-destructuring-explained-in-plain-english-1cd457419393" rel="noopener ugc nofollow" target="_blank">按照这个指南</a>来。</p><h2 id="2233" class="nu my it bd mz nv nw dn nd nx ny dp nh li nz oa nj lm ob oc nl lq od oe nn of bi translated">使用promise . all结算时间</h2><ul class=""><li id="0cd4" class="mc md it lb b lc np lf nq li og lm oh lq oi lu mh mi mj mk bi translated">你不在乎所有承诺的成功结果。</li></ul><h1 id="7c1d" class="mx my it bd mz na oj nc nd ne ok ng nh jz ol ka nj kc om kd nl kf on kg nn no bi translated">promise . all vs promise . all已解决</h1><p id="f0e5" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated"><code class="fe lx ly lz ma b">Promise.all</code>仅当所有输入承诺都实现时，解析为单个承诺，否则拒绝。<code class="fe lx ly lz ma b">Promise.allSettled</code>始终解析为具有单个输入承诺状态的单个承诺。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="f311" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">承诺。任何</h1><p id="287a" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">Promise.any还接受一个承诺数组，并返回一个承诺，只要输入数组中的任何承诺满足，该承诺就会立即解析。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="23fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码片段中，<code class="fe lx ly lz ma b">p1</code>失败了，但是<code class="fe lx ly lz ma b">Promise.any</code>不在乎，因为<code class="fe lx ly lz ma b">p3</code>是最快的(在<code class="fe lx ly lz ma b">p1</code>之后),并且也解决了。</p><p id="7875" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果所有承诺都被拒绝，则返回的承诺也会被拒绝，并出现错误。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><h2 id="1b12" class="nu my it bd mz nv nw dn nd nx ny dp nh li nz oa nj lm ob oc nl lq od oe nn of bi translated">使用Promise.any when</h2><ul class=""><li id="2584" class="mc md it lb b lc np lf nq li og lm oh lq oi lu mh mi mj mk bi translated">你只关心最快解决的问题。</li></ul><h1 id="a221" class="mx my it bd mz na oj nc nd ne ok ng nh jz ol ka nj kc om kd nl kf on kg nn no bi translated">承诺.比赛</h1><p id="ea74" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated"><code class="fe lx ly lz ma b">Promise.race</code>与<code class="fe lx ly lz ma b">Promise.any</code>类似，只是它返回一个承诺，该承诺基于解决或拒绝的最快承诺(作为输入给出)来解决或拒绝。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="65de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果最快的承诺失败了，<code class="fe lx ly lz ma b">Promise.race</code>也失败了</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><h2 id="443a" class="nu my it bd mz nv nw dn nd nx ny dp nh li nz oa nj lm ob oc nl lq od oe nn of bi translated">什么时候使用Promise.race</h2><ul class=""><li id="117c" class="mc md it lb b lc np lf nq li og lm oh lq oi lu mh mi mj mk bi translated">你关心最快的承诺，要么成功，要么失败。</li></ul><h1 id="31dc" class="mx my it bd mz na oj nc nd ne ok ng nh jz ol ka nj kc om kd nl kf on kg nn no bi translated">承诺。任何对承诺。比赛</h1><p id="d678" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated"><code class="fe lx ly lz ma b">Promise.any</code>只关心最快解决的问题，而<code class="fe lx ly lz ma b">Promise.race</code>关心最快解决或拒绝的问题。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><p id="0ba0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时，以顺序方式执行异步操作是唯一的选择，但是要确保尽可能并行地运行它们，因为这样可以减少执行这些操作的时间。</p><p id="19fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读</p></div></div>    
</body>
</html>