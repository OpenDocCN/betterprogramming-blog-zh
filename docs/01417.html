<html>
<head>
<title>A Complete Go Development Environment With Docker and VS Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个完整的Go开发环境，包含Docker和VS代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-complete-go-development-environment-with-docker-and-vscode-a3e4410d27f7?source=collection_archive---------1-----------------------#2019-09-08">https://betterprogramming.pub/a-complete-go-development-environment-with-docker-and-vscode-a3e4410d27f7?source=collection_archive---------1-----------------------#2019-09-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="0507" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"># 17——每日邮报</h2><div class=""/><div class=""><h2 id="3b75" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated"><a class="ae kr" href="/@phuctm97/go-restful-series-a7addbfef5b1?source=friends_link&amp;sk=81e26fc768b3326f8389694694ffa53d" rel="noopener ugc nofollow" target="_blank"> Go RESTful系列第三篇文章</a></h2></div><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/302124bfb81e48187afa0aa3cc3bc344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vmW2Gu0ElsVxq79gYRLTlw.png"/></div></div></figure><p id="76e8" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><a class="ae kr" href="https://medium.com/@phuctm97/setup-simple-go-development-environment-with-docker-b8b9c0d4e0a8?source=friends_link&amp;sk=95df4d670edceb69df0af4c146600748" rel="noopener">上一次</a>，我创建了一个简单的脚本来启动Docker容器，它可以从我的本地机器上同步并执行Go源代码。但是我还没有解释如何支持智能感知和调试，这对于开发是至关重要的。让我们在这篇文章中这样做。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="8d59" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">考虑</h1><p id="6b35" class="pw-post-body-paragraph le lf it lg b lh mz kd lj lk na kg lm ln nb lp lq lr nc lt lu lv nd lx ly lz im bi translated">当我研究这个目标的解决方案时，我有点担心，因为它很大程度上依赖于代码编辑器/ide的供应商在容器内工作。幸运的是，有两个流行的编辑器支持这一点:GoLand和VS Code。</p><p id="a5c1" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">GoLand支持看起来相当成熟，因为它已经存在一段时间了(起源于IntelliJ)。但是，该功能仅适用于购买的版本。</p><p id="31da" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">VS Code Remote-Containers扩展最近才发布，所以它没有GoLand那么成熟。然而，该扩展是由微软官方开发和维护的(非开源)，并计划作为web伴侣IDE或云IDE用于未来的许多服务中——因此它是非常有前途的。在撰写本文时，特性集看起来也足够好，可以开始了。还是用VS代码吧。</p><p id="3d22" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">显然，我们可以直接在容器中使用Vim，并在其中安装令人惊叹的插件。然而，这将是我的最后一次尝试，因为我不仅为我自己，也为我的团队(也为你的团队)设置了这个，而且Vim的学习曲线对于大多数开发人员来说非常沉重。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="b78a" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">VS代码远程容器</h1><h2 id="4d72" class="ne mi it bd mj nf ng dn mn nh ni dp mr ln nj nk mt lr nl nm mv lv nn no mx iz bi translated">概念</h2><p id="90f5" class="pw-post-body-paragraph le lf it lg b lh mz kd lj lk na kg lm ln nb lp lq lr nc lt lu lv nd lx ly lz im bi translated">VS Code Remote-Containers是一个扩展，它帮助开发人员像平常一样使用他们的VS Code UI，但是所有的命令和动作都是在容器内部传播和执行的。这实际上就像是你在一个容器中使用VS代码。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi np"><img src="../Images/1894f8d551b26464662c21200bfac16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwuNtvg204SBHmXdM--uXg.png"/></div></div></figure><p id="cdb2" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">VS代码实现足够强大和抽象，以至于大多数扩展仍然可以正常工作。</p><p id="134c" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">有了这个概念，我们可以为几乎所有类型的开发将环境容器化，而不仅仅是Go。</p><h2 id="602a" class="ne mi it bd mj nf ng dn mn nh ni dp mr ln nj nk mt lr nl nm mv lv nn no mx iz bi translated">秘诀</h2><p id="f44d" class="pw-post-body-paragraph le lf it lg b lh mz kd lj lk na kg lm ln nb lp lq lr nc lt lu lv nd lx ly lz im bi translated">安装<a class="ae kr" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers" rel="noopener ugc nofollow" target="_blank"> VS代码远程容器</a>扩展。</p><p id="4057" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">编写一个<code class="fe nq nr ns nt b">Dockerfile</code>用运行和调试应用程序所需的包和工具定义您的映像。</p><p id="fbde" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">在您的工作区根目录(在<code class="fe nq nr ns nt b">.vscode</code>旁边)创建一个<code class="fe nq nr ns nt b">.devcontainer.json</code>，引用<code class="fe nq nr ns nt b">Dockerfile</code>。</p><pre class="kt ku kv kw gt nu nt nv nw aw nx bi"><span id="9dd7" class="ne mi it nt b gy ny nz l oa ob">{<br/>   "dockerFile": "Dockerfile",<br/>   "extensions": [ <br/>      "ms-vscode.go" <br/>   ]<br/>}</span></pre><p id="a8b6" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">打开包含带有VS代码的<code class="fe nq nr ns nt b">.devcontainer.json</code>文件的文件夹。VS代码会自动检测它，并要求你以容器模式打开你的项目。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oc"><img src="../Images/a0befdbeabc03a022c215c7f225c0bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DPPZTF7C-UlYKI3DZfwFMg.png"/></div></div></figure><p id="2b17" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">然后，VSCode将基于您的<code class="fe nq nr ns nt b">Dockerfile</code>构建您的映像(仅第一次)，并将设置一些额外的必需包，以便它可以容器化地工作。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi od"><img src="../Images/2708d7e4519425dc44a23f37e5e0453d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uFMhv2_HePYvX47riTVs8A.png"/></div></div></figure><p id="27dc" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">在这个过程完成之后，您现在可以像平常一样使用VS代码，并且让所有的东西都在容器内部运行。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oe"><img src="../Images/287473d273b8087edabbfc9bbcfb1fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mVlRBHFxSPws_zk_6ogfqg.gif"/></div></div></figure><p id="3def" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">就像上面的例子，我甚至没有在我的本地机器上运行<code class="fe nq nr ns nt b">go</code>，但是我仍然可以从我的VS代码中执行Go代码，并且可以从Safari访问服务器。一切都在容器内完成。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="1c42" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">实施</h1><p id="7173" class="pw-post-body-paragraph le lf it lg b lh mz kd lj lk na kg lm ln nb lp lq lr nc lt lu lv nd lx ly lz im bi translated">按照上面提到的概念和配方，我创建了一个<code class="fe nq nr ns nt b">Dockerfile</code>。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="cf15" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">该图像基于官方的<code class="fe nq nr ns nt b">golang</code>图像，因此它可以适当地支持<code class="fe nq nr ns nt b">go</code>。然后，我安装了Go VS代码扩展所需的一些工具，以便能够实现智能感知、林挺和调试功能。</p><p id="ec4a" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">然后我写了一个<code class="fe nq nr ns nt b">.devcontainer.json</code>文件。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="1a8a" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">它只是引用my <code class="fe nq nr ns nt b">Dockerfile</code>并列出VS代码应该安装到附加容器中的所有扩展。它还设置了从我的本地机器到我的容器的端口映射，反之亦然，因此我可以直接从我的浏览器测试我的应用程序。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="7cb0" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">结果</h1><p id="469a" class="pw-post-body-paragraph le lf it lg b lh mz kd lj lk na kg lm ln nb lp lq lr nc lt lu lv nd lx ly lz im bi translated">我能够编写具有智能感知所有特性的代码，比如自动完成、自动导入、代码导航等。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oh"><img src="../Images/c988604cc73ce3e02439f32b9987302d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jxBvTmP3S95ll4fd-jWRMA.gif"/></div></div></figure><p id="9174" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">我可以在本地机器上不安装Go runtime的情况下运行这个应用程序。多亏了端口映射，我还可以从Safari测试我的应用程序。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oe"><img src="../Images/287473d273b8087edabbfc9bbcfb1fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mVlRBHFxSPws_zk_6ogfqg.gif"/></div></div></figure><p id="5e2f" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">我能够使用Go VS代码扩展支持的出色调试特性。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oh"><img src="../Images/5711ac5cba06b4a4d3e590754eb7bf83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kmZv1SItQya881Wg-LMPgg.gif"/></div></div></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="f29d" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">限制</h1><p id="8a90" class="pw-post-body-paragraph le lf it lg b lh mz kd lj lk na kg lm ln nb lp lq lr nc lt lu lv nd lx ly lz im bi translated">我需要的东西差不多都有了。然而，仍然有一些我觉得有点讨厌的限制:</p><ul class=""><li id="426e" class="oi oj it lg b lh li lk ll ln ok lr ol lv om lz on oo op oq bi translated">为了能够使用VS代码git push命令，我不得不做了一些工作，因为它需要我的SSH凭证绑定到容器</li><li id="08bc" class="oi oj it lg b lh or lk os ln ot lr ou lv ov lz on oo op oq bi translated">我不能使用VS代码git commit命令对我的提交进行GPG签名，因为它需要大量的工作才能将GPG命令从容器转发到主机</li></ul></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="9124" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">总结</h1><p id="2d1c" class="pw-post-body-paragraph le lf it lg b lh mz kd lj lk na kg lm ln nb lp lq lr nc lt lu lv nd lx ly lz im bi translated">尽管仍然有一些限制，我能够解决这里定义的史诗<a class="ae kr" href="https://github.com/the-evengers/go-restful/projects/1#card-26142625" rel="noopener ugc nofollow" target="_blank"/>并且有一个全职的容器化开发环境和本地质量的开发经验。</p><p id="6df0" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">感谢微软这么救命的功能！</p><p id="12fd" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">本文的完整源代码发布在<a class="ae kr" href="https://github.com/the-evengers/go-restful/tree/41b3172af912a36643f9b578bdcf242fccabccf6" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>