<html>
<head>
<title>How to Upgrade Dependencies in Your package.json</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何升级包中的依赖项</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-upgrade-dependencies-in-package-json-e5546804187f?source=collection_archive---------4-----------------------#2019-12-16">https://betterprogramming.pub/how-to-upgrade-dependencies-in-package-json-e5546804187f?source=collection_archive---------4-----------------------#2019-12-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="188b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">检查过期的软件包并正确更新它们</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4f46e8629fdf293ba0a07a9c827418b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Kb1XcyAinllJ1Is5tCbmw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@austindistel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">奥斯汀·迪斯特尔</a>在<a class="ae ky" href="https://unsplash.com/s/photos/program?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="a059" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Npm(节点包管理器)是JavaScript编程语言的包管理器。它是JavaScript运行时环境Node.js的默认包管理器。</p><p id="0c7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">项目将其包依赖列表保存在<code class="fe lv lw lx ly b">package.json</code>中。对于每个已安装的软件包，都会分配一个版本。通常，一个版本由三部分组成:major.minor.patch</p><ul class=""><li id="b050" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">主要是针对不兼容的API修改。</li><li id="889e" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">Minor用于向后兼容的功能。</li><li id="316a" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">补丁是为了向后兼容的错误修复。</li></ul><p id="96f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，npm会安装最新版本，并在前面添加一个插入符号，如“^15.2.0".”脱字符号依赖关系表明至少应该安装15.2.0。</p><p id="3cfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当存在更高的次要版本时，将使用它。如果目前的最高次要版本是15.6.2，这个特定版本15.6.2将升级到。</p><p id="27ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想保守一点，波浪号依赖项“~15.2.0”会建议只使用更高的补丁版本。当然，简单的“15.2.0”将保证只使用精确的版本。语义版本化的细节由<a class="ae ky" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank"> SemVer </a>定义。</p><p id="5d3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，一切顺利。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="82bb" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated"><strong class="ak">问题</strong></h1><p id="7940" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">随着时间的推移，你的<code class="fe lv lw lx ly b">package.json</code>中的依赖关系已经发生了变化。您可能希望升级所有软件包以跟上新功能或修复漏洞。你该怎么办？</p><p id="3cd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，您需要确定最新版本是什么。这里有一个关于GitHub的例子。</p><p id="9355" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在Visual Studio代码上安装了<a class="ae ky" href="https://marketplace.visualstudio.com/items?itemName=pflannery.vscode-versionlens" rel="noopener ugc nofollow" target="_blank">版本镜头</a>，它会显示所有软件包的最新版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/c29fd990ad3c32bb9401c18d5b63bc6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yotH4WLqb2P4dvE4xtz5Kg.png"/></div></div></figure><p id="d405" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，您可以使用npm命令行界面:<code class="fe lv lw lx ly b">npm outdated</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/d91e47631fa4a1e1517febe7fdd9556e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dik7s8WGFMVAe6pxny30TQ.png"/></div></div></figure><ul class=""><li id="098b" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated"><em class="nt">当前</em>是当前安装的版本。</li><li id="0daf" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated"><em class="nt"> Wanted </em>是满足<code class="fe lv lw lx ly b">package.json</code>中指定的SemVer范围的软件包的最高版本。</li><li id="a546" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated"><em class="nt"> Latest </em>是在注册表中标记为最新的软件包版本。</li><li id="83b0" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated"><em class="nt">位置</em>是包在依赖关系树中的位置。</li></ul><p id="0a41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CLI输出中的包颜色表示过期的级别。红色表示有符合<code class="fe lv lw lx ly b">package.json</code>中定义的SemVer要求的更新版本。黄色表示有一个高于SemVer要求的新版本。</p><p id="3fe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，<a class="ae ky" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank"> Lodash </a>并没有过时。因此，不在此列。同时，<a class="ae ky" href="https://prettier.io/" rel="noopener ugc nofollow" target="_blank">beautiful</a>在小版本后面，React在大版本后面。</p><p id="0dc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果依赖项修改为以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/e79627a9fcbd70865fbb4be1bd4f1751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ikv6V1IvHbvbITAOv26lYg.png"/></div></div></figure><p id="65b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">红旗将会为Lodash和beauty而闪烁。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/dae7f9bb3ceb4b85954f55e5d3a99ecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Syf_oZFb_f2Y5QkF7C6vJw.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f80c" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated"><strong class="ak">解决方案</strong></h1><p id="391c" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在识别出过时的包之后，我们相应地修正了<code class="fe lv lw lx ly b">package.json</code>中的版本规范。然后我们可以运行<code class="fe lv lw lx ly b">npm install</code>或者<code class="fe lv lw lx ly b">npm update</code>来升级。</p><ul class=""><li id="b2e4" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated"><code class="fe lv lw lx ly b"><a class="ae ky" href="https://docs.npmjs.com/cli/install" rel="noopener ugc nofollow" target="_blank">npm install</a></code>安装一个软件包和它依赖的任何软件包。如果包有一个包锁或包膜文件，依赖项的安装将由此驱动，如果两个文件都存在，则<code class="fe lv lw lx ly b">npm-shrinkwrap.json</code>优先。</li><li id="29af" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated"><code class="fe lv lw lx ly b"><a class="ae ky" href="https://docs.npmjs.com/cli/update" rel="noopener ugc nofollow" target="_blank">npm update</a></code>将列出的所有软件包更新到最新的指定版本。它还会安装缺失的软件包。</li></ul><p id="c157" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">npm install</code>和<code class="fe lv lw lx ly b">npm update</code>有什么区别？</p><ul class=""><li id="2ab5" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated"><code class="fe lv lw lx ly b">npm install</code>忽略已经安装的模糊版本模块，而<code class="fe lv lw lx ly b">npm update</code>更新它。</li></ul><p id="d6aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，<code class="fe lv lw lx ly b">devDependencies</code>的处理方式也不同:</p><ul class=""><li id="fe90" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated"><code class="fe lv lw lx ly b">npm install</code>安装或更新<code class="fe lv lw lx ly b">devDependencies</code>，除非添加了<code class="fe lv lw lx ly b">--</code>生产标志。</li><li id="21c8" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">除非添加了<code class="fe lv lw lx ly b">--</code> dev标志，否则<code class="fe lv lw lx ly b">npm update</code>将忽略<code class="fe lv lw lx ly b">devDependencies</code>。</li></ul><p id="2044" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是不是太概念化了？让我们看一个例子。在我们的例子中，我们将漂亮器的版本从“1.18.0”更改为“~1.18.0”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/a5b27e24adc7dfec4ec849a2ae518a8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*16MmkxvJK51Y-1cnZEHofQ.png"/></div></div></figure><p id="7e83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们运行<code class="fe lv lw lx ly b">npm install</code>，Prettier的版本足够模糊，可以保留为<code class="fe lv lw lx ly b">package-lock.json</code>中原来的“1.18.0”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/bc318b22087015dfaed35bbf5e37c2ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Gq-v5ph2kgDFT01UwQ4eg.png"/></div></div></figure><p id="8033" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以使用<code class="fe lv lw lx ly b">npm ls</code>查看。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/2192589899570206a588db1fed9910fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MhO1ybJj5Bm6DVanAwk18g.png"/></div></div></figure><p id="d3b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是如果我们运行<code class="fe lv lw lx ly b">npm update</code>，Prettier的版本在<code class="fe lv lw lx ly b">package-lock.json</code>升级为“1.8.2”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/d50b48215b36d5d2096b717aab742fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rHhCGfT86T-3fCpVdlBHjQ.png"/></div></div></figure><p id="2f3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">npm ls</code>输出也被更新。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/20da36a3c163722b62dda60df5692e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xrMdhezw_OmtK9XVI6iiw.png"/></div></div></figure><p id="f8cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，更漂亮的波浪号依赖关系改为插入符号依赖关系！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/1095a38f962bbcc72ada4a1b156ec1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6rYCLC_YTPC5beI-L_YBVQ.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="807c" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated"><strong class="ak">强大的解决方案</strong></h1><p id="1d41" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">正如我们所观察到的，<code class="fe lv lw lx ly b">npm update</code>不会升级到最新的主版本。这是有意义的，因为主要版本经常引入突破性的变化，需要谨慎处理。</p><p id="2295" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，如何才能升级各大版本呢？</p><p id="4e87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Visual Studio代码中使用Version Lens的提示，我们可以手动将包升级到主要版本。此外，还有一个强大的工具，<code class="fe lv lw lx ly b"><a class="ae ky" href="https://www.npmjs.com/package/npm-check-updates" rel="noopener ugc nofollow" target="_blank">npm-check-updates</a></code>，可以自动做到这一点。npm工具可以在全球范围内安装:</p><pre class="kj kk kl km gt oc ly od oe aw of bi"><span id="38c5" class="og mv it ly b gy oh oi l oj ok">npm install -g npm-check-updates</span></pre><p id="78db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们运行这个强大的命令:<code class="fe lv lw lx ly b">ncu -u</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/008b718f6f46207ff863aa10f1b4ae87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vx-BiiN9l6TmNCFrmxtvzw.png"/></div></div></figure><p id="bf80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，<code class="fe lv lw lx ly b">package.json</code>中的依赖项升级到了最新版本，包括主要版本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/86e56e5139f4127b19c5e39caff6acbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TqnAtdvOXxyV-G7D-i5kIQ.png"/></div></div></figure><p id="1893" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剩下的都是小事。运行<code class="fe lv lw lx ly b">npm install</code>或<code class="fe lv lw lx ly b">npm update</code>完成升级。</p><p id="c193" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只是要小心<code class="fe lv lw lx ly b">npm-check-updates</code>:权力越大，责任越大。</p><p id="4fd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。我希望这有所帮助。如果你有任何问题，请随时回复。你可以在这里看到我的其他媒体出版物<a class="ae ky" href="https://medium.com/@jenniferfubook/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener"/>。</p></div></div>    
</body>
</html>