<html>
<head>
<title>Explore the Dynamic Island — ActivityKit Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索动态岛—活动指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/explore-the-dynamic-island-activitykit-tutorial-a7b8e3f9e234?source=collection_archive---------0-----------------------#2022-09-18">https://betterprogramming.pub/explore-the-dynamic-island-activitykit-tutorial-a7b8e3f9e234?source=collection_archive---------0-----------------------#2022-09-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cbe1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何征服iPhone 14 Pro中的动态岛，为你的app增加支持！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/45bbc6ba7a66905e3842e88ac7ec3d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDnyNnGW7TOBiLho2wfVYQ.jpeg"/></div></div></figure><p id="ff86" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">苹果以一种出乎意料的方式展示了iPhone 14 Pro，让我们惊叹不已。来自Cupertino的团队将硬件限制变成了一项功能，我认为这是学校需要教授的内容。</p><p id="ccb3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是，当谈到动态岛时，它的独特之处在于它不仅仅是一个常规功能，而是软件和硬件的结合。苹果甚至向第三方开发者开放了这个机会。</p><p id="5187" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">而且非常简单！</p><h1 id="2744" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">为什么和什么时候</h1><p id="84d0" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">无论你是产品经理还是iOS开发人员，你都应该知道为什么以及何时使用动态岛及其功能。</p><p id="c3cd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当您想要显示正在进行的任务的更新信息时，动态岛通常很有帮助。</p><p id="381d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如:</p><ul class=""><li id="572b" class="mk ml iq kt b ku kv kx ky la mm le mn li mo lm mp mq mr ms bi translated">显示实时更新的体育应用程序。</li><li id="913b" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm mp mq mr ms bi translated">一个显示倒计时信息的计时器应用程序。</li><li id="02de" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm mp mq mr ms bi translated">显示音乐控制的音乐应用程序。</li><li id="0d2c" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm mp mq mr ms bi translated">显示方向的导航应用程序。</li><li id="40af" class="mk ml iq kt b ku mt kx mu la mv le mw li mx lm mp mq mr ms bi translated">上传/下载文件或数据信息。</li></ul><p id="97df" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这些只是何时使用动态岛的几个例子。</p><h1 id="2fbe" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">现在，对于技术部分</h1><p id="6f24" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">让我们回顾一下“现场活动”是如何构建的。</p><p id="d7bd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，Activity实际上是一个widget，就像iOS 14 widgets一样。我们为不同的状态配置小部件，并使用SwiftUI声明它的UI。</p><p id="0f55" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">主应用程序通过发送数据有效载荷来添加、删除和更新活动信息。</p><p id="5515" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">更新实时活动的另一种方法是使用推送通知，我们将单独介绍。</p><p id="ca41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">与其他小部件不同，Live Activity不能通过网络进行自我更新，因此它是主应用程序或接收推送的责任。</p><p id="63c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请看下图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/7bac0f153752e00ccd0252acae3ac171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*sCqwPuRufaiVuTKnRiMIMQ.png"/></div></figure><p id="3253" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Activity小部件基于两种小部件配置——锁屏和动态岛。主目标通过向两个配置发送一个叫做“活动属性”的东西来更新活动小部件。系统负责为你管理所有精彩的动画和状态管理。</p><h1 id="40c0" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">设置</h1><p id="b4b7" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们首先需要做两件事，以确保我们可以开始开发我们惊人的动态岛。</p><p id="83a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们需要下载Xcode 14.1，并确保我们在iOS 16.1或更高版本的iPhone 14 Pro上运行该应用程序。</p><p id="d21b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要做的第二件事是添加对现场活动的支持。我们向info.plist文件添加另一个名为“支持实时活动”的键，并将其设置为“是”。</p><h1 id="920b" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">创建活动属性</h1><p id="4ce2" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">首先，让我们尝试理解您的小部件的数据。</p><p id="8d88" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，如果我们谈论一个导航应用程序，我们可能想要显示目的地、方向和预计到达时间。</p><p id="3624" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，在这一点上，我们需要区分两种类型的数据——不应该改变的静态信息和动态数据。</p><p id="731b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这个例子中，<strong class="kt ir">目的地</strong>是静态的，正在更新的数据是<strong class="kt ir">下一个转弯</strong>和<strong class="kt ir"> ETA </strong>。</p><p id="8a0a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了表示这些数据，我们创建了一个符合名为<code class="fe mz na nb nc b">ActivityAttributes</code>的协议的结构。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="77bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看<code class="fe mz na nb nc b">NavigationAttributes</code>，我们可以看到该州被单独声明为<code class="fe mz na nb nc b">ContentState</code>的一部分。</p><p id="a78d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mz na nb nc b">ContentState</code>是<code class="fe mz na nb nc b">ActivityAttributes</code>协议的一部分，必须符合<code class="fe mz na nb nc b">Codable</code>。</p><p id="df53" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里需要注意的一件重要事情是，该结构必须是应用程序和小部件目标的一部分，因为它们都将使用它。该应用程序将创建并发送到小部件，相应地更新用户界面。</p><h1 id="6396" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">创建实时活动</h1><p id="6a4f" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们现在要做的是，一旦开始导航流，就创建一个实时活动。为此，我们创建一个新的<code class="fe mz na nb nc b">NavigationAttributes</code>并请求一个新的活动:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5ce9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">返回的对象是类型为<code class="fe mz na nb nc b">NavigationAttributes</code>的<code class="fe mz na nb nc b">Activity</code>。最佳做法是将该对象保存到实例变量中，这样我们就可以引用它。当我们需要更新ETA、下一个转弯或只是关闭导航时，这将是要修改的对象。</p><p id="efc9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了更新<code class="fe mz na nb nc b">Activity</code>，我们需要发送一个新的状态(还记得<code class="fe mz na nb nc b">ContentState</code>类型吗？).</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="51d8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要结束导航，我们只需调用<code class="fe mz na nb nc b">end()</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h1 id="6276" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">现在来看看小部件本身</h1><p id="fd32" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们需要做的第一件事是确保我们的项目有一个小部件目标。如果没有，我们需要创建一个(文件-&gt;新建-&gt;目标并选择“小部件扩展”)。</p><p id="2d27" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们有一个小部件目标，我们需要确保我们有一个小部件包，这样新的<code class="fe mz na nb nc b">Activity</code>将是我们的应用程序支持的另一个小部件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="d45b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要创建一个新的小部件，我们需要添加一个符合“小部件”的新结构，并返回一个<code class="fe mz na nb nc b">ActivityConfiguration</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0c9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意，新的<code class="fe mz na nb nc b">ActivityConfiguration</code>有一个我们之前创建的通用类型<code class="fe mz na nb nc b">NavigationAttributes</code>。</p><p id="aeba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要返回的第一个UI是锁屏小部件。当我们创建一个实时活动时，我们还会创建一个锁屏小部件，显示我们发送的属性的更新信息。承认你不知道你也收到了！</p><p id="59b5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mz na nb nc b">ActivityConfiguration</code>的第二个参数是<code class="fe mz na nb nc b">DynamicIsland</code>，它有四个参数——展开、<code class="fe mz na nb nc b">compactLeading</code>、<code class="fe mz na nb nc b">compactTrailing</code>和<code class="fe mz na nb nc b">minimal</code>。</p><h1 id="4433" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">动态岛屿布局</h1><p id="a0d8" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">现在，支持动态岛的伟大之处在于，大部分艰苦的工作都是由iOS为我们完成的。</p><p id="3966" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要做的就是为三种状态声明动态岛UI:</p><p id="2ad7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">紧凑</strong> —这是“常规”状态，我们退出应用程序，它“收缩”到动态岛中。</p><p id="4f18" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">最小化</strong> —你的应用在另一个应用缩小的地方获得最小化的视图。</p><p id="ff83" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">扩展</strong> —当用户长按动态岛时，你的活动暂时扩展到有更多的空间和控制。</p><p id="d5af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">需要了解的一点是动态岛布局是如何构建的。苹果希望我们所有的应用程序开发人员以一种特定的模式来构建动态岛，就像标准导航栏是如何制作的一样。</p><p id="6c18" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">紧凑模式(“常规”模式)基于两个部分——结尾和开头。</p><p id="b97e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">扩展模式具有前导、尾随、中心和底部。</p><p id="22e3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看以下紧凑和扩展模式的布局:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/a9edd33d6cda4a1b6b370aa1ed1c0bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbnXZRBMBzBLLBeG-kET4w.png"/></div></div></figure><p id="ea3d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">添加这些部件很容易:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="b027" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意，每个部分(动态岛和锁屏部件)都有一个包含属性和状态的上下文。</p><p id="f405" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们看看我们的小部件在不同状态下的外观:</p><p id="6d06" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">紧凑型:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/72acc614880fb5193778a015e9316fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*3l0VpgBzBosMSBfYnpmOJA.png"/></div></figure><p id="1170" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">展开:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/5d7b0165899f2abc86ee5183c237e7dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*IFNF3hcKdRgolY6UL748qQ.png"/></div></figure><p id="3274" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最低:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/3a16d50c1f817208ef80efc88b973d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*hA1q2Fpou5UNu8Zq7Nt5EQ.png"/></div></figure><p id="d1d5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">很漂亮，是吧？</p><h1 id="9bb1" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">摘要</h1><p id="38a2" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">现场活动(“动态岛”)很容易设置，因为大部分脏活已经为我们做了。</p><p id="c999" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下一部分将讨论如何使用推送通知来更新实时活动。敬请期待！</p></div></div>    
</body>
</html>