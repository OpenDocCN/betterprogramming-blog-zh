<html>
<head>
<title>Getting Started with React and MapBox GL JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React和MapBox GL JS入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-react-and-mapbox-gl-js-using-popup-component-with-marker-d76c72824423?source=collection_archive---------15-----------------------#2019-09-19">https://betterprogramming.pub/getting-started-with-react-and-mapbox-gl-js-using-popup-component-with-marker-d76c72824423?source=collection_archive---------15-----------------------#2019-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9a84" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用带有标记的弹出组件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8933e4fa3854e49902a096a7f2866351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y6C4nSvy2Woe0m7bWEn4BA.png"/></div></div></figure><h1 id="a0d9" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">首先(你知道程序):</h1><p id="247f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">以下是本系列前几篇文章的链接。他们做得很好——如果你还没有看的话，看看吧，里面应该有一些有价值的信息！</p><ol class=""><li id="e44f" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh mp mq mr ms bi translated">【React和MapBox GL JS入门</li></ol><p id="31e8" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">2.<a class="ae mt" href="https://medium.com/better-programming/getting-started-with-mapbox-gl-js-user-location-with-geolocation-f32c3e323526" rel="noopener">MapBox GL JS入门:带地理定位的用户位置</a></p><p id="09fa" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">3.【React和MapBox GL JS入门:带有标记组件的用户位置标记</p><p id="c1dc" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">4.【React和MapBox GL JS入门:从API设置地图标记。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="80d7" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">目标:为我们的标记设置一些弹出窗口</h1><p id="1b55" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们将以编程方式为每个标记放置弹出窗口。这个结果是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/695701436986c5704b13868296782105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YU4W2UEg8erzer8Tulp0kA.png"/></div></div></figure><p id="5b03" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">您可以点击每个标记来显示相关信息。如果您一直关注本系列，您会知道我们一直在使用API来呈现标记，因此我们可以使用ReactMapGL的<code class="fe nk nl nm nn b">Popup</code>组件使用每个标记的数据来呈现一个弹出窗口。轻松点。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="c61a" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">我们需要什么</h1><p id="d90a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们需要以下内容:</p><ul class=""><li id="9174" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh no mq mr ms bi translated">弹出组件</li><li id="a5ef" class="mi mj it lo b lp np ls nq lv nr lz ns md nt mh no mq mr ms bi translated"><code class="fe nk nl nm nn b">selectedHotspot</code>在状态。</li><li id="a7a5" class="mi mj it lo b lp np ls nq lv nr lz ns md nt mh no mq mr ms bi translated">一点定制。</li></ul></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="1236" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">弹出组件</h1><p id="b951" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我会让你们自己仔细阅读<code class="fe nk nl nm nn b">Popup</code>文档:<a class="ae mt" href="https://docs.mapbox.com/mapbox-gl-js/api/#popup" rel="noopener ugc nofollow" target="_blank">弹出组件</a></p><p id="1e80" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">但是我们将只使用所需的纬度和经度属性，并创建一个<code class="fe nk nl nm nn b">onClose</code>事件监听器。如果你有反应经验，这对你来说不算什么。</p><p id="6e58" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">我们需要用我们的<code class="fe nk nl nm nn b">ReactMapGL</code>导入<code class="fe nk nl nm nn b">Popup</code>组件:</p><pre class="kj kk kl km gt nu nn nv nw aw nx bi"><span id="ec67" class="ny kv it nn b gy nz oa l ob oc">import ReactMapGL, { Marker, Popup } from "react-map-gl";</span></pre></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="f1c1" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">处于状态的选定热点</h1><p id="c41a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在我们在state中创建一个<code class="fe nk nl nm nn b">selectedHotspot</code>键，它的值是<code class="fe nk nl nm nn b">null</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/be1ab24e0786b7aa9408687e63f3b9ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*aGEv0L6Pq2sNO4Gh8PRwTw.png"/></div></figure><p id="195a" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">每当我们点击一个<code class="fe nk nl nm nn b">Marker</code>，我们就将状态设置为我们分配给<code class="fe nk nl nm nn b">Marker</code>的热点对象。我们通过传递一个<code class="fe nk nl nm nn b">onClick</code>回调函数来做到这一点，该函数返回它的<code class="fe nk nl nm nn b">Marker</code>的对象。</p><p id="97c0" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">您会记得，我们迭代了所有的<code class="fe nk nl nm nn b">wifiHotspots</code>，并为每一个创建了一个<code class="fe nk nl nm nn b">Marker</code>。这是一个传递回调的好地方。</p><p id="35d8" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">我们通过在我们的<code class="fe nk nl nm nn b">Marker</code>中写一个<code class="fe nk nl nm nn b">onClick</code>，并把对象传递给<code class="fe nk nl nm nn b">setState</code>来实现。</p><p id="266d" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">之后，我们的<code class="fe nk nl nm nn b">loadWifiMarkers</code>函数看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/059461645b8c2294c96d2ceaf63a380f.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*Qzpcv7ozd5rbJxUjwmzp4Q.png"/></div></figure></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="a299" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">setSelectedHotspot函数</h1><p id="e9bb" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">如你所见，我们还没有编写setSelectedHotspot函数。这是最基本的国家职能:</p><pre class="kj kk kl km gt nu nn nv nw aw nx bi"><span id="1344" class="ny kv it nn b gy nz oa l ob oc"><strong class="nn iu">setSelectedHotspot</strong> = object =&gt; {<br/>  this.<strong class="nn iu">setState</strong>({<br/>     selectedHotspot: object<br/>  });<br/>};</span></pre></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="6ce8" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">弹出逻辑</h1><p id="318a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">所以现在我们可以设置一个标记被点击时的状态。然后呢？</p><p id="5097" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">我们需要做的就是在我们的JSX中编写一个三元运算符，有条件地呈现我们的<code class="fe nk nl nm nn b">selectedHotspot</code>的<code class="fe nk nl nm nn b">Popup</code>。如果<code class="fe nk nl nm nn b">selectedHotspot</code>是一个对象，渲染它的<code class="fe nk nl nm nn b">Popup</code>，如果不是，什么都不做。</p><p id="33ce" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">然后我们插入一个<code class="fe nk nl nm nn b">onClose</code>键，它的值是一个点击时将<code class="fe nk nl nm nn b">selectedHotspot</code>切换回<code class="fe nk nl nm nn b">null</code>的函数。</p><h2 id="e0d1" class="ny kv it bd kw of og dn la oh oi dp le lv oj ok lg lz ol om li md on oo lk op bi translated">为了澄清…</h2><p id="c851" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">标记器<code class="fe nk nl nm nn b">onClick =&gt;</code>将对象置于<code class="fe nk nl nm nn b">selectedHotspot</code>状态，组件重新渲染，此时三元运算符将看到状态中的对象并渲染<code class="fe nk nl nm nn b">Popup</code>组件。</p><p id="d980" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated"><code class="fe nk nl nm nn b">onClose =&gt;</code>设置<code class="fe nk nl nm nn b">selectedHotspot </code>状态为空，重新渲染组件，不渲染<code class="fe nk nl nm nn b">Popup</code>。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="0814" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated"><strong class="ak"> onClose功能</strong></h1><pre class="kj kk kl km gt nu nn nv nw aw nx bi"><span id="6fb1" class="ny kv it nn b gy nz oa l ob oc"><strong class="nn iu">closePopup</strong> = () =&gt; {<br/>  this.<strong class="nn iu">setState</strong>({<br/>    selectedHotspot: null<br/>  }); <br/>};</span></pre><p id="b477" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">这被添加到<code class="fe nk nl nm nn b">loadWifiMarkers</code>功能的下面。</p><pre class="kj kk kl km gt nu nn nv nw aw nx bi"><span id="afe5" class="ny kv it nn b gy nz oa l ob oc">{this.state.selectedHotspot !== null ? (<br/>&lt;<strong class="nn iu">Popup<br/>  </strong><em class="oq">latitude</em>={<strong class="nn iu">parseFloat</strong>(this.state.selectedHotspot.latitude)}<br/>  <em class="oq">longitude</em>={<strong class="nn iu">parseFloat</strong>(this.state.selectedHotspot.longitude)}<br/>  <em class="oq">onClose</em>={this.closePopup}<br/>&gt;<br/>  &lt;p&gt;HotSpot Information&lt;/p&gt;<br/>&lt;/<strong class="nn iu">Popup</strong>&gt;<br/>) : null}</span></pre><p id="bc8b" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">你会注意到这打开了我们点击的<code class="fe nk nl nm nn b">Marker</code>上的<code class="fe nk nl nm nn b">Popup</code>。当您点击<code class="fe nk nl nm nn b">Popup</code>时，它关闭。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/c0f9462bf0ff453a22775acf27f4bd48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*WcNfxjwQbk7-X3E57FsVhw.png"/></div></figure><p id="a08e" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">现在我们可以从我们的<code class="fe nk nl nm nn b">selectedHotspot</code>中添加我们想要的任何信息。</p><pre class="kj kk kl km gt nu nn nv nw aw nx bi"><span id="610d" class="ny kv it nn b gy nz oa l ob oc">{this.state.selectedHotspot !== null ? (<br/>  &lt;<strong class="nn iu">Popup<br/>    </strong><em class="oq">latitude</em>={<strong class="nn iu">parseFloat</strong>(this.state.selectedHotspot.latitude)}<br/>    <em class="oq">longitude</em>={<strong class="nn iu">parseFloat</strong>(this.state.selectedHotspot.longitude)}<br/>    <em class="oq">onClose</em>={this.closePopup}<br/>  &gt;<br/>    &lt;div&gt;<br/>      &lt;p&gt;<br/>        &lt;b&gt;Location:&lt;/b&gt; {this.state.selectedHotspot.location}{", "}<br/>        {this.state.selectedHotspot.city}<br/>      &lt;/p&gt;<br/>      &lt;p&gt;<br/>        &lt;b&gt;Type:&lt;/b&gt; {this.state.selectedHotspot.location_t}<br/>      &lt;/p&gt;<br/>    &lt;/div&gt;<br/>  &lt;/<strong class="nn iu">Popup</strong>&gt;<br/>) : null}</span></pre><p id="d31c" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">我们得到了这个:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/8dc5a212b309dc4987daaa961c243927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*7-BOIp52Ye7EeAIlZKKaBA.png"/></div></figure></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h1 id="bbdf" class="ku kv it bd kw kx ne kz la lb nf ld le jz ng ka lg kc nh kd li kf ni kg lk ll bi translated">结论</h1><p id="b023" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在我们可以用我们的<code class="fe nk nl nm nn b">Popup</code>组件以编程方式呈现弹出窗口，它显示每个热点的信息。这带来了更好的用户体验和基本的应用程序功能。</p><p id="6429" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mu lx ly lz mv mb mc md mw mf mg mh im bi translated">非常感谢你的阅读！</p></div></div>    
</body>
</html>