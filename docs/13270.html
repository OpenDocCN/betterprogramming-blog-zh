<html>
<head>
<title>Implementing the Google Place Autocomplete Widget in React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React Hooks中实现Google Place自动完成小部件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-implement-the-google-place-autocomplete-widget-in-react-hooks-4394a7a4e3b0?source=collection_archive---------4-----------------------#2022-08-12">https://betterprogramming.pub/how-to-implement-the-google-place-autocomplete-widget-in-react-hooks-4394a7a4e3b0?source=collection_archive---------4-----------------------#2022-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0977" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Google Place自动完成小部件表单的简单示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/c44d0f850931e055e88415e6188a3d7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QxJndhosvTUgr0Cthe8Aw.png"/></div></figure><p id="d11d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">自从我写了一篇如何做的文章以来，已经一年多了。在那段时间里，我启动了一个新的软件公司，我们一直在开发一个名为<a class="ae lm" href="https://anotherself.com" rel="noopener ugc nofollow" target="_blank"> AnotherSelf </a>的新档案应用程序和一个名为<a class="ae lm" href="https://anotherhire.com" rel="noopener ugc nofollow" target="_blank"> AnotherHire </a>的求职应用程序。这两个集成的应用程序都构建在Node和React之上。我想开始分享我们在这些应用程序中构建的一些东西，我认为其他人会发现这些东西很有用。</p><p id="0ed2" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">本文将向您展示如何将Google Place Autocomplete小部件合并到使用React Hooks构建的地址表单中。这个例子将把Autocomplete放入它自己的服务中，该服务可以在整个应用程序中的多个地址表单上重用。</p><p id="7d83" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一如既往，有不止一种方法来剥这只猫的皮。我在这里展示的是我是如何完成我需要做的事情的。请根据您的代码编写风格进行调整。</p><p id="08e9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们开始吧！</p></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><h1 id="1830" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">获取谷歌地图API密钥</h1><p id="987e" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">为了使用Google Place Autocomplete小部件，您需要一个Google Maps API密钥。这意味着你需要前往谷歌云控制台，创建一个帐户，并为谷歌地图平台设置凭证。在Google Maps Javascript API中，您需要启用Places API服务。</p><p id="5519" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">你可以点击<a class="ae lm" href="https://developers.google.com/maps/documentation/javascript/places-autocomplete" rel="noopener ugc nofollow" target="_blank">这个链接</a>来访问谷歌云控制台上的说明，它会带你完成这项工作。</p><p id="5a67" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在Google Cloud控制台中对这个API键进行限制是很重要的，这样它就只能在您发布到本地主机的站点的域中工作。</p><p id="8fd0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦你完成了，你将需要谷歌地图API密匙来继续。</p><p id="374b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">注意</strong>:当您启用Places API服务时，会提示您启用计费。这是因为您可以通过此服务请求收费的数据组件。然而，我们将在本例中使用的数据来自<strong class="ks iu">基本数据</strong>类别，该类别(根据<a class="ae lm" href="https://developers.google.com/maps/documentation/places/web-service/usage-and-billing" rel="noopener ugc nofollow" target="_blank">当前使用和计费政策</a>)不产生费用。</p></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><h1 id="d2b2" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">示例代码</h1><p id="fef9" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">所有示例代码都可以在下面的GitHub资源库中找到。请随意下载并以任何方式使用此代码，无需注明出处:</p><ul class=""><li id="666e" class="mr ms it ks b kt ku kw kx kz mt ld mu lh mv ll mw mx my mz bi translated">示例应用程序代码:<a class="ae lm" href="https://github.com/crmcmullen/medium-react-google-places" rel="noopener ugc nofollow" target="_blank">medium-react-Google-places</a></li></ul><p id="d3a5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦您克隆了这个库，您将需要导航到项目并运行<code class="fe na nb nc nd b">npm install</code>来安装必要的项目库。完成后，您应该有一个如下所示的项目文件夹:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ne"><img src="../Images/0130e3cc60001ac585706d59161cb334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t2fdQTNu0i3tWQRzwwVYKw.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">图1: VSCode项目文件夹结构</p></figure></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><h1 id="b06f" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">将您的谷歌地图API添加到Index.html</h1><p id="d5fa" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">打开<code class="fe na nb nc nd b">public/index.html</code>文件，修改加载Google Maps API的行，以包含您在上面的Google Cloud控制台中创建的API键。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">示例1:将您的Google API密钥添加到index.html</p></figure><p id="2f33" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">用您创建的Google API键替换文本<code class="fe na nb nc nd b">[YOUR-GOOGLE-API-KEY]</code>。</p><p id="a157" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦完成，你应该可以用<code class="fe na nb nc nd b">npm start</code>启动应用程序，它将会工作。</p><p id="e2c8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在让我们检查一下代码中发生了什么。</p></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><h1 id="4780" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">Google Place自动完成服务</h1><p id="73fe" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">打开文件<code class="fe na nb nc nd b">service/google_place_autocomplete.js</code>。</p><p id="8e91" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">该服务可以在任何有地址表单的页面上使用，您可以在该页面上提供自动完成小部件。它提供了两个功能:</p><ul class=""><li id="26ec" class="mr ms it ks b kt ku kw kx kz mt ld mu lh mv ll mw mx my mz bi translated"><code class="fe na nb nc nd b">initAutocomplete</code></li><li id="75b8" class="mr ms it ks b kt np kw nq kz nr ld ns lh nt ll mw mx my mz bi translated"><code class="fe na nb nc nd b">getFullAddress</code></li></ul><p id="a7c8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe na nb nc nd b">initAutoComplete</code> —从应用程序主页上的<code class="fe na nb nc nd b">useEffect</code>调用一次该功能。它将Google Maps Places Autocomplete小部件绑定到作为第一个参数传入的HTML input元素；<code class="fe na nb nc nd b">input</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">示例2:初始化地点自动完成小部件</p></figure><p id="476c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">请注意，在本例中，我们使用<code class="fe na nb nc nd b">componentRestrictions</code>参数将预测结果限制在美国和加拿大。这可以完全删除或扩展到包括其他国家。</p><p id="be7d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">注意:<code class="fe na nb nc nd b">fields</code>参数是<em class="nu">要考虑的最关键的</em>。强烈建议将自动完成限制在这些字段中，因为这是小部件所必需的。如果您没有将预测限制在特定的字段，place小部件将返回一个地点的所有字段，包括可收费类别中的字段！注意你要求API返回什么。</p><p id="205e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这样，当您开始在表单的这个输入字段中键入内容时，Autocomplete小部件将自动显示在您的输入字段下，预测将随着您的继续键入而调整(见图2)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/e5aaf745727e2bec396b2682f3443d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*iEwfnNBsCNcFaTM0JtXCDg.png"/></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">图2:运行中的自动完成小部件</p></figure><p id="05b4" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这个小部件的美妙之处在于它处理所有的UI呈现以及会话令牌处理。显示的是您可能在许多网站上见过的标准地点预测小部件。</p><p id="b6fe" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">谷歌控制台的自动完成小部件页面上有一些说明，会告诉你如果你真的觉得不满意，该如何设计呈现的用户界面。您甚至可以完全放弃这个小部件，直接调用Autocomplete服务并在您自己的UI中呈现。</p><p id="cfce" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在<code class="fe na nb nc nd b">initAutoComplete</code>函数中发生的最后一件事是在小部件上启动一个监听器(参见示例3 ),当从显示的预测中选择一个地址时就会触发这个监听器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">示例3:添加一个用于选择地点的监听器</p></figure><p id="eba6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">它将使用所选地址的ID调用内部小部件函数<code class="fe na nb nc nd b">place_changed</code>，并将该地址传递给第二个传递的参数中提供的回调函数；<code class="fe na nb nc nd b">callback</code>。</p><p id="c006" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe na nb nc nd b">getFullAddress</code> —该函数由<code class="fe na nb nc nd b">initAutoComplete</code>中建立的监听器中提供的回调函数调用。</p><p id="af60" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">它接收选定的地点，解析所有的地址组件，并在JSON对象中返回它们，然后可以使用该对象填充页面上的地址表单。</p></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><h1 id="6d65" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">应用程序主页</h1><p id="3d5d" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">打开文件<code class="fe na nb nc nd b">component/home.js</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">示例4:为Place小部件创建一个引用</p></figure><p id="1cd5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Place Autocomplete小部件需要绑定到HTML input元素，以便在键入时提供预测。在这个例子中，我用一个<code class="fe na nb nc nd b">useRef()</code>将它绑定到表单上的address1字段(主要街道地址)。</p><p id="d9b6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我还为我们的Google Place自动完成服务定义了一个常量(如上所述)。</p><p id="370f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe na nb nc nd b">handleAddressSelect()</code> —在初始化Google Place自动完成服务时，此函数作为<code class="fe na nb nc nd b">callback</code>函数传入。每当从微件中显示的预测中选择一个地点时，都会调用此函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">示例5:处理选定的地址</p></figure><p id="223b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">它通过传入选定的位置来调用Google Autocomplete服务中的<code class="fe na nb nc nd b">getFullAddress</code>函数，并接收回一个包含所有已解析地址组件的JSON对象。然后，它用这些地址组件的值填充相关表单字段的值。</p><p id="a335" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe na nb nc nd b">useEffect()</code> —最后，一旦页面加载完毕，<code class="fe na nb nc nd b">useEffect</code>函数运行并用<code class="fe na nb nc nd b">initAutoComplete</code>初始化Google Place Autocomplete小部件，并将其绑定到我们用<code class="fe na nb nc nd b">address1ref</code>创建的HTML输入元素的引用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">示例6:将输入元素绑定到小部件</p></figure><p id="01b7" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">当从小部件的预测列表中选择一个地点时，它还会将<code class="fe na nb nc nd b">handleAddressSelect</code>作为监听器回调函数传入。</p><h1 id="7d42" class="lu lv it bd lw lx nw lz ma mb nx md me jz ny ka mg kc nz kd mi kf oa kg mk ml bi translated">摘要</h1><p id="eaba" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">就是这样！这是一个非常简单的演示例子，演示了如何在React Hooks地址表单中实现最流行的Google Maps服务之一。</p><p id="a2fe" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我希望这篇文章和支持代码对您的项目有所帮助。</p></div></div>    
</body>
</html>