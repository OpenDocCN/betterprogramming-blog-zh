<html>
<head>
<title>Building Your Own WotsApp — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您自己的WotsApp —第1部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-your-own-wotsapp-part-1-1275abba645f?source=collection_archive---------13-----------------------#2020-03-04">https://betterprogramming.pub/build-your-own-wotsapp-part-1-1275abba645f?source=collection_archive---------13-----------------------#2020-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="06a3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用SwiftUI、Combine、通知、CloudKit和加密技术</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a96a9736be81e473062946e5d519501b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jDwI3jhtaZ4GS_R3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿兰·范在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="17b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我应该以免责声明开始这篇文章:它是基于iOS 13、Swift 5和Xcode 11.x的。如果你正在阅读这篇文章，而那些数字看起来过时了，请预先警告。</p><p id="7f2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还应该提醒你，通知——主要是远程通知——涉及苹果的基础设施，这意味着你需要一个苹果开发者账户才能使用它们。当然，你也需要一个来使用CloudKit。</p><p id="9a0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，这将是一个系列。你不会在20分钟内建立自己的WotsApp。我大部分时间会穿着裤子坐在座位旁边。这至少需要十章，本文只包括前两章。</p><p id="998d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们言归正传。你可以在Swift下找到很多关于编码通知的文章，尽管你很快会发现它们都不完整。不，我不骗你。在我看来，它们是不完整的，因为它们缺少了解释如何在iOS下发布远程通知的一章。我从未遇到过讨论如何在Swift中发布通知的教程。他们都告诉你使用第三方工具。所以我调查了这个主题，写了我自己的。</p><p id="3b1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是缺环还是阴谋？无论如何，我将尝试涵盖整个故事，因为我描述了如何建立自己的WhatsApp应用程序。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d0e3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第一章</h1><p id="6d91" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">那么什么是通知呢？嗯，他们有两种口味:本地和远程。您可以在同一个应用程序中创建和发布本地通知。远程通知在服务器或第二台iOS设备上创建，并发送到同一台和/或另一台iOS设备。它们是iOS军械库中非常特殊的部分，因为它们可以在前台和后台运行。</p><p id="bced" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">iOS 13下的通知有几种类型。重要的是警报、徽章和声音。我们将探究它们在代码中的作用。</p><p id="6ed9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本地通知虽然不能保证，但几乎总是会到达。远程通知本来就不太可靠。本地通知也没有数量限制，但远程通知有。它们都有一个共同点，那就是与副本相关联。默认情况下，它们永远不会到达。因此，如果您发送相同的通知两次，它将只显示一次。</p><p id="ffb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理论已经够多了。让我们从创建一个新的应用程序开始。我打算叫它沃采普。你也应该使用SwiftUI，因为我打算这么做。当然，我们从权限开始，权限分为两个级别。在顶部，您可以启用/禁用所有通知。再往下一层，你可以区分不同的类型。</p><p id="7f18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，我们在代码中需要做的第一件事是请求使用通知的许可。打开您的<code class="fe mz na nb nc b">AppDelegate</code>并为其创建一个扩展。使其成为<code class="fe mz na nb nc b">UNUserNotificationCenterDelegate</code>的代表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="4e50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加这段代码，并确保从您的<code class="fe mz na nb nc b">didFinishLaunchingWithOptions</code>方法中调用它。</p><p id="a857" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，创建一个新类，并将其命名为<code class="fe mz na nb nc b">LocalNotification.swift</code>。将以下代码添加到其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="9f97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这创建了一个基本的本地通知对象，然后使用一个简单的定时触发器(在我们的例子中为4秒)将它发送到本地设备。为了调用它，我们需要移到我们的<code class="fe mz na nb nc b">ContentView.swift</code>文件并添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="54a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个按钮，您可以按下它来触发您的本地通知。运行并编译它，看看会发生什么。</p><p id="c680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">什么？什么都没发生。你做错了什么？</p><p id="a258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没什么。这种iOS行为是故意的。当你的应用程序在前台时，通知并不是你提出来的东西，默认情况下它们不会出现。你需要对你的<code class="fe mz na nb nc b">AppDelegate.swift</code>扩展做另一个改变来看到它启动。将以下代码添加到其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e999" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编译并再次运行它。这次应该会很管用。</p><p id="a7eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，现在本地通知起作用了。这是一个好的开始。但是等等……我们需要的是远程通知。这些通知是通过服务器或其他iOS设备发出的。它们是如何工作的？</p><p id="b256" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，您需要获得显示通知的权限——与本地通知所需的权限相同，因此您可以勾选这个框。远程通知的下一步是获取运行设备的ID。你需要这个来告诉苹果它需要向哪里发送远程通知。您可以从这段代码开始，这段代码需要添加到您的<code class="fe mz na nb nc b">appDelegate.swift</code>中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="395e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将产生一个64个字符的字符串，向Apple识别您的设备以进行通知。但请注意:如果您删除并重新安装您的应用程序，它将是一个不同的64个字符的字符串。我在编写这个应用程序时发现的第二个注意点是，苹果在这方面已经改变了目标。所以这个在iOS 13上可以用，但是我从来没有在iOS 12上测试过，在iOS 14上可能会坏。检查堆栈溢出，这总是一个很好的解决这类问题的来源。</p><p id="2ab1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是在尝试之前，您需要添加接收推送通知的功能。点击Xcode项目的目标，移动到Signing and Capabilities，并添加(在单词“Capabilities”旁边有加号)推送通知。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/9ce354f25d3c146691eb09795dd104a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*p63N3BJ0BVhQPbydBrC3fw.png"/></div></figure><p id="0976" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，您就可以编译和运行项目了。这一次，您应该在控制台中获得一个64个字符的十六进制代码。好吧，这就是大多数向导告诉你下载一个应用程序来测试它的地方。我不会那么做的。我们都是程序员。我们要代码——不要用别人的应用。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2445" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第二章</h1><p id="4baf" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在你需要测试你的魔法。首先，我们需要登录您的Apple帐户，获取一个私钥，您将使用该私钥来请求发布通知。打开web浏览器并登录您的Apple Developer帐户。在“概述”页面上，您将看到我们正在寻找的名为“证书、标识符和配置文件”的选项卡。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/b9e3f0f85830bc5276c00d3ab94dd590.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*phuw9Z0JwEvBDc5B8CWtzw.png"/></div></figure><p id="e76a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击它，然后单击左侧选项卡中名为“Keys”的项目。在那里，你可以点击蓝色圆圈中的白色加号。您应该会发现自己看到的配置屏幕看起来很像这样。请注意，您只能创建两个APNS类型的密钥，所以要明智地使用它们。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/61dc82ddd778e78320ab310b1287c7d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6A8OulA-RJvi57sxjFV3-Q.png"/></div></div></figure><p id="63bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击注册，稍等片刻。注册后，请特别注意将出现在页面上的密钥ID。你以后会需要它的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/0fb03b3734ff09b6cfac0ef1c59b944d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l2yJOTXciWttB1PTuAFCPA.png"/></div></div></figure><p id="d873" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好，现在下载你的签名。它将包含在扩展名为. p8的文件中。标准OS X上的应用程序都不理解什么是. p8文件，你将无法正常打开它。但是我们在这里即兴表演，我需要. p8的内容来继续。前往“下载”,右键单击该文件，然后用“文本编辑”应用程序打开它。不，不推荐使用它来打开. p8文件。你必须强迫它出手。当然，如果你像我一样是一个非常守旧的人，你也可以使用终端应用程序中的vi编辑器来打开它。</p><p id="188b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你打开它，你会看到这样的内容。</p><pre class="kj kk kl km gt nj nc nk nl aw nm bi"><span id="3ab2" class="nn md it nc b gy no np l nq nr">-----BEGIN PRIVATE KEY-----<br/>MIGTAgVAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQgl8Kij2y6acAgp1FZ<br/>BHqI6T/Bv4bBgndxuVr1IfuYhemgBgYIKoZIzj0DAQehRANCAASweAt5jGR5H1Vf<br/>QmlPyVVa2hn8jPLxdg0wHyP/xpXbJ5kGunlkXomLh8k+d31tWKKQF2QTzPCzckyi<br/>p0aHWAWG<br/>-----END PRIVATE KEY-----</span></pre><p id="674f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是您将用来加密发送给Apple的信息的秘密私钥。好了，回到编码。重新打开WotsApp项目并创建另一个名为<code class="fe mz na nb nc b">RemoteNotifications.swift</code>的类。将我们刚刚提取的两条数据添加到其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="7ced" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，那是三段引文。你需要所有的东西。现在我想一些读者可能会发现最可怕的部分。我们需要一个第三方库来完成这项工作。我们要找的库是IBM写的。谷歌“swift jwt库”你应该带着这个<a class="ae ky" href="https://github.com/IBM-Swift/Swift-JWT" rel="noopener ugc nofollow" target="_blank">链接</a>回来。点击链接，你会发现自己在GitHub中查看这个库:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/2362bc4003e446ca3e4a7c81a6875627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y3nPTAF0Wgpo714A57aexw.png"/></div></div></figure><p id="cae4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">复制URL并移回Xcode项目。点击蓝色项目图标，然后点击Swift Packages选项卡。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/ef3195d3bf947475ad34552d1b7131dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tFJX7ZhwZhxG76BkYVhhYw.png"/></div></div></figure><p id="92e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击+并将IBM-Swift/Swift-JWT软件包的名称粘贴到将出现的对话框中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/1953cc51b70c09ac0e2b0fba157f107a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fmhwgx5LiFaSaqEgliOWKQ.png"/></div></div></figure><p id="c9a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击下一步，等待，看它验证一切。最后，单击“完成”按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/21149084bec165cfaf22c08bd889965f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*egNpm1iy4Id4J2BdKIG5eQ.png"/></div></div></figure><p id="d4b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设一切顺利，您的项目现在应该包括了<code class="fe mz na nb nc b">SwiftJWT</code>库。返回到<code class="fe mz na nb nc b">RemoteNotifications</code>类并导入您的新库。编译它只是为了检查一切工作正常。您应该不会收到任何错误。别担心，那是最伤脑筋的部分。现在应该是一帆风顺了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="583b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是创建一个我们可以发布到苹果通知服务器的有效负载。JSON有效负载。这里有一个适合你的项目:</p><pre class="kj kk kl km gt nj nc nk nl aw nm bi"><span id="6562" class="nn md it nc b gy no np l nq nr">Yes, it is another magic number of sorts we’re adding. Don’t worry, I am just doing this to get things going. Now for good measure, to make sure you didn’t mistype anything here, add this code to your RemoteNotification class:</span><span id="59b1" class="nn md it nc b gy nw np l nq nr">private var jsonObject: [String: Any] = ["aps":["badge":2,"category":"mycategory","alert":["title":"What, where, who, when, how","body":"You must be kidding"]]]</span></pre><p id="b46a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mz na nb nc b">ContentView.swift</code>中创建一个<code class="fe mz na nb nc b">RemoteNotification</code>类的实例——就像您对<code class="fe mz na nb nc b">LocalNotification</code>类所做的那样——并运行它以确保一切正常。您也可以为它创建第二个按钮。您应该在控制台中看到一条消息，确认您的JSON掘金是有效的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="88d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您已经准备好使用IBM库了。通过将这段代码添加到您的<code class="fe mz na nb nc b">RemoteNotification.swift</code> <code class="fe mz na nb nc b">postNotification</code>方法中，定义组成JSON Web令牌的三个部分中的两个:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="6403" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有两个字段需要与所示代码不同的值。<code class="fe mz na nb nc b">kid:</code>是您的私钥的密钥ID，我们前面已经描述过了。而<code class="fe mz na nb nc b">iss:</code>属性是你的团队ID，你应该可以在苹果账户会员页面下找到。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/8c8d5fdd9fab51c81c02ac2eae849874.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RKVChteqy_4FzKuiYMX_w.png"/></div></div></figure><p id="f8f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义了前两部分之后，现在需要使用您的私钥来构建第三部分。这是您的JSON Web令牌。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="1c78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个谜题的最后一步是打电话给苹果公司的APNS服务部。一些附加说明:</p><ul class=""><li id="954f" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated">代码中显示的URL是针对沙箱的。你需要用一个稍微不同的来制作。</li><li id="a93d" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">这里提到的令牌是我们在第一章中向Apple注册设备时获取的64个字符的字符串。</li><li id="89ad" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><code class="fe mz na nb nc b">apns-topic</code>是项目的包标识符，<code class="fe mz na nb nc b">jwtString</code>是我们刚刚构建的JSON Web令牌。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="bf17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编译它并解决作业中的错误。好吧，我开玩笑的。应该只有一个错误——需要将<code class="fe mz na nb nc b">RemoteNotifications</code>变成a类<code class="fe mz na nb nc b">URLSessionDelegate</code>。这段代码的最后一部分:</p><pre class="kj kk kl km gt nj nc nk nl aw nm bi"><span id="7d60" class="nn md it nc b gy no np l nq nr">class PostController: NSObject,URLSessionDelegate {</span></pre><p id="476f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您需要做的就是从SwiftUI接口调用您的新<code class="fe mz na nb nc b">RemoteNotification</code>类。下面显示的代码是为了完整性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="2ff8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在真实设备上运行应用程序，然后按下远程按钮。您应该会收到如下所示的通知:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/5b4b8dc69f214dba936e5f6c99516076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u2doN8HgsuFN12Cn2_o84Q.png"/></div></div></figure><p id="7185" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，通知不会来自Noob。会是沃采普送的。以防出现问题，并且您在发布时没有得到那个神奇的200成功错误代码，这里有一个表格可以帮助您调试您得到的代码:</p><ul class=""><li id="9717" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated">200 —成功。</li><li id="05d7" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">400 —错误的请求。</li><li id="fc10" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">403-证书或提供商身份验证令牌有错误。</li><li id="7e20" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">405 —请求使用了错误的<code class="fe mz na nb nc b">:method</code>值。仅支持发布请求。</li><li id="d92f" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">410 —设备令牌对于主题不再有效。</li><li id="4a0a" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">413-通知负载太大。</li><li id="1fb8" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">429 —服务器收到太多对同一设备令牌的请求。</li><li id="78ee" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">500 —内部服务器错误。</li><li id="efcc" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">503-服务器正在关闭，不可用。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bcf1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="f696" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我将在未来几天发布第三章。要把这个WotsApp投入生产，我们还有很多工作要做。请继续阅读。</p></div></div>    
</body>
</html>