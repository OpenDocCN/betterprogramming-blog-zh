<html>
<head>
<title>Call Python and R Scripts From Excel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Excel调用Python和R脚本</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/call-python-and-r-scripts-from-excel-76d1c1c6fb1a?source=collection_archive---------1-----------------------#2022-05-07">https://betterprogramming.pub/call-python-and-r-scripts-from-excel-76d1c1c6fb1a?source=collection_archive---------1-----------------------#2022-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2a02" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何将Python或R数据处理任务集成到excel中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ae1ee1863732c167222298bf4af5d2da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*byTniOAqqLDzfKy3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jjying?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> JJ英</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><h1 id="a1d7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">序文</h1><p id="bfc6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我喜欢用Python或r来争论、管理和处理数据。</p><p id="9fbb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，我的雇主在Excel中做大多数事情。我想把我的Python或R代码集成到我的Excel文档中。</p><p id="b23e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，我需要将结果直接输出到Excel工作簿中。</p><p id="b87d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我发现我可以用最少的Visual Basic for Applications (VBA)脚本来实现这一点，并将我的Python或R脚本重新安排到应用程序中。</p><p id="6aca" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你想用Python和R简化你的Excel工作流程，那么本教程就是为你准备的！</p><h1 id="2c04" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">概观</h1><p id="112b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我的工作中，所有东西都分散在一堆不同的Excel表格中。有些是不同软件程序输出的(我每周都做)，有些是公司自己预处理的。</p><p id="f8d3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当处理这些文档时，我要么尝试自动化以前的手动过程，要么改进现有的Excel工作簿，该工作簿可以受益于Python或r的一些数据处理。</p><p id="866e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我发现最适合我的操作顺序如下:</p><ul class=""><li id="788f" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><strong class="lt iu">第一步——探索性数据分析:</strong>探索Jupyter笔记本或R Markdown中的数据</li><li id="ab71" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><strong class="lt iu">步骤2——创建函数:</strong>将代码分组到逻辑函数中。</li><li id="c13b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><strong class="lt iu">第三步——分离脚本:</strong>将函数分成不同的脚本，用于代码中的每个流程。</li><li id="8023" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><strong class="lt iu">步骤4——创建应用程序:</strong>创建一个主脚本，从每个特定于流程的脚本中导入函数。</li><li id="0439" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><strong class="lt iu">步骤5 —命令行应用:</strong>通过从命令行调用确保应用正常工作。</li><li id="7a8a" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><strong class="lt iu">步骤6 — VBA运行脚本:</strong>编写VBA脚本，从Excel调用应用程序，并确保输出直接填充到Excel工作簿中。</li><li id="9c81" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><strong class="lt iu">第7步——检查再现性:</strong>确保我或其他人可以每周重复这个过程，以提高效率和简化工作流程。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/610cf18fb3dc42e91777f705bb495ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3NHxw9lXDpqGkaKf1jhEFQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有运行Rscript的宏按钮的Excel工作簿示例</p></figure></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="243c" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">探索性数据分析</h1><p id="9e06" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">EDA是我探索数据并提出一系列问题的过程的一部分。其中一些可能是:</p><p id="aec3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="nt">每列是哪种数据类型？</em></p><p id="aeb9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="nt">什么是数据集维度？</em></p><p id="77be" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我需要在导入中合并任何列吗？</p><p id="deb0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我需要删除任何列吗？</p><p id="c6e2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="nt">有哪些描述性统计？</em></p><p id="c920" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这有助于我在开始编码之前掌握数据。我的下一步通常是勾勒出我试图实现的确切过程的简要轮廓，然后开始编码。编码完成后，就该开始组织流程了。</p><h1 id="c265" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">功能</h1><p id="7008" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一旦我完成了编码，我就可以从头到尾运行笔记本并生成可重复的结果，然后我开始将代码重构为函数。我给这些函数起了容易辨认的名字，并开始考虑它们应该属于哪个组。</p><h1 id="40cf" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">剧本</h1><p id="5202" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我模块化我的代码之后，我开始把它们分成几个脚本文件。我确保每个脚本都有一个特定于其在整个工作流中的独特过程的逻辑标题。有时我会有一个通用脚本，其中包含在整个项目中重用的函数。完成后，我将所有脚本移动到同一个目录中，这样我可以在构建主应用程序脚本时导入它们。</p><p id="c728" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是我的一个项目目录的结构示例:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="da00" class="nz la it nv b gy oa ob l oc od">── FWW &lt;- Top-level directory<br/>├── data<br/>│  ├── Employee List.xls<br/>│  ├── Actuals Report.xls<br/>│  ├── Premium Audit.xls<br/>│  ├── Scheduler.xls<br/>│  ├── Schedule Audit Trail.xls<br/>├── scripts<br/>│  ├── __init__.py<br/>│  ├── cleaning_and_merges.py<br/>│  ├── data_import.py<br/>│  ├── feature_engineering.py<br/>│  ├── format_final_df.py<br/>├── __init__.py<br/>├── __main__.py<br/>├── fww_app.py<br/>└── Premium Audit.xlsb &lt;- Macros</span></pre><h1 id="b7bc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">应用</h1><p id="3e9b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">构建应用程序脚本对我来说是一个激动人心的时刻。主要是因为我可以在一个文件中查看我的项目的所有逻辑，而不是查看多个笔记本或脚本。通常情况下，它都可以显示在一个屏幕上。这就是给每个脚本和函数起一个有意义的名字的重要性。</p><p id="ca5d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我通常在每一节之前都有一个注释来解释它的目的。此外，如果我现在需要修改任何代码，我可以简单地进入该脚本，进行编辑，然后将该脚本重新导入到应用程序文件中，并重新运行。也就是说，该目录还需要进行组织，以便您可以轻松地从应用程序文件中调用脚本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/ad61084518be5cc32c8be585ce871eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*wkHuYuzGIbOnTKtk9wEBeQ.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python项目目录，脚本在一个文件夹中，数据在另一个文件夹中，Excel工作簿/Python应用程序在主文件夹中。</p></figure><p id="67b1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以下是导入所有流程特定脚本的最终应用程序文件的一些示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我实现的项目的Python应用程序文件。</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我最近实施的一个项目的r应用程序。</p></figure><p id="013b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下一步是确保应用程序准备好从命令行执行。</p><h1 id="fe88" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">命令行</h1><p id="c2f2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一旦应用程序文件启动并运行，我希望能够从命令行运行它。我最不想做的事情就是打开Visual Studio代码或R Studio，并在每次需要运行程序时重新运行该文件。</p><p id="4ca3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通常这些程序每周运行一次，因此需要高效且可重复。在这里，您可能需要将Python或R路径添加到您的环境变量中。</p><p id="3a4b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇<a class="ae ky" href="https://www.educative.io/edpresso/how-to-add-python-to-path-variable-in-windows" rel="noopener ugc nofollow" target="_blank">文章</a>可以帮助你在Windows上设置路径，我在Mac上没有遇到过这些命令的问题。一旦设置完毕，从命令行调用Python或R就可以从该特定目录中完成，如下所示:</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="07bf" class="nz la it nv b gy oa ob l oc od">python -m fww.py<br/>Rscript hours_update_app.R</span></pre><p id="33d7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有时应用程序可能需要用户的输入。在这种情况下，将会生成适当的提示。一旦命令行正常工作，我就可以从Excel中调用程序了。</p><p id="6ef1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="nt">注意:</em>对于基于Python的项目，你需要一个<code class="fe oh oi oj nv b">__main__.py</code>文件。这是一个简单的文件，它导入主应用程序并执行运行命令。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">__main__。py运行Python应用程序</p></figure><h1 id="9ead" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">VBA</h1><p id="f782" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通常，我有一个excel工作簿，其中我创建了一个说明<em class="nt"> </em>选项卡，列出了流程的正确步骤。通常，我将形状作为按钮，并将宏或宏串绑定到它们上面，这将触发应用程序和VBA脚本。</p><p id="87b6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦这是工作，我确保通过一个额外的简单的VBA脚本输出复制到正确的工作簿。我喜欢使用VBA来自动化繁琐的任务，如导入、调用脚本和打开/关闭笔记本，但我更喜欢用Python或r来处理数据</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从Excel调用的Python VBA脚本</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从Excel调用的VBA脚本</p></figure><p id="f5e7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">R脚本需要更多的步骤才能工作，这篇<a class="ae ky" href="https://stackoverflow.com/questions/11597626/running-r-scripts-from-vba" rel="noopener ugc nofollow" target="_blank"> StackOverflow帖子</a>帮助了我。</p><h1 id="b968" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">再现性</h1><p id="4701" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这一点上，项目已经完成，我只需要确保它的可重复性。有时，这可能意味着更改VBA脚本的一些方面，以便其他人可以使用它，例如Python或r的可执行文件的位置。此外，定期检查我使用的报告是否仍然是相同的格式。</p><p id="9c4c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请看下面最终版本的gif图片:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/711405d5c1c2a46b3306ed0c8b2099c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BPdy_fFRAvOJLKeq7SBX3A.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从Excel宏触发的Python项目的Gif</p></figure><h1 id="a583" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="59bf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">就是这样！感谢您加入我的旅程，学习如何将Python和R集成到Excel是一次有趣的经历。有些语言更适合不同的任务，这样使用它们是有意义的。</p><p id="0129" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，将它们整合在一起，可以最大限度地提高效率并简化您的工作流程。</p></div></div>    
</body>
</html>