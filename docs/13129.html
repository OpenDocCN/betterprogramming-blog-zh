<html>
<head>
<title>SwiftUI Navigation Is a Mess. Here’s What You Can Do</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI导航一塌糊涂。你可以这样做</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swiftui-navigation-is-a-mess-heres-what-you-can-do-d5e857e9d190?source=collection_archive---------4-----------------------#2022-08-01">https://betterprogramming.pub/swiftui-navigation-is-a-mess-heres-what-you-can-do-d5e857e9d190?source=collection_archive---------4-----------------------#2022-08-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="138d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">更轻松地管理您的视图</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/17cbd7a1000997022fe364b216be1e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zY8zMALgEADM31hRfqjbBQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Mick Haupt  / <a class="ae kv" href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>摄影</p></figure><p id="a0a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SwiftUI好看又强大。然而，在pure SwiftUI中管理导航是困难的，并且会导致混乱的解决方案。在这篇文章中，我将向您展示如何有效地管理视图。</p><h1 id="54f3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么乱？</h1><p id="2d13" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这是因为SwiftUI的核心思想——视图是状态的函数，或者说视图是状态驱动的。不要误会，这个概念很棒，但是SwiftUI的导航还没有这么先进。</p><blockquote class="mp mq mr"><p id="5f41" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">视图是状态的函数，导航也不例外。</p></blockquote><p id="8485" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，SwiftUI无法在您的应用程序中构建健壮的导航。</p><h1 id="4b8e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">混乱的例子</h1><p id="8eb0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当您需要呈现一些带有漂亮过渡的视图序列时，请考虑onboarding屏幕的常见情况。你能用SwiftUI做什么？或许，创建一个<code class="fe mw mx my mz b">enum</code>来告诉用户哪个屏幕是活动的，然后使用<code class="fe mw mx my mz b">switch</code>来呈现视图序列。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="61b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果需要修改顺序或者改变视图数量怎么办？你需要修改相应的<code class="fe mw mx my mz b">enum</code>，修改视图内部的切换逻辑和其他东西。</p><p id="1dd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没那么灵活吧？</p><p id="e997" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">哦，然后你决定通过<code class="fe mw mx my mz b">.sheet</code>在中间展示一个视图。这就是混乱开始出现的时候。您创建一个额外的<code class="fe mw mx my mz b">@State</code>来检查工作表是否打开，确保它被正确更新，并重构您之前使用的<code class="fe mw mx my mz b">switch</code>块。</p><p id="0292" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，这是一个混乱的视图，容易出现意想不到的错误。</p><h1 id="d1ee" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">现有导航视图</h1><p id="6095" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">最明显的就是<a class="ae kv" href="https://developer.apple.com/documentation/swiftui/navigationview" rel="noopener ugc nofollow" target="_blank"> NavigationView </a>，在新的iOS 16中已经弃用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/8dd627ab357f03536bcaf50278c84901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Jm4ypwTWNCfoj8-9.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://developer.apple.com/documentation/swiftui/navigationview" rel="noopener ugc nofollow" target="_blank">https://developer . apple . com/documentation/swift ui/navigation view</a></p></figure><p id="fae4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe mw mx my mz b">NavigationLink</code>，它可以呈现新的视图，并添加一个“back”按钮来返回到上一个视图。</p><p id="ce93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并且它不支持编程导航。</p><p id="27c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">苹果推出了新的<a class="ae kv" href="https://developer.apple.com/documentation/swiftui/navigationstack" rel="noopener ugc nofollow" target="_blank">导航堆栈</a>来解决这个问题，但它仍然不够灵活。例如，我希望能够随心所欲地修改视图，但是NavugationStack插入了后退按钮。此外，它不支持不同的过渡。虽然很高兴看到SwiftUI朝着这个方向发展，但我们还没有到那一步。</p><p id="f100" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，即使在iOS 16中，SwiftUI也没有强大到可以管理你能想到的任何导航。</p><p id="5b93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还有<code class="fe mw mx my mz b">.sheet()</code>。<code class="fe mw mx my mz b">NavigationStack</code>也不会让<code class="fe mw mx my mz b">.sheet()</code>变得更容易处理。</p><h1 id="08bb" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">设计灵活的导航库</h1><p id="db88" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我决定创建一个有几个要求的库:</p><ul class=""><li id="16c4" class="nd ne iq ky b kz la lc ld lf nf lj ng ln nh lr ni nj nk nl bi translated">编程视图导航</li><li id="0474" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">呈现一系列视图的能力</li><li id="2cb9" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">支持任何SwiftUI过渡和动画</li><li id="fdec" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">完全由状态驱动:没有单件或环境对象</li><li id="6d4b" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">手柄<code class="fe mw mx my mz b">.sheet()</code></li></ul><p id="c58a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">听起来很酷，对吧？</p><p id="3c00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">直截了当地说，我能够创建这样一个库。</p><div class="nr ns gp gr nt nu"><a href="https://github.com/AlexRoar/PathPresenter/blob/main/README.md" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">PathPresenter/README.md位于主AlexRoar/PathPresenter</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">swiftUIOnboarding.mp4纯SwiftUI路由与过渡，动画，和。工作表()支持。在SwiftUI中，视图是一个…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">github.com</p></div></div><div class="od l"><div class="oe l of og oh od oi kp nu"/></div></div></a></div><blockquote class="mp mq mr"><p id="8e62" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">我总是乐于接受客观的批评和对新功能的要求。不要犹豫，在GitHub上打开一个问题！</p></blockquote><p id="afde" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，如果你只是想要一个好的工具来做我上面列出的事情，你可以就此打住。现在，让我们看看我是怎么做的。</p><h1 id="8f14" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">呈现方式</h1><p id="b8ac" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">库的核心是一个存储视图和关于如何展示它们的信息的结构。演示的可能选项包括:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj nb l"/></div></figure><blockquote class="mp mq mr"><p id="6655" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">请注意，通过<code class="fe mw mx my mz b">.sheet()</code>展示就像展示任何其他视图一样简单。</p></blockquote><p id="9e35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您可以在没有任何动画的情况下呈现视图，用所需的过渡来呈现视图，并在表单中呈现视图。</p><h1 id="ab80" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">小路</h1><p id="049d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这个结构存储关于视图的信息。它只是存储一个带有表示类型信息的类型删除视图数组。您可以在顶部添加视图，也可以从顶部移除视图。</p><p id="fb4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">老实说，我从<code class="fe mw mx my mz b">NavigationStack</code>得到了这个想法，就像以前一样，我尝试做一个类似的库，能够在中间插入。然而，我在中间插入动画时遇到了几个问题。大概，有可能做到。</p><h1 id="34a6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">视图本身</h1><p id="d8d9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">关键的想法是如何呈现这些视图。PathPresenter使用ZStack来完成这项工作。它仅显示未标记为<code class="fe mw mx my mz b">.sheet</code>类型的视图。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj nb l"/></div></figure><p id="9b18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">视图在自身内部管理<code class="fe mw mx my mz b">.sheet</code>，并决定何时需要显示它。如果最后一个元素必须以工作表的形式显示，那么工作表将被激活。</p><p id="7f30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样。</p><p id="0de4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我介绍了实现的核心概念。您可以查看GitHub，了解完整的实现。代码有完整的文档，你可以在评论里问我任何问题。</p><h1 id="15b2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用PathPresenter的入职示例</h1><p id="2a1d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们简单地使用图书馆；).</p><p id="4dd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了构造<code class="fe mw mx my mz b">Path</code>，我们向它添加了所需的视图，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj nb l"/></div></figure><p id="2dae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，你用<code class="fe mw mx my mz b">RoutingView(path: $path)</code>来呈现这个路径。您可以查看这个项目中的完整示例:</p><div class="nr ns gp gr nt nu"><a href="https://github.com/AlexRoar/PathPresenterExample/tree/main" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">GitHub-Alex roar/pathfrenderexample</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">github.com</p></div></div><div class="od l"><div class="ok l of og oh od oi kp nu"/></div></div></a></div><h1 id="b549" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">最终注释</h1><p id="370a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我喜欢这个图书馆的样子。您可以自由地构建任何视图序列，并构建自己的导航。</p><p id="6569" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你注意到任何错误，不要犹豫与我联系。</p><blockquote class="mp mq mr"><p id="4416" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">这篇文章最初发表在<a class="ae kv" href="https://alexdremov.me/swiftui-navigation-is-a-mess-heres-what-you-can-do/" rel="noopener ugc nofollow" target="_blank"> alexdremov.me </a>上。</p></blockquote></div></div>    
</body>
</html>