<html>
<head>
<title>How to Work With Dates in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中处理日期</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-work-with-dates-in-python-dafa47d5cb3e?source=collection_archive---------2-----------------------#2020-02-08">https://betterprogramming.pub/how-to-work-with-dates-in-python-dafa47d5cb3e?source=collection_archive---------2-----------------------#2020-02-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1544" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">解析、格式化、时区等等</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6e86e557f21d6cc452b11e202b13a603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5pRTG9vkjm_xJlIk"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丘特尔斯纳普</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="bffe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python是一种很棒的语言，内置了许多易于使用的特性。对于几乎所有的问题，要么有直接语言支持，要么有一个库。易用性和丰富的生态系统使它成为许多人的首选语言。</p><p id="a9ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们这些有使用Java和JavaScript经验的人来说，在Python中处理日期并不直观或容易。我们认为简单的功能很难实现。但并不像看起来那么糟糕。这篇文章将介绍一些处理日期的有用技巧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3b0b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.从语法上分析</h1><p id="7b75" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">第一个用例涵盖了字符串形式的日期。我们想把它解析成一个<code class="fe mz na nb nc b">datetime</code>对象。Python有一个内置的方法来解析日期，<code class="fe mz na nb nc b"><a class="ae ky" href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior" rel="noopener ugc nofollow" target="_blank">strptime</a></code>。</p><p id="6c0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个例子:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="d828" class="nh md it nc b gy ni nj l nk nl">&gt;&gt;&gt; from datetime import datetime<br/>&gt;&gt;&gt; datetime.strptime("2020-01-01 14:00", "%Y-%m-%d %H:%M")<br/>datetime.datetime(2020, 1, 1, 14, 0)</span></pre><p id="9295" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个例子获取字符串<code class="fe mz na nb nc b">“2020–01–01 14:00”</code>，并将其解析为一个<code class="fe mz na nb nc b">datetime</code>对象。<code class="fe mz na nb nc b">strptime</code>的文档提供了所有格式字符串选项的概述。</p><p id="2662" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python还有许多第三方库，使得日期解析更加容易。<a class="ae ky" href="https://dateutil.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> dateutil </a>是一个很棒的库，它扩展了Python的<code class="fe mz na nb nc b">datetime</code>功能。它可以通过pip安装，如下所示:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="e80d" class="nh md it nc b gy ni nj l nk nl">pip install python-dateutil</span></pre><p id="9fe5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装后，让我们尝试几个例子:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="bcc9" class="nh md it nc b gy ni nj l nk nl">&gt;&gt;&gt; import dateutil.parser as parser</span><span id="79b5" class="nh md it nc b gy nm nj l nk nl">&gt;&gt;&gt; parser.parse("2020-01-01 14:00")<br/>datetime.datetime(2020, 1, 1, 14, 0)</span><span id="93a5" class="nh md it nc b gy nm nj l nk nl">&gt;&gt;&gt; parser.parse("01-01-2020 2:00pm")<br/>datetime.datetime(2020, 1, 1, 14, 0)</span><span id="1218" class="nh md it nc b gy nm nj l nk nl">&gt;&gt;&gt; parser.parse("2020-01-01T14:00")<br/>datetime.datetime(2020, 1, 1, 14, 0)</span></pre><p id="ff47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不算太坏…而且很强大。但是<code class="fe mz na nb nc b">dateutil</code>在解析日期时并不总是完美的。例如，2020年2月1日可能是2月1日，也可能是1月2日。但是对于大多数格式。它做得很好。</p><p id="290e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">dateutil</code>在解析各种日期格式的非结构化文本时效果最佳。如果日期格式已知，最好使用<code class="fe mz na nb nc b">strptime</code>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="58d0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.格式化</h1><p id="3e98" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这种情况下，我们从一个<code class="fe mz na nb nc b">datetime</code>对象开始，想要构建一个格式化的字符串。Python为此提供了<code class="fe mz na nb nc b"><a class="ae ky" href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior" rel="noopener ugc nofollow" target="_blank">strftime</a></code>方法。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="5bfa" class="nh md it nc b gy ni nj l nk nl">&gt;&gt;&gt; from datetime import datetime<br/>&gt;&gt;&gt; date = datetime.strptime("2020-01-01 14:00", "%Y-%m-%d %H:%M")<br/>&gt;&gt;&gt; datetime.strftime(date, "%a %B %d, %Y %I:%M %p")<br/>'Wed January 01, 2020 02:00 PM'</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6bfe" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.当前</h1><p id="24fc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了生成当前时间，<code class="fe mz na nb nc b">datetime</code>内置了<code class="fe mz na nb nc b"><a class="ae ky" href="https://docs.python.org/3/library/datetime.html#datetime.datetime.now" rel="noopener ugc nofollow" target="_blank">now</a></code>方法。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="681d" class="nh md it nc b gy ni nj l nk nl">&gt;&gt;&gt; from datetime import datetime<br/>&gt;&gt;&gt; datetime.now()<br/>datetime.datetime(2020, 2, 6, 10, 50, 48, 814047)</span></pre><p id="92fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该方法为当前本地时间构建一个<code class="fe mz na nb nc b">datetime</code>对象。另一个常见的用例是将当前时间生成为自1970年1月1日以来的毫秒数(Unix纪元)。大多数其他语言对此都有一个简单的内置方法，但是Python没有这么简单。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="ec5e" class="nh md it nc b gy ni nj l nk nl">&gt;&gt;&gt; import time<br/>&gt;&gt;&gt; int(time.time() * 1000)<br/>1581004507234</span></pre><p id="22f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据服务器的时区，如果当前时间不是UTC时间，则可能需要获取UTC时间。要始终生成UTC <code class="fe mz na nb nc b">datetime</code>而不管当地时区，请运行以下命令:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="4d80" class="nh md it nc b gy ni nj l nk nl">&gt;&gt;&gt; from datetime import datetime<br/>&gt;&gt;&gt; datetime.utcnow()<br/>datetime.datetime(2020, 2, 6, 15, 56, 12, 86502)</span></pre><p id="1abd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，即使现在是UTC时间，也不容易知道——这很好地引导我们进入下一个主题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b1be" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.时区</h1><p id="9cd1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Python中的时区很复杂。内置功能并不那么简单。但值得庆幸的是，有第三方库来拯救我们。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="47c4" class="nh md it nc b gy ni nj l nk nl">pip install pytz</span></pre><p id="b61d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">pytz 向现有的<code class="fe mz na nb nc b">datetime</code>对象添加时区信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="a4b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的示例生成一个UTC日期，将UTC时区附加到该日期，然后将时间转换为美国/东部时间。Python <code class="fe mz na nb nc b">datetime</code>方法具有格式化时区的内置功能。基于这个例子…</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="3239" class="nh md it nc b gy ni nj l nk nl">&gt;&gt;&gt; datetime.strftime(date, "%Z")<br/>'UTC'<br/>&gt;&gt;&gt; datetime.strftime(date.astimezone(eastern), "%Z")<br/>'EST'</span></pre><p id="7b54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">…现在时区信息已经添加到<code class="fe mz na nb nc b">datetime</code>对象中，我们可以格式化时区了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7b0f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.日期数学</h1><p id="757a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当我们处理日期时，如果我们想得到一个相对于另一个日期的日期呢？例如，如果我们想建立一个从一天前到现在的搜索查询。日期计算是抵消一个日期并构建另一个日期的常用技术。</p><p id="51c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例子包括:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="662d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python有一个内置的<code class="fe mz na nb nc b"><a class="ae ky" href="https://docs.python.org/3/library/datetime.html#timedelta-objects" rel="noopener ugc nofollow" target="_blank">timedelta</a></code>类来帮助偏移日期。上面的例子分别将当前的<code class="fe mz na nb nc b">datetime</code>偏移了10分钟、10小时和10天。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="15ce" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">6.日期回文</h1><p id="e751" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你可能听说过2020年2月2日是909年来第一个真正的日期回文。换句话说，02/02/2020是同样的向后和向前。让我们用Python来验证一下。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="f986" class="nh md it nc b gy ni nj l nk nl">&gt;&gt;&gt; from datetime import datetime<br/>&gt;&gt;&gt; datetime.strftime(datetime(2020, 2, 2, 2, 2, 2), "%Y%m%d")<br/>'20200202'<br/>&gt;&gt;&gt; datetime.strftime(datetime(2020, 2, 2, 2, 2, 2), "%Y%m%d")[::-1]<br/>'20200202'</span></pre><p id="d9c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">故事核实了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="236c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="aa52" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">虽然不那么简单，Python具有Java和JavaScript等语言中的所有相同功能。</p><p id="c7e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们只需要知道去哪里找。</p></div></div>    
</body>
</html>