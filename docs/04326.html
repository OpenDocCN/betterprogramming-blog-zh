<html>
<head>
<title>Ethereum DApps: How to Listen for Events</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊DApps:如何监听事件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ethereum-dapps-how-to-listen-for-events-c4fa1a67cf81?source=collection_archive---------10-----------------------#2020-04-06">https://betterprogramming.pub/ethereum-dapps-how-to-listen-for-events-c4fa1a67cf81?source=collection_archive---------10-----------------------#2020-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4371" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">订阅智能合同事件的3个步骤</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/82e4268ceea8361da6d8784bae529311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rgzwy0ekWl2mQ2i03uOSlw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@cliffordgatewood?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Clifford摄影</a>在<a class="ae ky" href="https://unsplash.com/s/photos/blockchain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="905c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">先决条件:了解Node.js，并对区块链和以太坊智能合约有基本了解</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0dbc" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">介绍</h1><p id="b1a7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">分散式应用(DApps)的最大问题之一是用户体验。DApps可能很笨重，很难共事。在您的DApp中提供实时、最新的信息至关重要。</p><p id="e395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是订阅智能合同事件的方法，这样您的DApp就可以始终显示来自区块链的最新信息。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2093" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">1.加载网站3</h1><p id="f975" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">首先，我们需要通过在浏览器中加载web3来将MetaMask连接到我们的DApp。图1展示了我们如何做到这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1:加载web3</p></figure><p id="cc2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第4行显示了尝试将MetaMask连接到我们的DApp的命令。当调用它时，MetaMask将打开一个请求连接的提示窗口，如图2所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/1a5276cdac6f12241913044adb68329b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HwTUPvb_kgsLwHss8lqCaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2:元掩码提示</p></figure><p id="a913" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦被接受，您的DApp就连接上了。</p><p id="c5ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">额外提示:</strong>加载到区块链时使用<a class="ae ky" href="https://medium.com/better-programming/ethereum-dapps-how-to-load-the-blockchain-8756ca0fa0d1" rel="noopener">这种模式</a>可以获得更好的用户体验。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="68e0" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">2.加载智能合同</h1><p id="8c81" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">接下来，我们需要加载智能契约，它发出我们想要订阅的事件。对于这个例子，我们有一个名为<code class="fe nd ne nf ng b">MyContract</code>的智能契约，它发出一个名为<code class="fe nd ne nf ng b">MyEvent</code>的事件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3:加载智能契约</p></figure><p id="54f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图3显示了我们如何将智能合同实例加载到我们的DApp中。在第1行，我们导入编译后的智能合约JSON文件。第3行和第4行收集网络细节。然后，第5行通过用我们的网络细节调用<code class="fe nd ne nf ng b">web.eth.Contract()</code>来初始化我们的智能合同实例。我们现在可以使用<code class="fe nd ne nf ng b">myContract</code>实例与区块链上的智能合约进行交互。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8f78" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">3.订阅</h1><p id="08aa" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">使用我们在步骤2中创建的实例，我们可以订阅监听它发出的任何事件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图4:订阅“MyEvent”</p></figure><p id="6b06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，我们想要监听的事件被称为<code class="fe nd ne nf ng b">MyEvent</code>，图4向我们展示了如何监听。我们的<code class="fe nd ne nf ng b">myContract</code>实例有一个名为<code class="fe nd ne nf ng b">events</code>的访问器，我们可以从这里访问<code class="fe nd ne nf ng b">MyEvent</code>。这是一个返回承诺的异步函数，每次发出<code class="fe nd ne nf ng b">MyEvent</code>时都会调用它。</p><p id="39ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第3行定义了从承诺返回数据后会发生什么。在这里，我们只是将事件值记录到控制台，但在这里，我们会编写警报或界面更新等功能，以便向用户更新刚刚发生的事件。</p><p id="0184" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个逻辑，从<code class="fe nd ne nf ng b">MyContract</code>发出的每个<code class="fe nd ne nf ng b">MyEvent</code>都会在这里被捕获。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7006" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">进一步阅读</h1><div class="nh ni gp gr nj nk"><a href="https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248" rel="noopener follow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">区块链开发资源马上跟进</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">学习区块链、以太坊和DApp开发的资源列表</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">medium.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ks nk"/></div></div></a></div></div></div>    
</body>
</html>