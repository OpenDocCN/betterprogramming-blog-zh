<html>
<head>
<title>How To Set Up TypeORM With Postgres in NestJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在NestJS中用Postgres设置TypeORM</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-set-up-typeorm-with-postgres-in-nestjs-5575c949c05f?source=collection_archive---------2-----------------------#2019-12-18">https://betterprogramming.pub/how-to-set-up-typeorm-with-postgres-in-nestjs-5575c949c05f?source=collection_archive---------2-----------------------#2019-12-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5bd0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">查询和具有类型的对象</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fadc949ba82d4bca456148621308049e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fbL7On_znXrv11iqblmCFQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@campaign_creators?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">活动创建者</a>在<a class="ae ky" href="https://unsplash.com/s/photos/database?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9eac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NestJS是一个有用的框架。今天我们要看看如何在NestJS中用Postgres设置TypeORM。</p><p id="a970" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但在深入细节之前，我们先回答几个问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ae8b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是NestJS？</h1><p id="ce39" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">NestJS是一个用于构建高效、可伸缩的Node.js服务器端应用程序的框架。它使用渐进式JavaScript，用TypeScript构建并完全支持TypeScript。</p><p id="c998" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NestJS提供了开箱即用的应用程序架构，允许开发人员创建高度可测试、可伸缩、松散耦合且易于维护的应用程序。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cde3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">定义类型</h1><p id="01a0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">TypeORM是一个对象关系映射器(ORM)，可以在Node.js、浏览器和Cordova中运行，并且可以与TypeScript和JavaScript (ES5、ES6、ES7)一起使用。</p><p id="2c48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这背后的目标是通过JavaScript特性提供帮助，并帮助开发使用数据库的应用程序，从小型到大型。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="20fc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么要使用TypeORM？</h1><p id="6618" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们选择TypeORM是因为它绝对是Node.js可用的成熟ORM，而且它是用TypeScript编写的，在NestJS中运行得很好。</p><p id="5cfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于那些已经熟悉提到的其他技术以及ORM的功能的人，我很乐意帮助你尝试一下，看看为什么我喜欢使用ORM层。</p><p id="1448" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以让我们在NestJS中使用TypeORM来使用Postgres。假设您已经安装了NestJS和Postgres，我们需要安装所有的TypeORM依赖项:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a2bd" class="ne md it na b gy nf ng l nh ni">npm i — save @nestjs/typeorm typeorm pg</span></pre><p id="88ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦安装过程完成，首先，我们至少需要一个实体。</p><p id="f8f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">TypeORM包支持存储库设计模式，因此每个实体都有自己的存储库。可以从数据库连接中获得存储库。</p><p id="4a12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在在博客目录中创建一个博客实体:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/38aa3f186477a5b1037042ad5e4e80b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RoX5ZIKdwzEMWnqe"/></div></div></figure><p id="b4a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要<strong class="lb iu"> </strong>基于TypeORM包创建一个数据库模块。我们可以使用Nest CLI创建一个数据库模块。</p><p id="1a7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1e4e" class="ne md it na b gy nf ng l nh ni"><strong class="na iu">nest g mo database</strong></span></pre><p id="f11f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="14fc" class="ne md it na b gy nf ng l nh ni"><strong class="na iu">nest generate module database</strong></span></pre><p id="cebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，你会看到这样的东西。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/71391eace7600c73743bda3e735e8078.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/0*7t0HVZ2vDtYmIREi"/></div></figure><p id="9c30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nl nm nn na b">database.module.ts</code>中，导入<code class="fe nl nm nn na b">TypeOrmModule</code>并提供以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/4a9e8c202fe58d06212eb323d27bb7c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J2cO3XRgz5P4TCaR"/></div></div></figure><p id="f7cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nl nm nn na b">forRoot()</code>方法从<code class="fe nl nm nn na b">TypeORM</code>包中接受与<code class="fe nl nm nn na b">createConnection()</code>相同的配置对象。</p><p id="8f93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nl nm nn na b">Blog</code>实体属于<code class="fe nl nm nn na b">blog</code>目录。这个目录代表<code class="fe nl nm nn na b">BlogModule</code>。您可以决定将模型文件保存在哪里。</p><p id="e2f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看<code class="fe nl nm nn na b">BlogModule</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/45a98b8e0db61ec4899fcde97b1732fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BQbYcZhY_OlBZuX-"/></div></div></figure><p id="b5b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该模块使用<code class="fe nl nm nn na b">forFeature()</code>方法来定义哪些存储库应该在当前范围内注册。</p><p id="e48e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以使用<code class="fe nl nm nn na b">@InjectRepository()</code>装饰器将<code class="fe nl nm nn na b">BlogRepository</code>注入到<code class="fe nl nm nn na b">BlogService</code>中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/22fb34410df39848c6f201fb8d07978e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-sSzO7t1Uld-UnvY"/></div></div></figure><p id="31b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记将<code class="fe nl nm nn na b">BlogModule</code>和<code class="fe nl nm nn na b">DatabaseModule</code>导入到根<code class="fe nl nm nn na b">AppModule</code>中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/28e88de86babd6b1e6b9bbc016496ae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rZvB3U5ZyEUW60NY"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f4d3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="c394" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我们学习了如何在NestJS应用程序中使用Postgres设置TypeORM。</p><p id="bcaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读，希望这对您有所帮助。</p><p id="eeb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多细节可从官方的<a class="ae ky" href="https://docs.nestjs.com/" rel="noopener ugc nofollow" target="_blank"> NestJS文档网站</a>获得。</p><div class="ns nt gp gr nu nv"><a href="https://dltlabs.medium.com/unit-testing-jest-with-nestjs-b5b043ac5598" rel="noopener follow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">单元测试:与NestJS开玩笑</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">NestJS是一个强大的后端框架，受Angular的启发，在TypeScript上工作。NestJS自带丰富的…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">medium.com数字实验室</p></div></div><div class="oe l"><div class="of l og oh oi oe oj ks nv"/></div></div></a></div></div></div>    
</body>
</html>