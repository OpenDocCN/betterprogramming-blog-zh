<html>
<head>
<title>Exploring SonarQube With Create React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Create React应用程序探索SonarQube</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exploring-sonarqube-with-create-react-app-e0b7e0e5658c?source=collection_archive---------0-----------------------#2022-09-14">https://betterprogramming.pub/exploring-sonarqube-with-create-react-app-e0b7e0e5658c?source=collection_archive---------0-----------------------#2022-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9f2f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何在React项目中使用SonarQube的入门指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fb1691cb0c134f2fcbbfbcf12a605f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wT0wLThyfB9nnZJb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ravipalwe?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ravi Palwe </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="9440" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">SonarQube是什么？</h1><p id="682a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Static_program_analysis" rel="noopener ugc nofollow" target="_blank">静态代码分析</a>是在不执行应用程序的情况下对其进行的分析，而动态分析是在应用程序执行期间对其进行的。</p><p id="07a0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="https://docs.sonarqube.org/" rel="noopener ugc nofollow" target="_blank">sonar cube</a>是由<a class="ae ky" href="https://www.sonarsource.com/" rel="noopener ugc nofollow" target="_blank"> SonarSource </a>开发的开源平台。它通过对代码进行静态分析来执行自动审查，从而持续检查代码质量。它检测错误、代码气味、安全热点和漏洞。</p><ul class=""><li id="be64" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">Bug:表示代码中有错误的问题。这需要在昨天解决。</li><li id="78c3" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">代码味道:代码中与可维护性相关的问题。这使得进一步的更改更加困难，并且可能会在将来的更改中引入额外的错误。</li><li id="828e" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">安全热点:需要手动审查的安全敏感的代码片段。</li><li id="9d0c" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">漏洞:一个与安全相关的问题，是攻击者的后门。</li></ul><p id="bee3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">其中，bug、代码气味和漏洞被定义为问题。每个问题都有五种严重程度:<code class="fe ng nh ni nj b">BLOCKER</code>、<code class="fe ng nh ni nj b">CRITICAL</code>、<code class="fe ng nh ni nj b">MAJOR</code>、<code class="fe ng nh ni nj b">MINOR</code>或<code class="fe ng nh ni nj b">INFO</code>。</p><p id="fb7e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">SonarQube版可以分析29种不同的语言，包括Java、C#、C、C++、JavaScript、TypeScript、Python、Go、Swift、COBOL、Apex、PHP、Kotlin、Ruby、Scala、HTML、CSS、ABAP、Flex、Obj-C、Objective-C、PL/I、PL/SQL、RPG、Swift、T-SQL、VB.NET、VB6和XML。</p><p id="17b1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">SonarQube通过SonarLint插件与Eclipse、Visual Studio、Visual Studio代码和IntelliJ IDEA开发环境集成。它还集成了外部工具，如LDAP、Active Directory和GitHub。</p><h1 id="8960" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">为什么是SonarQube？</h1><p id="3926" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">SonarQube有600万开发者。它有助于快速、系统地构建高质量的代码。</p><ul class=""><li id="5402" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">它有助于编写干净的代码，并将维护时间和成本保持在最低水平。</li><li id="f86d" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">干净的代码使工作环境令人愉快和满意。</li><li id="06ce" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">干净的代码使开发人员能够专注于解决业务问题。</li><li id="5610" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">它通过在正确的时间和地点进行正确的检查来确保软件的健壮性和安全性。它将风险最小化，并将产品的声誉最大化。</li></ul><h1 id="3827" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">React中的必备测试工具</h1><p id="6cd3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">SonarQube建立在React中现有的测试工具之上，比如Jest和伊斯坦布尔/纽约。</p><p id="ace6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/testing-your-components-in-react-967abda02396"> Jest </a>是一个确保代码库正确性的JavaScript/TypeScript测试框架。Jest已经内置到<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/an-in-depth-guide-for-create-react-app-5-cra-5-b94b03c233f2"> Create React App </a>中。</p><p id="eebc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">伊斯坦布尔是JavaScript/TypeScript代码覆盖工具，在运行测试时计算语句、行、函数和分支覆盖。伊斯坦布尔已被弃用。现在的版本叫做<a class="ae ky" href="https://github.com/istanbuljs/nyc" rel="noopener ugc nofollow" target="_blank"> nyc </a>，代表纽约市。这个名字是一个笑话，来自歌曲《他们也许是伟人》的歌词:</p><ul class=""><li id="30d6" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">伊斯坦布尔就是君士坦丁堡。现在是伊斯坦布尔，不是君士坦丁堡。</li><li id="c34a" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">甚至旧纽约也曾是新阿姆斯特丹。我不能说他们为什么改了它。</li></ul><p id="0c7b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">另外，作者,<a class="ae ky" href="https://github.com/kushalmahajan" rel="noopener ugc nofollow" target="_blank"> Kushal V. Mahajan </a>希望它简短。</p><p id="d6bd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有时，伊斯坦布尔和纽约市可以互换使用。伊斯坦布尔/纽约已被纳入Jest，并由Jest直接处理。创建React应用程序，包括Jest和伊斯坦布尔/纽约。</p><p id="4f30" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">创建基于类型脚本的Create React应用程序环境:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="c855" class="no la it nj b gy np nq l nr ns">% npx create-react-app react-sonarqube --template typescript<br/>% cd react-sonarqube</span></pre><p id="e74d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Create React App附带一个测试文件，<code class="fe ng nh ni nj b">src/App.test.tsx</code>。运行<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-achieve-100-test-coverage-for-react-functional-components-fbde1e40631c">测试覆盖命令</a>:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="e6d0" class="no la it nj b gy np nq l nr ns">% npm run test -- --coverage . --watchAll=false</span></pre><p id="3295" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该命令创建一个名为<code class="fe ng nh ni nj b">coverage</code>的文件夹，其中包含文件夹<code class="fe ng nh ni nj b">lcov-report</code>和文件<code class="fe ng nh ni nj b">lcov.info</code>。<a class="ae ky" href="https://en.wikipedia.org/wiki/Gcov" rel="noopener ugc nofollow" target="_blank"> Lcov </a> (Linux测试项目gcov)是gcov (GNU覆盖率)的图形化前端，是一个源代码覆盖率分析和逐语句剖析工具。它收集多个源文件的gcov数据，并创建包含源代码的HTML页面，这些代码用覆盖率信息进行了注释。Lcov支持语句、函数和分支覆盖度量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/ea295db27cc776ce026b58d99836685c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uxqKikijmurul3l-mppjbA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="08e6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上图中的<code class="fe ng nh ni nj b">coverage-final.json</code>是测试覆盖结果的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/exploring-json-json5-and-circular-references-2b5b0c5de532"> JSON </a>文件，转换成如下的“图形化”输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/0716d779eec16c0248199b47294af88d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*JG9rJ3eZvv9cejS90kfqdg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2641" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该报告包括大量测试信息:</p><ul class=""><li id="0dac" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><code class="fe ng nh ni nj b">App.tsx</code>100%承保。</li><li id="1a7a" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe ng nh ni nj b">index.tsx</code>被部分覆盖。</li><li id="bb20" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe ng nh ni nj b">reportWebVitals.ts</code>不是盖的。</li></ul><p id="d494" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">更具体地说，<code class="fe ng nh ni nj b">index.tsx</code>中的语句覆盖了0%,未覆盖的行是第7-19行。</p><p id="da91" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">很好。</p><p id="3c1a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">但是，我们需要打开<code class="fe ng nh ni nj b">index.tsx</code>来查看第7–19行代码。</p><p id="ec34" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这不够好。</p><p id="60ec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这就是SonarQube可以提供帮助的方式。</p><h1 id="04bd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">SonarQube怎么用？</h1><p id="c4c8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为React项目设置SonarQube需要几个步骤。</p><ol class=""><li id="cea6" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm nv my mz na bi translated">安装一个sonar cube的本地实例。</li><li id="0008" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm nv my mz na bi translated"><a class="ae ky" href="#82ac" rel="noopener ugc nofollow">在SonarQube中创建一个项目进行分析</a>。</li><li id="77e0" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm nv my mz na bi translated"><a class="ae ky" href="#887e" rel="noopener ugc nofollow">配置创建用于分析的React App项目</a>。</li></ol><h2 id="2aed" class="no la it bd lb nw nx dn lf ny nz dp lj ma oa ob ll me oc od ln mi oe of lp og bi translated">安装SonarQube的本地实例</h2><p id="4e96" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">安装SonarQube的本地实例是一次性任务。一旦设置好，实例就可以在不同的项目中重用。以下是安装过程:</p><ul class=""><li id="ae9b" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><a class="ae ky" href="https://adoptium.net/releases.html?variant=openjdk11&amp;jvmVariant=hotspot" rel="noopener ugc nofollow" target="_blank">下载</a>安装Java 11。</li></ul><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="c500" class="no la it nj b gy np nq l nr ns">% java --version<br/>openjdk 11.0.11 2021-04-20</span></pre><ul class=""><li id="10df" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><a class="ae ky" href="https://www.sonarqube.org/downloads/" rel="noopener ugc nofollow" target="_blank">下载</a>sonar cube社区版zip文件。</li></ul><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="dcc4" class="no la it nj b gy np nq l nr ns">% ls -l sonarqube-9.6.1.59531.zip<br/>-rw-r--r--@ 1 jenniferfu  staff  290033351 Sep  8 20:38 sonarqube-9.6.1.59531.zip</span></pre><ul class=""><li id="4375" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">拉开<code class="fe ng nh ni nj b">sonarqube-9.6.1.59531.zip</code>，移动到<code class="fe ng nh ni nj b">/sonarqube</code>或<code class="fe ng nh ni nj b">/opt/sonarqube</code>。</li></ul><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="af6c" class="no la it nj b gy np nq l nr ns">% sudo mv sonarqube-9.6.1.59531 /opt/sonarqube</span></pre><ul class=""><li id="523a" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">启动SonarQube服务器:</li></ul><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="cbf5" class="no la it nj b gy np nq l nr ns">% /opt/sonarqube/bin/macosx-universal-64<!-- -->/sonar.sh console</span></pre><ul class=""><li id="18d0" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">在浏览器上访问<code class="fe ng nh ni nj b">http://localhost:9000/</code>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/6bceb3dfac543ec1dc37dec0d286659c.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*JaGbYPE8QtEsAfx3jFHdfA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="550c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以<code class="fe ng nh ni nj b">admin</code>身份登录，密码为<code class="fe ng nh ni nj b">admin</code>。</p><p id="758f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当它提示输入新密码时，将其更改为新密码，如<code class="fe ng nh ni nj b">MyAdmin</code>。</p><p id="ecbd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">SonarQube的本地实例已经启动，可以使用了。</p><h2 id="82ac" class="no la it bd lb nw nx dn lf ny nz dp lj ma oa ob ll me oc od ln mi oe of lp og bi translated">在SonarQube中创建一个要分析的项目</h2><p id="4fa2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这一步是每个项目特有的。SonarQube提供了几个选项来创建项目，<code class="fe ng nh ni nj b">From Azure DevOps</code>、<code class="fe ng nh ni nj b">From Bitbucket</code>、<code class="fe ng nh ni nj b">From GitHub</code>、<code class="fe ng nh ni nj b">From GitLab</code>和<code class="fe ng nh ni nj b">Manually</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/6fb0bcb013bd79ad1b3eceae1c62cd0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L-4dwuK5wsDkZj0Hk6rBWA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="6c3d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们选择选择，<code class="fe ng nh ni nj b">Manually</code>。弹出<code class="fe ng nh ni nj b">Project display name</code>和<code class="fe ng nh ni nj b">Project key</code>窗口。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/be0d5965701e1b05a1d6b88ca617956b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*tAuQjdkZCKhmCQk12OZVCw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ff96" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">填写字段，并点击<code class="fe ng nh ni nj b">Set Up</code>按钮。以下屏幕询问如何分析储存库、<code class="fe ng nh ni nj b">With Jenkins</code>、<code class="fe ng nh ni nj b">With GitHub Actions</code>、<code class="fe ng nh ni nj b">With Bitbucket Pipelines</code>、<code class="fe ng nh ni nj b">With Azure Pipelines</code>、<code class="fe ng nh ni nj b">Other CI</code>或<code class="fe ng nh ni nj b">Locally</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/4434af7c34b5c5429de60f64c8247a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mKIFvBX5WxJNBDW9tRPEmQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="0829" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们选择选择，<code class="fe ng nh ni nj b">Locally</code>。然后，它要求一个项目令牌。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/3ef946fe87981cecd94da27bd8795820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hD5dVdpsjqcmIoMdMbQfqw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4818" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">点击<code class="fe ng nh ni nj b">Generate</code>，创建一个令牌<code class="fe ng nh ni nj b">sqp_f0a4edb0fbb43c80d52d47d739b5633d6d6da4dd</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/e113bb528405c9ac6baf2a53f9fe4694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WzeKIaQ_7xsO_fDnFp9lA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f9bf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">点击<code class="fe ng nh ni nj b">Continue</code>按钮。下一个屏幕在<code class="fe ng nh ni nj b">Maven</code>、<code class="fe ng nh ni nj b">Gradle</code>、<code class="fe ng nh ni nj b">.NET</code>和<code class="fe ng nh ni nj b">Other (for JS, TS, Go, Python, PHP, …)</code>选项中询问构建类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/2cb5cd4827725361946791f206269023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2fdtQ2yuyEyHmsc--PDZg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="154a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们选择<code class="fe ng nh ni nj b">Other</code>，它会弹出操作系统的选项。在<code class="fe ng nh ni nj b">Linux</code>、<code class="fe ng nh ni nj b">Windows</code>、<code class="fe ng nh ni nj b">macOS</code>中，我们选择<code class="fe ng nh ni nj b">macOS</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/af2f346aea39f2b4d86180cbc645344a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*en6G6u81JbJrVosXGPwMtQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="23e2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">项目已经建立，并准备进行分析。</p><p id="f602" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在上面的屏幕截图中，它显示了执行扫描仪的命令。</p><p id="a5d2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们选择不下载Java运行时，<code class="fe ng nh ni nj b">sonar-scanner</code>。相反，我们将运行等效的NPM模块来执行分析。</p><h2 id="887e" class="no la it bd lb nw nx dn lf ny nz dp lj ma oa ob ll me oc od ln mi oe of lp og bi translated">配置创建React应用程序项目以进行分析</h2><p id="95ac" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在Create React App工作环境中，我们应用了两个包:</p><ul class=""><li id="a65c" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">这是Jest的定制结果处理器。处理器将Jest的覆盖范围输出转换成声纳的通用测试数据格式。</li><li id="c931" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe ng nh ni nj b">sonarqube-scanner</code>:这是一个运行SonarQube分析的NPM模块。</li></ul><p id="aee8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">安装两个软件包:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="c3b8" class="no la it nj b gy np nq l nr ns">npm install -D jest-sonar-reporter sonarqube-scanner</span></pre><p id="94bf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">它们成为<code class="fe ng nh ni nj b">package.json</code>中<code class="fe ng nh ni nj b"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/package-jsons-dependencies-in-depth-a1f0637a3129">devDependencies</a></code>的一部分:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="1cdb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">执行以下命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><ul class=""><li id="3ce6" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">第1行执行NPM模块<code class="fe ng nh ni nj b">sonar-scanner</code>。</li><li id="f6f3" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第2行指定了项目密钥。</li><li id="fb32" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第3行指定了为这个项目生成的项目令牌。</li><li id="a23f" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第4行指定源文件的位置为当前文件夹——该设置可移至<code class="fe ng nh ni nj b">sonar-project.properties</code>。</li><li id="839b" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第5行指定SonarQube服务器运行的URL这个设置可以移到<code class="fe ng nh ni nj b">sonar-project.properties</code>。</li></ul><p id="2c51" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">分析成功运行并结束。</p><p id="74d9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">转到<code class="fe ng nh ni nj b">http://localhost:9000/dashboard?id=React-SonarQube</code>。状态显示<code class="fe ng nh ni nj b">Passed</code>，页面上有两个选项卡:</p><ul class=""><li id="1e85" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated"><code class="fe ng nh ni nj b">New Code</code>:根据上一版本、具体分析、参考分支或天数定义，增加或更新的代码。先前版本是默认设置。</li><li id="b210" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated"><code class="fe ng nh ni nj b">Overall Code</code>:都是代码，新旧都有。</li></ul><p id="21e2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ng nh ni nj b">New Code</code>中显示的数据已经整合到<code class="fe ng nh ni nj b">Overall Code</code>中。对于拉取请求，检查<code class="fe ng nh ni nj b">New Code</code>中的PR变化更有意义。</p><p id="6fd7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里，我们看一下<code class="fe ng nh ni nj b">Overall Code</code>，因为它对于写作来说更稳定。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/61a1a0942c3ad7d1baaa5bbb7f0d3cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1EVl00xJyMBvqeOihbUzNA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="7841" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">它显示20行的覆盖率为<code class="fe ng nh ni nj b">0.0%</code>。单击百分比链接，它会显示详细信息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/08bb81989063ce8ec6fd03772a679e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EqtTO_JWKMAkCxA4-BUDyQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="3d23" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这里有两个问题:</p><ol class=""><li id="601a" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm nv my mz na bi translated">Create React App附带一个测试，<code class="fe ng nh ni nj b">src/App.test.tsx</code>。为什么测试覆盖面是<code class="fe ng nh ni nj b">0.0%</code>？</li><li id="fa1d" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm nv my mz na bi translated"><code class="fe ng nh ni nj b">src/App.test.tsx</code>被列为待测试代码。</li></ol><p id="f197" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于#1，由于SonarQube是一个静态代码分析工具，它不运行测试。我们需要配置它来读取Jest的覆盖率输出。</p><p id="1cd1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于#2，我们需要排除要测试的测试文件。为了适应更常见的实践，我们将<code class="fe ng nh ni nj b">src/App.test.tsx</code>移至<code class="fe ng nh ni nj b">src/__tests__/App.test.tsx</code>。</p><p id="53b7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此外，我们在项目的根目录中创建一个配置文件<code class="fe ng nh ni nj b">sonar-project.properties</code>，以避免将所有参数传递到命令行中。根据<a class="ae ky" href="https://docs.sonarqube.org/latest/analysis/analysis-parameters/" rel="noopener ugc nofollow" target="_blank">属性定义</a>，我们对<code class="fe ng nh ni nj b">sonar-project.properties</code>配置如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><ul class=""><li id="a293" class="ms mt it lt b lu mn lx mo ma mu me mv mi mw mm mx my mz na bi translated">第1行指定了项目密钥。</li><li id="94ad" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第2行指定源文件位置为当前文件夹。</li><li id="5a00" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第3行指定SonarQube服务器运行的URL。</li><li id="7291" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第4行指定了测试文件的路径。</li><li id="49b9" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第5行指定了测试文件的命名约定。</li><li id="d25c" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第6行指定了要忽略的文件。</li><li id="73a2" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">第7行指定了在哪里阅读Jest测试报告。</li></ul><p id="9468" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">事实上，所有设置都可以在<code class="fe ng nh ni nj b">Administration &gt; Configuration</code>中进行全局设置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/36c62fdfadc29add89f999a6baf54707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ViglR-aBoBY0S0syc3n2GQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f4fb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们准备跑了。</p><p id="5b84" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">步骤1:重新生成测试覆盖报告。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="c81c" class="no la it nj b gy np nq l nr ns">% npm run test -- --coverage . --watchAll=false</span></pre><p id="283a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">第二步:执行NPM模块<code class="fe ng nh ni nj b">sonar-scanner</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="b568" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">第三步:转到<code class="fe ng nh ni nj b">http://localhost:9000/dashboard?id=React-SonarQube</code>查看结果。</p><p id="a71a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">状态为<code class="fe ng nh ni nj b">Passed</code>，转到<code class="fe ng nh ni nj b">Overall Code</code>选项卡:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/ca9c83159f0699c0ebe319ec554671be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n12X9cyaVc51UBcFGvrlCQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="b329" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">测试覆盖率为<code class="fe ng nh ni nj b">25.0%</code>，行数为16 ( <code class="fe ng nh ni nj b">src/__tests__/App.test.tsx </code>被忽略)。结果令人鼓舞。</p><p id="d8ec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">点击百分比链接，确认<code class="fe ng nh ni nj b">src/__tests__/App.test.tsx </code>未列出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/793dbec79057f3c7965b6aa9b3eef484.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ul7squI59xGh_7g34RJYwA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4c21" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们查看每个文件的更改。</p><p id="3137" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ng nh ni nj b"><strong class="lt iu">src/App.tsx</strong></code>:显示第6-10行被覆盖(绿色——我们添加了第6-9行，以显示更多可以删除的行)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/720bb64023c97533516c43ea7fd8c3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NmsfKu9ti8-UfsmC6vApcg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="4bf0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ng nh ni nj b"><strong class="lt iu">src/reportWebVitals.ts</strong></code>:显示3-10行未覆盖(红色)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/a564b43292eb8a6815d7770c138850b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oatpPWGt686-FAx64hs4pg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="c7af" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ng nh ni nj b"><strong class="lt iu">src/index.tsx</strong></code>:显示7、10号线未覆盖(红色)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/2dbf7b0705e0932ea93142871903738e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JzyXLZEfqQIhNj1AMOYTQw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="359b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">SonarQube的UI难道不比Jest的命令行覆盖报告好看吗？</p><p id="e3b5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">移除<code class="fe ng nh ni nj b">src/App.tsx</code>中的多余线路。承保范围数量减少:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/9f4f0a7e375fc9ffdbb8cb63396ce2c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ISMATPfjLKHUeOLiaeGgUw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="8848" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">它显示了Create React应用程序的开箱即用覆盖范围:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/95b9376c1e87933f2d52faee14353193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2x8WvmYUlcNaHfhPEzGOZw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h1 id="ae61" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结论</h1><p id="d4d9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">本文是关于如何在React项目中使用SonarQube的入门指南。SonarQube拥有漂亮的用户界面，比Jest的命令行覆盖报告更加人性化。SonarQube中有更多高级设置，如指标、质量门和规则。更多高级用法，请查看<a class="ae ky" href="https://docs.sonarqube.org/latest/" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p><p id="0ed8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">感谢阅读。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="d967" class="no la it nj b gy np nq l nr ns"><strong class="nj iu">Want to Connect? </strong></span><span id="ad31" class="no la it nj b gy op nq l nr ns">If you are interested, check out <a class="ae ky" href="https://jenniferfubook.medium.com/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener">my directory of web development articles</a>.</span></pre><p id="7393" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="oq">感谢Daria Mehra向我展示了SonarQube，这是一款强大的静态代码分析工具。</em></p></div></div>    
</body>
</html>