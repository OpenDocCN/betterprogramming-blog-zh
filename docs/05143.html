<html>
<head>
<title>How to Create a Star Rating Component in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular中创建星级评定组件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-star-rating-component-in-angular-ff32234ea531?source=collection_archive---------1-----------------------#2020-06-15">https://betterprogramming.pub/how-to-create-a-star-rating-component-in-angular-ff32234ea531?source=collection_archive---------1-----------------------#2020-06-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b595" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让你的用户留下评论</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7262466ff754781b92592f68026e0c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dK7G3W_dVQIWafHC"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@jcsf?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔丹·克劳福德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="d288" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将创建一个简单的Angular组件。你上过电影或书籍推荐网站吗？你可能注意到他们使用流行的星级评定。给事物打零到五星的分数是很常见的。这对任何开发人员来说都是一个很好的练习。让我们以测试驱动的方式一起回顾一下。我们会很开心的。这是一个承诺！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/a52aaa3c1bdfb4d58c6841a0f94b761e.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*589bVD2hvyykX_PN_K5CmA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的星级评定部分</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="3219" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">空荡荡的星星</h1><p id="b230" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如何开始创建这样一个组件？好吧，让我们从简单的开始。我们可以从创造五颗空恒星开始。这是问题解决的一部分，对吗？让我来描述一下你如何编写第一个测试。不要担心完整的代码示例，因为它们将包含在本文的末尾。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="8583" class="nf me it nb b gy ng nh l ni nj"><strong class="nb iu"><em class="nk">it</em></strong>('shows 5 empty stars', () =&gt; {<br/>  <strong class="nb iu"><em class="nk">expect</em></strong>(getEmptyStars().length).toEqual(5);<br/>});</span></pre><p id="6a14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建这个组件很简单。我们只是复制粘贴一个空的星星五次。眼力好的人可能会注意到我们在这里使用了数据属性作为选择器。如果你对为什么这可能有用感兴趣，你可以在<a class="ae ky" href="https://medium.com/better-programming/decouple-tests-with-data-attributes-c920606c5f27" rel="noopener">以前的文章</a>中阅读所有相关内容。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="bd81" class="nf me it nb b gy ng nh l ni nj">&lt;span class="fa fa-star-o" data-jest="empty star"&gt;&lt;/span&gt;<br/>&lt;span class="fa fa-star-o" data-jest="empty star"&gt;&lt;/span&gt;<br/>&lt;span class="fa fa-star-o" data-jest="empty star"&gt;&lt;/span&gt;<br/>&lt;span class="fa fa-star-o" data-jest="empty star"&gt;&lt;/span&gt;<br/>&lt;span class="fa fa-star-o" data-jest="empty star"&gt;&lt;/span&gt;</span></pre><p id="f46b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，我们可以做得更好。如果评分高于零，我们不想显示五颗空星。当评分为1时，我们希望看到四颗空星！当评分为二时，我们希望看到三颗空星。当评分为五时，我们根本看不到任何星星！最后一点是我们很容易测试的。让我们验证一下，当评级为5时，我们的组件没有显示星号。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="54d9" class="nf me it nb b gy ng nh l ni nj"><strong class="nb iu"><em class="nk">it</em></strong>('shows 0 empty stars', () =&gt; {<br/>  component.rating = 5;<br/>  fixture.detectChanges();</span><span id="178a" class="nf me it nb b gy nl nh l ni nj"><strong class="nb iu"><em class="nk">  expect</em></strong>(getEmptyStars().length).toEqual(0);<br/>});</span></pre><p id="5f38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们使用的是<code class="fe nm nn no nb b">rating</code>输入字段，我们需要自己触发变更检测。否则，当我们检查组件内部的评级时，评级仍然是未定义的。这是你在角度测试中自动学到的东西。让我们继续在绿色国家工作。为了完整，必须提到它。您可以在本文中阅读更多关于变更检测<a class="ae ky" href="https://dzone.com/articles/how-to-use-change-detection-in-angular" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="24db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就个人而言，添加这个简单的检查是正确的。它不是面向未来的，但它让测试变得更加环保。现在我们已经有了明确的界限，让我们添加一个更一般的测试。</p><p id="2987" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的测试将迫使我们修改我们的代码，以适用于这三种情况以及中间的所有其他情况。原理很简单:我们总是显示五颗减去我们的评级的空星。所以如果我们有三颗星，我们会看到两颗空的星:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="f953" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有必要为介于两者之间的所有情况创建测试。让我们一起努力吧。我们需要的是一种for循环，向我们展示所有的空星。因此，空星的数量是用下面的代码片段计算的:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="87bb" class="nf me it nb b gy ng nh l ni nj">private get numberOfEmptyStars(): number {<br/>  return this.MAX_NUMBER_OF_STARS - this.rating;<br/>}</span></pre><p id="7e18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在模板中创建一个for循环，我们需要一些可以迭代的对象。为此，我们实例化一个长度与空星数量相同的数组:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="5c99" class="nf me it nb b gy ng nh l ni nj">get emptyStars(): any[] {<br/>  return <strong class="nb iu"><em class="nk">Array</em></strong>(this.numberOfEmptyStars);<br/>}</span></pre><p id="e197" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有东西要迭代。让我们用这个数组来迭代空的星星。从逻辑上讲，这是您所期望的那种实现。顺便说一下，你甚至不需要<code class="fe nm nn no nb b">ng-container</code>。您也可以将<code class="fe nm nn no nb b">ngFor</code>放在<code class="fe nm nn no nb b">span</code>本身上。但是，大家一致认为这是很有可读性的，对吧？</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="16e9" class="nf me it nb b gy ng nh l ni nj">&lt;ng-container *ngFor="let <strong class="nb iu"><em class="nk">emptyStar</em></strong> of emptyStars"&gt;<br/>  &lt;span class="fa fa-star-o" data-jest="empty star"&gt;&lt;/span&gt;<br/>&lt;/ng-container&gt;</span></pre><p id="ab68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们工作的第一部分已经完成。我们对空恒星的实现已经完成。让我们进入下一步！</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="407c" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">全明星</h1><p id="11fe" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">让我分享一些好消息:你也可以为全明星重复大部分工作。现在更容易了。所以我们继续吧。首先，我们将从五星评级开始:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="5f86" class="nf me it nb b gy ng nh l ni nj"><strong class="nb iu"><em class="nk">it</em></strong>('shows five full stars when the rating is five', () =&gt; {<br/>  component.rating = 5;<br/>  fixture.detectChanges();</span><span id="31e2" class="nf me it nb b gy nl nh l ni nj"><strong class="nb iu"><em class="nk">  expect</em></strong>(getFullStars().length).toEqual(5);<br/>});</span></pre><p id="2244" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们重复同样的过程。现在应该更快了。我们添加了五星的实现。根据经验，您意识到您可以只添加五颗完整的星:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="00f6" class="nf me it nb b gy ng nh l ni nj">&lt;span class="fa fa-star checked" data-jest="full star"&gt;<br/>&lt;span class="fa fa-star checked" data-jest="full star"&gt;<br/>&lt;span class="fa fa-star checked" data-jest="full star"&gt;<br/>&lt;span class="fa fa-star checked" data-jest="full star"&gt;<br/>&lt;span class="fa fa-star checked" data-jest="full star"&gt;</span></pre><p id="0a59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧，你现在可以正确显示五星评级了。很快，你应该意识到你的另一个边界案例被打破了。我们需要为我们的场景添加一个零星级的测试！就这么办吧。这是一个简单的测试:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="5b5c" class="nf me it nb b gy ng nh l ni nj"><strong class="nb iu"><em class="nk">it</em></strong>('shows zero full stars when the rating is zero', () =&gt; {<br/>  component.rating = 0;<br/>  fixture.detectChanges();</span><span id="a33c" class="nf me it nb b gy nl nh l ni nj">  <strong class="nb iu"><em class="nk">expect</em></strong>(getFullStars().length).toEqual(0);<br/>});</span></pre><p id="1d12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在实现空星的时候，我们已经发现我们可以为此写一个简单的<code class="fe nm nn no nb b">if</code>语句。让我们再来一次。让我们保持绿色测试，好吗？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="8883" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经为全明星做好了准备。我们的全面实施对于五星评级和零星评级都是正确的。但是介于两者之间的价值观呢？让我们马上解决这个问题。我们将为此添加一个更通用的测试:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="6e03" class="nf me it nb b gy ng nh l ni nj"><strong class="nb iu"><em class="nk">it</em></strong>('shows "rating" full stars', () =&gt; {<br/>  component.rating = rating;<br/>  fixture.detectChanges();</span><span id="1d36" class="nf me it nb b gy nl nh l ni nj">  <strong class="nb iu"><em class="nk">expect</em></strong>(getFullStars().length).toEqual(3);<br/>});</span></pre><p id="d431" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你添加了这个测试，你就会意识到，“哦，它对任何评级都有效。”对于零、等于评级的数量或五星，测试是相同的。因此，如果您的评级是三，应该会显示三颗完整的星。让我们来实现它:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="5adb" class="nf me it nb b gy ng nh l ni nj">&lt;span *ngFor="let <strong class="nb iu"><em class="nk">fullStar</em></strong> of fullStars" class="fa fa-star checked" data-jest="full star"&gt;&lt;/span&gt;</span></pre><p id="f220" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。我们也完成了全星的实现。现在我们有了一个功能齐全的组件。它会显示0到5颗星之间的任何评分。在这个阶段，您当然可以进行一些重构。</p><p id="4e7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过，你不应该觉得有必要扔掉测试。在这个阶段，空星和满星的两种边界情况都包括在内，在这两种情况之间有一个基本的测试。这很好，而且它们为未来的发展提供了一个很好的安全网。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e1c7" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="826e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在Angular中创建星形组件是一件容易的事情。不过，有一件事确实困扰着我。你看到我们必须创建一个数组来多次做同样的事情了吗？这感觉不对，但我找不到一个简单的本土方法来做到这一点。</p><p id="70a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的要点中，实施还包括有一半剩余评分的可能性(例如3.5或4.5星)。请随意检查或将其作为练习来实施。通过在下面留下建设性的批评，你可以帮助我在未来提供更好的内容。感谢您从头到尾的阅读。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">书籍.评级.组件.规格(测试)</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">book.rating.component.ts(实现)</p></figure></div></div>    
</body>
</html>