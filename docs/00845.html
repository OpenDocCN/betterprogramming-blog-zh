<html>
<head>
<title>Designing API Methods in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript设计API方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/designing-api-methods-in-javascript-1d821bd29c7d?source=collection_archive---------2-----------------------#2019-07-21">https://betterprogramming.pub/designing-api-methods-in-javascript-1d821bd29c7d?source=collection_archive---------2-----------------------#2019-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ef7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索命名参数、方法链接和函数多态性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/85ee10e160cadba7d21152d6daa05984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWvKCx_dxSCg4QYwwmINbw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自Unsplash的照片</p></figure><p id="4cb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用JavaScript设计API方法是一项非常有用的技能，可以让你从不同的角度看待编程。这种视角不是为用户构建项目，而是为开发人员构建项目。如果您以前没有构建过库或SDK，这篇文章可以帮助您了解从哪里以及如何开始，从方法设计开始。</p><p id="7413" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JavaScript是一种松散类型的语言，开发人员可以利用它来创建健壮的多用途API。</p><p id="3d37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章将介绍用JavaScript设计API时编写方法的几种方式。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="214e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.命名参数</h1><p id="48a9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们要讲的第一个方法是<em class="mz">命名参数</em>。回到过去，在引入ES6之前，声明函数的唯一方式是使用<code class="fe na nb nc nd b">function</code>语法的<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function" rel="noopener ugc nofollow" target="_blank">函数声明</a>。</p><p id="b080" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了确定执行流的去向，您需要一个函数arity(函数期望的参数数量)，将它转换为一个数组，并根据参数的样子应用其余的逻辑。</p><p id="a847" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，<code class="fe na nb nc nd b">animal</code>、<code class="fe na nb nc nd b">options</code>和<code class="fe na nb nc nd b">callback</code>是函数的参数，arity是三。该功能旨在创建一个新账户。如果来电者没有提供，每个帐户都会有一些默认设置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="3506" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做的问题是，调用者必须知道要作为参数传递给函数的参数的确切顺序，即使一个或多个参数不是必需的。按顺序记住需求可能很难，如果不小心的话，很容易弄乱顺序。此外，如果没有必要让函数正常工作，那么让一个参数成为必需参数就没有多大意义。</p><p id="5d92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在将来也很难维护，因为当你或你的老板需要去掉<code class="fe na nb nc nd b">username</code>并把<code class="fe na nb nc nd b">email</code>换成新的用户名时，你必须改变逻辑。</p><p id="a776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更好的做法是简单地使用一个对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="da17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们受益于可读性以及对可维护性的更多控制，因为您只需要从代码中删除用户名:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="41cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打电话也变得更加简洁易读:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f4ab" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.方法链接/流畅API</h1><p id="9dcd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我最喜欢的编写API的方式是通过方法链接使用<a class="ae ky" href="https://martinfowler.com/bliki/FluentInterface.html" rel="noopener ugc nofollow" target="_blank"> fluent API </a>。</p><p id="2b3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">方法链接就是一个接一个地链接多个调用的过程。总的想法是实现一个可读和流畅的代码，从而使它更快地理解。这些方法通常是动词(如rotate)。</p><p id="abd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d702" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这翻译成:<code class="fe na nb nc nd b">Retrieve</code>图像<code class="fe na nb nc nd b"><em class="mz">nemo</em>the <em class="mz">fish.jpg</em></code>和<code class="fe na nb nc nd b">apply</code>值为<code class="fe na nb nc nd b">100%</code>的<code class="fe na nb nc nd b">grayscale</code> <code class="fe na nb nc nd b">filter</code>。<code class="fe na nb nc nd b">Rotate</code>将图像放大<code class="fe na nb nc nd b">100</code>度，并将<code class="fe na nb nc nd b">scale</code>放大<code class="fe na nb nc nd b">1.5</code>倍。</p><p id="5149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种做法的一个好处是可以很快开始编写自己的流畅API接口。您只需在方法调用中返回对上下文的引用，这样就可以将它链接起来:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="8111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">流畅API的一个最好的例子是jQuery。由于该库的流畅性，它可以说是最容易学习和使用的JavaScript库之一:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，链接fluent API的方法有一些缺点。</p><p id="68b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最大的缺点是很难在链的中间设置断点，这使得错误很难调试。此外，它鼓励过多的程序代码。不过，有一些方法可以解决调试问题，方法是在链中的任何一步插入记录器，并使用它们来调用后续的方法。</p><p id="9a29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一个缺点是，您可能会陷入用紧凑的点标记法写长句的行为中。这可能会妨碍事情的简单化。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ac55" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.功能多态性</h1><p id="c080" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你可能在其他语言中听说过术语<em class="mz">多态性</em>，通常情况下，事情会根据上下文表现不同。</p><p id="eabd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样的概念也适用于JavaScript中的函数多态性。这些函数根据传入的参数运行(这是我们的<em class="mz">上下文</em>)。</p><p id="0d3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API通常将参数收集到数组或类似数组的结构中，以便对它们进行更多的控制。将它们放在一个数组结构中允许它们做一些事情，比如传递给同一作用域中的其他函数，反之亦然。</p><p id="43c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在引入arrow函数之前，在多态函数中收集参数的常见做法是使用类似数组的<code class="fe na nb nc nd b">arguments</code>对象。有时，在将参数分配给数组后，您可能需要对它们做更多的处理。尽管<code class="fe na nb nc nd b">arguments</code>是一个类似数组的对象，但它的功能并不像一个真正的数组。它缺少基本的数组函数，这是非常有限的。</p><p id="e05a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开发人员解决这个问题的方法是使用<code class="fe na nb nc nd b">Array.prototype.slice.call()</code>制作一个单独的浅层副本。这叫<code class="fe na nb nc nd b">method delegation</code>。换句话说，你<em class="mz">将<code class="fe na nb nc nd b">slice()</code>调用</em>委托给<code class="fe na nb nc nd b">Array.prototype</code>对象。</p><p id="0f89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="c1b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将复制从<code class="fe na nb nc nd b">index 0</code>开始的项目，并返回所有内容。</p><p id="f418" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">Arguments</code>没有真正的方法，像<code class="fe na nb nc nd b">.push</code>或<code class="fe na nb nc nd b">.shift</code>，所以我们用<code class="fe na nb nc nd b">Array.prototype.slice</code>把它转换成一个数组。这使我们能够访问所有的数组方法。</p><p id="b083" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在ES6中，我们可以通过使用spread操作符轻松地将其转换为数组，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="ce05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您的参数位于数组或类似数组的结构中时，您可以根据参数的外观来确定执行逻辑的位置。这使得它非常灵活地用于多种目的，而无需编写太多代码。</p><p id="d305" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不扩散:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="80d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">展开时:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="8b47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到这一点，我们现在可以从这些参数中确定如何处理执行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d2f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个简单的函数允许开发者以多种方式使用它:</p><ol class=""><li id="5eed" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">通过提供一个字符串和值作为第一个和第二个参数来应用单个筛选器。</li><li id="1225" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">通过提供一个键/值对对象作为第一个参数来应用多个过滤器。</li><li id="ca61" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">通过提供一个筛选器键/值的对象作为第一个参数来应用单个筛选器。</li><li id="e78c" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">作为第二个或第三个参数通过回调接收新过滤的图像(位置取决于它们为过滤器传递的内容。)</li></ol><p id="c121" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是强大的力量！</p></div></div>    
</body>
</html>