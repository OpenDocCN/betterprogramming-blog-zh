<html>
<head>
<title>Build Custom Composables With Jetpack Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jetpack Compose构建自定义组件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/custom-composable-with-jetpack-compose-912d8c53b810?source=collection_archive---------7-----------------------#2022-07-05">https://betterprogramming.pub/custom-composable-with-jetpack-compose-912d8c53b810?source=collection_archive---------7-----------------------#2022-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="65b8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建自定义视图</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4fe3beb1ccc7af61483656701c6e554c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R9-Hf7dfxICtJtL4"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@andriklangfield?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">和</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="ef95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Jetpack Compose已经为我们提供了一个巨大的组件库来创建我们的UI。但是为了给用户创造一个更加愉快和定制的体验，我们有时需要创建我们自己的体验。</p><p id="4dda" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的第一篇文章系列中，我想谈谈如何在Jetpack Compose中创建定制视图。</p><p id="82f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在一个带标签的范围滑块的例子中，我们经历了创建一个完全自定义的可组合组件所需的步骤。</p><p id="b236" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我之所以选择这个例子，是因为当前版本的范围滑块只提供了一个浮动范围，并且没有简单的方法来显示步长对齐标签，根据所选的范围来改变它的外观。</p><p id="5971" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这一系列的结果将如下所示</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/93029acce4adfcb8b61042c550c80ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*XYR4BX02KdQqfk0lIY4Esw.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">运动中带标签的范围滑块</p></figure><p id="de71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将会看到三个不同的主题被用来创建可组合的，最后我们把它们放在一起。</p><ul class=""><li id="f3f9" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">如何在画布上画画(这一部分)</li><li id="11ff" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated"><a class="ae kv" href="https://medium.com/@alex.frank84/touch-interactions-in-jetpack-compose-caf88adcae61" rel="noopener">处理触摸交互</a></li><li id="3f07" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated"><a class="ae kv" href="https://medium.com/@alex.frank84/context-receivers-9265b29a6ff1" rel="noopener">科特林语境接收者</a>(因为它新颖有趣:-D)</li><li id="4ea5" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated"><a class="ae kv" href="https://medium.com/@alex.frank84/draw-the-labeled-range-slider-3eb96e748e88" rel="noopener">绘制带标签的范围滑块</a></li><li id="8171" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated"><a class="ae kv" href="https://medium.com/@alex.frank84/make-the-labeled-range-slider-interactive-516bdf6e5c25" rel="noopener">与带标签的范围滑块</a>互动</li></ul><p id="9e83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着我们的进展，所有的代码和项目都将发布在GitHub上。</p><h1 id="3692" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">如何在画布上画画</h1><p id="2fef" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">让我们先来看看如何在一个Composable内的画布上绘制东西。</p><p id="647e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为简单的第一步，我们画一个基本的形状，像一个圆形。为此，我们</p><ul class=""><li id="9592" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">创建我们的可组合</li><li id="8b4a" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">给它一个最小尺寸</li><li id="396e" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">添加画布</li><li id="327b" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">画圆</li></ul><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="d26a" class="nj mi iq nf b gy nk nl l nm nn">@Composable<br/>fun DrawSimpleCircle(<br/>   color: Color,<br/>   modifier: Modifier = Modifier,<br/>   minSize: DpSize = <em class="no">DpSize</em>(32.<em class="no">dp</em>, 32.<em class="no">dp</em>)<br/>) {<br/>   <em class="no">Canvas</em>(modifier = modifier.<em class="no">size</em>(minSize)) {<br/>      drawCircle(color)<br/>   }<strong class="nf ir"><br/></strong>}</span></pre><p id="2c45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个组合的结果将是一个给定颜色的圆，填充整个组合的大小。例如:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/0fbcc89ea0c82ee43c4b406a2f8b600c.png" data-original-src="https://miro.medium.com/v2/resize:fit:142/format:webp/1*iRzcYlXD89MEh6Yyc0U8HA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">一个简单的绿色圆圈</p></figure><p id="024d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，这个API允许我们不仅用单一颜色绘制形状，还提供了更灵活的<code class="fe nq nr ns nf b">Brush</code>变体。有了<code class="fe nq nr ns nf b">Brush</code>，我们也能实现渐变。该示例显示了两种颜色的渐变，但是如果需要的话，API允许可变的颜色列表。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="d8ad" class="nj mi iq nf b gy nk nl l nm nn"><em class="no">...</em><strong class="nf ir"><br/></strong>drawCircle(<br/>   brush = Brush.radialGradient(<br/>      colors = <em class="no">listOf</em>(<br/>         centerColor, outerColor<br/>      )<br/>   )<br/>)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/f18a7198c61bb3f58149766caaff8b84.png" data-original-src="https://miro.medium.com/v2/resize:fit:108/format:webp/1*PB_ZAOQMuSflOS9UFFe-nA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">具有径向渐变的圆</p></figure><p id="40c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构图中的画布当然不仅可以画圆。它提供了多种不同的绘图方法<em class="no">。</em></p><p id="d786" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有一些提供方法的例子和它可能的样子。</p><p id="fa44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">drawRect</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/211a9c8dca6d611bb539557313a053c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/1*w2VmJxEYJgys2tlw6JkMvg.png"/></div></figure><p id="2595" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">drawRoundRect</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/4cfecfa464c7cbb16ba093ced2520497.png" data-original-src="https://miro.medium.com/v2/resize:fit:220/format:webp/1*l_SIeHhvGuC0CMknm8DDgA.png"/></div></figure><p id="f669" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">drawLine</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/5ee5cea1b999022ad4279ffdb1255ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:218/format:webp/1*eiEuQSXMxBKjLHCyscLJLg.png"/></div></figure><p id="82cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">drawOval</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/92527f3e0fad7c27017954eacd327858.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/1*ZOsbDfnr_hneoLktO4NU5Q.png"/></div></figure><p id="ace2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">drawArc</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/60d56101bf0e5fbd22bc28ee6f53458e.png" data-original-src="https://miro.medium.com/v2/resize:fit:236/format:webp/1*ojmfJmDLr7QcJeVx1mOoow.png"/></div></figure><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="6aac" class="nj mi iq nf b gy nk nl l nm nn">...<br/>drawArc(<br/>   color = color,<br/>   startAngle = 180f,  // 0f is at 3 o'clock of the circle<br/>   sweepAngle = 180f,  // go 180° from startAngle<br/>   useCenter = false,  // whether to fill the arc or not<br/>   style = Stroke(width = 2.<em class="no">dp</em>.<em class="no">toPx</em>())<br/>)</span></pre><p id="1925" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">drawPath</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/dee23df17f3994fd211097887ba408ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:224/format:webp/1*ZxuQIzF3D1ewiVs5hhUB9Q.png"/></div></figure><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="c98b" class="nj mi iq nf b gy nk nl l nm nn">...<br/>val path = <em class="no">Path</em>().<em class="no">apply </em>{<br/>   lineTo(size.width, 0f)   // line from start to end<br/>   quadraticBezierTo(       // arc from the top to  bottom<br/>      size.width / 2, size.height / 2,<br/>      size.width, size.height<br/>   )<br/>   lineTo(0f, size.height)  // line from end to start<br/>   quadraticBezierTo(       // arc from bottom to top <br/>      size.width / 2, size.height / 2,<br/>      0f, 0f<br/>   )<br/>   close()                   // link end to start<br/>}<strong class="nf ir"><br/><br/></strong>drawPath(<br/>   color = color,<br/>   path = path,<br/>   style = Stroke(width = 2.<em class="no">dp</em>.<em class="no">toPx</em>())<br/>)</span></pre><p id="11d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">drawPoints</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/d9b7f5a3e173b0085cba63d031e3645d.png" data-original-src="https://miro.medium.com/v2/resize:fit:224/format:webp/1*LLaOP7sToXRGwEb1cKMG4Q.png"/></div></figure><p id="9077" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">drawOutline</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/d9ac3970dbe099fc9b0c39e5ee61cf47.png" data-original-src="https://miro.medium.com/v2/resize:fit:224/format:webp/1*fn7zJbk8Fs2xw7cPQa_nAQ.png"/></div></figure><p id="9ba2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nq nr ns nf b">drawImage</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/974ae9b0c11daa0496aac8ea817f9a3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:178/format:webp/1*LiEvPV9EYFa9Gckv4b9WpA.png"/></div></figure><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="d022" class="nj mi iq nf b gy nk nl l nm nn">...<br/>drawImage(<br/>   image = image,<br/>   dstSize = <em class="no">IntSize</em>(size.width.toInt(), size.width.toInt()),<br/>   colorFilter = ColorFilter.lighting(Color.Yellow, Color.Red)<br/>)</span></pre><h1 id="ae6f" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">天然画布</h1><p id="f67e" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">Canvas Composable中没有直接提供的一个有用的绘图功能是绘制文本的能力。但是我们仍然可以通过使用<code class="fe nq nr ns nf b">drawIntoCanvas</code> <em class="no"> </em>方法来实现这一点。它让我们可以访问本地Canvas，它提供了一个<code class="fe nq nr ns nf b">drawText</code>方法。</p><p id="80fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">重要的是要注意:当使用原生的<code class="fe nq nr ns nf b">Canvas</code>时，你必须求助于<code class="fe nq nr ns nf b">android.graphics</code> <em class="no"> </em>包，使用它的<code class="fe nq nr ns nf b">Paint</code>或<code class="fe nq nr ns nf b">Color</code>类来代替组合变量。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="29a2" class="nj mi iq nf b gy nk nl l nm nn"><em class="no">Canvas</em>(modifier = modifier.<em class="no">size</em>(minSize)) {<br/>   val paint = android.graphics.Paint()<br/>   paint.<em class="no">textSize </em>= textSize.<em class="no">toPx</em>()<br/>   paint.<em class="no">color </em>= android.graphics.Color.<em class="no">BLACK<br/>   drawIntoCanvas </em>{<br/>      it.<em class="no">nativeCanvas</em>.drawText(text, 0f, 0f, paint)<br/>   }<br/>}</span></pre><h1 id="ab1d" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">结论</h1><p id="2c39" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">有了画布和本机画布，我们就能够为我们的带标签的范围滑块绘制所需的一切。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/75ff3f5a0c9d09a4f5ea93654b893725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t8k4wC9_r4kNedaR8bTo6g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们最终的结果会是什么样子</p></figure><p id="5c89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下一部分中，我们将看看如何通过对触摸事件做出反应来使我们的自定义可组合交互。<a class="ae kv" href="https://medium.com/@alex.frank84/touch-interactions-in-jetpack-compose-caf88adcae61" rel="noopener">直接进入第2部分</a>。</p><p id="dda5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章中创建图片的代码可以在<a class="ae kv" href="https://github.com/a-frank/draw-canvas-composable" rel="noopener ugc nofollow" target="_blank"> GitHub </a> <strong class="ky ir">上找到。</strong></p></div></div>    
</body>
</html>