<html>
<head>
<title>Implementing Smart Contracts Using Vyper — A Python Approach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vyper实现智能合约——Python方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implementing-smart-contracts-using-vyper-a-python-approach-95f9299e64d8?source=collection_archive---------6-----------------------#2022-03-21">https://betterprogramming.pub/implementing-smart-contracts-using-vyper-a-python-approach-95f9299e64d8?source=collection_archive---------6-----------------------#2022-03-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f422" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索如何使用Vyper编程语言而不是Solidity编写智能合同</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4886470856158582489d5e03fa75155a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJdpgmA_I4A36YmcA9xTrQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由——简·kopřiva拍摄</p></figure><p id="2565" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多正在学习如何编写智能合同的程序员会学习Solidity语言。有大量的在线教程和书籍可以教你什么是可靠。当与Truffle框架结合时，Solidity形成了开发智能契约的杀手组合。以太坊区块链上几乎所有的智能合约都是用Solidity编程语言编写的。</p><p id="4871" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将探讨如何用Vyper编程语言编写智能合同。</p><h1 id="08b5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">涵盖的主题</h1><ol class=""><li id="c8cf" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu mu mv mw mx bi translated">介绍</li><li id="57fb" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">设置环境</li><li id="9e56" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">使用Vyper创建智能合同</li><li id="d1d7" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">将智能合同部署到Ganache</li><li id="f64a" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">与智能合约交互</li><li id="7ee1" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">与其他智能合同交互</li><li id="dea7" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu mu mv mw mx bi translated">以编程方式编译代码</li></ol><h1 id="641f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">介绍</h1><h2 id="6785" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">Vyper是什么？</h2><p id="efa2" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">Vyper是一种面向契约的pythonic编程语言，目标是<a class="ae ky" href="https://ethereum.org/learn/#ethereum-basics" rel="noopener ugc nofollow" target="_blank">以太坊虚拟机(EVM) </a>。Vyper的语法非常简单/易懂；Vyper的原则之一是让开发者几乎不可能编写误导性的程序。</p><h2 id="daee" class="nd lw it bd lx ne nf dn mb ng nh dp mf li ni nj mh lm nk nl mj lq nm nn ml no bi translated">为什么是Vyper？</h2><ul class=""><li id="5591" class="mn mo it lb b lc mp lf mq li mr lm ms lq mt lu ns mv mw mx bi translated"><strong class="lb iu">安全性</strong>:在Vyper中构建安全的智能合约应该是可能的，也是自然的。</li><li id="3c44" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu ns mv mw mx bi translated">语言和编译器的简单性:语言和编译器的实现应该尽量简单。</li><li id="812c" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu ns mv mw mx bi translated">可审计性 : Vyper代码应该最大程度上是人类可读的。此外，编写误导性代码应该是最困难的。对读者来说简单比对作者来说简单更重要，而对没有多少Vyper使用经验(以及一般编程经验)的读者来说简单尤为重要。</li></ul><p id="13fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，Vyper提供了以下功能:</p><ul class=""><li id="bce4" class="mn mo it lb b lc ld lf lg li nt lm nu lq nv lu ns mv mw mx bi translated"><strong class="lb iu">边界和溢出检查</strong>:关于数组访问和算术。</li><li id="c498" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu ns mv mw mx bi translated"><strong class="lb iu">支持有符号整数和十进制定点数</strong></li><li id="6411" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu ns mv mw mx bi translated"><strong class="lb iu">可判定性</strong>:可以计算任何Vyper函数调用的气体消耗的精确上限。</li><li id="b7cf" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu ns mv mw mx bi translated"><strong class="lb iu">强力打字</strong></li><li id="a209" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu ns mv mw mx bi translated"><strong class="lb iu">小巧易懂的编译器代码</strong></li><li id="7cb9" class="mn mo it lb b lc my lf mz li na lm nb lq nc lu ns mv mw mx bi translated"><strong class="lb iu">对纯函数的有限支持</strong>:任何标记为常量的东西都不允许改变状态。</li></ul><h1 id="6a3e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">设置环境</h1><p id="84bb" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">Vyper需要Python 3.6软件。所以，如果你没有安装Python 3.6软件，你必须在这里安装它<a class="ae ky" href="https://www.python.org/downloads/release/python-366/" rel="noopener ugc nofollow" target="_blank">，然后按照以下步骤操作:</a></p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="ae90" class="nd lw it nx b gy ob oc l od oe">$ python3 -m pip install --user virtualenv<br/>$ pip install vyper<br/>$ virtualenv -p python3.6 vyper-venv<br/>$ source vyper-venv/bin/activate<br/>(vyper-venv) $ pip install vyper<br/>(vyper-venv) $ vyper --version</span></pre><h1 id="a7bd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">与Vyper一起创建智能合同</h1><p id="2d3a" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">现在，让我们与Vyper一起创建一个智能合同。首先，我们将使用。vy扩展名，并将其命名为<code class="fe of og oh nx b">hello.vy</code>，如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">你好，小薇</p></figure><p id="0c4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是您编译vyper文件的方式:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="72c2" class="nd lw it nx b gy ob oc l od oe">(vyper-venv) $ vyper hello.vy</span></pre><p id="6ecb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由此，您将获得以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/2a46b960b053062c298260a4f9bf3196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3mTv3iE0HjvoxZLGQ2GJA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">abi</p></figure><p id="7af8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是智能合约的字节码。请记住，要部署智能合约，您需要字节码，但是要访问智能合约，您需要abi。那么如何获得abi呢？您可以通过运行以下命令来实现这一点:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="2c39" class="nd lw it nx b gy ob oc l od oe">(vyper-venv) $ vyper -f json hello.vy</span></pre><p id="e265" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由此，您将获得以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/42ec2372d6184d938ba74191b474c25f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F7axjszPYp7BDI20IbZn4A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">json</p></figure><p id="f84e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想在一个编译过程中同时获得abi和字节码，您可以在编译过程中组合这两个标志，如下所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="65dc" class="nd lw it nx b gy ob oc l od oe">(vyper-venv) $ vyper -f json,bytecode hello.vy</span></pre><p id="cee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将为您提供以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/b4d689b5fc1713711def7d71ebfc57e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SUKn-qFFqUzOS5fhvU9OGg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿比，json</p></figure><h1 id="f669" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">在加纳切部署智能合同</strong></h1><p id="80eb" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">那么，如何将这个智能合约部署到以太坊区块链呢？有几种方法可以做到这一点，但让我们使用一种熟悉的方式使用松露:</p><ol class=""><li id="723a" class="mn mo it lb b lc ld lf lg li nt lm nu lq nv lu mu mv mw mx bi translated">创建一个目录并用truffle init初始化它，如下所示:</li></ol><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="72a2" class="nd lw it nx b gy ob oc l od oe">$ mkdir hello_project<br/>$ cd hello_project<br/>$ truffle init</span></pre><p id="c25a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.按如下方式设置truffle-config.js:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="8fd5" class="nd lw it nx b gy ob oc l od oe">module.exports = { <br/>  networks: { <br/>    "development": { <br/>       network_id: "*", <br/>       host: "127.0.0.1", <br/>       port: 8545 // port at Ganache running<br/>      }, <br/>    } <br/> };</span></pre><p id="d51d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.创建一个构建目录，如下所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="357f" class="nd lw it nx b gy ob oc l od oe">$ mkdir -p build/contracts<br/>$ cd build/contracts</span></pre><p id="091e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.然后在那里创建一个Hello.json文件，如下所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="d725" class="nd lw it nx b gy ob oc l od oe">{<br/>  “abi”:<br/>  ”bytecode”:<br/>}</span></pre><p id="ab3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">5.然后用编译过程输出的abi或json填充abi字段，用编译过程输出的字节码填充字节码字段。您需要用双引号将字节码值括起来。不要忘记在abi字段和字节码字段之间加一个逗号。这将为您提供类似于以下内容的内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="63c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">6.然后，您可以通过在<code class="fe of og oh nx b">migrations/2_deploy_hello.js</code>中创建一个新文件来创建一个迁移文件来部署这个智能合约，如下所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="0131" class="nd lw it nx b gy ob oc l od oe">var Hello = artifacts.require("Hello");<br/>module.exports = function(deployer){<br/>   deployer.deploy(Hello);<br/>};</span></pre><p id="3217" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一切设置好后，点火<strong class="lb iu"> Ganache </strong>！</p><p id="afbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">7.然后，在hello_project目录中，您可以运行迁移过程，如下所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="da3c" class="nd lw it nx b gy ob oc l od oe">$ truffle migrate</span></pre><p id="40f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到类似如下的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/d76afdd142d1ac53575c9a9866347119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLW-2NoomwtALB9kaZSrrw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">块菌产量</p></figure><p id="7b58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您与Vyper一起编写的智能合同已部署到Ganache。您的智能合同地址如下:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="d3f4" class="nd lw it nx b gy ob oc l od oe">0x4AB3935Df0E224771663984f3617F1a78beA4E8D</span></pre><h1 id="4250" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">与智能合约互动</strong></h1><p id="4b0a" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">正如我们之前所做的，您可以使用Truffle控制台与您的智能合约进行交互，如下所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="003f" class="nd lw it nx b gy ob oc l od oe">$ truffle console</span></pre><p id="ff68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的智能合约始终被命名为合约。我们可以使用以下语句访问智能合同:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="9a6d" class="nd lw it nx b gy ob oc l od oe">truffle(development)&gt; Contract.at("0x4AB3935Df0E224771663984f3617F1a78beA4E8D")</span></pre><p id="07d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将得到一个很长的输出，其中可以看到abi、字节码等等，如下面的屏幕截图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/3af968bf641165dd78f62eae33042f79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Zj-nYXJB7LJTbSn5hVBAA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">块菌产量</p></figure><p id="78cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们使用下面的语句来看看智能合约的name变量的值:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="3ba2" class="nd lw it nx b gy ob oc l od oe">truffle(development)&gt; Contract.at(“0x4AB3935Df0E224771663984f3617F1a78beA4E8D”).then(function(instance){return instance.name.call(); });</span><span id="dbe3" class="nd lw it nx b gy op oc l od oe"><em class="oq">'Satoshi Nakamoto'</em></span></pre><p id="bf2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将名称更改如下:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="d09d" class="nd lw it nx b gy ob oc l od oe">truffle(development)&gt; Contract.at(“0x4AB3935Df0E224771663984f3617F1a78beA4E8D”).then(function(instance) { return instance.change_name(“Vitalik Buterin”), { from: “0xb28Fc17791bf66719FBFCc65846B01Fe2726e9E2” } });</span></pre><blockquote class="or os ot"><p id="1539" class="kz la oq lb b lc ld ju le lf lg jx lh ou lj lk ll ov ln lo lp ow lr ls lt lu im bi translated"><code class="fe of og oh nx b">from</code>字段中的值取自加纳切的一个账户。你可以只看Ganache窗口，选择任何你喜欢的账户。</p></blockquote><p id="2ed2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="118f" class="nd lw it nx b gy ob oc l od oe">{ from: ‘0xb28Fc17791bf66719FBFCc65846B01Fe2726e9E2’ }</span></pre><p id="38e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在改名字了吗？让我们找出答案。运行以下命令:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="9aff" class="nd lw it nx b gy ob oc l od oe">truffle(development)&gt; Contract.at(“0x4AB3935Df0E224771663984f3617F1a78beA4E8D”).then(function(instance){return instance.name.call(); });</span><span id="c846" class="nd lw it nx b gy op oc l od oe"><em class="oq">‘Vitalik Buterin’</em></span></pre><h1 id="3ff1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">与其他智能合同交互</h1><p id="cda2" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">您的智能合约可以与区块链上的其他智能合约进行交互。</p><p id="3adf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地址数据类型不仅用于普通帐户，也可用于智能合同帐户。因此，智能合同可以通过捐赠智能合同向我们的受赠人捐赠乙醚！</p><p id="d081" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重启你的Ganache。还记得你的<code class="fe of og oh nx b">hello.vy</code>文件吗？我们希望使用自定义名称部署我们的Hello smart契约。</p><p id="8937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的迁移文件，<code class="fe of og oh nx b">migrations/2_deploy_hello.js</code>仍然是相同的，如下面的代码所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="484e" class="nd lw it nx b gy ob oc l od oe">var Hello = artifacts.require("Hello");<br/>module.exports = function(deployer){<br/>   deployer.deploy(Hello);<br/>};</span></pre><p id="b952" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再次编译您的<code class="fe of og oh nx b">hello.vy</code>文件以获得接口和字节码。打开我们的合同JSON文件，<code class="fe of og oh nx b">build/contracts/Hello.json</code>文件。删除所有内容，并替换为以下代码:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="5c9c" class="nd lw it nx b gy ob oc l od oe">{<br/>     "contractName": "Hello",<br/>     "abi": &lt;your Hello smart contract's interface&gt;,<br/>     "bytecode": "&lt;your Hello smart contract's bytecode&gt;"<br/>}</span></pre><p id="243b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须为您的智能合约命名，因为这一次，您将部署两个智能合约。如果您不为智能合约命名，它将有一个默认名称contract。如果您只想部署一个智能合约，这不是问题。</p><p id="212e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，对您的<code class="fe of og oh nx b">donation.vy</code>进行编辑，并添加以下代码行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">捐赠. vy</p></figure><p id="3b05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用下面的代码，为我们的捐赠智能契约<code class="fe of og oh nx b">migrations/3_deploy_donation.js</code>创建另一个迁移文件:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="520f" class="nd lw it nx b gy ob oc l od oe">var Donation = artifacts.require("Donation");<br/>module.exports = function(deployer) {<br/>  deployer.deploy(Donation);<br/>};</span></pre><p id="0457" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编译您的<code class="fe of og oh nx b">donation.vy</code>,并获得智能契约的接口和字节码。然后，使用下面的代码，为我们的捐赠智能契约创建另一个契约JSON文件，<code class="fe of og oh nx b">build/contracts/Donation.json</code>:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="3502" class="nd lw it nx b gy ob oc l od oe">{<br/>     "contractName": "Donation",<br/>     "abi": &lt;your Donation smart contract's interface&gt;,<br/>     "bytecode": "&lt;your Donation smart contract's bytecode&gt;"<br/>}</span></pre><p id="5824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行迁移。您可能需要使用<code class="fe of og oh nx b">—- reset</code>标志，如下所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="2741" class="nd lw it nx b gy ob oc l od oe">$ truffle migrate --reset</span></pre><p id="84d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将获得以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/9969a5910b8d8a6d71a6be0ff8db50fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1shANa1f5U36mEbZime-HA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">块菌产量</p></figure><p id="f60c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意<code class="fe of og oh nx b">Donation</code>智能合约“0x 25 aff 89 b 8 a 72 a B4 ba 6 f 4c 831 F5 b 1375 f 9 BCE 76 a 9”和<code class="fe of og oh nx b">Hello</code>智能合约“0x 772138489 ed 34095 FBA 6a 0 af 70d 3c 9115813 cfca”的地址。你的可能会不同。</p><p id="895b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按如下方式运行Truffle控制台:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="bea9" class="nd lw it nx b gy ob oc l od oe">$ truffle console</span></pre><p id="4418" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们的智能合同不再孤独😄，如下面的代码所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="6968" class="nd lw it nx b gy ob oc l od oe">truffle(development)&gt; Donation.at(“0x25aFF89B8a72aB4Ba6F4C831f5B1375f9BCe76A9”).then(function(instance) { return instance.donation_smart_contract_call_hello_smart_contract_method.call(“0x772138489eD34095FBA6a0Af70d3C9115813CFcA”); } );</span></pre><p id="bdee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="9dd1" class="nd lw it nx b gy ob oc l od oe">‘0x48656c6c6f2c205361746f736869204e616b616d6f746f’</span></pre><h1 id="c797" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">以编程方式编译代码</h1><p id="132f" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">您可以创建一个脚本来编译Vyper代码，而不是使用命令行实用程序。确保您位于包含<code class="fe of og oh nx b">Hello.vy</code>和<code class="fe of og oh nx b">donation.vy</code>的同一目录中。创建一个名为<code class="fe of og oh nx b">compiler.vy</code>的脚本，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">compiler.vy</p></figure><p id="46f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您使用下面的命令执行这个脚本，您将得到一个可以与Truffle一起使用的<code class="fe of og oh nx b">Hello.json</code>文件，如下面的代码所示:</p><pre class="kj kk kl km gt nw nx ny nz aw oa bi"><span id="441e" class="nd lw it nx b gy ob oc l od oe">(vyper-venv) $ python compiler.vy</span></pre><h1 id="5351" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated"><strong class="ak">总结</strong>📝</h1><p id="1788" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">在本文中，我们看到了如何使用Vyper编程语言编写智能合同。首先，我们安装了Vyper编译器。然后我们开发了一个智能合同。</p><p id="09c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过这样做，我们了解了Vyper编程语言的大部分特性，包括函数装饰器、初始化函数和函数权限修饰符。</p><p id="5935" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有一些数据类型，如地址、整数、时间戳、映射、数组和字节数组(字符串)。我们学习了如何将Vyper源代码编译成智能契约，然后用Truffle工具将其部署到Ganache。我们还通过Truffle控制台与智能合约进行了交互。</p></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><h1 id="3f6f" class="lv lw it bd lx ly pf ma mb mc pg me mf jz ph ka mh kc pi kd mj kf pj kg ml mm bi translated">参考</h1><p id="b750" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">[1]: Vyper。文档。<a class="ae ky" href="https://vyper.readthedocs.io/en/stable/index.html" rel="noopener ugc nofollow" target="_blank">https://vyper.readthedocs.io/en/stable/index.html</a></p><p id="065d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多:</p><div class="pk pl gp gr pm pn"><a rel="noopener  ugc nofollow" target="_blank" href="/preventing-smart-contract-attacks-on-ethereum-a-code-analysis-bf95519b403a"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">防止对以太坊的智能合约攻击——代码分析</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">让我们编写一个易受攻击的智能合约代码，看看攻击是如何工作的，并了解修复它的预防技术</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">better编程. pub</p></div></div><div class="pw l"><div class="px l py pz qa pw qb ks pn"/></div></div></a></div></div></div>    
</body>
</html>