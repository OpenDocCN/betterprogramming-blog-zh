<html>
<head>
<title>Analysing Sleep Data From Garmin Smartwatch Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python分析Garmin智能手表的睡眠数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/analysing-sleep-data-from-garmin-smartwatch-using-python-ed0f05616960?source=collection_archive---------1-----------------------#2022-12-30">https://betterprogramming.pub/analysing-sleep-data-from-garmin-smartwatch-using-python-ed0f05616960?source=collection_archive---------1-----------------------#2022-12-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="00e9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在这篇文章中，我将总结如何从自己的Garmin智能手表设备上下载睡眠数据，然后进行分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/b451cbc46236d3e2026240bc792a95a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*txHkR6IaBKaoD8SGmrQKvA.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="e7d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我用的是老款Garmin Forerunner 235。有更现代、更强大的手表可以跟踪更多的健康数据，例如Vivo，因此，可以通过后台记录的其他指标进一步扩展分析。</p><h1 id="4646" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">数据下载和提取</h1><p id="faa8" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">您的Garmin数据可以从Garmin Connect IQ网站下载。前往<a class="ae mn" href="https://www.garmin.com/en-US/account/datamanagement/" rel="noopener ugc nofollow" target="_blank"> Garmin站点</a>，然后点击导出数据。数据是压缩的JSON格式。对于睡眠数据，您需要先进入<code class="fe mo mp mq mr b">DI_CONNECT,</code>，然后进入<code class="fe mo mp mq mr b">DI_Connect_Wellness</code>，然后按日期排序的JSON文件就在那里，准备提取。</p><p id="1646" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了从JSON文件中以漂亮的表格格式提取原始睡眠数据，我使用了GitHub上的<a class="ae mn" href="https://github.com/adam1brownell/garmin_data/blob/main/garmin_functions.py" rel="noopener ugc nofollow" target="_blank"> Adam Browne的repo </a>，特别是他的<code class="fe mo mp mq mr b">build_sleep_data</code>函数，如下所示。他还有许多其他有用的功能来提取Garmin数据的其他成分，我强烈建议您查看他的repo。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="8520" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您有多个JSON文件，那么您可以使用下面的代码片段将多个pandas数据帧按顺序附加在一起。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><p id="84df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">结果是具有1001行和27列的数据帧。</p><p id="20ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以使用seaborn通过下面的代码来实现这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><p id="a119" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">产生了这个漂亮的热图，浅棕色的值都是空的行和列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/81a992fc564f19e04448b652292913d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AqEZ0q3I4RBHW7_mebzjlw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">使用seaborn来可视化空的行和列(黑色代表数据，浅棕色代表nan)。</p></figure><h1 id="347c" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">数据清理</h1><p id="9150" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">现在，我们需要清理数据，因为有许多空的行和列，就像刚才解释的那样。我们先来整理一下数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><p id="1ba1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们用<code class="fe mo mp mq mr b">df_all.columns</code>检查数据中的列，用<code class="fe mo mp mq mr b">df_all.dtypes</code>检查数据类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi na"><img src="../Images/a0b84337bbddc0c2c6de14bdeee339aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dWRXLIrCiVU5AQoVuFGoag.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">睡眠数据数据帧中的列名。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/4eecaa12dafddf990f8557c4144d7c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*9XE8BLsETLUHxTJJqJuHCw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">数据帧中每一列的数据类型。</p></figure><p id="7b6c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后删除所有包含NAs的列。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><p id="603d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们进一步删除任何没有睡眠数据的行，我假设在deepSleepSeconds列中有0深度睡眠。从视觉上看，我们可以使用上面的Seaborn代码片段和下面的代码来检查这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><p id="1798" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们可以使用下面的代码从数据帧中删除这些零:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><p id="2750" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最终的数据帧如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nc"><img src="../Images/fad402244953db784b2af20c7d24afd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jvyJ38INfEKk19S7FN2KDw.png"/></div></div></figure><p id="66c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们将睡眠时间从秒转换为小时，并将它们添加为列。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><p id="84fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">数据现在处于正确的状态，已经删除了空数据和任何睡眠时间为0的数据。我们现在可以进入下一步，对数据进行分析和可视化。</p><h2 id="7647" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">数据可视化</h2><p id="e659" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">现在使用Seaborn包，我们可以以任何我们想要的方式可视化地分割数据。让我们先看看深度睡眠的时间。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi np"><img src="../Images/70e3533f2a5ebccf1cc25e062d9261d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ujl9E4qOP53-Sv-o_uNDNA.png"/></div></div></figure><p id="b22c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以在数据中看到任何有意义的东西。使用pandas，我们可以为不同种类的睡眠创建一个睡眠数据的堆积条形图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nq"><img src="../Images/2ec76134ea825cb7f2224aeea69f14b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k25iNgf24KyZ3ylylG2Ozw.png"/></div></div></figure><p id="d191" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们再清理一下，将每日数据分组为每月数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><p id="942a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，让我们做一个深度睡眠数据的箱线图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi np"><img src="../Images/195d13461f07b10e8dd9f6bf8183e90c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rlpil5s_hijwxIK50tNuNg.png"/></div></div></figure><p id="df91" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们可以将数据按月分组，并计算每个睡眠类别的月平均值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/32ad2d4c9cb67885ef4cb1e67164d11e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*awlai-Fyvv5KimMqblHcHA.png"/></div></figure><p id="f32a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这一次，使用pandas plotting可以创建一个堆积条形图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi np"><img src="../Images/80d1d7bb11a91c9dc3605de5345f055e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nMuN6h9y382HlvB3B1knJQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">使用Seaborn的深度、轻度和清醒睡眠分类的堆积条形图。</p></figure><p id="0695" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们通过绘制直方图和CDF图来检查总睡眠的分布。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ns"><img src="../Images/e8c853413adad574a15d7a9494b5973a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1de8mVZTsBNggnTb-wKFyA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">柱状图</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nt"><img src="../Images/a82488b547963a7ab636a951577a774c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1eZHzK_H5kVZ8CFePqY2g.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">CDF图</p></figure><p id="3486" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以通过一周中的某一天来观察睡眠模式吗？我们可以绘制堆栈直方图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ns"><img src="../Images/e4d9f7584c9320cff7d0f95ef944fc91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GOFYGnz4vhPoPhXFqnVJxw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">一周中各天睡眠数据的堆积直方图</p></figure><p id="ae20" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，这看起来相当混乱，很难从中看出任何模式。在Seaborn中，可以使用平面2D网格方式显示多个直方图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/37db66b585d6c5e11e988b4150c36412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*J-uvD4G2JVHOaxYitxcTsQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">堆积直方图的Seaborn显示图</p></figure><p id="5944" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">可以看出，事实上，从视觉上看，与周二和周四以及一般工作日相比，我在周六和周日确实睡得更久。以下是表格形式的日期:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/8406791c3ad2c2a020557e01b7971a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*5ErsRN8QCWiGTuI28AuCEA.png"/></div></figure><h2 id="37ea" class="nd lr it bd ls ne nf dn lw ng nh dp ma ld ni nj mc lh nk nl me ll nm nn mg no bi translated">后续步骤</h2><p id="8d7a" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">使用这款特殊的Garmin智能手表，您还可以进行心率监测，因此可以覆盖您的静息心率和最大摄氧量以及任何其他用户定义的输入，如水合作用、体重等。人们也可以通过使用智能手表继续建立更多的数据点。与此同时，一个人睡觉是为了获得统计上更有意义的数据，并比较是否存在季节性，比如你在冬天比夏天睡得更久？或者工作或个人环境中是否有变化模式可以显示压力。</p><h1 id="f17c" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">结论</h1><p id="e3db" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">我已经演示了如何从Garmin下载数据，系统地提取多个JSON文件并将它们添加到Pandas数据帧中。通过对数据的简单清理，我使用Seaborn对数据进行了可视化，以获得对每月时段和一周中各天的一些有意义的见解。</p><p id="3a78" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以上分析的全部完整代码位于我的GitHub <a class="ae mn" href="https://github.com/ferhat00/garmin_sleep_analysis" rel="noopener ugc nofollow" target="_blank"> repo </a>中。</p></div></div>    
</body>
</html>