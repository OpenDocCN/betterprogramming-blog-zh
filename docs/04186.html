<html>
<head>
<title>How to Protect Your HTTP Firebase Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何保护你的HTTP Firebase云功能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/protect-your-http-firebase-cloud-functions-adf23c45765e?source=collection_archive---------12-----------------------#2020-03-28">https://betterprogramming.pub/protect-your-http-firebase-cloud-functions-adf23c45765e?source=collection_archive---------12-----------------------#2020-03-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="54b0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用授权持有人</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/15fcf4105e6cb4271d2270cd4a207a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iLmvjzw4ywx-I8u5MOi7zw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@dre0316?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">安德烈·亨特</a>在<a class="ae ky" href="https://unsplash.com/s/photos/free?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="19c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我每天分享<a class="ae ky" href="https://medium.com/@david.dalbusco/one-trick-a-day-d-34-469a0336a07e" rel="noopener">一招</a>直到原定的瑞士新冠肺炎隔离期结束日，2020年4月19日。距离第一个里程碑还有22天。希望更好的日子就在前面。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="9095" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">去年，我为一个基金会开发了一个应用程序，该基金会的目标是帮助特定年龄的人。主要由于管理原因，该项目尚未公开发布。</p><p id="d261" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，我们注意到它的目标和当前的锁定情况有一些相似之处。这就是为什么我被要求创建一个包含有用功能的衍生产品，它可以很快释放出来，因为它会很有用！</p><p id="8546" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在周六上午“克隆”了我们的<a class="ae ky" href="https://firebase.google.com" rel="noopener ugc nofollow" target="_blank"> Firebase Cloud </a>基础设施，并且必须保护我刚刚在线部署的新的<a class="ae ky" href="https://cloud.google.com/functions/docs/writing/http" rel="noopener ugc nofollow" target="_blank"> HTTP函数</a>。这就是为什么我有写这篇关于这个主题的简短文章的想法。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bb7d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">授权持有人</h1><p id="a38c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当您创建一个可以通过HTTP请求触发或调用的Firebase Cloud函数时，该函数是公共的，可以在internet上使用。</p><p id="bfdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">据我所知，它生成的URL不包含随机ID或其他会使路由不可预测的散列，因此，您必须找到一种方法来保护它。</p><p id="dd42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我看来，这就是为什么解决方案是用授权令牌对每个请求进行身份验证。</p><p id="25a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">解决这个问题的一个方法是在代码中添加一个常量键。例如，如果我们部署了以下功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="0589" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以创建一个函数来验证必须为每个请求提供的<code class="fe nb nc nd ne b">bearer</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="ff12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并用它来扩展我们的HTTP函数，进行测试。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6047" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe nb nc nd ne b">key</code>,我们当然可以使用类似于密码或哑关键字的东西，就像我上面使用的那样，但是使用例如版本4 UUID会更安全。</p><p id="b7f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多工具可以生成它，但是今天，我使用了<a class="ae ky" href="https://www.uuidgenerator.net" rel="noopener ugc nofollow" target="_blank"> UUID生成器</a>，它完美地完成了这项工作。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="0d3c" class="nj md it ne b gy nk nl l nm nn">const key = '975dd9f6-4a89-4825-9a6d-deae71304a29';</span></pre><p id="29bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们的HTTP路由现在受到保护，只有在提供授权的情况下才可以访问。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="e146" class="nj md it ne b gy nk nl l nm nn">#!/bin/sh<strong class="ne iu"><br/></strong>curl -i <br/>     -H "Accept: application/json"<br/>     -H "Authorization: Bearer 975dd9f6-4a89-4825-9a6d-deae71304a29" <br/>     -X GET  https://us-central1-yolo.cloudfunctions.net/helloWorld</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2ae6" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Firebase环境变量</h1><p id="15c2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">保护很酷，但是我们的保护被保护了吗？</p><p id="1f34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们的代码作为开源软件发布，我们的密钥就会暴露。此外，在代码中间处理一个键并不可爱。但是有一个解决方案。</p><p id="daf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Firebase提供了定义非公开环境变量的能力，这些变量可以从云函数中读取。</p><p id="bcd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了这样定义上面的键，我们可以在Firebase CLI的帮助下运行下面的命令。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="49ae" class="nj md it ne b gy nk nl l nm nn">#!/bin/sh<br/>firebase functions:config:set hello.world.key="975dd9f6-4a89-4825-9a6d-deae71304a29"</span></pre><p id="c670" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剩下要做的事情是用新变量替换我们的常量。</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="cf78" class="nj md it ne b gy nk nl l nm nn">const key = functions.config().hello.world.key;</span></pre><p id="1ead" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就这样了，我们的HTTP Firebase云功能得到了保护。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="11ab" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一起</h1><p id="e49a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了以防万一，您可能需要将上面的代码放在一个块中，下面是所有代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1b24" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="0127" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Firebase太好用了！但更重要的是:</p><p id="92b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">呆在家里，注意安全！</p><p id="e42c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大卫</p></div></div>    
</body>
</html>