<html>
<head>
<title>How to Use Google Cloud Firestore With Glitch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Glitch使用Google Cloud Firestore</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-google-cloud-firestore-with-glitch-e92464f00ee7?source=collection_archive---------9-----------------------#2020-06-08">https://betterprogramming.pub/how-to-use-google-cloud-firestore-with-glitch-e92464f00ee7?source=collection_archive---------9-----------------------#2020-06-08</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="a251" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">设置多行JSON秘密的指南</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/f2c69eccc170c1720e268882528fd44b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YA495YapbJQBl1FP"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@courtniebt13?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">考特尼·托萨纳</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="8883" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://cloud.google.com/firestore/" rel="noopener ugc nofollow" target="_blank"> Cloud Firestore </a>和<a class="ae kz" href="https://glitch.com" rel="noopener ugc nofollow" target="_blank"> Glitch </a>都可以用来免费轻松构建强大的网络应用，并以低廉的价格扩展应用。但是要弄清楚如何将它们配置为一起工作可能有点棘手。请继续阅读，学习我的技巧。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="2b9a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Cloud Firestore是一个托管的NoSQL文档数据库服务，可从<a class="ae kz" href="https://cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>获得。该服务有一个免费层，允许每天存储高达1 GB的数据和数万次文档读写。API和web控制台都非常容易使用。</p><p id="c6c1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Glitch是一种基于云的协作编程环境服务，可以在您键入时部署代码。Glitch上托管的应用程序会自动使用SSL证书进行保护，并在互联网上公开发布。该服务免费层上的应用每小时最多允许4000次请求，并在一段时间不活动后进入睡眠状态。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="8581" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">访问数据库所需的服务帐户凭证由Firestore控制台以JSON格式的文件提供。在某些环境下，使用JSON文件格式来保存机密很方便——但在Glitch上就不方便了。在Glitch上，默认情况下大多数项目文件都是公开可见的。如果您将JSON文件直接添加到Glitch项目中，这将向外界公开您的数据库凭证。呀！</p><p id="3a92" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">幸运的是，还有另一种方法。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="55b9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Glitch上的开发工作流是围绕在名为<code class="fe md me mf mg b"><a class="ae kz" href="https://glitch.com/help/how-do-i-store-secrets-credentials-or-private-data/" rel="noopener ugc nofollow" target="_blank">.env</a></code>的文件中存储秘密的惯例而设计的。在Glitch上，这个文件中的值对除了被邀请的合作者之外的任何人都是隐藏的。Glitch还自动确保该文件中指定的每个值都可以作为环境变量从运行的应用程序和终端中访问。</p><p id="ff96" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">模块的文档中有更多关于这个文件格式的细节。关于文件格式，我们需要知道的两个关键问题是，要传递多行值，值必须用引号括起来，当值包含双引号时，我们可以用单引号括起来。</p><p id="0238" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这两件事意味着我们可以轻松地将整个多行JSON文件作为单个值传递，只要我们用单引号将它括起来，并且只要JSON文件本身不包含任何单引号。所以这正是我们将对包含数据库凭证的JSON文件所做的。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="55d9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们将创建一个Firebase项目，并在该项目中创建一个Firestore数据库。然后，我们将数据库凭证文件下载到我们的本地设备，并将内容复制到我们的剪贴板。最后，我们将把凭证粘贴到Glitch项目中的一个<code class="fe md me mf mg b">.env</code>文件中。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><ul class=""><li id="66db" class="mh mi iu lc b ld le lg lh lj mj ln mk lr ml lv mm mn mo mp bi translated">点击<a class="ae kz" href="https://glitch.com/edit/#!/remix/hello-express" rel="noopener ugc nofollow" target="_blank">这里</a>重新混合基本的基于NodeJS/Express的web app项目模板，或者使用现有的Glitch项目。</li><li id="143a" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">在Firebase控制台<a class="ae kz" href="https://console.firebase.google.com" rel="noopener ugc nofollow" target="_blank">这里</a>创建一个Firebase项目。</li><li id="99af" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">将Firebase项目命名为Glitch项目。</li><li id="e359" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">禁用分析。</li><li id="c13e" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">在Firebase控制台中创建一个新的Firestore数据库，方法是单击侧栏中的“数据库”，然后单击“创建数据库”:</li></ul><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mv"><img src="../Images/faf82f7bc311a42b9a66e148d5867648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qpIKA2SwgwTKFr3lqtRarw.png"/></div></div></figure><ul class=""><li id="174c" class="mh mi iu lc b ld le lg lh lj mj ln mk lr ml lv mm mn mo mp bi translated">将数据库设置为在生产模式下启动。</li><li id="5d5a" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">接受数据库的默认位置。</li><li id="4089" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">点按齿轮图标，然后点按“项目设置”，再点按“服务帐户”，然后点按“创建服务帐户”:</li></ul><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mv"><img src="../Images/67745217734224a28b733978b04cf047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_zBUaNMJY2_mr3Mp--Pe8g.png"/></div></div></figure><ul class=""><li id="3755" class="mh mi iu lc b ld le lg lh lj mj ln mk lr ml lv mm mn mo mp bi translated">单击“生成新的私钥”将凭据下载到您的本地设备。</li><li id="3146" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">打开下载的文件，并将内容复制到剪贴板。</li><li id="94b1" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">打开你的Glitch项目，在编辑器中选择<code class="fe md me mf mg b">.env</code>文件。</li><li id="157b" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">单击“纯文本”按钮隐藏图形编辑器。</li><li id="2152" class="mh mi iu lc b ld mq lg mr lj ms ln mt lr mu lv mm mn mo mp bi translated">将以下行添加到<code class="fe md me mf mg b">.env</code>文件中:</li></ul><pre class="kk kl km kn gu mw mg mx my aw mz bi"><span id="e6e1" class="na nb iu mg b gz nc nd l ne nf">FIREBASE_SERVICE_ACCCOUNT=''</span></pre><ul class=""><li id="8697" class="mh mi iu lc b ld le lg lh lj mj ln mk lr ml lv mm mn mo mp bi translated">将文本插入点放在两个单引号之间。从剪贴板粘贴凭据。</li></ul></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="3cb5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当我们完成后，我们的<code class="fe md me mf mg b">.env</code>文件将看起来像这样:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="c788" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当我们切换回图形编辑器时，我们应该只看到第一行<code class="fe md me mf mg b">FIREBASE_SERVICE_ACCOUNT</code>值:<code class="fe md me mf mg b">'{</code>。别担心，剩下的价值还在。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="54ad" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了在我们的项目中使用凭证，我们首先添加<code class="fe md me mf mg b"><a class="ae kz" href="https://www.npmjs.com/package/@google-cloud/firestore" rel="noopener ugc nofollow" target="_blank">@google-cloud/firestore</a></code>模块作为项目依赖项。然后，我们可以在项目中添加一些代码，如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="b1f6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">第一行解析来自<code class="fe md me mf mg b">FIREBASE_SERVICE_ACCOUNT</code>环境变量的JSON凭证数据。第二行加载Firestore SDK。第三行用凭证初始化Firestore SDK。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><p id="ae7e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有关如何使用<code class="fe md me mf mg b">Firestore</code>和<code class="fe md me mf mg b">db</code>对象的更多信息，请查看<a class="ae kz" href="https://googleapis.dev/nodejs/firestore/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Firestore SDK文档</a>。</p></div></div>    
</body>
</html>