<html>
<head>
<title>4 Tips To Automate Clean Code in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中自动化干净代码的4个技巧</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-tips-to-automate-clean-code-in-python-527f59b5fe4e?source=collection_archive---------7-----------------------#2021-06-16">https://betterprogramming.pub/4-tips-to-automate-clean-code-in-python-527f59b5fe4e?source=collection_archive---------7-----------------------#2021-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5053" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">使用预提交Git挂钩，通过这些林挺和格式化工具</strong>自动化Python代码风格<strong class="ak"/></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6a716de81e6677877bc907fa83e664ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nxdPii2hUB2IZ98OIaYb4w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">整合了black和flake8的Git协议。图片由<a class="ae ky" href="https://ljvmiranda921.github.io/notebook/2018/06/21/precommits-using-black-and-flake8/" rel="noopener ugc nofollow" target="_blank"> lj miranda </a>提供。</p></figure><p id="b5e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你是否梦想<em class="lv">永远不用</em>担心格式化你的Python代码？在这篇文章中，我将与你分享如何自动化干净的编码原则。</p><ul class=""><li id="c997" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">用<code class="fe mf mg mh mi b">flake8</code>、<code class="fe mf mg mh mi b">isort</code>和<code class="fe mf mg mh mi b">mypy</code>林挺你的代码。</li><li id="78e2" class="lw lx it lb b lc mj lf mk li ml lm mm lq mn lu mb mc md me bi translated">用<code class="fe mf mg mh mi b">black</code>格式化你的代码。</li><li id="ae48" class="lw lx it lb b lc mj lf mk li ml lm mm lq mn lu mb mc md me bi translated">预提交Git挂钩</li><li id="bfe5" class="lw lx it lb b lc mj lf mk li ml lm mm lq mn lu mb mc md me bi translated">自动化Git格式化程序挂钩。</li></ul></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="9a40" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">林挺你的代码</h1><p id="34c7" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">林挺是运行质量控制工具的过程，该工具对源代码进行静态分析，以检查潜在的错误。</p><p id="6aa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python的风格指南是PEP-8。验证是否遵循PEP-8风格指南的一个流行的林挺工具是<code class="fe mf mg mh mi b">flake8</code>。它可以通过pip安装，并且可以很容易地用<code class="fe mf mg mh mi b"><strong class="lb iu">$</strong> flake8 python_code.py</code>运行。输出显示了源代码和PEP-8风格指南之间的所有差异。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/874aabe93492d0365e70f57fd15779de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*huRNbROOtBWEdHxTMtkw_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python脚本的flake8林挺。</p></figure><p id="c26f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以通过几个可安装pip的包来增强，以增加对特定警告的支持。<code class="fe mf mg mh mi b">autoflake</code>删除未使用的导入语句，<code class="fe mf mg mh mi b">pep8-naming</code>检查变量命名约定，如snake_case，<code class="fe mf mg mh mi b">flake8-docstrings</code>为NumPy或Google风格的文档字符串启用林挺。<code class="fe mf mg mh mi b">isort</code>是另一个流行的林挺工具，用于对您的进口报表进行排序。</p><p id="5df0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在项目的<code class="fe mf mg mh mi b">setup.cfg</code>、<code class="fe mf mg mh mi b">tox.ini</code>或<code class="fe mf mg mh mi b">.flake8</code>中移除对特定警告或错误的支持，或者使用命令行参数。</p><pre class="kj kk kl km gt nt mi nu nv aw nw bi"><span id="4c8d" class="nx mw it mi b gy ny nz l oa ob">--max-line-length=120<br/>--ignore=D100,D104,E203,E402,E501,W503<br/>--docstring-convention=google</span><span id="b56a" class="nx mw it mi b gy oc nz l oa ob">D100: Missing docstring in public module<br/>D104: Missing docstring in public package<br/>E203: Whitespace before ‘:’ (interferes with <strong class="mi iu">black</strong> formatting)<br/>E402: Module level import not at top of file<br/>E501: Line too long (82 &gt; 79 characters)<br/>W503: Line break occurred before a binary operator</span></pre><p id="309a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我更喜欢将最大行长度增加到120个字符，使用Google风格的docstrings，忽略上面的警告和错误。错误<code class="fe mf mg mh mi b">E203</code>干扰了我的首选代码格式化工具<code class="fe mf mg mh mi b">black</code>。</p><p id="fde6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您使用Python类型提示用变量类型注释函数参数，您可能也会对<code class="fe mf mg mh mi b">mypy</code>感兴趣，这是Python的一个可选静态类型检查器，旨在结合动态(或“duck”)类型和静态类型的优点。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="3559" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">格式化您的代码</h1><p id="7b4d" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">格式化不同于林挺，因为它确实用遵循样式指南的源代码来改变源文件。</p><p id="41d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mf mg mh mi b">black</code>是一个流行的Python格式化程序。这是一个符合PEP-8的固执己见的格式化程序，它可以就地重新格式化整个文件。它可以通过pip安装，并且可以很容易地用<code class="fe mf mg mh mi b"><strong class="lb iu">$</strong> black python_code.py</code>运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/fdce91e0b645a36d9816485daab762ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJfOPPjeDctUr5hHk2xDiQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python脚本的黑色格式。</p></figure><p id="3be6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mf mg mh mi b">black</code>也使用配置文件或命令行参数来处理异常。我使用的唯一参数是<code class="fe mf mg mh mi b">--line-length=120</code>来遵守flake8行长度例外。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="54ce" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">预提交Git挂钩</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/f44b23f8b9db17644fc2ce7728ede06f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*77EnUG9WHLrJJVDI.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">预提交Git管道。作者GIF。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6a716de81e6677877bc907fa83e664ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nxdPii2hUB2IZ98OIaYb4w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">整合了black和flake8的Git协议。图片由<a class="ae ky" href="https://ljvmiranda921.github.io/notebook/2018/06/21/precommits-using-black-and-flake8/" rel="noopener ugc nofollow" target="_blank"> lj米兰达</a>提供。</p></figure><p id="8470" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Git钩子脚本是附加在Git协议上的脚本。它们也是我们自动化的基础。您可以指示Git挂钩在提交或推送到Git存储库之前执行林挺和格式化工具。因此，他们确保您的项目的参与者遵守一个干净的编码标准。</p><p id="7a2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在提交给代码评审之前，它们可以很方便地识别简单的问题，并且可以“预提交钩子”用Python中的<code class="fe mf mg mh mi b">pre-commit</code>包实现。</p><pre class="kj kk kl km gt nt mi nu nv aw nw bi"><span id="3c47" class="nx mw it mi b gy ny nz l oa ob"><strong class="mi iu">$ </strong>pre-commit install</span></pre><p id="1790" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">预提交框架使用一个<code class="fe mf mg mh mi b">.pre-commit-config.yaml</code>来指定运行哪些钩子。在<code class="fe mf mg mh mi b">repos</code>键下，您可以添加存储库并指定使用该存储库中的哪些钩子。</p><p id="3c8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将<code class="fe mf mg mh mi b">flake8</code>、<code class="fe mf mg mh mi b">isort</code>、<code class="fe mf mg mh mi b">mypy</code>和<code class="fe mf mg mh mi b">black</code>添加到我们的预提交配置中。确保首先包括<code class="fe mf mg mh mi b">black</code>格式，然后用<code class="fe mf mg mh mi b">flake8</code>检查PEP-8。请在<a class="ae ky" href="https://pre-commit.com/#adding-pre-commit-plugins-to-your-project" rel="noopener ugc nofollow" target="_blank">预提交的网站</a>上找到顶层配置的参数和挂钩的描述。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="a6ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对预提交配置进行更改时，确保使用<code class="fe mf mg mh mi b"><strong class="lb iu">$</strong> git add .pre-comit-config.yaml</code>进行准备，以避免以下错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/03da004281f6bd0ef4845f07a630dbde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*CBdl4c9a6nHBc2tanrEAPQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">未分段的预提交配置。图片由作者提供。</p></figure><p id="27f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论出于什么原因，如果您不希望执行预提交挂钩，请确保在提交时使用<code class="fe mf mg mh mi b">--no-verify</code>命令行参数。</p><pre class="kj kk kl km gt nt mi nu nv aw nw bi"><span id="a3e3" class="nx mw it mi b gy ny nz l oa ob"><strong class="mi iu">$</strong> git commit --no-verify</span></pre></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="ea78" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">自动化Git格式化程序挂钩</h1><p id="bbbb" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">如果其中一项检查失败，预提交框架就会中断，如下所示。避免手动检查每个错误或警告的一个解决方法是指示Git commit工作流中的格式化程序就地重新格式化文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/94945f36ce498dd53e97a0869aee0735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*djO8q2ouJIGjipqj471bTQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">薄片8失败</p></figure><p id="1539" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可以通过bash命令<code class="fe mf mg mh mi b">entry</code>来完成，它通过运行钩子来自动提交修改，然后在同一次提交中存放更改的文件。它仅适用于格式化程序<code class="fe mf mg mh mi b">autoflake</code>、<code class="fe mf mg mh mi b">isort</code>和<code class="fe mf mg mh mi b">black</code>，因为它们可以选择就地重新格式化源代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="8627" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，自动提交修改更容易出错，因为格式化程序可能会实现不需要的更改。在这些钩子的末端运行一个测试套件可以确保源代码不会中断。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="74fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面找到更多干净的编码、文档和自动化技巧👇</p><div class="oj ok gp gr ol om"><a href="https://towardsdatascience.com/five-tips-for-automatic-python-documentation-7513825b760e" rel="noopener follow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">自动化Python文档的五个技巧</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">用这五个自动化步骤和预提交Git挂钩在MkDocs &amp; Material中创建漂亮的Python文档</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">towardsdatascience.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa ks om"/></div></div></a></div></div></div>    
</body>
</html>