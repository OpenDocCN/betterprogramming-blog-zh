<html>
<head>
<title>How To Create Your Initial Coin Offering (ICO) Contract in Ethereum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在以太坊创建您的初始硬币发售(ICO)合同</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-your-initial-coin-offering-ico-contract-in-ethereum-5a94ec3e2337?source=collection_archive---------7-----------------------#2022-08-15">https://betterprogramming.pub/create-your-initial-coin-offering-ico-contract-in-ethereum-5a94ec3e2337?source=collection_archive---------7-----------------------#2022-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8a5f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让你的众筹更进一步</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f7f32248483f7a7b481eac34a3366b12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wxJB6plOLjJCWpfKUUzEaw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自Unsplash</p></figure><p id="5021" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">初始硬币发行(ICO)是一种使用加密货币和区块链技术的众筹方法。在ICO中，初创公司向投资者提供代币，以换取法定货币或其他加密货币，如比特币或以太坊。这使得初创公司可以在没有风险资本家、银行或证券交易所等中介机构的情况下获得项目资金。</p><h1 id="b4c9" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">准备就绪</strong></h1><p id="f51a" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">你需要一个可以处理solidity编程的开发环境和一个以太网来部署和测试你的代码。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="0959" class="mw lv it ms b gy mx my l mz na">mkdir ico &amp;&amp; cd ico</span><span id="f28e" class="mw lv it ms b gy nb my l mz na">git clone <a class="ae nc" href="https://github.com/ac12644/ICO-Token.git" rel="noopener ugc nofollow" target="_blank">https://github.com/ac12644/ICO-Token.git</a></span><span id="c9b4" class="mw lv it ms b gy nb my l mz na">npm install</span></pre><ol class=""><li id="6471" class="nd ne it la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">您需要创建一份<code class="fe nm nn no ms b">CrowdSale</code>合同，用于最初的硬币/代币提供流程。确保为算术运算导入SafeMath，如下所示:</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="e689" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.如果您正在向投资者分发代币，那么导入代币契约并创建一个状态变量来跟踪可分发代币契约的地址。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="ba41" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.每次购买售出的代币数量按比率计算；创建一个状态变量来将其存储在契约中。rate参数存储购买者为一个Wei获得的代币数量。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="6a78" class="mw lv it ms b gy mx my l mz na">uint256 public rate;</span></pre><p id="ffdb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.募集的资金要转到项目或公司地址。请在之后保存钱包地址。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="ad38" class="mw lv it ms b gy mx my l mz na">address public wallet;</span></pre><p id="d2c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.要跟踪筹集的资金数量，请使用以下代码创建一个状态变量:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="3cf7" class="mw lv it ms b gy mx my l mz na">uint256 public weiRaised;</span></pre><p id="915b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">6.应该首先初始化rate、wallet和token的值。使用构造函数将确保在协定创建期间进行初始化。确保为每个输入值包含足够的验证。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="1c89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">7.创建一个函数来计算每个输入金额的令牌数，可以允许其他合同使用该功能。这可能是有益的，因为它可以简化其他实体的流程并使其更加高效。下面是实现这一点的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="6ed0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">8.创建一个允许投资者购买代币的功能:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="4a43" class="mw lv it ms b gy mx my l mz na">function buyTokens(address _investor) public payable {<br/>            // ..<br/>}</span></pre><p id="1a1f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">9.包含足够的验证以确保函数的正确输入是很重要的。可以使用<code class="fe nm nn no ms b">require()</code>验证输入的金额和投资者地址:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="5616" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">10.确认成功后，请将该金额添加到所筹集的魏总额中。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="4c9b" class="mw lv it ms b gy mx my l mz na">function buyTokens(address _investor) public payable {<br/>    _preValidatePurchase(_investor, weiAmount);<br/>    weiRaised = weiRaised.add(msg.value);<br/>}</span></pre><p id="9790" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">11.您可以计算可以购买的代币数量，然后通过代币的<code class="fe nm nn no ms b">transfer</code>功能将代币转让给用户，如下图所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="82ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">12.创建一个事件来记录令牌销售流程。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="89b4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">13.完成代币购买后，请将代币转移到您的钱包中妥善保管。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="445b" class="mw lv it ms b gy mx my l mz na">function _forwardFunds() internal {<br/>    wallet.transfer(msg.value);<br/>}</span></pre><p id="b41f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">14.添加一个<code class="fe nm nn no ms b">payable</code>回调函数将提高令牌购买过程的可用性，因为它允许在不需要调用特定函数的情况下接受以太网。代码如下:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="a8c8" class="mw lv it ms b gy mx my l mz na">function () external payable {<br/>    buyTokens(msg.sender);<br/>}</span></pre><p id="cc25" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">15.包含所有这些属性将导致以下结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Crowdsale.sol</p></figure><h1 id="e424" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">向合同中添加额外功能</h1><p id="a4fa" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">众卖合同可以有额外的功能，如销售期限或限制出售的代币数量，这有助于众卖过程的自动化。拥有这些功能有助于确保令牌的有效分发。</p><p id="9146" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们将了解如何限制出售的代币以及出售的时间。通过扩展以前的<code class="fe nm nn no ms b">CrowdSale</code>合同，您将能够添加这些功能。</p><p id="89dd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1.合约可以有一个上限来限制通过众筹筹集的金额。通过创建一个变量来存储上限限制，可以帮助确保众筹成功。方法如下:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="bb45" class="mw lv it ms b gy mx my l mz na">uint256 public cap;</span></pre><p id="b6cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.该值通过构造函数指定。除了rate、wallet和token之外，还包括对构造函数的初始化，如下所示:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="8fea" class="mw lv it ms b gy mx my l mz na">constructor(uint256 _cap, ....)     <br/>    public {    <br/>    // Other validations and assignment     <br/>   <br/>    require(_cap &gt; 0);     <br/>    cap = _cap;<br/>}</span></pre><p id="5b1f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.在令牌购买操作期间，应该添加一个附加条件来验证上限。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="827b" class="mw lv it ms b gy mx my l mz na">function buyTokens(address _investor) public payable {<br/>    require(weiRaised.add(_weiAmount) &lt;= cap);<br/>    //..<br/>}</span></pre><p id="56e0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.创建一个只读函数，用于检查是否达到上限，并返回布尔值true或false。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="c1a4" class="mw lv it ms b gy mx my l mz na">function capReached() public view     <br/>    returns (bool) {     <br/>    return weiRaised &gt;= cap; <br/>}</span></pre><p id="d2a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.类似的程序可以将销售限制在特定的时期。通过创建状态变量来保存开始和结束时间，可以确保使用UNIX时间戳来计算固化时间，如下所示:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="3b0e" class="mw lv it ms b gy mx my l mz na">uint256 public openingTime;<br/>uint256 public closingTime;</span></pre><p id="5eae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">6.使用构造函数初始化持续时间。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="6524" class="mw lv it ms b gy mx my l mz na">constructor(uint256 _openingTime, uint256 _closingTime) public<br/>        {<br/>           require(_openingTime &gt;= block.timestamp);<br/>           require(_closingTime &gt;= _openingTime);</span><span id="5427" class="mw lv it ms b gy nb my l mz na">           openingTime = _openingTime;<br/>           closingTime = _closingTime;<br/>        }</span></pre><p id="33ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">7.请创建一个修改量来验证持续时间。使用此修饰符的功能在一段时间后不能执行。代码如下:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="a062" class="mw lv it ms b gy mx my l mz na">modifier onlyWhileOpen {<br/>     require(block.timestamp &gt;= openingTime<br/>        &amp;&amp; block.timestamp &lt;= closingTime);<br/>     _;<br/>}</span></pre><p id="8318" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">8.您可以在购买代币功能中使用此修饰符，以防止有人在销售期结束或尚未开始时购买代币。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="2926" class="mw lv it ms b gy mx my l mz na">function buyTokens(address _investor) public payable<br/>     onlyWhileOpen {<br/>     //…<br/>}</span></pre><p id="20a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">9.包括只读功能，供任何希望确认销售状态的人使用。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="abab" class="mw lv it ms b gy mx my l mz na">function hasClosed() public view returns (bool) {<br/>    return block.timestamp &gt; closingTime;</span><span id="a700" class="mw lv it ms b gy nb my l mz na">}</span></pre><p id="7f38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">10.该合同将类似于以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h1 id="9d6c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">添加更多限制</h1><p id="1640" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">也可以为每个账户设置一个上限，这给了所有者更多的控制权。为此，您必须创建一个将地址映射到cap的映射。您还必须为贡献创建映射。方法如下:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="158a" class="mw lv it ms b gy mx my l mz na">mapping(address =&gt; uint256) public contributions;<br/>mapping(address =&gt; uint256) public caps;</span></pre><p id="a426" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">检查每个代币购买的个人限额，以防止人们购买太多。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="9629" class="mw lv it ms b gy mx my l mz na">require(contributions[_beneficiary].add(_weiAmount) &lt;=<br/>caps[_beneficiary]);</span></pre><p id="c672" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为个人用户的贡献和上限创建只读方法是必不可少的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="3a9d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为用户限制创建setter函数将更容易为多个地址分配上限:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h1 id="553c" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">将用户列入众卖的白名单</h1><p id="7b19" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">当需要私下销售或增加奖金时，创建白名单合同来跟踪某一组用户。通过限制用户之间的操作，这允许更个性化的方法。</p><p id="1e21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这一部分中，我们将看到如何创建一个白名单函数，它可以与众卖合同一起使用。</p><ol class=""><li id="a867" class="nd ne it la b lb lc le lf lh nf ll ng lp nh lt ni nj nk nl bi translated">应该创建一个映射变量，将地址存储为键，将白名单状态存储为值。通过将映射标记为公共变量，将创建一个getter函数，可用于验证白名单状态，如下所示:</li></ol><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="b272" class="mw lv it ms b gy mx my l mz na">mapping(address =&gt; bool) public whitelist;</span></pre><p id="03c9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.应该使用以下函数将用户添加到白名单合同中，并且应该仅限于所有者或管理员。方法如下:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="5498" class="mw lv it ms b gy mx my l mz na">function addToWhitelist(address _investor) external<br/>    onlyOwner {<br/>      whitelist[_investor] = true;<br/>}</span></pre><p id="7bee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.为了便于加入白名单，您可以使用另一个函数来接受地址数组，如下所示:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="9323" class="mw lv it ms b gy mx my l mz na">function addMultipleToWhitelist(address[] _investors)<br/>            external onlyOwner { <br/>            for (uint256 i = 0; i &lt; _investors.length; i++) {<br/>               whitelist[_investors[i]] = true;<br/>}}</span></pre><p id="7a4c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.如果地址添加错误或者用户不再被邀请使用该功能，创建一个从白名单中删除用户的功能会很有用。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="4390" class="mw lv it ms b gy mx my l mz na">function removeFromWhitelist(address _beneficiary) external<br/>     onlyOwner {<br/>     whitelist[_beneficiary] = false;<br/>}</span></pre><p id="4b69" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.创建一个修饰符来阻止非白名单用户访问这些功能。代码如下:</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="9491" class="mw lv it ms b gy mx my l mz na">modifier isWhitelisted(address _investor) {<br/>    require(whitelist[_investor]);<br/>    _;<br/>}</span></pre><p id="6384" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">6.将修饰符应用于代币购买函数，以便只有白名单中的用户可以通过这个众卖购买代币。最终合同应类似于以下示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">白名单. sol</p></figure></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="d825" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ny">感谢阅读！</em></p><p id="ece5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ny">退房还:</em></p><div class="nz oa gp gr ob oc"><a href="https://medium.com/geekculture/5-key-features-of-a-security-token-you-need-to-know-f7975472f439" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">您需要了解的安全令牌的5个关键特性</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">什么是安全令牌？它们的必要组成部分是什么？</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ks oc"/></div></div></a></div></div></div>    
</body>
</html>