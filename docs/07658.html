<html>
<head>
<title>How Dataclass May Beautify Your Python Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dataclass如何美化您的Python代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/python-elegant-and-concise-models-with-the-dataclasses-3992b5f5a08d?source=collection_archive---------8-----------------------#2021-02-05">https://betterprogramming.pub/python-elegant-and-concise-models-with-the-dataclasses-3992b5f5a08d?source=collection_archive---------8-----------------------#2021-02-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c8d7" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">编程，Python</h2><div class=""/><div class=""><h2 id="5c43" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">弄清楚如何轻松优雅地表示数据结构</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/b67c1194726532257578b124cd973e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W63ISkdztr9wMuvG"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">Julien Moreau 在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a82e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">数据类是Python 3.7 引入的<a class="ae lh" href="https://docs.python.org/3/whatsnew/3.7.html" rel="noopener ugc nofollow" target="_blank">新特性之一。它的目标是简化主要包含数据而没有功能的类的创建。这可以与常用的数据结构相比较。</a></p><p id="fcd2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当使用类作为数据结构时，我们要实现与<code class="fe me mf mg mh b">__init__()</code>和<code class="fe me mf mg mh b">__repr__()</code>相同的方法，比较繁琐。Dataclasses为我们自动生成这些方法。这在语言中提供了更多的透明度。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="8ef9" class="mp mq it bd mr ms mt mu mv mw mx my mz ki na kj nb kl nc km nd ko ne kp nf ng bi translated"><strong class="ak">沉浸在数据类中</strong></h1><h2 id="3c9e" class="nh mq it bd mr ni nj dn mv nk nl dp mz lr nm nn nb lv no np nd lz nq nr nf iz bi translated">申报</h2><p id="720c" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">数据类的声明是通过影响一个类的装饰器来完成的。在下面的示例中，我们将创建一个数据类来表示GPS坐标:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="1a85" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以直接打印<code class="fe me mf mg mh b">Position</code>对象，而无需定义<code class="fe me mf mg mh b">__repr__()</code>函数:</p><pre class="ks kt ku kv gt nz mh oa ob aw oc bi"><span id="5112" class="nh mq it mh b gy od oe l of og">$ python dataclass_ex1.py<br/>Position(lat=37.6216, lon=-122.3929)</span></pre><p id="3cad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以用等号运算符比较<code class="fe me mf mg mh b">dataclass</code>对象，而不必实现额外的<code class="fe me mf mg mh b">__eq__</code>方法:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><pre class="ks kt ku kv gt nz mh oa ob aw oc bi"><span id="1ee5" class="nh mq it mh b gy od oe l of og">$ python dataclass_ex2.py<br/>True</span></pre><h2 id="136f" class="nh mq it bd mr ni nj dn mv nk nl dp mz lr nm nn nb lv no np nd lz nq nr nf iz bi translated">方法</h2><p id="78f4" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">你可以在一个<code class="fe me mf mg mh b">dataclass</code>里面添加方法。我们将实现一种方法来计算两个位置之间以千米为单位的哈弗线距离:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><pre class="ks kt ku kv gt nz mh oa ob aw oc bi"><span id="87d1" class="nh mq it mh b gy od oe l of og">$ python dataclass_ex3.py<br/>15479.614752629424</span></pre><h2 id="11b0" class="nh mq it bd mr ni nj dn mv nk nl dp mz lr nm nn nb lv no np nd lz nq nr nf iz bi translated">作为方法属性的数据类对象</h2><p id="bab7" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated"><code class="fe me mf mg mh b">dataclass</code>对象被认为是任何其他的Python类型。我们实现另一个类来实例化<code class="fe me mf mg mh b">Town</code>对象。基本上，<code class="fe me mf mg mh b">Town</code>对象会有一个位置属性:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="3a44" class="nh mq it bd mr ni nj dn mv nk nl dp mz lr nm nn nb lv no np nd lz nq nr nf iz bi translated">遗产</h2><p id="3a1c" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated"><code class="fe me mf mg mh b">dataclass</code>也支持继承。上一节介绍的<code class="fe me mf mg mh b">Town</code>类可以简化。我们将考虑一个城镇作为位置。<code class="fe me mf mg mh b">Town</code>对象将继承经纬度属性:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="75c3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了更进一步，我们添加了一个新的类来区分城镇中的首都:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="551e" class="nh mq it bd mr ni nj dn mv nk nl dp mz lr nm nn nb lv no np nd lz nq nr nf iz bi translated">菲尔茨</h2><p id="6960" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">数据类可以使用<code class="fe me mf mg mh b">field()</code>说明符单独定制每个字段。该字段支持许多不同的<a class="ae lh" href="https://docs.python.org/3/library/dataclasses.html#dataclasses.field" rel="noopener ugc nofollow" target="_blank">参数</a>。我们将使用其中一些来定义经度和纬度的字段和元数据的默认值:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="3f4c" class="nh mq it bd mr ni nj dn mv nk nl dp mz lr nm nn nb lv no np nd lz nq nr nf iz bi translated">不变</h2><p id="a827" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated"><code class="fe me mf mg mh b">dataclass</code>提供不变性选项设置<code class="fe me mf mg mh b">frozen=True</code>。启用后，<code class="fe me mf mg mh b">dataclass</code>字段可能永远不会改变。小心嵌套的<code class="fe me mf mg mh b">dataclass</code>，它包含使用继承的不可变字段。</p><p id="88fa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将添加一个新的<code class="fe me mf mg mh b">Country</code>类来收集一个国家的不同城镇(包括首都)。在这个类中，有一个函数<code class="fe me mf mg mh b">get_capital</code>从城镇列表中过滤出首都数据:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="2ba2" class="mp mq it bd mr ms mt mu mv mw mx my mz ki na kj nb kl nc km nd ko ne kp nf ng bi translated">结论</h1><p id="9f4f" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">我们已经看到，通过使用<code class="fe me mf mg mh b">dataclass</code>，<strong class="lk jd"> y </strong>你不需要在每次写类的时候都写重复的方法。这些方法已经实现并且完全透明。您可以隐式定义它们来覆盖默认行为。</p><p id="0184" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，我们已经意识到<strong class="lk jd"> </strong> <code class="fe me mf mg mh b">dataclass</code>实际上类似于一个经典类，并且支持继承。您也可以从现有的<code class="fe me mf mg mh b">dataclass</code>中定义类属性。最后，如果您认为不可变对象适合您的关注点，您可以定义不可变对象。</p><p id="1466" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">通过例子，我们可以断言<code class="fe me mf mg mh b">dataclass</code>是创建综合数据模型的一个优雅的解决方案。</p><p id="b913" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">自从我发现了这个特性，我就尽可能地使用它来编写优秀的可读代码！你呢？</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="61a8" class="mp mq it bd mr ms mt mu mv mw mx my mz ki na kj nb kl nc km nd ko ne kp nf ng bi translated">资源</h1><div class="oh oi gp gr oj ok"><a href="https://www.python.org/dev/peps/pep-0557/" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd jd gy z fp op fr fs oq fu fw jc bi translated">PEP 557 —数据类别</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">这个PEP描述了一个叫做数据类的标准库的附加物。虽然他们使用非常不同的…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">www.python.org</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy lb ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a href="https://docs.python.org/3/library/dataclasses.html" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd jd gy z fp op fr fs oq fu fw jc bi translated">数据类-数据类-Python 3 . 9 . 1文档</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">这个模块提供了一个装饰器和函数，用于自动添加生成的特殊方法，比如和…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">docs.python.org</p></div></div></div></a></div></div></div>    
</body>
</html>