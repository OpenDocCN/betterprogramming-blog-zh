<html>
<head>
<title>WWDC22: Enabling Live Text Interactions With Images in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WWDC22:在SwiftUI中启用与图像的实时文本交互</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/enabling-live-text-interactions-with-images-in-swiftui-5dd1d7f1676?source=collection_archive---------5-----------------------#2022-06-10">https://betterprogramming.pub/enabling-live-text-interactions-with-images-in-swiftui-5dd1d7f1676?source=collection_archive---------5-----------------------#2022-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a07c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从图像片段、屏幕截图等中提取文本</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/112d3eccc408c34ec2a9bbcbee1ec22a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9hPR_ycnNHu-Vpvd"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@coffeefyworkafe?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">coffeify work AFE</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="fd98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">WWDC22带来了许多更新，使开发人员能够创造有史以来最棒的用户体验。现在，实现与图像的实时文本交互比以往任何时候都更容易。只需几行代码，您就可以帮助用户识别图像中的文本或机器可读代码，用户可以轻松地复制或共享这些结果。</p><p id="cb95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将分享我在SwiftUI项目中嵌入Live Text函数的经验。下图是今天的项目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/b34a58e5aa6912460245842212953105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBYupxZemxYFm01Mv2LJ-A.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们将在本文中创建的项目</p></figure><h1 id="8c99" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">构建主视图</h1><p id="43f0" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">创建一个新的Xcode项目，我们现在将关注于<code class="fe mq mr ms mt b">ContentView.swift</code>文件。下面的代码和我上一篇文章放的代码差不多:<a class="ae kv" href="https://medium.com/better-programming/scanning-data-with-the-camera-in-swiftui-491741e36f69" rel="noopener">iOS 16中的Live Text API——swift ui中的摄像头扫描数据</a>。我假设你有SwiftUI的基础知识，如果没有请查看苹果官方文档:<a class="ae kv" href="https://developer.apple.com/tutorials/swiftui" rel="noopener ugc nofollow" target="_blank">swift ui介绍</a>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="295a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码生成一个只包含一个<code class="fe mq mr ms mt b">Button</code>视图的视图，它的功能是呈现动态文本视图，让用户对检测到的文本或机器可读代码进行复制或其他操作。然而，据苹果公司称，并非所有设备都具备实时文本功能:</p><blockquote class="mw mx my"><p id="df5c" class="kw kx mz ky b kz la jr lb lc ld ju le na lg lh li nb lk ll lm nc lo lp lq lr ij bi translated">对于iOS应用程序，Live Text只能在装有A12 Bionic芯片和更高版本的设备上使用。</p></blockquote><p id="eff3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">幸运的是，苹果为我们提供了一个新的API来检查设备是否支持实时文本。如果设备不支持实时文本，当试图点击按钮以显示实时文本视图时，应用程序将显示一个警告，说明设备不支持实时文本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/ebb495c5e2f8aa7df5349e660fa7dc97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*9D03J3Lys0ykNfQf5ewR2A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">说明设备不支持实时文本的警报。</p></figure><h1 id="4fae" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">构建动态文本视图</h1><p id="9cf3" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">实时文本视图包含对图像中出现的文本和QR码执行操作所需的所有功能。</p><p id="72ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个名为<code class="fe mq mr ms mt b">LiveTextInteractionView.swift</code>的新SwiftUI文件，并将以下代码添加到文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="a3a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于我们还没有创建我们的实时文本视图，我将把文本视图放在这里。</p><h1 id="edcf" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">检查设备是否支持实时文本</h1><p id="1832" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在应用程序中显示实时文本界面之前，请检查设备是否支持实时文本。如果<code class="fe mq mr ms mt b">ImageAnalyzer</code> <code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalyzer/3974561-issupported" rel="noopener ugc nofollow" target="_blank">isSupported</a></code>属性为<code class="fe mq mr ms mt b">true</code>，则显示文字直播界面。</p><p id="f092" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的<code class="fe mq mr ms mt b">ContentView</code>中，在您的<code class="fe mq mr ms mt b">onAppear</code>代码中添加以下检查语句:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="f2c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将使您的应用程序能够在启动后立即检查设备是否支持实时文本。</p><h1 id="bf9d" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">在iOS中将实时文本交互对象添加到您的视图</h1><p id="4552" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">本文仅包含如何在iOS或iPadOS应用程序内部实现Live Text API的说明，因此我不会分析macOS中的API。</p><p id="f7b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了在SwiftUI视图中嵌入一个<code class="fe mq mr ms mt b">UIView</code>，我们需要<code class="fe mq mr ms mt b">UIViewRepresentable</code>来帮助我们。</p><p id="0348" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个名为<code class="fe mq mr ms mt b">LiveTextInteraction.swift</code>的新swift文件，并添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="51ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b">imageName</code>这里是一个字符串类型的值，所以你最好准备一个图像，添加到<code class="fe mq mr ms mt b">Assets</code>。我把这张图片命名为<code class="fe mq mr ms mt b">1.png</code>。</p><p id="92bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b">imageView</code>是从<code class="fe mq mr ms mt b">UIImageView</code>继承的<code class="fe mq mr ms mt b">LiveTextImageView</code>类型值。<code class="fe mq mr ms mt b">LiveTextImageView</code>仅用于在SwiftUI视图中嵌入<code class="fe mq mr ms mt b">UIImageView</code>时调整图像大小。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="b4c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于iOS应用程序，您可以通过将交互对象添加到包含图像的视图来添加实时文本界面。向视图的交互中添加一个<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalysisinteraction" rel="noopener ugc nofollow" target="_blank">ImageAnalysisInteraction</a></code>对象。</p><h1 id="77ed" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">查找项目并开始与图像互动</h1><p id="519c" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><code class="fe mq mr ms mt b">ImageAnalyzer.Configuration</code>对象用于指定我们要查找的图像中的项目类型。在这种情况下，我只关心文本类型的项目。<code class="fe mq mr ms mt b">ImageAnalyzer.Configuration</code>对象的初始化很简单:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="5bb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我们希望我们的应用程序支持实时文本，并在实时文本视图出现时立即获得检测结果，所以我们需要在<code class="fe mq mr ms mt b">updateUIView</code>函数中添加上面的代码。更何况，正如<a class="ae kv" href="https://developer.apple.com/documentation/visionkit/enabling_live_text_interactions_with_images" rel="noopener ugc nofollow" target="_blank">苹果官方文件</a>中提到的:</p><blockquote class="mw mx my"><p id="4cd8" class="kw kx mz ky b kz la jr lb lc ld ju le na lg lh li nb lk ll lm nc lo lp lq lr ij bi translated">本文中的代码清单使用了异步方法，您可以从一个异步方法或在一个<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/swift/task" rel="noopener ugc nofollow" target="_blank">Task</a></code>结构中调用这些方法。有关异步流的详细信息，请参见<a class="ae kv" href="https://developer.apple.com/documentation/swift/concurrency" rel="noopener ugc nofollow" target="_blank">并发</a>。</p></blockquote><p id="500e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以在我们添加<code class="fe mq mr ms mt b">updateUIView</code>函数内部的代码之前，我们需要添加<strong class="ky ir">任务</strong>关键字。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="53a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后通过向一个<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalyzer" rel="noopener ugc nofollow" target="_blank">ImageAnalyzer</a></code>对象发送<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalyzer/3974554-analyze" rel="noopener ugc nofollow" target="_blank">analyze(_:configuration:)</a></code>来分析图像，传递图像和配置。为了提高性能，在整个应用程序中使用分析器的单个共享实例。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="f436" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我们检查图像是否是<code class="fe mq mr ms mt b">nil</code>。如果图像存在，则使用<code class="fe mq mr ms mt b">analyzer</code>对图像进行处理。<code class="fe mq mr ms mt b">Analyzer</code>是在<code class="fe mq mr ms mt b">LiveTextInteraction</code>中初始化的<code class="fe mq mr ms mt b">ImageAnalyzer</code>对象:</p><pre class="kg kh ki kj gt ne mt nf ng aw nh bi"><span id="e386" class="ni lu iq mt b gy nj nk l nl nm"><strong class="mt ir">let</strong> analyzer = ImageAnalyzer()</span></pre><p id="1cd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于iOS应用程序，通过将<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalysisinteraction" rel="noopener ugc nofollow" target="_blank">ImageAnalysisInteraction</a></code>对象的<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalysisinteraction/3974474-analysis" rel="noopener ugc nofollow" target="_blank">analysis</a></code>属性设置为analyze方法的结果来启动实时文本界面。例如，在启动实时文本的控件的action方法中设置<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalysisinteraction/3974474-analysis" rel="noopener ugc nofollow" target="_blank">analysis</a></code>属性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="83f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，当我们单击并按住图像中的项目时，会出现标准的动态文本菜单。</p><h1 id="a729" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">使用交互类型自定义界面</h1><p id="44f3" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">您可以通过启用与图像中项目的交互类型来更改界面的行为。如果将交互或覆盖视图<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalysisinteraction/3974487-preferredinteractiontypes" rel="noopener ugc nofollow" target="_blank">preferredInteractionTypes</a></code>属性设置为<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalysisinteraction/interactiontypes/3974430-automatic" rel="noopener ugc nofollow" target="_blank">automatic</a></code>，用户可以与分析器在图像中找到的所有类型的项目进行交互。对于文本项，我将<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalysisinteraction/3974487-preferredinteractiontypes" rel="noopener ugc nofollow" target="_blank">preferredInteractionTypes</a></code>改为<code class="fe mq mr ms mt b">textSelection</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="ffb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过将<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalysisinteraction/3974487-preferredinteractiontypes" rel="noopener ugc nofollow" target="_blank">preferredInteractionTypes</a></code>属性设置为<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/visionkit/imageanalysisinteraction/interactiontypes/3974467-textselection" rel="noopener ugc nofollow" target="_blank">textSelection</a></code>，我们可以选择图像中的文本，然后执行一个基本的文本操作，比如复制、翻译或共享文本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/75bc8a164bb2b337db10979a3a5079d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S7Rl3dILueQmXJR8FeKOow.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择图像中的文本</p></figure><p id="7def" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在运行这个项目，并享受自己。</p><h1 id="b979" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">源代码</h1><p id="cc06" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">你可以在<a class="ae kv" href="https://github.com/HuangRunHua/LiveTextWithImage" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到源代码。</p><h1 id="a309" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">支持我</h1><p id="a1f3" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果你认为这篇文章有帮助，你可以在<a class="ae kv" href="https://apps.apple.com/us/app/filerapp/id1626627609?mt=12&amp;itsct=apps_box_link&amp;itscg=30200" rel="noopener ugc nofollow" target="_blank"> Mac应用商店</a>上下载我的第一个Mac应用，名为<a class="ae kv" href="https://huangrunhua.github.io/FilerApp/" rel="noopener ugc nofollow" target="_blank"> FilerApp </a>。FilerApp是一个用于Mac的Finder扩展，它使您能够在系统的任何地方轻松创建支持格式的文件。它是免费的，对许多人来说是有用的。希望你喜欢。</p></div></div>    
</body>
</html>