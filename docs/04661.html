<html>
<head>
<title>Scoping in JavaScript For Loops</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript For循环中的作用域</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/scoping-in-javascript-for-loops-c5ffac6aa92b?source=collection_archive---------7-----------------------#2020-04-28">https://betterprogramming.pub/scoping-in-javascript-for-loops-c5ffac6aa92b?source=collection_archive---------7-----------------------#2020-04-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5873" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让vs. var进入你的循环</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ba4e3ffb24b2bdd00ef9f491c145b14d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q2uOCGa0TdNeHhwY"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">米卡·科尔霍宁在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="cc67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我偶然发现了两个代码片段，这让我想到了for循环中的作用域和一个可能的误解。第一个看起来如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="4f18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以不时看到它来演示事件循环，闭包的概念，或者作为一个面试问题。该代码的输出是:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="f7a8" class="mc md it ly b gy me mf l mg mh">3<br/>3<br/>3</span></pre><p id="2632" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">变量<code class="fe mi mj mk ly b">i</code>在调用<code class="fe mi mj mk ly b">console.log()</code>的匿名函数的闭包中被捕获，并通过<code class="fe mi mj mk ly b">setTimeout()</code>被异步调用。因此调用被添加到事件循环中，在调用时，捕获的变量<code class="fe mi mj mk ly b">i</code>已经增加到3。</p><p id="c085" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，一切顺利。但是下面的代码呢？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="b3df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出是:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="b40d" class="mc md it ly b gy me mf l mg mh">0<br/>1<br/>2</span></pre><p id="f228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么<code class="fe mi mj mk ly b">let</code>在这里改变了什么呢？您可能有理由认为这与作用域有关。我们知道由于JavaScript中的提升，<code class="fe mi mj mk ly b">var</code>关键字只支持函数作用域。<code class="fe mi mj mk ly b">let</code>另一方面，允许块范围的变量。但是<code class="fe mi mj mk ly b">for</code>循环的作用域究竟是如何工作的呢？</p><p id="5d6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个常见的误解是该循环有一个作用域，因此它等同于下面的<code class="fe mi mj mk ly b">while</code>循环:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="c268" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意循环周围立即调用的函数表达式(IIFE ),它覆盖了整个循环。然而，上面的<code class="fe mi mj mk ly b">while</code>循环仍然会给出一个<code class="fe mi mj mk ly b">3 3 3</code>的输出，所以之前显示的<code class="fe mi mj mk ly b">for</code>循环不能等同于它。原因是<code class="fe mi mj mk ly b">for</code>循环对于每次迭代都有自己的作用域。如果我们使用Babel将<code class="fe mi mj mk ly b">for</code>循环(使用<code class="fe mi mj mk ly b">let</code>)从上向下传输到ES5，我们可以通过查看生成的代码很好地看到这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="614b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第8行中，我们可以看到每个循环迭代都是通过调用一个带有循环变量<code class="fe mi mj mk ly b">i</code>的函数来表示的。因此<code class="fe mi mj mk ly b">i</code>的一个副本在<code class="fe mi mj mk ly b">_loop()</code>的功能范围内，这意味着它不会受到第7行原<code class="fe mi mj mk ly b">i</code>的后续更改的影响。</p><p id="9576" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望我能给你一些见解，对你的面试、日常工作或者只是娱乐有用。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="df4d" class="ms md it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">参考</h1><ul class=""><li id="9b52" class="nj nk it lb b lc nl lf nm li nn lm no lq np lu nq nr ns nt bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for" rel="noopener ugc nofollow" target="_blank"> MDN Web文档:用于语句</a></li></ul></div></div>    
</body>
</html>