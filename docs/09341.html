<html>
<head>
<title>How to Handle Data Locally in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Flutter中本地处理数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-handle-data-locally-in-flutter-79506abc07c9?source=collection_archive---------0-----------------------#2021-08-12">https://betterprogramming.pub/how-to-handle-data-locally-in-flutter-79506abc07c9?source=collection_archive---------0-----------------------#2021-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5bc2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何在Flutter中本地存储数据和管理嵌套数据模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3b20d6ab8ccb3f9cb0a404637a9d25d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aY89jvsSo9BO2RqY"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@nordwood?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">诺德伍德主题</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0fe6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不需要在应用程序中存储某种数据的情况很少见。Flutter提供了多种方法来实现这一点。</p><p id="78d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于一些应用程序，我们只需要存储一些键值对，这可以使用<code class="fe lv lw lx ly b"><a class="ae ky" href="https://pub.dev/packages/shared_preferences" rel="noopener ugc nofollow" target="_blank">shared_preferences</a></code>包来完成。对于其他一些app，我们可能需要存储和查询大量的数据。</p><p id="0290" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们可以通过<code class="fe lv lw lx ly b">pub.dev</code>上的<code class="fe lv lw lx ly b"><a class="ae ky" href="https://pub.dev/packages/sqflite" rel="noopener ugc nofollow" target="_blank">sqflite</a></code>插件使用SQLite数据库。另一种保存数据的方法是读写光盘上的文件。</p><p id="01ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文专门讨论在文件中存储数据。菜谱还将处理存储嵌套数据模型的情况，这使用<code class="fe lv lw lx ly b">sqflite</code>插件不容易实现。</p><p id="8210" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这本食谱将带你完成以下步骤:</p><ol class=""><li id="5e48" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">添加所需的依赖项。</li><li id="2677" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">创建<code class="fe lv lw lx ly b">FileHandler</code>类。</li><li id="3a38" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">找到正确的本地路径，并创建对文件位置的引用。</li><li id="2d0d" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">实现读取、写入、更新和删除方法。</li></ol><p id="41b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是将用于此示例的嵌套的<em class="mn"> </em> <code class="fe lv lw lx ly b">User</code> <em class="mn"> </em>数据模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="29d1" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">添加所需的依赖项</h1><p id="d503" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在您的<code class="fe lv lw lx ly b">pubspec.yaml</code>文件中添加<code class="fe lv lw lx ly b">path_provider</code>依赖项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="e337" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">创建<code class="fe lv lw lx ly b">FileHandler</code>类</h1><p id="281d" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们需要创建一个单例类，因为我们在整个应用程序中只需要该类的一个实例。现在让我们找到本地路径并创建一个对文件的引用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="20fa" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">找到正确的本地路径并创建对文件位置的引用</h1><p id="1533" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated"><code class="fe lv lw lx ly b">path_provider</code>插件提供了一种平台无关的方式来访问设备文件系统中常用的位置。该插件目前支持对两个文件系统位置的访问:</p><ul class=""><li id="fe7f" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu nn mf mg mh bi translated">临时目录:系统可以随时清除的临时目录(缓存)。</li><li id="f8f8" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu nn mf mg mh bi translated">文档目录:存储只有应用程序才能访问的文件的位置。只有在删除应用程序时，系统才会清除目录。</li></ul><p id="5641" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了持久化数据，我们将文件存储在documents目录中，并创建对它的引用。您可以使用<code class="fe lv lw lx ly b">dart:io</code>库来实现这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="a014" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">实现读取、写入、更新和删除方法</h1><p id="787a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">为了将数据模型读写到文件中，您需要使用<code class="fe lv lw lx ly b">dart:convert</code>库中可用的<code class="fe lv lw lx ly b">jsonEncode()</code>方法对数据进行编码。这将给定的对象转换为字符串。然后，为了读取文件，您可以使用<code class="fe lv lw lx ly b">jsonDecode()</code>方法将字符串转换为JSON对象。然后，您可以轻松地从地图中检索该对象。</p><p id="7fde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将数据写入文件，需要维护一个<code class="fe lv lw lx ly b">Users</code>的<code class="fe lv lw lx ly b">Set</code>。当添加一个新的<code class="fe lv lw lx ly b">User</code>时，首先将其添加到这个<code class="fe lv lw lx ly b">Set</code>中，然后使用它写入文件。使用<code class="fe lv lw lx ly b">Set</code>确保一个元素在文件中只添加一次。此外，您需要用<code class="fe lv lw lx ly b"><a class="ae ky" href="https://pub.dev/packages/equatable" rel="noopener ugc nofollow" target="_blank">equatable</a></code>包中可用的<code class="fe lv lw lx ly b">Equatable</code>类来扩展您的类，以便比较<code class="fe lv lw lx ly b">User</code>类的实例。<code class="fe lv lw lx ly b">Equatable</code>有助于实现基于值的对象比较，而无需显式覆盖<code class="fe lv lw lx ly b">==</code>和<code class="fe lv lw lx ly b">hashcode</code>。你可以查看<a class="ae ky" href="https://medium.com/flutter-community/what-is-equatable-package-in-dart-and-flutter-81bbb62e73b9" rel="noopener">这篇</a>文章，了解更多关于<code class="fe lv lw lx ly b">Equatable</code>的内容。</p><p id="5d3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还需要为类实现<code class="fe lv lw lx ly b">toJson()</code>和<code class="fe lv lw lx ly b">fromJson()</code>方法，以便在类对象和JSON映射之间进行转换。查看来自Flutter docs的这个页面，了解更多关于JSON序列化的信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="05e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在要读取文件，使用<code class="fe lv lw lx ly b">readAsString()</code>方法，然后使用<code class="fe lv lw lx ly b">jsonDecode()</code>方法将字符串转换成一个JSON对象(这里是一个<code class="fe lv lw lx ly b">Map&lt;String, dynamic&gt;</code>列表)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="3add" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">类似地，实现<code class="fe lv lw lx ly b">update()</code>和<code class="fe lv lw lx ly b">delete()</code>方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="ea00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在一切都设置好了，只需使用<code class="fe lv lw lx ly b">FileHandler.instance</code>创建一个<code class="fe lv lw lx ly b">FileHandler</code>类的实例，并使用这些方法来读写文件中的数据。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h1 id="b6f7" class="mq mr it bd ms mt nv mv mw mx nw mz na jz nx ka nc kc ny kd ne kf nz kg ng nh bi translated">结论</h1><p id="1f85" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">是的，在Flutter中通过读写一个文件来处理本地数据就是这么简单！</p><p id="ff72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Flutter中有很多本地持久化数据的方法。使用的方法取决于数据的类型和比例。就嵌套数据模型(如上所述)而言，存储此类数据的最简单方法是将其存储在文件中。</p><p id="cc8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，仍然可以有一些更好的方法，请留下评论或联系我<a class="ae ky" href="mailto:bharat.sharma1809@gmail.com" rel="noopener ugc nofollow" target="_blank">这里</a>如果你知道一个！。</p><p id="5a93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看由Flutter团队编写的关于处理数据的<a class="ae ky" href="https://flutter.dev/docs/cookbook/persistence/sqlite" rel="noopener ugc nofollow" target="_blank">用SQLite </a>持久化数据和<a class="ae ky" href="https://flutter.dev/docs/cookbook/persistence/key-value" rel="noopener ugc nofollow" target="_blank">将键值数据存储在光盘上</a>食谱，了解更多关于其他方法的信息。</p><p id="e593" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述项目的回购可以在<a class="ae ky" href="https://github.com/bharat-1809/data_persistence_flutter" rel="noopener ugc nofollow" target="_blank">这里</a>找到。您还可以查看<code class="fe lv lw lx ly b">database_handler.dart</code>文件中的<code class="fe lv lw lx ly b">DatabaseHandler</code>类，看看如何用SQLite持久化数据。</p><p id="063b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，伙计们！感谢阅读。你可以在推特上找到我。</p></div></div>    
</body>
</html>