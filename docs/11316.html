<html>
<head>
<title>Build Your Own E-Commerce Keystone.js-Based System — Requirements and Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您自己的基于Keystone.js的电子商务系统——需求和架构</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-your-own-e-commerce-keystone-js-based-system-requirements-and-architecture-3d639241b963?source=collection_archive---------11-----------------------#2022-03-08">https://betterprogramming.pub/build-your-own-e-commerce-keystone-js-based-system-requirements-and-architecture-3d639241b963?source=collection_archive---------11-----------------------#2022-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2951" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们的电子商务系统的基本概述</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/61af706891345c395cb97af698d3a6fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XabqiEWy222pPfIQx0QI2w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·温克勒在<a class="ae kv" href="https://unsplash.com/s/photos/commerce?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="825b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="4520" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">不久前，我还在开发一个基于<a class="ae kv" href="https://keystonejs.com/" rel="noopener ugc nofollow" target="_blank"> Keystone.js </a> CMS的系统。但在那里，它的使用方式要复杂得多，不仅仅是作为基本的无头CMS。我可以轻松地用搜索引擎(基于Rust的<a class="ae kv" href="https://www.meilisearch.com/" rel="noopener ugc nofollow" target="_blank"> Meilisearch </a>)扩展它，并连接到外部API。</p><p id="98b2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在那之后，我有了几个可以用Keystone.js构建项目的想法，其中一个是电子商务系统。这个想法太吸引人了，所以我决定试一试，真的造出来。这篇文章是关于这个主题的系列文章的第一篇。</p><p id="ba25" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">经过简短的研究，我发现了一个类似的项目，但它使用的是Keystone.js的以前版本(<a class="ae kv" href="https://github.com/sophiabrandt/nextjs-ecommerce" rel="noopener ugc nofollow" target="_blank"> details </a>)。这个项目很棒，但是有些事情我相信我会以不同的方式去做。</p><p id="3d4d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">首先，它使用MongoDB，我不太确定这是电子商务的最佳解决方案(我也是一个SQL人)。此外，从我的角度来看，一些功能缺失，如交付处理等。</p><p id="b8bb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">另一个类似的项目来自另一个node . js headless CMS—<a class="ae kv" href="https://strapi.io/" rel="noopener ugc nofollow" target="_blank">Strapi</a>。但它是一个相当简化的教程类型(<a class="ae kv" href="https://strapi.io/blog/how-to-build-an-e-commerce-store-with-nuxt-js-and-strapi" rel="noopener ugc nofollow" target="_blank">细节</a>)，而且使用<a class="ae kv" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> Nuxtjs </a>。这不是我喜欢的；我是一个反应型的人。</p><p id="6d75" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在我的职业生涯中，我在一个相当大的电子商务系统上工作了几年，所以我相信我对它应该是什么样子(以及不应该是什么样子)有一些想法。这里先说我们的目标。</p><h1 id="b998" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">目标</h1><p id="f169" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">好吧，但是这个电子商务系统应该是什么样的呢？首先，可伸缩性不是我在这里主要关心的，所以我不会太关注它。当然，我会打开一些门，允许一些基本的扩展，但仅此而已。</p><p id="f0b2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这样一来，让我们假设我们的系统将使用三层方法来构建。第一层是面向用户的表示层，第二层是业务/逻辑层，最后一层是数据层。</p><h2 id="e186" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">表示层</h2><p id="9324" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">包含应用程序的前端部分，这应该允许用户浏览产品目录。他们还可以按类别过滤、搜索、添加到购物车中，并通过支付和交付处理完成订单。</p><p id="ff6b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，它应该允许用户查看订单的状态和历史。</p><h2 id="1f14" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">逻辑层</h2><p id="f67a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">下一层包含系统的所有后端流程:处理产品、库存、订单处理、支付和交付集成。</p><p id="1d4f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，带有访问控制的用户授权和认证在这里也至关重要。基本上，它的目标是转换和处理来自表示层或数据层的数据，并进一步双向传递。</p><h2 id="55e3" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">数据层</h2><p id="5175" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">最后一层负责数据存储及其持久性。基本上就是我们系统的数据库。其目标是维护数据可用性和一致性，并确保我们遵循ACID原则。</p><p id="5f68" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">所以基本上，我要创建一个包含所有这些层的电子商务系统。总而言之，这个系统应该包括:</p><ul class=""><li id="297a" class="nb nc iq lq b lr mk lu ml lx nd mb ne mf nf mj ng nh ni nj bi translated">允许用户浏览产品和处理订单的前端层</li><li id="97a8" class="nb nc iq lq b lr nk lu nl lx nm mb nn mf no mj ng nh ni nj bi translated">负责处理数据并允许您管理订单、产品等的逻辑层</li><li id="d9c9" class="nb nc iq lq b lr nk lu nl lx nm mb nn mf no mj ng nh ni nj bi translated">数据层以ACID方式保存所有必需的数据</li></ul></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><p id="105f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我认为有必要澄清一下。这个三层模型与软件架构无关。我们仍然可以使用它来创建微服务架构，并且我们可以坚持旧的但却是黄金的整体模型。</p><p id="fc4e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我在这里的主要目标是练习设计和实现一个工作系统的技巧(并写下来)，而不是卷入一种方法优于另一种方法的理论讨论。</p><h1 id="62d6" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">系统元素</h1><p id="f6cc" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在是时候讨论构建每个独立层的所有元素以及它们之间的联系了。虽然我将在本文中对每一层进行简要的分析和描述，但我将主要关注逻辑层。</p><h2 id="cb65" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">表示层元素</h2><p id="c88f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">前端层将由三个主要元素构建而成:主应用程序、本例中的Next.js应用程序以及CDN服务和Nginx web服务器。</p><p id="7f6c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这是一个相当简单的解决方案:在Next.js的服务器站点渲染的帮助下，React中内置的主应用程序创建了一种具有单页面应用程序交互性的最佳点——并具有所有的SEO优势和来自服务器端渲染的更快的初始加载。</p><p id="a77d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">CDN在这里的作用是帮助提供静态文件，主要是图像。Nginx就像一个反向代理和负载平衡器。没什么太复杂的。与逻辑层的所有通信都通过GraphQL进行。</p><h2 id="6c4e" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">逻辑层元素</h2><p id="44f7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这个主层基本上只包含两个元素:作为主处理的Keystone.js应用程序，以及命令单元和GraphQL解析器，它们充当内置元素的扩展，并作为底层搜索引擎的文本搜索功能的包装器。</p><p id="8e2d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但这种说法是一种巨大的简化，让我们进入细节。</p><p id="6aae" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Keystone管理整个系统的三个基本模型:<code class="fe nw nx ny nz b">User</code>、<code class="fe nw nx ny nz b">Product</code>和<code class="fe nw nx ny nz b">Order</code>。</p><p id="b464" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">其余的模型可以直接或间接地从它们中导出。首先，<code class="fe nw nx ny nz b">User</code>保存了我们电子商务系统的客户和员工的基本信息，主要是授权信息和分配的角色。</p><p id="3938" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">另外<code class="fe nw nx ny nz b">User</code>有一个<code class="fe nw nx ny nz b">Cart</code>并且可以有多个<code class="fe nw nx ny nz b">Order</code>型号和多个<code class="fe nw nx ny nz b">Address</code>型号。每个<code class="fe nw nx ny nz b">Order</code>模型有一个连接的<code class="fe nw nx ny nz b">Payment</code>和<code class="fe nw nx ny nz b">Shipment</code>并容纳多个<code class="fe nw nx ny nz b">Product</code>模型。</p><p id="3376" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><code class="fe nw nx ny nz b">Product</code>有一个<code class="fe nw nx ny nz b">Stock</code>模型(为了简单起见，我们假设不使用多仓库设置)和多个<code class="fe nw nx ny nz b">ProductImage</code>模型。</p><p id="1008" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，它连接到多个<code class="fe nw nx ny nz b">Category</code>模型，每个模型都可以关联到父<code class="fe nw nx ny nz b">Category</code>生成树。</p><p id="994b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">看起来很复杂，其实(目前)还不是。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/0c64a8306f41a579d5d4b6a5b04655a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*TnTONR0pbnAXkqDZsQmZNA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">基本模型结构</p></figure><p id="2a5b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，Keystone的作用是管理主前端应用程序的基本页面的内容。但更重要的是，它的作用也是管理副作用和外部集成。</p><p id="aaec" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这种副作用的一个例子可能是与订单处理步骤相关的电子邮件通知，以及通知客户相关信息，或者在发生变化后在搜索引擎中索引产品数据。</p><p id="9865" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">另一方面，外部集成的示例包含Stripe的使用，以便处理支付或连接到处理交付的外部API(例如，<a class="ae kv" href="https://developer.dhl.com/" rel="noopener ugc nofollow" target="_blank"> DHL API </a>)。</p><p id="98c6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这些功能将主要利用Keystone模式中钩子的能力。不仅如此，我们还需要创建额外的rest端点作为webhooks，以便处理来自这些集成的异步响应。</p><p id="bc5d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，Keystone admin UI在这里充当一种仪表板，供员工管理和处理订单。</p><h2 id="6e52" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">数据层元素</h2><p id="8577" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">系统主要职责的最后一层是收集数据并确保其持久性。和上一个一样，这里会有两个元素:PostgreSQL数据库和Meilisearch搜索引擎。</p><p id="6150" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">目前，我在没有选择数据库的情况下写这篇文章。Keystone.js只支持PostgreSQL或者SQLite，相信第二个对于电商系统来说有点太小了。</p><p id="669b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于搜索引擎，我们需要自定义集成，所以这里的选择余地要大得多，不过我最熟悉的还是Elasticsearch和Meilisearch。</p><p id="9c9b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我决定选择第二个，因为我觉得它的JavaScript集成更好一些，并且使用facet过滤器进行查询更容易。此外，它的占地面积比Elastic小几倍。</p><p id="d58e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这总结了我们尚未建立的电子商务系统的所有元素:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/c88fea162e1645c8c599f01a8f004cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fDYB7xW9eKCGbKBjbC6Z-Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">系统概况</p></figure><h1 id="00a9" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">摘要</h1><p id="3ea4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">好了，总结一下。现在，我们已经对我们将在本系列的下一部分中构建的内容有了基本的概述。</p><p id="a391" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">建立一个电子商务系统可能看起来很难，令人生畏，但是当我们把这个任务分成小的、计划好的块时，它就不那么可怕了。</p><p id="c3ee" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下一次，我们将编写一些代码，从项目的设置开始。</p><p id="355f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我希望你喜欢它。如果您有任何问题或意见，请随时提问。</p><p id="66fb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">祝您愉快！</p></div></div>    
</body>
</html>