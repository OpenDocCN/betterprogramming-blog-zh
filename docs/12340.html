<html>
<head>
<title>NextJS + Rust Twitter Streaming With Websocket</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Websocket的NextJS + Rust Twitter流</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/nextjs-rust-twitter-streaming-with-websocket-708dd0f33bb6?source=collection_archive---------4-----------------------#2022-05-30">https://betterprogramming.pub/nextjs-rust-twitter-streaming-with-websocket-708dd0f33bb6?source=collection_archive---------4-----------------------#2022-05-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="15d8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">周末建设和学习</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0b08d8e13174d430a7f1fe5f64a8a700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gblHydQXgSlLJsrs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@monaleesa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">莫妮卡·MG</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="6d40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上一次，我们用Rust构建了一个速度限制管道，并讨论了基于用例的性能调优。</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/velocity-limit-with-rust-performance-matters-9345763ec2d6"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">生锈时的速度限制—性能至关重要</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">这个周末让我们用Rust重建速度极限。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">better编程. pub</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><blockquote class="mu mv mw"><p id="e8e2" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">对于这个长周末，让我们构建一个仪表板组件，允许用户提交他们希望用Twitter流跟踪的特定主题。</p></blockquote><p id="bebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看整体逻辑架构图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/9e9c0d2038eca2dc41d73fd65deff37a.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*mDdDJgutmG0GI2ueMJtXsw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">逻辑流程-文件示例-按作者</p></figure><p id="98bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如我们所见，我们需要构建两个主要组件:</p><ol class=""><li id="e795" class="nc nd it lb b lc ld lf lg li ne lm nf lq ng lu nh ni nj nk bi translated"><code class="fe nl nm nn no b">Dashboard</code>，我们将在ReactJS之上使用NextJS框架。</li><li id="7a9b" class="nc nd it lb b lc np lf nq li nr lm ns lq nt lu nh ni nj nk bi translated">对于服务层，我们将使用Rust。</li><li id="9298" class="nc nd it lb b lc np lf nq li nr lm ns lq nt lu nh ni nj nk bi translated">客户机和服务器之间的通信将是HTTP RESTful POST和DELETE，消息将使用WebSocket。</li></ol><p id="affd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从演示和简单的角度来看，我将使用一个简单的hashmap，而不是DB级别的实现。然而，这可以很容易地扩展到更复杂的用例，我将把它留给您的创造力和想象力。:)</p><h1 id="d9eb" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">API服务层构建</h1><p id="9df7" class="pw-post-body-paragraph kz la it lb b lc om ju le lf on jx lh li oo lk ll lm op lo lp lq oq ls lt lu im bi translated">基于逻辑流程图，让我们将其分解为序列图，以了解我们需要构建什么API端点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/63fb59a63fec69ad9022842930a8d4e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*H37pp4vuz6-jo-l6IS_rFQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">序列图—按作者</p></figure><p id="f232" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，有两个主要的功能端点:</p><ol class=""><li id="58bf" class="nc nd it lb b lc ld lf lg li ne lm nf lq ng lu nh ni nj nk bi translated">注册端点以处理流的主题注册，并断开与流的连接[POST，DELETE]。</li><li id="f9ef" class="nc nd it lb b lc np lf nq li nr lm ns lq nt lu nh ni nj nk bi translated">Websocket端点来触发WebSocket服务，让前端应用程序连接，并发送Twitter流API passthought消息/数据。</li></ol><h2 id="28b7" class="os nv it bd nw ot ou dn oa ov ow dp oe li ox oy og lm oz pa oi lq pb pc ok pd bi translated">数据模型</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据模型—按作者</p></figure><h2 id="f1cb" class="os nv it bd nw ot ou dn oa ov ow dp oe li ox oy og lm oz pa oi lq pb pc ok pd bi translated">注册端点[POST，DELETE]</h2><ol class=""><li id="d8e6" class="nc nd it lb b lc om lf on li pg lm ph lq pi lu nh ni nj nk bi translated">Register endpoint向前端返回一个UUID，它将用于为前端构建一个WebSocket URI来监听消息。</li><li id="c4b6" class="nc nd it lb b lc np lf nq li nr lm ns lq nt lu nh ni nj nk bi translated">注销端点有两个主要任务，关闭套接字并从运行时hashmap中删除用户。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">注册端点—按作者</p></figure><h2 id="53e8" class="os nv it bd nw ot ou dn oa ov ow dp oe li ox oy og lm oz pa oi lq pb pc ok pd bi translated">WebSocket端点</h2><p id="2221" class="pw-post-body-paragraph kz la it lb b lc om ju le lf on jx lh li oo lk ll lm op lo lp lq oq ls lt lu im bi translated">Warp框架有其内置的WebSocket支持，一旦它连接了套接字，您就可以执行以下操作:</p><ol class=""><li id="c8c2" class="nc nd it lb b lc ld lf lg li ne lm nf lq ng lu nh ni nj nk bi translated">将传入的WebSocket连接拆分为发送方和接收方(对于这个用例，我们只使用发送方)。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Websocket拆分—按作者</p></figure><p id="a96f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.将传入的WebSocket连接客户端保存到运行时hashmap中，并触发Twitter流功能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">插入hashmap &amp;触发流—按作者</p></figure><p id="7e3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.Twitter流媒体。TwitterStream库跟踪传入的主题，并将其发送到WebSocket发送器，发送到连接的web前端。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">流式传输和发送—按作者</p></figure><p id="12e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">截至目前，API层已经按预期构建完成。让我们转到前端部分。</p><h1 id="7f50" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">仪表板构建</h1><p id="4554" class="pw-post-body-paragraph kz la it lb b lc om ju le lf on jx lh li oo lk ll lm op lo lp lq oq ls lt lu im bi translated">等一下，我以为你是个后端的家伙。你现在建前端？”:)</p><p id="f5f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我从一名网站管理员开始了我的IT生涯，一步一步地深入到前端、移动、后端和数据开发，然后是管理。</p><p id="a168" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，当然，我构建/编码前端！几年前，我曾经开发了很多前端和移动应用程序。</p><p id="c898" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前端世界变化很大，有不同的库、框架等。但是，基础仍然是JavaScript和标记语言HTML。</p><p id="b1c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在ReactJS库的基础上使用NextJS web开发框架来完成这个仪表板构建。</p><blockquote class="mu mv mw"><p id="6173" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">为什么选择NextJS？</p></blockquote><p id="36e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">抱歉，我不想争论JavaScript框架和libs哪个最好。</p><p id="4713" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前端世界有很多，比如AngularJS，VueJS，ReactJS等。都是很好的框架或者库。</p><p id="b276" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，根据您的项目/用例，您的团队结构、技能组合和需求可能会基于优点和CONS有不同的考虑。</p><p id="82a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mx">正如我常说的，没有最好的解决方案或工具。唯一最好的解决方案或工具是服务于你的项目、用例、上下文和需求的。</em></p><p id="82db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我选择NextJS作为前端构建工具的原因如下:</p><ol class=""><li id="6fc1" class="nc nd it lb b lc ld lf lg li ne lm nf lq ng lu nh ni nj nk bi translated">服务器端渲染，可以让我的页面加载得更快，因为我们只根据我们选择的主题显示即将到来的tweet流。</li><li id="f210" class="nc nd it lb b lc np lf nq li nr lm ns lq nt lu nh ni nj nk bi translated">它位于反应库的顶部。我在以前的工作中既有ReactJS又有AngularJS的经验，对我来说，很容易上手。</li><li id="83ca" class="nc nd it lb b lc np lf nq li nr lm ns lq nt lu nh ni nj nk bi translated">API中间件。您可以构建您的API中间件层来与外部API通信，以完成所需的集成和用例。</li></ol><p id="2ee5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仪表板的用户界面如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/4fbdb835940e42276ef5274c60dea4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jFDb15ReFVfwGHtMO7ZYww.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按作者排列的用户界面布局</p></figure><p id="fd66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了基本的HTML标签和渲染，让我们按照上面的顺序流程图:</p><ol class=""><li id="75b4" class="nc nd it lb b lc ld lf lg li ne lm nf lq ng lu nh ni nj nk bi translated">UI触发HTTP Post请求-&gt;返回WebSocket URI。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者的NextJS注册实现</p></figure><p id="dcfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.连接Websocket并监听消息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Index.js关于作者的消息实现</p></figure><p id="d02c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于NextJS是ReactJS之上的一个框架，它允许我们将一个页面解构为一系列组件。</p><p id="6365" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些组件中有许多经常在页面之间重用。在这个用例中，我们有TopicForm和TwitterCard每一个都有其渲染细节和功能上下文。</p><p id="6aa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">TwitterCard负责显示来自Websocket服务器的消息tweets。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pe pf l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者的TwitterCard组件</p></figure><h1 id="8400" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">把它们放在一起</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/918178253aa3598c404b5f589ef30702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*6vj2TRW_1wY7QKbjo3WIMg.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者Gif截图</p></figure><h1 id="1536" class="nu nv it bd nw nx ny nz oa ob oc od oe jz of ka og kc oh kd oi kf oj kg ok ol bi translated">最后的话</h1><p id="7486" class="pw-post-body-paragraph kz la it lb b lc om ju le lf on jx lh li oo lk ll lm op lo lp lq oq ls lt lu im bi translated">我们了解到:</p><ol class=""><li id="0082" class="nc nd it lb b lc ld lf lg li ne lm nf lq ng lu nh ni nj nk bi translated">如何用Rust实现WebSocket服务？</li><li id="e727" class="nc nd it lb b lc np lf nq li nr lm ns lq nt lu nh ni nj nk bi translated">如何使用NextJS连接监听WebSocket？</li><li id="6207" class="nc nd it lb b lc np lf nq li nr lm ns lq nt lu nh ni nj nk bi translated">如何连接Twitter流API，并通过通道将消息传递给Rust WebSocket？</li><li id="46e2" class="nc nd it lb b lc np lf nq li nr lm ns lq nt lu nh ni nj nk bi translated">为NextJS UI组件构建组件。</li></ol><p id="e37b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>