<html>
<head>
<title>Building a Better Dungeon Level</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建造一个更好的地下城关卡</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-better-dungeon-level-b04d133a6ca?source=collection_archive---------5-----------------------#2022-10-13">https://betterprogramming.pub/building-a-better-dungeon-level-b04d133a6ca?source=collection_archive---------5-----------------------#2022-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dcdb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我如何更新算法以更好地匹配图形</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/678c2ca394e4656749b472e347ae1a39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wb_a7R6BkmYExEV0yMqxTw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</p></figure><p id="6fef" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在过去的七个月里，我一直在用JavaScript和HTML5 Canvas构建一个地牢游戏。这款游戏类似于众所周知的<em class="lu"> Roguelike </em>，因为我没有自己建造关卡，而是使用了一种算法——一系列我翻译成代码的指令。</p><p id="0840" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不同的算法产生不同类型的地下城。例如，当我实现了一个叫做<em class="lu">随机漫步的算法时，</em>它产生了一个类似下面的地牢。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7524fb9db49f0af902d47400cef70929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3lVSpZfZKZnkr8BSR1PcPw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个游戏关卡示例。玩家蓝，敌人红，物品蓝黄。</p></figure><p id="9753" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">顾名思义，一个“挖掘者”会从中心向外随意摸索，并在坚硬的岩石中挖掘出隧道。然后它回到中心，继续前进，直到产生一定量的空间。</p><p id="03bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在实现了随机行走之后，我写了一些逻辑，在地图上随机放置房间，然后用狭窄的走廊将它们连接起来。虽然我也为同一个游戏用JavaScript写了这个，但它是基于不同的算法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6fe5446979f2ba47ec4d211030f327e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5dVPinjfK7uEkt4F2PYgQ.png"/></div></div></figure><p id="211d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这两种算法都会产生0和1的2D数组。<code class="fe lv lw lx ly b">0</code>代码产生灰色墙砖，而<code class="fe lv lw lx ly b">1</code>代码产生白色地砖。例如，下面是一个被墙包围的4 x 4房间的地图。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="1980" class="md me it ly b gy mf mg l mh mi">[[0,0,0,0],<br/> [0,1,1,0]<br/> [0,1,1,0]<br/> [0,0,0,0]]</span></pre><p id="2329" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我最近的游戏原型中，名为<em class="lu">Rhondar的Rogue</em>，地牢的墙壁和地板由称为瓷砖的正方形图像组成，这个2D阵列决定了瓷砖的放置位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mj"><img src="../Images/5036f17e4a4eaf78e5e570036ba43f03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*33M5Mdbz17BQzR5MpcJC8A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个游戏原型的图像。通过<a class="ae mk" href="https://www.facebook.com/TMT-Art-collection-405885289760848/" rel="noopener ugc nofollow" target="_blank"> TMT Art </a>平铺图像；作者笔下的流氓和妖精。</p></figure><p id="6941" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每当我的2D数组中有一个零(<code class="fe lv lw lx ly b">0</code>)时，就会出现一个墙砖；只要地图上有(<code class="fe lv lw lx ly b">1</code>)的地方，就会出现一个地砖。</p><p id="0550" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以下面的2D阵列部分—</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="72a9" class="md me it ly b gy mf mg l mh mi">0,0,0,0<br/>0,0,0,0<br/>0,0,0,1<br/>0,0,0,1<br/>1,0,1,1<br/>1,1,1,1</span></pre><p id="4f8d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">—会转化为类似下面的游戏内区域。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/521e90e5d4b4681e3e8a1ae2aa31c5b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*vY3gwvz_u8dmIYRgdjEiSQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如你所见，这里有一系列墙砖和地砖。</p></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="3986" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">放置瓷砖的方法</h1><p id="9eb7" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">为了将0和1转换为正确的瓷砖，我编写了逻辑，首先将瓷砖识别为墙壁或地板，然后根据该位置周围的瓷砖选择特定的图像。为了确定使用哪种瓷砖，程序必须仔细检查瓷砖代码的2D阵列，检查每个代码，并寻找其周围的图案。虽然程序会在任何现有的牌中寻找模式，但它也会在0和1中寻找模式。</p><p id="7408" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">确定贴哪种瓷砖比我想象的要困难，因为只有两种瓷砖代码——0代表墙壁，1代表地板——以及大约20种不同类型的瓷砖。</p><p id="8436" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，给定下面四种类型的墙砖—</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/8342b5e4d53f165c3b1d12d9df8d7f51.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*ckZbMpOIYXbvhwaaZfeK5g.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">四面可能的墙</p></figure><p id="3152" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">—该算法必须根据周围的单幅图块决定将哪个单幅图块用于下方的中心正方形。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/61bde1f307a4137ea9d415b6f19bbe3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*FO0sFfQvZX_VeZRYPLXWcA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae mk" href="https://m.facebook.com/ArtOfTMT/posts/" rel="noopener ugc nofollow" target="_blank"> TMT艺术</a>瓷砖。</p></figure><p id="afdb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果周围区域中的一些瓷砖还没有被放置，所有程序必须进行的是附近的瓷砖代码是<code class="fe lv lw lx ly b">0</code>还是<code class="fe lv lw lx ly b">1</code>。</p><p id="8909" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然找出地砖很简单，但墙砖可以是空白空间、边界、实心墙或孤立的块，这取决于周围的瓷砖。</p><p id="d041" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不幸的是，这种方法将我的代码变成了摇摇欲坠的积木塔。有太多不同的模式需要跟踪，编写代码来识别所有这些模式并正确地响应它们变得很笨拙。我很确定从长远来看这很难维持。</p><p id="721d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是第一次尝试出来的测试游戏截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/2ab824a170fc0d742292299b384cbe8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DeCm9OHBeW1oFoTv74crcA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一张早期的游戏截图。</p></figure><p id="7a2d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的游戏版本使用了我前面提到的随机行走算法。虽然它是实现起来比较容易的算法之一，但是处理它可以生成的所有不同的模式——并在这个过程中使它看起来不错——是非常棘手的。(只要看看下面的水平，它类似于罗夏墨迹。)我开始想，因为随机漫步关卡更像洞穴，而不是地牢，所以洞穴瓷砖会更适合。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e0c0289d4a359a29a09dbc4e60d3af80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kbUNhBWBDJCjzTjKddGDeg.png"/></div></div></figure><p id="1338" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以我知道我想切换回一个房间的算法，但我对使用我之前设计的算法感觉不是很好，如下所示。只有两个瓷砖代码，房间有时被放置在奇怪的位置，还有太多又长又细的走廊。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6aef3d7637996fb2ace2a45ffde08e27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ROZWZfTWwQPuOwbv5_1Icw.png"/></div></div></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="790a" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">从头再来</h1><p id="06ca" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在进一步进行瓦片放置之前，我需要一个更好的基础——一个更合适的算法来匹配我的瓦片集，并帮助我编写更易于维护的瓦片放置代码。所以我决定回到房间构建算法，做一些修改。</p><p id="aad1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我的目标是产生更宽的走廊和更均匀放置的房间。至于图块代码，我想要的不只是0和1。为了使模式检测更易于管理，我在图块代码中加入了以下内容:</p><ul class=""><li id="eaf8" class="ns nt it la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated">0-边界正下方的墙</li><li id="57f4" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">1-楼层</li><li id="9272" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">2-房间之间的封闭空间</li><li id="90e4" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">3-门</li><li id="3b37" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">4-迷宫周围的空白空间</li><li id="c037" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">5-边框</li></ul><p id="efa9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我添加了这些更具体的瓷砖代码，以帮助程序识别它正在处理的墙砖或地砖的类型，并减少它必须检查的周围瓷砖图案的数量。</p><p id="4036" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在建立了新的代码之后，我改进了房间生成算法，直到生成的地图看起来像下面这样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/55985a5f7ba566611eb907e413818c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k1msSJ5rmAT_nyLzgHjYqQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由更新的房间生成算法生成的级别。</p></figure><p id="38ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每种颜色代表一种特定的瓷砖类型，例如，边框是紫色的，地板是白色的，门是橙色的。虽然代码不需要特定的图块集，但我在编写时考虑了地牢图块集。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="b3ad" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">算法是如何进化的</h1><p id="61dc" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">除了一组更多样化的图块代码之外，下面是该算法发展的一些其他方式。</p><h2 id="b9bf" class="md me it bd mu og oh dn my oi oj dp nc lh ok ol ne ll om on ng lp oo op ni oq bi translated">更宽的走廊</h2><p id="b535" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">我原来的走廊只有一个瓷砖宽，而我的新大厅有两个瓷砖宽，以适应瓷砖集，并给玩家更多的活动空间。</p><p id="7003" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">根据朝向不同，每个大厅都有各自的特点。</p><ul class=""><li id="2473" class="ns nt it la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated">垂直的大厅通常在一端或两端有一扇门。</li><li id="ba79" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">水平的大厅顶部有一面墙。</li></ul><p id="f2df" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在等级生成过程中也存储了大厅位置，以便更容易检查大厅之间的重叠。</p><h2 id="eba2" class="md me it bd mu og oh dn my oi oj dp nc lh ok ol ne ll om on ng lp oo op ni oq bi translated">门</h2><p id="4b52" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">门是我打算加入的一个新元素。下面是我打算用的门砖。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/0dc48a0cdb4f0799ef2217984f85b140.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*uopPDADLPHFM1_ZJEJIttw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">四门瓷砖由<a class="ae mk" href="https://www.facebook.com/TMT-Art-collection-405885289760848/" rel="noopener ugc nofollow" target="_blank"> TMT艺术</a>制作。</p></figure><p id="74d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是具体的限制因素:</p><ul class=""><li id="9821" class="ns nt it la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated">门只出现在房间和走廊的顶部和底部。</li><li id="9123" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">它们组成了四块瓷砖。</li><li id="c93e" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">有一排墙砖与一扇门的下半部分对齐。</li></ul><p id="00e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是另一张地牢地图，上面有许多大厅和门。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6ed2338f09393a7f5b0075ad82ba821e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JSJ-QJSQvRf_Q_sKAVJcDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">灰色墙壁的水平大厅和带门的垂直大厅。</p></figure><h2 id="0c3a" class="md me it bd mu og oh dn my oi oj dp nc lh ok ol ne ll om on ng lp oo op ni oq bi translated">将房间放置在象限中</h2><p id="1b74" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">我早期的房间算法将房间放置在随机的位置，没有真正的限制，除了它们必须有特定的尺寸并适合地图。为了让房间分布更加均匀，我把地下城分成了四个象限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/262718e41a82a34376dd87a3c7a2b5ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qPX6VogF9n8XpXGPGoDVSA.png"/></div></div></figure><p id="043f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，尽管早期的算法在放置每个房间时会考虑整个地图，但新算法每次都会尝试在特定的象限内添加一个房间。过程是这样的:</p><ul class=""><li id="a9eb" class="ns nt it la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated">重复象限1到4。</li><li id="d88a" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">在每个象限中，尝试放置一个房间。</li><li id="d287" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">如果房间与另一个房间重叠，不要放置它。</li><li id="4f74" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">重复此操作，直到达到最大房间数。</li><li id="042c" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">把房间和走廊连接起来。</li></ul><p id="0eec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种方法确实使房间的布局更加均匀。有一种更复杂的方法叫做<a class="ae mk" href="http://www.roguebasin.com/index.php/Basic_BSP_Dungeon_generation" rel="noopener ugc nofollow" target="_blank">二进制空间分割</a>，尽管象限法对于我想要创建的层次也能很好地工作。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="b5e6" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">调试示例</h1><p id="4e2c" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">在编写新逻辑的整个过程中，调试工具是必不可少的。如果我需要解释房间不相连或走廊看起来不对的问题，打印每个房间和走廊的<code class="fe lv lw lx ly b">id</code>会有所帮助。此外，分隔象限的渲染线帮助我看到每个房间在哪个象限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/41522ad7933ba8006d8499e1f325199d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9vOO2Irw9__ajzX_xoaJVg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一张游戏地图，分成四个象限，标有路径和房间。</p></figure><h2 id="b005" class="md me it bd mu og oh dn my oi oj dp nc lh ok ol ne ll om on ng lp oo op ni oq bi translated">添加拐角</h2><p id="f71d" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">然而，连通房间并不是唯一的问题。我还遇到了一个问题，那就是在正确的位置给特定的路径边界添加拐角。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/42bfd752508bd418626578f008d11d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*SPgNlvHDYu3TlY161uGneg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个角落瓦片丢失的地牢区域。</p></figure><p id="a16b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用不同的颜色突出一个关键的角落，如下图所示，有助于确定问题并将其放在正确的位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/77b0ec3dfd278b2f0e22beadfa5bd27a.png" data-original-src="https://miro.medium.com/v2/resize:fit:358/format:webp/1*6zISMFAF8pi1slZnCmSeaw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">角落贴有标签的房间。</p></figure><h2 id="0e68" class="md me it bd mu og oh dn my oi oj dp nc lh ok ol ne ll om on ng lp oo op ni oq bi translated">监控清理</h2><p id="6b81" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">后来在这个过程中，我添加了一个功能，将浅灰色的瓷砖放在封闭的空间中，并将周围区域作为蓝色的空白空间。然而，我遇到过一些开放空间部分被不需要的灰色瓷砖填满的情况。该死。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f097fafcd9ce57b79c1fc90a42220805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWaolqrcg8CCMCSDIwr_lA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">渗透到开阔区域的灰色瓷砖。</p></figure><p id="1928" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我决定，我需要一个清理阶段，一旦发现不正确放置的灰色瓷砖所在的空间没有被封闭，就将它们移除。为了实现这一点，我编写了一个快速擦除函数，它检查相邻的图块并递归地调用自己。</p><p id="3663" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了测试擦除逻辑，我用蓝色和红色瓷砖来表示擦除开始的位置。然后我用绿色来突出灰色瓷砖被移除的区域。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/6126ca1868c095759e44e26efb04be3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgfo-r8XXO7DBjCUsLPOuw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">平铺突出显示有助于我跟踪擦除功能的进度。</p></figure><p id="e411" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有的调试指示器都被放置在一个<code class="fe lv lw lx ly b">&lt;canvas&gt;</code>元素上，这个元素直接位于持有游戏的<code class="fe lv lw lx ly b">&lt;canvas&gt;</code>之上。这样，放置在地图上的图块就不会覆盖指示器。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="0803" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">外卖食品</h1><p id="b895" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">对于我的游戏，我开始意识到建造一个好的地下城需要两个过程。</p><ul class=""><li id="27c6" class="ns nt it la b lb lc le lf lh nu ll nv lp nw lt nx ny nz oa bi translated">一个用于构建图块代码的映射</li><li id="75de" class="ns nt it la b lb ob le oc lh od ll oe lp of lt nx ny nz oa bi translated">一个用于放置平铺图像</li></ul><p id="be4d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于有程序生成关卡的游戏，地图构建算法是平铺图像放置的重要基础。太多的瓦片代码和初始地图构建变得太复杂和太特定于瓦片地图；太少，并且放置平铺图像时要检测的图案数量变得难以处理。</p><p id="9e52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">特别是，我发现更多的瓷砖代码对于区分边界、空白空间和真正的墙壁是必不可少的。我遇到的大多数自顶向下的图块集都有这些图块类型，所以这个逻辑也应该可以转移到其他图块集。更精细的算法应该有望使瓦片映射更容易。</p><p id="1f93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这是一篇有帮助的阅读，给你一些可以带回你的编程或游戏开发之旅的东西。下次见！</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="556c" class="mt me it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">信用</h1><p id="8e21" class="pw-post-body-paragraph ky kz it la b lb nk ju ld le nl jx lg lh nm lj lk ll nn ln lo lp no lr ls lt im bi translated">看看<a class="ae mk" href="https://o-lobster.itch.io/" rel="noopener ugc nofollow" target="_blank"> o_lobster </a>的精灵作品。他的玩家精灵对我创建自己的玩家精灵非常有帮助。</p><p id="0aae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">非常感谢<a class="ae mk" href="https://www.facebook.com/TMT-Art-collection-405885289760848/" rel="noopener ugc nofollow" target="_blank"> TMT Art </a>提供的非常棒的地牢瓷砖套装。</p><p id="b675" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我欣赏这两位艺术家在作品中展现的技巧和才华。</p><div class="ov ow gp gr ox oy"><a rel="noopener  ugc nofollow" target="_blank" href="/creating-a-game-loop-in-javascript-4b4d51c18f67"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd iu gy z fp pd fr fs pe fu fw is bi translated">用JavaScript创建游戏循环</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">让我们用一个循环的过程来平滑玩家的移动。</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">better编程. pub</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm ks oy"/></div></div></a></div></div></div>    
</body>
</html>