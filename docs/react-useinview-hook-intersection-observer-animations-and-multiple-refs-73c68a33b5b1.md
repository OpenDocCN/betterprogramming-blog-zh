# 如何实现 React“usein view”自定义钩子

> 原文：<https://betterprogramming.pub/react-useinview-hook-intersection-observer-animations-and-multiple-refs-73c68a33b5b1>

## 交叉点观察器、动画和多个参考

![](img/292e6f06968a42d76fd375ea23f9db5f.png)

照片由[马蒂亚斯雷丁](https://unsplash.com/@matreding?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

在本文中，我将介绍如何构建一个名为`useInView`的定制钩子，并在一些元素进入用户视图时用它来制作动画。

# 什么是交叉点观察器，以及如何在 React 中使用它

正如文档所说，它是一个浏览器 API。浏览器功能允许我们在特定元素与特定目标(默认为用户视口)相交时执行操作。

我强烈推荐阅读[文档](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API)。

## 它能用来做什么

有一些很酷的应用程序，例如:

*   当视频退出/进入视图时暂停/播放视频
*   统计一篇文章或一个帖子被用户阅读了多少次
*   图像或任何其他内容的延迟加载
*   展示一些好看的动画
*   基于滚动的动态导航栏

## 如何在 React 中快速设置交叉点观察器

我们需要一个引用来定位需要观察的元素。将在`useEffect`中设置`Observer`，当元素在视图中时，我们可以有一个标记状态。

这里发生了什么？我们在页面的底部显示一个段落，并且我们希望标记该元素何时在视图中，何时不在视图中。为此，我们保留对它的引用。

当组件被挂载时，我们创建一个交叉点观察器的新实例。我们传递回调函数，当观察者检测到我们的元素进入或退出视图时，该函数将被触发。`entries`参数表示我们的目标节点，在我们的例子中，就是页面底部的段落。然后，我们用我们的目标调用`observe`方法，最后，我们确保当组件被卸载时观察器断开连接。

## 如何在自定义钩子中提取它

我们喜欢干净的代码，不是吗？在其他组件中使用它会很好，但是我们当然不希望每个组件重复大约 20 行代码。所以，让我们在一个单独的钩子中提取它，并让它观察多个元素。最好每个元素都有一个唯一的标识符。我们可以使用 id 或数据属性。

快速信息:数据属性是额外的属性，我们可以附加到 HTML 元素来存储一些信息，而不显示任何视觉表示。我们还必须尊重模式，将`data`放在我们酒店的后面。

在这里，我们的钩子变成了一个漂亮的黑盒，它接受对元素的引用，并返回一个对象，该对象包含元素名称(作为数据属性传递)和一个标志，该标志指示当前元素在视图中。

我们在回调中所做的不同是，我们试图获取元素名称。如果没有找到，我们显示一个警告。否则，如果元素是相交的，我们就切换元素对象中的元素。我们应该意识到每个元素都应该有一个唯一的名字。

这是我们重构后的组件:

这只是一个基本的例子。我希望最终开发人员决定什么最适合他们的场景。如前所述，可以用 id 代替数据属性。钩子也可以被参数化以接收数据属性的名称。我们可以返回一个数组而不是一个对象，等等。

下面，我演示了文章中的内容，我还添加了如何触发平滑淡入淡出动画。干杯🍺！