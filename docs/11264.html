<html>
<head>
<title>Imitating Kotlin With Java Optional</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Java可选模仿Kotlin</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/imitating-kotlin-with-java-optional-9ab1fb8aec53?source=collection_archive---------7-----------------------#2022-03-03">https://betterprogramming.pub/imitating-kotlin-with-java-optional-9ab1fb8aec53?source=collection_archive---------7-----------------------#2022-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3ba5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从爪哇到科特林</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/a228c2a21b0f8e268314d0351bb18622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*bQdRGie3Gz97qj21.jpeg"/></div></figure><p id="f2cc" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe lj lk ll lm b">java.util.Optional</code>的用法有点像<a class="ae ln" href="https://en.wikipedia.org/wiki/Law_of_triviality" rel="noopener ugc nofollow" target="_blank">自行车棚对话</a>。它已经被广泛地写了，观点也各不相同。</p><p id="c67d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">从假设您想将代码迁移到Kotlin开始，对于您的Java代码来说，哪种风格是最好的可选风格？选择最类似于<a class="ae ln" href="https://kotlinlang.org/docs/null-safety.html" rel="noopener ugc nofollow" target="_blank"> Kotlin可空性规则</a>的样式可能是有意义的。</p><p id="a832" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让我们先来看看<a class="ae ln" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Optional.html" rel="noopener ugc nofollow" target="_blank">可选</a>(在<a class="ae ln" href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html" rel="noopener ugc nofollow" target="_blank"> Java8 </a>中引入)是做什么的。Optional是一个对象包装器，提供了安全使用底层对象的方法，同时避免了可怕的空指针异常<a class="ae ln" href="https://docs.oracle.com/javase/7/docs/api/java/lang/NullPointerException.html" rel="noopener ugc nofollow" target="_blank">。这提供了与Kotlin的</a><a class="ae ln" href="https://kotlinlang.org/docs/null-safety.html#nullable-types-and-non-null-types" rel="noopener ugc nofollow" target="_blank">可空数据类型</a>基本相同的行为，并允许Java模仿Kotlin可空数据类型。</p><p id="f7be" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Java没有的是匹配Kotlin的非空类型。您不能阻止将<code class="fe lj lk ll lm b">null</code>赋值给变量。那么我们能做些什么呢？我们可以假设所有不是可选的东西都是非空的——理想情况下，在ide和编译器警告中对其进行注释来帮助我们(并且可能使用<a class="ae ln" href="https://projectlombok.org/features/NonNull" rel="noopener ugc nofollow" target="_blank"> Lombok </a>来尽我们所能在运行时强制执行它)。</p><p id="8c8e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在代码中会是什么样子呢？</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="982d" class="lv lw iq bd lx ly lz dn ma mb mc dp md kw me mf mg la mh mi mj le mk ml mm mn bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="58b6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">注意:所有的Java返回类型和参数都被标记为<code class="fe lj lk ll lm b">@Nonnull</code>——这意味着我们不希望在代码中看到任何<code class="fe lj lk ll lm b">null</code>。反而可以用<code class="fe lj lk ll lm b">Optional.empty()</code>；这是一个更明确的指示，表明不希望出现任何值，而只是缺少值。</p><h2 id="09f9" class="lv lw iq bd lx ly lz dn ma mb mc dp md kw me mf mg la mh mi mj le mk ml mm mn bi translated">科特林</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mo mp l"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="b2a5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">对于Java来说，这使得到处都是可选的。当一个值可以是<code class="fe lj lk ll lm b">null</code>时，使用一个可选的来包装它。这适用于返回类型、方法参数和成员变量。</p><p id="e691" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">通过遵循这种方法，您可以避免大多数情况下不得不编写<code class="fe lj lk ll lm b">null</code>。相反，您可以使用可选类提供的方法来操作基础值。一些有用的例子:</p><ul class=""><li id="abd0" class="mq mr iq kp b kq kr kt ku kw ms la mt le mu li mv mw mx my bi translated">如果值存在且不为空，则<code class="fe lj lk ll lm b">ifPresent(Consumer&lt;? super T&gt; consumer)</code>执行<code class="fe lj lk ll lm b">consumer</code>。</li><li id="8e2d" class="mq mr iq kp b kq mz kt na kw nb la nc le nd li mv mw mx my bi translated"><code class="fe lj lk ll lm b">map(Function&lt;? super T, ? extends U&gt; mapper)</code>使用<code class="fe lj lk ll lm b">mapper</code>将基础值转换为新的类型。</li><li id="653f" class="mq mr iq kp b kq mz kt na kw nb la nc le nd li mv mw mx my bi translated"><code class="fe lj lk ll lm b">orElse(T other)</code>返回基础值，如果基础值为<code class="fe lj lk ll lm b">null</code>，则返回<code class="fe lj lk ll lm b">other</code>。这允许您保证检索到非空值。</li></ul><p id="12a1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在Java <a class="ae ln" href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html" rel="noopener ugc nofollow" target="_blank"> 8 </a>、<a class="ae ln" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Optional.html" rel="noopener ugc nofollow" target="_blank"> 11 </a>和<a class="ae ln" href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Optional.html" rel="noopener ugc nofollow" target="_blank"> 17 </a>文档中可以找到更多的选项。</p><p id="643d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我曾经属于仅返回类型可选的阵营，但是在与Kotlin和Swift一起工作后，我在任何地方都变成了可选的。</p><h2 id="a1f9" class="lv lw iq bd lx ly lz dn ma mb mc dp md kw me mf mg la mh mi mj le mk ml mm mn bi translated">这如何适用于集合？</h2><p id="8356" class="pw-post-body-paragraph kn ko iq kp b kq nf jr ks kt ng ju kv kw nh ky kz la ni lc ld le nj lg lh li ij bi translated">在可能的情况下，当不需要区分空情况和<code class="fe lj lk ll lm b">null</code>情况时，最好使用空集合而不是<code class="fe lj lk ll lm b">null</code>集合。如果需要区分<code class="fe lj lk ll lm b">null</code>和空集(如补丁请求)，可以使用可选的来区分集合的两种状态。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="506f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">通过遵循这种方法，你的代码库将更接近Kotlin，并且有额外的好处，可以消除大多数(如果不是全部)你可能会遇到<a class="ae ln" href="https://www.linkedin.com/pulse/20141126171912-7082046-tony-hoare-invention-of-the-null-reference-a-billion-dollar-mistake/" rel="noopener ugc nofollow" target="_blank">十亿美元错误</a>的情况。</p><h1 id="e938" class="nk lw iq bd lx nl nm nn ma no np nq md jw nr jx mg jz ns ka mj kc nt kd mm nu bi translated">特别感谢</h1><ul class=""><li id="6cf3" class="mq mr iq kp b kq nf kt ng kw nv la nw le nx li mv mw mx my bi translated">蒂姆·绍恩贝格</li><li id="0c45" class="mq mr iq kp b kq mz kt na kw nb la nc le nd li mv mw mx my bi translated">阿尔瓦罗·伊巴尔根</li><li id="70ad" class="mq mr iq kp b kq mz kt na kw nb la nc le nd li mv mw mx my bi translated"><a class="ny nz ep" href="https://medium.com/u/5668fa40d801?source=post_page-----9ab1fb8aec53--------------------------------" rel="noopener" target="_blank">普拉得·阿什拉夫·普尔</a></li></ul><h1 id="5a83" class="nk lw iq bd lx nl nm nn ma no np nq md jw nr jx mg jz ns ka mj kc nt kd mm nu bi translated">参考</h1><ul class=""><li id="8267" class="mq mr iq kp b kq nf kt ng kw nv la nw le nx li mv mw mx my bi translated"><a class="ae ln" href="https://kotlinlang.org/docs/null-safety.html" rel="noopener ugc nofollow" target="_blank">科特林零安全</a></li><li id="0fac" class="mq mr iq kp b kq mz kt na kw nb la nc le nd li mv mw mx my bi translated"><a class="ae ln" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Optional.html" rel="noopener ugc nofollow" target="_blank"> Java 11可选</a></li><li id="b92e" class="mq mr iq kp b kq mz kt na kw nb la nc le nd li mv mw mx my bi translated"><a class="ae ln" href="https://www.baeldung.com/jackson-optional" rel="noopener ugc nofollow" target="_blank">杰克森的JDK8模块</a></li><li id="7e3c" class="mq mr iq kp b kq mz kt na kw nb la nc le nd li mv mw mx my bi translated"><a class="ae ln" href="https://stackoverflow.com/questions/36166658/how-to-disable-the-optional-used-as-field-or-parameter-type-warning-in-intelli" rel="noopener ugc nofollow" target="_blank">在IntelliJ中禁用选项作为参数警告</a></li></ul></div></div>    
</body>
</html>