<html>
<head>
<title>4 Ways to Optimize Your Kubernetes Cloud Costs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优化Kubernetes云成本的4种方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-ways-to-optimize-kubernetes-cloud-costs-41e93892d05c?source=collection_archive---------11-----------------------#2020-10-12">https://betterprogramming.pub/4-ways-to-optimize-kubernetes-cloud-costs-41e93892d05c?source=collection_archive---------11-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2e0e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">确保你只花你需要的钱</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f498397032be06868f950d74db3b6fd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rb5oUPCFQwzg42zN.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者照片。</p></figure><p id="3053" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">迁移到Kubernetes不能保证降低云成本。本文分享了如何在Kubernetes中管理容器化应用程序的成本。</p><p id="d0c4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">无论您使用的是AWS弹性容器服务(ECS)还是任何风格的Kubernetes，这些内容都可以帮助FinOps团队取得成功。管理云成本的核心原则是了解我们基于云的工作负载的运营模式。容器技术允许应用程序在共享计算资源上独立运行，但这在成本可见性、资源优化和预算方面带来了挑战。</p><p id="b7a1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意，在ECS中，容器和服务实例相当于Kubernetes中的pod和节点。我们将在本文中使用Kubernetes术语。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="6abc" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Kubernetes提供了什么？</h1><p id="f57f" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">Kubernetes及其其他发行版是一个容器编排平台。容器运行一个应用程序，它们使用容器映像来定义运行应用程序所需的所有资源。Kubernetes通过将一个或多个容器分组为一个pod来管理这些容器。这些单元可以在计算节点集群中进行调度和扩展。</p><p id="89ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后名称空间提供了一种组织不同Kubernetes资源的方式，比如pod和部署。名称空间可以模拟一个组织的结构，因此每个团队都有一个名称空间，或者为开发人员的沙盒环境提供一个名称空间。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4d7a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">如何优化Kubernetes工作负载</h1><p id="280e" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">在上一篇文章中，我们讨论了云成本的<a class="ae lr" href="https://harness.io/2020/06/a-developers-guide-to-cloud-cost/" rel="noopener ugc nofollow" target="_blank">贡献者</a>，以及工作负载如何贡献已利用、闲置和未分配的成本。未分配和闲置成本是浪费，代表未充分利用的群集资源。请注意，在未分配的情况下，您已经保留了没有活动工作负载的节点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/b40047fe649c137fd252263a35462442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1cpaxGqLeZvh_CK_"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者照片。</p></figure><p id="12ac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在Kubernetes中优化工作负载时，需要考虑不同的策略。让我们更详细地讨论这些。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b4be" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">为pod配置服务质量</h1><p id="7a0d" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">通过指定容器的配置，可以确保pod具有固定或最小数量的节点资源。Kubernetes调度程序使用该配置将pod分配给集群中的节点。这些配置为Kubernetes中运行的pods提供了不同的服务质量(QoS)等级:有保证、可突发和尽力而为。每个类别都是根据您如何配置资源限制以及对计算和内存资源的请求来分配的。</p><p id="e65a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有保证的服务质量等级确保pods具有所请求的设定数量的CPU和内存。可突发的资源分配将使pods仅在需要时访问更多资源，而尽力而为则允许pods在节点上有容量时运行。</p><p id="0d5e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我建议查看Kubernetes文档,了解如何利用每个类。通过对工作负载采用不同的QoS等级，您可以获得更高的利用率。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="36d8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">配置Kubernetes调度程序</h1><p id="fe8c" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">Kubernetes调度程序监视新创建的没有分配节点的pod。调度器负责为它发现的每个pod找到最佳的节点分配，它通过两个步骤来完成:过滤和评分。</p><p id="12f6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">筛选步骤决定了可以调度pod的节点集。节点关联性指的是在一组节点上运行的pod的偏好或要求。在Kubernetes中，你还可以<em class="mx">污染</em>一个节点来击退一组pods，然后应用<em class="mx">容忍</em>来允许pods调度到具有匹配污染的节点上。这是将一组计算资源分配给组织中的一个团队的绝佳方式。</p><p id="e064" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">评分步骤确定剩余节点的等级，以评估最合适的pod放置。kube-scheduler将pod分配给具有最高等级的节点。如果有多个节点得分相等，kube-scheduler会随机选择其中一个。</p><p id="66ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有两种受支持的方式来配置调度程序的过滤和评分行为。我建议查看调度配置文件和调度配置文件，以确定什么对您的工作负载最有意义。参见<a class="ae lr" href="https://kubernetes.io/docs/concepts/scheduling-eviction/kube-scheduler/" rel="noopener ugc nofollow" target="_blank"> Kubernetes文档</a>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d730" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">垂直和水平调整大小</h1><p id="6880" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">最后的建议是考虑调整你的资源。在垂直调整中，我们改变节点的大小。如果您正在运行高可用性工作负载，而pod需要在不同的底层节点上运行，则您可能需要垂直调整规模。很多时候，这会导致更高比例的闲置成本，例如，我们的节点实例可以有12个核心，但您的pod只使用了6个核心。如果您有一个高可用性的服务，它运行一个应用程序的两个实例，那么运行每个节点的50%的成本都会造成浪费。</p><p id="08bd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在水平调整中，您可以更改集群中的节点数量。如果集群中没有足够的利用率或工作负载，水平合理调整是有益的。但是，目前为止您只能水平缩减，因此，或者，您可以在不使用计算资源时(例如，在周末)关闭或降低计算资源。</p><p id="f312" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">无服务器架构和容器也为您处理资源分配，因此您只需为您使用的资源付费。尽管如此，如果无法访问预留的基础架构，就很难针对不同的工作负载进行优化。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="524e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">利用云成本可见性</h1><p id="0e1e" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">管理Kubernetes和基于容器的工作负载的成本与管理任何其他云工作负载一样重要。这篇文章分享了如何优化你的Kubernetes消费。优化的一个主要组成部分是可视性。</p></div></div>    
</body>
</html>