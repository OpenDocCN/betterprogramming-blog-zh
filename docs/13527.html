<html>
<head>
<title>How to Use Xcode Plugins in Your iOS App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在您的iOS应用程序中使用Xcode插件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-xcode-plugins-in-your-ios-app-13574261f210?source=collection_archive---------5-----------------------#2022-09-05">https://betterprogramming.pub/how-to-use-xcode-plugins-in-your-ios-app-13574261f210?source=collection_archive---------5-----------------------#2022-09-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4b4e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">将Xcode构建插件应用到您的iOS应用程序开发流程中</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3b2f210e915908ed591f73d3d0f64fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mTNDZLAivELwCBk3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">汉斯·维维克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3cb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名iOS工程师，你工作的最终目标是开发iOS应用。今年6月，苹果为Swift Package Manager提供了一个与Xcode集成的新功能:Swift Package plugins。</p><p id="fa01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关Swift软件包插件的更多信息可在以下WWDC视频中找到:</p><ul class=""><li id="f7c7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://developer.apple.com/videos/play/wwdc2022/110359/" rel="noopener ugc nofollow" target="_blank">认识Swift包插件</a></li><li id="f5f4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://developer.apple.com/videos/play/wwdc2022/110401/" rel="noopener ugc nofollow" target="_blank">创建Swift包插件</a></li></ul><p id="077d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这些视频中，苹果向我们展示了如何在Xcode内外的其他包中使用插件。然而，在你的应用中使用这个插件并不像预期的那样简单。</p><p id="93b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我想和你分享如何在你的应用中实际使用构建插件，用一个简单的技巧，也可以提高模块化和代码重用。</p><h1 id="6529" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">应用程序</strong></h1><p id="4593" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果你想在一个app上应用Swift插件，首先，你需要一个app。</p><p id="c7a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于本文的考虑，您可以在Xcode中创建一个简单的SwiftUI应用程序。该应用程序包括一个口袋妖怪列表和一些口袋妖怪细节的导航。代码可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="9d18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是应用程序的入口点，标有<code class="fe ni nj nk nl b">@main</code>注释。您定义数据模型(示例中的<code class="fe ni nj nk nl b">Pokemon</code>)和<code class="fe ni nj nk nl b">DataLoader</code>依赖项来返回口袋妖怪列表。</p><blockquote class="nm nn no"><p id="4010" class="kz la np lb b lc ld ju le lf lg jx lh nq lj lk ll nr ln lo lp ns lr ls lt lu im bi translated"><strong class="lb iu">注意</strong>:为了举例，您可以使用静态数据列表，如在<code class="fe ni nj nk nl b">App</code>类型的末尾所定义的。</p></blockquote><p id="86b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ni nj nk nl b">ContentView</code>可以根据需要变得复杂。在本例中，这是一个简单的列表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="1960" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码只包含一个带有一个显示所有口袋妖怪的<code class="fe ni nj nk nl b">List</code>的<code class="fe ni nj nk nl b">NavigationStack</code>。当点击口袋妖怪的名字时，应用程序会导航到一个更大的图像和有味道的文本的详细屏幕。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/cd5ca4e5e21698e64e60ddf9930e05ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/1*jFFku77ez_8G7KjhkYB-eA.gif"/></div></figure><h1 id="2885" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">外挂</strong></h1><p id="46df" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">然后，你需要Swift插件。为了简洁起见，你可以重用我上一篇文章中的插件，或者你可以自己创建一个新的插件。</p><p id="493a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回想一下，编写构建插件的基本步骤是:</p><ol class=""><li id="dd00" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nu mb mc md bi translated">创建一个导出<code class="fe ni nj nk nl b">.plugin</code>产品的<code class="fe ni nj nk nl b">Package.swift</code>文件。</li><li id="9248" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nu mb mc md bi translated">添加一个具有<code class="fe ni nj nk nl b">.buildTool</code>能力的<code class="fe ni nj nk nl b">.plugin</code>类型的目标。</li><li id="982c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nu mb mc md bi translated">创建一个<code class="fe ni nj nk nl b">@main</code>结构，为选择的插件实现合适的协议。</li><li id="0a71" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nu mb mc md bi translated">实现插件。</li></ol><p id="72df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ni nj nk nl b">Package.swift</code>的代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="ac5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意<code class="fe ni nj nk nl b">swift-tools-version</code>(第一行)需要是<code class="fe ni nj nk nl b">5.7</code> : Swift包插件是一个新特性，仅从该版本开始支持。</p><p id="8b66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，插件的代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="778a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，您导入了Apple提供的新的<code class="fe ni nj nk nl b">PluginPackage</code>框架来实现一个<code class="fe ni nj nk nl b">BuildToolPlugin</code>协议。该协议要求您实现一个<code class="fe ni nj nk nl b">createBuildCommand(context:target:)</code>函数，该函数返回一个要在构建过程中执行的<code class="fe ni nj nk nl b">Command</code>列表。</p><p id="cb31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您返回的命令是一个<code class="fe ni nj nk nl b">prebuildCommand</code>插件，它在您代码的文件夹中执行<code class="fe ni nj nk nl b">swiftlint</code>程序。</p><h1 id="25ad" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated"><strong class="ak">将插件连接到应用程序</strong></h1><p id="88e5" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">不幸的是，将插件连接到应用程序并不简单。首先，您可能想通过以下方式将Swift包作为项目的依赖项添加进来:</p><p id="86d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.右键单击项目，</p><p id="9ba8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.选择<strong class="lb iu">添加包… </strong>，</p><p id="26cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.点击<strong class="lb iu">添加本地… </strong>，</p><p id="9e2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">1.选择上一步创建的<code class="fe ni nj nk nl b">SwiftLintPlugin</code>。</p><p id="8817" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几秒钟后，Xcode会向您显示项目中的插件，也会构建它，但它不会在您的项目上运行可执行文件。此时，您可以尝试将它作为依赖项添加到<strong class="lb iu">框架、库和嵌入内容</strong>中，但是插件不会出现。</p><p id="885e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过一些挖掘和Xcode探索，您还可以发现在各个构建阶段中有一个新的<strong class="lb iu">运行构建工具插件</strong>步骤。您可以尝试在这一步添加插件，点击<strong class="lb iu"> + </strong>按钮并选择插件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/c7c627ad5d67702ff5b01d7545391384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aropYdTCPj0WTY7JVqGQew.png"/></div></div></figure><p id="eba5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您这样做，然后尝试构建应用程序，Xcode将会导致构建失败，并显示一个错误:</p><pre class="kj kk kl km gt nw nl nx ny aw nz bi"><span id="38f7" class="oa mk it nl b gy ob oc l od oe">Malformed input JSON: Couldn’t find the XcodeProjectPlugin entry point</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/b1b255221fb7383c67ebe03caf603e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AGrkslDMZw-wRoUL3Dtzvg.png"/></div></div></figure><p id="965e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我很确定应该有一个地方可以配置这个JSON，这样你就可以把Xcode引向正确的方向。我尝试在项目和目标级别查看各种构建设置。我试着看了一下<code class="fe ni nj nk nl b">Info.plist</code>键，但是找不到有用的东西。</p><p id="cc9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你能找到我们可以配置插件的地方，请告诉我。</p><h2 id="662a" class="oa mk it bd ml og oh dn mp oi oj dp mt li ok ol mv lm om on mx lq oo op mz oq bi translated">变通办法:把你的应用程序打包</h2><p id="cfa0" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">我最喜欢的一句话是<em class="np">需要是发明之母。所以，我发现，如果插件可以在一个包中运行，你也可以把你所有的应用程序放在一个包中，让插件在这个包中运行。</em></p><p id="c95f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦有了想法，这个过程就是线性的:</p><ul class=""><li id="eace" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">从你的应用程序中删除<code class="fe ni nj nk nl b">SwiftLintPlugin</code>。</li><li id="510a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">创建一个新包<code class="fe ni nj nk nl b">PokemonAppKit</code>。您可以使用以下命令来完成:</li></ul><pre class="kj kk kl km gt nw nl nx ny aw nz bi"><span id="394c" class="oa mk it nl b gy ob oc l od oe">mkdir PokemonAppKit &amp;&amp; cd PokemonAppKit <br/>swift package init --name PokemonAppKit --type library</span></pre><ul class=""><li id="49ae" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">按照上一节中的步骤，将新的空包添加到您的<code class="fe ni nj nk nl b">PokemonApp</code>中。</li><li id="eac9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将<code class="fe ni nj nk nl b">PokemonAppKit</code>库添加到应用程序的<strong class="lb iu">框架、库和嵌入内容</strong>部分。</li><li id="5fcb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">打开<code class="fe ni nj nk nl b">PokemonAppKit</code>的<code class="fe ni nj nk nl b">Package.swift</code>文件，添加<code class="fe ni nj nk nl b">SwiftLintPlugin</code>依赖关系:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="afcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些片段突出显示了您需要应用的更改:</p><ol class=""><li id="903e" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nu mb mc md bi translated">指定包是iOS 16的(插件只能应用到那个版本)。</li><li id="bd5c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nu mb mc md bi translated">将带有插件的<code class="fe ni nj nk nl b">package</code>添加到依赖项中。</li><li id="9b42" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nu mb mc md bi translated">将<code class="fe ni nj nk nl b">plugin</code>添加到必须执行它的目标上。</li></ol><p id="84f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">插件现在被配置为在<code class="fe ni nj nk nl b">PokemonAppKit</code>目标上运行。要验证是否正在运行，请打开<code class="fe ni nj nk nl b">PokemonAppKit.swift</code>文件，并在文件末尾添加一些新行，然后进行编译。您应该会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/28aec76066a195692332479b0120ab37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8BWZoPUDzqYYEjjMX6RY9A.png"/></div></div></figure><p id="ef14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您已经配置了插件，但是新的包是空的。目标是在应用程序代码上运行插件，所以是时候将代码从应用程序移到包中了。在这一步要小心:你需要添加适当的可见性修饰符,因为现在这个应用程序与代码的其余部分在不同的模块中。</p><p id="938f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">移动代码的具体步骤是:</p><ol class=""><li id="f083" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nu mb mc md bi translated">创建一个<code class="fe ni nj nk nl b">Pokemon.swift</code>文件。代码将类似于:</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="f17f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.用下面的代码创建一个<code class="fe ni nj nk nl b">DataLoader.swift</code>文件</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="bf33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.将<code class="fe ni nj nk nl b">ContentView.swift</code>从应用程序移动到包中。您需要创建<code class="fe ni nj nk nl b">ContentView</code>结构<code class="fe ni nj nk nl b">public</code>，以及<code class="fe ni nj nk nl b">var body: some View</code>属性和<code class="fe ni nj nk nl b">init</code>。</p><p id="38c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">4.更新<code class="fe ni nj nk nl b">PokemonApp.swift</code>文件，添加<code class="fe ni nj nk nl b">import PokemonAppKit</code>语句。<code class="fe ni nj nk nl b">PokemonApp.swift</code>文件的最终外观是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="6326" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个文件很薄，逻辑很少。这是应用程序中唯一保留的文件。</p><p id="1d89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您现在构建，您应该已经从包中的Swift文件看到一些警告。恭喜:你成功地将插件连接到你的应用程序上了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/aac72b8284f48b228aa1ff95e0ca68d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*OEtpgzvcdgcS3uWM6HT-0A.png"/></div></figure><h1 id="82f9" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="9259" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在今天的文章中，您学习了如何将Swift软件包插件连接到iOS应用程序。没有明确的方法可以直接做到这一点:希望苹果会在Xcode 14发布之前发布一些关于它的文档。</p><p id="2e56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你学习如何去做，绕过这个限制。为了实现您的目标，您将应用程序的代码提取到一个单独的包中，并将插件连接到它。</p><p id="58fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法不仅简化了应用程序的代码:它还推动了更好的模块化和代码重用。一旦你将你的应用打包到Swift包中，使用Vapor 为macOS应用、CLI应用甚至<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/share-swift-code-between-client-and-vapor-server-94df9cc42543">服务器应用重用相同的代码将会更加容易。</a></p></div></div>    
</body>
</html>