<html>
<head>
<title>The Easy Python Auto-code Formatting Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简单的Python自动代码格式化指南</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-easy-python-auto-code-formatting-guide-e8300c82797b?source=collection_archive---------14-----------------------#2022-03-30">https://betterprogramming.pub/the-easy-python-auto-code-formatting-guide-e8300c82797b?source=collection_archive---------14-----------------------#2022-03-30</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="036b" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">只需设置一次<strong class="ak"><em class="kj"/></strong>，在提交时编写并自动格式化您的代码——使用这些工具没有任何麻烦。</h2></div><figure class="kl km kn ko gu kp gi gj paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gi gj kk"><img src="../Images/20e3c0cfd8c7e7909e94fb8448f12eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OHB1gLmQ0WkRpApw"/></div></div><p class="kw kx gk gi gj ky kz bd b be z dk translated"><a class="ae la" href="https://unsplash.com/@jeremythomasphoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰瑞米·托马斯</a>在<a class="ae la" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="89b2" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">Python易于阅读和理解的语法使其成为当今最流行的编程语言——这是有充分理由的。Python的各种用例是如此的多样化，以至于软件工程、机器学习和数据科学都有不同的复杂用法。</p><p id="01e5" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">在编写干净的Python代码时，最容易被忽视的也是最基本的领域之一包括对良好的格式和代码检查的需求。</p><p id="8e24" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">可以说，在生活的每个方面都自动化的今天，代码审查中的这个特定步骤也可以很容易地完成，而不需要太多的人工努力。</p><p id="0bfc" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">有一些工具可以帮助你节省一些宝贵的时间和精力，而不是每次在git提交之前格式化你的代码。</p><p id="5564" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">以下是其中的一些</p><ul class=""><li id="35bf" class="ly lz iu ld b le lf lh li lk ma lo mb ls mc lw md me mf mg bi translated">预提交挂钩，</li><li id="4b11" class="ly lz iu ld b le mh lh mi lk mj lo mk ls ml lw md me mf mg bi translated">黑色</li><li id="9bf0" class="ly lz iu ld b le mh lh mi lk mj lo mk ls ml lw md me mf mg bi translated">伊索特</li></ul><p id="1b6e" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">让我们一步一步地学习如何为一个Python项目设置它们。</p><h1 id="45bd" class="mm mn iu bd mo mp mq mr ms mt mu mv mw ka mx kb my kd mz ke na kg nb kh nc nd bi translated">安装和使用提交前挂钩</h1><p id="8b85" class="pw-post-body-paragraph lb lc iu ld b le ne jv lg lh nf jy lj lk ng lm ln lo nh lq lr ls ni lu lv lw in bi translated">预提交钩子完全按照它在tin上所说的那样做——它们运行某些脚本来检查您的代码是否有错误，尾随空白，运行一些格式化工具，以及在代码审查过程中进行许多其他有用的检查。</p><p id="534b" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">对我们来说，我们将经历两个重要的挂钩，不包括一些常见的挂钩。</p><p id="91f9" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">让我们先安装库(我假设您已经在使用虚拟环境):</p><pre class="kl km kn ko gu nj nk nl nm aw nn bi"><span id="6f97" class="no mn iu nk b gz np nq l nr ns">pip install pre-commit</span></pre><p id="fd01" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">安装后用这个检查版本，它应该为您输出版本作为健全性检查:</p><pre class="kl km kn ko gu nj nk nl nm aw nn bi"><span id="e689" class="no mn iu nk b gz np nq l nr ns">$ pre-commit --version</span><span id="fe41" class="no mn iu nk b gz nt nq l nr ns">pre-commit 2.17.0</span></pre><p id="ecaa" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated"><strong class="ld iv">事情是这样的:</strong>为了以简单的方式设置自动格式化工具，您需要在您的根项目目录中有一个特定的git配置文件。</p><p id="afbf" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">我们现在就去做吧。</p><h2 id="3fff" class="no mn iu bd mo nu nv dn ms nw nx dp mw lk ny nz my lo oa ob na ls oc od nc oe bi translated">设置配置文件</h2><p id="df8b" class="pw-post-body-paragraph lb lc iu ld b le ne jv lg lh nf jy lj lk ng lm ln lo nh lq lr ls ni lu lv lw in bi translated">根据文档，在我们的项目中，我们需要一个名为“<code class="fe of og oh nk b"><strong class="ld iv">.pre-commit-config.yaml</strong></code>”的预提交配置文件。</p><p id="0a0d" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">完成之后，让我们介绍一下代码片段，它告诉我们想要包含哪些钩子。我们现在想要的两个钩子是在每次提交之前在我们的python文件上运行:<strong class="ld iv"> black </strong>和<strong class="ld iv"> isort </strong>。</p><p id="0a71" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">这是他们的设置:</p><figure class="kl km kn ko gu kp"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="de63" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">所以，让我们分别看看这几行:</p><ul class=""><li id="5c17" class="ly lz iu ld b le lf lh li lk ma lo mb ls mc lw md me mf mg bi translated">第5–7行:前三个<code class="fe of og oh nk b">id</code>行是这样做的:第一行尝试加载所有yaml文件以验证它们的语法，第二行确保文件以一个新行结束，并且只有一个新行，最后一行检查尾随空格。</li><li id="c4f7" class="ly lz iu ld b le mh lh mi lk mj lo mk ls ml lw md me mf mg bi translated">第8–10行:这是<code class="fe of og oh nk b">black</code>的挂钩设置。它可以自动格式化你的Python代码，现在在整个行业中它的使用非常普遍。</li><li id="92df" class="ly lz iu ld b le mh lh mi lk mj lo mk ls ml lw md me mf mg bi translated">第12–16行:这是为<code class="fe of og oh nk b">isort</code>设置的钩子，它是一个在我们的代码中自动排序导入的库，所以我们不需要手动排序。</li></ul><p id="a8db" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">现在，为了将它们附加到我们的git配置中，让它们在每次提交之前运行，我们再运行一个命令:</p><pre class="kl km kn ko gu nj nk nl nm aw nn bi"><span id="8f23" class="no mn iu nk b gz np nq l nr ns"><strong class="nk iv">$ </strong>pre-commit install<br/>pre-commit installed at .git/hooks/pre-commit</span></pre><p id="f189" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">至此，我们已经成功地完成了项目的预提交挂钩的设置！到目前为止非常简单，对吗？</p><p id="6ff7" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">我们现在就去设置<code class="fe of og oh nk b"><strong class="ld iv">black</strong></code>和<code class="fe of og oh nk b"><strong class="ld iv">isort</strong></code>！幸运的是，只用一个配置文件就可以做到这一点。</p><h1 id="54db" class="mm mn iu bd mo mp mq mr ms mt mu mv mw ka mx kb my kd mz ke na kg nb kh nc nd bi translated">安装和设置black和isort</h1><p id="69d5" class="pw-post-body-paragraph lb lc iu ld b le ne jv lg lh nf jy lj lk ng lm ln lo nh lq lr ls ni lu lv lw in bi translated">安装这两个库也非常简单:</p><pre class="kl km kn ko gu nj nk nl nm aw nn bi"><span id="25b9" class="no mn iu nk b gz np nq l nr ns">pip install black isort</span></pre><p id="b62b" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">布莱克将其用法定义为:(来自其精彩的书面文件):</p><blockquote class="ok ol om"><p id="aba4" class="lb lc lx ld b le lf jv lg lh li jy lj on ll lm ln oo lp lq lr op lt lu lv lw in bi translated"><strong class="ld iv"> <em class="iu">黑色</em> </strong>通过产生尽可能小的差异来加快代码审查。不管你在读什么项目，黑化的代码看起来都一样。一段时间后，格式变得透明，您可以专注于内容。</p></blockquote><p id="2ec0" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">isort还将其用法简单定义为:</p><blockquote class="ok ol om"><p id="8913" class="lb lc lx ld b le lf jv lg lh li jy lj on ll lm ln oo lp lq lr op lt lu lv lw in bi translated"><strong class="ld iv"> isort </strong>是一个Python实用程序/库，用于按字母顺序对导入进行排序，并自动按类型分成几个部分。</p></blockquote><p id="e825" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">这里是我们需要为他们的设置制作的唯一文件:一个<code class="fe of og oh nk b"><strong class="ld iv">pyproject.toml</strong></code>文件。</p><p id="7c6e" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">这是我们想放进去的内容:</p><figure class="kl km kn ko gu kp"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="684b" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">当然，线长可以根据您自己或您的工作偏好而改变，black提供的许多其他可配置变量也是如此。</p><p id="481c" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">你可能会问，为什么我们要显式地使用这个特定的文件？以下是提供的理由:</p><blockquote class="ok ol om"><p id="1bc4" class="lb lc lx ld b le lf jv lg lh li jy lj on ll lm ln oo lp lq lr op lt lu lv lw in bi translated"><a class="ae la" href="https://www.python.org/dev/peps/pep-0518/" rel="noopener ugc nofollow" target="_blank"> PEP 518 </a>将<code class="fe of og oh nk b">pyproject.toml</code>定义为一个配置文件，用于存储Python项目的构建系统需求。</p></blockquote><p id="78d6" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">因此，实际上，项目根目录中的这个文件允许您为整个项目使用一个“<strong class="ld iv">全局</strong>”代码检查/修订配置。</p><p id="2ac1" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">让我们继续测试他们吧！</p><h1 id="5bc2" class="mm mn iu bd mo mp mq mr ms mt mu mv mw ka mx kb my kd mz ke na kg nb kh nc nd bi translated">测试我们的预提交挂钩</h1><p id="a19b" class="pw-post-body-paragraph lb lc iu ld b le ne jv lg lh nf jy lj lk ng lm ln lo nh lq lr ls ni lu lv lw in bi translated">当您在几个文件中编写或编辑了一些代码后，继续按照这个简单的过程来测试我们附加的钩子是否如预期的那样工作。</p><p id="e929" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">首先，我们需要在终端中添加带有我们的<code class="fe of og oh nk b"><strong class="ld iv">git add .</strong></code>的文件，或者您想要添加的任何文件组合。</p><p id="3d17" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">我正在我现有的<strong class="ld iv"> Django </strong>项目中测试这个。</p><p id="4676" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">现在，让我们运行<code class="fe of og oh nk b"><strong class="ld iv">git commit -m “a message here”</strong></code>。您将看到类似这样的内容:</p><figure class="kl km kn ko gu kp gi gj paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gi gj oq"><img src="../Images/37c670a1b057f59d53ca8b5ad7abe7a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KGaCmhBc7L0zf1LGov5ynA.png"/></div></div><p class="kw kx gk gi gj ky kz bd b be z dk translated">作者图片—第一次运行预提交挂钩</p></figure><p id="ecc7" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">这意味着我们的文件已经被预提交钩子所做的格式化修改了。</p><p id="6b59" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">当你现在运行命令<code class="fe of og oh nk b"><strong class="ld iv">git status</strong></code> <strong class="ld iv"> </strong>时，你会看到这样的东西:</p><figure class="kl km kn ko gu kp gi gj paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gi gj or"><img src="../Images/ddb268345a54006484fdd06174f2ae21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nq7df9z5iQETBAUTAx2Bhw.png"/></div></div><p class="kw kx gk gi gj ky kz bd b be z dk translated">按作者排序的图像—由挂钩运行修改的文件</p></figure><p id="03d1" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">所以<code class="fe of og oh nk b"><strong class="ld iv">views.py</strong></code>文件有一些行被执行的钩子修改了。去看看吧。</p><p id="f1bc" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated"><strong class="ld iv">这确保不会自动提交您修改的文件，并让您查看一次，以确保所有更改都是正确的。</strong></p><p id="4d92" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">作为一个有意的步骤，<strong class="ld iv">预提交</strong>永远不会修改我们的版本化代码的暂存区域。因为我们运行的任何钩子都可能有错误，撤销是一个巨大的痛苦<strong class="ld iv"> <em class="lx">在</em> </strong>提交之后，我们得到了一个额外的机会来查看是否一切正常。</p><p id="a898" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">现在，让我们继续添加并再次提交文件:</p><pre class="kl km kn ko gu nj nk nl nm aw nn bi"><span id="38fc" class="no mn iu nk b gz np nq l nr ns">git add .<br/>git commit -m "your message here" </span></pre><p id="6233" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">您现在将看到类似这样的输出:</p><figure class="kl km kn ko gu kp gi gj paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gi gj os"><img src="../Images/4ffae4f0ed63a597428b07b142281bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4mAbkvJhCZft2UWC6Se00Q.png"/></div></div><p class="kw kx gk gi gj ky kz bd b be z dk translated">图片作者—所有挂钩通过！</p></figure><p id="1905" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">这太棒了！我们已经成功地提交了应用了更改的代码！</p><h1 id="6b92" class="mm mn iu bd mo mp mq mr ms mt mu mv mw ka mx kb my kd mz ke na kg nb kh nc nd bi translated">一些遗言和参考</h1><p id="eddd" class="pw-post-body-paragraph lb lc iu ld b le ne jv lg lh nf jy lj lk ng lm ln lo nh lq lr ls ni lu lv lw in bi translated">我希望这篇快速教程很好地介绍了如何使用预提交钩子轻松地自动格式化代码，并且不需要手动干预。</p><p id="a5c3" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">以下是我使用过的一些资源，我也建议您阅读更多关于我在本文中提到的所有内容的信息:</p><ul class=""><li id="bb75" class="ly lz iu ld b le lf lh li lk ma lo mb ls mc lw md me mf mg bi translated"><a class="ae la" href="https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#configuration-via-a-file" rel="noopener ugc nofollow" target="_blank">黑色文件</a></li><li id="790f" class="ly lz iu ld b le mh lh mi lk mj lo mk ls ml lw md me mf mg bi translated"><a class="ae la" href="https://pycqa.github.io/isort/index.html" rel="noopener ugc nofollow" target="_blank">其他文件</a></li><li id="b5f0" class="ly lz iu ld b le mh lh mi lk mj lo mk ls ml lw md me mf mg bi translated"><a class="ae la" href="https://pre-commit.com" rel="noopener ugc nofollow" target="_blank">预提交挂钩文件</a></li><li id="0917" class="ly lz iu ld b le mh lh mi lk mj lo mk ls ml lw md me mf mg bi translated">GitHub的一个问题解释了为什么额外的提交步骤如此必要。</li></ul></div><div class="ab cl ot ou hy ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="in io ip iq ir"><p id="a1f9" class="pw-post-body-paragraph lb lc iu ld b le lf jv lg lh li jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw in bi translated">感谢您的阅读！:)</p></div></div>    
</body>
</html>