<html>
<head>
<title>Building a GraphQL Server in NestJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在NestJS中构建GraphQL服务器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-graphql-server-in-nestjs-f9ba34e773a3?source=collection_archive---------3-----------------------#2019-07-22">https://betterprogramming.pub/building-a-graphql-server-in-nestjs-f9ba34e773a3?source=collection_archive---------3-----------------------#2019-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3461" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">GraphQL基础和NestJS开发的最佳实践</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1c9a6246c8c7cdeb5e27be65f7fe8d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YFyFji4BSxdORR7i"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@jantined?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jantine Doornbos </a>拍摄的照片</p></figure><p id="1d52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NestJS通过为Node.js提供开箱即用的适当模块化和可测试的结构，引入了一种使用node . js构建后端应用程序的现代时尚方法。默认情况下，它还提供了TypeScript和依赖注入支持，这大大提高了我们项目中的代码质量。</p><p id="2ec2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我们将通过使用MongoDB构建一个简单的数据库CRUD应用程序，来深入了解如何使用NestJS框架构建一个GraphQL服务器。</p><p id="1179" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，您将学习GraphQL的基础知识和NestJS开发的一些最佳实践。</p><p id="3e2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，不要再浪费时间了，让我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3c38" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先决条件</h1><p id="8acf" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要阅读这篇文章，我建议您了解这些技术的基本知识，并安装最新的工具:</p><ul class=""><li id="c5ad" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">通过阅读这个<a class="ae ky" href="https://medium.com/free-code-camp/a-crash-course-in-typescript-e6bf9c10946" rel="noopener">速成班</a>，你可以获得使用JavaScript构建应用程序的合理知识和基本的TypeScript知识</li><li id="f0c6" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">NestJS及其构建模块的基础知识，可以在<a class="ae ky" href="https://gabrieltanner.org/blog/nestjs-crashcourse" rel="noopener ugc nofollow" target="_blank">这篇文章</a>中找到</li><li id="8764" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">安装在本地系统上的<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a></li><li id="7e62" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">GraphQL基础知识</li></ul><p id="f02c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你以前没有使用这些技术的经验，我建议你在继续这篇文章之前，使用列出的资源来获得基本知识。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="be00" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">GraphQL基础知识</h1><p id="249c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">GraphQL是一种查询语言和运行时，可用于将API构建和公开为强类型模式，而不是杂乱的REST端点。用户可以看到该模式，并可以查询他们特别想要的字段。</p><p id="3937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是您需要了解的一些关键概念:</p><ul class=""><li id="6759" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">模式GraphQL服务器实现的核心。描述客户端应用程序可用的功能</li><li id="abae" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">查询—请求读取或获取值</li><li id="a6ca" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">突变—修改数据存储中数据的查询</li><li id="1b17" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">类型—定义GraphQL中使用的数据结构</li><li id="43b4" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">解析器—为GraphQL查询生成响应的函数集合</li></ul><p id="a2fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NestJS为我们提供了两种不同的构建GraphQL应用程序的方式，分别是模式优先和代码优先。</p><ul class=""><li id="023f" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">模式优先——在模式优先方法中，事实的来源是GraphQL SDL(模式定义语言),并且您的GraphQL模式的类型定义将由NestJS自动生成</li><li id="6c31" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">代码优先—在代码优先方法中，您将只在您的TypeScript类中使用声明符来生成相应的GraphQL模式</li></ul><p id="6e77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我选择了代码优先的方法，因为我个人发现对于没有GraphQL经验的人来说，这种方法更容易理解和遵循本教程。</p><p id="73aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想了解更多关于GraphQL及其概念的信息，我强烈建议您查看以下资源:</p><ul class=""><li id="1e7e" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">官方<a class="ae ky" href="https://graphql.org/learn/" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="b173" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><a class="ae ky" href="https://www.howtographql.com/" rel="noopener ugc nofollow" target="_blank"> How to GraphQL </a> —伟大的初学者学习资源</li><li id="b4bf" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=ed8SzALpx1Q" rel="noopener ugc nofollow" target="_blank"> GraphQL速成班</a> —使用GraphQL和React的完整速成班</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3021" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">安装NestJS及其依赖项</h1><p id="e708" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">既然我们知道了我们将要构建什么，以及为什么我们要使用每一种特定的工具和技术，那么让我们从创建项目和安装所需的依赖项开始吧。</p><p id="aa8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们安装Nest CLI并使用它来创建项目</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="3991" class="ns md it no b gy nt nu l nv nw">npm i -g @nestjs/cli<br/>nest new nest-graphql</span></pre><p id="6233" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，让我们进入目录并安装所需的依赖项</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="2b61" class="ns md it no b gy nt nu l nv nw">cd nest-graphql<br/>npm i --save @nestjs/graphql apollo-server-express graphql-tools graphql @nestjs/mongoose mongoose type-graphql</span></pre><p id="eefe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经安装好了所有的东西，基本的项目设置也已经就绪，让我们来创建要使用的文件。</p><p id="4640" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从使用NestJS CLI创建<code class="fe nx ny nz no b">Module</code>、<code class="fe nx ny nz no b">Service</code>和<code class="fe nx ny nz no b">Controller</code>开始</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="f380" class="ns md it no b gy nt nu l nv nw">nest g module items<br/>nest g service items<br/>nest g resolver items</span></pre><p id="5827" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，手动创建文件和文件夹，使您的结构如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/d52c17142319b26c38b0b11dae7a6306.png" data-original-src="https://miro.medium.com/v2/resize:fit:392/format:webp/1*1jaLhf_OzhKaiTu8K-EAxw.png"/></div></figure><p id="198a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也可以在<a class="ae ky" href="https://github.com/TannerGabriel/Blog/tree/master/nest-graph-ql" rel="noopener ugc nofollow" target="_blank"> my GitHub </a>上找到这个结构。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3e20" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">启动服务器</h1><p id="701c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">设置过程完成后，您现在可以使用以下命令启动服务器:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="53d1" class="ns md it no b gy nt nu l nv nw">npm run start</span></pre><p id="debf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在默认端口3000上启动应用程序。现在，您只需在浏览器中导航到<a class="ae ky" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，应该会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/ef0cffe1b9e0b9306de131f7a30b5f03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*nuDISQ8HlI0BNBRKvfZ2PA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">NestJS Hello World</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="26e2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">添加GraphQL</h1><p id="08dd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们已经完成了基本的服务器设置，让我们继续将GraphQL依赖项导入到我们的应用程序模块中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="aa61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们从<code class="fe nx ny nz no b">@nest/graphql</code>导入<code class="fe nx ny nz no b">GraphQLModule</code>，我们安装在上面。之后，我们在imports语句中使用它，使用的是将一个<code class="fe nx ny nz no b">option</code>对象作为参数的<code class="fe nx ny nz no b">forRoot()</code>方法。</p><p id="a1e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nx ny nz no b">options</code>文件中，我们指定了启动服务器时自动生成的GraphQL文件的名称。这个文件是我们上面讨论的代码优先方法的一部分。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9133" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">与MongoDB连接</h1><p id="6682" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">接下来，让我们通过将<code class="fe nx ny nz no b">MongooseModule</code>导入到<code class="fe nx ny nz no b">ApplicationModule</code>中来创建一个到应用程序数据库的连接。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="c919" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们使用<code class="fe nx ny nz no b">forRoot()</code>函数，它接受与我们习惯的<code class="fe nx ny nz no b">mongoose.connect()</code>函数相同的配置对象。</p><h2 id="38c3" class="ns md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">数据库模式</h2><p id="241a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">数据模式用于正确构建将存储在应用程序数据库中的数据类型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="9da7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们通过导入<code class="fe nx ny nz no b">mongoose</code>并使用<code class="fe nx ny nz no b">mongoose.Schema</code>创建一个新对象来定义一个模式。</p><h2 id="52c6" class="ns md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">连接</h2><p id="15f2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">接下来，我们将创建一个TypeScript接口，用于我们的服务和接收器中的类型检查。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="345b" class="ns md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">数据传输对象</h2><p id="2360" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">DTO(数据传输对象)是定义数据如何通过网络发送的对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="97eb" class="ns md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">导入模式</h2><p id="de07" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">既然我们已经为数据库创建了所有需要的文件，我们只需要将我们的模式导入到我们的<code class="fe nx ny nz no b">ItemsModule</code>中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="4006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们像在<code class="fe nx ny nz no b">ApplicationModule</code>中一样导入<code class="fe nx ny nz no b">MongooseModule</code>，但是使用了<code class="fe nx ny nz no b">forFeature()</code>函数，它定义了将为当前范围注册什么数据库模型。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8ddc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">实现GraphQL CRUD</h1><p id="3a5b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们继续使用Mongoose数据库和GraphQL端点来实现CRUD功能。</p><h2 id="703b" class="ns md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">服务</h2><p id="f952" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，让我们在服务内部创建数据库CRUD功能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="6370" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们首先使用依赖注入在构造函数中导入数据库模型。之后，我们继续使用标准的MongoDB函数实现基本的CRUD功能。</p><h2 id="1777" class="ns md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">分解器</h2><p id="fece" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">既然我们已经在服务中实现了CRUD功能，我们只需要创建我们的GraphQL解析器，在这里我们定义GraphQL所需的<code class="fe nx ny nz no b">Querys</code>和<code class="fe nx ny nz no b">Mutations</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="866d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们用不同的方法创建了一个类，这些方法利用了我们之前创建的ItemService。但是这个类也有一些非常有趣的声明符，所以让我们来看看它们:</p><ul class=""><li id="8097" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><code class="fe nx ny nz no b">@Resolver()</code> —告诉Nestjs这个类知道如何为我们的项目解析动作。</li><li id="2109" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nx ny nz no b">@Query()</code>—graph QL中的查询基本上是客户端用来向服务器请求特定字段的结构。在这种情况下，声明符只是说，我们可以使用函数名进行查询，我们稍后会这样做。</li><li id="3561" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nx ny nz no b">@Mutation()</code>—graph QL中的突变与Querys非常相似，但更多的是对数据进行突变而不是查询。</li><li id="90f5" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nx ny nz no b">@Args()</code> —是一个帮助声明器，用于挖掘输入参数</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7bd9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">E2E测试应用程序</h1><p id="d33f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们已经完成了CRUD功能，让我们看看如何使用Jest测试库来测试我们的应用程序。</p><p id="e49e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您以前从未使用过Jest，我建议您在继续本节之前先学习基础知识。</p><p id="636a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要使用下面的命令创建一个新的测试文件。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="25df" class="ns md it no b gy nt nu l nv nw">touch test/items.e2e-spect.ts </span></pre><p id="9eb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们可以继续为我们的模块创建基本的测试设置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="745a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个代码块中，我们用测试AppController所需的三个模块创建了一个Nestjs实例。我们还定义了当所有测试都完成时，实例将被关闭。</p><p id="c814" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们创建两个将在HTTP请求中使用的item对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="22f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们可以创建一个GraphQL查询来测试项目创建功能，并在我们的HTTP请求中使用它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="d3b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们创建一个查询，并使用request函数将其发送到我们的端点，该函数允许我们模拟对服务器的HTTP请求。</p><p id="4bb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以使用expect函数来验证请求的响应。</p><p id="52fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个过程可以对所有端点重复，并留给我们以下结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="b99a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，现在我们只需要使用下面的命令来运行测试。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="0517" class="ns md it no b gy nt nu l nv nw">npm run test:e2e</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c4ec" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试应用程序</h1><p id="7e1d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们已经完成了简单CRUD应用程序的构建，让我们使用GraphQL playground来测试它。为此，让我们启动服务器，然后导航到我们的游乐场:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="cb2b" class="ns md it no b gy nt nu l nv nw">npm run start</span></pre><p id="1219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">启动服务器后，您应该能够在<a class="ae ky" href="http://localhost:3000/graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/graph QL</a>上看到您的GraphQL playground。</p><p id="4d58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们继续编写一个创建项目的变异。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/552aa2e4d1a329778e35daa67f51ad8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nNBnkSwanZui8wmYBx3seg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建图表项目</p></figure><p id="ab3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，让我们使用这个简单的查询来测试我们的<code class="fe nx ny nz no b">get</code>功能:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/642886711c410ab3e1ea45e82ae02b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TZU9evWEWe-8S_3TdWFGBw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">获取所有项目</p></figure><p id="5cea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在只剩下更新和删除功能。为此，我们将需要我们之前创建的项目的<code class="fe nx ny nz no b">id</code>,您可以通过使用我们的<code class="fe nx ny nz no b">items</code>查询来获得它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/e4249f008f10430bf8c92cfb2eeae504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9OUZ3Ipyo1pQmbosMZTXg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">获取项目响应</p></figure><p id="4b3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们在接下来的两个动作中使用这个<code class="fe nx ny nz no b">id</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/dd3e62b7df55bf421c108307cb8899f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H86QxA8SWWIl_waLT-Oquw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更新现有项目</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/671b4e9ef760e6011734c4b526b8012f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wtUTR1uZcpJ0pwWw7hCNw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">删除项目</p></figure><p id="0a6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整个项目也可以在我的Github上找到:</p><div class="ou ov gp gr ow ox"><a href="https://github.com/TannerGabriel/Blog/tree/master/nest-graph-ql" rel="noopener  ugc nofollow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd iu gy z fp pc fr fs pd fu fw is bi translated">TannerGabriel/博客</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">我所有博客项目的存储库。在GitHub上创建一个帐户，为TannerGabriel/博客的发展做出贡献。</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">github.com</p></div></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9188" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">推荐阅读</h1><div class="ou ov gp gr ow ox"><a href="https://medium.com/free-code-camp/a-crash-course-in-typescript-e6bf9c10946" rel="noopener follow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd iu gy z fp pc fr fs pd fu fw is bi translated">打字稿速成班</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">Typescript是javascript的类型化超集，旨在简化大型javascript应用程序的开发…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">medium.com</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl ks ox"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ed56" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="dae0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你一直坚持到最后！我希望这篇文章能帮助您理解GraphQL的基础知识以及如何在NestJS中使用它。</p><p id="b100" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您发现这很有用，请考虑推荐并与其他开发人员分享。如果你有任何问题或反馈，请在下面的评论中告诉我。</p><p id="496c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想获得我博客的持续更新，请确保在Medium上关注我，并<a class="ae ky" href="https://gabrieltanner.us20.list-manage.com/subscribe/post?u=9d67fc028348a0eb71318768e&amp;amp;id=6845ed3555" rel="noopener ugc nofollow" target="_blank">加入我的时事通讯</a>。</p><blockquote class="pm pn po"><p id="9b2b" class="kz la pp lb b lc ld ju le lf lg jx lh pq lj lk ll pr ln lo lp ps lr ls lt lu im bi translated">最初发表于gabrieltanner.org的<a class="ae ky" href="https://gabrieltanner.org/blog/nestjs-graphqlserver" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote></div></div>    
</body>
</html>