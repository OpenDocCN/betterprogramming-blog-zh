<html>
<head>
<title>Real-Time Video Streams With Streamlit-WebRTC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Streamlit-WebRTC的实时视频流</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/real-time-video-streams-with-streamlit-webrtc-bd38d15f2ef3?source=collection_archive---------0-----------------------#2021-11-17">https://betterprogramming.pub/real-time-video-streams-with-streamlit-webrtc-bd38d15f2ef3?source=collection_archive---------0-----------------------#2021-11-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b217" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过网络处理和传输实时视频</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/377c7e3f83d4f2d8e9e68d2ca3fb3a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3h0awJSPITIaiw3_86Qaw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/s/photos/video-call?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">上的<a class="ae ky" href="https://unsplash.com/@surface?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">表面</a>和</a>组成</p></figure><p id="841b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读这篇文章，你将学会用实时视频和音频流构建一个可共享的web应用程序。这对于展示任何计算机视觉和音频处理相关的项目都非常有用。整个实现将完全在Python中，可以通过URL从他们的智能手机或具有网络摄像头功能的计算机访问它。</p><p id="061c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看下面的gif，它展示了我过去的一个基于AnimeGANv2 的<a class="ae ky" href="https://github.com/bryandlee/animegan2-pytorch" rel="noopener ugc nofollow" target="_blank"> PyTorch实现的研究项目。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/9102100f94aa0509e2788e8e814dedf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FRKkjpc__UNlakpvQxwjIg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者Gif</p></figure><p id="c1ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程涵盖了使用名为<a class="ae ky" href="https://github.com/whitphx/streamlit-webrtc" rel="noopener ugc nofollow" target="_blank"> streamlit-webrtc </a>的Python包创建实时视频流web应用程序的基本实现。基于Github中的官方库，这个包提供了</p><blockquote class="lw lx ly"><p id="c5a4" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">…通过Streamlit实现网络上的实时视频和音频流。</p></blockquote><p id="bfc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它建立在<a class="ae ky" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>之上，Streamlit是一个开源框架，可以将Python数据脚本转换为可共享的web应用。</p><p id="ab47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续下一部分，开始安装必要的模块。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="3e53" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">设置</h1><p id="e3ff" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">强烈建议您在继续安装之前创建一个新的虚拟环境。</p><p id="8767" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">激活它并运行以下命令来安装<code class="fe nh ni nj nk b">streamlit-webrtc</code>:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="fe2e" class="np ml it nk b gy nq nr l ns nt">pip install streamlit-webrtc</span></pre><p id="d7e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装可能需要一些时间，因为streamlit需要相当多的依赖项。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="89af" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">履行</h1><p id="10fa" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在同一个工作目录中，创建一个名为<code class="fe nh ni nj nk b">app.py</code>的新文件。</p><h2 id="84d6" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">导入</h2><p id="6bd9" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在文件顶部添加以下导入语句:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="09de" class="np ml it nk b gy nq nr l ns nt">import streamlit as st<br/>from streamlit_webrtc import webrtc_streamer, VideoProcessorBase, RTCConfiguration<br/>import av<br/>import threading</span></pre><p id="72e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">av</code>包含FFmpeg库的Pythonic绑定。它将用于从一个<code class="fe nh ni nj nk b">PIL.Image</code>或numpy数组构建一个帧。</p><p id="96c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，<code class="fe nh ni nj nk b">threading</code>在回调中访问/传递变量时提供了线程安全。</p><h2 id="6204" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">页面配置</h2><p id="169f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">您可以通过调用<code class="fe nh ni nj nk b">set_page_config</code>函数来设置网页的标题和图标。</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="edca" class="np ml it nk b gy nq nr l ns nt">st.set_page_config(page_title="Streamlit WebRTC Demo", page_icon="🤖")</span></pre><h2 id="5cd6" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">补充报道</h2><p id="92fb" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">接下来，添加下面的代码，它将为任务选择创建一个侧栏。</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="af35" class="np ml it nk b gy nq nr l ns nt">task_list = ["Video Stream"]</span><span id="4039" class="np ml it nk b gy of nr l ns nt">with st.sidebar:<br/>    st.title('Task Selection')<br/>    task_name = st.selectbox("Select your tasks:", task_list)<br/>st.title(task_name)</span></pre><p id="5635" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我只为这个应用程序设置了一个任务。它将在web应用程序的左侧呈现以下用户界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/97a606847dd19eecf73a767cf5f80c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*wLvMwriOszOEt0i7pcdNCA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="a2b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以轻松设置多个任务，并在单个应用程序中独立运行它们。您需要做的就是添加条件检查代码，并相应地实例化相应的小部件。举个例子，</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="42d2" class="np ml it nk b gy nq nr l ns nt">if task_name == task_list[0]:<br/>    style_list = ['color', 'black and white']</span><span id="4c58" class="np ml it nk b gy of nr l ns nt">st.sidebar.header('Style Selection')<br/>    style_selection = st.sidebar.selectbox("Choose your style:", style_list)</span></pre><p id="8a31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用户选择第一个任务时，上面的代码将在侧边栏创建一个额外的标签和下拉列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/0f3faa46ade21984f0c73f5f93221ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*v4N00p2aTRBOnmgavFHYvA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="75ce" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">视频处理器</h2><p id="60a1" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">完成后，让我们创建一个继承自<code class="fe nh ni nj nk b">VideoProcessorBase</code>的<code class="fe nh ni nj nk b">VideoProcessor</code>类，函数如下:</p><ul class=""><li id="c652" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated"><code class="fe nh ni nj nk b">init</code>:任何初始化代码都应该放在这里</li><li id="de39" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated"><code class="fe nh ni nj nk b">recv</code>:接收并返回帧的回调方法。该帧是<a class="ae ky" href="https://pyav.org/docs/develop/api/video.html#av.video.frame.VideoFrame" rel="noopener ugc nofollow" target="_blank"> av的实例。视频框</a>。你应该在这个回调中调用所有的图像处理方法。</li></ul><p id="0438" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，实例化该类，并传入以下参数:</p><ul class=""><li id="0300" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated"><code class="fe nh ni nj nk b">key</code>:唯一标识符。只需使用任意字符串</li><li id="f2c5" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated"><code class="fe nh ni nj nk b">video_processor_factory</code> : <code class="fe nh ni nj nk b">VideoProcessorBase</code>实例类</li></ul><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="59b5" class="np ml it nk b gy nq nr l ns nt">class VideoProcessor(VideoProcessorBase):<br/>    def __init__(self):<br/>        self.style = 'color'</span><span id="5021" class="np ml it nk b gy of nr l ns nt">    def recv(self, frame):<br/>        img = frame.to_image()<br/>        <br/>        # image processing code here<br/>    <br/>        return av.VideoFrame.from_image(img)</span><span id="2f72" class="np ml it nk b gy of nr l ns nt">webrtc_streamer(key="vpf", video_processor_factory=VideoProcessor)</span></pre><p id="903b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">recv</code>函数中的代码基于PIL。如果您更喜欢使用opencv，请修改如下:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="fe02" class="np ml it nk b gy nq nr l ns nt">class VideoProcessor(VideoProcessorBase):<br/>    def __init__(self):<br/>        self.style = 'color'</span><span id="4b94" class="np ml it nk b gy of nr l ns nt">def recv(self, frame):<br/>        img = frame.to_ndarray(format="bgr24")<br/>        <br/>        # image processing code here<br/>    <br/>        return av.VideoFrame.from_ndarray(img, format="bgr24")</span><span id="68d4" class="np ml it nk b gy of nr l ns nt">webrtc_streamer(key="vpf", video_processor_factory=VideoProcessor)</span></pre><p id="4554" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设当用户选择第二种风格选项时，您打算将视频流更改为黑白。您可以简单地修改<code class="fe nh ni nj nk b">recv</code>功能，如下所示:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="4064" class="np ml it nk b gy nq nr l ns nt">def recv(self, frame):<br/>    img = frame.to_image()<br/>        <br/>    # image processing code here<br/>    # using PIL to convert img to greyscale<br/>    if self.style == style_list[1]:<br/>        img = img.convert("L")</span><span id="b5fd" class="np ml it nk b gy of nr l ns nt">    return av.VideoFrame.from_image(img)</span></pre><p id="2303" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，回调方法在不同的线程中执行时有一些限制:</p><ul class=""><li id="ba78" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated">任何streamlit方法在<code class="fe nh ni nj nk b">recv()</code>内部都不起作用。这包括所有的<code class="fe nh ni nj nk b">st.</code>功能，如<code class="fe nh ni nj nk b">st.write()</code></li><li id="6440" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">您不能引用回调之外的任何变量(即使您使用了global关键字)</li><li id="334d" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">当从回调外部和内部访问相同的对象时，您需要小心并实现线程安全的代码。</li></ul><p id="e6be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">话虽如此，您可以利用以下技巧来传递变量:</p><ul class=""><li id="a2bc" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated">初始化<code class="fe nh ni nj nk b">init</code>功能中的变量</li><li id="a3e7" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">从<code class="fe nh ni nj nk b">webrtc_streamer</code>获取上下文对象并直接操作变量</li></ul><p id="d7f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下示例说明了当用户从下拉列表中选择一个选项时，如何更改<code class="fe nh ni nj nk b">style</code>值。</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="599d" class="np ml it nk b gy nq nr l ns nt">st.sidebar.header('Style Selection')<br/>style_selection = st.sidebar.selectbox("Choose your style:", style_list)</span><span id="e585" class="np ml it nk b gy of nr l ns nt">...</span><span id="1370" class="np ml it nk b gy of nr l ns nt">ctx = webrtc_streamer(key="vpf", video_processor_factory=VideoProcessor)</span><span id="af61" class="np ml it nk b gy of nr l ns nt">if ctx.video_processor:<br/>    ctx.video_processor.style = style_selection</span></pre><p id="9e55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">处理复杂物体时考虑使用<code class="fe nh ni nj nk b">threading.Lock</code>。例如，您可以按如下方式更新样式:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="ffcf" class="np ml it nk b gy nq nr l ns nt">st.sidebar.header('Style Selection')<br/>style_selection = st.sidebar.selectbox("Choose your style:", style_list)</span><span id="1fe4" class="np ml it nk b gy of nr l ns nt">...</span><span id="9dd9" class="np ml it nk b gy of nr l ns nt">class VideoProcessor(VideoProcessorBase):<br/>    def __init__(self):<br/>        self.model_lock = threading.Lock()<br/>        self.style = style_list[0]</span><span id="f3fc" class="np ml it nk b gy of nr l ns nt">    def update_style(self, new_style):<br/>        if self.style != new_style:<br/>            with self.model_lock:<br/>                self.style = new_style</span><span id="2d9b" class="np ml it nk b gy of nr l ns nt">...</span><span id="618f" class="np ml it nk b gy of nr l ns nt">ctx = webrtc_streamer(key="vpf", video_processor_factory=VideoProcessor)</span><span id="0bfc" class="np ml it nk b gy of nr l ns nt">if ctx.video_processor:<br/>    ctx.video_transformer.update_style(style_selection)</span></pre><h2 id="4eba" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">WebRTC配置</h2><p id="4e07" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">除此之外，您可以向<code class="fe nh ni nj nk b">webrtc_stream</code>传递额外的参数:</p><ul class=""><li id="a31b" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated"><code class="fe nh ni nj nk b">media_stream_constraints</code>:接受代表<code class="fe nh ni nj nk b">getUserMedia</code>函数的<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#parameters" rel="noopener ugc nofollow" target="_blank">约束</a>的字典。</li><li id="685b" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated"><code class="fe nh ni nj nk b">rtc_configuration</code> : <code class="fe nh ni nj nk b">RTCConfiguration</code>眩晕或转身服务器的对象。供您参考，STUN指的是NAT的会话遍历实用程序。它能够识别客户端的公共地址、它们背后的NAT类型以及通过NAT与特定本地端口关联的互联网端端口。如果您打算通过IP或域名远程提供应用程序，则需要此设置。如果您在localhost下工作，可以安全地忽略这一点。</li></ul><p id="1497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">初始化下面的配置，它包含了Google的STUN服务器的url。您可以根据自己的喜好随意使用任何其他STUN服务器:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="2af7" class="np ml it nk b gy nq nr l ns nt">RTC_CONFIGURATION = RTCConfiguration(<br/>    {"iceServers": [{"urls": ["stun:stun.l.google.com:19302"]}]}<br/>)</span></pre><p id="9d58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，简单地如下初始化<code class="fe nh ni nj nk b">webrtc_streamer</code>:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="e214" class="np ml it nk b gy nq nr l ns nt">ctx = webrtc_streamer(<br/>        key="example",<br/>        video_processor_factory=VideoProcessor,<br/>        rtc_configuration=RTC_CONFIGURATION,<br/>        media_stream_constraints={<br/>            "video": True,<br/>            "audio": False<br/>        }<br/>    )</span></pre><p id="80e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在以下<a class="ae ky" href="https://gist.github.com/wfng92/c60994e046df02065827d1ef3832977d" rel="noopener ugc nofollow" target="_blank">要点</a>中找到完整的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="b42f" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">试验</h1><p id="8b98" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">保存文件并在终端上运行以下命令:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="3f98" class="np ml it nk b gy nq nr l ns nt">streamlit run app.py</span></pre><p id="b1e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将通过您的默认浏览器打开一个指向以下URL的新网页:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="6149" class="np ml it nk b gy nq nr l ns nt">http://localhost:8501/</span></pre><p id="68e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到以下用户界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/04a796af4fc4ac26064a6bd7c0252b3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JCRuJ2FDMp4MaSswfqYBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="ff6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<code class="fe nh ni nj nk b">START</code>按钮，它会询问您是否允许使用相机和音频。之后，您应该会看到您的网络摄像头拍摄的视频流。</p><p id="ae13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当调用<code class="fe nh ni nj nk b">streamlit run</code>命令时，您可以传递额外的选项。例如，以下命令将其设置为无头，并将端口更改为8005而不是8051(默认):</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="021d" class="np ml it nk b gy nq nr l ns nt">streamlit run app.py --server.headless true --server.port 8005</span></pre></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="60ab" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">HTTPS</h1><p id="82ca" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">请注意，此包仅在安全上下文中工作，因为它使用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" rel="noopener ugc nofollow" target="_blank"> getUserMedia </a>来访问本地媒体设备。从官方文件来看，它声明…</p><blockquote class="lw lx ly"><p id="a43c" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">简而言之，安全上下文是使用HTTPS或file:/// URL方案加载的页面，或者是从localhost加载的页面。</p></blockquote><p id="a95e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您将应用程序托管在远程服务器上，则必须将其部署为HTTPS。考虑阅读我以前的<a class="ae ky" href="https://levelup.gitconnected.com/how-to-proxy-https-traffic-to-your-development-server-63c9980d5899" rel="noopener ugc nofollow" target="_blank">文章</a>,了解开发期间代理HTTPS流量的快速解决方案:</p><ul class=""><li id="1cfd" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated"><a class="ae ky" href="https://levelup.gitconnected.com/how-to-proxy-https-traffic-to-your-development-server-63c9980d5899" rel="noopener ugc nofollow" target="_blank">如何将HTTPS流量代理到您的开发服务器</a></li></ul></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="4651" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">结论</h1><p id="0206" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">让我们回顾一下你今天所学的内容。</p><p id="8f0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文首先简要介绍了streamlit和webrtc。然后，它通过<code class="fe nh ni nj nk b">pip install</code>进入安装过程。</p><p id="300b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还介绍了设置侧栏和更改页面配置。随后，它为<code class="fe nh ni nj nk b">VideoProcessor</code>类提供了深入的解释，以及如何为您自己的用例扩展它。</p><p id="25fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，它讨论了在命令行上运行应用程序，以及在远程服务器上托管时，在安全的上下文中服务web应用程序的需要。</p><p id="f54e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢你阅读这篇文章。祝你有美好的一天！</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="0037" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">参考</h1><ol class=""><li id="3a18" class="oi oj it lb b lc nc lf nd li oz lm pa lq pb lu pc oo op oq bi translated"><a class="ae ky" href="https://github.com/whitphx/streamlit-webrtc" rel="noopener ugc nofollow" target="_blank"> GitHub — streamlit-webrtc </a></li><li id="862d" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu pc oo op oq bi translated"><a class="ae ky" href="https://docs.streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit —文档</a></li></ol></div></div>    
</body>
</html>