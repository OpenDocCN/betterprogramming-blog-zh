# 通过错误配置的路径成为根

> 原文：<https://betterprogramming.pub/becoming-root-via-a-misconfigured-path-720a52981c93>

## 利用错误配置的路径变量提升 Linux 权限

![](img/be139d383245bccb89cee981e3f88fa6.png)

凯文·霍尔瓦特在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片。

欢迎回到 Linux 安全系列！在本系列中，我们将讨论影响 Linux 系统的安全问题以及导致这些问题的常见错误配置。我们开始吧！

权限提升是攻击者提升系统权限的一种方式。例如，假设一个攻击者已经获得了对您的 web 服务器的访问权，但只是作为一个低特权用户。他们不能读写敏感文件、执行脚本或更改系统配置。他们如何危害您的服务器并保持对服务器的访问？

如果他们可以找到一种方法来欺骗系统，使其认为自己是根用户，攻击者就可以进行更强大的攻击，如读写敏感文件和在系统中插入永久性后门。这就是特权升级的由来。

今天，我们来谈谈攻击者如何利用配置错误的路径变量来利用根用户运行具有根权限的脚本。

# **什么是路径变量？**

环境变量是系统环境中影响程序运行方式的变量。例如，一些常见的环境变量包括当前用户的主目录、当前用户的默认 shells 和可执行文件的路径。您可以使用以下命令查看您的环境变量:

```
$ printenv
```

`PATH`变量是一个环境变量，包含一个由冒号分隔的路径列表。每次执行命令时，Unix 都会在这些目录中搜索与命令名匹配的可执行文件。如果执行存储在这些位置中的任何文件，则在运行该文件时不必指定其绝对路径。

例如，`ls`命令用于列出当前目录中的文件。而`ls`命令的二进制文件通常位于`/bin`目录中。但是您不必键入`/bin/ls`来执行命令，因为`/bin`目录被添加到您的`PATH`变量中。当您在没有指定绝对路径的情况下键入一个命令名时，您的 shell 将搜索`PATH`列表中的每个目录，以查找具有该名称的可执行文件。然后，shell 将运行它找到的第一个匹配程序。

您可以通过执行以下命令来显示您的`PATH`变量:

```
$ echo $PATH
```

您可以使用以下命令更新您的`PATH`变量:

```
$ export PATH=”new-path-here”
```

# 问题是

那么这个功能有什么问题呢？

在 Linux 文件路径中，单个点(`.`)表示当前目录。你可以通过输入`./script_name`来运行当前目录下的程序。有时，用户将`.`添加到他们的`PATH`变量中，这样他们就可以在当前目录下运行程序，而不需要输入额外的`./`。例如，如果您将`.`添加到您的`PATH`变量中，您可以通过键入`maintenance.sh`而不是`./maintenance.sh`来运行当前目录中名为`maintenance.sh`的 shell 脚本。

当在可执行文件的原始路径前添加“点”路径时，shell 将在命令运行时首先搜索当前目录，然后再查找其他目录。这意味着攻击者可以用命令名来命名他们的脚本，并使用户执行恶意脚本而不是合法命令。

例如，假设一个具有 root 权限的管理员在他们的路径中有一个点目录。当他们执行`ls`命令时，在寻找位于`/bin/ls`的合法程序之前，shell 将首先在当前目录中搜索名为`ls`的可执行文件。这给了攻击者一个独特的机会:如果攻击者可以在一个目录中植入一个名为`ls`的恶意可执行文件，并诱使管理员在该目录中执行该命令，他们就可以诱使管理员以 root 权限执行该恶意脚本！

# 袭击

假设攻击者想要将自己添加为系统的 root 用户，并且他们知道具有 root 权限的管理员在他们的`PATH`变量中有“点”路径。他们可以将这个恶意脚本植入一个公开可写的目录，比如`/tmp`目录，并将其命名为`ls`。现在，当管理员用户执行`ls`命令和`/tmp`目录时，他们将执行这个脚本，而不是实际的`/bin/ls`二进制文件:

```
echo “vickie::0:0:System Administrator:/root/root:/bin/bash” >> /etc/passwd/bin/ls
```

该脚本的第一行向`/etc/passwd`文件添加了一个新的 root 用户。由于`0`是 root 用户的 UID，添加一个 UID 为`0`的用户将会给这个用户 root 权限。该用户将拥有用户名`vickie`和一个空密码。这个命令对于普通用户来说通常是不可能的，因为只有特权用户才能修改`/etc/password`文件。然后，脚本执行合法的`/bin/ls`命令来列出目录内容，并欺骗管理员认为他们执行了正确的命令。

# 注意安全！

将“点”路径添加到您的`PATH`变量是非常危险的，您可能会意外地给攻击者机会来提升您系统上的权限。相反，花时间在命令中输入额外的`./`来执行当前目录中的程序！

感谢阅读！下一次，我们将深入探讨攻击者可以用来危害您的系统的更多特权提升技术。