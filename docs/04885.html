<html>
<head>
<title>Make Your Python Code Dramatically Faster With Cython</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Cython显著提高Python代码的速度</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/make-your-python-code-dramatically-faster-with-cython-2a307253234b?source=collection_archive---------6-----------------------#2020-05-19">https://betterprogramming.pub/make-your-python-code-dramatically-faster-with-cython-2a307253234b?source=collection_archive---------6-----------------------#2020-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a7d3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">只需几个步骤就可以将C语言引入Python代码！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6176bc1a7dcbc7b140d9cad9e1d7a3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jDvCoE2T0GjaOcdf"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@i_am_g?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Guillaume Jaillet </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b1a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你肯定听过很多人抱怨Python太慢了。我看到人们仅在性能方面将Python与C进行比较，但他们不会在快速开发的背景下进行比较。Python开发时间这么快，是因为不用处理指针、内存管理等。</p><p id="21f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这也是我们公司使用Python的原因之一。在大多数情况下，开发时间比性能更重要。Python有一个很好的社区和很好的库，可以满足你大部分时间的需求。也就是说，我将在本文中讨论Cython，以提高Python代码的速度。让我们开始吧！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="308d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">cy thon:Python的C扩展</h1><p id="9c55" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你喜欢Python那样的简单语法，C那样的高性能吗？Cython是你想要的。可以使用Cython为Python编写C扩展。您的代码将被翻译成优化的C/C++代码。它将给你带来高性能，你可以在你的Python项目中使用它。</p><h2 id="48f6" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">安装Cython</h2><p id="32ea" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">请注意，您将需要一个C编译器。你可以基于你的操作系统得到一个。然后你需要像下面这样安装Cython。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="2f26" class="mz md it nm b gy nq nr l ns nt">pip install Cython</span></pre><h2 id="0db8" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">受益于静态类型声明</h2><p id="a26e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以在变量和函数中添加静态类型声明。它会给你更好的表现。你可以使用所有的C类型来声明，比如<code class="fe nu nv nw nm b">int</code>、<code class="fe nu nv nw nm b">float</code>、<code class="fe nu nv nw nm b">double</code>等等。</p><h2 id="f751" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">在Cython 中声明<strong class="ak">变量</strong></h2><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="a85a" class="mz md it nm b gy nq nr l ns nt"><strong class="nm iu">cdef</strong> int i = 10</span></pre><p id="0375" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您从未使用过这种语法，这基本上意味着您正在声明一个变量<code class="fe nu nv nw nm b">i</code>，它是一个整数。</p><h2 id="0cdf" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">在Cython 中声明一个<strong class="ak">函数</strong></h2><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="d2f4" class="mz md it nm b gy nq nr l ns nt"><strong class="nm iu">cdef</strong> int square(int x):<br/>    <strong class="nm iu">return</strong> x ** 2</span></pre><p id="34e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这基本上意味着<code class="fe nu nv nw nm b">square</code>函数接受一个整数参数<code class="fe nu nv nw nm b">x</code>并返回一个整数值<code class="fe nu nv nw nm b">x**2</code>，它是<code class="fe nu nv nw nm b">x</code>的平方。</p><p id="8363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nm b">cdef</code>当您导入模块时，声明的函数将对您的Python代码不可见。为了使它可见，你需要使用<code class="fe nu nv nw nm b">cpdef</code>而不是<em class="nx">。</em></p><h2 id="53d8" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">在Python中计算阶乘</h2><p id="6967" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们编写一个Python函数来计算给定整数的阶乘。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4214" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用Cython加快速度</h1><h2 id="eb58" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">创建一个pyx文件</h2><p id="8e15" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><code class="fe nu nv nw nm b">cpdef long fastfactorial</code>:这个函数将返回一个长值，所以我们通过在函数名<code class="fe nu nv nw nm b">fastfactorial</code>前加上<code class="fe nu nv nw nm b">long</code>来声明它为<code class="fe nu nv nw nm b">long</code>。</p><p id="d5d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nm b">long n</code>:我们期待<code class="fe nu nv nw nm b">n</code>成为<code class="fe nu nv nw nm b">long</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h2 id="cd30" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">创建安装文件</h2><p id="7892" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们需要创建一个<code class="fe nu nv nw nm b">setup.py</code>文件来将Cython翻译成c。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h2 id="99b2" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">编译代码</h2><p id="f768" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了执行这个编译，我们将运行这个命令。</p><p id="a7cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nu nv nw nm b">--inplace</code>:该选项在您的工作目录中创建一个共享目标文件。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="0178" class="mz md it nm b gy nq nr l ns nt">python3 setup.py build_ext --inplace</span></pre><p id="c619" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你！这是你做的。</p><h2 id="a68e" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">Co <strong class="ak">比较</strong></h2><p id="ad8d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们来对比一下！我将把执行时间和打印功能放在一起，让您看看不同之处。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="6e55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看区别:快了差不多<strong class="lb iu"> 88倍</strong>！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9783" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="2ab1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">只需轻轻一点，您就可以让Python代码运行得更快。这是一个温和的介绍。您可以根据自己的需要进一步完善它，使它变得更加复杂。注意，示例是为了说明的目的；它们可以被优化。</p></div></div>    
</body>
</html>