<html>
<head>
<title>Tips and Tricks for Handling Configuration Files in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python处理配置文件的技巧和诀窍</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/tips-and-tricks-for-handling-configuration-files-in-python-a9d7429aa50b?source=collection_archive---------0-----------------------#2019-12-02">https://betterprogramming.pub/tips-and-tricks-for-handling-configuration-files-in-python-a9d7429aa50b?source=collection_archive---------0-----------------------#2019-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0b8d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用ConfigParser在Python中读写配置文件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ee5650f63b5c2f91a1843d3a1fee030d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ikkiar2teCizr06fDxN7ig.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@iammrcup?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">杯先生/杨奇煜·巴勒</a>在<a class="ae ky" href="https://unsplash.com/s/photos/file?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="9820" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读本文，您将了解用Python管理配置文件所需的基本步骤。本教程重点介绍一个名为<code class="fe lv lw lx ly b">ConfigParser</code>的Python模块。基于官方<a class="ae ky" href="https://docs.python.org/3/library/configparser.html" rel="noopener ugc nofollow" target="_blank">文档</a> , <code class="fe lv lw lx ly b">ConfigParser</code>是一个:</p><blockquote class="lz ma mb"><p id="9a13" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated">“…实现基本配置语言的类，该语言提供类似于Microsoft Windows INI文件中的结构。您可以使用它来编写Python程序，最终用户可以轻松地对其进行定制。”</p></blockquote><p id="334c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程有四个部分:</p><ol class=""><li id="a2e5" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ml mm mn mo bi translated">设置</li><li id="2670" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">文件格式</li><li id="7379" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">基本API</li><li id="10c9" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">结论</li></ol><p id="7050" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们进入下一部分，安装该模块。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="dbd4" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">1.设置</h1><p id="53f9" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated"><code class="fe lv lw lx ly b">ConfigParser</code>模块是Python 3库的一部分，当你安装Python 3的时候就应该有了。您可以使用以下代码轻松导入它:</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="ef64" class="oc nc it ly b gy od oe l of og">import configparser</span></pre><p id="6e91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您使用的是Python 2.6–3.5，可以尝试以下导入语句:</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="26c2" class="oc nc it ly b gy od oe l of og">from backports import configparser</span></pre><p id="d507" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，如果您想编写同时适用于Python 2/3的代码，请使用以下代码:</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="775a" class="oc nc it ly b gy od oe l of og">try:<br/>    import configparser<br/>except:<br/>    from six.moves import configparser</span></pre></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="723f" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">2.文件格式</h1><p id="715a" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">您可以根据自己的喜好来命名配置，但是强烈建议将扩展名保持为<code class="fe lv lw lx ly b">ini</code>。</p><p id="9366" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个配置文件由一个或多个基于开始和结束括号标题<code class="fe lv lw lx ly b">[section_name]</code>识别的部分组成。每个部分将包含由<code class="fe lv lw lx ly b">=</code>或<code class="fe lv lw lx ly b">:</code>符号分隔的键值条目。我将在本教程中使用等号。允许在键值条目之间有空格。您甚至可以使用<code class="fe lv lw lx ly b">#</code>或<code class="fe lv lw lx ly b">;</code>前缀添加评论。</p><p id="2949" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看一个配置文件的例子:</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="1342" class="oc nc it ly b gy od oe l of og">[default]<br/>host = 192.168.1.1<br/>port = 22<br/>username = username<br/>password = password</span><span id="2044" class="oc nc it ly b gy oh oe l of og">[dev_database]<br/>port = 22<br/>forwardx11 = no<br/>name = db_test</span></pre><p id="1361" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置文件中有两个部分，每个部分都有自己的键值条目。您可以创建自己的配置文件或通过代码生成它。让我们进入下一部分，了解更多信息。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="3624" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">3.基本API</h1><p id="a3a9" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">我们需要做的第一件事是初始化一个<code class="fe lv lw lx ly b">ConfigParser</code>对象。</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="4e54" class="oc nc it ly b gy od oe l of og">config = configparser.ConfigParser()</span></pre><h2 id="aa52" class="oc nc it bd nd oi oj dn nh ok ol dp nl li om on nn lm oo op np lq oq or nr os bi translated">写</h2><p id="446d" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">我们可以很容易地创建默认节，通过用字典初始化该节来使用。</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="950e" class="oc nc it ly b gy od oe l of og">config['default'] = {<br/>        "host" : "192.168.1.1",<br/>        "port" : "22",<br/>        "username" : "username",<br/>        "password" : "password"<br/>    }</span></pre><ul class=""><li id="0c45" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">default</code> —部分的名称</li><li id="a8a2" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">“host” : “192.168.1.1”</code> —配置文件的键值对条目</li></ul><p id="ad11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，您可以将它初始化为一个空字典，然后逐行添加条目。这为我们提供了更多的灵活性。让我们来看看如何为<code class="fe lv lw lx ly b">dev_database</code>部分做这件事。</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="31fe" class="oc nc it ly b gy od oe l of og">config['dev_database'] = {}<br/>    config['dev_database']['port'] = "22"<br/>    config['dev_database']['forwardx11'] = "no"<br/>    config['dev_database']['name'] = "db_test"</span></pre><ul class=""><li id="67a3" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">dev_database</code> —区间名称</li><li id="f7da" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">port</code> —条目的键</li><li id="c2a9" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">22 </code> —条目的值</li></ul><p id="622f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦完成，就可以开始将内容写入配置文件。</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="e277" class="oc nc it ly b gy od oe l of og">with open('test.ini', 'w') as configfile:<br/>        config.write(configfile)</span></pre><p id="9c28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦运行代码，您应该能够看到一个生成的<code class="fe lv lw lx ly b">test.ini</code>文件。</p><h2 id="6e9d" class="oc nc it bd nd oi oj dn nh ok ol dp nl li om on nn lm oo op np lq oq or nr os bi translated">阅读</h2><p id="cc02" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">让我们试着读取您刚刚生成的配置文件。</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="6a87" class="oc nc it ly b gy od oe l of og">config.read('test.ini')</span></pre><p id="09b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用下面的API调用来标识配置文件中出现的部分。</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="e66d" class="oc nc it ly b gy od oe l of og">config.sections()</span></pre><p id="ed6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将尝试获取数据库的名称。</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="4823" class="oc nc it ly b gy od oe l of og">config['dev_database']['name']</span></pre><ul class=""><li id="93b8" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">dev_database</code> —部分的名称</li><li id="402f" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">name</code> —用于输入的键</li></ul><p id="40bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你应该可以得到<code class="fe lv lw lx ly b">db_test</code>作为输出。如果您想获得一个部分的所有键值条目，该怎么办？让我们用下面的代码试一试，将所有的值打印到<code class="fe lv lw lx ly b">default</code>部分。</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="2d10" class="oc nc it ly b gy od oe l of og">for key in config['default']:<br/>        print(config['default'][key])</span></pre><h2 id="6ad0" class="oc nc it bd nd oi oj dn nh ok ol dp nl li om on nn lm oo op np lq oq or nr os bi translated">数据类型</h2><p id="a9e9" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">默认情况下，模块会在内部将数据解析为字符串。您需要手动或者使用getter方法来转换它们。</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="38b3" class="oc nc it ly b gy od oe l of og">config['default'].getint('port')</span></pre><p id="2af2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有三种getter方法可用于转换:</p><ul class=""><li id="14c4" class="mg mh it lb b lc ld lf lg li mi lm mj lq mk lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">getint</code></li><li id="7b1e" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">getboolean</code></li><li id="5be2" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ot mm mn mo bi translated"><code class="fe lv lw lx ly b">getfloat</code></li></ul><p id="848b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用另一种方法来试试:</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="f011" class="oc nc it ly b gy od oe l of og">config.getboolean('dev_database', 'forwardx11')</span></pre><p id="af83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，第二个参数是条目的键，而不是回退结果。</p><h2 id="5a14" class="oc nc it bd nd oi oj dn nh ok ol dp nl li om on nn lm oo op np lq oq or nr os bi translated">撤退</h2><p id="c762" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">如果您想要一个回退结果，您可以将其定义如下:</p><pre class="kj kk kl km gt ny ly nz oa aw ob bi"><span id="4a4e" class="oc nc it ly b gy od oe l of og">config.get('default', 'database', fallback='prod_database')</span></pre><p id="6eaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果找不到数据库关键字或找不到节，将返回结果<code class="fe lv lw lx ly b">prod_database</code>。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="a5c3" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">4.结论</h1><p id="93a2" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">让我们回顾一下今天所学的内容。首先，我们通过编写几行导入代码开始设置。</p><p id="9505" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们详细探讨了配置文件的格式，它由部分和键值条目组成。建议保留扩展名为<code class="fe lv lw lx ly b">ini</code>。</p><p id="6726" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们测试了模块中可用的一些基本API。这包括将配置写入文件和读取现有的配置文件。我们甚至可以使用getter方法将数据转换成特定的数据类型。fallback参数可用于在找不到节或键的情况下提供回退响应。</p><p id="1a92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，希望在下一篇文章中再次见到您。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="5007" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">参考</h1><ol class=""><li id="88c2" class="mg mh it lb b lc nt lf nu li ou lm ov lq ow lu ml mm mn mo bi translated"><a class="ae ky" href="https://docs.python.org/3/library/configparser.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/library/configparser.html</a></li><li id="ba8c" class="mg mh it lb b lc mp lf mq li mr lm ms lq mt lu ml mm mn mo bi translated">【https://github.com/jaraco/configparser T2】号</li></ol></div></div>    
</body>
</html>