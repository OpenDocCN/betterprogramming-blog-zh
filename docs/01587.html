<html>
<head>
<title>Building Your First Website with Flask: Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Flask构建你的第一个网站:第4部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-your-first-website-with-flask-part-5-e389fff0c8ec?source=collection_archive---------6-----------------------#2019-09-26">https://betterprogramming.pub/building-your-first-website-with-flask-part-5-e389fff0c8ec?source=collection_archive---------6-----------------------#2019-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d9aa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Flask创建表单和数据库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/901105242d17df2a16f19aca4b0c7437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gku0rkmFowUOYBXl5i9oNg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">哈尔·盖特伍德在<a class="ae ky" href="https://unsplash.com/s/photos/websites?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="c459" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的团队最近写了几篇关于使用Flask开发网站的文章。</p><ul class=""><li id="a8a5" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/better-programming/building-your-first-website-with-flask-part-1-903a8b44e806" rel="noopener">第一部分——Hello World及以后</a></li><li id="6bff" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/better-programming/building-your-first-website-with-flask-part-2-6324721be2ae" rel="noopener">第2部分— HTML模板和CSS </a></li><li id="2eb4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/better-programming/building-your-first-website-with-flask-part-3-99df7d589078" rel="noopener">第3部分——跟踪会议和表格简介</a></li></ul><p id="bc9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本系列的第4部分中，我们将介绍如何创建一个数据库来处理各种数据。创建之后，Flask中数据库管理可用的一组特性也会得到考虑。因此，对于第四部分，我们计划从我们的简单网站实现以下内容:</p><p id="c840" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从表单中插入数据</p><p id="1b81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">整合数据库</p><p id="bcb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">处理基本用户配置文件</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="2a59" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">从表单中插入数据</h1><p id="ca0d" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">使用Flask，可以将表单数据发送到模板。<strong class="lb iu"> </strong>接收到的表单数据将触发一个功能，该功能将收集到的数据转发到一个模板，以便在选定的网页上呈现。</p><p id="487f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，我们将使用主页，它可以在<code class="fe nn no np nq b"><strong class="lb iu">‘/’</strong></code> URL找到。这将呈现一个带有表单的web页面(<code class="fe nn no np nq b">user.html</code>)。用户填写的数据被发布到<code class="fe nn no np nq b">‘/result’</code> URL。<code class="fe nn no np nq b">results()</code>函数触发结果URL上的输出。该函数还使用字典样式(dictionary对象)收集出现在<code class="fe nn no np nq b">request.form</code>中的表单数据，并将其发送到<code class="fe nn no np nq b">result.html</code>进行呈现。</p><p id="0f9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该模板将表单数据动态呈现在HTML表格中。下面是<code class="fe nn no np nq b">FormTable.py</code> <em class="nr">的代码。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="c86d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面给出的是<code class="fe nn no np nq b">users.html</code>的HTML脚本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="823e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提交表单后，它将调用结果HTML页面。模板代码(<code class="fe nn no np nq b">result.html</code>)如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="e7dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行Python脚本，在浏览器中输入URL<a class="ae ky" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/</a>。</p><p id="5bec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到表单的输出如下所示(减去我们输入的内容):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/3b5d29f0f9b2c55b6cb038446998afd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_NAXrsHw6Es8AUI86YSJQw.png"/></div></div></figure><p id="5926" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当点击提交按钮时，表单数据以HTML表格的形式呈现在<code class="fe nn no np nq b">result.html</code>上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/c20471cb711eb2e33b5cd8b0e8bdc9bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AMp0zocWTFiIxq361JEhmA.png"/></div></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="2b1a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">整合数据库</h1><p id="044c" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">如果你还记得，在我们对<a class="ae ky" href="https://www.coriers.com/python-backends-flask-vs-django/" rel="noopener ugc nofollow" target="_blank"> Flask和Django </a>的比较中，Flask是Python中的一个微型网络框架。这个定义意味着它没有对象关系映射器(ORM)(而Django有)。</p><p id="6338" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果您希望合并一个交互式数据库，那么您需要额外安装一个扩展。SQLAlchemy已经成为一种流行的安装选择。在Flask中，加法SQLAlchemy的现成扩展称为<a class="ae ky" href="http://flask-sqlalchemy.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask-SQLAlchemy </a>。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3e4c" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">安装烧瓶-SQLAlchem</h1><p id="5174" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Flask-SQLAlchemy的安装需要在为Flask创建的活动虚拟环境中使用pip。要安装扩展，请在Python中的Flask活动环境中输入以下内容:</p><p id="169b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">pip install flask-sqlalchemy</code></p><p id="86b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Flask-SQLAlchemy安装成功后，接下来需要安装的是MySQL。这种安装可以通过以下方式实现:</p><p id="6d67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">pip install mysql</code></p><p id="76f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在成功安装Flask-SQLAlchemy和其他依赖项之后，是时候创建我们的交互式数据库了。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="25a7" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">创建数据库</h1><p id="ff32" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">使用SQLAlchemy创建数据库非常简单。SQLAlchemy支持几种处理数据库的方法。一种常见的方法是使用声明性语法，它允许您创建用于数据库建模的类。</p><p id="5ee7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以对于我们简单的Flask教程，我们将使用SQLite作为后端。可以使用其他后端解决方案，如MySQL或Postgres。首先，我们将了解如何创建:</p><p id="b228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过正常的SQLAlchemy的数据库文件</p><p id="db6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用不同Flask-SQLAlchemy语法的单独脚本</p><p id="d775" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以让我们从将代码放入一个名为<code class="fe nn no np nq b">db_create.py</code>的文件开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="ba5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码的早期部分可能看起来很相似，因为我们要求Python导入SQLAlchemy和其他必要的扩展来使代码的不同部分工作。</p><p id="27f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随后，代码尝试创建SQLAlchemy的engine对象，这实质上是将Python连接到所选的数据库。此外，我们连接SQLite并创建一个数据库文件来代替在内存中创建数据库。</p><p id="fdf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，创建的基类是为了服务于声明类定义的创建。这个类定义定义了数据库表。例如，我们可能想要定义一个名为<code class="fe nn no np nq b">user</code>的类，它被附加到一个用户表。</p><p id="4ca3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还要注意，表的命名是通过<code class="fe nn no np nq b"><strong class="lb iu"> __tablename__ </strong></code>类属性完成的。使用我们需要的数据类型来设置表列的创建。</p><p id="20e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以阅读更多相关内容，并从精心编写的<a class="ae ky" href="http://docs.sqlalchemy.org/en/latest/orm/extensions/declarative/basic_use.html" rel="noopener ugc nofollow" target="_blank">文档</a>中获得深入的细节。在运行上面的代码时，在输出终端得到一个错误。现在让我们在烧瓶中完成所有这些工作。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="b3a7" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">使用Flask-SQLAlchemy创建数据库</h1><p id="bd22" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在使用Flask-SQLAlchemy时，我们首先需要创建一个简单的应用程序脚本。让我们把这个应用脚本叫做<strong class="lb iu"> </strong> <code class="fe nn no np nq b">apps.py</code>。现在让我们将下面的代码添加到Python文件中并保存它。</p><p id="590d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，一个简单的秘诀是同时建立一个数据库对象，这允许将SQLAlchemy集成到Flask中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="fe68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是创建Flask app对象，并为SQLAlchemy数据库文件提供一个位置。创建一个<code class="fe nn no np nq b">models.py</code>文件可以做到这一点。这将包含以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="2b7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Flask-SQLAlchemy不需要普通SQLAlchemy要求的所有导入。我们只需要在应用程序脚本中创建数据库(db)对象。从那里，我们使用原始的SQLAlchemy代码将<code class="fe nn no np nq b">db</code>添加到所有的类中。</p><p id="888c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，预定义的<code class="fe nn no np nq b">db.Model</code>也作为基类。为了帮助初始化数据库，我们创建了<code class="fe nn no np nq b">db_setup.py</code> <em class="nr">。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="e4d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码将使用在模型脚本中创建的表初始化数据库。为了可视化初始化，让我们对我们的<code class="fe nn no np nq b">test.py</code>脚本做一些补充:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="fd7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们只导入我们的app对象和<code class="fe nn no np nq b">init_db</code>函数。现在让我们在终端中运行代码，使用如下代码:</p><p id="5051" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">python test.py</code></p><p id="45b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行这段代码时，您可以访问下面的链接，看看页面是什么样子的:</p><p id="f931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/ </a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/1615d26440aa08e1606276eddeb9d40e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*Ftj7AgYh8VQsaaV8cvQUWw.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="76ca" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="1887" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们已经使用一个表单和一个包含空数据库的web应用程序成功创建了一个简单的数据库条目。</p><p id="8864" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为web应用程序创建的数据库还不能接受任何输入，但它提供了数据库使用的介绍。</p><p id="8cff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一部分中，我们将把数据库与Flask前端集成起来，这样您就可以开始创建新用户了。</p></div></div>    
</body>
</html>