<html>
<head>
<title>How To Send Tweets From Your App With the Twitter API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Twitter API从您的应用程序发送推文</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-send-tweets-from-your-app-with-the-twitter-api-5bb9f24e0896?source=collection_archive---------12-----------------------#2019-08-13">https://betterprogramming.pub/how-to-send-tweets-from-your-app-with-the-twitter-api-5bb9f24e0896?source=collection_archive---------12-----------------------#2019-08-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3bed" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用twit模块发送推文并获取推文历史</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6a9c0b7b025425b1367c208d9f5e5bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W03h_wkc_H9zchnmUT2mBA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@stereophototyp?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">萨拉·库菲</a>在<a class="ae ky" href="https://unsplash.com/search/photos/twitter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="b69b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您已经按照步骤<a class="ae ky" href="https://medium.com/better-programming/how-to-add-twitter-sign-in-to-your-node-js-back-end-with-angular-app-as-the-front-end-d90213f95703" rel="noopener">构建Twitter登录到您的应用程序</a>，您可以登录到您的Twitter帐户并获得OAuth请求令牌和密码。</p><p id="b893" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以用它来做很多伟大的事情，比如发送推文和接收你过去在推文上发布的消息。</p><p id="bf21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">后端用<a class="ae ky" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>打造，前端用Angular打造。在那篇教程中，我们构建了Twitter应用程序的基本部分。它具有注册、登录和Twitter登录功能。</p><p id="538d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要添加Twitter功能，以便该应用程序是有用的。</p><p id="80c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现这个功能，我们可以使用<a class="ae ky" href="https://www.npmjs.com/package/twit" rel="noopener ugc nofollow" target="_blank"> twit </a> Node.js模块。我们通过运行<code class="fe lv lw lx ly b">npm i twit</code>来下载它。</p><p id="4082" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于Twitter tweets有280个字符的限制，我们还需要使用一个链接缩短器来缩短我们的链接。我们通过运行<code class="fe lv lw lx ly b">npm i bitly</code>来添加<a class="ae ky" href="https://www.npmjs.com/package/bitly" rel="noopener ugc nofollow" target="_blank">节点包。</a></p><p id="0c8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们现有的应用程序使用<a class="ae ky" href="https://www.npmjs.com/package/sequelize" rel="noopener ugc nofollow" target="_blank"> Sequelize </a>作为我们的ORM，我们可以运行数据库迁移来改变我们数据库的结构。这里有一篇关于如何使用Sequelize 的文章，包括制作模型和表关系。</p><p id="4054" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让事情变得简单，如果你是从你在之前构建的<a class="ae ky" href="https://medium.com/better-programming/how-to-add-twitter-sign-in-to-your-node-js-back-end-with-angular-app-as-the-front-end-d90213f95703" rel="noopener">应用继续，我们移除一些东西并重新开始。如果您在生产环境中，您必须进行迁移和添加或更改，以实现相同的数据库结构。</a></p><p id="890a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们进行迁移并添加以下内容:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="2fa9" class="md me it ly b gy mf mg l mh mi">'use strict';<br/>module.exports = {<br/>  up: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.createTable('Users', {<br/>      id: {<br/>        allowNull: false,<br/>        autoIncrement: true,<br/>        primaryKey: true,<br/>        type: Sequelize.INTEGER<br/>      },<br/>      userName: {<br/>        type: Sequelize.STRING<br/>      },<br/>      email: {<br/>        type: Sequelize.STRING<br/>      },<br/>      hashedPassword: {<br/>        type: Sequelize.STRING<br/>      },<br/>      hashedOauthRequestToken: {<br/>        type: Sequelize.STRING<br/>      },<br/>      hashOauthRequestTokenSecret: {<br/>        type: Sequelize.STRING<br/>      },<br/>      createdAt: {<br/>        allowNull: false,<br/>        type: Sequelize.DATE<br/>      },<br/>      updatedAt: {<br/>        allowNull: false,<br/>        type: Sequelize.DATE<br/>      }<br/>    });<br/>  },<br/>  down: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.dropTable('Users');<br/>  }<br/>};</span></pre><p id="9107" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">进行另一次迁移，并添加:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="21f4" class="md me it ly b gy mf mg l mh mi">'use strict';<br/>module.exports = {<br/>  up: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.createTable('Tweets', {<br/>      id: {<br/>        allowNull: false,<br/>        autoIncrement: true,<br/>        primaryKey: true,<br/>        type: Sequelize.INTEGER<br/>      },<br/>      content: {<br/>        type: Sequelize.TEXT<br/>      },<br/>      usersId: {<br/>        type: Sequelize.INTEGER<br/>      },<br/>      createdAt: {<br/>        allowNull: false,<br/>        type: Sequelize.DATE<br/>      },<br/>      updatedAt: {<br/>        allowNull: false,<br/>        type: Sequelize.DATE<br/>      }<br/>    });<br/>  },<br/>  down: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.dropTable('Tweets');<br/>  }<br/>};</span></pre><p id="2361" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在模型中，如果我们遵循如何使用Twitter登录构建应用程序的教程，它应该存在，我们将它放在<code class="fe lv lw lx ly b">models/users.js</code>:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="54c2" class="md me it ly b gy mf mg l mh mi">'use strict';<br/>module.exports = (sequelize, DataTypes) =&gt; {<br/>  const User = sequelize.define('User', {<br/>    userName: DataTypes.STRING,<br/>    email: DataTypes.STRING,<br/>    hashedPassword: DataTypes.STRING,<br/>    hashedOauthAccessToken: DataTypes.STRING,<br/>    hashedOauthAccessTokenSecret: DataTypes.STRING,<br/>    activated: DataTypes.BOOLEAN,<br/>    passwordResetToken: DataTypes.STRING<br/>  }, {});<br/>  User.associate = function (models) {<br/>    User.hasMany(models.Tweet, {<br/>      foreignKey: 'userId',<br/>      sourceKey: 'id'<br/>    });<br/>  };<br/>  return User;<br/>};</span></pre><p id="f674" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并将以下内容放入<code class="fe lv lw lx ly b">tweet.js</code>:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="5f8e" class="md me it ly b gy mf mg l mh mi">'use strict';</span><span id="cace" class="md me it ly b gy mj mg l mh mi">module.exports = (sequelize, DataTypes) =&gt; {<br/>  const Tweet = sequelize.define('Tweet', {<br/>    content: DataTypes.TEXT,<br/>    userId: DataTypes.INTEGER,<br/>    scheduled: DataTypes.BOOLEAN<br/>  }, {});<br/>  Tweet.associate = function (models) {<br/>    Tweet.hasMany(models.TweetRecord, {<br/>      foreignKey: 'tweetId',<br/>      sourceKey: 'id'<br/>    });</span><span id="7361" class="md me it ly b gy mj mg l mh mi">  Tweet.belongsTo(models.User, {<br/>      foreignKey: 'userId',<br/>      targetKey: 'id'<br/>    });<br/>  };</span><span id="2d42" class="md me it ly b gy mj mg l mh mi">  return Tweet;<br/>};</span></pre><p id="9c78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe lv lw lx ly b">npx sequelize db:migrate</code>之后，我们已经有了构建应用程序的模型和数据库结构。</p><p id="28ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们制作了一个新的控制器来存储Twitter的tweet逻辑。创建一个名为<code class="fe lv lw lx ly b">tweetsController.js</code>的文件，放入以下内容:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="bdb6" class="md me it ly b gy mf mg l mh mi">const express = require('express');<br/>const models = require('../models');<br/>const jwt = require('jsonwebtoken');<br/>const Twit = require('twit');<br/>const Op = require('sequelize').Op;<br/>const CryptoJS = require("crypto-js");<br/>const shortUrl = require('node-url-shortener');<br/>const router = express.Router();<br/>import { authCheck } from '../middlewares/authCheck';<br/>import { saveTweetRecord, saveTweet } from '../services/tweetService';<br/>import { BitlyClient } from 'bitly';<br/>const bitly = new BitlyClient(process.env.BITLY_TOKEN, {});</span><span id="6bbe" class="md me it ly b gy mj mg l mh mi">const urlRegex = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&amp;//=]*)/;</span><span id="d683" class="md me it ly b gy mj mg l mh mi">router.get('/get/:id', authCheck, async (req, res) =&gt; {<br/>    try {<br/>        const id = req.params.id;<br/>        const tweets = await models.Tweet.findAll({ where: { id } });<br/>        return res.send(tweets[0]);<br/>    }<br/>    catch (ex) {<br/>        return res.send(ex, 500);<br/>    }</span><span id="00c2" class="md me it ly b gy mj mg l mh mi">});</span><span id="f0e9" class="md me it ly b gy mj mg l mh mi">router.get('/list', authCheck, async (req, res) =&gt; {<br/>    const page = req.params.page;<br/>    const token = req.headers.authorization;<br/>    const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>    const userId = decoded.data.userId;<br/>    const tweets = await models.Tweet.findAll({<br/>        where: {<br/>            userId,<br/>            [Op.or]: [<br/>                { deleted: false },<br/>                { deleted: null }<br/>            ]<br/>        }<br/>    });<br/>    res.send({<br/>        tweets,<br/>        count: tweets.length<br/>    });</span><span id="151e" class="md me it ly b gy mj mg l mh mi">});</span><span id="8516" class="md me it ly b gy mj mg l mh mi">router.post('/post', authCheck, async (req, res) =&gt; {<br/>    const token = req.headers.authorization;<br/>    const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>    const userId = decoded.data.userId;<br/>    try {<br/>        let content = req.body.content;<br/>        let urls = content.match(urlRegex) || [];<br/>        urls = urls.filter(u =&gt; u &amp;&amp; u.startsWith('http') &amp;&amp; !u.includes('bit.ly'));<br/>        for await (const u of urls) {<br/>            const urlResult = await bitly.shorten(u);<br/>            content = content.replace(u, urlResult.url);<br/>        }<br/>        await models.Tweet.create({<br/>            ...req.body,<br/>            content,<br/>            userId<br/>        })<br/>        return res.send({ message: 'Successfully created tweet' });<br/>    }<br/>    catch (ex) {<br/>        return res.send(ex, 500);<br/>    }</span><span id="8216" class="md me it ly b gy mj mg l mh mi">});</span><span id="f33b" class="md me it ly b gy mj mg l mh mi">router.put('/update/:tweetId', authCheck, async (req, res) =&gt; {<br/>    try {<br/>        const token = req.headers.authorization;<br/>        const tweetId = req.params.tweetId;<br/>        const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>        const userId = decoded.data.userId;<br/>        let content = req.body.content;<br/>        let urls = content.match(urlRegex) || [];<br/>        urls = urls.filter(u =&gt; u &amp;&amp; u.startsWith('http') &amp;&amp; !u.includes('bit.ly'));<br/>        for await (const u of urls) {<br/>            const urlResult = await bitly.shorten(u);<br/>            content = content.replace(u, urlResult.url);<br/>        }<br/>        await models.Tweet.update({<br/>            ...req.body,<br/>            content,<br/>            userId<br/>        }, {<br/>                where: {<br/>                    id: tweetId<br/>                }<br/>            })<br/>        return res.send({ message: 'Successfully updated tweet' });<br/>    }<br/>    catch (ex) {<br/>        console.log(ex);<br/>        return res.send(ex, 500);<br/>    }</span><span id="6eb1" class="md me it ly b gy mj mg l mh mi">});</span><span id="0c72" class="md me it ly b gy mj mg l mh mi">router.delete('/delete/:id', authCheck, async (req, res) =&gt; {<br/>    const id = req.params.id;<br/>    try {<br/>        await models.Tweet.update(<br/>            {<br/>                deleted: true<br/>            }, {<br/>                where: { id }<br/>            }<br/>        )<br/>        return res.send({ message: 'Successfully deleted tweet' });<br/>    }<br/>    catch (ex) {<br/>        return res.send(ex, 500);<br/>    }<br/>});</span><span id="8f30" class="md me it ly b gy mj mg l mh mi">router.post('/sendTweet/:id', authCheck, async (req, res) =&gt; {<br/>    const id = req.params.id;<br/>    const token = req.headers.authorization;<br/>    try {<br/>        const tweets = await models.Tweet.findAll({<br/>            where: { id }<br/>        })<br/>        const tweet = tweets[0];<br/>        const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>        const userId = decoded.data.userId;<br/>        const users = await models.User.findAll({<br/>            where: { id: userId }<br/>        })<br/>        const user = users[0];<br/>        const accessTokenBytes = CryptoJS.AES.decrypt(user.hashedOauthAccessToken, process.env.OAUTH_SECRET);<br/>        const oauthAccessToken = accessTokenBytes.toString(CryptoJS.enc.Utf8);</span><span id="5da4" class="md me it ly b gy mj mg l mh mi">const accessTokenSecretBytes = CryptoJS.AES.decrypt(user.hashedOauthAccessTokenSecret, process.env.OAUTH_SECRET);<br/>        const oauthAccessTokenSecret = accessTokenSecretBytes.toString(CryptoJS.enc.Utf8);</span><span id="2410" class="md me it ly b gy mj mg l mh mi">const T = new Twit({<br/>            consumer_key: process.env.TWITTER_CONSUMER_KEY,<br/>            consumer_secret: process.env.TWITTER_CONSUMER_SECRET,<br/>            access_token: oauthAccessToken,<br/>            access_token_secret: oauthAccessTokenSecret,<br/>            timeout_ms: 60 * 1000,<br/>            strictSSL: true<br/>        })<br/>        T.post('statuses/update', { status: tweet.content }, (err, data, response) =&gt; {<br/>            saveTweetRecord(id);<br/>            res.send({ message: 'Successfully sent tweet' });<br/>        })<br/>    }<br/>    catch (ex) {<br/>        return res.send(ex, 500);<br/>    }</span><span id="fae7" class="md me it ly b gy mj mg l mh mi">});</span><span id="938e" class="md me it ly b gy mj mg l mh mi">router.get('/importOldTweets', authCheck, async (req, res) =&gt; {<br/>    const token = req.headers.authorization;<br/>    try {<br/>        const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>        const userId = decoded.data.userId;<br/>        const users = await models.User.findAll({<br/>            where: { id: userId }<br/>        })<br/>        const user = users[0];<br/>        const accessTokenBytes =            CryptoJS.AES.decrypt(user.hashedOauthAccessToken, process.env.OAUTH_SECRET);<br/>        const oauthAccessToken = accessTokenBytes.toString(CryptoJS.enc.Utf8);</span><span id="d8f7" class="md me it ly b gy mj mg l mh mi">const accessTokenSecretBytes = CryptoJS.AES.decrypt(user.hashedOauthAccessTokenSecret, process.env.OAUTH_SECRET);<br/>        const oauthAccessTokenSecret = accessTokenSecretBytes.toString(CryptoJS.enc.Utf8);</span><span id="80c8" class="md me it ly b gy mj mg l mh mi">         const T = new Twit({<br/>            consumer_key: process.env.TWITTER_CONSUMER_KEY,<br/>            consumer_secret: process.env.TWITTER_CONSUMER_SECRET,<br/>            access_token: oauthAccessToken,<br/>            access_token_secret: oauthAccessTokenSecret,<br/>            timeout_ms: 60 * 1000,<br/>            strictSSL: true<br/>        })<br/>        T.get('statuses/user_timeline', {}, (err, data, response) =&gt; <br/>            res.send({ message: 'Successfully imported tweets' });<br/>        })<br/>    }<br/>    catch (ex) {<br/>        return res.send(ex, 500);<br/>    }</span><span id="64b4" class="md me it ly b gy mj mg l mh mi">});</span><span id="11ec" class="md me it ly b gy mj mg l mh mi">module.exports = router;</span></pre><p id="2819" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">’/get/:id’</code>路线是我们获取存储在本地数据库中的推文的地方。<code class="fe lv lw lx ly b">findAll</code>是一个从序列表中获取条目的函数。</p><p id="2eb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">‘/post’</code>路线是我们通过Twitter API向我们的Twitter账户发送推文的地方。</p><p id="6396" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在之前的教程中使用了<code class="fe lv lw lx ly b">authCheck</code>来验证令牌，然后才允许用户发送tweets。然后，我们从前端的授权头中获取令牌。然后，我们得到用户ID。</p><p id="7142" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">try</code>块中，我们通过Bit.ly缩短了我们的链接。要使用<code class="fe lv lw lx ly b">bitly</code>模块，我们必须注册一个bit.ly帐户并获得一个API令牌。然后，我们用Bit.ly API缩短所有不是Bit.ly URL的内容。</p><p id="bfd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用<code class="fe lv lw lx ly b">’/update/:tweetId’</code>路线更新现有的推文。它与<code class="fe lv lw lx ly b">post</code>路线非常相似，除了您使用<code class="fe lv lw lx ly b">tweetId</code>检索现有的tweet，并在我们的数据库中更新tweet。</p><p id="479f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">'/sendTweet/:id’</code>是推特魔法发生的地方。我们使用与Twitter API对话的<code class="fe lv lw lx ly b">twit</code>模块来发送推文。</p><p id="576e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们需要取回数据时，<code class="fe lv lw lx ly b">delete</code>路由会执行软删除。<code class="fe lv lw lx ly b">importOldTweets</code> route获取我们过去的推文历史，并将其保存到我们的数据库中。</p><p id="b09f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个街区:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="495c" class="md me it ly b gy mf mg l mh mi">const accessTokenBytes = CryptoJS.AES.decrypt(user.hashedOauthAccessToken, process.env.OAUTH_SECRET);<br/>        const oauthAccessToken = accessTokenBytes.toString(CryptoJS.enc.Utf8);</span><span id="a92d" class="md me it ly b gy mj mg l mh mi">const accessTokenSecretBytes = CryptoJS.AES.decrypt(user.hashedOauthAccessTokenSecret, process.env.OAUTH_SECRET);<br/>        const oauthAccessTokenSecret = accessTokenSecretBytes.toString(CryptoJS.enc.Utf8);</span></pre><p id="a03c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们获得了加密的OAuth访问令牌和密码，可以识别您的Twitter帐户，在下面的代码中，我们实例化了我们的Twitter客户端:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="50a1" class="md me it ly b gy mf mg l mh mi">const T = new Twit({<br/>  consumer_key: process.env.TWITTER_CONSUMER_KEY,<br/>  consumer_secret: process.env.TWITTER_CONSUMER_SECRET,<br/>  access_token: oauthAccessToken,<br/>  access_token_secret: oauthAccessTokenSecret,<br/>  timeout_ms: 60 * 1000,<br/>  strictSSL: true<br/>})</span></pre><p id="e513" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="1a43" class="md me it ly b gy mf mg l mh mi">T.post('statuses/update', { status: tweet.content }, (err, data, response) =&gt; {<br/>  res.send({ message: 'Successfully sent tweet' });<br/>})</span></pre><p id="824d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将推文内容发送到我们的Twitter账户，让全世界都能看到你的推文。</p><p id="8da9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了散列加密我们的OAuth访问令牌和秘密，我们用以下内容替换了<code class="fe lv lw lx ly b">saveAccessTokens</code>控制器:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="63d4" class="md me it ly b gy mf mg l mh mi">router.get('/saveAccessTokens', authCheck, (req, res) =&gt; {</span><span id="3622" class="md me it ly b gy mj mg l mh mi">  consumer.getOAuthAccessToken(<br/>        req.query.oauth_token,<br/>        req.session.oauthRequestTokenSecret,<br/>        req.query.oauth_verifier,<br/>        (error, oauthAccessToken, oauthAccessTokenSecret, results) =&gt; {<br/>            if (error) {<br/>                logger.error(error);<br/>                res.send(error, 500);<br/>            }<br/>            else {<br/>                const token = req.headers.authorization;<br/>                const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>                const userId = decoded.data.userId;<br/>                const hashedOauthAccessToken = CryptoJS.AES<br/>                    .encrypt(oauthAccessToken, process.env.OAUTH_SECRET)<br/>                    .toString();<br/>                const hashedOauthAccessTokenSecret = CryptoJS.AES<br/>                    .encrypt(oauthAccessTokenSecret, process.env.OAUTH_SECRET)<br/>                    .toString();<br/>                models.User.update({<br/>                    hashedOauthAccessToken,<br/>                    hashedOauthAccessTokenSecret<br/>                },<br/>                    { where: { id: userId } })<br/>                    .then((result) =&gt; {<br/>                        return res.send({ message: 'token saved' });<br/>                    })<br/>                    .catch((ex) =&gt; {<br/>                        logger.error(ex);<br/>                        return res.send({ error: ex }, 500);<br/>                    })</span><span id="d8c8" class="md me it ly b gy mj mg l mh mi">}<br/>        });<br/>});</span></pre><p id="960f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">app.js</code>中，我们必须添加两条线来访问我们添加的路线:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="f90f" class="md me it ly b gy mf mg l mh mi">const tweets = require('./controllers/tweetsController');</span></pre><p id="9aab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后补充:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="fd5d" class="md me it ly b gy mf mg l mh mi">app.use('/tweets', tweets);</span></pre><p id="31f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用你其他的<code class="fe lv lw lx ly b">app.use</code>台词。</p><p id="c518" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上一个教程中，我们没有加密机密访问令牌。但是，如果我们想做一个安全的应用程序，我们必须这样做。这将保存加密的凭据，而不是原始凭据。</p><p id="fb59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们之前构建的<a class="ae ky" href="https://medium.com/better-programming/how-to-add-twitter-sign-in-to-your-node-js-back-end-with-angular-app-as-the-front-end-d90213f95703" rel="noopener"> Angular应用</a>中，我们必须添加一个页面来查看我们的前端应用。</p><p id="c56a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要将我们的推文存储在商店中，以便于集中访问。我们在<code class="fe lv lw lx ly b">reducers</code>文件夹中创建一个名为<code class="fe lv lw lx ly b">tweets-reducer.ts</code>的文件，然后将以下内容放入:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="b232" class="md me it ly b gy mf mg l mh mi">const SET_TWEETS = 'SET_TWEETS';</span><span id="978e" class="md me it ly b gy mj mg l mh mi">function tweetsReducer(state, action) {<br/>    switch (action.type) {<br/>        case SET_TWEETS:<br/>            state = action.payload;<br/>            return state;<br/>        default:<br/>            return state<br/>    }<br/>}</span><span id="9931" class="md me it ly b gy mj mg l mh mi">export { tweetsReducer, SET_TWEETS };</span></pre><p id="9cc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在<code class="fe lv lw lx ly b">reducers/index.ts</code>中，我们把:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="46ce" class="md me it ly b gy mf mg l mh mi">import { menuReducer } from './menu-reducer';<br/>import { tweetsReducer } from './tweets-reducer';</span><span id="8ae6" class="md me it ly b gy mj mg l mh mi">export const reducers = {<br/>  menu: menuReducer,<br/>  tweets: tweetsReducer<br/>};</span></pre><p id="675d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">app.module.ts</code>的<code class="fe lv lw lx ly b">imports</code>数组中，确保我们添加了以下内容:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="bb75" class="md me it ly b gy mf mg l mh mi">MatButtonModule,<br/>MatCheckboxModule,<br/>MatFormFieldModule,<br/>MatInputModule,<br/>MatMenuModule,<br/>MatSidenavModule,<br/>MatToolbarModule,<br/>MatTableModule,<br/>FormsModule,<br/>HttpClientModule,<br/>MatDialogModule,<br/>MatDatepickerModule,<br/>MatMomentDateModule,<br/>MatSelectModule,<br/>MatCardModule</span></pre><p id="ddc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们运行<code class="fe lv lw lx ly b">ng g component tweetForm</code>。这是输入推文的对话框。在新生成的<code class="fe lv lw lx ly b">tweet-form.component.ts</code>中，我们添加了:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="a55d" class="md me it ly b gy mf mg l mh mi">import { Component, OnInit, Inject } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { MAT_DIALOG_DATA, MatDialogRef } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>';<br/>import { Store } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { TweetsService } from '../tweets.service';<br/>import { SET_TWEETS } from '../reducers/tweets-reducer';<br/>import { NgForm } from '<a class="ae ky" href="http://twitter.com/angular/forms" rel="noopener ugc nofollow" target="_blank">@angular/forms</a>';<br/>import * as moment from 'moment';</span><span id="a432" class="md me it ly b gy mj mg l mh mi"><a class="ae ky" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-tweet-form',<br/>  templateUrl: './tweet-form.component.html',<br/>  styleUrls: ['./tweet-form.component.scss']<br/>})<br/>export class TweetFormComponent implements OnInit {<br/>  tweetData: any = {};<br/>  edit: boolean;</span><span id="9e25" class="md me it ly b gy mj mg l mh mi">  constructor(<br/>    public dialogRef: MatDialogRef&lt;TweetFormComponent&gt;,<br/>    <a class="ae ky" href="http://twitter.com/Inject" rel="noopener ugc nofollow" target="_blank">@Inject</a>(MAT_DIALOG_DATA) public data: any,<br/>    private tweetsService: TweetsService,<br/>    private store: Store&lt;any&gt;<br/>  ) { }</span><span id="d35b" class="md me it ly b gy mj mg l mh mi">  ngOnInit() {<br/>    if (this.data) {<br/>      this.edit = this.data.edit;<br/>      this.tweetData = this.data.tweet;<br/>    }<br/>  }</span><span id="af81" class="md me it ly b gy mj mg l mh mi">  getTweets(page: number = 1) {<br/>    this.tweetsService.listTweets(page)<br/>      .subscribe(res =&gt; {<br/>        this.store.dispatch({ type: SET_TWEETS, payload: res });<br/>        this.dialogRef.close();<br/>      })<br/>  }</span><span id="e24d" class="md me it ly b gy mj mg l mh mi">  save(tweetForm: NgForm) {<br/>    if (tweetForm.invalid) {<br/>      return;<br/>    }<br/>    const data = Object.assign({}, this.tweetData);<br/>    if (this.tweetData.scheduleDate) {<br/>      data.scheduleDate = moment(this.tweetData.scheduleDate).format('YYYY-MM-DD');<br/>    }<br/>    if (!this.edit) {<br/>      this.tweetsService.postTweet(data)<br/>        .subscribe(res =&gt; {<br/>          this.getTweets();<br/>        })<br/>    }<br/>    else {<br/>      this.tweetsService.updateTweet(this.tweetData.id, data)<br/>        .subscribe(res =&gt; {<br/>          this.getTweets();<br/>        })<br/>    }<br/>  }<br/>}</span></pre><p id="bb59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">tweet-form.component.html</code>中，我们有:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="ce70" class="md me it ly b gy mf mg l mh mi">&lt;h2 mat-dialog-title&gt;{{data.edit ? 'Edit' :'Add'}} Tweet&lt;/h2&gt;<br/>&lt;mat-dialog-content&gt;<br/>    &lt;form #tweetForm='ngForm' (ngSubmit)='save(tweetForm)'&gt;<br/>        &lt;mat-form-field&gt;<br/>            &lt;input matInput placeholder="Content" required #content='ngModel' name='content'<br/>                [(ngModel)]='tweetData.content' maxlength="140"&gt;<br/>            &lt;mat-error *ngIf="content.invalid &amp;&amp; (content.dirty || content.touched)"&gt;<br/>                &lt;div *ngIf="content.errors.required"&gt;<br/>                    Content is required.<br/>                &lt;/div&gt;<br/>            &lt;/mat-error&gt;<br/>        &lt;/mat-form-field&gt;<br/>    &lt;/form&gt;<br/>&lt;/mat-dialog-content&gt;<br/>&lt;mat-dialog-actions&gt;<br/>    &lt;button mat-button mat-dialog-close&gt;Cancel&lt;/button&gt;<br/>    &lt;!-- The mat-dialog-close directive optionally accepts a value as a result for the dialog. --&gt;<br/>    &lt;button mat-button type='submit' (click)='save(tweetForm)'&gt;Save&lt;/button&gt;<br/>&lt;/mat-dialog-actions&gt;</span></pre><p id="172e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保存成功后，对话框将更新tweets存储。它用于添加和编辑推文。</p><p id="2dd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">app.module.ts</code>的<code class="fe lv lw lx ly b">AppModule</code>中添加一个<code class="fe lv lw lx ly b">entryComponents</code>字段。我们补充如下:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="b660" class="md me it ly b gy mf mg l mh mi">TweetFormComponent</span></pre><p id="fa1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这允许我们的模块使用我们刚刚创建的对话框。</p><p id="2b1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须创建一个页面来查看推文列表。我们运行<code class="fe lv lw lx ly b">ng g component tweetsPage</code>。</p><p id="f8c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在新创建的<code class="fe lv lw lx ly b">tweets-page.component.ts</code>中，我们放入:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="3aac" class="md me it ly b gy mf mg l mh mi">import { Component, OnInit } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { MatDialogRef, MatDialog } from '<a class="ae ky" href="http://twitter.com/angular/material" rel="noopener ugc nofollow" target="_blank">@angular/material</a>';<br/>import { TweetFormComponent } from '../tweet-form/tweet-form.component';<br/>import { TweetsService } from '../tweets.service';<br/>import { Store, select } from '<a class="ae ky" href="http://twitter.com/ngrx/store" rel="noopener ugc nofollow" target="_blank">@ngrx/store</a>';<br/>import { SET_TWEETS } from '../reducers/tweets-reducer';<br/>import { TweetHistoryDialogComponent } from '../tweet-history-dialog/tweet-history-dialog.component';<br/>import { SessionService } from '../session.service';</span><span id="a7cd" class="md me it ly b gy mj mg l mh mi"><a class="ae ky" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-tweets-page',<br/>  templateUrl: './tweets-page.component.html',<br/>  styleUrls: ['./tweets-page.component.scss']<br/>})<br/>export class TweetsPageComponent implements OnInit {<br/>  tweets: any[] = [];<br/>  displayedColumns: string[] = [<br/>    'content',<br/>    'edit',<br/>    'tweet',<br/>    'delete'<br/>  ];  <br/>  currentTwitterUser = {};</span><span id="0824" class="md me it ly b gy mj mg l mh mi">  constructor(<br/>    public dialog: MatDialog,<br/>    private tweetsService: TweetsService,<br/>    private store: Store&lt;any&gt;,<br/>    private sessionService: SessionService<br/>  ) {<br/>    store.pipe(select('tweets'))<br/>      .subscribe(tweets =&gt; {<br/>        if (!tweets || !Array.isArray(tweets.tweets)) {<br/>          return;<br/>        }<br/>        this.tweets = tweets.tweets;<br/>      })<br/>  }</span><span id="f3d5" class="md me it ly b gy mj mg l mh mi">  ngOnInit() {<br/>    this.getTweets();<br/>    this.getCurrentTwitterAccount();<br/>  }</span><span id="5c7a" class="md me it ly b gy mj mg l mh mi">  openDialog(edit: boolean, index: number = null) {<br/>    const dialogRef = this.dialog.open(TweetFormComponent, {<br/>      width: '70vw',<br/>      data: {<br/>        edit,<br/>        tweet: edit ? this.tweets[index] : {}<br/>      }<br/>    })</span><span id="f8af" class="md me it ly b gy mj mg l mh mi">  dialogRef.afterClosed().subscribe(result =&gt; {<br/>      console.log('The dialog was closed');<br/>    });<br/>  }</span><span id="ffde" class="md me it ly b gy mj mg l mh mi">  getTweets() {<br/>    this.tweetsService.listTweets()<br/>      .subscribe(res =&gt; {<br/>        this.store.dispatch({ type: SET_TWEETS, payload: res });<br/>      })<br/>  }</span><span id="fc25" class="md me it ly b gy mj mg l mh mi">  deleteTweet(id: number) {<br/>    this.tweetsService.deleteTweet(id)<br/>      .subscribe(res =&gt; {<br/>        this.getTweets();<br/>      })<br/>  }</span><span id="a9a5" class="md me it ly b gy mj mg l mh mi">  sendTweet(id: number) {<br/>    this.tweetsService.sendTweet(id)<br/>      .subscribe(res =&gt; {<br/>        alert('Tweet sent');<br/>      })<br/>  }</span><span id="d832" class="md me it ly b gy mj mg l mh mi">  openTweetHistory(index: number) {<br/>    const dialogRef = this.dialog.open(TweetHistoryDialogComponent, {<br/>      width: '70vw',<br/>      data: this.tweets[index] || {}<br/>    })</span><span id="42c3" class="md me it ly b gy mj mg l mh mi">    dialogRef.afterClosed().subscribe(result =&gt; {<br/>      console.log('The dialog was closed');<br/>    });<br/>  }</span><span id="a9e9" class="md me it ly b gy mj mg l mh mi">  getCurrentTwitterAccount() {<br/>    this.sessionService.getCurrentTwitterAccount()<br/>      .subscribe(res =&gt; {<br/>        this.currentTwitterUser = res;<br/>      })<br/>  }</span><span id="c867" class="md me it ly b gy mj mg l mh mi">  importOldTweets() {<br/>    this.tweetsService.importOldTweets()<br/>      .subscribe(res =&gt; {<br/>        this.getTweets();<br/>        alert('Tweets successfully imported.');<br/>      })<br/>  }<br/>}</span></pre><p id="c389" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了添加一个表格来显示我们的推文，我们在<code class="fe lv lw lx ly b">tweet-page.component.html</code>中添加了以下内容:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="ea14" class="md me it ly b gy mf mg l mh mi">&lt;div class="center"&gt;<br/>    &lt;h1&gt;Tweets&lt;/h1&gt;<br/>&lt;/div&gt;<br/>&lt;br&gt;<br/>&lt;button mat-raised-button (click)='openDialog(false)'&gt;Add Tweet&lt;/button&gt;<br/>&lt;button mat-raised-button (click)='importOldTweets()'&gt;Import Old Tweets&lt;/button&gt;<br/>&lt;div id='table'&gt;<br/>    &lt;table mat-table [dataSource]="tweets" class="mat-elevation-z8"&gt;</span><span id="cdfd" class="md me it ly b gy mj mg l mh mi">       &lt;ng-container matColumnDef="content"&gt;<br/>            &lt;th mat-header-cell *matHeaderCellDef&gt;<br/>                Content<br/>            &lt;/th&gt;<br/>            &lt;td mat-cell *matCellDef="let element"&gt;{{element.content}}&lt;/td&gt;<br/>        &lt;/ng-container&gt;</span><span id="bac9" class="md me it ly b gy mj mg l mh mi">       &lt;ng-container matColumnDef="edit"&gt;<br/>            &lt;th mat-header-cell *matHeaderCellDef&gt;&lt;/th&gt;<br/>            &lt;td mat-cell *matCellDef="let element; let i = index"&gt;<br/>                &lt;button mat-raised-button (click)='openDialog(true, i)'&gt;Edit&lt;/button&gt;<br/>            &lt;/td&gt;<br/>        &lt;/ng-container&gt;</span><span id="8a65" class="md me it ly b gy mj mg l mh mi">        &lt;ng-container matColumnDef="tweet"&gt;<br/>            &lt;th mat-header-cell *matHeaderCellDef&gt; &lt;/th&gt;<br/>            &lt;td mat-cell *matCellDef="let element"&gt;<br/>                &lt;button mat-raised-button (click)='sendTweet(element.id)' [disabled]='!currentTwitterUser.id'&gt;<br/>                    Tweet<br/>                &lt;/button&gt;<br/>            &lt;/td&gt;<br/>        &lt;/ng-container&gt;</span><span id="9249" class="md me it ly b gy mj mg l mh mi">        &lt;ng-container matColumnDef="delete"&gt;<br/>            &lt;th mat-header-cell *matHeaderCellDef&gt; &lt;/th&gt;<br/>            &lt;td mat-cell *matCellDef="let element"&gt;<br/>                &lt;button mat-raised-button (click)='deleteTweet(element.id)'&gt;Delete&lt;/button&gt;<br/>            &lt;/td&gt;<br/>        &lt;/ng-container&gt;</span><span id="df57" class="md me it ly b gy mj mg l mh mi">        &lt;tr mat-header-row *matHeaderRowDef="displayedColumns"&gt;&lt;/tr&gt;<br/>        &lt;tr mat-row *matRowDef="let row; columns: displayedColumns;"&gt;&lt;/tr&gt;<br/>    &lt;/table&gt;<br/>&lt;/div&gt;</span></pre><p id="32f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们添加了一个用于发出HTTP请求的服务。我们运行<code class="fe lv lw lx ly b">ng g service tweets</code>来生成<code class="fe lv lw lx ly b">tweets.service.ts</code>。</p><p id="27bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们放入:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="bf61" class="md me it ly b gy mf mg l mh mi">import { Injectable } from '<a class="ae ky" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { HttpClient } from '<a class="ae ky" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http';<br/>import { environment } from 'src/environments/environment';</span><span id="1b47" class="md me it ly b gy mj mg l mh mi"><a class="ae ky" href="http://twitter.com/Injectable" rel="noopener ugc nofollow" target="_blank">@Injectable</a>({<br/>  providedIn: 'root'<br/>})<br/>export class TweetsService {</span><span id="e9f0" class="md me it ly b gy mj mg l mh mi">  constructor(<br/>    private http: HttpClient<br/>  ) { }</span><span id="b2c8" class="md me it ly b gy mj mg l mh mi">  getTweets(id: number) {<br/>    return this.http.get(`${environment.apiUrl}/tweets/get/${id}`)<br/>  }</span><span id="e9e0" class="md me it ly b gy mj mg l mh mi">  listTweets() {<br/>    return this.http.get(`${environment.apiUrl}/tweets/list`)<br/>  }</span><span id="4be2" class="md me it ly b gy mj mg l mh mi">  postTweet(data) {<br/>    return this.http.post(`${environment.apiUrl}/tweets/post`, data)<br/>  }</span><span id="3a0b" class="md me it ly b gy mj mg l mh mi">  updateTweet(id, data) {<br/>    return this.http.put(`${environment.apiUrl}/tweets/update/${id}`, data)<br/>  }</span><span id="ff7a" class="md me it ly b gy mj mg l mh mi">  deleteTweet(id: number) {<br/>    return this.http.delete(`${environment.apiUrl}/tweets/delete/${id}`)<br/>  }</span><span id="34e6" class="md me it ly b gy mj mg l mh mi">  sendTweet(id: number) {<br/>    return this.http.post(`${environment.apiUrl}/tweets/sendTweet/${id}`, {})<br/>  }</span><span id="da7b" class="md me it ly b gy mj mg l mh mi">  getTweetRecord(tweetId: number) {<br/>    return this.http.get(`${environment.apiUrl}/tweets/tweetRecord/${tweetId}`)<br/>  }</span><span id="54d4" class="md me it ly b gy mj mg l mh mi">  importOldTweets() {<br/>    return this.http.get(`${environment.apiUrl}/tweets/importOldTweets`)<br/>  }<br/>}</span></pre><p id="7948" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们有:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/0945a47e4b9ceacde2288ec6d648d9d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4zSown3JacU7Mp8cPHmRoA.png"/></div></div></figure><p id="2559" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">现在在http://jauyeung.net/subscribe/</strong><a class="ae ky" href="http://jauyeung.net/subscribe/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"/></a><strong class="lb iu">订阅我的邮件列表。关注我在推特上的</strong><a class="ae ky" href="https://twitter.com/AuMayeung" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">https://twitter.com/AuMayeung</strong></a></p></div></div>    
</body>
</html>