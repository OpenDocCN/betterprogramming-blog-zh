<html>
<head>
<title>HTTPS— In a Nutshell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTTPS——简而言之</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/https-in-a-nutshell-4be77279967c?source=collection_archive---------21-----------------------#2022-06-20">https://betterprogramming.pub/https-in-a-nutshell-4be77279967c?source=collection_archive---------21-----------------------#2022-06-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fa56" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">理解HTTPS如何工作所需的最少概念</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3c3c9b8d3d78eef80b0c462acbead74e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_XaSnZNtW7s4bF9Kc1O4gA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@felipegregate?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">费利佩·格里察</a>拍摄的照片</p></figure><p id="dd69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">对于一些工作来说，拥有一个证书——比如医学学位——是必要的，以确保这个人接受过从事这项工作的适当培训。这种情况引出了一个问题:如何验证一个人是否有证书？</em></p><h1 id="746c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">HTTPS是什么？</h1><p id="3887" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">当一个公司想要确认一个求职者是否拥有他们所说的资格证书时，它可能会雇佣一个“可信的”背景调查机构来联系持有求职者资格证书的机构，以验证他们拥有他们所做的事情。换句话说，一个可信的第三方确认了这种关系。</p><p id="9457" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦求职者成为公司的员工，他们通常可以访问公司提供的帐户，如电子邮件地址，这允许他们向公司的其他成员发送私人信息。</p><p id="a7bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">验证并通过公共互联网将私人数据发送到网络服务器(如Amazon.com)的过程类似。客户端，例如像Firefox或Google Chrome这样的web浏览器，通过被称为认证机构(CA)的可信第三方来验证它们已经连接到合法的web服务器，该认证机构可以证明浏览器正在与之对话的web服务器实际上是它所声称的那个服务器。</p><p id="a473" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦通过验证，客户端和浏览器就可以在彼此之间共享私人信息，如登录信息，因为它们已经建立了关系。</p><p id="5341" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，超文本传输协议安全(HTTPS)是一种协议，通过该协议，客户端(例如浏览器)可以:</p><ul class=""><li id="f673" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">验证它是否通过CA与正确的web服务器对话</li><li id="5b23" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr mv mw mx my bi translated">通过加密在web服务器和浏览器之间发送安全数据</li></ul><p id="d4e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将在本文的剩余部分讨论这个协议的细节。</p><h1 id="046c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">加密技术</h1><p id="f6ac" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">要了解HTTPS是如何工作的，我们首先必须了解一些加密技术，因为这些是HTTPS的基本工具。我不会深入到每个主题，但会提供一个基本的总结，让您可以掌握一般概念。</p><h2 id="e279" class="ne lu iq bd lv nf ng dn lz nh ni dp md lf nj nk mf lj nl nm mh ln nn no mj np bi translated">对称加密</h2><p id="64a0" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">消息、文件等。用私钥加密。这个相同的私钥解密消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/5869f7ec521cc3db49e60a0bf4b90cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-bqRXKwIe9J1BeXk"/></div></div></figure><ol class=""><li id="1db1" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nr mw mx my bi translated">爱丽丝和鲍勃共用一把秘密钥匙。</li><li id="1fd8" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">Alice可以使用秘密密钥来加密文件。</li><li id="36be" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">Bob可以用相同的密钥解密加密的文件，以返回原始消息。</li></ol><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="abba" class="ne lu iq nt b gy nx ny l nz oa">### Symmetric Encryption with GPG ###</span><span id="7894" class="ne lu iq nt b gy ob ny l nz oa">### Adapted from <a class="ae kv" href="https://www.baeldung.com/linux/encrypt-decrypt-files" rel="noopener ugc nofollow" target="_blank">https://www.baeldung.com/linux/encrypt-decrypt-files</a></span><span id="256a" class="ne lu iq nt b gy ob ny l nz oa"># create a random file<br/>echo hi &gt; symmetric-example.txt</span><span id="27e3" class="ne lu iq nt b gy ob ny l nz oa"># encrypt it with the phrase "mysecret"<br/>gpg --batch \<br/>    --output symmetric-example.txt.gpg \<br/>    --passphrase mysecret \<br/>    --symmetric symmetric-example.txt</span><span id="6936" class="ne lu iq nt b gy ob ny l nz oa"># decrypt it with the phrase<br/>gpg --batch \<br/>    --output symmetric-example-out.txt \<br/>    --passphrase mysecret \<br/>    --decrypt symmetric-example.txt.gpg</span><span id="cef4" class="ne lu iq nt b gy ob ny l nz oa"># check the differences<br/>diff symmetric-example.txt symmetric-example.out.txt</span></pre><h2 id="a4f4" class="ne lu iq bd lv nf ng dn lz nh ni dp md lf nj nk mf lj nl nm mh ln nn no mj np bi translated">不对称加密</h2><p id="024f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">密钥对包括公钥和私钥。公钥可以加密只能用其私钥解密的消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/2aa778047d6de6dd27431187e8a1ddcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gCd2R1EeVmv1zjPM"/></div></div></figure><ol class=""><li id="893d" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nr mw mx my bi translated">Alice生成公钥和私钥对。</li><li id="57ef" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">Alice与Bob共享她的公钥，Bob用它来加密消息。注意:Bob无法使用Alice的公钥解密该消息。</li><li id="fa7d" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">使用Alice的私钥将加密的消息解密回原始消息。</li></ol><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="770d" class="ne lu iq nt b gy nx ny l nz oa">### Asymmetric Encryption with GPG ###</span><span id="a95c" class="ne lu iq nt b gy ob ny l nz oa">### Adapted from <a class="ae kv" href="https://www.baeldung.com/linux/encrypt-decrypt-files" rel="noopener ugc nofollow" target="_blank">https://www.baeldung.com/linux/encrypt-decrypt-files</a></span><span id="48ad" class="ne lu iq nt b gy ob ny l nz oa"># generate the key pair as a key-ring<br/>gpg --batch --generate-key <!-- -->&lt;&lt;EOF<br/>    Key-Type: RSA<br/>    Key-Length: 3072<br/>    Subkey-Type: RSA<br/>    Subkey-Length: 3072<br/>    Name-Real: Alice<br/>    Name-Email: alice@example.com<br/>    Passphrase: alicerocks<br/>    Expire-Date: 30<br/>    %pubring alicepubring.kbx<br/>    %commit<br/>EOF</span><span id="5e51" class="ne lu iq nt b gy ob ny l nz oa"># Create a shareable public key, alicepubkey.gpg<br/>gpg --keyring ./alicepubring.kbx \<br/>    --no-default-keyring \<br/>    --armor \<br/>    --output alicepubkey.gpg \<br/>    --export</span><span id="637c" class="ne lu iq nt b gy ob ny l nz oa"># Import alice's pubkey into bob's keyring file<br/>gpg --keyring ./bobpubring.kbx \<br/>    --no-default-keyring \<br/>    --import alicepubkey.gpg</span><span id="e331" class="ne lu iq nt b gy ob ny l nz oa"># Encrypt a file with alice's pubkey<br/>echo "Hi Alice!" &gt; alice.txt</span><span id="3106" class="ne lu iq nt b gy ob ny l nz oa">gpg --keyring ./bobpubring.kbx \<br/>    --nodefault-keyring \<br/>    --encrypt \<br/>    --recipient "alice@example.com" alice.txt</span><span id="23bc" class="ne lu iq nt b gy ob ny l nz oa"># Decrypt the file with alice's private key<br/>gpg --keyring ./alicepubring.kbx \<br/>    --no-default-keyring \<br/>    --pinentry-mode=loopback \<br/>    --passphrase "alicerocks" \<br/>    --output alice-decrypted.txt \<br/>    --decrypt alice.txt.gpg </span><span id="ba26" class="ne lu iq nt b gy ob ny l nz oa"># Compare the messages<br/>diff -s alice.txt alice-decrypted.txt</span></pre><h2 id="6607" class="ne lu iq bd lv nf ng dn lz nh ni dp md lf nj nk mf lj nl nm mh ln nn no mj np bi translated">数字证书</h2><p id="2526" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">数字证书是由“可信”第三方颁发的身份文件(对于HTTPS，这是x.509证书)。数字证书就像护照；它们包含关于实体的身份和认证信息，并有办法通过认证机构验证该信息是否正确。</p><p id="9729" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在护照的情况下，认证机构是政府机构(如美国国务院)，实体是个人。护照中的身份信息包括该人的名、姓、出生日期等。海关和边境官员可以向该机构核实。</p><p id="1b1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于网站来说，认证机构是像<a class="ae kv" href="https://www.entrust.com/" rel="noopener ugc nofollow" target="_blank">委托</a>这样的机构，实体是web服务器。该证书包括关于web服务器的信息，如其通用名称(即域名)、组织、国家等。浏览器可以验证这一点。</p><p id="792b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以编程方式，数字证书遵循如下接口:</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="c1fb" class="ne lu iq nt b gy nx ny l nz oa">DigitalCertificate:<br/>  .public_key            # attribute, webserver pubkey<br/>  .identity_information  # attribute, webserver info<br/>  .issuing_CA            # attribute, CA info<br/>  .verify(CA_public_key) # method, verify it's signed by CA</span></pre><h1 id="1f65" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">HTTPS是如何工作的？</h1><p id="c658" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">HTTPS使用对称、非对称和数字证书来实现网络上的安全通信。下图详细描述了从web服务器希望向CA注册(步骤1–4)到web服务器和浏览器(即客户端)能够安全地相互传输数据(步骤5–9)的数据流:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/4c9a7d820f3e59a2706a2dd41f5ad600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9X6SinhmT5CvgBul"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">HTTPS通信</p></figure><ol class=""><li id="17eb" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr nr mw mx my bi translated">web服务器生成一个证书签名请求(CSR ),其中包括有关web服务器的身份信息及其私钥。它将CSR发送给CA。</li><li id="3012" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">一旦CA批准了CSR，它就对CSR进行签名，从而将其转换成数字证书。</li><li id="07f1" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">CA将证书发送回web服务器。</li><li id="e2dd" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">当从客户端(例如网络浏览器)向网络服务器发出GET请求时，网络服务器将来自步骤3的数字证书发送到浏览器。</li><li id="9464" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">收到证书后，浏览器会验证该证书是由一个已知的可信CA使用该CA的公钥签名的。<em class="ls">注意:浏览器内置了一个CA公钥数据库</em>。</li><li id="1017" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">一旦通过验证，浏览器就会为web服务器和浏览器之间的加密通信生成一个对称会话密钥。该对称会话密钥使用来自证书的web服务器的公钥进行加密，并发送回web服务器。</li><li id="8d9a" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">web服务器从客户端接收包含对称会话密钥的消息，并使用其私钥解密对称会话密钥</li><li id="5372" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">web服务器现在可以对称地加密消息，如HTML文件等。，并通过互联网发送加密邮件。</li><li id="77e9" class="mq mr iq ky b kz mz lc na lf nb lj nc ln nd lr nr mw mx my bi translated">一旦客户端收到加密的消息，它就可以解密并查看消息。</li></ol><h1 id="0dd0" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="19bc" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">您可能想知道，当整个过程只需要非对称加密就可以满足时，为什么HTTPS同时使用非对称和对称加密？这是因为对称加密相对于非对称加密来说速度更快。一旦客户机和服务器之间的验证完成，客户机和服务器之间就不再需要缓慢的、来回的不对称通信。</p></div></div>    
</body>
</html>