<html>
<head>
<title>Docker Container Security With Anchore Grype</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">码头集装箱安全系统</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/docker-container-security-with-anchore-grype-6913bc926499?source=collection_archive---------5-----------------------#2021-02-25">https://betterprogramming.pub/docker-container-security-with-anchore-grype-6913bc926499?source=collection_archive---------5-----------------------#2021-02-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9231" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对CI/CD管道中的容器映像运行漏洞扫描程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/824da686e8c5524892c70dada43a8af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZUiefQL4XTN12dg8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@danielkcheung?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">张家瑜</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="fc19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着云和容器编排器的出现，容器变得越来越普遍。Docker是我们使用的最流行的容器运行时之一，Docker图像无处不在。然而，由于它是一项相对较新的技术，而且随着人们对左移的日益关注，容器安全性成了一个热门话题。</p><p id="3ed1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数企业关注运行时容器的安全性。然而，有时容器本身在构建时有一个未被专业人员发现的漏洞。</p><p id="cd3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">容器使用层，大多数容器都是从Docker Hub上提供的第三方基本映像构建的。因此，即使您的代码是安全和健壮的，您可能最终会在生产中部署一些由于易受攻击的基础映像而不应该部署的东西。</p><p id="6395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">系统管理员通常在生产中强化操作系统映像，以确保您安全地运行应用程序。尽管如此，由于容器世界中的左移，这经常被开发人员忽略——我们不会责怪他们。他们知道如何很好地编码，而且他们做到了。传统上，安全是SecOps的责任，因此他们通常是管理安全的专家。</p><p id="b005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">DevSecOps专注于将安全性带到构建和发布自动化级别，有各种工具可用于在开发和构建周期的早期扫描漏洞。<a class="ae ky" href="https://github.com/anchore/grype" rel="noopener ugc nofollow" target="_blank"> Anchore Grype </a>就是这样一个可以提供帮助的工具。</p><p id="784b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Anchore Grype是一个容器漏洞扫描器，它使用一个易于安装和运行的简单CLI来帮助您扫描容器映像中的漏洞。最好的部分是，您可以在CI/CD管道中使用这个工具，并使跨越某个漏洞阈值的构建失败。</p><p id="e4bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们看看如何安装Anchore Grype。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a421" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">安装锚定Grype</h1><p id="7c3d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">安装Anchore Grype很简单。下载最新的安装程序，并使用以下命令运行该程序以在系统路径中生成二进制文件:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="aee0" class="ne md it na b gy nf ng l nh ni">$ curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin</span></pre><p id="96dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装Grype后，运行以下命令进行验证:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1a75" class="ne md it na b gy nf ng l nh ni">$ grype version<br/>Application:          grype<br/>Version:              0.7.0<br/>BuildDate:            2021-01-28T14:03:23Z<br/>GitCommit:            8344b8f0d3f61729cf0845c08b31f26103e21231<br/>GitTreeState:         clean<br/>Platform:             linux/amd64<br/>GoVersion:            go1.14.14<br/>Compiler:             gc<br/>Supported DB Schema:  1</span></pre><p id="4855" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们所看到的，Grype已经成功地安装在我们的系统中。</p><p id="09fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们运行一个漏洞扫描。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f2ad" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">运行漏洞扫描</h1><p id="8af9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要运行Docker映像的漏洞扫描，请使用以下命令:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8e1b" class="ne md it na b gy nf ng l nh ni">grype &lt;image&gt;</span></pre><p id="550a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们想要运行NGINX映像的漏洞扫描，运行以下命令:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/d3d04a687fe9e2ac2e90027463001a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*EjOvxADc_TSjU7GgGGAiKg.gif"/></div></div></figure><p id="39c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在响应中，我们获得列出的漏洞及其严重性。现在让我们在CI/CD管道中使用Grype工具。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bf5d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在CI/CD管道中使用Grype</h1><p id="bf55" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们将在这个活动中使用GitHub动作。这些操作将尝试在NGINX映像上运行容器构建，然后在将文件推送到容器注册表之前报告漏洞。</p><p id="1960" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分叉以下GitHub存储库以获得一个工作示例:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fb5a" class="ne md it na b gy nf ng l nh ni"><a class="ae ky" href="https://github.com/bharatmicrosystems/nginx-grype.git" rel="noopener ugc nofollow" target="_blank">https://github.com/bharatmicrosystems/nginx-grype.git</a></span></pre><p id="702d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在存储库中查找，您会看到以下docker文件:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8494" class="ne md it na b gy nf ng l nh ni">FROM nginx<br/>RUN echo 'This is a custom nginx image' &gt; /usr/share/nginx/html/index.html</span></pre><p id="1172" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个简单的docker文件，它获取nginx基本图像，并将“这是一个定制的NGINX图像”发送到<code class="fe nk nl nm na b">/usr/share/nginx/html/index.html</code>。因此，如果我们运行这个容器并访问它的URL，我们将在主页上看到“这是一个自定义的nginx图像”。</p><p id="4d77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了构建这个容器，我们有以下GitHub Actions工作流文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="11f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建YAML包括以下步骤:</p><ul class=""><li id="96ac" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">登录Docker Hub——它使用<code class="fe nk nl nm na b">secrets.DOCKER_USER</code>和<code class="fe nk nl nm na b">secrets.DOCKER_PASSWORD</code>变量登录你的Docker Hub账户。这些变量来源于GitHub secrets，我们将在后面进行配置。</li><li id="8386" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">构建Docker映像—然后使用Docker文件构建Docker映像。</li><li id="b930" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">运行Grype漏洞扫描—它使用设置为高的失败标志对构建的映像运行Grype漏洞扫描。如果我们发现任何标记为高或更高的漏洞，那么构建应该会失败。</li><li id="1a6f" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">推送Docker映像——如果一切正常，它会将Docker映像推送至您的Docker Hub注册表。</li></ul><p id="9cd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要将<code class="fe nk nl nm na b">DOCKER_USER</code>和<code class="fe nk nl nm na b">DOCKER_PASSWORD</code>配置为GitHub机密，请访问您在GitHub - &gt;设置- &gt;机密上的存储库，并配置以下两个机密:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="44d6" class="ne md it na b gy nf ng l nh ni">DOCKER_USER=Your DockerHub username<br/>DOCKER_PASSWORD=Your DockerHub password</span></pre><p id="18d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们准备运行CI/CD管道。转到您的代码并编辑自述文件，以推动对repo的更改。然后转到Actions选项卡，查看正在构建的映像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/f1da01569888bcff87bca0bfeac81f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6EY-kqDyjQm_ef5EbkFQxQ.gif"/></div></div></figure><p id="44fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如我们所见，构建失败了。那是因为我们发现了一个严重性很高的漏洞。我们刚刚阻止了一些讨厌的东西投入生产！</p><p id="578f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以调整容器映像，删除包含漏洞的包，并重新构建代码。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7f8e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="ed47" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Anchore Grype是一款功能强大的容器漏洞扫描器，它可以扫描OCI标准容器映像来查找已知的漏洞。它支持许多流行的操作系统包，如Alpine、Busybox、CentOS / Red Hat、Debian和Ubuntu，还支持流行的特定语言包，如Ruby Bundler、JARs (Java)、NPM/Yarn (JavaScript)、Egg/Wheel (Python)和Python <code class="fe nk nl nm na b">pip/requirements.txt/setup.py</code>清单。</p><p id="af10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！我希望你喜欢这篇文章。</p></div></div>    
</body>
</html>