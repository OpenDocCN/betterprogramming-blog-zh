<html>
<head>
<title>3 Reasons to Switch to FastAPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">转用FastAPI的3个理由</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/3-reasons-to-switch-to-fastapi-f9c788d017e5?source=collection_archive---------9-----------------------#2020-08-17">https://betterprogramming.pub/3-reasons-to-switch-to-fastapi-f9c788d017e5?source=collection_archive---------9-----------------------#2020-08-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9c1b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Flask vs. FastAPI</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5cbae90bb7a3f0886d133b97edf5ea13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v8gSoNrkmYlX8s3L"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@hishahadat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沙哈达特·拉赫曼</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄。</p></figure><p id="ed1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们生活在后Python 2时代，因为大多数公司已经适应了Python 3。语言越来越成熟。最近，Python一直在采用其他语言中很酷的东西。几个例子是类型提示和<code class="fe lv lw lx ly b">async/await</code>语法。</p><p id="daa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于Python语言的这些变化，是时候我们讨论一下新的猛兽了:<a class="ae ky" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>。根据我几个月来使用FastAPI和Flask的经验，让我们来看一下选择FastAPI比选择Flask的三个优点。</p><p id="3db2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">读完这篇文章，你会明白什么时候应该做出改变。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="ae55" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">异步ˌ非同步(asynchronous)</h1><p id="d706" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated"><code class="fe lv lw lx ly b">async/await</code>语法是最近在Python中引入的。大多数程序员认为这将加快一切。这并不完全正确，因为同步代码在大多数情况下都是可行的。<code class="fe lv lw lx ly b">Async/await</code>是一种以非常方便的方式编写异步代码的方法。</p><p id="c77d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就API编程而言，这是非常有趣的。我们看到对诸如排队、<a class="ae ky" href="https://medium.com/better-programming/how-to-create-a-websocket-in-python-b68d65dbd549?source=friends_link&amp;sk=556dcc527edf1d277053396332a270bd" rel="noopener"> WebSockets </a>等异步任务的需求正在上升。与Flask不同，FastAPI是在ASGI上实现的，允许您在本地创建异步和同步应用程序。</p><p id="e526" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您正在编写一个检索动物图片的端点。每个请求都需要一些时间。在后台，您可能会根据文本和HTTP图片调用进行一些预测。大多数时候，线程都在等待某个操作完成。</p><p id="f07b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在同步世界中，下面的代码片段将首先得到一张猫的图片，然后是一张狗的图片，最后是一张蝙蝠的图片。一个接一个。简单易行——我们早已熟知的编程方式。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="737a" class="nh mh it ly b gy ni nj l nk nl">get('A picture of a cat') // first<br/>get('A picture of a dog') // second<br/>get('A picture of a bat') // third</span></pre><p id="521e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，想象一下，这个API是公开的，用户正在使用它。想象一下，每个被触发的请求需要300毫秒来处理。当在同步世界中同时发送50个请求时，最后一个请求需要15秒才能完成。</p><p id="0537" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">突然之间，你的API被称为慢。你可以用多线程之类的东西来扩展它，但也只能有这么多。最后，这变得非常复杂。本质上，每个执行这个任务的线程都要花费300毫秒等待。</p><p id="9f73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">异步编程提供了改进。Asyncio 允许你等待一个进程结束，同时用同一个线程执行一些其他的计算。不用再等了！50个请求？没问题。我们一个接一个地把他们都送出去。您可以将其视为一个具有多个调用堆栈的单个线程。</p><p id="e77e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要底层基础设施能够处理它，我们就可以了。在这种极端情况下，我们甚至可以将所有请求的等待时间减少到300毫秒多一点。你明白了吗？如果没有，看这个<a class="ae ky" href="https://www.youtube.com/watch?v=tSLDcRkgTsY" rel="noopener ugc nofollow" target="_blank">教程</a>。</p><p id="6fc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nm">重要警告:如果您无法处理大量请求，请确保以您能够处理的速度对传入请求进行排队。有可能编写的代码非常快，以至于会破坏整个Kubernetes集群。在最近的</em> <a class="ae ky" href="https://mlconference.ai/" rel="noopener ugc nofollow" target="_blank"> <em class="nm">在线</em> </a> <em class="nm">机器学习大会期间，Carmine Paolino提到，当您将应用程序投入生产时，您必须牢记这一点。确保你能处理大量同时发送的请求。</em></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="88ab" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">类型提示</h1><p id="6747" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">FastAPI基于类型提示。到目前为止，Flask只是简单地忽略了它们。类型提示给了我们很多可读性。在任何时候，我们都确切地知道我们在与什么类型的人打交道。这非常有价值。虽然这在Java和TypeScript等其他语言中是常见的做法，但对于Python语言来说，这是一个新的很好的补充。</p><p id="43ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个行业正在适应。与以往相比，Python不仅被用作快速编写脚本的语言。越来越多的团队在一起工作，笔记本被共享，比以往更多的测试被编写。现在连前端世界都在写测试(如果你是其中一员，不要觉得被冒犯)。开发被视为一门手艺，也应该如此。</p><p id="0f69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天写的大部分代码还没有达到真正的工匠想要的标准。类型提示给了我们多一个工具来朝着正确的方向前进。当与适当的变量命名相结合时，这为我们省去了许多麻烦。干得好，蟒蛇。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="849a" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">内置OpenAPI</h1><p id="0e02" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">当你是一名程序员时，你可能对API很熟悉。最终，我们需要与我们的终端用户共享我们的终端，以便他们知道如何与您提供的服务进行交互。</p><p id="dd1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">FastAPI内置了OpenAPI (Swagger)和Redoc。这是FastAPI在它所基于的Starlette上提供的一个很好的附加功能。Flask也没有内置OpenAPI，因此您需要一个额外的库来完成相同的任务。</p><p id="e2b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个API最终都需要文档。如果你正在开发的API没有很好的文档记录，它就没有很大的生存机会。在开发的早期拥有一个API是很重要的。它允许您在早期手动测试应用程序。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="8dbf" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="627f" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在本文中，我们讨论了选择FastAPI而不是Flask的三个重要原因:</p><ol class=""><li id="b3b2" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">异步编程</li><li id="d1da" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">类型提示</li><li id="903d" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">内置文档</li></ol><p id="44a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个程序员，我一直认为你的框架只和你写的代码一样快。这就是为什么速度FastAPI在他们的<a class="ae ky" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">网站</a>上卖得很好的一件事——没有在本文中讨论。同样的道理也适用于bug、编码速度等。对我来说，这些指标很难衡量。你很容易将苹果和橘子相提并论。</p><p id="a21c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">老实说，你可以用Flask和FastAPI编写速度惊人的应用程序。如果您可以使用异步编程进一步改进您的应用程序，为什么不呢？</p></div></div>    
</body>
</html>