<html>
<head>
<title>Recovering From Common Git Errors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从常见Git错误中恢复</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/recovering-from-common-git-errors-eccda7ec6180?source=collection_archive---------11-----------------------#2022-06-27">https://betterprogramming.pub/recovering-from-common-git-errors-eccda7ec6180?source=collection_archive---------11-----------------------#2022-06-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8b73" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为了更快地回到您的开发中</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c3d06eabb1a111a6f3aa1edbba25ab58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NGwbJd4VYjeYYLXLJxbDCQ.png"/></div></div></figure><p id="a375" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在使用像Git这样复杂的东西时，我们经常会遇到一些常见的错误。但是作为人类，我们会犯错误，毕竟，最有效的学习方法是从错误中学习。</p><p id="cfd1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以，不要惊慌，没有任何进一步的麻烦，我在这里分享我犯的所有这些git错误，以及我如何修复这些错误。</p><h1 id="bf02" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">错误1:无意中删除了一个分支</h1><p id="4d0c" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">因此，可能有两种情况:要么你马上意识到了错误(即，删除了另一个分支，而不是预期的分支)，要么你最初没有意识到删除了错误的分支，但后来你意识到了。</p><p id="761b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第一个场景中，您可以在删除分支后在终端中简单地检查消息。它可能看起来像这样:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="d44a" class="mp lo iq ml b gy mq mr l ms mt">$git branch -d branch1<br/>warning: deleting branch 'branch1' that has been merged to 'refs/remotes/origin/branch1', but not yet merged to HEAD.<br/>Deleted branch branch1(was e9498ae).</span></pre><p id="36dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里，我们看到了删除分支时指向的提交的SHA值。使用这个SHA值，我们可以从提交本身创建一个新的分支。你只需要做到以下几点:</p><p id="0e9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mu mv mw ml b">git checkout [SHA]</code></p><p id="666f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦提交，就可以使用以下命令从那里重新创建分支:</p><p id="7a39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mu mv mw ml b">git checkout -b [branchname]</code></p><p id="3909" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第二种情况下，如果您丢失了消息，要找到位于已删除分支末端的提交的SHA。Do <code class="fe mu mv mw ml b">git reflog</code>，它实际上是你的回购中在任何时候被引用或曾经被引用的所有提交的记录。</p><p id="6b64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，您可以执行与上述第一种情况相同的命令。</p><h1 id="d377" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">错误2:您删除了一个文件或目录</h1><p id="77a0" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">这是一个我们都害怕的场景！</p><p id="478f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们所有人都至少从项目中删除过一次错误的文件。这可能是突然执行的<code class="fe mu mv mw ml b">rm -rf</code>命令，也可能是心不在焉的选择和删除，或者可能是任何错误脚本的结果！</p><p id="6ed7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不管是什么原因，删除一个重要的文件，如果不立即修复，可能会令人恼火。</p><p id="93a8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">同样，可能有许多可能的情况:</p><ol class=""><li id="ee1d" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated">如果您立即意识到这是一个错误，您需要运行以下命令:</li></ol><p id="e824" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mu mv mw ml b">$ git checkout HEAD &lt;filename&gt;</code></p><p id="40b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2.或者，另一种情况可能是您删除了文件并且也提交了删除。以下命令将带您回到提交之前的状态。</p><p id="0f76" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以，有三种方法可以做到:</p><p id="0b55" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mu mv mw ml b">$ git reset --soft HEAD~1</code></p><p id="ffde" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里，我们说让我们及时回滚，但是让我们保留这些更改，让我们将它们保存在暂存区和工作目录中，就好像它们还没有提交一样。有点类似于git commit amend。</p><p id="5b0a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mu mv mw ml b">$ git reset --mixed HEAD~1</code></p><p id="2745" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">混合重置允许我们返回到旧状态，就像软重置一样，它将代码更改留在工作目录中，而不是暂存区中。</p><p id="aa67" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mu mv mw ml b">$ git reset --hard HEAD~1</code></p><p id="8219" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在头指针指向一个提交，就像其他提交一样。但是，如果您将获得状态，您的更改并不存在。他们就这么走了！</p><p id="bfe0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用硬重置，git不会试图跟踪它们。它不会将它们放在我的暂存区或工作目录中。它只是说，“你知道吗，忘了他们吧。”</p><p id="741e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">3.现在，让我们来处理这样的场景:您提交了删除，然后又提交了更多。</p><p id="0ff2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，要找到正确的提交，请检查已删除文件的历史记录:</p><p id="baf4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mu mv mw ml b">$ git log -- &lt;filename&gt;</code></p><p id="358d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以使用仍有文件的最后一次提交，也可以使用删除文件的提交。在第一种情况下，只需从提交中签出文件:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="bfd9" class="mp lo iq ml b gy mq mr l ms mt">$ git checkout &lt;commit hash&gt; -- &lt;filename&gt;</span></pre><p id="2e6f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第二种情况下，从之前的一次提交中签出文件:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="4a51" class="mp lo iq ml b gy mq mr l ms mt">$ git checkout &lt;deletion commit hash&gt;~1 -- &lt;filename&gt;</span></pre><p id="6d25" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">4.我们可能犯的另一个错误是，我们删除了一个文件，提交了它，然后推送了它。</p><p id="e66e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您已经将您的一个或多个提交推送到远程，重置并再次推会导致问题，因为本地存储库的历史实际上已经被重写。在这种情况下，最好记录一个新的提交来撤销删除文件者的工作。为此，请运行以下命令:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="a088" class="mp lo iq ml b gy mq mr l ms mt">$ git revert --no-commit &lt;commit&gt;</span></pre><p id="491f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面，<code class="fe mu mv mw ml b">&lt;commit&gt;</code>是删除文件的提交。接下来，根据需要创建新的提交。“<code class="fe mu mv mw ml b">— no-commit</code>”选项阻止命令立即创建新的提交，而不是允许您准确地选择在新的提交中要恢复旧提交中引入的哪些更改。</p><h1 id="43c7" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">错误3:您在回购中添加了不需要的文件</h1><p id="4cfb" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">该死的。我最近面临这个问题，很痛苦！</p><p id="ff2a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我不小心推了文件，我只是不想它再在那里了。因此，这是您可以用来从git repo中删除文件的命令:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="a5d5" class="mp lo iq ml b gy mq mr l ms mt">git rm --cached &lt;filename&gt;</span></pre><p id="207b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这不会在本地删除它，所以如果你想把它保存在你的计算机上作为参考而不在g it上共享它，它是安全的。</p><p id="ac21" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注意</strong>:为了防止再次被推送到Git，只需将文件添加到你的<code class="fe mu mv mw ml b">.gitignore</code>中即可。</p><p id="5729" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当然，如果你不再需要这个文件，也可以从你的系统中删除它。</p><p id="2e58" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">等等！</p><p id="1a3a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是如果文件中有敏感数据，如密码或密钥，该怎么办呢？</p><p id="8cba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可能知道，提交仍然可以在存储库的历史中找到。所以，除此之外，你还需要做更多的事情。</p><h2 id="9b7a" class="mp lo iq bd lp ng nh dn lt ni nj dp lx la nk nl lz le nm nn mb li no np md nq bi translated">如果推送的文件包含密码等敏感数据</h2><p id="c398" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">上述方法不会将文件从提交历史中完全删除。</p><p id="f803" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了从你的历史中删除敏感文件，你可以使用一个叫做<a class="ae nr" href="https://rtyley.github.io/bfg-repo-cleaner/" rel="noopener ugc nofollow" target="_blank"> BFG回购清理器</a>的开源工具，或者使用git的<code class="fe mu mv mw ml b">git filter-branch</code>。</p><p id="fc57" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">与<code class="fe mu mv mw ml b">filter-branch</code>相比，BFG Repo-Cleaner使完成工作变得更加容易和快速。它允许您删除文件，或者用文本<code class="fe mu mv mw ml b">***REMOVED***</code>替换文件中的密码或密钥。您还可以删除意外推送的大文件。</p><p id="6ba1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以查看<a class="ae nr" href="https://rtyley.github.io/bfg-repo-cleaner/" rel="noopener ugc nofollow" target="_blank"> BFG回购清洁器的文档并下载页面</a>来了解如何使用它。说明相当直接。</p><p id="beaa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，要了解<code class="fe mu mv mw ml b">git filter-branch</code>，查看git帮助网站上的<a class="ae nr" href="https://help.github.com/en/articles/removing-sensitive-data-from-a-repository#using-filter-branch" rel="noopener ugc nofollow" target="_blank">使用过滤分支</a>文章和<a class="ae nr" href="https://git-scm.com/docs/git-filter-branch" rel="noopener ugc nofollow" target="_blank"> git过滤分支文档</a>。</p><h1 id="fb04" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">错误#4:您忘记在最后一次提交时添加文件</h1><p id="dcf2" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">另一个常见的Git陷阱是过早提交。</p><p id="c9c9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您错过了一个文件，忘记保存它，或者需要对最后一次提交做一些小的修改。<code class="fe mu mv mw ml b">--amend</code>是你最好的朋友。</p><p id="ca97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">添加丢失的文件，然后运行可信的命令:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="8784" class="mp lo iq ml b gy mq mr l ms mt">git add missed-file.txt<br/>git commit --amend</span></pre><p id="6438" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此时，您可以修改提交消息，也可以保存它以保持不变。</p><p id="7daf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，这些是一些常见的修复方法，以摆脱最常见的Git错误。</p><p id="9a33" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你有自己的git建议，请在下面的评论中告诉我，我很乐意听到。</p></div></div>    
</body>
</html>