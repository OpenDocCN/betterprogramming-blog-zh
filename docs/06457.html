<html>
<head>
<title>Microservice Observability — Metrics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务可观察性—指标</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/microservice-observability-metrics-bd9be270bc62?source=collection_archive---------3-----------------------#2020-10-03">https://betterprogramming.pub/microservice-observability-metrics-bd9be270bc62?source=collection_archive---------3-----------------------#2020-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a0e5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">密切关注让你对软件充满信心的信号</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/23ecd78ffcec4c43208fc04b4dc0e929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*530-MJBS4LKvtyxBMIBg4A.png"/></div></div></figure><p id="3966" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我之前的<a class="ae ln" href="https://medium.com/@theawesomenayak/microservice-observability-logging-2be535385616" rel="noopener">文章</a>中，我谈到了日志的重要性以及结构化和非结构化日志之间的区别。日志很容易集成到您的应用程序中，并且能够以字符串的形式表示任何类型的数据。</p><p id="c4cf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一方面，度量是数据的数字表示。这些通常用于计算或测量一个值，并在一段时间内进行汇总。指标让我们深入了解系统的历史和当前状态。因为它们只是数字，所以也可以用来进行统计分析和预测系统的未来行为。指标还用于触发警报，并通知您系统行为中的问题。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="0657" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">日志与指标</h1><h2 id="58f9" class="mn lw iq bd lx mo mp dn mb mq mr dp mf la ms mt mh le mu mv mj li mw mx ml my bi translated">格式</h2><p id="6a99" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">日志表示为字符串。它们可以是简单的文本、JSON有效负载或键值对(就像我们在结构化日志中讨论的那样)。</p><p id="92c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">指标用数字表示。他们测量一些东西(如CPU使用率、错误数量等。)并且本质上是数字。</p><h2 id="e7af" class="mn lw iq bd lx mo mp dn mb mq mr dp mf la ms mt mh le mu mv mj li mw mx ml my bi translated">解决</h2><p id="4c4d" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">日志包含高分辨率数据。这包括关于事件的完整信息，可用于关联事件通过系统的流程(或路径)。如果出现错误，日志包含异常的整个堆栈跟踪，这允许我们查看和调试来自下游系统的问题。简而言之，日志可以告诉你<em class="ne">在某个时间系统中发生了什么</em>。</p><p id="278c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">指标包含低分辨率数据。这可能包括参数计数(如请求、错误等。)和资源的度量(如CPU和内存利用率)。简而言之，指标可以给你<em class="ne">在某个时间系统中发生的事情的数量</em>。</p><h2 id="0b0b" class="mn lw iq bd lx mo mp dn mb mq mr dp mf la ms mt mh le mu mv mj li mw mx ml my bi translated">费用</h2><p id="5896" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">存储日志的成本很高。日志的存储开销也会随着时间的推移而增加，并且与流量的增加成正比。</p><p id="92dd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">度量具有恒定的存储开销。度量的存储和检索成本不会随着流量的增加而增加太多。然而，它依赖于我们用每个指标发出的变量的数量。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="2d68" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">基数</h1><p id="47fa" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">指标由两条关键信息确定:</p><ul class=""><li id="2015" class="nf ng iq kt b ku kv kx ky la nh le ni li nj lm nk nl nm nn bi translated">公制名称</li><li id="b404" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">称为标记或标签的一组键值对</li></ul><p id="e279" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这些值的排列提供了度量的基数。例如，如果我们正在测量一个有三台主机的系统的CPU利用率，该指标的基数值为3，可以有以下三个值:</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="7282" class="mn lw iq nu b gy ny nz l oa ob">(name=pod.cpu.utilization, host=A)<br/>(name=pod.cpu.utilization, host=B)<br/>(name=pod.cpu.utilization, host=C)</span></pre><p id="5f2a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">类似地，如果我们在度量中引入另一个标记来确定主机的AWS区域(比如，<code class="fe oc od oe nu b">us-west-1</code>和<code class="fe oc od oe nu b">us-west-2</code>)，我们现在将得到一个基数为6的度量。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="5c5a" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">度量的类型</h1><h2 id="6d8a" class="mn lw iq bd lx mo mp dn mb mq mr dp mf la ms mt mh le mu mv mj li mw mx ml my bi translated">黄金信号</h2><p id="f216" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">黄金信号是监控系统整体状态和识别问题的有效方法。</p><ul class=""><li id="f50c" class="nf ng iq kt b ku kv kx ky la nh le ni li nj lm nk nl nm nn bi translated">可用性:从客户端的角度衡量的系统状态(例如，总请求中的错误百分比)。</li><li id="8b7e" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">运行状况:使用定期pings来测量系统的状态。</li><li id="d872" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">请求速率:传入系统请求的速率。</li><li id="acd0" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">饱和度:系统的空闲或负载程度(例如队列深度或可用内存)。</li><li id="197c" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">利用率:系统有多忙(例如CPU负载或内存使用)。这是用百分比表示的。</li><li id="dd69" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">错误率:系统中产生错误的比率。</li><li id="7191" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">延迟:<strong class="kt ir"> </strong>系统的响应时间，通常以第95或99百分位来衡量。</li></ul><h2 id="579b" class="mn lw iq bd lx mo mp dn mb mq mr dp mf la ms mt mh le mu mv mj li mw mx ml my bi translated">资源度量</h2><p id="f7e9" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">默认情况下，基础设施提供商(AWS CloudWatch或Kubernetes metrics)几乎总是提供资源指标，并用于监控基础设施的健康状况。</p><ul class=""><li id="cf0c" class="nf ng iq kt b ku kv kx ky la nh le ni li nj lm nk nl nm nn bi translated">CPU/内存利用率:系统核心资源的使用情况。</li><li id="620f" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">主机计数:运行您的系统的主机pod的数量(用于检测由于pod崩溃导致的可用性问题)。</li><li id="29b5" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">活动线程:服务中产生的线程(用于检测多线程中的问题)。</li><li id="15ea" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">堆使用:堆内存使用统计(可以帮助调试内存泄漏)。</li></ul><h2 id="9093" class="mn lw iq bd lx mo mp dn mb mq mr dp mf la ms mt mh le mu mv mj li mw mx ml my bi translated">业务指标</h2><p id="8649" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">业务指标可用于监控与服务中核心API或功能的细粒度交互。</p><ul class=""><li id="680c" class="nf ng iq kt b ku kv kx ky la nh le ni li nj lm nk nl nm nn bi translated">请求速率:对API的请求速率。</li><li id="ed23" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">错误率:API抛出错误的比率。</li><li id="50f4" class="nf ng iq kt b ku no kx np la nq le nr li ns lm nk nl nm nn bi translated">延迟:API处理请求所花费的时间。</li></ul></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="da3e" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">仪表板和警报</h1><p id="5717" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">由于指标存储在时间序列数据库中，因此针对它们运行查询来测量系统状态会更加高效和可靠。</p><p id="2b6f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这些查询可用于构建表示系统历史状态的仪表板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/60bedab66730125f3f1563eb04308e2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVFwcxe8I1FFCLdyakINZw.png"/></div></div><p class="og oh gj gh gi oi oj bd b be z dk translated">包含一些重要指标的波前仪表盘</p></figure><p id="0b8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它们还可用于在系统出现问题时触发警报(例如，观察到的错误数量增加或CPU利用率突然激增)。</p><p id="eeae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于它们的数字性质，我们还可以创建复杂的数学查询(例如过去Y分钟内的X%错误)来监控系统健康状况。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="7bbe" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">结论</h1><p id="9921" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">在本文中，我们看到了指标和日志之间的区别，以及指标如何帮助我们更有效地监控系统的健康状况。使用Wavefront和Grafana等监控软件，指标还可用于创建仪表板和警报。</p><p id="307a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，处理指标的最大挑战是决定基数的正确数量，使指标有用，同时控制成本。有必要协调使用度量和日志来准确地检测和调试问题。</p><p id="903b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是我的微服务可观察性系列的第二部分。如果你还没有看过<a class="ae ln" href="https://medium.com/@theawesomenayak/microservice-observability-logging-2be535385616" rel="noopener">第一集</a>的话，就来看看吧。我会在下一篇文章上线时添加链接。敬请期待！</p></div></div>    
</body>
</html>