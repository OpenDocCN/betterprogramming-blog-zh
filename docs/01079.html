<html>
<head>
<title>React Hooks-Oriented Redux Coding Pattern Without Thunks and Action Creators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">没有Thunks和动作创建器的面向钩子的Redux编码模式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-hooks-oriented-redux-coding-pattern-without-thunks-and-action-creators-b338b42c5327?source=collection_archive---------18-----------------------#2019-08-12">https://betterprogramming.pub/react-hooks-oriented-redux-coding-pattern-without-thunks-and-action-creators-b338b42c5327?source=collection_archive---------18-----------------------#2019-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="529f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">小型应用程序和初学者指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bb579d7bd22be2a621a67acd3ae7769e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYKoKrHz2IG_sWon-ZZrsQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@berkaygumustekin" rel="noopener ugc nofollow" target="_blank"> Berkay Gumustekin </a>在<a class="ae ky" href="https://unsplash.com/photos/fogjAvfUERE" rel="noopener ugc nofollow" target="_blank"> Upsplash </a>上拍摄</p></figure><h1 id="09df" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">动机</h1><p id="3863" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我爱Redux。但这并不意味着我喜欢Redux生态系统的所有部分。有些人不喜欢Redux，因为它的样板代码。真可悲。样板代码不是来自Redux核心，而是来自生态系统。不要误解我。最佳实践很好，我认为Redux Starter Kit最近的工作很棒。(向马克鼓掌。)</p><p id="bc90" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于Redux怎么和React一起用，我想我有自己的理解。可能不常见，大概也永远不会是主流。我知道Redux是有用的，并针对较大的应用程序进行了调整，但我想到的是较小的应用程序和初学者的用法。</p><p id="2776" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于较小的应用程序和初学者来说，似乎有几个障碍。我的第一个是<code class="fe ms mt mu mv b">mapStateToProps</code>。我开发了<a class="ae ky" href="https://github.com/dai-shi/reactive-react-redux" rel="noopener ugc nofollow" target="_blank"> reactive-react-redux </a>来解决。它提供了一个超级简单的<code class="fe ms mt mu mv b">useTrackedState</code>。它是在Redux hooks API可用之前开发的。现在，<code class="fe ms mt mu mv b">useSelector</code>从新的钩子API是如此之好。比<code class="fe ms mt mu mv b">mapStateToProps</code>丑多了。注意，<code class="fe ms mt mu mv b">useTrackedState</code>仍然更容易，因为它不需要内存化来优化。</p><p id="71a1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我面临的另一个障碍是异步操作。我一般喜欢Redux的中间件系统和Redux Thunk实现的优雅。但是我发现它有些困难。基本上就是太灵活了。这在某种程度上就像将中间件系统暴露给用户。就像人们通过繁重的计算误用选择器一样，人们误用thunks——或者过度使用它们。Redux-Observable和Redux-Saga似乎提供了更好的抽象，但它们是复杂的系统。它们适合更大的应用程序。</p><p id="9ce1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">所以在这篇文章中，我想展示一个替代模式的示例代码。它不使用中间件，而是反应自定义挂钩。以下是这种模式中的一些要点。</p><ul class=""><li id="6702" class="mw mx it lt b lu mn lx mo ma my me mz mi na mm nb nc nd ne bi translated">没有异步库(在Redux之外运行异步任务)</li><li id="cf65" class="mw mx it lt b lu nf lx ng ma nh me ni mi nj mm nb nc nd ne bi translated">无操作创建者(在TypeScript中定义操作类型)</li></ul><p id="353d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">不多说了，让我们深入代码。</p><p id="cc98" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">(顺便说一下，对我来说还有一个障碍是<code class="fe ms mt mu mv b">combineReducers</code>，但这超出了本文的范围。)</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="75c3" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">例子</h1><p id="5ae0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要用的例子是官方Redux高级教程中的<a class="ae ky" href="https://redux.js.org/advanced/async-actions" rel="noopener ugc nofollow" target="_blank">异步动作</a>。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="2218" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">密码</h1><h2 id="e24c" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated"><strong class="ak">文件夹结构</strong></h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="f197" class="nw la it mv b gy om on l oo op">- src/<br/>  - index.tsx<br/>  - store/<br/>    - actions.ts<br/>    - reducers.ts<br/>  - hooks/<br/>    - useSelectSubreddit.ts<br/>    - useInvalidateSubreddit.ts<br/>    - useFetchPostsIfNeeded.ts<br/>  - components/<br/>    - App.tsx<br/>    - Picker.tsx<br/>    - Posts.tsx</span></pre><h2 id="3806" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated"><strong class="ak"> src/index.tsx </strong></h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="82fe" class="nw la it mv b gy om on l oo op">import * as React from 'react';<br/>import { render } from 'react-dom';<br/>import { Provider } from 'react-redux';</span><span id="6ab0" class="nw la it mv b gy oq on l oo op">import rootReducer from './store/reducers';<br/>import App from './components/App';</span><span id="ebae" class="nw la it mv b gy oq on l oo op">const store = createStore(rootReducer);</span><span id="5f77" class="nw la it mv b gy oq on l oo op">render(<br/>  &lt;Provider store={store}&gt;<br/>    &lt;App /&gt;<br/>  &lt;/Provider&gt;,<br/>  document.getElementById('app'),<br/>);</span></pre><p id="4c7f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是切入点。你在这个文件里找不到什么特别的东西。</p><h2 id="ebc6" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated"><strong class="ak"> src/store/actions.ts </strong></h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="1531" class="nw la it mv b gy om on l oo op">export type Post = {<br/>  id: string;<br/>  title: string;<br/>};</span><span id="cc1e" class="nw la it mv b gy oq on l oo op">export type SubredditPosts = {<br/>  isFetching: boolean;<br/>  didInvalidate: boolean;<br/>  items: Post[];<br/>  lastUpdated?: number;<br/>};</span><span id="ec91" class="nw la it mv b gy oq on l oo op">export type PostsBySubreddit = {<br/>  [subreddit: string]: SubredditPosts;<br/>};</span><span id="8943" class="nw la it mv b gy oq on l oo op">export type SelectedSubreddit = string;</span><span id="beba" class="nw la it mv b gy oq on l oo op">export type State = {<br/>  selectedSubreddit: SelectedSubreddit;<br/>  postsBySubreddit: PostsBySubreddit;<br/>};</span><span id="72a3" class="nw la it mv b gy oq on l oo op">type SelectSubredditAction = {<br/>  type: 'SELECT_SUBREDDIT';<br/>  subreddit: string;<br/>};</span><span id="c57b" class="nw la it mv b gy oq on l oo op">type InvalidateSubredditAction = {<br/>  type: 'INVALIDATE_SUBREDDIT';<br/>  subreddit: string;<br/>};</span><span id="0e55" class="nw la it mv b gy oq on l oo op">type RequestPostsAction = {<br/>  type: 'REQUEST_POSTS';<br/>  subreddit: string;<br/>};</span><span id="89b4" class="nw la it mv b gy oq on l oo op">type ReceivePostsAction = {<br/>  type: 'RECEIVE_POSTS';<br/>  subreddit: string;<br/>  posts: Post[];<br/>  receivedAt: number;<br/>};</span><span id="90f0" class="nw la it mv b gy oq on l oo op">export type Action =<br/>  | SelectSubredditAction<br/>  | InvalidateSubredditAction<br/>  | RequestPostsAction<br/>  | ReceivePostsAction;</span></pre><p id="b818" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这定义了<code class="fe ms mt mu mv b">State</code>和<code class="fe ms mt mu mv b">Action</code>类型。没有定义动作常数和动作创建者。</p><h2 id="0f23" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated"><strong class="ak"> src/store/reducers.ts </strong></h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="2342" class="nw la it mv b gy om on l oo op">import { combineReducers } from 'redux';<br/>import {<br/>  SubredditPosts,<br/>  SelectedSubreddit,<br/>  PostsBySubreddit,<br/>  State,<br/>  Action,<br/>} from './actions';</span><span id="53e9" class="nw la it mv b gy oq on l oo op">const selectedSubreddit = (<br/>  state: SelectedSubreddit = 'reactjs',<br/>  action: Action,<br/>): SelectedSubreddit =&gt; {<br/>  switch (action.type) {<br/>    case 'SELECT_SUBREDDIT':<br/>      return action.subreddit;<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="d548" class="nw la it mv b gy oq on l oo op">const posts = (state: SubredditPosts = {<br/>  isFetching: false,<br/>  didInvalidate: false,<br/>  items: [],<br/>}, action: Action): SubredditPosts =&gt; {<br/>  switch (action.type) {<br/>    case 'INVALIDATE_SUBREDDIT':<br/>      return {<br/>        ...state,<br/>        didInvalidate: true,<br/>      };<br/>    case 'REQUEST_POSTS':<br/>      return {<br/>        ...state,<br/>        isFetching: true,<br/>        didInvalidate: false,<br/>      };<br/>    case 'RECEIVE_POSTS':<br/>      return {<br/>        ...state,<br/>        isFetching: false,<br/>        didInvalidate: false,<br/>        items: action.posts,<br/>        lastUpdated: action.receivedAt,<br/>      };<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="90e3" class="nw la it mv b gy oq on l oo op">const postsBySubreddit = (<br/>  state: PostsBySubreddit = {},<br/>  action: Action,<br/>): PostsBySubreddit =&gt; {<br/>  switch (action.type) {<br/>    case 'INVALIDATE_SUBREDDIT':<br/>    case 'RECEIVE_POSTS':<br/>    case 'REQUEST_POSTS':<br/>      return {<br/>        ...state,<br/>        [action.subreddit]: posts(state[action.subreddit], action),<br/>      };<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="bdb2" class="nw la it mv b gy oq on l oo op">const rootReducer = combineReducers&lt;State&gt;({<br/>  postsBySubreddit,<br/>  selectedSubreddit,<br/>});</span><span id="c249" class="nw la it mv b gy oq on l oo op">export default rootReducer;</span></pre><p id="0067" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是一个带有类型注释的普通reducer文件。注意，我们没有使用显式或隐式的<code class="fe ms mt mu mv b">any</code>。</p><h2 id="19c4" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated"><strong class="ak">src/hooks/useselectsubreddit . ts</strong></h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="4087" class="nw la it mv b gy om on l oo op">import { useCallback } from 'react';<br/>import { useDispatch } from 'react-redux';</span><span id="27f7" class="nw la it mv b gy oq on l oo op">import { Action } from '../store/actions';</span><span id="656a" class="nw la it mv b gy oq on l oo op">const useSelectSubreddit = () =&gt; {<br/>  const dispatch = useDispatch&lt;Action&gt;();<br/>  const selectSubreddit = useCallback((subreddit: string) =&gt; {<br/>    dispatch({<br/>      type: 'SELECT_SUBREDDIT',<br/>      subreddit,<br/>    });<br/>  }, [dispatch]);<br/>  return selectSubreddit;<br/>};</span><span id="a535" class="nw la it mv b gy oq on l oo op">export default useSelectSubreddit;</span></pre><p id="8d87" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是某种东西而不是一个动作创造者。它是一个返回回调函数的钩子，该函数创建并调度一个动作。姑且称之为<em class="or">动作钩。</em>这是一个同步动作挂钩:</p><h2 id="5b64" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated">src/hooks/use invalidatesubreddit . ts</h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="6fe8" class="nw la it mv b gy om on l oo op">import { useCallback } from 'react';<br/>import { useDispatch } from 'react-redux';</span><span id="08e8" class="nw la it mv b gy oq on l oo op">import { Action } from '../store/actions';</span><span id="b16c" class="nw la it mv b gy oq on l oo op">const useInvalidateSubreddit = () =&gt; {<br/>  const dispatch = useDispatch&lt;Action&gt;();<br/>  const invalidateSubreddit = useCallback((subreddit: string) =&gt; {<br/>    dispatch({<br/>      type: 'INVALIDATE_SUBREDDIT',<br/>      subreddit,<br/>    });<br/>  }, [dispatch]);<br/>  return invalidateSubreddit;<br/>};</span><span id="9cec" class="nw la it mv b gy oq on l oo op">export default useInvalidateSubreddit;</span></pre><p id="aa53" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是另一个同步动作挂钩:</p><h2 id="fd81" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated"><strong class="ak">src/hooks/usefetchpostsifneed . ts</strong></h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="0e8a" class="nw la it mv b gy om on l oo op">import { useCallback } from 'react';<br/>import { useDispatch, useStore } from 'react-redux';</span><span id="d186" class="nw la it mv b gy oq on l oo op">import { Action, State, Post } from '../store/actions';</span><span id="4347" class="nw la it mv b gy oq on l oo op">const shouldFetchPosts = (state: State, subreddit: string) =&gt; {<br/>  const posts = state.postsBySubreddit[subreddit];<br/>  if (!posts) {<br/>    return true;<br/>  }<br/>  if (posts.isFetching) {<br/>    return false;<br/>  }<br/>  return posts.didInvalidate;<br/>};</span><span id="2a9a" class="nw la it mv b gy oq on l oo op">const extractPosts = (json: unknown): Post[] | null =&gt; {<br/>  try {<br/>    const posts: Post[] = (json as {<br/>      data: {<br/>        children: {<br/>          data: {<br/>            id: string;<br/>            title: string;<br/>          };<br/>        }[];<br/>      };<br/>    }).data.children.map(child =&gt; child.data);<br/>    // type check<br/>    if (posts.every(post =&gt; (<br/>      typeof post.id === 'string' &amp;&amp; typeof post.title === 'string'<br/>    ))) {<br/>      return posts;<br/>    }<br/>    return null;<br/>  } catch (e) {<br/>    return null;<br/>  }<br/>};</span><span id="7ee0" class="nw la it mv b gy oq on l oo op">const useFetchPostsIfNeeded = () =&gt; {<br/>  const dispatch = useDispatch&lt;Action&gt;();<br/>  const store = useStore&lt;State&gt;();<br/>  const fetchPostsIfNeeded = useCallback(async (subreddit: string) =&gt; {<br/>    if (!shouldFetchPosts(store.getState(), subreddit)) {<br/>      return;<br/>    }<br/>    dispatch({<br/>      type: 'REQUEST_POSTS',<br/>      subreddit,<br/>    });<br/>    const response = await fetch(`<a class="ae ky" href="https://www.reddit.com/r/" rel="noopener ugc nofollow" target="_blank">https://www.reddit.com/r/</a>${subreddit}.json`);<br/>    const json = await response.json();<br/>    const posts = extractPosts(json);<br/>    if (!posts) throw new Error('unexpected json format');<br/>    dispatch({<br/>      type: 'RECEIVE_POSTS',<br/>      subreddit,<br/>      posts,<br/>      receivedAt: Date.now(),<br/>    });<br/>  }, [dispatch, store]);<br/>  return fetchPostsIfNeeded;<br/>};</span><span id="7d7e" class="nw la it mv b gy oq on l oo op">export default useFetchPostsIfNeeded;</span></pre><p id="224f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是一个异步操作钩子。这是用Thunk编写的逻辑。这个文件中有几个要点。</p><ul class=""><li id="9598" class="mw mx it lt b lu mn lx mo ma my me mz mi na mm nb nc nd ne bi translated">因为这不是中间件，所以我们不能直接访问状态。它用的是<code class="fe ms mt mu mv b">useStore</code>，这是我们不应该误用的。这是整个模式中最大的警告。</li><li id="afb6" class="mw mx it lt b lu nf lx ng ma nh me ni mi nj mm nb nc nd ne bi translated"><code class="fe ms mt mu mv b">extractPosts</code>是一种从网络上测试JSON的类型卫士。</li><li id="2188" class="mw mx it lt b lu nf lx ng ma nh me ni mi nj mm nb nc nd ne bi translated">我们没有像原来教程中的<a class="ae ky" href="https://redux.js.org/advanced/async-actions#note-on-error-handling" rel="noopener ugc nofollow" target="_blank">那样实现错误处理。</a></li></ul><h2 id="9a06" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated"><strong class="ak"> src/components/App.tsx </strong></h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="7422" class="nw la it mv b gy om on l oo op">import * as React from 'react';<br/>import { useCallback, useEffect } from 'react';<br/>import { useSelector } from 'react-redux';</span><span id="0f2e" class="nw la it mv b gy oq on l oo op">import { State, SelectedSubreddit } from '../store/actions';<br/>import useSelectSubreddit from '../hooks/useSelectSubreddit';<br/>import useFetchPostsIfNeeded from '../hooks/useFetchPostsIfNeeded';<br/>import useInvalidateSubreddit from '../hooks/useInvalidateSubreddit';</span><span id="bf2c" class="nw la it mv b gy oq on l oo op">import Picker from './Picker';<br/>import Posts from './Posts';</span><span id="e9e1" class="nw la it mv b gy oq on l oo op">const App: React.FC = () =&gt; {<br/>  const selectedSubreddit = useSelector((state: State) =&gt; state.selectedSubreddit);<br/>  const postsBySubreddit = useSelector((state: State) =&gt; state.postsBySubreddit);<br/>  const {<br/>    isFetching,<br/>    items: posts,<br/>    lastUpdated,<br/>  } = postsBySubreddit[selectedSubreddit] || {<br/>    isFetching: true,<br/>    items: [],<br/>    lastUpdated: undefined,<br/>  };</span><span id="1826" class="nw la it mv b gy oq on l oo op">  const fetchPostsIfNeeded = useFetchPostsIfNeeded();<br/>  useEffect(() =&gt; {<br/>    fetchPostsIfNeeded(selectedSubreddit);<br/>  }, [fetchPostsIfNeeded, selectedSubreddit]);</span><span id="1de5" class="nw la it mv b gy oq on l oo op">  const selectSubreddit = useSelectSubreddit();<br/>  const handleChange = useCallback((nextSubreddit: SelectedSubreddit) =&gt; {<br/>    selectSubreddit(nextSubreddit);<br/>  }, [selectSubreddit]);</span><span id="83b2" class="nw la it mv b gy oq on l oo op">  const invalidateSubreddit = useInvalidateSubreddit();<br/>  const handleRefreshClick = (e: React.MouseEvent) =&gt; {<br/>    e.preventDefault();<br/>    invalidateSubreddit(selectedSubreddit);<br/>    fetchPostsIfNeeded(selectedSubreddit);<br/>  };</span><span id="652a" class="nw la it mv b gy oq on l oo op">  const isEmpty = posts.length === 0;<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;Picker<br/>        value={selectedSubreddit}<br/>        onChange={handleChange}<br/>        options={['reactjs', 'frontend']}<br/>      /&gt;<br/>      &lt;p&gt;<br/>        {lastUpdated &amp;&amp; (<br/>          &lt;span&gt;<br/>            Last updated at {new Date(lastUpdated).toLocaleTimeString()}.<br/>            {' '}<br/>          &lt;/span&gt;<br/>        )}<br/>        {!isFetching &amp;&amp; (<br/>          &lt;button type="button" onClick={handleRefreshClick}&gt;<br/>            Refresh<br/>          &lt;/button&gt;<br/>        )}<br/>      &lt;/p&gt;<br/>      {isEmpty &amp;&amp; isFetching &amp;&amp; &lt;h2&gt;Loading...&lt;/h2&gt;}<br/>      {isEmpty &amp;&amp; !isFetching &amp;&amp; &lt;h2&gt;Empty.&lt;/h2&gt;}<br/>      {!isEmpty &amp;&amp; (<br/>        &lt;div style={{ opacity: isFetching ? 0.5 : 1 }}&gt;<br/>          &lt;Posts posts={posts} /&gt;<br/>        &lt;/div&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="f1b3" class="nw la it mv b gy oq on l oo op">export default App;</span></pre><p id="9a1d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是一个根组件或容器组件。不幸的是，代码看起来像样板文件。但它应该与普通的React应用程序基本相同。我认为这种模式的第二个警告是需要<code class="fe ms mt mu mv b">useCallback</code>钩子。</p><h2 id="6e2e" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated"><strong class="ak">src/components/picker . tsx</strong></h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="905a" class="nw la it mv b gy om on l oo op">import * as React from 'react';</span><span id="d3ff" class="nw la it mv b gy oq on l oo op">const Picker: React.FC&lt;{<br/>  value: string;<br/>  onChange: (value: string) =&gt; void;<br/>  options: string[];<br/>}&gt; = ({ value, onChange, options }) =&gt; (<br/>  &lt;span&gt;<br/>    &lt;h1&gt;{value}&lt;/h1&gt;<br/>    &lt;select<br/>      onChange={e =&gt; onChange(e.target.value)}<br/>      value={value}<br/>    &gt;<br/>      {options.map(option =&gt; (<br/>        &lt;option value={option} key={option}&gt;<br/>          {option}<br/>        &lt;/option&gt;<br/>      ))}<br/>    &lt;/select&gt;<br/>  &lt;/span&gt;<br/>);</span><span id="89c3" class="nw la it mv b gy oq on l oo op">export default Picker;</span></pre><p id="df28" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是一个无状态组件。除了类型注释之外，什么都没有改变。</p><h2 id="7243" class="nw la it bd lb nx ny dn lf nz oa dp lj ma ob oc ll me od oe ln mi of og lp oh bi translated"><strong class="ak">src/components/posts . tsx</strong></h2><pre class="kj kk kl km gt oi mv oj ok aw ol bi"><span id="5127" class="nw la it mv b gy om on l oo op">import * as React from 'react';</span><span id="fcc7" class="nw la it mv b gy oq on l oo op">const Posts: React.FC&lt;{<br/>  posts: {<br/>    id: string;<br/>    title: string;<br/>  }[];<br/>}&gt; = ({ posts }) =&gt; (<br/>  &lt;ul&gt;<br/>    {posts.map(post =&gt; (<br/>      &lt;li key={post.id}&gt;{post.title}&lt;/li&gt;<br/>    ))}<br/>  &lt;/ul&gt;<br/>);</span><span id="cc24" class="nw la it mv b gy oq on l oo op">export default Posts;</span></pre><p id="0942" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这是另一个无状态组件。我们可以从<code class="fe ms mt mu mv b">actions.ts</code>导入<code class="fe ms mt mu mv b">Post</code>。</p><p id="473e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">就这些了。我们都准备好了。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="19cb" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">演示</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/dai-shi/reactive-react-redux/tree/master/examples/12_async" rel="noopener ugc nofollow" target="_blank">回购中的源代码</a></p></figure><p id="8539" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意这段代码是基于<a class="ae ky" href="https://github.com/dai-shi/reactive-react-redux" rel="noopener ugc nofollow" target="_blank"> reactive-react-redux </a>而不是react-redux。reactive-react-redux有一个与react-redux兼容的hooks API，除了<code class="fe ms mt mu mv b">useStore</code>。在这个演示中，<code class="fe ms mt mu mv b">useStore</code>是用另一个上下文实现的。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="d17c" class="kz la it bd lb lc nr le lf lg ns li lj jz nt ka ll kc nu kd ln kf nv kg lp lq bi translated">结束语</h1><p id="bdd0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这种编码模式可能并不新鲜，我相信已经有人尝试过了。然而，使用React钩子和TypeScript更有意义。它可以消除一些样板代码。这个例子使用了一个<code class="fe ms mt mu mv b">isFetching</code>标志来显示加载状态，但是它会随着React悬念而改变。这种模式应该可以缓解悬念的过渡。</p></div></div>    
</body>
</html>