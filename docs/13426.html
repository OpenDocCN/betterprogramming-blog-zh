<html>
<head>
<title>Creating a Traveling Distance Map for a Whole City With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python创建整个城市的旅行距离地图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-a-traveling-distance-map-for-a-whole-city-with-python-f2e063272832?source=collection_archive---------6-----------------------#2022-08-25">https://betterprogramming.pub/creating-a-traveling-distance-map-for-a-whole-city-with-python-f2e063272832?source=collection_archive---------6-----------------------#2022-08-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5319" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">同时使用多个点的图形网络和叶图的等时线绘图</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7ced14f299d6cf8f2d36cd8c85612883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QXmNSXo4sUnTHnh_TIDUEQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">汉堡公共交通的可用性|图片由作者提供</p></figure><p id="9f8e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">计算从你的位置到你能到达的所有地方的距离被称为等时线，如果你想知道在特定时间内你能到达什么地方，这是非常有用的。但是，如果您想反过来创建一张地图，显示从一系列感兴趣的点到城市中所有点的旅行距离，该怎么办呢？本教程将向您展示如何自己创建这样的等时线图！</p><p id="d921" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以在这个streamlit应用程序上找到结果的概述:<a class="ae lr" href="https://doppelfelix-isochron-hamburg-streamlitbikes-over-the-day-awtwm5.streamlitapp.com/Walking_Distances_to_Infrastructure" rel="noopener ugc nofollow" target="_blank">到汉堡基础设施的步行距离</a>。</p><h1 id="b9ed" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">创建图形网络</strong></h1><p id="24ec" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">创建图形网络相当容易。首先，安装并导入所需的库。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="ef9c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们为起始地址创建图，给出一个节点列表，这些节点本质上是简化的街道交叉口。之后，我们将其转换为GeoPandas数据帧，以绘制生成的节点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="f347" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mr ms mt mu b">dist</code>是用于创建图表的从起始位置的距离。</p><p id="a31a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mr ms mt mu b">network_type</code>是您要使用的交通工具类型，其他选项有:<code class="fe mr ms mt mu b">all_private</code>、<code class="fe mr ms mt mu b">all</code>、<code class="fe mr ms mt mu b">bike</code>、<code class="fe mr ms mt mu b">drive</code>、<code class="fe mr ms mt mu b">drive_service</code>。</p><p id="ce33" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以使用下面的代码在一张叶子地图上查看我们的网络:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/af4ec5c32a0910c4f1bc35e36dc77d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*Xh0sRE7LqcYaZwG1RiMV5g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带有我们创建的节点的叶子图|图片由作者提供</p></figure><h2 id="9cc9" class="mw lt iq bd lu mx my dn ly mz na dp mc le nb nc me li nd ne mg lm nf ng mi nh bi translated">为每个感兴趣的点创建等时线</h2><p id="3392" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">现在是有趣的部分:为每个感兴趣的点创建等时线，并计算到每个新创建的节点的距离。在这种情况下，我们将使用汉堡市所有地铁站的位置。为了使用这些位置，我们必须为每个坐标元组找到最近的节点。这在osmnx函数<code class="fe mr ms mt mu b">nearest_nodes</code>的帮助下很容易实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="c8e1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了计算实际距离，我们需要将网络投影到地图上。变换因纬度而异。(<a class="ae lr" href="https://en.wikipedia.org/wiki/Map_projection" rel="noopener ugc nofollow" target="_blank">Wikipedia:Map projection</a>)我们将使用<code class="fe mr ms mt mu b">project_graph</code>函数的默认设置来这样做。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="b10e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们已经可以为单个兴趣点(POI)创建一个距离数组。如果我们使用networkx函数<code class="fe mr ms mt mu b">shortest_path_length</code>并且只提供一个源，它将计算到所提供的图中所有其他节点的最短距离。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="27aa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们字典的结构应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="0196" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们已经可以继续这样做，并从中创造一个情节。这将需要一些工作，虽然，因为我们需要自己创建一个彩色地图，以直观的方式在叶地图上很好地呈现距离。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="5c7e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们自己创建了一个彩色地图，每一分钟都有从1到50的步骤。在一个小的映射函数的帮助下，我们重写了字典函数来包含颜色代码而不是距离。现在，我们的图形中的每个节点都有了颜色，可以再次绘制叶子图。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/0e4e459ebac9299d3ced908d6291a58f.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*Kg5ckUht_nQ6HRtYX-ECVg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">彩色节点取决于与兴趣点的距离(越亮越近)|图片由作者提供</p></figure><h2 id="2b88" class="mw lt iq bd lu mx my dn ly mz na dp mc le nb nc me li nd ne mg lm nf ng mi nh bi translated">使用所有感兴趣的点</h2><p id="8a92" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">还记得我们想要使用几个兴趣点来创建我们的地图吗？我们快到了。为了迭代我们的POI列表，我们希望确保始终保持最小的距离。出于这个原因，我编写了一个小的自定义字典类，它只更新小于现有值或尚不存在的值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="5822" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这样，我们最终可以遍历所有POI，并创建一个包含每个节点和到任何POI的最小距离的字典。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="a898" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有了这个新的<code class="fe mr ms mt mu b">node_distances</code>，我们只需重复上面的步骤，即绘制颜色和创建叶子图，瞧，我们有了最终的图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/8ca1ace9d069380fb7d67e1282eb239c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zXFD8b-6tKozpAbwJXF9QQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">步行即可到达汉堡最近的地铁站(15公里渲染距离)|图片由作者提供</p></figure><p id="2e71" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">希望你喜欢这个小教程！如果你有兴趣，你可以在这里找到整本笔记本<a class="ae lr" href="https://github.com/Doppelfelix/isochron_hamburg/blob/main/Isochron%20Maps%20Tutorial/Isochron%20Maps.ipynb" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>