<html>
<head>
<title>Getting Started With SQLDelight in Android Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android开发中的SQLDelight入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-sqldelight-in-android-development-eecd0ae9bbdd?source=collection_archive---------7-----------------------#2021-08-30">https://betterprogramming.pub/getting-started-with-sqldelight-in-android-development-eecd0ae9bbdd?source=collection_archive---------7-----------------------#2021-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a65a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">启动应用程序的数据库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b3d217a3c8a18a6a782cfac6aa8f4c0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VDd7zDjJaPiGuQbA"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@writecodenow?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">博伊图梅洛·菲特拉</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="ebb3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="7c31" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">SQLDelight是一个跨平台的数据库库。这与传统的注释过程和反射生成代码的方法完全相反。</p><p id="f1b3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">它的独特之处，甚至超过了它支持跨平台的事实，是它采用SQL代码并将其转换为Kotlin/Java/Native代码，支持不同的平台，如Android、iOS、web。</p><p id="2ae4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于传统的特定于平台的库，如Room database，它们使创建数据库表和操作变得容易，因为您是用同一种语言编写代码的。</p><p id="c037" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">但是说到SQLDelight，你需要能够自己编写SQL查询。在我看来，这既是图书馆的优势，也是它的弱点。作为一个Android开发者，我不喜欢写Kotlin/Java之外的代码，但另一方面，这也给了我支持多平台的机会。</p><p id="8660" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">坦率地说，当你开发一个移动应用程序时，你不需要太多关于SQL、基本编码和语法知识的深入知识来使它工作。</p><p id="61e7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">所以，没有任何延迟，让我们开始吧:</p><h1 id="8f77" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">综合</h1><p id="cd2f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在项目级Gradle文件中添加SQLDelight插件，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="831f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">第二步，我们需要在app级Gradle文件上应用SQLDelight插件来支持代码生成。SQL delight不会基于像<code class="fe mu mv mw mx b">kapt</code>这样的注释处理器来生成代码。</p><p id="f2c4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">生成特定于平台的代码的过程是可行的，因为最终您将执行SQL查询。与特定于平台的库(如房间数据库)相比，这在某种程度上是相同的行为。看看下面的代码:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="9fc9" class="nc la it mx b gy nd ne l nf ng">plugins <strong class="mx iu">{<br/>    </strong>id 'com.android.application'<br/>    id 'kotlin-android'<br/>    <strong class="mx iu">id 'com.squareup.sqldelight'</strong><br/><strong class="mx iu">}</strong></span></pre><p id="99bd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">到目前为止，我们已经集成了通用SQL Delight支持，现在我们需要添加Android支持库。<code class="fe mu mv mw mx b">AndroidSqliteDriver</code>是我们这里需要的。我们需要在应用程序级梯度文件的依赖关系节点下添加以下行:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="4c03" class="nc la it mx b gy nd ne l nf ng">implementation "com.squareup.sqldelight:android-driver:1.3.0"</span></pre><h1 id="9b04" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">编写SQL代码</h1><p id="5454" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">作为第一个创建数据库的人，我们应该编写SQL代码。问题是应该在哪里定位(*。sq)文件。我们需要在主目录下创建一个名为<code class="fe mu mv mw mx b">sqldelight</code>的单独目录，类似于java和Kotlin，并托管我们所有的(*。sq)文件。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="2b81" class="nc la it mx b gy nd ne l nf ng">src/main/sqldelight</span></pre><p id="d35a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，没有任何进一步的延迟，让我们创建我们的MovieItem.sql文件。在文件中添加以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="f337" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">添加上述代码后，将会向您显示一个安装SQLDelight Android Studio插件的建议。这不是强制性的，但是可以使理解语法变得容易。我建议安装插件。</p><h1 id="a318" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Android代码</h1><p id="3c33" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如我前面说过的，我们需要使用<code class="fe mu mv mw mx b">AndroidSqliteDriver</code>将数据写入android数据库，该数据库在应用程序启动时保持不变。首先，创建如下所示的<code class="fe mu mv mw mx b">AndroidSqliteDriver</code>实例:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="7e05" class="nc la it mx b gy nd ne l nf ng">val androidSqlDriver = AndroidSqliteDriver(<br/>    schema = Database.Schema,<br/>    context = applicationContext,<br/>    name = "movies.db"<br/>)</span></pre><p id="84e5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后我们需要获得我们在movieitem.sql文件中创建的查询。看一下代码:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="5c48" class="nc la it mx b gy nd ne l nf ng">val queries = Database(androidSqlDriver).movieItemQueries</span></pre><p id="1c56" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，我们可以直接执行我们在movieItem SQL文件中创建的所有功能。看一下代码:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="50f4" class="nc la it mx b gy nd ne l nf ng">val movies: List = queries.selectAll().executeAsList()<br/>Log.d("MovieDatabase", "Movies : $movies")</span></pre><h1 id="7c0c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">协程<strong class="ak">支持</strong></h1><p id="184a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">jetpack Room数据库库成功的主要原因之一是它易于使用，并且与流行的框架如协程和分页兼容<strong class="lt iu">。</strong></p><p id="2b87" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">SQL Delight也有这样的好处；我们只需要在应用程序级Gradle文件中的dependencies节点下添加下面一行代码就可以让它工作了。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="6134" class="nc la it mx b gy nd ne l nf ng">implementation "com.squareup.sqldelight:coroutines-extensions-jvm:1.5.0"</span></pre><p id="522d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，它就像对Room library使用协程一样简单。代码如下:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="49d4" class="nc la it mx b gy nd ne l nf ng">val players: Flow&lt;List&lt;<!-- -->MoveItem<!-- -->&gt;&gt; = <br/>  <!-- -->queries<!-- -->.selectAll()<br/>    .asFlow()<br/>    .mapToList()</span></pre><p id="14fd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您还在使用RxJava，那么您可以添加下面一行来将Rxjava支持集成到SQL Delight中:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="0db4" class="nc la it mx b gy nd ne l nf ng">implementation "com.squareup.sqldelight:rxjava3-extensions:1.5.0"</span></pre><p id="d038" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，为了观察查询，我们可以使用RxJava扩展构件，如下所示:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="c8a6" class="nc la it mx b gy nd ne l nf ng">val players: Flow&lt;List&lt;<!-- -->MoveItem<!-- -->&gt;&gt; = <br/>  <!-- -->queries<!-- -->.selectAll()<br/>    .asObservable()<br/>    .mapToList()</span></pre><h1 id="4625" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">想要更多吗？</h1><p id="8113" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我最近看到了由<a class="ae ky" href="https://medium.com/u/d255c4fc9d76?source=post_page-----4c9f44d04e68--------------------------------" rel="noopener"> Satya Pavan Kantamani </a>发表的这篇关于Jetpack Compose的优秀文章，强烈推荐:</p><div class="nh ni gp gr nj nk"><a rel="noopener  ugc nofollow" target="_blank" href="/jetpack-compose-androids-modern-toolkit-for-building-ui-82e67d384c26"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">Jetpack Compose简介:Android的未来UI工具包</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">告别XML布局，采用现代技术</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">better编程. pub</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ks nk"/></div></div></a></div><p id="b9a6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">目前就这些。希望你学到了有用的东西。</p><p id="64e4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">感谢阅读。</p></div></div>    
</body>
</html>