<html>
<head>
<title>What’s New in TypeScript 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TypeScript 4中的新功能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/whats-new-in-typescript-4-fe8d50f08e31?source=collection_archive---------2-----------------------#2020-08-20">https://betterprogramming.pub/whats-new-in-typescript-4-fe8d50f08e31?source=collection_archive---------2-----------------------#2020-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="abce" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解此主要版本更新中的新增内容</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3773a20985798462be1cde93b2324968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*unmgAGdaaYoimP6k"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@bharat_patil_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">巴拉特·帕蒂尔</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="2e68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在进入文章之前，我想说恭喜你，打字稿！</p><p id="3102" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几天前发布了新版TypeScript。有很多有趣的功能。在这篇文章中，我将向您简要介绍一下发生了哪些变化。(如果您想了解详情，请查看此<a class="ae ky" href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-0-beta/" rel="noopener ugc nofollow" target="_blank">开发说明</a>。)</p><h2 id="87ea" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">放弃</h2><p id="8ca2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">TypeScript 4还不是稳定版本；这是测试版。所以你应该确保你真的可以在你的产品代码中使用这个版本，因为<em class="mt"> beta </em>意味着他们可能会在最终发布之前改变一些特性。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="d90c" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated">可变元组类型</h1><p id="6721" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">假设我们在TS 3.9基础上编写了函数<code class="fe nm nn no np b">concat</code>。</p><h2 id="4a22" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">TS 3</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 3.9基础版</p></figure><p id="7216" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数有两个参数，每个类型都扩展了<code class="fe nm nn no np b">any[]</code>。看看调用该函数的三个结果。</p><p id="de94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nm nn no np b">r1</code>类型是<code class="fe nm nn no np b">any[]</code>，尽管它是函数取<code class="fe nm nn no np b">string[]</code>和<code class="fe nm nn no np b">number[]</code>类型值的结果，因为函数<code class="fe nm nn no np b">concat</code>无法使用<code class="fe nm nn no np b">T</code>和<code class="fe nm nn no np b">U</code>推断返回类型。</p><p id="0ad9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们不得不像<code class="fe nm nn no np b">r2</code>和<code class="fe nm nn no np b">r3</code>那样手动转换返回类型。即使在TS 3.x中可能有某种解决方案，我们真的只是需要一些很酷的东西，所以我们不必考虑这些。</p><p id="5427" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在TS 4中，你现在能做的就是像下面这样传播类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><pre class="kj kk kl km gt ns np nt nu aw nv bi"><span id="6898" class="lv lw it np b gy nw nx l ny nz">type Spread = [...ArrNum, ...ArrStr];</span></pre><p id="2ce5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一个类型由一些长度未知的类型组成，TS 4会把它们当作一个类型的数组。</p><pre class="kj kk kl km gt ns np nt nu aw nv bi"><span id="b0aa" class="lv lw it np b gy nw nx l ny nz">type StrStrNumNum = [...Strings, ...Numbers];</span></pre><p id="e660" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">否则，TS 4可以计算每个类型中有多少相同的类型，这样它就可以将它们传播到新的类型中。</p><h2 id="b2ca" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">TS 4</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 4.0基础版</p></figure><p id="a6ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在在TS 4中需要做的就是将函数的返回类型声明为<code class="fe nm nn no np b">[…T, …U]</code>；那我们就不用每次都去投结果了。另外，现在<code class="fe nm nn no np b">r1</code>也有合适的型号，而不是<code class="fe nm nn no np b">any[]</code>。</p><p id="2e2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以点击查看更多关于这个<a class="ae ky" href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-0-beta/#variadic-tuple-types" rel="noopener ugc nofollow" target="_blank">的细节。</a></p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="c946" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated">标记元组元素</h1><p id="ccb2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">使用TS 4中的type关键字，现在您可以告诉TS您传递给函数的参数的每种类型。</p><h2 id="c934" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">TS 3</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 3.9基础版</p></figure><h2 id="7851" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">TS 4</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 4.0基础版</p></figure><p id="4256" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能看不出它们之间的巨大差异；TypeScript团队引入这个特性是为了更好的可读性。当你想表达其余的论点时，你可以这样写你的类型:</p><pre class="kj kk kl km gt ns np nt nu aw nv bi"><span id="b42c" class="lv lw it np b gy nw nx l ny nz">type Foo = [first: string, second: number, ...rest: any[]];</span></pre><p id="4136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要记住的一点是，如果你给类型一个标签，你必须给所有的类型一个标签，就像这样:</p><pre class="kj kk kl km gt ns np nt nu aw nv bi"><span id="81b7" class="lv lw it np b gy nw nx l ny nz">// Error<br/>type Bar = [first: string, number];</span><span id="fa07" class="lv lw it np b gy oa nx l ny nz">// It works<br/>type Baz = [first: string, second: number; </span></pre><p id="4d98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里查看更多关于这个<a class="ae ky" href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-0-beta/#labeled-tuple-elements" rel="noopener ugc nofollow" target="_blank">的细节。</a></p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="5ebf" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated">从构造函数推断类属性</h1><p id="cd38" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在TS 3基础中，你的类成员属性必须有一个特定的类型，除非你没有关闭<code class="fe nm nn no np b">noImplicitAny</code>选项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 3.9基础版</p></figure><p id="7d92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">否则，<code class="fe nm nn no np b">Student</code>类的属性<code class="fe nm nn no np b">age</code>会给你一个错误，它隐式地有一个<code class="fe nm nn no np b">any</code>类型。而<code class="fe nm nn no np b">getDoubleAge</code>的返回类型也是一个<code class="fe nm nn no np b">any</code>，因为<code class="fe nm nn no np b">age</code>是<code class="fe nm nn no np b">any</code>类型。</p><p id="dad0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在TS 4中，它可以通过属性在构造函数中的初始化方式更自然地推断出类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 4.0基础版</p></figure><p id="8768" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要记住的一点是，由于TS 4从构造函数中检查成员属性类型，所以您应该始终确保不会混淆TypeScript。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="8018" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看上图。TS不知道<code class="fe nm nn no np b">age</code>应该考虑哪种类型。</p><p id="3c72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里查看关于这个<a class="ae ky" href="http://You can check out the more details about this from here." rel="noopener ugc nofollow" target="_blank">的更多细节。</a></p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="07ba" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated">短路赋值运算符</h1><p id="438c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">一个很简单的对比。现在你可以在TS 4中做到这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 3.9基础版</p></figure><p id="e012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与上面截图中的<code class="fe nm nn no np b">=</code>一样，TS 3中不支持符号<code class="fe nm nn no np b">&amp;&amp;</code>、<code class="fe nm nn no np b">||</code>和<code class="fe nm nn no np b">??</code>。但是在TS 4中，它们是受支持的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 4.0基础版</p></figure><p id="993a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以现在你可以用这个功能来做这件事:</p><pre class="kj kk kl km gt ns np nt nu aw nv bi"><span id="f6ac" class="lv lw it np b gy nw nx l ny nz">let values: string[];<br/><br/>// Before<br/>(values ?? (values = [])).push("hello");<br/><br/>// After<br/>(values ??= []).push("hello");</span></pre><p id="971c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里查看更多关于这个<a class="ae ky" href="http://You can check out the more details about this from here." rel="noopener ugc nofollow" target="_blank">的细节。</a></p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="2c8b" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated"><code class="fe nm nn no np b">'unknown'</code> on ' <code class="fe nm nn no np b">catch'</code>子句绑定</h1><p id="f490" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">以前，TS中一个令人不舒服的特性是您不能在<code class="fe nm nn no np b">catch</code>子句中控制错误类型的类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 3.9基础版</p></figure><p id="52d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但在TS 4中，为了更好的安全性，它让你将其类型改为<code class="fe nm nn no np b">unknown</code>。但是您仍然不能将类型更改为自定义类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 4.0基础版</p></figure><p id="2e84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nm nn no np b">catch</code>子句中，您可以像下面这样更改类型。</p><pre class="kj kk kl km gt ns np nt nu aw nv bi"><span id="7e1a" class="lv lw it np b gy nw nx l ny nz">if (typeof e === 'string') {<br/>  // It works now<br/>  console.log(e.toUpperCase());<br/>}</span></pre><p id="3770" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里查看更多关于这个<a class="ae ky" href="http://You can check out the more details about this from here." rel="noopener ugc nofollow" target="_blank">的细节。</a></p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="ddfe" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated"><code class="fe nm nn no np b">'@deprecated'</code></h1><p id="f867" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在TS 4中，您可以让其他开发人员知道有些方法已经过时了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 3.9基础版</p></figure><p id="6d11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一些JavaScript编辑器工具更直观地让你知道它们已经过时了。当然，TS本身也让你知道这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">TS 4.0基础版</p></figure><p id="185b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你使用VS代码作为JavaScript编辑器，那么把它更新到最新版本并重启程序。VS代码会让你更容易注意到什么被否决了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/359ececd52b8f40456a99b0b7ffa8208.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*hFkhZ8-E4zz_1EjZuCK7LA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在带有VS代码的TS 4.0基础版中</p></figure><p id="fdd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里查看更多关于这个<a class="ae ky" href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-0-beta/#deprecated-support" rel="noopener ugc nofollow" target="_blank">的细节。</a></p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="f211" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated">结论</h1><p id="eb0d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果你想进一步了解我介绍的新特性，你可以在这里查看<a class="ae ky" href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-0-beta" rel="noopener ugc nofollow" target="_blank"/>。似乎TS 4并没有太多的重大变化，目前推出的版本是测试版，所以我们应该跟踪它的变化或错误修复。</p><p id="4474" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想安装这个测试版，可以通过npm或者Yarn安装。</p><pre class="kj kk kl km gt ns np nt nu aw nv bi"><span id="2ce1" class="lv lw it np b gy nw nx l ny nz">npm i -D typescript@beta<br/>yarn add -D typescript@beta</span></pre></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="452f" class="nb lw it bd lx nc nd ne ma nf ng nh md jz ni ka mg kc nj kd mj kf nk kg mm nl bi translated">参考</h1><ul class=""><li id="33cc" class="oc od it lb b lc mo lf mp li oe lm of lq og lu oh oi oj ok bi translated"><a class="ae ky" href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-0-beta/" rel="noopener ugc nofollow" target="_blank">“发布TypeScript 4.0测试版”</a>通过微软开发博客</li></ul></div></div>    
</body>
</html>