<html>
<head>
<title>How to Use Custom HTML as a Drag Image With Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Vue.js中使用自定义HTML作为拖动图像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-custom-html-as-a-drag-image-with-vue-js-5b3d21c3c227?source=collection_archive---------1-----------------------#2020-11-20">https://betterprogramming.pub/how-to-use-custom-html-as-a-drag-image-with-vue-js-5b3d21c3c227?source=collection_archive---------1-----------------------#2020-11-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0436" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你实际上不能真的这么做，但我们无论如何都要这么做</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/c7a3690dcee37afbd13ab6b5f544ec9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PGdItozCVEgonQsDURc2HA.gif"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">由<a class="ae kw" href="http://avatars.dicebear.com" rel="noopener ugc nofollow" target="_blank"> DiceBear Avatars </a>提供的头像。</p></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="0bb5" class="le lf iq bd lg lh li lj lk ll lm ln lo jw lp jx lq jz lr ka ls kc lt kd lu lv bi translated">在开始之前</h1><p id="602d" class="pw-post-body-paragraph lw lx iq ly b lz ma jr mb mc md ju me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">这种方法在Chrome上肯定管用，但在Firefox上不行。我还没有在IE或Safari上验证这一点。</p><p id="4aba" class="pw-post-body-paragraph lw lx iq ly b lz ms jr mb mc mt ju me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">如果你不熟悉HTML拖放API的基础知识，我强烈推荐你阅读Mozilla开发者文档。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="a173" class="le lf iq bd lg lh li lj lk ll lm ln lo jw lp jx lq jz lr ka ls kc lt kd lu lv bi translated">TL；DR——这是完整的例子</h1><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mx my l"/></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="f5cd" class="le lf iq bd lg lh li lj lk ll lm ln lo jw lp jx lq jz lr ka ls kc lt kd lu lv bi translated">指定“假”拖动图像</h1><p id="ae60" class="pw-post-body-paragraph lw lx iq ly b lz ma jr mb mc md ju me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">文档说明你可以使用DOM上任何可见的<em class="mz">元素作为拖动图像。这破坏了我们的意图，因为我们希望元素只作为拖动图像可见。因此，创建一个假的空图像来取消默认行为。</em></p><pre class="kh ki kj kk gt na nb nc nd aw ne bi"><span id="76b4" class="nf lf iq nb b gy ng nh l ni nj">&lt;div<br/>  ref="fakeDragImage"<br/>  class="fakeDragImage"<br/>  style="display: none"<br/>/&gt;</span></pre></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="0edd" class="le lf iq bd lg lh li lj lk ll lm ln lo jw lp jx lq jz lr ka ls kc lt kd lu lv bi translated">创建“真实的”拖动图像</h1><p id="1cf9" class="pw-post-body-paragraph lw lx iq ly b lz ma jr mb mc md ju me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">创建用于表示实际拖动图像的元素，并确保其可见性由拖动行为决定。</p><pre class="kh ki kj kk gt na nb nc nd aw ne bi"><span id="5ddf" class="nf lf iq nb b gy ng nh l ni nj">&lt;div<br/>  ref="realDragImage"<br/>  v-show="isDragging"<br/>  style="position: absolute; z-index: 1000"<br/>&gt;&lt;!-- Drag image info goes here --&gt;&lt;/div&gt;</span></pre></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="4f7f" class="le lf iq bd lg lh li lj lk ll lm ln lo jw lp jx lq jz lr ka ls kc lt kd lu lv bi translated">当DragStart事件被激发时</h1><p id="9367" class="pw-post-body-paragraph lw lx iq ly b lz ma jr mb mc md ju me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">将<code class="fe nk nl nm nb b">realDragImage</code>引用附加到父Vue元素。通常，这将是<code class="fe nk nl nm nb b">#app</code>，但是您可以通过查看<code class="fe nk nl nm nb b">src/main.js</code>文件来仔细检查。这样做的原因是，元素可以在页面上自由移动，而不必担心它最初被限制在HTML元素中的约束。</p><pre class="kh ki kj kk gt na nb nc nd aw ne bi"><span id="38a2" class="nf lf iq nb b gy ng nh l ni nj">onDragStart(ev) {<br/>  ...<br/>  document.getElementById('app').append(this.$refs.realDragImage)<br/>  ...<br/>}</span></pre><p id="3817" class="pw-post-body-paragraph lw lx iq ly b lz ms jr mb mc mt ju me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">将<code class="fe nk nl nm nb b">fakeDragImage</code>引用分配给事件上的<code class="fe nk nl nm nb b">dataTransfer</code>对象。这样，当您初始化拖动时，就看不到默认的拖动图像。</p><pre class="kh ki kj kk gt na nb nc nd aw ne bi"><span id="c673" class="nf lf iq nb b gy ng nh l ni nj">onDragStart(ev) {<br/>  ...<br/>  ev.dataTransfer.setDragImage(this.$refs.fakeDragImage, 0, 0)<br/>  ...<br/>}</span></pre></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="72fc" class="le lf iq bd lg lh li lj lk ll lm ln lo jw lp jx lq jz lr ka ls kc lt kd lu lv bi translated">当拖动事件被激发时</h1><p id="344d" class="pw-post-body-paragraph lw lx iq ly b lz ma jr mb mc md ju me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">根据<code class="fe nk nl nm nb b">ev.pageX</code>和<code class="fe nk nl nm nb b">ev.pageY</code>坐标设置<code class="fe nk nl nm nb b">realDragImage</code>的位置，使元素可见。</p><pre class="kh ki kj kk gt na nb nc nd aw ne bi"><span id="5052" class="nf lf iq nb b gy ng nh l ni nj">onDrag(ev) {<br/>  if (!ev.pageX &amp;&amp; !ev.pageY) return</span><span id="2fb7" class="nf lf iq nb b gy nn nh l ni nj">  const [offsetX, offsetY] = [4, 4]<br/>  this.$refs.realDragImage.style.left = ev.pageX + offsetX + 'px'<br/>  this.$refs.realDragImage.style.top = ev.pageY + offsetY + 'px'<br/>  this.isDragging = true<br/>}</span></pre><p id="cd57" class="pw-post-body-paragraph lw lx iq ly b lz ms jr mb mc mt ju me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">有一个小问题:当拖动操作不成功时(即元素没有被放到任何有效的放置位置)，触发<code class="fe nk nl nm nb b">drag</code>，使得<code class="fe nk nl nm nb b">ev.pageX</code>和<code class="fe nk nl nm nb b">ev.pageY</code>成为<code class="fe nk nl nm nb b">(0, 0)</code>。这正好发生在<code class="fe nk nl nm nb b">dragend</code>事件触发之前，所以图像会瞬间闪烁到页面的左上角。为了防止这种情况，只要在事件发出<code class="fe nk nl nm nb b">(0, 0)</code>时返回即可。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="c4bb" class="le lf iq bd lg lh li lj lk ll lm ln lo jw lp jx lq jz lr ka ls kc lt kd lu lv bi translated">触发DragEnd事件时</h1><p id="9e17" class="pw-post-body-paragraph lw lx iq ly b lz ma jr mb mc md ju me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">设置<code class="fe nk nl nm nb b">this.isDragging=false</code>再次隐藏拖动元素。</p><p id="c206" class="pw-post-body-paragraph lw lx iq ly b lz ms jr mb mc mt ju me mf mu mh mi mj mv ml mm mn mw mp mq mr ij bi translated">仅此而已。这就是你如何破坏HTML拖放API来设置你自己的自定义拖动行为。感谢阅读！</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="3e51" class="le lf iq bd lg lh li lj lk ll lm ln lo jw lp jx lq jz lr ka ls kc lt kd lu lv bi translated">资源</h1><ul class=""><li id="2b56" class="no np iq ly b lz ma mc md mf nq mj nr mn ns mr nt nu nv nw bi translated"><a class="ae kw" href="http://avatars.dicebear.com" rel="noopener ugc nofollow" target="_blank"> DiceBear头像</a></li><li id="8bf2" class="no np iq ly b lz nx mc ny mf nz mj oa mn ob mr nt nu nv nw bi translated"><a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API" rel="noopener ugc nofollow" target="_blank"> HTML拖放API </a></li></ul></div></div>    
</body>
</html>