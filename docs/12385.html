<html>
<head>
<title>The Most Important Skill When Writing Unit Tests is Making Sure They Fail</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写单元测试时最重要的技能是确保它们失败</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-most-important-skill-when-writing-unit-tests-is-making-sure-they-fail-182e8ab0e4c5?source=collection_archive---------14-----------------------#2022-06-01">https://betterprogramming.pub/the-most-important-skill-when-writing-unit-tests-is-making-sure-they-fail-182e8ab0e4c5?source=collection_archive---------14-----------------------#2022-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="54ff" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">是的，说真的…</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/17d1ab421f4fe559d97c1679c2e11d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*04dtUDo8H1Xg-PNU"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@cdr6934?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯里德</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="79b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大约一年前，我在LinkedIn上看到Craig Livings的帖子，他发表了一段有争议的话:</p><blockquote class="ls lt lu"><p id="3631" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">任何从未失败的测试都不会增加任何价值</p></blockquote><p id="bc6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着任何从未失败的测试都没有价值，因此可以删除。为了让任何测试增值，它必须至少失败一次。</p><p id="f2a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看为什么测试失败是如此重要的技能…</p><h1 id="0f7b" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">为什么我们的测试一定会失败？</h1><p id="c6d7" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">假设我们已经编写了一些代码和一些支持单元测试。我们做得很好，对吗？测试从未失败过，但是我们现在有了支持我们代码的单元测试！或者至少我们<em class="lv">认为</em>我们拥有…</p><p id="0f4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看一些例子。一个测试没有失败，另一个失败了。</p><h2 id="3d19" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">从未失败的测试</h2><p id="ace1" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这个例子是一个常见的场景，我们只是专注于编写一个通过的测试。我们无意让它失败。</p><p id="0bd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用以下JavaScript函数:</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="f13c" class="mw ma iq nj b gy nn no l np nq">function sum(a, b) {<br/>  return a + b;<br/>}</span><span id="29c6" class="mw ma iq nj b gy nr no l np nq">module.exports = sum;</span></pre><p id="7318" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们编写了下面的<a class="ae kv" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>测试来验证我们的<code class="fe ns nt nu nj b">sum</code>函数将两个数相加:</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="c820" class="mw ma iq nj b gy nn no l np nq">const sum = require('./sum');<br/><br/>test('two plus two is four', () =&gt; {<br/>  expect(2 + 2).toBe(4);<br/>});</span></pre><p id="b998" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们运行测试，它通过了✅</p><p id="1ba7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样。我们很高兴测试通过了，所以我们继续前进。</p><h2 id="cc1b" class="mw ma iq bd mb mx my dn mf mz na dp mj lf nb nc ml lj nd ne mn ln nf ng mp nh bi translated">失败的测试</h2><p id="19bb" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在这个例子中，我们使用完全相同的代码。然而，这一次我们确保测试没有证明它的价值。</p><p id="d8f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用相同的功能:</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="12fa" class="mw ma iq nj b gy nn no l np nq">function sum(a, b) {<br/>  return a + b;<br/>}</span><span id="c823" class="mw ma iq nj b gy nr no l np nq">module.exports = sum;</span></pre><p id="54a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用同样的测试:</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="c5dc" class="mw ma iq nj b gy nn no l np nq">const sum = require('./sum');</span><span id="1b0f" class="mw ma iq nj b gy nr no l np nq">test('two plus two is four', () =&gt; {<br/>  expect(2 + 2).toBe(4);<br/>});</span></pre><p id="a00e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们运行测试，它通过了✅</p><p id="9ef7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但这一次我们要确保测试失败。所以我们决定修改代码:</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="d617" class="mw ma iq nj b gy nn no l np nq">function sum(a, b) {<br/>  return 0;<br/>}</span><span id="e819" class="mw ma iq nj b gy nr no l np nq">module.exports = sum;</span></pre><p id="eab2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们重新运行测试，我们得到了另一个通过✅</p><p id="974d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是等等…这个应该失败了。我们删除了将数字相加的代码。</p><p id="a5b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到测试仍然通过的原因是测试本身是不正确的。测试没有调用<code class="fe ns nt nu nj b">sum</code>。</p><p id="d9d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们更新了测试:</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="c76d" class="mw ma iq nj b gy nn no l np nq">const sum = require('./sum');</span><span id="6c66" class="mw ma iq nj b gy nr no l np nq">test('two plus two is four', () =&gt; {<br/>  expect(sum(2, 2)).toBe(4);<br/>});</span></pre><p id="b569" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们重新进行了测试，❌没有通过</p><p id="b1ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好的，太好了！现在让我们把代码放回去:</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="5f7c" class="mw ma iq nj b gy nn no l np nq">function sum(a, b) {<br/>  return a + b;<br/>}</span><span id="c97f" class="mw ma iq nj b gy nr no l np nq">module.exports = sum;</span></pre><p id="f732" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们重新运行测试，它通过了✅</p><p id="a520" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很好，现在我们的测试有了价值，因为我们确保了测试验证了正确的东西。</p><p id="6d1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个例子很简单。然而，当测试更复杂的代码时，很难发现这些错误。这就是为什么我们在通过测试之前确保测试失败是如此重要——因此我们对我们正在验证的东西有信心。</p><h1 id="5426" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">外卖</h1><p id="ec2d" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">当编写测试时，我们必须知道它们失败了，所以我们知道它们增加了价值。</p><p id="a54a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你同意吗？</p></div></div>    
</body>
</html>