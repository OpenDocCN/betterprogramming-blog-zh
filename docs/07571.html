<html>
<head>
<title>Build a Twilio-Powered Chat App Using React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React Native构建一个基于Twilio的聊天应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-twilio-powered-chat-app-using-reactn-ative-2460b7995a30?source=collection_archive---------2-----------------------#2021-01-28">https://betterprogramming.pub/build-a-twilio-powered-chat-app-using-reactn-ative-2460b7995a30?source=collection_archive---------2-----------------------#2021-01-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9759" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Twilio可编程聊天工具快速入门</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e4b60f8034d264295d3a59bb0e959ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tpChqHfmbLkqvQYkTTG1Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">格伦·卡斯滕斯-彼得斯在<a class="ae kv" href="https://unsplash.com/s/photos/texting?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9472" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想为我的React本机应用程序构建一个快速、功能全面的聊天功能。我设法用Twilio可编程聊天工具来做这件事。</p><p id="78aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Twilio可编程聊天使您可以轻松地将聊天功能添加到您的web和移动应用程序中，而无需构建或扩展实时聊天后端。Chat拥有所有必要的API和特性来与您的业务逻辑集成，以确保您能够掌控一切。</p><p id="fc5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在互联网上搜索了很多，以找到使用Twilio可编程聊天和React Native的最佳方式。不幸的是，我没找到多少。所以我决定写一篇关于它的文章，希望能节省别人一些时间。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="bb22" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">设置项目</h1><p id="82ec" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先，我将通过以下代码行创建一个新的React本地项目:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="6ced" class="nb ma iq mx b gy nc nd l ne nf">react-native init react_native_twilio_chat<br/>cd react_native_twilio_chat<br/>npm run ios</span></pre><p id="6b88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了，我们已经成功创建了React本机应用程序。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1747" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建我们的服务器</h1><p id="dc08" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在开始之前，我们需要生成一个访问令牌来授权React Native应用程序与可编程的Twilio Chat进行通信。</p><p id="53b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了设置我们的聊天后端，我们需要来自Twilio帐户的四个值。我们将这些存储在我们的<code class="fe ng nh ni mx b">.env</code>文件中:</p><ul class=""><li id="3835" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated"><strong class="ky ir">服务实例SID</strong>—一个<a class="ae kv" href="https://www.twilio.com/docs/api/chat/rest/services" rel="noopener ugc nofollow" target="_blank">服务</a>实例，我们应用程序的所有数据都存储在这个实例中并确定其范围</li><li id="7361" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><strong class="ky ir">账户SID </strong> —您的主要Twilio账户标识符</li><li id="490d" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><strong class="ky ir"> API密钥</strong> —用于认证</li><li id="87ca" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><strong class="ky ir"> API秘密</strong> —用于认证</li></ul><p id="cfe3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您没有Twilio帐户，请访问Twilio，然后<a class="ae kv" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank">轻松创建一个免费帐户</a>。</p><p id="cea2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果你的账户准备好了，你可以在<a class="ae kv" href="https://www.twilio.com/console" rel="noopener ugc nofollow" target="_blank"> Twilio控制台</a>上找到你的账户SID。您应该将它作为值<code class="fe ng nh ni mx b">TWILIO_ACCOUNT_SID</code>复制并粘贴到<code class="fe ng nh ni mx b">.env</code>文件中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/c42a79fc3d6668bf2ad72abcc74e0e29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rs8b952Ao0sBUAf-yP8FNA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">帐户SID</p></figure><p id="00e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们需要通过导航到设置&gt; API密钥&gt;新API密钥来生成API密钥和API秘密。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/3967e820d2c0d84bbe187de9e30396c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0qm0kgBwnr9xpYIox1CDw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">新的API密钥页面</p></figure><p id="6ef9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您成功地创建了这些东西，让我们复制并粘贴SID和secret作为值<code class="fe ng nh ni mx b">TWILIO_API_KEY</code>和<code class="fe ng nh ni mx b">TWILIO_API_SECRET</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/dc1eb7328479f3323dbe19afd2364ba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NeHwiW92ya2bkR3ohxt4Mg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">API密钥和机密</p></figure><p id="4090" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们需要通过导航到所有产品&amp;服务&gt;可编程聊天&gt;服务&gt;聊天服务来创建一个新的<a class="ae kv" href="https://www.twilio.com/console/chat/services" rel="noopener ugc nofollow" target="_blank">聊天服务</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/97811258d8cde4e82da76b48d9bc7126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bjHgeMpN3lLfWvfyQoexQg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">聊天服务SID</p></figure><p id="382d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们复制并粘贴服务SID作为值<code class="fe ng nh ni mx b">TWILIO_CHAT_SERVICE_SID</code>。</p><p id="2715" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们的<code class="fe ng nh ni mx b">.env</code>文件应该是这样的:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="269c" class="nb ma iq mx b gy nc nd l ne nf">TWILIO_ACCOUNT_SID=your_account_sid<br/>TWILIO_API_KEY=your_api_key<br/>TWILIO_API_SECRET=your_api_secret<br/>TWILIO_CHAT_SERVICE_SID=your_chat_service_sid</span></pre><p id="0345" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们的<code class="fe ng nh ni mx b">.env</code>准备好了，我们可以创建一个简单的服务器，只有一个<code class="fe ng nh ni mx b">GET</code>路由<code class="fe ng nh ni mx b">/token/:identity</code>。该路由将从<code class="fe ng nh ni mx b">TWILIO</code>请求并返回一个令牌。让我们为服务器安装依赖项:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="f411" class="nb ma iq mx b gy nc nd l ne nf">yarn add express dotenv twilio</span></pre><p id="8e12" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建我们的<code class="fe ng nh ni mx b">server.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="de2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是我们的服务器。现在，我们可以用下面的命令行运行我们的服务器:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="f333" class="nb ma iq mx b gy nc nd l ne nf">node server.js</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8d87" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">反应导航</h1><p id="9dc1" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了向您展示Twilio可编程聊天的实际应用，我将在React Native上构建一个全功能的应用程序。我们的应用程序将有四个屏幕:<code class="fe ng nh ni mx b">WelcomeScreen</code>、<code class="fe ng nh ni mx b">ChatListScreen</code>、<code class="fe ng nh ni mx b">ChatRoomScreen</code>和<code class="fe ng nh ni mx b">ChatCreateScreen</code>。</p><p id="4121" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要一个路由器在React本地应用的屏幕间导航。所以我要用<code class="fe ng nh ni mx b"><a class="ae kv" href="https://reactnavigation.org" rel="noopener ugc nofollow" target="_blank">react-navigation</a></code>库。React导航在iOS和Android上都提供了100%的原生平台导航。我们应该用所需的包来安装它:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="9b9d" class="nb ma iq mx b gy nc nd l ne nf">yarn add @react-navigation/native react-native-reanimated react-native-gesture-handler react-native-screens react-native-safe-area-context <a class="ae kv" href="http://twitter.com/react" rel="noopener ugc nofollow" target="_blank">@react</a>-native-community/masked-view <a class="ae kv" href="http://twitter.com/react" rel="noopener ugc nofollow" target="_blank">@react</a>-navigation/stack</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="7ed7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">欢迎屏幕</h1><p id="06f6" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们将从欢迎屏幕开始。让我们创建<code class="fe ng nh ni mx b">welcome-screen.js</code>并添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="b7e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用<code class="fe ng nh ni mx b">username</code>来生成Twilio访问令牌。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/6503c4319b38252094de0c9beab50390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z4fEP5sFoEnWBOfEtouJ2A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">欢迎屏幕</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="dd22" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">聊天-创建屏幕</h1><p id="0529" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">下一步是创建一个聊天客户端，这就是我们需要令牌的目的。我将使用<code class="fe ng nh ni mx b"><a class="ae kv" href="https://www.npmjs.com/package/twilio-chat" rel="noopener ugc nofollow" target="_blank">twilio-chat</a></code>来连接和使用<a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/index.html" rel="noopener ugc nofollow" target="_blank"> Twilio SDK </a>。让我们安装并测试它:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="490e" class="nb ma iq mx b gy nc nd l ne nf">yarn add twilio-chat events</span></pre><p id="9995" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们将创建一个<code class="fe ng nh ni mx b">getToken</code>方法来处理与令牌服务器的通信。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="fb2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们应该通过调用<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Client.html#.create__anchor" rel="noopener ugc nofollow" target="_blank">create(token)</a></code>来创建带有令牌的Twilio聊天客户端实例。此外，我们有两个事件来帮助管理我们的令牌过期:<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Client.html#event:tokenAboutToExpire__anchor" rel="noopener ugc nofollow" target="_blank">tokenAboutToExpire</a></code>和<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Client.html#event:tokenExpired__anchor" rel="noopener ugc nofollow" target="_blank">tokenExpired</a></code>。</p><p id="c1d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建一个<code class="fe ng nh ni mx b">twilio-service.js </code>文件来防止Twilio聊天客户端在所有屏幕上重复初始化。我们将创建并存储一个Twilio服务客户端实例，并在每个屏幕上使用它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="839e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我将用下面的代码创建<code class="fe ng nh ni mx b">chat-create-screen.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="dbfd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦聊天客户端被初始化，我们可以用<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Client.html#createChannel__anchor" rel="noopener ugc nofollow" target="_blank">createChannel({ uniqueName, friendlyName })</a></code>创建一个新的聊天频道，或者用<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Channel.html#join__anchor" rel="noopener ugc nofollow" target="_blank">join()</a></code>方法加入一个现有的频道。要加入一个现有的频道，我们必须使用<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Client.html#getChannelByUniqueName__anchor" rel="noopener ugc nofollow" target="_blank">getChannelByUniqueName</a>()</code>方法从Twilio获取频道，并将房间名传递给它。</p><p id="bb57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果通道不存在，将会引发异常。如果确实存在，该方法将返回通道资源，并从那里加入通道。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/556ec3c8765e58e8d92ddd9aa5621ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_xYi6S5I3NgGMufOyAQE3A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">新频道屏幕</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0667" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">聊天列表屏幕</h1><p id="0a58" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我将在<code class="fe ng nh ni mx b">ChatListScreen</code>上显示我订阅的所有频道。作为用户，当我在<code class="fe ng nh ni mx b">CreateChannelScreen</code>上加入或创建新频道时，我希望使用更新的频道。因此，我们需要在Redux或React上下文中全局存储通道。Redux对于我们简单的应用程序来说太复杂了，所以我们将使用React上下文。</p><p id="62dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们用下面的代码创建我们的<code class="fe ng nh ni mx b">app-context.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="9fb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ng nh ni mx b">AppContext</code>存储<code class="fe ng nh ni mx b">channels</code>和<code class="fe ng nh ni mx b">updateChannels</code>方法的列表。因此我们可以得到所有的频道:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="3c5f" class="nb ma iq mx b gy nc nd l ne nf">const { channels, updateChannels } = useApp();</span></pre><p id="bc95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们的<code class="fe ng nh ni mx b">chat-list-screen.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="babd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们检索令牌并创建Twilio聊天客户端的实例。然后，我们通过使用<code class="fe ng nh ni mx b">getSubscribedChannels()</code>方法获得所有订阅频道的当前列表，并将它们存储在全局React上下文中。</p><p id="2375" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Twilio没有提供根据最新消息对频道列表进行排序的功能。最好的办法是将所有通道加载到一个数组中，并自己对它们进行排序。</p><p id="3768" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我订阅了<code class="fe ng nh ni mx b">messageAdded</code>事件，当一条新消息被添加到服务器上的频道时，该事件将被触发，因为我希望按照最后一条消息的时间对频道列表进行排序。因此，当有人通过聊天发送消息时，我们将更新特定频道的最后一条消息的时间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/bb67fceaa81e25101c0765085c48c925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m0g4kMCRQhqHxApYEu2H8w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">聊天列表屏幕</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5494" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">聊天室屏幕</h1><p id="08a6" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我将使用<code class="fe ng nh ni mx b"><a class="ae kv" href="https://github.com/FaridSafi/react-native-gifted-chat" rel="noopener ugc nofollow" target="_blank">react-native-gifted-chat</a></code>创建一个频道聊天室。<code class="fe ng nh ni mx b">react-native-gifted-chat</code>是React Native最完整易用的聊天UI。</p><p id="2e67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们安装它:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="a469" class="nb ma iq mx b gy nc nd l ne nf">yarn add react-native-gifted-chat</span></pre><p id="90fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们必须获得一个Twilio聊天客户端，或者创建一个(如果不存在的话)。然后我们需要使用<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Client.html#getChannelBySid__anchor" rel="noopener ugc nofollow" target="_blank">getChannelBySid(channelSid)</a></code>来获取特定的频道。</p><p id="a316" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们获得了通道，我们就可以通过使用<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Channel.html#getMessages__anchor" rel="noopener ugc nofollow" target="_blank">getMessages()</a></code>方法从通道中获得所有的消息。</p><p id="f19b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，我将订阅<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Channel.html#event:messageAdded__anchor" rel="noopener ugc nofollow" target="_blank">messageAdded</a></code>事件，当新消息被添加到频道并更新我们的聊天时，该事件将被触发。</p><p id="1891" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来创造<code class="fe ng nh ni mx b">chat-room-screen.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="1816" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我创造了一个叫做<code class="fe ng nh ni mx b">onSend()</code>的方法。这个方法将调用channel对象上的SDK方法<code class="fe ng nh ni mx b"><a class="ae kv" href="http://media.twiliocdn.com/sdk/js/chat/releases/4.0.0/docs/Channel.html#sendMessage__anchor" rel="noopener ugc nofollow" target="_blank">sendMessage()</a></code>,并将用户输入的消息传递给它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/af04fbf11234ca917ac2065235e7aef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eC9JYCpOob602WI7TcXC3A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">聊天室屏幕</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="ab88" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">让我们演示一下我们的Twilio聊天应用程序</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/0da45985b532bebf634fe83966c623b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*k-0wJaLh1AXHsTB2EDWb7w.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">反应-本地-twilio-chat</p></figure><p id="a4cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想检查所有的代码，这里有到GitHub的链接。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5b2f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="c036" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">感谢阅读——我希望这篇文章对你有用。编码快乐！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="6aec" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">资源</h1><div class="of og gp gr oh oi"><a href="https://www.twilio.com/blog/2017/10/implement-chat-javascript-nodejs-react-apps.html" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">在JavaScript、Node.js和React应用中实现聊天</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">如果您正在使用JavaScript React构建一个聊天用户界面，您如何集成后端的其余部分…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">www.twilio.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow kp oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://www.twilio.com/blog/build-a-chat-app-with-twilio-programmable-chat-and-react" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">用Twilio可编程的Chat和React.js构建聊天应用</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">本教程将教你如何使用Twilio的可编程聊天API在React中构建一个聊天应用。完成后…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">www.twilio.com</p></div></div><div class="or l"><div class="ox l ot ou ov or ow kp oi"/></div></div></a></div></div></div>    
</body>
</html>