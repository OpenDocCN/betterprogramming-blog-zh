<html>
<head>
<title>Master the Compound Component Pattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握复合组件模式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/mastering-the-compound-component-pattern-cd0e56937fc3?source=collection_archive---------12-----------------------#2020-02-04">https://betterprogramming.pub/mastering-the-compound-component-pattern-cd0e56937fc3?source=collection_archive---------12-----------------------#2020-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="559b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用高级模式编写声明性React组件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/90028d58a0b90ab2f68a151aa302e74f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-ZL1z0Z2en3z_rm8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@sortino?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Joshua Sortino </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="6d03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我想介绍一种简单而强大的方法来用ReactJS创建组件:复合组件模式。</p><h2 id="a914" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">什么是复合成分？</h2><p id="5eb9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">复合组件模式允许组件共享一个<em class="mt">隐式</em>状态。这允许我们创建表达性和声明性的组件，而不需要不必要的训练。这些组件一起工作来完成一个共享的任务。</p><p id="f4fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个很好的例子是HTML <code class="fe mu mv mw mx b">select</code>和<code class="fe mu mv mw mx b">option</code>。</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="e398" class="lv lw it mx b gy nc nd l ne nf">&lt;select&gt;<br/> &lt;option value="apple"&gt;Apple&lt;/option&gt;<br/> &lt;option value="pear"&gt;Pear&lt;/option&gt;<br/>&lt;/select&gt;</span></pre><p id="d5ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mu mv mw mx b">Option</code>和<code class="fe mu mv mw mx b">select</code>合作完成他们的目标，让用户选择他们最喜欢的水果。</p><p id="63f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前面的例子是原生HTML。反应当量会是什么样的？</p><p id="540e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是没有复合组件模式时的样子:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="2b2b" class="lv lw it mx b gy nc nd l ne nf">&lt;Select<br/>  value={value}<br/>  onChange={handleChange}<br/>  options={[<br/>    { value: "apple", label: "Apple" },<br/>    { value: "pear", label: "Pear" }<br/>  ]}<br/>/&gt;;</span></pre><p id="2fff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是复合组件模式的外观:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="f6b7" class="lv lw it mx b gy nc nd l ne nf">&lt;Select value={value} onChange={handleChange}&gt;<br/>  &lt;Select.Option value="apple"&gt;Apple&lt;/Select.Option&gt;<br/>  &lt;Select.Option value="pear"&gt;Pear&lt;/Select.Option&gt;<br/>&lt;/Select&gt;;</span></pre><p id="b0f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们的组件现在以更具声明性的方式表达。</p><p id="8277" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将复合组件模式付诸实践，创建我们自己的<code class="fe mu mv mw mx b">Input</code>组件。</p></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="e933" class="nn lw it bd lx no np nq ma nr ns nt md jz nu ka mg kc nv kd mj kf nw kg mm nx bi translated">将模式付诸行动</h1><p id="0014" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们想创建一个足够灵活的<code class="fe mu mv mw mx b">Input</code>组件来满足我们所有的需求。</p><h2 id="0f04" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">验收准则</h2><ul class=""><li id="eaca" class="ny nz it lb b lc mo lf mp li oa lm ob lq oc lu od oe of og bi translated">标签可以放在输入之前或之后。</li><li id="4195" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">像图标或按钮这样的自定义元素可以放在输入之前或之后。</li><li id="74ca" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">它还应该允许传入自定义元素，如图标或按钮。</li><li id="854a" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">当输入获得焦点时，整个区域都应该获得焦点。</li><li id="3290" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">组件应该将<code class="fe mu mv mw mx b">htmlFor</code>添加到标签中。</li></ul><h2 id="a2ca" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">设计</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/d50734acf04471ec2451d31fdcbc4f4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ub4xCBpOq5H_O24X7sAzwg.png"/></div></div></figure><h2 id="d0ca" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">我们组件的API</h2><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="f654" class="lv lw it mx b gy nc nd l ne nf">&lt;InputGroup id="search-input" value={searchTerm} onChange={handleSearchTermChange}&gt;<br/>  &lt;InputGroup.Label&gt;Search&lt;/InputGroup.Label&gt;<br/>  &lt;InputGroup.Input /&gt;<br/>  &lt;InputGroup.Item&gt;<br/>    &lt;SearchIcon /&gt;<br/>  &lt;/InputGroup.Item&gt;<br/>&lt;/InputGroup&gt;</span></pre></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><h1 id="6aa4" class="nn lw it bd lx no np nq ma nr ns nt md jz nu ka mg kc nv kd mj kf nw kg mm nx bi translated">代码</h1><p id="1634" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们开始吧！我们创建一个名为<code class="fe mu mv mw mx b">InputGroup.js</code>的文件。</p><p id="6012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们为我们的<code class="fe mu mv mw mx b">InputGroup</code>创建一个定制的上下文:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="4f9c" class="lv lw it mx b gy nc nd l ne nf">const InputGroupContext = React.createContext();</span></pre><p id="e908" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们定义一个自定义挂钩，以便我们的组件可以使用该上下文:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="780c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们有了上下文，我们可以创建我们的<code class="fe mu mv mw mx b">InputGroup</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="a431" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个组件做两件事。</p><ul class=""><li id="2014" class="ny nz it lb b lc ld lf lg li op lm oq lq or lu od oe of og bi translated">它呈现传递给它的<code class="fe mu mv mw mx b">children</code>。</li><li id="a8bb" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">它用我们的<code class="fe mu mv mw mx b">InputGroupContext.Provider</code>包装<code class="fe mu mv mw mx b">children</code>。这使得我们的组件不必显式地传递props就可以进行通信。</li></ul><p id="77ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们定义我们的<code class="fe mu mv mw mx b">Input</code>组件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="4e17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们的<code class="fe mu mv mw mx b">Input</code>组件从上下文中接收它需要的道具。这意味着我们不需要显式地将<code class="fe mu mv mw mx b">id</code>、<code class="fe mu mv mw mx b">value</code>和<code class="fe mu mv mw mx b">onChange</code>传递给它。</p><p id="1e38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的<code class="fe mu mv mw mx b">Label</code>组件以类似的方式工作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="e22c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以定义一个<code class="fe mu mv mw mx b">Item</code>组件，以便更容易地传递像图标这样的定制元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="578b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们导出<code class="fe mu mv mw mx b">InputGroup</code>及其所有组件:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="9e24" class="lv lw it mx b gy nc nd l ne nf">InputGroup.Label = Label;<br/>InputGroup.Item = Item;<br/>InputGroup.Input = Input;</span><span id="3be0" class="lv lw it mx b gy os nd l ne nf">export default InputGroup;</span></pre><p id="7e93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以使用<code class="fe mu mv mw mx b">InputGroup</code>、<code class="fe mu mv mw mx b">InputGroup.Input</code>、<code class="fe mu mv mw mx b">InputGroup.Label</code>和<code class="fe mu mv mw mx b">InputGroup.Item</code>来重新创建我们的设计。</p><p id="1b68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们为网站做一个输入，左边是<code class="fe mu mv mw mx b">https://</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/c4f4b80d2c3f0e68db03da9b2acf087c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJG_O7S_PA61TPoBOhJIKg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">网站输入</p></figure><p id="3136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们使用<code class="fe mu mv mw mx b">InputGroup</code>和<code class="fe mu mv mw mx b">InputGroup.Item</code>:</p><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="0836" class="lv lw it mx b gy nc nd l ne nf">&lt;InputGroup<br/>  id="input-1"<br/>  value={value}<br/>  onChange={event =&gt; setValue(event.target.value)}<br/>&gt;<br/>  &lt;InputGroup.Item className="bg-dark"&gt;http://&lt;/InputGroup.Item&gt;<br/>  &lt;InputGroup.Input /&gt;<br/>&lt;/InputGroup&gt;;</span></pre><p id="7c79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单！</p><p id="9d5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们进行搜索输入:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/1cf6df5a3ab85ee1662a163b6baa1c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*782y7lLZh1C3vUAUh0mx3Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">搜索输入</p></figure><pre class="kj kk kl km gt my mx mz na aw nb bi"><span id="d934" class="lv lw it mx b gy nc nd l ne nf">&lt;InputGroup<br/>  id="input-1"<br/>  value={value}<br/>  onChange={event =&gt; setValue(event.target.value)}<br/>&gt;<br/>  &lt;InputGroup.Label className="bg-dark"&gt;Search&lt;/InputGroup.Label&gt;<br/>  &lt;InputGroup.Input /&gt;<br/>  &lt;InputGroup.Item&gt;<br/>    &lt;AiOutlineSearch /&gt;<br/>  &lt;/InputGroup.Item&gt;<br/>&lt;/InputGroup&gt;;</span></pre><p id="3e86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！想想复合组件的所有用例——它们在下拉、选择、标签等方面表现出色。</p><h2 id="01e2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">要查看代码和CSS，请在<a class="ae ky" href="https://codesandbox.io/s/fieldinput-compound-components-dysdj" rel="noopener ugc nofollow" target="_blank"> codesandbox </a>上查看。</h2></div></div>    
</body>
</html>