<html>
<head>
<title>Automating Your Android Code Review Process</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动化您的Android代码审查过程</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/automate-part-of-your-code-review-process-cf83e644d356?source=collection_archive---------8-----------------------#2022-01-20">https://betterprogramming.pub/automate-part-of-your-code-review-process-cf83e644d356?source=collection_archive---------8-----------------------#2022-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="92a5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">或者使用这些工具的过程的一部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e8967fc98f66851c8286525d8eb6e504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*djjogKOuAg0quXm5D5iyhw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">功劳归于<a class="ae kv" href="https://unsplash.com/photos/HBGYvOKXu8A" rel="noopener ugc nofollow" target="_blank">梁杰森</a></p></figure><p id="32d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在大公司或非个人项目中，总会有一次代码审查。你的另一个团队成员将会检查你的代码，如果有任何疑问，他们会提出意见。此外，如果更改文件很大，这将是一个很累的过程。在审查代码的时候，不管有没有意识到，你总会看到一些不必要的、不应该引起你注意的东西。比如缩进、类结构、通配符导入、代码约定等。好了，你可以放松了，那些琐碎的问题可以通过静态代码分析自动解决。</p><p id="f008" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">静态代码分析到底是什么？这是一个在不运行程序的情况下检查代码的过程。检查过程基于开发人员或工具已经设定的一组规则。当然，你不必手动完成，幸运的是，有一个工具可以自动完成这项工作。这个工具被称为静态代码分析器。有很多著名的静态代码分析工具，比如<a class="ae kv" href="https://developer.android.com/studio/write/lint" rel="noopener ugc nofollow" target="_blank"> Android Lint </a>、<a class="ae kv" href="https://github.com/pinterest/ktlint" rel="noopener ugc nofollow" target="_blank"> Ktlint </a>、<a class="ae kv" href="https://github.com/detekt/detekt" rel="noopener ugc nofollow" target="_blank"> Detekt </a>、<a class="ae kv" href="https://github.com/diffplug/spotless" rel="noopener ugc nofollow" target="_blank">一尘不染</a>等。有些工具，比如SonarQube，不仅仅是分析代码，它还会查看你的代码漏洞，重复代码等等。</p><p id="fc71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的项目中实现这些静态代码分析工具有很多好处。</p><ol class=""><li id="8343" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><strong class="ky ir">时间</strong>。添加静态代码分析器意味着成功提交的代码已经符合标准。在审查代码时，我们只需要关注重要的事情。您也可以在推至原点之前或之后以及合并至主图形之前运行该流程。选择最适合你的，目标是一致的。</li><li id="146c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">执行标准代码</strong>。和许多人一起做一个项目需要一些标准。实现静态代码分析器，迫使开发人员遵循规则。</li><li id="d93e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">最小化bug和性能问题</strong>。一些规则已经遵循标准指南，使我们的应用程序性能更好。比如在需要的时候使用<em class="mg">作为每个</em>和<em class="mg">的内嵌</em>功能。</li></ol><p id="b8c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将介绍Ktlint和Detekt的基本用法，因为它在社区中非常有名(每个都超过4k颗星)。出于演示的目的，我已经创建了一个简单的项目，它拥有我稍后将解释的一切，在这里得到它<a class="ae kv" href="https://github.com/bobbyirawan09/StaticAnalyzer" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="66c1" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">Ktlint</h1><p id="741a" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">根据官方文档，Ktlint是一种内置格式化程序的防自行车脱落Kotlin linter。在运行Ktlint任务时，有一些规则是默认激活的，您可以在这里找到<a class="ae kv" href="https://ktlint.github.io/#rules" rel="noopener ugc nofollow" target="_blank">。让我们开始将其集成到Android项目中。</a></p><ul class=""><li id="862c" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr ne ly lz ma bi translated">添加依赖项。建议使用此处所述的<a class="ae kv" href="https://github.com/pinterest/ktlint#with-a-plugin---recommended" rel="noopener ugc nofollow" target="_blank">插件。我们将使用</a><a class="ae kv" href="https://github.com/jlleitschuh/ktlint-gradle" rel="noopener ugc nofollow" target="_blank"> Jlleitschuh </a>。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">步骤1，添加Ktlint插件</p></figure><ul class=""><li id="3791" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr ne ly lz ma bi translated">添加Ktlint配置。我们将在<em class="mg"> allProjects </em>中实现它，因此其他模块将与Ktlint集成。从下图中，你可以看到有一些额外的配置。我不打算在这里解释它，去检查项目，因为我在那里添加了一些评论。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">步骤2，添加Ktlint配置</p></figure><ul class=""><li id="f11d" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr ne ly lz ma bi translated">(可选)您还可以修改报告文件目录。默认情况下，它将被放置在<code class="fe nh ni nj nk b">build/reports/ktlint</code>中。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">第三步，修改报表文件目录</p></figure><ul class=""><li id="a99c" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr ne ly lz ma bi translated">去同步你的项目。之后，你现在已经成功地将Ktlint集成到Android项目中了。</li></ul><p id="3419" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要检查Ktlint任务是否可以执行，请运行<em class="mg">。终端上的/gradlew task </em>命令，结果应该如下图所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/0ed9983e694954dca320459c21b29b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrIfq9W2EXk53hmpTGZVGQ.png"/></div></div></figure><p id="04d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Ktlint有两个可以运行的Gradle任务，每个任务都有自己的工作。第一个是<em class="mg"> ktlintCheck，</em>它会检查你所有的代码，如果有违反就报告。第二个是<em class="mg"> ktlintFormat，</em>作业与ktlintCheck相同，但有一个额外的作业。它还会根据规则自动重新格式化您的代码。请记住，它有局限性，并不是每一个违规都会重新格式化。</p><p id="9f38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里获得Ktlint集成的完整代码。</p><h1 id="ccfd" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated"><strong class="ak">检测</strong></h1><p id="8845" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated"><a class="ae kv" href="https://detekt.github.io/detekt/index.html" rel="noopener ugc nofollow" target="_blank"> Detekt </a>是一个静态代码分析器。它的主要工作与Ktlint相同，扫描您的代码并在有违规时报告，但它要强大得多，至少对我来说是这样。Detekt还带有预定义的规则，我们可以轻松地打开和关闭，完整的规则请查看<a class="ae kv" href="https://detekt.github.io/detekt/comments.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><ul class=""><li id="9593" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr ne ly lz ma bi translated">与Ktlint相同，首先添加依赖项。点击了解更多<a class="ae kv" href="https://detekt.github.io/detekt/gradle.html#kotlin-dsl-2" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">步骤1，将插件添加到项目中</p></figure><ul class=""><li id="4e24" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr ne ly lz ma bi translated">向Detekt添加一些配置。我们将在<em class="mg"> allProject </em>中实现配置。对于多模块项目，有一个特性可以将所有模块的报告合并到一个报告文件中。还有基线和配置放置。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">步骤2，添加Detekt插件配置</p></figure><ul class=""><li id="bfbd" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr ne ly lz ma bi translated">同步项目并检查可用的Gradle任务，确保您可以在那里找到detekt。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/6f578471650560f1ee5feadfffb7c6a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BqgNdz9ZO6FEegOo9EH_5Q.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">步骤3，检查可用于检测的梯度任务</p></figure><p id="208b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了默认的规则之外，您可以向Detekt添加自己的规则。假设您在公司或项目中编码时有一个约定或一些限制，您可以将它添加到Detekt中，这样Detekt将在检查代码时包括那些规则。你可以在项目中找到这一点，但是如何做将在另一篇文章中解释。</p><p id="f4b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，每个违规都有自己的解决时间预测。这一预测印在每一条规则中。当报告出来时，它还会告诉你和你的团队需要多少时间来解决所有的违规问题。这可能需要几天，几周，甚至几个月</p><p id="ec14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！你都准备好了！现在您可以开始在您的项目中使用Ktlint和Detekt了。但是请记住，特别是在大项目中，修复问题的时间不短。你可以一次一个地开始执行这个规则。一旦一个规则通过，那么继续下一个。</p><p id="07fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里获得完整的代码。</p><h1 id="28f8" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated"><strong class="ak">结案陈词</strong></h1><p id="3083" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">静态代码分析的主要作用是帮助我们处理代码惯例、代码性能等问题。</p><p id="e110" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请选择哪些工具涵盖了您的用例。除了我们刚刚讨论的两个，还有一些前面提到的其他方法值得一看和尝试。设置过程只是开始，添加到管道中，使每个编码通过所有规则，以及您需要做的其他事情，以便在您的项目/团队中充分利用这一点。慢慢来，一条一条地添加规则，让你的代码同时遵循所有的规则可能会让人头疼。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="0d94" class="mh mi iq bd mj mk nu mm mn mo nv mq mr jw nw jx mt jz nx ka mv kc ny kd mx my bi translated">资源</h1><div class="nz oa gp gr ob oc"><a href="https://detekt.github.io/detekt/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">检测</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">基于代码逻辑行、McCabe复杂性和…的Kotlin项目复杂性报告的代码味道分析</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">detekt.github.io</p></div></div><div class="ol l"><div class="om l on oo op ol oq kp oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://github.com/jlleitschuh/ktlint-gradle" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">GitHub-JLLeitschuh/ktlint-gradle:一个ktlint gradle插件</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">最新插件版本:10.2.1这个插件在你的Gradle项目中创建方便的任务，运行ktlint检查或做…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">github.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq kp oc"/></div></div></a></div><p id="d9cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完整的项目，你可以查看我的Github <a class="ae kv" href="https://github.com/bobbyirawan09/StaticAnalyzer" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="149e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>