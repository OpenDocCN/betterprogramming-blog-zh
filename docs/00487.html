<html>
<head>
<title>7 JavaScript Patterns Part 3: The Bracket Notation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">7 JavaScript模式第3部分:括号符号</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/7-js-pattern-part-3-the-bracket-notation-f571c2548c0a?source=collection_archive---------1-----------------------#2019-05-30">https://betterprogramming.pub/7-js-pattern-part-3-the-bracket-notation-f571c2548c0a?source=collection_archive---------1-----------------------#2019-05-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="35ef" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这是由七部分组成的系列文章中的第三篇，介绍了所有初级开发人员都应该知道的JavaScript模式</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f792571a50f6a45a102ddc566f186894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Vt8d4KKBZR0Zj10P.jpg"/></div></div></figure><p id="458e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您想知道如何在JavaScript中用字符串访问对象属性，那么这篇文章就是为您准备的！括号符号是最简单、最强大和最危险的JS模式之一。MDN文档可以在<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Property_Accessors#Bracket_notation" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="2279" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本周不是关于一个需要复杂帖子的古怪JS特性。我们将讨论一些有趣的东西:括号符号。这是大多数面向对象语言(如Ruby和Python)的一个特性。它既强大又危险，但这并不难理解。我们将重点给出真实世界的例子，<strong class="kw iu">，然后我们将看到如果你不小心的话会有多危险。</strong>让我们投入其中吧！</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="1aa6" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">括号符号是什么样子的？</h1><p id="7c1f" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">考虑这个数组:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="dbfa" class="na lz it mw b gy nb nc l nd ne">const array = ["lol", "lmao", "GG", "GLHF"]</span></pre><p id="e686" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以从该数组中检索一个项，该项的索引为:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="1d36" class="na lz it mw b gy nb nc l nd ne">array[3]<br/>// expects: "GLHF"</span></pre><p id="1f7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好，现在考虑这个物体:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="f6f1" class="na lz it mw b gy nb nc l nd ne">const obj1 = {prop1: "Trololo", foo: "bar"}</span></pre><p id="7bbe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你已经知道可以访问像<strong class="kw iu"> <em class="nf"> obj1.foo </em> </strong>这样的对象属性，对吗？这就是我们所说的点符号。但是如果我告诉你，你也可以用一个字符串访问一个属性，就像你访问一个数组的索引号一样。这里有一个例子:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="002a" class="na lz it mw b gy nb nc l nd ne">obj1["foo"]</span><span id="881d" class="na lz it mw b gy ng nc l nd ne">// expects: "bar"</span><span id="ce60" class="na lz it mw b gy ng nc l nd ne">// it’s the same as</span><span id="5d49" class="na lz it mw b gy ng nc l nd ne">obj.foo</span><span id="5c7e" class="na lz it mw b gy ng nc l nd ne">// expects: "bar"</span></pre><p id="7201" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">等等，不要太激动。如果我告诉你，就像数组项一样，你可以进行任何类型的计算，甚至可以调用括号内的函数，如下例所示:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="9ba2" class="na lz it mw b gy nb nc l nd ne">obj1["prop" + "1"] // doing some computation</span><span id="f6fe" class="na lz it mw b gy ng nc l nd ne">// expects: "Trololo"</span><span id="cc6d" class="na lz it mw b gy ng nc l nd ne">function foo() {return "foo"}</span><span id="a4a1" class="na lz it mw b gy ng nc l nd ne">obj1[foo()] // calling an object</span><span id="d09d" class="na lz it mw b gy ng nc l nd ne">// expects: "bar"</span></pre><p id="3622" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你曾经在Ruby中使用过python或hashes，你应该已经熟悉了这种语法，并且知道它为我们JS开发人员打开了无限的潜力。<strong class="kw iu">它使我们能够动态地访问属性和调用功能。不管怎样，现在你可以尽情放松了。</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="8385" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">括号符号有什么用？</h1><h2 id="2011" class="na lz it bd ma nj nk dn me nl nm dp mi ld nn no mk lh np nq mm ll nr ns mo nt bi translated">动态访问属性</h2><p id="9d86" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">考虑一个随机CMS的API，它将为您提供一个JSON，其中包含用多种语言编写的一篇文章的标题和摘要，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu ni l"/></div><p class="nv nw gj gh gi nx ny bd b be z dk translated">在比利时，我们说3种语言，这是我在现实生活中经常遇到的事情</p></figure><p id="d62a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好了，现在考虑这个响应已经被转换成一个对象并存储在一个名为<strong class="kw iu"> <em class="nf"> respond </em> </strong>的变量中。如何用指定的语言创建一个可以返回指定属性的函数？</p><p id="8e3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您以前不熟悉括号符号，您的第一反应将是嵌套的if-else语句。这可能会产生很好的代码，但是如果缩进正确的话，也需要大约25行以上的代码。你也有switch/case语句选项，但是它也需要嵌套它们，而嵌套的switch/case就是一团乱麻。用括号符号，我可以这样做:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="62b3" class="na lz it mw b gy nb nc l nd ne">// respond variable was given before<br/>function displayContent(attrName, lang) {<br/>  return respond.data[attrName][lang]<br/>}</span></pre><p id="ed42" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">是的，只要三行代码，你就可以做到！现在，您可以用法语显示标题，如下所示:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="cc3d" class="na lz it mw b gy nb nc l nd ne">displayContent("title", "fr")<br/>// expects: "Combien de hot-dogs peux-tu manger?"</span></pre><p id="4db8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很神奇吧？但是，尽管这段代码看起来很神奇，但它仍然太单薄、不安全、易受攻击。让我们把它带到体育馆去放松一下，感到安全！</p><p id="8a95" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是升级/安全版本的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu ni l"/></div></figure><p id="8140" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">11行缩进良好、安全且非常优雅的代码。</p><p id="0934" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">稍后再谈安全问题。你会明白为什么这个代码的第一个版本是超级脆弱的。</em></p><h2 id="c41d" class="na lz it bd ma nj nk dn me nl nm dp mi ld nn no mk lh np nq mm ll nr ns mo nt bi translated">动态调用方法</h2><p id="fc0b" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">一个简单的典型例子:假设你需要实现<a class="ae lq" href="https://oauth.net/2/" rel="noopener ugc nofollow" target="_blank"> OAuth 2.0 </a>，为多个社交网络提供登录选项，比如脸书、谷歌、Instagram。你可以这样写:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu ni l"/></div></figure><p id="66c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">相当简单，但如此强大！一旦你知道了括号符号，你就会一直用到它。</p><p id="cf99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是要小心，年轻的学徒，即使它是强大而简单的，但在未经训练的开发人员手中可能是非常危险的。最坏的情况是，如果你不学会驯服它的阴暗面，它会破坏代码库。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/fb939403f0a332dd8f8e898f2bb01cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_aZPb5VVYRQkDsBc.jpg"/></div></div></figure><p id="e274" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们来看看如何成为一个负责任的开发者。我们来谈谈弱点。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="6f24" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">你应该知道的危险的东西！</h1><h2 id="693a" class="na lz it bd ma nj nk dn me nl nm dp mi ld nn no mk lh np nq mm ll nr ns mo nt bi translated">胁迫警报！</h2><p id="3b1c" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">当您使用括号符号时，括号<strong class="kw iu">中的任何内容都应该是或者返回一个原始值</strong>(字符串或数字)。如果您的目的是访问一个现有的属性，请始终确保返回的原语与一个现有属性的名称相对应，以便它能够正常工作。</p><p id="589a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你不返回一个原语，你放在那里的任何东西都将被强制转换为1。当这种情况发生时，您的代码变得非常不可预测并且很难调试。<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Property_Accessors#Property_names" rel="noopener ugc nofollow" target="_blank">检查此mdn示例</a>:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="2d0c" class="na lz it mw b gy nb nc l nd ne">var foo = {unique_prop: 1}, bar = {unique_prop: 2}, object = {};<br/>object[foo] = 'value';<br/>console.log(object[bar]);</span></pre><p id="2adc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">令人惊讶的是，这段代码的控制台输出不是<strong class="kw iu"><em class="nf"/></strong>。给自己一分钟时间猜猜会是什么…</p><p id="26c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它将<strong class="kw iu"> <em class="nf">【值】</em> </strong> <em class="nf"> </em>成为<em class="nf">c</em>ause booth<strong class="kw iu"><em class="nf">foo</em></strong>和<strong class="kw iu"> <em class="nf"> bar </em> </strong>变量是两个不同的对象。即使不同，也要挟成同一个字符串值:<strong class="kw iu"><em class="nf">【Object Object】"</em></strong><br/>所以，两者都会访问同一个属性，在第二行代码中创建，像这样:<br/><strong class="kw iu"><em class="nf">Object["[Object Object]"]。</em> </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl oa"><img src="../Images/06596c21e8dcc09148be5957113f60c1.png" data-original-src="https://miro.medium.com/v2/0*SCNBNI27ylYqPgXA"/></div></figure><p id="8d19" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我给你的建议是:别乱来！JavaScript中的有意强制已经很难处理了，<strong class="kw iu">无意强制是真正的噩梦</strong>。我敢打赌，至少70%的JavaScript迷因，就像上面这个，都是关于它处理强制的愚蠢方式。就是这么糟糕！</p><p id="f47e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">括号内的符号<strong class="kw iu">总是</strong>显式返回一个原语！<a class="ae lq" href="https://www.freecodecamp.org/news/js-type-coercion-explained-27ba3d9a2839/" rel="noopener ugc nofollow" target="_blank">这里有更多关于强制的内容。</a></p><h2 id="dc77" class="na lz it bd ma nj nk dn me nl nm dp mi ld nn no mk lh np nq mm ll nr ns mo nt bi translated">让用户访问您的属性和方法</h2><p id="edfe" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">使用括号符号，您可以创建一个应用程序，在其中向您的用户提供不需要的访问属性。更糟糕的是，他们可能会调用不应该调用的方法。</p><p id="214c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们来看看我能想到的最愚蠢的例子:<br/>想象一个网络应用程序，你可以在那里问一堆关于某人的问题。这段HTML带有一个输入字段、一个按钮和一个元素，请求的数据应该显示为:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="0a8a" class="na lz it mw b gy nb nc l nd ne">&lt;div&gt;<br/>Ask something about John: &lt;input type="text" id="dataAsker"&gt;<br/>&lt;br&gt;<br/>&lt;button id="dataLeaker"&gt; answers! &lt;/button&gt;<br/>&lt;p id="answer_el"&gt;&lt;/p&gt;<br/>&lt;/div&gt;</span></pre><p id="14f6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，考虑附加在它上面的这个脚本:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="01c5" class="na lz it mw b gy nb nc l nd ne">data: {<br/>  first_name: "John",<br/>  last_name: "Doe",<br/>  age: 34,<br/>  profession: "Proud developer",<br/>  credit_card_number: "12345678", // Should be private<br/>  dirty_secret: "bets in illegal hot-eating contest" // private<br/>  methods: {<br/>    full_name(){return(this.first_name + " " + this.last_name)},<br/>    dangerous(){// imagine some code the breaks the whole INTERNET},<br/>    leak_everything() {// image it leaks the all of googles data}<br/>  }<br/>}</span><span id="2a71" class="na lz it mw b gy ng nc l nd ne">answerRequest() {<br/>  const input = document.getElementById("dataAsker").value<br/>  const answer_el = document.getElementById("answer_el")</span><span id="b9a7" class="na lz it mw b gy ng nc l nd ne">  if (data[input] !== undefined) { // access properties<br/>    answer_el.innerHTML = data[input]<br/>  } else if(data.methods[input] !== undefined) {<br/>    // invoke if its a method<br/>    answer_el.innerHTML = data.methods[input]()<br/>  }<br/>}</span><span id="616c" class="na lz it mw b gy ng nc l nd ne">document.getElementById("#dataLeaker").addEventListener("click", answerRequest);</span></pre><p id="c294" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个应用程序中，用户可以访问所有的数据，并可以调用<strong class="kw iu"> <em class="nf">数据</em> </strong>对象所拥有的方法。例如，如果他在输入字段中填写<strong class="kw iu">“first _ name”</strong>并请求一个答案，他将在答案元素中返回<strong class="kw iu">“John”</strong>。但是，他也可以用同样的方式访问<strong class="kw iu"><em class="nf">crediet _ card _ number</em></strong>和<strong class="kw iu"> <em class="nf"> dirty secret </em> </strong>属性。由于这段代码给了用户访问所有方法的权限，他可以调用无害的<strong class="kw iu"> <em class="nf"> full_name </em> </strong>方法以及非常有害的<strong class="kw iu"> <em class="nf"> dangerous </em> </strong>和<strong class="kw iu"><em class="nf">leak _ everything</em></strong>方法，这些方法显然会让整个互联网着火。所以要非常注意你的用户可以用括号符号访问什么。</p><h2 id="636e" class="na lz it bd ma nj nk dn me nl nm dp mi ld nn no mk lh np nq mm ll nr ns mo nt bi translated">解决方案:验证</h2><p id="99aa" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">正如你从下面的例子中看到的，我总是使用某种验证模式来确保我不会盲目地执行参数中给出的任何东西:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu ni l"/></div></figure><p id="9080" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">基本上，我设置了一个有效原始值的数组。之后，我检查括号符号中使用的给定参数是否是有效值之一。</p><p id="a19c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用这种模式，我可以同时解决这两个问题，并检查参数是否等于有效的原始值之一。因此，不存在非故意胁迫的风险。最重要的是，只有经过阵列验证的内容才可以访问。这使得用户没有访问他不应该访问的内容的风险。</p><p id="a2c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您不需要使用与我在这里使用的完全相同的验证模式，但是您需要以某种方式验证这些东西。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="12a3" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">我们到此为止</h1><p id="66bb" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">你觉得这篇文章怎么样？所有的例子都清楚了吗？你知道为什么要小心括号符号吗？这篇文章还有什么没有回答的问题吗？请在下面的评论中告诉我。</p><p id="24bd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本系列的下一篇文章:使用逻辑运算符返回内容</p><p id="03ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://medium.com/@patick.cyiza/7-js-patterns-junior-developers-should-know-well-1a0ad075338f" rel="noopener">点击此处查看完整系列</a></p></div></div>    
</body>
</html>