<html>
<head>
<title>iOS 14's New Logger API vs. OSLog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 14的新日志API与OSLog</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ios-14s-new-logger-api-vs-oslog-ef88bb2ec237?source=collection_archive---------0-----------------------#2020-07-15">https://betterprogramming.pub/ios-14s-new-logger-api-vs-oslog-ef88bb2ec237?source=collection_archive---------0-----------------------#2020-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4747" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在WWDC 20上，苹果宣布了一个新的统一日志API来收集、处理日志信息，并帮助调试意外行为</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bf8ea68451625ec64a1ec4c88ed6a0d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ar7b6nmBJ9mYIloQcdES9A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@williamtm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">威廉·胡克</a>在<a class="ae ky" href="https://unsplash.com/s/photos/mobile-phone?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><h1 id="5e07" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">我们开始吧</h1><p id="a764" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">简而言之，我们将从现有的<code class="fe mn mo mp mq b">print</code>日志迁移到新的苹果日志API。</p><p id="42f3" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">然后我们将重温<code class="fe mn mo mp mq b">OSLog</code> API，并检查现有的旧<code class="fe mn mo mp mq b">OSLog</code>和新iOS 14<code class="fe mn mo mp mq b">Logger</code>API之间的差异。</p><p id="5de9" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">首先，让我们转换一个简单的打印语句，我们在项目中经常使用它来记录消息:</p><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="d3a7" class="na la it mq b gy nb nc l nd ne">print(“Start network call”)</span></pre><p id="4b6a" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">对此:</p><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="9bf2" class="na la it mq b gy nb nc l nd ne">let log = OSLog.init(subsystem: "com.mandy.loggingdemo", category: "main")<br/>os_log("Start network call", log: log)</span></pre><p id="2620" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">记得为此使用<code class="fe mn mo mp mq b">os_log </code>API；你得写<code class="fe mn mo mp mq b">import os.log</code>声明。自iOS 10以来，统一日志系统一直是苹果的日志标准。(这是在WWDC 2016 宣布的<a class="ae ky" href="https://developer.apple.com/videos/play/wwdc2016/721/" rel="noopener ugc nofollow" target="_blank">。)</a></p><p id="d879" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">您可以将<strong class="lt iu">子系统</strong>视为您的应用程序的唯一捆绑id，将<strong class="lt iu">类别</strong>视为应用程序模块。</p><p id="cc2e" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">现在，在iOS 14中，苹果推出了新的<code class="fe mn mo mp mq b">Logger</code> API。要使用这个API，我们必须编写相同的<code class="fe mn mo mp mq b">import os.log</code>语句，但是语法与<code class="fe mn mo mp mq b">os_log</code> API完全不同。</p><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="1352" class="na la it mq b gy nb nc l nd ne">let logger = Logger.init(subsystem: "com.mandy.loggingdemo", category: "main")<br/>logger.debug("Start network call")</span></pre><p id="34c3" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">您可以在调试模式下的Xcode控制台以及Mac控制台应用程序中查看<code class="fe mn mo mp mq b">os_log</code>和<code class="fe mn mo mp mq b">Logger</code>日志。</p><p id="f81e" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">控制台app很强大；我会推荐使用它，因为你可以使用<strong class="lt iu">子系统</strong>和<strong class="lt iu">类别</strong>过滤值，并更广泛地调试你的应用程序。</p><p id="782a" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">当您想要调试设备问题并导出<strong class="lt iu">日志文件</strong>时，它也会有所帮助。归档文件将在控制台中打开，并帮助您确定问题。下面是一个例子，我们登录了iPhone 11 Pro，并用子系统<em class="nf"> com.mandy.loggingdemo. </em>过滤了这个简单的日志</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/dc7926f0063ef1bf408d7b34e6b64373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9RJmh3u5Exm7F-aHdn-ubA.png"/></div></div></figure><p id="6867" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">与<code class="fe mn mo mp mq b">print</code>语句相比，<code class="fe mn mo mp mq b">os_log</code>和<code class="fe mn mo mp mq b">Logger</code> API具有相同的优势。在本文中，我们将主要关注它们的用法以及这两个API之间的区别。我还在文章末尾添加了一些好的参考资料，带你浏览一下<code class="fe mn mo mp mq b">os_log</code>和<code class="fe mn mo mp mq b">Logger</code> API。让我们深入探讨一下。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="d188" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">统一日志API的优势</h1><ul class=""><li id="879e" class="nt nu it lt b lu lv lx ly ma nv me nw mi nx mm ny nz oa ob bi translated">低性能开销；</li><li id="6e84" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">字符串插值(从iOS 14开始，<code class="fe mn mo mp mq b">os_log</code>也支持该功能)；</li><li id="d480" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">不同的日志类型(调试、信息、警告、错误、故障、通知)用于不同的用途；</li><li id="a456" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">持久有效的日志记录——我们甚至可以调试设备中罕见的情况下的bug并修复它们；</li><li id="b433" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">许多格式化和表达选项在运行时没有成本；和</li><li id="ab34" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">可见性选项。</li></ul><p id="e285" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">让我们来看看一些关键的不同之处。</p><h1 id="4f62" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">字符串插值和格式化字符串</h1><p id="483f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe mn mo mp mq b">os_log</code>iOS 14之前接受格式化字符串:</p><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="6d29" class="na la it mq b gy nb nc l nd ne">let count = 0<br/>let log = OSLog.init(subsystem: "com.mandy.loggingdemo", category: "main")<br/>os_log("Start %d network call", log: log, type: OSLogType.debug, count)</span></pre><p id="7013" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated"><strong class="lt iu"> <em class="nf">注</em> </strong> <em class="nf">:从iOS 14开始，</em> <code class="fe mn mo mp mq b">os_log</code>、<em class="nf">中也有所有的字符串插值方法。</em></p><p id="a1f7" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">新的<code class="fe mn mo mp mq b">Logger</code> API支持开箱即用的字符串插值，与旧的C风格格式化相比，更像Swift风格。一些例子是</p><ul class=""><li id="6577" class="nt nu it lt b lu mr lx ms ma oh me oi mi oj mm ny nz oa ob bi translated">数字数据类型，如Int和Double</li><li id="79f8" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">带描述的对象；和</li><li id="0804" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated">符合<code class="fe mn mo mp mq b">CustomStringConvertible</code>的任何类型。</li></ul><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="43b9" class="na la it mq b gy nb nc l nd ne">let count = 0<br/>let logger = Logger.init(subsystem: “com.mandy.loggingdemo”, category: “main”)<br/>logger.debug(“Start \(count) network call”)</span></pre></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="06b2" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">不同的日志记录类型</h1><p id="3cab" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe mn mo mp mq b">os_log</code>和<code class="fe mn mo mp mq b">Logger</code>都支持不同的记录类型。下面是一些类型及其用途的示例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/89839417d65e5a3b9c46bc1cfdc4cb20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzyV2jkaqAgu5GD1TKxkww.png"/></div></div></figure><p id="bf02" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">在iOS 14之前，我们用<code class="fe mn mo mp mq b">os_log</code>用<code class="fe mn mo mp mq b">type</code>参数声明。果然是<code class="fe mn mo mp mq b">OSLogType</code>枚举:</p><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="b67a" class="na la it mq b gy nb nc l nd ne">let count = 0<br/>let log = OSLog.init(subsystem: "com.mandy.loggingdemo", category: "main")<br/>os_log("Start %d network call", log: log, type: OSLogType.debug, count)</span></pre><p id="2107" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">从iOS 14开始，苹果已经使Logger API对开发者更加友好、直接和简单，以促进其使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/fcbfe0cc8fe035fbfdbde9fffd73fd47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7xeeIuu49rwFTpQxNrczXg.png"/></div></div></figure><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="20aa" class="na la it mq b gy nb nc l nd ne">let count = 0<br/>let logger = Logger.init(subsystem: “com.mandy.loggingdemo”, category: “main”)<br/>logger.debug(“Start \(count) network call”)</span></pre><p id="28f4" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">既然我们谈到了这个主题，让我们来看看这些日志记录类型的不同属性，在您的应用程序中使用它们时会很方便。</p><h2 id="a30c" class="na la it bd lb ol om dn lf on oo dp lj ma op oq ll me or os ln mi ot ou lp ov bi translated">坚持的</h2><p id="0bdc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这些日志消息根据其类型存储在磁盘中。调试不持久化，信息仅在<code class="fe mn mo mp mq b">log collect</code>选项期间持久化，其余的持久化直到存储限制。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/2789becd890c2270cbb0b52d91f384e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*noYtBE8PQfmeOd4hTsQXog.png"/></div></div></figure><h2 id="4bce" class="na la it bd lb ol om dn lf on oo dp lj ma op oq ll me or os ln mi ot ou lp ov bi translated">表演</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/ef33d53804aefb32040e4da70070ad3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hpHswNMhLoksGDqUil0Qog.png"/></div></div></figure></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="16a9" class="kz la it bd lb lc no le lf lg np li lj jz nq ka ll kc nr kd ln kf ns kg lp lq bi translated">能见度</h1><p id="ce8c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当消息被记录时，即使当应用程序被部署时，如果一个人可以物理地访问设备，他们也可以被查看。因此，开发者有责任不公开这些敏感信息。</p><p id="1f87" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">在<code class="fe mn mo mp mq b">os_log</code>中，我们可以用格式选项设置可见性，如下图所示。我们将<code class="fe mn mo mp mq b">%{private}s</code>设置为private，就像我们将它设置为public一样。默认情况下，在<code class="fe mn mo mp mq b">os_log</code>中，动态值是私有的。</p><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="3fd0" class="na la it mq b gy nb nc l nd ne">let log = OSLog.init(subsystem: “com.mandy.loggingdemo”, category: “main”)<br/> os_log(“Bank account number %{private}s, “, log: log, type: .info, 00011112222)</span></pre><p id="7822" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">让我们看看<code class="fe mn mo mp mq b">Logger</code>。除了可见性选项之外，这个API还为我们提供了更多的定制选项。默认情况下，在<code class="fe mn mo mp mq b">Logger</code>中，动态值是私有的。</p><p id="0bd1" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">借助<code class="fe mn mo mp mq b">os_log</code>这样的隐私参数，我们可以将值设置为公共或私有。</p><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="dba5" class="na la it mq b gy nb nc l nd ne">logger.log(“Bank account number \(XXXXXXXX, privacy: .private)”)</span></pre><p id="9d65" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我们还可以屏蔽敏感信息:</p><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="94b5" class="na la it mq b gy nb nc l nd ne">logger.log(“Bank account number \(XXXXXXXX, privacy: .private(mask: .hash))”)</span></pre><h1 id="e58c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">日志归档</h1><p id="e65f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">考虑一个场景，您想要调试一些罕见的场景错误或bug，这些错误或bug不会在您的桌面计算机上或在调试时出现。假设你的QA遇到了一些独特的问题，他不知道重现它的具体步骤。</p><p id="5bd4" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我们可以连接他的设备，导出错误发生时应用程序的日志存档，并在控制台中打开以调试这种情况，前提是我们已经在应用程序中添加了适当的日志记录。</p><h2 id="814a" class="na la it bd lb ol om dn lf on oo dp lj ma op oq ll me or os ln mi ot ou lp ov bi translated">导出归档文件的命令</h2><pre class="kj kk kl km gt mw mq mx my aw mz bi"><span id="1823" class="na la it mq b gy nb nc l nd ne">log collect --device --start '<!-- -->2020-06-22 9:41:00<!-- -->' --output yourapp.logarchive</span></pre><p id="609f" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">在控制台中打开此档案，并使用子系统和类别进行过滤以找到问题。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="7d3e" class="pw-post-body-paragraph lr ls it lt b lu mr ju lw lx ms jx lz ma mt mc md me mu mg mh mi mv mk ml mm im bi translated">我希望这篇文章能帮助你理解Logger API的强大之处，并帮助你认识到现在是时候将我们的项目从传统的日志记录机制切换到新的Apple APIs，以便进行更好、更可靠的调试。</p><h1 id="41eb" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考资料和好读物</h1><ul class=""><li id="63d2" class="nt nu it lt b lu lv lx ly ma nv me nw mi nx mm ny nz oa ob bi translated">【OSLog的Rayweinderlich】</li><li id="a372" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated"><a class="ae ky" href="https://developer.apple.com/videos/play/wwdc2016/721/" rel="noopener ugc nofollow" target="_blank"> WWDC 2016年奥运会(OSLog) </a></li><li id="8462" class="nt nu it lt b lu oc lx od ma oe me of mi og mm ny nz oa ob bi translated"><a class="ae ky" href="https://developer.apple.com/videos/play/wwdc2020/10168/" rel="noopener ugc nofollow" target="_blank"> WWDC 2020(记录者)</a></li></ul></div></div>    
</body>
</html>