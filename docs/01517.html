<html>
<head>
<title>Making a Search and Filter Function in Ruby on Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Ruby on Rails中创建搜索和过滤功能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/making-a-search-and-filter-function-in-rails-a7858987f6f6?source=collection_archive---------2-----------------------#2019-09-20">https://betterprogramming.pub/making-a-search-and-filter-function-in-rails-a7858987f6f6?source=collection_archive---------2-----------------------#2019-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="60a7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习cookies的巧妙使用，减少对影响性能的脚本的依赖</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a3c46fc36994fabd519eec81730fe80e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U3pb7iQmiIZRPg2__IJdbw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Christian Holzinger 在<a class="ae kv" href="https://unsplash.com/s/photos/rails?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="b2ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"> Ruby on Rails </a>非常适合轻松创建强大而灵活的后端。随着JavaScript的流行和灵活性，<a class="ae kv" href="https://www.ruby-lang.org/en/" rel="noopener ugc nofollow" target="_blank"> Ruby </a>不常被用来创建前端。然而，我认为限制你自己使用HTML、Ruby和CSS可以帮助开发者学习建立更好的网站。通过测试在没有JavaScript的情况下，我们可以将网页的动态性推进到什么程度，我们可以了解cookies的巧妙使用，并减少对影响性能的脚本的依赖。</p><p id="a236" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">练习在Rails中使用cookies的一个好方法是为网站创建一个简单的搜索和排序功能。让我们来看看使这两种操作同时成为可能的组件。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="80f7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">代码</h1><p id="c85e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">对于这个例子，我们将使用一个非常基本的梦幻足球花名册应用程序，如果你想按照所示的代码进行操作，可以在这里找到完整的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="ac8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上述方法处理来自数据库的玩家响应。第一种方法，<code class="fe my mz na nb b">handle_search_name</code>获取一个保存用户搜索输入的cookie，并使用它来选择名字与搜索项相似的球员，使用<code class="fe my mz na nb b">activerecord</code>方法:其中<code class="fe my mz na nb b">@players = Player.where("name LIKE ?", "%#{session[:search_name].titleize}%")</code></p><p id="d946" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">方法<code class="fe my mz na nb b">handle_filters</code>获取当前可用的玩家列表，然后通过适当的选项“<code class="fe my mz na nb b">@players = @players.where(position: session[:filter_option])</code>进行过滤</p><p id="2edf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两种方法都依靠<em class="nc">会话</em>。这个会话实际上只是一个cookies的集合。这些cookies是通过作为表单的<code class="fe my mz na nb b">get</code>请求的一部分发送回服务器的参数来传递的。所以我们来看看那些是怎么发的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="df86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的表单将一个<code class="fe my mz na nb b">get</code>请求发送回同一个页面，但是将用户的搜索词作为一个名为<code class="fe my mz na nb b">search_name</code>的参数传入。</p><p id="108d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后在我们的Rails控制器中，我们使用:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e522" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面一行代码将传递的参数<code class="fe my mz na nb b">search_name</code>存储为我们的会话的一部分，然后由<code class="fe my mz na nb b">handle_search_name</code>方法使用。虽然我们可以简单地使用参数使我们的搜索工作，但参数的问题是它们不会在请求之间持续。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="2d03" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">为什么是会话？</h1><p id="4112" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果一个参数没有在多次请求中保持不变，当我们选择过滤器选项(向服务器发出请求)时，用户的搜索词为空。这就是为什么我们必须把这个参数作为会话的一部分存储起来。</p><p id="e2b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Rails中的会话实际上是一组加密的cookies。如果我们不希望用户能够手动编辑单个cookies，我们使用会话。在这种特殊的情况下，我们希望控制特定的cookies什么时候持续存在，什么时候被清除。为此，我们将把cookie放在一个会话中，而不是作为单独的cookie保存。</p><h2 id="7ce2" class="nd ma iq bd mb ne nf dn mf ng nh dp mj lf ni nj ml lj nk nl mn ln nm nn mp no bi translated">同时搜索和过滤</h2><p id="4c76" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在，用户已经给了我们一个要存储的搜索词，我们可以使用过滤器进一步缩小搜索范围。在我们的HTML中，每个过滤器选项都有一个表单，让我们看看下面的一个:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6642" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码创建了一个下拉菜单，当它被更改时，将使用所选选项的参数向服务器提交一个请求。回到Rails的控制器端，我们处理参数并将其保存到我们的会话中。既然我们有了搜索词和过滤器选项，我们就有了显示结果所需的一切。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="625c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">显示结果</h1><p id="5434" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">最令人满意的部分是将这些结果显示在页面上。</p><p id="d771" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您的路由配置正确，我们需要做的就是在您的控制器中调用这些搜索和过滤处理程序。这将处理每次参数的检查，在我们的会话中存储适当的参数，然后从我们的数据库中组织数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="8a61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后在我们的HTML中，我们必须创建在新排序的数据集中返回的元素。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="2e22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">维奥拉。最终结果应该类似于下面的gif:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/fe0c706124cfd1f88af692bb08b1f895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GItAToZ51jfKtfZw"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Gif信用<a class="ae kv" href="http://twitter.com/mrwerner392" rel="noopener ugc nofollow" target="_blank"> @mrwerner392 </a></p></figure><p id="9616" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用这个项目中应用的相同原则，我们可以推动Rails作为前端感觉更具交互性，并训练自己更好地利用cookies等工具。</p></div></div>    
</body>
</html>