<html>
<head>
<title>How To Prefix Your Commit Message With a Ticket Number Automatically</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何自动在您的提交消息前添加一个票号</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-automatically-add-the-ticket-number-in-git-commit-message-bda5426ded05?source=collection_archive---------0-----------------------#2019-12-19">https://betterprogramming.pub/how-to-automatically-add-the-ticket-number-in-git-commit-message-bda5426ded05?source=collection_archive---------0-----------------------#2019-12-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f8f8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">prepare-commit-msg git挂钩的实际用例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0497e6bb292f9d374dd8ebabcb0d975e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-yJ7v-I4P0FrSuZ6S7B55w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@paullywooten?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">波莱特·伍滕</a>在<a class="ae ky" href="https://unsplash.com/s/photos/happy-coder?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a9a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您不必为每次提交手动输入票号！</p><p id="2aa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦分支名称包含了那个引用，您就可以设置git挂钩来为您做这件事！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/96ec2d89d2ae9ba24e87269dc1d11000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tqDxHHt4zkvtkms7K49q5Q.png"/></div></div></figure><p id="a4c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Git允许您使用<code class="fe lw lx ly lz b">prepare-commit-msg</code> <a class="ae ky" href="https://git-scm.com/book/uz/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank">钩子</a>拦截提交消息。</p><p id="a0e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个钩子是Git在提交之前调用的一个可执行文件。它接受一个参数—包含提交消息的目标文件名。</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="99b9" class="me mf it lz b gy mg mh l mi mj"># GIT executes the prepare-commit-msg hook internally like:</span><span id="88f4" class="me mf it lz b gy mk mh l mi mj">$ .git/hooks/prepare-commit-msg .git/COMMIT_EDITMSG</span></pre><p id="1e08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任务是准备一个基于分支名称的定制消息，并将其写回到<code class="fe lw lx ly lz b">.git/COMMIT_EDITMSG</code>文件中。</p><p id="b5c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是bash中的一个示例实现:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="a7b7" class="me mf it lz b gy mg mh l mi mj">#!/bin/bash<br/>FILE=$1<br/>MESSAGE=$(cat $FILE)<br/>TICKET=[$(git rev-parse --abbrev-ref HEAD | grep -Eo '^(\w+/)?(\w+[-_])?[0-9]+' | grep -Eo '(\w+[-])?[0-9]+' | tr "[:lower:]" "[:upper:]")]<br/>if [[ $TICKET == "[]" || "$MESSAGE" == "$TICKET"* ]];then<br/>  exit 0;<br/>fi<br/><br/>echo "$TICKET $MESSAGE" &gt; $FILE</span></pre><p id="4ca3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lw lx ly lz b">TICKET</code>变量在括号中包含一个提取的票号，比如:</p><ul class=""><li id="e4d8" class="ml mm it lb b lc ld lf lg li mn lm mo lq mp lu mq mr ms mt bi translated"><code class="fe lw lx ly lz b">myproj-123-some-feature</code> → <code class="fe lw lx ly lz b">[MYPROJ-123]</code></li><li id="e153" class="ml mm it lb b lc mu lf mv li mw lm mx lq my lu mq mr ms mt bi translated"><code class="fe lw lx ly lz b">feature/myproj-456-some-other-feature</code> → <code class="fe lw lx ly lz b">[MYPROJ-456]</code></li><li id="1c4f" class="ml mm it lb b lc mu lf mv li mw lm mx lq my lu mq mr ms mt bi translated"><code class="fe lw lx ly lz b">bugifx/myproj-789</code> → <code class="fe lw lx ly lz b">[MYPROJ-789]</code></li><li id="dd60" class="ml mm it lb b lc mu lf mv li mw lm mx lq my lu mq mr ms mt bi translated"><code class="fe lw lx ly lz b">123_some_feature </code> → <code class="fe lw lx ly lz b">[123]</code></li></ul><p id="5fa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，现在复制脚本并放在<code class="fe lw lx ly lz b">your-repo/.git/hooks/prepare-commit-msg</code>中，使用<code class="fe lw lx ly lz b">chmod</code>命令:<code class="fe lw lx ly lz b">chmod +x your-repo/.git/hooks/prepare-commit-msg</code>使其成为可执行文件。</p><p id="0efc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">观看它的实际应用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/96ec2d89d2ae9ba24e87269dc1d11000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tqDxHHt4zkvtkms7K49q5Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用内嵌提交自动生成的票据编号。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/afc45f1f3bdcc96b4a89294e535edc1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bcHSRSlls00TPT0QwXZkLw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在文本编辑器中自动生成的票号(不带-m开关提交)。</p></figure><p id="baf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能已经注意到了这种情况:</p><pre class="kj kk kl km gt ma lz mb mc aw md bi"><span id="2453" class="me mf it lz b gy mg mh l mi mj">if [[ $TICKET == "[]" || "$MESSAGE" == "$TICKET"* ]]</span></pre><p id="56f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是为了防范:</p><ul class=""><li id="1014" class="ml mm it lb b lc ld lf lg li mn lm mo lq mp lu mq mr ms mt bi translated">当脚本无法提取时，一个空的票号</li><li id="527f" class="ml mm it lb b lc mu lf mv li mw lm mx lq my lu mq mr ms mt bi translated">当消息已经包含一个冗余票据编号时(例如，当修改提交时)</li></ul></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><p id="a605" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。感谢您的阅读！</p></div></div>    
</body>
</html>