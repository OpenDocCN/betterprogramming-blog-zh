<html>
<head>
<title>How to Read Websites in SwiftUI — Data Scraping in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SwiftUI中阅读网站iOS中的数据抓取</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-read-website-in-swiftui-c1bb17a06bf8?source=collection_archive---------6-----------------------#2022-05-10">https://betterprogramming.pub/how-to-read-website-in-swiftui-c1bb17a06bf8?source=collection_archive---------6-----------------------#2022-05-10</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="a268" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">SwiftUI中的网页抓取变得简单</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/e65e5a0bd297c8d447d58977a4564816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AFh_LkO2XDxGak2sLIrE1A.jpeg"/></div></div></figure><p id="4785" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我们生活在一个普遍使用API的世纪。作为移动开发者，我们习惯于对JSON数据进行编码和解码，以便通过服务器运行我们的应用程序。可悲的是，并不是所有的网站/服务都提供API。有时候，你需要阅读网站来得到你想要的。我们称之为数据搜集。它包括在过滤CSS选择器的帮助下获取页面上的数据。我们如何在SwiftUI应用程序中获取数据？</p></div><div class="ab cl lo lp hv lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ik il im in io"><h1 id="762f" class="lv lw ir bd lx ly lz ma mb mc md me mf jx mg jy mh ka mi kb mj kd mk ke ml mm bi translated">图书馆</h1><p id="6b5f" class="pw-post-body-paragraph ks kt ir ku b kv mn js kx ky mo jv la lb mp ld le lf mq lh li lj mr ll lm ln ik bi translated">为此，我们需要一个能够正确解析和读取HTML主体的工具。我选择了<a class="ae ms" href="https://github.com/scinfu/SwiftSoup" rel="noopener ugc nofollow" target="_blank"> SwiftSoup </a>，一个100% Swift的库，来做这个。您可以将它添加为CocoaPods pod或Swift包，因为这是我的优先选择。</p><h1 id="8f54" class="lv lw ir bd lx ly mt ma mb mc mu me mf jx mv jy mh ka mw kb mj kd mx ke ml mm bi translated">项目</h1><p id="d2e8" class="pw-post-body-paragraph ks kt ir ku b kv mn js kx ky mo jv la lb mp ld le lf mq lh li lj mr ll lm ln ik bi translated">至于今天的例子，我想创建一个简单的博客阅读器应用程序来解析<a class="ae ms" href="https://www.swiftbysundell.com" rel="noopener ugc nofollow" target="_blank"> swiftbysundell.com的</a>文章。让我们通过右键单击并查看其代码来研究它的HTML方案。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="2812" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我们关心的是，所有的文章都是在<code class="fe na nb nc nd b">&lt;ul class=”item-list&gt;</code>里面总结的，它们都有<code class="fe na nb nc nd b">&lt;article&gt;</code>的主体。在一篇文章中，我们有一个<code class="fe na nb nc nd b">&lt;H1&gt;</code>作为标题，一个<code class="fe na nb nc nd b">&lt;span class=”date”&gt;</code>中的日期和一个带有<code class="fe na nb nc nd b">&lt;a href=””&gt;</code>的文章的URL。我们需要丢弃这些数据来创建我们的文章模型。</p><h1 id="44ca" class="lv lw ir bd lx ly mt ma mb mc mu me mf jx mv jy mh ka mw kb mj kd mx ke ml mm bi translated">构建应用程序</h1><p id="e252" class="pw-post-body-paragraph ks kt ir ku b kv mn js kx ky mo jv la lb mp ld le lf mq lh li lj mr ll lm ln ik bi translated">首先，我创建了一个简单的结构来保存我们的数据。我将使它可识别和可散列，以正确地与SwiftUI的List &amp; ForEach视图一起工作。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="my mz l"/></div></figure><h1 id="951b" class="lv lw ir bd lx ly mt ma mb mc mu me mf jx mv jy mh ka mw kb mj kd mx ke ml mm bi translated">创建视图</h1><p id="a496" class="pw-post-body-paragraph ks kt ir ku b kv mn js kx ky mo jv la lb mp ld le lf mq lh li lj mr ll lm ln ik bi translated">接下来，我将创建视图。为此，我将创建一个可搜索列表，当我点按单元格时，它会在Safari中导航到文章页面。</p><p id="1e54" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">首先，我创建一个结果数组，根据搜索条件保存我们的文章。搜索不仅会查找文章的标题，还会查找它的日期。</p><p id="93b2" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">之后，我将创建一个显示页眉和页脚的节结构。今天的帖子和以前的帖子将有两种结构。</p><p id="32de" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">接下来，我将创建一个简单的获取函数，从我们的<code class="fe na nb nc nd b">dataModel</code>中获取数据。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="9fd0" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated"><code class="fe na nb nc nd b">ArticleCell</code>是一个简单的子视图，我将在其中显示数据。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="3f30" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我还写了一些日期扩展，帮助我从旧帖子中过滤今天的帖子，并按照我想要的方式格式化日期。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="my mz l"/></div></figure><h1 id="ddfa" class="lv lw ir bd lx ly mt ma mb mc mu me mf jx mv jy mh ka mw kb mj kd mx ke ml mm bi translated">编写数据服务</h1><p id="0d84" class="pw-post-body-paragraph ks kt ir ku b kv mn js kx ky mo jv la lb mp ld le lf mq lh li lj mr ll lm ln ik bi translated">现在我们需要实现我们的数据服务。我将创建一个带有名为<code class="fe na nb nc nd b">articleList</code>的<code class="fe na nb nc nd b">Published</code>变量的<code class="fe na nb nc nd b">ObservableObject</code>和一个我将使用的<code class="fe na nb nc nd b">baseURL</code>。</p><p id="0bd3" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我将编写一个<code class="fe na nb nc nd b">fetchArticles</code>函数</p><ul class=""><li id="ce7e" class="ne nf ir ku b kv kw ky kz lb ng lf nh lj ni ln nj nk nl nm bi translated">擦除数组。它被填满了，</li><li id="fb93" class="ne nf ir ku b kv nn ky no lb np lf nq lj nr ln nj nk nl nm bi translated">以字符串形式获取整个网站，</li><li id="b9e9" class="ne nf ir ku b kv nn ky no lb np lf nq lj nr ln nj nk nl nm bi translated">并在Swiftsoup的帮助下将字符串解析为HTML。</li></ul><p id="4f8a" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我们将使用do catch块执行第二步和第三步，因为这些操作可能会引发错误。</p><pre class="kh ki kj kk gu ns nd nt nu aw nv bi"><span id="c933" class="nw lw ir nd b gz nx ny l nz oa">let articles = try document.getElementsByClass(“item-list”).select(“article”)</span></pre><p id="5d75" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这将引导我们进入网站的文章阵列。注意会有一个数组用<code class="fe na nb nc nd b">document.getElementsByClass</code> <strong class="ku is"> </strong>调用，所以我们会做一个for循环来分别对待每一个数据。</p><pre class="kh ki kj kk gu ns nd nt nu aw nv bi"><span id="cda7" class="nw lw ir nd b gz nx ny l nz oa">let title = try article.select(“a”).first()?.text(trimAndNormaliseWhitespace: true) ?? “”</span></pre><p id="7432" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这将选择标签并获取其中没有任何空格的文本(如果有的话)。</p><pre class="kh ki kj kk gu ns nd nt nu aw nv bi"><span id="6e3c" class="nw lw ir nd b gz nx ny l nz oa"><strong class="nd is">let</strong> url = <strong class="nd is">try </strong>baseURL.appendingPathComponent(article.select(“a”).attr(“href”))</span></pre><p id="9c6b" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这将得到我们需要的URL。</p><pre class="kh ki kj kk gu ns nd nt nu aw nv bi"><span id="45f2" class="nw lw ir nd b gz nx ny l nz oa"><strong class="nd is">let</strong> dateString = <strong class="nd is">try</strong> article.select(“div”).select(“span”).text().replacingOccurrences(of: “Published on “, with: “”).replacingOccurrences(of: “Remastered on “, with: “”).replacingOccurrences(of: “Answered on “, with: “”).trimmingCharacters(in: .whitespacesAndNewlines)</span></pre><p id="d015" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这个长代码将获取字符串形式的数据。因为它可能包含一些文本，我们需要将它们去掉，并清除任何不可见的空白。</p><p id="b848" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我也将这个字符串转换成日期，因此我应用了<code class="fe na nb nc nd b">DateFormatter</code>。</p><pre class="kh ki kj kk gu ns nd nt nu aw nv bi"><span id="ab14" class="nw lw ir nd b gz nx ny l nz oa"><strong class="nd is">let</strong> formatter = DateFormatter(dateFormat: “dd MMM yyyy”)</span><span id="2bda" class="nw lw ir nd b gz ob ny l nz oa"><strong class="nd is">let</strong> date = Calendar.current.startOfDay(for: formatter.date(from: dateString) ?? Date.now)</span></pre><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="1556" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">最后，我将创建我的数据并将其添加到模型中。</p><pre class="kh ki kj kk gu ns nd nt nu aw nv bi"><span id="326d" class="nw lw ir nd b gz nx ny l nz oa"><strong class="nd is">let</strong> post = Article(title: title, url: url, publishDate: date)</span><span id="4322" class="nw lw ir nd b gz ob ny l nz oa"><strong class="nd is">self</strong>.articleList.append(post)</span></pre><p id="fd40" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">服务类将如下所示。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="my mz l"/></div></figure><p id="70a1" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">就是这样。我们的应用程序运行良好。可以查看整个项目的<a class="ae ms" href="https://github.com/egrimo/WebDataScraper" rel="noopener ugc nofollow" target="_blank">回购</a>。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj oc"><img src="../Images/16af486ac3e91880e9bb8f8be50a0713.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYIw3UDAx82kOEl-3--HpQ.png"/></div></div><p class="od oe gk gi gj of og bd b be z dk translated">结果呢</p></figure></div><div class="ab cl lo lp hv lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ik il im in io"><p id="e9a8" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">今天，您将学习如何废弃数据来创建数据源。您可以使用这种技术从网站获取数据或创建您的博客应用程序。有什么问题吗？欢迎在下面的评论区提问。祝你有愉快的一天。</p></div></div>    
</body>
</html>