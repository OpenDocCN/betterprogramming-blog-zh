<html>
<head>
<title>Take an ARView Snapshot in RealityKit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在RealityKit中拍摄视图快照</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/take-an-arview-snapshot-in-realitykit-93b620cf99b3?source=collection_archive---------7-----------------------#2022-01-16">https://betterprogramming.pub/take-an-arview-snapshot-in-realitykit-93b620cf99b3?source=collection_archive---------7-----------------------#2022-01-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f17e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建增强现实iOS应用</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a9bd3803a048a0baedf5f667fbf18aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rj_g2FME2dbSpNfH"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">帕特里克·施耐德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a377" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我学习使用Reality Kit时，我很高兴地发现Xcode为您提供了一个不错的增强现实模板，其中包含一个“盒子”，您可以使用您的设备将其放置在一个平面上。轻松又爽！一旦我开始玩它，我脑海中出现的第一个问题是“如何给这个盒子拍照(不截屏)？”。</p><p id="cc4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">缺少文档，周围也没有很多教程。在这里，我分享一个我发现的简单解决方案，使用Xcode中提供的这个开箱即用的“盒子”(双关语)。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="47a5" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建您的项目</h1><p id="211a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在Xcode上，新建一个增强现实项目:<strong class="ky ir">文件&gt;新建&gt;项目</strong>。选择<strong class="ky ir"> iOS &gt;增强现实。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/bdabf752567361d8183696793c928ede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LKmqKMG5PWFKNI2h6MeTeg.png"/></div></div></figure><p id="52c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击<strong class="ky ir">下一步</strong>继续。将产品名称设置成自己喜欢的东西，比如<code class="fe mx my mz na b">SnapshotExample</code> <strong class="ky ir">。</strong>保留默认选项，选择<strong class="ky ir">下一步。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/37742c67aa0d4179dcc4c98d520147e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8i2TPwdLIJ_llWeTl5--Yw.png"/></div></div></figure><p id="ac7a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将项目保存在通常的开发文件夹中。在这个阶段，如果你在你的iOS设备上运行你的项目，你已经可以把盒子放到AR世界中了。建造它并试一试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/0254cbd6869e0e5a830cda8b5283b5f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWhOJy4SnVkDUMxmcV_68Q.jpeg"/></div></div></figure><p id="25b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在将修改这个基本模板，添加一个快门按钮，并拍摄一张AR视图的照片。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="32e8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">构建用户界面</h1><p id="b250" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">首先，我们将按下给我们拍照的按钮。在<code class="fe mx my mz na b">ContentView</code>中找到下面一行:</p><pre class="kg kh ki kj gt nd na ne nf aw ng bi"><span id="f8d4" class="nh ma iq na b gy ni nj l nk nl"><strong class="na ir">return</strong> ARViewContainer().edgesIgnoringSafeArea(.all)</span></pre><p id="a0f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将此行替换为以下内容:</p><pre class="kg kh ki kj gt nd na ne nf aw ng bi"><span id="c2d1" class="nh ma iq na b gy ni nj l nk nl">ZStack(alignment: .bottom){<br/>  ARViewContainer().edgesIgnoringSafeArea(.all)</span><span id="afe8" class="nh ma iq na b gy nm nj l nk nl">Button {<br/>  <br/>  // Placeholder: take a snapshot<br/>  <br/>  } label: {<br/>    Image(systemName: "camera")<br/>      .frame(width:60, height:60)<br/>      .font(.title)<br/>      .background(.white.opacity(0.75))<br/>      .cornerRadius(30)<br/>      .padding()<br/>  }<br/>}</span></pre><p id="62cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将创建一个带有适当SF符号的圆形按钮。该按钮将在稍后执行快照，记下“占位符”行，因为我们稍后将回到它。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d071" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建一个静态变量来跟踪AR视图</h1><p id="1793" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在同一个文件<code class="fe mx my mz na b">ContentView.swift</code>中，创建一个新的结构<code class="fe mx my mz na b">ARVariables</code>。这将拖住<code class="fe mx my mz na b">ARView</code>。</p><pre class="kg kh ki kj gt nd na ne nf aw ng bi"><span id="610d" class="nh ma iq na b gy ni nj l nk nl"><strong class="na ir">struct</strong> ARVariables{<br/>  <strong class="na ir">static</strong> <strong class="na ir">var</strong> arView: ARView!<br/>}</span></pre><p id="b962" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个静态变量将允许我们在代码的其他部分访问<code class="fe mx my mz na b">ARView</code>,因此能够对它拍照。</p><p id="3a22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在需要指向<code class="fe mx my mz na b">ARViewContainer</code>来使用这个变量，而不是本地创建的变量。找到<code class="fe mx my mz na b">makeUIView</code> <strong class="ky ir"> </strong>方法并替换为:</p><pre class="kg kh ki kj gt nd na ne nf aw ng bi"><span id="46ce" class="nh ma iq na b gy ni nj l nk nl"><strong class="na ir">func</strong> makeUIView(context: Context) -&gt; ARView {<br/>  ARVariables.arView = ARView(frame: .zero)</span><span id="8271" class="nh ma iq na b gy nm nj l nk nl">  // Load the "Box" scene from the "Experience" Reality File<br/>  <strong class="na ir">let</strong> boxAnchor = <strong class="na ir">try</strong>! Experience.loadBox()</span><span id="6e8e" class="nh ma iq na b gy nm nj l nk nl">  // Add the box anchor to the scene<br/>  ARVariables.arView.scene.anchors.append(boxAnchor)</span><span id="39a1" class="nh ma iq na b gy nm nj l nk nl"><strong class="na ir">  return</strong> ARVariables.arView<br/>}</span></pre><p id="a0aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在上面所做的只是告诉方法使用我们在上一步中创建的结构。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="835d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">编写函数</h1><p id="efcf" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们快到了！在先前创建的按钮中找到“占位符”动作，并将其替换为:</p><pre class="kg kh ki kj gt nd na ne nf aw ng bi"><span id="6b48" class="nh ma iq na b gy ni nj l nk nl">// (Placeholder): Take a snapshot<br/>ARVariables.arView.snapshot(saveToHDR: <strong class="na ir">false</strong>) { (image) <strong class="na ir">in<br/>  <br/>  </strong>// Compress the image<br/>  <strong class="na ir">let</strong> compressedImage = UIImage(data: (image?.pngData())!)</span><span id="7692" class="nh ma iq na b gy nm nj l nk nl">  // Save in the photo album<br/>  UIImageWriteToSavedPhotosAlbum(compressedImage!, <strong class="na ir">nil</strong>, <strong class="na ir">nil</strong>, <strong class="na ir">nil</strong>)</span><span id="b4af" class="nh ma iq na b gy nm nj l nk nl">}</span></pre><p id="eaad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个片段中，我们调用了静态变量<code class="fe mx my mz na b">arView</code>的snapshot函数，并在首先压缩图像后将其保存到我们的相册中。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1668" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">请求相册权限</h1><p id="1ca9" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">还有一步！我们需要请求相册权限，以便能够在我们的照片库中保存我们的快照。</p><p id="3dfe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择您的项目(在我们的例子中是<code class="fe mx my mz na b">SnapshotExample</code>，然后打开<strong class="ky ir">信息</strong>标签。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/c6f5ef316516e056f0e93f063cfca069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Am9loRykxkD7ndH0NbD6kg.png"/></div></div></figure><p id="8d06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在任一键上，选择“+”按钮并搜索<code class="fe mx my mz na b">Privacy- Photo Library Usage Description</code>，并将其值输入到最终用户能够理解的内容中，例如“需要在照片库中保存AR图片”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/4a1ddea7c78af7f856f59f7699126cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYoJ6yU-b01VZsfQtXZ8Aw.png"/></div></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="28bb" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">构建并运行</h1><p id="133b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们完了！建立和运行您的项目，等到框出现在屏幕上，并采取您的照片，它将被保存在您的照片库。</p><p id="43ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这有所帮助。你有意见、建议或问题吗？请在下方留言或给我发消息。</p><p id="d2b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完整的项目可以在下面的GitHub资源库中找到:</p><div class="np nq gp gr nr ns"><a href="https://github.com/serchazo/SnapshotExample" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">GitHub-serchazo/snapshot示例:对SwiftUI上的视图进行快照</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">github.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og kp ns"/></div></div></a></div></div></div>    
</body>
</html>