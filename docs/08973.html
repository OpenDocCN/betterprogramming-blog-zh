<html>
<head>
<title>A Gentle Introduction to WebAssembly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WebAssembly简介</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-gentle-introduction-to-webassembly-529b7bdc24e6?source=collection_archive---------5-----------------------#2021-07-01">https://betterprogramming.pub/a-gentle-introduction-to-webassembly-529b7bdc24e6?source=collection_archive---------5-----------------------#2021-07-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="815a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解它的历史和未来</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d0249b0c09ed7f0f49c4505f9dff5466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_M85NxC6Ngxvgp1cPGzY_Q.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">保罗·埃施-洛朗在<a class="ae ky" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="86dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近用Rust写了一个玩具项目，然后编译成<a class="ae ky" href="https://webassembly.org/" rel="noopener ugc nofollow" target="_blank"> WebAssembly </a>。令我惊讶的是，它并没有那么复杂，一切都很完美。</p><p id="9ec3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的计算密集型应用程序现在以预期的性能运行在web客户端上。这个奇妙的经历诱使我去了解更多关于WebAssembly的知识。我将在本文中分享我对WebAssembly的理解。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c6d9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">WebAssembly之前</h1><p id="a639" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">每一项新技术的引入都是为了解决一些现存的问题。发明WebAssembly是为了解决web的问题。</p><p id="8ad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，前端应用程序变得更加复杂。除了逻辑复杂，代码量大，还有一个原因是语言本身的缺陷。</p><p id="8340" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">广泛使用的解释型编程语言JavaScript的作者布伦丹·艾希(Brendan Eich)创造了它，使它的发展史变成了某种程度上的补洞史。</p><p id="d0a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JavaScript主要有两种问题。</p><h2 id="372b" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">表演</h2><p id="97ec" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">类似于其他解释编程语言，JavaScript很慢。至少在2008年之前，是非常缓慢的。随着越来越多的web应用程序采用JavaScript，web浏览器之间开始了一场性能大战。JIT(实时编译器)的引入是为了解决JavaScript的性能问题。<a class="ae ky" href="https://v8.dev/" rel="noopener ugc nofollow" target="_blank">谷歌的V8 </a>和微软的<a class="ae ky" href="https://github.com/chakra-core/ChakraCore" rel="noopener ugc nofollow" target="_blank"> ChakraCore </a>都自带JIT(甚至是多阶段JIT)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/e51c3999ed214a1243906650ae7e67c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*E38icKHE48n2XDnM.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://twitter.com/linclark" rel="noopener ugc nofollow" target="_blank">https://twitter.com/linclark</a></p></figure><p id="d8fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于其作为动态语言的设计，有几类优化可用于其他编程语言，但即使是最快和最现代的JavaScript运行时也无法使用，并且仍将如此。例如，超前(AOT)优化编译策略。</p><h2 id="e7ea" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">鲁棒性和可维护性</h2><p id="1d8e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有了JavaScript这样的动态编程语言，我们可以快速构建东西。但是当项目越来越大的时候，事情就变得一团糟了。</p><p id="da5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">静态类型使处理复杂系统变得更加容易。它有助于您在编译时更快地发现类型不匹配，并且使优化变得更容易。</p><p id="010d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，在动态类型编程语言中，如果你不小心输入，你可能会做出奇怪的事情，比如试图将数字<code class="fe nm nn no np b">1</code>和字符串<code class="fe nm nn no np b">“2”</code>相加，结果得到字符串<code class="fe nm nn no np b">“12”</code>。但是这种类型错误应该在开发阶段就被发现。简单地说，动态类型具有“先编写，后调试”的风格，而静态类型涉及“先思考，后编写”的风格。</p><p id="6462" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要向JavaScript添加静态类型，有几种方法:</p><ul class=""><li id="c7f3" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated"><a class="ae ky" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>:基于JavaScript，添加静态类型定义。</li><li id="b91f" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><a class="ae ky" href="https://reasonml.github.io/" rel="noopener ugc nofollow" target="_blank">原因</a>和<a class="ae ky" href="https://www.purescript.org/" rel="noopener ugc nofollow" target="_blank"> PureScript </a>:翻译器将其他静态类型语言(如OCaml/Haskell)编译成JavaScript。</li><li id="8fa9" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">asm.js (已弃用):定义一个严格的JavaScript子集，可以用作编译器的低级、高效的目标语言——特别是允许编译器进行提前(AOT)优化编译。我们可以使用一个源代码到源代码的编译器比如<a class="ae ky" href="https://en.wikipedia.org/wiki/Emscripten" rel="noopener ugc nofollow" target="_blank"> Emscripten </a>把静态类型语言(比如C)编译成asm.js。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3c7d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">WebAssembly简介</h1><p id="a70b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">虽然asm.js在最初的JavaScript上有性能改进，但它本质上仍然是JavaScript。在某些情况下，生成的文件会变得太大，并给需要频繁传输的代码带来瓶颈。</p><p id="d2fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于asm.js代码主要作为编译目标，我们不会手动编辑，所以有必要发明一种二进制格式。这基本上就是WebAssembly的起源:</p><blockquote class="oe of og"><p id="6da2" class="kz la oh lb b lc ld ju le lf lg jx lh oi lj lk ll oj ln lo lp ok lr ls lt lu im bi translated">“WebAssembly(缩写为Wasm)是基于堆栈的虚拟机的二进制指令格式。Wasm旨在作为编程语言的可移植编译目标，支持客户端和服务器应用程序在web上的部署。”— <a class="ae ky" href="https://webassembly.org/" rel="noopener ugc nofollow" target="_blank"> WebAssembly的网站</a></p></blockquote><p id="afe0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">WebAssembly于2015年首次发布，第一次演示是运行Unity的<a class="ae ky" href="https://beta.unity3d.com/jonas/AngryBots/" rel="noopener ugc nofollow" target="_blank">“愤怒的机器人”。</a>在<a class="ae ky" href="https://www.webassemblygames.com/" rel="noopener ugc nofollow" target="_blank"> WebAssembly Games </a>可以玩更多部署在WebAssembly上的游戏。另一个经典demo是Mozilla的<a class="ae ky" href="https://www.youtube.com/watch?v=TwuIRcpeUWE" rel="noopener ugc nofollow" target="_blank">禅园(史诗)</a>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="4e11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2019年12月5日，WebAssembly成为继HTML、CSS、JavaScript之后的官方<a class="ae ky" href="https://www.w3.org/2019/12/pressrelease-wasm-rec.html.en" rel="noopener ugc nofollow" target="_blank">“web第四语言”</a>。</p><p id="2d4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">WebAssembly是一种不同于JavaScript的语言，但它不是用来替代JavaScript的。相反，它旨在补充JavaScript并与之协同工作，允许web开发人员利用两种语言的优点。</p><p id="6ffb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过面向WebAssembly，我们可以重用嵌入在更大的JavaScript/HTML应用程序中的现有代码。这可以是从简单的助手库到面向计算的任务卸载。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/94296ce621837506017f47c742d53936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fEsjZQWjocXWBIrH.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a5b2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">试一试</h1><p id="d0d8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在WebAssembly中，有两种常用的文件格式:</p><ul class=""><li id="3ed6" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">。wat——一种基于S表达式的文本格式和中间形式，设计用于文本编辑器、浏览器开发工具等。</li><li id="6e14" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">。wasm—web assembly的虚拟机可以读取和运行的二进制格式。</li></ul><p id="8f19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两种格式可以相互转换。</p><p id="9154" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果只是试用WebAssembly，可以使用<a class="ae ky" href="https://mbebenita.github.io/WasmExplorer/" rel="noopener ugc nofollow" target="_blank"> WasmExplorer </a>输入一些C/C++代码。你可以把C/C++/Rust或者其他源代码转换成。wat格式，然后组装。wat格式到. wasm。</p><p id="83ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编译后的WAT和x86汇编格式内容显示在windows:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/f2a560f7b27d059087156b23d8606ca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Tpca83Z2-tfbWZHl.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自wasmexplorer</p></figure><p id="75a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，大多数web浏览器已经支持WebAssembly。您可以尝试打开浏览器的控制台，输入如下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/1f22d74a11741d715c6d1a8ae29874f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XUi_gbzt_CKtnPTr.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者</p></figure><p id="8617" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最好的初学者教程是<a class="ae ky" href="https://webassembly.org/getting-started/developers-guide/" rel="noopener ugc nofollow" target="_blank">官方指南</a>。你可以选择你最熟悉的编程语言，编译成WASM格式。</p><p id="4918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://wasmer.io/" rel="noopener ugc nofollow" target="_blank"> wasmtime </a>是一个独立的WebAssembly运行时，而<a class="ae ky" href="https://github.com/wasmerio/wasmer" rel="noopener ugc nofollow" target="_blank"> wasmer </a>不仅是一个运行时，还支持使用超轻量容器。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1179" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">浏览器外的web程序集</h1><p id="7bea" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">因为二进制格式的WASM可以由WASM虚拟机加载和执行，我们实际上可以将WebAssembly的使用扩展到浏览器之外。</p><p id="0b64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在任何地方经营WASM都会带来巨大的好处。我们可以重用代码，让遗留代码在不同的平台上运行。我们根本负担不起为多个平台不断重写软件的时间和金钱。</p><p id="bb5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当Java问世时，“一次编写，随处运行”是一个说明跨平台好处的口号。有了WebAssembly，有希望的未来是“用任何编程语言编写一次，在任何地方运行。”</p><p id="3faa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">WASI项目是实现这一目标的一个有希望的标准。</p><p id="77fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们能够让不同的编程语言无缝地互操作，这将是一个新的强大武器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/76dcf7b96814ced91492590de57aad61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zhlFxRD-thKZY9pv.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b9b8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">WebAssembly的未来</h1><p id="df4d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">仍有许多功能处于开发或建议阶段。</p><p id="8938" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管WebAssembly现在还没有完成，但我相信它将会影响客户端web开发、桌面应用程序、服务器端功能、传统现代化、游戏、无服务器等领域。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d1f4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><ul class=""><li id="554c" class="nq nr it lb b lc mu lf mv li or lm os lq ot lu nv nw nx ny bi translated"><a class="ae ky" href="https://webassembly.org/" rel="noopener ugc nofollow" target="_blank">网页组装主页</a></li><li id="affc" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><a class="ae ky" href="https://hacks.mozilla.org/category/code-cartoons/a-cartoon-intro-to-webassembly/" rel="noopener ugc nofollow" target="_blank">web assembly文章的卡通介绍</a></li><li id="8790" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=fh9WXPu0hw8" rel="noopener ugc nofollow" target="_blank">与一起将WebAssembly带到web之外作者林克拉克</a></li><li id="eddc" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><a class="ae ky" href="https://hacks.mozilla.org/2019/03/standardizing-wasi-a-webassembly-system-interface/" rel="noopener ugc nofollow" target="_blank"> WASI:在web之外运行WebAssembly的系统接口</a></li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="a62a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oh">原载于</em><a class="ae ky" href="https://coderscat.com/intro-webassembly/" rel="noopener ugc nofollow" target="_blank"><em class="oh">https://coderscat.com</em></a></p></div></div>    
</body>
</html>