# 使用 TDD 和 Azure 功能的快速原型开发

> 原文：<https://betterprogramming.pub/fast-prototyping-with-azure-functions-6e0e24ef2bff>

## 接受达里奥有史以来最好的生日祝福

![](img/1a9889f36f463f52d50bd28766c6be7f.png)

# 我有个主意

我有一个同事，达里奥，他给我很棒的生日祝福。

办公室里的每个人都很高兴收到来自达里奥的语音问候。他们说，“直到达里奥向你问好，这才算生日。”

那么，为什么不让世界上的每个人在生日那天都受到达里奥的问候呢？你想试试吗？

[](https://telegram.me/HappyDarioBot) [## 快乐机器人

### 大米预示着一个完整的达里奥！写下你的名字，并注意他的声音信息！！！

电报.我](https://telegram.me/HappyDarioBot) 

目前它只有意大利语版本(抱歉)。

Github 储存库在这里:

[](https://github.com/lucapiccinelli/HappyDarioBot) [## lucapiccinelli/HappyDarioBot

### 从达里奥那里得到生日快乐的祝福！快乐达里奥机器人在这里工作 https://telegram.me/HappyDarioBot 达里奥很有趣…

github.com](https://github.com/lucapiccinelli/HappyDarioBot) 

# 好的。怎么会？

我需要一种简单的方式让人们向我问好。网站？平台时代谁还用一个网站？那么站台。哪一个？脸书？推特？或者电报？通常，达里奥使用 WhatsApp 发布他的音频笔记。我想让他呆在他的舒适区，但你可能知道 WhatsApp 对 bot 开发设置了许多限制。所以，电报是选择！

# 好的。在哪里？

在哪里托管机器人？答案取决于业务需求和技术选择。在项目的这个阶段，我需要快！我不想把时间花在可能没人会用的东西上。我需要尽快知道是否有人要用它。因此，速度是重中之重。目前，我正在用 Kotlin 开发，但是由于我用 C#开发了很多年，它仍然是我最有效的语言。

我还需要存储音频文件和一些简单的非结构化信息。

用 C#写的东西，访问简单的存储，有什么更快的方法？答案是无服务器托管。对于 C#，Azure 函数。

# 质量

我说快，那不代表我接受低质量的代码。在幸运的情况下，有人会使用它，我想让它增长，而不是重写一切。

如何快速并保持可接受的代码质量水平？测试驱动开发是答案。总而言之，习惯它需要一些时间和练习，但是一旦你投入其中，这是在现实世界中开发和运输东西的最快方式。

实际上，提高速度不仅仅是关于 TDD。这是一套黄金组合的技术:

*   TDD →保存您的商业价值
*   渐进式方法→只做你已经知道的有价值的事情
*   简单设计→保持简单和模块化

那些是相关的。TDD 支持增量方法。增量方法改进简单设计。

# 如何用 Azure 函数进行 TDD

TDD 一点也不平凡。最难回答的问题之一是“考什么？”

HappyDarioBot Azure 函数正在通过 Telegram webhook 接收电报更新。然后，它处理更新并发回一条电报消息。这个回答消息依赖于一些业务逻辑。

似乎我既没有输入也没有输出。

那要考什么呢？我是否应该通过 HTTP 向 bot 发送请求，然后使用一些 Telegram API 来确保消息已经被实际接收到？需要多长时间？这个测试代码会有多复杂？

我们不是 QA。我们是开发商。我们的重点不是为测试而测试，而是为开发而测试。

让我们开始切掉一些东西。因为我使用的是无服务器架构，所以我可以非常确定这个基础架构能够正常工作。所以，我不需要通过 HTTP 执行一个真正的 post 来确保我的函数会像预期的那样被触发。我可以直接通过 Azure 函数的类来调用它。这省去了我发现应该如何在本地调用 Azure 函数来通过 HTTP 应答的努力。

我不拥有输入格式，因为它是通过 webhook 从 Telegram 来的。我如何获得一些输入来测试？

请看下面代码的第 6 行:

这是机器人的第一个版本。

在第 6 行，我记录了 HTTP 请求。我将它部署在 Azure 上，注册了 webhook，并通过 Telegram 向机器人发送了一条消息。然后我去了 Azure portal 的日志监控。在那里，我有我的输入样本。我复制并粘贴到测试中，它就完成了。对您期望的每种输入类型重复这个过程(对一些意外的表单也是如此)。

## 产量呢？

这里也要简化。通常，在测试第三方 API 时，您无法检查您的调用在他们的系统上触发的状态变化。你依赖的事实是，如果 API 回答 OK，那么就 OK。

这里也一样。在这个级别的测试中，我对*工作*的定义是函数回答 OK。仅此而已。

商业逻辑呢？我怎么知道它实际上在做我期望的事情？通过单元测试。

发现业务逻辑将被转移到一个合作者是很容易的。业务逻辑不能依赖于任何基础设施。这样，就很容易用单元测试来测试它。

# 结论

我没有记录开发 HappyDarioBot 花了多长时间。然而，我估计总共需要 25 到 30 个小时。一些注意事项:

*   我以前从未在 Azure 上开发过任何东西。
*   我以前从未开发过电报机器人。
*   我每天花一小时完成大部分工作。这和 8 小时专注是不一样的。

总而言之，我想说的是，作为无服务器架构的第一次测试，我对结果很满意。你必须学会如何使用平台的工具，但是作为一名开发人员，你可以 100%专注于开发。

如果你想尽快用你的产品的可用原型/alpha 版本达到你的目标，去无服务器是我建议考虑的一个选择。如果你是一个 C#开发者，那么在 Azure 上你会有宾至如归的感觉。