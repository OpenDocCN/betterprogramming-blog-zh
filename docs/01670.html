<html>
<head>
<title>MongoDB Performance 101: How To Improve the Speed of MongoDB App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MongoDB性能101:如何提高MongoDB App的速度</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/mongodb-performance-101-how-to-improve-the-speed-of-mongodb-app-a59f2390ee5?source=collection_archive---------4-----------------------#2019-10-03">https://betterprogramming.pub/mongodb-performance-101-how-to-improve-the-speed-of-mongodb-app-a59f2390ee5?source=collection_archive---------4-----------------------#2019-10-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5801" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用现实生活中的用例编制索引</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6f4198a7bd199e5ee94940a25caed211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EGScnU3ujPUPwnTI"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯蒂安·威迪格在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="296f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章的灵感来自于我跟随MongoDB大学的MongoDB性能课程。这个课程给了我很多启发，让我知道在实际的生产项目中我可以在哪些地方改进以及如何优化查询。</p><p id="9430" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将分享一个简单、常见但实用的用例来提高MongoDB的性能。</p><p id="ca18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在开始之前，我将在本文中使用一些工具:</p><ul class=""><li id="ed3e" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>(当然。我们正在讨论MongoDB性能优化)</li><li id="a870" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">MongoDB <a class="ae ky" href="https://www.mongodb.com/products/compass" rel="noopener ugc nofollow" target="_blank">指南针</a>(MongoDB的GUI)</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="4013" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">用例:亚航AVA聊天机器人</h1><p id="4ea6" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在开始之前，我想发表一些免责声明:</p><ul class=""><li id="9af5" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我不在亚航工作。</li><li id="c3cd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我在这里建议和写的只是我个人的观点和解释，这意味着我可能是错的。</li></ul><h2 id="9c04" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">介绍</h2><p id="cff6" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">故事开始于我通过亚航预订了一张11月份去韩国的机票。然而，由于个人原因，我不得不取消航班，取消必须通过<a class="ae ky" href="https://newsroom.airasia.com/news/airasia-unveils-ai-chatbot-with-website-and-mobile-app-facelift" rel="noopener ugc nofollow" target="_blank"> AVA聊天机器人</a>进行。</p><p id="40f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了执行退款，它要求用户以连续的方式提供某些信息:</p><ol class=""><li id="1ea1" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nz mb mc md bi translated">订票号码(航班订票号码)</li><li id="8071" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">姓氏/姓氏</li><li id="b84f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">教名</li><li id="aa54" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">出生日期</li><li id="f549" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">电子邮件地址</li></ol><p id="1f6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面我也提供了一个截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/3481e1d53e99b3c0f3c4aaf8f82a164a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SH_3KongGPa0oFwklENDWQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">AVA聊天机器人韩国退款流程</p></figure><p id="ddda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们了解了退款流程及其所需的信息。让我们设计和模拟数据库。</p><h2 id="7bfa" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">数据准备</h2><p id="9d3b" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这一节解释了我如何准备数据库模型并将虚拟数据加载到我们的集合中，以便在后面的阶段进行性能优化。如果您来自SQL后台，那么表也可以识别集合。</p><p id="fae4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我需要什么？</p><ol class=""><li id="6ecf" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nz mb mc md bi translated">我需要包含航班预订信息的记录列表。预订信息包括预订号、名字、姓氏、出生日期和电子邮件。<strong class="lb iu"> </strong>这是我们集合中的必填字段。我还将创建另外两个字段，分别是origin和destination，<strong class="lb iu"> </strong>，只是为了使其更接近真实的生产数据。</li><li id="9702" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">我还需要一个数据生成工具来生成一个百万文档数据集到我们的集合中，因为这允许我们发现更重要的发现，特别是在查询时间。在谷歌搜索了一番后，我在GitHub上发现了一个工具，<a class="ae ky" href="https://github.com/feliixx/mgodatagen" rel="noopener ugc nofollow" target="_blank"> mgodatagen </a>，它允许我用最少的配置在MongoDB中生成随机数据。</li></ol><p id="7bd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事不宜迟，让我们进入下一步。</p><p id="f055" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第一步。从数据生成库</strong> <a class="ae ky" href="https://github.com/feliixx/mgodatagen/releases" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">下载工具发布</strong> </a> <strong class="lb iu">页面</strong></p><p id="0389" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请根据您的工作站操作系统下载该库。解压缩后，您将看到mgodatagen可执行文件。下面提供了一个截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/026f4c4bf83f97905c07bfbb4d78bf64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eo7WTXljjNE1o5hulWEjkw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">提取后的mgodatagen截图</p></figure><p id="f89c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第二步。创建一个config.json </strong></p><p id="be08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据数据生成库，我们必须指定一些强制配置，例如，数据库的名称、集合名称、想要生成多少个文档等。</p><p id="31c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我在同一级目录下创建的<code class="fe oc od oe of b">config.json</code> <strong class="lb iu"> <em class="og"> </em> </strong>的要旨。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="70be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要点基本上告诉我们:</p><ul class=""><li id="9bf1" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我们生成数据的地方——航班数据库和预订收集。如果这个数据库和集合还没有创建，不要担心，因为MongoDB会在数据插入之前为您创建它。</li><li id="7dc0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们生成了多少数据——我们在count <em class="og"> </em>键中定义了一百万。</li><li id="2c75" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们正在生成的文档和字段是什么。我们在内容密钥中定义了这一点。我们添加了我们需要的键以及它们各自的类型。例如，booking_no是一个最小和最大6个字符的字符串。</li></ul><p id="d81e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经准备好了所有的配置，让我们执行数据生成。对于数据生成，我们只需运行以下命令。</p><pre class="kj kk kl km gt oj of ok ol aw om bi"><span id="0c4b" class="nn mr it of b gy on oo l op oq">./mgodatagen -f config.json</span></pre><p id="94f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它使用了我们之前定义的<code class="fe oc od oe of b">config.json</code>并生成了数据。下面是生成数据的过程和成功生成数据的结果截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/9a340fc45d24fa189e0b47fd29d7ae50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ajogAhwmTVqMUeWAyp8IrQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生成一百万个文档</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/a3a82e2d40f109c9a7f3933717447418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4b2wnEcQIDZ3bh8esk9iw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">成功地在预订集合中生成了一百万个文档</p></figure><p id="d86f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤三。验证数据生成</strong></p><p id="91f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们通过Compass验证数据库和集合是在您的本地MongoDB中生成的。参考下面的截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/4011aaca40455676ba4b2c2bac5d6de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VUmbGXQBxPyEglK953g8Vg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">航班数据库，预订集合包含100万个文档</p></figure><h2 id="051d" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">问题标识</h2><p id="f5d4" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这一节描述了我们遇到了什么样的性能问题。在优化性能之前，我们必须知道我们遇到了什么样的性能问题。</p><p id="a766" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们尝试以下场景:</p><ul class=""><li id="9f69" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">使用booking_no查询航班预订</li><li id="3b07" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用姓氏查询航班预订</li><li id="3b7d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">使用名字查询航班预订</li></ul><p id="75a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看他们有什么共同点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/ba6b91d559c9d369b26f2afda395d638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzcplOWKmdaYBlNezOPxbQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">查询性能摘要的屏幕截图</p></figure><p id="70df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于MongoDB的性能，我们需要考虑三个关键因素。</p><ol class=""><li id="8ac4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nz mb mc md bi translated">返回的文档与检查的文档之间的比率。为了找到这个订单，我们必须扫描一百万个文档，这是一个非常糟糕的比例。</li><li id="0b98" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">实际的查询执行时间。为了找到这个预订，花了899毫秒，已经接近1秒了。这被认为是一个非常糟糕的结果。</li><li id="5d59" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">MongoDB用于文档查询的方法。默认情况下，MongoDB使用集合扫描，我们可以通过实现索引扫描来优化它，这将在后面的小节中讨论。</li></ol><h2 id="3a13" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">解决方案实施</h2><p id="fc49" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">本节描述了我们如何通过使用索引来提高查询性能。</p><p id="d06b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有一个标准操作流程(SOP ),那么优化你的数据库查询就非常容易。如果您的用例看起来也是这样，那么您可能会实现与我们在这里所做的相同的解决方案。</p><p id="17c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们知道亚航在退款流程中始终遵循以下SOP。他们会按顺序询问信息，即:</p><ul class=""><li id="8125" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">订房号</li><li id="e51b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">姓</li><li id="eabf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">西方人名的第一个字</li></ul><p id="c7d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第一步:为预约号</strong>创建索引</p><p id="200c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们为booking_no字段创建一个索引。如果你的索引只涉及单个字段，我们称之为<a class="ae ky" href="https://docs.mongodb.com/manual/core/index-single/" rel="noopener ugc nofollow" target="_blank">单字段索引</a>。使用MongoDB Compass创建索引很容易。你可以按照下面截图中的步骤指南进行操作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/248843804e780dc28b739ec5ced932c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V66ZMmER8uRUi0zpt4u90w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">单击“索引”选项卡上的“创建索引”按钮。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/8bf151e13f70a326489589b3ce9b89ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kzzkJXnQJchKSb1sCa3hLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建预订_无索引</p></figure><p id="c6a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">写下您的索引名称，并配置哪个字段是索引定义。在这种情况下，我们将booking_no <em class="og">配置为索引字段。我们先按升序排列。</em></p><p id="14cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您准备好看看在这个简单的配置之后查询性能提高了多少了吗？(地狱耶！)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/bb63518f19088c2cf4a92038dd2ca99e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-nvvG5mtLkkinXOFf36oQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">实施booking_no索引后查询结果截图</p></figure><p id="3745" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需在索引中进行简单的配置，查询性能就有了巨大的提高。</p><ol class=""><li id="1f35" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nz mb mc md bi translated">我们只检查一个文档并返回一个文档。这个比率(返回的文档除以检查的文档)为1是完美的。</li><li id="2f0f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">平均查询执行时间减少了近50倍。现在只有18毫秒，而以前是899毫秒。</li><li id="c49b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">我们正在使用一种更好的方法，这是一种索引扫描，而不是整个集合扫描。这导致了更好的性能。</li></ol><p id="8ec6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">步骤2:使用姓氏和名字创建一个复合索引</strong></p><p id="ca3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我们尝试使用booking_no <em class="og">进行查询，我们已经提高了查询性能。但是假设客服告诉你，我们的大部分客户都不记得他们的订房号了。他们建议用客户的名字来代替。</em></p><p id="8d29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您现在尝试使用姓氏字段进行查询，您将会看到下面的屏幕截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/6028f0831fc5498d59d744db19dba799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eWRPNMZ7SlC0OF7o5NGPvg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用姓氏屏幕截图进行查询</p></figure><p id="1558" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在这里面临着什么样的问题？</p><ul class=""><li id="c220" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">在创建任何索引之前，我们面临着与以前完全相同的性能问题，使用集合扫描方法会花费很长的查询执行时间。</li><li id="2c42" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们面临的另一个问题是，用户名分为两个字段，名和姓。尝试只使用姓氏进行查询会返回太多不相关的记录。这就是我们必须创建一个复合指数的地方。</li></ul><p id="60af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们尝试创建一个复合指数来解决我们面临的问题。</p><p id="57a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建复合索引就像创建单字段索引一样简单。你所要做的只是在MongoDB compass中添加另一个字段。你可以跟着下面的截图走。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/ffeda5312f2425f812d3720ff33496cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwJS4YKaPfHcBjytE1H7KA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">点击“添加另一个字段”添加名字。</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/a91f0abadb81d45aa9d51796ace5806f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i-7kexo5rzXJa0G84unZhQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">复合索引已成功创建</p></figure><p id="c802" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们已经为这个名字创建了复合索引。让我们验证一下查询性能。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/35d2a776b3e38460b86f12e323772a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wdgUQ11TVA9QIpK2XSQgMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">仅使用姓氏的查询(优化)</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/079899c158b42d0bfc7b13d8f3403416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MHQAR-yQKyw9jcjunV1Bug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用姓氏和名字进行查询(优化)</p></figure><p id="8710" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上面的第二个屏幕截图所示，通过在查询中同时使用姓氏和名字，我们能够将查询性能优化到接近0毫秒。</p><p id="bc39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当查询涉及以下内容时，我们优化了案例:</p><ul class=""><li id="b606" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">仅姓氏</li><li id="bb6a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">姓氏和名字</li></ul><p id="276c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，有一件额外的事情需要小心。如果只使用名字进行查询，性能不会得到优化。参考下面的截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/91200107807cb49a1b884b91823c4080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MG88dZ5QBx6HwepedY14PQ.png"/></div></div></figure><p id="ee2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为复合索引在创建索引时会考虑字段的顺序。当我们创建这个索引时，我们把姓放在名的前面。</p><p id="266f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果您想要利用刚刚创建的复合索引，那么总是需要首先指定姓氏。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="86b1" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="3c90" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">本文的关键要点是，如果您了解自己的业务流程，数据库性能可以很容易地得到提高。具体来说，在MongoDB中，我们可以使用以下方法来提高查询性能:</p><ul class=""><li id="bac4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">单字段索引</li><li id="700f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">复合字段索引</li></ul><p id="3a63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在MongoDB中还有很多不同类型的索引可以探索，但目前就这些了。</p><p id="eb7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">优化愉快，感谢阅读。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="98b7" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">参考</h1><ul class=""><li id="028f" class="lv lw it lb b lc ni lf nj li ox lm oy lq oz lu ma mb mc md bi translated">MongoDB大学<a class="ae ky" href="https://university.mongodb.com/courses/M201/about" rel="noopener ugc nofollow" target="_blank"> M201表演课程</a></li><li id="85a4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">MongoDB <a class="ae ky" href="https://docs.mongodb.com/manual/indexes/" rel="noopener ugc nofollow" target="_blank">索引文档</a></li><li id="6a3f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.airasia.com/en/gb" rel="noopener ugc nofollow" target="_blank">亚航AVA聊天机器人</a></li></ul></div></div>    
</body>
</html>