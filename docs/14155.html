<html>
<head>
<title>How to Solve Web Application Issues Using C</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用C解决Web应用程序问题</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/solving-web-application-issues-in-c-the-greenest-programming-language-be395851a9f1?source=collection_archive---------7-----------------------#2022-11-11">https://betterprogramming.pub/solving-web-application-issues-in-c-the-greenest-programming-language-be395851a9f1?source=collection_archive---------7-----------------------#2022-11-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1e98" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">利用最环保的编程语言的力量</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ebc3b86e185ad55d7770037e1d83c5f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SKT_Zd-qZ0Rg__sA.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">封面图片版权2022 Sergio Mijatovic(作者)</p></figure><p id="3b6d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尽管世界上大量的web基础设施都是用C语言编写的，但大多数人并不认为C语言可以编写web应用程序。这是可以理解的，因为C缺乏易于使用的web和数据库结构，不能直接连接到web服务器，还有安全问题，等等。</p><p id="1cdd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，c是<a class="ae lr" href="https://medium.com/codex/what-are-the-greenest-programming-languages-e738774b1957?ref=hackernoon.com" rel="noopener">世界上最绿色的编程语言</a>，如果我们想<a class="ae lr" href="https://medium.com/@velydev/writing-green-software-is-our-code-unfriendly-to-environment-3cd1b4249cf5" rel="noopener">帮助环境</a>，这是很重要的。如果你想要最好的性能，使用C语言当然没有坏处。</p><p id="3883" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文将展示如何利用C的强大功能并解决上述问题。</p><h1 id="1d8f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是vly？</h1><p id="6e7f" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">vly是一个面向C开发人员的通用框架。使用vly创建的应用程序是本地的，没有解释器或字节码方案。更多信息见<code class="fe mp mq mr ms b">vely.dev</code>。</p><h1 id="0925" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">我们将构建的应用程序</h1><p id="3e82" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">您将编写一个维护员工列表的人力资源(HR) web应用程序。它很简单，没有太多花哨的东西，但足以让您开始使用。你也不希望一个旨在学习的教程充斥着各种你可以轻松添加的东西。这里的目的是学习基础知识。</p><p id="564e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，有三个部分。首先是增加员工。第二个是显示雇员名单。第三个是能够从列表中删除员工。</p><p id="2fda" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">开始之前:</p><ol class=""><li id="5e9e" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">安装vly。你可以使用像apt，dnf，zypper或者pacman这样的标准打包程序。前往<a class="ae lr" href="https://vely.dev/pkg/" rel="noopener ugc nofollow" target="_blank">https://vely.dev/pkg/</a>安装vly。您总是可以用同一个打包程序将其删除，</li><li id="3118" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">为您的项目创建一个目录，您可以随意命名。这里所做的一切都应该在那个目录中完成，</li><li id="5428" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">确保您已经安装了MariaDB和Nginx，因为这里使用了它们。</li></ol><h1 id="1e51" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">应用程序截图</h1><p id="7f6c" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">以下是应用程序的快照。这是最终的结果。</p><p id="782c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">添加员工的Web表单:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/87c9bd0e4f6e21b2b4dd46840432e22d.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*CNZp5tsurOvNCMI7.png"/></div></figure><p id="c107" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">添加员工的结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/4ef088e12970e9d4bc521e7672612c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/0*2EwKngmFjoH4dNw6.png"/></div></figure><p id="c51a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">列出员工:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/227c9c7bc55c8f36e354e3027b27a8ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/0*RmOqwgd_RPr3u9VQ.png"/></div></figure><p id="6c3d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你也可以删除一个员工，之后它将不再出现在列表中。</p><h1 id="bb79" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">它是如何工作的</h1><p id="2598" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在本文中，您将为应用程序创建源代码文件。这些文件的扩展名为<code class="fe mp mq mr ms b">.vely</code>。</p><p id="b553" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些文件中的源代码是C语言，其中包含Vely语句。每条语句都会生成一定的C代码，所以最终结果总是C，这就是Vely的工作方式。</p><p id="7ad9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">构成框架的一部分是请求处理——一个简单的调度程序为全面的标准HTTP请求处理提供了基础。还有一个自动内存垃圾收集器，这对于长时间运行的进程(如web应用程序守护进程)很有用。</p><p id="b1fb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">底线是，vly代码将把自己变成纯C语言，然后编译成本地应用程序。</p><h1 id="f5a0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">SQL使用简介</h1><p id="c9f1" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">首先，我将谈谈数据库的使用，因为它是数据库驱动的web应用程序的基础。</p><p id="9652" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">vly目前支持MariaDB/MySQL、PostgreSQL和SQLite数据库。它们的界面都是一样的。例如，要查询employee表并显示找到的姓名列表，下面是vly代码:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="cfdd" class="no lt iq ms b be np nq l nr ns">run-query @db = \<br/>    "select firstName, lastName from employee where employeeID='%s'" \<br/>    output firstName, lastName \<br/>    : empid<br/><br/>    @Employee is &lt;&lt;query-result  firstName&gt;&gt; &lt;&lt;query-result  lastName&gt;&gt;<br/>end-query</span></pre><p id="4b02" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在编写vly代码时，需要记住以下几点:</p><ul class=""><li id="2710" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq nt mz na nb bi translated"><strong class="kx ir">行延续— </strong>注意反斜杠(<code class="fe mp mq mr ms b">\</code>)的用法，它和C中一样，表示行延续。所以前3行代码是一条语句。</li><li id="b194" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq nt mz na nb bi translated"><strong class="kx ir">输出数据— </strong>要向web客户端(如浏览器)或标准输出显示数据，使用output语句，即行首的<code class="fe mp mq mr ms b">@</code>。</li><li id="021d" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq nt mz na nb bi translated"><strong class="kx ir">数据库配置— </strong>数据库用<code class="fe mp mq mr ms b">@</code>子句指定，这里是<code class="fe mp mq mr ms b">@db</code>。这是保存本机数据库连接信息的文件。每个数据库都有自己的；在这种情况下，您使用的是MariaDB(或MySQL)，因此文件<code class="fe mp mq mr ms b">db</code>可能包含以下内容:</li></ul><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="06b3" class="no lt iq ms b be np nq l nr ns">[client]  <br/>user=user_name <br/>password=password     <br/>database=database_name     <br/>socket=/run/mysqld/mysqld.sock</span></pre><p id="ecdd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以阅读更多关于为MariaDB/MySQL编写连接字符串信息的<a class="ae lr" href="https://mariadb.com/kb/en/configuring-mariadb-connectorc-with-option-files/?ref=hackernoon.com#options" rel="noopener ugc nofollow" target="_blank">细节</a>。Vely使用本地数据库连接来提高性能，连接细节也是本地的。这涵盖了你在C语言中使用vly查询数据库所需的大部分内容。</p><ul class=""><li id="5018" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq nt mz na nb bi translated"><strong class="kx ir">数据库查询— </strong>要运行查询，使用<code class="fe mp mq mr ms b">run-query</code>语句。通常，它陈述所使用的数据库(使用<code class="fe mp mq mr ms b">@</code>子句)、查询本身以及输出列的列表(使用<code class="fe mp mq mr ms b">output</code>子句)。您在<code class="fe mp mq mr ms b">:</code>子句后为SQL语句提供输入参数。</li><li id="c35a" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq nt mz na nb bi translated"><strong class="kx ir">查询结果— </strong>要显示查询结果集中的列数据，使用<code class="fe mp mq mr ms b">query-result</code>语句。当在输出中使用时，就像这里的情况一样，您可以将它放在<code class="fe mp mq mr ms b">&lt;&lt;</code>和<code class="fe mp mq mr ms b">&gt;&gt;</code>中——这是内联代码。</li><li id="40f4" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq nt mz na nb bi translated"><strong class="kx ir">查询循环— </strong>如果您想要循环查询的结果集，请使用<code class="fe mp mq mr ms b">end-query</code>语句标记该循环的结束，如上所示。</li></ul><h1 id="05d8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">步骤1:入门—数据库</h1><p id="4ce8" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">首先，您将创建这里使用的数据库和雇员表。这个例子中的SQL很简单，所以您可以使用任何您想要的数据库供应商。不过这里使用的是MariaDB。创建employee表的SQL如下。将此保存到<code class="fe mp mq mr ms b">setup.sql</code>文件:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="4c09" class="no lt iq ms b be np nq l nr ns">create table if not exists employee (<br/>    firstName varchar(50),<br/>    lastName varchar(50),<br/>    employeeID integer primary key auto_increment);</span></pre><p id="da55" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以root用户(数据库管理员)的身份登录mysql实用程序，并执行以下操作来创建数据库、用户和员工表:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="f568" class="no lt iq ms b be np nq l nr ns">create database if not exists emp;<br/>create user if not exists appuser identified by 'my_password';<br/>grant create,alter,drop,select,insert,delete,update <br/>    on emp.* to appuser;<br/>use emp;<br/>source setup.sql;<br/>exit</span></pre><p id="f0f6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，vly需要知道你的数据库在哪里。创建数据库配置文件<code class="fe mp mq mr ms b">db</code>(这是在<code class="fe mp mq mr ms b">run-query</code>语句中使用的名称)。将此复制到文件<code class="fe mp mq mr ms b">db</code>:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="ba38" class="no lt iq ms b be np nq l nr ns">[client]<br/>user=appuser<br/>password=my_password<br/>database=emp<br/>protocol=TCP<br/>host=127.0.0.1<br/>port=3306</span></pre><p id="6757" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意<code class="fe mp mq mr ms b">appuser</code>和<code class="fe mp mq mr ms b">emp</code>数据库(以及密码)与您在mysql实用程序中执行的创建sql相同。</p><h1 id="5598" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第二步:源代码</h1><p id="fe6b" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">这是源代码。按照说明将代码复制并粘贴到文件中。</p><h2 id="b4e1" class="nu lt iq bd lu nv nw dn ly nx ny dp mc le nz oa me li ob oc mg lm od oe mi of bi translated"><strong class="ak">列出员工(查询一张表)</strong></h2><p id="324d" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">这将显示雇员表中的雇员列表。只是为了说明任何C代码的用法，(因为这里的大部分代码都是Vely语句)，我添加了C代码来找出进程ID (PID)并显示它。将此保存到<code class="fe mp mq mr ms b">emp.vely</code>文件:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="8577" class="no lt iq ms b be np nq l nr ns">#include "vely.h"<br/><br/>void emp()<br/>{<br/>    out-header default<br/>    @&lt;!DOCTYPE html&gt;<br/>    @&lt;html&gt;<br/>    @&lt;head&gt;&lt;title&gt;Vely example&lt;/title&gt;&lt;/head&gt;<br/>    @&lt;body&gt;<br/>    pid_t pid = getpid(); // get current process ID<br/>    <br/>    @Employee report from process &lt;&lt;pf-out "%d", pid&gt;&gt;<br/>    @&lt;hr/&gt;<br/>    @&lt;table border="1"&gt;<br/>    run-query @db = \<br/>        "select firstName, lastName, employeeID from employee" \<br/>        output firstName, lastName, employeeID<br/>        @&lt;tr&gt;<br/>            @&lt;td&gt; &lt;&lt;query-result lastName&gt;&gt; &lt;/td&gt;<br/>            @&lt;td&gt; &lt;&lt;query-result firstName&gt;&gt; &lt;/td&gt;<br/>            @&lt;td&gt; \<br/>                &lt;a href="?req=del_emp\<br/>                    &amp;employee_id=&lt;&lt;query-result employeeID&gt;&gt;"&gt;\<br/>                    Delete\<br/>                &lt;/a&gt; &lt;/td&gt;<br/>        @&lt;/tr&gt;<br/>    end-query<br/>    @&lt;/table&gt;<br/>    @&lt;/body&gt;<br/>    @&lt;/html&gt;<br/> }</span></pre><p id="580d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如您所见，输出语句<code class="fe mp mq mr ms b">@</code>被大量使用。它输出同一行后面的任何文本。由于同一个Vely程序可以作为web应用程序和命令行程序，因此输出的目的地取决于您如何使用它。如果是一个web应用程序，则输出到web客户端，即浏览器。如果它是一个命令行程序，输出将转到标准输出，即<code class="fe mp mq mr ms b">stdout</code>。</p><p id="ba28" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输出数据时，内联代码通常用作输出的一部分。内联代码写在<code class="fe mp mq mr ms b">&lt;&lt;</code>和<code class="fe mp mq mr ms b">&gt;&gt;</code>之间，通常调用一个输出某些东西的Vely语句。在这个例子中，<code class="fe mp mq mr ms b">query-result</code>输出查询结果集的列值。</p><p id="900a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请注意，您可以通过单击“删除”链接来删除员工记录。该链接回调您的应用程序，并根据嵌入在删除链接中的<code class="fe mp mq mr ms b">employeeID</code>指定要删除的员工记录。</p><p id="dc0d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所有的vly请求必须有一个<code class="fe mp mq mr ms b">req</code>输入参数，指定哪个<code class="fe mp mq mr ms b">.vely</code>文件将处理该请求。所以当用户点击链接时，<code class="fe mp mq mr ms b">del_emp.vely</code>中的代码将会运行。这就来了。</p><h2 id="ce0c" class="nu lt iq bd lu nv nw dn ly nx ny dp mc le nz oa me li ob oc mg lm od oe mi of bi translated"><strong class="ak">添加一名员工(插入到表中)</strong></h2><p id="71a6" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">为了将数据插入到雇员表中，将提供雇员的名字和姓氏作为输入参数。在Vely框架中，使用<code class="fe mp mq mr ms b">input-param</code>语句很容易获得这些信息。然后，INSERT SQL将使用<code class="fe mp mq mr ms b">run-query</code>插入数据，它使用<code class="fe mp mq mr ms b">no-loop</code>子句说明没有结果集循环(即这不是一个选择查询)，并使用<code class="fe mp mq mr ms b">affected-rows</code>获得实际插入的行数。最后，您将检查是否按预期插入了一行，并通知用户。将此代码保存到<code class="fe mp mq mr ms b">add_emp.vely</code>文件中:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="85af" class="no lt iq ms b be np nq l nr ns">#include "vely.h"<br/><br/>void add_emp() {<br/>    out-header default<br/>    input-param first_name<br/>    input-param last_name<br/>    run-query @db = \<br/>        "insert into employee (firstName, lastName) \<br/>            values ('%s', '%s')" \<br/>        : first_name, last_name \<br/>        no-loop \<br/>        affected-rows define aff_rows<br/>    if (aff_rows != 1) {<br/>        @Could not add employee!<br/>        exit-request<br/>    }<br/>    @Employee added<br/>}</span></pre><p id="eea0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">添加员工的Web表单</strong></p><p id="d427" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了添加员工，您需要一个web表单来输入他们，然后作为输入参数发送给<code class="fe mp mq mr ms b">add_emp.vely</code>进行处理。下面是一个简单的表单——注意在<code class="fe mp mq mr ms b">&lt;form&gt;</code>元素中使用<code class="fe mp mq mr ms b">?</code>作为动作属性。这意味着:使用与这里相同的URL路径，然后从表单的输入字段添加URL查询字符串。请注意隐藏字段<code class="fe mp mq mr ms b">req</code>，这是一个强制字段，Vely需要它来路由HTTP请求——不出所料，它包含了<code class="fe mp mq mr ms b">add_emp</code>。将此保存到<code class="fe mp mq mr ms b">form_add_emp.vely</code>文件:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="a4c3" class="no lt iq ms b be np nq l nr ns">#include "vely.h"<br/><br/>void form_add_emp() {<br/>    out-header default<br/>    @&lt;h2&gt;Enter employee&lt;/h2&gt;<br/>    @&lt;form action="?" method="POST"&gt;<br/>    @    &lt;input type="hidden" name="req" value="add_emp"&gt;<br/>    @    &lt;label for="first_name"&gt;First name:&lt;/label&gt;&lt;br&gt;<br/>    @    &lt;input type="text" name="first_name" value=""&gt;&lt;br&gt;<br/>    @    &lt;label for="last_name"&gt;Last name:&lt;/label&gt;&lt;br&gt;<br/>    @    &lt;input type="text" name="last_name" value=""&gt;&lt;br&gt;&lt;br&gt;<br/>    @    &lt;input type="submit" value="Submit"&gt;<br/>    @ &lt;/form&gt;<br/>}</span></pre><h2 id="6125" class="nu lt iq bd lu nv nw dn ly nx ny dp mc le nz oa me li ob oc mg lm od oe mi of bi translated"><strong class="ak">删除一个员工(从表中删除)</strong></h2><p id="20ae" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">删除员工记录将获得员工ID，并发出DELETE SQL语句。注意<code class="fe mp mq mr ms b">:</code>子句的使用，它允许您指定SQL输入参数，在本例中<code class="fe mp mq mr ms b">employee_id</code>将被删除。将此保存到<code class="fe mp mq mr ms b">del_emp.vely</code>文件:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="390b" class="no lt iq ms b be np nq l nr ns">#include "vely.h"<br/><br/>void del_emp() {<br/>    out-header default<br/>    input-param employee_id<br/>    run-query @db = \<br/>        "delete from employee where employeeID='%s'" : employee_id \<br/>        no-loop \<br/>        affected-rows define aff_rows<br/>    if (aff_rows == 1) {<br/>        @Employee record deleted.<br/>    } else {<br/>        @Could not delete an employee record.<br/>    }<br/>}</span></pre><h1 id="478a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">步骤3:创建应用程序</h1><p id="026c" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">要创建Vely应用程序，请执行以下操作:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="af61" class="no lt iq ms b be np nq l nr ns">sudo vf -i -u $(whoami) emp</span></pre><p id="a2c8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mp mq mr ms b">-i</code>表示创建一个虚拟应用程序，<code class="fe mp mq mr ms b">-u</code>表示它的所有者将是当前用户，<code class="fe mp mq mr ms b">emp</code>是应用程序名称。</p><p id="2374" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将创建目录<code class="fe mp mq mr ms b">/var/lib/vv/emp</code>，这是您的项目的应用程序目录(参见<a class="ae lr" href="https://vely.dev/how_vely_works.html" rel="noopener ugc nofollow" target="_blank">如何工作</a>)。您已经对它进行了初始化并设置了权限，允许当前用户使用该目录，而其他用户不能访问它。</p><h1 id="6c64" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第四步:申请</h1><p id="e721" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">您的项目中现在有以下文件:<code class="fe mp mq mr ms b">emp.vely</code>、<code class="fe mp mq mr ms b">form_add_emp.vely</code>、<code class="fe mp mq mr ms b">add_emp.vely</code>、<code class="fe mp mq mr ms b">del_emp.vely</code>和<code class="fe mp mq mr ms b">db</code>。Vely的<a class="ae lr" href="https://vely.dev/vv.html" rel="noopener ugc nofollow" target="_blank"> vv实用程序</a>会把它们做成一个应用程序——它会自动找到这些文件，为你生成一个合适的Makefile，并链接到必要的库中。</p><p id="88b2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以使用<code class="fe mp mq mr ms b">vv</code>进行申请:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="7588" class="no lt iq ms b be np nq l nr ns">vv -q --db=mariadb:db</span></pre><p id="3df6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">表示您正在申请。<code class="fe mp mq mr ms b">--db</code>表示您正在使用MariaDB数据库，数据库配置文件在文件<code class="fe mp mq mr ms b">db</code>中。</p><p id="d5a1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意，您可以在您的应用程序中使用多个数据库，也可以使用来自不同供应商的数据库。</p><h1 id="f23c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">步骤5:运行应用程序</h1><p id="4a28" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">您将把应用程序作为FastCGI应用服务器运行。您的应用服务器运行在web服务器(在本例中是Nginx)的后面，它充当一个<code class="fe mp mq mr ms b">reverse-proxy</code>。许多持久和并发的服务器进程将为传入的请求提供服务。这些进程并不退出，而是并行工作。此外，最终用户无法直接访问它们。</p><p id="ae9e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要启动您的应用程序:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="06d6" class="no lt iq ms b be np nq l nr ns">vf -w 5 emp</span></pre><p id="87d2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将启动5个并发进程。阅读关于<a class="ae lr" href="https://vely.dev/vf.html" rel="noopener ugc nofollow" target="_blank"> vf — Vely的FastCGI进程管理器</a>的更多信息，了解如何微调性能，包括设置一个动态进程加载器，根据实际运行时负载改变运行的进程数量。</p><h1 id="04c0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">步骤6:为FastCGI设置Nginx</h1><p id="89df" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">最后一步是设置一个web服务器，在本例中是Nginx。编辑Nginx配置文件——对于Ubuntu和类似的Linux发行版:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="38b2" class="no lt iq ms b be np nq l nr ns">sudo vi /etc/nginx/sites-enabled/default</span></pre><p id="0ccc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于Fedora，像RedHat一样:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="d95a" class="no lt iq ms b be np nq l nr ns">sudo vi /etc/nginx/nginx.conf</span></pre><p id="5621" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe mp mq mr ms b">server {}</code>部分增加以下内容:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="f26d" class="no lt iq ms b be np nq l nr ns">location /emp { include /etc/nginx/fastcgi_params; fastcgi_pass unix:///var/lib/vv/emp/sock/sock; }</span></pre><p id="7ec0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">重新启动Nginx以使更改生效:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="6a1a" class="no lt iq ms b be np nq l nr ns">sudo systemctl restart nginx</span></pre><p id="526d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您在这里所做的是将URL路径<code class="fe mp mq mr ms b">/emp</code>与Nginx和您的应用服务器之间的超快速Unix套接字连接连接起来。这种方式的URL类似于:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="73a5" class="no lt iq ms b be np nq l nr ns">http://&lt;your web server&gt;/emp?req=add_emp&amp;first_name=Joe&amp;last_name=Darling</span></pre><p id="ce52" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将调用文件<code class="fe mp mq mr ms b">add_emp.vely</code>中的函数<code class="fe mp mq mr ms b">add_emp()</code>，并将名字和姓氏作为输入参数。</p></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><p id="565e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，您已经有了一个可以使用的功能应用程序。下面描述了使用它的各种方法。</p></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><h1 id="e2ac" class="ls lt iq bd lu lv on lx ly lz oo mb mc jw op jx me jz oq ka mg kc or kd mi mj bi translated">使用web浏览器中的应用程序</h1><p id="38a8" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">以下URL是应用程序的接口。使用两者来运行它。首先是添加一名员工:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="fea8" class="no lt iq ms b be np nq l nr ns">http://&lt;your web server&gt;/emp?req=form_add_emp</span></pre><p id="0f57" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个是列出员工</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="2605" class="no lt iq ms b be np nq l nr ns">http://&lt;your web server&gt;/emp?req=emp</span></pre><p id="9700" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当然，用“127.0.0.1”回送地址(如果您在本地测试)或web服务器的完全限定名称或IP地址替换“<your web="" server="">”。</your></p><p id="ce50" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请注意以下事实:</p><ol class=""><li id="9b9f" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">URL路径是您的应用程序的名称— <code class="fe mp mq mr ms b">/emp</code>在本例中，因为这是您用Nginx设置它的方式，</li><li id="e19c" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated"><code class="fe mp mq mr ms b">req</code>参数总是处理它的请求源文件的基本名称。例如，URL中的<code class="fe mp mq mr ms b">req=form_add_emp</code>意味着<code class="fe mp mq mr ms b">form_add_emp.vely</code>中的代码将处理请求，</li><li id="7e7b" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">其他任何参数你都可以自由选择。</li></ol><p id="b847" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请注意，如果您没有web服务器，并且仍然希望使用您的应用程序服务器，那么您可以使用vey安装中包含的FastCGI客户端在命令行上直接联系它(从而绕过web服务器)。在这种情况下，您会要求您的应用程序服务器列出雇员记录:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="2f9f" class="no lt iq ms b be np nq l nr ns">export REQUEST_METHOD=GET<br/>export SCRIPT_NAME="/emp"<br/>export PATH_INFO=""<br/>export QUERY_STRING='req=emp'<br/>cgi-fcgi -connect /var/lib/vv/emp/sock/sock /</span></pre><h1 id="6837" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">命令行用法</h1><p id="faa2" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">每个虚拟应用程序都可以作为web应用程序或命令行程序运行。它们都使用HTTP作为协议，使得以各种不同的方式开发、测试、维护和使用应用程序变得容易。</p><p id="1fa1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请注意，如果您计划从命令行单独运行您的应用程序，您不需要应用程序服务器，因此在这种情况下，您不需要web服务器设置，也不需要使用vf process manager启动应用程序服务器。简单多了。</p><p id="6545" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要从命令行运行应用程序，请在命令行上提供输入参数并运行程序。例如添加一个员工，提供<code class="fe mp mq mr ms b">REQUEST_METHOD</code>环境变量(如<code class="fe mp mq mr ms b">GET</code>)和<code class="fe mp mq mr ms b">QUERY_STRING</code>(设置为URL来添加一个员工)，调用程序:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="032d" class="no lt iq ms b be np nq l nr ns">export REQUEST_METHOD=GET<br/>export SCRIPT_NAME="/emp"<br/>export PATH_INFO=""<br/>export QUERY_STRING='req=add_emp&amp;first_name=Joe&amp;last_name=Darling'<br/>/var/lib/vv/bld/emp/emp</span></pre><p id="6fc4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">结果是:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="03f4" class="no lt iq ms b be np nq l nr ns">Content-type: text/html;charset=utf-8<br/>Cache-Control: max-age=0, no-cache<br/>Pragma: no-cache<br/>Status: 200 OK<br/><br/>Employee added</span></pre><p id="6468" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您计划将结果保存在一个文件中(例如缓存应用程序输出)，您可以通过以下方式从输出中省略HTTP头:</p><pre class="kg kh ki kj gt nk ms nl bn nm nn bi"><span id="5a9f" class="no lt iq ms b be np nq l nr ns">export VV_SILENT_HEADER=yes</span></pre><h1 id="737d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="f811" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在本教程中，您学习了如何使用vly创建一个全功能的数据库驱动的web应用程序，它使用MariaDB/MySQL作为数据库，使用Nginx作为反向代理web服务器。</p><p id="2c22" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，您可以使用PostgreSQL和Apache，这将非常相似。</p><p id="f8c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您还学习了如何以不同的方式运行您的应用程序:作为应用程序服务器或从命令行运行。输出和行为完全相同，这对部署和自动化应用程序测试都很有用。</p></div></div>    
</body>
</html>