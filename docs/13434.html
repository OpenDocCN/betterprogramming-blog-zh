<html>
<head>
<title>Get Daily Exchange Rates via SMS Using Ballerina</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用芭蕾舞演员通过短信获取每日汇率</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/get-daily-exchange-rates-via-sms-using-ballerina-6cfb577633c9?source=collection_archive---------14-----------------------#2022-08-25">https://betterprogramming.pub/get-daily-exchange-rates-via-sms-using-ballerina-6cfb577633c9?source=collection_archive---------14-----------------------#2022-08-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ab18" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">轻松掌握最新财务信息</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cde7e23ecc1c0839b1e1a778e9ea578a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I46TfG5kAsUbmWIB5kU6SQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@margabagus" rel="noopener ugc nofollow" target="_blank">玛加·桑托索</a>在<a class="ae kv" href="https://unsplash.com/s/photos/currency-exchange?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><h1 id="49a0" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="f36e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我开发了一个使用芭蕾舞演员接收法定货币每日汇率的服务。它允许您订阅任何转换的汇率，并在每天早上收到订阅转换的短信。以下视频描述了该应用程序的功能:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">应用程序功能</p></figure><p id="cc3c" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">我将带你完成这个应用程序的实现，这样你就可以利用这种经验和Ballerina一起创建很酷的东西。好吧！让我们首先开始查看用例。</p><h1 id="2b2f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">用例</h1><p id="8097" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">该服务有两个HTTP端点。一个用于预订服务，另一个用于取消预订。订阅时，用户应该提供一个手机号码和要订阅的转换列表。当取消订阅时，用户只需提供带有HTTP请求的移动电话号码。该应用程序应该每天早上发送短信到每个订阅的移动电话号码与各自的转换。</p><h1 id="3179" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">背景</h1><p id="a707" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在尝试实现应用程序之前，我们应该了解芭蕾舞演员的基础知识。我们先来了解一下芭蕾中的<code class="fe mr ms mt mu b">services</code><code class="fe mr ms mt mu b">recurrent tasks</code><strong class="lq ir"/><code class="fe mr ms mt mu b">client objects</code>。Ballerina中的这些构造对我们来说非常重要，因为我们需要每天早上定期通知订户，同时为订阅管理提供两个HTTP端点。</p><h1 id="237c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">芭蕾舞演员服务</h1><p id="4628" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Ballerina中的一个服务声明表示一个可远程访问的资源方法的集合，这些方法附加到一个特定的侦听器上。在我们的用例中，服务应该包含订阅和取消订阅的两种方法，并且应该附加到一个HTTP侦听器，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">示例转换服务</p></figure><p id="18fb" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">下图描述了我们如何运行和测试端点。</p><p id="d6cb" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">芭蕾舞女演员提供了一堆对应各种交通工具的监听器。详细指南请参考此<a class="ae kv" href="https://ballerina.io/learn/by-example/?utm_source=me&amp;utm_medium=link&amp;utm_campaign=me_link_smsballerinamalintha_220825" rel="noopener ugc nofollow" target="_blank">示例</a>。</p><h1 id="dab7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">芭蕾舞演员的任务</h1><p id="6594" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在上面的用例中，需要查找转换率并在每天早上通知订户。这可以在芭蕾舞中使用<code class="fe mr ms mt mu b"><a class="ae kv" href="https://lib.ballerina.io/ballerina/task/2.2.2/functions#scheduleJobRecurByFrequency" rel="noopener ugc nofollow" target="_blank">recurrent jobs</a>.</code>来完成</p><p id="32b5" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">要创建周期性任务，需要提供<strong class="lq ir"> </strong>类型<strong class="lq ir"> </strong> <code class="fe mr ms mt mu b">Job</code>的值。<code class="fe mr ms mt mu b">Job</code>是一只<code class="fe mr ms mt mu b"><a class="ae kv" href="https://lib.ballerina.io/ballerina/task/2.2.2/objectTypes/Job" rel="noopener ugc nofollow" target="_blank">object type</a></code>。Ballerina中的对象类型有点类似于java中的接口。一个对象类型可以用来定义一个<code class="fe mr ms mt mu b">class</code> <strong class="lq ir"> </strong>使用类型包含类似于实现一个接口。</p><p id="7b7a" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">但是需要注意的是，芭蕾舞者不是OOP语言。芭蕾舞演员类型的系统是结构性的。它使用的概念叫做<code class="fe mr ms mt mu b">shapes</code>。详细指南请参考<a class="ae kv" href="https://ballerina.io/why-ballerina/flexibly-typed/" rel="noopener ugc nofollow" target="_blank">芭蕾舞演员类型系统</a>。</p><p id="6db0" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">Ballerina中的类类型用于创建特定类类型的值(该类的对象实例)。在下面的代码段中，我定义了一个名为<code class="fe mr ms mt mu b">MyJob</code>的类，它可以由调度程序作为一次性任务或循环任务来调度和执行。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">示例作业</p></figure><p id="9ad9" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">当创建类型为<code class="fe mr ms mt mu b">MyJob</code>的值时，执行<strong class="lq ir"> </strong> <code class="fe mr ms mt mu b">init</code>方法，这类似于java类中的<code class="fe mr ms mt mu b">constructor</code>。<code class="fe mr ms mt mu b">execute</code>方法是上面提到的<code class="fe mr ms mt mu b">task:Job </code>对象类型中未实现的方法<code class="fe mr ms mt mu b">execute</code>的实现。</p><h1 id="97bd" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">芭蕾舞女中的顾客物品</h1><p id="1446" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们可以用<code class="fe mr ms mt mu b">client objects</code>和芭蕾里的<code class="fe mr ms mt mu b">remote services</code>互动。远程服务可以是在特定传输上可用的任何服务。例如，Ballerina中的<code class="fe mr ms mt mu b">http client</code>允许我们与HTTP远程服务进行交互。我们可以使用<code class="fe mr ms mt mu b">http client</code>来检索两种货币的汇率，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">示例客户端对象</p></figure><p id="04ed" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">在上面的实现中，我们使用了<code class="fe mr ms mt mu b">http client</code>来调用由<a class="ae kv" href="https://apilayer.com" rel="noopener ugc nofollow" target="_blank">https://apilayer.com</a>提供的<a class="ae kv" href="https://apilayer.com/marketplace/exchangerates_data-api" rel="noopener ugc nofollow" target="_blank">远程HTTP服务</a>。应该获取API密钥来调用端点。API键可以在Ballerina中指定为可配置变量。示例参见<a class="ae kv" href="https://ballerina.io/learn/by-example/configurable-variables/?utm_source=me&amp;utm_medium=link&amp;utm_campaign=me_link_smsballerinamalintha_220825" rel="noopener ugc nofollow" target="_blank">可配置变量</a>。</p><p id="360d" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">因为我们只对结果感兴趣，所以可以改进上面的程序，用类型定义克隆响应。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">客户端对象的改进示例</p></figure><h1 id="691a" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">履行</h1><p id="f5c7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在，让我们看看如何使用我们在背景部分看到的内容来实现最初的需求。我们可以进一步改进<code class="fe mr ms mt mu b">Job</code>类，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用例的作业类</p></figure><p id="0468" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated"><code class="fe mr ms mt mu b">Job</code>类应该维护一组每天早上必须向其发送消息的订户。此外，它还应该定义添加或删除订户的逻辑。<code class="fe mr ms mt mu b">getRatesAndSendSMS()</code>方法负责最重要的任务，即从外部<code class="fe mr ms mt mu b">HTTP</code>服务中检索汇率并通知用户。</p><p id="71e5" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">现在，困难的部分已经完成了。让我们用这段代码改进一下我们的<code class="fe mr ms mt mu b">/conversions</code> HTTP远程服务:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv ml l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用例的改进转换服务</p></figure><p id="dac5" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">服务对象初始化时调用的服务的<code class="fe mr ms mt mu b">init</code>方法。在<code class="fe mr ms mt mu b">init</code>方法中，我们创建了一个<code class="fe mr ms mt mu b">Job</code>对象，并安排了一个每分钟执行一次的循环任务(一分钟模拟一天)。实现到此为止。</p><p id="f094" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">万岁！！！你可以试试这个，就像我在上面的视频中展示的那样。</p><p id="fd65" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">在本文中，我们看到了Ballerina编程语言的优势，以及为集成场景编写应用程序是多么容易。</p><p id="e90d" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">下一步是使用适当的身份验证和授权来部署这个应用程序。让我们在一篇新的文章中见面，我将讨论我们如何在<a class="ae kv" href="https://wso2.com/choreo/" rel="noopener ugc nofollow" target="_blank"> Choreo </a>上改进和部署这个应用程序。</p><p id="21b6" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated">在<a class="ae kv" href="https://github.com/malinthar/daily_exchange_rates" rel="noopener ugc nofollow" target="_blank">https://github.com/malinthar/daily_exchange_rates</a>找到源代码。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><p id="3f47" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated"><em class="nd">感谢您的阅读！</em></p><p id="b11f" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx mo lz ma mb mp md me mf mq mh mi mj ij bi translated"><em class="nd">如有任何疑问，请随时联系我！</em></p></div></div>    
</body>
</html>