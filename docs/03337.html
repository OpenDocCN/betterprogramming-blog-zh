<html>
<head>
<title>Add Metadata to Your User-Shared Content with LPLinkMetadata</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用LPLinkMetadata将元数据添加到您的用户共享内容</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/whats-new-in-sharing-for-ios-13-3216999ff942?source=collection_archive---------10-----------------------#2020-02-04">https://betterprogramming.pub/whats-new-in-sharing-for-ios-13-3216999ff942?source=collection_archive---------10-----------------------#2020-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8da8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">iOS 13有什么新的分享？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/976d0c90793a7e6d7709cabb66cf02d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*phW8wKGM3Gm8Xx2PJd8WmQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">动态链接元数据(左)和自定义链接元数据(右)</p></figure><p id="9910" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<strong class="la iu"> WWDC 2019 </strong>中，苹果宣布iOS 13现在支持<a class="ae lu" href="https://medium.com/better-programming/linkpresentation-in-ios-13-bbb6007818c6" rel="noopener">丰富链接</a>。他们还宣布了iOS 13中共享功能的更新。首先，我们来看看iOS 12中的分享</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/195e837562d3411124e7b58ad155f021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sPbMUULKBidt-8QPI9Sm_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">比较iOS 12和iOS 13中的共享部分</p></figure><p id="9c50" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，共享部分的顶部有一个视图，用于显示该链接中的元数据，本文将帮助您显示它，包括自动获取元数据和手动设置它。</p><p id="e0b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好了，我们开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ad41" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">步骤1:获取元数据</h1><p id="8758" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">您首先需要的是<code class="fe mz na nb nc b"><a class="ae lu" href="https://developer.apple.com/documentation/linkpresentation/lplinkmetadata" rel="noopener ugc nofollow" target="_blank">LPLinkMetadata</a></code>——一个存储URL元数据的对象，包括标题、图标、图像和视频。</p><h2 id="6a10" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated"><strong class="ak">自动提取元数据</strong></h2><p id="7d35" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">因为我们没有链接的元数据，所以我们需要另一个进程来获取它。为此，我们使用<code class="fe mz na nb nc b"><a class="ae lu" href="https://developer.apple.com/documentation/linkpresentation/lpmetadataprovider" rel="noopener ugc nofollow" target="_blank">LPMetadataProvider</a></code>。</p><p id="9132" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mz na nb nc b">LPMetadataProvider</code>是一个检索URL元数据的对象。在它完成获取之后，它会将元数据映射到<code class="fe mz na nb nc b">LPLinkMetadata</code> <strong class="la iu"> </strong>对象。</p><p id="c07c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mz na nb nc b">LPMetadataProvider</code> <strong class="la iu"> </strong>支持一个叫<code class="fe mz na nb nc b"><a class="ae lu" href="https://developer.apple.com/documentation/linkpresentation/lpmetadataprovider/3143321-startfetchingmetadata" rel="noopener ugc nofollow" target="_blank">startFetchingMetadata</a></code>的功能。</p><p id="cdae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里有一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><h2 id="b571" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated">自定义元数据</h2><p id="1aa2" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">如果您的链接不支持元数据，或者您想要更改为另一个URL、标题、图标、图像或视频，只需创建<code class="fe mz na nb nc b">LPLinkMetadata</code> <strong class="la iu"> </strong>并输入所需数据。但是在<code class="fe mz na nb nc b">Sharing</code>部分，你需要重点关注<code class="fe mz na nb nc b">title</code>、<code class="fe mz na nb nc b">icon</code>、<code class="fe mz na nb nc b">URL</code>。</p><p id="0cdd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是为<code class="fe mz na nb nc b">Sharing</code>创建元数据的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ddba" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第二步。为元数据创建UIActivityItemSource</h1><p id="df55" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">当您有了<code class="fe mz na nb nc b"><a class="ae lu" href="https://developer.apple.com/documentation/linkpresentation/lplinkmetadata" rel="noopener ugc nofollow" target="_blank">LPLinkMetadata</a></code>之后，下一步是创建一个实现来自<code class="fe mz na nb nc b">UIActivityItemSource</code>的协议的对象。</p><p id="f93a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有两个功能需要实现。<code class="fe mz na nb nc b">activityViewControllerPlaceholderItem </code> —真实数据的占位符—以及</p><p id="a431" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mz na nb nc b">activityViewController</code> —应该共享数据的句柄，它还检测数据发送到哪里(例如，脸书、Gmail、Twitter等)。</p><p id="0188" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<a class="ae lu" href="https://developer.apple.com/documentation/uikit/uiactivityitemsource/1620453-activityviewcontroller" rel="noopener ugc nofollow" target="_blank">苹果文档</a>中阅读更多信息。</p><p id="b286" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从iOS 13开始，我们有了一个新的功能来帮助我们实现URL的元数据，这个功能就是<code class="fe mz na nb nc b">activityViewControllerLinkMetadata</code>。它返回一个<code class="fe mz na nb nc b">LPLinkMetadata</code>。</p><p id="5253" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击了解更多<code class="fe mz na nb nc b">activityViewControllerLinkMetadata</code> <strong class="la iu"> </strong> <a class="ae lu" href="https://developer.apple.com/documentation/uikit/uiactivityitemsource/3144571-activityviewcontrollerlinkmetada" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="053d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是创建自定义<code class="fe mz na nb nc b">UIActivityItemSource</code>的完整代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="af05" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第三步。呈现UIActivityViewController</h1><p id="9918" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在我们有了数据，一切都变得容易了。接下来，我们就展示一下<code class="fe mz na nb nc b">UIActivityViewController</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="43fa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为方便起见，我想将所有必要的函数放在一个文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="e282" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读。我希望这篇文章对你有用。</p></div></div>    
</body>
</html>