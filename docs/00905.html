<html>
<head>
<title>Redux Middleware in Depth: Write Custom Redux Middleware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux中间件深度:编写定制的Redux中间件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/redux-middleware-in-depth-write-custom-redux-middleware-4f02e2497cd6?source=collection_archive---------8-----------------------#2019-07-26">https://betterprogramming.pub/redux-middleware-in-depth-write-custom-redux-middleware-4f02e2497cd6?source=collection_archive---------8-----------------------#2019-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2777" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过示例了解更多关于Redux中间件的信息</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ec2eb5ea488985ba668a7ba23ec3a74d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bpT2YdQKYPlgqwV-pcbKwQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">J. Kelly Brito 在<a class="ae kv" href="https://unsplash.com/search/photos/laptop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="0c3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在玩<a class="ae kv" href="https://github.com/redux-saga/redux-saga" rel="noopener ugc nofollow" target="_blank"> redux-saga </a>、<a class="ae kv" href="https://github.com/reduxjs/redux-thunk" rel="noopener ugc nofollow" target="_blank"> redux-thunk </a>和<a class="ae kv" href="https://redux-observable.js.org/" rel="noopener ugc nofollow" target="_blank"> redux-observable </a>，这时我意识到<a class="ae kv" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> redux </a>中间件可能是一个全新的话题，因为这些库(尤其是redux-saga和redux-observable)依赖于Redux中间件的实现。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="cbba" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">Redux简介</strong></h1><p id="8ec4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Redux是JavaScript应用程序的可预测状态容器。</p><p id="e60a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你不熟悉Redux，我建议你看一下<a class="ae kv" href="https://redux.js.org" rel="noopener ugc nofollow" target="_blank">官方文档</a>，记下Redux的主要概念:<code class="fe mw mx my mz b">store</code>、<code class="fe mw mx my mz b">reducer</code>、<code class="fe mw mx my mz b">actions</code>、<code class="fe mw mx my mz b">actionCreator</code>。</p><p id="890c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请看看下面的示例代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="54b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，这里发生的事情是我们使用Redux的<code class="fe mw mx my mz b">createStore</code> <strong class="ky ir"> </strong>函数创建了商店，Redux接收<code class="fe mw mx my mz b">reducer</code> <strong class="ky ir"> </strong>函数作为参数。</p><p id="5d25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个<code class="fe mw mx my mz b">reducer</code>函数定义了我们如何更新我们的状态。更新状态的唯一方法是调度一个<code class="fe mw mx my mz b">action</code> <strong class="ky ir">，</strong>基本上是一个普通对象<strong class="ky ir">。</strong></p><p id="bf83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe mw mx my mz b">actionCreator</code> <strong class="ky ir"> </strong>函数来构造<code class="fe mw mx my mz b">action</code>是常见的做法，我们也将使用这种模式。</p><p id="72e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为一个例子，我们将使用to-do应用商店，稍后我们将更改一些代码以获得更多功能。为了构建一个完整的UI，以便我们可以真正看到我们在构建什么，我将使用<a class="ae kv" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5451" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">什么是Redux中间件，为什么它很重要</h1><p id="1651" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Redux通过调度动作同步改变其状态。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/cebf80e198de2b6d086ee4724c783722.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLiwYf5mfryO-_iR98DNqQ.png"/></div></div></figure><p id="e721" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其实，我们可以把<em class="nd">中间件</em> <strong class="ky ir"> </strong>放在<em class="nd">调度动作</em>和<em class="nd">更新存储</em>到<em class="nd"> </em>之间做一些疯狂的事情，比如放入一个while ( <code class="fe mw mx my mz b">true</code>)语句(请不要那样做)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/9b432308591a3651925e0e6134f19cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UlvYJTukfGdZoIdEyutIeg.png"/></div></div></figure><p id="65d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你注意到我在那里写了<em class="nd">中间件</em>而不是<em class="nd">中间件</em>了吗？是的，没错，因为我们可以在那里放置多个中间件。</p><p id="f0f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些中间件使我们能够扩展我们的商店的功能，例如:记录每个分派的动作或动作类型验证。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="db07" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">简单日志中间件</h1><p id="e422" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">请看看下面的React to-do应用程序示例。</p><p id="97cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将所有代码都写在一个文件中，以便您更容易阅读代码示例(请让我知道它是否工作)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf nb l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用Redux和logger中间件的待办事项应用程序示例</p></figure><p id="df4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个待办事项应用程序示例中，我们有一个日志记录中间件，它将记录更新前的状态、分派的动作和更新后的状态。你应该试着玩玩沙盒，看看它是如何工作的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">运行中的记录器中间件</p></figure><p id="a334" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">中间件是<em class="nd">函数返回函数返回函数，</em> <strong class="ky ir"> </strong>好玩的。</p><p id="fdeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个函数都有<code class="fe mw mx my mz b">store</code>、<code class="fe mw mx my mz b">next</code>和<code class="fe mw mx my mz b">action</code>作为参数。</p><ul class=""><li id="5110" class="ng nh iq ky b kz la lc ld lf ni lj nj ln nk lr nl nm nn no bi translated"><code class="fe mw mx my mz b">Store</code>是商店实例。</li><li id="0f68" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><code class="fe mw mx my mz b">next</code>是下一个中间件功能。</li><li id="3391" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated"><code class="fe mw mx my mz b">action</code>是派遣行动。</li></ul><p id="c80a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">执行下面的代码行将执行下一个具有分派动作的中间件。</p><pre class="kg kh ki kj gt nu mz nv nw aw nx bi"><span id="62a2" class="ny ma iq mz b gy nz oa l ob oc">next(action);</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0679" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">编写自定义操作验证器</h1><p id="d4b3" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">假设我们想要确保商店调度的每个动作都是有效的动作。</p><p id="1137" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有两种类型的动作:<code class="fe mw mx my mz b">ADD_TODO</code>和<code class="fe mw mx my mz b">RESET_TODO</code>。</p><p id="4afa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们只想处理这些动作，如果我们有另一种动作类型，就抛出异常。请检查下面这段代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="fb43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个验证中间件将检查动作的类型是<code class="fe mw mx my mz b">ADD_TODO</code>还是<code class="fe mw mx my mz b">RESET_TODO</code>，否则，它不会执行下一个函数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf nb l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带有验证中间件的待办事项应用</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0478" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated"><strong class="ak">结论</strong></h1><p id="ebfe" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们可以使用Redux中间件来执行各种事情，比如日志记录、验证、放入try/catch块来处理异常，或者可能产生副作用，比如将事件广播给另一个侦听器。</p><p id="e034" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，放入一个while ( <code class="fe mw mx my mz b">true</code>)语句。不，不要那样做，那绝对是一个笑话。</p><p id="b8e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你怎么看待Redux中间件？你有其他的想法可以用来做什么吗？</p><p id="d19c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>