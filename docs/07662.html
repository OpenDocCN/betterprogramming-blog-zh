<html>
<head>
<title>Flutter Failed To Solve the Biggest Challenge for Our Cross-Platform App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter未能解决我们跨平台应用的最大挑战</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/flutter-failed-to-solve-the-biggest-challenge-for-our-cross-platform-app-c551afa0ef18?source=collection_archive---------0-----------------------#2021-02-08">https://betterprogramming.pub/flutter-failed-to-solve-the-biggest-challenge-for-our-cross-platform-app-c551afa0ef18?source=collection_archive---------0-----------------------#2021-02-08</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="70b5" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">将原生iOS应用迁移到Flutter的惨痛教训</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/416bfdee17535a46f797ddab8975a3a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GW5IPrsjUoVRMWe6"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">奥拉夫·阿伦斯·罗特内在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c24a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我第一次尝试移动应用程序开发始于大约十年前。我刚买了我的第一部iPhone (a 3GS ),我很想为这个迷人的小设备开发应用程序。我当时想开发的应用程序基本上是(现在仍然是)一本关于类固醇的电子书。它有大约50个章节的信息内容，目的是在某些紧急情况下帮助其观众。因此，该应用程序的主要目标是以这样一种方式呈现其内容，即用户可以在紧张的情况下快速可靠地找到他们正在寻找的内容。</p><p id="418e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我最初是作为一个web应用程序开始这个项目的，使用的是打包到部署在iOS上的原生PhoneGap容器中的jQTouch库。在发布后不久，这款应用就登上了苹果医疗类推荐应用列表一周，所以看起来这款应用确实触动了神经。四年后，在我决定于2020年9月将其移植到<a class="ae kz" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank"> Flutter </a>之前，我在Swift中将该应用重写为原生应用。这是我在最后一段旅程中学到的东西。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="085d" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">Flutter:跨平台应用的圣杯？</h1><p id="3cfd" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">当最终决定创建该应用的Android版本时，显而易见的问题是如何实现。一个原生Android端口？跨平台？用Ionic和React还是Vue.js？还是街区里新来的酷小子，扑扑？在对多平台应用程序开发的现状做了一些研究后，似乎有很多关于后者的宣传。从Medium algorithms推荐的文章中，我得到的印象是，人们普遍对谷歌的项目非常满意，Flutter似乎已经足够成熟，可以成为一个重要的替代方案。所以我决定试一试。</p><p id="aa85" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">令人惊讶的是，我最初的经历和文章中称赞的一样棒。信不信由你，在没有任何Dart和Flutter的UI设计原则(来自iOS Swift和Xcode Interface Designer)的知识的情况下，我在一周内用Flutter在Android和iOS上运行了我的应用程序——嗯，差不多。</p><p id="9a85" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当它进入测试时，我随机开始看到一些非常奇怪的行为:在应用程序中，我显示了一个旋转器，而电子书的一个章节正在加载。一旦它被加载并呈现在WebView中，我就用呈现的内容替换微调器。实际上很简单。这在99%的情况下都是有效的，但在随机的时候，应用程序会卡在旋转器上——显然，对于一个应该在紧急情况下帮助你的应用程序来说，这是不可行的。大概花了一两天的时间才发现，这是因为如果用户短暂地切换到另一个应用程序，然后又回到我的应用程序，那么Flutter的HttpServer就会在iOS上崩溃。真扫兴。我提交了一份广泛的<a class="ae kz" href="https://github.com/flutter/flutter/issues/67628" rel="noopener ugc nofollow" target="_blank"> bug报告</a>——但是短期内还没有修复。</p><p id="c806" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">由于我不能在这种状态下发布我的应用程序，我开始寻找替代方法。我没有通过HttpServer提供我的电子书内容，而是决定在第一次启动应用程序时将应用程序捆绑包中的内容复制到应用程序的文档目录中，然后使用file:// schema直接在WebView中打开HTML。经过一些测试和重构，这似乎是一个可行的解决办法——直到电子书中的一些链接在真实的iOS设备上停止工作。奇怪的是，Android甚至iOS模拟器上的一切都运行良好。原来我发现了<a class="ae kz" href="https://github.com/flutter/flutter/issues/67747" rel="noopener ugc nofollow" target="_blank">的另一个bug </a>，这次是在Flutter WebView包中，我提交了这个bug，这个bug也很快被团队确认、复制和分类。<strong class="lc iv">但是截止到今天(2021年2月)</strong>这两个bug依然存在于Flutter中。</p><p id="b35f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当我解决了最后一个bug的时候，我花了和学习Dart和移植我的应用一样多的时间来寻找和报告Flutter中的bug。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="a676" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">依赖地狱</h1><p id="c309" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">Flutter HttpServer和WebView是我的app最重要的两个依赖。没有其中之一，我的应用程序将无法在这种环境下运行。从我使用iOS和CocoaPods的经验来看，这些天我把每一个依赖都视为技术债务:你借用了别人的代码或功能，有一天你可能不得不为此付出代价。</p><p id="470b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">任何不属于你自己的、你的应用程序所依赖的代码都会增加你的应用程序的技术债务。</p><p id="69c5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">就个人而言，我认为WebView和HttpServer是Flutter技术栈的核心部分，因为它们都是由Flutter团队直接开发和支持的，而不是某个第三方。(我不会告诉你那些可怕的细节，当我用一个第三方WebView作为一种选择来测试Flutter的时候。)</p><p id="7b05" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，我很惊讶，他们似乎很少得到颤振团队的爱。我猜，要么是谷歌目前的团队规模不够大，无法完成像Flutter这样的项目(截至今天，有8，230个未决问题)，要么是他们的优先事项在别处。但它确实启发了我，让我从总体上审视我的Flutter应用程序的依赖性，并将它们与我的应用程序的原生Swift版本进行比较。要点如下:</p><h2 id="f2ce" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">原生iOS (Swift)</h2><ul class=""><li id="8fd5" class="nm nn iu lc b ld mv lg mw lj no ln np lr nq lv nr ns nt nu bi translated">AEXML</li><li id="96a3" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">FontAwesome.swift</li></ul><p id="5a73" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">AEXML需要解析一些XHTML文件，因为原生iOS SDK不提供DOM解析器。第二个库允许我在应用程序中使用流行的字体图标。</p><h2 id="f022" class="na me iu bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">摆动</h2><ul class=""><li id="7c99" class="nm nn iu lc b ld mv lg mw lj no ln np lr nq lv nr ns nt nu bi translated">库比蒂诺_图标</li><li id="512b" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">超文本传送协议</li><li id="ba01" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">供应者</li><li id="f1f4" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">共享_首选项</li><li id="9297" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">font_awesome_flutter</li><li id="1ba8" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">xml2json</li><li id="c4fd" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">小路</li><li id="029d" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">路径提供者</li><li id="bd5f" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">哑剧</li><li id="0e6c" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">颤振_网页_浏览器</li><li id="6e4d" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">webview_flutter</li><li id="6a97" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">url _启动器</li><li id="3e33" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">地理定位器</li><li id="d6e0" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">地理编码</li><li id="b153" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">地图_启动器</li><li id="6bf3" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">唤醒锁</li><li id="cb94" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">设备信息</li><li id="57bc" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">包信息</li><li id="92b5" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">可滚动定位列表</li><li id="d794" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">in_app_review</li><li id="f5ea" class="nm nn iu lc b ld nv lg nw lj nx ln ny lr nz lv nr ns nt nu bi translated">分享</li></ul><p id="1d42" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">OMG！我要这么多包裹做什么？嗯，作为一个应用程序而不是电子书，我在我的原生应用程序中添加了一些额外的功能和服务:使用第三方API在线搜索该领域的专业人士，使用地理定位和反向地理编码显示用户当前位置的一些信息，以帮助指导紧急服务，以及紧急电话号码的快速拨号。每个功能都需要本地平台SDK的一些特定功能，如地理定位、地理编码、触发呼叫或在应用程序打开时阻止睡眠模式。最重要的是，你可以在任何像样的应用程序中找到基本功能:偶尔要求用户进行评论，允许与其他应用程序共享内容，启动URL，在特定位置打开地图应用程序，或访问有关本地设备和操作系统的一些信息。</p><p id="f1e9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然iOS和Android在其自带的SDK中提供了大部分这些功能，但跨平台解决方案必须为它们中的每一个提供桥梁、包或插件。在Flutter的情况下，它们必须用三种语言实现:Dart、Swift/Objective-C和Java/Kotlin。</p><p id="cdec" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你的Flutter应用将依赖于无数的外部库来允许你提供与本地应用相同的功能。因此，你的应用程序的功能依赖于许多未知的团体，他们有不同的议程、时间限制和开发动机。你的应用程序的技术债务会随着你使用的每个插件而增加。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="f724" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">跨平台增加了复杂性</h1><p id="04a0" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">如果你的目标是最少的技术债务，你必须自己编写100%的应用程序代码，并且只使用原生SDK来提供对底层硬件的访问。每个第三方库都会增加你的技术债务，所以如果你不能自己实现这个功能，至少要谨慎选择。</p><p id="85ac" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当我开始测试我的原生iOS应用程序时，我最初发现了一个巨大的内存泄漏。那么这是从哪里来的呢？在理解了不可思议的保留循环的概念以及如何找到它们之后，我终于发现了罪魁祸首:第三方XML库在递归中泄漏了。当我经常用它解析XHTML时，我的应用程序变成了内存猪。</p><p id="e89a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">幸运的是，我可以用我敏捷的技能找到库中的bug，在一天之内修复它，甚至向库的所有者提交补丁。但我能找到并修复它，只是因为这个库和我的应用程序是用同一种语言编写的，而这是一种我熟悉的语言。</p><p id="8e23" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因此，如果一个第三方库是开源的，并且用和你的应用程序相同的语言编写，你可能能够很好地承担债务。但是<strong class="lc iv">每一个跨平台的解决方案都会给你的应用增加多层复杂性，并在每一层引入额外的故障点。</strong></p><p id="a30f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">任何Flutter包都可能在其Dart代码、Swift/Objective-C代码或Java/Kotlin代码中失败。<strong class="lc iv">Flutter、Dart、iOS或Android的任何更新都可能破坏该包的部分内容，并随之破坏你在一个或所有平台上的应用</strong>。</p><p id="1765" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">除非您精通所有三种语言，并且精通所有支持的平台，否则您可能无法或者不想找到并修复这些问题。</p><p id="525a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意:就在我写这篇文章的时候，我收到了一个用户的第二次支持请求，他在装有iOS 12.4的iPhone 6上运行我的应用程序。他们报告说他们的设备上没有加载章节。在我的iOS模拟器中，同样的硬件/操作系统组合，一切都很好。说真的:如果我没有一部旧iPhone 6，我到底应该如何调试这个？即使我设法找到了Flutter WebView插件的iOS部分的错误，我也不精通Objective-C，也不想花更多的时间来尝试修复一些我应该可以正常工作的东西——或者被声明为仍处于alpha或beta状态的东西！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="4787" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">你想依靠谁？</h1><p id="9a88" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">如果项目背后有一个强大的组织，负责为Dart提供所有主要原生SDK功能的桥梁，那么Flutter包增加的复杂性就不会如此严重。但这一关键部分的大部分被排除在核心颤振项目之外，留给志愿者来处理。他们的承诺和工作质量从出色的工作到0.1版本后失去兴趣不等。如果你依赖一个专业的软件包，对你有好处。如果你依赖后者，你将不得不偿还你的债务。</p><p id="c0a3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你真正想从Flutter得到的只是用Dart编写你的应用，并部署在iOS和Android上。您被误导，认为使用这种跨平台解决方案可以让您做到这一点，同时与其他替代方法相比，节省您的时间和金钱。理论上，Flutter(以及其他跨平台解决方案)可以做到这一点。或者与Gartner交谈:在我看来，Flutter的愿景相对完整(尽管Dart距离Swift还有很长的路要走)。</p><p id="cbad" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是Flutter的执行能力仍然有很多需要改进的地方，尤其是在iOS上。这是因为对Android的偏见吗？还是他们只是缺乏经验？我不知道。但我知道的是，这是Flutter作为跨平台开发环境失败的地方。</p><p id="f14e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果一个跨平台的解决方案不能可靠地在所有支持的平台上同等地提供常用的应用功能，它就会失去相对于原生应用的优势，并且从长远来看会失去开发者的忠诚度。</p><p id="5b73" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">从我从外部看到的一点点情况来看，我严重怀疑谷歌能否成功地让Flutter开发成为像native开发一样无缝的体验。如果他们真的以此为目标，他们将需要在这个项目上投入更多的努力和人力。这同样需要大量资金、对项目的坚定承诺和对未来的清晰愿景。</p><p id="a246" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">也许我只是运气不好，而Flutter宇宙中仅有的两个有缺陷的包恰好是我的主要依赖项。但是当阅读GitHub上的公开问题时，我有点怀疑。看着我的应用程序的Flutter端口积累的技术债务，我真的为所有已经跳上Flutter列车的开发人员祈祷，谷歌会加大努力，而不是有一天失去兴趣，让项目死去。</p><p id="a772" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我自己很好奇，想知道<a class="ae kz" href="https://ionicframework.com/" rel="noopener ugc nofollow" target="_blank">离子</a>是否会做得更好。因为至少在理论上，他们在技术债务方面面临着非常相似的挑战。但这意味着要再次重写我的应用程序。如果有机会，我会让你知道事情的进展。</p></div></div>    
</body>
</html>