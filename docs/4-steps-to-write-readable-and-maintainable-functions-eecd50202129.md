# 编写可读和可维护的函数的 4 个步骤

> 原文：<https://betterprogramming.pub/4-steps-to-write-readable-and-maintainable-functions-eecd50202129>

## 让你的功能符合它们的预期目的

![](img/9ee62a50de177d116f1f95fbf820715a.png)

Max Ostrozhinskiy 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片。

函数是执行特定操作的代码块。它们是任何编程项目的基本构件。没有它们，数据就不能以理想的方式进行处理和呈现。声明好的函数是如此重要的一项技能，以至于你必须练习很长时间才能看出你在创建可读性和可维护性好的函数方面做得越来越好。

我知道不同的程序员可以开发他们自己的关于如何编写函数的管道。此外，不同的编程语言有不同的语法，所以编写只适用于一种特定语言的指南是不现实的。相反，我想分享如何以尽可能通用的方式编写可读和可维护的函数的四个一般步骤。我希望这些原则能帮助你用你选择的任何编程语言写出更好的函数。

# 1.写下你的需求

在我们开始编写一个函数之前，第一步就是确定我们现在需要什么。最常见的错误是人们没有写下他们下一个功能的当前需求。

我不是说你根本不考虑函数的用途。相反，我强调的是，你应该写下一些单词来描述你期望用新功能实现什么。

一些经验丰富的程序员可能不同意我的观点，他们告诉我，在编写一个完美的函数之前，他们通常不需要写下任何东西。嗯，我绝对相信他们说的是真的，他们也一直在这么做。写下我们为什么要为一个简单的工作编写一个函数是很乏味的。事实上，我承认我并不总是通过写下简单的功能来明确我的需求。

然而，那些高级程序员没有认识到的是，他们总是通过非常明智地命名他们的函数来隐式地标识他们的需求。合理的函数名，以及定义明确的返回数据类型，清楚地反映了要声明的函数的目的。不幸的是，许多程序员不擅长给出合理的函数名和识别正确的输出数据。

简单函数示例

“写作是逻辑思维”，这是一句我无法理解的话，直到我开始写得比以往任何时候都多。通过强迫自己写下对该功能的需求，你必须有条理地组织你的思维，这样所需的功能对你来说就不再模糊了。换句话说，您将更清楚地知道您试图操作或从函数中生成什么数据。特别是对于更复杂的函数，知道最终的输出/端点(如果函数不返回任何东西)就像在开始跑马拉松之前知道你的目的地一样。

这里有一个真实的例子。最近，我一直在使用[pandas](https://pandas.pydata.org/)——一个流行的 Python 数据操作库——进行一个数据分析项目。第一步是将单个 CSV 文件合并成一个统一的数据框架(pandas 中类似电子表格的数据结构)。

为此，我编写了一个名为`CSVs_to_df`的函数。您可能已经注意到，函数名本身非常有意义，因为它表明了它的服务目的。更重要的是，在我开始定义这个函数之前，我写了类似下面这个函数的东西:

Python 函数(CSV 到 DataFrame)

看看这个例子，这是声明函数的第一步的快速清单。中心思想是理解你到底想用这个特定的功能实现什么:

*   一句话概括功能。如果以后选择这样做，您可以将这句话扩展为更详细的注释来描述该函数。然而，如果您遵循本文中的四个步骤，您会发现这样的描述或相关的注释并不是真正需要的。
*   给一个合理的函数名。明智的名字将极大地提高代码的可读性和可维护性。永远不要低估它们的重要性。例如，`getData`在这种情况下可能不是一个好名字。
*   确定最终返回数据。你可以命名一个伪变量(当然，也要有一个合理的名字)作为函数的返回数据。请记住，这是你第一步可能要做的最重要的事情。
*   列出所有已知的所需输入参数。在这个阶段，你可能知道你的函数需要一两个参数。但是您可能会发现您的函数需要更多的输入数据——在后面的步骤中。

# 2.考虑现有解决方案

假设你现在 100%清楚你的需求，请控制住你开始写函数的冲动。我已经痛苦地认识到，匆忙编写函数，尤其是一个超级复杂的函数，是一个错误——尤其是如果你是一个自学成才的程序员。

一个常见的误解是，一些程序员，不管他们的经验水平如何，都认为他们必须——或者只是喜欢——自己编写所有需要的函数。然而，迟早，我们会很容易发现我们浪费了很多宝贵的时间。

为什么会这样？我指的是什么教训/错误？

当我们深入编写自己的函数时，经常发生的情况是，我们无法检查是否已经开发了替代解决方案，无论是通过语言的内置标准框架还是开源库。

例如，在我的生物医学研究领域，我们的数据以 CSV 格式保存是很常见的。CSV 文件以列作为变量名，以行作为研究对象的数据记录。我们的数据处理管道的第一步是读取 CSV 文件——这是我们在上一节中学习识别的函数的需要。

如果我们不主动想出任何现有的解决方案，我们最终可能会写出如下所示的函数。基本上，我们将使用最基本的函数来读取文本文件并逐行解析数据。为了简化示例，我们假设 CSV 数据没有标题。

Python 函数(CSV 到 dict)

我们在这里犯的错误是，我们没有探索和利用现有的解决方案，这些解决方案通常更加完善。对于相同的任务(即读取 CSV 文件进行数据分析)，我们应该查看 pandas 库中可用的选项，使用这些选项可以像下面这样重新编写函数。当然，我们将修改输出数据，因为 DataFrame 数据类型对后续数据处理步骤更友好。你不觉得我们的函数变得更可读了吗？

Python 函数(CSV 到 DataFrame)

上面的例子是关于一个简单的数据导入函数。但是在实际项目中，我们可能会在更多的地方找到现有的更好的解决方案。现有的功能已经解决了我们的重担。我们的职能应该更多地关注我们正在工作的内容领域所特有的东西。

然而，我并不是说你应该让你的项目严重依赖于众多的第三方库。相反，我要说的是，你应该思想开放，并理解存在良好的替代解决方案的可能性。即使你不必使用这些解决方案，它们也能给你一些思路——尤其是当你面临一个难题的时候。

# 3.原型

在我们做了上面的评估之后，我们决定我们需要写函数。所以是时候写原型了。需要注意的一点是，我们并不是真的在谈论编写简单的函数。在这些情况下，我们可以不用太多的逻辑思考和结构组织来编写代码。相反，这里的原型是指开发更复杂功能的工作版本(逻辑上复杂或者简单乏味，涉及多个组件)。

假设我们正在为一个 iOS 应用程序创建用户档案视图。为此，我们将有一个`User`结构(尽管没有实现细节)来存储用户的数据。

用户结构

让我们看一些关于如何创建用户概要视图的伪代码，之后我们将讨论更多关于函数原型的内容。

创建用户个人资料视图的 Swift 代码

我们正在讨论的函数是`createProfileView`，如上面的代码所示。函数原型本质上关注于编写函数体。我将强调原型制作步骤中我们需要注意的四个关键事项:

*   就像函数名一样，所有的变量名都应该合理命名，这样我们就不需要写任何额外的注释而不损失任何可读性。
*   确定函数需要的所有参数。你可能已经知道从什么论点开始了。当您进行原型设计时，您可能会发现函数需要更多的参数。您将决定括号中需要包含哪些参数，以便调用者指定它们。或者其他一些输入数据需要是一些全局变量，你可以从其他地方得到。
*   尽可能多地编写函数。你现在不需要担心你的函数变得太长。冗长的嵌套函数容易出错，但是我们将在下一节解决这个问题。
*   根据需要运行并修改代码，直到它正常工作。记住，你不必现在就让你的功能变得完美。但是，在进入下一步之前，您确实需要确保它能够工作。

# 4.重构

一旦有了函数的工作版本，就该重构它来改进函数的组织，从而提高可读性。这是关键的一步，可以极大地增强函数及其相关代码的可维护性。这也是很多初级程序员最容易忽略的一步。一旦他们有了工作，他们就称之为完成。大不了！

继续上面讨论的例子，让我们看看我们应该如何重构代码。首先，我们将创建一些助手函数，它们将在更新版本的`createProfileView`函数中使用。创建一些助手函数的想法是，我们可以将一些不太相关的代码移到函数之外，这样函数变得更精简，更容易阅读和维护。

函数重构的唯一原则就是让函数变小。

更具体地说，在重构之后，我们希望所有的功能都很小，只负责一项工作。例如，`createProfileView`功能将只为用户创建一个个人资料视图。所有其他代码都不太相关，应该重新组织，形成自己的小功能和专门的工作。我们可以考虑以下几个方面来重构功能:

*   获取所需的数据。该操作与`User`数据结构更相关。因此，我们现在在更新的`User`结构中获取概要文件图像的数据。当然，这应该是一个异步请求，对此的讨论超出了本文的范围。
*   特定 UI 组件的重复使用。例如，假设标签需要特殊格式才能在纵断面图中使用，我们可以创建标签作为`UILabel`类的扩展，这样我们就不需要重复创建多个相同格式的标签。
*   数据格式。在下面的代码中，我们实现了一个函数来处理显示的数字，作为`String`类的扩展。这个想法是，这个字符串格式(或一般的数据格式)可以独立于`createProfileView`函数而存在。

助手方法

随着这些助手方法的创建，下面的代码片段向您展示了`createProfileView`函数的更新版本。正如您所看到的，重构后的函数看起来更加清晰，可读性更好。如果有人审查代码，他们可以相对快速地检查一遍，并理解该功能在做什么。

重构函数

需要再次强调的一点是，所有辅助函数的命名都非常合理。因此，代码审查者(或者当你回来维护代码时，你自己)甚至不需要检查助手函数的实现，如果他们选择不这样做的话，因为这些助手函数的名称清楚地表明了它们的预期目的。

事实上，我们可以进一步重构`createProfileView`函数。为什么？因为我们可以做更小的函数。在我们的例子中，每个 UI 组件需要两行代码来配置，但是每个配置可能需要更多的代码。因此，我们应该考虑采取以下措施:

重构函数(替代)

如您所见，我们为单个 UI 组件创建了更多的函数。重要的是，所有这些函数都很小，并且每个函数只做一项工作。记得吗？这就是函数重构的原则！

比较这两个重构版本，我们可以学到一个实现更好的可读性和可维护性的重要技巧——结构一致性。

结构一致性一般是什么意思？在函数体中，子组件应该有相似的结构。在重构函数的第一个版本中，所有 UI 元素都在函数中配置，具有相似的长度。在第二个版本中，所有 UI 元素都在各自的函数中单独配置，这些函数依次嵌套在重构后的函数中。

你明白重点了吗？无论您最终使用哪个版本，您都应该在重构中优先考虑结构一致性。最终版本应该包含一定数量的函数——更准确地说，是每个函数执行一项工作的小函数。

当然，在重构之后，您应该再次运行该函数以确保不会出错。

# 结论

在本文中，我们回顾了编写可读和可维护的函数的四个步骤。正如我在开始时所说的，在你能写出更好的函数或更简洁的代码之前，需要大量的练习——真正好的练习。但是意识到这些最佳实践(例如，好的名字和结构一致性)可以帮助你更快地到达那里。