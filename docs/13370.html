<html>
<head>
<title>How To Fix Error 413 in Apps Behind Nginx on AWS Elastic Beanstalk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何修复AWS Elastic Beanstalk上Nginx后面的应用程序中的错误413</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-fix-error-413-in-apps-behind-nginx-on-aws-elastic-beanstalk-c68a1ef2c331?source=collection_archive---------2-----------------------#2022-08-22">https://betterprogramming.pub/how-to-fix-error-413-in-apps-behind-nginx-on-aws-elastic-beanstalk-c68a1ef2c331?source=collection_archive---------2-----------------------#2022-08-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dfb4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">解决了使用Nginx作为反向代理时“413请求实体太大”的错误</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/43603a6d06a77fb4c1d81f46b6104192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4qGSniUXGc7ZBfUL"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">穆罕默德·拉赫马尼在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2c90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近处理了一个运行在AWS Elastic Beanstalk上并使用Nginx作为反向代理的应用程序的错误413。当客户端发出的请求超过web服务器大小限制时，Nginx会生成此错误。我在网上找到了这个问题的几种可能的解决方案，但是都没有解决。</p><p id="d89b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过几次尝试，我终于找到了一个解决方案，也是由官方AWS EB文档支持的。</p><p id="c7c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们来看看“413请求实体太大”错误是什么，以及如何在Nginx中和当Nginx作为AWS Elastic beanstalk上的反向代理时解决它。</p><h1 id="5535" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是HTTP错误413？</h1><blockquote class="mn mo mp"><p id="c904" class="kz la mq lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">HTTP <code class="fe mu mv mw mx b">413 Payload Too Large</code>响应状态代码表明请求实体大于服务器定义的限制；服务器可能会关闭连接或返回一个<code class="fe mu mv mw mx b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Retry-After" rel="noopener ugc nofollow" target="_blank">Retry-After</a></code>头字段。—<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/413" rel="noopener ugc nofollow" target="_blank">MDN“413有效负载过大”页面</a></p></blockquote><p id="cafe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，HTTP <code class="fe mu mv mw mx b">413 Payload Too Large</code>状态代码<a class="ae ky" href="https://www.rfc-editor.org/rfc/rfc2616#section-10.4.14" rel="noopener ugc nofollow" target="_blank">之前被称为</a>T3。详细来说，记住大多数情况下，还是这么叫的。因此，如果您遇到“请求实体太大”错误，您可以假设这是一个HTTP <code class="fe mu mv mw mx b">413 Payload Too Large</code>错误。</p><p id="7ad7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看这篇文章，了解如何修复Node.js上的HTTP错误413。</p><div class="my mz gp gr na nb"><a href="https://javascript.plainenglish.io/how-to-fix-413-request-entity-too-large-error-in-node-js-226c0070e4f4" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">如何修复Node.js中的“413请求实体太大”错误</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">解决Express中的HTTP“413有效负载过大”错误</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ks nb"/></div></div></a></div><h1 id="378a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">修复Nginx中的错误“413请求实体太大”</h1><p id="c060" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">如前所述，Nginx只接受有效负载小于MB的请求。这个限制性的限制是“413请求实体太大”错误的原因。为了避免这种情况，您可以简单地将<code class="fe mu mv mw mx b">client_max_body_size</code>选项设置为一个更大的值。</p><p id="88ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，您必须编辑<code class="fe mu mv mw mx b">/etc/nginx/nginx.conf</code>文件。</p><p id="ecae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe mu mv mw mx b">http</code>块中的<code class="fe mu mv mw mx b">client_max_body_size</code>设为影响所有虚拟主机:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="c101" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mu mv mw mx b">server</code>块中设置<code class="fe mu mv mw mx b">client_max_body_size</code>以影响特定网站或网络应用。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="1728" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mu mv mw mx b">location</code>块中设置<code class="fe mu mv mw mx b">client_max_body_size</code>以影响特定网站或web应用程序的特定目录。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="336c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，保存<code class="fe mu mv mw mx b">/etc/nginx/nginx.conf</code>文件，并使用以下命令重启Nginx web服务器以应用最近的更改:</p><pre class="kj kk kl km gt nx mx ny nz aw oa bi"><span id="80a4" class="ob lw it mx b gy oc od l oe of">systemctl restart nginx </span><span id="ee48" class="ob lw it mx b gy og od l oe of">service nginx restart</span></pre><p id="45a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恭喜你。您刚刚将Nginx请求实体大小限制从1MB扩展到10MB。</p><h1 id="e173" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在AWS Elastic Beanstalk上配置Nginx以避免错误413</h1><p id="2660" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">不幸的是，要将上述解决方案应用到AWS Elastic Beanstalk上使用Nginx作为反向代理的应用程序，您应该在每个实例上手动配置Nginx。</p><p id="2947" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个AWS EB实例都是从头开始创建的，不与其他实例共享web服务器配置。因此，每次添加新实例时，您可能需要通过SSH来配置Nginx，如前所示。你可以想象，这不是一个可行的解决方案。</p><p id="43af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，正如在<a class="ae ky" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/platforms-linux-extend.html" rel="noopener ugc nofollow" target="_blank">“扩展Elastic Beanstalk Linux平台”</a>文档页中所解释的，AWS Elastic Beanstalk允许您在用作反向代理时扩展默认的Nginx配置。这个自定义配置由所有AWS EB实例共享。</p><p id="1304" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">按照以下步骤扩展AWS Elastic Beanstalk上的Nginx默认配置，以避免“413请求实体太大”错误。</p><ol class=""><li id="3040" class="oh oi it lb b lc ld lf lg li oj lm ok lq ol lu om on oo op bi translated">确保您的应用程序源代码包有一个<code class="fe mu mv mw mx b">.platform</code>文件夹。如果不存在，请创建它。</li><li id="6b8a" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated">在应用程序源代码包的<code class="fe mu mv mw mx b">.platform/nginx/conf.d/</code>路径中创建一个<code class="fe mu mv mw mx b">XXX.conf</code>配置文件。您可以随意命名这个<code class="fe mu mv mw mx b">.conf</code>文件。比如你可以叫它<code class="fe mu mv mw mx b">proxy.conf</code>。</li><li id="a7c0" class="oh oi it lb b lc oq lf or li os lm ot lq ou lu om on oo op bi translated">如下初始化您的<code class="fe mu mv mw mx b">.conf</code>文件:</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="24f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是您的应用程序源代码包中的<code class="fe mu mv mw mx b">.platform</code>文件夹现在的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/67bf05f5a2758705894237375e8a06e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sErNtvR4p_A-KK5duDg0sQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe mu mv mw mx b">.platform/nginx/conf.d/proxy.conf</code></p></figure><p id="b4c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊！当AWS Elastic Beanstalk作为反向代理使用Nginx时，您刚刚定义了一个扩展配置来避免413错误。</p><h1 id="69ea" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="b6d3" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">在本文中，您看到了什么是HTTP错误413以及它为什么会出现。具体来说，您有机会学习如何修复Nginx web服务器上的“413请求实体太大”错误。此外，您还了解了如何使用Nginx作为反向代理将该解决方案应用于AWS Elastic Beanstalk环境。</p><p id="63b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！我希望这篇文章对你有所帮助。请随意留下任何问题、评论或建议。</p></div></div>    
</body>
</html>