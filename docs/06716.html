<html>
<head>
<title>Sharp: A High-Performance Image Processing Library for Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">sharp:node . js的高性能图像处理库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/sharp-high-performance-node-js-image-processing-library-3f04df66c722?source=collection_archive---------3-----------------------#2020-10-28">https://betterprogramming.pub/sharp-high-performance-node-js-image-processing-library-3f04df66c722?source=collection_archive---------3-----------------------#2020-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1ad7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">夏普是一个高性能的调整图像大小和格式的模块</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3f613d94fd4b0150bd1cec961ef1a82b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cN2PeQqzkNahHSby"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯蒂娜@ wocintechchat.com在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8c19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在构建现代、快速和用户友好的应用程序时，图像是您应该熟悉的难题的一大部分。每个应用程序都以某种方式使用图像。</p><p id="03cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，用户想要调整他们个人资料照片的大小，商家想要塑造他们的图片，这样他们就能吸引买家，等等。</p><p id="6258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">处理大型图像是令人沮丧的，因为加载它们要花很长时间，存储到数据库中更令人沮丧。有一种方法可以让我们的图像更加用户友好，加载速度更快，甚至质量更高。</p><blockquote class="lv lw lx"><p id="616d" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">Sharp library模块的典型用例是将常见格式的大图像转换为不同尺寸的较小的、web友好的JPEG、PNG和WebP图像。—根据夏普官方文件</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/674c73cce4cd54a7c228768046fad55c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-K-79gOMprM607rNBTkIw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">夏普Github库—来源:<a class="ae ky" href="https://github.com/lovell/sharp" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="7d95" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">格式</h1><p id="45a9" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">Sharp库支持读取JPEG、PNG、WebP、TIFF、GIF和SVG图像。</p><blockquote class="lv lw lx"><p id="8e22" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">输出图像可以是JPEG、PNG、WebP和TIFF格式，也可以是未压缩的原始像素数据。</p><p id="79ad" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">流、缓冲区对象和文件系统可以用于输入和输出。</p><p id="47d3" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">单个输入流可以被分成多个处理流水线和输出流。</p><p id="57f4" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">可以生成深度缩放图像金字塔，适用于像<a class="ae ky" href="https://github.com/openseadragon/openseadragon" rel="noopener ugc nofollow" target="_blank"> OpenSeadragon </a>这样的“滑动地图”平铺查看器。—根据夏普官方文档页面。</p></blockquote></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="97e4" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">入门指南</h1><p id="41f6" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">Sharp库的先决条件如下:</p><ul class=""><li id="5410" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated">Node.js v10.16.0+版</li></ul><h2 id="e8c7" class="nq ml it bd mm nr ns dn mq nt nu dp mu li nv nw mw lm nx ny my lq nz oa na ob bi translated">通过纱线安装</h2><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="934b" class="nq ml it od b gy oh oi l oj ok">yarn add sharp</span></pre><h2 id="edb6" class="nq ml it bd mm nr ns dn mq nt nu dp mu li nv nw mw lm nx ny my lq nz oa na ob bi translated">通过NPM安装</h2><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="50d7" class="nq ml it od b gy oh oi l oj ok">npm install sharp</span></pre></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="b84f" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">调整图像大小</h1><p id="fefc" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">假设我们有一个很大的图像，需要很长时间来加载。我们应该适当地调整它的大小，并大幅减少应用程序的加载时间，而不是提供如此大的图像。</p><p id="c6af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，Sharp库很有逻辑性，使用起来也很简单。为了调整图像的大小，Sharp只需要我们提供图像的路径、新的尺寸以及新调整的图像的输出路径。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="8952" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码获取原始图像并将其调整为<strong class="lb iu"> 500x450 </strong>的尺寸。</p><div class="kj kk kl km gt ab cb"><figure class="on kn oo op oq or os paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/0d2d1f610290ccfc88940984099d6176.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*KM_qA5t_8GEhXXyNF_D9JQ.png"/></div></figure><figure class="on kn ot op oq or os paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/cd04785d0ea44df52e40f4625530dc6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*0K_Zv_LGvD59xPcrK-BM0Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk ou di ov ow translated">在右边，我们有调整大小的图像，在左边，我们有原始的大图像。</p></figure></div><p id="2a6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个交互式的<a class="ae ky" href="https://codesandbox.io/s/magical-feather-ushwn?file=/src/sharp-example.js" rel="noopener ugc nofollow" target="_blank"> CodeSandBox </a>演示，以防你有兴趣在浏览器中尝试这些演示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox om l"/></div></figure><p id="20dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但这还不是全部！您可以对任何图像执行的操作有一个很大的列表。<a class="ae ky" href="https://sharp.pixelplumbing.com/api-resize" rel="noopener ugc nofollow" target="_blank">点击这里查看调整大小操作的完整列表</a>。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="7f13" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">格式化图像</h1><p id="cb05" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">改变图像格式非常简单——只需将函数链接在一起。Formatting有一个<code class="fe oy oz pa od b">.toFormat()</code>函数，它将新格式作为参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="5958" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们将图像质量提升到了<code class="fe oy oz pa od b">100</code>——这是图像所能达到的最高质量。</p><p id="c2d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">质量说明符是一个整数。任何给定图像的范围是从<code class="fe oy oz pa od b">1</code>到<code class="fe oy oz pa od b">100</code> —更多信息可以在找到<a class="ae ky" href="https://sharp.pixelplumbing.com/api-output#jpeg" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/a10b95b686a3533c557f49737428889f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6nE4WOcj7OmIu9Pl1emag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">提高任何图像格式的图像质量—来源:<a class="ae ky" href="https://sharp.pixelplumbing.com/api-output#examples-5" rel="noopener ugc nofollow" target="_blank">像素管道</a></p></figure><p id="3bad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们运行代码，一个<code class="fe oy oz pa od b">output.png</code>文件就会出现在我们的项目中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/e4ce77ef428319ce5886688b1dfe0655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJR4zKdjkyWgTvlqQDkotg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们创建了一个名为<strong class="bd pd">output.png</strong>的新图像</p></figure><blockquote class="lv lw lx"><p id="d227" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">PNG输出总是8或16位/像素的全色。每像素1、2或4位的索引PNG输入被转换为每像素8位。</p><p id="af5b" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">其中一些选项需要使用全局安装的libvips，该lib VIPs编译时支持libimagequant (GPL)。—根据夏普官方文档。</p></blockquote></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="6afc" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">将图像存储到数据库中</h1><p id="179a" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">如果您正在处理用户配置文件，您可能希望将图像保存到数据库中。以下是您可以做到这一点的方式和位置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用promises调整图像大小并将其存储在数据库中</p></figure><p id="ed43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意夏普是如何回应承诺的。每当我们完成对实际图像本身的任务时，我们可以使用这个承诺并采取行动。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="dcad" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">异步/等待示例</h1><p id="788a" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">也有可能使用async/await语法来代替promises。这里有一个简单的例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用async/await语法调整图像大小并将其存储在数据库中</p></figure><p id="3892" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您不确定或者不熟悉async/await语法，我会帮您解决的！请查看“<a class="ae ky" href="https://medium.com/better-programming/improve-your-asynchronous-javascript-code-with-async-and-await-c02fc3813eda" rel="noopener"> <strong class="lb iu">如何使用Async改进您的异步JavaScript代码并等待</strong> </a>”进行深入探讨。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="f2ea" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">旋转图像</h1><p id="b226" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">使用Sharp可以轻松进行旋转图像等简单操作。调用<code class="fe oy oz pa od b"><a class="ae ky" href="https://sharp.pixelplumbing.com/api-operation#rotate" rel="noopener ugc nofollow" target="_blank">rotate</a></code>函数，将图像旋转多少度。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="a7dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是上面的例子在代码中的样子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/568464485e717dfe8e582ce5bfc11e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s823qNsNP3URtKo3SjXexA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将图像旋转180度</p></figure><p id="6dca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想将图像旋转180度，也可以使用<code class="fe oy oz pa od b"><a class="ae ky" href="https://sharp.pixelplumbing.com/api-operation#flip" rel="noopener ugc nofollow" target="_blank">flip</a></code>功能。这将产生与上面相同的输出。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="af9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是互动演示，你自己去看看吧。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox om l"/></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="69d3" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">证明文件</h1><p id="8f59" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">如果你好奇或感兴趣，请访问sharp.pixelplumbing.com<a class="ae ky" href="https://sharp.pixelplumbing.com/" rel="noopener ugc nofollow" target="_blank">的</a>获取完整的<a class="ae ky" href="https://sharp.pixelplumbing.com/install" rel="noopener ugc nofollow" target="_blank">安装说明</a>、<a class="ae ky" href="https://sharp.pixelplumbing.com/api-constructor" rel="noopener ugc nofollow" target="_blank"> API文档</a>、<a class="ae ky" href="https://sharp.pixelplumbing.com/performance" rel="noopener ugc nofollow" target="_blank">基准测试</a>，以及<a class="ae ky" href="https://sharp.pixelplumbing.com/changelog" rel="noopener ugc nofollow" target="_blank">变更日志</a>。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="3501" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">贡献的</h1><p id="1e15" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">想参与开源吗？这里有一个给贡献者的<a class="ae ky" href="https://github.com/lovell/sharp/blob/master/.github/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank">指南，涵盖了报告bug、请求特性和提交代码变更。</a></p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="61a5" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">结论</h1><p id="ad4f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">感谢阅读。编码快乐！</p></div></div>    
</body>
</html>