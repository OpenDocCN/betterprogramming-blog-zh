# 异常代码:在 Python 中使用 try-except

> 原文：<https://betterprogramming.pub/exceptional-code-using-try-except-in-python-540b6416db79>

## Python 中异常的处理与其他一些语言略有不同。那么，我们何时以及如何使用 try-except 呢？

![](img/d41faa504f1cf4694ba37ca6aeac4e74.png)

里克·桑切斯在 [Unsplash](https://unsplash.com/s/photos/exceptional?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

# 快速介绍

如果您曾经对如何或何时使用 Python 中的 try-except 块感到困惑，您并不孤单。让我们看看什么是 try-except，什么时候使用它最好，以及我们如何在 Python 中使用它。

首先，让我们快速思考一下*异常*这个词是什么意思。在字典中，它被定义为:

> **/ɪkˈsɛpʃ(ə)n,ɛkˈsɛpʃ(ə)n/**——被排除在一般陈述之外或不遵守规则的人或事。

同样，在编程的环境中:

> **异常**是在执行**程序**期间发生的事件，它扰乱了正常的指令流。

# Python 中的异常

程序员处理异常的方式取决于他们所使用的语言的文化规范，以及他们所选择的语言的异常处理程序的工作和执行方式。

经常有一些相当激烈的建议，关于*永远不要*使用 try-except，除非是灾难性的、低级别的事件，并确保将所有其他事情隔离到传统的流控制中(例如 if-else)——这在许多语言中都是正确的。

在 Python 中，事情有点不同。尽管我们需要对它的正确使用保持敏感，但使用 try 是一种正常且相当常见的做法——除了流控制，这是 Python 核心中常用的一种模式。

也就是说，我们不应该过度使用它，寻找大量使用它的机会，或者在 try-except 块中包装长的应用程序代码块(原因我们将很快介绍)。

但是，重要的是，在 Python 中，我们不需要害怕使用 try——除了管理某些事件——特别是如果它们可以调用不可忽略的结果，并且可以在适当的时候帮助干净地管理程序的主流程。

# 那么，我们如何使用 try-except？

在我们编写 try-catch 块之前，我们想问:

*   我们认为这里会出什么问题？
*   我们可以向开发者或用户返回哪些有用的信息？
*   我们如何确保不泄露太多信息，并保持安全？

## 一个工作实例

一个好的常见用例是从外部源请求数据，比如 API 端点。

让我们举一个假设的例子——我们正在使用伦敦的 [TFL API](https://api.tfl.gov.uk/) 为伦敦皮卡迪利广场的公交车站构建一个数字到达板！

为此，我们需要 ping Piccadilly Circus stop point API 端点，使用其适当的端点:[https://api.tfl.gov.uk/StopPoint/490000179F/arrivals](https://api.tfl.gov.uk/StopPoint/490000179F/arrivals)，以 JSON 格式返回其即将到来的到达。

如果没有成功返回的数据内容，我们的数字公交站牌根本做不了什么。

这个 API 调用是一个潜在的破坏点——它是我们无法控制的第三方资源，有时，它可能会经历意外的停机时间。那么，如果它关闭了，我们的代码会发生什么呢？

使用 try-catch，我们可以简单地确保一个坏的响应不会破坏我们的程序，通过编写:

(更好的是，在这个实例中，我们实际上使用了 Requests 库中内置的`raise_for_status`函数，它将自动为我们捕捉任何 HTTP 问题，并很好地精简我们的代码。)

## 好吧，那么什么是"*其他"*？

在一个 try-except 块中使用`else:`的一个有用之处就是稍微美化了一下我们的代码。

这意味着我们可以在相同的缩进层次上可视化地对齐异常和常规操作的结果，而不是超越下面的指令。

(这种特殊的用法是可选的，严格来说不是必需的，但是从结构上来说，感觉很有条理，所以很好。)

## `And, "finally"...`

`finally:`在尝试结束时执行——除了在**所有情况下** *—* 即使前一行用 *return* 语句求值。

要小心这一点——它用于不管块中其他任何东西而发生的事情。

例如，这对于关闭打开的文件是很有用的，这样当你移动到下一个操作时，不管结果如何，你都不会不小心让它们打开。

# 所以，一般来说

*   不要害怕——但是要仔细思考并战略性地使用它。
*   避免包装大块代码——这是因为您需要将一个`try`隔离到一个特定的调用或动作，该调用或动作可能会产生一个单一的、不可忽略的结果，从而使您能够`catch`那个特定的异常。如果您将一组不同的任务打包到一个 try 中，那么您可能会在代码中引发异常，而这些代码本来就不应该受到保护。这很笨拙，会导致意外的副作用，并且在调试时令人头疼。
*   千万不要把它们当作 if/else 语句使用— 出于上述原因，大多数时候，你会希望使用 if/else 语句，尤其是在设计你的主要流控制时。

编码快乐！

托马斯·卡尔