# 构建分析数据模型时的 10 个常见错误

> 原文：<https://betterprogramming.pub/10-common-mistakes-when-building-analytical-data-models-814c763d1b70>

## 通过避免这些陷阱做出更好的设计选择

![](img/7ce2947010bdf00d37d6bd076acf50e3.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的 [ThisisEngineering RAEng](https://unsplash.com/@thisisengineering?utm_source=medium&utm_medium=referral)

为分析设计数据模型与为事务处理设计数据模型是不同的。您针对与 OLTP 系统中使用的行级数据检索非常不同的访问模式进行了优化。在本文中，我们将研究在为分析设计模式和表时最常见的陷阱。

# 1.将模式设计视为一次性项目

构建数据资产是一个持续的过程。随着您的分析需求随着时间的推移而变化，模式也必须进行调整。将数据建模视为一次性活动是不现实的。想想那些因为一个源系统中的数据结构发生变化而不得不更改列名、数据类型甚至重建整个表的时候。

同样，您可以构建一个在特定时间完全适合用例的模式。但是，当数据继续增长或源系统发生变化(新的 ERP、CRM、PIM 系统)时，由于下游工作负载或性能优化的必要变化，设计工作会继续进行。

# 2.构建太大的表和 ETL 过程

假设您正在构建营销成本归属的数据管道。与其将它实现为一个巨大的 ETL 过程，产生一个单一的表，不如有一个初始过程，首先将来自不同渠道的所有原始(尚未归属的)成本合并到一个中间表中。然后，该表可以被执行属性的一些下游过程使用。

从长远来看，拆分和解耦数据转换将使整个过程更容易构建、调试和维护。此外，中间表对于对原始数据感兴趣的最终用户来说非常有价值(在进行任何计算和转换之前的*)。如果最终表中的某些内容看起来不合理，您可以更深入地研究上一步的数据，以调查发生了什么以及原因。*

# *3.选择(并坚持)错误的建模方法*

*有许多建模技术，如星型模式、雪花模式或数据仓库。如果过去有人决定遵循一个**雪花模式**，那么拥有一个维度“product”将不符合第三范式，并且构建它将违反所选择的建模方法。相反，您必须将它分成额外的维度，如“产品类别”或“品牌”,以规范化数据，而不管它对您的用例是否有意义。*

*类似地，当您坚持使用**数据仓库**建模时，您会将每个表拆分成[集线器、卫星和链接](https://en.wikipedia.org/wiki/Data_vault_modeling)，即使对于特定的用例来说没有这样做的逻辑理由。虽然工程中需要严谨，但是所有的数据建模技术都是一套指南，而不是应该盲目遵循的硬性规则。*

*需要大量连接的数据设计(如 data vault)可能会由于并行负载而提供更快的数据接收，但它通常会损害查询性能，并且对于许多人来说，使用起来很不舒服。通过在分布在集线器、卫星和链路上的数据上创建 SQL 视图，可以在一定程度上缓解这个问题。这样的视图让我们避免了重复的多连接查询，从而为处理这些数据的每个人节省了大量时间。*

*没有“最好的”数据建模方法，一切都是有得有失。但是请记住，许多数据仓库建模技术是在存储昂贵的时代设计的。如今，与工程时间相比，存储和计算都很便宜。因此，非规范化的分析模式通常会提供更好的用户体验(更少的连接，更少的搜索正确数据的时间)，而不会对性能产生负面影响。*

# *4.缺乏对最终用户的同情*

*每当您构建新的表或流程时，都要努力为最终用户着想。最终谁会查询这个表？这是一位对查看汇总值感兴趣的经理吗？如果是这样，那么在已经应用了这些聚合的地方构建一个额外的视图或表可能是有意义的。或者，这将是一个业务分析师，他更喜欢在日常数据工作中使用更少连接的更直观的非规范化设计？*

# *5.不跟踪对数据所做的更改*

*你可能听说过[缓慢变化的维度](https://en.wikipedia.org/wiki/Slowly_changing_dimension)，它可以帮助你跟踪维度表是如何随时间变化的。例如，如果一个客户修改了他或她的电子邮件地址，您的表将为该客户获得一个额外的行——每个行将包含`VALID_FROM`和`VALID_TO`时间戳，显示各个维度数据如何随时间变化。*

*在过去，构建 [SCD2 逻辑](https://rob-davidson.co.uk/2019/01/28/type-2-slowly-changing-dimension-with-snowflake.html)是复杂的，并且经常是相当重复的——您需要基于散列差异构建您自己的合并逻辑，或者可能您不得不依赖一些(糟糕的)拖放式 ETL 产品来完成这项工作。但是现在，您可以随意使用 dbt 这样的工具— [dbt 快照](https://docs.getdbt.com/docs/building-a-dbt-project/snapshots)使 SCD2 的实现变得轻而易举。拥有这些`VALID_FROM`和`VALID_TO`字段将为您在调查数据中的不一致性时节省大量时间。*

# *6.混合不同粒度的数据*

*为表定义一个主键被认为是一种最佳实践，这样通过查看主键，用户就可以知道数据的粒度。*

*例如，假设您的表正在跟踪每天的用户登录。这意味着您的粒度是每日的，您的主键可能由`USER_ID`和`DATE`组成。现在，企业希望您开始区分高峰时段和非高峰时段的登录数量。您的粒度变为每个用户每天两行:一行用于高峰时间，一行用于非高峰时间。*

*如果在同一个表中实现这一更改，将会导致混合粒度，这反过来可能会给处理这些数据的每个人带来困惑。因此，创建一个全新的表是有意义的，它的粒度和主键都发生了变化。`USER_ID`、`DATE`、`PEAK_TIME`(对或错)。*

# *7.使用糟糕的命名约定*

*命名是工程中最被低估的活动之一。好的或坏的命名约定可以在拥有一个伟大的或仅仅是好的(甚至是平庸的)数据产品之间产生差别。我的一位同事经常重复这句话，这句话很好地概括了这一点:*

> *"计算机科学中只有两个难题:缓存失效和事物命名."— [菲尔·卡尔顿](https://www.karlton.org/2017/12/naming-things-hard/)*

*使用只有很少人理解的晦涩的列名和缩写，并且不将其记录在数据字典中可能会导致很多麻烦。*

# *8.太多视图*

*视图很容易构建，但是它们不能提供与普通表相同的性能。如果您开始基于视图构建下游数据转换，随着时间的推移，事情可能会变得缓慢。[在这里](https://docs.getdbt.com/docs/building-a-dbt-project/building-models/materializations)你可以找到不同类型物化的利弊。*

*总的来说，视图最适合于简单的转换，比如更改列名。对于其他用例，您可以根据底层数据更改的频率，在完全表刷新(每次运行时都重建表)或增量模型(对新的/更改的数据进行上插)之间进行选择。*

# *9.目光短浅*

> *“生活中唯一不变的就是变化。”—赫拉克利特*

*您不太可能“完成”您的数据建模。事物总是在变化的。同时，一旦您将新的数据资产集成到您的系统中，就很难将它们取出来。它们将被用在下游过程中，引入依赖关系并使后面的更改更具挑战性。每当您构建新的数据模型时，最好记住:*

*   *数据将如何更新—新数据是否可以轻松地重新加载或回填？*
*   *在执行增量加载时，我们是否需要添加一个合并逻辑和诸如`CREATED_AT`和`UPDATED_AT`之类的列来防止重复？*
*   *哪些表和流程依赖于这些数据？我们能追踪它吗？*
*   *您的数据仓库或数据湖(房子)是否能够随着您的数据一起增长？[存储和计算如何扩展？](https://towardsdatascience.com/why-you-are-throwing-money-away-if-your-cloud-data-warehouse-doesnt-separate-storage-and-compute-65d2dffd450f)*
*   *您是否有一个可以随时更新的数据字典和文档机制？*

# *10.数据消费者之间的沟通不足*

*有时，我们仅仅因为沟通问题而以次优的数据设计告终。总会有一些利益冲突:*

*   *操作数据管道的数据(平台)工程师希望建立稳健的工程流程，并最大限度地降低运营风险*
*   *数据科学家希望获得尽可能多的原始数据，并自行决定如何为 ML 用例构建特性并从这些数据中推断信号*
*   *构建前端数据应用程序的软件工程师希望与他们的技术体系无缝集成*
*   *数据分析师*
*   ***管理人员努力实现标准化、安全性、最小化风险和控制成本***

***有许多工具有助于减轻不同用户组之间切换时的摩擦。其中之一就是 GoodData。云原生的 [GoodData 平台](https://www.gooddata.com/developers/cloud-native-community-edition/)允许:***

*   ***数据工程师构建语义数据模型***
*   ***软件工程师通过利用 [GoodData API](https://www.gooddata.com/developers/cloud-native/doc/) ，直接在 React、TypeScript 或 JavaScript 应用程序中使用这些数据模型***
*   ***通过利用数据和前端应用程序设计之间的 API，分离两者之间的关注点***
*   ***构建可以跨仪表板和分析应用程序重用的小组件(见解、指标、KPI、可视化)***
*   ***度量标准的集中来源— [GoodData API](https://www.gooddata.com/developers/cloud-native/doc/) 将语义模型作为服务公开，并帮助确保所有数据消费者在整个组织中使用一致的度量标准和洞察力***

***要开始使用 GoodData 的[免费社区版](https://www.gooddata.com/developers/cloud-native-community-edition/?utm_source=mediumcom&utm_medium=referral&utm_campaign=gdcn&utm_content=anna-10mistakes)，您可以运行一个[单 Docker](https://hub.docker.com/r/gooddata/gooddata-cn-ce) 容器:***

```
***docker run --name gooddata -p 3000:3000 -p 5432:5432 \
  -e LICENSE_AND_PRIVACY_POLICY_ACCEPTED=YES gooddata/gooddata-cn-ce:latest***
```

***要深入了解云原生 BI 平台及其所有优势，您可以看看我的文章[关于分离您的 BI 堆栈。](https://medium.com/gooddata-developers/here-is-what-happens-if-you-decouple-your-bi-stack-cd365a97ee74)如果您想在 Kubernetes 集群中直接尝试，您可以使用下面的[掌舵图](https://www.gooddata.com/developers/cloud-native/#plans)。***

***感谢您的阅读！***