# 域名和重定向:域名系统是如何工作的？

> 原文：<https://betterprogramming.pub/debunking-the-complexities-in-understanding-dns-b4374e6ca7e5>

## 理解 DNS 是非常简单的，希望这篇文章将有助于揭穿一些复杂性

![](img/82151c12d0d8d06b53f1579228e56600.png)

Andrew Stutesman 在 [Unsplash](https://unsplash.com/s/photos/map-of-the-world?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

# 域名系统

在最基本的层面上，域名系统(DNS)是人类可读域名(如`google.com`或`amazon.com`)和 IP 地址之间的翻译目录。

# 什么是 IP 地址？

互联网协议地址(IP 地址)是分配给连接到使用 IP 进行通信的计算机网络的每台设备的数字标签。

IP 地址有两个主要功能:网络接口识别和位置寻址。

日常使用的 IP 地址有两种版本:IPv4 和 IPv6。

由于可用的 IPv4 地址迅速耗尽，IPv6 在 2000 年代中期后变得更加普及。您可以通过地址的长度快速区分 IPv4 ( `8.8.8.8`)和 IPv6 地址(`0:0:0:0:0:ffff:808:808`)。

网络上的每台设备都需要有一个 IP 地址。IP 地址可以是公有的，也可以是私有的，保留的 IP 地址用于私有 IP 地址。

`Class A — 10.0.0.0/8`


`Class B — 172.16.0.0/12`
`172.16.0.0–172.31.255.255`

`Class C — 192.168.0.0/16`
`192.168.0.0–192.168.255.255`

IP 地址是一个庞大的主题，关于 IP 的更多信息超出了本文的范围。

# DNS 解析

DNS 解析是将主机名转换为 IP 地址的过程。
加载一个网页需要四个操作。

## 递归程序

递归器是一种服务器，用于接收来自客户端的查询。它将充当客户端和 DNS 名称服务器之间的中间人。如果数据存在，它将从缓存中返回数据，或者直接查找根名称服务器。

## 根名称服务器

根名称服务器包含构成根区域的信息，根区域是顶级域的全球列表。根区域包含:

*   通用顶级域名，如`.com`、`.net`和`.org`
*   国家代码顶级域名，如英国的`.uk`。
*   国际化顶级域名，本质上是用每个国家的本地字符集书写的顶级域名

## 顶级域名服务器

顶级域名(TLD)是互联网域名系统根区域中最高级别的域名。互联网名称与数字地址分配机构(ICANN)负责大多数顶级域名。

## 权威名称服务器

权威名称服务器是名称服务器查询中的最后一个操作。如果权威名称服务器可以访问所请求的记录，它会将所请求主机名的 IP 地址返回给 DNS recursor。该服务器保存实际的 DNS 记录(A、CNAME 等。)对于特定的域

# 权威 DNS 服务器 vs 递归 DNS 解析器？

主要区别是递归解析器在 DNS 查询的开始，而权威名称服务器在查询的结尾。

假设您的操作系统和 web 浏览器还没有缓存，客户端将请求递归 DNS 服务器找到与该网站相关联的 IP 地址。

递归服务器将检查自己是否缓存了该 IP，以及它是否在有效的生存时间(TTL)内。如果没有，它将启动一个递归(重复一个过程并引用自身)过程，遍历权威 DNS 服务器层次结构。

权威 DNS 服务器负责目标网站的 IP 映射。权威服务器将响应递归服务器。

Web 托管公司通常管理权威服务器，递归服务器用于减轻权威服务器的负载并提供一定程度的缓存。

# DNS 查找(无缓存时的指南)

用户在浏览器中键入网站，如`medium.com`。该请求最初由 DNS 递归解析器拾取。

1.  DNS 递归解析器查询 DNS 根目录`nameserver (.)`。
2.  根服务器然后用一个 TLD 的地址响应，并被指向`.com` TLD。向它发出请求。
3.  TLD 域名服务器响应域名服务器的 IP 地址`medium.com`。
4.  递归解析器然后向域名服务器发送一个查询，然后`medium.com`的 IP 地址从域名服务器返回给解析器。
5.  然后，该 IP 被发送回 web 浏览器，然后浏览器向该 IP 地址发出 HTTP 请求。呈现从服务器返回的内容。

# DNS 查询类型

在典型的 DNS 查找中，使用三种类型的查询。

在理想情况下，缓存的记录数据将是可用的，允许 DNS 名称服务器返回非递归查询。

## 递归 DNS 查询

对于递归查询，如果解析器找不到记录，DNS 客户端要求 DNS 服务器用资源记录或错误消息来响应客户端。

## 迭代 DNS 查询

对于重复的 DNS 查询，DNS 客户端将允许 DNS 服务器返回它能返回的最佳答案。

如果被查询的 DNS 服务器没有与查询名称匹配的域名，它将返回一个到权威 DNS 服务器的引用。然后，DNS 客户端对引用地址进行查询。这一过程随着查询链中的其他 DNS 服务器而继续，直到出现错误或超时。

## 非递归 DNS 查询

对于非递归查询，DNS 解析器已经知道答案。

它要么立即返回一个 DNS 记录，因为它已经将该记录存储在本地缓存中，要么查询该记录的权威 DNS 名称服务器。在这两种情况下，都不需要额外的查询，所以响应会立即返回给客户端。

# DNS 缓存，DNS 缓存发生在哪里？

缓存将数据临时存储在一个位置，从而提高数据请求的性能和可靠性。

DNS 缓存将数据存储在离请求客户端更近的地方，以便可以更早地解析 DNS 查询，并避免其他查询。缓存缩短了加载时间。

DNS 数据缓存在多个位置，每个位置将在由生存时间(TTL)确定的一段时间内存储 DNS 记录。

## 浏览器 DNS 缓存

Web 浏览器被设计为在设定的时间内缓存 DNS 记录。

DNS 缓存离 web 浏览器越近，检查缓存并向 IP 地址发出正确请求所需的处理步骤就越少。

浏览器缓存是检查所请求记录的第一个位置。

## 操作系统 DNS 缓存

在 DNS 查询离开您的机器之前，您的操作系统是最后一个可以使用缓存的地方。

当浏览器中没有缓存记录时，操作系统解析器会检查其缓存以查看是否有该记录。

如果不匹配，它会在本地网络外部向互联网服务提供商(ISP)内部的 DNS 递归解析器发送 DNS 查询，这通常是默认设置或路由器内部设置的解析器。

当递归解析器接收到 DNS 查询时，它还会检查所请求的主机转换是否已经存储在其缓存中。

递归解析器还具有附加功能，具体取决于其缓存中的记录类型。

# 递归解析器如何高效地解析

*   如果解析器没有 A 记录，但有权威名称服务器的 NS 记录，它将绕过 DNS 查询中的几个步骤，直接查询这些名称服务器。这种快捷方式可以防止从根和`.com`名称服务器查找(在我们搜索`example.com`时)，并有助于更快地解析 DNS 查询。
*   如果解析器没有 NS 记录，它将向 TLD 服务器发送一个查询(在我们的例子中是 T2)，跳过根服务器。
*   万一解析器没有指向 TLD 服务器的记录，它将查询根服务器。此事件通常在 DNS 缓存被清除后发生。

# 结论

感谢阅读！