<html>
<head>
<title>Learn the Strategy Pattern With This Simple Exercise!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过这个简单的练习学习策略模式！</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/my-first-coding-dojo-drunk-santa-claus-and-the-strategy-pattern-e7b6529b1ae4?source=collection_archive---------9-----------------------#2022-08-18">https://betterprogramming.pub/my-first-coding-dojo-drunk-santa-claus-and-the-strategy-pattern-e7b6529b1ae4?source=collection_archive---------9-----------------------#2022-08-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="32c7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我主持的第一个<em class="kf">编码道场</em>就在整个团队的圣诞假期之前。所以我准备了一些饼干和一些热潘趣酒，并邀请大家来帮助我们的好朋友圣诞老人！</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/ee8a5538a319a6322aabfdb677a6adc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tok7hwbKu278JDI_u0HGvg.jpeg"/></div></div></figure><h1 id="f9dd" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">问题是:</h1><p id="abdf" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">当我们所有人都试图与家人共度美好时光时，圣诞老人不得不在平安夜工作。</p><p id="9737" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">他的工作总是一样的:</p><ol class=""><li id="9825" class="ml mm iq lm b ln mg lq mh lt mn lx mo mb mp mf mq mr ms mt bi translated">圣诞老人必须凭记忆想出一些好礼物。</li><li id="1038" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf mq mr ms mt bi translated">圣诞老人必须从他的众多想法中随机选择一个。</li><li id="4657" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf mq mr ms mt bi translated">圣诞老人必须从商场买礼物。</li><li id="0638" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf mq mr ms mt bi translated">圣诞老人必须开车送礼物。</li></ol><h1 id="fbae" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">获取编码！</h1><p id="004e" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">我给两个小组(两人一组)看了一眼圣诞老人的大脑:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6c3c" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">团队现在有大约15分钟的时间来编写一个控制台应用程序，绘制以下输出:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nb"><img src="../Images/de12d861c14e1c6c2f5a893e91b4e335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*65DGqUN8wHs71L-xjLjOfA.png"/></div></div></figure><h1 id="d2ba" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">圣诞老人不高兴</h1><p id="5ad8" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">控制台输出不是很方便。一旦圣诞老人关闭应用程序，所有信息都会丢失。</p><p id="62d9" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">作为我们的应用程序的唯一客户，他希望将输出写入一个文件。他想通过命令行参数来切换该功能。</p><p id="d8b1" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">团队还有15分钟来实现这个功能。</p><p id="9d56" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">一些团队已经对他们的架构进行了大量的讨论，一些团队采取了非常务实的<em class="nc"> </em>方法，一些团队有意识地全力以赴。如此琐碎的任务有这么多不同的解决方案。</p><h1 id="197d" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">第一个转折:圣诞老人喝醉了！</h1><p id="7872" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">而且不是第一次了！这当然影响了平安夜:</p><p id="444d" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">圣诞老人喝醉的时候记不住礼物。他必须从他清醒时创建的文件中获得他的想法:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="b495" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">由于我们永远不知道圣诞老人在平安夜是喝醉了还是清醒的，该团队被指示创建另一个命令行参数来切换该行为:清醒时根据记忆，喝醉时根据文件。</p><p id="acb6" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">两队还有15分钟。</p><p id="5e91" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">反序列化*。json文件是小菜一碟。但是一些团队的发展已经有些迟缓了。尤其是快脏团队不得不与自己的设计决策斗争。</p><h1 id="ec57" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">最后一步:交换代码库！</h1><p id="3358" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">每个团队将一台笔记本电脑移到右边，剩下的是他们前任的代码。这就像是团队中的新人，看着一大堆遗留代码。</p><p id="acee" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">他们现在必须在25分钟内实现以下新要求:</p><p id="cea0" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">当圣诞老人喝醉的时候</p><ul class=""><li id="5dd3" class="ml mm iq lm b ln mg lq mh lt mn lx mo mb mp mf nd mr ms mt bi translated">他不在乎。他总是挑选他在文件中找到的第一件礼物。</li><li id="92ec" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">他不能步行去商场。他只是从亚马逊订购。</li><li id="0ba8" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">他不能(也不允许)开车！他只是骑着他的驯鹿。老派。</li></ul><p id="042a" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">之后的输出应该是这样的:</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/c736c8a8698d5a9371557c216ef05712.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*TnD3NIr73hqnw_a_3AqB0A.jpeg"/></div></figure><p id="e2a8" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">所有的团队立刻对新的代码库持否定态度。只是因为它是未知的，有待阅读和理解。我的一个同事甚至在查看快速和肮脏部分的代码时说道:</p><blockquote class="nf ng nh"><p id="d552" class="lk ll nc lm b ln mg jr lp lq mh ju ls ni mi lv lw nj mj lz ma nk mk md me mf ij bi translated">我认为我们应该继续以这种方式实施…</p></blockquote><p id="11ae" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">这说明了代码气味的一个主要问题:它们是会传染的。当在有臭味的代码中移动时，编写坏代码的抑制级别下降。整个解决方案变得越来越混乱。这也被称为<a class="ae nl" href="https://en.wikipedia.org/wiki/Broken_windows_theory" rel="noopener ugc nofollow" target="_blank">破窗理论</a>。</p><h1 id="1485" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">拯救战略模式！</h1><p id="a2cb" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">所有团队都承认这个练习并不容易，尽管它看起来微不足道。我问他们是否有任何解决方案符合<a class="ae nl" href="https://en.wikipedia.org/wiki/Open%E2%80%93closed_principle" rel="noopener ugc nofollow" target="_blank">开闭原则</a>:没有。</p><p id="af3e" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">所以我向他们提出了一个解决方案。感谢策略模式。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="88d6" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">看一下方法<code class="fe nm nn no np b">Run()</code>。读起来超级容易。它代表了我们的算法，我们的策略。这是圣诞老人每年都会做的程序，不管他是喝醉了还是清醒着。最棒的是:这种方法保持不变:</p><ul class=""><li id="8ab2" class="ml mm iq lm b ln mg lq mh lt mn lx mo mb mp mf nd mr ms mt bi translated">圣诞老人必须从任何一种<code class="fe nm nn no np b">IIdeaSource</code>中获得他的想法。</li><li id="59c6" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">圣诞老人必须以某种方式和T2一起做出决定。</li><li id="e19c" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">圣诞老人必须从任何一个<code class="fe nm nn no np b">IShop</code>处购买礼物。</li><li id="1bb0" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">圣诞老人必须用任何类型的<code class="fe nm nn no np b">IDelivery</code>来递送礼物。</li></ul><p id="158c" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">这个策略非常抽象。这是这个模式的重要部分:</p><ul class=""><li id="1d2c" class="ml mm iq lm b ln mg lq mh lt mn lx mo mb mp mf nd mr ms mt bi translated">这种策略不在乎这些想法是来自记忆、文件、互联网还是他的朋友。它只需要来自<code class="fe nm nn no np b">IIdeaSource</code>的方法<code class="fe nm nn no np b">IEnumerable&lt;Present&gt; GetPresents()</code>。</li><li id="003c" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">这个策略不在乎圣诞老人是随机选择第一份礼物还是最后一份礼物。它只需要来自<code class="fe nm nn no np b">IPresentChooser</code>的方法<code class="fe nm nn no np b">Present ChooseFrom(IEnumerable&lt;Present&gt; presents)</code>。</li><li id="a629" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">这个策略不关心圣诞老人是在商场买礼物，从亚马逊、易趣订购，还是自己动手修补。它只需要来自<code class="fe nm nn no np b">IShop</code>的方法<code class="fe nm nn no np b">void Buy(Present present)</code>。</li><li id="d396" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">这种策略不在乎圣诞老人是开车、骑驯鹿、步行还是在UPS的帮助下送货。它只需要来自<code class="fe nm nn no np b">IDelivery</code>的方法<code class="fe nm nn no np b">void Deliver()</code>。</li></ul><blockquote class="nf ng nh"><p id="c327" class="lk ll nc lm b ln mg jr lp lq mh ju ls ni mi lv lw nj mj lz ma nk mk md me mf ij bi translated">平安夜发生的事情总是一成不变。只是做的方式会不时改变。</p></blockquote><p id="7ac1" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">一切保持不变是我们的策略。这属于我们班<code class="fe nm nn no np b">ChristmasEve</code>。</p><p id="2887" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">所有可以改变的东西都通过构造函数作为依赖注入到类中。</p><p id="1599" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">这样，我们可以简单地通过注入所需的实现来决定如何执行策略。</p><p id="1129" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">仅此而已。这就是战略模式。</p><h1 id="1319" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">这些实现看起来怎么样？</h1><p id="a7eb" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">短小精悍！这里有两个例子:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="6e25" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">如果我想增加一个新的商店会怎么样？</h1><p id="e5bf" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">简单易行:</p><ol class=""><li id="660b" class="ml mm iq lm b ln mg lq mh lt mn lx mo mb mp mf mq mr ms mt bi translated">我们创建一个新的类，例如<code class="fe nm nn no np b">Ebay.cs</code></li><li id="fdb3" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf mq mr ms mt bi translated">我们让那个类实现<code class="fe nm nn no np b">IShop</code></li><li id="c3be" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf mq mr ms mt bi translated">我们给<code class="fe nm nn no np b">ChristmasEve</code>一个<code class="fe nm nn no np b">Ebay</code>的实例，而不是<code class="fe nm nn no np b">Mall</code>。</li><li id="ed6b" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf mq mr ms mt bi translated">就是这样。我们没有碰任何旧代码。我们只添加了新代码。<a class="ae nl" href="https://en.wikipedia.org/wiki/Open%E2%80%93closed_principle" rel="noopener ugc nofollow" target="_blank">开闭原则</a>认可。</li></ol><h1 id="a13b" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">你是如何实现不同的输出的？</h1><p id="62a8" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">这一切都是为了确定战略。</p><ul class=""><li id="c469" class="ml mm iq lm b ln mg lq mh lt mn lx mo mb mp mf nd mr ms mt bi translated">你想怎么样？—写东西！</li><li id="b18e" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">你想在哪里写东西？—我不在乎。我只想写作。</li><li id="2537" class="ml mm iq lm b ln mu lq mv lt mw lx mx mb my mf nd mr ms mt bi translated">结论:我们所需要的是一个接口<code class="fe nm nn no np b">IOutput</code>和一个方法<code class="fe nm nn no np b">WriteLine(string text)</code>。</li></ul><p id="4dd1" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">这就是两个实现的样子。两者都短小精悍。您可以看到这些类在没有任何滚动的情况下做了什么。</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="0a22" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">将它们联系在一起</h1><p id="4eb1" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">下面是我们的应用程序根可能的样子:</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="5651" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">我真的很喜欢这个解决方案。对于这个问题，策略模式确实很有效。所有的班级都很小并且可读。我们可以灵活应对进一步的变化。</p><blockquote class="nq"><p id="b4e3" class="nr ns iq bd nt nu nv nw nx ny nz mf dk translated">圣诞节有救了！谢谢帮忙！</p></blockquote><h1 id="cd42" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw oa jx le jz ob ka lg kc oc kd li lj bi translated">但是在一个大的应用程序中，我的根类会非常大，而且那样会很乱</h1><p id="fd3e" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">在某个必须完成的地方。至少在一个地方是这样。您可以在应用程序的根中交换行为，而不是在整个应用程序中挖掘。</p><p id="00eb" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">一些聪明人已经帮你解决了这个问题。如果你的根变得太大而无法处理，可能是时候看看IoC容器了，比如<a class="ae nl" href="https://autofac.org/" rel="noopener ugc nofollow" target="_blank"> Autofac </a>。</p><p id="91d3" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">你主持过编码道场吗？你的经历如何？让我知道！:-)</p><p id="5748" class="pw-post-body-paragraph lk ll iq lm b ln mg jr lp lq mh ju ls lt mi lv lw lx mj lz ma mb mk md me mf ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>