<html>
<head>
<title>Build Your Own Cryptocurrency Price Alert Service Using Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js构建您自己的加密货币价格警报服务</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-your-own-cryptocurrency-price-alert-service-using-nodejs-51d6989dd062?source=collection_archive---------5-----------------------#2021-03-05">https://betterprogramming.pub/build-your-own-cryptocurrency-price-alert-service-using-nodejs-51d6989dd062?source=collection_archive---------5-----------------------#2021-03-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="515a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Express.js、BullMQ、Cron作业，并获得电子邮件通知</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b9ff79f22a3babfec5e74fce17987910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOv2RLIpBkCLEeUGzH6iDg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@cardmapr?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> CardMapr </a>在<a class="ae kv" href="https://unsplash.com/s/photos/cryptocurrency?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="13cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个世界上的每个人都很忙，我们经常忘记事情。受这两种说法的激励，我决定构建一个简单的加密货币价格警报微服务，如果指定硬币的价格高于/低于某个阈值，它将发送电子邮件通知。</p><p id="f913" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你再也不需要整天盯着市场查价格了。你所需要做的就是选择货币并指定门槛价格。就是这样。您将通过提供的电子邮件地址收到通知。</p><p id="2b88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我使用Node.js来实现。您可以遵循以下步骤，并使用其他编程语言构建相同的微服务。本教程只是为了演示。它不是生产就绪或稳定的(为了简单起见，我将把警报存储在内存中)。但是，我相信您会发现这个演示非常有趣，因为我们将实现通知队列、服务工作者(Cron作业)、发送电子邮件等等。您还可以通过添加更多功能来改进这一点。</p><p id="690a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">说到这里，让我们看一下这个项目的主要特点:</p><ul class=""><li id="c76a" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">设置价格警报(针对高于/低于阈值价格的价格)。</li><li id="cc65" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">获取所有活动警报。</li><li id="05e3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">警报自动过期。</li><li id="bcd7" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">邮件通知。</li></ul><p id="a1c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始之前，您需要以下内容:</p><ul class=""><li id="a7a5" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">为你的操作系统安装<a class="ae kv" href="http://nodejs.org" rel="noopener ugc nofollow" target="_blank"> LTS版本</a>。</li><li id="64f7" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Postman:一个<a class="ae kv" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank">工具</a>，可以动态地使用API。在本演示中，我们将使用该软件来创建和检索警报。</li><li id="1a23" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Redis服务器:<a class="ae kv" href="https://redis.io/topics/quickstart" rel="noopener ugc nofollow" target="_blank">本地安装配置</a>。或者，如果您愿意，也可以选择云服务提供商。我们需要Redis服务器来处理BullMQ。</li><li id="717f" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">SendGrid API key: <a class="ae kv" href="https://signup.sendgrid.com/" rel="noopener ugc nofollow" target="_blank">创建一个新帐户</a>并获取API key。需要发送电子邮件通知。</li></ul><p id="c027" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦建立了环境，我们就可以开始实施了。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="8b4a" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">初始化项目</strong></h1><p id="167e" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">按照以下步骤初始化一个空Node.js项目:</p><ol class=""><li id="1470" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nk ly lz ma bi translated">创建一个空目录:<code class="fe nl nm nn no b">mkdir price-alert</code>。</li><li id="aadb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nk ly lz ma bi translated">导航到目录:<code class="fe nl nm nn no b">cd price-alert</code>。</li><li id="5b5b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nk ly lz ma bi translated">用<code class="fe nl nm nn no b">npm init</code>初始化一个新项目，并回答问题。或者您可以使用<code class="fe nl nm nn no b">npm init -y</code>来满足默认配置。</li></ol></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="9f73" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">安装依赖项</h1><p id="c889" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我们将在项目中使用以下依赖关系:</p><ul class=""><li id="c5a0" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><a class="ae kv" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a>:处理来自客户端的HTTP请求。有助于构建API。</li><li id="758f" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>:帮助我们向外部资源发出HTTP请求的库。</li><li id="d312" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://www.npmjs.com/package/bull" rel="noopener ugc nofollow" target="_blank"> Bull </a>:基于Redis的健壮消息队列。</li><li id="2a30" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://www.npmjs.com/package/cron" rel="noopener ugc nofollow" target="_blank"> Cron </a>:用于作业调度。</li><li id="6f2b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://www.npmjs.com/package/nodemailer" rel="noopener ugc nofollow" target="_blank"> Nodemailer </a>:用于发送邮件通知。</li></ul><p id="496e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们使用以下命令安装所有依赖项:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="ec2d" class="nt mo iq no b gy nu nv l nw nx">npm install express axios bull cron nodemailer --save</span></pre><p id="7ad4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ny">注意:如果你愿意，你也可以像</em> <code class="fe nl nm nn no b"><em class="ny">nodemailer</em></code> <em class="ny">一样安装开发者依赖项。</em></p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="eef0" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">项目目录结构</strong></h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/c509b6326bbc75aaa3fdd539cc31c6dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/0*ZBJYPGEq5EKoHmHf"/></div></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="a548" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">让我们开始吧</h1><p id="5c81" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">在<code class="fe nl nm nn no b">app.js</code>文件中，配置Express服务器。添加以下内容并保存文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="3b4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nl nm nn no b">node app</code>命令启动服务器。您将看到以下输出:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="bc8e" class="nt mo iq no b gy nu nv l nw nx">Server started listening!</span></pre><p id="90e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您导航到<a class="ae kv" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000/ </a>，您应该会看到状态为“<code class="fe nl nm nn no b">Up and running</code>”</p><p id="f75e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">酷毙了。现在我们的应用程序可以处理HTTP请求了。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="0e2b" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">实现端点</strong></h1><p id="bfce" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">现在让我们创建一个<code class="fe nl nm nn no b">router.js</code>文件，它将包含我们项目中使用的所有端点:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="cf49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nl nm nn no b">controller.js</code>文件将包含每个端点的逻辑。</p><p id="8c24" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们定义端点的逻辑。首先，让我们从<code class="fe nl nm nn no b">CurrentPrice</code>端点开始:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="4d7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以看到，我使用了<code class="fe nl nm nn no b">currentPrice</code>函数来获取当前的市场价格。</p><p id="cea1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们在<code class="fe nl nm nn no b">helpers</code>文件夹中实现<code class="fe nl nm nn no b">currentPrice</code>函数。这是最重要的函数，因为我们将在这个应用程序的许多地方使用这个函数。</p><p id="8982" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ny">注意:为了简单起见，我在这个演示中只实现了BTC和瑞士联邦理工学院的价格警报。您可以添加您喜欢的任何资产。</em></p><p id="727f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了获取ETH和BTC的当前价格，我使用了<a class="ae kv" href="https://p.nomics.com/cryptocurrency-bitcoin-api" rel="noopener ugc nofollow" target="_blank"> nomics api </a>。你可以从任何渠道得到价格。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="b043" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，我在<code class="fe nl nm nn no b"> config.js</code>文件中定义了一个<code class="fe nl nm nn no b">error</code>对象，如果在处理请求时出现任何未知错误，就可以发送这个对象:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="e536" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将<code class="fe nl nm nn no b">error</code>对象和当前价格函数导入控制器文件并保存:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="100e" class="nt mo iq no b gy nu nv l nw nx">const currentPrice = require("./helpers/currentPrice");<br/>const { errorObject } = require("./config");</span></pre><p id="7d36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们测试一下我们的<code class="fe nl nm nn no b">GET /prices</code>端点。启动服务器并导航到<a class="ae kv" href="http://localhost:5000/prices" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/prices</a>。你可以看到价格对象在浏览器中显示或者通过Postman点击端点。</p><p id="0a8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！我们设法得到了ETH和BTC当前的美元市场价格。</p><p id="86a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们继续实现另外两个端点，用于创建警报和检索所有活动警报。为了在我们的应用程序中全局使用警报，我们将创建一个名为<code class="fe nl nm nn no b">alerts.js</code>的文件，该文件导出一个空数组:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="c648" class="nt mo iq no b gy nu nv l nw nx">module.exports = [ ];</span></pre><p id="810e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">导入<code class="fe nl nm nn no b">controller.js</code>文件顶部的文件:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="2b63" class="nt mo iq no b gy nu nv l nw nx">var alerts = require(‘./alerts’);</span></pre><p id="7fdd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们定义创建新警报的逻辑:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="49d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我将警报存储在内存中，以简化演示。如果我们停止服务器，警报将会丢失，因为它们临时存储在易失性内存中。如果要在生产中使用，请使用数据库。</p><p id="ea2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，定义检索所有活动警报的逻辑。这个终点很简单。我们只需要返回<code class="fe nl nm nn no b">alerts</code>数组:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="8875" class="nt mo iq no b gy nu nv l nw nx">exports.GetAlerts = async (req, res) =&gt; {<br/>    return res.send({ success: true, alerts: alerts });<br/>};</span></pre><p id="7fa4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样。我们需要定义端点来创建和检索警报:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="c237" class="nt mo iq no b gy nu nv l nw nx">router.get(“/alerts”, Controller.GetAlerts);<br/>router.post(“/alert”, Controller.CreateAlert);</span></pre><p id="202c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在定义了所有三条路线之后，<code class="fe nl nm nn no b">router.js</code>文件将如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="cea6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要在我们的<code class="fe nl nm nn no b">app.js</code>文件中导入并使用这个路由器文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="e7ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是时候开心一下了。让我们打开Postman并测试我们的端点。首先，我们将尝试为BTC创建一个阈值价格低于49，000.095美元的警报:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/6aa10af3538c89180b3105e363a39a5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cRyHMu8aBGeIlxrX"/></div></div></figure><p id="995e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在响应中看到<code class="fe nl nm nn no b">Alert created</code>消息。同样，您可以尝试为阈值价格创建多个提醒，并指定接收提醒的电子邮件地址。</p><p id="5366" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们可以尝试获取所有警报:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/000a1370fbb1695afde079dbebc22319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sqlO1PUqGevuZpFY"/></div></div></figure><p id="fafd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有用！我们已经实现了这个项目所需的所有端点。现在我们需要删除过期的警报。我已经将提醒的到期时间设置为五分钟。您可以根据自己的需求进行修改。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="54d2" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">实施Cron作业(调度程序)</strong></h1><p id="3213" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">我们需要实现两个调度程序。一个是删除过期的警报，另一个是如果指定硬币的价格高于/低于阈值，则向电子邮件地址发送警报。</p><p id="e9cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，让我们实现<code class="fe nl nm nn no b">removeExpired</code>服务。为了简单起见，worker将每十秒遍历一次所有活动的警报，并删除五分钟前创建的警报。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="21cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保存文件并在<code class="fe nl nm nn no b">controller.js</code>文件中要求它:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="444c" class="nt mo iq no b gy nu nv l nw nx">require(./workers/removeExpired.js)</span></pre><p id="c6bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们一启动应用程序，调度程序就会启动。</p><p id="16a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，启动服务器并添加一些警报。您可以看到，警报在创建五分钟后就被删除了。您可以使用<code class="fe nl nm nn no b">GET /alerts </code>端点来确认<code class="fe nl nm nn no b">removeExpired</code>服务是否按预期工作。</p><p id="dc8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在实现我们的第二个调度程序(<code class="fe nl nm nn no b">sendAlert</code>)之前，我们需要实现<code class="fe nl nm nn no b">sendEmailNotification</code>助手函数来发送电子邮件通知。</p><p id="b3ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<code class="fe nl nm nn no b">helpers/sendEmailNotification.js</code>并添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="6225" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保存文件。确保在配置文件中添加了<code class="fe nl nm nn no b">USERNAME</code>、<code class="fe nl nm nn no b">PASSWORD</code>、<code class="fe nl nm nn no b">EMAIL</code>和<code class="fe nl nm nn no b">NAME</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="c6e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe nl nm nn no b">workers/sendAlert.js</code>中增加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="d2c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我每25秒运行一次调度程序。你可以根据你的要求改变它。一旦警报被推送到队列中，我们将把它从<code class="fe nl nm nn no b">alerts</code>数组中删除，以防止出现多余的警报。</p><p id="aaca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，如果使用<code class="fe nl nm nn no b">localhost</code>，确保<code class="fe nl nm nn no b">redis-server</code>在端口<code class="fe nl nm nn no b">6379</code>上启动并运行，并且<code class="fe nl nm nn no b">REDIS_URL</code>在<code class="fe nl nm nn no b">config.js</code>文件中输入正确。</p><p id="c42a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经在<code class="fe nl nm nn no b">3</code>设置了最大重试次数，并将回退时间设置为三秒，这意味着如果在发送电子邮件时出现错误，BullMQ的消费者进程将尝试以三秒的时间间隔处理请求。如果请求失败三次，那么它将被丢弃。</p><p id="d57f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在保存文件并通过运行<code class="fe nl nm nn no b">npm run start</code>命令启动服务器。</p><p id="0138" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开邮差并添加一些提醒。您将收到如下所示的指定电子邮件地址的警报:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/bee9486c2521139378cb2b2a16a410d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5cQFzCKC1e4NBXDb"/></div></div></figure><p id="ca10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果电子邮件没有到达收件箱，请确保检查垃圾邮件和促销文件夹。此外，您需要将发件人列入SendGrid帐户中的白名单，这样您的电子邮件就会到达收件箱。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="669c" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">结论</strong></h1><p id="ee5f" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">如前所述，该应用程序不适合生产，除非您进行更多的改进(例如，将警报保存到数据库、将密钥作为<code class="fe nl nm nn no b">env</code>变量传递、配置流程管理器等)。).</p><p id="8f64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过添加更多功能，尝试将此演示提升到下一个级别。你可以试试:</p><ul class=""><li id="e835" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">添加推送通知或短信提醒。</li><li id="575c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">添加更多硬币/代币。</li><li id="dda0" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">向多个电子邮件地址发送警报。</li><li id="654a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">通过设计UI，将此演示变成全栈应用。</li><li id="754d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">通过部署在云服务器上使其在线。</li></ul><p id="d7db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在GitHub 上找到这个项目<a class="ae kv" href="https://github.com/PraneshASP/cryptocurrency-price-alert" rel="noopener ugc nofollow" target="_blank">的完整源代码。</a></p><p id="3b4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就这些了，伙计们。一如既往，欢迎分享您的想法和建议。</p><p id="d054" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div></div>    
</body>
</html>