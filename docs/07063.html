<html>
<head>
<title>A BitBucket CI/CD Pipeline to Sync Branches With GitHub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用GitHub同步分支的BitBucket CI/CD管道</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-bitbucket-ci-cd-pipeline-to-sync-branches-with-github-1c885cefe202?source=collection_archive---------1-----------------------#2020-12-03">https://betterprogramming.pub/a-bitbucket-ci-cd-pipeline-to-sync-branches-with-github-1c885cefe202?source=collection_archive---------1-----------------------#2020-12-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5f18" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在BitBucket和GitHub repos之间同步分支</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8252926198f4ede0d2f40a7baa6d6c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5Aqxcke1gwOCNdd9"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@xcrap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">塞萨尔·库托</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="bd1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数时候，我们需要在两个不同的存储库之间同步分支(例如，BitBucket存储库到GitHub存储库)。</p><p id="1d78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是在云存储库上工作时的常见场景，但是日常开发是通过本地存储库管理的。在这种情况下，本地存储库分支应该同步到云存储库进行部署。手动处理同步会产生很多问题，还会消耗开发团队更多的时间。更好的选择是自动化本地存储库和云存储库之间的分支同步。可以启用完整的存储库镜像，但这将同步每个分支。我的目标是只同步特定的分支。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/78dd4416e6e539b69836e6ab485c3ea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZbIYEPklVmqVFBa4Q1Nog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="6550" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将看到一种通过BitBucket CI/CD管道在BitBucket存储库和GitHub之间同步分支的方法。可以遵循相同的方法，只需进行最小的更改，就可以同步任意两个存储库的分支。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="bb1a" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">先决条件</h1><ul class=""><li id="6eae" class="mv mw it lb b lc mx lf my li mz lm na lq nb lu nc nd ne nf bi translated">比特桶存储库</li><li id="e00e" class="mv mw it lb b lc ng lf nh li ni lm nj lq nk lu nc nd ne nf bi translated">空的GitHub存储库</li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="69d0" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">设置位桶管道</h1><p id="a71e" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我在BitBucket存储库中创建了一个名为<code class="fe no np nq nr b">dev</code>的分支。对于任何变更，<code class="fe no np nq nr b">dev</code>分支应该与GitHub存储库同步。在第一次同步时，<code class="fe no np nq nr b">dev</code>分支将被创建在GitHub存储库中。</p><p id="28bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">管道将在每一个被推送到指定分支的变更上执行(例如<code class="fe no np nq nr b">dev</code>并将变更与远程GitHub存储库同步)。</p><p id="159a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录到BitBucket存储库，单击“管道”，然后单击“创建您的第一个管道”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/63d724dff5e3d6c109fe8940b67eab7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-6rAGP2HGjNhu8iLcyjEA.png"/></div></div></figure><p id="d632" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择“起始管道”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/55466835e5dbee6e4f314c73a9a0c391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TUH8VqlfrDBnDHq1xlhZ0Q.png"/></div></div></figure><p id="1310" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe no np nq nr b">bitbucket-pipelines.yml</code> <strong class="lb iu"> </strong>中启用以下配置，并提交更改。该文件将被提交到主分支的根目录。将文件复制到其他需要的分支(如<code class="fe no np nq nr b">dev</code>):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="194e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据您的配置修改分支名称引用(<code class="fe no np nq nr b">dev</code>、<code class="fe no np nq nr b">dev1</code>和<code class="fe no np nq nr b">uat</code>)。此外，相应地修改远程(GitHub)存储库URL。</p><p id="e409" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在提交对<code class="fe no np nq nr b">dev</code>、<code class="fe no np nq nr b">dev1</code>和<code class="fe no np nq nr b">uat</code>分支的更改时，将触发管道，并执行以下特定于环境的脚本，以将本地分支(BitBucket)与远程存储库(GitHub)同步:</p><pre class="kj kk kl km gt nw nr nx ny aw nz bi"><span id="0465" class="oa me it nr b gy ob oc l od oe">git remote add sync git@github.com:techforum-repo/test1.git - <strong class="nr iu">add GitHub repository as the additional remote repository and tag with name "sync"</strong><br/>git checkout dev - <strong class="nr iu">Check out the latest changes from local dev bracnh( modify branch name accordingly), this step can be skipped as BitBucket pipeline already checked out the laetst branch</strong><br/>git pull - <strong class="nr iu">pull the latest change from local branch,</strong>  <strong class="nr iu">this step can be skipped as BitBucket pipeline already pulled out the laetst branch</strong>   <br/>git push sync dev - <strong class="nr iu">push the local(BitBucket) branch to the remote GitHub repository (modify branch name accordingly)</strong></span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="72ba" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">生成SSH密钥</h1><p id="e481" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">远程存储库的HTTPS Git URL(<a class="ae ky" href="https://techforum-repo:password@github.com/techforum-repo/test1.git" rel="noopener ugc nofollow" target="_blank">https://tech forum-repo:password @ github . com/tech forum-repo/test1 . Git</a>)可以与管道中的凭证一起使用，以将本地更改推送到远程存储库(将凭证存储在存储库或部署变量中，并在管道中引用它们)，但是最佳实践是使用SSH URL(<a class="ae ky" href="http://git@github.com:techforum-repo/test1.git" rel="noopener ugc nofollow" target="_blank">Git @ github . com:tech forum-repo/test1 . Git</a>)。</p><p id="305a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SSH密钥应该配置为启用基于SSH的集成。第一步，通过执行下面的命令生成SSH密钥(可以通过GIT bash执行)。如果需要，可以通过BitBucket UI生成SSH密钥:</p><pre class="kj kk kl km gt nw nr nx ny aw nz bi"><span id="4c73" class="oa me it nr b gy ob oc l od oe">ssh-keygen -t ed25519 -C "<a class="ae ky" href="mailto:test@techforum.com" rel="noopener ugc nofollow" target="_blank">test@techforum.com</a>"</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/f317c3a591e0b9c0fbf6f225bda6320e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxsGMKsoAi4TcGmThW3YcA.png"/></div></div></figure><p id="40e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在下生成公钥(id_ed25519.pub)和私钥(id_ed25519)。ssh文件夹。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="37ac" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">设置SSH密钥— GitHub</h1><p id="3635" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在登录GitHub存储库并创建一个新的部署密钥:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/d9a23b4f0b27acadfc404212f9b73054.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5yKzgmKEc-Of3mhiLW3kKA.png"/></div></div></figure><p id="7b04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给键添加一个标题(<code class="fe no np nq nr b">sync-bitbucket</code>)。从文件<code class="fe no np nq nr b">id_ed25519.pub</code>中输入公钥。</p><p id="9f4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择“允许写访问”点击“添加密钥”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/2fef4b42a58ad4f354b4e51c0edad9f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wX7QUz7QHUrgfAOiMKnGlw.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2109" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">设置SSH密钥—位桶</h1><p id="0dfc" class="pw-post-body-paragraph kz la it lb b lc mx ju le lf my jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">登录BitBucket存储库并点击“存储库设置”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/31a8f0f81de176c1825699abd9c7a47d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-vmkdRgEhSDSDGFkgzW-YA.png"/></div></div></figure><p id="845d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击“SSH密钥”和“使用我自己的密钥”(如前所述，您可以使用“生成密钥”按钮来生成私有和公共密钥)。</p><p id="125d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从<code class="fe no np nq nr b">id_ed25519</code>文件添加私钥，从<code class="fe no np nq nr b">id_ed25519.pub</code>文件添加公钥，并保存密钥对。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/3ce2921b5d8f90a875126513afdab9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ccy6txlHsLTfeuXIuMinUQ.png"/></div></div></figure><p id="d22d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在将一些更改推送到BitBucket中的一个分支(例如<code class="fe no np nq nr b">dev</code>)。这将触发相应的管道步骤:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/469f63fa9b12be8663e8c7c03e435f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJAhp4Yo1RRc_gO5qqA6Ug.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/c9b8889e079612a7131f1b5b3c089ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UcYuTy4Fo3rMrLZm-ZUnmw.png"/></div></div></figure><p id="3964" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦管道成功完成，来自BitBucket存储库的特定分支(例如<code class="fe no np nq nr b">dev</code>)将被同步到GitHub存储库(相应的分支将在GitHub中为第一次同步创建):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/2c80b3ae1300e0a842b6449753259654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pq6AW6CrPUIETfIWVCORSg.png"/></div></div></figure><p id="45f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CI/CD管道可以帮助我们在两个不同的存储库之间同步分支。这里，我们将特定的分支从BitBucket存储库同步到GitHub存储库，但是可以遵循相同的方法来同步两个不同的存储库。如果需要，可以使用外部CI/CD工具(例如Jenkins)来同步两个不同的存储库。</p><p id="b43e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一篇教程中，我们将探索如何使用Jenkins管道在两个存储库之间同步分支。</p></div></div>    
</body>
</html>