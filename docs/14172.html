<html>
<head>
<title>Go Lacks Ternary Operators. Here Are Some Equivalents</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">围棋缺少三元运算符。以下是一些对等物</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/go-has-no-ternary-operators-here-are-some-equivalents-316debbc9caa?source=collection_archive---------2-----------------------#2022-11-14">https://betterprogramming.pub/go-has-no-ternary-operators-here-are-some-equivalents-316debbc9caa?source=collection_archive---------2-----------------------#2022-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3720" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">围棋中三元算子的替代方案</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e38414ef7b4e23023a44241b83fe1fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O2QqOQjpXuJ2KiLe"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自Unsplash <a class="ae ky" href="https://unsplash.com/photos/KyCzR06ypjI" rel="noopener ugc nofollow" target="_blank"> donio3d </a></p></figure><p id="3ebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你像我一样，在写Go之前是一个纯Java开发人员，你一定在想为什么Go不支持像<code class="fe lv lw lx ly b">return a &gt; 1 ? 0 : 1</code>这样的三元运算符。</p><p id="be07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数主流语言像C和Java都支持三元运算符；像Python和Ruby这样的语言支持简化的<code class="fe lv lw lx ly b">if-else</code>一行程序，比如<code class="fe lv lw lx ly b">a = 0 if a &gt; 1</code>。但是，围棋不在其中。它不仅仅是添加操作符，而且是一种以更方便的方式编码的概念，例如<code class="fe lv lw lx ly b">?:</code>表达式可以被<code class="fe lv lw lx ly b">if-else,</code>完美地替换，但是如果你被要求复制它几十或几百次呢？你必须毫不犹豫地寻求优化。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="ff88" class="md me it ly b gy mf mg l mh mi">if a &gt; 1 {<br/>  return 0<br/>else {<br/>  return 1<br/>}​</span></pre><h1 id="7d7b" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">Go中没有三元运算符</h1><p id="e812" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">早在2012年就有过关于是否添加三元运算符的<a class="ae ky" href="https://groups.google.com/g/golang-nuts/c/dbyqx_LGUxM/m/tLFFSXSfOdQJ" rel="noopener ugc nofollow" target="_blank">讨论</a>，最终被否决，并将<a class="ae ky" href="https://go.dev/doc/faq#Does_Go_have_a_ternary_form" rel="noopener ugc nofollow" target="_blank">答案</a>添加到FAQ中。</p><blockquote class="nf ng nh"><p id="1790" class="kz la ni lb b lc ld ju le lf lg jx lh nj lj lk ll nk ln lo lp nl lr ls lt lu im bi translated">Go中没有<code class="fe lv lw lx ly b">?:</code>的原因是这种语言的设计者已经看到这种操作经常被用来创建极其复杂的表达式。<code class="fe lv lw lx ly b">if-else</code>形式虽然更长，但无疑更清晰。一种语言只需要一个条件控制流结构。</p></blockquote><p id="49dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个回答并不能让所有人满意，Github issues中仍有提案(<a class="ae ky" href="https://github.com/golang/go/issues/20774" rel="noopener ugc nofollow" target="_blank">提案</a>2017)在请求拥有它。我个人对Go团队的视角保持保守的态度，想把他们的理由一个个“打”出来。</p><h2 id="863d" class="md me it bd mk nm nn dn mo no np dp ms li nq nr mu lm ns nt mw lq nu nv my nw bi translated"><strong class="ak">原因1:明确性</strong></h2><p id="cf12" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated"><code class="fe lv lw lx ly b">if-else</code>可以完成任务，但代价是“牺牲”我的键盘和手指。例如，在前面的例子中使用<code class="fe lv lw lx ly b">if-else</code>而不是<code class="fe lv lw lx ly b">?:</code>意味着我敲击键盘至少13次以上(<code class="fe lv lw lx ly b">if + else + { + { + } + return</code>)，这个数字在一个生产项目中可能会呈指数增长。</p><p id="3bd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">三元运算符不仅可以用于返回、变量赋值，还可以用于函数参数、<code class="fe lv lw lx ly b">printf </code>参数等。如果在下面的<code class="fe lv lw lx ly b">printf</code>案例中改成<code class="fe lv lw lx ly b"> if-else</code>，我们可以看到一个明显的重复代码。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="624e" class="md me it ly b gy mf mg l mh mi">printf("I’m %s 21 years old, so I %s drink", age &gt; 21 ? "above":"below", age &gt; 21 ? "can" : "cannot") <br/>// if - else, duplicated code<br/>if age &gt; 21 {<br/>printf("I’m above 21 years old, so I can drink")<br/>} else {<br/>printf("I’m below 21 years old, so I can drink")<br/>}​</span></pre><p id="1209" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，重复的代码是一种不好的味道，即使我们封装了一个额外的函数来减少重复的代码，代码的可读性也会降低。只看打印方法，完整的逻辑被撕成碎片。​</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="4ee1" class="md me it ly b gy mf mg l mh mi">if age &gt; 21 {<br/>print("above", "can")<br/>else {<br/>print("below", "cannot")<br/>}<br/>// wrap function<br/>func print(a string, b string) {<br/>printf("I’m %s 21 years old, so I %b drink", a, b)<br/>}​​</span></pre><p id="325f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">if-else</code>有一个转换，其中使用了初始化变量，而不是<code class="fe lv lw lx ly b">else</code>，将上面的例子改为如下。它更简洁，但失去了不变性，可读性仍然很低。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="ec9e" class="md me it ly b gy mf mg l mh mi">b := 0<br/>if a &lt;= 1 {<br/> b = 1<br/>}<br/>return b​</span></pre><h2 id="d347" class="md me it bd mk nm nn dn mo no np dp ms li nq nr mu lm ns nt mw lq nu nv my nw bi translated"><strong class="ak">原因2:易读性</strong></h2><p id="42e3" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">易读性是一个很有争议的概念。至少，我觉得<code class="fe lv lw lx ly b">return a &gt; 1 ? 0:1</code>的可读性不弱于<code class="fe lv lw lx ly b">if-else</code>。但是根据我多年的Java经验，我无法判断是否存在偏见。而且从提案的各种评论来看，我猜想Go官方考虑的是滥用三元运算符导致的可读性差，而不是三元运算符本身，比如像<code class="fe lv lw lx ly b">a = b &gt; 100 ? 99 : ( b &gt; 1000 ? 999 : (b &gt; 10000 ? 9999 : ( b &gt; 100000 ? 99999 : …. )))).</code>这样的多级嵌套表达式将其转换为<code class="fe lv lw lx ly b">if-else</code>更好理解。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="6b52" class="md me it ly b gy mf mg l mh mi">if b &gt; 100 {<br/>a = 99<br/>else if b &gt; 1000 {<br/>a = 999<br/>else if b &gt; 10000 {<br/>a = 9999<br/>....​</span></pre><p id="ec58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，仅仅因为有被滥用的风险，就对一个带来效率的经营者说不，是没有足够说服力的。</p><h2 id="b04f" class="md me it bd mk nm nn dn mo no np dp ms li nq nr mu lm ns nt mw lq nu nv my nw bi translated"><strong class="ak">原因3:并非所有语言都支持三元运算符</strong></h2><p id="3e1b" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">除了Go，还有一些其他语言也不支持三元运算符，比如Rust，他们的团队也给出了一个原因。</p><blockquote class="nf ng nh"><p id="c552" class="kz la ni lb b lc ld ju le lf lg jx lh nj lj lk ll nk ln lo lp nl lr ls lt lu im bi translated">Rust试图避免用多种方式做同一件事。此外，<code class="fe lv lw lx ly b">:</code>符号已经超出了我的想象，经典的三元语法与已经被接受的类型归属RFC在语法上是不明确的。此外，还有模糊的计划在将来使用<code class="fe lv lw lx ly b">?</code>符号来支持语言级别的错误处理。​​</p></blockquote><p id="fc4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是他们也提到了他们对<code class="fe lv lw lx ly b">?</code>和<code class="fe lv lw lx ly b">:</code>运营商的未来规划吧？</p><h1 id="a1e5" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">备选方案s</h1><p id="839f" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">Go用户在三进制运算符失败后仍在孜孜不倦地提出其他类似的优化来简化<code class="fe lv lw lx ly b">if-else</code>。</p><p id="8d64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建议<a class="ae ky" href="https://github.com/golang/go/issues/31659" rel="noopener ugc nofollow" target="_blank">有条件分配(？=)对于有限的三元运算符功能</a>希望实现<code class="fe lv lw lx ly b">?=</code>来完成单行<code class="fe lv lw lx ly b">if-else</code>和变量赋值，比如<code class="fe lv lw lx ly b">a ?= a &gt; 1, 0, 1</code>。这个提案也没有通过。</p><p id="c216" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提案<a class="ae ky" href="http://Support inline &quot;if&quot; statement syntax" rel="noopener ugc nofollow" target="_blank">支持内联“if”语句语法</a>，希望有Python和Ruby那样的一行程序<code class="fe lv lw lx ly b">if-else</code>，也因关注和支持不足而被否决。</p><p id="6f22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如所看到的，无论被问多少次，Go团队可能都不会考虑添加三元运算符。转向替代品是短期内唯一的出路。</p><h2 id="8e7f" class="md me it bd mk nm nn dn mo no np dp ms li nq nr mu lm ns nt mw lq nu nv my nw bi translated">IDE模板</h2><p id="2dec" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我们可以用IDE创建模板来简化代码生成，避免重复的<code class="fe lv lw lx ly b">if-else</code>。例如，我们可以在IntelliJ中创建一个名为<code class="fe lv lw lx ly b">tern</code>的实时模板。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/e9a0bb8391332e5a733882d82023b09c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-k8gb3AYyP-0hwZRRlWnsA.png"/></div></div></figure><p id="5b9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以在需要<code class="fe lv lw lx ly b">if-else</code>的地方使用tern，在三个变量中输入相关表达式。</p><h2 id="d3b1" class="md me it bd mk nm nn dn mo no np dp ms li nq nr mu lm ns nt mw lq nu nv my nw bi translated">泛型三元运算符</h2><p id="8f88" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">一个更好的解决方案来自于<a class="ae ky" href="https://stackoverflow.com/questions/19979178/what-is-the-idiomatic-go-equivalent-of-cs-ternary-operator" rel="noopener ugc nofollow" target="_blank"> StackoverFlow </a>，由用户提供，支持泛型的实现。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="47c1" class="md me it ly b gy mf mg l mh mi">func If[T any](cond bool, vtrue, vfalse T) T {<br/>    if cond {<br/>        return vtrue<br/>    }<br/>    return vfalse<br/>}</span></pre><p id="929a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以把前面的例子变成<code class="fe lv lw lx ly b">return If(a &gt; 1, 0, 1)</code>，就像三元运算符一样方便。自己试试<a class="ae ky" href="https://go.dev/play/p/nl_-04X1_GN" rel="noopener ugc nofollow" target="_blank">这里</a>。​​​</p><h1 id="06f6" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结束了</h1><p id="a4c9" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我喜欢三进制运算符带来的便利，然而，Go团队坚持不添加它，尽管周围总是有提议。在Go官方真正改变主意之前，我们可以依靠其他方法来提高我们的编码效率。</p><p id="e011" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p><h1 id="f831" class="mj me it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">参考文献</h1><p id="a7aa" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated"><a class="ae ky" href="https://github.com/golang/go/issues/33171" rel="noopener ugc nofollow" target="_blank">https://github.com/golang/go/issues/33171</a></p><p id="7657" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">​</p></div></div>    
</body>
</html>