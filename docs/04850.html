<html>
<head>
<title>How to Detect When a User Changes Their Metamask Account</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何检测用户何时更改其元掩码帐户</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-detect-when-a-user-changes-their-metamask-account-4611845b6415?source=collection_archive---------7-----------------------#2020-05-15">https://betterprogramming.pub/how-to-detect-when-a-user-changes-their-metamask-account-4611845b6415?source=collection_archive---------7-----------------------#2020-05-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7205" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">确保您跟踪的是用户正确的ETH帐户</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/415dd39a22c22cad5c6108ef66a8b824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k_U9qcivI4DABpM3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@jeison?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰森·伊吉塔</a>拍摄的照片。</p></figure><p id="089c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">先决条件:对以太坊和web3.js的初级理解</em></p><p id="e531" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户体验是让用户加入你的去中心化应用的最大障碍之一(DApp)。现代网络浏览器默认不支持<a class="ae ky" href="https://web3.foundation/" rel="noopener ugc nofollow" target="_blank"> web3 </a>，所以大多数用户不得不通过<a class="ae ky" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank"> Metamask </a>浏览器扩展与DApps交互。</p><p id="0e30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">元掩码允许用户更改网络，并通过分机更改他们的活动钱包地址。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/fb7c1a4e5595a81fac4003d81ff26a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Phz6MVQPq02gzQrWbxUSzA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图1</p></figure><p id="4231" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，DApps不会知道用户何时更改帐户，除非专门检查它。这意味着，如果用户在使用您的DApp时更改帐户，他们将看到与以前帐户相关的过期信息。这就像登录您的脸书帐户，看到前一个用户的仪表板。显然是不能接受的。</p><p id="0eb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，Metamask现在允许您通过一段简单的代码实时监听用户何时更改他们的帐户。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="98f4" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">检测帐户更改</h1><p id="495e" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">让我们假设您有一个名为<code class="fe nb nc nd ne b">getAccount()</code>的函数，它连接到以太坊并加载正在使用的活动帐户。每当加载DApp时都会发生这种情况。</p><p id="296a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Metamask在帐户选择改变时触发一个<code class="fe nb nc nd ne b">accountsChanged</code>事件，我们可以监听这个事件。图2显示了这样的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图2</p></figure><p id="33ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用该事件监听器，您的DApp可以实时获得最新的钱包数据，从而使您的用户体验更加流畅和及时。图3显示了一个DApp，当触发<code class="fe nb nc nd ne b">accountsChanged</code>事件时，它检索活动的钱包地址并将其显示在一个按钮中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/533fe708c068cffdc13e7fa4a0facb50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*CWsUQF15GWMjVQ9zE8yxSQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图3</p></figure><p id="15db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关该功能的更多信息，请参见<a class="ae ky" href="https://docs.metamask.io/guide/accessing-accounts.html" rel="noopener ugc nofollow" target="_blank"> Metamask的文档</a>。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="8290" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">进一步阅读</h1><p id="0c2c" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">如果你对区块链开发感兴趣，我会写一些关于如何开始和建立投资组合的教程、演练、提示和技巧。查看以下资源:</p><div class="ni nj gp gr nk nl"><a href="https://medium.com/blockcentric/blockchain-development-resources-b44b752f3248" rel="noopener follow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">区块链开发资源马上跟进</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">学习区块链、以太坊和DApp开发的资源列表</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ks nl"/></div></div></a></div></div></div>    
</body>
</html>