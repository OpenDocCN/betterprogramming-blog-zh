<html>
<head>
<title>NLP With Python: Build a Haiku Machine in 50 Lines Of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python实现NLP:用50行代码构建一台俳句机器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/nlp-with-python-build-a-haiku-machine-in-50-lines-of-code-6c7b6de959e3?source=collection_archive---------3-----------------------#2020-10-30">https://betterprogramming.pub/nlp-with-python-build-a-haiku-machine-in-50-lines-of-code-6c7b6de959e3?source=collection_archive---------3-----------------------#2020-10-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c6cc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">自然语言处理探究</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dd3fc920c804a3e3a889f15e072ed7bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gqnqd-jFRhbw7kt0kWlWmw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">阿列克谢·萨维琴科在<a class="ae ky" href="https://unsplash.com/s/photos/clock?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="07b5" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><em class="mc"> *:代码更新至空间3.2 </em></p><h1 id="8af6" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">灵感</h1><p id="7580" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">你喜欢异想天开的报纸停电诗吗？我们可以借用同样的想法来写一个写俳句的程序。昏厥诗的创作是在一段文本中寻找想要的词语的过程。当其他单词被删除时，这首诗就从上下文中浮现出来。令人耳目一新。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/4372559c1f99862a11e332a786cbbdff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hUonq9CZ-sTKslLTlpmdqA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">奥斯汀·克莱恩和蝙蝠侠说过话。</p></figure><p id="6840" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">俳句是一种不押韵的诗歌形式，只有17个音节，通常写三行，音节数为5-7-5。有了Python和NLP(自然语言处理)工具，我们可以编写一个俳句机器，从一端接收任意一段文字，在另一端输出俳句。</p><p id="e186" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们开始吧。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="ffd1" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">NLP库</h1><p id="c319" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">自2001年首次亮相以来，NLTK(自然语言工具包)一直是一股强大的力量，也是当今最著名的NLP库。它的缺点是复杂和缓慢。2012年，Tom De Smedt和Walter Daelemans开发了一个名为Pattern的库，其中包含情感和图形分析。更流行的TextBlob是基于Pattern和NLTK开发的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/13689a443fa13ad7ba0671c2cb8ec5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qUcez_UI-lCvdfMyWKZ2_w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">造型创意|汤姆·德·斯梅特</p></figure><p id="d1ab" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">TextBlob宣传自己是简化的文本处理，完全正确。我在几个项目中使用过它，我很喜欢它，但也发现它不适合举重。</p><p id="8abe" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于我们在这里要做的事情，我会选择<a class="ae ky" href="https://spacy.io/" rel="noopener ugc nofollow" target="_blank">空间</a>。spaCy是快速的，因为它是用Cython编写的，并且通过包含用于处理常见任务的预训练模型而设计为随时可用。闲暇之余，我建议你看一下马修·洪尼巴尔和伊娜丝·蒙塔尼的视频，他们解释了spaCy的设计理念:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Matthew Honnibal和Ines Montani:空间和爆炸:过去、现在和未来</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="38b2" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">项目设置</h1><p id="cea5" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">使用Python 3，项目设置非常简单。我们需要两个库:spaCy用于处理文本，而<a class="ae ky" href="https://pypi.org/project/syllapy/" rel="noopener ugc nofollow" target="_blank"> syllapy </a> <em class="mc"> </em>用于计算音节。我们已经知道在创作俳句时音节数是必不可少的:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="a00b" class="no me it nk b gy np nq l nr ns">pip3 install -U spacy<br/>pip3 install syllapy</span></pre><p id="af18" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">安装spaCy后，我们需要下载一个语言模型。spaCy支持多种语言。我们将在这里使用英语:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="0b64" class="no me it nk b gy np nq l nr ns">python3 -m spacy download en_core_web_sm</span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="7657" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">阅读课文</h1><p id="7cdb" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">我们可以自由地使用任何文本作为输入。在这个练习中，我从乔治·奥威尔的经典小说<em class="mc"> 1984 </em>中选了几百个单词。</p><p id="9d03" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为我们的项目创建一个文件夹，然后用Visual Studio代码打开该文件夹。创建一个名为<code class="fe nt nu nv nk b">data</code>的文件夹来存储文本文件。然后创建一个名为<code class="fe nt nu nv nk b">z2poem.py</code>的Python文件。</p><p id="c812" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在Python文件中，我们设置了空间。在内部，spaCy维护一个文本处理管道。它是可定制的，但是默认设置对许多项目来说是好的。</p><p id="3cf1" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们将一个语言模型加载到管道<code class="fe nt nu nv nk b">nlp</code>中，然后创建一个文档<code class="fe nt nu nv nk b">doc</code>来读取文本:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="4aaf" class="no me it nk b gy np nq l nr ns">import spacy<br/>nlp = spacy.load("en_core_web_sm")</span><span id="5d57" class="no me it nk b gy nw nq l nr ns">file = "data/orwell_1984.txt"<br/>doc = nlp(open(file).read())</span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="2cc6" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">基于规则的模式匹配</h1><p id="6a94" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">为了实现停电诗的想法，我们需要从一段文字中选择一个短语。为了使选择适合一首俳句，它需要遵循一定的规则。例如，我们从不以“the”结尾，也很少把“of”作为最后一个单词。</p><p id="8d45" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">spaCy有一个优秀的基于规则的匹配工具。我们的目标是找到足够多的好词，但我们不需要穷尽所有的可能性。我们可以自由地想出一套规则，而且我们可以随时改进它。</p><p id="ac59" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">例如，我们可以从匹配一个由形容词修饰的名词短语开始。它需要两个属性的模式:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="bb02" class="no me it nk b gy np nq l nr ns">pattern = [{'POS': 'ADJ'},<br/>           {'POS': 'NOUN'}]</span></pre><p id="36dc" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">POS代表词性。spaCy为我们提供了一个交互工具，让我们可以随意摆弄，并写出要使用的模式。然后我们可以将它们复制并粘贴到我们的Python程序中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/62b8bf17e9b4e68a80a320e0e0775caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsvqK_2IsfIr9TBg9i4UPA.jpeg"/></div></div></figure><p id="d7b7" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为了制作我们的俳句，我使用了三种不同的模式:两个词，三个词和四个词的短语。我将展示下面四个单词的匹配器，您可以在本文末尾看到完成的代码:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="6ed5" class="no me it nk b gy np nq l nr ns">from spacy.matcher import Matcher</span><span id="f455" class="no me it nk b gy nw nq l nr ns">matcher4 = Matcher(nlp.vocab)</span><span id="2fd7" class="no me it nk b gy nw nq l nr ns">pattern = [{'POS':  {"IN": ["NOUN", "ADP", "ADJ", "ADV"]} }, <br/>{'IS_ASCII': True, 'IS_PUNCT': False, 'IS_SPACE': False},  {'IS_ASCII': True, 'IS_PUNCT': False, 'IS_SPACE': False}, {'POS':  {"IN": ["NOUN", "VERB", "ADJ", "ADV"]} }]</span><span id="c8c5" class="no me it nk b gy nw nq l nr ns">matcher4.add("FourWords", [pattern])</span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="64a2" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">音节计数</h1><p id="f0a5" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">最著名的音节计数工具可能是CMU的发音，但它有一个缺陷。发音实际上是计算音素而不是音节，音素并不总是与音节对齐。Michael Holtzscher的syllapy <em class="mc"> </em>更正<a class="ae ky" href="https://medium.com/@mholtzscher/programmatically-counting-syllables-ca760435fab4" rel="noopener">本期</a>。虽然发音提供了其他功能，但我们很乐意使用syllapy <em class="mc"> </em>，因为它提供了我们所需要的:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="ffda" class="no me it nk b gy np nq l nr ns">syllapy.count("word")</span></pre><p id="0b6e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">根据音节数，匹配规则的短语被进一步分类。创建两个列表:一个用于五音节的短语，另一个用于七音节的短语。不属于这两个列表的任何东西都被简单地扔掉。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="c057" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">俳句作文</h1><p id="88ad" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">最简单的方法是从五个音节的列表中选择一个短语，然后从七个音节的列表中选择一个，再从五个音节的列表中选择一个。当我们把所有东西放在一起时，下面是代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny ni l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8c1c" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">图灵检定</h1><p id="2482" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">该程序可以在瞬间生成俳句。我<a class="ae ky" href="https://medium.com/house-of-haiku/poster-6bf094e424e0" rel="noopener">向<a class="ae ky" href="https://medium.com/house-of-haiku" rel="noopener">俳句之家</a>提交了一篇</a>并被接受，我想知道是否有人注意到俳句是由一个程序生成的。</p><p id="83b0" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果俳句感觉像是人类写的，我们能认为它通过了图灵测试吗？</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="bc76" class="md me it bd mf mg nb mi mj mk nc mm mn jz nd ka mp kc ne kd mr kf nf kg mt mu bi translated">讨论</h1><p id="02e7" class="pw-post-body-paragraph lg lh it li b lj mv ju ll lm mw jx lo lp mx lr ls lt my lv lw lx mz lz ma mb im bi translated">本文旨在为自然语言处理做一个练习。我们用不到50行代码制作了一台功能正常的俳句机器，但还有很大的改进空间，而且我们还仅仅触及了计算诗的皮毛。敬请期待，我将很快做出另一个版本的俳句机。</p><p id="8c01" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">干杯！</p></div></div>    
</body>
</html>