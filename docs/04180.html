<html>
<head>
<title>How to Create D3 Animations in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中创建D3动画</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/d3-animations-in-react-with-1-line-of-code-976396a45ede?source=collection_archive---------6-----------------------#2020-03-28">https://betterprogramming.pub/d3-animations-in-react-with-1-line-of-code-976396a45ede?source=collection_archive---------6-----------------------#2020-03-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2acf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">只用一行代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/588a6e734e436bdd44b7eb30d05b8398.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*SVfrsJe0x98JMgWHb4QDtg.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">仅仅用D3.js和普通的Javascript构建复杂的可视化动画会变得很快。挂钩use-d3-transition通过让您使用您所熟悉和喜爱的React模块性(就像上面的GIF中一样),使这项任务变得简单。)</p></figure><p id="b572" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu"> TLDR </strong>:想要一个定制的React挂钩，让React中的<a class="ae lr" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank"> D3.js </a>过渡/动画变得简单？<a class="ae lr" href="https://www.npmjs.com/package/use-d3-transition" rel="noopener ugc nofollow" target="_blank">查看我的npm包</a> <code class="fe ls lt lu lv b"><a class="ae lr" href="https://www.npmjs.com/package/use-d3-transition" rel="noopener ugc nofollow" target="_blank">use-d3-transition</a>.</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lw lx l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">传递你要动画的属性，然后用useD3Transition返回给你的！完成了。</p></figure></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="c022" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">我们想要的:React + D3转换</h1><p id="204c" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">我们只是喜欢那些非常流畅的动画/过渡。</p><p id="6e98" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">天哪，我们喜欢React的声明性和可组合性(尤其是在构建复杂的数据可视化时。)</p><p id="a66c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">那么，React中可以有D3转场吗？</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="100d" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">你可以…但是，目前来说，这有点痛苦</h1><p id="c655" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">D3/数据可视化女神<a class="nc nd ep" href="https://medium.com/u/4607b4069d83?source=post_page-----976396a45ede--------------------------------" rel="noopener" target="_blank"> Shirley Wu </a>做了惊人的工作，解释了React和D3的结合方式(<a class="ae lr" href="http://slides.com/shirleywu/deck#/" rel="noopener ugc nofollow" target="_blank">幻灯片摘要</a>、<a class="ae lr" href="https://www.youtube.com/watch?v=zXBdNDnqV2Q" rel="noopener ugc nofollow" target="_blank">视频</a>)。</p><p id="dfcb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">但是在我看来，如果你没有时间进行大规模重构(或者对React反模式没有兴趣)，现有的方法就太麻烦了。</p><p id="6198" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">(甚至<a class="ae lr" href="https://reactjs.org/docs/animation.html#low-level-api-reacttransitiongroup" rel="noopener ugc nofollow" target="_blank">只反应的动画解决方案</a>也需要重要的重构。)</p><p id="3911" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">有什么大不了的？为什么我们不能让它变得简单些？</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="2ca4" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">为什么这么难:D3和React想要独占DOM的控制权</h1><p id="4e36" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">当Mike Bostock在2011年发明D3的时候，web开发人员基本上是外科医生，每次他们想要进行更新时，就直接把手伸进DOM的内脏。</p><p id="07e2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">D3也不例外:它通过让您编写查找和变异DOM元素的代码来转换元素。</p><p id="3c48" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">快进到今天。我们生活在一个声明式web开发的世界里。React、Svelt、Vue、Ember和Angular都有一个共同的想法:你只需要告诉他们你想要渲染什么，他们就会负责DOM的更新。</p><p id="ba01" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">哦，这些框架都期望独占DOM的控制权。不好意思，D3，他们不合租。</p><p id="90a2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">有没有可能让它们很好地一起玩，而不用大规模地重写我们的组件？</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="3f78" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">解决方案:在过渡期间给D3独占的DOM控制权</h1><p id="d792" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">你可以通过在黑暗中对即将到来的更新做出反应来做到这一点。</p><h2 id="2c28" class="ne mg it bd mh nf ng dn ml nh ni dp mp le nj nk mr li nl nm mt lm nn no mv np bi translated"><em class="ku">实质技术方法</em></h2><ol class=""><li id="494b" class="nq nr it kx b ky mx lb my le ns li nt lm nu lq nv nw nx ny bi translated">当一个动画元素的属性改变时，调用一个React钩子，它使用D3通过直接DOM操作将元素的属性转换为新值。比如圆半径<code class="fe ls lt lu lv b">10px </code>到半径<code class="fe ls lt lu lv b">20px</code>。</li><li id="09b6" class="nq nr it kx b ky nz lb oa le ob li oc lm od lq nv nw nx ny bi translated">哦不——现在D3和React都在更新DOM！但是我们已经有了一个计划:我们通过从钩子返回旧的属性值来欺骗React暂停它自己对那个组件的更新。反应来看，好像组件没变。(卑鄙！)</li><li id="c67d" class="nq nr it kx b ky nz lb oa le ob li oc lm od lq nv nw nx ny bi translated">当转换完成时，我们才让React看到最终值，并忠实地运行自己的更新。(嘘，不要告诉React我们已经平滑地动画到那个值了！)</li></ol><p id="c8f2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">复杂？这就是为什么我们把所有的逻辑塞进一个可重用的钩子:<code class="fe ls lt lu lv b">useD3Transition</code>。</p><h2 id="9ae5" class="ne mg it bd mh nf ng dn ml nh ni dp mp le nj nk mr li nl nm mt lm nn no mv np bi translated">如何用use-d3-transition更新你的代码库</h2><p id="7865" class="pw-post-body-paragraph kv kw it kx b ky mx ju la lb my jx ld le mz lg lh li na lk ll lm nb lo lp lq im bi translated">假设您有下面的SVG <code class="fe ls lt lu lv b">circle</code> React组件，当您传入一个新的结束位置时，您希望平滑地更新其位置(<code class="fe ls lt lu lv b">cx</code>和<code class="fe ls lt lu lv b">cy</code>)。以下是在<code class="fe ls lt lu lv b">use-d3-transition</code>之前发生的事情:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="of og di oh bf oi"><div class="gh gi oe"><img src="../Images/448a20c7998db95e802a3ed4da66716c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*n8-IP0yEJ10a58EMxrU69g.gif"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">没有D3转换的反应…*嗅嗅*</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="92df" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">制作动画，简单来说</p><ol class=""><li id="2a5a" class="nq nr it kx b ky kz lb lc le oj li ok lm ol lq nv nw nx ny bi translated">传递<code class="fe ls lt lu lv b">useD3Transition</code>动态属性(<code class="fe ls lt lu lv b">cx</code>和<code class="fe ls lt lu lv b">cy</code>):</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/4e5ae4a5716a9352ce378af86c754912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*wPJ958XeYueTjgaVMoPN3A.png"/></div></figure><p id="d4e2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">2.在JSX元素中使用钩子返回的DOM节点引用<code class="fe ls lt lu lv b">ref</code>和反应停止值<em class="on">、</em>、<code class="fe ls lt lu lv b">attrState</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/9ccb7c2232385d87be4afce85408b581.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*4pgeRavqPde7CC0z4tsinw.png"/></div></figure><p id="769a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">瞧啊。平滑过渡(以及过渡过程中的优雅更新！).</p><p id="3395" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">尝试在代码沙箱中单击“切换圆形位置”:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op lx l"/></div></figure><p id="d655" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><a class="ae lr" href="https://www.npmjs.com/package/use-d3-transition" rel="noopener ugc nofollow" target="_blank">立即使用npm软件包</a>:</p><pre class="kj kk kl km gt oq lv or os aw ot bi"><span id="a5bb" class="ne mg it lv b gy ou ov l ow ox">npm install use-d3-transition </span><span id="16e9" class="ne mg it lv b gy oy ov l ow ox">yarn add use-d3-transition</span></pre></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><p id="a3a3" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">特别感谢</strong> : <strong class="kx iu"> </strong>这个钩子的灵感来源于<a class="nc nd ep" href="https://medium.com/u/8e43dcd3c21f?source=post_page-----976396a45ede--------------------------------" rel="noopener" target="_blank"> Swizec Teller </a>的博文，<a class="ae lr" href="https://swizec.com/blog/declarative-d3-transitions-react/swizec/8323" rel="noopener ugc nofollow" target="_blank">声明性D3转场与React 16.3 </a>。</p><p id="cffb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">技术提示:</strong>一些非常精明的React开发人员可能会注意到，虽然这个钩子阻止了自己的重新渲染，但是在某些边缘情况下，父钩子的重新渲染可能会在过渡过程中强制重新渲染，比如在使用上下文时。虽然这是真的，但我还没听说有人遇到过这种情况。这也是实现简单性公认折衷。</p></div></div>    
</body>
</html>