<html>
<head>
<title>How to Manage Microservices on Kubernetes With Istio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Istio管理Kubernetes上的微服务</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-manage-microservices-on-kubernetes-with-istio-c25e97a60a59?source=collection_archive---------4-----------------------#2020-04-23">https://betterprogramming.pub/how-to-manage-microservices-on-kubernetes-with-istio-c25e97a60a59?source=collection_archive---------4-----------------------#2020-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bdb3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在具有服务网格的微服务架构上实现DevSecOps</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/50e5c728ae8ff91991cbe91151a51208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*52Wm1a8SR7XTWM-XMCyKug.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/users/PIRO4D-2707530/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3357028" rel="noopener ugc nofollow" target="_blank"> PIRO4D </a>来自<a class="ae ky" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3357028" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></p></figure><p id="cdd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像<a class="ae ky" href="https://kubernetes.io" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>这样的容器和容器编排平台简化了我们运行<a class="ae ky" href="https://en.wikipedia.org/wiki/Microservices" rel="noopener ugc nofollow" target="_blank">微服务</a>的方式。</p><p id="b19e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">容器技术有助于推广这一概念，因为它使得在具有独立运行时的自包含单元中运行和扩展应用程序的不同组件成为可能。</p><p id="799d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然微服务架构通过将更改范围缩小到更小的部分、提高系统弹性、简化测试以及独立扩展应用程序的各个部分来实现更快的交付，但实现它也有其挑战。</p><p id="9267" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">微服务是管理和安全的噩梦，因为现在你有多个移动部件，每个部件都服务于特定的功能，而不是一个单一的应用程序。</p><p id="11ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个广泛的应用程序可以利用数百个相互交互的微服务，很快你会发现事情变得令人不知所措。您的安全和运营团队可能会问您的主要问题是:</p><ul class=""><li id="bb66" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我们如何确保微服务之间的通信是安全的？我们需要保护数百个较小的服务，而不是保护一个单一的应用程序。</li><li id="143f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果出现问题，我们如何隔离微服务来解决问题？</li><li id="0772" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们如何在向公众发布部署以获得信任之前，用很小比例的流量测试部署？</li><li id="ece0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">现在应用程序日志分布在多个地方，我们如何整合它们呢？</li><li id="06a6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">我们如何检查服务的健康状况？随着越来越多的组件组成应用程序，应用程序监控的任务变得更加复杂。</li></ul><p id="3723" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然Kubernetes解决了一些管理问题，但它应该是一个容器编排平台，并且在这方面做得非常好。</p><p id="6e99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它没有解决微服务架构的问题，它有不同的目的。服务管理不是Kubernetes的专长，因此，默认情况下，它不能回答所有问题。</p><p id="1fa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，Kubernetes容器之间的通信是不安全的，并且没有简单的方法来强制执行pods之间的TLS，因为您最终将独自维护数百个TLS证书。</p><p id="a264" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相互通信的pod不在它们之间应用身份和访问管理。</p><p id="b705" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管有一些工具，如Kubernetes Network Policy(T1 ),你可以在不同的设备之间运行防火墙，但它们是一个T2第三层T3解决方案，而不是T4第七层T5解决方案，这也是大多数现代防火墙的特点。</p><p id="9d48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着，虽然您可以知道流量的来源，但您无法窥视数据包以了解它们包含的内容。这不允许您做出重要的元数据驱动的决策，比如基于HTTP头在新版本的pod上路由。</p><p id="d92a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Kubernetes入口对象确实提供了一个基于第7层的反向代理，但是它们没有提供更多。</p><p id="3e0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Kubernetes确实提供了不同的部署方式，并进行某种形式的<a class="ae ky" href="https://en.wikipedia.org/wiki/A/B_testing" rel="noopener ugc nofollow" target="_blank"> A/B测试</a>和金丝雀部署。更多的是通过实现容器的副本来实现。</p><p id="b8c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我想部署一个新版本的微服务，并且只通过它传递10%的流量，我必须将我的容器扩展到至少10个，9个是旧版本，1个是新版本。</p><p id="ab30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Kubernetes不能智能地分割流量，而是以循环方式在pod之间进行负载平衡。</p><p id="2d70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pod中的每个Kubernetes容器都有单独的日志记录，您必须在Kubernetes上实现一个定制的解决方案来捕获和整合它们。</p><p id="06cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然Kubernetes仪表板提供了监控pod和检查其健康状况等功能，但它没有提供组件之间如何交互，每个pod中有多少流量，以及应用程序由哪些容器链组成。</p><p id="5c6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为您无法跟踪通过Kubernetes Pods的流量，所以您无法判断请求失败发生在链的哪个部分。</p><p id="bad4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过使用服务网格技术来解决所有这些问题，比如<a class="ae ky" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a>。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="c44c" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">介绍Istio</h1><p id="3213" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">那么，Istio是什么？Istio是一种服务网格技术，有助于连接、保护、控制和观察服务。</p><p id="fe00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行微服务应用程序时，每个单独的微服务都在容器中独立运行。因此，他们彼此之间有许多互动。</p><p id="14ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">服务网格使您能够发现、启用和控制这些交互，通常使用边车代理。专业术语太多？让我为你一个一个地解决它。</p><p id="3609" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们举一个具有前端和后端Pod的Kubernetes应用程序的典型例子。Kubernetes使用Kubernetes服务和<a class="ae ky" href="https://coredns.io/" rel="noopener ugc nofollow" target="_blank"> CoreDNS </a>在pod之间提供内置服务发现。</p><p id="9832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，您可以使用服务名从一个Pod路由到另一个Pod。然而，您无法控制这些交互如何工作，以及如何处理运行时流量。</p><p id="a39c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Istio所做的是在你的Pod中注入一个副车容器作为代理，你的主容器通过代理与另一个容器通信。</p><p id="ef2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，因为所有请求都通过代理，所以您可以控制流量并收集数据来处理它们。您还可以加密pod之间的通信，并使用单个控制面板实施身份和访问管理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/8a1720d3972066a11c0eb65b55de10ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mXfP8dp7vpnf1d7QCeVcFQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://istio.io/docs/concepts/security/arch-sec.svg" rel="noopener ugc nofollow" target="_blank"> Istio </a></p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="2bb8" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">Istio的核心功能</h1><p id="e4d0" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Istio具有以下核心功能。</p><h2 id="c39a" class="no mr it bd ms np nq dn mw nr ns dp na li nt nu nc lm nv nw ne lq nx ny ng nz bi translated">交通管理</h2><p id="c934" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">由于侧车代理(也称为特使代理)以及入口和出口网关，Istio管理流量并创建路由规则，允许您控制流量并定义服务之间的交互。</p><p id="31f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以做一些很酷的事情，比如实现超时、重试、断路器等等，所有这些都可以通过更改控制平面中的配置来实现。这使您可以做一些明智的事情，如A/B测试、canary部署和基于百分比的流量分流的阶段性部署。</p><p id="3ede" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它可以帮助您慢慢推出一个版本，并通过简单的控制从现有版本(蓝色)逐渐过渡到新版本(绿色)。</p><p id="bfde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您需要在生产中运行操作测试，并查看您的产品在实时流量中的表现，您可以对您的测试实例进行实时流量镜像。因此，您甚至可以在上线之前收集实时见解并识别潜在的生产问题！</p><p id="e145" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以让一个应用程序运行多种特定语言版本的微服务，并使用地理定位或用户配置文件将请求路由到正确的版本，等等！</p><h2 id="fdf8" class="no mr it bd ms np nq dn mw nr ns dp na li nt nu nc lm nv nw ne lq nx ny ng nz bi translated">安全性</h2><p id="23a0" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Istio通过相互TLS在pod之间建立身份访问管理，使您能够通过envoy代理保护您的微服务。</p><p id="128c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们帮助您抵御中间人攻击，因为它们提供开箱即用的pod之间的流量加密。也就是说，前端和后端之间可以相互认证，并且只有前端可以连接到后端。</p><p id="bd60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">后端只信任前端，反之亦然，所以如果其中一个pod受到损害，没有人能够对应用程序的其余部分做任何事情。</p><p id="62ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Istio还为您提供了通过细粒度策略来限制访问的特性，并使用Kubernetes目前缺乏的审计工具来确定集群中正在发生什么。</p><h2 id="c9e0" class="no mr it bd ms np nq dn mw nr ns dp na li nt nu nc lm nv nw ne lq nx ny ng nz bi translated">可观察性</h2><p id="b113" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">由于特使侧车，Istio意识到通过吊舱的交通，因此从服务收集遥测细节。这有助于获得关于服务行为的见解，并且您可以了解未来可以用来优化您的应用程序的可能性。</p><p id="17a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它还整合了应用程序日志，并可以通过多个微服务实现流量跟踪。这有助于您更快地发现问题，并允许您隔离故障服务并修复它。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="94b1" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">为您的团队开发软件</h1><p id="1a89" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Istio提供的最好的东西是，它不会让开发人员担心实现的安全性和管理细节。</p><p id="8a7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于Istio是Kubernetes感知的，他们仍然可以像标准的Kubernetes部署一样开发他们的应用程序，并且Istio自动将侧车容器注入到pod中。</p><p id="ffb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦Istio插入侧车容器，操作和安全团队就可以对流量实施策略，并帮助保护和操作应用程序。大家共赢！</p><p id="696d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Istio使安全和运营团队能够有效地监控微服务应用，而不会影响开发团队的工作效率。</p><p id="ef51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它还使组织内的团队能够保留他们的位置，并着眼于他们的专业领域。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="33b9" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="d28a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">感谢您的阅读！我希望你喜欢这篇文章。接下来的故事描述了“Istio如何在Kubernetes 上幕后工作”。所以下一部分再见！</p></div></div>    
</body>
</html>