<html>
<head>
<title>How To Improve Continuous Integration Processes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何改进持续集成过程</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-improve-continous-integration-process-541242d7a1fb?source=collection_archive---------8-----------------------#2021-09-07">https://betterprogramming.pub/how-to-improve-continous-integration-process-541242d7a1fb?source=collection_archive---------8-----------------------#2021-09-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0018" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在持续测试之外使用CI</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/47cc0b7374a96c0c0e64d4aef117b213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6TGCG0Ts2fev07gm"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">约翰·施诺布里奇在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><h1 id="268e" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">现状</h1><p id="3295" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">持续集成(或CI)这个名字在开发人员中被抛来抛去，却没有深入思考它的实际含义。更普遍的说法是(至少在我的经验中)它是持续测试的同义词，或者更具体地说，是指每当推送新的提交或创建拉取请求时，负责构建和测试应用程序的系统。</p><p id="8808" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然而，这是持续集成的一个简化定义，它远不止于此。</p><p id="bea3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">科技创业公司中最普遍的惯例(这也是我的经验)是，所有开发人员都在开发分支工作，当他们的工作准备好被合并时，他们会发送一个pull请求。所有这些更改都被推送到一个中央存储库，比如GitHub，然后一些CI系统，比如Travis或GitHub Actions，构建并测试代码。</p><p id="ffe5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">本质上，持续集成就是将各种并行的工作集成到一个公共的代码库中。</p><p id="56ac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在接下来的内容中，我将描述团队可能想要使用或考虑的其他事情，以使集成更加持续。其中一些听起来很明显，但我认为花一点时间去思考它以确保它确实是你所遵循的方向是很有趣的。</p><h1 id="02c2" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">我们为什么要在乎呢？</h1><p id="8199" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">最明显的原因是，没有定期合并到主分支中的代码库的长期版本会导致更多的合并冲突，并且这些冲突通常更难解决。采取健康的做法可以避免所有不必要的工作。</p><p id="9a9d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">除了解决冲突的额外工作之外，对于相关的开发人员来说，不集成通常感觉很慢。他们可能会觉得事情没有进展，他们的工作没有真正产生强大的影响。</p><p id="876e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">不仅会让人痛苦，还会严重阻碍人的表现和留存。</p><p id="78ac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我也很好奇长时间的拉伸工作对由此引入的bug数量的影响。假设人们不太可能把所有移动的部分都记在脑子里，因此更可能犯错误，这可能不是太疯狂。</p><h1 id="fca9" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">经常改变基础</h1><p id="4851" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">就个人而言，最简单的开始方式是经常调整基数。也就是反过来集成:从主代码库到开发分支。</p><p id="c561" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这不是一个非常有趣的观点，但值得一提，因为当一个人埋头苦干时，这很容易被忽视。</p><h1 id="2894" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">合并更频繁</h1><p id="3e4d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在应该很清楚，主要的焦点应该是更频繁地合并，以尽早集成变更，并给其他开发人员一个机会，通过重新调整他们自己的变更来发现任何问题，例如冲突。</p><h1 id="90b4" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">将变更分解成较小的拉取请求</h1><p id="64f2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">也许完成一项任务最自然的方式是一次完成，然后发送一个大规模的拉式请求，让一个不幸的同事来审阅。</p><p id="2f61" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">除了将任务分解成本身仍然有价值的更小的任务——这是你绝对应该做的——你也可以将它分解成本身不一定提供价值的更小的任务。这听起来可能很傻，但它确实可以帮助事情向前发展。</p><p id="1bb0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">考虑给一个函数添加对新情况的支持，并在实际使用它之前进行修改。或者反过来，让一个新的端点使用一个可以在以后填充的虚拟实现。在这种情况下，请参见关于功能标志的部分。</p><p id="435b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">值得一提的是，这样做的一个副作用可能是，当您开始实现其余部分并意识到您的假设是错误的时候，您最终合并了实际上并不需要的代码。您应该记住这一点，并适当地注释您的代码。当然，你的编译器，linter等可以帮助解决这个问题。</p><p id="e339" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">较小变更的另一个优点是可以更详细地检查它们，并且可以更早地发现潜在的问题。我不知道你是怎么想的，但是当我被要求审查一个有1，500个添加和700个删除的拉取请求时，我就不那么专心了。</p><p id="ef07" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">老实说，我经常不遵循我自己的建议，因为，当然，将变更分解成更小的拉请求只有在您不必等待一周的时间来审查和合并这些请求的情况下才是可行的，这导致了下面的观点。</p><p id="de45" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这(在某种程度上)是一种团队行动，而不是单打独斗。</p><h1 id="0911" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">区分代码评审的优先级</h1><p id="a7e7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们很容易将自己的工作按优先顺序排列，认为通过专注于当前的任务，我们将能够更快地完成任务，并且可能更容易将问题留在脑海中。因此，我们可能会将代码审查推迟到以后。</p><p id="87a6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">虽然它可以提高你自己的生产力，因为其他一切都保持不变，但在我看来，这是一种简化的看待事物的方式。</p><p id="3e61" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">软件工程通常是一项团队运动。最终重要的是项目向前推进了多少，而不是个人的贡献。因此，我们应该把注意力从我们自己转移到整个团队的表现上来。</p><p id="3a01" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">将团队放在第一位，优先考虑代码审查成为最有效的途径，因为它使另一个团队成员富有成效。</p><p id="16af" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">作为一个经验法则，我尝试——尽管说起来容易做起来难——在我休息后的第一件事就是检查拉请求。在这样的休息之后，你的工作记忆已经基本被清空了，所以你最好在重新开始当前的工作之前做一些其他的事情，比如回顾。</p><h2 id="6d90" class="mq kx iq bd ky mr ms dn lc mt mu dp lg lx mv mw li mb mx my lk mf mz na lm nb bi translated">一天内检查或合并</h2><p id="76ca" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这里有一些你可能想尝试的东西，我发现在我之前的一个团队中非常有效。</p><p id="3662" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在确定等待审查的拉请求对我们的工作有重大影响之后，我们决定允许我们合并任何等待超过48小时的拉请求。</p><p id="401e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">滴答作响的时钟通常是一个极好的激励因素。</p><h1 id="d84e" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">功能标志</h1><p id="d182" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当涉及到持续集成时，系统地使用特性标志来支持更改会给表带来两个重要的好处。</p><p id="a3ac" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">首先，较小的变化成为可能。例如，如果一个新特性实际上还没有被任何用户使用，那么它在被合并之前不一定要被完全实现或修饰。一些边缘情况可以不处理，或者部分代码可能是用于测试的临时虚拟实现。</p><p id="f1be" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">第二个好处是<em class="mp">衍生</em>代码变更。我们首先进行代码审查的部分原因是为了在问题进入生产和影响真实用户之前发现它们。功能标志可用于将此任务推迟到以后。如果一个bug没有被审查者发现，它可以在修改进入主代码库之后，但在特性为每个人启用之前被发现。这意味着评论可能会快一点。</p><h1 id="49fa" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">退耦</h1><p id="fb7b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">整个团队在同一个代码库上工作，不可避免地会导致两个人对同一个东西进行修改，从而导致合并冲突。任何降低这种可能性的方法都是向持续集成迈进了一步。</p><p id="cd4c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">除了仔细挑选最不可能引起冲突的任务之外，关注减少代码库中的耦合也是有帮助的。当然，这本身是一件好事，因为它降低了复杂性，允许更快的开发，并减少了出错的可能性。</p><h1 id="36e7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">劈开一块巨石</h1><p id="1fe3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">随着企业向云迁移，将一个整体应用拆分成微服务最近风靡一时。这样做的典型原因是为了使应用程序更具可伸缩性和弹性。</p><p id="950c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">独立组件(微服务或其他)可以独立构建，这可以极大地提高团队快速部署变更的能力。</p><p id="f054" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">当然，它带来了自己的复杂性和大量的工作，但值得思考的是，如果开发人员不必在测试运行和应用程序部署到生产环境之前等待一个小时，他们的工作效率会有多高。</p><h1 id="98e0" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">弹性是加快行动的工具</h1><p id="d142" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">更加强调系统的弹性当然有助于你晚上睡觉，也有助于减轻bug和错误的影响，从而允许尽早集成变更。</p><p id="fbe1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">乍看之下，改进生产基础设施会有助于持续集成，这一点可能并不明显，但我确信这确实会产生实际影响。</p><p id="e028" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">解决这个问题的一个方法是<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/developers-should-be-a-little-bit-reckless-3d2521ad9641">允许开发者肆无忌惮</a>。</p><h1 id="0867" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">持续部署</h1><p id="b343" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当把一个变更分解成更小的拉请求或者使用特性标志来测试和试验新特性时，拥有一个短的反馈循环是很重要的。</p><p id="7f92" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这种情况下，这意味着短的发布周期。当然，没有比连续部署更短的时间了，因为您最终会以构建和测试套件运行的最快速度将变更部署到生产环境中。</p><p id="8e20" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">短的发布周期是上面讨论的一些技术的先决条件。例如，如果合并较小的变更不会导致任何反馈，除了潜在的“破坏构建”的压力之外，就很容易退回到进行较大的拉请求</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="b4e6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这是一种关于改进持续集成的思想的随机拼凑，没有太多的结构。希望你能发现这是有用的，只要开始考虑除了简单地对拉请求运行测试之外，改进你自己的工作流的方法。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="ff52" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你喜欢这样的故事，可以考虑成为<a class="ae kv" href="https://inconclusive.medium.com/membership" rel="noopener">媒体</a>和/或<a class="ae kv" href="https://inconclusive.medium.com/subscribe" rel="noopener">订阅</a>的会员。</p></div></div>    
</body>
</html>