<html>
<head>
<title>From Swift Import Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Swift导入Python</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/from-swift-import-python-f2fc2a997d4?source=collection_archive---------3-----------------------#2020-08-24">https://betterprogramming.pub/from-swift-import-python-f2fc2a997d4?source=collection_archive---------3-----------------------#2020-08-24</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="9b36" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">构建一个macOS应用程序，从SwiftUI代码库运行Python脚本</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/5bf3717c593c0604894fe5b13c6f5d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JAUJuALq17_YHuUFtShLFg.png"/></div></div></figure><p id="4ab9" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Python早已确立了自己作为数据科学无可争议的领导者的地位。但是随着数据量的不断增加，Python的缺点也开始被注意到。在大规模应用中，速度慢、并行性受限以及缺乏类型安全性都是一个障碍。</p><p id="5cb4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">谷歌显然将赌注压在Swift上，认为它是深度学习的未来。难怪，他们为了Tensorflow对Swift进行了大量投资。</p><p id="fd26" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">虽然Python自诩拥有大量的库，但从它身上转移并不容易，但我们仍然可以利用它与Swift的互操作性。</p><p id="faf6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">是的，您可以通过使用PythonKit从Swift运行python代码，python kit是一个基于TensorFlow 项目<a class="ae lv" href="https://github.com/tensorflow/swift" rel="noopener ugc nofollow" target="_blank"> Swift的<code class="fe lr ls lt lu b">Python</code>模块的框架。</a></p><p id="65a7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">需要注意的是，Python在iOS上不可用。但是你可以为macOS和Linux构建非常棒的实用程序。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="4866" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">PythonKit的优势</h1><ul class=""><li id="1a02" class="mv mw iu kx b ky mx lb my le mz li na lm nb lq nc nd ne nf bi translated">您的Swift代码库可以直接访问丰富的Python模块和包。</li><li id="330b" class="mv mw iu kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">Python开发人员可以轻松构建macOS应用程序来运行自动化脚本和执行数值计算。</li><li id="eec9" class="mv mw iu kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">无需在Swift中捆绑大型OpenCV和Tensorflow框架，您可以简单地在您的系统上安装Python对应物，并在所有涉及PythonKit的macOS应用程序中使用它。</li></ul><p id="a328" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在接下来的几节中，我们将看到如何在SwiftUI macOS应用程序中设置PythonKit并执行一些有趣的任务。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="08cc" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">在macOS应用程序中添加PythonKit</h1><p id="2ef9" class="pw-post-body-paragraph kv kw iu kx b ky mx jv la lb my jy ld le nl lg lh li nm lk ll lm nn lo lp lq in bi translated">首先，以macOS为目标创建一个新的Xcode项目，并使用Swift Package Manager添加以下包依赖项:</p><pre class="kk kl km kn gu no lu np nq aw nr bi"><span id="cc3d" class="ns me iu lu b gz nt nu l nv nw">.package(url: "https://github.com/pvieito/PythonKit.git", .branch("master")),</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nx"><img src="../Images/b6a730eb84f45536e84573dd255083b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NFUMnB2B6rq7pcWGyceycg.png"/></div></div><p class="ny nz gk gi gj oa ob bd b be z dk translated">文件-&gt;Swift包-&gt;添加包依赖-&gt;输入<a class="ae lv" href="https://github.com/pvieito/PythonKit" rel="noopener ugc nofollow" target="_blank">这个git URL </a></p></figure><p id="e303" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，您可以<code class="fe lr ls lt lu b">import PythonKit</code>在您的Swift视图中开始。要检查当前python版本并进行更新，请使用以下代码行:</p><pre class="kk kl km kn gu no lu oc bn od oe bi"><span id="5d50" class="of me iu lu b be og oh l oi nw">print(Python.version)<br/>PythonLibrary.useVersion(2)<br/>//or <br/>PythonLibrary.useVersion(3, 8)</span></pre><p id="8d05" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">注:<code class="fe lr ls lt lu b">PythonLibrary.useVersion</code>需要放在进口声明的正下方。您不能在运行时动态更改Python版本号。</p><p id="d1d5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">接下来，确保您已经从签名和功能部分删除了App sandbox，因为我们将直接在mac上使用Python程序:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oj"><img src="../Images/a010483d2e2c2e8c2c124893b7b6745c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SeHM6td7yAIVs_cDPuMLSA.png"/></div></div></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="46ba" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">在Swift中运行您的第一个Python脚本</h1><p id="2c04" class="pw-post-body-paragraph kv kw iu kx b ky mx jv la lb my jy ld le nl lg lh li nm lk ll lm nn lo lp lq in bi translated">让我们在一个<code class="fe lr ls lt lu b">.py</code>文件中编写一个hello world风格的Python函数:</p><pre class="kk kl km kn gu no lu oc bn od oe bi"><span id="21c5" class="of me iu lu b be og oh l oi nw">def hello():<br/>    return "Hello Swift, I'm Python"</span></pre><p id="14b5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，将它保存在一个文件中，并记下它的路径。</p><p id="3688" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">下面的Swift方法调用上面的Python函数并返回结果:</p><pre class="kk kl km kn gu no lu oc bn od oe bi"><span id="4468" class="of me iu lu b be og oh l oi nw">func runPythonCode(){<br/>  let sys = Python.import("sys")<br/>  sys.path.append(dirPath)<br/>  let example = Python.import("sample")<br/>  let response = example.hello()<br/>}</span></pre><p id="b909" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">从上面这段Swift代码中可以观察到一些东西:</p><ul class=""><li id="18a4" class="mv mw iu kx b ky kz lb lc le ok li ol lm om lq nc nd ne nf bi translated"><code class="fe lr ls lt lu b">dirPath</code>是文件位置的路径。对我来说是:<code class="fe lr ls lt lu b">/Users/anupamchugh/Desktop/workspace/</code>。</li><li id="c952" class="mv mw iu kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><code class="fe lr ls lt lu b">Python.import</code>用于导入一个Python模块。在我们的例子中，我们导入了包含hello world代码的<code class="fe lr ls lt lu b">sample.py</code>文件。</li><li id="4dd6" class="mv mw iu kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><code class="fe lr ls lt lu b">example</code>是PythonObject类型的Swift实例。我们对它调用<code class="fe lr ls lt lu b">hello</code>函数。</li><li id="4a0d" class="mv mw iu kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">响应实例也是一个<code class="fe lr ls lt lu b">PythonObject</code>，在我们的例子中，它被隐式地转换成一个字符串。</li></ul><p id="2d43" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们可以通过以下方式将<code class="fe lr ls lt lu b">PythonObject</code>显式转换为原生Swift类型:</p><pre class="kk kl km kn gu no lu oc bn od oe bi"><span id="4b16" class="of me iu lu b be og oh l oi nw">let str = String(pythonString)!<br/>let arr = Array(pythonArray)!</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="fde7" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">交换Python变量并返回Swift</h1><p id="db89" class="pw-post-body-paragraph kv kw iu kx b ky mx jv la lb my jy ld le nl lg lh li nm lk ll lm nn lo lp lq in bi translated">让我们看看在Python函数中互换Swift中两个变量内容的经典案例:</p><pre class="kk kl km kn gu no lu oc bn od oe bi"><span id="b34a" class="of me iu lu b be og oh l oi nw">def swap(a, b):<br/>    a, b = b, a<br/>    return a, b</span></pre><p id="b809" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，让我们从Swift函数中调用它来获取结果:</p><pre class="kk kl km kn gu no lu oc bn od oe bi"><span id="b8e7" class="of me iu lu b be og oh l oi nw">func swapNumbersInPython(){<br/>  let sys = Python.import("sys")<br/>  sys.path.append(dirPath)<br/>  let example = Python.import("sample")<br/>  let response = example.swap(swapA, swapB)<br/>  let arr : [Int] = Array(response)!<br/>  swapA = arr[0]<br/>  swapB = arr[1]<br/>}</span></pre><p id="6327" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe lr ls lt lu b">swapA</code>和<code class="fe lr ls lt lu b">swapB</code>是SwiftUI状态变量，最终会在屏幕上更新。</p><p id="66f9" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">让我们用上面的Python脚本运行我们的macOS SwiftUI应用程序:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj on"><img src="../Images/0de0cdd4873ce96c281edfff9b8158d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/1*FZas8vgM3Vp0TOw2wyzg7A.gif"/></div></figure><p id="0c9e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">据此，我们成功构建了第一个具备Swift和Python互操作性的macOS应用程序。</p><p id="f5f1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">但这是微不足道的。让我们写一个更好的Python脚本。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="76db" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">使用Python脚本下载视频并在SwiftUI VideoPlayer中显示</h1><p id="74ba" class="pw-post-body-paragraph kv kw iu kx b ky mx jv la lb my jy ld le nl lg lh li nm lk ll lm nn lo lp lq in bi translated">Python有一个流行的包，名为<code class="fe lr ls lt lu b">youtube-dl</code>，用于从YouTube和许多其他网站下载视频。</p><p id="ddb5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">让我们把它安装在我们的mac上。以下pip命令适用于Python3:</p><pre class="kk kl km kn gu no lu np nq aw nr bi"><span id="1163" class="ns me iu lu b gz nt nu l nv nw">pip3 install youtube-dl</span></pre><p id="aaa5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，在Python文件中添加以下函数:</p><pre class="kk kl km kn gu no lu oc bn od oe bi"><span id="0ba3" class="of me iu lu b be og oh l oi nw">import youtube_dl<br/><br/>videoName = "NA"<br/><br/>def hello():<br/>    return "Hello Swift, this is Python"<br/><br/>def swap(a, b):<br/>    a, b = b, a<br/>    return a, b<br/><br/>def downloadVideo(link, path):<br/>    ydl_opts = {<br/>    'format': 'best',<br/>    'writesubtitles' : 'writesubtitles',<br/>    'outtmpl': path + '/%(title)s.%(ext)s'<br/>    }<br/><br/>    with youtube_dl.YoutubeDL(ydl_opts) as ydl:<br/>        info_dict = ydl.extract_info(link, download=False)<br/>        videoName = info_dict.get('title', None) + '.' + info_dict.get('ext', None)<br/>        ydl.download([link])<br/><br/>    return videoName</span></pre><p id="3319" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe lr ls lt lu b">link</code>和<code class="fe lr ls lt lu b">path</code>参数从Swift传递，前者是视频链接，后者是保存视频的目录路径。</p><p id="eeb3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe lr ls lt lu b">ydl.download()</code>下载视频，我们将<code class="fe lr ls lt lu b">videoName</code>返回给Swift代码:</p><pre class="kk kl km kn gu no lu oc bn od oe bi"><span id="afc7" class="of me iu lu b be og oh l oi nw">func downloadVideo(link: String){<br/>  let sys = Python.import("sys")<br/>  sys.path.append(dirPath)<br/>  let example = Python.import("sample")<br/>  let response = example.downloadVideo(link, dirPath)<br/>  videoPath = String(response)<br/>}</span></pre><p id="6a16" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，WWDC 2020的SwiftUI在运行macOS 11.0和iOS 14的设备上引入了对<code class="fe lr ls lt lu b">VideoPlayer</code>的内置支持。不过，对于iOS 13，你可以利用<code class="fe lr ls lt lu b">UIViewRepresentable</code>协议来创建自定义视频视图。</p><p id="4d55" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">通过使用<code class="fe lr ls lt lu b">videoPath</code>，我们能够在SwiftUI中显示下载的视频文件，如下所示:</p><pre class="kk kl km kn gu no lu oc bn od oe bi"><span id="99d9" class="of me iu lu b be og oh l oi nw">let url = URL(fileURLWithPath:dirPath+videoPath)<br/>VideoPlayer(player: AVPlayer(url: url))</span></pre><p id="6647" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">让我们运行上面的mac应用程序来查看输出:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oo"><img src="../Images/9f865e3c1653901c67b5ef85030177a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/1*J_2hApqQrMnRWwsLnMgnMA.gif"/></div></div><p class="ny nz gk gi gj oa ob bd b be z dk translated">该视频是对<a class="ae lv" href="https://www.youtube.com/watch?v=NLOp_6uPccQ" rel="noopener ugc nofollow" target="_blank">蝙蝠侠的挑逗</a>的一瞥</p></figure><p id="0e2e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您可以在<a class="ae lv" href="https://github.com/anupamchugh/iowncode/tree/master/PythonKitBasics" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>中找到SwiftUI应用程序和Python脚本的完整源代码。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="7d41" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="878f" class="pw-post-body-paragraph kv kw iu kx b ky mx jv la lb my jy ld le nl lg lh li nm lk ll lm nn lo lp lq in bi translated">我们看到了Python-Swift互操作性如何使从Swift运行Python代码成为可能。除了视频下载，您还可以运行自动化任务，如批处理文件重命名，磁盘空间分析器，等等。</p><p id="68c4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Python和Swift是两种语法简洁明了的语言。虽然后者被视为深度学习的未来，但前者将在未来几年作为第二把交椅发挥关键作用。</p><p id="6d99" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">PyCon 2022中PyScript的推出带来了从HTML运行Python的新方式。由于Python和Swift已经可以互操作，在移动应用中使用Python的可能性是无限的。</p></div></div>    
</body>
</html>