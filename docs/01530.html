<html>
<head>
<title>How To Handle Async Providers in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular中处理异步提供者</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-handle-async-providers-in-angular-51884647366?source=collection_archive---------0-----------------------#2019-09-21">https://betterprogramming.pub/how-to-handle-async-providers-in-angular-51884647366?source=collection_archive---------0-----------------------#2019-09-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="68e4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">解释从配置文件加载基本API URL的值并将其与<code class="fe kf kg kh ki b">InjectionToken</code>一起使用的问题</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/4158d53d50ee630fdbf8ff76105746a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*avlg0U4o26ozRD2Ft6DT9Q.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@lucabravo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卢卡·布拉沃</a>在<a class="ae kz" href="https://unsplash.com/s/photos/angular-web?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d239" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果你不确定这个标题是什么意思，不要担心。让我解释一下。<br/>我最近遇到了一个问题，我们需要从一个配置文件中加载一个基本API URL(例如，http://localhost:9000)的值，并在我们的应用程序中使用带有<code class="fe kf kg kh ki b">InjectionToken</code>的值。</p><p id="8742" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我将在这篇博文中解释我最终做了什么。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="9061" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">APP_INITIALIZER拯救世界</h1><p id="b1fc" class="pw-post-body-paragraph la lb iq lc b ld mv jr lf lg mw ju li lj mx ll lm ln my lp lq lr mz lt lu lv ij bi translated">你可能对<code class="fe kf kg kh ki b">APP_INITIALIZER</code>很熟悉。如果没有，我推荐阅读这篇关于角度深度的文章。</p><p id="ab80" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b">APP_INITIALIZER</code>让你在应用程序的其余部分加载之前，就可以进入Angular的引导过程。</p><h2 id="17a6" class="na me iq bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">服务</h2><p id="deb9" class="pw-post-body-paragraph la lb iq lc b ld mv jr lf lg mw ju li lj mx ll lm ln my lp lq lr mz lt lu lv ij bi translated">让我们创建加载配置的服务。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="c71c" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">很简单，对吧？<code class="fe kf kg kh ki b">getBaseUrl()</code>对<code class="fe kf kg kh ki b">/assets/config.json</code>执行一个<code class="fe kf kg kh ki b">GET</code> <strong class="lc ir"> </strong>请求，并使用一些<a class="ae kz" href="https://rxjs-dev.firebaseapp.com/" rel="noopener ugc nofollow" target="_blank"> RxJS </a> <em class="no"> </em>魔法<em class="no"> </em>从结果JSON中提取属性<code class="fe kf kg kh ki b">baseUrl</code>。</p><p id="558b" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">它还将结果值存储在私有属性<code class="fe kf kg kh ki b">baseApiUrl</code>中，该属性由getter <code class="fe kf kg kh ki b">baseUrl</code>公开。我添加了<code class="fe kf kg kh ki b">loadConfig()</code>以防需要加载多个值。<code class="fe kf kg kh ki b">loadConfig()</code>也是我们将在<code class="fe kf kg kh ki b">APP_INITIALZER</code>中使用的。</p><h2 id="76fa" class="na me iq bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">应用程序模块</h2><p id="9810" class="pw-post-body-paragraph la lb iq lc b ld mv jr lf lg mw ju li lj mx ll lm ln my lp lq lr mz lt lu lv ij bi translated"><code class="fe kf kg kh ki b">AppLoadModule</code>将提供<code class="fe kf kg kh ki b">APP_INITIALIZER</code>。代码也非常简单。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d594" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们添加了一个工厂函数，它将我们的服务作为第一个参数。在这个函数中，我们返回一个返回承诺的函数——这个承诺就是我们想要做的事情。</p><p id="e8ed" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">感谢RxJS，我们可以在整个应用程序中使用RxJS的优点，并在需要时将其转化为承诺。我们也可以在工厂函数中直接使用<code class="fe kf kg kh ki b">HttpClient</code>,但是你可以在你的应用程序中共享的代码越多越好。</p><p id="8e9a" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">接下来我们要做的是<code class="fe kf kg kh ki b">provide</code> <code class="fe kf kg kh ki b">APP_INITIALIZER</code>。</p><ul class=""><li id="14d4" class="np nq iq lc b ld le lg lh lj nr ln ns lr nt lv nu nv nw nx bi translated"><code class="fe kf kg kh ki b">useFactory</code>告诉Angular使用哪个工厂功能。你也可以用内联方式写。</li><li id="76cf" class="np nq iq lc b ld ny lg nz lj oa ln ob lr oc lv nu nv nw nx bi translated"><code class="fe kf kg kh ki b">deps</code>告诉Angular处理工厂需要哪些服务或其他注入。您输入<code class="fe kf kg kh ki b">deps</code>的顺序会影响您对函数参数的排序。</li></ul><p id="94a1" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b">AppLoadModule</code>到此为止。</p><h2 id="101b" class="na me iq bd mf nb nc dn mj nd ne dp mn lj nf ng mp ln nh ni mr lr nj nk mt nl bi translated">配置模块</h2><p id="0004" class="pw-post-body-paragraph la lb iq lc b ld mv jr lf lg mw ju li lj mx ll lm ln my lp lq lr mz lt lu lv ij bi translated">我们需要的最后一个模块是<code class="fe kf kg kh ki b">ConfigModule</code>。在我看来，为此创建一个单独的模块是没有必要的，但是可以在更大的应用程序中清理这些东西。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="ffb4" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们在这里所做的就是提供一个名为<code class="fe kf kg kh ki b">BASE_API_URL_TOKEN</code>的<code class="fe kf kg kh ki b">InjectionToken</code>。我在整个应用程序中使用它来告诉服务API服务器在哪里。</p><p id="1769" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们使用工厂是因为我们需要访问<code class="fe kf kg kh ki b">ConfigService</code>。<code class="fe kf kg kh ki b">useFactory</code>和<code class="fe kf kg kh ki b">deps</code>做的事情和上面一样，不同的是提供者的工厂不支持承诺，这就是这篇文章之所以必要的全部原因。</p><p id="a370" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在剩下要做的就是<code class="fe kf kg kh ki b">import</code>你选择的模块中的两个模块，你就可以开始了。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="a884" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">摘要</h1><p id="e972" class="pw-post-body-paragraph la lb iq lc b ld mv jr lf lg mw ju li lj mx ll lm ln my lp lq lr mz lt lu lv ij bi translated">我不禁想到，有或者应该有更好的方法来做到这一点。我也认为我在这里描述的解决方案没有那么糟糕。</p><p id="fdf0" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果您想查看我的完整示例，我创建了一个<a class="ae kz" href="https://github.com/beyerleinf/angular-async-module-providers" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>，您可以自己克隆、运行和检查它。</p><p id="ee29" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">总而言之，我们真正需要做的就是在应用程序的其余部分可用之前，使用Angular的<code class="fe kf kg kh ki b">APP_INITIALIZER</code>来加载配置，并将它们保存在服务中。一旦我们在应用程序中包含了它们，提供它们就相当容易了。</p><p id="630b" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果你对此有任何建议或者更好的解决方案，请写在下面。</p><p id="0118" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>