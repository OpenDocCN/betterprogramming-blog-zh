<html>
<head>
<title>4 Options To Consider for Writing User-Friendly Python Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写用户友好的Python函数需要考虑的4个选项</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/4-options-to-consider-for-writing-user-friendly-python-functions-269cd8c98d51?source=collection_archive---------14-----------------------#2021-02-24">https://betterprogramming.pub/4-options-to-consider-for-writing-user-friendly-python-functions-269cd8c98d51?source=collection_archive---------14-----------------------#2021-02-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0623" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">函数不仅仅是好的名字和文档字符串</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f656345de754046774232055850d52a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SpeSXc6otts_lRxd"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Patrick Fore 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="4bf6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">函数构成了任何Python或编程项目的驱动力。除了数据模型和结构设计之外，项目的功能在其可维护性方面也起着重要的作用。我们经常谈论代码库中函数和其他组件的可读性。在许多情况下，函数的可读性指的是合理的名称和清晰的文档字符串。这些应该是编写更好的函数的优先事项。</p><p id="0b29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了这些基础，Python中还有可选的特性，可以让你的函数变得更好。他们对终端用户更友好。在本文中，我想谈谈其中的四个特性。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="44df" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">1.类型提示</h1><p id="2f90" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">静态类型语言通常需要在函数声明中指定参数的类型。作为一种动态语言，Python不要求我们在函数中指定参数的类型。然而，随着Python ( <a class="ae ky" href="https://www.python.org/dev/peps/pep-0484/" rel="noopener ugc nofollow" target="_blank"> PEP484 </a>)中类型提示的引入，可以在函数中提供参数的类型信息。</p><p id="d332" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下代码向您展示了一个简单的示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">类型提示</p></figure><p id="c255" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过类型提示，ide可以在您调用这些函数时提供更有意义的信息，如下面的屏幕截图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/100cda6bab93ef8d2ce08b10b496520b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sMlE5I8eRFeThSBiqWWDCg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">清除函数签名</p></figure><p id="bd4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的一点是，有时函数的类型超出了内置函数的类型(例如<code class="fe nd ne nf ng b">str</code>、<code class="fe nd ne nf ng b">int</code>、<code class="fe nd ne nf ng b">list</code>)。在这种情况下，您可以利用包含更高级类型的<code class="fe nd ne nf ng b">typing</code>模块。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/c13f5a4a2598985fb9866a4b2509453a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZHBJzgJvoBqCTDaOr2_DGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">高级类型提示</p></figure><p id="cd4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，上面的例子向你展示了<code class="fe nd ne nf ng b">Optional</code>类型的用法。在该函数中，需要一个<code class="fe nd ne nf ng b">int</code>或<code class="fe nd ne nf ng b">None</code>。当我们试图使用不兼容的对象类型时，IDE(在我的例子中是PyCharm)会给出一个适用的警告消息。</p><p id="762a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应该注意的是，即使您使用与类型提示不一致的不兼容对象类型调用函数，您的代码仍然可以运行，直到遇到异常。换句话说，Python中并不严格要求输入。在Python中，在编译(到字节码)或运行时不执行类型检查，直到您的程序因为异常而被迫停止。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f223" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">2.仅关键字参数</h1><p id="75b9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们知道Python函数可以有位置参数和关键字参数。具体来说，关键字参数是由标识符(即关键字)指定的参数。相比之下，位置参数是由位置指定的参数。换句话说，位置参数不是关键字参数。</p><p id="766c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python中的函数调用范式允许我们通过位置隐式传递参数，或者通过关键字显式传递参数。下面的代码片段显示了一个示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python中的函数调用</p></figure><p id="6e6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，你可能知道，当我们按位置调用函数时，并不清楚某些参数是什么意思。在上面的例子中，使用关键字的第二次调用比第一次调用更清晰。</p><p id="730a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了通过关键字强制调用，我们可以在定义函数时实现仅关键字参数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">仅关键字函数</p></figure><p id="d834" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">函数中的星号表示星号后面的所有参数都必须指定为关键字参数。让我们试着调用这个函数:</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="c106" class="nl me it ng b gy nm nn l no np">&gt;&gt;&gt; add_numbers_better(5, 7, 20)<br/>Traceback (most recent call last):<br/>  File "&lt;input&gt;", line 1, in &lt;module&gt;<br/>TypeError: add_numbers_better() takes 2 positional arguments but 3 were given<br/>&gt;&gt;&gt; add_numbers_better(5, 7, deduction=20)<br/>-8</span></pre><p id="d51a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，只有当我们将第三个参数设置为关键字参数，而不是位置参数时，才会调用该函数。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="18a8" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">3.装修工</h1><p id="3c71" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">有时，我们希望我们的函数具有额外的调试或性能优化特性。例如，我们想知道我们的函数何时被调用，或者用特定的参数运行一个函数需要多长时间。</p><p id="2dbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这些情况下，我们可以考虑在编写函数时使用decorators。一般来说，decorator是高阶函数(从技术上讲，decorator也可以实现为类)，它改变其他函数的行为，而不影响这些被修饰函数的原始操作。</p><p id="42db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看下面的玩具例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">函数中的装饰者</p></figure><ul class=""><li id="73ce" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">我们创建一个<code class="fe nd ne nf ng b">logging_time</code>函数来记录其他函数的执行时间。注意，这个函数返回一个本质上是修饰函数的函数。</li><li id="5f71" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">除了自定义装饰器函数，我们还可以使用内置装饰器，比如<code class="fe nd ne nf ng b">wraps</code>和<code class="fe nd ne nf ng b">lru_cache</code>。</li><li id="ef1a" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><code class="fe nd ne nf ng b">wraps</code>装饰器有助于保存函数的元数据(例如注释、文档字符串)，而<code class="fe nd ne nf ng b">lru_cache</code>允许缓存计算后的函数输出。因此，如果有对相同输入和输出的重复访问，比如使用递归函数，这是很有用的。</li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="aeec" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">4.使用下划线进行访问控制</h1><p id="8a63" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">与许多其他面向对象的编程语言不同，Python没有访问控制。严格来说，Python中的一切都是公开的。然而，通过使用下划线，我们可以使我们的函数模仿一些访问控制特性，将public变为protected或private。</p><p id="d610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你想表达这些函数不打算公开使用的意图时，这是一个有用的特性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="na nb l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Python自定义类</p></figure><p id="fb41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们在一个类中创建了一些函数，如上面的代码片段所示。通常，这些函数(或者更具体地说，实例方法)都是公共的。典型Python IDE中的自动完成建议清楚地揭示了这一事实。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/2499c890e3bc2e55f400657f8f843c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bvlfo6S0o1FZV4ORRCQLJA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">公共职能</p></figure><p id="e5e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们更改这些方法的定义来更新它们的访问级别。现代Python IDEs足够聪明，可以知道这些函数的更新访问级别，如下面的自动完成建议所示。仅提示<code class="fe nd ne nf ng b">speak</code>方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/98498cac584db6515bfb1845c40c9b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s0NTlCzfl8Xd49df2-XAiA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更新访问</p></figure><p id="d89b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">顺便提一下，如果您想调用这些非公共方法，Python中仍然允许您这样做。它涉及到对类名的篡改，如下所示:</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="0d66" class="nl me it ng b gy nm nn l no np">&gt;&gt;&gt; person = Person()<br/>&gt;&gt;&gt; person.speak()<br/>&gt;&gt;&gt; person._walk()<br/>&gt;&gt;&gt; # the private method with double underscore prefix triggers mangling in the format of _Class__method()<br/>&gt;&gt;&gt; person._Person__sleep()</span></pre><p id="2254" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，为了通过限制非公共函数来利用自动完成特性，您应该考虑在函数前面加上一两个下划线，使函数成为受保护的或私有的。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="9752" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="32c7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在本文中，我们讨论了在创建Python函数时可以考虑使用的四个可选特性。尽管它们不是Python函数声明所必需的，但它们可以使您的函数更加用户友好。这里有一个快速回顾:</p><ul class=""><li id="a325" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">类型提示有助于指示函数接受什么输入以及函数产生什么输出。它们允许ide执行类型检查。</li><li id="2af5" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">只有关键字的参数使得函数调用更加明确。</li><li id="2e4f" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">装饰者向函数添加额外的行为，并删除一些样板文件(例如日志)。</li><li id="3a80" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">使用下划线可以使函数成为非公共的，从自动完成建议中删除它们。此外，你要清楚地表明，在大多数用例中，这些功能不是面向最终用户的。</li></ul></div></div>    
</body>
</html>