<html>
<head>
<title>Create a Countdown With Observables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个可观察的倒计时</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-countdown-with-observables-ded4139fac1f?source=collection_archive---------8-----------------------#2020-01-20">https://betterprogramming.pub/create-a-countdown-with-observables-ded4139fac1f?source=collection_archive---------8-----------------------#2020-01-20</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ddb0" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">并了解RxJS的基础知识</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/864e9d05f09d3d1a8cb8e20f5ea51fe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTYbrCtmN0HtKxzBgGxszg.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自<a class="ae kz" href="https://www.pexels.com/photo/brown-hourglass-on-brown-wooden-table-1178684/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a>的<a class="ae kz" href="https://www.pexels.com/@mike-468229?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">迈克</a>的照片</p></figure><p id="eb07" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于许多初级或中级前端开发人员来说，处理可观测量和订阅仍然是一场噩梦。我也必须承认，我很难理解反应式开发的原则。</p><p id="63da" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，当我不得不编码倒计时时，一切对我来说都变得更加清晰，我决定在<a class="ae kz" href="https://rxjs-dev.firebaseapp.com/" rel="noopener ugc nofollow" target="_blank"> RxJS </a> Observables的帮助下做这件事！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="1074" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">每个问题都有它的操作者</h1><p id="8c20" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">我们希望显示一个持续30秒的倒计时，并在完成时通知用户。为了做到这一点，我们需要以设定的间隔发出一串数值，这个间隔将是1s。</p><p id="7bbd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">RxJS提供了广泛的运算符来帮助我们处理数据流。在这些之间，还有<code class="fe na nb nc nd b">interval</code> <em class="ne"> </em>和<code class="fe na nb nc nd b">timer</code>运算符。</p><p id="552d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe na nb nc nd b"><a class="ae kz" href="https://www.learnrxjs.io/operators/creation/interval.html" rel="noopener ugc nofollow" target="_blank">interval</a></code> <em class="ne"> </em>运算符返回每隔<em class="ne"> n </em>秒发出一个值的可观察值。但是什么是可观察的呢？</p><p id="9daa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">可观察值是不断更新的数据流。</p><p id="26f9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">打个比喻，这就像在一个特定的频道上有一台收音机。如果我们订阅了《可观察》，也就是说，如果我们打开收音机，我们就可以随心所欲地实时收听直播。</p><p id="9e3c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在<code class="fe na nb nc nd b">interval</code> <em class="ne"> </em>操作者<em class="ne">、</em>的情况下，收音机被调到一个定期发出声音的频道。输出如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="9bb2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个<code class="fe na nb nc nd b"><a class="ae kz" href="https://www.learnrxjs.io/operators/creation/timer.html" rel="noopener ugc nofollow" target="_blank">timer</a></code>操作者是不同的。它返回一个可观测值，在我们作为参数输入的时间帧结束时，它将只发射一次。</p><p id="0752" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">基本上，广播会一直沉默，直到节目结束时，扬声器说:“结束”。像这样:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="c4ce" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以使用这两个操作符的组合能力来实现我们的目标并显示倒计时。</p><p id="b0d5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是仍然缺少一些东西。其实只要我们订阅了<code class="fe na nb nc nd b">interval$</code>，<code class="fe na nb nc nd b">interval</code>，<em class="ne">，</em>运营商就会一直为我们“数数”。我们只需要记录相当于30秒的前30个值。</p><p id="8d4a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这就是<code class="fe na nb nc nd b"><a class="ae kz" href="https://www.learnrxjs.io/operators/filtering/take.html" rel="noopener ugc nofollow" target="_blank">take</a></code>操作符的用武之地！它将允许我们陈述我们想听的发射次数，有点像记录我们喜爱的节目一定时间的设备。例如:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="5194" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们有了所有的工具，我们可以开始创建我们的倒计时了！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="dc49" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">解决方案</h1><p id="e902" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">因此，为了创建一个30秒的倒计时，我们将创建一个可观察对象，它将以1秒的间隔发送30次值，并在30秒后发送一个可观察对象，以通知时间到了。</p><pre class="kk kl km kn gu nh nd ni nj aw nk bi"><span id="14e5" class="nl me iu nd b gz nm nn l no np">const timerInterval$ = interval(1000); //1s</span><span id="bcfa" class="nl me iu nd b gz nq nn l no np">const timer$ = timer(30000); //30s</span><span id="cca0" class="nl me iu nd b gz nq nn l no np">const times = 30;</span><span id="4c19" class="nl me iu nd b gz nq nn l no np">const countDown$ = timerInterval$.pipe(take(times));</span></pre><p id="9ca4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最后，我们将订阅这两个观察值来记录发出的值。</p><p id="ad12" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是由于<code class="fe na nb nc nd b">interval</code>可观测值将发出递增的值，而我们想要显示递减的值，我们将记录我们倒计时的总长度和发出的值之间的差异:</p><pre class="kk kl km kn gu nh nd ni nj aw nk bi"><span id="ee81" class="nl me iu nd b gz nm nn l no np">const sub = countDown$.subscribe(val =&gt;console.log(time - val));</span><span id="171f" class="nl me iu nd b gz nq nn l no np">const sub1 = timer$.subscribe(val =&gt; console.log('time is up!'));</span></pre><p id="ccca" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以尝试代码并在<a class="ae kz" href="https://stackblitz.com/edit/rxjs-timer-ts?file=index.ts" rel="noopener ugc nofollow" target="_blank"> StackBlitz </a>上查看输出！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><div class="kk kl km kn gu nr"><a href="https://medium.com/better-programming/how-to-create-a-simple-store-in-angular-577a8f21a3d6" rel="noopener follow" target="_blank"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">如何在Angular中创建一个简单的商店</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">用单一的事实来源增强你的应用</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">medium.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of kt nr"/></div></div></a></div><div class="og oh gq gs oi nr"><a href="https://medium.com/better-programming/how-i-got-rid-of-state-observables-in-angular-2c69cbbbbd0e" rel="noopener follow" target="_blank"><div class="ns ab fp"><div class="nt ab nu cl cj nv"><h2 class="bd iv gz z fq nw fs ft nx fv fx it bi translated">我是如何在Angular中消除状态可观测量的</h2><div class="ny l"><h3 class="bd b gz z fq nw fs ft nx fv fx dk translated">我不会回去的</h3></div><div class="nz l"><p class="bd b dl z fq nw fs ft nx fv fx dk translated">medium.com</p></div></div><div class="oa l"><div class="oj l oc od oe oa of kt nr"/></div></div></a></div></div></div>    
</body>
</html>