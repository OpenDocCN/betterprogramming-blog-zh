<html>
<head>
<title>5 MongoDB Security Tips to Help Keep the Cats Away</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5个MongoDB安全提示帮助远离猫咪</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-mongodb-security-tips-364a44f32977?source=collection_archive---------18-----------------------#2020-08-05">https://betterprogramming.pub/5-mongodb-security-tips-364a44f32977?source=collection_archive---------18-----------------------#2020-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6673" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">防止您的MongoDB(或MongoDB Atlas)实例被黑客攻击</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/03b72924f7d606bc025af9d35cda0f9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jlR7bf2xZIbcoqdC"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://studio3t.com/knowledge-base/articles/mongodb-security-best-practices/%22https://unsplash.com/images/animals/cat" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@artyana" rel="noopener ugc nofollow" target="_blank"> Tatyana Eremina </a>拍摄的照片。</p></figure><p id="0a64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近喵攻击不安全的<a class="ae ky" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>和Elasticsearch实例再次提醒我们需要妥善保护我们的数据库。</p><p id="a877" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不像以前MongoDB攻击中的那些人，喵黑客不会留下任何赎金要求或便条。他们的脚本简单地删除所有数据，首先删除所有的集合，然后用指示性的<code class="fe lv lw lx ly b">meow</code>字符串创建新的集合。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lz"><img src="../Images/126b1fe60844a533088ca03712974b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WzHiyMzHAMNSCXst"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://twitter.com/MayhemDayOne/status/1285303164116389890/photo/1" rel="noopener ugc nofollow" target="_blank"> @MayhemDayOne </a></p></figure><p id="d4f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">据鲍勃·迪亚琴科称，截至7月24日，已经有1779个Elasticsearch和701个MongoDB实例被喵了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="7ff6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到7月25日，这个数字已经上升到<a class="ae ky" href="https://www.bleepingcomputer.com/news/security/new-meow-attack-has-deleted-almost-4-000-unsecured-databases/" rel="noopener ugc nofollow" target="_blank">将近4，000个数据库</a>，其中还包括Redis、Cassandra、CouchDB、Redis、Hadoop、Jenkins和开放文件系统实例。</p><p id="acd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">黑客攻击声称津巴布韦领先的在线支付平台和一个著名的开源VPN是受害者，并且<a class="ae ky" href="https://www.bleepingcomputer.com/news/security/new-meow-attack-has-deleted-almost-4-000-unsecured-databases/" rel="noopener ugc nofollow" target="_blank">似乎有可能继续</a>。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="c7ce" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">MongoDB安全性必须是主动的，而不是被动的</h1><p id="7113" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在Studio 3T，我们偶尔会收到数据库遭到黑客攻击的客户的支持票，询问我们是否存储了他们数据的备份(我们从来没有这样做过——<a class="ae ky" href="https://studio3t.com/" rel="noopener ugc nofollow" target="_blank">我们是MongoDB GUI </a>)。</p><p id="6b8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MongoDB安全性有两个级别:</p><ol class=""><li id="965c" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">有一个数据库，您可以通过实施用户和角色访问控制、使用正确的身份验证、限制网络暴露来保护它，这些都是常见的疑点。</li><li id="37f6" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">还有客户端，对实际数据的处理，您可以通过在连接或集合级别启用只读模式、使用您自己的加密密钥存储来加密密码等等来保护这些数据。</li></ol><p id="bd95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有人希望被黑，但预防需要行动。现在，通过在数据库和客户端采取这五个简单的步骤来证明您的MongoDB(或MongoDB Atlas)实例。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="93cc" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">1.停止将0.0.0.0列入白名单，并限制受信任IP地址的网络暴露</h1><p id="3081" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这对于MongoDB Atlas集群来说尤其重要，它要求您在设置期间<a class="ae ky" href="https://studio3t.com/knowledge-base/articles/mongodb-atlas-tutorial/#set-up-a-mongodb-atlas-free-tier-cluster" rel="noopener ugc nofollow" target="_blank">将您的IP地址列入白名单。</a></p><p id="3dd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数用户可能首先将他们当前的IP地址列入白名单，但是IP地址通常会随着时间的推移而改变。在某些时候，您可能会遇到这样的错误:</p><pre class="kj kk kl km gt nu ly nv nw aw nx bi"><span id="c0fc" class="ny mk it ly b gy nz oa l ob oc">Could not connect to any servers in your MongoDB Atlas cluster. Make sure your current IP address is on your Atlas cluster's IP whitelist.</span></pre><p id="abea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MongoDB Atlas有一个默认的“允许从任何地方访问”选项，将所有IP地址列入白名单(0.0.0.0)。这是一个不安全的选项，它向网络上的每个人授予访问权限。<em class="od">不要</em>用这个。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/00ae7ce1b7e1759f62cb76bd8ccb3aab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kq9GLGvQmARRKlJo"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">MongoDB图集截图</p></figure><p id="68d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更安全的选择是<a class="ae ky" href="https://studio3t.com/knowledge-base/articles/mongodb-atlas-login-ip-whitelisting/#whitelist-a-range-of-ip-addresses" rel="noopener ugc nofollow" target="_blank">将一系列IP地址</a>、<a class="ae ky" href="https://studio3t.com/knowledge-base/articles/mongodb-atlas-login-ip-whitelisting/#whitelist-multiple-or-additional-ip-addresses" rel="noopener ugc nofollow" target="_blank">列入多个IP地址</a>(比如你的工作和家庭IP地址)，或者<a class="ae ky" href="https://studio3t.com/knowledge-base/articles/mongodb-atlas-login-ip-whitelisting/#whitelist-your-current-ip-address" rel="noopener ugc nofollow" target="_blank">定期将你当前的IP地址列入白名单</a>。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="51ee" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">2.启用访问控制，仅授予用户他们需要的角色</h1><p id="3190" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果您没有自托管MongoDB服务器，那么您的MongoDB实例已经使用SCRAM作为默认的身份验证机制。</p><p id="12cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了它，用户需要首先提供登录名和密码来读取或修改数据。但是一个没有人来验证的机制有什么用呢？</p><p id="3fd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您是用户管理员，那么通过<a class="ae ky" href="https://studio3t.com/knowledge-base/articles/user-manager/#create-mongodb-user" rel="noopener ugc nofollow" target="_blank">在您的数据库</a>中创建额外的用户，并且仅<a class="ae ky" href="https://studio3t.com/knowledge-base/articles/user-manager/#grant-mongodb-roles-to-a-user" rel="noopener ugc nofollow" target="_blank">授予他们需要的角色</a>，来使用这种先发制人的安全措施。这是传递连接字符串的更安全的替代方法。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="8979" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">3.强制进行身份验证—请记住您有多种选择</h1><p id="2848" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">如果您自托管您的MongoDB服务器，那么<a class="ae ky" href="https://docs.mongodb.com/manual/tutorial/enable-authentication/" rel="noopener ugc nofollow" target="_blank">您必须首先启用认证</a>。</p><p id="d21e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">否则，MongoDB会默认将<code class="fe lv lw lx ly b">bindIp</code>设置为localhost这是MongoDB 3.6中引入的一个增强安全性的特性——这意味着只有您可以访问您的数据。</p><p id="ff44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在第一篇技巧文章中了解到的，不要轻信将<code class="fe lv lw lx ly b">bindIp</code>设置为0.0.0.0的简单变通方法。</p><p id="6876" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于需要比SCRAM更健壮的认证机制的用户，MongoDB还支持<a class="ae ky" href="https://docs.mongodb.com/manual/core/authentication/" rel="noopener ugc nofollow" target="_blank"> x.509、LDAP和Kerberos </a>。</p><p id="7b63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前三点应该已经足够防喵了，但是这里有两个额外的安全措施你也可以在客户端采取。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="2b73" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">4.在连接或集合级别启用只读模式</h1><p id="0b4a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">GUI或客户端中的只读模式不能取代正确实现的访问控制。</p><p id="fb09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您不想搞砸任何事情(例如，您被合法授权访问的生产数据)，启用它仍然是一个方便的选项。</p><p id="2517" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Studio 3T允许您<a class="ae ky" href="https://studio3t.com/knowledge-base/articles/mongodb-read-only-mode/" rel="noopener ugc nofollow" target="_blank">在MongoDB集合和连接</a>上启用只读模式，因此您可以安心地查询集合和探索结果，不会有任何错误编辑。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="a972" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">5.使用您自己的加密密钥库加密MongoDB密码</h1><p id="2cd0" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">MongoDB提供了<a class="ae ky" href="https://docs.mongodb.com/manual/core/security-encryption-at-rest/" rel="noopener ugc nofollow" target="_blank">静态加密</a>，它允许数据库对数据文件进行加密，只有使用正确的解密密钥的用户才能对这些文件进行解码和访问。但只有MongoDB Enterprise才有。</p><p id="962b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种方法是使用第三方GUI，该GUI支持使用您自己的密钥库进行密码加密<a class="ae ky" href="https://studio3t.com/knowledge-base/articles/mongodb-password-encryption/" rel="noopener ugc nofollow" target="_blank">。与现有的默认机制相比，这是一种更安全的密码处理方式。</a></p></div></div>    
</body>
</html>