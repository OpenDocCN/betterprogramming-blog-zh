<html>
<head>
<title>Implement a Feature Flag in Four Steps Using LaunchDarkly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用LaunchDarkly分四步实现功能标志</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implement-a-feature-flag-in-4-steps-using-launchdarkly-4136ba66036d?source=collection_archive---------5-----------------------#2019-09-03">https://betterprogramming.pub/implement-a-feature-flag-in-4-steps-using-launchdarkly-4136ba66036d?source=collection_archive---------5-----------------------#2019-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="648f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过实现功能标志的魔力，节省金钱、时间和精力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/aeb40d9d6c2c950cf7949c0eaae9814f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Tj5Ed72ZuLnIBXk7oTscQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">约翰·施诺布里奇在Unsplash<a class="ae kv" href="https://unsplash.com/search/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">上的照片</a></p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="51c5" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">隐藏和显示新功能</h1><p id="e7e4" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">实现特征标志有<a class="ae kv" href="https://launchdarkly.com/use-cases/" rel="noopener ugc nofollow" target="_blank">多种原因；A/B测试、产品和营销驱动的发布、基础设施迁移等等。</a></p><p id="17a4" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">然而对我来说，特征标志消除了对失败的恐惧。这是一种担心，有人可能不喜欢我所做的，或者当它在生产中投入使用时，一些东西可能会在代码中爆炸。</p><p id="a13c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">通过在特性标志中实现代码更改，我可以在任何时候通过翻转仪表板上的标志来轻松地显示或隐藏新特性。</p><p id="98f5" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">例如，当我最终选择向全世界(或者至少是几个亲密的朋友)展示新特性时，我可以放心，如果代码在生产中爆炸或者生产中的变化不像我开发时那样引人注目，我可以迅速恢复变化。</p><p id="1433" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">旁注:功能标志通常也被称为功能切换或开关，我甚至看到它们被称为功能翻板。</p><p id="e790" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在四个步骤中，让我们看一看为一个小型个人应用程序实现一个LaunchDarkly特性标志是什么样子的。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="e894" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">1.快速入门(免费试用)</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/fe0c574a0824a91777e94a2594371877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GTPtnndk1cGEBWvxXoTfMA.gif"/></div></div></figure><p id="a1c0" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">实现功能标志魔术的第一步是注册免费试用。</p><p id="6b46" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我只需要一个电子邮件地址和想出一个好密码的能力。我确信，如果我遇到了问题，LaunchDarkly的支持会帮助我。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="b9c8" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">2.识别语言和功能</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/3fbe9640f475d2409ae7ec9d20d3a26b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QEp0GCg3yHkYkb9w4fFQoA.gif"/></div></div></figure><p id="2c56" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">第二步是确定项目的编程语言以及我想要更新的特性。</p><p id="de9f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我有一个React项目，为我的朋友Bradlie制作灵感卡片。我想把横幅改得更符合卡片的风格。我知道横幅的代码目前位于我的应用程序的顶层，<code class="fe my mz na nb b">App.js</code>。</p><p id="a16e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">现在我知道我需要什么，我的应用程序是用哪种语言编写的(React)，代码在哪里。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/9e874f2f63649e743572e820e07af5af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3KZC3frZceCyB_eq"/></div></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="1bd7" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">3.快速入门</h1><p id="4c78" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">第三步，如果你和我一样，使用Quickstart快速地在代码中加入一个特性标志。这不正是快速入门的目的吗？</p><p id="73aa" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">快速启动类似于一个演示。我从来没有设置过功能标志，所以对我来说，看到功能标志在如此小的代码实现后工作是非常令人满意的。在我开始这个项目之前，我认为这是一个很棒的小介绍。</p><p id="02cb" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">然而，现在我已经确定了我自己的要添加特性标志的项目，我只需要使用快速入门的一部分。</p><p id="39f9" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">快速入门要求我命名功能标志并选择语言和环境。首先，我只有一个生产和测试环境，但是我可以在以后添加更多的环境。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/82716296defb30fd0f04697e3894fd56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7Tp8Qt4TAlXOHYRB"/></div></div></figure><p id="b4cb" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">旁注:我想把这个特性命名为<code class="fe my mz na nb b">awesome-new-header</code>，但是已经同意了<code class="fe my mz na nb b">new-header</code>，所以我们在这里。</p><p id="6c9e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">一旦选择了我的标志名、SDK语言和环境，我就跳过了创建hello-react应用程序的步骤，直接使用我的终端安装launch crystally SDK:</p><pre class="kg kh ki kj gt ne nb nf ng aw nh bi"><span id="ef16" class="ni le iq nb b gy nj nk l nl nm">npm install --save launchdarkly-react-client-sdk@2.13.0</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/2c19b96e4ae0657e87644155fe70ca62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TtMQ0xe2YAFhfy5Qsri41w.jpeg"/></div></div></figure><p id="5f3c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">接下来是添加代码的时候了！正如快速入门所建议的，我从<code class="fe my mz na nb b">App.js</code>开始，然后粘贴<code class="fe my mz na nb b">import</code>和<code class="fe my mz na nb b">export default...</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/8afd9a8e80ac85ef9cc0991dd4b53809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_QeA0PHqKvPW8EFU"/></div></div></figure><p id="7e23" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">就在截图之后，我在第11行的<code class="fe my mz na nb b">"email"</code>和<code class="fe my mz na nb b">"User@email.com"</code>之间添加了一个冒号。(希望在您阅读本文时，这个问题已经在示例代码中解决了。我确实让launch crystally support知道了，他们很有帮助，也乐于接受反馈。)</p><pre class="kg kh ki kj gt ne nb nf ng aw nh bi"><span id="a2c3" class="ni le iq nb b gy nj nk l nl nm">"email": "User@email"</span></pre><p id="ea6e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">正如你在上面看到的，我的头代码在<code class="fe my mz na nb b">App.js</code>中。在我看来，更有意义的做法是将标题转换成一个组件，使应用程序更整洁、更有条理。幸运的是，如果header是一个组件，那么使用Quickstart也更容易。</p><p id="7a27" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我还把<code class="fe my mz na nb b">export default...</code>移到了<code class="fe my mz na nb b">App.js</code>文件的底部。看看App.js漂亮的最终代码！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/a2c947e0218a59296fb16d009844d6e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qZIN3I4mr5xC9Pe4"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">App.js文件的最终代码</p></figure><p id="f0f2" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在将标题代码移动到它自己的组件中之后，是时候向新的标题组件添加特性标志了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/fd28d9bb9797d309c017cc7de9a77705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xbybMJycEBBpxSdZpivDgQ.jpeg"/></div></div></figure><p id="90ad" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我首先将相关代码复制并粘贴到我的代码库中。(导入launch darky<code class="fe my mz na nb b">withLDConsumer</code>和标志本身，以及<code class="fe my mz na nb b">export default...</code>)</p><p id="e984" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">然后，我用<code class="fe my mz na nb b">if</code>块中的原始代码和<code class="fe my mz na nb b">else</code>块中的新代码创建了一个<code class="fe my mz na nb b">if statement</code>。最后，我有了一个非常可爱的带有特征标志的组件。</p><p id="1e9a" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">请注意，我在示例代码中发现的另一件事是，包装器返回的标志是<em class="nr">而不是</em> <code class="fe my mz na nb b">new-header</code>，实际上是<code class="fe my mz na nb b">camelCase</code> <code class="fe my mz na nb b">newHeader</code>。</p><p id="d9c2" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">再一次，我让LaunchDarkly support知道了，他们很有帮助，也乐于接受反馈。支持工程师Matt甚至说有一种方法可以禁用camel套管。<a class="ae kv" href="https://docs.launchdarkly.com/docs/react-sdk-reference#section-camel-casing" rel="noopener ugc nofollow" target="_blank">你可以在文档中找到这些信息。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/f5816d532afedb5e14ca0e469bf447bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QMfxxCuUQIPHuqVD"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">新标题组件的最终代码</p></figure><p id="11e1" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在我进行开发工作时，我目前通过将它设置为<code class="fe my mz na nb b">true</code>(第12行)来手动控制该标志，在将代码部署到生产环境之前，我需要删除该行。</p><p id="3810" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">将来，为了确保我不会引入没有删除该行的可能的人为错误，来自launch crystally support的Bonnie建议为应用程序中的项目创建一个新的开发人员<a class="ae kv" href="https://docs.launchdarkly.com/docs/environments" rel="noopener ugc nofollow" target="_blank">环境</a>。</p><p id="f42d" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这个新环境将可以访问相同的标志(因为标志在所有环境中是共享的)，但是标志的目标/默认规则是特定于环境的——因此您可以设置标志，以便每次为新环境返回<code class="fe my mz na nb b">true</code>。</p><p id="caaa" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">然后，您可以使用环境变量来确定使用哪个环境密钥(参见<em class="nr">帐户设置</em>选项卡中的密钥),这取决于您的应用是在生产环境还是开发环境中运行。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="c895" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">4.扳动开关</h1><p id="820a" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">最后一步是使用LaunchDarkly仪表板控制标志。</p><p id="a79b" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">正如你从下面精彩的截图中看到的，当<em class="nr">新标题标志</em>关闭时，原来的标题被显示出来。为了打开这个开关，我写了一条关于这个变化的消息，并且必须输入环境的名称。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/bfe3b08250d80c245bc13ee1de2c55e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EXp1bzUIwVVrSfM2gYTkFA.jpeg"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/7c8926214380ed7b8ae0cd858a5f07b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*72TfARgCKtCywOWT10GD6w.gif"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/efce9632c48af8b8b15e5dd5a65fe63b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kImAnRg1ufa9gReOPACjLA.jpeg"/></div></div></figure><p id="0db4" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">Tada！现在，我可以向我的朋友展示新的页眉，如果他们不喜欢，我可以通过翻转旗帜将其切换回来，而不必担心花费数天时间来尝试将其恢复到以前的状态。我的朋友不得不看他们不喜欢的标题的日子！</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="b507" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">结论</h1><p id="03ca" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">这个特性标志的介绍是为一个很小的应用程序编写的，这个应用程序可能永远不会被部署到更大的用户群中。</p><p id="a21b" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">然而，为拥有大量用户的更广泛的应用程序实现功能标志可以节省公司的时间、金钱和精力，以回滚在生产中不按预期方式运行的功能。</p><p id="50a9" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">例如，当我刚开始为一家小公司编写产品代码时，对于一个新功能，有一个非常漫长的批准过程，并且在发布之前对一个功能进行了大量的测试。</p><p id="f24c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">为什么？因为如果在代码部署后的任何时候，发现有bug，或者审批链中有人不喜欢它，就必须在生产中“热修复”它，有时甚至回滚。</p><p id="988f" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">回滚一个功能需要花费大量的时间和精力，在生产中进行“热修复”可能会有风险。</p><p id="1324" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">我相信，如果该公司实现了功能标志的魔力，他们本可以节省金钱、时间和精力。</p></div></div>    
</body>
</html>