# 为什么应该使用 PUT 请求而不是 POST 请求

> 原文：<https://betterprogramming.pub/why-you-should-use-a-put-request-instead-of-a-post-request-13b593b6e67c>

以及如何在 FastAPI 中轻松创建一个

![](img/3c1ea2a6d1b99030b4e088670d289e11.png)

照片由[乔纳森派](https://unsplash.com/@r3dmax?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

这个问题我已经收到十几次了:为什么用 PUT 请求而不是 POST 请求？

看完这篇文章，你就明白为什么了。您将使用 FastAPI 在 Python 中实现它，还将学习如何正确地测试它，以便在实践中能够自如地使用它。

# PUT 和 POST 请求之间的区别

让我们从解释 PUT 请求的关键特征开始:**幂等**。

如果您多次调用 put 请求，将会导致相同的结果。所以，想象你创造了一种资源:一本书。如果您调用该方法两次，结果是相同的。更准确地说，数据库中有一本书。不是多个，是一个。

POST 请求则完全不同。如果您创建了一本书，然后又创建了同一本书，那么您将拥有多本书。换句话说，第二次，你会得到不同的结果。

这两种方法各有优点。PUT 请求便于防止副作用。

但是，为了让你更好地理解，让我来解释一个场景:Juliette 点击一个按钮来购买一个三明治。因为网店有点慢，她又按了一次同一个按钮。同一请求到达服务器两次。因为您已经用 put 请求实现了该方法，所以它在第二次到达服务器时没有任何效果。你让朱丽叶不用吃双份餐，还帮她省钱。很棒，不是吗？

在许多用例中，PUT 请求对于防止不必要的更新非常重要。

**注**:小心，即使使用 PUT 方法，仍然可能违反幂等性。如果您以与 POST 请求相同的方式实现 PUT 请求，那将是相同的，违反了 PUT 原则。作为 API 开发人员，您有责任创建一个有效的 PUT 请求。

# 如何创建卖出请求

首先，设置您的 Python 环境。为此，您需要一些库:FastAPI、uvicorn、pydantic 和 requests。请随意用你选择的工具安装它们——我个人最喜欢的是虚拟环境。

在本文中，您将从头开始构建 PUT 请求。我们从一个空的图书收藏开始，您将创建一本新书。我们在本教程中使用的数据类型非常简单:

```
class Book:
  **isbn**: int
  **title**: str
```

此时最好不要使用数据库，因为我们试图让事情变得简单。对于这样的更新，一个很好的数据结构是字典，我们将使用它。

您的 PUT 请求将创建一本新书。如果这本书不存在，它将为字典创建一个新的。如果这本书存在，它将取代整本书。PUT 请求允许我们一次更新整个 book 对象。

在 FastAPI 中，可能是这样的(取决于您的底层数据结构):

现在，让我们回顾一下这里发生了什么。如果书已经存在，你替换它。如果书不存在，在执行这个方法后它将存在。最后，该方法返回我们添加到字典中的对象。

很棒吧？

POST 方法的主要区别在于如何处理类似资源的更新。如果您用 post 方法进行同样的更新，并且惟一键已经存在于我的字典中，那么您最好抛出一个异常。

如果您的数据结构允许重复，您就不会在 POST 方法中抛出异常。每次调用 POST 方法时，您都会创建一本新书。这在某些情况下也是有意义的，例如，在卖书的时候。在这种情况下，您将允许多本书存在。

# 测试您的卖出请求

你正在阅读有关 FastAPI 的资料。FastAPI 允许您编写简单的单元和集成测试。从测试开始总是很难，尤其是对于较新的框架。随着你对 FastAPI 越来越熟悉，你会发现你也可以做完全测试驱动的事情。

你应该写的第一个测试是最重要的。当你创作一本不存在的书时，你的收藏中会有一本新书。代码如下:

因为我们使用了字典，所以不允许相同的元素出现两次。这意味着为这个场景编写测试是没有用的。不过，还有一种情况需要考虑。如果您提供了对原书的更新，您应该会得到一本新书，如下所示:

最后，我们还可以编写一个集成测试。集成测试最重要的部分是看我们是否用正确的主体得到 200 OK 响应。这个测试与用 Postman 调用我们的 API 是一样的，但是额外的价值是您可以自动化这个检查。代码如下:

# 结论

阅读完本文后，您可以看到 PUT 方法创建了一个稳定的 API。现在您理解了幂等的含义，并且能够自己实现 PUT 方法了。

FastAPI 使我们创建 PUT 请求变得简单，这使得测试变得轻而易举。这个框架的简单性无人能敌。想继续学习 FastAPI 吗？我以前的关于[获取](https://medium.com/p/ecdc794b0cf)、[发布](https://medium.com/p/3dbd017dd998)和[删除](https://medium.com/p/b4577f9bcb77)方法的文章可能会有所帮助。也可以随意阅读这些文章。

感谢您阅读本文！