<html>
<head>
<title>Using Metal in Swift Playgrounds 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Swift Playgrounds 4中使用金属</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-metal-in-swift-playgrounds-4-e100122d276a?source=collection_archive---------16-----------------------#2022-04-19">https://betterprogramming.pub/using-metal-in-swift-playgrounds-4-e100122d276a?source=collection_archive---------16-----------------------#2022-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="010d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">让金属在雨燕游乐场像鸟儿一样歌唱的两种变通方法</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/1bdf131adf449f7b22867823970679fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*De_fO68Uz5mDKKRhiLYw-g.png"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">生病:苹果公司。</p></figure><p id="dcaf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Swift Playgrounds 4是一个巨大的更新，将SwiftUI中的完整应用程序开发带到了iPad上，并使应用程序更快、更好地使用。虽然Playgrounds很适合原型开发和移动工作，但它缺少一些高级开发功能，如Metal。</p><p id="ce77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文将展示在Swift Playgrounds 4中为应用程序项目和游戏场所制作Metal的两种方法。</p><h1 id="7d66" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在Xcode中编译金属库</h1><p id="706f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">一种选择是在Xcode中编译Metal源代码，并将编译后的库复制到Playgrounds。</p><p id="d984" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这在处理Metal源代码时保留了代码完成和语法突出显示，并且执行速度更快。然而，这种方法可能相当麻烦，并且只能在一个平台上工作(相同的编译库不能在iOS和macOS上工作)。</p><p id="d474" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该过程如下:</p><ol class=""><li id="c3f1" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">在Xcode中打开一个新的iOS项目</li><li id="21f9" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">创建一个新的<code class="fe nd ne nf ng b">.metal</code>文件并编写你的着色器</li><li id="8b77" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">为您的平台构建项目</li><li id="eb1f" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">按产品&gt;在Finder中显示构建文件夹，并导航至<code class="fe nd ne nf ng b">Products/Debug-[platform]</code>。例如，为Mac Catalyst生产路径<code class="fe nd ne nf ng b">Products/Debug-maccatalyst</code>。</li><li id="ebdc" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">右键点击你的应用并选择<code class="fe nd ne nf ng b">Show Package Contents</code>，然后复制文件<code class="fe nd ne nf ng b">default.metallib</code>(可能位于资源文件夹中)</li><li id="baf8" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">然后在雨燕游乐场。如果你有一个应用程序:将文件粘贴到应用程序的<em class="nh"> Resources </em>文件夹中(或者将文件拖到playgrounds-app中)。如果您有一个游戏场:将文件粘贴到游戏场的<code class="fe nd ne nf ng b">Edits/UserResources</code> <em class="nh"> </em>中(或选择带有文件文字的文件)</li><li id="c630" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">使用<code class="fe nd ne nf ng b">device.makeDefaultLibrary()!</code>编写代码来执行你的metal功能，就像在普通应用程序中一样</li></ol><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ca"><img src="../Images/8a9f92c1ada7e424210066758a387119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bT6gd1DMWwCRx8G8MlC0ew.gif"/></div></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">在Xcode中编译Metal-source并复制编译后的库。位于<build-folder>/产品/调试- <platform>。</platform></build-folder></p></figure><h2 id="c80e" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated"><strong class="ak">优势</strong></h2><ul class=""><li id="aaf4" class="mp mq iq ky b kz mk lc ml lf nu lj nv ln nw lr nx mv mw mx bi translated">保留代码完成和语法突出显示</li><li id="53a4" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nx mv mw mx bi translated">执行速度更快(如果您真的需要优化)</li></ul><h2 id="80c2" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated"><strong class="ak">限制</strong></h2><ul class=""><li id="b7b6" class="mp mq iq ky b kz mk lc ml lf nu lj nv ln nw lr nx mv mw mx bi translated">笨重的</li><li id="fb90" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nx mv mw mx bi translated">只能在编译平台上运行。</li></ul></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h1 id="12ed" class="ls lt iq bd lu lv of lx ly lz og mb mc jw oh jx me jz oi ka mg kc oj kd mi mj bi translated">将金属源作为资源储存</h1><p id="f5a4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">另一种方法是将Metal-source明文存储为资源，并在设备上编译。</p><p id="d7e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里的好处是，你可以在操场上编辑着色器，操场将跨平台工作。如果您在Xcode(或语言设置为c++的不同编辑器)中打开着色器，您将获得语法高亮显示。</p><p id="d73d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">方法是这样的:</p><ol class=""><li id="a28b" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">创建一个新的文本文件，并编写您的着色器。注意，你可以用<code class="fe nd ne nf ng b">.metal</code>结束文件，但是这在playgrounds应用程序中不起作用——应用程序将无法编译。</li><li id="f129" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">如果你有一个应用程序:将文件粘贴到应用程序的<code class="fe nd ne nf ng b">Resources</code>文件夹中(或者将文件拖到playgrounds-app中)。如果你有一个游戏场:将文件粘贴到你的游戏场的<code class="fe nd ne nf ng b">Edits/UserResources</code> <em class="nh"> </em>(或者选择一个带有文件文字的文件)</li><li id="cf84" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">使用<code class="fe nd ne nf ng b">try device.makeLibrary(source: String, options: MTLCompileOptions?)</code>编写代码来执行你的金属功能，就像在普通应用程序中一样</li></ol><pre class="kh ki kj kk gt ok ng ol bn om on bi"><span id="a68d" class="oo lt iq ng b be op oq l or os">let file = #fileLiteral(resourceName: "&lt;Name of your metal-source&gt;")<br/><br/>let libraryData = try! Data(contentsOf: file)<br/>let libraryStr = String(data: libraryData, encoding: .utf8)!<br/>let library = try device.makeLibrary(source: libraryStr, options: nil)</span></pre><h2 id="a8cd" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated"><strong class="ak">强项</strong></h2><ul class=""><li id="f2c0" class="mp mq iq ky b kz mk lc ml lf nu lj nv ln nw lr nx mv mw mx bi translated">源可以在Swift Playgrounds编辑</li><li id="1526" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nx mv mw mx bi translated">适用于任何平台</li></ul><h2 id="1039" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated"><strong class="ak">限制</strong></h2><ul class=""><li id="068c" class="mp mq iq ky b kz mk lc ml lf nu lj nv ln nw lr nx mv mw mx bi translated">没有语法突出显示，也没有代码完成</li><li id="8a80" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nx mv mw mx bi translated">执行速度稍慢</li></ul></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="caf4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用Xcode编译这个库会稍微加快执行速度。我做了一个测试来比较在Swift Playgrounds中使用上述两种方法加载一个金属库所需的时间。该测试是在M1 Mac电脑上的Swift Playgrounds 4.0中进行的，使用金属着色器计算11行代码。结果的数量级为微秒(即小于毫秒)，但表明在Xcode中编译会更快地加载库。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/f4e011f4dcfb8cecc3598722e003abb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*I8wH-mHbl0uPJSOyden6tA.png"/></div><p class="ks kt gj gh gi ku kv bd b be z dk translated">使用两种方法比较playground在M1 Mac上加载金属库的时间。</p></figure><p id="4e82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是在Swift游乐场制造金属制品的两种方法。如果已经有一个完成的Metal库，在Xcode中编译Metal-library可能是首选，而如果需要在操场上开发期间编辑源代码，则将Metal-source存储为资源是首选。</p></div></div>    
</body>
</html>