<html>
<head>
<title>Working With the flatMap Combine Operator in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS中使用平面图合并运算符</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/working-with-the-flatmap-combine-operator-in-ios-1267b6cf37ca?source=collection_archive---------9-----------------------#2021-02-08">https://betterprogramming.pub/working-with-the-flatmap-combine-operator-in-ios-1267b6cf37ca?source=collection_archive---------9-----------------------#2021-02-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c687" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">揭开这个狡猾的运营商构建反应式iOS应用的神秘面纱</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2463efe077d20622846ec4fe2cfc5674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PGYdDXB5rTVpLyTHNEo9LQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="e26c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你看了托尼·帕克的<a class="ae lu" href="https://developer.apple.com/videos/play/wwdc2019/722/" rel="noopener ugc nofollow" target="_blank">介绍联合收割机WWDC 2019演讲</a>，你可能会认为使用联合收割机是在公园散步。他将新的Combine框架定义为一个统一的、声明性的API，用于随时间处理值。这个框架只有三个主要部分:发布者、订阅者和运营商。听托尼说，这一切听起来很简单。而且平心而论苹果，大部分都是。</p><p id="7268" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是有一个操作符不是那么容易让人理解的:操作符<code class="fe lv lw lx ly b">flatMap</code>。</p><p id="05a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它与其他应用程序的不同之处在于，大多数应用程序(如果不是全部的话)从发布者那里接收数据，然后将数据传递出去。然而，<code class="fe lv lw lx ly b">flatMap</code>操作符从一个发布者接收数据，并将一个发布者传递出去。这是我们在苹果的朋友选择在联合收割机上的第二次<a class="ae lu" href="https://developer.apple.com/videos/play/wwdc2019/721/" rel="noopener ugc nofollow" target="_blank"> WWDC 2019演讲</a>中出现的运营商。我怀疑他们也认为这可能会令人困惑。</p><p id="a9ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">考虑到这一点，我想我应该在Combine中提供一些<code class="fe lv lw lx ly b">flatMap</code>的工作示例。先说超级简单的。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="5d9d" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">将字符数组转换为字符串</h1><p id="dc47" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">我有一个字母数组，我称之为<code class="fe lv lw lx ly b">foo</code>。我将通过我在SwiftUI演示应用程序中称为<code class="fe lv lw lx ly b">flatMapPublisher</code>的出版商发送它。工作代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="85e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当发布者通过<code class="fe lv lw lx ly b">flatMap</code>发送数据时，它获取集合中的每个字母并重新发布。在同一个管道中，<code class="fe lv lw lx ly b">sink</code>操作符收集数据，将其打印出来，并添加到<code class="fe lv lw lx ly b">mojo</code>文本标签中。最终结果如下——一个简单的字符串，包含了<code class="fe lv lw lx ly b">foo</code>数组中的字母:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/2453ec1fc24305d919b9a0c688790965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sLIIyVnhbtV6ltQlVPasEA.png"/></div></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="bcf8" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">展平数组的数组</h1><p id="1c01" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">在我的第二个例子中，我想进一步扩展这个想法。我定义了第二个发布者，它是一个或多个集合。然后，我将它发送给<code class="fe lv lw lx ly b">flatMap</code>，展平集合，并将其传递给我刚刚定义的第一个出版商。我再次包含了完整的代码，以便您可以看到完整的图片:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="29be" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">和第一个例子一样，<code class="fe lv lw lx ly b">flatMap</code>重新发布数组中的每个数组，打印出来，然后发送给我们的第一个发布者。当它处理完所有的值后，它将找到的值添加到<code class="fe lv lw lx ly b">mojo2</code>数组中，最终看起来像这样:<code class="fe lv lw lx ly b">[“A”, “1”, “B”, “A”, “C”, “C”, “D”]</code>。<strong class="la iu"> </strong>这个字符串也被传递给我们刚刚提到的更新<code class="fe lv lw lx ly b">mojo</code>文本标签的第一个发布者。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/1f325b6027a0c2dd089ada999e6f2909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*J_SOHdFPRiK0-iYFjUOyag.png"/></div></div></figure><p id="1421" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nh">注:它没有试图简化或改变数据。它只是在处理它的时候把它变平。</em></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d9ed" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">将字符串数组拆分成字符</h1><p id="75bf" class="pw-post-body-paragraph ky kz it la b lb my ju ld le mz jx lg lh na lj lk ll nb ln lo lp nc lr ls lt im bi translated">在我的第三个例子中，我走了另一条路，发送了一个单独的<code class="fe lv lw lx ly b">[character by character]</code>字符串。这次，<code class="fe lv lw lx ly b">flatMap</code>把它打散，然后重新组合。当然，你最终会得到几乎相同的结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="06e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nh">注意:在发送到</em> <code class="fe lv lw lx ly b"><em class="nh">flatMap</em></code> <em class="nh">之前，我需要做一个额外的转换。我需要这样做，因为没有</em> <code class="fe lv lw lx ly b"><em class="nh">Character</em></code> <em class="nh">类型的发布者。于是我用</em> <code class="fe lv lw lx ly b"><em class="nh">.map</em></code> <em class="nh">运算符把它投成了一个</em> <code class="fe lv lw lx ly b"><em class="nh">String</em></code> <em class="nh">。运行这个字符串，我得到一个由值组成的</em><code class="fe lv lw lx ly b"><em class="nh">mojo3</em></code><em class="nh">(</em><code class="fe lv lw lx ly b"><em class="nh">[“A”, “B”, “C”, “D”, “E”, “F”]</em></code><em class="nh">)</em><strong class="la iu"><em class="nh"/></strong><em class="nh">，当然，还有一个看起来相同的</em> <code class="fe lv lw lx ly b"><em class="nh">mojo</em></code> <em class="nh">字符串</em> <strong class="la iu"> <em class="nh"> </em> </strong> <em class="nh">作为我发送的字符串。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/546c77e73e72f6f159e12c2fcc99fcd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3sWRFxqtaBHaGd7p6RnYQ.png"/></div></div></figure><p id="f946" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望我成功地揭开了<code class="fe lv lw lx ly b">flatMap</code>的神秘面纱，足以让你能够开始创作自己的作品。感谢阅读。</p><p id="2c31" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">保持冷静，继续编码。</p></div></div>    
</body>
</html>