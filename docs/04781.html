<html>
<head>
<title>How to Implement Dark Mode With Backward Compatibility in iOS Swift App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在iOS Swift App中实现向后兼容的黑暗模式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-implement-dark-mode-with-backward-compatibility-in-ios-7566376e24fd?source=collection_archive---------4-----------------------#2020-05-08">https://betterprogramming.pub/how-to-implement-dark-mode-with-backward-compatibility-in-ios-7566376e24fd?source=collection_archive---------4-----------------------#2020-05-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f1cd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用propertyWrapper实现黑暗模式和多个主题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/53534141307bb1121e595598831782f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C-NWMqjzDA2O3GFo"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@vmxhu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Szabo Viktor </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="8790" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">黑暗模式和iOS</h1><p id="7622" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我们都知道黑暗模式很受用户欢迎。此外，我们不能忽视有机发光二极管显示器对设备电池和眼睛的好处。</p><p id="5ea9" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">iOS 13已经提供了系统颜色API，当我们将系统更改为黑暗模式时，它会自动更改视图颜色。但是在我的应用程序中实现它的时候，我有太多的疑问。</p><h2 id="dcf6" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">我们如何为暗模式和亮模式配置自定义颜色？</h2><p id="ec79" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我们有这方面的彩色资产目录。我们可以为明暗模式添加颜色。</p><h2 id="092c" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">如果我们想添加更多的主题呢？</h2><p id="b10b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">目前，颜色资源目录只能为深色和浅色模式添加有限的颜色。但是如果我们想增加更多的主题支持呢？想象一下，一个应用程序根据付费、免费等改变主题。</p><h2 id="3ab1" class="mz lh it bd li na nb dn lm nc nd dp lq mh ne nf ls ml ng nh lu mp ni nj lw nk bi translated">支持iOS 10版本的app呢？</h2><p id="69ea" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">嗯，iOS 10不支持颜色资产目录。只有从iOS 11开始才支持，所以我们必须放弃这个想法，转向编程方式。</p><p id="890b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们必须创建自己的自定义<code class="fe nl nm nn no b">UIColor</code>包装器，为不同的模式/主题提供颜色。在制作这些包装器时，我们必须确保语法与苹果的<code class="fe nl nm nn no b">UIColor</code>API的语法相同(例如调用<code class="fe nl nm nn no b">UIColor.red</code>)。</p><p id="2eeb" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们可以在<code class="fe nl nm nn no b">propertyWrapper</code>的帮助下实现这一目标。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="1a96" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak"> propertyWrapper来拯救</strong></h1><p id="fbd9" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">让我们用<code class="fe nl nm nn no b">propertyWrapper</code>创建一个<code class="fe nl nm nn no b">Theme</code>结构，它的变量数量等于主题支持的数量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="3ff4" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在让我们创建一些颜色。我们将创建一个<code class="fe nl nm nn no b">UIColor</code>的扩展，并在<code class="fe nl nm nn no b">Theme</code>的帮助下创建一个颜色对象。看看语法和对象创建。这有许多优点:</p><ul class=""><li id="08e7" class="nr ns it ma b mb mu me mv mh nt ml nu mp nv mt nw nx ny nz bi translated">语法简单</li><li id="a253" class="nr ns it ma b mb oa me ob mh oc ml od mp oe mt nw nx ny nz bi translated">添加或删除主题支持的灵活性</li><li id="715f" class="nr ns it ma b mb oa me ob mh oc ml od mp oe mt nw nx ny nz bi translated">类似苹果的API调用</li><li id="5a21" class="nr ns it ma b mb oa me ob mh oc ml od mp oe mt nw nx ny nz bi translated">易于维护和代码可读性</li><li id="0877" class="nr ns it ma b mb oa me ob mh oc ml od mp oe mt nw nx ny nz bi translated">根据您的功能对扩展进行分组</li><li id="2df5" class="nr ns it ma b mb oa me ob mh oc ml od mp oe mt nw nx ny nz bi translated">向后兼容性</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="78a3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">就是这样。现在，你可以使用与苹果相同的语法来设置UI组件的颜色(例如，为标签文本颜色设置颜色将是<code class="fe nl nm nn no b">UIColor.primaryText</code>)，完成后，你的应用程序将根据你设置的暗/亮模式改变其颜色。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3a03" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">iOS 13的最终结果</h1><p id="3f64" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">下面是我创建的示例应用程序的结果。查看GitHub 上的完整项目<a class="ae ky" href="https://github.com/mukyasa/DarkModeExample" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="kj kk kl km gt ab cb"><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/98f0bc12cc2fe62766d6b526ab7daef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*fA8zV1ZPr5m2AZOOq060QQ.png"/></div></figure><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/33b81082d12f920cba28992e3f886644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2o3swlhj-fK1bsSN0nrcpg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk ol di om on translated">在iOS 13 iPhone 11 pro中运行的示例应用程序的截图，左边是亮模式，右边是暗模式</p></figure></div></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d3e0" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">老版本呢？</strong></h1><p id="dd0f" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我们必须做一些额外的工作来为旧设备添加主题。我们的社区有许多解决方案，我只分享一个简单的。您可以根据您的项目需求拥有自己的实现。</p><p id="e4e3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">首先，我们将使用<code class="fe nl nm nn no b">addThemeChangeObserver</code>方法的默认实现创建一个<code class="fe nl nm nn no b">ThemeProtocol</code>，这样任何实现这个协议的对象只需调用这个方法。然后我们实现<code class="fe nl nm nn no b">ThemeProtocol</code>到<code class="fe nl nm nn no b">ViewController</code>，调用<code class="fe nl nm nn no b">viewDidLoad</code>中的<code class="fe nl nm nn no b">addThemeChangeObserver</code>，并实现<code class="fe nl nm nn no b">configureSubviewsColors</code>，在这里我们将配置所有的子视图颜色。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="0522" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">总结</strong></h1><p id="9802" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我添加了左<code class="fe nl nm nn no b">UIBarButton</code>来切换旧设备上的黑暗模式，并添加了目标<code class="fe nl nm nn no b">toogleDarkMode</code>来处理<code class="fe nl nm nn no b">ThemeManager</code>中的变化。就是这样。我们现在已经成功地为旧版本实现了它。</p><pre class="kj kk kl km gt oo no op oq aw or bi"><span id="3407" class="mz lh it no b gy os ot l ou ov">// Implement this method only for iOS version less than 13<br/> @objc func toogleDarkMode() {<br/> // Toggle Theme Logic<br/>  ThemeManager.isDarkModeEnabled = !ThemeManager.isDarkModeEnabled<br/>  NotificationCenter.default.post(name: NSNotification.Name(rawValue:  “themeChange”),<br/>                                 object: nil)<br/> }</span></pre><p id="b40a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">以下是旧设备的测试结果:</p><div class="kj kk kl km gt ab cb"><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/a30e556c6602ef939b68813c0edf79be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*VgL2eWFmc7zCId0ML7Vbww.png"/></div></figure><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/5b169bff64f39b85461944afe80e1d3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*HQM0T4eoGWmMZn2js5vLcQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk ol di om on translated">在iOS 11 iPhone 8中运行的示例应用的截图，左边是亮模式，右边是暗模式</p></figure></div><p id="e74b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><strong class="ma iu"> <em class="ow">注意</em> </strong> <em class="ow">:如果你不想为旧版本做这些额外的代码，你可以重置</em> <code class="fe nl nm nn no b">AppDelegate</code> <em class="ow"> </em> <code class="fe nl nm nn no b">window.rootViewController</code> <em class="ow">。它将根据您在本地为应用程序设置的内容配置一个新的主题(深色或浅色)。</em></p><h1 id="51d4" class="lg lh it bd li lj ox ll lm ln oy lp lq jz oz ka ls kc pa kd lu kf pb kg lw lx bi translated">感谢您的阅读。</h1><p id="308c" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">我希望这篇文章能帮助你在应用程序中实现黑暗模式。请分享您的宝贵反馈。</p></div></div>    
</body>
</html>