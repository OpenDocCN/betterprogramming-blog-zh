<html>
<head>
<title>Getting Ready for App Tracking Transparency in iOS 14.5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为iOS 14.5中的应用程序跟踪透明度做好准备</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-ready-for-app-tracking-transparency-d3b78d062114?source=collection_archive---------11-----------------------#2021-04-21">https://betterprogramming.pub/getting-ready-for-app-tracking-transparency-d3b78d062114?source=collection_archive---------11-----------------------#2021-04-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dd9c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">请求允许以正确的方式使用IDFA</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4d2b41244205d7ed515e37920cc63aeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DhVbxF4KK1CeQoQZ"/></div></div></figure><p id="cc21" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">回到2020年6月，在WWDC20期间，苹果宣布，从iOS 14开始，开发者在跟踪用户之前需要获得用户的许可。换句话说，除非获得授权，否则应用程序无法访问设备的IDFA(广告商的标识符)。</p><p id="2ce5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">2020年9月，<a class="ae lq" href="https://developer.apple.com/news/?id=hx9s63c5" rel="noopener ugc nofollow" target="_blank">苹果推迟了这一变化</a>，以便开发者和发行商有更多的时间来适应。</p><p id="1b04" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本月早些时候(2021年4月)，苹果发布公告，要求所有开发者<a class="ae lq" href="https://developer.apple.com/news/?id=8h0btjq7" rel="noopener ugc nofollow" target="_blank">为</a> <code class="fe lr ls lt lu b"><a class="ae lq" href="https://developer.apple.com/news/?id=8h0btjq7" rel="noopener ugc nofollow" target="_blank">AppTrackingTransparency</a></code>做好准备，表明苹果将在他们即将发布的iOS公开版(iOS 14.5)中全面执行追踪授权。</p><p id="139b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为一名开发人员，我们的工作是确保我们的应用程序在公开发布时能够顺利运行。如果你的应用程序正在使用IDFA，并且你想了解如何让你的应用程序符合<code class="fe lr ls lt lu b">AppTrackingTransparency</code>标准，请继续阅读。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1a49" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">了解IDFA</h1><p id="3d10" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">在深入研究代码之前，让我们快速地看一下IDFA是什么。</p><p id="2bbb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，确保你没有混淆IDFA和IDFV(供应商的标识符)，苹果只是在IDFA上执行授权。换句话说，如果您的应用程序只使用IDFV，则不需要进行任何更改。</p><p id="4033" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">IDFA是一个字母数字字符串，对于每个设备都是唯一的。它主要用于广告定位、频率上限、广告欺诈检测、活动测量等。以下是IDFA的一个例子:</p><pre class="kj kk kl km gt mz lu na nb aw nc bi"><span id="b836" class="nd md it lu b gy ne nf l ng nh">CE3BB49C-0F44-4DB9-9F6D-B2025A8A4FF7</span></pre><p id="1d49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">IDFA具有以下行为:</p><ul class=""><li id="9bed" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">每个设备都有自己独特的IDFA。</li><li id="5f88" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">它是一个设备级别的标识符，这意味着安装在同一设备上的不同供应商的应用程序将具有相同的IDFA。</li><li id="711a" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">删除应用程序<em class="nw">不会</em>重置/更改IDFA(因为它是设备级标识符)。</li><li id="ba36" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">禁用并重新启用设备的应用程序跟踪将重置其IDFA。</li></ul><blockquote class="nx ny nz"><p id="a098" class="ku kv nw kw b kx ky ju kz la lb jx lc oa le lf lg ob li lj lk oc lm ln lo lp im bi translated"><strong class="kw iu"> <em class="it">亲提示</em> </strong> <em class="it"> : </em></p><p id="8d54" class="ku kv nw kw b kx ky ju kz la lb jx lc oa le lf lg ob li lj lk oc lm ln lo lp im bi translated"><em class="it">在iOS 14中，你可以通过进入</em>设置<em class="it"> &gt; </em>隐私<em class="it"> &gt; </em>追踪<em class="it"> &gt;关闭</em>“允许应用请求追踪”<em class="it"> &gt; </em>要求应用停止追踪来禁用应用追踪。</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a4e7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">请求追踪许可</h1><p id="d2e0" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">在iOS 14.5之前，您可以使用以下代码不受限制地轻松获得IDFA:</p><pre class="kj kk kl km gt mz lu na nb aw nc bi"><span id="c3cb" class="nd md it lu b gy ne nf l ng nh">let idfa = ASIdentifierManager.shared().advertisingIdentifier</span></pre><p id="6827" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与此同时，在iOS 14.5中，如果你试图在未经用户许可的情况下访问IDFA，它将被清零。</p><pre class="kj kk kl km gt mz lu na nb aw nc bi"><span id="c7fc" class="nd md it lu b gy ne nf l ng nh">Zeroed out IDFA: <br/>00000000-0000-0000-0000-000000000000</span></pre><p id="782b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了获得用户权限，必须先将<code class="fe lr ls lt lu b">NSUserTrackingUsageDescription</code>键添加到<code class="fe lr ls lt lu b">info.plist</code>中。密钥的值是一个用法描述字符串，告诉用户为什么应用程序请求跟踪用户或设备的权限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/bdd584be3c62fcb42ce41c53da0148f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/0*Lg26ocMBKZqrrqRE"/></div><p class="oe of gj gh gi og oh bd b be z dk translated">将NSUserTrackingUsageDescription添加到info.plist</p></figure><p id="ea40" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">准备就绪后，您现在可以使用<code class="fe lr ls lt lu b">AppTrackingTransparency</code>框架来显示一个系统权限警告请求:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="2f60" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的代码中，您需要注意三件事:</p><ul class=""><li id="7398" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">只有当app的跟踪授权状态为<code class="fe lr ls lt lu b">.notDetermined</code>时，<code class="fe lr ls lt lu b">requestTrackingAuthorization(completionHandler:)</code>功能才会显示系统权限提示。一旦设置了授权状态，调用该函数只会触发完成处理程序，而不会显示警告。</li><li id="42ea" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">如果在系统隐私设置中关闭了<em class="nw">“允许应用程序请求跟踪”</em>，将不会显示系统权限提醒。</li><li id="8001" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">完成处理程序是<em class="nw">而不是</em>在主线程上被触发。因此，如果您在完成处理程序中更新UI，则需要分派到主线程。</li></ul><blockquote class="nx ny nz"><p id="67aa" class="ku kv nw kw b kx ky ju kz la lb jx lc oa le lf lg ob li lj lk oc lm ln lo lp im bi translated"><strong class="kw iu"> <em class="it">注:</em> </strong></p><p id="8fb5" class="ku kv nw kw b kx ky ju kz la lb jx lc oa le lf lg ob li lj lk oc lm ln lo lp im bi translated"><em class="it">在撰写本文时，iOS模拟器中有一个</em><a class="ae lq" href="https://developer.apple.com/forums/thread/124604" rel="noopener ugc nofollow" target="_blank"><em class="it">bug</em></a><em class="it">IDFA总是被清零。在真实设备上测试您的代码，以避免任何意外行为。</em></p></blockquote><p id="1a6d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，您还可以使用下面的代码来确定应用程序的当前跟踪授权状态:</p><pre class="kj kk kl km gt mz lu na nb aw nc bi"><span id="34db" class="nd md it lu b gy ne nf l ng nh">let status = ATTrackingManager.trackingAuthorizationStatus</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f48d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">拒绝处理访问</h1><p id="bbac" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">现在，您已经知道如何请求应用程序跟踪权限，如果用户拒绝您访问IDFA会怎样？</p><p id="8481" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">处理这种情况的一种方法是提供设置的快捷方式，以便用户可以轻松地更改跟踪权限。下面是如何做到这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="abb6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一种处理方式是根本不使用IDFA。但是，这种方法只适用于当你使用IDFA纯粹是为了运动测量。我这么说是什么意思？</p><p id="1f27" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">苹果有一个验证广告驱动的应用安装的类— <code class="fe lr ls lt lu b"><a class="ae lq" href="https://developer.apple.com/documentation/storekit/skadnetwork" rel="noopener ugc nofollow" target="_blank">SKAdNetwork</a></code>。它是一个广告网络API，帮助广告商衡量广告活动的成功，同时维护用户隐私。你可以在这篇<a class="ae lq" href="https://adtechexplained.com/skadnetwork-explained/" rel="noopener ugc nofollow" target="_blank">文章</a>中了解更多。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9041" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">包扎</h1><p id="da40" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">苹果再次加强了产品生态系统中的隐私控制。我真的很喜欢这个变化，这再次表明苹果真的很关心他们用户的隐私。</p><p id="5df5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为开发者，我们有责任确保我们的应用程序始终符合苹果隐私政策，以便我们的用户在使用我们的应用程序时感到安全和有保障。</p><p id="9dc0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你喜欢读这篇文章，请随意查看我的其他iOS开发文章<a class="ae lq" href="https://swiftsenpai.com/tag/ios/" rel="noopener ugc nofollow" target="_blank"/>。你也可以在<a class="ae lq" href="https://twitter.com/Lee_Kah_Seng" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我。</p><p id="ef93" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！</p></div></div>    
</body>
</html>