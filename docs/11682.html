<html>
<head>
<title>Securing Your GraphQL Endpoint With Dgraph and Auth0 — Setting Up Auth0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Dgraph和Auth0保护GraphQL端点—设置Auth0</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/securing-your-graphql-endpoint-with-dgraph-and-auth0-1bf9acedc0c8?source=collection_archive---------12-----------------------#2022-04-07">https://betterprogramming.pub/securing-your-graphql-endpoint-with-dgraph-and-auth0-1bf9acedc0c8?source=collection_archive---------12-----------------------#2022-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5ada" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第2/3部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f0d4d918a1d1ec351e264d5aded06f2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KuLaTEHCpgaUSoY-OJJTGg.jpeg"/></div></div></figure><blockquote class="kr ks kt"><p id="e1af" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="iq">这是一系列文章的第二部分，将解释如何为我们将使用Dgraph构建的示例报价应用程序设置Auth0。如果你是这方面的新手，你可能想要</em> <a class="ae lr" href="https://medium.com/@flo_80930/securing-your-graphql-endpoint-with-dgraph-and-auth0-eb94b935f795" rel="noopener"> <em class="iq">阅读第1部分</em> </a> <em class="iq">来了解什么是giong on。</em></p><p id="95eb" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="iq">最终目标是建立一个安全的GraphQL端点，您的前端应用程序和后端脚本可以通过JWT查询和修改数据。我们将通过一个简单应用程序的例子来完成设置Dgraph、Auth0和Dgraph with Auth0的所有必要步骤。如果您已经设置了Auth0并知道如何使用它，您可以安全地跳过这一部分。</em></p></blockquote><h1 id="b856" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">介绍</h1><p id="793b" class="pw-post-body-paragraph ku kv iq kx b ky mk jr la lb ml ju ld mm mn lg lh mo mp lk ll mq mr lo lp lq ij bi translated">如果您正在阅读本系列的第1部分，此时您的GraphQL端点(您的引用和作者)是不可公开查询的。由于您可能对构建一个应用程序感兴趣，该应用程序将允许您的用户从他们的浏览器中查询报价，我们将不得不改变这一点。不幸的是，如果您将<code class="fe ms mt mu mv b">Quote</code>和<code class="fe ms mt mu mv b">Author</code>设置为public，任何人都可以添加、更新、删除和查询您的节点！</p><p id="41de" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">你当然可以构建自己的认证服务器，但是如果已经有了像Auth0这样很棒的东西，而且在此之上，它还能与Dgraph完美地协同工作，为什么还要再次发明轮子呢？您不必处理证书和各种安全漏洞——auth 0会处理这些问题！用Auth0的话说</p><blockquote class="kr ks kt"><p id="3620" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Auth0是一个灵活的嵌入式解决方案，可为您的应用程序添加认证和授权服务。您的团队和组织可以避免构建自己的解决方案来验证和授权用户所带来的成本、时间和风险。</p></blockquote><p id="76a6" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">我想说的够多了，让我们建立一个账户吧——它是免费的！</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="303f" class="ls lt iq bd lu lv nd lx ly lz ne mb mc jw nf jx me jz ng ka mg kc nh kd mi mj bi translated">获取Auth0帐户</h1><p id="f174" class="pw-post-body-paragraph ku kv iq kx b ky mk jr la lb ml ju ld mm mn lg lh mo mp lk ll mq mr lo lp lq ij bi translated">前往<a class="ae lr" href="https://auth0.com" rel="noopener ugc nofollow" target="_blank">认证0 </a>并注册。选择私人选项，退出所有营销电子邮件。点击下一步，我们准备好了🚀—这有多容易？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/92cc5db93b5057b08575459ca78024d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_zonsIWjKhKNLNl8O9a7tA.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">注册您的电子邮件后，选择“个人”并退出营销邮件。</p></figure><p id="ba59" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">你将被重定向到你的仪表板，让你做各种事情。你还将获得22天的试用期，以尝试Auth0可以做的所有事情，然后才结束免费帐户。但是不要担心，Auth0提供了很多完全免费的功能，对于我们的小实验来说，这已经足够了。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="68dd" class="ls lt iq bd lu lv nd lx ly lz ne mb mc jw nf jx me jz ng ka mg kc nh kd mi mj bi translated">设置应用程序</h1><p id="a2b8" class="pw-post-body-paragraph ku kv iq kx b ky mk jr la lb ml ju ld mm mn lg lh mo mp lk ll mq mr lo lp lq ij bi translated">我们现在准备设置一个适合我们需要的应用程序。导航到<code class="fe ms mt mu mv b">Applications &gt; Applications</code>并点击已经存在的默认应用程序。这是一个通用的应用程序，这意味着它还没有为特定的用途而设置。因为我假设你有兴趣用现代框架创建一个web应用程序(比如React)，点击QuickStart并选择Single-Page App。</p><p id="43fd" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">在后续屏幕中，您可以在<a class="ae lr" href="https://angular.io" rel="noopener ugc nofollow" target="_blank"> Angular </a>、<a class="ae lr" href="https://developer.mozilla.org/de/docs/Web/JavaScript" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>、<a class="ae lr" href="https://reactjs.org" rel="noopener ugc nofollow" target="_blank"> React </a>和<a class="ae lr" href="https://vuejs.org" rel="noopener ugc nofollow" target="_blank"> Vue </a>之间进行选择——您在这里选择哪一个并不重要，但是如果您选择了稍后要使用的那个，那么您将获得如何将Auth0集成到您的应用程序中的模板和代码示例。您可以在以后更改它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/d2675f9685f9369338282e99eb9c510d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sqIi8AWdeLMs3AyZGO4edA.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">当点击Auth0为你生成的默认应用时，点击“快速启动”并选择“单页应用”。</p></figure><p id="32bd" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">完成后，让我们切换到设置，给我们的应用程序命名为报价应用程序。显然，这也可以是任何其他名称。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/2a8ee2a53916237bd22be022217f37a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4j-fczTK7CtvM7YG1nVH_w.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">给你的应用取个名字。</p></figure><p id="5064" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">接下来，向下滚动到应用程序属性，输入一个徽标的URL，然后从应用程序类型下拉列表中选择单页应用程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/2bbd997945fb50e6af447b43c09f9978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSzyCCgLi8TBKttLAa3oDA.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">在“应用程序属性”部分，从“应用程序类型”下拉列表中选择“单页应用程序”。</p></figure><p id="3725" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">现在，在应用程序URI的部分，将您的本地主机添加到允许的回调URL列表，允许的Web源和允许的源(CORS)。如果您希望您的应用程序也允许注销用户，那么您还需要将您的本地开发端点添加到允许的注销URL中。对于React应用程序，这通常是<code class="fe ms mt mu mv b"><a class="ae lr" href="http://localhost" rel="noopener ugc nofollow" target="_blank">http://localhost</a>:3000</code>。这是必要的，以便允许您在前端应用程序中使用<a class="ae lr" href="https://auth0.com/docs/quickstart/spa/react/01-login" rel="noopener ugc nofollow" target="_blank"> Auth0 SDK </a>，并允许您在开发的同时测试应用程序的登录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/30ca6d8ff44c1004ba84381f6024247e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*znKdMiI_7iKkly0yRayWog.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">将您的本地开发端点添加到允许的回调URIs。</p></figure><p id="486c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">最后，一直向下滚动(如果需要，您可以快速停止刷新令牌循环并打开循环，但这不是强制性的)，然后单击保存更改。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h1 id="d784" class="ls lt iq bd lu lv nd lx ly lz ne mb mc jw nf jx me jz ng ka mg kc nh kd mi mj bi translated">添加使用您的应用程序的用户</h1><p id="f88d" class="pw-post-body-paragraph ku kv iq kx b ky mk jr la lb ml ju ld mm mn lg lh mo mp lk ll mq mr lo lp lq ij bi translated">如果我们没有至少一个用户被允许登录我们的应用程序，我们的整个项目将毫无意义。让我们从我们的控制面板这里设置一个。转到<code class="fe ms mt mu mv b">User Management &gt; Users</code>并点击+创建用户。给用户一个电子邮件地址<em class="kw">(可以是任何一个，但是如果你想稍后测试密码重置，你可能想使用一个真实的电子邮件地址)</em>和一个密码。用户还需要一个连接，它基本上是存储用户数据的数据库。由于Auth0，我们已经有了一个默认连接<code class="fe ms mt mu mv b">Username-Password-Authentication</code>，它是在创建帐户时生成的。你可以使用许多其他的连接<em class="kw">(例如，也有一个默认的谷歌社交连接)</em>，但是让我们坚持使用那个。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/bb38b2a0df5d6970edf1bcba1f77e0ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CbPUCQFm9riEcF4v1jp1ew.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">要添加用户，请输入电子邮件地址和密码。</p></figure><blockquote class="kr ks kt"><p id="e105" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您在这里得到一个密码太弱的错误，要么选择一个更硬的密码，要么在<code class="fe ms mt mu mv b">Authentication &gt; Database &gt; Username-Password-Authentication &gt; Password Policy</code>中更改密码强度。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/6a820fffea5498fdc05bf1814a951517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SvqLKcAsEXLVptN4LZsrPg.png"/></div></div><p class="nj nk gj gh gi nl nm bd b be z dk translated">如果您想更改“用户名-密码-身份验证”连接的密码策略。</p></figure><p id="ec74" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">干得好！我们也差不多完成了。该用户尚未被授权使用我们的报价应用程序，但一旦该用户首次登录，该用户将自动注册我们的应用程序<em class="kw">(该功能也可以在</em><code class="fe ms mt mu mv b"><em class="kw">Authentication &gt; Database &gt; Username-Password-Authentication &gt; Settings &gt; Disable Sign Ups</em></code><em class="kw"/>下禁用)。</p><p id="072a" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">我已经创建了一个<a class="ae lr" href="https://codesandbox.io/s/hopeful-haslett-zgj55z?file=/src/index.js:312-474" rel="noopener ugc nofollow" target="_blank"> CodeSandbox </a>示例，您可以在其中测试自己的设置。只需在<code class="fe ms mt mu mv b">index.js</code>中为您的报价申请替换您的Auth0域和客户ID</p><pre class="kg kh ki kj gt no mv np nq aw nr bi"><span id="b4f4" class="ns lt iq mv b gy nt nu l nv nw">// part of index.js</span><span id="d780" class="ns lt iq mv b gy nx nu l nv nw">&lt;Auth0Provider<br/>  domain=”&lt;your-auth0-domain&gt;”<br/>  clientId=”&lt;your-client-id&gt;”<br/>  redirectUri={window.location.origin}<br/>&gt;</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="65ee" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">您可以在您的Auth0仪表板中的<code class="fe ms mt mu mv b">Applications &gt; Quote App &gt; Settings</code>下找到域名和客户端ID。</p><p id="d463" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld mm lf lg lh mo lj lk ll mq ln lo lp lq ij bi translated">我们完了！我希望这一切对你来说都解决了！我让您这样做是为了对您的前端应用程序进行一些试验。在本系列的第3部分中，我们将把Dgraph和Auth0放在一起，这将使我们的演示应用程序拥有一个安全的GraphQL端点。</p></div></div>    
</body>
</html>