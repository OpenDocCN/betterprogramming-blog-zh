# 如何将 API Gateway 和 SQS 与 AWS CDK 集成

> 原文：<https://betterprogramming.pub/how-to-integrate-api-gateway-and-sqs-with-aws-cdk-14e74e7de5ba>

## 如何使用 AWS CDK 部署堆栈

## API Gateway 和 AWS SQS 之间的直接集成

大家好。在过去的一个月里，我一直在学习 CDK 框架。很不可思议，很强大。让我们来看看吧！

![](img/54a05f322e8a5cdda5552090ea65a891.png)

由[穆罕默德·阿里·皮克](https://unsplash.com/@mrpeker?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# 什么是 CDK？

根据 AWS 页面的概述，“AWS 云开发工具包(AWS CDK)是一个开源软件开发框架，使用熟悉的编程语言来定义您的云应用程序资源。”

对于开发人员来说，从应用程序的同一种语言创建 AWS 的基础设施更自然，而不是切换到 JSON 或 YAML。

由于构造编程模型(CPM ),您可以更容易地开发您的基础设施。每个构造都是一个 AWS 资源，一个构造有三个级别:

*   L1——这些是低层次的资源，比如云形成资源。该层中的类定期从 AWS CloudFormation 资源规范中生成，类的名称以 Cfn 前缀开头。
*   L2 —这些是 AWS 的高级资源，由 L1 构件创建。它们包括带有默认值、样板文件和实用程序的功能。推荐这些开始开发栈。
*   L3 —这些结构被称为模式。它们包括多个构造，以创建一个随时可用的构造。第三级构造的一个例子是`ecs_patterns`，它包括许多 ECS 模式，这些模式将创建许多资源。

# 建立一个堆栈

我想给你们看一个 CDK 是如何工作的小例子。我们将使用 API Gateway 来推送 SQS 队列中的元素。我们正试图建造一个三级建筑。

## 什么是直接集成？

这个小例子演示了如何在不使用 lambda 函数的情况下创建一个端点来推送 SQS 队列中的元素。

API Gateway 和 SQS 之间不通过 lambda 函数的直接集成有利于延迟、成本和您的心理健康。

## 利益

延迟更低，因为您不需要启动新的 lambda 函数(如果是第一次，则使用冷启动)，因此您只有 API gateway 的延迟和从 SQS 发送消息的延迟。

成本。我说过，你不需要 lambda 函数，所以成本和执行时间为零。然后，您将只支付 API 网关和 SQS 请求。我知道这个费用对无服务器的人来说很荒谬，但是如果你有很多电话，你可以在上面花很多钱。使用此解决方案，您可以保持低成本。

心理健康是最重要的，因为你不需要每天更新代码，维护和更新 SDK，或者检查 lambda 函数崩溃的原因，因为该服务完全由 AWS 管理。

# 我们来钻研一些代码吧！

从 AWS CDK 开始的第一步是建立 CDK。您可以使用 NPM(或 Yarn)在您的环境中安装 global，代码如下:

`npm install -g aws-cdk`

要创建您的第一个项目，您必须创建一个新文件夹，然后执行以下操作:

`cdk init app --language=typescript`

这样，CDK 将使用 TypeScript 语言建立您的项目。在`lib/`文件夹中，你可以找到你想要部署的当前栈。

我做这个堆栈是为了方便 API 网关和 SQS 的直接集成。

让我解释一下这些代码:

在上面的代码片段中，您可以看到我创建了一个由 AWS 管理加密的 SQS 队列和一个 API 网关角色。您可以看到 CDK 有一个授予角色权限的方法。这样，你就不需要写保单了。只需调用这个方法，它就会为您做到这一点！最佳实践是使用 grant 方法来授予正确的权限。

这是堆栈的核心。这里我们定义了 API 网关 Rest API 和直接集成。如您所见，我们与 SQS 集成，然后将端点主体作为消息发送。是的，我知道它有点脏，但是对于这个例子来说，它会做得很好。

在您的 AWS 帐户中部署之前，您必须引导环境。环境是来自地区/客户的一对夫妇。要引导您的环境，请执行以下操作:

```
cdk bootstrap
```

引导完成后，您可以使用以下命令部署堆栈:

```
cdk deploy
```

部署完成后，您可以获得 URL 来调用您的新端点并向 SQS 发送消息。

AWS CDK 是部署基础设施的绝佳工具。最近一个月，我一直在了解它，和同事讨论它，并将其用于新的项目。

今天到此为止。我希望你觉得这篇文章很有趣。

回头见！