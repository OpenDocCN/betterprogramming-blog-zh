<html>
<head>
<title>How To Put a Legacy Application in Git</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将遗留应用程序放入Git</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-put-a-legacy-application-in-git-c7b1aec7cd2f?source=collection_archive---------8-----------------------#2022-06-24">https://betterprogramming.pub/how-to-put-a-legacy-application-in-git-c7b1aec7cd2f?source=collection_archive---------8-----------------------#2022-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2cc8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">验证所有应用程序都在版本控制系统中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/956088ea109ff9c7022e539eed00a020.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4EyFxquHOykUHkrK.jpg"/></div></div></figure><p id="245d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你有没有遇到过一个旧的应用程序，在2022年仍然不在<a class="ae lq" href="https://www.atlassian.com/git/tutorials/what-is-version-control" rel="noopener ugc nofollow" target="_blank">版本控制系统</a> (VCS)下，比如<a class="ae lq" href="https://git-scm.com/" rel="noopener ugc nofollow" target="_blank"> Git </a>或<a class="ae lq" href="https://subversion.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Subversion </a>？一个系统，为了修改它，需要连接应用所在的服务器，直接用<a class="ae lq" href="https://en.wikipedia.org/wiki/Vim_(text_editor)" rel="noopener ugc nofollow" target="_blank"> vim </a>修改文件？</p><p id="8e2b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在舍布鲁克镇，我们的主要系统之一是。有人很容易引入新的变化或缺陷。唯一做出改变的人会知道为什么要这样做！</p><p id="f296" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">是时候开始跟踪该系统中的变化了。</p><h1 id="7fde" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">结构化</h1><p id="5020" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">由于遗留系统可能非常复杂，我们需要构造自己来确定我们想要版本化它的内容和方式。</p><h2 id="f8cb" class="mo ls it bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">Git分支</h2><p id="6843" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我们的系统有两个环境:生产和开发。因为他们每个人都有不同版本的应用程序，所以他们需要在Git中有相应的分支:<code class="fe na nb nc nd b">main</code>和<code class="fe na nb nc nd b">develop</code>。</p><p id="f0e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当你考虑Git的时候，你可以去<a class="ae lq" href="https://about.gitlab.com/" rel="noopener ugc nofollow" target="_blank"> GitLab </a>或者<a class="ae lq" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>创建一个新的Git仓库。确保它是空的，因为这样会容易得多。</p><h2 id="d153" class="mo ls it bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">开发文件</h2><p id="1415" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">由于开发人员直接在服务器上进行更改，所以有可能存在我们不想进行版本控制的文件，比如副本或待办事项列表。</p><p id="2140" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我们需要用一个<a class="ae lq" href="https://en.wikipedia.org/wiki/Whitelist" rel="noopener ugc nofollow" target="_blank"> allowlist </a>(也称为白名单)列出我们想要的文件。</p><p id="d680" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以从生产服务器上的文件开始这个列表，因为不应该有太多我们不想要的文件。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="472f" class="mo ls it nd b gy ni nj l nk nl">index.html<br/>api.js<br/>search.js<br/>main.js<br/>main.css<br/>README.md</span></pre><p id="0322" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一个简单命名为<code class="fe na nb nc nd b">files.txt</code>的文本文件的例子，它列出了定制应用程序应该版本化的所有文件。</p><blockquote class="nm nn no"><p id="0573" class="ku kv np kw b kx ky ju kz la lb jx lc nq le lf lg nr li lj lk ns lm ln lo lp im bi translated">如果您知道所需文件的扩展名，您可以使用类似下面的命令轻松创建该文件。</p><p id="d30a" class="ku kv np kw b kx ky ju kz la lb jx lc nq le lf lg nr li lj lk ns lm ln lo lp im bi translated"><code class="fe na nb nc nd b">find . -regex ".*\.js" -o -regex ".*\.css" &gt; files.txt</code></p><p id="a119" class="ku kv np kw b kx ky ju kz la lb jx lc nq le lf lg nr li lj lk ns lm ln lo lp im bi translated">它将列出所有匹配正则表达式的文件。您将能够修改这个基本文件来包含或排除更多的内容。</p></blockquote><p id="5b6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们已经构建好了，让我们进入脚本阶段！</p><h1 id="3661" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">脚本</h1><p id="3a52" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">由于我们不应该将Git添加到生产服务器(这可能会在那里引入潜在的漏洞)，我们将使用<a class="ae lq" href="https://en.wikipedia.org/wiki/Secure_copy_protocol" rel="noopener ugc nofollow" target="_blank"> scp </a>将我们想要的文件下载到我们的本地机器。</p><blockquote class="nm nn no"><p id="4b51" class="ku kv np kw b kx ky ju kz la lb jx lc nq le lf lg nr li lj lk ns lm ln lo lp im bi translated">对于那些感兴趣的人，如果你是这个命令的新手，这里有一个<a class="ae lq" href="https://devhints.io/scp" rel="noopener ugc nofollow" target="_blank">有用的备忘单</a>。</p></blockquote><h2 id="41cd" class="mo ls it bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">为我们的应用程序创建一个档案</h2><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="79a8" class="mo ls it nd b gy ni nj l nk nl"># From our local computer, upload the file that contains the list of files we want to version<br/>scp list.txt USERNAME@PRODUCTION_SERVER_NAME:/PATH_OF_OUR_APPLICATION<br/><br/># Connect to the production server<br/>ssh USERNAME@PRODUCTION_SERVER_NAME<br/><br/># Go to where the application is<br/>cd /PATH_OF_OUR_APPLICATION<br/><br/># Create an archive containing the files we want<br/>tar --create --preserve-permissions --file APPLICATION_NAME.tar --files-from files.txt --verbose<br/><br/># Go back to our local computer<br/>exit</span></pre><h2 id="9a44" class="mo ls it bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">将源代码下载到我们的本地计算机上</h2><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="0d79" class="mo ls it nd b gy ni nj l nk nl"># Create a new directory to receive the source code<br/>mkdir -p ~/Downloads/APPLICATION_NAME<br/><br/># Download our TAR archive to our computer<br/>scp USERNAME@PRODUCTION_SERVER_NAME:/PATH_OF_OUR_APPLICATION/APPLICATION_NAME.tar ~/Downloads<br/><br/># Extract the TAR archive to our new directory<br/>tar --extract --preserve-permissions --file ~/Downloads/APPLICATION_NAME.tar --directory ~/Downloads/APPLICATION_NAME --verbose</span></pre><h2 id="1589" class="mo ls it bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">将源代码上传到GitLab存储库</h2><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="249d" class="mo ls it nd b gy ni nj l nk nl"># Go in the directory that now contains our source code<br/>cd ~/Downloads/APPLICATION_NAME<br/><br/># Initialize the Git repository in that directory<br/>git init<br/>git remote add origin git@gitlab.com:benjaminrancourt/APPLICATION.git<br/><br/># Add all files to the Git repository<br/>git add .<br/><br/># Commit changes<br/>git commit -m "Source code from the production environment"<br/><br/># Create the main branch<br/>git branch -M main<br/><br/># Push the main branch to GitLab<br/>git push origin main</span></pre><h2 id="d3bb" class="mo ls it bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">对另一个环境重复上述步骤</h2><p id="2a58" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">请记住，我们的遗留应用程序在不同的环境中可能有不同的版本。如果是这样，您可能想知道对生产服务器还没有做什么更改。</p><p id="87cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我们必须将这些版本推送到Git，这样我们就可以很容易地比较它们。</p><p id="cafc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，对于我的开发环境，我将执行以下操作:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="5ec1" class="mo ls it nd b gy ni nj l nk nl"># Download the source code from the development server (follow the previous procedure)<br/><br/># Go in the directory that now contains our source code<br/>cd ~/Downloads/APPLICATION_NAME<br/><br/># Make sure we are on the main branch<br/>git checkout main<br/><br/># Create a new branch from main<br/>git checkout -b develop<br/><br/># Extract the archive from the development server <br/>tar --extract --preserve-permissions --file ~/Downloads/APPLICATION_NAME_DEV.tar --directory ~/Downloads/APPLICATION_NAME --verbose<br/><br/># Add all changes<br/>git add .<br/><br/># Commit the changes<br/>git commit -m "Source code from the development environment"<br/><br/># Push the develop branch to GitLab<br/>git push origin develop</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/8d2a0c81b5fe80533abd6e84dc91bfe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Yg-oZgjEArDZJzr7.jpg"/></div></div><p class="nu nv gj gh gi nw nx bd b be z dk translated">一个从<code class="fe na nb nc nd b">develop</code>到<code class="fe na nb nc nd b">main</code>的合并请求，在这里我可以很容易地识别出还没有生产的变更。</p></figure><h1 id="4380" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">结论</h1><p id="dd6a" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">通过将遗留系统放入版本控制系统，您可以大大降低丢失应用程序源代码的风险。</p><p id="c212" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">向更好的系统迈进了一步！😎</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="bb7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="np">最初发布于</em><a class="ae lq" href="https://www.benjaminrancourt.ca/how-to-put-a-legacy-application-into-git/" rel="noopener ugc nofollow" target="_blank"><em class="np">www . Benjamin rancourt . ca</em></a><em class="np">。</em></p></div></div>    
</body>
</html>