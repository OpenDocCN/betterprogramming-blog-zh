<html>
<head>
<title>Moving Messages in AWS: Comparing Kinesis, SQS, and SNS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS中移动消息:比较Kinesis、SQS和SNS</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/moving-messages-in-aws-comparing-kinesis-sqs-and-sns-32cb5d2f89d5?source=collection_archive---------0-----------------------#2019-10-14">https://betterprogramming.pub/moving-messages-in-aws-comparing-kinesis-sqs-and-sns-32cb5d2f89d5?source=collection_archive---------0-----------------------#2019-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1f33" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">哪种技术最适合在AWS上传递您的信息？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/3078cea24d4d23c1e98e263a0ea1aad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*dTh5P-Yo_6Q4hoW-HMQkOQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Kinesis，SQS还是SNS？</p></figure><p id="8057" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用无服务器技术构建您的应用程序充满了看起来相似的选项。将事件和消息从一个地方转移到另一个地方就是一个典型的例子:你如何决定哪种技术适合你？</p><p id="5509" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本指南中，我将比较以下AWS服务:</p><ul class=""><li id="235e" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">kine sis——kine sis数据流</li><li id="bc63" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">简单队列服务—SQS标准队列</li><li id="e721" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">简单通知服务——SNS主题</li></ul></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="cae6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我可能应该先道歉:事实是这不是一个“谁对谁”的问题。每种服务都非常适合特定的用例。我们只需要了解我们的用例是什么，然后选择合适的技术。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/0b21243293a91c7deff94a16696bc682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*yr-cqLz8Cujj18HjnDrN3Q.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">典型的基于消息、事件驱动的架构</p></figure><p id="cc85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本指南帮助的场景是一个或多个服务<em class="mm">按照事件驱动模式产生</em>消息和<em class="mm">消费</em>消息。要决定哪种<em class="mm">交通</em>服务最适合您的需求，您需要了解与决策相关的特征:</p><ul class=""><li id="6b36" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">可扩展性和负载</li><li id="544d" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">多个消费者</li><li id="129f" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">可靠性</li><li id="165d" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">过滤</li><li id="f2ab" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">消息大小</li><li id="3cb3" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">费用</li></ul><p id="b0b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事不宜迟，我们开始对比吧。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="fd93" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">可扩展性和负载</h1><p id="b6be" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">我们的生产者/消费者模式中的三个元素可能都需要扩展。了解您的负载水平将如何变化以及这些增加和减少的性质是非常重要的。例如，你期望一个稳定的线性负载吗？或者，您是否期望在可预测的时间点出现“钟形曲线”式的上升和下降？或者可能是一个尖峰负载曲线，在这种情况下，大负载可能在任何时候出现，而没有警告？</p><h2 id="e82d" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">上传请求</h2><p id="3ec6" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">首先要考虑的是从生产者到运输服务的“投入”。当生产者将他们的消息发送到传输时，传输需要有足够的带宽来接受这些消息。否则，生产者将不得不不断重试，否则可能会丢失这些消息。</p><h2 id="4392" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">SQS和社交网络</h2><p id="ca6e" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">SQS和SNS在这里表现不错。它们会自动缩放以匹配传入消息的速率。换句话说，你不需要担心！</p><h2 id="dcbb" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">由外界刺激引起的不随意运动</h2><p id="e177" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">Kinesis就没那么有用了。一个Kinesis流的规模与其拥有的“碎片”数量有关。更多碎片，更大规模。每个碎片有1个MiB和每秒1000条消息的限制。</p><p id="9c10" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，如果预期吞吐量是每秒9，500条消息，您可以放心地提供10个碎片来避免瓶颈。但是，如果吞吐量可能发生变化，所需的分片数也必须随之变化。</p><p id="5628" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">AWS不会为你管理Kinesis碎片的数量，因此，与SNS或SQS不同，你的解决方案必须包括一种方法来<a class="ae nw" href="https://docs.aws.amazon.com/kinesis/latest/APIReference/API_UpdateShardCount.html" rel="noopener ugc nofollow" target="_blank">改变Kinesis流上的碎片数量</a>。碎片的过度供应会增加成本，但是要注意——AWS限制了在24小时内可以减少流上碎片数量的次数。</p><p id="bcd2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这里阅读更多关于Kinesis <a class="ae nw" href="https://docs.aws.amazon.com/streams/latest/dev/service-sizes-and-limits.html" rel="noopener ugc nofollow" target="_blank">极限的信息</a>。</p><h2 id="dd1c" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">获取请求</h2><p id="2eec" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">一旦消息被放到传输服务中，我们需要接收它们——消费者需要能够获取它们。get的伸缩性与put的伸缩性非常相似。</p><h2 id="1b03" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">SQS和社交网络</h2><p id="0323" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">再一次，AWS在这里很有帮助。如果我们设置一个Lambda函数由SQS或SNS触发，AWS将自动增加和减少该Lambda的实例，以匹配put的规模。您可以放心，因为AWS会负责优化规模。</p><h2 id="4159" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">由外界刺激引起的不随意运动</h2><p id="efc0" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">如果我们有一个由Kinesis流触发的Lambda，AWS会确保为每个流部署该Lambda的一个实例。随着流数量的增加或减少，部署的Lambda实例的数量也会增加。Lambda实例属于那个分片，所以只接收来自那个分片的消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi nx"><img src="../Images/083e8a92867b1d84688675755c532885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DVdz7ZVv8wgtJLYGz1Vl1w.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">每个分片1个Lambda实例</p></figure><p id="0c52" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">理解这种模式是必要的，因为每个碎片限制达到10个<a class="ae nw" href="https://en.wikipedia.org/wiki/Mebibyte" rel="noopener ugc nofollow" target="_blank"> MiB </a>和每次<em class="mm">调用</em>10，000条消息。请注意，限制是根据<em class="mm">调用</em>而不是每秒。要了解Lambda调用了多少个调用，您需要知道Lambda的批处理大小和处理时间。有许多变量需要考虑，包括内存分配、代码效率等。要问的关键问题是:<em class="mm">在每个分片中，消费者处理消息的速度能比产生消息的速度更快吗？</em>否则，您的消费者将无法跟上生产量。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="f561" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">多个消费者</h1><p id="0f3b" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">一个重要的考虑因素是您是需要多种消费者(执行不同的功能)还是只需要一个。注意，就规模或吞吐量而言，这不同于拥有同一个消费者的多个<em class="mm">实例</em>。</p><h2 id="2072" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">社交网站（Social Network Site的缩写）</h2><p id="0a9d" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">简单通知服务允许多达一千万的订阅者订阅一个主题，这意味着一千万个不同的Lambda函数订阅一个主题。对于大多数用例来说，这远远超出了需要。</p><p id="fb78" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">点击阅读更多关于SNS限制<a class="ae nw" href="https://aws.amazon.com/sns/faqs/" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><h2 id="88aa" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">由外界刺激引起的不随意运动</h2><p id="5084" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">Kinesis比SNS限制性更强。每个流被允许有20个离散消费者，每个<em class="mm">流</em>(使用<a class="ae nw" href="https://docs.aws.amazon.com/streams/latest/dev/introduction-to-enhanced-consumers.html" rel="noopener ugc nofollow" target="_blank">增强扇出</a>)。对于您的用例，20个消费者可能就足够了。</p><p id="d20b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，如果您要从一个流中触发多个消费者，那么您必须知道另一个限制。每个碎片被限制为每秒五次获取。如果您的每个Lambdas的调用持续时间都是一秒钟，那么您可能只有五个使用者。如果周期时间是两秒，你可能有10秒，以此类推。</p><p id="779b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以做一些事情来减轻这个限制:增加批量大小，调整内存分配等等。请记住，Lambda调用的行为可能不完全一致。所以，如果只有很小的容差，Lambdas偶尔可能无法从shard中获得记录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/31bde2f06e2c48bd9eca8a5869562af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*sRA6uYtNNGeTSpxdca02dw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">每种服务都有不同的消费者限制</p></figure><h2 id="3c88" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">SQS</h2><p id="96a5" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">因为SQS是一种排队服务(不是流服务)，它不适合多个消费者。它是专为“一次性”递送而设计的。当一个使用者从队列中“获得”一条消息时，SQS会阻止其他使用者使用这条消息。</p><p id="3b39" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果SQS是首选服务，尽管有此限制，那么您必须为每个消费者安排一个队列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi od"><img src="../Images/2f2f96c02baf567939f014ce29dd6a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5aV3V5ivwOwxpTbUssho8A.jpeg"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">格雷格·法罗摄影</p></figure><h1 id="afd9" class="mn mo it bd mp mq oe ms mt mu of mw mx jz og ka mz kc oh kd nb kf oi kg nd ne bi translated">可靠性</h1><p id="5837" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">可靠性看起来似乎是一个奇怪的特性——当然，设计应该总是可靠的？</p><p id="83a7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">澄清一下:我所说的可靠性是指确保消息被成功消费<em class="mm">最终</em>的能力。延迟处理并不适合所有情况。例如，如果消息是时间敏感的，那么除非在特定的时间范围内被成功地消费掉，否则它可能是无用的。</p><p id="339d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在另一个极端，即使“丢失”一条消息也是不可接受的。</p><h2 id="65b6" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">SQS</h2><p id="8edf" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">SQS队列管理消息的方式使其成为非常可靠的选择。当消息被“消费”时，它会保留在队列中。但是，其他所有<em class="mm">消费者都看不到。当消息保持隐藏状态时，不能再次使用，从而防止重复处理。</em></p><p id="291a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，如果在消费者处理消息的过程中出现错误，该怎么办呢？在这种情况下，消费者将无法告诉SQS消息已被成功消费。SQS最终会让信息再次可见，以便另一个消费者可以检索到它。您可以自定义可见性超时— <a class="ae nw" href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-visibility-timeout.html" rel="noopener ugc nofollow" target="_blank">这里有一些关于如何工作的信息</a>。</p><p id="cddb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">消息会在SQS队列中保留四天，或者直到它们被成功使用(<a class="ae nw" href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-limits.html" rel="noopener ugc nofollow" target="_blank">这是可配置的</a>，在60秒和14天之间)。</p><h2 id="d60f" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">社交网站（Social Network Site的缩写）</h2><p id="cb02" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">社交网站的可靠性不如SQS。如果用户出现错误，SNS会尝试重新发送消息，但仅限于严格限制范围内。更多信息可以在这个问题的答案中找到:<a class="ae nw" href="https://aws.amazon.com/sns/faqs/" rel="noopener ugc nofollow" target="_blank">问:如果订阅端点不可用，Amazon SNS消息会怎么样？</a></p><h2 id="f7f4" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">由外界刺激引起的不随意运动</h2><p id="945e" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">Kinesis可以说是三个选项中最可靠的。与SQS非常相似，如果消费者中存在持久错误状态，消息不会丢失——它会保留在流中。Kinesis是一个<em class="mm">流</em>，而不是一个<em class="mm">队列。</em>一旦消息被成功处理，它<em class="mm">将保持</em>在流中。邮件不会被删除。</p><p id="081b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为Kinesis保留所有消息，不管它们的成功处理状态如何，它提供了一个SQS或SNS都没有提供的选项——重播。</p><p id="112c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">也许消费者没有进入错误状态，但是消息被不正确地处理。例如，代码中的业务逻辑可能有问题。如果你正在使用Kinesis，你可以重置触发器到历史上的某个点(<a class="ae nw" href="https://docs.aws.amazon.com/streams/latest/dev/kinesis-extended-retention.html" rel="noopener ugc nofollow" target="_blank">直到保持期限制</a>)。重置触发器可能是一个有益的选择，尤其是在数据保留和准确性至关重要的情况下。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="86a8" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">过滤</h1><p id="5718" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">有些用例要求能够过滤消息，只处理那些与消费者相关的消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/7acafdce6c7505b804df6527765c0267.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*Ns919R6nm1ptzB_4uliB_Q.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">仅处理具有消费者类型子集的消息</p></figure><p id="29b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，如果使用者应该只处理属于一个租户的消息，那么最好防止它被不符合标准的消息调用。</p><p id="5163" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的例子中，消费者1希望处理所有消息，而不管内容如何。消费者二只想处理属于一个特定租户的消息。SNS、SQS和Kinesis如何帮助我们解决这个问题？</p><h2 id="ba59" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">SQS</h2><p id="c221" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">如上所述，一个SQS队列应该有一个订阅的消费者，而不是几个。解决方法是为每个消费者设置不同的SQS队列。</p><p id="50d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">拥有多个队列带来了一个问题:协调生产者变得更加困难。每个生产者现在必须理解它正在发送的消息的上下文，以便它可以将消息提交到正确的队列。</p><h2 id="81c2" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">由外界刺激引起的不随意运动</h2><p id="df30" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">不像SQS，一个Kinesis流上有多个消费者是完全可以接受的。但是，Kinesis不提供任何过滤帮助。</p><p id="2827" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">解决方法是让所有使用者调用并检查消息的内容。消费者必须做出决定:处理消息，或者忽略它。在不知道消息是否应该被处理的情况下进行调用是不理想的。调用必须付费，决定消息是否相关的处理时间也必须付费。在我看来，在无服务器架构中，不需要运行计算是一种反模式，因此应该避免。</p><h2 id="c3a6" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">社交网站（Social Network Site的缩写）</h2><p id="f9c6" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">在过滤方面，社交网络话题是我们的冠军。话题允许<a class="ae nw" href="https://docs.aws.amazon.com/sns/latest/dg/sns-subscription-filter-policies.html" rel="noopener ugc nofollow" target="_blank"> <em class="mm">订阅过滤</em> </a> <em class="mm">。</em>订阅过滤器非常出色。基于过滤器，您可以选择处理或不处理消息，而不必调用Lambda来检查内容。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="27b5" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">消息大小</h1><p id="0b7a" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">虽然所讨论的一些特征是需要评估和寻找折衷的问题，但是消息大小是更明确的。您必须在消息有效负载大小的硬性限制内操作。</p><h2 id="48d8" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">社交网站（Social Network Site的缩写）</h2><p id="aa83" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">从<a class="ae nw" href="https://aws.amazon.com/sns/faqs/#Limits_and_restrictions" rel="noopener ugc nofollow" target="_blank"> AWS SNS文档</a>中:</p><blockquote class="oj ok ol"><p id="33da" class="ku kv mm kw b kx ky ju kz la lb jx lc om le lf lg on li lj lk oo lm ln lo lp im bi translated">Amazon SNS消息可以包含多达256 KB的文本数据，包括XML、JSON和无格式文本。</p></blockquote><h2 id="6373" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">SQS</h2><p id="761f" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">来自<a class="ae nw" href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-limits.html#limits-messages" rel="noopener ugc nofollow" target="_blank"> AWS SQS文档</a>:</p><blockquote class="oj ok ol"><p id="affb" class="ku kv mm kw b kx ky ju kz la lb jx lc om le lf lg on li lj lk oo lm ln lo lp im bi translated">最小消息大小为1字节(1个字符)。最大值为262，144字节(256 KB)。</p></blockquote><h2 id="e93e" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">由外界刺激引起的不随意运动</h2><p id="c707" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">来自<a class="ae nw" href="https://docs.aws.amazon.com/streams/latest/dev/service-sizes-and-limits.html" rel="noopener ugc nofollow" target="_blank"> AWS Kinesis文档</a>:</p><blockquote class="oj ok ol"><p id="0a9a" class="ku kv mm kw b kx ky ju kz la lb jx lc om le lf lg on li lj lk oo lm ln lo lp im bi translated">在base64编码之前，记录的数据有效负载的最大大小为1 MB。</p></blockquote><p id="f937" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于任何比简单信息更大的东西，Kinesis是更合适的选择。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="f2dc" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">费用</h1><p id="4c10" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">每项服务都有不同的相关成本。这些成本可能会很高，你应该在产生这些成本之前了解它们可能是什么。成本可能是选择过程中的一个重要因素。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi op"><img src="../Images/36e670b37f943f586f2ea2d1db8df94a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nV_LoHr9l86cSP6lL1xyrw.jpeg"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">看好硬币……(格雷格·法罗拍摄)</p></figure><h2 id="9e6a" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">社交网站（Social Network Site的缩写）</h2><p id="eb6c" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated"><a class="ae nw" href="https://aws.amazon.com/sns/pricing/" rel="noopener ugc nofollow" target="_blank">产品升级和技术支持服务成本</a>将取决于您的消费者。假设您的消费者是Lambda functions，交付是免费的。因此，你只需支付发布消息的主题。</p><blockquote class="oj ok ol"><p id="b6e0" class="ku kv mm kw b kx ky ju kz la lb jx lc om le lf lg on li lj lk oo lm ln lo lp im bi translated">每100万次发布请求0.50美元</p></blockquote><h2 id="1257" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">SQS</h2><p id="cf68" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">SQS向你收取与它互动的费用。因此，您将为每次交互—每次请求—累积成本。发布到队列是一个请求，使用队列中的消息是另一个请求。因此，尽管每百万次请求的价格略低于产品升级和技术支持服务，但更多的请求将导致成本继续增加。</p><blockquote class="oj ok ol"><p id="7e7c" class="ku kv mm kw b kx ky ju kz la lb jx lc om le lf lg on li lj lk oo lm ln lo lp im bi translated">每100万次发布请求0.40美元</p></blockquote><p id="dfd8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您在SQS以外的地方阅读信息，您可能还会产生数据传输费用，更多详情请参见<a class="ae nw" href="https://aws.amazon.com/sqs/pricing/" rel="noopener ugc nofollow" target="_blank">价格信息</a>。</p><h2 id="4c30" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">由外界刺激引起的不随意运动</h2><p id="896b" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">Kinesis的定价不同于SNS和SQS，并且很难预测您的成本-但值得努力确保您不会累积大笔账单！</p><p id="3b7a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">AWS在他们的<a class="ae nw" href="https://aws.amazon.com/kinesis/data-streams/pricing/" rel="noopener ugc nofollow" target="_blank">定价页面</a>上提供了一个方便的计算器。计算器让你更容易理解你的流将花费多少。</p><p id="e24c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您将为数据流的碎片数量、所需的保留期以及数据流上的数据量产生成本。有趣的是，消费消息的Get请求不需要付费。</p><p id="77c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据我的经验，随着体积的增加，Kinesis在成本上变得更有利——但前提是你能保持碎片数量绝对最小。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="4711" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">我们如何将这一切付诸实践？</h1><p id="43f8" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">如果你是云或AWS的新手，你可能会觉得信息超载。似乎经常有几个可行的选择——没有一个明显的方法来选择“最好”的一个。我深表同情！我也经历过同样的痛苦。让我们试着把它煮沸。</p><h2 id="bce5" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">社交网站（Social Network Site的缩写）</h2><p id="111e" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated"><strong class="kw iu">我最喜欢SNS的两点:</strong>出色的扩展性和可过滤性。</p><p id="183d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">我对社交网站的担心:</strong>如果你的提醒和设计不够强大，数据很有可能会丢失。</p><p id="1b33" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">关于SNS，我“要记住的事情:</strong>成本。如果你不明白自己的计划，这些会让你大吃一惊。</p><h2 id="a16a" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">SQS</h2><p id="ff1f" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated"><strong class="kw iu">我最喜欢SQS的一点:</strong>它可以轻松地进行大规模扩展，同时保证所有数据的安全。</p><p id="b06a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">我对SQS的担心:</strong>它对多个消费者不起作用。这可能导致更复杂的架构。对于有经验的人来说，这不成问题，但作为新手，这可能会令人生畏。</p><p id="43ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">关于SQS，我要记住的是:因为当你使用Lambda来消费它时，它的伸缩性是如此惊人，它可以打破你的<a class="ae nw" href="https://docs.aws.amazon.com/lambda/latest/dg/limits.html" rel="noopener ugc nofollow" target="_blank">并发限制</a>！确保为消费者隔离Lambda并发性。</p><h2 id="358d" class="nk mo it bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">由外界刺激引起的不随意运动</h2><p id="394f" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">我最喜欢Kinesis的一点是它可以记录你的信息长达七天。如果你想“重放”数据，那就太棒了。</p><p id="eada" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">我对Kinesis的担心:t </strong> hat的缩放取决于你，可能会很尴尬和缓慢(与SNS和SQS相比)。</p><p id="7aab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">我关于Kinesis的“需要记住的事情”:</strong>虽然理论上支持多个消费者，但是实现起来可能会很麻烦。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="38d8" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">最后</h1><p id="8ce5" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">这些服务中的每一个都是有价值的，如果你在正确的场景中应用它们，它们会非常强大。选择最合适的解决方案通常很棘手。最好的学习方法是实验，将你的“最佳猜测”付诸实践，看看会发生什么。</p><p id="74e8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你也应该考虑一起使用这些服务<em class="mm">和</em>来最大化每个服务的好处，同时减少它们的缺点。在<a class="ae nw" href="https://medium.com/responsetap-engineering" rel="noopener"> ResponseTap </a>，我们热衷于使用SNS主题，将SQS队列作为订阅者——使用上面提到的订阅过滤器。下次再谈这个吧！</p><h1 id="2de5" class="mn mo it bd mp mq oe ms mt mu of mw mx jz og ka mz kc oh kd nb kf oi kg nd ne bi translated">附言</h1><p id="7397" class="pw-post-body-paragraph ku kv it kw b kx nf ju kz la ng jx lc ld nh lf lg lh ni lj lk ll nj ln lo lp im bi translated">如果您觉得这篇文章很有用，并且想了解更多关于如何有效地向这些服务发送数据，请查看这篇文章:</p><div class="oq or gp gr os ot"><a href="https://medium.com/@greg.farrow1/moving-messages-in-aws-super-fast-lambdas-use-batches-c34cae10e78d" rel="noopener follow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd iu gy z fp oy fr fs oz fu fw is bi translated">在AWS中移动消息:超快的Lambdas使用批处理</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">通过批量发送消息来增强您的Lambda功能。</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">medium.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph ko ot"/></div></div></a></div></div></div>    
</body>
</html>