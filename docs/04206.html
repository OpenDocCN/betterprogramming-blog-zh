<html>
<head>
<title>How to Send an Email With Attachments in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Android中发送带附件的电子邮件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-send-an-email-with-attachments-in-android-b2d75123f7e7?source=collection_archive---------7-----------------------#2020-03-30">https://betterprogramming.pub/how-to-send-an-email-with-attachments-in-android-b2d75123f7e7?source=collection_archive---------7-----------------------#2020-03-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d07a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用JavaMail库直接从Java应用程序或Android应用程序发送电子邮件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/14369855eb333635fc76a8585cf142a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOhwgtwwkEhXG-7Mj7YBIg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@thanhy_99?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Thanh Mai Nguyen </a>在<a class="ae ky" href="https://unsplash.com/s/photos/email?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f6bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读这篇文章，你将学会在Android应用程序中直接发送电子邮件。我们将使用<a class="ae ky" href="https://javaee.github.io/javamail/" rel="noopener ugc nofollow" target="_blank"> JavaMail API </a>，它有助于简化对SMTP服务器的认证。</p><p id="c5d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JavaMail API:</p><blockquote class="lv lw lx"><p id="f358" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“…提供一个独立于平台和协议的框架来构建邮件和消息传递应用程序。JavaMail API是一个可选的软件包，可用于Java SE平台，也包含在Java EE平台中。</p></blockquote><p id="def9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文分为三个部分:</p><ol class=""><li id="08c8" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu mh mi mj mk bi translated">设置</li><li id="70e4" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">履行</li><li id="45b1" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated">结论</li></ol></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="1907" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">1.设置</h1><p id="73d4" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">确保您已经安装了Android Studio，并下载了必要的SDK和构建工具。</p><p id="5636" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用<code class="fe nu nv nw nx b">Empty Activity</code>创建一个新项目。前往以下<a class="ae ky" href="https://code.google.com/archive/p/javamail-android/downloads" rel="noopener ugc nofollow" target="_blank">下载链接</a>并下载所有文件。您应该有以下文件。</p><ul class=""><li id="4c5a" class="mc md it lb b lc ld lf lg li me lm mf lq mg lu ny mi mj mk bi translated"><code class="fe nu nv nw nx b"><a class="ae ky" href="https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/javamail-android/additionnal.jar" rel="noopener ugc nofollow" target="_blank">additionnal.jar</a></code></li><li id="36c5" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu ny mi mj mk bi translated"><code class="fe nu nv nw nx b"><a class="ae ky" href="https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/javamail-android/mail.jar" rel="noopener ugc nofollow" target="_blank">mail.jar</a></code></li><li id="5d15" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu ny mi mj mk bi translated"><code class="fe nu nv nw nx b"><a class="ae ky" href="https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/javamail-android/activation.jar" rel="noopener ugc nofollow" target="_blank">activation.jar</a></code></li></ul><p id="f191" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，这些依赖项不是最新版本。如果你想获得最新版本，请点击下面的<a class="ae ky" href="https://javaee.github.io/javamail/" rel="noopener ugc nofollow" target="_blank"> JavaMail链接</a>并下载相应的<code class="fe nu nv nw nx b">javax.mail.jar</code>1 . 6 . 2版本。</p><p id="959b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将所有jar文件放在项目的<code class="fe nu nv nw nx b">libs</code>文件夹中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/7e7915d8bf696b61a609b6ead9143831.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*LLL9Rkg2SV7avKWBnJaMLQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="f62f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">右键单击它们，然后“添加为库”。检查<code class="fe nu nv nw nx b">gradle.build (Module: app)</code>文件。依赖项中应该有以下代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/736b1b656654b462a19530aa045f9e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*KeMgNfj9ui_LJ7usC3xblw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="d2c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同步梯度只是为了确保模块被正确加载，以防你有冲突的类和函数。进入<em class="ly">构建</em>菜单，点击<em class="ly">清理项目</em>子菜单。</p><p id="835b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到<code class="fe nu nv nw nx b">AndroidManifest.xml</code>文件，添加以下权限。您需要提供应用程序访问来使用<code class="fe nu nv nw nx b">INTERNET</code>。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="1548" class="of my it nx b gy og oh l oi oj">&lt;uses-permission android:name="android.permission.INTERNET"/&gt;</span></pre><p id="e1a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们进入下一部分，启动您的Android项目。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="998b" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">2.履行</h1><p id="212b" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">让我们创建一个名为<code class="fe nu nv nw nx b">SendEmailService</code>的新类。我们将把它作为应用程序的单例对象。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="31f3" class="of my it nx b gy og oh l oi oj">public class SendEmailService {</span><span id="0b66" class="of my it nx b gy ok oh l oi oj">}</span></pre><h2 id="aa5a" class="of my it bd mz ol om dn nd on oo dp nh li op oq nj lm or os nl lq ot ou nn ov bi translated">导入</h2><p id="fd78" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">在MainActivity.java顶部添加以下进口声明。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="9566" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您不确定要导入哪个模块，请继续下一部分，因为稍后您可以通过将鼠标悬停在错误上并点击<code class="fe nu nv nw nx b">Alt+Shift+Enter</code>，或者简单地通过<code class="fe nu nv nw nx b">Alt+Enter</code>跳转到特定错误并进行适当的导入声明来轻松导入它。</p><p id="2528" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你甚至可以将鼠标悬停在错误上，点击<em class="ly">导入类</em>，Android Studio会自动为你导入。如果同一个类名有多个选择，请确保选择了正确的类。</p><p id="0aff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您遇到导入错误的问题，请确保您已经安装了适当的依赖项。</p><h2 id="f6d0" class="of my it bd mz ol om dn nd on oo dp nh li op oq nj lm or os nl lq ot ou nn ov bi translated">初始化</h2><p id="fa0f" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">在您的<code class="fe nu nv nw nx b">SendEmailService</code>类中，添加以下变量。用您的电子邮件和相应的密码替换输入。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="d0da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个接受<code class="fe nu nv nw nx b">Context</code>参数的同步<code class="fe nu nv nw nx b">getInstance</code>方法。</p><p id="8d99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建议在初始化时使用一个<code class="fe nu nv nw nx b">context</code>，因为它为我们以后处理UI提供了更多的灵活性。我们将使用这个函数作为初始化，以确保只创建一个对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="e145" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个构造函数并添加以下初始化。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="d86a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我使用Outlook作为SMTP服务器，连接基于TLS。事实上，您可以使用自己的SMTP服务器或第三方服务，如Gmail或Outlook。</p><p id="0d3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须根据将要使用的SMTP服务器的设置来修改参数。您必须允许第三方服务访问您的电子邮件。</p><p id="b4e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Outlook的设置如下。如果您正在使用其他SMTP服务器，请进行相应的修改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/7e44cad5f8b79be78d7a6903bb0aabd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*qVnls5z03tBHHw8dkIya_A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="1c48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个<code class="fe nu nv nw nx b">SendEmail</code>函数，它将托管发送电子邮件所需的所有代码。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="17a5" class="of my it nx b gy og oh l oi oj">public void SendEmail() {</span><span id="f30f" class="of my it nx b gy ok oh l oi oj">}</span></pre><p id="a8bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在捕捉<code class="fe nu nv nw nx b">MessagingException</code>的函数内增加一个<code class="fe nu nv nw nx b">try catch</code>块。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="8671" class="of my it nx b gy og oh l oi oj">try {</span><span id="4712" class="of my it nx b gy ok oh l oi oj">}<br/>catch<strong class="nx iu"> </strong>(MessagingException e) {<br/>    e.printStackTrace();<br/>}</span></pre><h2 id="41fe" class="of my it bd mz ol om dn nd on oo dp nh li op oq nj lm or os nl lq ot ou nn ov bi translated">哑剧</h2><p id="1794" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">下一步是创建电子邮件。将以下代码放入<code class="fe nu nv nw nx b">try catch</code>块中。您可以使用自己的电子邮件来设置发送者和接收者电子邮件，以进行测试。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="8822" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您将它发送给多个接收者，您可以依靠<code class="fe nu nv nw nx b">InternetAdresss</code>函数来解析它。只需将它们作为逗号分隔的单个字符串添加即可。</p><p id="98d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有问题，将它们存储在一个列表中，并使用以下代码:</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="62af" class="of my it nx b gy og oh l oi oj">List&lt;String&gt; recipient = new ArrayList&lt;String&gt;();<br/>//add item to list<br/>String.<em class="ly">join</em>(<strong class="nx iu">","</strong>, recipient);</span></pre><p id="19c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，添加下面的代码以方便消息发送。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="60b5" class="of my it nx b gy og oh l oi oj">Transport.<em class="ly">send</em>(message);</span></pre><h2 id="e30c" class="of my it bd mz ol om dn nd on oo dp nh li op oq nj lm or os nl lq ot ou nn ov bi translated">异步任务</h2><p id="86e8" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">您不能直接从主线程运行该调用，因为它会阻塞进程。因此，将会出现错误。</p><p id="b1df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过将它包装在一个<code class="fe nu nv nw nx b">Runnable</code>函数中来轻松解决它。我正在使用<code class="fe nu nv nw nx b">AsyncTask</code>来实现这一点。只需将下面的代码放在您的<code class="fe nu nv nw nx b">onCreate</code>函数中，或者放在一个将在<code class="fe nu nv nw nx b">Button click</code>期间被调用的函数中进行测试。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><h2 id="44fd" class="of my it bd mz ol om dn nd on oo dp nh li op oq nj lm or os nl lq ot ou nn ov bi translated">执行服务</h2><p id="4151" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">在最新的更新中，Android中的文档建议使用<code class="fe nu nv nw nx b">java.util.concurrent</code>来代替，因为<code class="fe nu nv nw nx b">AsyncTask</code>在API级别r中已被否决。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/29c0acb3f30c3e323939dddc26aa4695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5VFqsA1Gb7BlMwiB.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。摘自<a class="ae ky" href="https://developer.android.com/reference/android/os/AsyncTask" rel="noopener ugc nofollow" target="_blank">安卓</a></p></figure><p id="7a90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加以下导入语句:</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="bf0d" class="of my it nx b gy og oh l oi oj">import java.util.concurrent.ExecutorService;                       import java.util.concurrent.Executors;</span></pre><p id="edac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个新的<code class="fe nu nv nw nx b">ExecutorService</code>对象。我将只用一个<code class="fe nu nv nw nx b">SingleTheadExecutor</code>。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="8fb6" class="of my it nx b gy og oh l oi oj">static final ExecutorService emailExecutor = Executors.newSingleThreadExecutor();</span></pre><p id="f5f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用以下代码替换<code class="fe nu nv nw nx b">AsyncTask</code>部分:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="4746" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行该应用程序时，您应该能够在邮箱中获得以下结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/774f617c4335c18467fb7ab8346c1597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*F5AChe8R1csHVSbGmK2llw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="d052" class="of my it bd mz ol om dn nd on oo dp nh li op oq nj lm or os nl lq ot ou nn ov bi translated">使用MimeMultipart的图像附件</h2><p id="5a03" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">对于添加图像附件，您可以通过利用<code class="fe nu nv nw nx b">MimeMultipart</code>类来完成。</p><p id="6ace" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们注释掉<code class="fe nu nv nw nx b">setText</code>函数，并继续在<code class="fe nu nv nw nx b">Transport.send</code>函数上方多写几行Java代码。如下初始化<code class="fe nu nv nw nx b">MimeMultipart</code>变量:</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="ce13" class="of my it nx b gy og oh l oi oj">Multipart multipart = new<strong class="nx iu"> </strong>MimeMultipart();</span></pre><p id="a7f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置一个<code class="fe nu nv nw nx b">MimeBodyPart</code>，用各自的文本调用<code class="fe nu nv nw nx b">setContent</code>。您也可以指定一个HTML文本。完成后，通过调用<code class="fe nu nv nw nx b">addBodyPart</code>函数将身体部位添加到<code class="fe nu nv nw nx b">MimeMultipart</code>变量中。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="cc84" class="of my it nx b gy og oh l oi oj">BodyPart messageBodyPart = new MimeBodyPart();<em class="ly"><br/></em>String htmlText = "&lt;H1&gt;<em class="ly">Welcome to Medium!</em>&lt;/H1&gt;";<br/>messageBodyPart.setContent(htmlText, "text/html");<br/>multipart.addBodyPart(messageBodyPart);</span></pre><p id="417d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了发送图像，你必须把它转换成字节数组。假设您的XML中有一个ID为image的<code class="fe nu nv nw nx b">ImageView</code>。只需添加以下导入。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="42f1" class="of my it nx b gy og oh l oi oj"><strong class="nx iu">import </strong>android.widget.ImageView;</span></pre><p id="37ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">初始化你的<code class="fe nu nv nw nx b">MainActivity</code>类中的一个变量。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="d0fb" class="of my it nx b gy og oh l oi oj">private ImageView mImageView;</span></pre><p id="cb2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过在<code class="fe nu nv nw nx b">onCreate</code>函数中找到ID来分配图像视图。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="06b6" class="of my it nx b gy og oh l oi oj">mImageView = (ImageView) findViewById(R.id.<em class="ly">image</em>);</span></pre><p id="339a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过下面的方法从<code class="fe nu nv nw nx b">ImageView</code>中获取<code class="fe nu nv nw nx b">Bitmap</code>对象。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="1880" class="of my it nx b gy og oh l oi oj">Bitmap bitmap = ((BitmapDrawable) mImageView.getDrawable()).getBitmap();</span></pre><p id="218a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须修改<code class="fe nu nv nw nx b">sendEmail</code>函数来接受位图作为参数。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="8bf3" class="of my it nx b gy og oh l oi oj">public void SendEmail(Bitmap bitmap)</span></pre><p id="a2de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nu nv nw nx b">SendEmail</code>函数中，继续在<code class="fe nu nv nw nx b">addBodyPart</code>后添加以下代码。我们将从<code class="fe nu nv nw nx b">ImageView</code>中获取位图，并在<code class="fe nu nv nw nx b">ByteArrayOutputStream</code>中捕获字节数组。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="4d67" class="of my it nx b gy og oh l oi oj">ByteArrayOutputStream baos = new ByteArrayOutputStream();<br/>bitmap.compress(Bitmap.CompressFormat.<em class="ly">JPEG</em>, 100, baos);<br/>byte[] imageInByte = baos.toByteArray();</span></pre><p id="efe9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从字节数组中创建一个新的<code class="fe nu nv nw nx b">MimeBodyPart</code>和一个<code class="fe nu nv nw nx b">ByteArrayDataSource</code>。</p><p id="7634" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以根据自己的偏好设置文件名。通过调用<code class="fe nu nv nw nx b">addBodyPart</code>函数，继续将身体部位添加到<code class="fe nu nv nw nx b">MimeMultipart</code>变量中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="f5cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，调用<code class="fe nu nv nw nx b">setContent</code>并传入<code class="fe nu nv nw nx b">Transport.send</code>函数正上方的multipart。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="0404" class="of my it nx b gy og oh l oi oj">message.setContent(multipart);<br/>Transport.<em class="ly">send</em>(message);</span></pre><p id="7765" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你应该可以在你的邮箱里看到下面的邮件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/d44cbfa1cd153f2ef1f3db4b4a65a1cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*941z3aHCLJ31ymUuZqfh0A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="efb7" class="of my it bd mz ol om dn nd on oo dp nh li op oq nj lm or os nl lq ot ou nn ov bi translated">文本附件</h2><p id="244b" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">您也可以添加文本附件文件。</p><p id="58e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nu nv nw nx b">message.setContent</code>函数上添加以下代码。我将从字符串的字节数组中创建一个简单的<code class="fe nu nv nw nx b">ByteArrayDataSource</code>。如果您正在编写Unicode文本，也可以将<code class="fe nu nv nw nx b">Charset</code>参数作为UTF-8来传递。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="9abf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该能够获得以下结果</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/a7c38182506c85fa9e141b74e71fb7bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*pR35eE8unyzDcT2o8Pitvg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="6175" class="of my it bd mz ol om dn nd on oo dp nh li op oq nj lm or os nl lq ot ou nn ov bi translated">信任商店</h2><p id="c2de" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">如果由于<code class="fe nu nv nw nx b">TrustStore</code>问题而导致发送错误，请添加以下属性。</p><p id="b302" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，这只有在您使用最新版本的JavaMail时才有效。理论上，您可以传入<code class="fe nu nv nw nx b">*</code>作为允许所有证书的值，但是建议不要这样做。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="57ca" class="of my it nx b gy og oh l oi oj">prop.put("mail.smtp.ssl.trust", "smtp.office365.com");</span></pre><h2 id="d011" class="of my it bd mz ol om dn nd on oo dp nh li op oq nj lm or os nl lq ot ou nn ov bi translated">MailCapCommandMap</h2><p id="fcf5" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">如果遇到MIME类型的问题，您需要添加下面的导入声明。</p><pre class="kj kk kl km gt ob nx oc od aw oe bi"><span id="8f3d" class="of my it nx b gy og oh l oi oj">import javax.activation.CommandMap;<br/>import javax.activation.MailcapCommandMap;</span></pre><p id="500f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nu nv nw nx b">Properties</code>的正上方，添加以下代码。这是为了确保它可以处理我们的电子邮件中的所有类型的MIME。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="da8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个<a class="ae ky" href="https://gist.github.com/wfng92/f131ea2d96d0d90338bb496aac97cfdc" rel="noopener ugc nofollow" target="_blank"> GitHub </a>链接上，你可以随意查看<code class="fe nu nv nw nx b">SendEmailService.java</code>的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="6d52" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">3.结论</h1><p id="380b" class="pw-post-body-paragraph kz la it lb b lc np ju le lf nq jx lh li nr lk ll lm ns lo lp lq nt ls lt lu im bi translated">让我们回顾一下你今天所学的内容。我们从一个简单的设置开始，下载必要的JAR文件并将其作为库添加到项目中。此外，我们在<code class="fe nu nv nw nx b">AndroidManifest.xml</code>中明确设置了<code class="fe nu nv nw nx b">INTERNET</code>访问的权限。</p><p id="23a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们创建了一个简单的singleton <code class="fe nu nv nw nx b">SendEmailService</code>类。在类内部，我们声明了一些导入语句并初始化了一些有用的变量。</p><p id="6b7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们深入探讨了如何创建MIME电子邮件。我们还尝试在<code class="fe nu nv nw nx b">AsyncTask</code>或<code class="fe nu nv nw nx b">ExecutorService</code>里发送一封简单的文本邮件。</p><p id="a679" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">后来，我们将图像和文本附件作为<code class="fe nu nv nw nx b">MimeMultipart</code>对象的一部分添加到电子邮件中。</p><p id="c6a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读这篇文章。希望在下一篇文章中再见到你！</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="7073" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">参考</h1><ol class=""><li id="bcbe" class="mc md it lb b lc np lf nq li pd lm pe lq pf lu mh mi mj mk bi translated"><a class="ae ky" href="https://www.tutorialspoint.com/java/java_sending_email.htm" rel="noopener ugc nofollow" target="_blank">用Java发送电子邮件</a></li><li id="3af3" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated"><a class="ae ky" href="https://www.tutorialspoint.com/javamail_api/javamail_api_send_inlineimage_in_email.htm" rel="noopener ugc nofollow" target="_blank">用Java发送图像附件邮件</a></li><li id="bc73" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated"><a class="ae ky" href="https://code.google.com/archive/p/javamail-android/" rel="noopener ugc nofollow" target="_blank"> JavaMail存档</a></li><li id="fd0e" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated"><a class="ae ky" href="https://code.google.com/archive/p/javamail-android/downloads" rel="noopener ugc nofollow" target="_blank"> JavaMail下载</a></li><li id="f39f" class="mc md it lb b lc ml lf mm li mn lm mo lq mp lu mh mi mj mk bi translated"><a class="ae ky" href="https://www.oracle.com/technetwork/java/javamail/index.html" rel="noopener ugc nofollow" target="_blank"> JavaMail甲骨文</a></li></ol></div></div>    
</body>
</html>