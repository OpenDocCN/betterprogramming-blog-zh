<html>
<head>
<title>From HTTP to HTTPS — Easily Secure Flask Web Apps With Talisman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从HTTP到HTTPS —使用Talisman轻松保护Flask Web应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/from-http-to-https-easily-secure-flask-web-apps-with-talisman-3359692d3eac?source=collection_archive---------3-----------------------#2021-11-24">https://betterprogramming.pub/from-http-to-https-easily-secure-flask-web-apps-with-talisman-3359692d3eac?source=collection_archive---------3-----------------------#2021-11-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bac2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用Python的Talisman库建立HTTPS协议以增强web应用程序的安全性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/daaf3c516abdcba89d12c5e3544143f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2vH6j5AUQiQgwqnUBGGAiw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">乔恩·摩尔在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2955" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在像<a class="ae ky" href="https://devcenter.heroku.com/articles/ssl" rel="noopener ugc nofollow" target="_blank"> Heroku </a>这样的云解决方案上将你的Python项目(例如ML模型、网站)部署为Flask web应用之后，你可能会注意到它加载了一个不安全的HTTP连接，尽管已经配置了<a class="ae ky" href="https://ahrefs.com/blog/what-is-https/#how-tls-works" rel="noopener ugc nofollow" target="_blank"> SSL/TSL </a>证书。</p><p id="1f83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种不安全的请求会带来安全隐患，因为恶意行为者很容易破坏客户端和服务器之间的通信。</p><p id="42a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文探讨了如何使用Talisman库将所有传入的应用程序请求重定向到HTTPS，而不是HTTP。</p><h2 id="30c2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><em class="mo">目录</em></h2><blockquote class="mp mq mr"><p id="73da" class="kz la ms lb b lc ld ju le lf lg jx lh mt lj lk ll mu ln lo lp mv lr ls lt lu im bi translated"><em class="it"> (1) </em> <a class="ae ky" href="#11d2" rel="noopener ugc nofollow"> <em class="it">关于HTTPS</em></a><em class="it"><br/>(2)</em><a class="ae ky" href="#d364" rel="noopener ugc nofollow"><em class="it">什么是护身符？</em></a><em class="it"><br/>(3)</em><a class="ae ky" href="#4cb5" rel="noopener ugc nofollow"><em class="it">基本用法</em></a><em class="it"><br/>(4)</em><a class="ae ky" href="#aebc" rel="noopener ugc nofollow"><em class="it">高级选项</em> </a></p></blockquote></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="11d2" class="nd lw it bd lx ne nf ng ma nh ni nj md jz nk ka mg kc nl kd mj kf nm kg mm nn bi translated">关于HTTPS</h1><p id="a647" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">HTTPS(安全超文本传输协议)是HTTP协议的安全版本，因为它通过<a class="ae ky" href="https://www.ssl.com/faqs/faq-what-is-ssl/" rel="noopener ugc nofollow" target="_blank"> SSL/TLS协议</a>添加了一个额外的加密、认证和完整性层。</p><p id="c188" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">HTTPS使信用卡号和登录凭证等敏感数据在互联网上安全传输成为可能。因此，HTTPS正迅速成为所有网站的标准协议，无论它们是否涉及敏感数据的交换。</p><p id="3cb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，谷歌Chrome已经开始将非HTTPS网站标记为不安全，而苹果要求iOS应用程序的API通信使用HTTPS。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="d364" class="nd lw it bd lx ne nf ng ma nh ni nj md jz nk ka mg kc nl kd mj kf nm kg mm nn bi translated">什么是护身符？</h1><p id="5bfb" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated"><a class="ae ky" href="https://github.com/GoogleCloudPlatform/flask-talisman" rel="noopener ugc nofollow" target="_blank"> Talisman </a>是一个Python Flask扩展，它配置Flask web应用程序，使其免受常见web安全问题的影响。</p><p id="fa89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Talisman由<a class="ae ky" href="https://github.com/GoogleCloudPlatform/community" rel="noopener ugc nofollow" target="_blank"> Google云平台社区</a>开发，它通过在web应用程序中启用和设置HTTP安全头来规定HTTP通信的安全相关细节。</p><p id="4884" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">HTTP安全头通过在web应用程序运行时限制浏览器和服务器内的行为来提供额外的安全性。</p><p id="35f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Talisman的一个关键特性是强制所有web应用程序连接到HTTPS，这将是本文的重点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/ea7aadd2b32166585d2bd32f5a9c3a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MmLpsUd-9ZGsWz4x"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@franckinjapan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">弗兰克</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="4cb5" class="nd lw it bd lx ne nf ng ma nh ni nj md jz nk ka mg kc nl kd mj kf nm kg mm nn bi translated">基本用法</h1><p id="f179" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">我们首先用下面的命令安装Talisman(<em class="ms">flask-Talisman</em>):</p><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="2f60" class="lv lw it nv b gy nz oa l ob oc">pip install flask-talisman</span></pre><p id="b4de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦完成，我们导入库，并在我们的主Python脚本中用Talisman包装我们的Flask应用程序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="edb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只用一行代码，我们就成功地为Flask web应用程序实现了Talisman的安全优势。</p><p id="21d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是关于护身符包装纸的一些重要注意事项:</p><ul class=""><li id="d4d6" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu ok ol om on bi translated">参数<code class="fe oo op oq nv b">force_https</code>的默认值为<em class="ms">真</em>，这意味着所有请求(与调试无关的)将被自动定向到HTTPS。因此，没有必要显式设置参数。</li><li id="0f83" class="of og it lb b lc or lf os li ot lm ou lq ov lu ok ol om on bi translated">您可能会注意到，在示例中，参数<code class="fe oo op oq nv b">content_security_policy</code>被设置为<em class="ms"> None </em>。原因是当内容安全策略保留为默认值时，许多用户遇到了问题(例如，HTTPS重定向失败)。这个策略是高级Talisman选项的一部分，我们将在下面探讨。</li></ul></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="aebc" class="nd lw it bd lx ne nf ng ma nh ni nj md jz nk ka mg kc nl kd mj kf nm kg mm nn bi translated">高级选项</h1><p id="1b5b" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">内容安全策略(CSP)是高级Talisman选项的一部分，可将您的web应用程序的安全性提升到一个新的水平。</p><p id="cbd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认的CSP选项非常严格，会阻止加载与应用程序不在同一个域中的任何资源。因此，大多数网络应用程序需要改变这个策略，这也是我们在上面的例子中设置<code class="fe oo op oq nv b">content_security_policy=None</code>的原因。</p><p id="abe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CSP允许您定义web应用程序上明确允许的特定资源类型(例如，图像、视频、代码、网站等。).</p><p id="3af6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们有以下需求:</p><ol class=""><li id="326c" class="of og it lb b lc ld lf lg li oh lm oi lq oj lu ow ol om on bi translated">允许从任何地方加载图像</li><li id="1857" class="of og it lb b lc or lf os li ot lm ou lq ov lu ow ol om on bi translated">将音频或视频媒体仅限于两个受信任的提供商(<code class="fe oo op oq nv b">kenneth.com</code>和<code class="fe oo op oq nv b">leung.com</code>)</li><li id="9bbc" class="of og it lb b lc or lf os li ot lm ou lq ov lu ow ol om on bi translated">仅允许来自托管可信代码的特定服务器的可执行脚本(<code class="fe oo op oq nv b">userscripts.trusted.com</code>)</li></ol><p id="d570" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是将上述内容转换为Talisman设置的Python代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="13f7" class="nd lw it bd lx ne nf ng ma nh ni nj md jz nk ka mg kc nl kd mj kf nm kg mm nn bi translated">包装它</h1><p id="e651" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">我们已经看到如何利用Talisman来实现重要Flask web应用程序安全性的适当HTTP头。</p><p id="ddc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了简单的主要用途(对于许多用例和POC项目来说已经足够了)，Talisman还提供了高级的粒度设置来满足不同级别的安全需求。</p><p id="e22e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更多信息和细节，请查看Talisman <a class="ae ky" href="https://github.com/GoogleCloudPlatform/flask-talisman" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>和<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" rel="noopener ugc nofollow" target="_blank"> Mozilla内容安全政策页面</a>。</p><p id="1646" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同时，享受为Flask web应用程序实现Talisman的乐趣！</p><p id="e549" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ms">免责声明:web应用程序安全没有灵丹妙药。Talisman可以提供帮助，但是安全性不仅仅是设置几个标题。任何面向公众的web应用程序都应该有一个全面的安全方法。</em></p><h1 id="e46e" class="nd lw it bd lx ne ox ng ma nh oy nj md jz oz ka mg kc pa kd mj kf pb kg mm nn bi translated">资源</h1><ul class=""><li id="2136" class="of og it lb b lc no lf np li pc lm pd lq pe lu ok ol om on bi translated"><a class="ae ky" href="https://www.ssl.com/faqs/what-is-https/" rel="noopener ugc nofollow" target="_blank"> SSL —什么是HTTPS </a></li><li id="6497" class="of og it lb b lc or lf os li ot lm ou lq ov lu ok ol om on bi translated"><a class="ae ky" href="https://github.com/GoogleCloudPlatform/flask-talisman" rel="noopener ugc nofollow" target="_blank">烧瓶-talisman GitHub </a></li><li id="af6e" class="of og it lb b lc or lf os li ot lm ou lq ov lu ok ol om on bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" rel="noopener ugc nofollow" target="_blank"> Mozilla —内容安全政策</a></li></ul><pre class="kj kk kl km gt nu nv nw nx aw ny bi"><span id="c815" class="lv lw it nv b gy nz oa l ob oc"><strong class="nv iu">Want to Connect With the Author?</strong></span><span id="782f" class="lv lw it nv b gy pf oa l ob oc">Check out my <a class="ae ky" href="https://github.com/kennethleungty" rel="noopener ugc nofollow" target="_blank">GitHub</a> to stay in the loop of more exciting tech and data science-related content.</span></pre></div></div>    
</body>
</html>