# iOS 上的单元测试 SDK

> 原文：<https://betterprogramming.pub/unit-test-static-and-singleton-frameworks-on-ios-df4e7d77a7b8>

## 让单一和静态框架在 iOS 上可测试的技巧

![](img/9ae18414593870751577e44e0b193d55.png)

图片来自 [**Unsplash**](https://unsplash.com/photos/0WzeC6JtbHU)

如果你还不是单元测试大师，看看我的前一篇文章中关于 iOS 单元测试的提示。

在开发时，我们应该考虑如何使我们的代码可测试。对第三方框架进行单元测试可能会很困难，如果它们是静态的就更困难了，因为它们不容易被注入和模仿。本文将介绍一些可以用来避免不测试 SDK 的技术。

# 在开始测试之前👀

在我们深入探讨技巧之前，请记住始终将框架与项目模块和类隔离开来，无论是通过创建包装器、 [facade](https://www.raywenderlich.com/books/design-patterns-by-tutorials/v3.0/chapters/17-facade-pattern) 、 [adapters、](https://refactoring.guru/pt-br/design-patterns/adapter)还是其他方式。我们项目的架构和用例不应该依赖于外部框架，因为它们总是在变化。因此，请记住将它们隔离在一个单独的类中，该类可以很容易地更改，而不会影响实现它的类。

# 静态方法

最常见的不友好框架。

## 问题

我们通常会看到这样的实现:

我们用[隐姓埋名的 DK](https://www.incognia.com/pt/) 作为例子。

这种实现限制了我们模仿，因为我们不能简单地继承期望的类并覆盖它的静态方法，仅仅因为它们是静态的。

## 解决办法

幸运的是，我们可以使用 Swift 的[协议](https://docs.swift.org/swift-book/LanguageGuide/Protocols.html)和[元类型](https://docs.swift.org/swift-book/ReferenceManual/Types.html#grammar_metatype-type)类型。根据苹果的文档:

> *元类型类型*是指任何类型的类型，包括类类型、结构类型、枚举类型和协议类型。

这意味着我们可以声明一个变量来引用协议的元类型。

1.  首先，您应该创建一个包含与框架类相同的方法的协议。在我们的例子中，我们只需要实现`initSdk()`方法。

**2。**使用**扩展**使你的框架的类符合创建的协议。应该不会出现错误，因为我们已经用相同的关键字创建了完全相同的方法。

3.现在，您应该使用 Swift 的元类型*将协议注入到您的类中。*

`Type`关键字和使用`.self`的框架的类。

**3.1** 。另一种实现是使用具体框架的类初始化器，并使用`type(of:)` 来访问它的方法。该实现应该与上述技术产生相同的结果，但是以不同的方式编写。

4.要测试它，只需创建一个符合创建的协议的测试 double。测试时应该注入这个模拟的类，而不是原来的类。

# 一个

Singleton(反)模式的主要思想是在应用程序中只运行一个对象实例，并且存在一个全局访问点。小心使用它们，因为它们违反了单一责任原则。

## 问题

下面的类是一个普通网络类的简单实现。

这样的实现使得代码不可测试。

## 解决办法

为了使这段代码能够被测试，实现我们的网络服务的类需要**请求一个依赖项**，而不是自己定义一个，所以我们将注入一个。

您可以选择使用协议、继承或闭包来继续。

1.如果选择继承，只需使用类类型声明一个变量。如果属性是公共的，可以进行属性注入。这里，我们使用构造函数注入。记住`NetworkingService`类不要设置为`final`。

因为这些方法不是静态的，所以您可以在模拟的类中覆盖它们。

2.如果您决定使用协议，或者您的项目要求您只创建`final`类，那么实现应该与我们使用静态框架时非常相似。只需创建一个协议，使用与符合它的类完全相同的方法。

要测试它，只需创建一个符合创建的协议的 spy:

3.如果你的类允许公共属性，用闭包测试也是一种技术。

要测试它，只需调用`requestProperty`属性，完成应该是用于测试目的的“假”完成。

*瞧！*

# 结论

就是这样！单元测试您的应用程序保证了代码质量，并有助于避免未来的错误。所以，永远记住:

*   尽可能保持框架的类与其他类的分离。框架变化很大；
*   DI(依赖注入)使类要求依赖，这意味着你可以注入被模仿的类，例如；
*   静态方法不能被重写；

# 参考

*   [注入和嘲讽静态框架](https://medium.com/openclassrooms-product-design-and-engineering/injecting-and-mocking-static-frameworks-in-swift-b4fc410ab3ae)