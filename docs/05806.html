<html>
<head>
<title>How to Use Google Spreadsheet as a Backend for Your App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用谷歌电子表格作为应用程序的后端</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/google-spreadsheet-as-a-backend-b6b51541f1e1?source=collection_archive---------2-----------------------#2020-08-07">https://betterprogramming.pub/google-spreadsheet-as-a-backend-b6b51541f1e1?source=collection_archive---------2-----------------------#2020-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c79e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有时电子表格可以作为轻量级数据库。以下是如何做的</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a1c56f8b371f7e12aded8b7d37ecb3d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PXnIDqF8K-xINssi"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">卢卡斯·布拉塞克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="8e69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有一个简单的应用程序，你不需要非常复杂的后端，你可以使用谷歌电子表格来存储你的数据。我们后端的数据库是什么？是表格，谷歌电子表格也是表格。让我们看看如何将这些表用作应用程序的后端。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/f02ad56aea25ffffc7daafb72a5eafaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*s1IcD_CA70GxEzZO0UEZ5Q.png"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="faeb" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak">初始化</strong></h1><p id="5c26" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">让我们开始设置Google API凭证，因为我们将需要它们在前端和后端之间传输数据。</p><p id="f2eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，我们将需要一个谷歌开发人员帐户。你可以去<a class="ae ky" href="http://console.developers.google.com" rel="noopener ugc nofollow" target="_blank">这里</a>创建一个，它是免费的。</p><p id="5b6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们创建一个新项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/543e5e8724ec3661d3c2599142d590ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MW7Huc5PKSVStCpDljYcOQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/9b32d9923c191245f72b114c1e654482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*kngCYcxrv_cf1-NPXX2PeQ.png"/></div></figure><p id="f35c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们创建一个新项目之后，让我们为这个项目生成凭证——访问Google服务所需的API密钥。如果您只想读取表，您可以只生成API键，这就足够了。但是我们想要执行所有的CRUD，为此我们需要一个服务帐户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/c9d57621de699f399782ac91d9280dd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hW0PA_Xh-S4SgBP35bqwYw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/b45e167408c7b77f00a495e808b42bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*9DobHofVdIM-If9RYlu13Q.png"/></div></figure><p id="4b63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需给新的服务帐户一个名称，并跳过角色和用户对此帐户的访问。现在我们有了一个服务帐户。让我们打开它并为它生成一个密钥。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/13bd50aa777fb4cbc0ed0ed72aada31e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zZ7ngCpXcSDbzeOqBp-2iA.png"/></div></div></figure><p id="9481" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择json:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/417e88dcdf0681c4b332fee365a3c141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*t0YymyiqonxBGwcJ8jxIkQ.png"/></div></figure><p id="ccbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“create”后，它将下载一个. json文件，文件名很长，包含我们需要的所有凭证。</p><p id="f919" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们创建一个我们将要使用的电子表格。只需打开这个<a class="ae ky" href="https://docs.google.com/spreadsheets/u/0/" rel="noopener ugc nofollow" target="_blank">链接</a>并创建一个电子表格。在URL中，您可以找到电子表格ID:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/9df1bfd3064cf02fc02960c5e6ca0cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UUuRttdSikSdiISZLIuVeA.png"/></div></div></figure><p id="899b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将需要这个ID来访问特定的电子表格。</p><p id="5975" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要做的最后一件事是配置共享选项。点击绿色大按钮SHARE，让每个有链接的人都可以编辑这个电子表格。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="1d55" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak">前端设置</strong></h1><p id="5f12" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">当我们的证书准备好了，让我们在前端工作。第一步是创建一个简单的React.js项目。请阅读此处的<a class="ae ky" href="https://medium.com/swlh/full-stack-app-with-react-and-node-express-b62e45aa33c7" rel="noopener">以了解如何操作。</a></p><p id="6ab7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更容易与Google API通信，我们将使用<a class="ae ky" href="https://www.npmjs.com/package/google-spreadsheet" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Google-spread sheet</strong></a>库。让我们安装它:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="12b7" class="nm me it ni b gy nn no l np nq">yarn add google-spreadsheet</span><span id="f7b4" class="nm me it ni b gy nr no l np nq">Or</span><span id="1b9a" class="nm me it ni b gy nr no l np nq">npm i google-spreadsheet — save</span></pre><p id="2816" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们准备开始编码。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="672c" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak">前端设计</strong></h1><p id="f181" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">首先，我们需要确保我们可以安全地使用API密钥。为此，让我们创建一个<strong class="lb iu">。env </strong>文件放在react项目的根目录下。打开文件并创建三个变量；我们将把它们作为环境变量:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="29f3" class="nm me it ni b gy nn no l np nq">REACT_APP_SHEET_ID = ‘’</span><span id="66ab" class="nm me it ni b gy nr no l np nq">REACT_APP_GOOGLE_PRIVATE_KEY = ‘’</span><span id="b8cd" class="nm me it ni b gy nr no l np nq">REACT_APP_GOOGLE_SERVICE_ACCOUNT_EMAIL = ‘’</span></pre><p id="f34b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经在某个地方保存了电子表格ID，对吗？如果是这样，将这个ID分配给REACT_APP_SHEET_ID变量。接下来，让我们用API密匙打开<strong class="lb iu"> longname.json </strong>文件，将private_key赋给REACT_APP_GOOGLE_PRIVATE_KEY，将client_email赋给REACT _ APP _ GOOGLE _ SERVICE _ ACCOUNT _ EMAIL。</p><p id="00f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很好，现在我们可以转到React代码，描述应该如何发送对Google API的请求。</p><p id="cb8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，我们有一个空的应用程序组件。让我们导入<strong class="lb iu">谷歌电子表格</strong>库。我们还需要一个<strong class="lb iu"> useState </strong>钩子，因为我们使用功能组件，我们需要在这里管理状态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/60fc2c82cdac64563dd9b98d10b7e0eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*nXN8yTQHOVhF0bOCCiXIDA.png"/></div></figure><p id="f2a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是在输入数据被发送到后端之前存储输入数据的变量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/694474946db01ae46e5df7beecd33617.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*25qWqle27ETQdcQjmKxXHQ.png"/></div></figure><p id="8f06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是将显示给用户的JSX表单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/164f4b0ff726a73f103df13acb0b27ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G-garRW1l2SaqlWJ4bVaWg.png"/></div></div></figure><p id="8951" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们创建一个向后端发送请求的函数。看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/bcc5f0421b01e4f7447ae2d017e7f9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4fwT9uya1aDTAu3UwXT61w.png"/></div></div></figure><p id="2f29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来分解一下。</p><p id="65aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要从. env中获取一个电子表格ID。我们可以用<strong class="lb iu"> process.env、</strong>来完成，这是在启动应用程序时由Node.js注入的。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="039f" class="nm me it ni b gy nn no l np nq"><em class="nw">const SHEET_ID = process.env.REACT_APP_SHEET_ID;</em></span></pre><p id="fdd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们创建一个新的GoogleSpreadsheet实例，并将工作表ID传递给它。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="b62e" class="nm me it ni b gy nn no l np nq">const doc = new GoogleSpreadsheet(SHEET_ID);</span></pre><p id="bc01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要授权给自己。我们将使用useServiceAccountAuth方法来进行授权。这个方法将接受一个对象作为参数(或者它可以接受一个带有凭证的json文件，但是这种方式更安全)。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="e16c" class="nm me it ni b gy nn no l np nq">private_key: process.env.REACT_APP_GOOGLE_PRIVATE_KEY.replace(/\\n/gm, “\n”),</span></pre><p id="c382" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">私钥是一个很长的多行字符串。为了使它工作，我们需要用新行替换所有的“\n”字符。<strong class="lb iu">替换(/\\n/gm，" \n") </strong>就行了。</p><p id="5c42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">万岁，我们授权了！现在让我们加载关于我们正在连接的电子表格的数据。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="a0a9" class="nm me it ni b gy nn no l np nq">await doc.loadInfo()</span></pre><p id="06f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们应该选择要使用的工作表。我们可以通过索引或id来实现。最初，我们只有一张表，所以我只选择索引0。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="2736" class="nm me it ni b gy nn no l np nq">const sheet = doc.sheetsByIndex[0]</span></pre><p id="8304" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们用这张纸做点什么。增加新的一行怎么样？我们可以做到。假设电子表格中有<strong class="lb iu">姓名</strong>、<strong class="lb iu">电子邮件、</strong>和<strong class="lb iu">文本、</strong>等列，我们可以这样做:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="a554" class="nm me it ni b gy nn no l np nq">await sheet.addRow({ Name: name, Email: email, Text: text });</span></pre><p id="ed04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切都正确，那么当您单击complete按钮时，您在字段中键入的任何内容都应该出现在电子表格中。</p><h2 id="bbce" class="nm me it bd mf nx ny dn mj nz oa dp mn li ob oc mp lm od oe mr lq of og mt oh bi translated">最终代码:</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="cf0e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated"><strong class="ak">结论</strong></h1><p id="5724" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">对于不需要复杂后端的简单应用程序，我们可以使用简单的免费工具。谷歌电子表格就是其中之一。在我的例子中，我只发送post请求，但是您可以在那里存储数据并发送GET请求来在DOM上呈现某些内容。</p><p id="0b5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不断学习，不断成长！</p></div></div>    
</body>
</html>