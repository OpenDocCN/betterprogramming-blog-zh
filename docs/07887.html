<html>
<head>
<title>Do Pair Trading With 16 Lines of Python Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用16行Python代码做配对交易</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/do-pair-trading-with-16-lines-of-python-code-d1b0fed9ad22?source=collection_archive---------5-----------------------#2021-03-02">https://betterprogramming.pub/do-pair-trading-with-16-lines-of-python-code-d1b0fed9ad22?source=collection_archive---------5-----------------------#2021-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b344" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">获取相似的股票进行配对交易</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/396aa62bdf7492e8e58dd7aa668967a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d2xgUdYP2cUANsNN"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@jamie452?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰米街</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure><p id="cc0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>是一种优秀的编程语言，因为它对程序员友好的行为和合理的学习曲线，所以非常方便。我们可以在Python中找到大量可以用来快速完成任务的库和快捷方式。</p><p id="cb7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>是使用最多的处理数据的Python模块之一。当我们谈论数据时，<a class="ae ky" href="https://en.wikipedia.org/wiki/Time_series" rel="noopener ugc nofollow" target="_blank">时间序列数据</a>总能抓住我们的注意力。我们喜欢玩时间序列数据来寻找不同的模式、趋势和预测未来。</p><p id="4d51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将介绍我们如何利用pandas和其他Python特性来找到最相似的部分。交易者可以考虑这些套对股票进行<a class="ae ky" href="https://zerodha.com/varsity/chapter/pair-trading-basics/" rel="noopener ugc nofollow" target="_blank">对交易</a>。</p><p id="ce38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">注意:本文仅用于教育目的，不包含财务建议。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="94af" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">熟悉数据</h1><p id="5691" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们将使用的数据是开源的。许多数据源如Quandl和Yahoo Finance也可以通过他们的API向我们提供实时的股票市场数据。其中一些提供免费的有限API调用，我们可以用来练习。</p><p id="889d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们导入一些库来加载我们的数据，并进行进一步的分析和可视化:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="0fa1" class="nf me it nb b gy ng nh l ni nj">import pandas as pd<br/>import datetime as dt</span><span id="6909" class="nf me it nb b gy nk nh l ni nj">import seaborn as sns<br/>from matplotlib import pyplot as plt<br/>plt.style.use('ggplot')<br/>%matplotlib inline</span></pre><p id="8959" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pandas用于加载和分析数据。<a class="ae ky" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Seaborn </a>和<a class="ae ky" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> matplotlib </a>用于绘制可视化效果。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="10a2" class="nf me it nb b gy ng nh l ni nj">df=pd.read_csv("cs-1.csv")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/da3f5953b6be7890c46734206afb9cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*eztxROqsGiD9RhCze2wPHg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可用数据集</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="5084" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">数据分析</h1><p id="2e16" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们将使用年度数据。让我们在日期字段中管理年份列:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="7868" class="nf me it nb b gy ng nh l ni nj">df['date'] = pd.to_datetime(df['date'])<br/>df['year'] =df['date'].dt.year</span></pre><p id="fdd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要比较两只股票，应该遵循相同的数据日期范围。我发现有些股票的日期范围较小:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/d6eb87d3eaf3689b1a0d6fff484cea1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*3d01COF4iAja6xNpNn76Rg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">数据分析</p></figure><p id="6ce9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们移除这些库存，继续进一步加工:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="d057" class="nf me it nb b gy ng nh l ni nj"><strong class="nb iu">count_df=pd.DataFrame(df.Name.value_counts()[:470], columns=["Name", "Count"]).reset_index()</strong></span><span id="c4ca" class="nf me it nb b gy nk nh l ni nj">list_valid_shares=list(count_df["index"])<br/><strong class="nb iu">final_df=df[df.Name.isin(list_valid_shares)]</strong></span></pre><p id="ba37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们来看看我们的数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/d1308ca2a29d380f14e1865a50190d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*VovMfbgniocu-eVi70_qig.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于进一步处理的数据</p></figure><p id="eef9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有2013-2019年的数据。我们的目标是找到任何特定年份最相似的股票。我们将采用2018年的数据:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="d166" class="nf me it nb b gy ng nh l ni nj">data_by_year=final_df.groupby("year")<br/>data_2018=data_by_year.get_group(2018)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/2d5c8d41060b94679c265724daf1147e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*R4isRGetFI5LoYn30Za0vg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2018年的数据</p></figure><p id="27b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于任何时间序列数据，我们都需要日期作为索引。让我们将日期列作为索引，并使我们的数据成为比较不同股票的枢纽:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="16ea" class="nf me it nb b gy ng nh l ni nj">pivot_df=data_2018.pivot(index="date",columns="Name", values="close")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/c0cf02df5a3d1b42a571fc4d4a905fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4xycQChy4AtGI7nY-Oxm8w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">2018年的枢纽数据</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="bc44" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">寻找相似之处</h1><p id="dacc" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">为了找到相似之处，我们将使用熊猫的<code class="fe nq nr ns nb b">corr</code>方法:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="af8a" class="nf me it nb b gy ng nh l ni nj">corr_mat=pivot_df.corr(method ='pearson').apply(lambda x : x.abs())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/fc358ebb7b6a7397628180eec986aa84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gh3N2vl4YJOQqEVZvkb63g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">相关矩阵</p></figure><p id="193b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将利用<code class="fe nq nr ns nb b">unstack</code>方法，它可以给我们一个更好的股票之间的关系。此外，我们可以对结果进行排序，以获得关系的最终图像。</p><p id="dbfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们可以选择前十个配对，得出股票之间的前五个关系，以便进行配对交易:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="98ba" class="nf me it nb b gy ng nh l ni nj">sorted_corr = corr_mat.unstack().sort_values(kind="quicksort", ascending=False)</span><span id="124e" class="nf me it nb b gy nk nh l ni nj">sc=pd.DataFrame(sorted_corr, columns=["Value"])[470:480]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/8ac049ba4681782726665969ef06f278.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*-mFUAqvqnC3ANXLB5KrUJg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">排序相关DF</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/842ceb4d2b2120f511b0bfbd8481e1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*wAzO63ci4GpBpo8SSuJSFA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">配对交易的最终前五组</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6d9b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">可视化结果</h1><p id="16be" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们现在将利用<code class="fe nq nr ns nb b">matplotlib</code>模块来可视化最终输出，以进一步澄清我们的结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/92ed8b63032edad926f25955a30e1762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ee44N0bGlmsgQkyYXlKCQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/a9696b1afd8186173749d39c6158e9f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6hp9VBUgvwauXYOKsCkBw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/724a4d49f8a17b4a3cbf2d10966ac1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QbUORBwUDos9W4LuI8NfaA.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a3c3" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="e233" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">本文到此为止。我们讨论了如何利用Python来寻找系列/股票之间的相似性。我希望你喜欢它。敬请关注更多文章。</p><p id="d6cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>