# 如何使用 RouteGenerator 处理 Flutter 中的页面路由

> 原文：<https://betterprogramming.pub/how-to-handle-page-routing-in-flutter-using-the-routegenerator-ccce288e751c>

## 在你的 Flutter 应用中构建下一级导航

![](img/a690085c33d0c8a865e8dcd5caab26da.png)

由 [Sebastian Hietsch](https://unsplash.com/@s_hietsch?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片。

当涉及到多个页面之间的导航时，你无法绕过这种颤动`Navigator`。然而，当一遍又一遍地调用相同的页面时，重复的代码会非常烦人。

为什么不把页面路由移到一个单独的类中，让路由变得更加简单呢？

# 基础知识

例如，为了通过点击按钮跳转到另一个页面，我们使用了 Flutter `Navigator`:

`Navigator.of(context)`使用当前`BuildContext`的`Navigator`实例。然后使用`push`功能在当前页面上放置一个新页面。在这里，创建了一个新的`MaterialPageRoute`,它在其构建函数中引用了新页面。

`Navigator.of(context)`上的可选功能有:

*   `.pop()`返回上一页。
*   `.popUntil((route) => condition)`导航回上一页，直到所需站点出现。
*   `.pushReplacement(newRoute)`用当前页面替换页面。
*   `.popAndPushNamed(routeName)`与前一个类似，但在此之前，页面导航是用一个字符串唯一标识的。
*   `.pushNamed(routeName)`与前一个类似，但是没有用它替换当前页面。

现在假设您不仅想调用一个新页面，还想向它传递值，或者在错误导航的情况下转移到一个错误页面(404)。代码变得混乱，很难很快读懂！

要解决这个问题，生成一个类来处理动态路由。

# 页面路由是如何工作的？

为了通过单独的类实现路由，必须做三件事。

## 1.创建 RouteGenerator 类

这个类包含一个静态函数，它被传递给一个`RouteSettings`对象并返回一个动态路由。传递的对象的`name`属性用于定位要导航的页面并返回相应的对象。

## 2.在主类中分配 RouteGenerator

为此，必须设置`onGenerateRoute`和`initialRoute`属性:

## 3.执行导航

现在，可以使用与开始时类似的简化调用来调用新页面。在这种情况下，只需传递新页面的字符串标识符:

这就是从页面路由开始的全部工作！

# 如何传递信息

直奔主题。下一步传递信息并不难，但是很容易导致错误。因此，做好错误处理尤为重要。

但是为了传递信息，首先必须遵循这些步骤。

## 1.传递参数

为了在调用`Navigator`对象时传递参数，必须用任何类型的数据填充`arguments`参数:

这些可以是原始数据类型，如整数或字符串，也可以是复杂对象。如果要传递几个单项的数据，建议放在一个列表里。

## 2.流程参数

在之前创建的`RouteGenerator`类中，传递的参数现在可以被提取并传递给新页面。这可以通过以下方式完成:

## 3.防止运行时错误

为了避免运行时错误，检查输入的参数是否有效很重要。例如，这可以通过检查类型来实现。例如，如果只允许传递整数值，可以如下所示:

如果传递的参数无效，则将`null`传递给导航器，新页面不会出现。这比错误消息要好，但对用户没有太大帮助。如果您想知道如何创建错误页面，请查看以下部分。

# 如何处理错误

为了在应用内导航时捕捉错误，我们添加了错误查询。现在，将用户重定向到错误页面只需要几个简单的步骤。

## 1.创建错误页面

要显示错误页面，我们需要创建一个错误页面。这可以在一个单独的类中完成，也可以直接在我们之前创建的`RouteGenerator`类中完成。如果错误页面很简单，我推荐最后一个选项。

对于错误页面，我们现在创建一个内部私有函数(`_errorRoute`)，它返回一个对象(`Route<dynamic>`)。在返回的页面上，我们构造了一个 scaffold 对象来设置我们的错误消息。这可能如下所示:

## 2.链接到错误页面

现在，为了在每个错误情况下重定向到页面，我们只需要在每个错误时返回`_errorRoute()`函数。因此，我们之前创建的`switch-case`块将扩展如下:

## 3.个性化错误页面

当然，也可以在错误页面上为用户提供更多信息。例如，您可以通过尝试传递错误的原因来使错误更加具体。这可能如下所示:

并且:

请记住将传递的错误指定为可选的，如示例中所示，这样在导航到错误页面时就不会出现错误。这有多讽刺？

# 如何弹出页面并传回数据

在浏览应用程序或网站时，您通常还想往回导航。这可能发生在三种不同的情况下:

1.  通过使用智能手机上的原生后退按钮。
2.  通过使用应用程序栏中的后退按钮。
3.  通过使用`Navigator.pop(context);`将此功能赋予按钮。

## 1.WillPopScope

在 Flutter 中，几乎每个应用程序都有一个小部件。对于条件 1 和 2，可以用`WillPopScope`小部件拦截和处理相应的`onWillPop`事件。这可能如下所示:

用顶部的`WillPopScope`小部件扩展了`_SecondPageState`的构建方法。使用`onWillPop`属性将在用户想要返回上一页时产生想要的结果。注意`onWillPop`中的方法是异步调用的。

## 2.pop 上下文

作为`WillPopScope`小部件的替代，也可以通过编程切换到上一页。这通常是通过点击按钮来完成的。下面给出一个例子:

`onPressed`函数处理按钮点击。在调用`Navigator.of(context).pop();`之前，可选任务也可以做。

## 3.砰的一声然后

在上面的两个例子中，在返回之前，您只能执行第二页中的任务。下面，我想向您展示一种在向后导航后执行上一个类中的操作的方法。

如果您执行基础中介绍的某个函数，比如`.pushNamed()`，那么`.then()`函数可以在此运算符上执行。在此功能中，可以执行仅在再次向前和向后导航后执行的操作。一个具体的例子如下所示:

## 4.传回数据

您可能想知道前面例子中的`value`变量传递的是什么。这非常简单:当然，您可以将第二页的数据传递回前一页。这可以通过在调用`.pop()`函数时传递除`context`之外的另一个对象来实现。该对象可以作为函数调用`.pushNamed()`(或类似函数)的返回值来实现，也可以通过`.then()`函数作为传递变量来实现。

这个例子看起来像这样。向前导航时，在首页上:

向后导航时在第二页上:

# 结束语

我希望这篇文章向您展示了如何在 Flutter 中平稳有效地导航。感谢您的阅读，并期待您对内容的反馈、对新内容的建议以及其他有趣的对话。

你有哪些颤振和导航的经验？