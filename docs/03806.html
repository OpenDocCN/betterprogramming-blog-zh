<html>
<head>
<title>Error Handling in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的错误处理</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/error-handing-in-swift-dda6e3fb1c65?source=collection_archive---------9-----------------------#2020-03-05">https://betterprogramming.pub/error-handing-in-swift-dda6e3fb1c65?source=collection_archive---------9-----------------------#2020-03-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ae2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">试试？或者试试！或者试试</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e83c6863fd76c27eb9bad81103674d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PSah4ScPzRiKD5Xq"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@woodies11?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">罗姆森·普里查维特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄。</p></figure><p id="7de0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，导游试图通过网络来教授错误处理。然而，本指南将从基础开始探索错误处理。</p><p id="47b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">难度:初级|简单<strong class="lb iu"> </strong> | <strong class="lb iu">普通</strong> |挑战</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9dda" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先决条件</h1><ul class=""><li id="4269" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">了解一些Swift中的解包知识会很有用(参见<a class="ae ky" href="https://medium.com/@stevenpcurtis.sc/avoiding-force-unwrapping-in-swift-6dae252e970e" rel="noopener">本指南</a>)。</li><li id="9cbd" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">可选的链接知识将是有用的(见本指南<a class="ae ky" href="https://medium.com/@stevenpcurtis.sc/b7d2a7e18b86" rel="noopener"/>)。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3810" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">术语</h1><ul class=""><li id="e2a9" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">block:Swift中描述闭包的一种方式(特别是有Objective-C背景的人使用的)。</li><li id="d976" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">错误:程序产生错误结果而导致的问题。</li><li id="cb41" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">可选方案:Swift引入了可选方案，只需声明是否有值，即可处理缺少值的情况。可选的本身就是一种类型！</li><li id="cf17" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">可选链接:将多个可选链接到一个语句中。如果链中的任何一个环节为零，整个链都会失败。</li><li id="2824" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">URL:统一资源定位器。网页或资源的地址。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dc6c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么扔？</h1><p id="feab" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">您可能希望记录Swift程序中的错误。我在之前使用过的一个例子是文件处理。</p><p id="40f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，下面的例子将使用文件管理器。由于我们对iOS应用程序使用沙箱，我决定使用单视图iOS应用程序，而不是Playgrounds(使用Playgrounds沙箱需要对代码进行一些更改)。</p><p id="f1a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事情是这样的，创建一个文件或文件夹可能会因为很多原因而失败(资源被锁定，请求访问用户无权访问的地方，等等。).</p><p id="2a34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正是因为这个原因，我们需要处理错误消息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="54f5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">真实世界的使用</h1><p id="4cf8" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">的确，在执行网络任务时，您可能必须处理错误，因为有时从网络位置下载会失败，我们需要知道在这种情况下该怎么办。</p><p id="e7a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件处理也是如此，因为操作失败或成功有各种不同的原因。</p><p id="a573" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始描述我们的例子。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f239" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">这个例子</h1><p id="f55b" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">Swift编译器会产生以下错误:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="2671" class="ns md it no b gy nt nu l nv nw"><strong class="no iu">let</strong> urls = FileManager.default.urls(for: .applicationSupportDirectory, in: .userDomainMask)</span><span id="34c3" class="ns md it no b gy nx nu l nv nw"><strong class="no iu">try</strong> FileManager.default.createDirectory(at: urls[0],withIntermediateDirectories: <strong class="no iu">true</strong>, attributes: <strong class="no iu">nil</strong>)</span></pre><p id="e938" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码中发生的事情是，我们正在检索您当前设备上的应用程序支持目录的<code class="fe ny nz oa no b">URL</code>。然后，我们使用它在该文件夹中创建一个目录。好吗？我们继续吧。</p><p id="5caa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是有一个错误:“从这里抛出的错误没有被处理。”</p><p id="a01c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯<em class="ob">。这意味着我们实际上需要处理这种情况。我们要怎么做呢？</em></p><p id="09be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，我们可以基于<a class="ae ky" href="https://medium.com/@stevenpcurtis.sc/avoiding-force-unwrapping-in-swift-6dae252e970e" rel="noopener">展开</a>的方法，因为我们可以强制展开可选的或者使用可选的链接来静默失败。这导致了另一种方法，帮助我们知道是否以及何时出现了问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e2a0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最初的方法——尝试！</h1><p id="29e2" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">类似于强制展开，我们可以使用<code class="fe ny nz oa no b">try!</code>:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="bd8a" class="ns md it no b gy nt nu l nv nw"><strong class="no iu">try</strong>! FileManager.default.createDirectory(at: urls[0],withIntermediateDirectories: <strong class="no iu">true</strong>, attributes: <strong class="no iu">nil</strong>)</span></pre><p id="f28b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果运行时出现错误，应用程序就会崩溃。这是值得重复的:如果你使用<code class="fe ny nz oa no b">try!</code>并有一个错误，应用程序将简单地崩溃。</p><p id="0d6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做的结果将是用户不高兴。换句话说，只有当你确定不会出错时，才使用<code class="fe ny nz oa no b">try!</code>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e780" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">可选的尝试——尝试？</h1><p id="32a6" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">与可选链接类似，我们可以使用<code class="fe ny nz oa no b">try?</code> <strong class="lb iu"> </strong>来忽略以下情况中的错误:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="2591" class="ns md it no b gy nt nu l nv nw"><strong class="no iu">try?</strong> FileManager.default.createDirectory(at: urls[0],withIntermediateDirectories: <strong class="no iu">true</strong>, attributes: <strong class="no iu">nil</strong>)</span></pre><p id="014b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者如果我们有一个变量作为结果:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="d3c6" class="ns md it no b gy nt nu l nv nw">let responseJSON = try? JSONSerialization.jsonObject(with: data, options: [])</span></pre><p id="7136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，<code class="fe ny nz oa no b">responseJSON</code>要么是类型<code class="fe ny nz oa no b">Any</code>要么是零——这是可选的<code class="fe ny nz oa no b">Any</code>或<code class="fe ny nz oa no b">Any?</code>。然后，我们可以像处理任何可选语句一样，通过使用程序员选择的可选链接或保护语句来处理这个问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2b78" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">做-试-抓</h1><p id="ed2b" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们可以捕捉错误。请参见以下示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="2c83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们尝试创建目录，如果有错误，就会触发第二个代码块。</p><p id="352d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我打印了错误。这对谁都没多大好处。在另一种情况下，我们可能不关心错误是什么。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="39c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里，我们可以使用第二个块(注意，我已经删除了捕获错误名称的代码部分)。这个想法是，你进入第二个区块，在那里你处理问题，并确保你的用户有一个伟大的整体应用体验。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e4e9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><ul class=""><li id="2359" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated"><code class="fe ny nz oa no b">try!</code>:小心使用。事实上，只有当你完全确定不会发生错误时，才使用它。换句话说，不要使用它，除非你能证明这是应用程序崩溃的风险。</li><li id="f429" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe ny nz oa no b">try?</code>:忽略错误即可。当你(作为程序员)不太关心这个错误时，使用这个。将值设为<code class="fe ny nz oa no b">nil</code>继续运行。</li><li id="788d" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe ny nz oa no b">do-try-catch</code>:运行代码并从代码的catch块中获取错误，以确保应用程序可以继续运行，不会出现问题。</li></ul></div></div>    
</body>
</html>