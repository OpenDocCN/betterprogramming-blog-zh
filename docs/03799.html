<html>
<head>
<title>Design Vue3 Plugins Using Provide and Inject</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用提供和注入设计Vue3插件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/designing-vue3-plugins-using-provide-and-inject-47b586d9ce4?source=collection_archive---------2-----------------------#2020-03-05">https://betterprogramming.pub/designing-vue3-plugins-using-provide-and-inject-47b586d9ce4?source=collection_archive---------2-----------------------#2020-03-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c4e2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">非常适合构建插件或避免道具钻孔</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d4d31555a1c43e0ee036ac776c434eca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_AnHuicm4fHJ1zJaAne0qA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@alvaropinot?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿尔瓦罗·皮诺</a>在<a class="ae ky" href="https://unsplash.com/s/photos/patterns?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="56a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然不经常使用，但是您可以使用两个内置方法来实现依赖注入:<code class="fe lv lw lx ly b">provide</code>和<code class="fe lv lw lx ly b">inject</code>。</p><p id="2f90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看组合API文档，使用provide和inject的依赖注入在<a class="ae ky" href="https://learnvue.co/2019/12/what-does-vuejs-3-0-mean-for-web-development/" rel="noopener ugc nofollow" target="_blank"> Vue 3.0 </a>中会更常见。这主要是因为插件将不得不切换到使用这种模式，因为组合API对<code class="fe lv lw lx ly b">this</code>引用的改变。</p><p id="49d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将会看到在Vue3中使用provide和inject，以及如何使用它来构建<a class="ae ky" href="https://learnvue.co/2020/01/how-to-make-your-first-vuejs-plugin/" rel="noopener ugc nofollow" target="_blank"> VueJS插件</a>。</p><p id="f69a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们直接跳进来吧！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d2cb" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">为什么Vue3插件的工作方式不同？</h1><p id="12dd" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在Vue2中，大多数插件都在<code class="fe lv lw lx ly b">this</code>上注入属性。例如，通过<code class="fe lv lw lx ly b">this.$router</code>访问Vue路由器。</p><p id="e08a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，<code class="fe lv lw lx ly b">setup()</code>方法不再包含对<code class="fe lv lw lx ly b">this</code>的相同引用。这一变化的主要原因是<a class="ae ky" href="https://learnvue.co/2019/12/5-things-you-can-do-to-prepare-for-vue-3-0" rel="noopener ugc nofollow" target="_blank">增加了类型脚本支持</a>。</p><p id="7211" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nd">那么，我们现在如何访问我们的插件呢？</em></p><p id="e5de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，我们可以使用<code class="fe lv lw lx ly b">provide</code>和<code class="fe lv lw lx ly b">inject</code>来帮助在我们的Vue应用中注入依赖关系。</p><p id="02ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b"><a class="ae ky" href="https://medium.com/js-dojo/the-magic-of-provide-inject-a27041df33b2" rel="noopener">Provide</a></code><a class="ae ky" href="https://medium.com/js-dojo/the-magic-of-provide-inject-a27041df33b2" rel="noopener"/><code class="fe lv lw lx ly b"><a class="ae ky" href="https://medium.com/js-dojo/the-magic-of-provide-inject-a27041df33b2" rel="noopener">inject</a></code>用于依赖注入，使我们能够在我们的Vue app的根中提供一个插件，然后将其注入到一个子组件中。</p><p id="32b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://learnvue.co/2019/12/a-first-look-at-vue3-a-vue-composition-api-tutorial/" rel="noopener ugc nofollow" target="_blank">组合API </a>中，两种方法都只能在<code class="fe lv lw lx ly b">setup()</code>方法期间调用。</p><h2 id="669c" class="ne mh it bd mi nf ng dn mm nh ni dp mq li nj nk ms lm nl nm mu lq nn no mw np bi translated">提供和注入的是什么？</h2><p id="1ef6" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">好的，我们知道我们必须使用<code class="fe lv lw lx ly b">provide</code>和<code class="fe lv lw lx ly b"> inject</code>，但是这是如何工作的呢？</p><p id="7a4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，我们所需要的是某种识别我们的依赖性的键。出于我们的目的，我们将使用一个<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol" rel="noopener ugc nofollow" target="_blank"> JavaScript符号</a>。</p><p id="7ed1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们provide方法将我们的符号与某个值相关联，我们的inject方法将使用相同的符号检索该值。</p><p id="f7d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们看一个例子，会更有意义:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5026" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个模式，我们实际上可以用<a class="ae ky" href="https://learnvue.co/2019/12/what-you-need-to-know-about-vue3-in-2020/" rel="noopener ugc nofollow" target="_blank"> Vue3 </a>完成一些很酷的技巧。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="97f4" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">我们可以在我们的应用程序中提供全局依赖</h1><p id="b525" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果我们想在全球范围内提供一些东西，我们可以在声明Vue应用实例的任何地方使用<code class="fe lv lw lx ly b">app.provide</code>。然后，我们可以像刚才那样注射:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d237" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">我们可以使用Ref来提供反应数据</h1><p id="ab8e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果我们希望将反应数据传递给子组件，这也非常方便。我们所要做的就是使用<code class="fe lv lw lx ly b">ref()</code>将一个反应属性传递给我们的provide方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e1a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们如何对插件使用<code class="fe lv lw lx ly b">provide</code>和<code class="fe lv lw lx ly b">inject</code>？</p><p id="e60b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设计一个插件实际上非常类似于我们刚刚看到的简单的提供和注入示例。</p><p id="0e03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我们想使用一个<code class="fe lv lw lx ly b">Composition</code>函数，而不是提供一个奇异值。这是Vue3的巨大优势之一——能够根据功能组织和提取代码。</p><p id="cb89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们的代码<em class="nd">无论如何都应该用一个有组织的组合函数来编写，我们只需要创建这些提供和注入方法和BAM——我们有一个插件。</em></p><p id="4275" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们快速看一下<a class="ae ky" href="https://learnvue.co/2020/01/4-vue3-composition-api-tips-you-should-know/" rel="noopener ugc nofollow" target="_blank"> Vue3组合API </a>文档给出的假设插件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2151" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们的实际组件会像这样使用它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e6ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你所看到的，在一些根组件中，我们提供了我们的插件并传递给它一个复合函数。然后，无论我们想在哪里使用它，我们都必须将它注入到组件中。</p><p id="2d1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">组件不应该真的进行<code class="fe lv lw lx ly b">provide</code> / <code class="fe lv lw lx ly b">inject</code>调用，而是应该调用插件公开的<code class="fe lv lw lx ly b">provideStore</code> / <code class="fe lv lw lx ly b">useStore</code>方法。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="671c" class="ne mh it bd mi nf ng dn mm nh ni dp mq li nj nk ms lm nl nm mu lq nn no mw np bi translated">那么我还能用我的旧插件吗？</h2><p id="4b03" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">简而言之:是的。</p><p id="9e84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">长回答:看你什么意思了。</p><p id="1ffc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于组合API是纯粹的附加API，你可以继续使用选项API，并且对之前的<code class="fe lv lw lx ly b">this</code>有相同的引用，所有的旧插件都将同样工作。</p><p id="161f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，向前看，跳到Vue3并利用它的所有特性绝对是值得的。</p><p id="5dce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本质上，只要你想坚持Vue2 options API，你的插件也会一样工作。但是大多数维护良好的插件和库应该会增加对Vue3的支持。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="e575" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="2051" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated"><code class="fe lv lw lx ly b">provide</code> / <code class="fe lv lw lx ly b">inject</code>的正确使用，绝对是Vue开发中比较高级的话题。</p><p id="e29d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然大多数典型的应用程序不会使用这些概念，但如果你对开发插件很认真，Vue3组合API的变化意味着你必须使用<code class="fe lv lw lx ly b">provide</code> / <code class="fe lv lw lx ly b">inject</code>。</p><p id="3378" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想要更多的信息，查看<a class="ae ky" href="https://vue-composition-api-rfc.netlify.com/" rel="noopener ugc nofollow" target="_blank">组合API文档</a>。</p><p id="3af2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="e9d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有兴趣了解更多关于VueJS的知识，点击这里获得一份免费的Vue备忘单，这是每个Vue开发者都需要知道的基本知识。</p></div></div>    
</body>
</html>