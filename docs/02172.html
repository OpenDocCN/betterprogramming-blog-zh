<html>
<head>
<title>Classify Movie Reviews With Natural Language Framework, Core ML, and SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用自然语言框架、核心ML和SwiftUI对电影评论进行分类</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/classifying-movie-reviews-with-natural-language-framework-12dfe2fc3308?source=collection_archive---------17-----------------------#2019-11-11">https://betterprogramming.pub/classifying-movie-reviews-with-natural-language-framework-12dfe2fc3308?source=collection_archive---------17-----------------------#2019-11-11</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="e810" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">在烂番茄数据集上探索苹果新的内置情感分析和自然语言处理的文本分类</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/01db51c2dc07c3b1220b6245fa808624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Uy8EENZtQamveCkW"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@felixmooneeram?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">菲利克斯·穆纳拉姆</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="e3cf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">苹果在<a class="ae kz" href="https://developer.apple.com/videos/play/wwdc2019/232/" rel="noopener ugc nofollow" target="_blank"> WWDC 2019 </a>期间展示了自然语言处理领域的一些良好进展。他们增强了文本分类和单词标注，这是自然语言处理的两大支柱。</p><p id="79e6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我们将只讨论文本分类方面的进步，它将输入文本分类到一组预定义的类标签中。</p><p id="1926" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">今年，苹果公司引入了用于文本分类器模型训练的迁移学习技术。迁移学习关注文本整体语境的语义，能够找出同一单词在文本不同部分有不同含义的情况。</p><p id="94d4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然最先进的迁移学习更适合语义分析，但它确实比最大熵算法需要更长的训练时间。</p><p id="bd94" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">苹果今年还引入了内置的情绪分析。使用NLP框架，现在你得到一个范围在-1到1之间的分数，表示情感的程度。</p><p id="7eb3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下面是一个示例代码，展示了NLP的内置情感分析如何预测字符串中的情感得分:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="a123" class="mb mc iu lx b gz md me l mf mg">import NaturalLanguage</span><span id="b495" class="mb mc iu lx b gz mh me l mf mg">tagger.string = text</span><span id="172c" class="mb mc iu lx b gz mh me l mf mg">let (sentiment, _) = tagger.tag(at: text.startIndex, unit: .paragraph, scheme: .sentimentScore)</span><span id="7f65" class="mb mc iu lx b gz mh me l mf mg">print(sentiment.rawValue)</span></pre><p id="4b2b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">内置的情绪分析非常准确，如下图所示:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj mi"><img src="../Images/40170675fa0bb9bc9ee40493e600a14a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YPolij5F0FKVQ83Q1RWrwQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">带有NLP情感分析的SwiftUI预览示例</p></figure><p id="7f5d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在接下来的章节中，我们将使用<a class="ae kz" href="https://datapane.com/datasets/mA2pj74/" rel="noopener ugc nofollow" target="_blank">烂番茄数据集</a>通过Create ML创建一个文本分类器核心ML模型，并将其部署在我们的自然语言框架中。</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h2 id="cb64" class="mb mc iu bd mq mr ms dn mt mu mv dp mw lj mx my mz ln na nb nc lr nd ne nf ng bi translated">行动（或活动、袭击）计划</h2><ul class=""><li id="e3b1" class="nh ni iu lc b ld nj lg nk lj nl ln nm lr nn lv no np nq nr bi translated">将CSV数据集转换为训练测试文件夹。</li><li id="d0a3" class="nh ni iu lc b ld ns lg nt lj nu ln nv lr nw lv no np nq nr bi translated">使用Create ML训练数据集。</li><li id="a5fd" class="nh ni iu lc b ld ns lg nt lj nu ln nv lr nw lv no np nq nr bi translated">用SwiftUI在自然语言框架中部署核心ML模型。</li></ul></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="95c3" class="nx mc iu bd mq ny nz oa mt ob oc od mw ka oe kb mz kd of ke nc kg og kh nf oh bi translated">转换我们的数据集</h1><p id="934f" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj oi ll lm ln oj lp lq lr ok lt lu lv in bi translated">我们的数据集是一个CSV文件，如下所示:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ol"><img src="../Images/34a4f466f9c88bb7a749fc199513c044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*C5xZ_Otc6BTqry9IEvWyFA.png"/></div></div></figure><p id="b4a7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下python脚本用于将CSV拆分为训练和测试数据文件夹:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="009b" class="mb mc iu lx b gz md me l mf mg">import os<br/>import pandas as pd</span><span id="7867" class="mb mc iu lx b gz mh me l mf mg">df = pd.read_csv("rotten_tomatoes_reviews.csv", nrows=50000)<br/>df.columns = ["freshness", "review"]<br/># Split data into training and testing sets by label<br/>train = df.sample(frac=0.8, random_state=42)<br/>train_good = train[train.freshness == 1]<br/>train_bad = train.drop(train_good.index)<br/>test = df.drop(train.index)<br/>test_good = test[test.freshness == 1]</span><span id="1338" class="mb mc iu lx b gz mh me l mf mg">test_bad = test.drop(test_good.index)<br/># Create folders for data<br/>os.mkdir("train"); os.mkdir("test")<br/>os.mkdir("train/good"); os.mkdir("train/bad")<br/>os.mkdir("test/good"); os.mkdir("test/bad")<br/>#Write out data<br/>def write_text(path, df):<br/>    for i, r in df.iterrows():<br/>        with open(path + str(i) + ".txt", "w") as f:<br/>            f.write(r["review"])<br/>write_text("train/good/", train_good)<br/>write_text("train/bad/", train_bad)<br/>write_text("test/good/", test_good)<br/>write_text("test/bad/", test_bad)</span></pre><p id="b904" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">为了简单和节省时间，我们将解析4，80，000条烂番茄评论中的前50000行，并将数据集拆分为标准的80–20比例的<code class="fe om on oo lx b">train</code>和<code class="fe om on oo lx b">test</code>文件夹。</p><p id="c6b9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一旦CSV被拆分到各自的文件夹中，我们就可以启动Create ML应用程序了，今年它已经有了一个独立的实体。</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="c353" class="nx mc iu bd mq ny nz oa mt ob oc od mw ka oe kb mz kd of ke nc kg og kh nf oh bi translated">创建ML文本分类器模型</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj op"><img src="../Images/0c8a7f76a4ff509480c7c7c964c2ecce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*4LfFn42M1Of0xAC0m7tC-Q.png"/></div></figure><p id="8da7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在Create ML中创建新的文本分类器模型项目，并添加training文件夹。您可以选择任何技术来训练您的模型，并在训练和验证过程中喝杯咖啡。我花了4个小时训练了一个迁移学习模型。</p><p id="37e8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">下图比较了文本分类中两种技术的模型指标:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/283ec5753ca86885924ccd9d1da1ce3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dSV7OnU3-w6-lGnlJ2FLfg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">迁移学习需要4个小时，而最大熵只需要2分钟</p></figure><p id="95ae" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">基于迁移学习的模型外推得更好。尽管您可以通过增加数据集的大小来获得更好的准确性(对我来说，TL模型训练在15000个文本的数据集上花费了4个小时)。</p><p id="3a08" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">或者，您可以使用Create ML以编程方式创建您的模型。只需在参数<code class="fe om on oo lx b">ModelParameters</code>中传递想要的算法。</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="09d8" class="mb mc iu lx b gz md me l mf mg"><a class="ae kz" href="https://developer.apple.com/documentation/createml/mltextclassifier/3006741-init" rel="noopener ugc nofollow" target="_blank">init(trainingData: MLTextClassifier.DataSource, parameters: MLTextClassifier.ModelParameters)</a></span></pre><h2 id="589d" class="mb mc iu bd mq mr ms dn mt mu mv dp mw lj mx my mz ln na nb nc lr nd ne nf ng bi translated">评估我们的模型</h2><p id="913b" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj oi ll lm ln oj lp lq lr ok lt lu lv in bi translated">一旦模型经过训练和测试，跳到Create ML中的Output选项卡，输入文本来运行预测。下图显示了我运行的一些预测。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj or"><img src="../Images/ef3ed989aa31ba1f2294c13374c5755a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CAG2-6UjLKDM9Tnp13P5KQ.gif"/></div></div></figure><p id="cc34" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，我们的模型已经准备好部署用于自然语言处理。</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="3f67" class="nx mc iu bd mq ny nz oa mt ob oc od mw ka oe kb mz kd of ke nc kg og kh nf oh bi translated">部署核心ML模型</h1><p id="e2cc" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj oi ll lm ln oj lp lq lr ok lt lu lv in bi translated">创建一个新的基于Xcode SwiftUI的项目，并拖放我们之前创建的核心ML模型。</p><p id="afa5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们将开发一个应用程序，显示文本列表(通常是腐烂的番茄评论)，我们将使用NLP运行我们的核心ML模型，以确定它是否是腐烂的(好的或坏的评论)。</p><p id="2e88" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">此外，我们将运行NLP的内置情感分析，以了解它如何预测烂番茄评论，并查看情感程度和CoreML预测的准确性。</p><p id="fc2c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下代码显示了如何将核心ML模型加入自然语言框架:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="487b" class="mb mc iu lx b gz md me l mf mg">import NaturalLanguage<br/><br/>let predictor = try NLModel(mlModel: ReviewClassifier().model)<br/>predictor.predictedLabel(for: "Fight Club was a master piece. One of it's kind cinema.")</span></pre><h2 id="2883" class="mb mc iu bd mq mr ms dn mt mu mv dp mw lj mx my mz ln na nb nc lr nd ne nf ng bi translated">创建带导航的SwiftUI列表</h2><p id="4e61" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj oi ll lm ln oj lp lq lr ok lt lu lv in bi translated">让我们首先创建一个SwiftUI列表，使用符合可识别协议的Reviews结构填充该列表。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="os ot l"/></div></figure><p id="7434" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在上面的代码中，我们向列表项添加了导航链接，将它们带到我们接下来将看到的ReviewDetail视图:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="os ot l"/></div></figure><p id="077e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上面的代码很简单。我们添加了两个SwiftUI按钮，分别评估文本的情感分析和评论的好坏。</p><p id="064b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">作为回报，我们在SwiftUI预览中得到以下结果:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ou"><img src="../Images/0c385962565413541fd035701188fdb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/1*64OPC9c3p7DrV4BekdhXrg.gif"/></div></figure><p id="2ed7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">NLP的内置情感分析在一个它基本上不熟悉的数据集上做得相当好。与此同时，我们的核心ML模型在确定评论者是喜欢这部电影还是批评这部电影时，与自然语言框架表现得相当不错。</p><h1 id="7946" class="nx mc iu bd mq ny ov oa mt ob ow od mw ka ox kb mz kd oy ke nc kg oz kh nf oh bi translated">结论</h1><p id="99aa" class="pw-post-body-paragraph la lb iu lc b ld nj jv lf lg nk jy li lj oi ll lm ln oj lp lq lr ok lt lu lv in bi translated">这就概括了核心的ML和自然语言框架。我们看到了内置的情感分析在语言处理中是多么强大的工具。</p><p id="3718" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">完整的源代码以及用于解析CSV的python脚本可以在这个<a class="ae kz" href="https://github.com/anupamchugh/iowncode/tree/master/iOSNLPRottenTomatoes" rel="noopener ugc nofollow" target="_blank"> Github仓库</a>中找到。此外，它还包含使用最大熵和迁移学习构建的模型。你可以试着和他们玩玩，看看哪个更符合要求。</p><p id="3b09" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这一次到此为止。我希望你喜欢阅读和模型训练！</p></div></div>    
</body>
</html>