<html>
<head>
<title>The Subtle Art of Test Automation Using Docker Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker Compose的测试自动化的微妙艺术</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-subtle-art-of-test-automation-using-docker-compose-69a10fc9aac5?source=collection_archive---------11-----------------------#2019-10-28">https://betterprogramming.pub/the-subtle-art-of-test-automation-using-docker-compose-69a10fc9aac5?source=collection_archive---------11-----------------------#2019-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="be54" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用docker-compose来执行测试自动化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6a9a50fdb82e41ea20bbc700c63bd0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WIpE5OahWDR6Ri-xgc_Knw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">摄影师:Self |地点:印度拉达克列城潘公湖</p></figure><p id="af49" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">多年来，我们中的许多人已经在类似生产的测试环境中执行了测试自动化。</p><p id="f92b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于术语“类似生产环境”,我指的是具有类似生产环境的精确设置的测试环境，但是可能具有也可能不具有与生产环境相同的精确配置。</p><p id="780c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，当谈到针对测试环境执行测试自动化时，工程师总是会面临一定程度的挑战(尽管是可以解决的)。</p><p id="eee7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">典型的例子是:</p><ol class=""><li id="b80f" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">QA工程师在测试环境中执行手动/探索性测试，同时，CI管道由于新的提交而被触发，从而部署当前的构建快照，触发可能妨碍已经完成的测试数据设置的自动化测试。</li><li id="49d2" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">可以通过测试套件和测试框架的设计来解决，但是并行执行不可能支持特定的用例。</li><li id="09b1" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">与专用的成熟的类似生产的测试环境相关的总成本。</li></ol><p id="cf41" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些是可以通过使用docker-compose执行测试自动化来解决的一些挑战。我们能够用这种方法解决的一些经典挑战:</p><ol class=""><li id="87e6" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">针对Docker映像运行测试，而不是一个成熟的测试环境，这一点总是有争议的。但是最终，测试自动化的目的是验证这些Docker映像中包含的功能，而不是基础设施的设置。当然，可以有测试的子集，也称为冒烟测试套件，可以在真实的类似生产的环境中运行——最好是在系统集成测试或开发环境中。但是基于docker-compose的设置可以用来运行耗时的回归套件。</li><li id="8b6c" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">可以创建多个隔离的环境，可能在同一个主机中，因此测试套件可以隔离运行。这里最大的优势是，我们现在能够利用底层基础设施提供的并行化，而不是依赖于自动化框架级别的并行化，也就是说，在这种情况下，我们可以利用docker-compose创建的隔离环境。</li><li id="24b9" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">在测试用例或测试套件级别进行测试数据设置和拆卸，而不要过多考虑当多个测试套件并行运行时会产生什么影响。原因是，当并行化在自动化框架级别完成时，执行仍然指向单个环境。但是，当并行化是通过在隔离环境中执行测试来完成时，责任就转移到了底层基础设施级别，从而带来了一定程度的关注点分离。</li><li id="a832" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">如果必须部署一个热修复程序，并且必须针对该热修复程序执行回归，那么与其在测试环境中部署热修复程序快照，还不如使用docker-compose构建独立的环境并验证热修复程序，这样会更加方便。</li><li id="aa46" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">为了运行向后兼容性测试，如果需要部署当前的生产快照，可以使用docker-compose构建独立的环境，在当前生产的状态下创建测试数据，然后升级到当前版本的快照，并验证新的更改是否不会破坏构建，这样可以更有效地完成。</li><li id="bc53" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">复制将用于未来参考的所需数据，即自动执行测试报告，在我们的情况下，使用卷，以便可以利用主机。</li></ol></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="cb74" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">入门指南</h1><p id="f066" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh nj lj lk ll nk ln lo lp nl lr ls lt im bi translated">在本文中，我们将看到一个如何使用docker-compose针对微服务运行REST API测试自动化套件的示例。</p><ol class=""><li id="6c33" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">创建微服务的Docker映像，并将其推送到Docker Hub。</li><li id="1d59" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">创建REST API自动化的Docker映像，并将其推送到Docker Hub。</li><li id="65d9" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">创建一个<code class="fe nm nn no np b">docker-compose.yaml</code>,它:</li></ol><p id="20c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">a.从Docker Hub提取微服务Docker映像，并启动服务。</p><p id="c670" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">b.从Docker Hub中提取REST API automation Docker映像，并启动该映像，以便针对点3-a中的微服务执行自动化测试套件。</p><p id="ae21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.将测试自动化执行的报告复制到Docker容器运行的主机上的一个卷中。</p><p id="c98e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们来详细看看这些步骤。</p><h2 id="40aa" class="nq mq it bd mr nr ns dn mv nt nu dp mz lh nv nw nb ll nx ny nd lp nz oa nf ob bi translated"><strong class="ak">微服务存储库和Dockerfile </strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/1d6c8b5244b9f73aa7426e95296cae0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOIIoDB54KDYeTE2GpU8-g.png"/></div></div></figure><h2 id="ea72" class="nq mq it bd mr nr ns dn mv nt nu dp mz lh nv nw nb ll nx ny nd lp nz oa nf ob bi translated"><strong class="ak"> REST API测试框架库和Dockerfile文件</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/b451de433e77f0a392d7822dbf88023c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OAasRf4UavrfiGrZLqVkBQ.png"/></div></div></figure><p id="ab09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第一步。为微服务存储库和REST API测试框架存储库构建Docker映像。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Docker命令来构建docker图像并列出它们</p></figure><p id="2777" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二步。运行<code class="fe nm nn no np b">docker images</code>，它列出了上述<code class="fe nm nn no np b">docker build</code>命令创建的图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/ed9755d9ff06f3cbcf45c8cf1e5fa927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_o3_SQyUmS0cgBOS-GjvTg.png"/></div></div></figure><p id="3936" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第三步。将创建的Docker映像推送到Docker Hub。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将Docker映像推入Docker Hub的Docker命令</p></figure><p id="3a60" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第四步。Docker Hub中列出的推送图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/b251aff310f97d6be2bc79ad6f64428e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UVfV44d24VrJl4HjKPZLYg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Docker Hub中发布的图像</p></figure><p id="6e00" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第五步。添加本地目录，安装到Docker容器中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/161aff9264d97ba6cf48325d9e36ef89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qRAQzS-rDeF37DIEnt_e8A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将主机目录装入Docker容器</p></figure><p id="a8b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">码头工人作曲YAML。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/72348288e09b76be7960be50b21691b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AM0Sqmwaw5SSLXusLp-6pw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">docker-compose.yaml</p></figure><p id="80d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第六步。检查<code class="fe nm nn no np b">docker-compose.yaml</code>的配置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/9dcacc5706f0efee46880bb3a5fab478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c7QPAYIDOBaYvt70ZvLsQQ.png"/></div></div></figure><p id="d586" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第七步。跑<code class="fe nm nn no np b">docker-compose up</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/484f97a9302e674cf9a079b3dd1a574c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2JzQLbJAUNFxptLWK55iA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用docker-compose.yaml开始执行</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/2a708f9cf9b8e049d219ae0043bb3438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fEDGQ6WA4vJQntZ2J8Ixag.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">运行docker-compose.yaml后生成的结果</p></figure><p id="0931" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第八步。在挂载的macOS目录中生成的结果文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/bd9068df4a453a50ecc3de792c83dc83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xaspbke7Vc8ib8vXeu1LWw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">执行后生成的Html报告</p></figure><p id="2b14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第九步。来自安装的macOS目录的详细HTML报告。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/cb020a5a2a32e4a88d51f669cdd3b7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AimavwsvwkPwYcdciXu3lQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">REST API自动化HTML报告</p></figure><p id="3354" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">步骤的视频教程:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op of l"/></div></figure><p id="dfcb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了实现上述步骤，需要开发人员、质量保证人员和运营人员之间的密切协调。如果没有老年退休金计划的支持，要达到这个目标会比较困难。</p><p id="291a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，让每个角色都参与进来非常重要——开发人员、质量保证人员和运营人员。</p></div></div>    
</body>
</html>