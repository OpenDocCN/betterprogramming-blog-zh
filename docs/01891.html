<html>
<head>
<title>Understanding Docker Container Exit Codes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解码头集装箱出口代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/understanding-docker-container-exit-codes-5ee79a1d58f6?source=collection_archive---------0-----------------------#2019-10-21">https://betterprogramming.pub/understanding-docker-container-exit-codes-5ee79a1d58f6?source=collection_archive---------0-----------------------#2019-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e738" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">最常见的退出代码、它们的含义以及导致它们的原因</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/41f4f31e9a2e6560ccf3fcd32c5830b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oPxowflUcsnxaNBRIZMmUw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Docker容器退出代码——如何使用它们进行故障排除？</p></figure><p id="8253" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我遇到的最常见的问题之一:“为什么我的容器没有运行？”</p><p id="e4a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">docker容器退出代码有助于解决这个问题吗？</p><p id="6056" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">回答这个问题的第一步是识别docker容器的退出代码。退出代码可能会给出一个提示，说明发生了什么使容器停止运行。本文列出了使用docker容器时最常见的退出代码，旨在回答两个重要问题:</p><ul class=""><li id="5a89" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">这个特定的退出代码是什么意思？</li><li id="cf4e" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">什么操作导致了这个退出代码？</li></ul><p id="e1cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将最终有助于回答最初的问题:“为什么我的容器没有运行？”</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="d7ad" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">如何找到退出代码</h1><h2 id="ff27" class="nh mq it bd mr ni nj dn mv nk nl dp mz lh nm nn nb ll no np nd lp nq nr nf ns bi translated">选项1:列出所有退出的容器</h2><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="1534" class="nh mq it nu b gy ny nz l oa ob">docker ps --filter "status=exited"</span></pre><h2 id="a6cf" class="nh mq it bd mr ni nj dn mv nk nl dp mz lh nm nn nb ll no np nd lp nq nr nf ns bi translated">选项2:通过容器名进行Grep</h2><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="d098" class="nh mq it nu b gy ny nz l oa ob">docker ps -a grep &lt;container-name&gt;</span><span id="53a5" class="nh mq it nu b gy oc nz l oa ob"><strong class="nu iu">Example</strong>: docker ps -a | grep hello-world</span></pre><h2 id="a999" class="nh mq it bd mr ni nj dn mv nk nl dp mz lh nm nn nb ll no np nd lp nq nr nf ns bi translated">选项3:按集装箱编号检验</h2><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="fdfc" class="nh mq it nu b gy ny nz l oa ob">docker inspect &lt;container-id&gt; --format='{{.State.ExitCode}}'</span><span id="2c4d" class="nh mq it nu b gy oc nz l oa ob">Example: docker inspect ca6cbb290468 --format='{{.State.ExitCode}}'</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="5c90" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">退出代码</h1><p id="890b" class="pw-post-body-paragraph ky kz it la b lb od ju ld le oe jx lg lh of lj lk ll og ln lo lp oh lr ls lt im bi translated">与docker容器相关联的常见退出代码有:</p><ul class=""><li id="6016" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated"><strong class="la iu">退出代码0 </strong>:没有附加前台进程</li><li id="ab65" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu">退出代码1 </strong>:表示由于应用错误导致失败</li><li id="8e49" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu">退出代码137 </strong>:指示失败，因为容器接收到SIGKILL(手动干预或‘oom-killer’[内存不足])</li><li id="f8c4" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu">退出代码139 </strong>:当容器接收到信号SEGV时，指示失败</li><li id="6f5f" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu">退出代码143 </strong>:指示失败，因为容器接收到SIGTERM</li></ul><h2 id="6246" class="nh mq it bd mr ni nj dn mv nk nl dp mz lh nm nn nb ll no np nd lp nq nr nf ns bi translated">退出代码0</h2><ul class=""><li id="168c" class="lu lv it la b lb od le oe lh oi ll oj lp ok lt lz ma mb mc bi translated">退出代码0表示特定容器没有附加前台进程。</li><li id="4a93" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">这个退出代码是所有其他退出代码的例外。这并不一定意味着发生了不好的事情。</li><li id="2efe" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">如果开发人员想在容器完成工作后自动停止容器，他们可以使用这个退出代码。</li></ul><p id="87a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是一个使用公共docker容器的例子——“hello-world”。如果您的系统或虚拟机实例上安装了docker，请运行以下命令:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="9e73" class="nh mq it nu b gy ny nz l oa ob">docker run hello-world</span></pre><p id="bcbd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你会收到一条信息，“你好，docker！”但是尝试使用以下代码找到容器:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="a30d" class="nh mq it nu b gy ny nz l oa ob">docker ps -a | grep hello-world</span></pre><p id="49f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您会注意到容器已经退出，退出代码是0。这是因为容器没有附加任何前台进程，比如Java进程或shell进程，它们会一直运行到SIGTERM事件发生</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/b1af39ed08bf83aaf7e665e3963ce8be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*onZujADMgDc3KvsDt8k0BA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">退出代码0</p></figure><h2 id="57a5" class="nh mq it bd mr ni nj dn mv nk nl dp mz lh nm nn nb ll no np nd lp nq nr nf ns bi translated">退出代码1</h2><ul class=""><li id="1c65" class="lu lv it la b lb od le oe lh oi ll oj lp ok lt lz ma mb mc bi translated">指示容器由于应用程序错误或Dockerfile中对容器中不存在的文件的错误引用而停止。</li><li id="00d7" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">应用程序错误可能简单到“被0除”，也可能复杂到“引用的bean名称与现有的、不兼容的相同名称和类的bean定义冲突”</li><li id="62b8" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">Dockerfile中对容器中不存在的文件的错误引用可能只是一个打字错误(下面的例子中有<code class="fe om on oo nu b">sample.ja</code>而不是<code class="fe om on oo nu b">sample.jar</code>)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/c13c0dce5054b848937998d1391151f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0C1noFKfmrj5FVnhpbO53w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">退出代码1</p></figure><h2 id="2be2" class="nh mq it bd mr ni nj dn mv nk nl dp mz lh nm nn nb ll no np nd lp nq nr nf ns bi translated">退出代码137</h2><ul class=""><li id="b328" class="lu lv it la b lb od le oe lh oi ll oj lp ok lt lz ma mb mc bi translated">这表明容器收到了信号删除</li><li id="0075" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">引发SIGKILL的常见事件是docker kill。这可以由用户手动启动，也可以由docker守护程序启动:</li></ul><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="dfbc" class="nh mq it nu b gy ny nz l oa ob">docker kill &lt;container-id&gt;</span></pre><ul class=""><li id="1206" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated"><code class="fe om on oo nu b">docker kill</code>可以由用户手动启动，也可以由主机启动。如果由主机发起，则通常是由于内存不足。要确认容器是否由于内存不足而退出，请对照下面部分的容器id验证<code class="fe om on oo nu b">docker inspect</code>，并检查<code class="fe om on oo nu b">OOMKilled</code>是否为真(这将表明它内存不足):</li></ul><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="72bf" class="nh mq it nu b gy ny nz l oa ob">"State": {<br/> "Status": "exited",<br/> "Running": false,<br/> "Paused": false,<br/> "Restarting": false,<br/> "OOMKilled": true,<br/> "Dead": false,<br/> "Pid": 0,<br/> "ExitCode": 137,<br/> "Error": "",<br/> "StartedAt": "2019-10-21T01:13:51.7340288Z",<br/> "FinishedAt": "2019-10-21T01:13:51.7961614Z"<br/>}</span></pre><h2 id="4edd" class="nh mq it bd mr ni nj dn mv nk nl dp mz lh nm nn nb ll no np nd lp nq nr nf ns bi translated">退出代码139</h2><ul class=""><li id="2113" class="lu lv it la b lb od le oe lh oi ll oj lp ok lt lz ma mb mc bi translated">这表明容器收到了SIGSEGV</li><li id="c730" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">SIGSEGV表示分段故障。当程序试图访问不允许它访问的<a class="ae oq" href="https://en.wikipedia.org/wiki/Computer_memory" rel="noopener ugc nofollow" target="_blank">内存</a>位置，或者试图以不允许的方式访问内存位置时，就会发生这种情况。</li><li id="70ae" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">从Docker容器的角度来看，这要么表明应用程序代码有问题，要么有时表明容器使用的基本映像有问题。</li></ul><h2 id="e768" class="nh mq it bd mr ni nj dn mv nk nl dp mz lh nm nn nb ll no np nd lp nq nr nf ns bi translated">退出代码143</h2><ul class=""><li id="b6ab" class="lu lv it la b lb od le oe lh oi ll oj lp ok lt lz ma mb mc bi translated">这表明容器收到了SIGTERM。</li><li id="aefd" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">启动SIGTERM的常见事件是<code class="fe om on oo nu b">docker stop</code>或<code class="fe om on oo nu b">docker-compose stop</code>。在这种情况下，有一个手动终止，迫使集装箱退出:</li></ul><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="63ae" class="nh mq it nu b gy ny nz l oa ob">docker stop &lt;container-id&gt;<br/>OR<br/>docker-compose down &lt;container-id&gt;</span></pre><ul class=""><li id="9223" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated"><strong class="la iu">注意:</strong>有时<code class="fe om on oo nu b">docker stop</code>也会导致退出代码137。如果绑定到容器的应用程序不处理SIGTERM，通常会发生这种情况docker守护进程等待十秒钟，然后发出SIGKILL</li></ul><h2 id="7831" class="nh mq it bd mr ni nj dn mv nk nl dp mz lh nm nn nb ll no np nd lp nq nr nf ns bi translated"><strong class="ak">Docker容器中一些不常见的退出代码(通常使用shell脚本)</strong></h2><ul class=""><li id="dfab" class="lu lv it la b lb od le oe lh oi ll oj lp ok lt lz ma mb mc bi translated"><strong class="la iu">退出代码126 </strong>:权限问题或命令不可执行</li><li id="409e" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated"><strong class="la iu">退出代码127</strong>:shell脚本中可能有不可识别字符的输入错误</li></ul></div></div>    
</body>
</html>