<html>
<head>
<title>Stetho: The Best Debugging Tool for Android Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ste tho:Android应用程序的最佳调试工具</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/stetho-the-best-debugging-tool-for-android-applications-1b1f0b99dc0e?source=collection_archive---------4-----------------------#2020-03-12">https://betterprogramming.pub/stetho-the-best-debugging-tool-for-android-applications-1b1f0b99dc0e?source=collection_archive---------4-----------------------#2020-03-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0e50" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们探索脸书的调试工具，并了解检查网络请求是多么容易</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/01b48ea2cbff3bdc89db0be74ece293a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ilJNGR7LnfYlh4XM"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@rami_alzayat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Rami Al-zayat </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片。</p></figure><p id="f565" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为Android开发人员，我们的开发生活经常涉及在构建动态应用程序时集成API <strong class="lb iu"> </strong>或web服务。以前，在API响应中查找响应和缺少的字段有点麻烦，因为我们过去常常保存日志<strong class="lb iu"> </strong>来检查输出或使用Studio中可用的调试器调试应用程序。</p><p id="740e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在花了大量时间之后，我们意识到有一些意想不到的数据类型来自后端。因此，这个过程需要一点时间和耐心来探索，因为如果您连接多个设备，您总是需要在它们之间切换以检查输出。</p><p id="b462" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是后来我发现<a class="ae ky" href="https://github.com/facebook/stetho" rel="noopener ugc nofollow" target="_blank"> Stetho </a>，<strong class="lb iu"> </strong>这样工作更轻松，也更节省时间。虽然已经过去很长时间了，但仍有许多开发人员在为网络调用检查做日志记录或调试工作。我写这篇文章是为了那些需要一些指导来简化工作的人。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/d9888bd09110d146b17ecd5746f41d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tJPKZXrW2qq43GLZIkgsgw.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="143b" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">问题</h1><p id="0793" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">您需要耐心和时间来探究网络请求被拒绝的次数。在处理多个设备时，您需要在设备之间切换以查看日志或附加调试器，这使得检查网络请求有点困难。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a174" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">解决办法</h1><p id="0e76" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们需要一个库或工具，用几行代码就能轻松地自动化网络呼叫检查。我们需要能够在某一点并行检查一定数量设备的网络调用，以检查事件是否正确触发。这就是斯特索发挥作用的地方。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="dbfc" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">Stetho是什么？</h1><p id="477f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Stetho是脸书的一个简单的库，用它我们可以很容易地调试网络调用。无需在开发期间添加日志，也无需在发布时删除日志。不需要使用调试器。只要遵循三个步骤，我们就可以在Chrome桌面浏览器中获得所有网络呼叫。我们可以看到应用程序发出的所有网络请求，如延迟、大小快照、触发序列、请求参数、响应数据等。除了网络检查之外，Stetho还有许多特性，但是本文将简要讨论网络请求检查。所以让我们开始吧。</p><h2 id="f65b" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated"><strong class="ak">第一步:</strong>在build.gradle中添加<strong class="ak">依赖关系</strong></h2><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="d6b3" class="na me it nn b gy nr ns l nt nu">implementation 'com.facebook.<strong class="nn iu">stetho:stetho</strong>:1.5.1'</span></pre><p id="1f23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只有主<code class="fe nv nw nx nn b">stetho</code>依赖项是严格要求的。但是，我们也可以使用网络助手之一:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="65f9" class="na me it nn b gy nr ns l nt nu">implementation 'com.facebook.stetho:stetho-<strong class="nn iu">okhttp3</strong>:1.5.1'</span><span id="df62" class="na me it nn b gy ny ns l nt nu">                          <strong class="nn iu">OR</strong></span><span id="4808" class="na me it nn b gy ny ns l nt nu">implementation 'com.facebook.stetho:stetho-<strong class="nn iu">urlconnection</strong>:1.5.1'</span></pre><p id="d208" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以启用JavaScript控制台:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="3d93" class="na me it nn b gy nr ns l nt nu">implementation 'com.facebook.stetho:<strong class="nn iu">stetho-js-rhino</strong>:1.5.1'</span></pre><h2 id="a780" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated"><strong class="ak">第二步:</strong>我<strong class="ak">用一行代码在应用程序类中初始化</strong></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5bcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记在<code class="fe nv nw nx nn b">AndroidManifest.xml</code>中注册您的班级:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h2 id="d3c5" class="na me it bd mf nb nc dn mj nd ne dp mn li nf ng mp lm nh ni mr lq nj nk mt nl bi translated"><strong class="ak">第三步:</strong>启用网络<strong class="ak">检查</strong></h2><p id="fb37" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果您在3.x版本中使用流行的<a class="ae ky" href="https://square.github.io/okhttp/" rel="noopener ugc nofollow" target="_blank"> OkHttp库</a>，您可以使用拦截器系统自动挂钩到您现有的栈。这是目前启用网络检查的最简单、最直接的方法:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="40a5" class="na me it nn b gy nr ns l nt nu"> <strong class="nn iu">OkHttpClient</strong>.Builder()<br/>    .<strong class="nn iu">addNetworkInterceptor</strong>(<strong class="nn iu">StethoInterceptor</strong>())<br/>    .build()</span></pre><p id="e5fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拦截器是一种强大的机制，可以监控、重写和重试调用。查看更多关于<a class="ae ky" href="https://square.github.io/okhttp/interceptors/" rel="noopener ugc nofollow" target="_blank">拦截器</a>的信息。</p><p id="a2e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！我们已经准备好检查应用程序发出的每一个网络呼叫。很简单，对吧？</p><p id="bbfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一个问题是在哪里检查输出。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8b39" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">如何使用Chrome DevTools进行检查</h1><p id="e297" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">与Chrome DevTools前端的集成是使用Stetho软件为您的应用程序提供的客户机/服务器协议实现的。既然基本设置已经完成，我们需要打开Chrome并连接设备来检查请求触发。</p><p id="884e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开你的Chrome浏览器，在地址栏输入<code class="fe nv nw nx nn b">chrome://inspect</code>。然后按下回车键，你将能够看到你的设备连接如下图所示。点击<em class="ob">检查</em>看魔术！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/406962cfa6e6350ff220a898c238c7f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6Mu4oz7prerWeeCa6qDEQ.png"/></div></div></figure><p id="6cfc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的屏幕中，您可以看到我连接的设备，其起始名称为ONEPLUS。在这里，它将列出所有与启用的USB调试选项连接的设备，以及每个集成了Stetho的设备上的应用程序列表。</p><p id="676b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，当你点击应用名称下方的<em class="ob">检查</em>时，神奇的事情发生了。它会打开一个单独的窗口，以列表格式提供所有服务的概述，以及所需的每个细节。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/08a9cbf402d47c8a588418a23fa6ddda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0PZHVpDpa1Apm3sEzrZ5g.png"/></div></div></figure><p id="66d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以找到任何容易被触发的重复请求，就像我们使用Log一样。</p><p id="183d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你点击任何一个请求时，它会显示三个不同的部分:标题、预览和响应。要查看单个部分，您可以单击每个部分。例如，如果您单击标题，它将显示以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/42086274a8531be8f29e37b30aa1d60e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MpvJER5cqhJ0n_iRSSvauQ.png"/></div></div></figure><p id="ba25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在此处查看完整的请求参数部分。这对于查看请求头部分的细节非常方便。您可以很容易地找出在触发请求时丢失的任何请求参数。</p><p id="04d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们检查预览部分:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/6a00564449739418b76f97833ac981e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bIqceaXfhgavANSdCj3pPA.png"/></div></div></figure><p id="0650" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您单击第一个节点时，它以JSON折叠格式显示，然后打开其中的对象，对内部节点也是如此。这可以帮助您非常容易地构建模型类。您甚至可以在几秒钟内找出不匹配的数据格式和期望值的缺失情况。</p><p id="1a75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">响应部分是原始格式的数据。您可以简单地将它复制粘贴到任何地方:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/a879c27622cf00ef79ad5e1a10dbd3da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MUtwLNS7_j5qU8RlE0g0zA.png"/></div></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="ae79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的设备断开连接，它会显示以下提示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/232f8c66201feab4b5c8cf8f675d540e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gPWSxHpRoKfOD6IKfHnnrQ.png"/></div></div></figure><p id="7bf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击保留日志选项的复选框，这样即使设备断开连接，您也可以查看数据。否则，数据将会丢失，您需要重新连接设备并重试。查看由脸书开发者在<a class="ae ky" href="https://github.com/facebook/stetho/tree/master/stetho-sample" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上发布的Stetho 的<a class="ae ky" href="https://github.com/facebook/stetho/tree/master/stetho-sample" rel="noopener ugc nofollow" target="_blank">样本，了解更多信息。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="bd68" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="9fcf" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">到目前为止，您应该已经了解了使用Stetho库检查网络火灾有多容易。这还不是斯特索的全部。我们只讨论了网络检查，但Stetho有更多的功能，如可视化SQLite数据库、视图层次结构、转储应用程序、JavaScript控制台等。我们可以在以后的文章中探讨这些问题。</p><p id="9a1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。请让我知道你的建议和意见。</p></div></div>    
</body>
</html>