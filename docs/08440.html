<html>
<head>
<title>Build a REST API With HarperDB and FastifyJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用HarperDB和FastifyJS构建REST API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-rest-api-with-harperdb-and-fastifyjs-ee3d8d5d6ea0?source=collection_archive---------11-----------------------#2021-04-29">https://betterprogramming.pub/build-a-rest-api-with-harperdb-and-fastifyjs-ee3d8d5d6ea0?source=collection_archive---------11-----------------------#2021-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0cca" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何结合使用这两种技术来构建REST API</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1c28163ed1231d51358206f95024f1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ie-VrqR2wp6KcrnR"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@nateggrant?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">内特·格兰特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="6634" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文将教你如何使用Node.js、<a class="ae kv" href="https://www.fastify.io/" rel="noopener ugc nofollow" target="_blank"> Fastify </a>和<a class="ae kv" href="https://harperdb.io/" rel="noopener ugc nofollow" target="_blank"> HarperDB </a>构建课程管理系统。这个应用程序将帮助您跟踪您正在进行的课程和您计划进行的课程。</p><p id="ca23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将使用以下技术:</p><ul class=""><li id="8b0b" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">节点. js</li><li id="d419" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">HarperDB</li><li id="6b30" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Fastify</li></ul></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="f957" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">介绍</h1><p id="abcc" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">说到Node.js和Fastify，人们对这些技术都很熟悉。然而，当谈到数据库，有一个新的孩子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/f827e51f31d5f1db665663091e3d4cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LZAqvNraE_dqmRbg.png"/></div></div></figure><p id="d01f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近，我从我通常用来玩HarperDB的数据库中休息了一下。HarperDB是一个具有NoSQL和SQL功能的分布式数据库。HarperDB最吸引人的地方在于，您只使用一个端点来执行所有的CRUD数据库操作。</p><p id="0654" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">HarperDB最显著的特性是:</p><ul class=""><li id="e9d6" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">使用单个端点</li><li id="53e1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">对JSON数据执行SQL查询</li><li id="ff5a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">通过以JSON数组的形式返回结果，不再需要ORM</li><li id="a615" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">能够通过JSON、CSV或使用SQL插入数据</li></ul><p id="c41f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那看起来不有趣吗？</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="d590" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">先决条件</h1><p id="68d1" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">在继续之前，您应该了解一些先决条件。本教程假设您具备以下基本知识:</p><ul class=""><li id="69df" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">Node.js和FastifyJS</li><li id="af20" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">数据库</li><li id="aabc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Java Script语言</li><li id="43bc" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">知道如何使用像npm这样的包管理器</li></ul><p id="a78c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，您应该拥有12.xx或更高版本的节点，HarperDB才能运行。最后，您需要有一个HarperDB帐户，您可以在这里创建<a class="ae kv" href="https://studio.harperdb.io/sign-up" rel="noopener ugc nofollow" target="_blank"/>。不用担心；免费的！</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="d362" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">设置文件夹结构</h1><p id="5c20" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">本教程的第一步是设置应用程序的文件夹结构。创建一个名为<code class="fe nl nm nn no b">course-management</code>的新文件夹并打开它。您可以使用以下命令来完成此操作:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="b198" class="nt mo iq no b gy nu nv l nw nx">mkdir course-management<br/>cd course-management</span></pre><p id="b0ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本的文件夹结构已经准备好。当然，当您构建应用程序的每个部分时，您会创建更多的文件夹。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="13ae" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">安装依赖项</h1><p id="faed" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">此时，您应该在<code class="fe nl nm nn no b">course-management</code>文件夹中。让我们用下面的命令初始化这个项目:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="e80c" class="nt mo iq no b gy nu nv l nw nx">npm init -y</span></pre><p id="217f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nl nm nn no b">-y</code>标志会自动生成<code class="fe nl nm nn no b">package.json</code>，而无需您回答关于项目名称、描述等常见问题。如果你打开<code class="fe nl nm nn no b">package.json</code>，你可以看到所有的字段都是自动完成的。</p><h2 id="77a4" class="nt mo iq bd mp ny nz dn mt oa ob dp mx lf oc od mz lj oe of nb ln og oh nd oi bi translated">安装所需的软件包</h2><p id="af67" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">下一步是安装构建应用程序所需的包。您可以在一行中安装多个软件包。在您的终端中运行以下命令:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="8d96" class="nt mo iq no b gy nu nv l nw nx">npm i fastify harperive dotenv --save</span></pre><p id="90c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该命令安装三个软件包/依赖项:</p><ul class=""><li id="5931" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">Fastify是一个新的web框架，它声称是镇上最快的web框架。</li><li id="d27d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://www.npmjs.com/package/harperive" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">Harper rive</strong></a>—Harper db的Node.js驱动。</li><li id="79a8" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><a class="ae kv" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> Dotenv </strong> </a> —这是一个从<code class="fe nl nm nn no b">.env</code>文件加载环境变量到<code class="fe nl nm nn no b">process.env</code>的模块。</li></ul></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="237c" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">配置Fastify服务器</h1><p id="a0b9" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">在继续配置服务器之前，您需要创建几个文件。第一步是创建以下文件:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="7709" class="nt mo iq no b gy nu nv l nw nx">touch app.js<br/>touch .env</span></pre><p id="c235" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nl nm nn no b">app.js</code>文件包含服务器配置。另一方面，<code class="fe nl nm nn no b">.env</code>文件存储了您的环境变量。</p><p id="e628" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<code class="fe nl nm nn no b">app.js</code>文件，编写以下代码:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="175b" class="nt mo iq no b gy nu nv l nw nx">const app = require('fastify')({<br/>    logger: true<br/>});<br/><br/>require('dotenv').config()<br/><br/>app.get('/', (req, res) =&gt; {<br/>    res.send({ hello: 'world' });<br/>});<br/><br/>app.listen(process.env.PORT, (err, addr) =&gt; {<br/>    if (err) {<br/>        app.log.error(err);<br/>        process.exit(1);<br/>    }<br/><br/>    app.log.info(`Your server is listening on port ${process.env.PORT} 🧨`);<br/>});</span></pre><p id="6941" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一行中，您导入Fastify包并将其存储在一个名为<code class="fe nl nm nn no b">app</code>的常量中。在同一行中，您还启用了<code class="fe nl nm nn no b">logger</code>。之后，导入Dotenv，这样就可以使用环境变量了。</p><p id="407d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，创建一个用JSON响应的GET round，然后监听在<code class="fe nl nm nn no b">.env</code>文件中指定的端口。</p><p id="91e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">继续，打开<code class="fe nl nm nn no b">.env</code>文件并添加以下几行:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="9ccf" class="nt mo iq no b gy nu nv l nw nx">PORT=3000<br/>INSTANCE_URL=<br/>INSTANCE_USERNAME=<br/>INSTANCE_PASSWORD=<br/>INSTANCE_SCHEMA=</span></pre><p id="788e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以<code class="fe nl nm nn no b">INSTANCE</code>开头的字段将保存关于数据库的信息。现在，如果您还没有一个HarperDB帐户，是时候创建一个了。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="0c7a" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">创建和配置数据库</h1><p id="0264" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">首先，登录<a class="ae kv" href="https://studio.harperdb.io/" rel="noopener ugc nofollow" target="_blank"> HarperDB工作室</a>。登录后，单击<strong class="ky ir"> + </strong>按钮，这将创建一个新的HarperDB云实例。图一。说明了这一点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/9f114ad624a723169a070258ace355bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZbJUzS4SnS68oWqf.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图一。</p></figure><p id="5dbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，将要求您选择一个新的HarperDB云实例或注册一个用户安装的实例，如图2所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/c1efb2c9f65d3cd6916fa86cb42ca3aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9unyR4rYpDSam4rl.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图二。</p></figure><p id="bb6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击按钮Create HarperDB Cloud Instance。因此，您在他们的云中创建数据库实例，而不是自己托管它。之后，您需要输入:</p><ul class=""><li id="0385" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">实例的名称</li><li id="157a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">用户名</li><li id="c8d8" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">一个密码</li></ul><p id="9830" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在图3中。，下面，你可以看到我的实例信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/9dd70a94dc6f12bf6a13a0ed49870185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/0*sW-K2KQqQGx9itj8.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图3。</p></figure><p id="aef3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是选择您的实例规范。对于本教程，我建议你选择免费选项。您可以免费获得以下规格:</p><ul class=""><li id="8414" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">0.5GB内存</li><li id="887e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">1GB存储和100 IOPS</li></ul><p id="5295" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图4。，下面说明了这一点。但是，如果您计划大量使用DB，我建议您启动实例并选择更好的规范。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/3cbef0009de69c6197721b4bb36ce01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/0*kRyqSNgR6K02eImn.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图4。</p></figure><p id="0e5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后一步是确认实例细节，然后等待实例启动。实例设置和初始化后，单击实例。例如，您可以在图5中看到我新创建的实例。，下面。</p><p id="443a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果是第一次访问实例，可能会提示您输入之前设置的用户名和密码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/7216aeba8e7b48822a4a37bab5158ebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SuuS4xNoYBYGVKW9.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图5。</p></figure><p id="ce60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的实例目前没有任何模式或表。因此，您需要首先创建一个模式。您可以看到我选择了“mydb”作为我的模式的名称(图6。).但是，您可以为您的模式使用任何其他名称。</p><p id="dcc5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为模式选择名称后，单击绿色复选标记保存它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/9b42847b04cc19b0ede707d54c77dff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4sq2iO-tC2IZCmyi.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图6。</p></figure><p id="3d74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，您需要创建表。目前，您将只设置一个名为“课程”的表输入名称“课程”并提供一个<code class="fe nl nm nn no b">hash_attribute</code>名称。哈希属性用于唯一标识每条记录。简而言之，散列属性就是ID，它对于每条记录都是唯一的。现在，单击绿色复选标记保存它，如图7所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/7b86697c34c5e14f91e2adb05a0823e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BE7jldteuo1jtif_.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图7。</p></figure><p id="e7b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以在Node.js应用程序中使用数据库了。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="e065" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">在应用程序中设置和配置HarperDB</h1><p id="a2d1" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">进入<code class="fe nl nm nn no b">.env</code>文件并添加以下几行:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="65b0" class="nt mo iq no b gy nu nv l nw nx">INSTANCE_URL=https://app-tutorial.harperdbcloud.com/<br/>INSTANCE_USERNAME=admin<br/>INSTANCE_PASSWORD=password<br/>INSTANCE_SCHEMA=mydb</span></pre><p id="1286" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，你需要用你的替换那些细节。以上信息都是虚构的，你试试也不行。</p><p id="55a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保存文件，让我们继续。现在创建两个文件夹和一个数据库文件。您可以通过执行以下命令来完成此操作:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="bc06" class="nt mo iq no b gy nu nv l nw nx">mkdir src<br/>mkdir src/db<br/>touch src/db/db_config.js</span></pre><p id="81e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用上面的命令，您在<code class="fe nl nm nn no b">src</code>中创建了<code class="fe nl nm nn no b">db</code>文件夹。此外，您还创建了一个文件<code class="fe nl nm nn no b">db_config.js</code>,用于存储数据库的配置。</p><p id="dfde" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开新创建的文件<code class="fe nl nm nn no b">db_config.js</code>并编写以下代码:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="2b70" class="nt mo iq no b gy nu nv l nw nx">const harperive = require('harperive').Client;<br/><br/>const DB_CONFIG = {<br/>    harperHost: process.env.INSTANCE_URL,<br/>    username: process.env.INSTANCE_USERNAME,<br/>    password: process.env.INSTANCE_PASSWORD,<br/>    schema: process.env.INSTANCE_SCHEMA<br/>};<br/><br/>const client = new harperive(DB_CONFIG);<br/><br/>module.exports = client;</span></pre><p id="9cff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一行中，您导入HarperDB的Node.js驱动程序。之后，您创建数据库配置，并将详细信息存储在<code class="fe nl nm nn no b">.env</code>文件中。最后，创建一个新的客户机并将其导出。</p><p id="3199" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">稍后，您将在控制器文件中使用客户端。现在，让我们来看看路线和控制器。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="b842" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">配置应用程序端点</h1><p id="15b7" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">第一步是在<code class="fe nl nm nn no b">src</code>文件夹中创建两个新文件夹。按如下方式创建它们:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="6f12" class="nt mo iq no b gy nu nv l nw nx">mkdir src/controllers<br/>mkdir src/routes</span></pre><p id="29bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，您需要在新创建的文件夹中创建两个新的JavaScript文件。创建文件<code class="fe nl nm nn no b">course.js</code>和<code class="fe nl nm nn no b">courseController.js</code>，如下所示:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="5396" class="nt mo iq no b gy nu nv l nw nx">touch src/routes/course.js<br/>touch src/controllers/courseController.js</span></pre><p id="4499" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将从创建路线开始。在这种情况下，您可以利用Fastify插件架构。因此，从<code class="fe nl nm nn no b">routes</code>文件夹中打开<code class="fe nl nm nn no b">course.js</code>文件，并编写以下代码:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="3e61" class="nt mo iq no b gy nu nv l nw nx">const courseController = require('../controllers/courseController');<br/><br/>async function routes(app, opts) {<br/><br/>}<br/><br/>module.exports = routes;</span></pre><p id="ce01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">发生了三件事:</p><ol class=""><li id="56f6" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oq ly lz ma bi translated">您可以导入用于路线的控制器。</li><li id="769c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oq ly lz ma bi translated">你创建了一个<code class="fe nl nm nn no b">routes</code>函数。</li><li id="debb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oq ly lz ma bi translated">您导出了新创建的<code class="fe nl nm nn no b">routes</code>函数。</li></ol><p id="597b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个方法中，<code class="fe nl nm nn no b">routes</code>，你配置你的应用程序的端点。对于每个路由，至少要指定HTTP方法、URL和处理程序。然而，还有许多其他参数。您可以在Fastify文档中看到<a class="ae kv" href="https://www.fastify.io/docs/latest/Routes/#options" rel="noopener ugc nofollow" target="_blank">完整列表</a>。</p><p id="feb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也就是说，让我们构建第一个端点，在被访问时返回所有课程。您可以通过调用<code class="fe nl nm nn no b">app</code>上的<code class="fe nl nm nn no b">route</code>方法来实现，如下所示:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="c2e8" class="nt mo iq no b gy nu nv l nw nx">const courseController = require('../controllers/courseController');<br/><br/>async function routes(app, opts) {<br/><br/>    // Get all courses<br/>    app.route({<br/>        method: 'GET',<br/>        url: '/courses',<br/>        handler: courseController.getCourses<br/>    });<br/>}<br/><br/>module.exports = routes;</span></pre><p id="f6b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您以类似的方式构建所有其他路由/端点。唯一改变的是方法、URL和处理程序。</p><p id="35fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下面的要点中，你可以看到所有的端点。每个CRUD操作都有一个端点。应用程序用户可以查看所有课程或特定课程，添加新课程，以及删除或编辑现有课程。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">routes.js文件</p></figure><p id="980b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意</strong>:如你所见，每个路由/端点都有一个特定的控制器。目前，它们只是占位符，因为没有控制器。这意味着，如果你试图进入路线，他们不会工作。但是这在下一步中会发生变化，因为您现在将构建应用程序逻辑。</p><p id="2de3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">继续之前还有一件事。</strong>转到根文件夹中的<code class="fe nl nm nn no b">app.js</code>并添加以下行:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="3437" class="nt mo iq no b gy nu nv l nw nx">app.register(require('./src/routes/course'));</span></pre><p id="8626" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该行的目的是使路线在您的应用程序中可用。如果您不添加这条线，您的路线将不起作用。</p><p id="26e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nl nm nn no b">app.js</code>的最终版本应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">app.js文件</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="f6ac" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">用HarperDB构建应用程序逻辑</h1><p id="fa73" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">应用程序逻辑定义了当用户请求上一节中指定的路由时会发生什么。</p><p id="aa4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，当有人访问路线<code class="fe nl nm nn no b">/courses</code>时，他们应该看到数据库中的所有课程。为此，让我们从那条路线开始。</p><p id="f7f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有路线的代码将在<code class="fe nl nm nn no b">courseController.js</code>中。打开<code class="fe nl nm nn no b">courseController.js</code>文件，导入文件顶部的Harperive客户端:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="cdad" class="nt mo iq no b gy nu nv l nw nx">const client = require("../db/db_config");</span></pre><p id="9bbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有趣的事情开始了。为了描述HarperDB的功能，您将使用SQL和NoSQL操作来操作数据。</p><h2 id="37ed" class="nt mo iq bd mp ny nz dn mt oa ob dp mx lf oc od mz lj oe of nb ln og oh nd oi bi translated">构建获取路线</h2><p id="6c96" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">在同一个文件中，在导入数据库客户机后添加以下代码:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="0ded" class="nt mo iq no b gy nu nv l nw nx">const getCourses = async (req, res) =&gt; {<br/>    const allCourses = await client.query('SELECT * FROM mydb.courses');<br/><br/>    res.send({ allCourses });<br/>};<br/><br/>module.exports = {<br/>    getCourses,<br/>}</span></pre><p id="49c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，HarperDB Node.js驱动程序允许您在数据库上运行SQL查询。上述查询从数据库中选择并返回所有课程。</p><p id="d2a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，使用<code class="fe nl nm nn no b">response</code>对象将数据发送给客户机。如果您运行应用程序并尝试访问<code class="fe nl nm nn no b">/courses</code>路线，您将不会获得任何数据，因为数据库是空的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/2070f49a3131eff5d55b97137fbbc8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7d8P4AdoScH-Q83n.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图8。</p></figure><p id="a152" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图8。说明了一个成功的请求。您可以看到数据数组是空的，因为数据库是空的。然而，一旦数据库中有了数据，我们将重复这个请求。</p><h2 id="4592" class="nt mo iq bd mp ny nz dn mt oa ob dp mx lf oc od mz lj oe of nb ln og oh nd oi bi translated">建立邮政路线</h2><p id="cf0f" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">下一步是构建POST路径，这样就可以将数据添加到数据库中。在这种情况下，我们将使用NoSQL操作。在<code class="fe nl nm nn no b">getCourses</code>常量后编写以下代码:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="4634" class="nt mo iq no b gy nu nv l nw nx">const addCourse = async (req, res) =&gt; {<br/>    const allProperties = Object.keys(req.body).length;<br/><br/>    if (allProperties !== 4) {<br/>        res.code(400).send({ <br/>            error: 'Some properties are missing! Add the name, description, author and link!' <br/>        });<br/><br/>        return;<br/>    }<br/><br/>    try {<br/>        const newCourse = await client.insert({<br/>            table: 'courses',<br/>            records: [<br/>                {<br/>                    name: req.body.name,<br/>                    description: req.body.description,<br/>                    author: req.body.author,<br/>                    link: req.body.link<br/>                }<br/>            ]<br/>        });<br/><br/>        res.send({ newCourse });<br/>    } catch (error) {<br/>        res.send({ error });<br/>    }<br/>};<br/><br/>module.exports = {<br/>    getCourses,<br/>    addCourse,<br/>}</span></pre><p id="02ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，<code class="fe nl nm nn no b">try catch</code>块之前的部分确保用户提供所有的字段。如果用户试图在没有指定名称、描述、作者或链接的情况下添加课程，将会返回一个错误。用户必须始终提供所有四个字段。</p><p id="cae0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，在<code class="fe nl nm nn no b">try catch</code>块中，使用数据库客户端将新课程插入数据库。</p><ul class=""><li id="b3e6" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">您需要指定表格(在本例中是<code class="fe nl nm nn no b">courses</code>)，然后指定<code class="fe nl nm nn no b">records</code>。</li><li id="ba1e" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">字段是一个对象数组，这意味着您可以一次输入多个课程。然而，就目前而言，一个就够了。</li></ul><p id="8e28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果插入成功，它将返回新添加的课程。您可以在图9中看到运行中的路由。，下面。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/a38b7048ca6f296870526141c93b99ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CX2Q4wrMdUo45F_v.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图9。</p></figure><p id="58b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">操作成功，新课程被添加到数据库中。图10。显示数据库中的课程。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/0290d40c86ec0bca5d64705fad6da03a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MZGsLj-CO9uZGEea.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图10。</p></figure><h2 id="d671" class="nt mo iq bd mp ny nz dn mt oa ob dp mx lf oc od mz lj oe of nb ln og oh nd oi bi translated">获得特定课程</h2><p id="4a3d" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">获取特定课程与获取所有课程类似，但有一点不同。现在，您使用一个<code class="fe nl nm nn no b">WHERE</code>子句来选择一门特定的课程。</p><p id="fa06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您在URL中传递课程ID，然后SQL查询将它与数据库中的记录进行匹配。</p><p id="d0e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但首先，“我如何获得ID？”你可能会问。有两种选择。(注意:首先需要数据库中的课程。)</p><ol class=""><li id="8602" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr oq ly lz ma bi translated">你可以访问路线<code class="fe nl nm nn no b">http://localhost:3000/courses</code>并获得你想要的任何课程的ID。</li><li id="4dfd" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr oq ly lz ma bi translated">去HarperDB工作室，点击课程，你会看到所有的细节。在页面的顶部，您会看到它指定了哪个是ID(参见图10。，以上)。</li></ol><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="b4cb" class="nt mo iq no b gy nu nv l nw nx">const getSpecificCourse = async (req, res) =&gt; {<br/>    const course = await client.query(`SELECT * FROM mydb.courses WHERE id="${req.params.id}"`);<br/><br/>    res.send({ course });<br/>};<br/><br/>module.exports = {<br/>    getCourses,<br/>    addCourse,<br/>    getSpecificCourse,<br/>}</span></pre><p id="c6d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，它返回路线。图11。，说明了当您发出GET请求以获取特定课程时会发生什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/c00fb3b33db2df624e147b3434533edd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oios8lx9cfrbl-Mb.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图11。</p></figure><h2 id="6186" class="nt mo iq bd mp ny nz dn mt oa ob dp mx lf oc od mz lj oe of nb ln og oh nd oi bi translated">删除特定课程</h2><p id="dc89" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">您可以通过在URL中提供课程ID来删除课程。例如，如果您向<code class="fe nl nm nn no b">http://localhost:3000/courses/0eb95456-255b-44da-b3df-b90671ef0908</code>发出删除请求，您将删除具有指定ID的课程。</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="cac0" class="nt mo iq no b gy nu nv l nw nx">const deleteCourse = async (req, res) =&gt; {<br/>    const course = await client.query(`DELETE FROM mydb.courses WHERE id="${req.params.id}"`);<br/><br/>    res.send({ <br/>        message: 'Course deleted!',<br/>        deleteCourse: course<br/>     });<br/>};<br/><br/>module.exports = {<br/>    getCourses,<br/>    addCourse,<br/>    getSpecificCourse,<br/>    deleteCourse<br/>}</span></pre><p id="498d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦课程被删除，它会发送一条确认消息和一些额外的信息。图12。说明了一个删除请求。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/df657a9fc650cf9f49b381f89d54134f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*caNmvLsDZNFBqjuV.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图12。</p></figure><h2 id="f2e3" class="nt mo iq bd mp ny nz dn mt oa ob dp mx lf oc od mz lj oe of nb ln og oh nd oi bi translated">构建PUT路线</h2><p id="18d0" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">最后，这条路线允许您更新现有的课程。在<code class="fe nl nm nn no b">try catch</code>块之前的所有代码确保用户只使用允许的字段:名称、描述、作者和链接。如果用户试图更新一个不存在的字段，服务器将返回一个错误。</p><p id="51a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要编辑课程，您需要再次使用NoSQL操作。在数据库客户机上调用<code class="fe nl nm nn no b">update</code>方法，然后传递表名(在本例中是<code class="fe nl nm nn no b">courses</code>)和想要更新的记录。</p><p id="0775" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，在记录数组中指定<code class="fe nl nm nn no b">id</code>也很重要。如果不这样做，服务器就不知道要更新哪条记录。</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="a0ea" class="nt mo iq no b gy nu nv l nw nx">const editCourse = async (req, res) =&gt; {<br/>    const updates = Object.keys(req.body);<br/>    const allowedUpdates = ['name', 'description', 'author', 'link'];<br/>    const isValidOperation = updates.every((update) =&gt; allowedUpdates.includes(update));<br/><br/>    if (!isValidOperation) {<br/>        res.code(400).send({ error: 'Not a valid operation! '});<br/><br/>        return;<br/>    }<br/><br/>    try {<br/>        const updatedCourse = await client.update({<br/>            table: 'courses',<br/>            records: [<br/>                {<br/>                    id: req.params.id,<br/>                    name: req.body.name,<br/>                    description: req.body.description,<br/>                    author: req.body.author,<br/>                    link: req.body.link<br/>                }<br/>            ]<br/>        });<br/><br/>        res.send({ updatedCourse });<br/>    } catch (error) {<br/>        res.send({ error });<br/>    }<br/>};<br/><br/>module.exports = {<br/>    getCourses,<br/>    addCourse,<br/>    getSpecificCourse,<br/>    deleteCourse,<br/>    editCourse<br/>}</span></pre><p id="e302" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果有错误，服务器会发回错误。否则，它返回更新的课程。下图显示了如何发出一个PUT请求，以及当它成功时会发生什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/b93d20c29ab4d80d5b09fc4868c92f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-MJuZI2-vtV6PH2u.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图13。</p></figure><p id="b737" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些都是关于路线和控制器的。你可以在<a class="ae kv" href="https://gist.github.com/catalinpit/191cbb0db15a52121e28461b31bc0a35" rel="noopener ugc nofollow" target="_blank">这个要诀</a>里看到整个<code class="fe nl nm nn no b">courseController.js</code>文件。我选择不嵌入它，因为它很大，在页面上占了很大的空间。</p><p id="edfe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样的，你可以<strong class="ky ir">在</strong><a class="ae kv" href="https://github.com/catalinpit/harperdb-fastifyjs-rest-api" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">my GitHub</strong></a>上看到完整的应用。为了更好地学习，经历它，改变东西，打破东西，增加东西，等等。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="3928" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">如何启动应用程序</h1><p id="48eb" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">您可以通过运行根文件夹中的<code class="fe nl nm nn no b">node app.js</code>来启动应用程序。</p><p id="7ea0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，如果您从GitHub克隆应用程序，您需要首先安装依赖项。您可以通过运行以下命令来实现:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="fd33" class="nt mo iq no b gy nu nv l nw nx">npm install<br/>node app.js</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="63a2" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">结论</h1><p id="f34a" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">至此，您应该有了一个REST API，它允许您存储和操作课程。本教程的目的是快速掌握这两种技术。因此，可以添加其他内容，例如:</p><ul class=""><li id="8ac2" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">授权</li><li id="abb2" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">API速率限制</li><li id="1bc1" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">添加一个前端，并将其转换为全栈应用程序</li></ul><p id="b5f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也就是说，如果你喜欢这个教程，想要第2部分，我用Vue构建前端，请在评论中告诉我。</p></div></div>    
</body>
</html>