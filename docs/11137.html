<html>
<head>
<title>What’s the Purpose of Code Reviews?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码评审的目的是什么？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-purpose-of-code-review-c9942ee551e2?source=collection_archive---------10-----------------------#2022-02-21">https://betterprogramming.pub/the-purpose-of-code-review-c9942ee551e2?source=collection_archive---------10-----------------------#2022-02-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e68a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">代码评审(通常称为同行评审或拉式请求)是软件开发过程中非常基本的一部分。我们都知道这意味着什么吗？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ab6f2967f5d036f0a01764d25ed1e32a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nccPfLSKfgxseVfF"/></div></div></figure><blockquote class="ku kv kw"><p id="3385" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">免责声明:在这篇文章中，我可能会举一些我在微软、谷歌或其他我工作过的地方的例子。我必须说，这篇文章完全是我个人观点的反映，不代表任何官方立场。我引用了谷歌公开的工程实践——但是这些陈述的扩展是基于我个人的信念。</p></blockquote><h1 id="6d0a" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">什么是代码审查</h1><blockquote class="ku kv kw"><p id="5d1e" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">代码评审</strong>(有时也称为同行评审)是一项软件质量保证活动，一个或几个人主要通过查看和阅读程序的部分源代码来检查程序，他们在程序实现后或中断实现时进行检查。</p></blockquote><p id="dfb7" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">这个片段当然来自<a class="ae mp" href="https://en.wikipedia.org/wiki/Code_review" rel="noopener ugc nofollow" target="_blank">维基百科</a>，我认为一个更小的声明会更好，尤其是最后一部分。我试试我的版本:</p><p id="4721" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">代码评审是一种非常普遍的软件开发实践，其中代码"<strong class="la iu"> author </strong>"在提交给代码库之前发送一个新的代码变更供评审。一个或多个"<strong class="la iu">评审者</strong>"评审"<strong class="la iu">代码差异</strong>"并可选地共享建议/评论以供作者处理或批准代码提交。之后作者可以提交代码。</p><blockquote class="ku kv kw"><p id="cdf2" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，维基百科的文章可能做得更好！</p></blockquote><p id="3c7e" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">让我们再次就关键人物角色达成一致，因为我将在整篇文章中使用相同的术语:</p><ul class=""><li id="83c0" class="mq mr it la b lb lc le lf mm ms mn mt mo mu lt mv mw mx my bi translated"><strong class="la iu">作者</strong>:编写代码并提交审查的人</li><li id="8e8d" class="mq mr it la b lb mz le na mm nb mn nc mo nd lt mv mw mx my bi translated"><strong class="la iu">审查者</strong>:审查代码的人，可以选择为作者留下评论或建议，也可以选择批准代码提交。</li><li id="94a5" class="mq mr it la b lb mz le na mm nb mn nc mo nd lt mv mw mx my bi translated"><strong class="la iu">代码差异</strong>:在代码评审中对代码库进行的添加、删除或修改。</li></ul></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="753a" class="lu lv it bd lw lx nl lz ma mb nm md me jz nn ka mg kc no kd mi kf np kg mk ml bi translated">为什么要做代码评审？</h1><h2 id="b0ff" class="nq lv it bd lw nr ns dn ma nt nu dp me mm nv nw mg mn nx ny mi mo nz oa mk ob bi translated">代码健康</h2><blockquote class="oc"><p id="bae2" class="od oe it bd of og oh oi oj ok ol lt dk translated">代码评审的主要目的是确保代码库的代码健康状况随着时间的推移而改善。</p></blockquote><p id="251a" class="pw-post-body-paragraph kx ky it la b lb om ju ld le on jx lg mm oo lj lk mn op ln lo mo oq lr ls lt im bi translated">—摘自在线提供的<a class="ae mp" href="https://google.github.io/eng-practices/review/reviewer/standard.html" rel="noopener ugc nofollow" target="_blank">谷歌最佳实践</a>。</p><p id="39bd" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">代码健康是一个“概念”，用于跟踪代码库(一个或多个开发人员在其上编写代码)是否可维护、可读、稳定(或不易出错)、可构建和可测试。</p><p id="09f2" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">这让我想知道一个空的代码库是否是完全健康的？也许是的，但是工程团队的主要目标是通过构建新功能或解决现有的bug来构建或维护产品，这是通过对代码库进行更改来实现的。但是它不一定保证代码审查。</p><p id="dc83" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">因此，结合这两者——审查者的职责——代码审查过程是为了确保，随着组织在构建产品方面不断取得进展，代码库的质量不会随着时间的推移而降低。这不是一个没有例外的规则——经常有这样的时候，约束要求作者走捷径来完成目标，但是继续改进代码库健康的一般目的仍然存在。</p><h2 id="1a87" class="nq lv it bd lw nr ns dn ma nt nu dp me mm nv nw mg mn nx ny mi mo nz oa mk ob bi translated">一致性</h2><p id="7f99" class="pw-post-body-paragraph kx ky it la b lb or ju ld le os jx lg mm ot lj lk mn ou ln lo mo ov lr ls lt im bi translated">这可以被认为是代码健康改进的一个子集——但是值得一提。</p><blockquote class="oc"><p id="0fa1" class="od oe it bd of og oh oi oj ok ol lt dk translated">评审者对他们所评审的代码拥有所有权和责任。他们希望确保代码库保持一致和可维护。</p></blockquote><p id="cc2b" class="pw-post-body-paragraph kx ky it la b lb om ju ld le on jx lg mm oo lj lk mn op ln lo mo oq lr ls lt im bi translated">一致的代码库更容易理解，因此更容易维护。一致的代码可以帮助提高工程团队的速度。</p><p id="f4da" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">如果你想知道是谁定义了一致性，这一节可能是一本好书。</p><h2 id="6085" class="nq lv it bd lw nr ns dn ma nt nu dp me mm nv nw mg mn nx ny mi mo nz oa mk ob bi translated">专家评审</h2><p id="2ff7" class="pw-post-body-paragraph kx ky it la b lb or ju ld le os jx lg mm ot lj lk mn ou ln lo mo ov lr ls lt im bi translated">有时评审者可能不是代码库的所有者，而是代码变更所涉及的主题的专家。例如，如果作者在他们的产品中实现加密——让具有隐私或加密专业知识的其他人审阅代码可能是可取和有用的，即使他们不是代码库的所有者。</p><h2 id="6183" class="nq lv it bd lw nr ns dn ma nt nu dp me mm nv nw mg mn nx ny mi mo nz oa mk ob bi translated">指导</h2><p id="9c93" class="pw-post-body-paragraph kx ky it la b lb or ju ld le os jx lg mm ot lj lk mn ou ln lo mo ov lr ls lt im bi translated">评审人员通常可以将代码评审作为指导作者学习新东西的机会，比如新语言、框架或设计原则。</p><blockquote class="oc"><p id="a23e" class="od oe it bd of og oh oi oj ok ol lt dk translated">随着时间的推移，共享知识是改善系统代码健康的一部分。</p></blockquote><p id="97e0" class="pw-post-body-paragraph kx ky it la b lb om ju ld le on jx lg mm oo lj lk mn op ln lo mo oq lr ls lt im bi translated">我相信，评审人员也可以把代码评审作为学习新东西的机会。关于这个话题，我还有很多要补充的——我会单独写出来。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4152939c4d502fca73bce50fe3d81dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A6fqcE70yO9-CPAN"/></div></div><p class="ow ox gj gh gi oy oz bd b be z dk translated">要求我们等待的交通灯！</p></figure><h1 id="2577" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">代码审查不是为了什么？</h1><h2 id="8c92" class="nq lv it bd lw nr ns dn ma nt nu dp me mm nv nw mg mn nx ny mi mo nz oa mk ob bi translated">降低代码提交速度</h2><p id="9d9e" class="pw-post-body-paragraph kx ky it la b lb or ju ld le os jx lg mm ot lj lk mn ou ln lo mo ov lr ls lt im bi translated">目的不是让代码提交变得难以置信的困难——那会阻碍作者在未来进行代码改进。如果作者没有在他们的任务中取得进展，代码健康就不能得到改善。</p><blockquote class="oc"><p id="d56b" class="od oe it bd of og oh oi oj ok ol lt dk translated">一般来说，一旦代码评审确实改善了正在工作的系统的整体代码健康状况，评审者应该赞成批准代码评审，即使变化并不完美。</p></blockquote><p id="cba8" class="pw-post-body-paragraph kx ky it la b lb om ju ld le on jx lg mm oo lj lk mn op ln lo mo oq lr ls lt im bi translated">除非，如果代码评审有评审者不希望在他们的系统中出现的变更——即使这些变更是精心设计的。</p><h2 id="7b0b" class="nq lv it bd lw nr ns dn ma nt nu dp me mm nv nw mg mn nx ny mi mo nz oa mk ob bi translated">强加个人偏好</h2><blockquote class="oc"><p id="7743" class="od oe it bd of og oh oi oj ok ol lt dk translated">技术事实和数据推翻意见和个人偏好。</p></blockquote><p id="5a33" class="pw-post-body-paragraph kx ky it la b lb om ju ld le on jx lg mm oo lj lk mn op ln lo mo oq lr ls lt im bi translated">我经常为此感到内疚，并学习变得更好。</p><p id="7d6c" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">如果是风格的问题，风格指南应该被认为是绝对的权威。风格指南基本上是不同语言的一套公认的规则。一个团队或组织可以从零开始定义它们，或者使用广泛采用的标准，如python的<a class="ae mp" href="https://www.python.org/dev/peps/pep-0008/" rel="noopener ugc nofollow" target="_blank"> PEP </a>或C++的<a class="ae mp" href="https://google.github.io/styleguide/cppguide.html" rel="noopener ugc nofollow" target="_blank"> cppguide </a>。几乎所有语言都有类似的标准。</p><p id="2ea3" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">如果是设计问题，技术事实和数据应该比个人偏好更重要。软件设计的标准原则经常会派上用场，但是如果作者能够证明其他选择同样有效或者更好——评审应该接受它。</p><h2 id="9583" class="nq lv it bd lw nr ns dn ma nt nu dp me mm nv nw mg mn nx ny mi mo nz oa mk ob bi translated">战斗审判</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/9dec2d1330f29e0ba3ec7379507c78e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ByjWkvgaCvnvgKme.jpg"/></div></div><p class="ow ox gj gh gi oy oz bd b be z dk translated">《权力的游戏》截图。</p></figure><p id="25bb" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">代码评审的目的绝对不是确定谁是对的或者谁更好。我断言这是为了改善代码的健康。有时代码审查会导致作者和审查者之间的分歧。在这种情况下，代码评审不应该用来决定谁赢，而是让双方达成共识，学习新的东西。</p><p id="ad6e" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated"><a class="ae mp" href="https://google.github.io/eng-practices/review/reviewer/standard.html#conflicts" rel="noopener ugc nofollow" target="_blank">这部分</a>对解决冲突有很好的建议。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/622fce025aeff57b0657fa87ae5d8404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KN0oel0FRNPEV0EY"/></div></div></figure><h1 id="3dea" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">代码审查是强制性的吗？</h1><p id="417a" class="pw-post-body-paragraph kx ky it la b lb or ju ld le os jx lg mm ot lj lk mn ou ln lo mo ov lr ls lt im bi translated">这取决于组织和团队。我曾在不做代码审查的团队中工作过。我会说</p><blockquote class="oc"><p id="cfa4" class="od oe it bd of og oh oi oj ok ol lt dk translated">一个不进行代码评审的团队将会在早期取得快速的进展，而在后期取得缓慢的进展。</p></blockquote><p id="75e6" class="pw-post-body-paragraph kx ky it la b lb om ju ld le on jx lg mm oo lj lk mn op ln lo mo oq lr ls lt im bi translated">因此，在原型阶段跳过代码审查可能是可以的，但是如果你正在构建最终客户使用的严肃产品，代码审查只会有助于确保你保持他们的信任完好无损。</p><p id="8780" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">此外，为了代码评审而进行代码评审可能没有帮助——领导者应该确保评审过程是健康的，并增加它应该有的价值。这是一种被广泛遵循的做法，你可以在网上找到保持这一过程健康的好指南。</p><p id="448a" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">请允许我分享一个我个人的例子，在我之前的一份工作中</p><blockquote class="ku kv kw"><p id="8ba2" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们有几个工程师，他们拥有属于一个产品的不同的微服务，每个人都有不同的代码库。此外，我们有组织范围的政策，要求每个代码提交通过代码审查。目前没有危险信号！</p><p id="6e15" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，工程师审查代码的动机并不明确。因此，我们不得不去找一个人来同意每次都审查代码。最终，我们建立了一个“伙伴系统”(超级非官方):</p><p id="93ed" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">“你认可我的代码，我也认可你的代码”。</p><p id="4a2d" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这很糟糕，代码审查没有以正确的动机进行。作为作者，审查代码变得很容易(使用上述策略)，但是最终代码作者(通常对他们的代码有信心)开始跳过编写单元测试并提交代码——审查系统没有标记它。</p><p id="19ef" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在一段较长的时间内，这会导致一个或多个超出我们预期的生产问题。这些问题本可以更早发现，从而以更低的成本得到解决。</p></blockquote><p id="3b83" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">这类问题可以通过领导监督和良好的组织政策来解决。如果你(读者)是某个地方的工程领导——我非常想知道你如何在团队中发现这种危险信号并解决它们。欢迎直接评论。</p><p id="0ba7" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mm li lj lk mn lm ln lo mo lq lr ls lt im bi translated">我在谷歌在这方面的经验非常好，那里的工程实践相当扎实。我的最新观点是——在我工作的地方——我绝对希望代码审查对于所有提交到代码库的产品代码是强制性的，并有良好的指导规则和工具集来简化这个过程。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="1c50" class="lu lv it bd lw lx nl lz ma mb nm md me jz nn ka mg kc no kd mi kf np kg mk ml bi translated">结束语</h1><blockquote class="oc"><p id="98d9" class="od oe it bd of og oh oi oj ok ol lt dk translated">这里的一个关键点是，没有所谓的“完美”代码，只有更好的代码。</p><p id="03ec" class="od oe it bd of og oh oi oj ok ol lt dk translated">技术事实和数据推翻意见和个人偏好。</p></blockquote><h1 id="6e7d" class="lu lv it bd lw lx ly lz ma mb mc md me jz pc ka mg kc pd kd mi kf pe kg mk ml bi translated">参考</h1><ul class=""><li id="8f08" class="mq mr it la b lb or le os mm pf mn pg mo ph lt mv mw mx my bi translated"><a class="ae mp" href="https://google.github.io/eng-practices/review/reviewer/standard.html" rel="noopener ugc nofollow" target="_blank">代码审查的标准</a> — Google Eng practices(开源)</li><li id="daf4" class="mq mr it la b lb mz le na mm nb mn nc mo nd lt mv mw mx my bi translated"><a class="ae mp" href="https://google.github.io/eng-practices/review/reviewer/looking-for.html#consistency" rel="noopener ugc nofollow" target="_blank">在代码审查中寻找什么</a>——谷歌工程实践(开源)</li><li id="16f7" class="mq mr it la b lb mz le na mm nb mn nc mo nd lt mv mw mx my bi translated"><a class="ae mp" href="https://google.github.io/eng-practices/review/developer/" rel="noopener ugc nofollow" target="_blank">CL作者的代码审查指南</a></li><li id="aa4e" class="mq mr it la b lb mz le na mm nb mn nc mo nd lt mv mw mx my bi translated"><a class="ae mp" href="https://www.mediawiki.org/wiki/Code_Health" rel="noopener ugc nofollow" target="_blank">代码健康— MediaWiki </a></li></ul><h2 id="3f23" class="nq lv it bd lw nr ns dn ma nt nu dp me mm nv nw mg mn nx ny mi mo nz oa mk ob bi translated">图片致谢</h2><ul class=""><li id="f4d8" class="mq mr it la b lb or le os mm pf mn pg mo ph lt mv mw mx my bi translated">杰佛逊·桑托斯在<a class="ae mp" href="https://unsplash.com/photos/9SoCnyQmkzI" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</li><li id="8c2d" class="mq mr it la b lb mz le na mm nb mn nc mo nd lt mv mw mx my bi translated"><a class="ae mp" href="https://unsplash.com/@leohoho" rel="noopener ugc nofollow" target="_blank"> Leohoho </a>在<a class="ae mp" href="https://unsplash.com/photos/dO8OGz3IayQ" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</li><li id="a2d8" class="mq mr it la b lb mz le na mm nb mn nc mo nd lt mv mw mx my bi translated"><a class="ae mp" href="https://unsplash.com/@tingeyinjurylawfirm" rel="noopener ugc nofollow" target="_blank">廷杰伤害律师事务所</a>在<a class="ae mp" href="https://unsplash.com/photos/veNb0DDegzE" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>的照片。</li></ul></div></div>    
</body>
</html>