<html>
<head>
<title>Introduction To Locust: An Open-Source Load Testing Tool in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Locust简介:Python中的一个开源负载测试工具</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/introduction-to-locust-an-open-source-load-testing-tool-in-python-2b2e89ea1ff?source=collection_archive---------0-----------------------#2020-01-03">https://betterprogramming.pub/introduction-to-locust-an-open-source-load-testing-tool-in-python-2b2e89ea1ff?source=collection_archive---------0-----------------------#2020-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5ad8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Tsung和JMeter的基于Python的替代方案，用于对服务器进行负载测试</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/7ee50731d6e70da7901b4b89cab37111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*iHbPgMP5K4WWaP2RDBD37w.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">图片来源:官方<a class="ae ku" href="https://locust.io/" rel="noopener ugc nofollow" target="_blank">蝗虫网站</a></p></figure><p id="1ce2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">受够了对现有服务器进行基准测试和负载测试的现有工具，我最近在我的一个项目中找到了一个名为<code class="fe lr ls lt lu b">Locust</code>的开源工具。</p><p id="d5fa" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">通过阅读这篇文章，您将能够使用这个负载测试工具。这为您提供了服务器每秒支持多少请求(RPS)的粗略概念。根据<a class="ae ku" href="https://docs.locust.io/en/stable/" rel="noopener ugc nofollow" target="_blank">官方文献</a>记载，蝗虫是:</p><blockquote class="lv lw lx"><p id="891f" class="kv kw ly kx b ky kz ju la lb lc jx ld lz lf lg lh ma lj lk ll mb ln lo lp lq im bi translated">“…一个易于使用的分布式用户负载测试工具。它旨在对网站(或其他系统)进行负载测试，并计算出一个系统可以处理多少并发用户。</p><p id="cfe5" class="kv kw ly kx b ky kz ju la lb lc jx ld lz lf lg lh ma lj lk ll mb ln lo lp lq im bi translated">这个想法是在测试期间，一群蝗虫会攻击你的网站。每个蝗虫(或者测试用户，如果你愿意的话)的行为是由你定义的，群集过程是由一个web用户界面实时监控的。这将有助于您在让真正的用户进入之前测试和识别代码中的瓶颈。</p><p id="eaca" class="kv kw ly kx b ky kz ju la lb lc jx ld lz lf lg lh ma lj lk ll mb ln lo lp lq im bi translated">Locust是完全基于事件的，因此可以在一台机器上支持成千上万的并发用户。与许多其他基于事件的应用相比，它不使用回调。相反，它通过gevent使用轻量级流程。每一个蜂拥而至的蝗虫实际上都运行在自己的进程中(准确地说，是greenlet)。这允许您用Python编写非常有表现力的场景，而不会因为回调而使代码变得复杂。"</p></blockquote><p id="40ca" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">本教程有四个部分:</p><ol class=""><li id="d027" class="mc md it kx b ky kz lb lc le me li mf lm mg lq mh mi mj mk bi translated"><strong class="kx iu">设置</strong></li><li id="815d" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq mh mi mj mk bi translated"><strong class="kx iu">基本用法</strong></li><li id="08d9" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq mh mi mj mk bi translated"><strong class="kx iu">命令行界面</strong></li><li id="c31e" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq mh mi mj mk bi translated"><strong class="kx iu">结论</strong></li></ol><p id="0944" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们开始吧！</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="2fef" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">1.设置</h1><p id="e8c5" class="pw-post-body-paragraph kv kw it kx b ky np ju la lb nq jx ld le nr lg lh li ns lk ll lm nt lo lp lq im bi translated">安装非常简单，因为3.6、3.7和3.8(从版本0.14开始)都支持<code class="fe lr ls lt lu b">Locust</code>。您可以根据您的Python版本运行适当的pip命令来安装它。强烈建议先设置一个虚拟环境。</p><p id="4302" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">请注意蝗虫已经从<code class="fe lr ls lt lu b">locustio</code>改名为<code class="fe lr ls lt lu b">locust</code>。</p><h2 id="80c3" class="nu my it bd mz nv nw dn nd nx ny dp nh le nz oa nj li ob oc nl lm od oe nn of bi translated">Python 3</h2><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="c919" class="nu my it lu b gy ok ol l om on">pip install locust</span></pre><h2 id="6883" class="nu my it bd mz nv nw dn nd nx ny dp nh le nz oa nj li ob oc nl lm od oe nn of bi translated">来自git的最新主分支</h2><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="b920" class="nu my it lu b gy ok ol l om on">pip install -e git://github.com/locustio/locust.git@master#egg=locust</span></pre><p id="4617" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">上面提到的步骤应该适用于Linux和Windows。如果事情没有按预期进行，请尝试以下方法。</p><h2 id="b19c" class="nu my it bd mz nv nw dn nd nx ny dp nh le nz oa nj li ob oc nl lm od oe nn of bi translated">Windows的可选修复程序</h2><p id="0c2d" class="pw-post-body-paragraph kv kw it kx b ky np ju la lb nq jx ld le nr lg lh li ns lk ll lm nt lo lp lq im bi translated">首先，前往以下<a class="ae ku" href="https://www.lfd.uci.edu/~gohlke/pythonlibs/" rel="noopener ugc nofollow" target="_blank">网站</a>下载预构建的二进制包:</p><ul class=""><li id="e122" class="mc md it kx b ky kz lb lc le me li mf lm mg lq oo mi mj mk bi translated">pyzmq</li><li id="7391" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated">gevent</li><li id="343a" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated">一种绿色小鸟</li></ul><p id="84be" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您应该有wheel文件，可以通过运行以下命令来安装每个文件:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="46d8" class="nu my it lu b gy ok ol l om on">pip install name-of-the-package.whl</span></pre><p id="5d00" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">完成后，只需运行pip安装。</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="8b68" class="nu my it lu b gy ok ol l om on">pip install locust</span></pre><h2 id="b483" class="nu my it bd mz nv nw dn nd nx ny dp nh le nz oa nj li ob oc nl lm od oe nn of bi translated">马科斯</h2><p id="2050" class="pw-post-body-paragraph kv kw it kx b ky np ju la lb nq jx ld le nr lg lh li ns lk ll lm nt lo lp lq im bi translated">MacOS要求在安装pip之前安装<code class="fe lr ls lt lu b">gevent</code>。最简单的方法是安装<a class="ae ku" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">自制软件</a>:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="6e01" class="nu my it lu b gy ok ol l om on">/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</span></pre><p id="1436" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然后，安装<code class="fe lr ls lt lu b">gevent</code>的依赖项<code class="fe lr ls lt lu b">libev</code>:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="a58e" class="nu my it lu b gy ok ol l om on">brew install libev</span></pre><p id="b60a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然后通过<code class="fe lr ls lt lu b">pip install</code>安装蝗虫。</p><h2 id="3087" class="nu my it bd mz nv nw dn nd nx ny dp nh le nz oa nj li ob oc nl lm od oe nn of bi translated">测试蝗虫装置</h2><p id="7bc4" class="pw-post-body-paragraph kv kw it kx b ky np ju la lb nq jx ld le nr lg lh li ns lk ll lm nt lo lp lq im bi translated">完成后，您可以通过在命令行中运行以下代码来测试它:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="0ab6" class="nu my it lu b gy ok ol l om on">locust --help</span></pre><p id="f9b0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您应该会看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oq or di os bf ot"><div class="gh gi op"><img src="../Images/db2d9fc05c8aee01573678cb41294e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hksDORR_nCjtJWqsrpx_4g.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="fd91" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在下一节中，我们将探索该模块提供的基本功能，并了解如何编写一个测试脚本来对您自己的服务器进行负载测试。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="99a2" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">2.基本用法</h1><h2 id="56e2" class="nu my it bd mz nv nw dn nd nx ny dp nh le nz oa nj li ob oc nl lm od oe nn of bi translated">Flask服务器</h2><p id="a8eb" class="pw-post-body-paragraph kv kw it kx b ky np ju la lb nq jx ld le nr lg lh li ns lk ll lm nt lo lp lq im bi translated">假设您有下面的Flask开发服务器文件，<code class="fe lr ls lt lu b">myapp.py</code>，它已经准备好进行负载测试了:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="277f" class="nu my it lu b gy ok ol l om on">from flask import Flask</span><span id="1ad8" class="nu my it lu b gy ou ol l om on">server_port = 5000<br/>app = Flask(__name__)</span><span id="15f6" class="nu my it lu b gy ou ol l om on"><a class="ae ku" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/')<br/>def hello_world():<br/>    return 'Hello, World!'</span><span id="2ca9" class="nu my it lu b gy ou ol l om on">if __name__ == "__main__":<br/>    app.run('0.0.0.0',port=server_port)</span></pre><p id="293f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">只需在终端中通过以下代码运行服务器:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="9e48" class="nu my it lu b gy ok ol l om on">python myapp.py</span></pre><p id="1327" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您应该能够通过localhost:5000访问服务器，并看到<code class="fe lr ls lt lu b">Hello World</code>输出。</p><h2 id="59d4" class="nu my it bd mz nv nw dn nd nx ny dp nh le nz oa nj li ob oc nl lm od oe nn of bi translated">蝗虫脚本</h2><p id="a57f" class="pw-post-body-paragraph kv kw it kx b ky np ju la lb nq jx ld le nr lg lh li ns lk ll lm nt lo lp lq im bi translated">创建一个名为<code class="fe lr ls lt lu b">locustfile.py</code>的新文件。向其中添加以下导入语句:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="bddf" class="nu my it lu b gy ok ol l om on">from locust import HttpUser, task, between</span></pre><p id="86c6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">继续编写继承了<code class="fe lr ls lt lu b">HttpUser</code>类的类。您可以根据自己的喜好命名该类。</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="c736" class="nu my it lu b gy ok ol l om on">class WebsiteTestUser(HttpUser):</span></pre><p id="b2a0" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在该类中，您可以定义自己的函数作为locust的任务。默认情况下，它提供了两个基类，将在<code class="fe lr ls lt lu b">Locust</code>调用的开始和停止期间调用:</p><ul class=""><li id="df54" class="mc md it kx b ky kz lb lc le me li mf lm mg lq oo mi mj mk bi translated">开启_启动</li><li id="0430" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated">开_停</li></ul><p id="145e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果你在一个函数上添加<code class="fe lr ls lt lu b">@task</code>装饰器，它将被视为一个Locust的任务。下面的例子显示了一个测试<code class="fe lr ls lt lu b">localhost:5000</code> API的简单任务:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="62a5" class="nu my it lu b gy ok ol l om on"><a class="ae ku" href="http://twitter.com/task" rel="noopener ugc nofollow" target="_blank">@task</a>(1)<br/>def hello_world(self):<br/>    self.client.get("<a class="ae ku" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a>")</span></pre><p id="c497" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您必须修改后续任务的编号，如下所示:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="3ac6" class="nu my it lu b gy ok ol l om on"><a class="ae ku" href="http://twitter.com/task" rel="noopener ugc nofollow" target="_blank">@task</a>(1)<br/>def hello_world(self):<br/>    self.client.get("<a class="ae ku" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a>")</span><span id="674b" class="nu my it lu b gy ou ol l om on"><a class="ae ku" href="http://twitter.com/task" rel="noopener ugc nofollow" target="_blank">@task</a>(2)<br/>def index(self):<br/>    self.client.get("<a class="ae ku" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a>/index")</span></pre><p id="c7f4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果你想设置一个<code class="fe lr ls lt lu b">POST</code>请求任务，你可以使用下面的代码:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="d50d" class="nu my it lu b gy ok ol l om on">self.client.post("/login", {"username":"admin", "password":"admin"})</span></pre><p id="b83b" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">一旦你完成了它，你可以在类中添加额外的特性，比如<code class="fe lr ls lt lu b">wait_time</code>:</p><ul class=""><li id="0530" class="mc md it kx b ky kz lb lc le me li mf lm mg lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">wait_time</code> —指任务执行之间的等待时间。现在，让我们用<code class="fe lr ls lt lu b">between(0.5, 3.0)</code>来表示0.5到3秒之间的等待时间。其他<a class="ae ku" href="https://docs.locust.io/en/stable/api.html#module-locust.wait_time" rel="noopener ugc nofollow" target="_blank">内置功能</a>也可用，如<code class="fe lr ls lt lu b">constant</code>和<code class="fe lr ls lt lu b">constant_pacing</code>。对于负载测试，我们稍后会将这个数字更改为0。</li></ul><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="5a1a" class="nu my it lu b gy ok ol l om on">wait_time = between(0.5, 3.0)</span></pre><p id="e4c7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您的最终代码应该与此类似:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="adaf" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe lr ls lt lu b">on_start</code>和<code class="fe lr ls lt lu b">on_stop</code>功能特意留空以供参考。一个主要的用例是添加登录和注销调用来测试网站的认证。</p><h2 id="3075" class="nu my it bd mz nv nw dn nd nx ny dp nh le nz oa nj li ob oc nl lm od oe nn of bi translated">试验</h2><p id="fef8" class="pw-post-body-paragraph kv kw it kx b ky np ju la lb nq jx ld le nr lg lh li ns lk ll lm nt lo lp lq im bi translated">让我们通过打开另一个命令行并指向您的<code class="fe lr ls lt lu b">locustfile.py</code>所在的目录来测试它。如果您使用完全相同的名称，只需运行:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="b8cd" class="nu my it lu b gy ok ol l om on">locust</span></pre><p id="4b97" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如果您使用的不是这个名称，您必须使用以下命令(相应地修改文件名):</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="8249" class="nu my it lu b gy ok ol l om on">locust -f personal_directory/your_file.py</span></pre><p id="a953" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">您应该能够看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oq or di os bf ot"><div class="gh gi ox"><img src="../Images/f8e3918b1c779224a86e55581ff3c751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B7w2qc5lCNwlCxyAk4UmDw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="b0cb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">打开浏览器，输入以下URL:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="d0ed" class="nu my it lu b gy ok ol l om on"><a class="ae ku" href="http://localhost:8089/" rel="noopener ugc nofollow" target="_blank">http://localhost:8089/</a></span></pre><p id="1cbc" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">将出现以下界面。最佳实践是使用实际主机的实际IP或主机名。现在，只要填写你喜欢的任何东西，因为我们不做任何分布式测试。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/57d453448e66975587e31191d0ca130f.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*wZUc_UqvKKGKXgqRgvblWw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="e475" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">准备好之后点击<code class="fe lr ls lt lu b">Start swarming</code>按钮。该过程将开始，您将注意到如下变化:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oq or di os bf ot"><div class="gh gi oz"><img src="../Images/31a025ae4e283a870ae68eb4e272f5f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-7TVG-79r-m_56HXcyhp4Q.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><ul class=""><li id="ca27" class="mc md it kx b ky kz lb lc le me li mf lm mg lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">Request </code> —迄今提出的请求总数</li><li id="66a5" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">Fails</code> —失败的请求数</li><li id="cc6b" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">Median</code>—50%的响应速度，单位为毫秒</li><li id="236e" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">90%ile</code>—90%的响应速度，单位为毫秒</li><li id="540b" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">Average</code> —平均响应速度，单位为毫秒</li><li id="9087" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">Min</code> —最小响应速度，单位为毫秒</li><li id="70d0" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">Max </code> —最大响应速度，单位为毫秒</li><li id="8659" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">Average bytes</code> —以字节为单位的平均响应大小</li><li id="961a" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">Current RPS</code> —当前每秒请求数</li><li id="0ef8" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">Current Failure/s</code> —每秒失败的总次数</li></ul><p id="b225" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">转到图表选项卡，您应该会看到以下图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oq or di os bf ot"><div class="gh gi pa"><img src="../Images/5459bec5b632330f88c30f47e700fe31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3g3XScCz8fwYlu7RhECh7A.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oq or di os bf ot"><div class="gh gi pb"><img src="../Images/3d581d94f58af1c133c8d9be9dcc2742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z8J7tGGkmV-BkGozEtgYkQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oq or di os bf ot"><div class="gh gi pc"><img src="../Images/350dbba0aa104114756c3559a8ee2caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1tMwo_jnhvC9jDLAToqSg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="243e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">其余的菜单用于故障和异常。您甚至可以通过<code class="fe lr ls lt lu b">Download Data</code>选项卡下载csv格式的数据。你会注意到此时<code class="fe lr ls lt lu b">RPS</code>非常低。这主要是因为我们已经将<code class="fe lr ls lt lu b">wait_time</code>设置在0.5到3秒之间。对于实际负载测试，将这两个值都更改为0。您也可以根据自己的喜好使用<code class="fe lr ls lt lu b">constant(0)</code>功能。重启您的测试，您应该能够看到您的服务器能够处理的最大值<code class="fe lr ls lt lu b">RPS</code>。请随意使用不同的<code class="fe lr ls lt lu b">number of users</code>和<code class="fe lr ls lt lu b">hatch rate</code>进行试验。</p><p id="d7fc" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">下一节将直接通过命令行而不是web UI来模拟相同的功能。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="b773" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">3.命令行界面</h1><p id="977b" class="pw-post-body-paragraph kv kw it kx b ky np ju la lb nq jx ld le nr lg lh li ns lk ll lm nt lo lp lq im bi translated">该模块还为我们提供了一种通过命令行界面运行负载测试的方法。这允许我们轻松地实现自动化负载测试流程。运行locust时只需添加无web参数。您还必须包括主机、客户端数量和孵化率。</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="39d4" class="nu my it lu b gy ok ol l om on">locust -f locustfile.py --no-web --host wfng -c 1000 -r 100</span></pre><ul class=""><li id="f36f" class="mc md it kx b ky kz lb lc le me li mf lm mg lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">f </code> —文件的路径</li><li id="67ea" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">no-web</code> —在没有网络界面的情况下运行模拟</li><li id="757d" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">c</code> —客户数量</li><li id="97ca" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">r</code> —孵化率</li></ul><p id="a7b9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">运行大约30秒，然后使用<code class="fe lr ls lt lu b">Ctrl-C</code>命令停止。您应该会看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oq or di os bf ot"><div class="gh gi pd"><img src="../Images/79d633d5764f1b34ccaa63210e2f4a50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KW0cYEKt0C77qstGxgdiBQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作者图片</p></figure><p id="1690" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">还有其他有用的参数，例如:</p><ul class=""><li id="5063" class="mc md it kx b ky kz lb lc le me li mf lm mg lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">t </code> —特定时间后停止。30s，5m，1h，1h30m。</li><li id="dfe9" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq oo mi mj mk bi translated"><code class="fe lr ls lt lu b">csv</code> —将结果保存为CSV格式的文件。</li></ul><p id="a1b2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">请随时通过以下方式检查所有可用参数:</p><pre class="kj kk kl km gt og lu oh oi aw oj bi"><span id="ba22" class="nu my it lu b gy ok ol l om on">locust --help</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="42be" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">4.结论</h1><p id="b3f5" class="pw-post-body-paragraph kv kw it kx b ky np ju la lb nq jx ld le nr lg lh li ns lk ll lm nt lo lp lq im bi translated">让我们回顾一下今天所学的内容。首先，根据所使用的平台，我们从模块的简单安装开始。</p><p id="1f75" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然后，我们为负载测试创建了一个测试Flask服务器。同时，我们通过编写一个简单的Locust脚本探索了该模块提供的功能。我们运行了测试，并在web UI界面中获得了结果。有图表和数据可以很容易地以CSV格式下载。</p><p id="ce36" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">此外，我们尝试仅通过命令行界面运行相同的模拟。这允许我们运行自动化的负载测试流程。</p><p id="5f5d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">感谢阅读，我希望你喜欢这篇教程。下一篇再见！</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="a08c" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">参考</h1><ol class=""><li id="a25d" class="mc md it kx b ky np lb nq le pe li pf lm pg lq mh mi mj mk bi translated"><a class="ae ku" href="https://docs.locust.io/en/stable/installation.html" rel="noopener ugc nofollow" target="_blank">https://docs.locust.io/en/stable/installation.html</a></li><li id="e231" class="mc md it kx b ky ml lb mm le mn li mo lm mp lq mh mi mj mk bi translated"><a class="ae ku" href="https://locust.io/" rel="noopener ugc nofollow" target="_blank">https://locust.io/</a></li></ol></div></div>    
</body>
</html>