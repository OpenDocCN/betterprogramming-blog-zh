<html>
<head>
<title>Creating an Opinionated Go GQL Server — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建自以为是的Go GQL服务器—第1部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/creating-an-opinionated-gql-server-part1-8fad071e525f?source=collection_archive---------12-----------------------#2019-07-15">https://betterprogramming.pub/creating-an-opinionated-gql-server-part1-8fad071e525f?source=collection_archive---------12-----------------------#2019-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e4e8b53808694c447d1c1e4dd2620b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auRW7pQ2UcTbPccZc5Tayg.png"/></div></div></figure><div class=""/><div class=""><h2 id="9555" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">项目设置和初始步骤</h2></div><p id="de27" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们使用<a class="ae lp" href="https://gin-gonic.com" rel="noopener ugc nofollow" target="_blank"> Gin-gonic </a> web框架、用于OAuth2连接的<a class="ae lp" href="https://github.com/markbates/goth" rel="noopener ugc nofollow" target="_blank"> Goth </a>、作为DB ORM的<a class="ae lp" href="http://gorm.io" rel="noopener ugc nofollow" target="_blank"> GORM </a>以及用于构建GraphQL服务器的<a class="ae lp" href="https://gqlgen.com/" rel="noopener ugc nofollow" target="_blank"> GQLGen </a>来创建一个自以为是的GraphQL服务器。</p><p id="d788" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这个项目假设你至少有基本的Go知识，安装了Go 1.12+和VSCode(首选)或类似的IDE。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="a0c8" class="lx ly je bd lz ma mb mc md me mf mg mh kk mi kl mj kn mk ko ml kq mm kr mn mo bi translated">项目设置</h1><p id="67c7" class="pw-post-body-paragraph kt ku je kv b kw mp kf ky kz mq ki lb lc mr le lf lg ms li lj lk mt lm ln lo im bi translated">我们将遵循该服务的Go标准项目布局。看一下说明书。它坚持己见，是一个很好的基础，尽管我们可能会偏离它的指导方针一点点。</p><p id="3c56" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">首先在我们想要的任何地方创建一个目录:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="f60a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们用以下内容创建整个项目布局:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="1602" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe na nb nc nd b">internal/gql-server</code>将保存gql服务器的所有相关文件。</p><p id="f308" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe na nb nc nd b">cmd/gql-server</code>将为服务器存放<code class="fe na nb nc nd b">main.go</code>文件，这是将所有文件粘合在一起的入口点。</p><p id="3ebf" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">因为我们使用的是Go 1.12+，所以你可以使用<code class="fe na nb nc nd b">$GOPATH/src</code>路径之外的任何目录。我们想使用<code class="fe na nb nc nd b">go modules</code>来初始化我们的项目。我们必须跑:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="5176" class="lx ly je bd lz ma mb mc md me mf mg mh kk mi kl mj kn mk ko ml kq mm kr mn mo bi translated">编写我们的web服务器</h1><p id="fff9" class="pw-post-body-paragraph kt ku je kv b kw mp kf ky kz mq ki lb lc mr le lf lg ms li lj lk mt lm ln lo im bi translated">现在我们可以开始向我们的项目添加包了！让我们从获取我们的web框架开始:<code class="fe na nb nc nd b">gin-gonic</code></p><p id="0fb9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">来自gin-gonic.com<a class="ae lp" href="https://gin-gonic.com/" rel="noopener ugc nofollow" target="_blank"/>:</p><blockquote class="ne nf ng"><p id="cbd4" class="kt ku nh kv b kw kx kf ky kz la ki lb ni ld le lf nj lh li lj nk ll lm ln lo im bi translated"><strong class="kv jf">什么是杜松子酒？Gin是一个用Golang编写的web框架。它有一个类似martini的API，性能更好，速度提高了40倍。如果你需要性能和良好的生产力，你会喜欢杜松子酒。</strong></p></blockquote><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="c9cb" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们开始创建web服务器。</p><p id="f8f6" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在<code class="fe na nb nc nd b">cmd/gql-server</code>中创建一个<code class="fe na nb nc nd b">main.go</code>文件:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="8041" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">并粘贴以下占位符代码:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="51f2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如果你<code class="fe na nb nc nd b">go run cmd/gql-server/main.go</code>这个代码，它将调出一个Gin服务器监听<a class="ae lp" href="http://localhost:7777/ping" rel="noopener ugc nofollow" target="_blank"> locahost:7777 </a>，并在浏览器中打印出一个<em class="nh"> OK </em>。有用！</p><p id="09b6" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在，让我们使用已经存在的目录结构、<code class="fe na nb nc nd b">script</code>、<code class="fe na nb nc nd b">internal</code>和<code class="fe na nb nc nd b">pkg</code>文件夹来重构这段代码:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="dd94" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">怎么样？一行代码就让我们的服务器用完了<code class="fe na nb nc nd b">pkg</code>文件夹。</p><p id="80a3" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在我们可以用一个脚本来构建服务器:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="6968" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">跑步前，确保你:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="9234" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在我们可以开始构建我们的服务器，就像这样:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5db1" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">16M的独立服务器，我认为还不错，这可能是其docker图像的大小！</p><p id="a88c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">好了，现在来试试已经建成的东西:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="7fd4" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这是相当快的速度，39(微秒)秒。</p><p id="29ea" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们可以进一步改进我们的服务器代码，让配置从一个<code class="fe na nb nc nd b">.env</code>文件加载。让我们为我们的服务器创建一些<code class="fe na nb nc nd b">utils</code>:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="06d0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">代码基本上是不言自明的。如果一个<code class="fe na nb nc nd b">ENV</code> var不存在，程序会死机。我们需要这些来运行。现在，改变</p><p id="8df0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">-<strong class="kv jf">pkg/server/main . go</strong>to this:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="a582" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们看到它是如何作为一个精心设计的项目开始成形的！</p><p id="f6a5" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们仍然可以做一些事情，比如使用这个脚本在本地运行服务器:</p><figure class="mu mv mw mx gt iv"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="bf1f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这将设置<code class="fe na nb nc nd b">ENV</code>var和<code class="fe na nb nc nd b">go run</code>服务器。</p><p id="1bb2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">也可以添加一个<code class="fe na nb nc nd b">.gitignore</code>文件。运行<code class="fe na nb nc nd b">git init</code>，将原点设置到您自己的存储库中，然后<code class="fe na nb nc nd b">git push</code>它:)</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="ceee" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这个项目将在第二部分中继续，我们将添加服务器的<code class="fe na nb nc nd b">GQLGen</code>部分！</p><div class="is it gp gr iu nl"><a href="https://medium.com/better-programming/creating-an-opinionated-go-gql-server-part-2-f049e4a9afe1" rel="noopener follow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd jf gy z fp nq fr fs nr fu fw jd bi translated">创建自以为是的Go GQL服务器—第2部分</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">我们现在将GQLGen生成的服务器添加到我们的项目中，并开始gqling了！而且，我们将移动更多…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ja nl"/></div></div></a></div><p id="8d87" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">所有代码都可以在<a class="ae lp" href="https://github.com/cmelgarejo/go-gql-server/tree/tutorial/part-1" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>中获得。</p></div></div>    
</body>
</html>