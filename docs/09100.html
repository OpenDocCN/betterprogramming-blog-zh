<html>
<head>
<title>How To Conditionally Change index.html in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何有条件地改变index.html的反应</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-conditionally-change-index-html-in-react-de090b51fed3?source=collection_archive---------1-----------------------#2021-07-15">https://betterprogramming.pub/how-to-conditionally-change-index-html-in-react-de090b51fed3?source=collection_archive---------1-----------------------#2021-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="85b0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使您的index.html内容依赖于环境变量</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6ee77b8420385216a7d1306b71531fd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lHQXMneKTNg8ACsL"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@jacksonsophat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jackson So </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="746b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当开发一个<a class="ae ky" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>应用程序时，您可能需要根据您为构建的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-correctly-build-a-multi-environment-react-app-6ba4878e98ba">环境来包含或更改脚本或HTML标签。在处理</a><a class="ae ky" href="https://en.wikipedia.org/wiki/Search_engine_optimization" rel="noopener ugc nofollow" target="_blank"> SEO </a>或跟踪工具时尤其如此，比如<a class="ae ky" href="https://analytics.google.com/analytics/web/" rel="noopener ugc nofollow" target="_blank">谷歌分析</a>或<a class="ae ky" href="https://www.hotjar.com/" rel="noopener ugc nofollow" target="_blank"> HotJar </a>。</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-correctly-build-a-multi-environment-react-app-6ba4878e98ba"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">如何正确构建多环境React App</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">为每个环境保留一个专用的构建文件夹</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">better编程. pub</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="0299" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能不知道的是，用<a class="ae ky" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> Create React App </a>初始化的React应用程序为你提供了这样做的可能性。虽然很难在网上找到它的文档，但它实际上是一个很酷的功能。事实上，只需几行代码，您就可以让您的<code class="fe mn mo mp mq b">index.html</code>文件内容依赖于环境变量。</p><p id="65e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来了解一下这个鲜为人知的功能，看看如何使用它。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="3983" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">带有HtmlWebpackPlugin的条件代码</h1><p id="10ef" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated"><code class="fe mn mo mp mq b"><a class="ae ky" href="https://webpack.js.org/plugins/html-webpack-plugin/" rel="noopener ugc nofollow" target="_blank">HtmlWebpackPlugin</a></code>自带Create React App，用于捆绑。具体来说，它使用<code class="fe mn mo mp mq b">public/index.html</code>作为模板，用<code class="fe mn mo mp mq b"><a class="ae ky" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank">webpack</a></code>提供的路径注入一个<code class="fe mn mo mp mq b">&lt;script&gt;</code>，生成最终的HTML页面。</p><p id="da25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，<code class="fe mn mo mp mq b">HtmlWebpackPlugin</code>为开发人员提供了使用以下语法处理条件代码的能力:</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="13fb" class="nz mz it mq b gy oa ob l oc od">&lt;% if (condition) { %&gt;<br/>    // code inserted in the final HTML file only if<br/>    // condition is true<br/>&lt;% } %&gt;</span></pre><p id="ecb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以如下使用<code class="fe mn mo mp mq b">else</code>和/或<code class="fe mn mo mp mq b">if else</code>分支:</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="a640" class="nz mz it mq b gy oa ob l oc od">&lt;% if (condition1) { %&gt;<br/>    // code inserted in the final HTML file only if<br/>    // condition1 is true<br/>&lt;% } else if (contition2) { %&gt;<br/>    // code inserted in the final HTML file only if<br/>    // condition1 is true<br/>&lt;% } else { %&gt;<br/>    // code inserted in the final HTML file only if<br/>    // both condition1 and contition2 are false<br/>&lt;% } %&gt;</span></pre><p id="7807" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，在调试时，您可能还需要打印变量或条件的值。您可以使用以下语法来实现:</p><pre class="kj kk kl km gt nv mq nw nx aw ny bi"><span id="d4b2" class="nz mz it mq b gy oa ob l oc od">&lt;%= variable %&gt;</span></pre><p id="c600" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个<code class="fe mn mo mp mq b"><a class="ae ky" href="https://docs.npmjs.com/cli/v6/commands/npm-build" rel="noopener ugc nofollow" target="_blank">npm build</a></code>或<code class="fe mn mo mp mq b"><a class="ae ky" href="https://docs.npmjs.com/cli/v7/commands/npm-start" rel="noopener ugc nofollow" target="_blank">npm start</a></code>进程结束时，您会发现它的值打印在生成的HTML文件中。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="d9a2" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">条件代码在起作用</h1><p id="6664" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">比方说，您希望只有您的production React应用程序被Google抓取，并且Google Analytics只出现在产品中。您可能会考虑编写两个定制的构建脚本，但这不是必需的。</p><p id="c373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，你可以轻松实现这两个结果。您只需要根据当前环境有条件地更改您的<code class="fe mn mo mp mq b">public/index.html</code>文件的代码，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="1bb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">发生的情况是，只有当<code class="fe mn mo mp mq b">process.env.NODE_ENV</code>具有所需的值时，用上述特殊语法编写的两个部分才会包含在最终的HTML文件中。这个环境变量是Create React App的一部分，如官方文档中所述。</p><blockquote class="og oh oi"><p id="f338" class="kz la oj lb b lc ld ju le lf lg jx lh ok lj lk ll ol ln lo lp om lr ls lt lu im bi translated">“[……]一个名为<code class="fe mn mo mp mq b">NODE_ENV</code>的内置环境变量。可以从<code class="fe mn mo mp mq b">process.env.NODE_ENV</code>开始读。当你运行<code class="fe mn mo mp mq b">npm start</code>时，它总是等于<code class="fe mn mo mp mq b">'development'</code>，当你运行<code class="fe mn mo mp mq b">npm test</code>时，它总是等于<code class="fe mn mo mp mq b">'test'</code>，当你运行<code class="fe mn mo mp mq b">npm run build</code>来制作一个生产包时，它总是等于<code class="fe mn mo mp mq b">'production'</code>。您不能手动覆盖<code class="fe mn mo mp mq b">NODE_ENV</code>。— <a class="ae ky" href="https://create-react-app.dev/docs/adding-custom-environment-variables/" rel="noopener ugc nofollow" target="_blank">创建React应用程序</a></p></blockquote><p id="f535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊！您的<code class="fe mn mo mp mq b">index.html</code>内容现在取决于环境变量。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="18ea" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">结论</h1><p id="54c2" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">今天，我们看了如何根据环境变量改变<code class="fe mn mo mp mq b">index.html</code>文件。实现这个目标很容易，只需要几行代码。特别是，由于默认情况下Create React App自带的<code class="fe mn mo mp mq b">HtmlWebPackPlugin</code>，这成为可能。这个有用但并不广为人知的React特性可以让您避免为面向环境的构建编写定制脚本，从而节省您的时间。</p><p id="e7f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！我希望这篇文章对你有所帮助。请随意留下任何问题、评论或建议。</p></div></div>    
</body>
</html>