<html>
<head>
<title>How to Handle Multiple Environments in a React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React应用中处理多种环境</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/managing-environments-for-provisional-builds-with-react-app-1fb411e3597?source=collection_archive---------0-----------------------#2019-08-23">https://betterprogramming.pub/managing-environments-for-provisional-builds-with-react-app-1fb411e3597?source=collection_archive---------0-----------------------#2019-08-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="392b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为开发和生产之外的环境设置React应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f4c3c6ba2a537b7cf27afa6ae928d7db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0SferIcpM_xAgBiX1iweOQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:https://undraw.co/</p></figure><p id="2db9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开发React web应用时，开发者默认只能使用两种环境。</p><ul class=""><li id="ee53" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">开发— <code class="fe me mf mg mh b">NODE_ENV=development</code>在本地开发应用程序。如果可用，默认使用<code class="fe me mf mg mh b">.env.development</code>。</li><li id="e717" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated">生产— <code class="fe me mf mg mh b">NODE_ENV=production</code>构建应用程序进行部署时。如果可用，默认使用<code class="fe me mf mg mh b">.env.production</code>。</li></ul><p id="d61e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们使用<a class="ae ky" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>时，<code class="fe me mf mg mh b">package.json</code>有如下脚本:</p><pre class="kj kk kl km gt mn mh mo mp aw mq bi"><span id="3af0" class="mr ms it mh b gy mt mu l mv mw">"scripts": {<br/>  "start": "react-scripts start", <!-- -->// NODE_ENV=development as default<br/>  "build": "react-scripts build", <!-- -->// NODE_ENV=production as default<br/>}</span></pre><p id="c60e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我的项目有四个环境:</p><ul class=""><li id="934b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">发展</li><li id="db20" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated">测试</li><li id="de87" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated">脚手架</li><li id="480b" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated">生产</li></ul><p id="8f33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，<a class="ae ky" href="https://www.npmjs.com/package/react-scripts" rel="noopener ugc nofollow" target="_blank"> react-scripts </a>只支持开发和生产。</p><p id="f485" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我需要测试和试运行环境。我们不能改变<code class="fe me mf mg mh b">NODE_ENV</code>的值，它只能是“开发”或“生产”。</p><p id="9a52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，我们使用一个npm包<code class="fe me mf mg mh b">env-cmd</code>。可以通过下面的链接获得。</p><div class="mx my gp gr mz na"><a href="https://www.npmjs.com/package/env-cmd" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">环境-cmd</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">使用env文件中的环境变量执行命令</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">www.npmjs.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no ks na"/></div></div></a></div><p id="fd27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的npm包帮助用户根据环境改变<code class="fe me mf mg mh b">env</code>变量。为此，请执行以下步骤。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="858b" class="nw ms it bd nx ny nz oa ob oc od oe of jz og ka oh kc oi kd oj kf ok kg ol om bi translated">1.安装<code class="fe me mf mg mh b">env-cmd</code> npm包</h1><pre class="kj kk kl km gt mn mh mo mp aw mq bi"><span id="9f81" class="mr ms it mh b gy mt mu l mv mw">npm install env-cmd --save</span></pre><p id="fedf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据环境添加<code class="fe me mf mg mh b">env</code>文件和一个带有公共变量的<code class="fe me mf mg mh b">.env</code>文件。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="d0bd" class="nw ms it bd nx ny nz oa ob oc od oe of jz og ka oh kc oi kd oj kf ok kg ol om bi translated">2.定义环境文件</h1><h2 id="4649" class="mr ms it bd nx on oo dn ob op oq dp of li or os oh lm ot ou oj lq ov ow ol ox bi translated">。包封/包围（动词envelop的简写）</h2><pre class="kj kk kl km gt mn mh mo mp aw mq bi"><span id="b480" class="mr ms it mh b gy mt mu l mv mw">REACT_APP_NAME = "Rockin MAT"</span></pre><h2 id="c32c" class="mr ms it bd nx on oo dn ob op oq dp of li or os oh lm ot ou oj lq ov ow ol ox bi translated">.环境发展</h2><pre class="kj kk kl km gt mn mh mo mp aw mq bi"><span id="dee6" class="mr ms it mh b gy mt mu l mv mw">REACT_APP_API_ENDPOINT = "https://api-dev.endpoint.com/"</span></pre><h2 id="4d58" class="mr ms it bd nx on oo dn ob op oq dp of li or os oh lm ot ou oj lq ov ow ol ox bi translated">环境测试</h2><pre class="kj kk kl km gt mn mh mo mp aw mq bi"><span id="0694" class="mr ms it mh b gy mt mu l mv mw">REACT_APP_API_ENDPOINT = "https://api-testing.endpoint.com/"</span></pre><h2 id="8aea" class="mr ms it bd nx on oo dn ob op oq dp of li or os oh lm ot ou oj lq ov ow ol ox bi translated">env.staging</h2><pre class="kj kk kl km gt mn mh mo mp aw mq bi"><span id="f673" class="mr ms it mh b gy mt mu l mv mw">REACT_APP_API_ENDPOINT = "https://api-staging.endpoint.com/"</span></pre><h2 id="7d56" class="mr ms it bd nx on oo dn ob op oq dp of li or os oh lm ot ou oj lq ov ow ol ox bi translated">.环境生产</h2><pre class="kj kk kl km gt mn mh mo mp aw mq bi"><span id="d9cc" class="mr ms it mh b gy mt mu l mv mw">REACT_APP_API_ENDPOINT = "https://api.endpoint.com/"</span></pre><p id="9472" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:在React中创建自定义变量需要前缀<code class="fe me mf mg mh b">“REACT_APP_”</code>。</p><h1 id="72b8" class="nw ms it bd nx ny oy oa ob oc oz oe of jz pa ka oh kc pb kd oj kf pc kg ol om bi translated">3.向package.json添加脚本</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="6009" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要测试您的工作，请运行以下命令。</p><p id="7d0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于测试环境:</p><pre class="kj kk kl km gt mn mh mo mp aw mq bi"><span id="95c3" class="mr ms it mh b gy mt mu l mv mw">npm run build:testing</span></pre><p id="b93b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于登台环境:</p><pre class="kj kk kl km gt mn mh mo mp aw mq bi"><span id="f790" class="mr ms it mh b gy mt mu l mv mw">npm run build:staging</span></pre><p id="56c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:即使您在构建应用程序时添加了两个新的不同环境，<code class="fe me mf mg mh b">NODE_ENV</code>也将是生产环境。为了区分构建，我建议您添加<code class="fe me mf mg mh b">REACT_APP_ENV</code>并在那里指定您的环境。</p><p id="322e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">万岁！现在，您可以向React代码添加两个以上的环境。</p></div></div>    
</body>
</html>