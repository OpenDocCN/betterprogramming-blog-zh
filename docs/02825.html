<html>
<head>
<title>Implement Auth0 With Your Node.js App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js应用程序实现Auth0</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implement-auth0-with-nodejs-442d44da2d0f?source=collection_archive---------8-----------------------#2020-01-03">https://betterprogramming.pub/implement-auth0-with-nodejs-442d44da2d0f?source=collection_archive---------8-----------------------#2020-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6c72" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将身份验证构建到您的节点应用程序中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/c5c29d0bf51b69f2b3b2b6e3066b562e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*0UWyZJxh_kdfb_AeyRgjpA.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:auth0的完整旅程</p></figure><h1 id="7402" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">什么是Auth0？</h1><p id="92a0" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">Auth0是第三方工具，提供身份验证和授权服务。它提供了身份验证和授权的构建块，使您无需成为安全专家就能保护您的应用程序。可以将Auth0集成到任何Node.js app中。</p><p id="e7c1" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要用Node.js实现Auth0，首先你需要<a class="ae mn" href="https://auth0.auth0.com/login?state=g6Fo2SBoUDRvY2tWWXJOX29VT0NBQUNEaGJKZEV2VFBsa213ZaN0aWTZIHpITFl0WGNNZG1vaURmTXNDMGRPUE9CdG40YTdraXVwo2NpZNkgU0IzME9XMVMxVmxyWmdqWVdxWkc2NEFRNU5qRm8xd20&amp;client=SB30OW1S1VlrZgjYWqZG64AQ5NjFo1wm&amp;protocol=oauth2&amp;audience=https%3A%2F%2Fauth0.auth0.com%2Fuserinfo&amp;response_type=code&amp;redirect_uri=https%3A%2F%2Fauth0.com%2Fdocs%2Fauth%2Fcallback&amp;scope=openid%20profile%20email" rel="noopener ugc nofollow" target="_blank">在Auth0上创建一个账户</a>。然后，<a class="ae mn" href="https://auth0.auth0.com/login?state=g6Fo2SBoUDRvY2tWWXJOX29VT0NBQUNEaGJKZEV2VFBsa213ZaN0aWTZIHpITFl0WGNNZG1vaURmTXNDMGRPUE9CdG40YTdraXVwo2NpZNkgU0IzME9XMVMxVmxyWmdqWVdxWkc2NEFRNU5qRm8xd20&amp;client=SB30OW1S1VlrZgjYWqZG64AQ5NjFo1wm&amp;protocol=oauth2&amp;audience=https%3A%2F%2Fauth0.auth0.com%2Fuserinfo&amp;response_type=code&amp;redirect_uri=https%3A%2F%2Fauth0.com%2Fdocs%2Fauth%2Fcallback&amp;scope=openid%20profile%20email" rel="noopener ugc nofollow" target="_blank">登录</a>。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="6d21" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">步骤1:获取Auth0应用程序密钥</h1><p id="a46d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在我们需要在Auth0上做一些配置，就这么做吧。当你注册Auth0时，一个新的应用程序已经为你创建了——或者你也可以创建一个新的。我们需要以下信息:</p><ul class=""><li id="4913" class="na nb it lo b lp mi ls mj lv nc lz nd md ne mh nf ng nh ni bi translated">域密钥</li><li id="8b54" class="na nb it lo b lp nj ls nk lv nl lz nm md nn mh nf ng nh ni bi translated">客户ID密钥</li><li id="859c" class="na nb it lo b lp nj ls nk lv nl lz nm md nn mh nf ng nh ni bi translated">客户端密钥</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi no"><img src="../Images/bf2c8b6c5fe99a7aaffc9fac8b04d2d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RIw3lesxx1aTr2gAbLj5Og.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:Auth0仪表板</p></figure><p id="fc52" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">现在获取应用程序密钥并保存在某个地方:<strong class="lo iu"> <br/> </strong>进入应用程序&gt;默认应用程序&gt;设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi nt"><img src="../Images/82e17ebaec825f01024824df23188c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sHZs-CiaMRWQ48LQh7zETQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:复制密钥</p></figure><p id="8a4b" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">复制域、客户端ID和客户端密码。它们将用于我们的节点应用程序。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="6f73" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated"><strong class="ak">步骤2:在您的Auth0应用中配置回调URL</strong></h1><p id="2d90" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><em class="nu">回调URL </em>是应用程序中的一个URL，Auth0在认证后将用户重定向到这个URL。</p><p id="a95f" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要添加此功能，请进入应用程序&gt;默认应用程序&gt;设置，然后在允许的回拨URL框中输入<code class="fe nv nw nx ny b">http://localhost:3000/callback</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi nz"><img src="../Images/ad79559b45b8b1bf4ff41e27cf75ad3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5BF102VNA_KTiypAqElOSg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:允许的回调URL框</p></figure><h1 id="6e09" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated"><strong class="ak">步骤3:在您的Auth0应用中配置注销URL</strong></h1><p id="5eee" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><em class="nu">注销URL </em>是应用程序中的一个URL，用户从授权服务器注销后，Auth0可以返回到这个URL。这在<code class="fe nv nw nx ny b">returnTo</code>查询参数中指定。</p><p id="12f5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要添加此功能，请进入应用程序&gt;默认应用程序&gt;设置，然后在允许的注销网址框中输入<code class="fe nv nw nx ny b">http://localhost:3000</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi oa"><img src="../Images/39a4a945863178735067d4c5e9c23659.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_klZPVHwkHHs6wS7rmM2sQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:允许的注销URL框</p></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="0025" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">步骤4:现在点击保存更改</h1><p id="df93" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">您需要保存您现在所做的更改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi ob"><img src="../Images/3e00ce3b4f42831c20c84d2648c2abac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RM3L-wh-YFUQzggYBAnwYA.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:保存更改</p></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="4d2d" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">步骤5:现在让我们创建一个Node.js服务器</h1><p id="431c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">为此，创建一个名为<code class="fe nv nw nx ny b">auth0</code>的文件夹，并创建一个名为<code class="fe nv nw nx ny b">app.js</code>的文件。将下面的代码粘贴到<code class="fe nv nw nx ny b">app.js</code>中:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="6fbf" class="og kv it ny b gy oh oi l oj ok"><strong class="ny iu">var</strong> express = require('express');<br/><strong class="ny iu">var</strong> path = require('path');<br/><strong class="ny iu">var</strong> logger = require('morgan');<br/><strong class="ny iu">var</strong> cookieParser = require('cookie-parser');<br/><strong class="ny iu">var</strong> flash = require('connect-flash');<br/><strong class="ny iu">const</strong> app = express();</span><span id="7a30" class="og kv it ny b gy ol oi l oj ok">app.get('/test',(req,res,next)<strong class="ny iu">=&gt;</strong>{<br/> res.send({message:"Server is on"});<br/>})</span><span id="df8b" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// View engine setup<br/></em>app.set('views', path.join(__dirname, 'views'));<br/>app.set('view engine', 'pug');</span><span id="2f9c" class="og kv it ny b gy ol oi l oj ok">app.use(logger('dev'));<br/>app.use(cookieParser());<br/>app.use(express.static(path.join(__dirname, 'public')));<br/>app.use(flash());</span><span id="46b7" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// Handle auth failure error messages<br/></em>app.use(<strong class="ny iu">function</strong> (req, res, next) {<br/>  <strong class="ny iu">const</strong> err = new Error('Not Found');<br/>  err.status = 404;<br/>  next(err);<br/>});</span><span id="d91d" class="og kv it ny b gy ol oi l oj ok">app.use(<strong class="ny iu">function</strong> (err, req, res, next) {<br/>  res.status(err.status || 500);<br/>  res.send({message: err.message,error: {} });<br/>});</span><span id="795d" class="og kv it ny b gy ol oi l oj ok">app.listen(8080,()<strong class="ny iu">=&gt;</strong>{<br/>console.log("Server is runnig on port 8080");<br/>});</span><span id="22da" class="og kv it ny b gy ol oi l oj ok">module.exports = app;</span></pre><p id="cb66" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">现在打开终端，转到<code class="fe nv nw nx ny b">app.js</code>位置。运行命令:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="953c" class="og kv it ny b gy oh oi l oj ok">npm install express cookie-parser connect-flash morgan</span></pre><p id="6776" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">成功运行上面的命令后，使用下面的命令运行<code class="fe nv nw nx ny b">app.js</code>文件:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="3ba8" class="og kv it ny b gy oh oi l oj ok">node app.js</span></pre><p id="795b" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">您可以看到输出如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi om"><img src="../Images/a0de88adfc6385625d461edc14f8c4b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYQQUNpM5DZfMRBw9oirpw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:Node app.js</p></figure><p id="190d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">此外，您可以通过在浏览器中点击以下API来测试您的服务器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/05cb11031819dc639d7e11304a116eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*a0j4kVa1mq9S98grcYSEPw.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:服务器打开</p></figure><p id="822b" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">如果你能看到上面的消息，这意味着你的服务器正在运行。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="8c06" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">现在让我们用Auth0配置Node.js应用程序</h1><h2 id="78c6" class="og kv it bd kw oo op dn la oq or dp le lv os ot lg lz ou ov li md ow ox lk oy bi translated">1:创建。环境文件</h2><p id="8343" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">创建。env文件，并粘贴以下代码。替换<code class="fe nv nw nx ny b">YOUR_CLIENT_ID</code>、<code class="fe nv nw nx ny b">YOUR_DOMAIN</code>和<code class="fe nv nw nx ny b">YOUR_CLIENT_SECRET</code>的实际值。</p><p id="13c2" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">。环境:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="976a" class="og kv it ny b gy oh oi l oj ok">AUTH0_CLIENT_ID=YOUR_CLIENT_ID<br/>AUTH0_DOMAIN=YOUR_DOMAIN<br/>AUTH0_CLIENT_SECRET=YOUR_CLIENT_SECRET</span></pre><h2 id="62d9" class="og kv it bd kw oo op dn la oq or dp le lv os ot lg lz ou ov li md ow ox lk oy bi translated"><strong class="ak"> 2。安装依赖项以支持Auth0 </strong></h2><p id="8f9b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们需要安装依赖项。为此，请运行以下命令:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="80b7" class="og kv it ny b gy oh oi l oj ok">npm install passport passport-auth0 express-session dotenv <!-- -->pug<!-- --> --save</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi oz"><img src="../Images/692418c1bab0346983d1a4093b14c1e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2yYJEMfoo5-l_OcrbdDOhQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:<code class="fe nv nw nx ny b">npm install passport passport-auth0 express-session dotenv </code>帕格<code class="fe nv nw nx ny b"> --save</code></p></figure><h2 id="0ce7" class="og kv it bd kw oo op dn la oq or dp le lv os ot lg lz ou ov li md ow ox lk oy bi translated"><strong class="ak"> 3。将以下代码添加到您的app.js文件</strong></h2><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="29df" class="og kv it ny b gy oh oi l oj ok">var session = require('express-session');<br/><br/>// config express-session<br/>var sess = {<br/>  secret: 'CHANGE THIS TO A RANDOM SECRET',<br/>  cookie: {},<br/>  resave: false,<br/>  saveUninitialized: true<br/>};<br/><br/>if (app.get('env') === 'production') {<br/>  // Use secure cookies in production (requires SSL/TLS)<br/>  sess.cookie.secure = true;<br/><br/>  // Uncomment the line below if your application is behind a proxy (like on Heroku)<br/>  // or if you're encountering the error message:<br/>  // "Unable to verify authorization request state"<br/>  // app.set('trust proxy', 1);<br/>}<br/><br/>app.use(session(sess));</span></pre><h2 id="e3e7" class="og kv it bd kw oo op dn la oq or dp le lv os ot lg lz ou ov li md ow ox lk oy bi translated">4.添加Passport代码和应用程序设置</h2><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="c941" class="og kv it ny b gy oh oi l oj ok">// Load environment variables from .env<br/>var dotenv = require('dotenv');<br/>dotenv.config();<br/><br/>// Load Passport<br/>var passport = require('passport');<br/>var Auth0Strategy = require('passport-auth0');<br/><br/>// Configure Passport to use Auth0<br/>var strategy = new Auth0Strategy(<br/>  {<br/>    domain: process.env.AUTH0_DOMAIN,<br/>    clientID: process.env.AUTH0_CLIENT_ID,<br/>    clientSecret: process.env.AUTH0_CLIENT_SECRET,<br/>    callbackURL:<br/>      process.env.AUTH0_CALLBACK_URL || 'http://localhost:3000/callback'<br/>  },<br/>  function (accessToken, refreshToken, extraParams, profile, done) {<br/>    // accessToken is the token to call Auth0 API (not needed in the most cases)<br/>    // extraParams.id_token has the JSON Web Token<br/>    // profile has all the information from the user<br/>    return done(null, profile);<br/>  }<br/>);<br/><br/>passport.use(strategy);<br/>app.use(passport.initialize());<br/>app.use(passport.session());</span></pre><p id="8a80" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">请确保在应用Express中间件(<code class="fe nv nw nx ny b">app.use(session(sess)</code>)后，这最后两个命令在您的代码中。</p><p id="fe99" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">现在，添加上述代码后，您的最终<code class="fe nv nw nx ny b">app.js</code>文件将如下所示:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="9975" class="og kv it ny b gy oh oi l oj ok"><strong class="ny iu">var</strong> express = require('express');<br/><strong class="ny iu">var</strong> path = require('path');<br/><strong class="ny iu">var</strong> logger = require('morgan');<br/><strong class="ny iu">var</strong> cookieParser = require('cookie-parser');<br/><strong class="ny iu">var</strong> session = require('express-session');<br/><strong class="ny iu">var</strong> dotenv = require('dotenv');<br/><strong class="ny iu">var</strong> passport = require('passport');<br/><strong class="ny iu">var</strong> Auth0Strategy = require('passport-auth0');<br/><strong class="ny iu">var</strong> flash = require('connect-flash');</span><span id="0f79" class="og kv it ny b gy ol oi l oj ok">dotenv.config();</span><span id="3d98" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// Configure Passport to use Auth0<br/></em><strong class="ny iu">var</strong> strategy = new Auth0Strategy({<br/>  domain: process.env.AUTH0_DOMAIN,<br/>  clientID: process.env.AUTH0_CLIENT_ID,<br/>  clientSecret: process.env.AUTH0_CLIENT_SECRET,<br/>  callbackURL:<br/>    process.env.AUTH0_CALLBACK_URL || 'http://localhost:3000/callback'<br/>  },</span><span id="8ff2" class="og kv it ny b gy ol oi l oj ok"><strong class="ny iu">function</strong> (accessToken, refreshToken, extraParams, profile, done) {<br/>  return done(null, profile);<br/>});</span><span id="5455" class="og kv it ny b gy ol oi l oj ok">passport.use(strategy);</span><span id="1095" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// You can use this section to keep a smaller payload<br/></em>passport.serializeUser(<strong class="ny iu">function</strong> (user, done) {<br/>  done(null, user);<br/>});</span><span id="e8f3" class="og kv it ny b gy ol oi l oj ok">passport.deserializeUser(<strong class="ny iu">function</strong> (user, done) {<br/>  done(null, user);<br/>});</span><span id="e954" class="og kv it ny b gy ol oi l oj ok"><strong class="ny iu">const</strong> app = express();<br/>app.get('/test', (req, res, next) <strong class="ny iu">=&gt;</strong> {<br/>  res.send({ message: "Server is on" });<br/>})</span><span id="0d4a" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// View engine setup<br/></em>app.set('views', path.join(__dirname, 'views'));<br/>app.set('view engine', 'pug');<br/>app.use(logger('dev'));<br/>app.use(cookieParser());</span><span id="d4b7" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// config express-session<br/></em><strong class="ny iu">var</strong> sess = {<br/> secret: 'CHANGE THIS SECRET',<br/> cookie: {},<br/> resave: false,<br/> saveUninitialized: true<br/>};</span><span id="b737" class="og kv it ny b gy ol oi l oj ok">app.use(session(sess));<br/>app.use(passport.initialize());<br/>app.use(passport.session());<br/>app.use(express.static(path.join(__dirname, 'public')));<br/>app.use(flash());</span><span id="623f" class="og kv it ny b gy ol oi l oj ok">app.use(<strong class="ny iu">function</strong> (err, req, res, next) {<br/>  res.status(err.status || 500);|<br/>  res.send({message: err.message,error: err});<br/>});</span><span id="03bb" class="og kv it ny b gy ol oi l oj ok">app.listen(8080, () <strong class="ny iu">=&gt;</strong> {<br/>  console.log("Server is runnig on port 8080");<br/>});<br/>module.exports = app;<br/></span></pre></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="d35f" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">步骤6:现在我们需要创建API登录</h1><p id="e9e0" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在我们需要创建API:<code class="fe nv nw nx ny b">/login</code>。现在我们将在根目录下创建一个名为<code class="fe nv nw nx ny b">routes</code>的文件夹，其中包含以下文件:</p><ul class=""><li id="7999" class="na nb it lo b lp mi ls mj lv nc lz nd md ne mh nf ng nh ni bi translated"><code class="fe nv nw nx ny b">routes/auth.js</code>处理认证</li><li id="6f4e" class="na nb it lo b lp nj ls nk lv nl lz nm md nn mh nf ng nh ni bi translated"><code class="fe nv nw nx ny b">routes/index.js</code>服务主页</li></ul><p id="9788" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">让我们在<code class="fe nv nw nx ny b">routes</code>文件夹中创建一个名为<code class="fe nv nw nx ny b">auth.js</code>的文件，并粘贴以下代码:</p><h2 id="7328" class="og kv it bd kw oo op dn la oq or dp le lv os ot lg lz ou ov li md ow ox lk oy bi translated">auth.js:</h2><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="ebde" class="og kv it ny b gy oh oi l oj ok"><em class="nu">// routes/auth.js<br/></em><strong class="ny iu">var</strong> express = require('express');<br/><strong class="ny iu">var</strong> router = express.Router();<br/><strong class="ny iu">var</strong> passport = require('passport');<br/><strong class="ny iu">var</strong> dotenv = require('dotenv');<br/>dotenv.config();</span><span id="e4d5" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// Perform the login, after login Auth0 will redirect to callback</em></span><span id="932d" class="og kv it ny b gy ol oi l oj ok">router.get('/login', passport.authenticate('auth0', {<br/>scope: 'openid email profile'}), <strong class="ny iu">function</strong> (req, res) {<br/>  res.redirect('/');<br/>});<br/>module.exports = router;<br/></span></pre></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="e0b0" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">步骤7:创建一个服务于主页的索引路径:</h1><p id="2074" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">为此，在<code class="fe nv nw nx ny b">routes</code>文件夹中创建一个名为<code class="fe nv nw nx ny b">index.js</code>的文件，并粘贴以下代码:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="f24e" class="og kv it ny b gy oh oi l oj ok"><em class="nu">// routes/index.js<br/></em><strong class="ny iu">var</strong> express = require('express');<br/><strong class="ny iu">var</strong> router = express.Router();</span><span id="a00a" class="og kv it ny b gy ol oi l oj ok"><em class="nu">/* GET home page. */</em></span><span id="21b7" class="og kv it ny b gy ol oi l oj ok">router.get('/', <strong class="ny iu">function</strong> (req, res, next) {<br/> res.render('layout', { title: 'Auth0 Webapp sample Nodejs' });|<br/>});<br/>module.exports = router;</span></pre></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="5d1d" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">步骤8:将路线添加到app.js文件中</h1><p id="55bb" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">将以下代码粘贴到您的<code class="fe nv nw nx ny b">app.js</code>文件中:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="da77" class="og kv it ny b gy oh oi l oj ok">var authRouter = require('./routes/auth');<br/>var indexRouter = require('./routes/index');<br/><br/><br/>app.use('/', authRouter);<br/>app.use('/', indexRouter);<br/></span></pre><p id="97c6" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">添加上述代码后，您的最终<code class="fe nv nw nx ny b">app.js</code>文件将如下所示:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="cb0b" class="og kv it ny b gy oh oi l oj ok"><strong class="ny iu">var</strong> express = require('express');<br/><strong class="ny iu">var</strong> path = require('path');<br/><strong class="ny iu">var</strong> logger = require('morgan');<br/><strong class="ny iu">var</strong> cookieParser = require('cookie-parser');<br/><strong class="ny iu">var</strong> session = require('express-session');<br/><strong class="ny iu">var</strong> dotenv = require('dotenv');<br/><strong class="ny iu">var</strong> passport = require('passport');<br/><strong class="ny iu">var</strong> Auth0Strategy = require('passport-auth0');<br/><strong class="ny iu">var</strong> flash = require('connect-flash');<br/><strong class="ny iu">var</strong> authRouter = require('./routes/auth');<br/><strong class="ny iu">var</strong> indexRouter = require('./routes/index');<br/>dotenv.config();</span><span id="245d" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// Configure Passport to use Auth0<br/></em><strong class="ny iu">var</strong> strategy = new Auth0Strategy(<br/>{<br/> domain: process.env.AUTH0_DOMAIN,<br/> clientID: process.env.AUTH0_CLIENT_ID,<br/> clientSecret: process.env.AUTH0_CLIENT_SECRET,<br/> callbackURL:process.env.AUTH0_CALLBACK_URL || 'http://localhost:3000/callback'<br/>},<br/><strong class="ny iu">function</strong> (accessToken, refreshToken, extraParams, profile, done) {<br/> return done(null, profile);<br/>});</span><span id="9711" class="og kv it ny b gy ol oi l oj ok">passport.use(strategy);</span><span id="4cbf" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// You can use this section to keep a smaller payload<br/></em>passport.serializeUser(<strong class="ny iu">function</strong> (user, done) {<br/> done(null, user);<br/>});</span><span id="1cd4" class="og kv it ny b gy ol oi l oj ok">passport.deserializeUser(<strong class="ny iu">function</strong> (user, done) {<br/> done(null, user);<br/>});</span><span id="5786" class="og kv it ny b gy ol oi l oj ok"><strong class="ny iu">const</strong> app = express();<br/>app.get('/test', (req, res, next) <strong class="ny iu">=&gt;</strong> {<br/> res.send({ message: "Server is on" });|<br/>})</span><span id="de93" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// View engine setup<br/></em>app.set('views', path.join(__dirname, 'views'));<br/>app.set('view engine', 'pug');<br/>app.use(logger('dev'));<br/>app.use(cookieParser());</span><span id="56ce" class="og kv it ny b gy ol oi l oj ok"><em class="nu">// config express-session<br/></em><strong class="ny iu">var</strong> sess = {<br/> secret: 'CHANGE THIS SECRET',<br/> cookie: {},<br/> resave: false,<br/> saveUninitialized: true<br/>};</span><span id="58fa" class="og kv it ny b gy ol oi l oj ok">app.use(session(sess));<br/>app.use(passport.initialize());<br/>app.use(passport.session());<br/>app.use(express.static(path.join(__dirname, 'public')));<br/>app.use(flash());</span><span id="db53" class="og kv it ny b gy ol oi l oj ok">app.use('/', authRouter);<br/>app.use('/', indexRouter);</span><span id="76a5" class="og kv it ny b gy ol oi l oj ok">app.use(<strong class="ny iu">function</strong> (err, req, res, next) {<br/> res.status(err.status || 500);<br/> res.send({message: err.message,error: err});<br/>});</span><span id="9f76" class="og kv it ny b gy ol oi l oj ok">app.listen(8080, () <strong class="ny iu">=&gt;</strong> {<br/> console.log("Server is runnig on port 8080");<br/>});</span><span id="2290" class="og kv it ny b gy ol oi l oj ok">module.exports = app;</span></pre></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="8d86" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">步骤9:为主页创建视图:</h1><p id="5448" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">为此，在根位置创建一个名为<code class="fe nv nw nx ny b">views</code>的文件夹，并创建一个名为<code class="fe nv nw nx ny b">layout.pug</code>的文件。粘贴以下代码:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="b3e2" class="og kv it ny b gy oh oi l oj ok">doctype html<br/>html<br/> head<br/>  title= title<br/>  link(rel='stylesheet', href='/stylesheets/style.css')<br/>  link(rel='stylesheet', href='https://www.w3schools.com/w3css/4/w3.css')<br/>  link(rel='shortcut icon', href='//cdn2.auth0.com/styleguide/latest/lib/logos/img/favicon.png') <br/> <br/> body<br/>   nav.w3-bar.w3-border.w3-light-grey( role="navigation" )<br/>   .w3-bar-item.w3-text-grey Auth0 - NodeJS<br/>   a(href="/").w3-bar-item.w3-button Home<br/>   a(id="qsLoginBtn" href="/login").w3-bar-item.w3-button Log In<br/> <strong class="ny iu">block</strong> content<br/>h4 Welcome in Auth0 Implementation: Shubham Verma blogs</span></pre><p id="6eaf" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">让我们看一下快照:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi pa"><img src="../Images/2b656ef0116e17ba1079951b35394146.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Tu2Yfcwcl8b4esXHsAtfQ.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:<code class="fe nv nw nx ny b">layout.pug</code></p></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="a582" class="ku kv it bd kw kx mv kz la lb mw ld le jz mx ka lg kc my kd li kf mz kg lk ll bi translated">第10步:运行应用程序，看看结果:</h1><p id="e145" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在您已经完成了编码，是时候使用下面的命令运行<code class="fe nv nw nx ny b">app.js</code>文件了:</p><pre class="kj kk kl km gt oc ny od oe aw of bi"><span id="15dd" class="og kv it ny b gy oh oi l oj ok">node app.js</span></pre><p id="5da6" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">您可以看到输出是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi om"><img src="../Images/a0de88adfc6385625d461edc14f8c4b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYQQUNpM5DZfMRBw9oirpw.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:Node app.js</p></figure><p id="f114" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">现在打开浏览器，输入网址<code class="fe nv nw nx ny b">localhost:8080</code>。并查看页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi pb"><img src="../Images/0f1f19957b33839dce674238b4ba5e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASMZvhxgW99hXphlth4e-A.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:本地主机:8080</p></figure><p id="cadc" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">现在点击登录，看看神奇之处。您可以看到显示的Auth0登录页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi pc"><img src="../Images/b1995ed94f81c3ead262db69868ff00a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQUCRuxA174A4fpGERDCYg.png"/></div></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:验证0登录页面</p></figure><p id="d2ed" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">让我们在下面的GIF中看到组合的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/c5c29d0bf51b69f2b3b2b6e3066b562e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*0UWyZJxh_kdfb_AeyRgjpA.gif"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">快照:Auth0的完整旅程</p></figure><p id="2152" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">恭喜你。现在我们已经用Node.js实现了Auth0。</p><p id="2159" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要了解Node.js的更多信息，<a class="ae mn" href="https://medium.com/@svsh227/every-nodejs-developer-should-read-these-articles-f29032441a31" rel="noopener">请阅读</a> this。</p><p id="c08f" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">感谢阅读！</p></div></div>    
</body>
</html>