<html>
<head>
<title>How to Scrape Cryptocurrency Data and Store It in a MySQL Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何抓取加密货币数据并将其存储在MySQL数据库中</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/web-scraping-for-cryptocurrency-6ae78bc8c48?source=collection_archive---------16-----------------------#2022-06-07">https://betterprogramming.pub/web-scraping-for-cryptocurrency-6ae78bc8c48?source=collection_archive---------16-----------------------#2022-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9eb7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">不用每次打开网站就能知道加密货币的价格何时会降低</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c48cabaaf738d75149a1a4e35b24cd0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACdYdU2-nQIoyzIJfyS5yQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">加密货币</p></figure><p id="564c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个项目中，我们将刮<a class="ae lr" href="https://crypto.com/price" rel="noopener ugc nofollow" target="_blank">crypto.com</a>网站获得前500名表演加密货币和存储在MySQL数据库中的所有数据与时间戳作为表名。</p><h1 id="ebe2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">介绍</h1><p id="5d75" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">网络抓取是如今必备的技能。我们可以将网站名称抓取到有价值数据的表格中，并自动完成任务。如果价格降低，我们可以简单地抓取网站并设置一个电子邮件，而不是重复打开一个网站来检查价格是否降低。</p><p id="2ebf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将从crypto.com/price和T4中挑选出500种性能最好的加密货币。下面是来自网站的截图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/d7c676efe198e272da5a7a4e4aadd216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tHPBQEAK3xEbHnysTX9N_g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae lr" href="https://crypto.com/price" rel="noopener ugc nofollow" target="_blank">https://crypto.com/price</a></p></figure><h1 id="8e99" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">先决条件</h1><p id="08f5" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">在开始这个项目之前，我们需要设置一个python虚拟环境。请访问<a class="ae lr" href="https://blog.devgenius.io/brief-introduction-to-python-virtual-environments-5eb0ad5e8921?source=friends_link&amp;sk=5a2eaafcba5209e67cf7f30ffa95285b" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir">Python虚拟环境简介</strong> </a>了解如何在Python中设置虚拟环境。</p><p id="7d90" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建虚拟环境后，使用下面的命令安装python模块。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="5b8d" class="mv lt iq mr b gy mw mx l my mz">$ pip install requests bs4 pandas mysql-connector-python</span></pre><p id="9baf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">既然我们已经安装了模块，我们可以开始项目了。</p><h1 id="1eb5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">网页抓取</h1><p id="ba25" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">Python模块请求和漂亮的汤将被用于网页抓取。Request模块用于获取网页的HTML代码，beautiful soup将使从代码中抓取特定元素变得更加容易。</p><p id="8c08" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在浏览器中，打开网站并检查，以检查我们需要从页面中提取的所有元素。对于这个项目，我们必须提取第一个表。在下面的代码中，你可以看到我们是如何使用请求和漂亮的汤从网页中提取第一个表格的。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="530a" class="mv lt iq mr b gy mw mx l my mz"># import &lt;packages&gt;<br/>import requests<br/>from bs4 import BeautifulSoup4</span><span id="2857" class="mv lt iq mr b gy na mx l my mz"># getting HTML code from webpage and formatting<br/>URL = '<a class="ae lr" href="https://crypto.com/price" rel="noopener ugc nofollow" target="_blank">https://crypto.com/price</a>'<br/>response = request.get(URL)<br/>soup = BeautifulSoup4(response.text)</span><span id="aab2" class="mv lt iq mr b gy na mx l my mz"># scraping table element from HTML code<br/>table = soup.find('table')</span></pre><h2 id="6a1d" class="mv lt iq bd lu nb nc dn ly nd ne dp mc le nf ng me li nh ni mg lm nj nk mi nl bi translated">密码</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d08d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">HTML代码总是填充有多个嵌套元素，有时我们需要手动执行一些任务来获取文本数据。在第28–29行，我们需要过滤更多的内容来获得文本值。</p><p id="f15b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">执行上述代码后，我们将得到两个列表。第一个将存储表中的标题，第二个将以元组格式存储表行。此数据可以格式化为数据帧，并存储为CSV文件。</p><h2 id="1837" class="mv lt iq bd lu nb nc dn ly nd ne dp mc le nf ng me li nh ni mg lm nj nk mi nl bi translated">将原始数据转换为数据帧并存储为CSV文件</h2><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="3da1" class="mv lt iq mr b gy mw mx l my mz">from pandas import DataFrame</span><span id="16f5" class="mv lt iq mr b gy na mx l my mz">crypto_df = DataFrame(crypto_data, columns=heading)<br/>crypto_df.to_csv(&lt;path&gt;, index=False)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/7efbb81334bdc751c9ace32724b804bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*xr4r3knwOhlI_qUR2idvJQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">CSV文件</p></figure><h1 id="cc60" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">MySQL连接</h1><p id="6b9f" class="pw-post-body-paragraph kv kw iq kx b ky mk jr la lb ml ju ld le mm lg lh li mn lk ll lm mo lo lp lq ij bi translated">请参考下面的代码将MySQL数据库连接到Python。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="32c6" class="mv lt iq bd lu nb nc dn ly nd ne dp mc le nf ng me li nh ni mg lm nj nk mi nl bi translated">创建命令</h2><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="b8ce" class="mv lt iq mr b gy mw mx l my mz">CREATE TABLE `crypto_scraper`.`{table_name}` (<br/>    `Rank` INT NOT NULL,<br/>    `Name` VARCHAR(50) NOT NULL,<br/>    `Price` VARCHAR(20) NOT NULL,<br/>    `24H_Change` VARCHAR(20) NOT NULL,<br/>    `24H_Volume` VARCHAR(20) NOT NULL,<br/>    `Market_Cap` VARCHAR(20) NOT NULL,<br/>    PRIMARY KEY (`Name`)<br/>);</span></pre><p id="c892" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将表名作为变量，因为将创建一个新表来存储从网站上抓取的新数据。</p><p id="e021" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">文件名格式:<code class="fe np nq nr mr b">crypto_%Y%m%d%H%M%S</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/07f318e9b495f7f5faebeefb5a762d68.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*0w6l2CyDh0cvbFViX2IliQ.png"/></div></figure><h2 id="f032" class="mv lt iq bd lu nb nc dn ly nd ne dp mc le nf ng me li nh ni mg lm nj nk mi nl bi translated">插入命令</h2><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="af69" class="mv lt iq mr b gy mw mx l my mz">INSERT_COMMAND = \<br/>    'INSERT INTO {table} VALUES(%s, %s, %s, %s, %s, %s);'.format(<br/>        table=table_name)</span></pre><h2 id="350e" class="mv lt iq bd lu nb nc dn ly nd ne dp mc le nf ng me li nh ni mg lm nj nk mi nl bi translated">在Python中执行SQL命令</h2><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="7455" class="mv lt iq mr b gy mw mx l my mz">try:<br/>    cursor.execute(CREATE_COMMAND)<br/>    database.commit()</span><span id="21d1" class="mv lt iq mr b gy na mx l my mz">    cursor.executemany(INSERT_COMMAND, crypto_data)<br/>    database.commit()</span><span id="9318" class="mv lt iq mr b gy na mx l my mz">except Error as e:<br/>    print(e)</span></pre><p id="2219" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上述代码将把所有加密数据传递给数据库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/fa91b47521e2ba99d6e487f9f189d1cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*8GH9VAhZmqDFITijWQ4RWQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">表格描述</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/ec3bfd19c6abdffbb54a8c519e9ad44b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAaqAyrkCUmZAfuc9Smwng.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">MySQL数据</p></figure><p id="b165" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">GitHub回购:<a class="ae lr" href="https://github.com/arabind-meher/Crypto-Scraping.git" rel="noopener ugc nofollow" target="_blank">https://github.com/arabind-meher/Crypto-Scraping.git</a></p></div></div>    
</body>
</html>