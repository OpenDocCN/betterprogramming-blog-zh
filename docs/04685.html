<html>
<head>
<title>How to Create a Generator in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python创建生成器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-generator-in-python-5ee587621879?source=collection_archive---------12-----------------------#2020-04-29">https://betterprogramming.pub/how-to-create-a-generator-in-python-5ee587621879?source=collection_archive---------12-----------------------#2020-04-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8ebb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">生成器、Python和测试驱动开发</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/1002c2b3b334554bbbed83665e633739.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*S-StszgqzfwVbiNJFmjv5w.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Izabelle Acheson 在<a class="ae ku" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="61bd" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">自从2001年在PEP 255中引入以来，生成器一直是Python中的一个重要概念。那都快20年前了！生成器函数允许你以一种快速、简单、干净的方式创建一个迭代器。您可以将它们视为一个对象，可以非常容易地在其上循环或迭代。</p><p id="a762" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">作为初学者，编写迭代器可能非常复杂——更不用说编写测试了。我将使用测试驱动的开发方法(测试、编码和可选的重构)来解释，创建一个生成器实际上是非常容易的。我将在几分钟内带你从一个基本的例子到一个完整的发生器。所以坐到副驾驶座上，因为今天我是你的司机。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="bb84" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">让我们从你能想到的最基本的发电机开始</h1><p id="0e59" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">在这个例子中，我将向您展示如何创建您见过的最基本的生成器。我将创建一个只返回<code class="fe mv mw mx my b">1</code>的生成器。在我创建生成器之前，让我写一个测试。</p><h2 id="7454" class="mz lz it bd ma na nb dn me nc nd dp mi le ne nf mk li ng nh mm lm ni nj mo nk bi translated">试验</h2><p id="6132" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">所以我写了一个测试，创建了你能创建的最基本的生成器。下一个函数检索生成器的第一个值。测试期望第一个值是<code class="fe mv mw mx my b">1</code>。很简单，对吧？</p><p id="6c9a" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当我们运行测试时，我们会立即发现它甚至无法编译。没有人喜欢考试不及格。因此，我们要让它工作——这样我们可以看到美丽的绿色，而不是红色测试错误。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">测试生成值1</p></figure><h2 id="98ae" class="mz lz it bd ma na nb dn me nc nd dp mi le ne nf mk li ng nh mm lm ni nj mo nk bi translated">密码</h2><p id="1cc6" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">我们需要一个生成器函数，一个返回迭代器的函数。在Python中，你可以通过使用<code class="fe mv mw mx my b">yield</code>关键字简单地实现这一点。代码产生值<code class="fe mv mw mx my b">1</code>，之前编写的测试将会成功。我们就喜欢这样，对吧？编写最少的代码来使测试工作是一个好习惯。当然，我们不能就此打住。我们可以创建更具体的测试用例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">单值生成器</p></figure><p id="d051" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><strong class="kx iu">提示:</strong>调用<code class="fe mv mw mx my b">next</code>函数两次会导致错误。此时代码只产生一个值。当生成器遇到return语句或函数末尾时，生成器将停止生成新值。当然，如果你不相信我，你可以自己检查一下。我不会因此而反对你。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="126e" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">让我们尝试两个值</h1><h2 id="e590" class="mz lz it bd ma na nb dn me nc nd dp mi le ne nf mk li ng nh mm lm ni nj mo nk bi translated">试验</h2><p id="93cc" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">我们不能只停留在一个价值观上——那太荒谬了。我们想要的是生成多个值的生成器。因此，让我们尝试两个值，并朝着更好的解决方案努力。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">生成两个值的测试</p></figure><h2 id="0c76" class="mz lz it bd ma na nb dn me nc nd dp mi le ne nf mk li ng nh mm lm ni nj mo nk bi translated">密码</h2><p id="10ac" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">新编写的测试简单地调用了两次next函数。它期望第二个值是<code class="fe mv mw mx my b">2</code>。为了让这些测试工作，代码现在应该产生第一个值<code class="fe mv mw mx my b">1</code>和第二个值<code class="fe mv mw mx my b">2</code>。这应该很容易实现，对吗？</p><p id="07a1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们编写第二个<code class="fe mv mw mx my b">yield</code>语句。这也相当简单。您不必编写更多的代码来实现这一点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">两个值的生成器</p></figure><h2 id="3339" class="mz lz it bd ma na nb dn me nc nd dp mi le ne nf mk li ng nh mm lm ni nj mo nk bi translated">重构</h2><p id="2f3a" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">我们已经编写了最少量的所需产品代码；然而，我们可以改进我们的测试。</p><p id="cff4" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在这一点上，稍微重构一下测试并没有什么坏处——我们只需要保持这种我们都喜欢的绿色状态。生成器的创建是重复的代码。由于我们将很快为生成器编写更多的测试，生成器的实例化可以移到<code class="fe mv mw mx my b">setUp</code>方法中。毕竟，没有发电机，我们无法测试任何东西。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">用“setUp”方法重构</p></figure><h2 id="dc85" class="mz lz it bd ma na nb dn me nc nd dp mi le ne nf mk li ng nh mm lm ni nj mo nk bi translated">试验</h2><p id="46a7" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">停在两个值将是愚蠢的。我们的代码需要生成无限数量的数字。所以我们可以编写一个测试来生成<em class="nn"> n </em>个值。现在，我们看到一种模式正在形成。因此，让我们编写一个适用于更多值的测试—假设有<em class="nn"> n </em>个值(例如，<em class="nn"> n = 7 </em>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">添加生成n个值的测试(例如，n = 7)</p></figure><h2 id="535c" class="mz lz it bd ma na nb dn me nc nd dp mi le ne nf mk li ng nh mm lm ni nj mo nk bi translated">密码</h2><p id="0b25" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">在这一点上，我们最好编写一些更通用的东西，因为没有人能够为所有可能的数字编写一个测试。</p><p id="aa83" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">所以我们妥协了。实现将是一个简单的迭代器。它适用于任何值<code class="fe mv mw mx my b">n</code>。我们从<code class="fe mv mw mx my b">1</code>开始，循环将产生值——一次无限增加<code class="fe mv mw mx my b">1</code>。同样，编写足够可读的代码来完成这项工作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">生成n个(或更多)值的实现</p></figure><p id="acc1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当我们再次运行所有测试时，我们看到，当然，它们都是绿色的！很顺利，不是吗？</p><p id="87d6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当然，我们可以进一步改进测试。可以假设该实现对于任何<code class="fe mv mw mx my b">n</code>都是有效的。如果您担心值<code class="fe mv mw mx my b">n</code>等于<code class="fe mv mw mx my b">1000</code>时它不起作用，可以简单地用一个快速测试来验证它。然而，既然走那么远没有价值，我们就此打住。一个好的开发者有时候终究是懒的。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="fe1e" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">结论</h1><p id="4d94" class="pw-post-body-paragraph kv kw it kx b ky mq ju la lb mr jx ld le ms lg lh li mt lk ll lm mu lo lp lq im bi translated">恭喜你。您现在能够以测试驱动的方式编写任何生成器了！所以现在就自己试试吧。跳上驾驶座，让我看看你能做什么。如果你评论这个故事，我会给你反馈。你可以从简单的练习开始——比如生成<a class="ae ku" href="https://en.wikipedia.org/wiki/Fibonacci_number" rel="noopener ugc nofollow" target="_blank">斐波那契</a>数。</p><p id="83ab" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">你甚至不必就此打住。你为什么不创建一个从互联网上生成猫图像的生成器呢？只需要一个测试驱动的步骤，你就可以实现了。别忘了:熟能生巧！</p></div></div>    
</body>
</html>