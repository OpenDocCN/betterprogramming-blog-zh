<html>
<head>
<title>Getting Started With ArUco Markers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ArUco标记器入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-aruco-markers-b4823a43973c?source=collection_archive---------0-----------------------#2022-08-26">https://betterprogramming.pub/getting-started-with-aruco-markers-b4823a43973c?source=collection_archive---------0-----------------------#2022-08-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7a2a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在本文中，我们将使用Python和OpenCV来检测和估计ArUco标记的方向。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ba5703aa5ef37809adead1be7e567769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ilm9RDXEdtqq1IVc"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@d_dandelion?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> D Pl </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="3759" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将从生成ArUco标记开始。你可以使用一个特定的网站来创建一个接一个的标签，或者使用我的程序来生成整页的标记。</p><p id="b366" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你创建了一些标记，我将向你展示另一个程序来检测这些。该程序还可以确定这些ArUco标记的姿态轴。</p><p id="557f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在这里写的代码是用Python编写的，但是对于更高级的检测和姿态估计应用程序，您可能希望使用C++来实现它们。</p><p id="5c51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你在下面发现的是我的好奇心和想要实验图像处理的结果。欢迎任何建设性的意见。</p><h1 id="6e92" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">生成ArUco标记</h1><p id="7925" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果你想一个一个地创造阿鲁科标记，那么你可以使用奥列格·卡拉切夫的<a class="ae ky" href="https://chev.me/arucogen/" rel="noopener ugc nofollow" target="_blank">这个网站。该网站提供了一个简单的界面，如下所示:</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/9f16ee315fb4f9da141f8f2be08f6db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Suks6hYNZ4OjpmYFk7cHQ.png"/></div></div></figure><p id="5a1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择ArUco字典、标记的id和大小。然后下载马克笔并打印出来。</p><p id="bd59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想用ArUco马克笔打印整页，所以这个网站对我没有帮助。</p><p id="c2e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，OpenCV提供了两个名为<code class="fe mt mu mv mw b">cv.aruco.GridBoard.create()</code>和<code class="fe mt mu mv mw b">cv.aruco.GridBoard.draw()</code>的函数来完成这项工作——创建并随后绘制一整页的ArUco标记。你可以在这里阅读关于这些功能<a class="ae ky" href="https://docs.opencv.org/4.x/de/d05/classcv_1_1aruco_1_1GridBoard.html" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><p id="294b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我对测试这些功能的结果并不满意。ArUco标记的尺寸在打印时不正确，一些标记没有正确放置在页面的边框内，并且无法添加标记的id。</p><p id="563a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我决定编写自己的程序来生成ArUco标记页面。您可以在下面找到它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="6679" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个程序的想法是生成一个A4页面，在网格上放置ArUco标记(或April标签)。几个输入参数决定了该网格的大小:</p><ul class=""><li id="8efc" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">标记/标签的尺寸，单位为毫米</li><li id="e6b3" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">标记之间的边距大小，以mm为单位</li><li id="15d6" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">X方向的标签数量</li><li id="9e77" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">Y方向上的标签数量</li><li id="3736" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">标签的id是否应该写在标签上面</li></ul><p id="fc60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该程序将确定所提供的参数是否会产生一个网格，该网格将适当地停留在A4页面的边界内。如果不是这样，程序将输出一个错误信息。</p><p id="0457" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了上述参数，您还可以提供以下其他参数:</p><ul class=""><li id="4c43" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">图像输出文件的名称</li><li id="39db" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">要放在页面上的第一个标记的id</li><li id="8199" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">输出图像的DPI</li><li id="eeab" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">要生成的标记或标签的类型</li></ul><p id="65a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是如何生成带有标记的页面的一些示例:</p><p id="2310" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">python aruco_gen_page.py -o "aruco_markers.png" -i 0 -t "DICT_5X5_50" -d 72 --write-id -x 3 -y 4</code></p><p id="d35f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将产生以下页面:</p><div class="kj kk kl km gt ab cb"><figure class="nn kn no np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/db0a991c53cbbde7c2df8b46fdda8fb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*KNq5qdklyoMwfV-OTs3B8A.png"/></div></figure><figure class="nn kn nt np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/401549659eab5873dcfbd441945842b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*0px5Y1-SVCw3l-QsIQQmCQ.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk nu di nv nw translated">左边是输出图像，右边是打印时的默认尺寸(50 mm)和边距(5mm)。</p></figure></div></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="e601" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">python aruco_gen_page.py -o "aruco_markers.png" -i 10 -t "DICT_4X4_50" -d 72 -s 25 -m 10 --no-write-id -x 5 -y7</code></p><p id="9af8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它给出了以下结果:</p><div class="kj kk kl km gt ab cb"><figure class="nn kn no np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/898c3e6b535ebdd42285eeb55255e15c.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*-FkrrEdhmTuwPW4sMiIGng.png"/></div></figure><figure class="nn kn nt np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/057db57ff47935281af07960628c5475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*c7JuLqBUOL8QPjc-Idk1zA.jpeg"/></div><p class="ku kv gj gh gi kw kx bd b be z dk nu di nv nw translated">左边是输出图像，右边可以看到打印时的尺寸(25mm)和边距(10 mm)是正确的。</p></figure></div></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="cb37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为确保在使用Windows 11时正确打印生成的图像，最佳打印方法如下:</p><p id="75ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前往输出带有标记的图像的文件夹。然后右键单击图标并选择“打印”您将看到下面的对话框(可能不像我的部分是荷兰语):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi gj"><img src="../Images/39f9e529c065e77df0c9d7ef9f430e96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_Manj8Ed52BXkkYypZO3g.png"/></div></div></figure><p id="5916" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里选择您的打印机，将纸张设置为A4，并选择“标准”质量和“普通”纸张(尽管我怀疑这些设置可能因打印机而异)。确保选择了“整页照片”并选中了“图片适合框架”。</p><p id="9b35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我没有在其他操作系统上测试过这个程序。</p><h1 id="357f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">检测和估计我们ArUco标记的姿态</h1><p id="1ddd" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在我们能够检测和估计标记的姿态之前，我们需要校准我们的相机。如何做到这一点，请看我下面的文章。</p><div class="oe of gp gr og oh"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-calibrate-a-camera-using-python-and-opencv-23bab86ca194"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">如何使用Python和OpenCV校准相机</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">在本文中，我们将看看如何确定单目相机的相机矩阵和失真系数…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">better编程. pub</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div><p id="90e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你校准了你的相机，你需要得到相机矩阵和失真系数。我已经把这些放在一个JSON文件中，如本文所示。</p><p id="086e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我用来检测和估算的程序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="c78b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，从JSON文件中加载相机矩阵和失真系数。</p><p id="52ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，从摄像机中读取一帧，以确定视频流中图像的宽度和高度。</p><p id="d974" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，使用OpenCV函数<code class="fe mt mu mv mw b">cv2.getOptimatlNewCameraMatrix()</code>和<code class="fe mt mu mv mw b">cv2.unitUndistortRectifyMap()</code>确定感兴趣区域<code class="fe mt mu mv mw b">roi</code>，以及<code class="fe mt mu mv mw b">mapx</code>和<code class="fe mt mu mv mw b">mapy</code>参数。</p><p id="e5a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在无限循环中，我们从视频流中读取一帧。使用我们刚刚找到的<code class="fe mt mu mv mw b">mapx</code>和<code class="fe mt mu mv mw b">mapy</code>参数重新映射(不失真)这个帧。此外，图像仅被裁剪为包含感兴趣的区域。</p><p id="bf80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以开始使用<a class="ae ky" href="https://docs.opencv.org/4.x/d4/d17/namespacecv_1_1aruco.html#a061ee5b694d30fa2258dd4f13dc98129" rel="noopener ugc nofollow" target="_blank"> OpenCV函数</a> <code class="fe mt mu mv mw b">cv2.aruco.detectMarkers()</code>检测标记。我还包括了使用当前图像帧的灰度版本的可能性。</p><p id="6e44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，如果检测到一些标记(通过它们的角来标注)，我们可以使用<a class="ae ky" href="https://docs.opencv.org/4.x/d9/d6a/group__aruco.html#ga2ad34b0f277edebb6a132d3069ed2909" rel="noopener ugc nofollow" target="_blank">函数</a> <code class="fe mt mu mv mw b">cv2.aruco.drawDetectedMarkers()</code>在视频帧中的标记周围画一个框，包括id。可选地，我们也可以使用<code class="fe mt mu mv mw b">cv2.estimatePoseSingleMarkers()</code>和<code class="fe mt mu mv mw b">cv2.aruco.drawFrameAxes()</code>绘制显示帧中每个标记的姿态的轴。在这里和这里<a class="ae ky" href="https://docs.opencv.org/4.x/d9/d0c/group__calib3d.html#gab3ab7bb2bdfe7d5d9745bb92d13f9564" rel="noopener ugc nofollow" target="_blank">阅读关于这些功能</a><a class="ae ky" href="https://docs.opencv.org/4.x/d9/d6a/group__aruco.html#ga56878c4f94362c9420f20b78de0def9b" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><p id="709d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们使用<code class="fe mt mu mv mw b">cv2.imshow()</code>在屏幕上的GUI中显示该帧。</p><p id="9939" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是来自GUI的两个截图，显示程序正确地确定了姿势的轴和我们之前生成的页面上每个标记的id。</p><div class="kj kk kl km gt ab cb"><figure class="nn kn ow np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/7b53db4a83ac468585c35153bd0a2d91.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*3KJdziElaWZ-Bfj5uTPDIg.png"/></div></figure><figure class="nn kn ow np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/e46d9af4c12eaea3fb7d66c97f92091f.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*hpZVhqRt0byA3wkvZViGVQ.png"/></div></figure></div><p id="49de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我保持页面相对静止或轻微移动时，大多数或所有标记都会被检测到。另一方面，如果我将页面快速移过相机，那么在某个时刻，将不会检测到标记。我的猜测是，我们所做的Python实现运行速度不够快，无法“跟随”。</p><p id="72f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果这是正确的，并且如果我们需要检测ArUco标记以供例如自动驾驶车辆使用，那么应该用C++来实现，以便足够快地工作。</p><h1 id="98ce" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><p id="d396" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><a class="ae ky" href="https://pyimagesearch.com/2020/12/14/generating-aruco-markers-with-opencv-and-python/" rel="noopener ugc nofollow" target="_blank">Pyimagesearch的“使用OpenCV和Python生成ArUco标记”</a></p><p id="e056" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://pyimagesearch.com/2020/12/21/detecting-aruco-markers-with-opencv-and-python/" rel="noopener ugc nofollow" target="_blank">Pyimagesearch的“使用OpenCV和Python检测ArUco标记”</a></p><p id="900d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://programming.vip/docs/3d-pose-estimation-using-aruco-tag-in-python.html" rel="noopener ugc nofollow" target="_blank">“使用python中的aruco标签进行3D姿态估计”由programming.vip完成</a></p><p id="03bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.programcreek.com/python/example/89319/cv2.initUndistortRectifyMap" rel="noopener ugc nofollow" target="_blank">《Python cv2 . initundistortrectifymap()示例》programcreek.com</a></p></div></div>    
</body>
</html>