<html>
<head>
<title>Using Docker as a Playground to Experiment With MkDocs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker作为试验MkDocs的平台</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-docker-as-playground-to-experiment-mkdocs-da13700799d6?source=collection_archive---------9-----------------------#2020-07-23">https://betterprogramming.pub/using-docker-as-playground-to-experiment-mkdocs-da13700799d6?source=collection_archive---------9-----------------------#2020-07-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="84cd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Docker保持机器清洁</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8c7d960e4981b8723f5e150e8e440b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ORuA5wXUK1Z-Cbxr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">帕斯卡尔·迈耶在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="315f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近了解到这个奇妙的项目文档工具叫做<a class="ae ky" href="https://www.mkdocs.org/" rel="noopener ugc nofollow" target="_blank"> MkDocs </a>，它使用Markdown语言。</p><p id="0692" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要试用它，您需要在您的机器上安装Python、PIP并下载MkDocs。我试图避免用各种软件污染我的机器，只是为了试验一些东西，所以我试图在Docker中交互地做所有这些。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5f68" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">逐步指南</h1><p id="b296" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://www.mkdocs.org/#installation" rel="noopener ugc nofollow" target="_blank">文档</a>指出安装MkDocs需要Python，所以我用一个<code class="fe mz na nb nc b">python:3</code>图像启动了一个Docker容器:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="b223" class="nh md it nc b gy ni nj l nk nl">docker run -it --rm -p 5000:8000 python:3</span></pre><ul class=""><li id="205e" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><code class="fe mz na nb nc b">-it</code>是让它交互运行。</li><li id="0b8b" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><code class="fe mz na nb nc b">-p 5000:8000</code>是将内部<code class="fe mz na nb nc b">8000</code>端口映射到我计划稍后使用的外部<code class="fe mz na nb nc b">5000</code>端口。</li><li id="4db1" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><code class="fe mz na nb nc b">--rm</code>是在我们退出时清除Docker容器。</li></ul><p id="0e13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成上述操作后，您将看到Python的RTE:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="5cef" class="nh md it nc b gy ni nj l nk nl">Python 3.8.5 (default, Jul 22 2020, 12:28:11)<br/>[GCC 8.3.0] on linux<br/>Type "help", "copyright", "credits" or "license" for more information.<br/>&gt;&gt;&gt;</span></pre><p id="ed3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，你需要运行<code class="fe mz na nb nc b">pip</code>来安装MkDocs。然而，<code class="fe mz na nb nc b">python:3</code>镜像启动了一个Python RTE。它没有为我们提供一个非常友好的控制台来运行Unix shell命令。因此，需要使用<code class="fe mz na nb nc b"><a class="ae ky" href="https://docs.python.org/3/library/os.html" rel="noopener ugc nofollow" target="_blank">os</a></code>库API。</p><p id="6695" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装<code class="fe mz na nb nc b">os</code>:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="990c" class="nh md it nc b gy ni nj l nk nl">import os</span></pre><p id="3ba5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个，要执行任何命令，都可以使用<code class="fe mz na nb nc b">os.system('my command')</code>。现在，您可以在Docker容器中使用下面的命令轻松安装MkDocs:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="ba66" class="nh md it nc b gy ni nj l nk nl">os.system(‘pip install mkdocs’)</span></pre><p id="d92f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，运行<code class="fe mz na nb nc b">mkdocs</code>来创建一个新项目:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="c769" class="nh md it nc b gy ni nj l nk nl">os.system('mkdocs new my-project')</span></pre><p id="ba7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧，你可以在Docker中运行<code class="fe mz na nb nc b">mkdocs</code>。</p><p id="9714" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们进入<code class="fe mz na nb nc b">my-project</code>。这一次，你不能使用<code class="fe mz na nb nc b">os.system('cd my-project')</code>，因为这是一个临时状态，之后它会回到原来的文件夹。为了改变文件夹，您需要使用<code class="fe mz na nb nc b">os</code>提供的API:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="25f3" class="nh md it nc b gy ni nj l nk nl">os.chdir('my-project')</span></pre><p id="878d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只是为了检查您是否在文件夹中，运行另一个<code class="fe mz na nb nc b">os</code> API，如下所示:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="2f2c" class="nh md it nc b gy ni nj l nk nl">os.getcwd()</span></pre><p id="1b9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显示<code class="fe mz na nb nc b">'/my-project'</code>。太好了！你进入了文件夹。</p><p id="df11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，使用下面的命令运行MkDocs默认项目:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="14e9" class="nh md it nc b gy ni nj l nk nl">os.system('mkdocs serve --dev-addr=0.0.0.0:8000')</span></pre><p id="5f71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您可以看到MyDoc正在运行:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="49ad" class="nh md it nc b gy ni nj l nk nl">[I 200723 13:48:49 server:334] Serving on <a class="ae ky" href="http://0.0.0.0:800" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:800</a><br/>INFO    -  Serving on <a class="ae ky" href="http://0.0.0.0:8000" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:8000</a><br/>[I 200723 13:48:49 handlers:62] Start watching changes<br/>INFO    -  Start watching changes<br/>[I 200723 13:48:49 handlers:64] Start detecting changes<br/>INFO    -  Start detecting changes</span></pre><p id="6736" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要用浏览器查一下<code class="fe mz na nb nc b">localhost:5000</code>就能看到它在运行！记住，我们先前设定的<code class="fe mz na nb nc b">-p 5000:8000</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/b385cf88eb9e21ad50df363355b16932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIHBgwjkWJ3w0vdGfGv-XQ.png"/></div></div></figure><p id="f324" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不错！若要退出服务，请按Ctrl+c，若要退出Docker容器，请按Ctrl+d。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fdde" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">带有Dockerfile文件的图像</h1><p id="d6e2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">上面的方法是交互式的。如果你不得不一次又一次地这样做，那么就创建一个docker文件来制作它的映像。这样会更有成效。</p><p id="b629" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要像前面一样在Dockerfile文件中执行所有相同的步骤，只需编写以下代码:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="d598" class="nh md it nc b gy ni nj l nk nl">FROM python:3<br/>RUN pip install mkdocs<br/>RUN mkdocs new my-project<br/>EXPOSE 8000<br/>WORKDIR /my-project<br/>ENTRYPOINT ["mkdocs"]<br/>CMD ["serve", "--dev-addr=0.0.0.0:8000"]</span></pre><p id="89b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在docker文件所在的文件夹中，运行以下命令来构建映像:</p><p id="688a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ob">注意:您可以将</em> <code class="fe mz na nb nc b"><em class="ob">elye/my-mkdocs</em></code> <em class="ob">替换为自己喜欢的图像名称。</em></p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="f31c" class="nh md it nc b gy ni nj l nk nl">docker build -t elye/my-mkdocs ./</span></pre><p id="3b4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了图像后，您可以运行它:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="32a6" class="nh md it nc b gy ni nj l nk nl">docker run -p 5000:8000 --rm elye/my-mkdocs</span></pre><p id="cdd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你们都完了。你可以在<code class="fe mz na nb nc b">localhost:5000</code>里浏览，会和你刚才互动的一样！</p><p id="daae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你完成后，如果你愿意，你可以很容易地把你的图片上传到Docker Hub。如果您决定删除该图像，只需使用以下命令:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="64e1" class="nh md it nc b gy ni nj l nk nl">docker image prune -a</span></pre><p id="a6d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">键入<code class="fe mz na nb nc b">y</code>删除所有不再使用的图像。然后你的机器会像原来一样干净，不需要在你的机器上安装任何东西！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure></div></div>    
</body>
</html>