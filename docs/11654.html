<html>
<head>
<title>How to Upload Files and Images in Your Django Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Django应用程序中上传文件和图像</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-upload-files-and-images-in-your-django-application-f4d086890e53?source=collection_archive---------2-----------------------#2022-04-06">https://betterprogramming.pub/how-to-upload-files-and-images-in-your-django-application-f4d086890e53?source=collection_archive---------2-----------------------#2022-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4812" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Django文件和图像上传</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3ee0f36468e997f0c403aff74deab6ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TRE8E-9FviSIjhSfBqSMsw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">照片由:</strong>T5】马太·亨利</p></figure><p id="9ec3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">上传文件和图像每天都在发生，无论您是向工作同事发送文档，还是将媒体上传到您最喜爱的社交媒体平台。</p><p id="3021" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在本指南中，您将学习在Django应用程序中上传文件和图像。您还将学习如何从您的Django应用程序中提供文件。</p><h1 id="bf36" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">项目设置</h1><p id="1bce" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">我们将从创建一个目录开始，我们的项目和虚拟环境将存放在这个目录中。</p><p id="9d80" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">创建一个目录，cd到该目录并创建一个虚拟环境:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="bc81" class="my lx it mu b gy mz na l nb nc">mkdir filesDjango<br/>cd  filesDjango<br/>python3.8 -m venv env</span></pre><p id="d13c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">建议使用虚拟环境来保持项目依赖关系独立于操作系统。激活虚拟环境并在虚拟环境中安装Django:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="e85a" class="my lx it mu b gy mz na l nb nc">source env/bin/activate</span><span id="a575" class="my lx it mu b gy nd na l nb nc">pip install Django</span></pre><p id="f8fa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">创建一个名为file uploads的新Django项目:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="bc0e" class="my lx it mu b gy mz na l nb nc">django-admin startproject fileuploads</span></pre><p id="32ab" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在Django项目目录中，创建一个名为files的应用程序。Django中的应用程序用于分离不同的组件，对于扩展应用程序至关重要。</p><p id="02be" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">应用程序也是可移动的部分，可以在不破坏代码的情况下移动到另一个Django项目。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="41f7" class="my lx it mu b gy mz na l nb nc">django-admin startapp files</span></pre><p id="a960" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">将应用程序文件添加到<code class="fe ne nf ng mu b">settings.py</code>文件中的已安装应用程序列表</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3f25" class="my lx it mu b gy mz na l nb nc">INSTALLED_APPS = [</span><span id="0c32" class="my lx it mu b gy nd na l nb nc">'django.contrib.admin',</span><span id="8eb1" class="my lx it mu b gy nd na l nb nc">'django.contrib.auth',</span><span id="3bc6" class="my lx it mu b gy nd na l nb nc">'django.contrib.contenttypes',</span><span id="f903" class="my lx it mu b gy nd na l nb nc">'django.contrib.sessions',</span><span id="b9ef" class="my lx it mu b gy nd na l nb nc">'django.contrib.messages',</span><span id="c3e0" class="my lx it mu b gy nd na l nb nc">'django.contrib.staticfiles',</span><span id="6f0a" class="my lx it mu b gy nd na l nb nc">'files',</span><span id="0d9f" class="my lx it mu b gy nd na l nb nc">]</span></pre><p id="2fba" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Django使用MEDIA_ROOT和MEDIA_URL设置在本地存储文件。让我们在settings.py中定义这些常量</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="8fd6" class="my lx it mu b gy mz na l nb nc">import os</span><span id="9e63" class="my lx it mu b gy nd na l nb nc">MEDIA_URL = "/media/"</span><span id="b5da" class="my lx it mu b gy nd na l nb nc">MEDIA_ROOT = os.path.join(BASE_DIR, 'media')</span></pre><p id="b446" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">MEDIA_ROOT将用于管理我们存储的文件，而MEDIA_URL将是所提供的媒体的URL</p><h1 id="5ebc" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">上传文件</h1><p id="e536" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">用FileFields模型字段上传文件是最容易上传文件的。让我们首先在models.py中创建一个简单的模型类，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="babf" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们的模型有3个字段，即电子邮件、姓名和要上传的文件。文件字段中的upload_to属性指向文件在应用程序中的存储位置</p><h2 id="e8cb" class="my lx it bd ly nj nk dn mc nl nm dp mg lj nn no mi ln np nq mk lr nr ns mm nt bi translated">运行迁移</h2><p id="4196" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">迁移将在数据库中创建实际的表。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="bb27" class="my lx it mu b gy mz na l nb nc">python3.8 manage.py migrate</span></pre><h2 id="5146" class="my lx it bd ly nj nk dn mc nl nm dp mg lj nn no mi ln np nq mk lr nr ns mm nt bi translated">形式</h2><p id="c689" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">Django附带了一个内置的ModelForm类，使得从模型字段创建表单变得很容易。创建一个名为forms.py的新文件，并添加以下代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="f4da" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">一旦我们定义了上面的表单，我们将使用视图中的POST请求使用<code class="fe ne nf ng mu b">request.FILES</code>从表单中获取数据。<br/>让我们编写视图来获取表单中包含的数据。打开view.py，编写以下代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="57b0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在上面的代码中，我们首先检查方法是否是POST，然后从表单中获取数据，验证它并保存到数据库中。如果方法是GET，我们在模板中呈现表单。</p><p id="bde9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们还没有创建用于呈现表单的<code class="fe ne nf ng mu b">upload.html</code>模板，所以让我们开始吧。Django自动在模板目录中查找模板，因此创建如下文件</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="65cf" class="my lx it mu b gy mz na l nb nc">templates/<br/>       files/<br/>         -upload.html</span></pre><p id="9bd4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要在模板中提供表单，表单必须有属性<code class="fe ne nf ng mu b">enctype=”multipart/form-data</code>。“否则，<code class="fe ne nf ng mu b">request.FILES</code>将返回空值</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="638e" class="my lx it mu b gy mz na l nb nc">{% block content %}<br/>&lt;form method = "post", enctype="multipart/form-data"&gt;<br/>   {% csrf_token %}<br/>   {{ form.as_p }}<br/>   &lt;button type="submit"&gt; Submit&lt;/button&gt;<br/>&lt;/form&gt;<br/>{% endblock %}</span></pre><p id="126e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">csrf_token标记将保护表单免受恶意数据的攻击，而form.as_p将字段显示为段落。</p><h1 id="2bef" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">注册URL路径</h1><p id="ab9c" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">第一步是创建一个urls.py文件来注册用于显示表单的URL。创建一个文件<code class="fe ne nf ng mu b">urls.py</code>，并添加以下代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="f141" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，在根<code class="fe ne nf ng mu b">url.py</code>文件中注册文件URL，如下所示</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="9987" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，如果您运行server并导航到<a class="ae kz" href="http://127.0.0.1:8000/upload_resume/" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/upload _ resume/</a>，您应该会看到如下所示的表单</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/3935fda34c0f8233d64f8e23be788936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sg6yTkRIoNqVrkenCzUg-g.png"/></div></div></figure><h2 id="091b" class="my lx it bd ly nj nk dn mc nl nm dp mg lj nn no mi ln np nq mk lr nr ns mm nt bi translated">Django管理</h2><p id="844b" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">Django附带了Django admin，这是一个强大的接口，允许开发人员添加数据。让我们在admin.py中注册简历模型，如下所示:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5507" class="my lx it mu b gy mz na l nb nc">from django.contrib import admin</span><span id="f963" class="my lx it mu b gy nd na l nb nc">from .models import Resume<br/></span><span id="6b45" class="my lx it mu b gy nd na l nb nc"># Register your models here.</span><span id="4f2c" class="my lx it mu b gy nd na l nb nc">admin.site.register(Resume)</span></pre><h2 id="dccf" class="my lx it bd ly nj nk dn mc nl nm dp mg lj nn no mi ln np nq mk lr nr ns mm nt bi translated">创建超级用户</h2><p id="55f1" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">超级用户将允许你执行管理工作</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3f1b" class="my lx it mu b gy mz na l nb nc">python3.8 manage.py createsuperuser<br/>Username (leave blank to use 'earthtoast'): <br/>Email address: <br/>Password: <br/>Password (again): <br/>Superuser created successfully.</span></pre><p id="dd8e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在导航到<a class="ae kz" href="http://127.0.0.1:8000/admin/" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/admin/</a>用我们上面创建的超级用户登录，就可以查看提交的数据了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/82f353b62fa3fc7782db65b12bd33b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9yUPrl6JocMxi85PZ22DEA.png"/></div></div></figure><p id="811a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">正如您在上面看到的，文件已经存储在files目录中。</p><h2 id="00a4" class="my lx it bd ly nj nk dn mc nl nm dp mg lj nn no mi ln np nq mk lr nr ns mm nt bi translated">在Django应用程序中上传图片</h2><p id="d3ee" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">我们已经看到了如何使用FileField上传文件；图像呢？。为了上传图像，我们将使用am ImageField。转到模型并添加图像字段，如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="f85c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们上面定义的<code class="fe ne nf ng mu b">imageField</code>需要<a class="ae kz" href="https://pypi.org/project/Pillow/" rel="noopener ugc nofollow" target="_blank"> pillow </a>库，所以让我们用pip安装<code class="fe ne nf ng mu b">pillow</code>。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7197" class="my lx it mu b gy mz na l nb nc">pip install Pillow</span></pre><p id="46e9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">应用迁移来实现对我们的模型所做的更改。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="2059" class="my lx it mu b gy mz na l nb nc">python3.8 manage.py makemigrations files<br/>Migrations for 'files':<br/>  files/migrations/0002_image.py<br/>    - Create model Image<br/></span></pre><p id="0657" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">运行迁移命令</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a8ac" class="my lx it mu b gy mz na l nb nc">python3.8 manage.py migrate <br/>Operations to perform:<br/>  Apply all migrations: admin, auth, contenttypes, files, sessions<br/>Running migrations:<br/>  Applying files.0002_image... OK</span></pre><p id="26ba" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，我们将创建一个表单，就像前面创建简历表单一样。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="dbe0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，让我们创建用于呈现图像上传表单的视图。在views.py中，添加以下代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="9545" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在templates文件夹中创建文件<code class="fe ne nf ng mu b">image.html</code>,并添加以下代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="6ad6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，将<code class="fe ne nf ng mu b">upload_imge</code>视图挂接到URL。打开urls.py并添加以下代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="ab21" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">您的图像上传表格可在<a class="ae kz" href="http://127.0.0.1:8000/upload_images/" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/upload _ images/</a>找到</p><h2 id="400e" class="my lx it bd ly nj nk dn mc nl nm dp mg lj nn no mi ln np nq mk lr nr ns mm nt bi translated">提供文件</h2><p id="398c" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">第一步是在<code class="fe ne nf ng mu b">settings.py</code>文件的<code class="fe ne nf ng mu b">TEMPLATES</code>的<code class="fe ne nf ng mu b">context_processors</code>选项中添加<code class="fe ne nf ng mu b">django.template.context_processors.media</code>，<br/>设置这个选项将允许我们在模板中使用<code class="fe ne nf ng mu b">{{ MEDIA_URL }}</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="4a29" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，更新视图以从数据库中获取我们的图像。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="b900" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">更新<code class="fe ne nf ng mu b">image.html</code>模板以显示我们的图像</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="fa96" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们可以在开发期间使用<code class="fe ne nf ng mu b"><a class="ae kz" href="https://docs.djangoproject.com/en/dev/ref/views/#django.views.static.serve" rel="noopener ugc nofollow" target="_blank">django.views.static.serve()</a></code>视图从媒体路径提供上传的文件。让我们将下面的路径添加到根URL文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="ce6a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，如果您导航到<a class="ae kz" href="http://127.0.0.1:8000/upload_images/" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/upload _ images/</a>，图像将按预期显示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/2646022515b84094d77272c34e286067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGE54RnGLuPBhumcnlfBzQ.png"/></div></div></figure><h1 id="4845" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">结论</h1><p id="8a32" class="pw-post-body-paragraph la lb it lc b ld mo ju lf lg mp jx li lj mq ll lm ln mr lp lq lr ms lt lu lv im bi translated">本教程涵盖了在Django项目中开始处理文件和媒体所需的一切。Pillow library还提供了许多功能，用于打开、操作和保存许多不同的图像文件格式。</p><div class="nv nw gp gr nx ny"><a rel="noopener  ugc nofollow" target="_blank" href="/build-a-personal-journal-with-django-and-python-f4835d27368c"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">用Django和Python创建个人日志</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">构建Django web应用程序</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">better编程. pub</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ks ny"/></div></div></a></div></div></div>    
</body>
</html>