<html>
<head>
<title>How to Securely Deploy a MERN Stack App on AWS EC2 With LetsEncrypt SSL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用LetsEncrypt SSL在AWS EC2上安全部署MERN堆栈应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/deploy-mern-stack-app-on-aws-ec2-with-letsencrypt-ssl-8f463c01502a?source=collection_archive---------0-----------------------#2020-09-23">https://betterprogramming.pub/deploy-mern-stack-app-on-aws-ec2-with-letsencrypt-ssl-8f463c01502a?source=collection_archive---------0-----------------------#2020-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b169" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">立即推送您的应用程序(2021年12月更新)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4dfc59f37bc4b030a962195e92a6402e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*muCAjJFgsIzAA9Wuzmt_4w.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://www.pexels.com/@harrison-candlin-1279336?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">哈里森·坎德林</a>从<a class="ae kv" href="https://www.pexels.com/photo/new-zealand-topography-from-above-2441454/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a>拍摄</p></figure><p id="7b13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我要说的是，我写这篇文章的主要原因之一是，每当我必须部署一个MERN应用程序时，我都有一个基本的蓝图可以遵循。我把所有的步骤都集中在一个地方，这样我就可以随时方便地查阅，因为所有这些信息花了我太长时间来收集和拼凑。我想如果我把它公之于众，可能也会对其他人有所帮助。(请注意:我知道本指南绝不是部署MERN堆栈应用程序的完美指南，但这是一个适合我的指南。)</p><p id="f1c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们开始之前，请系紧你们的安全带，因为这将是一次长途旅行。如果中途出了什么问题，请永远记住:</p><blockquote class="ls"><p id="45c6" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">“不要害怕失败。犯罪的不是失败，而是目标低。在伟大的尝试中，即使失败也是光荣的。”——李小龙</p></blockquote><p id="27e5" class="pw-post-body-paragraph kw kx iq ky b kz mc jr lb lc md ju le lf me lh li lj mf ll lm ln mg lp lq lr ij bi translated">再试一次。</p><p id="cff6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，首先根据下面的内容创建一个EC2实例。</p><p id="53c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，选择Ubuntu 18.04 LTS，并选择免费层。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/8a7608615e32ed4614d89ea606c63c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0CSpNS1SpNkbtmXTMV5Lw.png"/></div></div></figure><p id="d113" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其次，在上面选择的实例的安全组设置中创建以下条目。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/192fb26d59e753c96aba44baada315a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BK-aafwRQN7RAWv_3PRWxA.png"/></div></div></figure><p id="6240" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第三，创建一个安全密钥对，并下载如图所示的<code class="fe mj mk ml mm b">.pem</code>文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/a7842ecc28470b2f3e31c7775f5a7147.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kNHpQSjen5zAJ-NKxvluIw.png"/></div></figure><p id="5186" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，保留AWS建议的所有内容，并启动实例。</p><p id="d16d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">按照AWS在Mac上的建议，使用SSH连接到实例，或者如果您是Windows用户，那么按照AWS指南中关于如何使用Putty连接到实例的说明，如该链接中所述。<br/><a class="ae kv" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/putty.html?icmpid=docs_ec2_console" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/AWS ec2/latest/user guide/putty . html？icmpid=docs_ec2_console </a></p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><p id="3625" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">连接后，您需要在实例上设置以下内容列表，以便应用程序运行。</p><ol class=""><li id="4757" class="mv mw iq ky b kz la lc ld lf mx lj my ln mz lr na nb nc nd bi translated"><a class="ae kv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和<a class="ae kv" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a></li><li id="c9a0" class="mv mw iq ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">代码设置(<a class="ae kv" href="https://git-scm.com/" rel="noopener ugc nofollow" target="_blank"> git </a>或FTP)</li><li id="a319" class="mv mw iq ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">网络服务器(<a class="ae kv" href="https://www.nginx.com/" rel="noopener ugc nofollow" target="_blank"> nginx </a>)</li><li id="8e34" class="mv mw iq ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">数据库(<a class="ae kv" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>)</li><li id="bc68" class="mv mw iq ky b kz ne lc nf lf ng lj nh ln ni lr na nb nc nd bi translated">流程经理(<a class="ae kv" href="https://pm2.keymetrics.io/" rel="noopener ugc nofollow" target="_blank"> PM2 </a></li></ol><p id="078c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以上都是在AWS上运行MERN应用程序所必需的。从现在开始，它将使用大量命令来设置所有这些东西。我会尽量保持简单。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="4809" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">节点和国家预防机制</h1><p id="1afb" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">为了安装Node 12和npm 6，我们需要更新和升级实例APT存储库。</p><h2 id="60c0" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated"><strong class="ak">第一步。</strong></h2><p id="0484" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">作为一种规范，我们致力于更新系统，以确保我们没有依赖问题。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="4aa5" class="og nk iq mm b gy ow ox l oy oz">sudo apt update</span><span id="68e4" class="og nk iq mm b gy pa ox l oy oz">sudo apt -y upgrade</span></pre><h2 id="ea09" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated"><strong class="ak">第二步。</strong></h2><p id="021e" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">Node的所有版本都来自官方的APT库。但是，这需要手动添加到您的系统中。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="d2d1" class="og nk iq mm b gy ow ox l oy oz">sudo apt update<br/>sudo apt -y install curl dirmngr apt-transport-https lsb-release ca-certificates<br/>curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -</span></pre><h2 id="16f7" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated"><strong class="ak">第三步。</strong></h2><p id="ab57" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">已添加节点存储库。现在安装它。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="65be" class="og nk iq mm b gy ow ox l oy oz">sudo apt -y install nodejs</span></pre><p id="6466" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您也可以安装用于构建本地附加组件的开发工具:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="e13f" class="og nk iq mm b gy ow ox l oy oz">sudo apt -y  install gcc g++ make</span></pre><p id="1e1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过检查安装的版本来确认节点12的安装。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="dd70" class="og nk iq mm b gy ow ox l oy oz">$ node --version<br/>v12.10.0<br/><br/>$ npm --version<br/>6.10.3</span></pre><p id="1472" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果一切正常，那么您已经成功安装了节点和NPM。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="3d84" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">代码设置(git或FTP)</h1><p id="a92d" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">在设置web服务器之前，您需要在服务器上有项目代码，以便可以在实例上运行它。有两种方法可以做到这一点:通过连接FTP，如底部的附加材料部分所述，或者使用git。如果您计划使用FTP，那么您可以完全忽略这一部分，继续设置nginx。首先，确保项目的文件夹结构如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/2ae961fb419ef8dd7e081491acbc6fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/format:webp/1*-KOPdFpNR3V9OyDGD81gkw.png"/></div></figure><p id="1853" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要使用git，我们必须使用以下命令安装它:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="726e" class="og nk iq mm b gy ow ox l oy oz">sudo apt install git -y</span></pre><p id="7cd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用以下命令确认git已安装:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="f41e" class="og nk iq mm b gy ow ox l oy oz">git --version</span></pre><p id="e5dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，使用以下代码克隆您的项目:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="b702" class="og nk iq mm b gy ow ox l oy oz">sudo git clone {{your project file path on github/git}}</span></pre><p id="290a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成后，导航到项目文件夹:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="4bb4" class="og nk iq mm b gy ow ox l oy oz">cd /{{your cloned repo’s name}}</span></pre><p id="f94c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用此选项安装服务器依赖项:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="10d0" class="og nk iq mm b gy ow ox l oy oz">sudo npm install</span></pre><p id="6d71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后导航到客户端文件夹:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="2dc3" class="og nk iq mm b gy ow ox l oy oz">cd /client</span></pre><p id="b748" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，安装客户端依赖项，如下所示:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="5978" class="og nk iq mm b gy ow ox l oy oz">sudo npm install</span></pre><p id="609e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的<code class="fe mj mk ml mm b">Client</code>文件夹包含React应用程序的源代码。现在，您可以使用以下命令将其编译成优化的包:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="5594" class="og nk iq mm b gy ow ox l oy oz">npm run build</span></pre><p id="2647" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>这将生成一个新的构建文件夹，其中包含您编译的代码。请记住，如果您使用这种方法，那么您必须将nginx服务器指向<code class="fe mj mk ml mm b">default.conf</code>文件配置中的构建文件夹，就像这样:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="6843" class="og nk iq mm b gy ow ox l oy oz">location / {<br/>        root   /home/ubuntu/{{appName}}/client/build;</span></pre><p id="ab34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您已在服务器上成功设置了项目代码。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="00f1" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">网络服务器(nginx)</h1><p id="6472" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">现在我们需要安装和配置nginx，设置一个基本的HTTP服务器，将它指向一个域，测试它是否工作，为SSL创建证书，最后设置HTTPS。我知道这有很多事情，但一旦完成，你的应用程序应该在你的HTTPS域上可见。</p><h2 id="a8bb" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated"><strong class="ak">第一步。</strong></h2><p id="138c" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">我们需要安装nginx web服务器:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="24ad" class="og nk iq mm b gy ow ox l oy oz">sudo apt install nginx</span></pre><p id="1c8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要启动Nginx服务器，请使用以下命令:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="816a" class="og nk iq mm b gy ow ox l oy oz">sudo service nginx start</span></pre><p id="088a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，如果您想检查Nginx服务器的状态，请使用以下命令:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="ecc7" class="og nk iq mm b gy ow ox l oy oz">sudo service nginx status</span></pre><p id="23bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果需要停止或重启nginx服务器，那么使用以下命令。(注意:现在没有必要这样做。)</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="204f" class="og nk iq mm b gy ow ox l oy oz">sudo service nginx stop<br/>sudo service nginx restart</span></pre><h2 id="3dfd" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">第二步。</h2><p id="85e2" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">我们必须为它设置nginx配置来运行我们的应用程序。</p><p id="30a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们将在这些位置制作或编辑两个nginx配置文件。</p><ul class=""><li id="1736" class="mv mw iq ky b kz la lc ld lf mx lj my ln mz lr pc nb nc nd bi translated"><code class="fe mj mk ml mm b">/etc/nginx/nginx.conf</code></li><li id="f35a" class="mv mw iq ky b kz ne lc nf lf ng lj nh ln ni lr pc nb nc nd bi translated"><code class="fe mj mk ml mm b">/etc/nginx/conf.d/default.conf</code></li></ul><p id="6a71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，导航到<code class="fe mj mk ml mm b">nginx</code>文件夹:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="8135" class="og nk iq mm b gy ow ox l oy oz">cd /etc/nginx</span></pre><p id="fb4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要编辑这些文件，我们需要root用户访问权限，因为这些是系统文件。</p><p id="21dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们将编辑<code class="fe mj mk ml mm b">nginx.conf</code> <em class="pd"> </em>文件。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="3108" class="og nk iq mm b gy ow ox l oy oz">sudo vi nginx.conf</span></pre><p id="18c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将在<a class="ae kv" href="https://www.vim.org/" rel="noopener ugc nofollow" target="_blank"> Vim </a>编辑器中打开文件。要开始编辑该文件，请按<strong class="ky ir"/>I "<strong class="ky ir"/>进入插入模式，然后删除其所有内容，并确保没有括号随机留在任何地方；否则nginx无法工作。然后将下面的代码片段粘贴到文件中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="be5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要退出插入模式，请按Escape键，要保存，请键入“:wq”在保存文件后应该会退出。这将为nginx服务器设置一些基本的设置。如果你想更详细地了解它们，那么你必须一条一条地用谷歌搜索——我不会解释它们，因为那样的话这将是一篇永无止境的文章。</p><p id="9e3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成后，导航到<code class="fe mj mk ml mm b">conf.d</code>文件夹:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="292c" class="og nk iq mm b gy ow ox l oy oz">cd /etc/nginx/conf.d/</span></pre><p id="6972" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在创建并编辑<code class="fe mj mk ml mm b">default.conf</code> <strong class="ky ir"> <em class="pd"> </em> </strong>文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="4393" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我分享这个片段是为了让nginx快速建立一个web服务器，并测试它是否工作。一旦我们有了一个运行在HTTP上的服务器，我们就可以进入为HTTPS协议设置SSL的细节了。</p><p id="faf6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的代码片段中有一些事情需要注意。</p><p id="d128" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，如果你有一个域名，请在这里编辑它:代替yourdomain.com，添加你自己的域名，像这样:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="452e" class="og nk iq mm b gy ow ox l oy oz">server_name  abc.com www.abc.com;</span></pre><p id="b01a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其次，这些行定义了nginx服务器在服务器上显示主索引文件的位置。因此，您需要将构建/编译的React应用程序放在部署文件夹中。(注意:默认情况下，这些文件夹不存在。您需要创建它们，要么通过终端，要么在连接后使用FTP，如本文结尾的附加内容部分所述。)</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="60a2" class="og nk iq mm b gy ow ox l oy oz">location / {<br/>        root   /home/ubuntu/{{appName}}/client/deployed;</span></pre><p id="3158" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以转到AWS管理面板，使用该实例的公共IP地址来查看该实例是否在HTTP中运行您部署的应用程序。</p><h2 id="4279" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">第三步。</h2><p id="a8b4" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">如果您尝试点击您在配置文件中设置的域名，您会发现它不会显示您部署的应用程序，这是理所当然的，因为您还没有将您的域指向您的实例的IP地址。以下是你如何在GoDaddy管理面板中做到这一点。</p><p id="a565" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.登录后，转到My Domains，选择您想要附加到EC2实例的域，然后单击这三个点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/e4f777e8861736e73389a5df98f2a463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xwr0vb82H9IIxHRFkAeaZg.png"/></div></div></figure><p id="34c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.在选项中选择管理DNS。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/112f0bae1c41d0babbfd34ffaab9de81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upxKKZJ9gdMUMPVF2pf-Lg.png"/></div></div></figure><p id="cc18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.现在转到“A”条目的铅笔图标，单击编辑它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pi"><img src="../Images/6721210034fc4daa94f1aabf33d5489d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wnTO8w9jTUs_90F3vr0ysg.png"/></div></div></figure><p id="c514" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.在“指向”字段中输入EC2实例的公共IP并保存。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pi"><img src="../Images/17456880cd65f4ace5ca4fca5058ad67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4iTxVOjBupaN2WzyD3k8Vw.png"/></div></div></figure><p id="22b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应该就是这样了。这将需要几分钟的时间，但现在当任何人在上述域中键入时，它将从输入的EC2实例的IP地址中提取您部署的服务器，并应该显示您部署的React应用程序。</p><p id="cda0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">(更新:步骤4已更改为步骤4a，因为certbot-auto软件包已于2020年12月弃用。如果您已经在实例上安装了它，那么步骤4a将起作用，否则请忽略它，并按照步骤4b获取LetsEncrypt许可证。之后请继续第五步</strong></p><h2 id="5ddb" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">步骤4a。</h2><p id="4f93" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">要为我们的服务器设置免费的SSL，我们首先需要使用<code class="fe mj mk ml mm b"><a class="ae kv" href="https://certbot.eff.org/docs/install.html?highlight=certbot%20auto#certbot-auto" rel="noopener ugc nofollow" target="_blank">certbot-auto</a></code>为我们的域生成SSL证书。为此，请使用以下命令:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="5759" class="og nk iq mm b gy ow ox l oy oz">cd /etc</span></pre><p id="0080" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，安装<code class="fe mj mk ml mm b">certbot-auto</code>并为其提供适当的权限。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="857b" class="og nk iq mm b gy ow ox l oy oz">sudo wget <a class="ae kv" href="https://dl.eff.org/certbot-auto" rel="noopener ugc nofollow" target="_blank">https://dl.eff.org/certbot-auto</a><br/>sudo chmod a+x certbot-auto</span></pre><p id="dbc6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，使用以下命令安装它</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="7ecc" class="og nk iq mm b gy ow ox l oy oz">sudo ./certbot-auto certonly</span></pre><p id="a687" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦您开始该过程，它将询问您有关安装后创建证书的问题。第一个大概是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/d8b9242c08884d0454776560be572b8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vGWTc6lYG22a2t-aesemKQ.png"/></div></div></figure><p id="1bf6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">键入“1”并回车使用nginx插件。</p><p id="a9f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二个大概是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/99e59a4d6a51588250e90825d87fb0b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yUnHWOpIra-_nc9M7iCrSg.png"/></div></div></figure><p id="60b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加您的域名，用空格隔开，就像这样:abc.com www.abc.com。如果将来要使用www进行重定向，请使用两个域名(一个带www，另一个不带www)。</p><p id="d373" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，它会询问您的电子邮件地址，以便在该证书即将到期时通知您。之后，还有两个是非问题，我可以找到截图。用“是”来接受这两者那么您应该已经创建了您的证书。它会显示它们在系统中的位置，就像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/b18fd464abb6691078e3e4da55fb190f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z7mHFuv8drm3SFrQnBCAHw.png"/></div></div></figure><p id="9b8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，上图中的红线将带有您的域名，例如，abc.com。</p><p id="8378" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜你！您已经成功地为您的域创建了有效期为三个月的SSL证书。现在你只需要把它们连接到服务器上。</p><h2 id="d00d" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">步骤4b。</h2><p id="aaf5" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated"><strong class="ky ir">(注:如果您能够遵循步骤4a并已获得证书。请忽略此步骤。)</strong></p><p id="4904" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要为我们的服务器设置免费的SSL，我们首先需要使用<code class="fe mj mk ml mm b"><a class="ae kv" href="https://certbot.eff.org/docs/install.html?highlight=certbot%20auto#certbot-auto" rel="noopener ugc nofollow" target="_blank">certbot</a></code>为我们的域生成SSL证书。以下说明也可在官方网站上获得。以下是链接。<br/><a class="ae kv" href="https://certbot.eff.org/lets-encrypt/ubuntubionic-nginx" rel="noopener ugc nofollow" target="_blank">https://certbot.eff.org/lets-encrypt/ubuntubionic-nginx</a></p><p id="d5a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，请使用以下命令来安装Snapd</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="0320" class="og nk iq mm b gy ow ox l oy oz">sudo apt install snapd</span></pre><p id="e42b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，确保您的Snapd是最新的</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="ee92" class="og nk iq mm b gy ow ox l oy oz">sudo snap install core; sudo snap refresh core</span></pre><p id="fc71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在使用Snapd安装Certbot</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="5df9" class="og nk iq mm b gy ow ox l oy oz">sudo snap install --classic certbot</span></pre><p id="c7d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">准备Certbot命令以便能够在机器上运行</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="45a5" class="og nk iq mm b gy ow ox l oy oz">sudo ln -s /snap/bin/certbot /usr/bin/certbot</span></pre><p id="e943" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我们正在自己修改nginx配置，所以我们将使用下面的命令来获取证书</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="89a6" class="og nk iq mm b gy ow ox l oy oz">sudo certbot certonly --nginx</span></pre><p id="754a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦开始这个过程，它将自动检测在nginx部分的default.conf文件中定义的服务器名称，并让您像这样选择它们:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pm"><img src="../Images/2c6bc75daaada520815d18ddd777ec1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Ugg1anpfxm7uCxK83f2qQ.png"/></div></div></figure><p id="cd20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，它会询问您的电子邮件地址，以便在该证书即将到期时通知您。之后，还有两个是非问题，我可以找到截图。用“是”来接受这两者那么您应该已经创建了您的证书。它会显示它们在系统中的位置，就像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/b18fd464abb6691078e3e4da55fb190f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z7mHFuv8drm3SFrQnBCAHw.png"/></div></div></figure><p id="e915" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，上图中的红线将带有您的域名，例如，abc.com。</p><p id="8ea4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜你！您已经成功地为您的域创建了有效期为三个月的SSL证书。现在你只需要把它们连接到服务器上。</p><h2 id="9ff7" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">第五步。</h2><p id="14f2" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">使用SSL证书连接到服务器分为两个部分。首先，您必须通过在<code class="fe mj mk ml mm b">/etc/nginx/conf.d</code>位置编辑<code class="fe mj mk ml mm b">default.conf</code>文件来为它创建一个nginx配置。使用下面的代码片段允许nginx访问SSL证书。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="bc43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您必须用Node创建一个HTTPS服务器，并允许它读取您创建的证书。检查下面的代码片段，并相应地调整您的<code class="fe mj mk ml mm b">server/index.js</code>文件。(注意:<strong class="ky ir"> </strong>这只有在您已经在服务器上设置了代码的情况下才有可能。)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pe pf l"/></div></figure><p id="8703" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可能需要更改对<code class="fe mj mk ml mm b">letsencrypt</code>的文件和文件夹的访问权限，以允许访问节点文件系统。查看最后的参考资料部分，了解如何做到这一点。</p><h2 id="bbe7" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">附加步骤</h2><p id="7ed2" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">这一步不是上述指南的一部分，但是它将帮助任何想在nginx中设置HTTP到HTTPS的重定向的人。</p><p id="0185" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要设置HTTPS重定向，请在<code class="fe mj mk ml mm b">default.conf</code>文件的顶部添加下面的代码片段。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="2b20" class="og nk iq mm b gy ow ox l oy oz">server {<br/>    listen 80;<br/>    listen [::]:80;<br/>    server_name <a class="ae kv" href="https://digikampus.com$request_uri" rel="noopener ugc nofollow" target="_blank">yourdomain</a>.com <a class="ae kv" href="http://www.digikampus.com" rel="noopener ugc nofollow" target="_blank">www.</a><a class="ae kv" href="https://digikampus.com$request_uri" rel="noopener ugc nofollow" target="_blank">yourdomain</a><a class="ae kv" href="http://www.digikampus.com" rel="noopener ugc nofollow" target="_blank">.com</a>; <br/>    return 301 <a class="ae kv" href="https://digikampus.com$request_uri" rel="noopener ugc nofollow" target="_blank">https://www.yourdomain.com$request_uri</a>;<br/>}</span></pre><p id="a35e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您也想将其重定向到www，请在HTTPS块的顶部添加以下内容:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="37ce" class="og nk iq mm b gy ow ox l oy oz">server {<br/>    server_name yourdomain.com; <br/>    return 301 <a class="ae kv" href="https://digikampus.com$request_uri" rel="noopener ugc nofollow" target="_blank">$scheme://www.yourdomain.com$request_uri</a>;<br/>}</span></pre></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="b681" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">Mongo数据库</h1><p id="529b" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">为您的MERN堆栈应用程序设置MongoDB有不同的方法。最简单的方法是在MongoDB亚多拉斯上托管一个集群，并将其连接到您的应用程序。这里，我们将在EC2实例上运行一个简单的MongoDB服务，并将其连接到我们的后端。为此，我们必须遵循几个步骤来成功设置MongoDB。</p><h2 id="d567" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">第一步。</h2><p id="29d3" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">使用以下命令在您的Ubuntu机器上添加官方MongoDB包存储库的GPG密钥:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="4ff5" class="og nk iq mm b gy ow ox l oy oz">wget -qO - https://www.mongodb.org/static/pgp/server-4.2.asc | sudo apt-key add -</span></pre><h2 id="9cd8" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">第二步。</h2><p id="fde9" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">使用以下命令在您的Ubuntu机器上添加官方的MongoDB包存储库:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="299f" class="og nk iq mm b gy ow ox l oy oz">echo "deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list</span></pre><h2 id="2b78" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">第三步。</h2><p id="b61a" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">使用以下命令更新APT包存储库缓存:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="5e57" class="og nk iq mm b gy ow ox l oy oz">sudo apt update</span></pre><h2 id="7fca" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">第四步。</h2><p id="d664" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">现在，您可以使用以下命令安装MongoDB的最新稳定版本(v4.2):</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="d8f6" class="og nk iq mm b gy ow ox l oy oz">sudo apt-get install mongodb-org</span></pre><h2 id="65c3" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">第五步。</h2><p id="b92e" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">安装后，使用以下命令检查MongoDB是否安装正确:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="f09d" class="og nk iq mm b gy ow ox l oy oz">mongod --version<br/>mongo --version</span></pre><h2 id="3254" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">第六步。</h2><p id="86a5" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">现在我们必须将MongoDB作为一个服务来启动，以便它能够在我们的实例上持续运行。为此，请使用以下命令:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="993d" class="og nk iq mm b gy ow ox l oy oz">sudo systemctl enable mongod.service<br/>sudo systemctl start mongod.service</span></pre><p id="ebb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要检查<code class="fe mj mk ml mm b">mongod</code>服务的状态，使用以下命令:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="48cb" class="og nk iq mm b gy ow ox l oy oz">sudo systemctl status mongod.service</span></pre><p id="2522" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您需要停止或重启<code class="fe mj mk ml mm b">mongod</code>服务，请使用以下命令。<em class="pd"> </em>(注意:现在没必要这么做。)</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="fba9" class="og nk iq mm b gy ow ox l oy oz">sudo systemctl stop mongod.service<br/>sudo systemctl restart mongod.service</span></pre><p id="d22e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦确认<code class="fe mj mk ml mm b">mongod</code>正在工作，在服务器中使用下面的代码连接到应用程序的本地实例。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="daf7" class="og nk iq mm b gy ow ox l oy oz"><strong class="mm ir">const</strong> DB = await mongoose.connect(‘mongodb://localhost:27017/databaseName’, {</span><span id="604b" class="og nk iq mm b gy pa ox l oy oz">useNewUrlParser: true,</span><span id="5ba7" class="og nk iq mm b gy pa ox l oy oz">useUnifiedTopology: true,</span><span id="8c72" class="og nk iq mm b gy pa ox l oy oz">});</span></pre><p id="6788" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这应该理想地将您的应用程序连接到实例的本地MongoDB。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="5e2a" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">PM2(流程经理)</h1><p id="e934" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">为了无限期地运行一个MERN应用程序，我们需要在我们的服务器上有一个进程管理器来正确地管理事情。为此，我们将使用PM2。使用以下命令安装它。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="ff5d" class="og nk iq mm b gy ow ox l oy oz">npm install pm2@latest -g</span></pre><p id="f4dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要使用PM2运行您的服务器，您首先需要导航到服务器文件夹。</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="b11d" class="og nk iq mm b gy ow ox l oy oz">cd /{{appName}}/server</span></pre><p id="6dcf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要使用PM2启动服务器，请键入:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="082f" class="og nk iq mm b gy ow ox l oy oz">pm2 start index.js --name="App Server"</span></pre><p id="ddcc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将使用您的<code class="fe mj mk ml mm b">index.js</code>启动一个进程，该进程的id应该为0。(注意:name标志是完全可选的，没有它该命令也能正常工作。它只是为您的流程提供一个可读的名称。)</p><p id="89cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要查看正在运行的进程列表，请使用以下命令:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="f96c" class="og nk iq mm b gy ow ox l oy oz">pm2 list</span></pre><p id="5388" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它将向您显示所有正在运行的进程的列表，以及它们各自的id和名称。如果您必须查看流程的日志，请键入:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="3733" class="og nk iq mm b gy ow ox l oy oz">pm2 logs 0</span></pre><p id="18bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它应该开始向您显示该过程的日志。</p><p id="86c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想查看流程的完整细节，请使用:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="4b18" class="og nk iq mm b gy ow ox l oy oz">pm2 show 0</span></pre><p id="8299" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要停止进程，请使用:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="1466" class="og nk iq mm b gy ow ox l oy oz">pm2 stop 0</span></pre><p id="7625" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有时，您必须删除不再需要的流程。为此，请使用以下内容:</p><pre class="kg kh ki kj gt os mm ot ou aw ov bi"><span id="d458" class="og nk iq mm b gy ow ox l oy oz">pm2 delete 0</span></pre><p id="0b7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜你！您已经使用SSL在AWS EC2实例上成功部署了MERN应用程序。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="af17" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">附加材料</h1><p id="24f2" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">我将在这里添加任何不属于服务器设置过程的内容，比如将实例连接到<a class="ae kv" href="https://filezilla-project.org/" rel="noopener ugc nofollow" target="_blank"> FileZilla </a> FTP。</p><h2 id="90eb" class="og nk iq bd nl oh oi dn np oj ok dp nt lf ol om nv lj on oo nx ln op oq nz or bi translated">连接文件Zilla</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pn"><img src="../Images/5a62414ecfab4165e229ed5233625454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TINWC_V6j_y8_hjujaPAhg.png"/></div></div></figure><p id="b440" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只需将主机设置为实例的公共DNS，将用户设置为Ubuntu，选择<code class="fe mj mk ml mm b">.pem</code>密钥文件即可轻松连接到实例并访问其文件系统。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="356c" class="nj nk iq bd nl nm nn no np nq nr ns nt jw nu jx nv jz nw ka nx kc ny kd nz oa bi translated">参考</h1><p id="0a22" class="pw-post-body-paragraph kw kx iq ky b kz ob jr lb lc oc ju le lf od lh li lj oe ll lm ln of lp lq lr ij bi translated">这里有一些有用的链接，让我想出了这个指南。</p><p id="7057" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.阅读以下内容，了解如何更改<code class="fe mj mk ml mm b">letsencrypt</code>的权限:</p><div class="po pp gp gr pq pr"><a href="https://stackoverflow.com/questions/48078083/lets-encrypt-ssl-couldnt-start-by-error-eacces-permission-denied-open-et" rel="noopener  ugc nofollow" target="_blank"><div class="ps ab fo"><div class="pt ab pu cl cj pv"><h2 class="bd ir gy z fp pw fr fs px fu fw ip bi translated">让我们加密SSL无法由“错误:EACCES:权限被拒绝，打开…</h2><div class="py l"><h3 class="bd b gy z fp pw fr fs px fu fw dk translated">当您使用sudo发布证书时，它们将归root所有。因为节点不是作为根运行的，并且…</h3></div><div class="pz l"><p class="bd b dl z fp pw fr fs px fu fw dk translated">stackoverflow.com</p></div></div><div class="qa l"><div class="qb l qc qd qe qa qf kp pr"/></div></div></a></div><p id="fa92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.如果你想看整个过程的视频指南，看看这个家伙。他有多个视频解释这个过程。</p><div class="po pp gp gr pq pr"><a href="https://www.youtube.com/channel/UCFyXA9x8lpL3EYWeYhj4C4Q/videos" rel="noopener  ugc nofollow" target="_blank"><div class="ps ab fo"><div class="pt ab pu cl cj pv"><h2 class="bd ir gy z fp pw fr fs px fu fw ip bi translated">约翰·安</h2><div class="py l"><h3 class="bd b gy z fp pw fr fs px fu fw dk translated">一起快乐编码😄</h3></div><div class="pz l"><p class="bd b dl z fp pw fr fs px fu fw dk translated">www.youtube.com</p></div></div><div class="qa l"><div class="qg l qc qd qe qa qf kp pr"/></div></div></a></div><p id="fc8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.让我们加密底部的快速访问官方链接。</p><div class="po pp gp gr pq pr"><a href="https://certbot.eff.org/instructions?ws=nginx&amp;os=ubuntu-18" rel="noopener  ugc nofollow" target="_blank"><div class="ps ab fo"><div class="pt ab pu cl cj pv"><h2 class="bd ir gy z fp pw fr fs px fu fw ip bi translated">证书机器人说明</h2><div class="py l"><h3 class="bd b gy z fp pw fr fs px fu fw dk translated">和一个带有开口...它托管在一个可选的上，如果您需要，可以通过通配符证书访问它…</h3></div><div class="pz l"><p class="bd b dl z fp pw fr fs px fu fw dk translated">certbot.eff.org</p></div></div><div class="qa l"><div class="qh l qc qd qe qa qf kp pr"/></div></div></a></div><p id="2c0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>