<html>
<head>
<title>A Code Reviewer’s Checklist for Android Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android项目的代码审查清单</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/code-review-on-android-projects-b7aae196cfda?source=collection_archive---------1-----------------------#2021-12-01">https://betterprogramming.pub/code-review-on-android-projects-b7aae196cfda?source=collection_archive---------1-----------------------#2021-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9f2e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">审查Android代码库时要记住的几点</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/864b17de3402d61424dd88ea6020a2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1g71C2_cuPoX3kn8"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@lazizli?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拉拉·阿兹利</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="4194" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码审查有时是一个乏味的过程，但是我相信我们需要在这上面花更多的时间。也许是你学习或者分享一些知识的机会。</p><p id="d2c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我列出了一些我认为在Android项目的代码审查过程中需要检查的要点。</p><h1 id="1445" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">内存泄漏</h1><p id="dff9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">想象一下下面这个案例:<em class="mp">一个漂亮的app但是同时又很慢，屏幕之间的导航一次比一次慢。</em></p><p id="417e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在代码评审过程中需要检查的几点:</p><ul class=""><li id="36e4" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">这一段新代码有保留吗？</li><li id="a3b6" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">有没有RxAndroid相关的代码？如果是，检查RxCalls是否在生命周期范围(ViewModel/Fragment/Activity)的末尾被处理。</li><li id="7abe" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">如果代码有协程，检查<code class="fe mz na nb nc b">Job</code>是否从<code class="fe mz na nb nc b">ViewModel</code> <em class="mp"> </em>作用域启动，以正确释放。</li><li id="59d0" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">代码是一种使用<code class="fe mz na nb nc b">CountDownTimer</code>、AsyncTask或任何视频/音频播放器的实现吗？如果是，代码应该释放与避免泄漏相关的内存资源。</li><li id="4a50" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">是一个新的片段<em class="mp"> </em>用<code class="fe mz na nb nc b">ViewBinding</code> <em class="mp"> </em>接近，代码应该在<code class="fe mz na nb nc b">onDestroyView</code>方法释放绑定<strong class="ky ir"> </strong>。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">参考:<a class="ae kv" href="https://developer.android.com/topic/libraries/view-binding" rel="noopener ugc nofollow" target="_blank">https://developer.android.com/topic/libraries/view-binding</a></p></figure><h1 id="a53e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">深度布局</h1><p id="6b2d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">有时候我们有一个<code class="fe mz na nb nc b">ViewGroup</code>小时候有另一个<code class="fe mz na nb nc b">ViewGroup</code>。</p><p id="1eea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个好的建议是总是使用as<code class="fe mz na nb nc b">ViewGroup</code><em class="mp">constraint layouts</em>来保持布局更加平坦<em class="mp">。它可以避免导致性能问题的透支。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="370a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Android文档中提到了一些<a class="ae kv" href="https://developer.android.com/topic/performance/rendering/overdraw" rel="noopener ugc nofollow" target="_blank">提示</a>来减少透支。</p><h1 id="c0ec" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">资源注释</h1><p id="a524" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Android世界中的每个资源都有一个标识符，它是一个整数类型。如何确保我们的整数值代表一个有效的资源id？注释在这方面对我们有帮助。</p><p id="612f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="5bd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的代码中，审查员可以建议:“你认为使用注释怎么样？大概是这样的:“<em class="mp"> </em>(举个例子):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="fc99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注释的其他例子:<a class="ae kv" href="https://developer.android.com/studio/write/annotations" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h1 id="619f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">相似组件</h1><p id="de16" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在代码评审期间投入时间是非常重要的。试着像作者一样思考，反映他的选择，提出问题来理解代码。</p><p id="391b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">新的代码要来了。<em class="mp">等等:</em>“这段代码做的和我们已经在这个组件中做的一样”。像这样的注释是必不可少的，因为重要的是重用我们代码库中已经存在的东西。当组件类似于以下内容时，请注意:</p><ul class=""><li id="c9c7" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">组件X将月亮颜色变为红色🔴；</li><li id="898d" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">组件Z将满月变为蓝色🔵；</li><li id="d214" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">组件A将月亮变成绿色🍏。</li></ul><p id="ac71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为什么没有一种成分可以改变任何月亮的颜色？它可以接收颜色作为参数。是不是工作量太大了？</p><h1 id="becf" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">危险代码区域</h1><p id="c444" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你有一个敏感代码——我喜欢这个表达<em class="mp">危险区</em>，它更好地描述了这种情况。危险代码是审核人看了之后给出类似于:<em class="mp">“这个代码没有任何意义”的反应的代码。</em></p><p id="f338" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，不要评价作者<strong class="ky ir">。与他们交谈，了解代码背后的原因。这次谈话可能是一个学习新东西的机会。</strong></p><h1 id="1082" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">架构违规📐</h1><p id="3997" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">软件架构是软件各部分之间定义的通信协议。</p><p id="24f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码审查是识别诸如架构违规等问题的非常有效的工具。在这种情况下，添加这样的注释很有用:</p><ul class=""><li id="d74a" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">"T10朋友，您的ViewModel正在访问存储库。我们在它们之间有一个用例。请看看MainViewModel文件，这是一个很好的例子。</li><li id="f428" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">"<em class="mp">为什么在ViewModel中使用适配器引用？适配器是一个RecyclerView组件。最好将它放在一个片段中，并使它远离我们的视图模型。</em></li></ul><h1 id="6c7f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">小细节决定大不同</h1><ul class=""><li id="d51a" class="mq mr iq ky b kz mk lc ml lf nk lj nl ln nm lr mv mw mx my bi translated">未使用的进口产品；</li><li id="7d14" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">未使用的资源，如抽屉、绳子、颜色…</li><li id="7cbd" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">注释代码；</li><li id="c798" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">未格式化的代码；</li><li id="c7c9" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">变量名，方法名，文件名，…</li><li id="2e6e" class="mq mr iq ky b kz nd lc ne lf nf lj ng ln nh lr mv mw mx my bi translated">代码没有遵循样式指南。例如，Kotlin定义了一个定义良好的<a class="ae kv" href="https://kotlinlang.org/docs/coding-conventions.html" rel="noopener ugc nofollow" target="_blank">样式指南</a>。对于任何开发人员来说，在现有代码库中快速找到任何软件组件都有很大帮助。</li></ul><h1 id="617b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="5239" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">静态分析工具在代码审查过程中是有帮助的，但是它们不是100%有效的。如果你的团队追求代码质量，一个关键的开发人员评审是必不可少的。</p></div></div>    
</body>
</html>