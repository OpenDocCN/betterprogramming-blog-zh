<html>
<head>
<title>iOS Region Monitoring With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI监控iOS区域</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ios-region-monitoring-with-swiftui-b1028fa8b95f?source=collection_archive---------4-----------------------#2021-11-17">https://betterprogramming.pub/ios-region-monitoring-with-swiftui-b1028fa8b95f?source=collection_archive---------4-----------------------#2021-11-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7c9c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">【Swift简化了地理围栏</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/087fe2e228518ad5d7a4ba5f9b9ad44b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xbIQ6b-z5NdqvX4A1xabCA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@williamtm" rel="noopener ugc nofollow" target="_blank">威廉·胡克</a>在<a class="ae kv" href="https://unsplash.com/photos/9e9PD9blAto" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="99c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好吧！让我们开始吧。我将在Xcode中创建一个带有SwiftUI界面的新Swift项目。我决定使用UIKit应用程序代理生命周期，因为在本教程中设置核心位置和通知代理会更容易。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/f9e1561949de18d8ec0b835fe1c3ce18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3Ll9qJOI0YuM7deKqCyyQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Xcode项目设置</p></figure><h1 id="be18" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">入门</strong></h1><p id="3907" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">核心位置框架的<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/cllocationmanager" rel="noopener ugc nofollow" target="_blank">CLLocationManager</a></code>使开发者能够监控用户的位置，并触发应用程序的位置相关事件。让我们看看如何使用它在用户进入/退出给定区域时向用户显示通知。</p><h1 id="c8c4" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">设置位置管理器</strong></h1><p id="3594" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我们将初始化我们的<strong class="ky ir"> </strong> <code class="fe mq mr ms mt b">SceneDelegate.swift</code>文件中的<code class="fe mq mr ms mt b">CLLocationManager</code>。当您注册一个地区并开始监控时，即使应用程序进入后台，iOS也会继续监控这些地区。如果应用程序没有运行，操作系统将唤醒或重新启动应用程序，并尝试交付事件。这使得<code class="fe mq mr ms mt b">SceneDelegate</code>成为处理它们的理想场所。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">位置管理器属性</p></figure><p id="6e72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了接收与区域监控相关的事件，我们需要向用户请求“始终打开权限”:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">请求“始终在位置”权限</p></figure><p id="e0fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注册<code class="fe mq mr ms mt b">SceneDelegate.swift</code> <strong class="ky ir"> </strong>来接收位置管理器事件。下面的委托方法<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423560-locationmanager" rel="noopener ugc nofollow" target="_blank">locationManager(_:didEnterRegion:)</a></code>和<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423630-locationmanager" rel="noopener ugc nofollow" target="_blank">locationManager(_:didExitRegion:)</a></code>将处理geofence的进入/退出事件。现在，您可以将方法保留为空。我们稍后将实现它们。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">位置经理代表</p></figure><p id="9f56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保在<code class="fe mq mr ms mt b">info.plist</code>文件中包含<code class="fe mq mr ms mt b">NSLocationAlwaysAndWhenInUseUsageDescription</code> <strong class="ky ir"> </strong>和<code class="fe mq mr ms mt b">NSLocationWhenInUseUsageDescription</code> <strong class="ky ir"> </strong>按键的描述。如果没有这些条目，您的应用程序将不会请求位置权限。</p><p id="0b20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您现在构建并运行您的应用程序，您应该会看到您的应用程序请求位置访问，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/4843dee6dd7f171b45b98f6727eced5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*WQaTkQmnABOsoiXrXeplqg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">请求位置访问</p></figure><h1 id="5ac1" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">创建区域</strong></h1><p id="582f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">现在我们的location manager设置已经完成，我们可以开始监控该地区了。我们可以使用<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/clcircularregion" rel="noopener ugc nofollow" target="_blank">CLCircularRegion</a></code>对象定义一个区域。区域基本上是以给定地理坐标为中心的圆形区域。我们可以通过提供纬度、经度和半径(以米为单位)来定义一个区域。半径将决定边界。</p><p id="1003" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于本教程的考虑，我们将在<code class="fe mq mr ms mt b">SceneDelegate</code>中注册该地区，这样我们可以在应用程序启动后立即开始监控该地区。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建区域对象</p></figure><h1 id="e8f3" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">注册区域</h1><p id="af25" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我要监控的位置是<code class="fe mq mr ms mt b">Times Square, New York</code>。你可以选择任何你喜欢的地方。</p><p id="3deb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了开始监控，我们需要将区域注册到我们的<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/cllocationmanager" rel="noopener ugc nofollow" target="_blank">CLLocationManager</a>.</code>中，我们通过调用<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423656-startmonitoring" rel="noopener ugc nofollow" target="_blank">startMonitoring(for:</a>)</code>方法来完成。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">注册CLCircularRegion</p></figure><h1 id="7c1a" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">监听事件</h1><p id="e920" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">为了监听地理围栏事件，我们将使用前面讨论过的<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423560-locationmanager" rel="noopener ugc nofollow" target="_blank">locationManager(_:didEnterRegion:)</a></code>和<code class="fe mq mr ms mt b"><a class="ae kv" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423630-locationmanager" rel="noopener ugc nofollow" target="_blank">locationManager(_:didExitRegion:)</a></code>委托方法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="6605" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，如果应用程序是活动的，我们只更新我们的<code class="fe mq mr ms mt b">ContentView</code> <em class="mx"> </em>上的简单文本视图。如果应用程序未激活，将向用户显示本地通知。您可以在此决定您希望如何使用您的应用程序:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">更新geofence事件的用户界面</p></figure><h1 id="9b6c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">测试您的应用</h1><p id="4793" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">测试应用程序实际上很容易。我们可以使用一个定制的<code class="fe mq mr ms mt b">.GPX</code>文件，模拟iOS模拟器的位置，或者你正在构建和运行你的应用的实际设备。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mu mv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">纽约时代广场的经度和纬度</p></figure><p id="c49b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只需用。gpx格式并添加上述内容。您可以将lat，long值更新为您喜欢的任何值。然后启动一个模拟器或者连接你的测试设备，构建并运行你的应用。</p><p id="a8a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行应用程序后，将其最小化，然后单击底部工具条上的模拟位置按钮。现在选择您的自定义位置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/96af675598c9b4000d0fce2c6f0ad950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AM_2rXYDw2_ywV2jjbJtWg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在Xcode上模拟位置</p></figure><p id="5dc6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">几秒钟后，您应该会收到通知。如果您需要测试退出事件，只需从列表中选择任何其他默认位置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/e2c49f86f25969ab84d9add878627deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*3xOzd0HK9pK1Vr7lyu74KA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">本地通知消息</p></figure><p id="2e57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样！您已成功将iOS上的地区监控与Swift集成。直到下次，保持安全！</p><h1 id="04f2" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">资源</strong></h1><p id="747e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">你可以从GitHub 下载<a class="ae kv" href="https://github.com/sachi911/region-monitoring-ios" rel="noopener ugc nofollow" target="_blank">示例项目。</a></p></div></div>    
</body>
</html>