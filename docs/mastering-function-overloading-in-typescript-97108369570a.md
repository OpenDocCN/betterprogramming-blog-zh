# 在 TypeScript 中掌握函数重载

> 原文：<https://betterprogramming.pub/mastering-function-overloading-in-typescript-97108369570a>

## 使用重载功能创建更全面、更易读的函数类型

![](img/2ba255bc18dbc10fdc45f8e19c2c5a33.png)

照片由[克里斯托弗·罗宾·艾宾浩斯](https://unsplash.com/@cebbbinghaus?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄。

如果你有任何类型语言的背景，你可能熟悉重载的概念。如果不是，让我们快速回顾一下它是什么:

> “在某些编程语言中，函数重载或方法重载是指用不同的实现创建多个同名函数的能力。对重载函数的调用将根据调用的上下文运行该函数的特定实现，允许一个函数调用根据上下文执行不同的任务。— [维基百科](https://en.wikipedia.org/wiki/Function_overloading)

这是一个有用的特性。假设 Javascript 不是类型化的，是否有可能在那里实现它？它的警告是什么？

Typescript 呢？它本身支持重载吗？它有什么缺陷吗？

在这篇文章中，我们将回答这些问题。一旦我们涵盖了所有的基础，我们将看到一些最佳实践。

# JavaScript 重载

JavaScript 中有可能使用重载吗？不是从严格的角度来说。我们可以设法实现类似重载的东西，但是这种方法有一些缺陷。让我们用一些例子来研究这些。

假设我们想要创建一个可以接受 1-3 个字符串参数的`concatString`函数。

看起来不错。但是如果我们像这样调用这个方法会发生什么呢？

```
concatString('one', true);
```

该方法不会崩溃，但会返回不正确的结果。这很容易解决。我们可以检查`typeof`参数，只接受字符串。

```
if(s2 && typeof s2 === 'string')
```

所以不同类型的问题就“解决了”如果我们用不同数量的参数调用这个方法呢？这是另一个快速解决方案。我们可以检查`arguments`的长度，如果超过了，就返回一个错误。在这种情况下，这将是三个。

只要看看这个例子，就很容易理解为什么 JavaScript 社区已经习惯于忽略重载。方法变得更大，更难阅读，更难维护。错误只在运行时被发现。

# 拯救打字稿

TypeScript 结束了动态编码的混乱。有了类型化的方法，你的函数暴露了什么，返回了什么就很清楚了。它本身支持重载吗？

是的，它是！然而，它将会以一种与我们习惯的稍微不同的方式。TypeScript 只能在编辑和构建时提供帮助。这是因为代码最终会被转换成 JavaScript。在运行时，我们将拥有与 JavaScript 相同的工具。虽然它并不完美，但整理我们的打字应该是相当不错的。

让我们重温一下前面的例子。然而，这个非常简单，我们不需要使用任何重载语法。我们只需将参数声明为可选的:

通过将修饰符与类型结合起来，我们能够表达大量的签名契约。

# 更复杂的情况

如果我们想做一些更具体的事情呢？假设我们想基于参数返回一个不同的类型。仅仅用上面提到的技术我们不可能做到这一点。

让我们看一个例子:

在上面的方法中，返回的类型将是`string | number`。Typescript 将推断可能的返回类型，并使用联合语法将它们连接起来。

通过查看该方法，我们可以看到，如果参数是一个`string`，它将返回一个`string`。否则，它将返回一个`number`。如果我们想用更具体的类型来表达呢？我们可以使用重载语法将参数的类型映射到返回类型。

让我们看看结果:

现在，当我们向函数传递一个`string`时，我们将得到一个`string`类型。当没有参数时，返回的类型将是`number`。

这种语法是如何工作的？

*   `function helloWorld(): number`:这是第一次过载。
*   这是我们第二次超载了。
*   这是我们的基本功能。它需要容纳前面声明的所有可能的重载。它需要符合上面声明的所有返回类型。在这种情况下，我们的返回类型是推断出来的，它是`string | number`。

如果我们使用不兼容的返回类型会发生什么？TypeScript 无法编译。它将显示一个错误。

了解声明重载的顺序很重要，这一点很重要。基函数必须是最后声明的函数。让我们检查一下 TypeScript 文档以了解更多信息:

> 为了让编译器选择正确的类型检查，它遵循与底层 JavaScript 类似的过程。它查看重载列表，并从第一个重载开始，尝试用提供的参数调用函数。如果找到匹配项，它会选择该重载作为正确的重载。因此，习惯上从最具体到最不具体对重载进行排序。— [打字稿文件](https://www.typescriptlang.org/docs/handbook/functions.html)

让我们通过颠倒工作示例中重载方法声明的顺序来证明这一点。这会给我们带来大量的错误。

从文档中可以看出，顺序应该是从限制性更强到限制性更弱。我们之前的基本方法`function helloWorld(s: string): string`，是限制性最小的。所以应该是最后一个。

# 组合多种参数类型

我们已经看到，我们可以根据实参参数改变返回类型。如前所述，我们唯一的限制是基函数必须符合所有的类型变量。

注意`arg1`和`arg2`必须是`string | number`类型，以符合前面重载中描述的可能类型。一旦你掌握了它，它就是直观的。

⚠️:有一个小警告要记住。TypeScript 将无法根据参数在函数体上推导类型。目前，基方法不知道它的重载声明。这意味着即使您在函数体中检查到`arg1`是一个字符串，Typescript 也不会推断出`arg2`也应该是一个字符串。

# 超载的注意事项

现在我们已经了解了 Typescript 重载，让我们看看最常见的注意事项:

## 1.避免编写仅尾部参数不同的几个重载

您可以看到两个接口是如何相等的，但是第一个接口比第二个接口更冗长。在这种情况下，最好使用可选参数。

## 2.避免编写只有一种参数类型不同的重载

像前面的例子一样，第一个接口变得非常冗长。最好使用联合。

作为一般的经验法则，尽量保持一切简单。只有当重载语法真正增加了你的契约的价值时，才使用它。

# 最后的想法

重载是 TypeScript 中一个重要而有用的特性。它不应该被滥用。正如我们已经看到的，有时仅仅使用`optional`修饰符就足够了。

TypeScript 函数重载将帮助您整理代码。如果使用得当，它会使你的代码更具可读性，更易于维护。它将使你的合同更加丰富和精确。

[![](img/98a7abfbf1b720aaad1fdcfc560741f9.png)](https://ko-fi.com/G2G46F6T3)

# 相关文章

[](/top-5-typescript-features-you-should-master-2358db9ab3d5) [## 您应该掌握的五大打字稿功能

### 使用这些必须知道的特性来提高您的打字稿知识

better 编程. pub](/top-5-typescript-features-you-should-master-2358db9ab3d5) [](/typescript-a-gentle-introduction-to-mapped-types-f65e45fa2598) [## TypeScript:映射类型的简明介绍

### 学习构建自己的一套 TypeScript 工具

better 编程. pub](/typescript-a-gentle-introduction-to-mapped-types-f65e45fa2598)