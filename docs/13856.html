<html>
<head>
<title>Setting Up iOS Framework for Unity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Unity设置iOS框架</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/setting-up-ios-framework-for-unity-9ef4e577db89?source=collection_archive---------7-----------------------#2022-10-04">https://betterprogramming.pub/setting-up-ios-framework-for-unity-9ef4e577db89?source=collection_archive---------7-----------------------#2022-10-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e431" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从Swift到C#</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/658718224d92f660afb436da375842ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8SrQztkXGb4PmszPFxHU3A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="47a8" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">第一部分。从Unity启动<code class="fe ln lo lp lq b">UIViewController</code></h1><p id="cd38" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">我不会浪费你的时间来长篇大论地介绍我将在这里描述的技术。你很可能已经是一名iOS工程师或游戏开发人员，这意味着你可能对本文的主题有一些疑问。那么，我们开始吧。</p><p id="f1a4" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">这篇文章分为两部分。在第一部分中，您将学习如何从Unity启动一个简单的<code class="fe ln lo lp lq b">UIViewController</code>。我们会强制C#理解Swift。在第二部分，我们将尝试扩展Swift在Unity中的使用，并探讨其局限性。</p><p id="83f6" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">好了，开始了。</p><h2 id="f22c" class="ms kw iq bd kx mt mu dn lb mv mw dp lf ma mx my lh me mz na lj mi nb nc ll nd bi translated">先决条件</h2><ul class=""><li id="e16a" class="ne nf iq lt b lu lv lx ly ma ng me nh mi ni mm nj nk nl nm bi translated">马科斯·蒙特雷</li><li id="cc41" class="ne nf iq lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">Xcode 13(或14)</li><li id="63cb" class="ne nf iq lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">团结LTS 2021.3</li><li id="920f" class="ne nf iq lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">iOS设备(至少具有iOS14或更高版本)</li></ul><h2 id="62a5" class="ms kw iq bd kx mt mu dn lb mv mw dp lf ma mx my lh me mz na lj mi nb nc ll nd bi translated">iOS框架</h2><p id="e34a" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">打开Xcode并创建一个新的Swift项目—框架。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/11f6bc0d983b921e84c2b17375890fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QI4bBrCqUvFX4CjVXqljhQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Swift项目—框架</p></figure><p id="7de1" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">这个项目的名字由你决定，我把它命名为<code class="fe ln lo lp lq b">SwiftCodeKit</code>。这将是一个带有一个视图控制器的简单框架。我们只需要三个文件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/17292b91698404def5ebc1cf0aa30444.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*ToYj1ML9HhHewa8shzYP5w.png"/></div></figure><p id="01dc" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">在<code class="fe ln lo lp lq b">SwiftCodeKitViewController</code>中，让我们创建一个简单的<code class="fe ln lo lp lq b">UIViewController</code>——在视图的中心有一个按钮。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><code class="fe ln lo lp lq b">SwiftCodeKitViewController.swift</code></p></figure><p id="6f47" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">在<code class="fe ln lo lp lq b">SwiftCodeKit.swift</code>中，我们将收集我们所有的公共方法。拥有这个公共类将允许你在iOS项目中测试你的框架。第一个会是<code class="fe ln lo lp lq b">start()</code>。这个方法呈现了我们的<code class="fe ln lo lp lq b">SwiftCodeKitViewController</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><code class="fe ln lo lp lq b">SwiftCodeKit.swift</code></p></figure><p id="3aab" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">第三个文件<code class="fe ln lo lp lq b">SwiftCodeKitBridging.swift</code>将包含一个带有C声明符号<code class="fe ln lo lp lq b">@_cdecl</code>的公开方法列表。这些方法应该只存储在非本地范围内。首先，我们创建一个方法:<code class="fe ln lo lp lq b">startSwiftCodeKitController()</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><code class="fe ln lo lp lq b">SwiftCodeKitBridging.swift</code></p></figure><p id="f2d4" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">属性<code class="fe ln lo lp lq b">@_cdecl</code>未被记录。现在，您只需要知道这个属性向c暴露了一个Swift函数，进一步地，我们将对这个属性做一些实验，并找出它的局限性。</p><h2 id="ee8c" class="ms kw iq bd kx mt mu dn lb mv mw dp lf ma mx my lh me mz na lj mi nb nc ll nd bi translated">建筑框架</h2><p id="b6f9" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">在你的Xcode项目状态工具栏中选择<code class="fe ln lo lp lq b">Any iOS Device (arm64)</code>目的地。是的，我们将只为iOS设备开发，不为模拟器开发。现在，你只需要点击<code class="fe ln lo lp lq b">Command + B</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/8f9b5f25ac066b640e7ee77f364641c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*OJbRYnk6XqGxolOtl4Zkdg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">任何iOS设备(arm64)目的地</p></figure><p id="6708" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">为了得到我们的框架，我们需要找到派生数据，并从那里得到它。您应该从Xcode打开“衍生数据”文件夹:前往Xcode偏好设置(<code class="fe ln lo lp lq b">cmd + ,</code>)，然后打开“位置”，并轻按衍生数据路径末端的箭头。</p><p id="8ffd" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">在“衍生数据”文件夹中，找到您的项目并使用以下路径:<br/> <code class="fe ln lo lp lq b">Build / Products / Debug-iphoneos / SwiftCodeKit.framework</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/9c340d2c1174ad40fa32bbb17b712a2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XMJyFb54p9IcW0WJuPZuzg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用SwiftCodeKit项目导出数据</p></figure><h2 id="b4f6" class="ms kw iq bd kx mt mu dn lb mv mw dp lf ma mx my lh me mz na lj mi nb nc ll nd bi translated">团结项目</h2><p id="849b" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">是时候建立我们的团结项目了。打开Unity，创建一个项目；我称之为<code class="fe ln lo lp lq b">UnityClientProject</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/16e689d3981937ac00844a1e9833e62c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*loQzjOXaEK4KS140cNR9WQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建Unity项目</p></figure><p id="cdb9" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">在Unity项目中，您会发现文件夹资源。拖动你的<code class="fe ln lo lp lq b">SwiftCodeKit.framework</code>放到<code class="fe ln lo lp lq b">Assets</code>文件夹中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/aa77df1468c1c14777fac2ac4289d0b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*ObbA-hi7Y4vCExsQt3mxEg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><code class="fe ln lo lp lq b">SwiftCodeKit.framework in Assets / iOS folder</code></p></figure><p id="5976" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">关于Unity中的UI，我们准备做一个简单的按钮。这个按钮将调用我们的SwiftCodeKit视图控制器。右键单击层次结构，选择UI，然后选择按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/676ae880d4dbbe3902bc2cde8fe79c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pVDgtJLgPKK0of8SGibCw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Unity项目中的按钮</p></figure><p id="4840" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">此外，在层次结构中，我们必须为按钮创建另一个对象。我叫它<code class="fe ln lo lp lq b">ButtonController</code>。在<code class="fe ln lo lp lq b">ButtonController</code>的检查器中，添加一个组件/新脚本，命名为<code class="fe ln lo lp lq b">ButtonControllerScript.cs</code>。打开这个文件。</p><p id="6aa4" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">其实我们只需要一个公共方法:<code class="fe ln lo lp lq b">OnPressButton()</code>。但在此之前，我们还得导入<code class="fe ln lo lp lq b">System.Runtime.InteropServices</code>。这将帮助我们从<code class="fe ln lo lp lq b">SwiftCodeKit.framework</code>中认识我们的方法。如果你还记得，我们只有一个公共函数:<code class="fe ln lo lp lq b">startSwiftCodeKitController()</code>，所以我们用<code class="fe ln lo lp lq b">DllImport</code>导入它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">cs使用运行时处理来自iOS的方法。InteropServices</p></figure><h2 id="9894" class="ms kw iq bd kx mt mu dn lb mv mw dp lf ma mx my lh me mz na lj mi nb nc ll nd bi translated">建设团结项目</h2><p id="8806" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">我们准备从Unity构建我们的iOS项目。打开文件/构建设置，将平台改为iOS。然后按构建。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/c0a2944ac4c4631eaf32e6679aee9077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*CFDFXUszy3HynzTqYtcgBA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Unity构建设置</p></figure><p id="0ba4" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">按下build后，它会自动运行一个Xcode项目。这个项目是由Unity生成的，在那里你只会看到一个叫做<code class="fe ln lo lp lq b">UnityFramework</code>的框架。</p><p id="cc7f" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">这时你可能会遇到几个问题:第一个问题——你必须签署这个项目，第二个问题是位代码错误——这只有在你使用Xcode 14时才会发生。没什么大不了的。让我们在这个项目中禁用bitcode，然后再次运行它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/cabd4e6fe7525147b873960673bbec19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLNfEcuTtdO4V7t18_xTMg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Xcode构建设置</p></figure><p id="86ba" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">在您的iPhone上，您将看到您的Unity应用程序。第一个带按钮的蓝色屏幕——这是Unity部分，橙色显示的屏幕是您的框架！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/d8b4dfea1c18dbbd67d1cae5b715a582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*RE3qaXVeyditIrOkUsOG_Q.gif"/></div></div></figure><h1 id="29a6" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">包扎</h1><p id="0395" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">让我们快速回顾一下我们所做的事情:</p><ol class=""><li id="15fb" class="ne nf iq lt b lu mn lx mo ma oe me of mi og mm oh nk nl nm bi translated">使用<code class="fe ln lo lp lq b">@_cdecl</code>属性为iOS和C#准备了一个带有公共方法的框架。</li><li id="7e23" class="ne nf iq lt b lu nn lx no ma np me nq mi nr mm oh nk nl nm bi translated">创建了一个简单的Unity项目，中心有一个按钮。</li><li id="99e1" class="ne nf iq lt b lu nn lx no ma np me nq mi nr mm oh nk nl nm bi translated">将我们的框架添加到Unity项目的资产中。</li><li id="8ef2" class="ne nf iq lt b lu nn lx no ma np me nq mi nr mm oh nk nl nm bi translated">用C#脚本准备了<code class="fe ln lo lp lq b">ButtonController</code>对象，我们用<code class="fe ln lo lp lq b">System.Runtime.InteropServices</code>导入了我们的方法</li><li id="8d38" class="ne nf iq lt b lu nn lx no ma np me nq mi nr mm oh nk nl nm bi translated">从Unity构建了一个iOS项目。</li></ol><p id="9f9c" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">如你所见，这些是基本步骤，给你一个机会去理解它是如何工作的。在第二部分(见下文),我们将努力使这个项目更接近实际应用。我们将对<code class="fe ln lo lp lq b">@_cdecl</code>属性进行实验，并探索其局限性。</p></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><h1 id="5acf" class="kv kw iq bd kx ky op la lb lc oq le lf jw or jx lh jz os ka lj kc ot kd ll lm bi translated">第二部分。在Unity中向C#公开Swift功能</h1><p id="cec2" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">本文分为两部分。在第二部分中，我们将通过<code class="fe ln lo lp lq b">@_cdecl</code>来了解Swift和C#互操作性的局限性。让我们开始吧。</p><p id="76e7" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">如果您阅读了本文的第一部分，您应该记得<code class="fe ln lo lp lq b">SwiftCodeKitBridging.swift</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="a5bc" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">在这个文件中，我们使用<code class="fe ln lo lp lq b">@_cdecl</code>属性存储了一个公开的公共方法列表。正如你所看到的，我们已经知道如何从C#中调用一些函数。但是很明显，它不是很有用，因为在真实的iOS应用程序中，我们使用带参数的函数，我们的函数返回一些值，此外，我们使用闭包、委托等等。如何向Unity项目公开这些代码？</p><p id="a9db" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">让我们继续今天要尝试的内容:</p><ul class=""><li id="9434" class="ne nf iq lt b lu mn lx mo ma oe me of mi og mm nj nk nl nm bi translated">带参数的函数</li><li id="4f15" class="ne nf iq lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">函数返回值</li><li id="ccfd" class="ne nf iq lt b lu nn lx no ma np me nq mi nr mm nj nk nl nm bi translated">带闭包的函数</li></ul><h2 id="49b2" class="ms kw iq bd kx mt mu dn lb mv mw dp lf ma mx my lh me mz na lj mi nb nc ll nd bi translated">iOS框架更新</h2><p id="571c" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">我准备了一个我们<code class="fe ln lo lp lq b">SwiftCodeKitViewController</code>的小更新。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="9a13" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">我又加了两个视图:<code class="fe ln lo lp lq b">UILabel</code>和<code class="fe ln lo lp lq b">UIStepper</code>。使用步进控制，我们可以增加和减少一个值，并将其设置为标签。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/3daeec74b3c347d1b071f4a61c98ee1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5JCI5QxABsJVJmGEqUDeuw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">SiwftCodeKit用户界面</p></figure><p id="bb08" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">用真实的UI做实验就够了。让我们来看看我们的公共课:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="9626" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">正如你所看到的，这个类是用我们将在C#中使用的方法扩展的。最有趣的部分是<code class="fe ln lo lp lq b">Delegates</code>——它们用闭包来表示。让我们将所有这些方法连接到我们的UI。在<code class="fe ln lo lp lq b">viewDidLoad</code>中，添加我们的第一个委托方法<code class="fe ln lo lp lq b">SwiftCodeKit.swiftCodeKitDidStart?()</code>。</p><p id="2afa" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">以下是可以在扩展中使用的其他方法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="8468" class="ms kw iq bd kx mt mu dn lb mv mw dp lf ma mx my lh me mz na lj mi nb nc ll nd bi translated">iOS框架桥接方法</h2><p id="0c86" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">我们所有的公共方法都应该从C#中识别出来。我建议一个一个地走过它们。</p><p id="85c9" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">下面是带参数的函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">带参数的函数</p></figure><p id="f353" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">函数返回值(<code class="fe ln lo lp lq b">Double</code>):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">函数以双精度形式返回值</p></figure><p id="6164" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">该函数返回一个字符串。这里你可以注意到一个不同之处。特别是对于这种数据，我们需要分配内存并将我们的字符串传递给<code class="fe ln lo lp lq b">strdup()</code>——这个方法将为<code class="fe ln lo lp lq b">UnsafePointer()</code>复制字符串。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">函数以字符串形式返回值</p></figure><p id="951c" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">好，现在<code class="fe ln lo lp lq b">Delegates</code>。如你所见，它们是带有转义闭包的函数。但是除了转义闭包之外，还有一些有趣的插件叫做<code class="fe ln lo lp lq b">@convention(c)</code></p><p id="9822" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">有一段来自<a class="ae ov" href="https://docs.swift.org" rel="noopener ugc nofollow" target="_blank">docs.swift.org</a>的简短描述:</p><blockquote class="ow ox oy"><p id="488b" class="lr ls oz lt b lu mn jr lw lx mo ju lz pa mp mc md pb mq mg mh pc mr mk ml mm ij bi translated">将此属性应用于函数的类型，以指示其调用约定。<code class="fe ln lo lp lq b"><em class="iq">c</em></code>参数表示一个C函数引用。函数值不携带上下文，使用C调用约定。</p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">代表</p></figure><p id="3afd" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">好了，让我们构建我们更新的框架，获得这个构建，并把它放到Unity项目资产文件夹中(参见第1部分如何做)。</p><h2 id="0fd0" class="ms kw iq bd kx mt mu dn lb mv mw dp lf ma mx my lh me mz na lj mi nb nc ll nd bi translated">Unity ButtonControllerScript <code class="fe ln lo lp lq b">update</code></h2><p id="d7b5" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">我们的C#脚本文件目前只有一个导入的函数:<code class="fe ln lo lp lq b">startSwiftCodeKitController</code>，所以是时候添加其余的函数了。我们将采用与Swift方法相同的方式:</p><p id="a2db" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">下面是带参数的函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><code class="fe ln lo lp lq b">ButtonCotrollerScript.cs</code>中带参数的函数</p></figure><p id="269b" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">该函数返回值，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">函数在<code class="fe ln lo lp lq b">ButtonCotrollerScript.cs</code>中返回值</p></figure><p id="6934" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">使用<code class="fe ln lo lp lq b">AOT</code>和<code class="fe ln lo lp lq b">Delegates</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ButtonControllerScript.cs中的委托</p></figure><p id="0a1f" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">我们要做的最后一件事是更新<code class="fe ln lo lp lq b">OnPressButton()</code>方法，其中我们使用Swift框架中的所有方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ButtonControllerScript.cs中的OnPressButton()更新</p></figure><p id="bb47" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">我们直接从Unity配置了我们的iOS控制器，并使用了我们的三个代理。现在，是时候构建我们的项目了。如果你正确地跟随了我，并且你的所有方法都被Unity识别，你的结果将会如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/cba4c1105fd1cd846b36224975360c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UFic8NZzSNY_ygXWKKSB-Q.gif"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Unity iOS项目从Unity启动</p></figure><p id="3095" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">Xcode的控制台应该会显示如下内容:</p><pre class="kg kh ki kj gt pd lq pe pf aw pg bi"><span id="dde1" class="ms kw iq lq b gy ph pi l pj pk">SwiftCodeKit did start<br/>SwiftCodeKit get value: 10<br/>SwiftCodeKit get version: Swift Code Kit 0.0.1<br/>SwiftCodeKit value did change. Value: 11<br/>SwiftCodeKit value did change. Value: 12<br/>SwiftCodeKit value did change. Value: 13<br/>SwiftCodeKit did finish</span></pre><h1 id="4164" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">包扎</h1><p id="320c" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">每次我完成一项任务时，我总是问同一个问题:我怎样才能做得更好？我认为这项任务可以不断改进。我不是Unity方面的专家(如果你有更好的了解，请评论)，但我知道我们甚至可以用我们所有的函数构建DLL库，并最终将这个构建直接导入到脚本中。</p><p id="a655" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">另外，作为一个使用<code class="fe ln lo lp lq b">UnsafePointer</code>的iOS开发者，要记住这个内存应该被释放。</p><p id="508e" class="pw-post-body-paragraph lr ls iq lt b lu mn jr lw lx mo ju lz ma mp mc md me mq mg mh mi mr mk ml mm ij bi translated">感谢阅读。</p><h1 id="3f8a" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">源代码</h1><div class="pl pm gp gr pn po"><a href="https://github.com/maxkalik/swift-in-unity" rel="noopener  ugc nofollow" target="_blank"><div class="pp ab fo"><div class="pq ab pr cl cj ps"><h2 class="bd ir gy z fp pt fr fs pu fu fw ip bi translated">GitHub — maxkalik/swift-in-unity:用于unity的iOS框架</h2><div class="pv l"><p class="bd b dl z fp pt fr fs pu fu fw dk translated">github.com</p></div></div><div class="pw l"><div class="px l py pz qa pw qb kp po"/></div></div></a></div></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt pd lq pe pf aw pg bi"><span id="d79f" class="ms kw iq lq b gy ph pi l pj pk"><strong class="lq ir">Want to Connect?</strong></span><span id="6a49" class="ms kw iq lq b gy qc pi l pj pk">Don't hesitate to follow me on <a class="ae ov" href="https://twitter.com/maxkalik" rel="noopener ugc nofollow" target="_blank">Twitter</a>.</span><span id="8db6" class="ms kw iq lq b gy qc pi l pj pk">I appreciate any suggestions or comments regarding my research and articles.</span></pre></div></div>    
</body>
</html>