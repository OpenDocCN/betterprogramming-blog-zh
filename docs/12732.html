<html>
<head>
<title>Speed Up Your Data Collection Efforts With Multithreading in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python中的多线程加速数据收集工作</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/speed-up-your-data-collection-efforts-with-multithreading-in-python-61f3b3cc06df?source=collection_archive---------9-----------------------#2022-06-27">https://betterprogramming.pub/speed-up-your-data-collection-efforts-with-multithreading-in-python-61f3b3cc06df?source=collection_archive---------9-----------------------#2022-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7f7e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据检索不一定是一个人的工作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b3c3c6247b0fb39fad54d0c962133c07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VEVVelfTvMmKtrsb"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@randyfath?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">兰迪·法特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="799c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多项目需要某种形式的数据收集，这需要从数据库和网站等外部来源获取信息。</p><p id="cdad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，随着数据检索任务数量的增加，数据收集过程会变得冗长而耗时。</p><p id="a1ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，用户在执行数据拉取时，可以通过合并多线程来节省长时间的运行。</p><p id="0544" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们强调多线程的好处，并讨论如何将它集成到程序中，以加快Python中的数据收集操作。</p><h1 id="4fd4" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">为什么是多线程？</h1><p id="3f20" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">多线程使用户能够通过同时运行进程的不同部分(称为线程)来更快地执行操作。</p><p id="29b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑下面的函数，它需要大约五秒钟来运行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/aaccd619de5dbaa2f8ad9ed2409f771a.png" data-original-src="https://miro.medium.com/v2/resize:fit:324/format:webp/1*CI2d8JvqvEDp39oJW5BTbw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="f9ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果函数需要五秒钟来执行，那么运行三次需要多长时间？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/f58575b26ceffa701aa5312800bf47be.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*g9CH64lhdlIHcuN-DlHGOg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="b3c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是显而易见的。整个操作总共需要大约15秒钟。</p><p id="2245" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，当有大量任务时，这种安排的效率低得令人难以忍受。如果函数需要迭代成百上千次，这种方法会有多麻烦？</p><p id="c4a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，如果感兴趣的任务彼此独立，用户可以通过利用多线程来减少完成操作所需的时间，多线程将任务分布在多个线程中。</p><h1 id="a67e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Python中的多线程</h1><p id="43ef" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">Python允许用户将多线程与提供了<code class="fe mw mx my mz b">ThreadPoolExecutor</code>类的<code class="fe mw mx my mz b">concurrent.futures</code>包结合在一起。</p><p id="cc27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个类最强大的特性之一是<code class="fe mw mx my mz b">map</code>方法，它很像内置的map方法，用给定的参数集合映射感兴趣的函数。</p><p id="ce02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用这个类通过多线程并发执行任务来加速前面的操作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/dc4eddd0374e33e0cc4d7c73dd7b8244.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*j2ClWzFqyVKhDnmTyR6DBg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="1794" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mw mx my mz b">ThreadPoolExecutor</code>不是一次执行一个任务，而是在同一时间内执行多个任务，从而大大减少了运行时间。</p><h1 id="1cac" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用于数据收集的多线程</h1><p id="f42f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">多线程适用于I/O绑定的任务，这些任务需要花费大量时间与某种形式的外部系统(如数据库或web服务器)进行交互。由于数据收集过程通常需要从外部源接收数据，因此使用多线程来改进此类过程是切实可行的。</p><p id="f2f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多线程通常用于执行操作，如从网站上删除数据、读取文件或使用效率更高的API进行调用。</p><p id="728f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">举个简单的例子，假设我们希望使用<a class="ae ky" href="https://github.com/Hipo/university-domains-list/" rel="noopener ugc nofollow" target="_blank">大学域名和名称API </a>收集数据，它提供给定国家的大学信息。</p><p id="a90b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用下面的函数，可以获得任何给定国家的大学名称的数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="b425" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目标是获得248个不同国家的大学信息。如果没有多线程，这个函数可以通过一个简单的循环一次收集一个国家的大学数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/d4c7cb2a181d96684ae99b192a3336fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/format:webp/1*f0XpZhZyrPzk1krjrboGEg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="d72c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以这种方式收集所有国家的数据大约需要14秒钟。虽然这种方法可以完成工作，但效率非常低。</p><p id="73b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看通过使用<code class="fe mw mx my mz b">ThreadPoolExecutor</code>类在十个线程中执行该函数来获得相同的数据需要多少时间。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/4d2538a7a0492dcd164ee070f2ade003.png" data-original-src="https://miro.medium.com/v2/resize:fit:350/format:webp/1*Bboos9qmBVaQeISImz-NDg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">代码输出(由作者创建)</p></figure><p id="8a0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用多线程并发地用API执行数据检索节省了大量时间。</p><h1 id="7f60" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">限制</h1><p id="4031" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">虽然您可能正在评估多线程减少数据收集过程运行时间的能力，但是您可能会想:为什么不仅仅使用它来收集数据呢？我们为什么不用多线程来加速每一个感兴趣的操作呢？</p><p id="2fc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单来说，这种技术有其自身的局限性。</p><p id="6c9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然多线程适用于I/O相关的任务，但在处理CPU相关的任务时，它就不够用了。CPU相关的任务主要依赖于CPU的处理能力。</p><p id="e873" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这样的操作中加入多线程可能是无效的，甚至会产生更长的运行时间。</p><p id="6e2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果您正在处理计算密集型过程，如训练机器学习模型或处理图像，多线程不是一个合适的解决方案。对于这种情况，考虑探索更可行的替代方案，如多处理。</p><h1 id="79cd" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/e9747339fa441ff6a87861f2a29d42fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zjpvdGvv3pYMjtzS"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@prateekkatyal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">普拉蒂克·卡蒂亚尔</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="6534" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">多线程是数据收集工作的宝贵资产。</p><p id="b6f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，本文主要是提倡使用这种技术，并没有过多地探究实现多线程的最佳Python模块。</p><p id="5192" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我个人更喜欢使用<code class="fe mw mx my mz b">concurrent.futures</code>包中的<code class="fe mw mx my mz b">ThreadPoolExecutor</code>类，因为它的接口简单。然而，还有其他选项可以用来执行多线程(例如，<code class="fe mw mx my mz b">threading</code>模块)。</p><p id="2f98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请随意探索在Python中结合多线程的各种方法，并尝试一下，看看哪种方法最适合您。</p><p id="f0e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div></div>    
</body>
</html>