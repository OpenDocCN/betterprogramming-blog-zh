<html>
<head>
<title>3 Ways to Execute Commands in a Docker Container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Docker容器中执行命令的3种方式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/3-ways-to-execute-commands-in-a-docker-container-8a7feeeeaba2?source=collection_archive---------9-----------------------#2020-04-06">https://betterprogramming.pub/3-ways-to-execute-commands-in-a-docker-container-8a7feeeeaba2?source=collection_archive---------9-----------------------#2020-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a6d9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">提高你的码头游戏</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/921b5cd8ea69721505a0ff6243d6374d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z33JChPNoQWHBgd2QAVeDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://www.wallpaperflare.com/man-shooting-on-basketball-hoop-outdoor-ballin-swish-outdoor-court-wallpaper-zueky" rel="noopener ugc nofollow" target="_blank">壁纸耀斑</a></p></figure><p id="ba34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Docker容器是一个轻量级的可执行程序，它包含了从运行时到系统工具和库的所有东西来运行应用程序。当容器化一个应用程序时，我们可能经常需要在容器内执行不同的命令——例如，为了调试目的或者为了手动运行应用程序。</p><p id="6f7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Docker容器中有三种执行不同命令的方法，我将在本文中讨论每种方法。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9054" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">在DockerFile文件中使用“CMD”</h1><p id="28bc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在为应用程序构建映像时，我们需要指定一个docker文件，其中包含如何创建该映像以及它将执行什么应用程序的指令。</p><p id="2674" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码是一个DockerFile代码，用于封装我创建的一个简单的Java应用程序。出于演示目的，该应用程序向标准输出输出一行代码。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b5e6" class="ne md it na b gy nf ng l nh ni"><strong class="na iu">FROM </strong>frolvlad<strong class="na iu">/</strong>alpine-oraclejre8<br/><strong class="na iu">ARG <em class="nj">JAR_FILE_NAME<br/></em>ADD </strong>target<strong class="na iu">/</strong>${<strong class="na iu"><em class="nj">JAR_FILE_NAME</em></strong>} app.jar<br/> <br/><strong class="na iu">CMD </strong>java <strong class="na iu">-</strong>jar <strong class="na iu">/</strong>app.jar</span></pre><p id="0559" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一条指令是我们感兴趣的。它表示当运行该图像中的容器时，将执行<code class="fe nk nl nm na b">java -jar /app.jar</code>命令。这个命令将运行Java应用程序，打印在<code class="fe nk nl nm na b">Main</code>类中指定的输出，然后结束。</p><p id="4545" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码片段展示了构建映像、从该映像运行容器以及从Java应用程序获得输出的过程。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5bca" class="ne md it na b gy nf ng l nh ni">docker image build -t docker-demo . --build-arg JAR_FILE_NAME=demo.jar</span><span id="0de2" class="ne md it na b gy nn ng l nh ni">docker container run docker-demo:latest</span><span id="2852" class="ne md it na b gy nn ng l nh ni"><strong class="na iu">Output:</strong></span><span id="4770" class="ne md it na b gy nn ng l nh ni"><em class="nj">Java app is running inside a container</em></span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="62f8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">启动容器时运行命令</h1><p id="d09b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">执行Java <code class="fe nk nl nm na b">run</code>命令的另一种方式是在启动容器时指定该命令。我们需要首先从docker文件中删除<code class="fe nk nl nm na b">CMD</code>行，然后重新构建图像，这样这个方法才能工作。</p><p id="9876" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在容器启动时启动Java应用程序，我们将在<code class="fe nk nl nm na b">docker container run</code>命令后指定Java <code class="fe nk nl nm na b">run</code>命令，如下所示。注意，下面的容器不是在分离模式下运行的，所以Java应用程序输出将在标准输出中打印。然后应用程序将退出。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="4541" class="ne md it na b gy nf ng l nh ni">docker container run docker-demo:latest<strong class="na iu"> java -jar /app.jar</strong></span></pre><p id="8fa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们也可以运行其他命令，而不仅仅是应用程序启动命令。例如，我们可以使用<code class="fe nk nl nm na b">ls</code>命令列出容器中的所有文件。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1d41" class="ne md it na b gy nf ng l nh ni">docker container run docker-demo:latest<strong class="na iu"> ls -l</strong></span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a99d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">直接从容器外壳运行命令</h1><p id="31eb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以启动一个容器，直接访问它的交互式外壳来执行命令，就像在Linux终端中一样。我们可以使用以下命令在交互模式下启动容器:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c2cb" class="ne md it na b gy nf ng l nh ni">docker container run <strong class="na iu">-it</strong> docker-demo:latest <strong class="na iu">/bin/bash</strong></span></pre><p id="ab14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参数<code class="fe nk nl nm na b">-it</code>指定交互模式和伪<code class="fe nk nl nm na b">tty</code>的分配，而<code class="fe nk nl nm na b">/bin/bash</code>指定允许我们在容器上执行命令的外壳。</p><p id="fc9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行该命令后，我们可以访问容器的外壳，并从那里启动Java应用程序:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d05a" class="ne md it na b gy nf ng l nh ni"><strong class="na iu">bash-4.4#</strong> java -jar /app.jar<br/>Java app is running inside a container</span></pre><p id="1158" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得注意的是，您创建的映像可能没有安装shell——就像我的例子一样——当使用上面的命令运行容器时，您会得到下面的错误消息。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b28b" class="ne md it na b gy nf ng l nh ni">starting container process caused <strong class="na iu">"exec: \"/bin/bash\"</strong>: stat <strong class="na iu">/bin/bash</strong>: no such file or directory</span></pre><p id="1572" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，如果我们想从容器中运行命令，我们必须在构建映像时指定shell安装。应该将以下几行添加到docker文件中，以使shell可用。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f4b7" class="ne md it na b gy nf ng l nh ni"><strong class="na iu">RUN </strong>apk update<br/><strong class="na iu">RUN </strong>apk upgrade<br/><strong class="na iu">RUN </strong>apk add bash</span></pre><p id="8486" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您阅读本文，希望您觉得有用。</p><p id="4497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保重！</p></div></div>    
</body>
</html>