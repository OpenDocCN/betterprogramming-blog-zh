<html>
<head>
<title>Production-Ready React With Docker and Travis CI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Docker和Travis CI进行生产就绪型互动</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/production-ready-react-with-docker-and-travis-ci-8e2ae559f26c?source=collection_archive---------4-----------------------#2020-07-24">https://betterprogramming.pub/production-ready-react-with-docker-and-travis-ci-8e2ae559f26c?source=collection_archive---------4-----------------------#2020-07-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="df37" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">与React、Docker和Travis CI一起从零到生产英雄</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/706751c179fc8ddfd0b692875037e6a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ovRuAuqPf4r2xpiWh71rUg.png"/></div></div></figure><p id="5dcf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以前，我们在开发阶段通过设置React与Docker一起工作。但是，当我们已经完成了我们的整洁的应用程序，并希望与世界分享它呢？这篇文章将解释如何做到这一点。</p><p id="a170" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:我强烈建议你在阅读本文之前先看看第一部分。前一章解释了许多概念以及Docker是如何工作的:“<a class="ae lq" href="https://medium.com/better-programming/heres-how-you-can-use-docker-with-create-react-app-3ee3a972b04e" rel="noopener">这里是你如何使用Docker和React”</a></p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="2bc5" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">为生产设置Docker</h1><p id="7754" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">截至目前，我们有一个<code class="fe mv mw mx my b">Dockerfile</code>用于开发，但生产呢？要解决这个问题，我们需要的是另一个Docker文件，一个针对生产版本的文件。</p><h2 id="ceac" class="mz lz it bd ma na nb dn me nc nd dp mi ld ne nf mk lh ng nh mm ll ni nj mo nk bi translated">创建生产文档文件</h2><p id="0edc" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">继续创建一个名为<code class="fe mv mw mx my b">Dockerfile</code>的文件，其内容如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="78e8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Docker文件与开发文件非常相似，不是吗？生产和开发的主要区别是最后一个命令，我们指定运行<code class="fe mv mw mx my b">build</code>脚本。</p><p id="5d10" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:如果<code class="fe mv mw mx my b">Dockerfile</code>看起来让你感到困惑，<a class="ae lq" href="https://medium.com/better-programming/heres-how-you-can-use-docker-with-create-react-app-3ee3a972b04e" rel="noopener">看看第一章</a>，在那里我们一步一步地检查一个类似的文件。</p><p id="abe3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mv mw mx my b">build</code>脚本将生产应用程序构建到<code class="fe mv mw mx my b">build</code>文件夹中。它正确地捆绑了生产模式中的React，并优化了构建以获得最佳性能。</p><p id="4f2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">构建被缩小，并且文件名包括散列。如果需要，可以启用类名和函数名来进行分析。更多信息参见<a class="ae lq" href="https://create-react-app.dev/docs/production-build" rel="noopener ugc nofollow" target="_blank">生产制造</a>部分。</p><h2 id="c512" class="mz lz it bd ma na nb dn me nc nd dp mi ld ne nf mk lh ng nh mm ll ni nj mo nk bi translated">测试生产文档文件</h2><p id="eed5" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在我们将Docker映像部署到Travis CI之前，让我们确保Docker成功构建了生产映像。像这样构建生产Docker映像:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/f968212e735a78a3653b70d645be4bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDaS4VCaYrnFDFcJV9Heqg.png"/></div></div><p class="no np gj gh gi nq nr bd b be z dk translated">建立生产码头形象</p></figure><p id="9c85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果一切按预期进行，您应该会看到以下消息:</p><pre class="kj kk kl km gt ns my nt nu aw nv bi"><span id="c1d8" class="mz lz it my b gy nw nx l ny nz">Successfully tagged indreklasn/my-react-docker-app:latest</span></pre><p id="6e26" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不要忘记用你自己的名字替换docker图像标签。例如，代替<code class="fe mv mw mx my b">indreklasn/my-react-docker-app</code>，你可以做<code class="fe mv mw mx my b">yourname/my-react-docker-app</code>或者类似的事情。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="71d4" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">设置Travis CI(持续集成)</h1><p id="6067" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在我们开始之前，让我们探索一下为什么持续集成是一个好主意。</p><h2 id="61c5" class="mz lz it bd ma na nb dn me nc nd dp mi ld ne nf mk lh ng nh mm ll ni nj mo nk bi translated">什么是持续集成(CI)？</h2><p id="d42a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">持续集成是经常合并小的代码变更的实践——而不是在开发周期结束时合并大的变更。目标是通过以较小的增量开发和测试来构建更健康的软件。这就是Travis CI 的用武之地。</p><h2 id="a7d9" class="mz lz it bd ma na nb dn me nc nd dp mi ld ne nf mk lh ng nh mm ll ni nj mo nk bi translated">CI构建和自动化:构建、测试、部署</h2><p id="78f3" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">当您运行构建时，Travis CI将您的GitHub存储库克隆到一个全新的虚拟环境中，并执行一系列任务来构建和测试您的代码。如果这些任务中的一个或多个失败，那么构建就被认为是<a class="ae lq" href="https://docs.travis-ci.com/user/for-beginners/#breaking-the-build" rel="noopener ugc nofollow" target="_blank"> <em class="oa">中断</em> </a>。如果没有一个任务失败，构建就被认为通过了<a class="ae lq" href="https://docs.travis-ci.com/user/for-beginners/#breaking-the-build" rel="noopener ugc nofollow" target="_blank"><em class="oa"/></a>，Travis CI可以将您的代码部署到web服务器或应用程序主机上。</p><p id="3327" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">CI构建还可以自动化交付工作流的其他部分。这意味着您可以让作业与<a class="ae lq" href="https://docs.travis-ci.com/user/build-stages/" rel="noopener ugc nofollow" target="_blank">构建阶段</a>相互依赖，设置<a class="ae lq" href="https://docs.travis-ci.com/user/notifications/" rel="noopener ugc nofollow" target="_blank">通知</a>，在构建之后准备<a class="ae lq" href="https://docs.travis-ci.com/user/deployment/" rel="noopener ugc nofollow" target="_blank">部署</a>以及许多其他任务。</p><p id="60ff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我选择Travis CI的原因如下:</p><ul class=""><li id="5897" class="ob oc it kw b kx ky la lb ld od lh oe ll of lp og oh oi oj bi translated">它与Github配合得很好。</li><li id="5a25" class="ob oc it kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">使用简单，个人免费。</li></ul><p id="feb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">前往Travis CI官方网站注册。</p><div class="kj kk kl km gt ab cb"><figure class="op kn oq or os ot ou paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/90eb00dba66b459b4e60804c4649a935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*LhJUG5sp51lUIHlfd4zb5Q.png"/></div></figure><figure class="op kn ov or os ot ou paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/8919773a102a014af81537e2accedfc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*59WJFYJzgaLlO_WSBYZO0g.png"/></div><p class="no np gj gh gi nq nr bd b be z dk ow di ox oy translated">https://travis-ci.org/getting_started崔维斯·CI入门</p></figure></div><p id="5305" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦你点击“使用Github应用程序激活所有库”按钮，你应该会看到一个Github库列表出现。</p><h2 id="e618" class="mz lz it bd ma na nb dn me nc nd dp mi ld ne nf mk lh ng nh mm ll ni nj mo nk bi translated">正在创建. travis.yml</h2><p id="6d45" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">Travis CI上的构建主要是通过存储在存储库中的文件<code class="fe mv mw mx my b">.travis.yml</code>中的构建配置来配置的。这允许您的配置受版本控制且灵活。继续在项目的根目录下创建一个名为<code class="fe mv mw mx my b">.travis.yml</code>的文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="f931" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在您继续之前，您将需要一个Dockerhub帐户！请在继续之前在此处创建一个:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/273fab6f5684be14df8f808b9e8d9566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*vrDLGEw6SySt4X7tZZtIlQ.png"/></div><p class="no np gj gh gi nq nr bd b be z dk translated">注册Dockerhub账户—【https://hub.docker.com/signup T21】</p></figure><p id="f748" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mv mw mx my b">.travis.yml</code>文件里面发生的事情:</p><ul class=""><li id="3e87" class="ob oc it kw b kx ky la lb ld od lh oe ll of lp og oh oi oj bi translated">特拉维斯使用Docker作为我们的环境。</li><li id="3365" class="ob oc it kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">它构建了开发Docker映像。</li><li id="0cd0" class="ob oc it kw b kx ok la ol ld om lh on ll oo lp og oh oi oj bi translated">接下来，我们运行开发映像中的所有测试。这与在我们的项目中运行<code class="fe mv mw mx my b">npm run test</code>是一样的。在我们继续之前，我们要确保所有的测试都通过了。</li></ul><h2 id="079a" class="mz lz it bd ma na nb dn me nc nd dp mi ld ne nf mk lh ng nh mm ll ni nj mo nk bi translated"><code class="fe mv mw mx my b">npm test</code></h2><p id="f9a9" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在交互式观察模式下启动测试运行程序。详见<a class="ae lq" href="https://create-react-app.dev/docs/running-tests" rel="noopener ugc nofollow" target="_blank">运行测试</a>章节。</p><p id="ee31" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您的应用程序已准备好进行部署！请参阅关于<a class="ae lq" href="https://create-react-app.dev/docs/deployment" rel="noopener ugc nofollow" target="_blank">部署</a>的部分，了解更多关于将您的应用程序部署到流行的主机提供商的信息。</p><ul class=""><li id="383c" class="ob oc it kw b kx ky la lb ld od lh oe ll of lp og oh oi oj bi translated">一旦测试通过，我们就构建生产Docker映像。完成后，我们登录我们的Docker帐户，将图像推送到Dockerhub。如果你感到好奇，<a class="ae lq" href="https://hub.docker.com/r/indreklasn/my-react-docker-app" rel="noopener ugc nofollow" target="_blank">请随意探索我们在这里建立的Docker形象</a>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/82813f462fbafffc3bcdd27bed075d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0PKhB7mktLk-_A_w0rBqQg.png"/></div></div><p class="no np gj gh gi nq nr bd b be z dk translated">https://hub.docker.com/u/indreklasn</p></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="d79c" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">将代码推送到Github</h1><p id="6f22" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">继续创建一个Github存储库，并将代码推送到存储库。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/4b5cd6e4c8622a086cfc5cd7bc387ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eu-Vu-gQfD8Ej0VJXpmGCQ.png"/></div></div><p class="no np gj gh gi nq nr bd b be z dk translated">为我们的React项目创建Github存储库。</p></figure><p id="a381" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦您将代码推送到Github，Travis将自动获取存储库并查看<code class="fe mv mw mx my b">.travis.yml</code>文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/ebc4340ed8a386ccc56b503ecfeb9368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UzJFqJASjduY68trz98_0Q.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/e09dc5c1d1b656bce4e0b831f1438fe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5FU-b9k2KM5LBy30XDQMEQ.png"/></div></div><p class="no np gj gh gi nq nr bd b be z dk translated">Travis构建管道日志</p></figure><h2 id="ed99" class="mz lz it bd ma na nb dn me nc nd dp mi ld ne nf mk lh ng nh mm ll ni nj mo nk bi translated">祝贺你——你坚持到了最后！</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/31317781805e8edb2993f01f530195e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PPm9xGq3VFcJf8nUpEO0Ig.png"/></div></div><p class="no np gj gh gi nq nr bd b be z dk translated">成功通过构建</p></figure><p id="b2ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您遇到任何问题，<a class="ae lq" href="https://github.com/indreklasn/my-react-docker-app" rel="noopener ugc nofollow" target="_blank">请查看Github资源库中的任何拼写错误</a>。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="aa96" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">包扎</h1><p id="552f" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">感谢阅读！快乐的编码，并随时拍摄我任何问题。</p><p id="42a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">了解我最新内容的最好方式是通过我的<a class="ae lq" href="https://wholesomedev.substack.com/welcome" rel="noopener ugc nofollow" target="_blank">时事通讯</a>。成为第一个得到通知的人。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/bf98059c6ba9f84a5c16721789483ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dds734n3RiKUVOqyHK0Aqw.png"/></div></div><p class="no np gj gh gi nq nr bd b be z dk translated">我的<a class="ae lq" href="https://wholesomedev.substack.com/welcome" rel="noopener ugc nofollow" target="_blank">简讯</a>。成为第一个得到通知的人。</p></figure></div></div>    
</body>
</html>