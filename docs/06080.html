<html>
<head>
<title>Build a Restaurant Recommendation Engine Using Neo4j</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Neo4j构建一个餐馆推荐引擎</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-restaurant-recommendation-engine-using-neo4j-9d13ebdd4736?source=collection_archive---------4-----------------------#2020-09-01">https://betterprogramming.pub/build-a-restaurant-recommendation-engine-using-neo4j-9d13ebdd4736?source=collection_archive---------4-----------------------#2020-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5dc4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用流行的图表数据库来计算出我们今天应该吃什么</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/17d3dbe1465d47770beb38d6e0d145e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAlmqnpcWkKFVwRwGnAaUg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@therachelstory?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">雷切尔·帕克</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="582b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们之前的Neo4j指南的基础上，我们今天将充分利用我们的知识，构建一个餐馆推荐系统。确保你有一个Neo4j的工作版本。如果您是Neo4j的新手，强烈建议您在继续之前阅读下面的指南:<a class="ae ky" href="https://medium.com/better-programming/the-beginners-guide-to-the-neo4j-graph-platform-a39858ccdeaa" rel="noopener">《Neo4j图形平台初学者指南》</a>。最后，您应该有一个工作的web应用程序，它根据您的输入返回推荐的餐馆。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="22ec" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.设置</h1><h2 id="9a55" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">Neo4j</h2><p id="0cb6" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">本教程我使用的是Neo4j社区版本4.1.1。打开终端，将目录切换到Neo4j的根文件夹。由于根文件夹位于我的C驱动器中，我的工作目录如下:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="e1ea" class="mu md it nm b gy nq nr l ns nt">C:\neo4j-community-4.1.1</span></pre><p id="fc65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过运行以下命令，将目录更改为bin文件夹:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="a231" class="mu md it nm b gy nq nr l ns nt">cd bin</span></pre><p id="6eae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以作为控制台应用程序或后台服务启动Neo4j。对于控制台应用程序，运行以下命令:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="14cb" class="mu md it nm b gy nq nr l ns nt">neo4j console</span></pre><p id="56b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用以下命令将其作为后台服务启动:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="2253" class="mu md it nm b gy nq nr l ns nt">neo4j start</span></pre><p id="038b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该在控制台上看到以下输出，表明该进程已经启动:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/da22066e1752fe51f1b8a44c0f3fbbd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*43-P2DJJMb79gWaByOkmUg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="2ce7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开浏览器并转到以下URL:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="51e6" class="mu md it nm b gy nq nr l ns nt"><a class="ae ky" href="http://localhost:7474/browser/" rel="noopener ugc nofollow" target="_blank">http://localhost:7474</a></span></pre><p id="a53a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它会将您重定向到:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="b2b9" class="mu md it nm b gy nq nr l ns nt"><a class="ae ky" href="http://localhost:7474/browser/" rel="noopener ugc nofollow" target="_blank">http://localhost:7474/browser/</a></span></pre><p id="d904" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到以下网页，这是Neo4j浏览器控制台:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/e313dd9963a08a6ae9002a06c90c9287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZM4iVeGAETHdp-f6ow6rqQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><p id="bf88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用您自己的用户名和密码连接到数据库。如果您是第一次访问它，凭据如下:</p><ul class=""><li id="96c4" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated"><code class="fe of og oh nm b">username </code> — neo4j</li><li id="ddb7" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">password</code> — neo4j</li></ul><p id="99e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，系统会提示您更改密码。登录到数据库后，您应该会看到以下用户界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/5ea189ee3f5c4a69d2c35755ab83fc86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UUNZoul7kX1b65Vhzk8s2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="0db7" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">驾驶员</h2><p id="3062" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Neo4j还支持通过驱动程序直接连接到其数据库。基于最新版本，它正式支持以下编程语言:</p><ul class=""><li id="6136" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated"><code class="fe of og oh nm b">.NET</code>——。网络标准2.0</li><li id="b756" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">Java</code> —Java 8+(最新补丁发布)。</li><li id="431d" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">JavaScript</code> —节点的所有<a class="ae ky" href="https://github.com/nodejs/LTS" rel="noopener ugc nofollow" target="_blank"> LTS版本。JS </a>，特别是4.x和6.x系列运行时。</li><li id="e94f" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">Python</code> — CPython 3.5及以上。</li><li id="b41b" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">Go</code> —正在进行的工作。目前没有官方发布日期。</li></ul><p id="1a47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我将在FastAPI中为我们的web应用程序使用Python驱动程序。请查看下面的<a class="ae ky" href="https://neo4j.com/docs/driver-manual/current/get-started/#driver-get-started-installation" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多关于其余驱动程序安装步骤的信息。</p><p id="8877" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">强烈建议您在安装之前创建一个虚拟环境。激活您的虚拟环境并运行以下命令来安装Neo4j Python驱动程序的稳定版本。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="4986" class="mu md it nm b gy nq nr l ns nt">pip install neo4j</span></pre><p id="30ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您正在寻找预发布版本，您应该改为运行以下命令:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="dbee" class="mu md it nm b gy nq nr l ns nt">pip install --pre neo4j</span></pre><h2 id="af18" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">FastAPI</h2><p id="741f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">正如我前面提到的，我们的web应用程序基于FastAPI。如果您是Flask用户，可以随意修改它，因为您总是可以在以后迁移它。看看我以前的一篇关于<a class="ae ky" href="https://medium.com/better-programming/migrate-from-flask-to-fastapi-smoothly-cc4c6c255397" rel="noopener">将Flask平滑迁移到FastAPI的文章</a>来了解更多。在同一终端中，运行以下命令:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="d689" class="mu md it nm b gy nq nr l ns nt">pip install fastapi</span></pre><p id="2a07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还需要一个<code class="fe of og oh nm b">ASGI</code>服务器。推荐的<code class="fe of og oh nm b">ASGI</code>服务器是<code class="fe of og oh nm b">Uvicorn</code>。按照以下方式安装:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="54bb" class="mu md it nm b gy nq nr l ns nt">pip install uvicorn</span></pre><h2 id="e96c" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">用例(人)</h2><p id="dd1d" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们列出节点和关系，以便将我们的域建模为一个图。为了让事情简单而简短，假设我们的主角叫爱丽丝，她有一群朋友，如下所示:</p><ul class=""><li id="4fe3" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated">朱迪</li><li id="ff26" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated">神田沙也加</li><li id="e690" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated">李金</li><li id="355a" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated">埃米莉</li><li id="9654" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated">雏菊</li><li id="0704" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated">阮汉</li><li id="ef77" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated">李婷</li></ul><p id="a313" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个节点代表具有<code class="fe of og oh nm b">Person</code>标签单个单元，且它们与爱丽丝的关系表示为<code class="fe of og oh nm b">IS_FRIEND_OF</code>。</p><h2 id="0344" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">用例(餐馆)</h2><p id="8a04" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">爱丽丝和她的朋友经常在下列餐馆吃饭:</p><ul class=""><li id="fc1f" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated"><code class="fe of og oh nm b">Korean BBQ</code> —位于<code class="fe of og oh nm b">Jurong East</code>，供应<code class="fe of og oh nm b">Korean</code>菜肴。</li><li id="598a" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">Zen Sushi</code> —位于<code class="fe of og oh nm b">Jurong West</code>，供应<code class="fe of og oh nm b">Japanese</code>菜系。</li><li id="e43d" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">Mala Hot Pot</code> —位于<code class="fe of og oh nm b">Jurong North</code>，供应<code class="fe of og oh nm b">Chinese</code>美食。</li><li id="2dd8" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">Dim Sum</code> —位于<code class="fe of og oh nm b">Jurong South</code>，供应<code class="fe of og oh nm b">Chinese</code>美食。</li><li id="b57f" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">Thai Grill</code> —位于<code class="fe of og oh nm b">Jurong South</code>，供应<code class="fe of og oh nm b">Thai</code>菜肴。</li><li id="a9f7" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">Pho Street</code> —位于<code class="fe of og oh nm b">Jurong East</code>，供应<code class="fe of og oh nm b">Vietnamese</code>美食。</li></ul><p id="9bbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有两种关系。首先，每个<code class="fe of og oh nm b">Restaurant</code>实体<code class="fe of og oh nm b">SERVES</code>都有一个特定的<code class="fe of og oh nm b">Cuisine</code>实体。第二，每个餐馆实体是一个特定的实体。</p><p id="0ccb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的是，爱丽丝和她的朋友在他们喜欢的餐馆里有他们自己的偏好。这些关系被表示为<code class="fe of og oh nm b">Person</code>实体<code class="fe of og oh nm b">LIKES</code>零个或多个<code class="fe of og oh nm b">Restaurant</code>实体。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e036" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.Neo4j数据库</h1><p id="01ab" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在这一节中，我们将运行图形查询语言(Cypher)来读取和写入我们现有的数据库中的数据。您可以使用现有的或新的数据库。</p><h2 id="5ab7" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">清除数据库</h2><p id="9f41" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">如果您已经有一个现有系统，并且想要清除它，请运行以下查询:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="e488" class="mu md it nm b gy nq nr l ns nt">MATCH (n) DETACH DELETE n</span></pre><p id="c1de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将从数据库中删除所有现有节点及其关系。</p><h2 id="f1ae" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">创建数据集</h2><p id="b91a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">以下示例显示了创建两个<code class="fe of og oh nm b">Person</code>节点并在它们之间建立关系的方法:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="56cc" class="mu md it nm b gy nq nr l ns nt">CREATE (alice:Person {name:"Alice"})-[:IS_FRIEND_OF]-&gt;(judy:Person {name:"Judy"})</span></pre><p id="4084" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe of og oh nm b">Location</code>节点和<code class="fe of og oh nm b">Cuisine</code>节点可以创建如下:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="95f8" class="mu md it nm b gy nq nr l ns nt">CREATE (jurongeast:Location {name:"Jurong East"}),<br/>       (korean:Cuisine {name:"Korean"})</span></pre><p id="bfe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，您可以将两个节点链接在一起，如下所示:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="7ec8" class="mu md it nm b gy nq nr l ns nt">CREATE (koreanbbq:Restaurant {name:"Korean BBQ"})-[:SERVES]-&gt;(korean),(koreanbbq)-[:LOCATED_IN]-&gt;(jurongeast)</span></pre><p id="1f08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，您可以通过下面的查询很容易地在<code class="fe of og oh nm b">Person</code>节点和<code class="fe of og oh nm b">Restaurant</code>之间创建一个关系，该查询表明<code class="fe of og oh nm b">judy</code>喜欢吃<code class="fe of og oh nm b">Korean BBQ</code>。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="3975" class="mu md it nm b gy nq nr l ns nt">CREATE (judy)-[:LIKES]-&gt;(koreanbbq)</span></pre><p id="9c68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，您可以将它们组合成一个查询。下面的<a class="ae ky" href="https://gist.github.com/wfng92/7c101c38801b7cf230f16c959a803d8a" rel="noopener ugc nofollow" target="_blank">要点</a>包含为我们的餐馆推荐系统创建新数据集的完整查询。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="7df3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦执行了查询，数据库信息应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/30a9e8ef46432bee1e1bff5ed9542878.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*2hPueNxepyUh4zkb1isN4A.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="d115" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">获取全部</h2><p id="8b9b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">为了获得数据库中的所有数据，可以执行以下查询:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="6561" class="mu md it nm b gy nq nr l ns nt">MATCH (n) RETURN (n)</span></pre><p id="caa3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会在Neo4j浏览器中看到下图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/2402e3616e414bf6e9c9db651a8ae848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*bRdFgzUOXApTQUgT2Mjrzw.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="4cf9" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">爱丽丝的朋友</h2><p id="80ce" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">运行下面的查询来获取Alice的朋友<code class="fe of og oh nm b">Person</code>节点的名称。您可以注意到，查询中没有指定方向。这意味着它是双向的，只要与Alice存在<code class="fe of og oh nm b">IS_FRIEND_OF</code>关系，它就会匹配。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="26fe" class="mu md it nm b gy nq nr l ns nt">MATCH (alice:Person {name:"Alice"})-[:IS_FRIEND_OF]-(person)<br/>RETURN person.name</span></pre><p id="343c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在结果页面上，单击<code class="fe of og oh nm b">Text</code>按钮，您应该会看到以下结果，表明Alice总共有7个朋友。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/21c5dbc64e3309eb66378cfd81d0ac6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*mp-rQtSotBDdE2ierfDWZg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="feec" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">饭店</h2><p id="5560" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们获得更多关于<code class="fe of og oh nm b">Restaurant</code>节点及其与<code class="fe of og oh nm b">Location</code>和<code class="fe of og oh nm b">Cuisine</code>节点的关系的信息。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="fdaf" class="mu md it nm b gy nq nr l ns nt">MATCH (location)&lt;-[:LOCATED_IN]-(restaurant)-[:SERVES]-&gt;(cuisine)<br/>RETURN location, restaurant, cuisine</span></pre><p id="7835" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/f298ce221dff739422ecb8a91e552bbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*u6jw4kZVH_n5MTdEEWW7XQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="cfec" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">特定位置的餐馆</h2><p id="34e0" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">假设您只对特定位置的所有餐馆感兴趣，您可以按如下方式查询数据:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="a868" class="mu md it nm b gy nq nr l ns nt">MATCH (jurongeast:Location {name:"Jurong East"})&lt;-[:LOCATED_IN]-(restaurant)-[:SERVES]-&gt;(cuisine)<br/>RETURN jurongeast, restaurant, cuisine</span></pre><p id="f14e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将查询位于<code class="fe of og oh nm b">Jurong East</code>的所有<code class="fe of og oh nm b">Restaurant</code>节点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/adac32ac17c1f78bf50b9aa5f2383f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*NSBvY85qfEp5NpCNy80OVg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="8c80" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">提供特殊菜肴的餐馆</h2><p id="10f2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">除此之外，假设你的偏好不是关于<code class="fe of og oh nm b">Location</code>，而是关于<code class="fe of og oh nm b">Cuisine</code>。要获得提供<code class="fe of og oh nm b">Chinese</code>菜肴的所有餐馆，请按如下方式查询:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="334e" class="mu md it nm b gy nq nr l ns nt">MATCH (location)&lt;-[:LOCATED_IN]-(restaurant)-[:SERVES]-&gt;(chinese:Cuisine {name: "Chinese"})<br/>RETURN location, restaurant, chinese</span></pre><p id="f614" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">执行后，它将在您的Neo4j浏览器中显示下图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/af03891a2535dfc590bc4c7c7caebd41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*EEICnD8rcDtffRoeAtILTQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="a951" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">爱丽丝和她的朋友喜欢的餐馆</h2><p id="8e05" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">假设Alice要和她所有的朋友一起出去，并且想知道最好的餐馆，你可以通过下面的查询推荐一家他们最喜欢的餐馆。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="d5cb" class="mu md it nm b gy nq nr l ns nt">MATCH (restaurant:Restaurant)-[:LOCATED_IN]-&gt;(location),<br/>      (restaurant)-[:SERVES]-&gt;(cuisine),<br/>      (person:Person)-[:LIKES]-&gt;(restaurant)<br/>RETURN restaurant.name, collect(person.name) as likers, count(*) as occurence<br/>ORDER BY occurence DESC</span></pre><p id="3e2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在这里使用了两个聚合函数。第一个叫做<code class="fe of og oh nm b">collect()</code>，主要用于将多个结果合并成一个列表。在这种情况下，所有的名字将被合并到一个列表中作为<code class="fe of og oh nm b">likers</code>。</p><p id="2d35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同时，第二个聚合函数<code class="fe of og oh nm b">count()</code>用于返回匹配记录的数量。在这种情况下，它将计算数量<code class="fe of og oh nm b">likers</code>。</p><p id="ed6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该得到以下结果，表明他们可以决定<code class="fe of og oh nm b">Zen Sushi</code>或<code class="fe of og oh nm b">Thai Grill</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/fac5ffdf3e66a6943621b5fdce5c06cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*foj5pV_LrQkWUhUMURgV2A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="5b66" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">爱丽丝的朋友喜欢的餐馆</h2><p id="7d2f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">假设爱丽丝不是一个挑食的人，她想知道她朋友的喜好。在这种情况下，我们需要从最终结果中排除Alice。您可以选择设置一个条件来排除Alice或只匹配她的朋友。让我们来看看第一种方法，它将把爱丽丝排除在最终结果之外。它使用了<code class="fe of og oh nm b">WHERE</code>子句和<code class="fe of og oh nm b">&lt;&gt;</code>否定符号。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="d3b7" class="mu md it nm b gy nq nr l ns nt">MATCH (restaurant:Restaurant)-[:LOCATED_IN]-&gt;(location),<br/>      (restaurant)-[:SERVES]-&gt;(cuisine),<br/>      (person:Person)-[:LIKES]-&gt;(restaurant)<br/>RETURN restaurant.name, collect(person.name) as likers, count(*) as occurence<br/>WHERE person.name &lt;&gt; "Alice"<br/>ORDER BY occurence DESC</span></pre><p id="d702" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，我们在<code class="fe of og oh nm b">MATCH</code>子句中正确地匹配了她的朋友。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="c5a8" class="mu md it nm b gy nq nr l ns nt">MATCH (alice:Person {name:"Alice"}),<br/>      (alice)-[:IS_FRIEND_OF]-(friend),<br/>      (restaurant:Restaurant)-[:LOCATED_IN]-&gt;(location),<br/>      (restaurant)-[:SERVES]-&gt;(cuisine),<br/>      (friend)-[:LIKES]-&gt;(restaurant)<br/>RETURN restaurant.name, collect(friend.name) as likers, count(*) as occurence<br/>ORDER BY occurence DESC</span></pre><p id="ef7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将显示以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/2c8e5470153c3aef8a87cd7d192b0168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qd6Um0sgRQNSdsU_EFFWWg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="5f37" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">爱丽丝的朋友喜欢的中国餐馆</h2><p id="c3f1" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">假设爱丽丝的朋友厌倦了通常的烹饪，今天想吃<code class="fe of og oh nm b">Chinese</code>食物。您可以使用下面的查询来获得推荐的餐馆。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="3de6" class="mu md it nm b gy nq nr l ns nt">MATCH (alice:Person {name:"Alice"}),<br/>      (alice)-[:IS_FRIEND_OF]-(friend),<br/>      (restaurant:Restaurant)-[:LOCATED_IN]-&gt;(location),<br/>      (restaurant)-[:SERVES]-&gt;(:Cuisine {name:"Chinese"}),<br/>      (friend)-[:LIKES]-&gt;(restaurant)<br/>RETURN restaurant.name, location.name, collect(friend.name) as likers, count(*) as occurence<br/>ORDER BY occurence DESC</span></pre><p id="15dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据结果，您可以选择<code class="fe of og oh nm b">Dim Sum</code>或<code class="fe of og oh nm b">Mala Hot Pot</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/437f01bd8b405b6ae4ee584c998e3610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RjVtXVOzhUw25z8HOlSk6w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="946f" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">爱丽丝的朋友喜欢的位于特定位置的餐馆</h2><p id="97fe" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">另一个要考虑的因素是<code class="fe of og oh nm b">Location</code>。假设他们中的大多数人住在<code class="fe of og oh nm b">Jurong East</code>附近，并且喜欢在这个地方附近吃顿饭。您可以通过运行以下查询来提供建议:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="fd9e" class="mu md it nm b gy nq nr l ns nt">MATCH (alice:Person {name:"Alice"}),<br/>      (alice)-[:IS_FRIEND_OF]-(friend),<br/>      (restaurant:Restaurant)-[:LOCATED_IN]-&gt;(location:Location {name:"Jurong East"}),<br/>      (restaurant)-[:SERVES]-&gt;(cuisine),<br/>      (friend)-[:LIKES]-&gt;(restaurant)<br/>RETURN restaurant.name, collect(friend.name) as likers, count(*) as occurence<br/>ORDER BY occurence DESC</span></pre><p id="3721" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们在结果中省略了位置名称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/132387cc258f3e3283309a75aef0363c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*riCM_kCIPNRwh-rI651z0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure><h2 id="409c" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">爱丽丝的几个朋友喜欢的餐馆</h2><p id="c35d" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">假设<code class="fe of og oh nm b">Alice</code>将与<code class="fe of og oh nm b">Judy</code>和<code class="fe of og oh nm b">Sayaka</code>一起外出，您可以通过以下查询约束推荐的餐馆</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="4a14" class="mu md it nm b gy nq nr l ns nt">MATCH (restaurant:Restaurant)-[:LOCATED_IN]-&gt;(location),<br/>      (restaurant)-[:SERVES]-&gt;(cuisine),<br/>      (person:Person)-[:LIKES]-&gt;(restaurant)<br/>WHERE person.name = "Judy" OR person.name = "Sayaka"<br/>RETURN restaurant.name, collect(person.name) as likers, count(*) as occurence<br/>ORDER BY occurence DESC</span></pre><p id="82cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会得到<code class="fe of og oh nm b">Judy</code>和<code class="fe of og oh nm b">Sayaka</code>都喜欢的最好的餐厅。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/02661f5ae991c344bf1ff9d2b6cbd8e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*2wzEl6ZvFanATpFcsqSIJA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="28f9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.Python驱动程序</h1><p id="725b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在本节中，我们将实现一个连接到Neo4j数据库的简单Python模块。在工作目录中创建新的Python文件。我准备把它命名为<code class="fe of og oh nm b">recommender.py</code>。</p><h2 id="0ae5" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">导入</h2><p id="7d3c" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在文件的顶部添加以下导入声明。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="4d58" class="mu md it nm b gy nq nr l ns nt">from neo4j import GraphDatabase<br/>import logging<br/>from neo4j.exceptions import ServiceUnavailable</span></pre><h2 id="584d" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">推荐者类别</h2><p id="b049" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">创建一个名为<code class="fe of og oh nm b">Recommender</code>的新类，并用以下函数填充它:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="128e" class="mu md it nm b gy nq nr l ns nt">class Recommender:<br/>    def __init__(self, uri, user, password):<br/>        self.driver = GraphDatabase.driver(uri, auth=(user, password))</span><span id="5c6f" class="mu md it nm b gy pb nr l ns nt">    def close(self):<br/>        self.driver.close()</span></pre><h2 id="8257" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">证明</h2><p id="dcae" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">从版本4开始，认证功能已经通过接受以下参数的<code class="fe of og oh nm b">GraphDatabase.driver</code>功能标准化:</p><ul class=""><li id="c1e3" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated"><code class="fe of og oh nm b">uri</code> —用于引导系统的初始地址解析。本地服务器应该使用<code class="fe of og oh nm b">neo4j://</code> URI。</li><li id="0459" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">auth</code> —保存用户名和密码信息的元组。</li><li id="b286" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">resolver</code> —用作地址解析拦截挂钩。它接受回调函数。</li></ul><h2 id="1aee" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">与数据库的连接</h2><p id="1042" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在我们继续之前，让我们更深入地研究一下如何创建一个查询字符串并从数据库中获取数据。假设您的API负责获取Alice的朋友名单，我们需要为它编写两个函数。</p><p id="059e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个函数是接受输入名称的通用函数。它将初始化一个会话，并通过<code class="fe of og oh nm b">read_transaction()</code>函数调用获取数据。您需要传入一个回调函数和要传递给回调函数的参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="b7db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的API负责从数据库中获取记录，您需要使用<code class="fe of og oh nm b">write_transaction()</code>函数。</p><p id="8d72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个函数将调用section函数，它主要负责:</p><ul class=""><li id="f70f" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated">根据输入参数基于密码构建查询字符串，</li><li id="ab7c" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated">执行查询，以及</li><li id="2a14" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated">返回结果。</li></ul><p id="8bf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码片段演示了如何将参数传递到查询字符串中，通过<code class="fe of og oh nm b">run()</code>函数执行查询。在函数结束时，它会以列表的形式返回结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="0a6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">变量名通过在其前面添加美元符号<code class="fe of og oh nm b">$</code>来标记。建议在它上面声明<code class="fe of og oh nm b">staticmethod</code>装饰器。</p><p id="c41f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过在main函数中添加以下代码来自行测试它:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="492c" class="mu md it nm b gy nq nr l ns nt">if __name__ == "__main__":<br/>    uri = "neo4j://localhost:7687"<br/>    user = "neo4j"<br/>    password = "neo4j"</span><span id="24de" class="mu md it nm b gy pb nr l ns nt">    app = Recommender(uri, user, password)<br/>    print(app.find_friend('Alice'))<br/>    app.close()</span></pre><p id="a173" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并在终端中运行Python文件:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="9a8a" class="mu md it nm b gy nq nr l ns nt">python recommender.py</span></pre><p id="4d9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该得到以下输出:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="8606" class="mu md it nm b gy nq nr l ns nt">{'friends': ['Li Ting', 'Nguyen Hanh', 'Daisy', 'Emily', 'Kim Lee', 'Sayaka', 'Judy']}</span></pre><h2 id="8da2" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">Recommender.py</h2><p id="899f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们通过添加另外两个函数来为Python文件添加最后的润色，这两个函数负责基于以下输入返回建议:</p><ul class=""><li id="d533" class="nw nx it lb b lc ld lf lg li ny lm nz lq oa lu ob oc od oe bi translated"><code class="fe of og oh nm b">cuisine</code> —用户偏好的<code class="fe of og oh nm b">Cuisine</code>类型。</li><li id="8426" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">location</code> —用户首选的<code class="fe of og oh nm b">Location</code>。</li><li id="7488" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">person</code> —代表将要参加宴会的<code class="fe of og oh nm b">Person</code>的名字列表。</li><li id="9b79" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu ob oc od oe bi translated"><code class="fe of og oh nm b">max</code> —确定最终结果是否应该只包括最受欢迎的餐馆(参与者的首选)。</li></ul><p id="7f73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在下面的<a class="ae ky" href="https://gist.github.com/wfng92/1a680760a31b531b078f6fdce7a77cb0" rel="noopener ugc nofollow" target="_blank">要点</a>中找到<code class="fe of og oh nm b">recommender.py</code>的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="9ad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我添加了一个简单的工具来一般化和参数化这个函数。这可能不是最好的解决方案。因此，您可以根据自己的用例随意修改它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fe1e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.FastAPI服务器</h1><p id="bcd2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现在，我们将设置一个FastAPI服务器，作为我们的web应用程序的后端。创建一个名为<code class="fe of og oh nm b">myapp.py</code>的新Python文件。</p><h2 id="1077" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">导入</h2><p id="3fd4" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在文件顶部添加以下导入声明。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="ab77" class="mu md it nm b gy nq nr l ns nt">from fastapi import FastAPI<br/>import recommender<br/>import atexit</span></pre><p id="ff40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe of og oh nm b">atexit</code>是Python内置模块的一部分，当应用程序退出时，它可以帮助执行注册的函数。更多信息，请看我之前的教程<a class="ae ky" href="https://medium.com/better-programming/create-exit-handlers-for-your-python-appl-bc279e796b6b" rel="noopener">如何为你的Python应用</a>创建退出处理程序。</p><p id="0d43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe of og oh nm b">recommender</code>是我们之前创建的模块的名称，假设两个文件位于同一个目录中。如果您使用不同的名称或具有不同的层次结构，请相应地修改它。</p><h2 id="41ae" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">初始化</h2><p id="6693" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">初始化以下变量，这些变量将用于对我们的Neo4j数据库进行身份验证。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="ba60" class="mu md it nm b gy nq nr l ns nt">uri = "neo4j://localhost:7687"<br/>user = "neo4j"<br/>password = "neo4j"</span><span id="f184" class="mu md it nm b gy pb nr l ns nt">neo_db = recommender.Recommender(uri, user, password)</span></pre><h2 id="a594" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">退出处理程序</h2><p id="e061" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">创建一个新函数来关闭与数据库的连接。我们将注册到<code class="fe of og oh nm b">atexit</code>，这样它将在应用程序退出时执行该函数。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="27d6" class="mu md it nm b gy nq nr l ns nt">def exit_application():<br/>    neo_db.close()</span><span id="f79d" class="mu md it nm b gy pb nr l ns nt">atexit.register(exit_application)</span></pre><h2 id="f11e" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">FastAPI路线</h2><p id="7478" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">之后，创建一个新的FastAPI实例，并继续在Python文件中添加以下路径。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="4582" class="mu md it nm b gy nq nr l ns nt">app = FastAPI()</span><span id="4c2f" class="mu md it nm b gy pb nr l ns nt">@app.get('/get-recommedation')<br/>async def get_recommedation(cuisine = '', location = '', person = '', max=False):<br/>    person_list = [] if person == '' else person.split(',')<br/>    result = neo_db.find_recommendation(cuisine, location, person_list, max)<br/><br/>    return result</span></pre><p id="ac96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它接受四个查询参数。<code class="fe of og oh nm b">person</code>参数应该是一个包含参与者姓名的字符串。每个名称都应该用逗号分隔。在函数内部，我们将把<code class="fe of og oh nm b">person</code>字符串转换成一个列表，并调用<code class="fe of og oh nm b">find_recommendation()</code>函数。</p><p id="aa1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看下面的<a class="ae ky" href="https://gist.github.com/wfng92/587036079e257240ca01b2a5539a20a3" rel="noopener ugc nofollow" target="_blank">要点</a>获得<code class="fe of og oh nm b">myapp.py</code>的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="21cb" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">运行FastAPI</h2><p id="65c2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">为了测试它，运行下面的代码来启动FastAPI服务器:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="e203" class="mu md it nm b gy nq nr l ns nt">uvicorn myapp:app</span></pre><p id="52ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，打开浏览器，转到以下URL:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="6ce2" class="mu md it nm b gy nq nr l ns nt"><a class="ae ky" href="http://localhost:8000/get-recommedation" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/get-recommedation</a></span></pre><p id="ecd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该得到以下输出:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="e1b7" class="mu md it nm b gy nq nr l ns nt">[{"restaurant":"Zen Sushi","likers":["Daisy","Li Ting","Emily","Sayaka"],"occurence":4},{"restaurant":"Thai Grill","likers":["Sayaka","Daisy","Judy","Alice"],"occurence":4},{"restaurant":"Mala Hot Pot","likers":["Li Ting","Nguyen Hanh","Alice"],"occurence":3},{"restaurant":"Dim Sum","likers":["Li Ting","Emily","Alice"],"occurence":3},{"restaurant":"Pho Street","likers":["Kim Lee","Emily","Nguyen Hanh"],"occurence":3},{"restaurant":"Korean BBQ","likers":["Judy","Kim Lee"],"occurence":2}]</span></pre><h2 id="52e9" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">查询参数(位置)</h2><p id="1f6a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们添加一个<code class="fe of og oh nm b">location</code>输入，只匹配句容东的餐馆。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="e2c7" class="mu md it nm b gy nq nr l ns nt"><a class="ae ky" href="http://localhost:8000/get-recommedation?location=Jurong%20East" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/get-recommedation?location=Jurong%20East</a></span></pre><p id="0dc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="cc4a" class="mu md it nm b gy nq nr l ns nt">[{"restaurant":"Pho Street","likers":["Kim Lee","Emily","Nguyen Hanh"],"occurence":3},{"restaurant":"Korean BBQ","likers":["Judy","Kim Lee"],"occurence":2}]</span></pre><h2 id="62a8" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">查询参数(美食)</h2><p id="fe3f" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">除此之外，您也可以指定<code class="fe of og oh nm b">cuisine</code>。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="6300" class="mu md it nm b gy nq nr l ns nt"><a class="ae ky" href="http://localhost:8000/get-recommedation?cuisine=Chinese" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/get-recommedation?cuisine=Chinese</a></span></pre><p id="c637" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下数据将显示在您的浏览器上:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="8129" class="mu md it nm b gy nq nr l ns nt">[{"restaurant":"Dim Sum","likers":["Li Ting","Emily","Alice"],"occurence":3},{"restaurant":"Mala Hot Pot","likers":["Li Ting","Nguyen Hanh","Alice"],"occurence":3}]</span></pre><h2 id="ea01" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">查询参数(人)</h2><p id="1aaf" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">请记住，我们的路由有一个名为person的附加参数，它接受由逗号分隔的名称字符串。让我们试一试:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="6bc6" class="mu md it nm b gy nq nr l ns nt"><a class="ae ky" href="http://localhost:8000/get-recommedation?person=Alice,Judy,Sayaka" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/get-recommedation?person=Alice,Judy,Sayaka</a></span></pre><p id="c98f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的最终结果应该是这样的:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="ac28" class="mu md it nm b gy nq nr l ns nt">[{"restaurant":"Thai Grill","likers":["Sayaka","Judy","Alice"],"occurence":3},{"restaurant":"Korean BBQ","likers":["Judy"],"occurence":1},{"restaurant":"Zen Sushi","likers":["Sayaka"],"occurence":1},{"restaurant":"Mala Hot Pot","likers":["Alice"],"occurence":1},{"restaurant":"Dim Sum","likers":["Alice"],"occurence":1}]</span></pre><h2 id="00d9" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">查询参数(最大值)</h2><p id="4119" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">现在，您应该注意到返回的结果包含至少有一个<code class="fe of og oh nm b">occurence</code>的记录。事实上，您可以通过<code class="fe of og oh nm b">max</code>参数修改它，只返回最顶端的<code class="fe of og oh nm b">occurence </code>。您也可以使用<code class="fe of og oh nm b">0</code>或<code class="fe of og oh nm b">1</code>作为输入，因为Pydantic会将值解析到<code class="fe of og oh nm b">bool</code>中。</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="7c1d" class="mu md it nm b gy nq nr l ns nt">localhost:8000/get-recommedation?person=Alice,Judy,Sayaka&amp;max=True</span></pre><p id="4e4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将max设置为<code class="fe of og oh nm b">True</code>将产生以下结果:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="fc3e" class="mu md it nm b gy nq nr l ns nt">[{"restaurant":"Thai Grill","likers":["Sayaka","Judy","Alice"],"occurence":3}]</span></pre><p id="452d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝贺您完成本教程。继续下一部分，回顾我们今天所学的内容。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="da19" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.结论</h1><p id="ab8c" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我们首先在浏览器上运行Neo4j控制台，并安装必要的模块，比如Neo4j Python驱动程序和FastAPI。此外，我们还概述了用例中涉及的实体。</p><p id="48c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们清空了数据库，并在其中创建了一些示例记录。数据集由以下节点组成:<code class="fe of og oh nm b">Person</code>、<code class="fe of og oh nm b">Location</code>、<code class="fe of og oh nm b">Restaurant</code>和<code class="fe of og oh nm b">Cuisine</code>。</p><p id="7f2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们完成了这些，我们就使用Cypher(图形查询语言)根据我们指定的模式从数据库中获取记录。我们测试了几种不同的模式，根据我们的偏好返回推荐的餐馆。</p><p id="9698" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还实现了一个简单的模块，用于连接数据库并从中获取记录。之后，我们继续建立一个FastAPI服务器作为web应用程序的后端。最后，我们在浏览器上测试了几个不同的用例。</p><p id="6b71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢你阅读这篇文章。希望在下一篇文章中再见到你！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="73cf" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><ol class=""><li id="4d2e" class="nw nx it lb b lc ng lf nh li pc lm pd lq pe lu pf oc od oe bi translated"><a class="ae ky" href="https://neo4j.com/" rel="noopener ugc nofollow" target="_blank"> Neo4j网站</a></li><li id="bcda" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu pf oc od oe bi translated"><a class="ae ky" href="https://neo4j.com/graphgist/restaurant-recommendations" rel="noopener ugc nofollow" target="_blank"> Neo4j餐厅推荐</a></li><li id="b6f8" class="nw nx it lb b lc oi lf oj li ok lm ol lq om lu pf oc od oe bi translated"><a class="ae ky" href="https://neo4j.com/docs/api/python-driver/4.1/" rel="noopener ugc nofollow" target="_blank"> Neo4j Python驱动</a></li></ol></div></div>    
</body>
</html>