<html>
<head>
<title>A Beginner-friendly Introduction to FastAPI Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对初学者友好的FastAPI安全性介绍</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-beginner-friendly-introduction-to-fastapi-security-d8f69a259804?source=collection_archive---------5-----------------------#2021-12-06">https://betterprogramming.pub/a-beginner-friendly-introduction-to-fastapi-security-d8f69a259804?source=collection_archive---------5-----------------------#2021-12-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="62c7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">FastAPI中的基本认证</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/97ebcea1015ee525107fd46ce68493f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_kBCcYpjHOuFJTxu"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@alexeh99?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亚历山大·埃伦霍弗</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="d475" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你创建一个API时，安全性是非常重要的。假设攻击者找到了进入您的API的方法，那么在最坏的情况下，他可以修改您的数据。当然，你想一直避免这种情况。因此，最好的第一步是添加一种简单的身份验证方式。</p><p id="315c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了用户名和密码，攻击者就很难访问您的web应用程序。本文将教你如何用FastAPI实现基本的auth。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0e78" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">从控制器访问凭证</h1><p id="38ac" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您想要保护rest控制器，您必须定义一个安全方案。这已经在FastAPI中提供了，节省了您的时间和精力。没有比这更复杂的了:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="28d0" class="ne md it na b gy nf ng l nh ni">http_basic = fastapi.security.HTTPBasic()</span></pre><p id="d79a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您将需要查阅用户的数据。API用户在基本认证中指定用户名和密码。这些都在一个对象中，即<code class="fe nj nk nl na b">credentials</code>。下面的代码显示了如何查询凭据:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="148f" class="ne md it na b gy nf ng l nh ni">@app.get("/books")<br/>def find_all_books(credentials: HTTPBasicCredentials = fastapi.Depends(http_basic)) -&gt; List[Book]:<br/>    security_service.verify(credentials)<br/>    return book_service.find_all()</span></pre><p id="f6db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个查找图书列表的代码示例。用户提供的凭证可通过参数<code class="fe nj nk nl na b">credentials</code>访问。</p><p id="c901" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl na b">security service</code>将核实这些凭证。如果这些是错误的，这段代码将抛出401错误:未授权。安全服务验证功能是一种保护方法。否则，执行流程继续并返回一个图书列表。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="516d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">防止向攻击者泄露信息</h1><p id="e623" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">基本身份验证是保护API的一种简单方法。实现错误使其易受攻击。攻击者知道算法是如何工作的。他们利用有针对性的攻击来获取信息。</p><p id="d3ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须防御的最重要的攻击是暴力攻击和定时攻击。</p><p id="690f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">防止随机选择用户名和密码的暴力攻击的最佳方法是选择由不同字符、数字和符号组成的长用户名和密码。这将使窃取您的密码变得非常困难。</p><blockquote class="nm nn no"><p id="7fa6" class="kz la np lb b lc ld ju le lf lg jx lh nq lj lk ll nr ln lo lp ns lr ls lt lu im bi translated">永远不要在源代码中存储凭据。将它们存储在环境变量中，或者使用Azure Vault或AWS KMS等专用服务。</p></blockquote><p id="7969" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">攻击者还会试图获得至少一项权利。如果他能得到用户名或密码，他的工作就会减半。因此，永远不要告诉用户密码或用户名是否有效。要么都有，要么都没有。此外，在进行比较之前，我将用户名和密码连接起来。这样，它们被视为一个凭证。</p><p id="7c94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们使用<code class="fe nj nk nl na b">secure</code>模块的<code class="fe nj nk nl na b">compare_digest</code>函数来防止计时攻击，这将向攻击者指示密码的长度。结果如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6c90" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="56a0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，您已经了解到在FastAPI中添加基本身份验证很容易。您可以阅读凭据并开始检查它们。如果用户没有提供正确的凭证，您将返回401。否则，流程继续。</p><p id="6f30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，您应该仔细考虑如何实现基本身份验证。通过简单的实现错误，您可以使自己非常容易受到攻击者的攻击。所以，如果你想更好地保护自己，一定要采取额外的措施。</p><p id="69e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">合理的下一步是身份验证方法，在这种方法中，您必须使用第三方来识别您的身份，如您的身份证或面部识别。这种额外的安全措施将使攻击者极难获得对您的API的访问权限。</p><p id="d734" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，对于风险较低的应用程序，依靠基本的身份验证并定期对云中受到良好保护的系统进行良好的备份就足够了。</p></div></div>    
</body>
</html>