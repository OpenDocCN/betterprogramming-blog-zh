<html>
<head>
<title>Create a Running Docker Container With Gunicorn and Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Gunicorn和Flask创建一个正在运行的Docker容器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-a-running-docker-container-with-gunicorn-and-flask-dcd98fddb8e0?source=collection_archive---------1-----------------------#2020-11-04">https://betterprogramming.pub/create-a-running-docker-container-with-gunicorn-and-flask-dcd98fddb8e0?source=collection_archive---------1-----------------------#2020-11-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0703" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">可以想象的最简单的容器设置。从这里开始</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6ff6dff7061030597cba1baed2ea5449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KjMK8uwqgli73Vdj"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@mirkoblicke?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Mirko Blicke </a>拍摄的照片。</p></figure><p id="ec77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建一个最小的<a class="ae ky" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>应用程序开始:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">简单烧瓶应用</p></figure><p id="cbf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们编写运行<a class="ae ky" href="https://gunicorn.org/" rel="noopener ugc nofollow" target="_blank"> Gunicorn </a>服务器的命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="15a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参数几乎是不言自明的:我们告诉Gunicorn，我们希望生成两个工作进程，每个进程运行两个线程。我们还接受来自外部的连接，并覆盖Gunicorn的默认端口(8000)。</p><p id="82f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的基本文档:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Dockerfile文件</p></figure><p id="1504" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们建立自己的形象:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="d504" class="mc md it ly b gy me mf l mg mh">docker build -t flask/hello-world .</span></pre><p id="bde8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并运行:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="90d4" class="mc md it ly b gy me mf l mg mh">docker run -p 8003:8003 flask/hello-world</span></pre><p id="d91c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们发布了端口，所以现在可以访问该应用程序:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="3d40" class="mc md it ly b gy me mf l mg mh">$ curl localhost:8003<br/>Hello world!</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="5404" class="mp md it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">通过Minikube使用本地k8运行</h1><p id="38ac" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">假设您的机器上已经运行了Minikube，请按照下面的步骤操作。</p><p id="9664" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使用本地Docker映像，您需要运行:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="8ba6" class="mc md it ly b gy me mf l mg mh">eval $(minikube docker-env)</span></pre><p id="3c31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，您应该在想要使用的每个终端上这样做。</p><p id="f31d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，构建图像:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="6a48" class="mc md it ly b gy me mf l mg mh">docker build -t marounbassam/hello-flask:v1 .</span></pre><p id="9e1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe nl nm nn ly b">kubectl</code>上运行并公开部署:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="c732" class="mc md it ly b gy me mf l mg mh">$ kubectl run hello-flask --image=marounbassam/hello-flask:v1 --port=8003 --image-pull-policy=IfNotPresent<br/>$ kubectl expose deployment hello-flask --type=NodePort</span></pre><p id="17ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以到达应用程序的终点了:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="eb7f" class="mc md it ly b gy me mf l mg mh">curl $(minikube service hello-flask --url)</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="4467" class="mp md it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">奖金Makefile</h1><p id="4f0e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们创建一个简单的Makefile，它允许我们构建、运行和删除我们的映像/容器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生成文件</p></figure><p id="d9dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们应该可以运行了:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="e4c1" class="mc md it ly b gy me mf l mg mh"># build Docker image<br/>make build<br/># run the container<br/>make run<br/># destroy it<br/>make kill</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="93bf" class="mp md it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">摘要</h1><p id="7c3c" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">将生产就绪的烧瓶应用程序容器化既快速又简单。通过添加一个WSGI服务器(Gunicorn ),我们的部署变得更加稳定，并且能够一次处理更多的请求——而且速度很快。</p></div></div>    
</body>
</html>