<html>
<head>
<title>Building a Music Game in JavaScript: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript构建音乐游戏:第2部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-a-music-game-in-javascript-part-2-ec21d37be2d8?source=collection_archive---------14-----------------------#2019-11-26">https://betterprogramming.pub/building-a-music-game-in-javascript-part-2-ec21d37be2d8?source=collection_archive---------14-----------------------#2019-11-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2b65" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">增加游戏化、评分和互动</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7a24c7bf3019bbb0e00a794e668a71de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ykKDNL7m_7bWMW6wMyoFDg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/s/photos/dj-pad?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@justzorik?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Zorik D </a>拍摄</p></figure><p id="d6ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第1部分的<a class="ae ky" href="https://medium.com/better-programming/building-a-beatbox-game-in-javascript-bd9c2d06e1b2" rel="noopener">中，我描述了如何在JavaScript中使用异步函数以特定的间隔播放一系列声音，所有这些都由pad控制。在每个间隔之后，循环再次遍历声音并播放打开的声音。</a></p><p id="71af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们来看一下游戏的逻辑，并探索分数、计时器、输赢机制是如何实现的。</p><p id="ef1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用户玩游戏时，他们会听到电脑发出的节拍，然后他们有有限的时间来重新创建它。在此期间，他们可以尝试不同的模式，再次听示例节拍，并再次尝试，直到他们得到完全匹配或直到时间结束。</p><p id="52b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分数是根据在正确位置打开的键盘键的百分比计算的。</p><p id="d5ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的代码可以在我的GitHub 中找到<a class="ae ky" href="https://github.com/iourisorokine/The-Beat-Battle" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="d75f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有相当多的函数相互调用，但是如果我们把问题分成更小的块，我们有:</p><ul class=""><li id="0da6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">存储游戏每一轮的数据。</li><li id="1fd9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">让电脑设定并开始每一轮。</li><li id="5d70" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将用户密码与他们必须猜测的内容进行比较。</li><li id="979c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">计算分数，当分数达到100%时结束这一轮。</li><li id="f590" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">更新时间，时间到了就结束。</li><li id="ed4f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">向玩家提供视觉反馈。</li><li id="7ad7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">确保玩家不能通过多次按下同一个按钮来使机器崩溃。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="af42" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">玩家对抗电脑游戏机制</h1><p id="4954" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">为了创建计算机对手，我们需要复制我们为玩家构建的<code class="fe nn no np nq b">playBeat</code>和<code class="fe nn no np nq b">playMusic</code>函数。我们称它为<code class="fe nn no np nq b">playDJ</code>:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="2089" class="nv mr it nq b gy nw nx l ny nz">playDJ = (soundsArr, partition, tempo, measures) =&gt; { <br/>   let counter = 0; <br/>   let countTimes = 0; <br/>   stopPlaying(); <br/>   djPlaying = setInterval(()=&gt; { <br/>      playBeat(soundsArr, partition[counter]); <br/>      counter++; <br/>      countTimes++; <br/>      if (counter === partition.length) counter = 0; <br/>      if (countTimes === measures) clearInterval(djPlaying); <br/>   }, tempo);}</span></pre><p id="0457" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个函数将在另一个我们命名为<code class="fe nn no np nq b">listenToTheDJ</code>的函数中被调用，它将由玩家在按下“Play”按钮时触发:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="6597" class="nv mr it nq b gy nw nx l ny nz">listenToTheDJ = (measures) =&gt; { </span><span id="89e6" class="nv mr it nq b gy oa nx l ny nz">// the play button gets removed to avoid crashing the app by <br/>// pressing it several times</span><span id="e455" class="nv mr it nq b gy oa nx l ny nz">   let listenButton = document.getElementById(‘listen-button’); <br/>   startOrListenButton.removeChild(listenButton) </span><span id="6ef1" class="nv mr it nq b gy oa nx l ny nz">// The playDJ function is called, playing the model beat</span><span id="edd4" class="nv mr it nq b gy oa nx l ny nz">   playDJ(soundsDJ, partitionDJ, timeoutTempo, measures); <br/>   setTimeout(()=&gt; { <br/>      if (!document.contains(document.getElementById(‘btn-start-round’))) <br/>      createListenButton(); <br/>   }, timeoutTempo * measures);<br/>}</span></pre><p id="7b83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，这个函数的内容是存储在对象数组中的数据，称为<code class="fe nn no np nq b">easyPartitions</code>(也有一个硬模式)。每个对象看起来像这样:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="c7d4" class="nv mr it nq b gy nw nx l ny nz">{ <br/>   name: ‘“Funky”’, <br/>   tempo: 150, <br/>   time: 60, <br/>   difficulty: 4, <br/>   notes: [ <br/>      [true, false, true, false, false, true], <br/>      [false, false, true, false, false, false], <br/>      [true, false, true, false, true, false], <br/>      [false, false, true, false, true, true] <br/>   ] <br/>}</span></pre><p id="5824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">notes</code>部分很容易辨认，因为对用户来说它是完全相同的模型:4次6个声音的阵列。</p><p id="f5dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">速度用于计算以正确速度播放节拍所需的超时时间，然后将其传递到<code class="fe nn no np nq b">playDJ</code>函数的<code class="fe nn no np nq b">timeoutTempo</code>参数中。</p><p id="9ba3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">difficulty</code>是用户分数的乘数，如果猜的节奏变得更难，分数会变得更高。</p><p id="bdbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">time</code>是用户必须猜测节拍的秒数。将显示倒计时，一旦时间到了，这一轮将结束。</p><p id="0ce5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:可以将整个notes数组转换成一系列二进制值，然后进一步压缩成一个十进制数。</p><p id="1832" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，它会给我们101001 001000 101010 001011，然后是10783371，但它使笔记更难阅读，所以我把它放在一边。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="62c4" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">评分机制—检查用户的输出</h1><p id="ae2d" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这一轮的得分是通过比较游戏者在pad上所做的事情与所玩的分区来计算的，这意味着比较两个二维<strong class="lb iu"> <em class="ob"> </em> </strong>数组，并给出它们之间的准确率百分比。</p><p id="454e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们使用函数<code class="fe nn no np nq b">compareMusic</code>，它将两个数组作为参数，并返回分数:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="5384" class="nv mr it nq b gy nw nx l ny nz">compareMusic = (modelPartition, userPartition) =&gt; { <br/>   <br/>   const modelPartFlat = modelPartition.flat(2); <br/>   const userPartFlat = userPartition.flat(2); <br/>   <br/>   const compareLength = modelPartFlat.reduce((acc, value) =&gt; { <br/>      if (value) acc++ return acc; <br/>   });<br/> <br/>   let compareScore = 0; <br/>   userPartFlat.forEach((note, index) =&gt; { <br/>      if (modelPartFlat[index] &amp;&amp; note === modelPartFlat[index]){<br/>         compareScore++;<br/>      } <br/>      if (!modelPartFlat[index] &amp;&amp; note &amp;&amp; compareScore &gt; 0){<br/>         compareScore —- ; <br/>      }<br/>   }); </span><span id="0d32" class="nv mr it nq b gy oa nx l ny nz">   let score = (compareScore / compareLength) * 100; <br/>   return score ;<br/>}</span></pre><p id="bf9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们使用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/flat" rel="noopener ugc nofollow" target="_blank"> array flat </a>方法将数组展平到一维，这种方式使得数据易于比较。</p><p id="0def" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其次，我们确定应该切换到<code class="fe nn no np nq b">true</code> <em class="ob"> </em>的音符的数量，并将其存储在变量<code class="fe nn no np nq b">compareLength</code>中。</p><p id="f30b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，对于每个正确打开的音符，我们添加分数，对于每个错误打开的音符，分数减少，总数转换为百分比。</p><p id="65a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比如有10注要猜，每猜对一注带来10%，每猜错一注扣除10%。</p><p id="d8c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，分数最低不得超过0%。</p><p id="4868" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了增加一层乐趣，时间和难度都包括在该轮的得分中:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="5c91" class="nv mr it nq b gy nw nx l ny nz">updatePlayerScore = (score, difficulty, remainingTime) =&gt; { </span><span id="dc80" class="nv mr it nq b gy oa nx l ny nz">   const roundScore = (score * difficulty); <br/>   const timeBonus = Math.round(remainingTime * 10); <br/>   playerScore = playerScore + (roundScore + timeBonus);    <br/>   showScoreBoard(roundScore, timeBonus,  <br/>   playerScore, remainingTime); <br/>   document.getElementById(‘score-span’).innerText = `Score: ${playerScore}`;</span><span id="45d3" class="nv mr it nq b gy oa nx l ny nz">}</span></pre><p id="426e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">难度是分数的倍增器，剩下的时间会增加一些分数，让猜得快的人受益。</p><p id="f6be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nn no np nq b">showScoreBoard</code>函数使结果出现在每一轮结束时，但我不会在这里深入讨论它的细节。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="c974" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">时间力学——让时钟滴答作响</h1><p id="e1e7" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">如上所述，每一轮都是计时的，并且<em class="ob"> </em> <code class="fe nn no np nq b">time</code>键的值决定了用户完成这一轮的秒数。</p><p id="e530" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这基本上是通过创建一个<code class="fe nn no np nq b">setInterval</code>函数来完成的，该函数在每次执行时递增一个计数器:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="9978" class="nv mr it nq b gy nw nx l ny nz">playRound = () =&gt; { </span><span id="fad5" class="nv mr it nq b gy oa nx l ny nz">   clearInterval(musicPlaying); <br/>   moveToNextRound(); <br/>   clearFeedbackZone(); //this cleans the current status</span><span id="ba81" class="nv mr it nq b gy oa nx l ny nz">   roundIsStarted = true; <br/>   let counter = partitionsToPickFrom[roundNb].time; <br/>   let timeSpan = removeStartButton(); <br/>   listenToTheDJ(16); // plays one time the music to guess</span><span id="b1b1" class="nv mr it nq b gy oa nx l ny nz">   let roundPlaying = setInterval(()=&gt; { <br/>      timeSpan.innerText = `Time: ${counter} sec`; <br/>      counter —- ;<br/> <br/>      if (counter === -1 || currentScore === 100) { <br/>         clearInterval(roundPlaying); <br/>         endCurrentRound(counter + 1); <br/>      } // if this condition is entered, the round ends </span><span id="0f43" class="nv mr it nq b gy oa nx l ny nz">   }, 1000);<br/>}</span></pre><p id="8ce2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">计数器设置限制，但是如果之前达到100%的分数(意味着所有音符都被猜中)，则无论如何循环都会被中断，因为玩家赢得了这一轮。</p><p id="f89c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果发生这种情况，剩余时间将作为<code class="fe nn no np nq b">updatePlayerScore</code>中的<code class="fe nn no np nq b">remainingTime</code>来计算奖金。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0e2e" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">给出视觉反馈</h1><p id="e5b9" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">构建这个游戏给了我一个很容易玩的错误印象，但是在我周围的人身上做的第一次测试带来了真相:猜测音符极其困难！</p><p id="3ad7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了提高UX，我移除了速度条(用户最初也必须猜测速度)，增加了时间，降低了难度，最重要的是:专注于视觉反馈。</p><p id="8207" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一个函数通过调用其他三个函数来管理反馈:一个用于乐谱，一个用于相应的反馈，一个用于风格:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="dd3c" class="nv mr it nq b gy nw nx l ny nz">giveFeedbackToPlayer = () =&gt; { <br/>   currentScore = giveScore(partitionDJ, partitionUser); <br/>   const comment = generateComment(currentScore); <br/>   styleFeedback(currentScore); <br/>   feedbackZone.innerHTML = `${currentScore}% correct &lt;br&gt; ${comment}`; <br/>   return currentScore;<br/>}</span></pre><p id="cad5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">反馈功能，这里没有火箭科学，简单的<code class="fe nn no np nq b">if</code> / <code class="fe nn no np nq b">else</code>语句。样式功能的工作方式相同:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="bb72" class="nv mr it nq b gy nw nx l ny nz">// generating a comment depending on the current score<br/>generateComment = (score) =&gt; { <br/>   let comment = “”; <br/>   if (score &lt; 25) { <br/>      comment = “Not quite there”; <br/>   } else if (score &lt; 50) { <br/>      comment = “Keep trying, padawan”; <br/>   } else if (score &lt; 70) { <br/>      comment = “getting closer”; <br/>   } else if (score &lt; 85) { <br/>      comment = “Wow, nice!”; <br/>   } else if (score &lt; 100) { <br/>      comment = “Almost there!”; <br/>   } else { <br/>      comment = “Perfect! Bravo!”; <br/>   } return comment;<br/>}</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="2541" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">“防撞”系统:添加和移除按钮</h1><p id="6077" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">运行许多同步和异步循环的一个大危险是，它可能导致重叠声音的可怕噪音，并最终使浏览器崩溃。</p><p id="77d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了避免这种情况，我们将通过简单地删除不再需要的命令来防止用户多次启动同一个循环。</p><p id="b225" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是通过以下方式实现的:</p><ul class=""><li id="43e4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">有一个全局变量告诉我们音乐是否在播放。</li><li id="b403" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">具有拨动按钮的功能:按下<em class="ob">播放</em>变为<em class="ob">停止</em>，反之亦然。</li><li id="e3f8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">回合开始后,<em class="ob">开始回合</em>按钮变为<em class="ob">再次收听</em>。一旦按下，按钮会重新出现，延迟会阻止用户多次按下按钮。</li></ul><p id="c402" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当<code class="fe nn no np nq b">playMusic</code>被调用时，用<em class="ob">停止</em>按钮代替<em class="ob">播放</em>按钮；</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="d414" class="nv mr it nq b gy nw nx l ny nz">// plays the music and replaces by a stop button</span><span id="2f6a" class="nv mr it nq b gy oa nx l ny nz">playUserMusic = () =&gt; { <br/>   userMusicIsPlaying = true; <br/>   playMusic(soundsPlayer, partitionUser, timeoutTempo); <br/>   if (document.contains(document.getElementById(‘btn-play’))) {<br/>      removeButton(‘#btn-play’); <br/>      createStopButton(); <br/>   }<br/>}</span></pre><p id="e4df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户按下<em class="ob">停止</em>按钮，或者当不同的节拍将要重叠时，调用下面的<code class="fe nn no np nq b">stop</code>功能。去掉<em class="ob">停止</em>按钮，代之以<em class="ob">播放</em>；</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="f541" class="nv mr it nq b gy nw nx l ny nz">// stops the player music from playing, replaces by a play button</span><span id="9ce1" class="nv mr it nq b gy oa nx l ny nz">stopPlaying = () =&gt; { <br/>   clearInterval(musicPlaying); <br/>   userMusicIsPlaying = false; <br/>   if (document.contains(document.getElementById(‘btn-stop’))) {<br/>      removeButton(‘#btn-stop’); <br/>      createPlayButton(); <br/>   }<br/>}</span></pre><p id="07bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了遵循这一原则，开始每一轮的<em class="ob">开始</em>按钮在该轮开始时被移除，并在该轮结束时被添加:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="c787" class="nv mr it nq b gy nw nx l ny nz">createStartButton();<br/>removeStartButton();</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8965" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="99e1" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这是最重要的机制，使这个节拍制造商成为一个游戏:挑战玩家互动，计算分数，并执行游戏回合。</p><p id="06ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">欲了解更多信息:</p><ul class=""><li id="ddef" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://github.com/iourisorokine/The-Beat-Battle" rel="noopener ugc nofollow" target="_blank">代码</a></li><li id="5d69" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/better-programming/building-a-beatbox-game-in-javascript-bd9c2d06e1b2" rel="noopener">本系列第一部</a>。</li></ul></div></div>    
</body>
</html>