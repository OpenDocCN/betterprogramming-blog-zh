<html>
<head>
<title>My Ultimate Makefile for Golang Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的Golang项目最终Makefile</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/my-ultimate-makefile-for-golang-projects-fcc8ca20c9bb?source=collection_archive---------4-----------------------#2021-02-12">https://betterprogramming.pub/my-ultimate-makefile-for-golang-projects-fcc8ca20c9bb?source=collection_archive---------4-----------------------#2021-02-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4a70" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在一个地方使用您需要的所有工具，提高您的工作效率</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/79093b69429aa1f89a6192e08542421f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GkKAqLloIjQA6EGe"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Todd Quackenbush 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="b2c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我喜欢使用Go，因为它易于编码和构建。</p><p id="78e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是像所有其他编程语言一样，您必须处理大量的工具。为了方便使用这些工具，我把所有东西都放在makefile中，这样我就可以从一个地方<code class="fe lv lw lx ly b">build</code>、<code class="fe lv lw lx ly b">lint</code>和<code class="fe lv lw lx ly b">run</code>所有东西。</p><p id="95bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在构建了许多服务之后，我现在总是使用同一种makefile来帮助我正确地构建我的项目。在这篇文章中，我将分享我使用的目标以及它们为什么有用。</p><p id="b412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lz">注意:大部分目标使用Docker，如果要使用这个makefile，一定要有。</em></p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="9d1c" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">TL；速度三角形定位法(dead reckoning)</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/d16e4c9762a115e1f32a279b9a25e676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PNETwT5zf3d1RF4eE5PFiA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">可用目标</p></figure><p id="f0c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想马上看到代码，可以跳到本文的结尾或者这个要点。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="3a91" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">构建并测试代码</h1><p id="d549" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">处理代码和测试代码是开发人员日常工作的重要部分。</p><h2 id="19a1" class="nf mi it bd mj ng nh dn mn ni nj dp mr li nk nl mt lm nm nn mv lq no np mx nq bi translated">成为供应商</h2><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="d709" class="nf mi it ly b gy nv nw l nx ny"><strong class="ly iu">vendor</strong>:<br/>	$(GOCMD) mod vendor</span></pre><p id="2463" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的项目中，我使用<a class="ae ky" href="https://golang.org/ref/mod#go-mod-vendor" rel="noopener ugc nofollow" target="_blank"> go模块</a>作为我的依赖管理系统。这个目标只是调用系统下载依赖项，并将它们放在<code class="fe lv lw lx ly b">/vendor</code>目录中。</p><h2 id="6960" class="nf mi it bd mj ng nh dn mn ni nj dp mr li nk nl mt lm nm nn mv lq no np mx nq bi translated">创建版本</h2><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="c37f" class="nf mi it ly b gy nv nw l nx ny"><strong class="ly iu">build</strong>:<br/>	mkdir -p out/bin<br/>	GO111MODULE=on <strong class="ly iu">$(GOCMD) build -mod vendor -o</strong> out/bin/$(BINARY_NAME) .</span></pre><p id="6894" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">vendor</code>的是一个基本的<code class="fe lv lw lx ly b">go build</code> <strong class="lb iu"> </strong>任务。我们将二进制文件导出到<code class="fe lv lw lx ly b">out/bin</code> <strong class="lb iu"> </strong>目录中。</p><h2 id="01a1" class="nf mi it bd mj ng nh dn mn ni nj dp mr li nk nl mt lm nm nn mv lq no np mx nq bi translated">进行测试/进行报道</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="0452" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<code class="fe lv lw lx ly b">-race</code>选项运行测试，以检测我们是否有某种竞争条件。如果需要导出，结果将以<code class="fe lv lw lx ly b">junit</code> <strong class="lb iu"> </strong>格式导出。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="e1e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">覆盖是用<code class="fe lv lw lx ly b">go test</code>完成的，我们可以用不同的格式导出它(<code class="fe lv lw lx ly b">.cov</code>或<code class="fe lv lw lx ly b">.xml</code> ) <em class="lz">。</em></p><h2 id="5171" class="nf mi it bd mj ng nh dn mn ni nj dp mr li nk nl mt lm nm nn mv lq no np mx nq bi translated">制作手表</h2><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="9316" class="nf mi it ly b gy nv nw l nx ny"><strong class="ly iu">watch</strong>:<br/>	$(eval PACKAGE_NAME=$(shell head -n 1 go.mod | cut -d ' ' -f2))<br/>	<strong class="ly iu">docker run -it --rm -w /go/src/$(PACKAGE_NAME) -v $(shell pwd):/go/src/$(PACKAGE_NAME) -p $(SERVICE_PORT):$(SERVICE_PORT) cosmtrek/air</strong></span></pre><p id="c434" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该目标用于在开发时重新加载您的应用程序。它使用<a class="ae ky" href="https://github.com/cosmtrek/air" rel="noopener ugc nofollow" target="_blank"> cosmtrek/air </a> <strong class="lb iu"> </strong>在您的代码发生变化时立即刷新应用程序，这在您开发API时非常完美。</p><p id="1e76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lz">注意:不要忘记在</em> <code class="fe lv lw lx ly b"><em class="lz">SERVICE_PORT</em></code> <em class="lz">变量中指定正确的端口。</em></p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="c1f8" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">棉短绒</h1><p id="a976" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">如你所见，还有一堆linter目标。他们的所作所为显而易见:</p><ul class=""><li id="b9ed" class="ob oc it lb b lc ld lf lg li od lm oe lq of lu og oh oi oj bi translated"><code class="fe lv lw lx ly b">make lint-yaml</code>:在你项目的YAML文件中使用<a class="ae ky" href="https://yamllint.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> yamllint </a>(我相信你有很多这样的文件)。</li><li id="7f0a" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><code class="fe lv lw lx ly b">make lint-go</code>:在你的项目中使用<a class="ae ky" href="https://golangci-lint.run/" rel="noopener ugc nofollow" target="_blank"> golintci-lint </a>来lint你的Go代码。我推荐一个<code class="fe lv lw lx ly b">.golangci.yml</code>，上面有你的配置。</li><li id="4946" class="ob oc it lb b lc ok lf ol li om lm on lq oo lu og oh oi oj bi translated"><code class="fe lv lw lx ly b">make lint-dockerfile</code>:皮棉你的Dockerfile。</li></ul><p id="2bf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想用一个命令启动所有的linters，你可以运行<code class="fe lv lw lx ly b">make lint</code>。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="8324" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">码头工人</h1><pre class="kj kk kl km gt nr ly ns nt aw nu bi"><span id="7bcf" class="nf mi it ly b gy nv nw l nx ny"><strong class="ly iu">docker-build:</strong><br/><strong class="ly iu">	docker build --rm --tag $(BINARY_NAME) .</strong></span><span id="3fdd" class="nf mi it ly b gy op nw l nx ny"><br/><strong class="ly iu">docker-release:</strong><br/>	docker tag $(BINARY_NAME) $(DOCKER_REGISTRY)$(BINARY_NAME):latest<br/>	docker tag $(BINARY_NAME) $(DOCKER_REGISTRY)$(BINARY_NAME):$(VERSION)<br/>	# Push the docker images<br/>	docker push $(DOCKER_REGISTRY)$(BINARY_NAME):latest<br/>	docker push $(DOCKER_REGISTRY)$(BINARY_NAME):$(VERSION)</span></pre><p id="0671" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">docker-build</code>将在本地构建并标记您的Docker图像，<code class="fe lv lw lx ly b">docker-release</code>将把这个图像推送到您的注册表。如果你用的是Docker Hub，只要让变量<code class="fe lv lw lx ly b">DOCKER_REGISTRY</code>为空，就能完美工作。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="9005" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">完整的Makefile</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="22f5" class="nf mi it bd mj ng nh dn mn ni nj dp mr li nk nl mt lm nm nn mv lq no np mx nq bi translated">你想学更多的东西，想看我的未来故事？</h2><p id="6fc6" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated"><a class="ae ky" href="https://thomaspoignant.medium.com/subscribe" rel="noopener">订阅我的媒介账号</a>。</p></div></div>    
</body>
</html>