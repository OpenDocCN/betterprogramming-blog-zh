<html>
<head>
<title>React Context API + Hooks. Part 2 — UI Language Switch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React上下文API +钩子。第2部分—用户界面语言切换</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-context-hooks-part-2-ui-language-switch-f4610a21379b?source=collection_archive---------4-----------------------#2019-07-07">https://betterprogramming.pub/react-context-hooks-part-2-ui-language-switch-f4610a21379b?source=collection_archive---------4-----------------------#2019-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dcf8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用钩子和上下文改变用户界面语言</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d4ce6b69bff27e6cac46ff8003c7eb09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GishjVF51UabrkqY_yaZcA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">钩子+上下文</p></figure><p id="cbfa" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，我们将继续探索<a class="ae lr" href="http://reactjs.org" rel="noopener ugc nofollow" target="_blank"> React </a>上下文API的用法，以及如何向React应用程序添加多种UI语言。</p><p id="b400" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你读过我以前的文章，你就会熟悉上下文是如何工作的，以及我们为什么需要它。如果没有，读:<a class="ae lr" href="https://medium.com/better-programming/react-context-api-part-1-dark-theme-3f00666cbacb" rel="noopener"> React上下文API。第1部分—黑暗主题</a>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9b62" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">1.创建简单的应用程序</h1><p id="140b" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">首先创建一个简单的应用程序。这个应用程序将显示关于电影的信息。</p><p id="e692" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将模拟一个API获取请求，以保持应用程序的简单，并专注于功能实现。这一次，我们不关心CSS。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">fetchMock.js</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">App.js</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">LangSwitch.js</p></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Card.js</p></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="fc6d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">2.创建上下文文件</h1><p id="9934" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated">和上一篇文章一样，我们通过调用一个将对象作为参数的<code class="fe my mz na nb b">React.createContext</code>函数来初始化一个新上下文。</p><p id="0831" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该对象存储将由提供程序稍后更新的值。它可以是空的，但是出于测试和自动完成的目的，让键的值为空是一个好习惯。</p><pre class="kg kh ki kj gt nc nb nd ne aw nf bi"><span id="3bf0" class="ng ma iq nb b gy nh ni l nj nk">const LangContext = React.createContext({<br/>  lang: '', // for currently used language<br/>  currentLangData: '', // lang data (names, titles)<br/>  switchLang: () =&gt; {}, <br/>)};</span></pre><p id="3dba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe my mz na nb b">LangProvider</code>中，我们需要获取用户浏览器的当前语言，并将其保存在提供者的状态中。</p><p id="6d27" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果浏览器的语言与用户的偏好不同，我们会将最后选择的语言保存到本地存储中。我们将使用<code class="fe my mz na nb b">||</code>操作符使其优先于默认的浏览器语言，这样，在下一次页面加载时，应用程序将呈现正确的语言。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e5b4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用<code class="fe my mz na nb b">useLayoutEffect</code>钩子，因为应用程序需要知道在初始渲染之前显示哪种语言。<code class="fe my mz na nb b">useLayoutEffect</code>的第二个参数接受效果的一组依赖项。</p><p id="61c0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">稍后，单击一个按钮，我们将调用<code class="fe my mz na nb b">switchLang()</code>来更新状态(lang)。这给了<code class="fe my mz na nb b">useLayoutEffect</code>一个重新呈现应用程序的信号，将新的<code class="fe my mz na nb b">currentLang</code>数据传递给使用该数据的组件，并以当前语言呈现标题。</p><p id="9318" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了检索当前选择的语言的数据，我们在提供者的值对象中动态地设置它。我们还需要一个对象来存储不同语言的标题。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="3a57" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就是它看起来的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e229" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们重构<code class="fe my mz na nb b">Card.js</code>，通过订阅上下文变化并替换动态值的硬编码标题。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="a28b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe my mz na nb b">LangSwitch</code>中，我们将<code class="fe my mz na nb b">switchLang</code>函数从上下文传递给<code class="fe my mz na nb b">onClick</code>按钮处理程序。</p><p id="e5d1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还可以有条件地呈现按钮<code class="fe my mz na nb b">className</code>，这样我们就知道哪种语言当前是活动的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="3cf9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当用户更改UI语言时，我们希望根据选择的语言从API获取新数据。为此，我们将当前的<code class="fe my mz na nb b">lang</code>从上下文的状态传递给<code class="fe my mz na nb b">fetchMock</code>，作为<code class="fe my mz na nb b">App.js</code>中的一个属性。</p><p id="1387" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在实际的API请求中，我们会将它作为查询参数传递，或者向不同的端点发出请求，这取决于API架构。</p><p id="f2be" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，我们将<code class="fe my mz na nb b">lang</code>作为第二个属性传递给<code class="fe my mz na nb b">useEffect()</code>，因此它知道何时重新获取。然后，我们将<code class="fe my mz na nb b">h1</code>改为一个动态值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e984" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就是这样！我希望你喜欢它。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c25d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">证明文件</h1><p id="91c5" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le mt lg lh li mu lk ll lm mv lo lp lq ij bi translated"><a class="ae lr" href="https://uilangswitch.olegakan5326.now.sh" rel="noopener ugc nofollow" target="_blank">直播</a> | <a class="ae lr" href="https://github.com/aleckan53/react-context-part2" rel="noopener ugc nofollow" target="_blank">回购</a></p></div></div>    
</body>
</html>