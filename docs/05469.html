<html>
<head>
<title>Batch Address Geocoding Using React and the Google Geocoding API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React和Google地理编码API进行批量地址地理编码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/batch-address-geocoding-using-react-and-the-google-geocoding-api-bec9ef4444f2?source=collection_archive---------12-----------------------#2020-07-10">https://betterprogramming.pub/batch-address-geocoding-using-react-and-the-google-geocoding-api-bec9ef4444f2?source=collection_archive---------12-----------------------#2020-07-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b323" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">当您需要将文本地址转换为地理编码地址时</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0aa30b750ce531bade8d0e3c9fa9b5b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EW-twSXE8J6qKo8F0Z3A6A.jpeg"/></div></div></figure><p id="32d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lq">地理编码</em>是将地址(如街道地址)转换为地理坐标(如纬度和经度)的过程，您可以使用地理坐标在地图上放置标记或定位地图。这意味着我们需要一个像<code class="fe lr ls lt lu b">Anfield Rd, Anfield, Liverpool L4 0TH, United Kingdom</code>这样的完整地址来获得坐标<code class="fe lr ls lt lu b">-53.4318476,-2.9609068</code>。</p><p id="abfc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在下面看到这个项目的快照，或者试着在这里玩一下<a class="ae lv" href="https://sahero.github.io/batch-geocoding-using-react/" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/42a27c0df4718dbf1c03ed2a7d7aacd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xx26KbQPMDjOOgEFgRQWNQ.jpeg"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">用户界面</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/e1699fa2d0aee766417b480611a49fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*IwabZIsXTxO_nsi_DrUhWQ.jpeg"/></div><p class="lx ly gj gh gi lz ma bd b be z dk translated">代码结构</p></figure><p id="1521" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该地址可以从Excel或谷歌工作表中键入或复制粘贴。如果成功，它会自动填充纬度和经度值。如果不是，那么这个值将是<code class="fe lr ls lt lu b">Failed</code>。您也可以将数据下载到CSV文件中。如果您粘贴超过七行，它会自动添加额外的行。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="17c6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">开始之前</h1><p id="c996" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">我们将使用Google API键来获取坐标——即纬度和经度。如果你没有API密匙，你可以从<a class="ae lv" href="https://developers.google.com/maps/documentation/geocoding/get-api-key" rel="noopener ugc nofollow" target="_blank">这里</a>创建一个。</p><p id="3dc9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还将使用以下库:</p><ul class=""><li id="476b" class="ng nh it kw b kx ky la lb ld ni lh nj ll nk lp nl nm nn no bi translated"><code class="fe lr ls lt lu b"><a class="ae lv" href="https://github.com/nadbm/react-datasheet" rel="noopener ugc nofollow" target="_blank">react-datasheet</a></code>是一个简单的React组件，用于创建电子表格(这意味着它生成一个包含单元格的表格)</li><li id="4d5c" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><code class="fe lr ls lt lu b"><a class="ae lv" href="https://github.com/react-csv/react-csv" rel="noopener ugc nofollow" target="_blank">react-csv</a></code>是一个从给定数据生成CSV文件的组件。这些数据可以是数组的数组、文字对象的数组或字符串。</li><li id="fb0c" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><code class="fe lr ls lt lu b"><a class="ae lv" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank">axios</a></code>是一个简单易用的基于promise的HTTP客户端，用于浏览器和Node.js</li></ul></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="5e99" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">创建新的React应用程序</h1><p id="0e91" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">使用<a class="ae lv" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> Create React App </a>创建一个简单的<code class="fe lr ls lt lu b">React</code>应用程序。为此，您可以运行以下命令:</p><pre class="kj kk kl km gt nu lu nv nw aw nx bi"><span id="2e21" class="ny mk it lu b gy nz oa l ob oc">npx create-react-app react-geocoding<br/>cd react-geocoding<br/>npm start</span></pre></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="204f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">安装<code class="fe lr ls lt lu b">react-datasheet</code>、<code class="fe lr ls lt lu b">react-csv,</code>和<code class="fe lr ls lt lu b">axios</code></h1><p id="771e" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">使用以下命令，安装依赖项:</p><pre class="kj kk kl km gt nu lu nv nw aw nx bi"><span id="6c05" class="ny mk it lu b gy nz oa l ob oc">npm install --save react-datasheet react-csv axios</span></pre></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="17be" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">开始编码</h1><p id="748b" class="pw-post-body-paragraph ku kv it kw b kx nb ju kz la nc jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated"><a class="ae lv" href="https://developers.google.com/maps/api-key-best-practices" rel="noopener ugc nofollow" target="_blank">因为Google API密匙是凭证，我们需要保护它们</a>。有许多方法可以保护API密钥，但是在本教程中，我们不会将它们存储在任何地方。相反，我们将要求用户输入一个键。</p><p id="baa3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们创建一个<code class="fe lr ls lt lu b">Service</code>，它将API键和地址作为输入，并将返回来自<a class="ae lv" href="https://developers.google.com/maps/documentation/geocoding/start" rel="noopener ugc nofollow" target="_blank">谷歌地理编码API </a>的响应。以下示例请求<code class="fe lr ls lt lu b">Anfield Rd, Anfield, Liverpool L4 0TH, United Kingdom</code>的纬度和经度，并指定输出必须为<code class="fe lr ls lt lu b">JSON</code>格式。</p><pre class="kj kk kl km gt nu lu nv nw aw nx bi"><span id="1065" class="ny mk it lu b gy nz oa l ob oc"><a class="ae lv" href="https://maps.googleapis.com/maps/api/geocode/json?address=Anfield%20Rd,%20Anfield,%20Liverpool%20L4%200TH,%20United%20Kingdom&amp;key=YOUR_API_KEY" rel="noopener ugc nofollow" target="_blank">https://maps.googleapis.com/maps/api/geocode/json?address=Anfield%20Rd,%20Anfield,%20Liverpool%20L4%200TH,%20United%20Kingdom&amp;key=YOUR_API_KEY</a></span></pre><p id="8d35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以通过在您的web浏览器中输入URL并确保用您自己的API键替换<code class="fe lr ls lt lu b">YOUR_API_KEY</code>来测试这一点。响应包括地址的纬度和经度。下面是您在JSON中得到的响应:</p><pre class="kj kk kl km gt nu lu nv nw aw nx bi"><span id="d09b" class="ny mk it lu b gy nz oa l ob oc">{<br/>   "results" : [<br/>      {<br/>         "address_components" : [<br/>            ...<br/>         ],<br/>         "formatted_address" : "Anfield Rd, Liverpool L4 0TH, UK",<br/>         "geometry" : {</span><span id="feef" class="ny mk it lu b gy od oa l ob oc">...</span><span id="a522" class="ny mk it lu b gy od oa l ob oc">"location" : {<br/>               "lat" : 53.4318476,<br/>               "lng" : -2.9609068<br/>            },<br/>            ...<br/>         },<br/>        ...<br/>      }<br/>   ],<br/>   "status" : "OK"<br/>}</span></pre><p id="5d65" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lr ls lt lu b">geometry</code>的<code class="fe lr ls lt lu b">location</code>里面有<code class="fe lr ls lt lu b">lat</code>和<code class="fe lr ls lt lu b">lng</code>。所以如果成功的话,<code class="fe lr ls lt lu b">Service.js</code>会返回完全相同的东西，或者它会返回<code class="fe lr ls lt lu b">Failed</code>。</p><p id="73c0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们需要呈现用户只能输入地址的表单。我们需要的列非常简单。</p><pre class="kj kk kl km gt nu lu nv nw aw nx bi"><span id="ccf0" class="ny mk it lu b gy nz oa l ob oc">const columns = [<br/>  { label: 'S.No.', width: '3%' },<br/>  { label: 'Address', width: '40%' },<br/>  { label: 'Latitude', width: '25%' },<br/>  { label: 'Longitude', width: '25%' }<br/>];</span></pre><p id="7b4c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将渲染七个空行，这样我们就可以看到网格视图。每个网格的值是<code class="fe lr ls lt lu b">[{ value: ""}, { value: ""}, { value: ""}]</code>。这是因为列<code class="fe lr ls lt lu b">S.No.</code>是一个序列号，并且会随着行的扩展而自动递增。</p><pre class="kj kk kl km gt nu lu nv nw aw nx bi"><span id="8a57" class="ny mk it lu b gy nz oa l ob oc">&lt;ReactDataSheet<br/>  data={grid}<br/>  className="custom-sheet"<br/>  sheetRenderer={props =&gt; (<br/>     &lt;SheetRenderer columns={columns} {...props} /&gt;<br/>  )}<br/>  rowRenderer={props =&gt; (<br/>     &lt;RowRenderer className="data-row" {...props} /&gt;<br/>  )}<br/>  cellRenderer={props =&gt; (<br/>     &lt;CellRenderer columns={columns} {...props} /&gt;<br/>  )}<br/>  onCellsChanged={handleCellsChanged}<br/>  valueRenderer={cell =&gt; cell.value}<br/>/&gt;</span></pre><p id="8d79" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码片段将呈现数据表。<code class="fe lr ls lt lu b">grid</code>包含七行的空值。如果您想添加自定义渲染器，这取决于您。我添加它是为了修改每一列的宽度。</p><ul class=""><li id="b0cf" class="ng nh it kw b kx ky la lb ld ni lh nj ll nk lp nl nm nn no bi translated"><code class="fe lr ls lt lu b">sheetRenderer</code>是一个可选的函数或React组件，用于呈现主工作表元素。默认呈现一个<code class="fe lr ls lt lu b">table </code>元素。</li><li id="e664" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><code class="fe lr ls lt lu b">rowRenderer</code>是一个可选的函数或React组件，用于呈现每个行元素。默认呈现一个<code class="fe lr ls lt lu b">tr</code>元素。</li><li id="c81d" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><code class="fe lr ls lt lu b">cellRenderer</code>是一个可选的函数或React组件来渲染每个单元格元素。默认呈现一个<code class="fe lr ls lt lu b">td</code>元素。关于自定义渲染器的更多信息可以在这里找到<a class="ae lv" href="https://github.com/nadbm/react-datasheet#custom-renderers-1" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="264d" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><code class="fe lr ls lt lu b">valueRenderer</code>是一种呈现单元格值的方法</li><li id="e4b9" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><code class="fe lr ls lt lu b">onCellsChanged</code>是一个回调函数，每当网格中的数据发生变化时就会被调用:(1)当用户在单元格中输入新值时，(2)当用户在一个或多个选定的单元格中按下delete键时，(3)当用户将表格数据粘贴到表格中时</li></ul><p id="8541" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们必须呈现一个按钮，以CSV格式从工作表中下载数据。这很简单:</p><pre class="kj kk kl km gt nu lu nv nw aw nx bi"><span id="04f2" class="ny mk it lu b gy nz oa l ob oc">&lt;div className="d-flex flex-row justify-content-end mt-3"&gt;<br/>  &lt;button className="btn btn-success btn-sm" onClick={downloadCSV}&gt;<br/> Download CSV<br/>  &lt;/button&gt;<br/>&lt;/div&gt;</span></pre><p id="acda" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lr ls lt lu b">downloadCSV</code>将使用<code class="fe lr ls lt lu b">react-csv</code>库中的<code class="fe lr ls lt lu b">CSVLink</code>组件，并触发CSV文件的下载动作。</p><p id="fb85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe lr ls lt lu b">App.js</code>文件中组合以上所有片段将产生以下事件链:用户输入地址后，我们调用<code class="fe lr ls lt lu b">Service</code>组件从Google Geocoding API获取JSON格式的坐标。然后，我们填充纬度和经度列。</p><p id="dade" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在GitHub上找到完整的项目。请随时修改或建议修改。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="7d31" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">参考</h1><ul class=""><li id="c61c" class="ng nh it kw b kx nb la nc ld og lh oh ll oi lp nl nm nn no bi translated"><a class="ae lv" href="https://github.com/nadbm/react-datasheet" rel="noopener ugc nofollow" target="_blank">GitHub上的React-数据表</a></li><li id="4665" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><a class="ae lv" href="https://github.com/react-csv/react-csv" rel="noopener ugc nofollow" target="_blank">GitHub上的react-CSV</a></li><li id="e807" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><a class="ae lv" href="https://developers.google.com/maps/documentation/geocoding/start" rel="noopener ugc nofollow" target="_blank">地理编码API文档</a></li></ul></div></div>    
</body>
</html>