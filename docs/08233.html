<html>
<head>
<title>Build Your Slack App Home in Golang Using Socket Mode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用套接字模式在Golang中构建您的Slack应用程序主页</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-slack-app-home-in-golang-using-socket-mode-aff7b855bb31?source=collection_archive---------6-----------------------#2021-04-08">https://betterprogramming.pub/build-a-slack-app-home-in-golang-using-socket-mode-aff7b855bb31?source=collection_archive---------6-----------------------#2021-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="a9d4" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">GOLANG SLACKBOT教程</h2><div class=""/><div class=""><h2 id="3d91" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">为您的应用构建一个家——在Go中重温</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/65fa42461711d3a03474bd675578d1f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NQ-IvvHA4NPlKbgzLkEP_g.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@olianayda?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Olia Nayda </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片，<a class="ae lh" href="https://github.com/egonelbre" rel="noopener ugc nofollow" target="_blank"> Egon Elbre </a>的Gopher。</p></figure><p id="759d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本教程是关于用<a class="ae lh" href="https://github.com/slack-go/slack" rel="noopener ugc nofollow" target="_blank"> slack-go </a>库和<a class="ae lh" href="https://api.slack.com/apis/connections/socket" rel="noopener ugc nofollow" target="_blank"> Slack的Socket模式</a>在Golang中实现一个<a class="ae lh" href="https://api.slack.com/start/overview#app_home" rel="noopener ugc nofollow" target="_blank"> App Home </a>。本指南的灵感来自于Slack文档中的一篇文章。</p><p id="c86b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">应用程序主页是显示在对话列表中应用程序部分下方的空间，带有您的应用程序名称。这是一个完全可定制的空间，用于提供文档和与应用程序的交互。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/9f9be34d9faa47f9abf2735c314970e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g_asIzkKvri6V-Vf.png"/></div></div><p class="ld le gj gh gi lf lg bd b be z dk translated">作者照片。</p></figure><p id="6d0e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">“为什么是套接字模式？”你可能会问。</p><p id="8c23" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用套接字模式，您不需要一个具有公开可用IP地址的服务器。换句话说，你的笔记本电脑，你的Raspberry Pi，或者一个私人服务器都可以托管你的机器人。套接字模式非常适合您不打算通过<a class="ae lh" href="https://slack.com/apps" rel="noopener ugc nofollow" target="_blank">应用程序目录</a>发布的小型应用程序。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="4790" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">配置应用程序</h1><p id="010c" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">要开始本教程，您需要一个Slack应用程序，并激活适当的权限和套接字模式。您可以参考<a class="ae lh" href="https://api.slack.com/tutorials/app-home-with-modal#building-a-home-for-your-app---learn-how-to-create-the-app-home-view-and-use-the-modals__setting-up-your-app" rel="noopener ugc nofollow" target="_blank">本文档</a>来创建您的应用程序并添加权限。我还写了一篇专门的文章来简化设置步骤:</p><div class="nj nk gp gr nl nm"><a href="https://medium.com/geekculture/build-slack-application-in-golang-using-socket-mode-setting-up-57f454e63c0a" rel="noopener follow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jd gy z fp nr fr fs ns fu fw jc bi translated">使用套接字模式在Golang中构建松弛应用程序—设置</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">每个Slack应用程序都是从几个简单的步骤开始的。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">medium.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa lb nm"/></div></div></a></div><p id="3c72" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不要忘记在适当的部分激活套接字模式。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/e9bca32201e4c7c933c8cedabbbf093f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vCTlkoCx8kQ2jHPo.png"/></div></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="3024" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">步骤1:创建项目存储库</h1><p id="d6ad" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">首先，创建一个新的Go项目并导入<a class="ae lh" href="https://github.com/slack-go/slack" rel="noopener ugc nofollow" target="_blank"> slack-go </a>:</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="1d30" class="oh mn it od b gy oi oj l ok ol">go mod init <br/>go get -u github.com/slack-go/slack</span></pre><p id="9561" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本教程中，我使用我的slack-go分支，因为我用来处理事件的主要特性还没有合并(<a class="ae lh" href="https://github.com/slack-go/slack/pull/904" rel="noopener ugc nofollow" target="_blank"> #PR904 </a>)。</p><p id="6321" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要使用fork，我们需要在<code class="fe om on oo od b">go.mod</code>中添加一个<code class="fe om on oo od b">replace</code>语句:</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="6bb5" class="oh mn it od b gy oi oj l ok ol">replace github.com/slack-go/slack =&gt; github.com/xnok/slack master</span></pre><p id="9145" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们强制考虑这种变化:</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="7b5c" class="oh mn it od b gy oi oj l ok ol">go mod tidy</span></pre><p id="00e8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，您可以创建以下项目结构，或者在我们继续学习本教程时参考它:</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="6f01" class="oh mn it od b gy oi oj l ok ol">+ controllers<br/>|`- appHomeController.go<br/>+ drivers<br/>|`- slack.go<br/>+ views<br/>|`+ appHomeViewsAssets<br/>| |`- AppHomeView.json<br/>| | - CreateStickieNoteModal.json<br/>| | - NoteBlock.json<br/>|`- apphomeViews.go<br/>+ main.go</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="fe75" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">步骤2:创建驱动因素-&gt; slack.go</h1><p id="817c" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">在<code class="fe om on oo od b">drivers/slack.go</code>中，我们使用环境变量<code class="fe om on oo od b">SLACK_APP_TOKEN</code>和<code class="fe om on oo od b">SLACK_BOT_TOKEN</code>创建了一个实用函数来初始化我们的Slack客户端。此外，添加一些验证也是一个好主意。Slack提供了两种类型的令牌:</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="526d" class="oh mn it od b gy oi oj l ok ol">SLACK_APP_TOKEN=xapp-xxxxxxxxx <br/>SLACK_BOT_TOKEN=xoxb-xxxxxxxxx</span></pre><p id="07cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我验证令牌是否存在以及令牌的开头，以防止错误地反转。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="3e16" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">完整代码见<a class="ae lh" href="https://github.com/xNok/slack-go-demo-socketmode/blob/main/drivers/slack.go" rel="noopener ugc nofollow" target="_blank"> slack.go </a>。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="42c5" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">步骤3:创建控制器-&gt; appHomeController.go</h1><p id="963c" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">我创建了一个<a class="ae lh" href="https://github.com/xNok/slack-go-demo-socketmode/blob/main/controllers/appHomeController.puml" rel="noopener ugc nofollow" target="_blank">序列图</a>(灵感来自<a class="ae lh" href="https://api.slack.com/tutorials/app-home-with-modal#building-a-home-for-your-app---learn-how-to-create-the-app-home-view-and-use-the-modals__setting-up-your-app" rel="noopener ugc nofollow" target="_blank">朋美·井村的</a>)来表示我们将要进行的可视化编码。我相信将这样的图放在我的代码旁边是很方便的。这应该会使遵循本教程变得容易得多。此外，我在代码中添加了对图的引用作为注释。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi or"><img src="../Images/0525a1e2b79e9b8dfaffa06118ffa376.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*tPMZ5w069KRrGhS79SkDaA.png"/></div><p class="ld le gj gh gi lf lg bd b be z dk translated">使用<a class="ae lh" href="https://plantuml.com/" rel="noopener ugc nofollow" target="_blank"> PlantUML </a>创建。</p></figure><h2 id="87d3" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">处理事件</h2><p id="f67f" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">首先，在<code class="fe om on oo od b">controllers/appHomeController.go</code>中，创建一个代表我们的控制器的结构来处理依赖注入。到目前为止，我们只需要<code class="fe om on oo od b">socketmode.SocketmodeHandler</code>来注册我们想要处理的Slack事件。但是在更广泛的应用程序中，您可能有其他依赖项，比如处理数据库请求的存储库。</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="fec8" class="oh mn it od b gy oi oj l ok ol">type AppHomeController struct { <br/>  EventHandler *socketmode.SocketmodeHandler <br/>}</span></pre><p id="0f57" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其次，为我们的控制器创建一个初始化函数。这个函数负责注册我们想要接收哪个事件，以及哪个函数应该处理它。如果参考<a class="ae lh" href="https://github.com/xNok/slack-go-demo-socketmode/blob/main/controllers/appHomeController.puml" rel="noopener ugc nofollow" target="_blank">序列图</a>，该控制器需要监听三个事件:</p><ul class=""><li id="0d5c" class="pc pd it lk b ll lm lo lp lr pe lv pf lz pg md ph pi pj pk bi translated">一个名为<code class="fe om on oo od b">app_home_opened</code> (2)的事件API。</li><li id="f96e" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated">带有创建按钮(12)的<code class="fe om on oo od b">interaction</code>。</li><li id="b2bb" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated">带有模态提交按钮(22)的<code class="fe om on oo od b">interaction</code>。</li></ul><p id="d207" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要用<code class="fe om on oo od b">EventHandler</code>注册一个事件，您首先需要确定我们需要处理什么类型的事件。至此，你应该熟悉了Slack的术语，包括<em class="pq">事件API </em>、<em class="pq">交互</em>、<em class="pq">阻塞动作</em>。</p><p id="03a2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些处理函数的工作方式都是一样的。您提供了您期望的事件类型(使用自动完成功能找到您需要的类型)和一个回调函数。回调函数需要:</p><ol class=""><li id="a357" class="pc pd it lk b ll lm lo lp lr pe lv pf lz pg md pr pi pj pk bi translated">指向事件的指针(<code class="fe om on oo od b">*socketmode.Event</code>)。</li><li id="326b" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md pr pi pj pk bi translated">指向套接字模式客户端的指针(<code class="fe om on oo od b">*socketmode.Client</code>)。</li></ol><p id="0e24" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，这是一个有效的函数:</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="ca85" class="oh mn it od b gy oi oj l ok ol">func callback(evt *socketmode.Event, clt *socketmode.Client) {}</span></pre><p id="f1d1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">更好的选择是使用属于<code class="fe om on oo od b">AppHomeController</code>的<code class="fe om on oo od b">method</code>。这样，我们可以从<code class="fe om on oo od b">AppHomeController</code>中注入的依赖关系中获益:</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="181a" class="oh mn it od b gy oi oj l ok ol">func (c *AppHomeController) callback(evt *socketmode.Event, clt *socketmode.Client) {}</span></pre><p id="8e97" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了结束这一节，下面是我的初始化构造函数:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="ddfc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此时，我们的控制器已经准备好了。我们只需要实现三个事件处理方法中的每一个:</p><ul class=""><li id="e3f7" class="pc pd it lk b ll lm lo lp lr pe lv pf lz pg md ph pi pj pk bi translated"><code class="fe om on oo od b">publishHomeTabView</code></li><li id="08a3" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated"><code class="fe om on oo od b">openCreateStickieNoteModal</code></li><li id="b75e" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated"><code class="fe om on oo od b">createStickieNote</code></li></ul><h2 id="2223" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">实现publishHomeTabView</h2><p id="02b3" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">此功能的目标是显示应用程序主页选项卡:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ps"><img src="../Images/d80da3ddcd60baad2c1ff1483b53c162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WIRXo7rBXr_iJ1tv.png"/></div></div></figure><p id="16c4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们所有的处理程序都有大致相同的结构:</p><ol class=""><li id="eedd" class="pc pd it lk b ll lm lo lp lr pe lv pf lz pg md pr pi pj pk bi translated">将<code class="fe om on oo od b">socketmode.Event</code>转换成所需的类型。<code class="fe om on oo od b">socketmode.Event</code>是所有事件的通用结构，但是我们在注册这个处理程序时指定了我们期望的事件类型。因此，允许转换该结构。</li><li id="43fb" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md pr pi pj pk bi translated">创建视图。我们还没有实现任何视图，所以现在创建占位符函数。我更喜欢在最后一节介绍如何创建视图。</li><li id="c78f" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md pr pi pj pk bi translated">将视图发送到时差。</li></ol><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><h2 id="8d7d" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">实现openCreateStickieNoteModal</h2><p id="7f96" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">每当用户点击<code class="fe om on oo od b">Add a Stickie</code>时，该方法打开一个模态。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pt"><img src="../Images/6d83ba73ab3f1a9b4455309c69554121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R-Yj-68k28jEWMl_.gif"/></div></div></figure><p id="7ef6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这与<code class="fe om on oo od b">publishHomeTabView</code>的结构相同，除了我们必须确认<strong class="lk jd"> </strong>我们收到了事件。否则，我们的用户将会看到一个错误符号。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><h2 id="0212" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">实现createStickieNote</h2><p id="8838" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">最后一部分是当用户通过模式提交信息时更新应用程序主页。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pt"><img src="../Images/0e2330c8377b1c0ff17b775e972bc34d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LSXp6WfpNrDZaimX.gif"/></div></div></figure><p id="677f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">同样的结构。我们<code class="fe om on oo od b">acknowledge</code>这个事件是因为它是一个交互。我发现提取值来创建便笺有点棘手。</p><p id="0e9c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Slack在UI中需要一个惟一的ID来标识块和动作。为了最小化任何错误，我创建了常数:</p><ul class=""><li id="34cb" class="pc pd it lk b ll lm lo lp lr pe lv pf lz pg md ph pi pj pk bi translated"><code class="fe om on oo od b">views.ModalDescriptionBlockID</code></li><li id="9bf9" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated"><code class="fe om on oo od b">views.ModalDescriptionActionID</code></li><li id="0ad1" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated"><code class="fe om on oo od b">views.ModalColorBlockID</code></li><li id="d8fb" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated"><code class="fe om on oo od b">views.ModalColorActionID</code></li></ul><p id="915a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些常量在<code class="fe om on oo od b">views/appHomeViews.go</code>中定义。我们将在下一节再次讨论它们。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="b1e8" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">步骤4:视图&gt; appHomeViews.go</h1><p id="260c" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">对于所有视图，我们将充分利用<a class="ae lh" href="https://api.slack.com/block-kit" rel="noopener ugc nofollow" target="_blank"> Slack的块套件</a>的全部功能。因此，我们通过将Block Kit提供的<code class="fe om on oo od b">json payload</code>存储到文件中来创建视图。然后我们可以在需要的时候加载它们。为此，我决定使用最新的Golang 1.16特性来帮助管理静态资产:<code class="fe om on oo od b"><a class="ae lh" href="https://github.com/akmittal/go-embed" rel="noopener ugc nofollow" target="_blank">embed</a></code>。</p><p id="3f82" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这样，我们就像管理一个简单的web MVC应用程序一样管理我们的slack应用程序，视图被存储为静态资产。使用块套件和复制粘贴的结果，使我们的应用程序更新更容易。</p><p id="3b81" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="pq">注:我在另一篇文章</em>  <em class="pq">中详细介绍了这个过程。</em></p><p id="abba" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是<code class="fe om on oo od b">views/appHomeViews.go</code>的基本结构:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="a3ff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以看到与块ID和动作ID相关的常量的定义，表示粘性的对象，以及使用<code class="fe om on oo od b">“embed”</code>来管理我们的资产。</p><h2 id="d3cd" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">发布应用程序主页视图</h2><p id="9578" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">将<a class="ae lh" href="https://app.slack.com/block-kit-builder/T0B5XJYR2#%7B%22type%22:%22home%22,%22blocks%22:%5B%7B%22type%22:%22section%22,%22text%22:%7B%22type%22:%22mrkdwn%22,%22text%22:%22*Welcome!*%20%5CnThis%20is%20a%20home%20for%20Stickers%20app.%20You%20can%20add%20small%20notes%20here!%22%7D,%22accessory%22:%7B%22type%22:%22button%22,%22action_id%22:%22add_note%22,%22text%22:%7B%22type%22:%22plain_text%22,%22text%22:%22Add%20a%20Stickie%22%7D%7D%7D,%7B%22type%22:%22divider%22%7D%5D%7D" rel="noopener ugc nofollow" target="_blank">滑车套件</a>有效载荷保存在<code class="fe om on oo od b">views/appHomeViewsAssets/AppHomeView.json</code>中。</p><p id="de1e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后创建一个读取<code class="fe om on oo od b">AppHomeView.json</code>并解组到<code class="fe om on oo od b">slack.HomeTabViewRequest</code>的函数，这样我们就可以通过Slack API发送它。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><h2 id="ce83" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">打开模式对话框</h2><p id="76ed" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">将模态<a class="ae lh" href="https://app.slack.com/block-kit-builder/T0B5XJYR2#%7B%22title%22:%7B%22type%22:%22plain_text%22,%22text%22:%22Create%20a%20stickie%20note%22,%22emoji%22:true%7D,%22submit%22:%7B%22type%22:%22plain_text%22,%22text%22:%22Create%22,%22emoji%22:true%7D,%22type%22:%22modal%22,%22blocks%22:%5B%7B%22type%22:%22input%22,%22block_id%22:%22note01%22,%22element%22:%7B%22type%22:%22plain_text_input%22,%22placeholder%22:%7B%22type%22:%22plain_text%22,%22text%22:%22Take%20a%20note...%20%22%7D,%22multiline%22:true%7D,%22label%22:%7B%22type%22:%22plain_text%22,%22text%22:%22Note%22%7D%7D,%7B%22type%22:%22input%22,%22element%22:%7B%22type%22:%22static_select%22,%22action_id%22:%22color%22,%22options%22:%5B%7B%22text%22:%7B%22type%22:%22plain_text%22,%22text%22:%22yellow%22%7D,%22value%22:%22yellow%22%7D,%7B%22text%22:%7B%22type%22:%22plain_text%22,%22text%22:%22blue%22%7D,%22value%22:%22blue%22%7D%5D%7D,%22label%22:%7B%22type%22:%22plain_text%22,%22text%22:%22Color%22%7D%7D%5D%7D" rel="noopener ugc nofollow" target="_blank">模块套件</a>有效载荷保存到<code class="fe om on oo od b">views/appHomeViewsAssets/CreateStickieNoteModal.json</code>中。你必须小心那些<code class="fe om on oo od b">action_id</code> <strong class="lk jd"> </strong>和<code class="fe om on oo od b">block_id</code>。它们必须与常量中定义的相匹配。</p><p id="e8cd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，创建一个读取<code class="fe om on oo od b">CreateStickieNoteModal.json</code>并解组到<code class="fe om on oo od b">slack.ModalViewRequest</code>的函数，这样我们就可以通过Slack API发送它。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure><h2 id="83dc" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">更新应用程序主视图</h2><p id="a3a9" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">将便笺<a class="ae lh" href="https://app.slack.com/block-kit-builder/T0B5XJYR2#%7B%22type%22:%22home%22,%22blocks%22:%5B%7B%22type%22:%22context%22,%22elements%22:%5B%7B%22type%22:%22mrkdwn%22,%22text%22:%222021-04-05%2017:57:07%20-0400%20EDT%22%7D%5D%7D,%7B%22type%22:%22section%22,%22text%22:%7B%22type%22:%22mrkdwn%22,%22text%22:%22Test%22%7D,%22accessory%22:%7B%22type%22:%22image%22,%22image_url%22:%22https://cdn.glitch.com/0d5619da-dfb3-451b-9255-5560cd0da50b%252Fstickie_yellow.png%22,%22alt_text%22:%22Test%20stickie%20note%22%7D%7D,%7B%22type%22:%22divider%22%7D%5D%7D" rel="noopener ugc nofollow" target="_blank">块套件</a>有效载荷保存为<code class="fe om on oo od b">views/appHomeViewsAssets/NoteBlock.json</code>。</p><p id="282d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个视图稍微复杂一些，因为它是动态生成的。</p><p id="4e87" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，这个视图是由<code class="fe om on oo od b">views/appHomeViewsAssets/CreateStickieNoteModal.json</code>和<code class="fe om on oo od b">views/appHomeViewsAssets/NoteBlock.json</code>组合而成的。</p><p id="ef72" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其次，我们收集了模态信息，并将其存储在一个名为<code class="fe om on oo od b">views.StickieNote</code>的结构中。我们希望这些信息出现在我们的帖子上。因此，我们为此使用了<a class="ae lh" href="https://golang.org/pkg/text/template/" rel="noopener ugc nofollow" target="_blank"> Go模板</a>。占位符<code class="fe om on oo od b">{{ .Timestamp }}</code>、<code class="fe om on oo od b">{{ .Description }}</code>和<code class="fe om on oo od b">{{ .Color }}</code>被添加到<code class="fe om on oo od b">NoteBlock.json</code>中内容应该是动态的地方。</p><p id="2891" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面的函数生成我们的最终视图。如果需要更详细的解释，可以阅读<a class="ae lh" href="https://couedeloalexandre.medium.com/manage-static-assets-with-embed-golang-1-16-75c89c3eea39" rel="noopener">的专用文章</a>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="op oq l"/></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="c2cd" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">后续步骤</h1><h2 id="75f6" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">尝试应用程序</h2><p id="c5c8" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">成功完成教程后，您可以运行您的应用程序:</p><pre class="ks kt ku kv gt oc od oe of aw og bi"><span id="03e6" class="oh mn it od b gy oi oj l ok ol">go run ./main.go</span></pre><p id="6de7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">也可以直接克隆<a class="ae lh" href="https://github.com/xNok/slack-go-demo-socketmode" rel="noopener ugc nofollow" target="_blank">我的库</a>提前试一试。</p><h2 id="db84" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">能改善吗？</h2><p id="e52c" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">我在这里只讨论了基本原理，所以还可以做更多的事情。例如，你可能已经注意到你一遍又一遍地覆盖同一个便笺条。不理想吧？</p><h2 id="41e7" class="oh mn it bd mo os ot dn ms ou ov dp mw lr ow ox my lv oy oz na lz pa pb nc iz bi translated">了解Slack应用程序的其他用法</h2><ul class=""><li id="8a96" class="pc pd it lk b ll ne lo nf lr pu lv pv lz pw md ph pi pj pk bi translated"><a class="ae lh" href="https://medium.com/geekculture/build-slack-application-in-golang-using-socket-mode-setting-up-57f454e63c0a?sk=03196a8c492a76cd7ef9a73628fe4524" rel="noopener">每个Slack应用程序都从几个简单的步骤开始</a></li><li id="3b71" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated"><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/build-a-slack-app-home-in-golang-using-socket-mode-aff7b855bb31?sk=b8b1f7f3c03972793b26bec02dc3d2cc">使用套接字模式在Golang中构建您的Slack应用程序主页</a></li><li id="1913" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated"><a class="ae lh" href="https://levelup.gitconnected.com/properly-welcome-users-in-slack-with-golang-using-socket-mode-9a206d30a34a?sk=24fb8c44c1128cc3ef366d51d4a48812" rel="noopener ugc nofollow" target="_blank">使用Socket模式适当欢迎Slack中的用户使用Golang</a></li><li id="b24b" class="pc pd it lk b ll pl lo pm lr pn lv po lz pp md ph pi pj pk bi translated"><a class="ae lh" href="https://levelup.gitconnected.com/implement-slack-slash-command-in-golang-using-socket-mode-ac693e38148c?sk=33e90a65aded42cd4737ff6a137762cc" rel="noopener ugc nofollow" target="_blank">用Golang使用套接字模式执行松弛斜线命令</a></li></ul></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="14b0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你想在媒体上无限制地访问我和许多其他作者的内容吗？今天就考虑用我的会员链接 <a class="ae lh" href="https://alexandre-couedelo.medium.com/membership" rel="noopener"> <em class="pq">成为中等会员</em> </a> <em class="pq">！也可以在</em><a class="ae lh" href="https://twitter.com/AlexCouedelo" rel="noopener ugc nofollow" target="_blank"><em class="pq">Twitter</em></a><em class="pq">和</em><a class="ae lh" href="https://www.linkedin.com/comm/mynetwork/discovery-see-all?usecase=PEOPLE_FOLLOWS&amp;followMember=alexandre-couedelo" rel="noopener ugc nofollow" target="_blank"><em class="pq">Linkedin</em></a><em class="pq">上关注我。</em></p></div></div>    
</body>
</html>