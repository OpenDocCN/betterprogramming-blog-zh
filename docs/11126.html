<html>
<head>
<title>Escape From the Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">逃离框架</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/escape-from-the-framework-42e4cb13e4c6?source=collection_archive---------6-----------------------#2022-02-20">https://betterprogramming.pub/escape-from-the-framework-42e4cb13e4c6?source=collection_archive---------6-----------------------#2022-02-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b4e9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">或者如罗伯特·马丁所说:“不要和框架结婚”</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/eeb92eddb144bffc00fa2dc78417389a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AR53p6p4DQVyRMWK"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@pixelsucker?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> geraldo stanislas </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="e86e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">曾几何时，我曾经学习框架，并将所学直接应用于项目，无需过多解释。</p><p id="2494" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然它挽救了这一天，但从长远来看，它对可维护性、可测试性、可读性、枯燥的原则和任何东西都没有任何好处。我想知道为什么用可重用的业务逻辑组件编写web应用程序如此困难。</p><p id="b2fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在ASP.NET MVC上进行数据库操作的典型教程代码如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">教程教你的方式是最基本的，非抽象的编码方式。您可以直接从表示层(本例中是控制器层)访问数据库。</p></figure><p id="4133" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我开始像教程认为的那样编码。我估计这是大部分新人程序员长期以来的做法。对于一些简单的应用程序和学习新的框架来说，使用这种方法是可以的，但是总有一天，当你一次又一次地面对同样的问题时，你会感到有挑战性。代码变得杂乱，业务逻辑被复制在许多文件周围，与框架(<code class="fe lu lv lw lx b">ModelState</code>、<code class="fe lu lv lw lx b">ViewBag</code>、Http查询字符串等)完全耦合。).</p><p id="e733" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的核心业务逻辑不应该是HTTP请求、查询字符串和其他web噱头。它应该完全是关于业务需求的。核心业务模块不应该关心数据如何输入或结果如何输出。它可以来自一个web表单、一个查询字符串、一个windows表单、一个web服务、一个控制台应用程序，或者一个VR界面，如果你喜欢冒险的话。所有这些问题的解决方案是将业务逻辑从周围的框架中分离出来。</p><h1 id="2387" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">分离业务逻辑</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/8847e0c46fb73b3eed84f80e28a66ffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zyVNe5-eu_27oTuM"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@gala?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">加拉·罗德里格斯</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0e61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一会儿，就把自然想成一个类比。水果带着皮和壳长在树上。它们需要它们的皮和壳来健康地生长，保护它们免受外界的影响和危险。他们不会向外界暴露他们的核心。就像水果一样，你的应用需要一个外壳才能健康成长。</p><p id="cb37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当您直接将业务逻辑嵌入控制器时，您就暴露了果实的核心。但是当你把它分成另一层时，你就把框架当成了果皮。你可以随时把果皮换成外壳或塑料盖，但里面的果核会保持安全。您正在对核心逻辑进行未来验证。然而，这并不是一件容易的事情。</p><p id="430b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你需要开始思考你正在使用的框架之外的东西(在我们的例子中是ASP.NET MVC ),并把你的业务逻辑从你的框架代码中分离出来。这使得您的业务逻辑与您正在使用的框架分离。您可以设计一个服务类来封装控制器中的业务逻辑。当然，直接访问服务类并不是首选。相反，它通常被抽象在一个接口之后，以使其单元可测试和可互换。数据通过数据传输对象或<a class="ae kv" href="https://en.wikipedia.org/wiki/Data_transfer_object" rel="noopener ugc nofollow" target="_blank">dto</a>进行交换。dto是不包含任何业务逻辑的普通对象，只有可以序列化的数据。</p><p id="3971" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们试着将业务逻辑与前面的例子分开:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图书创建和查询的服务接口和实现。</p></figure><p id="3c7a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">MVC控制器代码变成这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这是您可能希望控制器代码看起来的样子。</p></figure><p id="673a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您甚至可以从命令行界面调用相同的业务逻辑:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">有了抽象之后，就可以从任何类型的应用程序中调用业务逻辑。</p></figure><p id="6f14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这些例子中使用接口似乎毫无意义，因为我们是手动构造的，你是对的。因为为了简洁起见，我省略了依赖注入。</p><p id="d027" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你绝对应该使用依赖注入库将接口的实现注入到构造函数中，而不是像<code class="fe lu lv lw lx b">new BookService()</code>那样手工构造它们。它对于可维护性和可测试性至关重要，应该在实际应用中使用。例如，这就是<code class="fe lu lv lw lx b">BookController</code>注入依赖项而不是手动创建的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">注入的依赖项。</p></figure><p id="c869" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过依赖接口和dto而不是具体的类和业务逻辑对象，我们的代码是面向未来的。这样，如果我们将来决定将我们的一些服务分解到另一个流程中，如web服务或任何其他RPC方法，我们可以轻松完成:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">BookService作为REST api闯入另一个进程。我们的MVC应用程序不受这个变化的影响。如果我们使用依赖注入库，我们可以在一行代码中交换IBookService的实现。</p></figure><h2 id="a172" class="mr lz iq bd ma ms mt dn me mu mv dp mi lf mw mx mk lj my mz mm ln na nb mo nc bi translated">引人深思的事</h2><ul class=""><li id="7bbb" class="nd ne iq ky b kz nf lc ng lf nh lj ni ln nj lr nk nl nm nn bi translated">我们只抽象出了一层逻辑。这一层仍然通过实体框架直接访问数据库，因此它仍然与框架紧密耦合。如果您需要将数据存储在文件中，或者存储在实体框架不支持的数据库中，会发生什么情况？你如何克服这个问题？</li><li id="4f8c" class="nd ne iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">抛出BusinessException会发生什么？需要办理吗，应该在哪里办理？</li><li id="f1e2" class="nd ne iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">将像HttpRequest或ViewBag这样的web构造直接泄漏到您的服务层中是一个好主意吗？当您泄漏web构造时，如果您想在控制台应用程序而不是web应用程序中使用此业务服务，会发生什么情况？</li></ul><h1 id="6c1d" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">结论</h1><p id="11ae" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nt lh li lj nu ll lm ln nv lp lq lr ij bi translated">这是对一个非常广泛的主题的一种非常通用的方法。我强烈推荐阅读像<em class="nw">罗伯特·c·马丁</em>写的<em class="nw">干净的架构:软件结构和设计的工匠指南</em>这样的书来更深入地探究这个主题。正如罗伯特·c·马丁在书中所说:<em class="nw">“不要和框架结婚！”</em></p></div></div>    
</body>
</html>