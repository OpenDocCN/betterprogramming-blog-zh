<html>
<head>
<title>How to Create Wobble Animations Using UIKit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用UIKit创建摆动动画</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/making-components-go-alive-using-uikit-animations-24fa11d19c02?source=collection_archive---------12-----------------------#2022-11-29">https://betterprogramming.pub/making-components-go-alive-using-uikit-animations-24fa11d19c02?source=collection_archive---------12-----------------------#2022-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4513" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让组件在你的iOS应用中活起来</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/376c60508e47e600710e8f79e212cf3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Dt611_6qULVfbgbT"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@alexjwing?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Alex Wing </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="c886" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将分享一些我在按钮和UICollectionView单元格等简单组件上进行微交互的经验。</p><p id="f7a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些在我们的宏观挑战应用中实现的微观互动——OTIN最初是设计团队的一个挑战，我们的技术团队构建了它。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="17a3" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">关键词:</h1><ul class=""><li id="547e" class="mr ms iq ky b kz mt lc mu lf mv lj mw ln mx lr my mz na nb bi translated">UIView动画</li><li id="2fb4" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><code class="fe nh ni nj nk b">CGAffineTransform</code></li><li id="e6fa" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><code class="fe nh ni nj nk b">CAKeyFrameAnimation</code></li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="41db" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">什么是微互动？</h1><p id="ea50" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">微交互是小但功能性的动画，它向用户提供关于用户界面内组件的当前状态或条件的反馈。像加载动画和按钮收缩这样的事情可以被认为是微交互。</p><p id="bcce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看看下面一些微交互的例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/37ad5e95afe26f9c2c5892be9379fd86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*9jLQyajkdKJcXlH-36OBCg.gif"/></div></figure><p id="6d8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是默认的编辑模式动画，当<code class="fe nh ni nj nk b">tableView.isEditing</code>设置为<code class="fe nh ni nj nk b">true</code>时触发。缩小单元左右部分的动画给人一种感觉，在单元的两边都有东西可以交互——在我们的例子中就是删除和重新排序。</p><p id="bc84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当主屏幕处于编辑模式时，下面的摆动动画受默认iOS / iPadOS动画的启发。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/4e60632f59c67cbb69303e2700b6e187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*ZyWEEkBrr6tuIJpyd6SYOw.gif"/></div></figure><p id="be3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">定义说得够多了，让我们看看更多的例子以及如何制作它们。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="a6d9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">动画UITableView编辑模式</h1><p id="4136" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">要创建像上面第一个例子那样的编辑模式动画，实际上不需要任何动画代码。这是<code class="fe nh ni nj nk b">UITableView</code>的默认状态。您只需要根据自己的需要实现委托。</p><p id="5f8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个处理编辑状态切换的按钮:</p><pre class="kg kh ki kj gt np nk nq bn nr ns bi"><span id="31da" class="nt ma iq nk b be nu nv l nw nx">@objc private func editButtonAction() {<br/>    tableView.setEditing(!tableView.isEditing, animated: true)<br/>    // You can also use the .toggle() function<br/>}</span></pre><p id="1f05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过实现委托，<code class="fe nh ni nj nk b">UITableView</code>将自动调用激活的适当编辑模式。</p><p id="7a22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当通过<code class="fe nh ni nj nk b">tableView.deleteRows(...)</code>删除和通过<code class="fe nh ni nj nk b">tableView.insertRows(...)</code>插入时，您还可以浏览每个单元格的动画:</p><pre class="kg kh ki kj gt np nk nq bn nr ns bi"><span id="2ebf" class="nt ma iq nk b be nu nv l nw nx">extension ParentRoutineViewController: UITableViewDelegate, UITableViewDataSource {<br/>		...<br/>    // Defines the editing style for each cell<br/>    func tableView(_ tableView: UITableView, editingStyleForRowAt indexPath: IndexPath) -&gt; UITableViewCell.EditingStyle {<br/>        guard tableView.isEditing else { return .none }<br/>        return .delete<br/>    }<br/>    <br/>    func tableView(_ tableView: UITableView, commit editingStyle: UITableViewCell.EditingStyle, forRowAt indexPath: IndexPath) {<br/>        <br/>        if editingStyle == .delete {<br/>            // What happens after clicking delete?<br/>	    tableView.deleteRows(at: [indexPath], with: .left)<br/>        }<br/>    }		<br/>}<br/><br/>extension ParentRoutineViewController: UITableViewDragDelegate {<br/>  func tableView(_ tableView: UITableView, itemsForBeginning session: UIDragSession, at indexPath: IndexPath) -&gt; [UIDragItem] {<br/>        // What to do on drag?<br/>    }<br/>    <br/>    func tableView(_ tableView: UITableView, moveRowAt sourceIndexPath: IndexPath, to destinationIndexPath: IndexPath) {<br/>        // What to do after dropping?<br/>    }<br/>}</span></pre><h1 id="2839" class="lz ma iq bd mb mc ny me mf mg nz mi mj jw oa jx ml jz ob ka mn kc oc kd mp mq bi translated">制作UICollectionViewCell动画</h1><p id="9072" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">为了在<code class="fe nh ni nj nk b">UICollectionViewCell</code>上创建摆动动画，我们可以使用<code class="fe nh ni nj nk b">CAKeyframeAnimation</code>，因为我们想要控制在每个动画运动中变换发生的距离。</p><pre class="kg kh ki kj gt np nk nq bn nr ns bi"><span id="d1ca" class="nt ma iq nk b be nu nv l nw nx">// Create wobble animation<br/>let wobble = CAKeyframeAnimation(keyPath: "transform.rotation")<br/>wobble.values = [0.0, -0.025, 0.0, 0.025, 0.0]<br/>wobble.keyTimes = [0.0, 0.25, 0.5, 0.75, 1.0]<br/>wobble.duration = 0.4<br/>wobble.isAdditive = true<br/>wobble.repeatCount = Float.greatestFiniteMagnitude</span></pre><pre class="od np nk nq bn nr ns bi"><span id="5481" class="nt ma iq nk b be nu nv l nw nx">// Add wobble animation to each collection view cell<br/>collectionView.indexPathsForVisibleItems.forEach { (indexPath) in<br/>    let cell = parentActivityListDetailView.collectionView.cellForItem(at: indexPath) as! CustomCollectionViewCell<br/>    cell.layer.add(wobble, forKey: "wobble")<br/>}</span></pre><p id="de63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成编辑后，不要忘记移除动画:</p><pre class="kg kh ki kj gt np nk nq bn nr ns bi"><span id="f8a8" class="nt ma iq nk b be nu nv l nw nx">collectionView.indexPathsForVisibleItems.forEach { (indexPath) in<br/>    let cell = parentActivityListDetailView.collectionView.cellForItem(at: indexPath) as! CustomCollectionViewCell<br/>    cell.layer.removeAllAnimations()<br/>}</span></pre><h1 id="c72f" class="lz ma iq bd mb mc ny me mf mg nz mi mj jw oa jx ml jz ob ka mn kc oc kd mp mq bi translated">动画UIButtons收缩和增长</h1><p id="c3ee" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">按钮是最常见的动画组件之一，尤其是在采用游戏化的时候。在这个例子中，让我们来看看<code class="fe nh ni nj nk b">UIButton</code>上的收缩和增长动画。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/bb90fffe55f41590f3bd0d36799c86c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*6QxdsLviNmZC7FlfI3nV2A.gif"/></div></figure><p id="fd6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你必须先创建一个按钮。您可以使用<code class="fe nh ni nj nk b">@IBOutlet</code>通过故事板来创建它，或者通过编程来创建它。在这里我创建了一个名为button的标准<code class="fe nh ni nj nk b">UIButton</code>。</p><p id="a3be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用<code class="fe nh ni nj nk b">CGAffineTransform</code>是因为它常用于缩放和平移。使用<code class="fe nh ni nj nk b">scaleX </code>和<code class="fe nh ni nj nk b">y</code>参数进行缩放操作，使用<code class="fe nh ni nj nk b">translationX</code>和<code class="fe nh ni nj nk b">y</code>进行平移操作。</p><pre class="kg kh ki kj gt np nk nq bn nr ns bi"><span id="3964" class="nt ma iq nk b be nu nv l nw nx">button.addTarget(self, action: #selector(animateUp), for: .touchUpOutside)<br/>button.addTarget(self, action: #selector(animateUp), for: .touchUpInside)<br/>button.addTarget(self, action: #selector(animateDown), for: .touchDown)</span></pre><pre class="od np nk nq bn nr ns bi"><span id="815e" class="nt ma iq nk b be nu nv l nw nx">// Set the default state with 1.0 scale on the up state<br/>@objc func animateUp(_ sender: UIButton) {<br/>    UIView.animate(withDuration: 0.1, animations: {<br/>          button.transform = CGAffineTransform(sscaleX: 1.0, y: 1.0)<br/>    }, completion: { _ in<br/>      // Completion Handler<br/>    })<br/>}<br/><br/>// Scale down to 0.9 when on click<br/>@objc func animateDown(_ sender: UIButton) {<br/>    UIView.animate(withDuration: 0.1, animations: {<br/>          button.transform = CGAffineTransform(scaleX: 0.9, y: 0.9)<br/>    }, completion: { _ in<br/>      // Completion Handler<br/>    })<br/>}</span></pre><h1 id="16f8" class="lz ma iq bd mb mc ny me mf mg nz mi mj jw oa jx ml jz ob ka mn kc oc kd mp mq bi translated">UIView动画— PIN输入</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/d7ac4a6a89ddd2e06004066e495c2e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*63fxaddFyHisjMk-rXs5dg.gif"/></div></figure><h2 id="7b9a" class="of ma iq bd mb og oh dn mf oi oj dp mj lf ok ol ml lj om on mn ln oo op mp oq bi translated">引脚焊盘</h2><p id="da61" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf nl lh li lj nm ll lm ln nn lp lq lr ij bi translated">这个项目中的pin pad实际上是一个UICollectionView。所以为了模仿UIButton的状态，比如<code class="fe nh ni nj nk b">.touchDown</code>、<code class="fe nh ni nj nk b">.touchUpInside</code>和<code class="fe nh ni nj nk b">.touchUpOutside</code>，我们必须使用集合视图本身的一些协议存根。有关详细信息，请查看下面的代码。</p><pre class="kg kh ki kj gt np nk nq bn nr ns bi"><span id="e58f" class="nt ma iq nk b be nu nv l nw nx">extension ChildPinUnlockViewController: UICollectionViewDelegate {<br/><br/>    // touchUpOutside<br/>    public func collectionView(_ collectionView: UICollectionView, didUnhighlightItemAt indexPath: IndexPath) {<br/>        let cell = collectionView.cellForItem(at: indexPath) ?? UICollectionViewCell()<br/>        UIView.animate(withDuration: 0.05, animations: {<br/>            button.transform = CGAffineTransform(scaleX: 1.0, y: 1.0)<br/>        }, completion: { _ in<br/>          // Completion Handler<br/>        })<br/><br/>    }<br/><br/>    // touchDown<br/>    public func collectionView(_ collectionView: UICollectionView, didHighlightItemAt indexPath: IndexPath) {<br/>        let cell = collectionView.cellForItem(at: indexPath) ?? UICollectionViewCell()<br/>        UIView.animate(withDuration: 0.05, animations: {<br/>            button.transform = CGAffineTransform(scaleX: 0.9, y: 0.9)<br/>        }, completion: { _ in<br/>          // Completion Handler<br/>        })<br/>    }<br/><br/>    // touchUpInside<br/>    func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) {<br/>        let cell = collectionView.cellForItem(at: indexPath) ?? UICollectionViewCell()<br/>        UIView.animate(withDuration: 0.05, animations: {<br/>            button.transform = CGAffineTransform(scaleX: 1.0, y: 1.0)<br/>        }, completion: { _ in<br/>          // Completion Handler<br/>        })<br/>    }<br/><br/>}</span></pre><p id="6872" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当PIN码错误时，我们希望像在iOS锁定屏幕上一样左右摇动PIN码输入栏。为了实现这一点，我们想要指定关键帧平移，我们必须使用<code class="fe nh ni nj nk b">CAKeyframeAnimation</code></p><pre class="kg kh ki kj gt np nk nq bn nr ns bi"><span id="aaf6" class="nt ma iq nk b be nu nv l nw nx">let shake = CAKeyframeAnimation(keyPath: "transform.translation.x")<br/>shake.values = [0, 20, -20, 0]<br/>shake.duration = 0.25<br/>shake.repeatCount = 1<br/>pinStackView.layer.add(shake, forKey: "shake")</span></pre><p id="f300" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仅此而已。感谢阅读。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="2b03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的Otin应用程序帮助印度尼西亚自闭症谱系障碍(ASD)儿童的父母保持他们孩子的日常生活和一致性，以提高自我独立性。</p><ul class=""><li id="feab" class="mr ms iq ky b kz la lc ld lf or lj os ln ot lr my mz na nb bi translated"><a class="ae kv" href="https://github.com/gal-bert/nuro" rel="noopener ugc nofollow" target="_blank">GitHub—gal-Bert/nuro:Petak 9宏挑战</a></li><li id="a5a7" class="mr ms iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated"><a class="ae kv" href="https://testflight.apple.com/join/2DVnkWrx" rel="noopener ugc nofollow" target="_blank">在试飞中加入欧廷测试版</a></li></ul></div></div>    
</body>
</html>