<html>
<head>
<title>React and D3 — Axis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React和D3 —轴</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/react-and-d3-axis-e8952d8d31e6?source=collection_archive---------8-----------------------#2019-11-05">https://betterprogramming.pub/react-and-d3-axis-e8952d8d31e6?source=collection_archive---------8-----------------------#2019-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b2f9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第二章React和D3系列的结合</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/aeb40d9d6c2c950cf7949c0eaae9814f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Tj5Ed72ZuLnIBXk7oTscQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">约翰·施诺布里希在<a class="ae kv" href="https://unsplash.com/s/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="5c7e" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">介绍</h1><p id="81e9" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">这是React和D3系列的第二部分。你可以在这里找到<a class="ae kv" href="https://medium.com/@icrosil/combination-of-react-and-d3-1fb07b00fb55" rel="noopener">第一章</a>。以及源代码<a class="ae kv" href="https://github.com/icrosil/react-d3" rel="noopener ugc nofollow" target="_blank">代码</a>。</p><p id="af65" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">在这一章中，我们将研究如何给React组件添加轴。通常，任何令人惊叹的图表都需要一些东西来描述你是如何测量数据的。这就是轴有用的地方。</p><p id="ad0c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated"><a class="ae kv" href="https://react-d3.icrosil.now.sh/" rel="noopener ugc nofollow" target="_blank">https://react-d3.icrosil.now.sh/</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/50ab6dc53405904187d5ce272b7d78f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uqpa-MOv_6fJiV9kOawkHg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加了轴📊</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="9ec6" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated"><strong class="ak">问题</strong></h1><p id="a80f" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">当你用D3创建一个轴时，它为你做了很多好事。<br/>它为标签做填充，它计算你想要显示的刻度数所需的标签，它将结果<em class="mx">呈现在一个节点中。</em></p><p id="618c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">不幸的是，渲染到一个节点中并不能很好地配合我们结合React和D3的方法。当你想从轴上得到比标准函数所能给你的更多的东西时，问题就出现了。</p><p id="15f7" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">让我们提一下您的产品可能会有的常见要求:</p><ul class=""><li id="f4a5" class="my mz iq lx b ly mr mb ms me na mi nb mm nc mq nd ne nf ng bi translated">定义动态数据的精确刻度数。形式上，您可以指定精确的刻度值，但这将约束您在相同的范围内拥有数据。通常，这对于动态数据不起作用。</li><li id="1f7c" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">在轴旁边添加标签。例如，您的设计师可能会要求您在轴旁边添加一个小文本。或者添加文本而不是最后一个元素。</li><li id="cf83" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">应该以不同方式显示在轴中的样式值。如果分笔成交点的每一种风格都不一样呢？</li><li id="d180" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">使用React渲染轴。如果我们想控制每个元素呢？</li><li id="895d" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">为SSR或转换为字符串时呈现轴。水合作用在生命周期或挂钩中可以正常工作，但在有些情况下这不是一个选项。例如，当您在浏览器中从SVG制作PNG时。</li></ul></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="2f97" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">用D3渲染</h1><p id="c581" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">让我们从默认解决方案开始，这在D3和React文章中都有很好的描述。这可能并不理想，也不能解决我们所有的要求，但这是一个很好的起点。</p><p id="33bb" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">为此，我们需要为<code class="fe nm nn no np b">ref</code>定义一个节点，并将其与D3链接起来。为了执行操作，我们将使用生命周期。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/ee25b69bf28e63a5ac566442eab8c5f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*B0dRjbtVK0K7uW4uC088Hw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">提供；给予</p></figure><p id="c5f7" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这是一个渲染方法。虽然它总是渲染一个React组件，但是它并没有做太多的事情。</p><ul class=""><li id="23c5" class="my mz iq lx b ly mr mb ms me na mi nb mm nc mq nd ne nf ng bi translated"><code class="fe nm nn no np b">this.renderAxis()</code>要求D3将轴渲染成元素。</li><li id="777e" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">SSR需要<code class="fe nm nn no np b">renderASAP</code>分支中的<code class="fe nm nn no np b">parser</code>。我们将轴呈现为虚拟元素，然后将其HTML解析为React组件。在这之后，我们的组件将是一个React实例。所有的解析动作都是用D3渲染一个轴并告诉React如何在渲染时处理它的唯一方法。为此，我们必须添加<code class="fe nm nn no np b">react-html-parser</code>库或任何其他<code class="fe nm nn no np b">html-to-react</code>库。这个技巧给你的项目增加了另外40 GZIP kb。</li><li id="f40d" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">返回设置了<code class="fe nm nn no np b">ref</code>的默认情况下的组件。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/43a016f8acb6c7c6679b5b3a51a06e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jleG4yLk7PbO1L4OzJFsQQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">渲染轴</p></figure><p id="a506" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这将选择现有元素并在内部绘制轴。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/137b077c2e8148b4fa4417fcc2703ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTLAlzx4E1PEnFNpOTSD8g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">生活过程</p></figure><ul class=""><li id="6f87" class="my mz iq lx b ly mr mb ms me na mi nb mm nc mq nd ne nf ng bi translated"><code class="fe nm nn no np b">componentWillMount</code>在将要创建组件时创建一个元素，并为D3设置虚拟元素。</li><li id="0ccd" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated"><code class="fe nm nn no np b">componentDidMount</code>触发渲染。</li><li id="90ab" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated"><code class="fe nm nn no np b">componentDidUpdate</code>触发渲染。</li><li id="2951" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated"><code class="fe nm nn no np b">setRef</code>是<code class="fe nm nn no np b">ref</code>的设定者。</li></ul><p id="ab2c" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这个解决方案对React 16有效，即使它看起来很丑。显然，React 17发布后，生命周期将被否决，这种变通办法将不再适用于我们。</p><p id="bc2e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">让我们试着用钩子做一些类似的东西，这样我们的轴就可以迎接React 17了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/6594eaba44a5aa32d04865356556c8f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CiJsA2yWzoNvmfPI92jaUw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">阿西肖克</p></figure><p id="e182" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">基本上，它是与生命周期相同的组件，但是使用钩子编写。<code class="fe nm nn no np b">renderASAP</code>块与前面的实现非常相似，因为我们不能创建它，所以在render中直接调用<code class="fe nm nn no np b">useEffect</code>。</p><p id="4c51" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这两个例子都依赖于轴的内部D3实现。它有如下警告:</p><ul class=""><li id="489f" class="my mz iq lx b ly mr mb ms me na mi nb mm nc mq nd ne nf ng bi translated">您可以定义精确的节拍数，但是D3可以根据<code class="fe nm nn no np b">closest guess</code>的内部实现相应地改变它。如果您想显示四个刻度，根据数据和视图，可以很容易地显示三个或五个刻度。</li><li id="132b" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">除了D3轴中预定义的记号和直线之外，不能添加任何东西。</li><li id="6251" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">您需要像<code class="fe nm nn no np b">react-html-parser</code>一样添加一个<code class="fe nm nn no np b">htmlToReact</code>解决方案。</li><li id="21a3" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">要设计记号的样式，必须使用直接的DOM操作。</li><li id="b343" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">要在轴旁边添加额外的文本，您需要绝对定位它。</li><li id="5dde" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">为了允许SSR，代码中应该有一个逻辑副本来处理不同的方法。</li></ul><p id="7f65" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">两个例子都解决了五个标准中的三个。我们能做得更好吗？</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="b7c2" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">用D3准备，用React渲染</h1><p id="f146" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">完成这项工作的另一种方法是获取ticks——将数据分割成axis就绪数组——并将它们作为普通组件呈现。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/a745fa2723cf15b3af0efff98ebf8ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jx0k3SuGYUk7ak62SUPF5w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AxisReactFirst</p></figure><p id="2833" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">就像React组件一样简单。我们只需要从天平上取下刻度。我们不需要额外的D3方法或者解析React到某个地方。我们可以控制任何风格和格式。</p><p id="a350" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">虽然，这里我们有一些额外的事情需要考虑:</p><ul class=""><li id="4ce4" class="my mz iq lx b ly mr mb ms me na mi nb mm nc mq nd ne nf ng bi translated">手动格式化记号。</li><li id="53b2" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">在容器上设置伸缩样式以传播刻度。</li><li id="0266" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">添加平移、高度、宽度和<code class="fe nm nn no np b">fontSize</code>。</li></ul><p id="eab4" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">上面列表中的所有东西通常都是由D3制作的，你不需要为这些细节而烦恼。</p><p id="c53e" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">当然，也有好处:</p><ul class=""><li id="7bf2" class="my mz iq lx b ly mr mb ms me na mi nb mm nc mq nd ne nf ng bi translated">不需要钩子来渲染。</li><li id="3b74" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">不需要考虑SSR render作为组件是纯粹的。</li></ul><p id="46f8" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">这个解决方案反映了我们所有的任务。样式，用React渲染，控制元素。五分之五。</p><p id="8616" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">尽管并不总是需要这种粒度的控制，因为它会增加更多的开销。需要考虑的一件事是，您真的需要这种粒度吗？如果第一个D3解决方案符合你的标准，你可以停下来。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="5114" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">外卖食品</h1><p id="88ad" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">我们比较了三种渲染轴的方法。根据你的需求，选择符合你标准的，不要过于复杂。</p><ul class=""><li id="2317" class="my mz iq lx b ly mr mb ms me na mi nb mm nc mq nd ne nf ng bi translated">避免使用生命周期方法，因为方法会被废弃。</li><li id="a2a2" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">如果你不介意效果的话，钩子解决方案是可以的。</li><li id="7a3f" class="my mz iq lx b ly nh mb ni me nj mi nk mm nl mq nd ne nf ng bi translated">如果缺省的axis组件需要大量的重新造型，则使用纯SVG解决方案。</li></ul><p id="3af7" class="pw-post-body-paragraph lv lw iq lx b ly mr jr ma mb ms ju md me mt mg mh mi mu mk ml mm mv mo mp mq ij bi translated">快乐编码。</p></div></div>    
</body>
</html>