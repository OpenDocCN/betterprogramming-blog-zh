# 从常见 Git 错误中恢复

> 原文：<https://betterprogramming.pub/recovering-from-common-git-errors-eccda7ec6180>

## 为了更快地回到您的开发中

![](img/c3d06eabb1a111a6f3aa1edbba25ab58.png)

在使用像 Git 这样复杂的东西时，我们经常会遇到一些常见的错误。但是作为人类，我们会犯错误，毕竟，最有效的学习方法是从错误中学习。

所以，不要惊慌，没有任何进一步的麻烦，我在这里分享我犯的所有这些 git 错误，以及我如何修复这些错误。

# 错误 1:无意中删除了一个分支

因此，可能有两种情况:要么你马上意识到了错误(即，删除了另一个分支，而不是预期的分支)，要么你最初没有意识到删除了错误的分支，但后来你意识到了。

在第一个场景中，您可以在删除分支后在终端中简单地检查消息。它可能看起来像这样:

```
$git branch -d branch1
warning: deleting branch 'branch1' that has been merged to 'refs/remotes/origin/branch1', but not yet merged to HEAD.
Deleted branch branch1(was e9498ae).
```

这里，我们看到了删除分支时指向的提交的 SHA 值。使用这个 SHA 值，我们可以从提交本身创建一个新的分支。你只需要做到以下几点:

`git checkout [SHA]`

一旦提交，就可以使用以下命令从那里重新创建分支:

`git checkout -b [branchname]`

在第二种情况下，如果您丢失了消息，要找到位于已删除分支末端的提交的 SHA。Do `git reflog`，它实际上是你的回购中在任何时候被引用或曾经被引用的所有提交的记录。

接下来，您可以执行与上述第一种情况相同的命令。

# 错误 2:您删除了一个文件或目录

这是一个我们都害怕的场景！

我们所有人都至少从项目中删除过一次错误的文件。这可能是突然执行的`rm -rf`命令，也可能是心不在焉的选择和删除，或者可能是任何错误脚本的结果！

不管是什么原因，删除一个重要的文件，如果不立即修复，可能会令人恼火。

同样，可能有许多可能的情况:

1.  如果您立即意识到这是一个错误，您需要运行以下命令:

`$ git checkout HEAD <filename>`

2.或者，另一种情况可能是您删除了文件并且也提交了删除。以下命令将带您回到提交之前的状态。

所以，有三种方法可以做到:

`$ git reset --soft HEAD~1`

这里，我们说让我们及时回滚，但是让我们保留这些更改，让我们将它们保存在暂存区和工作目录中，就好像它们还没有提交一样。有点类似于 git commit amend。

`$ git reset --mixed HEAD~1`

混合重置允许我们返回到旧状态，就像软重置一样，它将代码更改留在工作目录中，而不是暂存区中。

`$ git reset --hard HEAD~1`

现在头指针指向一个提交，就像其他提交一样。但是，如果您将获得状态，您的更改并不存在。他们就这么走了！

使用硬重置，git 不会试图跟踪它们。它不会将它们放在我的暂存区或工作目录中。它只是说，“你知道吗，忘了他们吧。”

3.现在，让我们来处理这样的场景:您提交了删除，然后又提交了更多。

首先，要找到正确的提交，请检查已删除文件的历史记录:

`$ git log -- <filename>`

您可以使用仍有文件的最后一次提交，也可以使用删除文件的提交。在第一种情况下，只需从提交中签出文件:

```
$ git checkout <commit hash> -- <filename>
```

在第二种情况下，从之前的一次提交中签出文件:

```
$ git checkout <deletion commit hash>~1 -- <filename>
```

4.我们可能犯的另一个错误是，我们删除了一个文件，提交了它，然后推送了它。

如果您已经将您的一个或多个提交推送到远程，重置并再次推会导致问题，因为本地存储库的历史实际上已经被重写。在这种情况下，最好记录一个新的提交来撤销删除文件者的工作。为此，请运行以下命令:

```
$ git revert --no-commit <commit>
```

上面，`<commit>`是删除文件的提交。接下来，根据需要创建新的提交。“`— no-commit`”选项阻止命令立即创建新的提交，而不是允许您准确地选择在新的提交中要恢复旧提交中引入的哪些更改。

# 错误 3:您在回购中添加了不需要的文件

该死的。我最近面临这个问题，很痛苦！

我不小心推了文件，我只是不想它再在那里了。因此，这是您可以用来从 git repo 中删除文件的命令:

```
git rm --cached <filename>
```

这不会在本地删除它，所以如果你想把它保存在你的计算机上作为参考而不在 g it 上共享它，它是安全的。

**注意**:为了防止再次被推送到 Git，只需将文件添加到你的`.gitignore`中即可。

当然，如果你不再需要这个文件，也可以从你的系统中删除它。

等等！

但是如果文件中有敏感数据，如密码或密钥，该怎么办呢？

您可能知道，提交仍然可以在存储库的历史中找到。所以，除此之外，你还需要做更多的事情。

## 如果推送的文件包含密码等敏感数据

上述方法不会将文件从提交历史中完全删除。

为了从你的历史中删除敏感文件，你可以使用一个叫做 [BFG 回购清理器](https://rtyley.github.io/bfg-repo-cleaner/)的开源工具，或者使用 git 的`git filter-branch`。

与`filter-branch`相比，BFG Repo-Cleaner 使完成工作变得更加容易和快速。它允许您删除文件，或者用文本`***REMOVED***`替换文件中的密码或密钥。您还可以删除意外推送的大文件。

你可以查看 [BFG 回购清洁器的文档并下载页面](https://rtyley.github.io/bfg-repo-cleaner/)来了解如何使用它。说明相当直接。

此外，要了解`git filter-branch`，查看 git 帮助网站上的[使用过滤分支](https://help.github.com/en/articles/removing-sensitive-data-from-a-repository#using-filter-branch)文章和 [git 过滤分支文档](https://git-scm.com/docs/git-filter-branch)。

# 错误#4:您忘记在最后一次提交时添加文件

另一个常见的 Git 陷阱是过早提交。

您错过了一个文件，忘记保存它，或者需要对最后一次提交做一些小的修改。`--amend`是你最好的朋友。

添加丢失的文件，然后运行可信的命令:

```
git add missed-file.txt
git commit --amend
```

此时，您可以修改提交消息，也可以保存它以保持不变。

因此，这些是一些常见的修复方法，以摆脱最常见的 Git 错误。

如果你有自己的 git 建议，请在下面的评论中告诉我，我很乐意听到。