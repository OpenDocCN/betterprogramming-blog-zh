<html>
<head>
<title>Throw Out Redux, Use Redux Toolkit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扔掉Redux，使用Redux工具包</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/throw-out-redux-use-redux-toolkit-aa247f18520e?source=collection_archive---------7-----------------------#2020-08-12">https://betterprogramming.pub/throw-out-redux-use-redux-toolkit-aa247f18520e?source=collection_archive---------7-----------------------#2020-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="50a7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在TypeScript中使用Redux Toolkit</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d376e848e7da4ed309d2f93baaaf01ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L0b5pjZ8w43iN2sm"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@tracycodes?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">特雷西·亚当斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="68da" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">辞旧迎新</h1><p id="263b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">不久前，当我第一次开始使用Redux时，我简直不敢相信我需要写这么多代码才能让任何东西工作。坦白说，这让我很害怕。尽管从内存中编写所有的设置代码可以让您感觉非常聪明，但过一段时间后，它会变得很无聊，您希望使用更直观、更简单的方法。</p><p id="4b18" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">Redux对初学者来说也很难掌握，对我来说也很难，直到我发现了<a class="ae ky" href="https://redux-toolkit.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux工具包</a>。我仍然感到惊讶的是，它并没有得到应有的广泛讨论，人们似乎还停留在旧的Redux上。</p><p id="c9e6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果你想开始学习redux，或者想要一种更直观的方式来编写Redux，RTK是一个不错的选择。</p><p id="0265" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在本文中，我将向您展示如何用TypeScript和React设置RTK。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="a487" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">为什么要用Redux Toolkit？</h1><ul class=""><li id="43f2" class="mz na it ma b mb mc me mf mh nb ml nc mp nd mt ne nf ng nh bi translated"><strong class="ma iu">类型定义</strong> —你可以通过TypeScript轻松使用它。</li><li id="51e9" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><strong class="ma iu">直接改变状态</strong> —你不再需要复制状态或者传播状态。RTK带有<a class="ae ky" href="https://immerjs.github.io/immer/docs/introduction" rel="noopener ugc nofollow" target="_blank"> Immer </a>，它允许你直接在代码中改变状态，而Immer则负责所有的繁重工作。</li><li id="0150" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><strong class="ma iu"> Redux Thunk </strong> —在常规Redux中编写异步代码需要安装额外的中间件，如Redux Saga或Redux Thunk。不再是了。RTK与<a class="ae ky" href="https://www.npmjs.com/package/redux-thunk" rel="noopener ugc nofollow" target="_blank"> Redux Thunk </a>捆绑在一起，提供所有的异步功能。</li><li id="e30b" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><strong class="ma iu">一个文件</strong> —所有的缩减器、操作和操作创建者都有一个文件。</li><li id="89d3" class="mz na it ma b mb ni me nj mh nk ml nl mp nm mt ne nf ng nh bi translated"><strong class="ma iu">Redux Dev Tools</strong>——我无法告诉你有多少次使用<a class="ae ky" href="https://github.com/reduxjs/redux-devtools" rel="noopener ugc nofollow" target="_blank"> Redux DevTools </a>(你需要在你的浏览器中安装扩展才能使用它)帮助我更快地调试代码，并阻止我有想砸键盘的日子(不，我永远不会那样做——希望如此)。RTK附带了Redux DevTools，这意味着您永远不需要添加任何额外的中间件来使用它。</li></ul><p id="0911" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">你可以在GitHub上看到这个应用程序完成的回购:<a class="ae ky" href="https://github.com/onedebos/typescript-with-redux-example" rel="noopener ugc nofollow" target="_blank">https://github.com/onedebos/typescript-with-redux-example</a></p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="df8d" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">让我们开始吧—设置</h1><p id="889c" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">首先，像往常一样，使用CRA和TypeScript模板创建一个名为rtk-app的新应用程序。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="246e" class="ns lh it no b gy nt nu l nv nw"><br/>npx create-react-app rtk-app — template typescript<br/>cd rtk-app<br/></span></pre><p id="0642" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在你最喜欢的代码编辑器中打开应用程序。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6b56" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">设置Redux工具包</h1><p id="b254" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">让我们从安装所需的包开始。我们将构建一个简单的应用程序，向<a class="ae ky" href="https://github.com/nasa/apod-api" rel="noopener ugc nofollow" target="_blank"> NASA APOD API </a>发出请求。</p><p id="24d8" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们需要好的ol' <a class="ae ky" href="https://react-redux.js.org/introduction/quick-start" rel="noopener ugc nofollow" target="_blank"> React Redux </a>和redux-toolkit本身。<a class="ae ky" href="https://github.com/reduxjs/redux-toolkit" rel="noopener ugc nofollow" target="_blank"> Redux Toolkit </a>是用TypeScript编写的，所以不需要为包安装@types。</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="491c" class="ns lh it no b gy nt nu l nv nw"><br/>npm install <a class="ae ky" href="http://twitter.com/types/react-redux" rel="noopener ugc nofollow" target="_blank">@types/react-redux</a> react-redux <a class="ae ky" href="http://twitter.com/reduxjs/toolkit" rel="noopener ugc nofollow" target="_blank">@reduxjs/toolkit</a><br/></span></pre><p id="d959" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">您可能需要再运行一次npm install，以便CRA在您的<code class="fe nx ny nz no b">package.json</code>中选取其他@types声明。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="266a" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">配置商店</strong></h1><p id="e9cd" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">Redux基于单个存储的概念，也就是说，您的整个状态都存储在一个地方。</p><p id="8b42" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在<code class="fe nx ny nz no b">src/index.js</code>内部，我们将创建我们的商店。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2a1a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在，有几件事需要注意:</p><p id="a2a8" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们使用RTK的<code class="fe nx ny nz no b">configureStore</code>方法来创建商店。该方法将一个包含所有reducers的对象作为参数。</p><p id="2c14" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们正在使用我们的<code class="fe nx ny nz no b">photoSliceReducer</code>，它是从一个<code class="fe nx ny nz no b">features/photos/PhotoSlice</code>文件(尚未创建)中导出的。</p><p id="aeeb" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">RTK文档鼓励我们将所有状态逻辑写在一个名为“SomethingSlice.ts”的features文件夹中。</p><p id="5a53" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">将我们所有的状态逻辑放在一个文件中使我们易于维护我们的应用程序并提高可读性。</p><p id="1084" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">注意:你可以传递任意多的减速器到商店。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="a36a" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">设置切片</h1><p id="ea24" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在<code class="fe nx ny nz no b">src</code>目录中，创建一个名为<code class="fe nx ny nz no b">features/photo</code>的新文件夹。在这里面，创建一个<strong class="ma iu"> </strong> <code class="fe nx ny nz no b">PhotoSlice.ts</code>文件。</p><p id="ade3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这就是奇迹发生的地方。所有这些神奇之处只依赖于一次进口。</p><p id="2e1c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">首先，我们导入<code class="fe nx ny nz no b">createSlice</code>，这是一个带有一个参数的函数:一个带有片名、初始状态和所有reducer函数的对象。</p><p id="2ebc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们还将导入<code class="fe nx ny nz no b">PayloadAction</code>来帮助我们定义有效载荷的类型。这样，我们可以确保我们的有效负载总是接收正确的类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="9093" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">由于使用了<code class="fe nx ny nz no b">createSlice</code>方法，我们导出了在<code class="fe nx ny nz no b">photoSlice</code>中自动可用的reducer对象。这是我们之前使用<code class="fe nx ny nz no b">configureStore</code>创建商店时传递给商店的减速器。</p><p id="86eb" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">RTK还自动为我们生成动作，我们可以在应用程序中使用的<code class="fe nx ny nz no b">photoSlice.actions</code>对象之外析构它们。</p><p id="9f9f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated"><code class="fe nx ny nz no b">photoSelector</code>将允许我们从Redux商店中选择我们想要的任何状态。我们稍后将回到<code class="fe nx ny nz no b">photoSelector</code>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="c36d" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">异步操作</h1><p id="c8a4" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">接下来，我们需要向NASA APoD API发出请求，以获取照片供我们显示。我们将使用<a class="ae ky" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>来完成这项工作。</p><p id="cde8" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">记住，RTK提供了Redux Thunk来允许我们编写异步代码。</p><p id="9ab5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们已经在我们的<code class="fe nx ny nz no b">PhotoSlice.ts</code>文件中导入了axios，但是我们需要安装它。使用以下内容安装axios:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="6a04" class="ns lh it no b gy nt nu l nv nw"><br/>npm install axios<br/></span></pre><p id="6889" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在导出<code class="fe nx ny nz no b">photosSelector</code>的那一行下面，我们可以开始编写一些异步动作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="1f66" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">将组件连接到Redux存储</h1><p id="4e85" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">让我们将我们的<code class="fe nx ny nz no b">App</code>组件连接到Redux商店。</p><p id="a75d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">为了将<code class="fe nx ny nz no b">App</code>(或任何其他组件)连接到商店，我们不需要任何<code class="fe nx ny nz no b">connect</code>功能、HOCs、<code class="fe nx ny nz no b">mapStateToProps</code>或任何旧的东西。辞旧迎新，记得吗？</p><p id="0e56" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们需要做的就是导入<code class="fe nx ny nz no b">useSelector</code>和<code class="fe nx ny nz no b">useDispatch</code>钩子，然后我们就可以开始了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="c86c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">为了从状态中选择我们想要的任何元素，我们将状态(导出为<code class="fe nx ny nz no b">photoSelector</code>)传递给我们的<code class="fe nx ny nz no b">useSelector</code>钩子。</p><p id="880e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们还可以访问从<code class="fe nx ny nz no b">PhotosSlice.ts</code>文件中导出的thunk操作(<code class="fe nx ny nz no b">getPhotos</code>)。</p><p id="debc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">只需几行代码，我们就可以将我们的<code class="fe nx ny nz no b">App</code>组件连接到Redux商店。这难道不令人惊讶吗？还要注意阅读代码是多么容易？漂亮！</p></div></div>    
</body>
</html>