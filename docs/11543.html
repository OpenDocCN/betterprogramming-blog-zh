<html>
<head>
<title>Resolving AppLocalizations Without Any BuildContext Around</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在没有任何BuildContext的情况下解析应用化</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/resolving-applocalizations-without-any-buildcontext-around-ef3490b84ab6?source=collection_archive---------4-----------------------#2022-03-29">https://betterprogramming.pub/resolving-applocalizations-without-any-buildcontext-around-ef3490b84ab6?source=collection_archive---------4-----------------------#2022-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ff2a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在调用runApp之前设置Android通知通道</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6675dbdd0be7b943d6144943be3494a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k3QHfxDegpFbf4Va"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d0cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你阅读关于<a class="ae kv" href="https://docs.flutter.dev/development/accessibility-and-localization/internationalization" rel="noopener ugc nofollow" target="_blank"><em class="ls">flutter _ localizations</em></a>的文档时，你会注意到，通过<code class="fe lt lu lv lw b">AppLocalizations.of(<em class="ls">context</em>)</code>使用本地化相当容易。由于这是在构建树中创建小部件时使用的，您可能想知道为什么这可能是一个问题，但是当您按照示例设置firebase messaging SDK，特别是<a class="ae kv" href="https://github.com/FirebaseExtended/flutterfire/blob/0ca85e519b585429d3d38b8d918ee6b132347b3e/packages/firebase_messaging/firebase_messaging/example/lib/main.dart#L53" rel="noopener ugc nofollow" target="_blank">为<em class="ls"> Android </em>创建通知通道</a>时，您会问自己:</p><blockquote class="lx"><p id="a6a6" class="ly lz iq bd ma mb mc md me mf mg lr dk translated"><em class="mh">我从</em>哪里得到 <strong class="ak">上下文</strong> <em class="mh">？</em></p></blockquote><p id="7c87" class="pw-post-body-paragraph kw kx iq ky b kz mi jr lb lc mj ju le lf mk lh li lj ml ll lm ln mm lp lq lr ij bi translated">最终<code class="fe lt lu lv lw b">runApp()</code>还没叫。</p><pre class="kg kh ki kj gt mn lw mo mp aw mq bi"><span id="c6e6" class="mr ms iq lw b gy mt mu l mv mw">void <strong class="lw ir">main</strong>() {<br/>  <strong class="lw ir">final</strong> <em class="ls">l10n</em> = <!-- -->AppLocalizations.of(<em class="ls">???</em>);<br/>  <!-- -->setupFirebaseMessaging(<em class="ls">l10n</em>);<br/>  runApp(App());<br/>}</span></pre><h1 id="af23" class="mx ms iq bd my mz na nb nc nd ne nf ng jw nh jx ni jz nj ka nk kc nl kd nm nn bi translated">查看AppLocalizations委托</h1><p id="5910" class="pw-post-body-paragraph kw kx iq ky b kz no jr lb lc np ju le lf nq lh li lj nr ll lm ln ns lp lq lr ij bi translated">我们将不得不以不同的方式获得<code class="fe lt lu lv lw b">AppLocalizations</code>实例。让我们看看这些是如何创建的；我们甚至不需要从我们已经知道的本地化本身去寻找。<code class="fe lt lu lv lw b">AppLocalizations.<em class="ls">delegate</em></code>定义了一个简单的函数<code class="fe lt lu lv lw b">load(locale)</code>，它创建<code class="fe lt lu lv lw b">AppLocalizations</code>的<em class="ls">区域设置</em>依赖实例(或者如果提供的<em class="ls">区域设置</em>不被支持，则抛出一个<code class="fe lt lu lv lw b">FlutterError</code>)。</p><pre class="kg kh ki kj gt mn lw mo mp aw mq bi"><span id="3d31" class="mr ms iq lw b gy mt mu l mv mw">void <strong class="lw ir">main</strong>() <strong class="lw ir">async</strong> {<br/>  <strong class="lw ir">final</strong> locale = ???;<br/>  <strong class="lw ir">final</strong> <em class="ls">l10n</em> = <strong class="lw ir">await</strong> <!-- -->AppLocalizations.<em class="ls">delegate</em>.load(<!-- -->locale<!-- -->);<br/>  ...<br/>}</span></pre><p id="b8c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们只需要找到用于本地化的最佳语言环境。</p><h1 id="1f99" class="mx ms iq bd my mz na nb nc nd ne nf ng jw nh jx ni jz nj ka nk kc nl kd nm nn bi translated">解析支持的用户区域设置</h1><p id="6d01" class="pw-post-body-paragraph kw kx iq ky b kz no jr lb lc np ju le lf nq lh li lj nr ll lm ln ns lp lq lr ij bi translated">要从所有支持的区域设置列表中解析用户区域设置，我们必须找到一个最适合系统定义的首选用户区域设置。这由<code class="fe lt lu lv lw b">WidgetsApp</code>实现，通常由<em class="ls">颤振</em>定位实现直接使用:</p><blockquote class="nt nu nv"><p id="f36b" class="kw kx ls ky b kz la jr lb lc ld ju le nw lg lh li nx lk ll lm ny lo lp lq lr ij bi translated"><em class="iq">当提供了</em><strong class="ky ir">localeListResolutionCallback</strong><em class="iq">时，Flutter将首先尝试用提供的</em><strong class="ky ir">localeListResolutionCallback</strong><em class="iq">解析区域设置。如果回调或结果为空，将退回到尝试</em><strong class="ky ir">localeResolutionCallback</strong><em class="iq">。如果</em><strong class="ky ir">localeResolutionCallback</strong><em class="iq">和</em><strong class="ky ir">localeListResolutionCallback</strong><em class="iq">都为空或解析失败(返回空)，则使用基本回退算法。</em> <a class="ae kv" href="https://github.com/flutter/flutter/blob/ab89ce285f76a3fd3a9328ec863f5623cc5ac8bc/packages/flutter/lib/src/widgets/app.dart#L828" rel="noopener ugc nofollow" target="_blank">【颤振】</a></p></blockquote><p id="70fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在大多数情况下，只使用用<code class="fe lt lu lv lw b">basicLocaleListResolution()</code>函数实现的基本回退算法就足够了。当您需要一种算法来实现用<a class="ae kv" href="https://unicode.org/reports/tr35/#LanguageMatching" rel="noopener ugc nofollow" target="_blank"> Unicode TR35 </a>定义的完整的语言环境解析时，您必须提供并使用带有<code class="fe lt lu lv lw b">localeListResolutionCallback</code>函数的自定义实现。</p><h1 id="395f" class="mx ms iq bd my mz na nb nc nd ne nf ng jw nh jx ni jz nj ka nk kc nl kd nm nn bi translated">把所有东西放在一起</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/6a3bb3b6061e92f3ca7f8c576af1fe51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WUWRIRbdT-XnboT0"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@emilymorter?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">艾米丽·莫特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="aa55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然我们已经知道了如何创建<code class="fe lt lu lv lw b">AppLocalizations</code>实例以及如何解析它所支持的用户区域设置，让我们看看最终它们是如何协同工作的。我们在这里将它声明为全局属性<code class="fe lt lu lv lw b">l10n</code>:</p><pre class="kg kh ki kj gt mn lw mo mp aw mq bi"><span id="5055" class="mr ms iq lw b gy mt mu l mv mw">Future&lt;AppLocalizations&gt; get <strong class="lw ir">l10n</strong> {<br/>  <strong class="lw ir">final</strong> widgets<em class="ls">Binding</em> = WidgetsFlutterBinding.<em class="ls">ensureInitialized</em>();<br/>  <strong class="lw ir">final</strong> <em class="ls">preferred</em> = widgets<em class="ls">Binding</em>.<em class="ls">window</em>.<em class="ls">locales</em>;<br/>  <strong class="lw ir">const</strong> <em class="ls">supported</em> = AppLocalizations.<em class="ls">supportedLocales</em>;<br/>  <strong class="lw ir">final</strong> <em class="ls">locale</em> = basicLocaleListResolution(<em class="ls">preferred</em>, <em class="ls">supported</em>);<br/>  <strong class="lw ir">return</strong> AppLocalizations.<em class="ls">delegate</em>.load(<em class="ls">locale</em>);<br/>}</span></pre><p id="8968" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只要考虑到这种实现不是有状态的，不应该在存储库或任何其他抽象中使用。请考虑改用全局键或其他可解析的值。</p><p id="e19a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最终，无论用户何时决定更改他们设备的区域设置(即使只有百万分之一)，您都不希望在错误的区域设置中定义字符串。</p><div class="oa ob gp gr oc od"><a href="https://docs.flutter.dev/development/accessibility-and-localization/internationalization" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">国际化Flutter应用</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">您将了解如何跟踪设备的区域设置(用户的首选语言)。如何管理特定于语言环境的应用程序…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">docs.flutter.dev</p></div></div><div class="om l"><div class="on l oo op oq om or kp od"/></div></div></a></div></div></div>    
</body>
</html>