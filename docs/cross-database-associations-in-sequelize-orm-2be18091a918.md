# Sequelize ORM 中的跨数据库关联

> 原文：<https://betterprogramming.pub/cross-database-associations-in-sequelize-orm-2be18091a918>

## 如果可能的话，不要创建两个或更多单独的查询

![](img/d155e1ee44a57008fef4d7a5dafc9b56.png)

我已经使用[序列](https://sequelize.org/)很多年了，它对我来说是一个很好的工具。我使用[范围](http://docs.sequelizejs.com/manual/scopes.html)和[关联](http://docs.sequelizejs.com/manual/associations.html)实现了大量非常大且复杂的查询。

在某种程度上，我认为我几乎成为了这方面的专家，能够做任何需要做的事情，除了一件事——跨数据库连接。

对我来说，这是一场巨大的斗争，因为一些应用程序使用多个数据库，并且需要一些查询来从其中几个数据库获取相关数据。有很多关于堆栈溢出和 GitHub 问题的主题，但是没有一个有具体的步骤来实现它。

很长一段时间，我不得不手动编写查询，用`sequelize.query`执行它们。

它对我来说工作得很好，尤其是将它们与[模型挂钩](http://docs.sequelizejs.com/manual/hooks.html)结合起来，但是它总是困扰着我，当可以使用一个查询时，我不得不进行两个或更多单独的查询。

让我们看一些代码。比方说，我们有两个数据库:一个包含用户和订单，另一个包含产品。用户可以有多个订单，订单可以有多个产品:

模型定义:

让我们创建两个顺序数据库连接实例:

并成立了一些协会:

现在，我们可以使用自动生成的模型方法来创建和查看属于特定订单的产品:

然而，如果我们试图使用`include` 选项，我们将会遇到以下错误

让我们继续解决这个问题。

您需要做的第一件事是手动调整 Sequelize 数据库连接实例，如下所示:

然后，将模式名称添加到产品型号选项中:

最后，您需要手动更新关联范围，因为默认的关联仍然会尝试点击`users_and_orders`。

答对了。现在，您可以使用不同数据库中的表创建多个复杂的查询。

# **更深的嵌套**

如果您想进行更深层次的嵌套，请确保使用文字字符串表示，如下所示:

黑客快乐！