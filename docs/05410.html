<html>
<head>
<title>Using Swift Inside a Linux-Based Docker Container Environment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在基于Linux的Docker容器环境中使用Swift</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-swift-inside-a-linux-based-docker-container-environment-65ec16b0004d?source=collection_archive---------20-----------------------#2020-07-06">https://betterprogramming.pub/using-swift-inside-a-linux-based-docker-container-environment-65ec16b0004d?source=collection_archive---------20-----------------------#2020-07-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="919b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索基于Linux的概念，将您的快速开发容器化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3f99106b2e9c634d91d8111ca0eba022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R_WA2nK3tYU83tIB"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@rubavi78?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ruben Bagües</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="9a63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行Swift需要Mac吗？不。Swift是一种设计用于苹果生态系统的编程语言。但是，它可以在Linux上运行。不仅仅是为苹果产品写的。</p><p id="d4c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们利用Docker创建一个适合Swift运行和执行其指令的环境:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="fc9e" class="ma mb it lw b gy mc md l me mf">curl -O https://swift.org/builds/swift-5.2.4-release/amazonlinux2/swift-5.2.4-RELEASE/swift-5.2.4-RELEASE-amazonlinux2.tar.gz<br/>tar -xf swift-5.2.4-RELEASE-amazonlinux2.tar.gz<br/>sudo cp -R ./swift-5.2.4-RELEASE-amazonlinux2 /usr/local/bin/</span></pre><p id="ddc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了！看起来我们可以运行<code class="fe mg mh mi lw b">swift</code>命令并继续前进。</p><p id="d0b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没那么快…我们需要<code class="fe mg mh mi lw b">swift</code>可以从任何地方访问。</p><p id="2dec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前，由于二进制文件的位置，运行<code class="fe mg mh mi lw b">swift</code>的唯一方法是直接从路径<code class="fe mg mh mi lw b">/usr/local/bin/swift-5.2.4-RELEASE-amazonlinux2/local/bin/swift</code>执行。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ef15" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">在您的机器上随时随地快速运行</h1><p id="48c0" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">在上面，你可以看到我们正在将<a class="ae ky" href="https://swift.org/" rel="noopener ugc nofollow" target="_blank"> Swift编程语言</a>下载为一个预构建的二进制文件，解压其内容，并将其直接添加到系统的用户目录中。</p><p id="3ee8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Bash不能主动使用二进制文件，除非在bash会话中的某个地方有到二进制文件的系统链接。为了启用这个链接，<code class="fe mg mh mi lw b">export</code>我们刚刚解压的二进制文件的路径，并用<code class="fe mg mh mi lw b">:${PATH}</code>将它链接到当前的bash会话。</p><p id="b250" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PATH是一个与文件位置相关的变量，相当于在ubuntu中使用<code class="fe mg mh mi lw b">/usr/sbin:/usr/bin:/sbin:/bin</code>。在macOSx上，这相当于使用<code class="fe mg mh mi lw b">/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin</code>。</p><p id="a1b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们用<code class="fe mg mh mi lw b">export</code>函数创建二进制文件的快捷方式:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="5177" class="ma mb it lw b gy mc md l me mf">export PATH="/usr/local/bin/swift-5.2.4-RELEASE-amazonlinux2/usr/bin/:${PATH}"</span></pre><p id="5bc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，您可以看到<code class="fe mg mh mi lw b">export</code>是一个命令，它将环境变量标记为子进程导出。</p><p id="8bb2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们检查一下这个<code class="fe mg mh mi lw b">swift --version</code>命令是否有所不同:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6a1a" class="ma mb it lw b gy mc md l me mf">bash-4.2# swift --version</span></pre><p id="0c9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功！我们在Linux内部安装了一个通常在苹果产品上使用的全系统编译语言，并第一次运行了它。</p><p id="18e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们清理剩下的文件:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="461b" class="ma mb it lw b gy mc md l me mf">sudo rm -rf ./swift-5.2.4-RELEASE-amazonlinux2<br/>sudo rm -rf ./swift-5.2.4-RELEASE-amazonlinux2.tar.gz</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="b54e" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">对接Swift</h1><p id="ef62" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">包含编译语言是隔离项目、代码和系统进程的下一步。由<a class="ae ky" href="https://hub.docker.com/_/amazonlinux" rel="noopener ugc nofollow" target="_blank"> DockerHub </a>提供的一个Amazon Linux 2 Docker镜像得到了很好的维护，处理了包的清理和包的轻松安装。</p><p id="e617" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试着让我们的Swift程序在基于Linux的环境中运行，类似于AWS ec2 linux2实例。<a class="ae ky" href="https://aws.amazon.com/amazon-linux-2/faqs/" rel="noopener ugc nofollow" target="_blank">亚马逊Linux 2 </a>是利用亚马逊EC2和亚马逊ECS(AWS提供的服务)的亚马逊机器镜像。</p><p id="5ea8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是一个Docker文件的示例:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6525" class="ma mb it lw b gy mc md l me mf">FROM amazonlinux:2<br/><br/># Install -- See https://hub.docker.com/_/amazonlinux<br/>RUN yum -y update; yum clean all<br/><br/># Install requirements.<br/>RUN yum makecache fast \<br/> &amp;&amp; yum -y install deltarpm epel-release initscripts \<br/> &amp;&amp; yum -y update \<br/> &amp;&amp; yum -y install \<br/>      binutils \<br/>      gcc \<br/>      git \<br/>      glibc-static \<br/>      gzip \<br/>      libbsd \<br/>      libcurl \<br/>      libedit \<br/>      libicu \<br/>      libsqlite \<br/>      libstdc++-static \<br/>      libuuid \<br/>      libxml2 \<br/>      tzdata \<br/>      tar \<br/>      sudo \<br/>      nano \<br/>      which \<br/>      python-pip \<br/> &amp;&amp; yum clean all<br/><br/>RUN curl -O https://swift.org/builds/swift-5.2.4-release/amazonlinux2/swift-5.2.4-RELEASE/swift-5.2.4-RELEASE-amazonlinux2.tar.gz<br/>RUN tar -xf swift-5.2.4-RELEASE-amazonlinux2.tar.gz<br/>RUN sudo cp -R ./swift-5.2.4-RELEASE-amazonlinux2 /usr/local/bin/<br/>ENV PATH="/usr/local/bin/swift-5.2.4-RELEASE-amazonlinux2/usr/bin/:${PATH}"<br/>RUN sudo rm -rf ./swift-5.2.4-RELEASE-amazonlinux2<br/>RUN sudo rm -rf ./swift-5.2.4-RELEASE-amazonlinux2.tar.gz<br/><br/>RUN cd ./home &amp;&amp; export PATH=/usr/local/bin/swift-5.2.4-RELEASE-amazonlinux2/usr/bin/:"${PATH}" &amp;&amp; swift package init --type="executable" &amp;&amp; swift package update &amp;&amp; swift build &amp;&amp; swift run<br/><br/>CMD ["/bin/ping","localhost"]</span></pre><p id="03d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们举例说明如何构建这个<code class="fe mg mh mi lw b">.dockerfile</code>:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="59ee" class="ma mb it lw b gy mc md l me mf">docker build -t swiftamazon .</span></pre><p id="2f97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到<code class="fe mg mh mi lw b">build</code>命令将预配置Swift并初始化一个Swift项目，其类型设置为<code class="fe mg mh mi lw b">executable</code>:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6ca7" class="ma mb it lw b gy mc md l me mf">swift package init --type="executable"</span></pre><p id="7e46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将创建一个现成的示例项目。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0fce" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">在Linux上运行Swift</h1><p id="cd10" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">让我们运行它！在Docker命令后包含<code class="fe mg mh mi lw b">CONTAINER ID</code>:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="6bb2" class="ma mb it lw b gy mc md l me mf">docker run &lt;CONTAINER ID&gt;</span></pre><p id="adcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者在Docker构建命令中最初用参数<code class="fe mg mh mi lw b">-t</code>设置的构建映像的标记名:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f885" class="ma mb it lw b gy mc md l me mf">docker run swiftamazon:latest</span></pre><p id="7e75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在运行一个基于Linux的Docker镜像作为一个容器，二进制文件<code class="fe mg mh mi lw b">ping</code>调用<code class="fe mg mh mi lw b">localhost</code>来保持这个容器活动。</p><p id="3a41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将允许我们对容器发出<code class="fe mg mh mi lw b">exec</code>命令。</p><p id="c7c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将参数<code class="fe mg mh mi lw b">-it</code>与运行程序<code class="fe mg mh mi lw b">/bin/bash</code>结合起来，在预装Swift的基于Linux的环境中工作:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ad27" class="ma mb it lw b gy mc md l me mf">docker exec -it &lt;CONTAINER ID&gt; /bin/bash</span></pre><p id="5575" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个运行中的<code class="fe mg mh mi lw b">amazonlinux:2</code>实例，其中<code class="fe mg mh mi lw b">Swift</code>已经初始化，可以在容器中运行。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="777c" class="mq mb it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">决赛成绩</h1><p id="a990" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">这就是如何让Swift在一个隔离的Linux容器环境中运行。Swift从一个预构建的二进制文件运行，可以从容器内的任何地方直接调用。使用Swift进行开发现在只需稍加调整就可以被容器化并部署到AWS。</p><p id="1991" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们探索了多个基于Linux的概念，并展示了如何利用非Mac自带的开发人员工作流。</p><p id="35f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div></div>    
</body>
</html>