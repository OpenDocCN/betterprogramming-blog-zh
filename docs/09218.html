<html>
<head>
<title>Advanced Toggle Switch in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI中的高级切换开关</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/advanced-toggle-switch-616b60b3512c?source=collection_archive---------5-----------------------#2021-07-28">https://betterprogramming.pub/advanced-toggle-switch-616b60b3512c?source=collection_archive---------5-----------------------#2021-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b17e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何创建和使用开关，以及如何在发生错误时处理可视状态的变化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1e154646cdb62a7a0ddc5c0649987cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYY2oflmHHXjTJ2wYHUH8w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><h1 id="3f71" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">介绍</h1><p id="d2c4" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">虽然SwiftUI的开发越来越多，但是很多日常工作中有用的细节仍然不明显，甚至不存在。</p><p id="3a92" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在这种情况下，通常有必要采取替代方案来解决我们的问题。</p><p id="ee81" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这种情况也会影响<code class="fe mo mp mq mr b">Toggle</code>开关。它的基本实现是显而易见的，但是为了本文的目的，让我们以GDPR同意状态的变化为例，尽量使它形式化，就像它应该出现在生产代码中一样。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="0ee5" class="kv kw iq bd kx ky mz la lb lc na le lf jw nb jx lh jz nc ka lj kc nd kd ll lm bi translated">履行</h1><p id="afd3" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">让我们从具有标题、副标题和拨动开关的<code class="fe mo mp mq mr b">CustomToggle</code>结构的实现开始，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a01f" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这是一个好的开始，现在让我们创建一个视图和一个视图模型，它将负责显示<code class="fe mo mp mq mr b">Toggle</code>开关并处理与之相关的逻辑:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0b8f" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">出于本文的目的，<code class="fe mo mp mq mr b">CustomView</code>中的<code class="fe mo mp mq mr b">viewModel</code>以及<code class="fe mo mp mq mr b">CustomViewModel</code>中的<code class="fe mo mp mq mr b">GdprAgreementsService</code>都没有被注入，这是生产实现中的一个显而易见的过程。如您所见，这里还使用了<code class="fe mo mp mq mr b">AnyPublisher</code>扩展来消除不必要的返回值:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0765" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">基本实现中的最后一件事当然是视图模型中已经初始化的<code class="fe mo mp mq mr b">GdprAgreementsService</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="df36" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">让我们在这一点上暂停一下。为什么发布者<code class="fe mo mp mq mr b">saveAgreements (isGdprAccepted: Bool?)</code>值是可选的？</p><p id="5f14" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这个过程(出于本文的目的)允许您轻松模拟<code class="fe mo mp mq mr b">saveGdprState (state :)</code>方法中的错误，并揭示<code class="fe mo mp mq mr b">Toggle</code>开关状态错误，因为即使用户将<code class="fe mo mp mq mr b">isOn</code>状态更改为<code class="fe mo mp mq mr b">true</code>，协议状态也不会更新——因此用户的可见状态和实际情况之间存在差异。</p><p id="c76c" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">当然，反过来也是一样，当用户希望选择不同意跟踪时。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="30c3" class="kv kw iq bd kx ky mz la lb lc na le lf jw nb jx lh jz nc ka lj kc nd kd ll lm bi translated">解决办法</h1><p id="c0a4" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">为了防止出现故障时视觉状态和实际状态之间的差异，必须能够从外部影响开关的切换状态。</p><p id="8f19" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">可以将它分成两个标志:<code class="fe mo mp mq mr b">isOn</code>，只负责它的状态，以及<code class="fe mo mp mq mr b">isPermissionGranted</code>，负责处理同意。</p><p id="e5e3" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">为此，<code class="fe mo mp mq mr b">CustomToggle</code>视图的实现应该更新如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0a32" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">现在，由于将<code class="fe mo mp mq mr b">isPermissionGranted</code>标志转移到了<code class="fe mo mp mq mr b">.onTapGesture</code>动作，我们可以在不修改同意的情况下设置<code class="fe mo mp mq mr b">Toggle</code>开关状态。</p><p id="aded" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">我们还需要对<code class="fe mo mp mq mr b">CustomView</code>的身体做一个小小的改动:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e31c" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">……在<code class="fe mo mp mq mr b">CustomViewModel</code>中还有更多:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="fa14" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">瞧啊。由于这些修改，在服务出错和未能设置许可的情况下，<code class="fe mo mp mq mr b">Toggle</code> switch将返回到其先前的正确状态。通过修改<code class="fe mo mp mq mr b">changePermissionState()</code>方法中的<code class="fe mo mp mq mr b">isGdprAccepted</code>标志，我们可以很容易地测试它当前的操作。可选地，在<code class="fe mo mp mq mr b">case .failure</code>中，可以显示关于未成功变更同意的错误警告或修改截止时间值，以增加切换状态变更动画之间的间隔。</p><h2 id="ed98" class="ng kw iq bd kx nh ni dn lb nj nk dp lf lw nl nm lh ma nn no lj me np nq ll nr bi translated">决赛成绩</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/ead613a8d8341f7a24e30c5525f91e12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Iul15JXYSM2j9SgMDLVGTA.gif"/></div></div></figure></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="30cd" class="kv kw iq bd kx ky mz la lb lc na le lf jw nb jx lh jz nc ka lj kc nd kd ll lm bi translated">摘要</h1><p id="d46f" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">以上解决方案并不完美，大家满怀希望的展望未来，等待进一步的更新。然而，目前，它肯定会促进接口和逻辑层的统一和同步，这转化为消除与应用程序维护相关的未来问题，并照顾其正常运行。</p><p id="0204" class="pw-post-body-paragraph ln lo iq lp b lq mj jr ls lt mk ju lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">希望你喜欢学习SwiftUI的一些东西。请随时关注我的<a class="ae nt" href="https://twitter.com/chrislowiec" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上的最新文章。</p></div></div>    
</body>
</html>