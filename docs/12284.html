<html>
<head>
<title>How To Code a Simple Game In Golang And Fyne</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Golang和Fyne编写一个简单的游戏</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-code-a-simple-game-in-golang-and-fyne-bff184bee9ef?source=collection_archive---------7-----------------------#2022-05-25">https://betterprogramming.pub/how-to-code-a-simple-game-in-golang-and-fyne-bff184bee9ef?source=collection_archive---------7-----------------------#2022-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9bfd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">本文将探讨如何使用Golang、图像包和Fyne GUI工具包编写一个可以在图像背景上行走的角色精灵</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d89e05a2a292de7c03acc8b0b550d598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2endpy_0wl8eq9w42ukrZw.png"/></div></div></figure><p id="e12b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">前段时间看了弗兰克实验室的一些有趣的教程，关于如何用JavaScript编写游戏。对于本文，我决定使用Fyne GUI工具包而不是JavaScript来编写他的一个简单游戏的Golang代码。</p><p id="8181" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">鉴于Golang与JavaScript的工作方式不同，我在这里向您展示的代码结构也将与Frank实验室的原始代码有所不同。</p><p id="2ed2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如在他的视频教程中，我们不会建立一个完整的游戏，虽然。你可以使用键盘上的箭头键在背景图像上移动一个字符。然而，这可能是一场真正游戏的开始。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="bd0b" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">游戏资产</h1><p id="f37c" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">下面，你可以看到这个项目中使用的两个游戏元素。</p><p id="6255" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用一个星球大战背景和一个以丘巴卡为特色的雪碧。“朱伊。”这些资源的原始链接可以在弗兰克实验室的教程的YouTube页面上找到<a class="ae mu" href="https://www.youtube.com/watch?v=EYf_JwzwTlQ" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="kj kk kl km gt ab cb"><figure class="mv kn mw mx my mz na paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/cbd7a41b553f9b5ace13a4b07b294c4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1486/format:webp/1*C1vurqTond4mao0BdZVOPA.png"/></div></figure><figure class="mv kn nb mx my mz na paragraph-image"><img src="../Images/69ffb48a073b392be726c6c5f74aad94.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*c-W0QIk-2ojE6WDLaauMjw.png"/><p class="nc nd gj gh gi ne nf bd b be z dk ng di nh ni translated">背景图像(左)和字符精灵表(右)</p></figure></div><p id="819f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦你下载了它们，这些PNG图像游戏资产应该放在运行Go代码的文件夹下面的一个名为<code class="fe nj nk nl nm b">./assets</code>的文件夹中。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="5b17" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">我们将使用的Golang软件包</h1><ul class=""><li id="fcce" class="nn no it kw b kx mp la mq ld np lh nq ll nr lp ns nt nu nv bi translated"><strong class="kw iu"> Fyne </strong>:你可以在这里找到Fyne GUI工具包<a class="ae mu" href="https://fyne.io/" rel="noopener ugc nofollow" target="_blank">的主页。如果你想了解更多关于Fyne的信息，那么我之前的文章，你可以在这里找到</a><a class="ae mu" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-a-simple-data-entry-desktop-app-with-golang-and-fyne-7c9e543d71e">这里找到</a>和<a class="ae mu" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-a-crud-desktop-app-with-golang-fyne-and-mongodb-35c54c37291">这里找到</a>，你可能也会感兴趣。</li><li id="89c3" class="nn no it kw b kx nw la nx ld ny lh nz ll oa lp ns nt nu nv bi translated"><strong class="kw iu">图像</strong>:来自标准库的基础图像包的文档可以在<a class="ae mu" href="https://pkg.go.dev/image" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</li><li id="b21d" class="nn no it kw b kx nw la nx ld ny lh nz ll oa lp ns nt nu nv bi translated"><strong class="kw iu">时间</strong>:这是一个标准的Golang库。你可以在这里找到时间包<a class="ae mu" href="https://pkg.go.dev/time" rel="noopener ugc nofollow" target="_blank">的文档。</a></li></ul></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="bc7e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">代码概述</h1><h2 id="10ac" class="ob ly it bd lz oc od dn md oe of dp mh ld og oh mj lh oi oj ml ll ok ol mn om bi translated">玩家和游戏模型</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="d31c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第1–16行，我们定义了<code class="fe nj nk nl nm b">Player</code>结构。</p><p id="6e4b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b">x</code>和<code class="fe nj nk nl nm b">y</code>区域是指玩家在游戏中的位置。</p><p id="ef64" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b">width</code>和<code class="fe nj nk nl nm b">height</code>是sprite工作表中每个sprite的大小。</p><p id="88fa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">变量<code class="fe nj nk nl nm b">frameX</code>和<code class="fe nj nk nl nm b">frameY</code>分别指子画面在x和y方向上的位置。</p><p id="3777" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">字段<code class="fe nj nk nl nm b">cyclesX</code>统计子画面上X方向的子画面数量。当玩家行走时，这些精灵将从头到尾重复循环。</p><p id="355f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">变量<code class="fe nj nk nl nm b">upY</code>、<code class="fe nj nk nl nm b">downY</code>、<code class="fe nj nk nl nm b">leftY</code>、<code class="fe nj nk nl nm b">rightY</code>指的是对应于玩家角色方向的特定精灵行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/caef1e59cb934deb2455194a97d08f35.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*8vmuJ_ToubHMVA7cl0c8sQ.jpeg"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">有16个单独精灵的“朱伊”精灵表</p></figure><p id="f986" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">变量<code class="fe nj nk nl nm b">speed</code>是加到玩家x或y位置的量。</p><p id="315b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在游戏过程中按下特定键时设置字段<code class="fe nj nk nl nm b">xMov</code>和<code class="fe nj nk nl nm b">yMov</code>。</p><p id="49b1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在第18–24行，我们定义了<code class="fe nj nk nl nm b">Game</code>结构。</p><p id="f4bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">字段<code class="fe nj nk nl nm b">canvasWidth</code>和<code class="fe nj nk nl nm b">canvasHeight</code>是指背景的尺寸。</p><p id="56c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">常量<code class="fe nj nk nl nm b">fps</code>指的是我们希望运行游戏的每秒帧数。</p><p id="945d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，<code class="fe nj nk nl nm b">then</code>用于计时——稍后会详细介绍。</p><h2 id="19b9" class="ob ly it bd lz oc od dn md oe of dp mh ld og oh mj lh oi oj ml ll ok ol mn om bi translated">加载PNG文件</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="96a7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码加载了我们用作游戏资产的PNG图像。</p><p id="eff6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它改编自本文中<a class="ae mu" href="https://go-recipes.dev/manipulating-2d-images-in-go-96106dd1b93f" rel="noopener ugc nofollow" target="_blank">的代码。我将它修改为专门处理PNG图像，并使它返回一个<code class="fe nj nk nl nm b">image.Image</code>类型的图像。</a></p><p id="0138" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本质上，它打开一个包含PNG图像的文件，然后对其进行解码。对于其中的每一步，都有一些基本的错误处理。</p><p id="7565" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">关闭文件是延迟的，所以它总是在程序离开函数时发生——不管错误是否发生。</p><h2 id="826c" class="ob ly it bd lz oc od dn md oe of dp mh ld og oh mj lh oi oj ml ll ok ol mn om bi translated">设置资产、模型和Fyne应用程序</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="9a01" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建一个Fyne应用程序，主窗口以“游戏”为标题。</p><p id="5b25" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用上面定义的<code class="fe nj nk nl nm b">load()</code>功能加载PNG文件。</p><p id="6386" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以Unix毫秒格式找出现在的时间—这是一个int64数字。另存为<code class="fe nj nk nl nm b">now</code>。</p><p id="b993" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建一个游戏结构来保存一些相关的变量。将宽度设置为800，高度设置为500。<code class="fe nj nk nl nm b">fps</code>或每秒帧数设置为10。将<code class="fe nj nk nl nm b">then</code>字段设置为正确的时间<code class="fe nj nk nl nm b">now</code>。</p><p id="07e7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们将<code class="fe nj nk nl nm b">margin</code>字段设置为4。这可以确保我们的玩家不会碰到背景边框。</p><p id="4cf7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们使用<code class="fe nj nk nl nm b">fps</code>变量来计算<code class="fe nj nk nl nm b">fpsInterval</code>。这个变量将在游戏循环中使用——稍后会详细介绍。</p><p id="a23d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完成后，我们将创建一个包含一些重要变量的Player结构。玩家的开始位置将在位置<code class="fe nj nk nl nm b">(100, 200)</code>，其中<code class="fe nj nk nl nm b">(0, 0)</code>在窗口的左上方。</p><p id="fac9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">每个玩家精灵的大小将会是<code class="fe nj nk nl nm b">40px</code>乘<code class="fe nj nk nl nm b">72px</code>。起点<code class="fe nj nk nl nm b">frameX</code>和<code class="fe nj nk nl nm b">frameY</code>都在<code class="fe nj nk nl nm b">0</code>。映射到<em class="oq">上箭头</em>、<em class="oq">下箭头</em>、<em class="oq">左数组</em>和<em class="oq">右箭头</em>键的sprite表行将分别为4、3、0和1。速度设定为<code class="fe nj nk nl nm b">9</code>。<code class="fe nj nk nl nm b">x</code>和<code class="fe nj nk nl nm b">y</code>位置的变化<code class="fe nj nk nl nm b">xMov</code>和<code class="fe nj nk nl nm b">yMov</code>均设置为<code class="fe nj nk nl nm b">0</code>。</p><p id="8615" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建一个名为<code class="fe nj nk nl nm b">img</code>的Fyne画布，并让它保存背景图像。然后将画布的大小设置为背景的原始大小。</p><p id="d6a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在创建一个名为<code class="fe nj nk nl nm b">sprite</code>的空白图像，大小与绘制精灵的背景相同，并将其放入Fyne画布中。这将被称为<code class="fe nj nk nl nm b">playerImg</code>。</p><p id="7669" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还将创建一个名为<code class="fe nj nk nl nm b">spriteSize</code>的变量，稍后会用到它。这个变量保持单人精灵的大小。</p><p id="30a7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后将背景画布<code class="fe nj nk nl nm b">img</code>和精灵画布<code class="fe nj nk nl nm b">playerImg</code>添加到名为<code class="fe nj nk nl nm b">c</code>的Fyne容器中。该容器将根据<code class="fe nj nk nl nm b">MaxLayout</code>布局组织画布。这样做的结果是两个画布都将被设置为最大尺寸。你可以在这里阅读更多关于这个布局<a class="ae mu" href="https://developer.fyne.io/container/max" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="2931" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们将窗口<code class="fe nj nk nl nm b">w</code>的内容设置到容器<code class="fe nj nk nl nm b">c</code>中。</p><p id="912a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">关键事件和游戏循环将在下面讨论。</p><p id="7728" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">窗口<code class="fe nj nk nl nm b">w</code>被设置为显示在屏幕中间。最后，它被告知显示和运行。</p><h2 id="e20c" class="ob ly it bd lz oc od dn md oe of dp mh ld og oh mj lh oi oj ml ll ok ol mn om bi translated">定义关键事件</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="eeca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里我们实现了四个可能的关键事件。假设你应该能够在一部分背景上向四个方向移动玩家角色，我们需要实现这些可能性。</p><p id="4b10" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们首先通过使用函数<code class="fe nj nk nl nm b">Canvas().SetOnTypedKey()</code>将Fyne键事件处理程序附加到窗口<code class="fe nj nk nl nm b">w</code>的画布上。</p><p id="f081" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">switch语句将处理四种情况中的每一种。你可以在这里找到所有键盘按键<a class="ae mu" href="https://github.com/fyne-io/fyne/blob/master/key.go" rel="noopener ugc nofollow" target="_blank">的定义</a>。</p><p id="980d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们检查玩家角色的位置是否在每种可能性的范围内。在这里，我们记得在适当的时候包括<code class="fe nj nk nl nm b">game.margin</code>。</p><p id="c8c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据移动方向，<code class="fe nj nk nl nm b">player.xMov</code>或<code class="fe nj nk nl nm b">player.yMov</code>被设置为<code class="fe nj nk nl nm b">player.speed</code>的正值或负值。此外，通过将<code class="fe nj nk nl nm b">player.frameY</code>设置为特定的行索引来选择正确的子画面行。</p><h2 id="f200" class="ob ly it bd lz oc od dn md oe of dp mh ld og oh mj lh oi oj ml ll ok ol mn om bi translated">游戏循环</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="210f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是游戏循环。这部分程序包含一个无限循环。</p><p id="1c85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于循环的每次迭代，将有1毫秒的暂停。如果需要，这可能会被调整为更长的暂停。</p><p id="9829" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们得到正确的时间<code class="fe nj nk nl nm b">now</code>并将其转换成<code class="fe nj nk nl nm b">int64</code> Unix毫秒。我们将使用它来找出自从我们上次设置<code class="fe nj nk nl nm b">game.then</code>以来<code class="fe nj nk nl nm b">elapsed</code>已经过了多长时间。</p><p id="18a9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果有<code class="fe nj nk nl nm b">elapsed</code>的时间大于<code class="fe nj nk nl nm b">fpsInterval</code>的时间，那么我们将进入实际的游戏力学分支。我们只有在<code class="fe nj nk nl nm b">fpsInterval</code>已经过去时才进入这个分支，以达到正确的游戏速度。</p><p id="4a13" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们将<code class="fe nj nk nl nm b">game.then</code>设置为<code class="fe nj nk nl nm b">now</code>。</p><p id="c863" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了从sprite表中提取一个sprite，我们需要一个起点<code class="fe nj nk nl nm b">spriteDP</code>和一个叫做<code class="fe nj nk nl nm b">sr</code>的矩形，大小为<code class="fe nj nk nl nm b">spriteSize</code>并覆盖这个特定的sprite。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/1a05c2eb1c6c68ec45fe536309cb6087.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*jQXoAEiqF0IpjEQCYSjMPw.jpeg"/></div><p class="nc nd gj gh gi ne nf bd b be z dk translated">特定精灵周围的矩形示例</p></figure><p id="b2d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了将精灵放置在背景之上，我们类似地需要一个玩家的参考点<code class="fe nj nk nl nm b">dp</code>——基于玩家的x和y坐标——以及一个需要绘制精灵的矩形。这个矩形的尺寸也是<code class="fe nj nk nl nm b">spriteSize</code>。</p><p id="4857" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们首先通过填充<code class="fe nj nk nl nm b">image.Transparent</code>来清除<code class="fe nj nk nl nm b">sprite</code>图像。一旦完成，我们可以将特定的精灵从<code class="fe nj nk nl nm b">playerSprites</code>精灵表转移到<code class="fe nj nk nl nm b">sprite</code>图像，并使用<code class="fe nj nk nl nm b">canvas.NewRasterFromImage()</code>创建一个新的光栅。</p><p id="1409" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在游戏循环的最后部分，如果<code class="fe nj nk nl nm b">player.xMov</code>或<code class="fe nj nk nl nm b">player.yMov</code>不为零，我们将确定玩家<code class="fe nj nk nl nm b">x</code>和<code class="fe nj nk nl nm b">y</code>的坐标以及下一个循环的<code class="fe nj nk nl nm b">player.frameX</code>。此外，我们还将通过改变<code class="fe nj nk nl nm b">player.frameX</code>来循环显示该行中的精灵。</p><p id="2d9d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果移动为零，则<code class="fe nj nk nl nm b">player.frameX</code>被设置为零，这是该行中的第一个子画面。这个精灵也代表了角色的静止姿态。</p><p id="3551" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，容器<code class="fe nj nk nl nm b">c</code>被刷新以确保窗口中的图像被更新。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="9462" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">完整的代码</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="4425" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">参考</h1><p id="618a" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated"><a class="ae mu" href="https://www.youtube.com/watch?v=EYf_JwzwTlQ" rel="noopener ugc nofollow" target="_blank">《如何用JavaScript和HTML画布制作游戏|键盘输入&amp;雪碧动画【香草JS】》YouTube上弗兰克斯实验室</a></p><p id="0cec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae mu" href="https://go-recipes.dev/manipulating-2d-images-in-go-96106dd1b93f" rel="noopener ugc nofollow" target="_blank">“在Go中使用图像”，作者Sau Sheong </a></p><p id="e727" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae mu" href="https://go.dev/blog/image-draw" rel="noopener ugc nofollow" target="_blank">Nigel Tao的“Go image/draw package”</a></p></div></div>    
</body>
</html>