<html>
<head>
<title>How to Build a Fullstack App With Next.js, Prisma, Postgres, and Fastify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Next.js、Prisma、Postgres和Fastify构建一个Fullstack应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-build-a-fullstack-app-with-next-js-prisma-postgres-and-fastify-5de189870413?source=collection_archive---------10-----------------------#2022-07-07">https://betterprogramming.pub/how-to-build-a-fullstack-app-with-next-js-prisma-postgres-and-fastify-5de189870413?source=collection_archive---------10-----------------------#2022-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ac82" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建考勤管理应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8f987c06d1ca58f742c51b3c54d6e3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UWpKjbcky5kZCgMh.png"/></div></div></figure><p id="153d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将学习如何使用Next.js、Prisma、Postgres和Fastify构建一个全栈应用程序。我们将构建一个考勤管理演示应用程序来管理员工的考勤。该应用程序的流程很简单:一个管理用户登录，创建一个当天的考勤表，然后每个员工在考勤表上签名和注销。</p><h1 id="f852" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">Next.js是什么？</h1><p id="4fcd" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">js是一个灵活的React框架，它为您提供了创建快速web应用程序的构建块。它通常被称为全栈React框架，因为它使前端和后端应用程序在同一个代码基上使用无服务器功能成为可能。</p><h1 id="2138" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">Prisma是什么？</h1><p id="4ac4" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">Prisma是一个开源的Node.js和Typescript ORM，它极大地简化了SQL数据库的数据建模、迁移和数据访问。在撰写本文时，Prisma支持以下数据库管理系统:PostgreSQL、MySQL、MariaDB、SQLite、AWS Aurora、Microsoft SQL Server、Azure SQL和MongoDB。您可能还想点击这里的<a class="ae mn" href="https://www.prisma.io/docs/reference/database-reference/supported-databases" rel="noopener ugc nofollow" target="_blank"/>来查看所有受支持的数据库管理系统的列表。</p><h1 id="85c5" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">什么是Postgres？</h1><p id="a4ea" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">Postgres也称为PostgreSQL，它是一个免费的开源关系数据库管理系统。它是SQL语言的超集，具有许多特性，允许开发人员安全地存储和扩展复杂的数据工作负载。</p><h1 id="8d5d" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">先决条件</h1><p id="d87e" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">本教程是一个实践演示教程。因此，最好在您的计算机上安装以下软件:</p><ul class=""><li id="0d78" class="mo mp it kw b kx ky la lb ld mq lh mr ll ms lp mt mu mv mw bi translated"><a class="ae mn" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>安装在你的机器上</li><li id="20c7" class="mo mp it kw b kx mx la my ld mz lh na ll nb lp mt mu mv mw bi translated"><a class="ae mn" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>数据库服务器运行</li></ul><p id="77fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本教程的代码可以在Github上的<a class="ae mn" href="https://github.com/Claradev32/attendance" rel="noopener ugc nofollow" target="_blank">这里</a>获得，所以请随意复制它并跟随。</p><h1 id="4d33" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">项目设置</h1><p id="efd5" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">让我们从设置Next.js应用程序开始。要开始，请运行下面的命令。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="8de0" class="nh lr it nd b gy ni nj l nk nl">npx create-next-app@latest</span></pre><p id="c367" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">等待安装完成，然后运行下面的命令来安装我们的依赖项。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="b2da" class="nh lr it nd b gy ni nj l nk nl">yarn add fastify fastify-nextjs iron-session @prisma/client<br/>yarn add prisma nodemon --dev</span></pre><p id="5623" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">等待安装完成。</p><h1 id="fdcd" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">设置Next.js和Fastify</h1><p id="6014" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">默认情况下，Next.js不使用Fastify作为其服务器。要使用Fastify来服务我们的Next.js应用程序，请使用下面的代码片段编辑<code class="fe nm nn no nd b">package.json</code>文件中的脚本字段。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="880d" class="nh lr it nd b gy ni nj l nk nl">"scripts": {<br/>"dev": "nodemon server.js",<br/>"build": "next build",<br/>"start": "next start",<br/>"lint": "next lint"<br/>}</span></pre><h1 id="dd57" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建我们的Fastify服务器</h1><p id="4b5c" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">现在让我们创建一个<code class="fe nm nn no nd b">server.js</code>文件。这个文件是我们应用程序的入口点，然后我们添加<code class="fe nm nn no nd b">require('fastify-nextjs')</code>来包含在fastify中公开Next.js API的插件，以处理渲染。</p><p id="73ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开<code class="fe nm nn no nd b">server.js</code>文件，添加下面的代码片段:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="a4a8" class="nh lr it nd b gy ni nj l nk nl">const fastify = require('fastify')()<br/>async function noOpParser(req, payload) {<br/>return payload;<br/>}<br/>fastify.register(require('fastify-nextjs')).after(() =&gt; {<br/>fastify.addContentTypeParser('text/plain', noOpParser);<br/>fastify.addContentTypeParser('application/json', noOpParser);<br/>fastify.next('/*')<br/>fastify.next('/api/*', { method: 'ALL' });<br/>})<br/>fastify.listen(3000, err =&gt; {<br/>if (err) throw err<br/>console.log('Server listening on &lt;http://localhost:3000&gt;')<br/>})</span></pre><p id="b80f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的代码片段中，我们使用了<code class="fe nm nn no nd b">fastify-nextjs</code>插件，它公开了Fastify中的Next.js API，为我们处理渲染。然后，我们用<code class="fe nm nn no nd b">noOpParser</code>函数解析传入的请求，这使得请求体对我们的Next.js API路由处理程序可用，我们用<code class="fe nm nn no nd b">[fastify.next](&lt;http://fastify.next&gt;</code>命令为我们的应用程序定义了两条路由。然后，我们创建Fastify服务器，并让它监听端口3000。</p><p id="5ae0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在继续用<code class="fe nm nn no nd b">yarn dev</code>命令运行应用程序:应用程序将在<code class="fe nm nn no nd b">localhost:3000</code>运行。</p><h1 id="67e7" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">Prisma设置</h1><p id="2ed7" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">首先，运行以下命令获得基本的Prisma设置:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="20e0" class="nh lr it nd b gy ni nj l nk nl">npx prisma init</span></pre><p id="01f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的命令将创建一个带有<code class="fe nm nn no nd b">schema.prisma</code>文件的prisma目录。这是您的主Prisma配置文件，它将包含您的数据库模式。另外，一个<code class="fe nm nn no nd b">.env</code>文件将被添加到项目的根目录中。打开<code class="fe nm nn no nd b">.env</code>文件，用PostgreSQL数据库的连接URL替换伪连接URL。</p><p id="0a67" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用以下代码替换<code class="fe nm nn no nd b">prisma/schema.prisma</code>文件中的代码:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="ff8f" class="nh lr it nd b gy ni nj l nk nl">datasource db {<br/>url = env("DATABASE_URL")<br/>provider="postgresql"<br/>}<br/>generator client {<br/>provider = "prisma-client-js"<br/>}<br/>model User {<br/>id        Int      @id @default(autoincrement())<br/>createdAt DateTime @default(now())<br/>email     String   @unique<br/>name      String<br/>password  String<br/>role      Role     @default(EMPLOYEE)<br/>attendance     Attendance[]<br/>AttendanceSheet AttendanceSheet[]<br/>}<br/>model AttendanceSheet {<br/>id        Int      @id @default(autoincrement())<br/>createdAt DateTime @default(now())<br/>updatedAt DateTime @updatedAt<br/>createdBy    User?    @relation(fields: [userId], references: [id])<br/>userId  Int?<br/>}<br/>model Attendance {<br/>id        Int      @id @default(autoincrement())<br/>createdAt DateTime @default(now())<br/>updatedAt DateTime @updatedAt<br/>signIn    Boolean @default(true)<br/>signOut   Boolean<br/>signInTime    DateTime @default(now())<br/>signOutTime   DateTime<br/>user    User?    @relation(fields: [userId], references: [id])<br/>userId  Int?<br/>}<br/>enum Role {<br/>EMPLOYEE<br/>ADMIN<br/>}</span></pre><p id="6415" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的代码片段中，我们创建了一个User、AttendanceSheet和Attendance模型，定义了每个模型之间的关系。</p><p id="3816" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，在数据库中创建这些表。运行以下命令:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="2570" class="nh lr it nd b gy ni nj l nk nl">npx prisma db push</span></pre><p id="b415" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行上面的命令后，您应该会在终端中看到如下屏幕截图所示的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/f878b00780a72ba1d1a3670d544206fe.png" data-original-src="https://miro.medium.com/v2/0*2-0jX5WPEOIqnGaA"/></div></figure><h1 id="cbc7" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建效用函数</h1><p id="9e81" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">Prisma设置完成后，让我们创建三个将在我们的应用程序中不时使用的实用函数。</p><p id="118c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开lib/parseBody.js文件，并添加以下代码片段。该函数将请求体解析为JSON:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="c923" class="nh lr it nd b gy ni nj l nk nl">export const parseBody = (body) =&gt; {<br/>if (typeof body === "string") return JSON.parse(body)<br/>return body<br/>}</span></pre><p id="5f28" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开lib/request.js文件，并添加以下代码片段。这个函数发送一个POST请求。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="ea5b" class="nh lr it nd b gy ni nj l nk nl">export const sessionCookie = () =&gt; {<br/>return ({<br/>cookieName: "auth",<br/>password: process.env.SESSION_PASSWORD,<br/>// secure: true should be used in production (HTTPS) but can't be used in development (HTTP)<br/>cookieOptions: {<br/>secure: process.env.NODE_ENV === "production",<br/>},<br/>})<br/>}</span></pre><p id="9383" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开/lib/request.js文件，并添加以下代码片段。这个函数返回一个铁会话的会话属性对象。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="8fc1" class="nh lr it nd b gy ni nj l nk nl">export const sessionCookie = () =&gt; {<br/>return ({<br/>cookieName: "auth",<br/>password: process.env.SESSION_PASSWORD,<br/>// secure: true should be used in production (HTTPS) but can't be used in development (HTTP)<br/>cookieOptions: {<br/>secure: process.env.NODE_ENV === "production",<br/>},<br/>})<br/>}</span></pre><p id="e61e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，将<code class="fe nm nn no nd b">SESSION_PASSWORD</code>添加到。env文件:它应该是至少32个字符的字符串。</p><h1 id="6838" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">设计应用程序</h1><p id="5d70" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">完成了我们的实用功能后，让我们给应用程序添加一些样式。我们为这个应用程序使用css模块，所以打开<code class="fe nm nn no nd b">styles/Home.modules.css</code>文件并添加下面的代码片段:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="3f43" class="nh lr it nd b gy ni nj l nk nl">.container {<br/>padding: 0 2rem;<br/>}<br/>.ma<!-- -->n {<br/>min-height: 100vh;<br/>padding: 4rem 0;<br/>flex: 1;<br/>display: flex;<br/>flex-direction: column;<br/>justify-content: center;<br/>align-items: center;<br/>}<br/>.login {<br/>width: 450px;<br/>}<br/>.login input {<br/>width: 100%;<br/>height: 50px;<br/>margin: 4px;<br/>}<br/>.login button {<br/>width: 100%;<br/>height: 50px;<br/>margin: 4px;<br/>}<br/>.dashboard {<br/>display: grid;<br/>grid-template-columns: 3fr 9fr;<br/>grid-template-rows: 1fr;<br/>grid-column-gap: 0px;<br/>grid-row-gap: 0px;<br/>height: calc(100vh - 60px);<br/>}<br/>.navbar {<br/>height: 60px;<br/>background-color: black;<br/>}</span></pre><h1 id="9e4f" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建侧栏组件</h1><p id="08e9" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">完成样式设计后，让我们创建侧边栏组件来帮助我们导航到应用仪表板上的不同页面。打开components/SideBar.js文件，粘贴下面的代码片段。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="640b" class="nh lr it nd b gy ni nj l nk nl">import Link from 'next/link'<br/>import { useRouter } from 'next/router'<br/>import styles from '../styles/SideBar.module.css'<br/><br/>const SideBar = () =&gt; {<br/><br/>    const router = useRouter()<br/><br/>    const logout = async () =&gt; {<br/><br/>        try {<br/><br/>            const response = await fetch('/api/logout', {<br/>                method: 'GET', <br/>                credentials: 'same-origin', <br/>            });<br/><br/>            if(response.status === 200)  router.push('/')<br/><br/>        } catch (e) {<br/>            alert(e)<br/>        }<br/>  <br/>    }<br/>      <br/><br/>    return (<br/>        &lt;nav className={styles.sidebar}&gt;<br/><br/>            &lt;ul&gt;<br/><br/>                &lt;li&gt; &lt;Link href="/dashboard"&gt; Dashboard&lt;/Link&gt; &lt;/li&gt;<br/><br/>                &lt;li&gt; &lt;Link href="/dashboard/attendance"&gt; Attendance &lt;/Link&gt; &lt;/li&gt;<br/><br/>                &lt;li&gt; &lt;Link href="/dashboard/attendance-sheet"&gt; Attendance Sheet &lt;/Link&gt; &lt;/li&gt;<br/><br/>                &lt;li onClick={logout}&gt; Logout &lt;/li&gt;<br/><br/>            &lt;/ul&gt;<br/><br/>        &lt;/nav&gt;<br/>    )<br/><br/>}<br/><br/>export default SideBar</span></pre><h1 id="0d1a" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">登录页面</h1><p id="8106" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">现在打开page/index.js文件，删除其中的所有代码，并添加以下代码片段。下面的代码向localhost:3000/api/login route发送一个post请求，其中包含通过表单提供的电子邮件和密码。一旦凭证被验证，它调用<code class="fe nm nn no nd b">router.push('/dashboard')</code>方法将用户重定向到localhost:3000/api/dashboard:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="c297" class="nh lr it nd b gy ni nj l nk nl">import Head from 'next/head'<br/>import { postData } from '../lib/request';<br/>import styles from '../styles/Home.module.css'<br/>import { useState } from 'react';<br/>import { useRouter } from 'next/router'<br/><br/>export default function Home({posts}) {<br/><br/>  const [data, setData] = useState({email: null, password: null});<br/><br/>  const router = useRouter()<br/><br/>  const submit = (e) =&gt; {<br/>    e.preventDefault()<br/><br/>    if(data.email &amp;&amp; data.password) {<br/>      postData('/api/login', data).then(data =&gt; {<br/>        console.log(data); <br/><br/>        if (data.status === "success") router.push('/dashboard')<br/>      <br/>      });<br/>    }<br/><br/>  }<br/><br/>  return (<br/>    &lt;div className={styles.container}&gt;<br/>      &lt;Head&gt;<br/>        &lt;title&gt;Login&lt;/title&gt;<br/>        &lt;meta name="description" content="Login" /&gt;<br/>        &lt;link rel="icon" href="/favicon.ico" /&gt;<br/>      &lt;/Head&gt;<br/><br/>      &lt;main className={styles.main}&gt;<br/><br/>        &lt;form  className={styles.login}&gt;<br/><br/>          &lt;input <br/>            type={"text"} <br/>            placeholder="Enter Your Email" <br/>            onChange={(e) =&gt; setData({...data, email: e.target.value})} /&gt;<br/><br/>          &lt;input <br/>            type={"password"}  <br/>            placeholder="Enter Your Password"<br/>            onChange={(e) =&gt; setData({...data, password: e.target.value})} /&gt;<br/><br/>          &lt;button onClick={submit}&gt;Login&lt;/button&gt;<br/><br/>        &lt;/form&gt;<br/>        <br/>      &lt;/main&gt;<br/><br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><h1 id="9e15" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">设置登录API路由</h1><p id="e322" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">现在打开page/api/login.js文件并添加以下代码片段。我们将使用<code class="fe nm nn no nd b">PrismaClient</code>进行数据库查询，而<code class="fe nm nn no nd b">withIronSessionApiRoute</code>是在RESTful应用程序中处理用户会话的铁会话函数。</p><p id="9cb7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个路由处理对localhost:3000/api/login的登录POST请求，并在用户通过身份验证后生成身份验证cookies。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="0e7d" class="nh lr it nd b gy ni nj l nk nl">import { PrismaClient } from '@prisma/client'<br/>import { withIronSessionApiRoute } from "iron-session/next";<br/>import { parseBody } from '../../lib/parseBody';<br/>import { sessionCookie } from '../../lib/session';<br/><br/>export default withIronSessionApiRoute(<br/>    async function loginRoute(req, res) {<br/><br/>      const { email, password } = parseBody(req.body)<br/><br/>      const prisma = new PrismaClient()<br/><br/>      // By unique identifier<br/>      const user = await prisma.user.findUnique({<br/>        where: {<br/>        email<br/>      },})<br/><br/>      if(user.password === password) {<br/><br/>        // get user from database then:<br/>        user.password = undefined<br/>        req.session.user = user<br/>        await req.session.save();<br/><br/>        return res.send({ status: 'success', data: user });<br/><br/>      };<br/><br/>    res.send({ status: 'error', message: "incorrect email or password" });<br/><br/>  },<br/>  sessionCookie(),<br/>);</span></pre><h1 id="db31" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">设置注销API路由</h1><p id="ca5f" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">打开/page/api/logout文件，添加下面的代码片段。该路由处理对localhost:3000/api/logout的GET请求，该请求通过销毁会话cookies来注销用户。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="a909" class="nh lr it nd b gy ni nj l nk nl">import { withIronSessionApiRoute } from "iron-session/next";<br/>import { sessionCookie } from "../../lib/session";<br/><br/>export default withIronSessionApiRoute(<br/>  function logoutRoute(req, res, session) {<br/>    req.session.destroy();<br/>    res.send({ status: "success" });<br/>  },<br/>  sessionCookie()<br/>);</span></pre><h1 id="5a20" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建仪表板页面</h1><p id="aa82" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">该页面为用户提供了签到和签出考勤表的界面。管理员也可以创建考勤表。打开page/dashboard/index.js文件，并添加下面的代码片段。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="7045" class="nh lr it nd b gy ni nj l nk nl">import { withIronSessionSsr } from "iron-session/next";<br/>import Head from 'next/head'<br/>import { useState, useCallback } from "react";<br/>import { PrismaClient } from '@prisma/client'<br/>import SideBar from '../../components/SideBar'<br/>import styles from '../../styles/Home.module.css'<br/>import dashboard from '../../styles/Dashboard.module.css'<br/>import { sessionCookie } from "../../lib/session";<br/>import { postData } from "../../lib/request";<br/><br/>export default function Page(props) {<br/><br/>  const [attendanceSheet, setState] = useState(JSON.parse(props.attendanceSheet));<br/><br/>  const sign = useCallback((action="") =&gt; {<br/><br/>    const body = {<br/>      attendanceSheetId: attendanceSheet[0]?.id,<br/>      action<br/>    }<br/><br/>    postData("/api/sign-attendance", body).then(data =&gt; {<br/><br/>      if (data.status === "success") {<br/><br/>        setState(prevState =&gt; {<br/><br/>          const newState = [...prevState]<br/><br/>          newState[0].attendance[0] = data.data<br/><br/>          return newState<br/><br/>        })<br/>     <br/>      }<br/><br/>    })<br/><br/>  }, [attendanceSheet])<br/><br/>  const createAttendance = useCallback(() =&gt; {<br/><br/>    postData("/api/create-attendance").then(data =&gt; {<br/><br/>      if (data.status === "success") {<br/>        alert("New Attendance Sheet Created")<br/>        setState([{...data.data, attendance:[]}])<br/>      }<br/><br/>    })<br/><br/>  }, [])<br/><br/>  return (<br/>    &lt;div&gt;<br/><br/>      &lt;Head&gt;<br/>        &lt;title&gt;Attendance Management Dashboard&lt;/title&gt;<br/>        &lt;meta name="description" content="dashboard" /&gt;<br/>      &lt;/Head&gt;<br/><br/>      &lt;div className={styles.navbar}&gt;&lt;/div&gt;<br/><br/>      &lt;main className={styles.dashboard}&gt;<br/><br/>        &lt;SideBar /&gt;<br/><br/>        &lt;div className={dashboard.users}&gt;<br/><br/>          {<br/>            props.isAdmin &amp;&amp; &lt;button className={dashboard.create} onClick={createAttendance}&gt;Create Attendance Sheet&lt;/button&gt;<br/>          }<br/>            <br/>          { attendanceSheet.length &gt; 0 &amp;&amp;<br/><br/>            &lt;table className={dashboard.table}&gt;<br/>              &lt;thead&gt;<br/>                &lt;tr&gt; <br/>                  &lt;th&gt;Id&lt;/th&gt; &lt;th&gt;Created At&lt;/th&gt; &lt;th&gt;Sign In&lt;/th&gt; &lt;th&gt;Sign Out&lt;/th&gt; <br/>                &lt;/tr&gt;<br/>              &lt;/thead&gt;<br/><br/>              &lt;tbody&gt;<br/>                &lt;tr&gt;<br/>                  &lt;td&gt;{attendanceSheet[0]?.id}&lt;/td&gt;<br/>                  &lt;td&gt;{attendanceSheet[0]?.createdAt}&lt;/td&gt;<br/><br/>                  {<br/>                    attendanceSheet[0]?.attendance.length != 0 ? <br/>                      &lt;&gt;<br/>                        &lt;td&gt;{attendanceSheet[0]?.attendance[0]?.signInTime}&lt;/td&gt;<br/>                        &lt;td&gt;{<br/>                          attendanceSheet[0]?.attendance[0]?.signOut ? <br/>                          attendanceSheet[0]?.attendance[0]?.signOutTime: &lt;button onClick={() =&gt; sign("sign-out")}&gt; Sign Out &lt;/button&gt; }&lt;/td&gt;<br/>                      &lt;/&gt;<br/>                      :<br/>                      &lt;&gt;<br/>                        &lt;td&gt; &lt;button onClick={() =&gt; sign()}&gt; Sign In &lt;/button&gt; &lt;/td&gt;<br/>                        &lt;td&gt;{""}&lt;/td&gt;<br/>                      &lt;/&gt;<br/>                  }<br/>                &lt;/tr&gt;<br/>              &lt;/tbody&gt;<br/><br/>            &lt;/table&gt;<br/><br/>          }<br/>          <br/>        &lt;/div&gt;<br/><br/>      &lt;/main&gt;<br/><br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="af8e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们使用<code class="fe nm nn no nd b">getServerSideProps</code>来生成页面数据，而<code class="fe nm nn no nd b">withIronSessionSsr</code>是用于处理服务器端呈现页面的铁会话函数。在下面的代码片段中，我们使用考勤表中的一行来查询考勤表的最后一行，其中<code class="fe nm nn no nd b">userId</code>等于存储在用户会话中的用户id。我们还检查用户是否是管理员。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="4353" class="nh lr it nd b gy ni nj l nk nl">export const getServerSideProps = withIronSessionSsr( async ({req}) =&gt; {<br/><br/>  const user = req.session.user<br/><br/>  const prisma = new PrismaClient()<br/><br/>  const attendanceSheet = await prisma.attendanceSheet.findMany({  <br/>    take: 1,<br/>    orderBy: {<br/>      id: 'desc',<br/>    },<br/>    include: { <br/>      attendance: {<br/>        where: {<br/>          userId: user.id<br/>        },<br/>      }<br/>    }<br/>  })<br/><br/>  return {<br/>    props: {<br/>      attendanceSheet: JSON.stringify(attendanceSheet),<br/>      isAdmin: user.role === "ADMIN"<br/>    }<br/>  }<br/><br/>}, sessionCookie())</span></pre><h1 id="f7f2" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">设置创建出勤API路线</h1><p id="f3d6" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">打开page/api/create-attendance.js文件，添加下面的代码片段。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="76fc" class="nh lr it nd b gy ni nj l nk nl">import { PrismaClient } from '@prisma/client'<br/>import { withIronSessionApiRoute } from "iron-session/next";<br/>import { sessionCookie } from '../../lib/session';<br/><br/>  <br/>export default withIronSessionApiRoute( async function handler(req, res) {<br/><br/>    const prisma = new PrismaClient()<br/><br/>    const user = req.session.user<br/><br/>    const attendanceSheet = await prisma.attendanceSheet.create({<br/>        data: {<br/>          userId: user.id,<br/>        },<br/>    })<br/><br/>    res.json({status: "success", data: attendanceSheet});<br/>    <br/>}, sessionCookie())</span></pre><h1 id="42db" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">设置签到API路线</h1><p id="65f6" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">这个路由处理我们对localhost的API POST请求:3000/api/sign-attendance。路由接受POST请求，而<code class="fe nm nn no nd b">attendanceSheetId</code>和<code class="fe nm nn no nd b">action</code>用于签到和退出<code class="fe nm nn no nd b">attendanceSheet</code>。</p><p id="0037" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开/page/api/sign-attendance.js文件，添加下面的代码片段。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="6a31" class="nh lr it nd b gy ni nj l nk nl">import { PrismaClient } from '@prisma/client'<br/>import { withIronSessionApiRoute } from "iron-session/next";<br/>import { parseBody } from '../../lib/parseBody';<br/>import { sessionCookie } from '../../lib/session';<br/><br/>  <br/>export default withIronSessionApiRoute( async function handler(req, res) {<br/><br/>    const prisma = new PrismaClient()<br/><br/>    const {attendanceSheetId, action} = parseBody(req.body)<br/><br/>    const user = req.session.user<br/><br/>    const attendance = await prisma.attendance.findMany({<br/>        where: {<br/>            userId: user.id,<br/>            attendanceSheetId: attendanceSheetId<br/>        }<br/>    })<br/><br/>    //check if atendance have been created<br/>    if (attendance.length === 0) {<br/>        const attendance = await prisma.attendance.create({<br/>            data: {<br/>                userId: user.id,<br/>                attendanceSheetId: attendanceSheetId,<br/>                signIn: true,<br/>                signOut: false,<br/>                signOutTime: new Date()<br/>            },<br/>        })   <br/><br/>        return res.json({status: "success", data: attendance});<br/><br/>    } else if (action === "sign-out") {<br/>        await prisma.attendance.updateMany({<br/>            where: {<br/>                userId: user.id,<br/>                attendanceSheetId: attendanceSheetId<br/>            },<br/>            data: {<br/>              signOut: true,<br/>              signOutTime: new Date()<br/>            },<br/>        })<br/><br/>        return res.json({status: "success", data: { ...attendance[0], signOut: true, signOutTime: new Date()}});<br/>    }<br/><br/>    res.json({status: "success", data: attendance});<br/>    <br/>}, sessionCookie())</span></pre><h1 id="229c" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建出勤页面</h1><p id="d5aa" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">这个服务器端呈现的页面显示了登录用户的所有考勤表。打开/page/dashboard/attendance.js文件，并添加下面的代码片段。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="5e5d" class="nh lr it nd b gy ni nj l nk nl">import { withIronSessionSsr } from "iron-session/next";<br/>import Head from 'next/head'<br/>import { PrismaClient } from '@prisma/client'<br/>import SideBar from '../../components/SideBar'<br/>import styles from '../../styles/Home.module.css'<br/>import dashboard from '../../styles/Dashboard.module.css'<br/>import { sessionCookie } from "../../lib/session";<br/><br/>export default function Page(props) {<br/><br/>  const data = JSON.parse(props.attendanceSheet)<br/><br/>  return (<br/>    &lt;div&gt;<br/><br/>      &lt;Head&gt;<br/>        &lt;title&gt;Attendance Management Dashboard&lt;/title&gt;<br/>        &lt;meta name="description" content="dashboard" /&gt;<br/>      &lt;/Head&gt;<br/><br/>      &lt;div className={styles.navbar}&gt;&lt;/div&gt;<br/><br/>      &lt;main className={styles.dashboard}&gt;<br/><br/>        &lt;SideBar /&gt;<br/><br/>        &lt;div className={dashboard.users}&gt;<br/><br/>        &lt;table className={dashboard.table}&gt;<br/><br/>          &lt;thead&gt;<br/><br/>            &lt;tr&gt; <br/>              &lt;th&gt; Attendance Id&lt;/th&gt; &lt;th&gt;Date&lt;/th&gt; <br/>              &lt;th&gt;Sign In Time&lt;/th&gt; &lt;th&gt;Sign Out Time&lt;/th&gt; <br/>            &lt;/tr&gt; <br/><br/>          &lt;/thead&gt;<br/><br/>            &lt;tbody&gt;<br/><br/>              {<br/>                data.map(data =&gt;   {<br/><br/>                  const {id, createdAt, attendance } = data<br/><br/>  <br/>                  return (<br/>                    &lt;tr key={id}&gt; <br/><br/>                      &lt;td&gt;{id}&lt;/td&gt; &lt;td&gt;{createdAt}&lt;/td&gt;  <br/><br/>                      { attendance.length === 0 ? <br/>                      <br/>                        (<br/>                          &lt;&gt;<br/>                            &lt;td&gt;You did not Sign In&lt;/td&gt;<br/>                            &lt;td&gt;You did not Sign Out&lt;/td&gt;<br/>                          &lt;/&gt;<br/>                        )<br/>                        :<br/>                        (<br/>                          &lt;&gt;<br/>                            &lt;td&gt;{attendance[0]?.signInTime}&lt;/td&gt;<br/>                            &lt;td&gt;{attendance[0]?.signOut ? attendance[0]?.signOutTime : "You did not Sign Out"}&lt;/td&gt;<br/>                          &lt;/&gt;<br/>                        )<br/>                        <br/>                      }<br/>              <br/>                    &lt;/tr&gt;<br/>                  )<br/><br/>                })<br/><br/>              }  <br/><br/>            &lt;/tbody&gt;<br/><br/>          &lt;/table&gt;<br/><br/>        &lt;/div&gt;<br/><br/>      &lt;/main&gt;<br/><br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="3203" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在下面的代码片段中，我们从<code class="fe nm nn no nd b">attendanceSheet</code>表中查询所有的行，并获取出席人数，其中<code class="fe nm nn no nd b">userId</code>等于存储在用户会话中的用户id。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="46d4" class="nh lr it nd b gy ni nj l nk nl">export const getServerSideProps = withIronSessionSsr( async ({req}) =&gt; {<br/><br/>  const user = req.session.user<br/><br/>  const prisma = new PrismaClient()<br/>  <br/>  const attendanceSheet = await prisma.attendanceSheet.findMany({<br/>    orderBy: {<br/>      id: 'desc',<br/>    },<br/>    include: { <br/>      attendance: {<br/>        where: {<br/>          userId: user.id<br/>        },<br/>      }<br/>    }<br/>  })<br/><br/>  return {<br/>    props: {<br/>      attendanceSheet: JSON.stringify(attendanceSheet),<br/>    }<br/>  }<br/><br/>}, sessionCookie())</span></pre><h1 id="ad3c" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">创建考勤表页面</h1><p id="52df" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">这个服务器端呈现的页面显示了所有的考勤表和签入该考勤表的员工。打开/page/dashboard/attendance.js文件，并添加下面的代码片段。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="474d" class="nh lr it nd b gy ni nj l nk nl">import { withIronSessionSsr } from "iron-session/next";<br/>import Head from 'next/head'<br/>import { PrismaClient } from '@prisma/client'<br/>import SideBar from '../../components/SideBar'<br/>import styles from '../../styles/Home.module.css'<br/>import dashboard from '../../styles/Dashboard.module.css'<br/>import { sessionCookie } from "../../lib/session";<br/><br/>export default function Page(props) {<br/><br/>  const data = JSON.parse(props.attendanceSheet)<br/><br/>  return (<br/>    &lt;div&gt;<br/><br/>      &lt;Head&gt;<br/>        &lt;title&gt;Attendance Management Dashboard&lt;/title&gt;<br/>        &lt;meta name="description" content="dashboard" /&gt;<br/>      &lt;/Head&gt;<br/><br/>      &lt;div className={styles.navbar}&gt;&lt;/div&gt;<br/><br/>      &lt;main className={styles.dashboard}&gt;<br/><br/>        &lt;SideBar /&gt;<br/><br/>        &lt;div className={dashboard.users}&gt;<br/><br/>        {<br/>          data?.map(data =&gt; {<br/><br/>            const {id, createdAt, attendance } = data<br/><br/>            return (<br/>              &lt;&gt;<br/><br/>                &lt;table key={data.id} className={dashboard.table}&gt;<br/><br/>                  &lt;thead&gt;<br/>                    <br/>                    &lt;tr&gt; <br/>                      &lt;th&gt; Attendance Id&lt;/th&gt; &lt;th&gt;Date&lt;/th&gt; <br/>                      &lt;th&gt; Name &lt;/th&gt; &lt;th&gt; Email &lt;/th&gt; &lt;th&gt; Role &lt;/th&gt;<br/>                      &lt;th&gt;Sign In Time&lt;/th&gt; &lt;th&gt;Sign Out Time&lt;/th&gt; <br/>                    &lt;/tr&gt; <br/><br/>                  &lt;/thead&gt;<br/><br/>                  &lt;tbody&gt;<br/><br/>                    {<br/>                      (attendance.length === 0)  &amp;&amp;<br/>                      (<br/>                        &lt;&gt;<br/>                        &lt;tr&gt;&lt;td&gt; {id} &lt;/td&gt; &lt;td&gt;{createdAt}&lt;/td&gt; &lt;td colSpan={5}&gt; No User signed this sheet&lt;/td&gt;&lt;/tr&gt;<br/>                        &lt;/&gt;<br/>                      )<br/>                    }<br/><br/>                    {<br/>                      attendance.map(data =&gt; {<br/><br/>                        const {name, email, role} = data.user<br/><br/>                      <br/>                        return (<br/>                          &lt;tr key={id}&gt; <br/><br/>                            &lt;td&gt;{id}&lt;/td&gt; &lt;td&gt;{createdAt}&lt;/td&gt;  <br/><br/>                            &lt;td&gt;{name}&lt;/td&gt; &lt;td&gt;{email}&lt;/td&gt;<br/><br/>                            &lt;td&gt;{role}&lt;/td&gt;<br/><br/>                            &lt;td&gt;{data.signInTime}&lt;/td&gt;<br/><br/>                            &lt;td&gt;{data.signOut ? attendance[0]?.signOutTime: "User did not Sign Out"}&lt;/td&gt;  <br/>                    <br/>                          &lt;/tr&gt;<br/>                        )<br/><br/>                      })<br/><br/>                    }  <br/><br/>                  &lt;/tbody&gt;<br/>                  <br/>                &lt;/table&gt;<br/>              &lt;/&gt;<br/>            )<br/>          })<br/>          <br/>          }<br/><br/>        &lt;/div&gt;<br/><br/>      &lt;/main&gt;<br/><br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="5548" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在下面的代码片段中，我们从<code class="fe nm nn no nd b">attendanceSheet</code>表中查询所有的行，并通过选择姓名、电子邮件和角色来获取出席情况。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="21e9" class="nh lr it nd b gy ni nj l nk nl">export const getServerSideProps = withIronSessionSsr(async () =&gt; {<br/><br/>  const prisma = new PrismaClient()<br/><br/>  const attendanceSheet = await prisma.attendanceSheet.findMany({<br/>    orderBy: {<br/>      id: 'desc',<br/>    },<br/>    include: { <br/>      attendance: {<br/>        include: { <br/>          user: {<br/>            select: {<br/>              name: true, <br/>              email: true, <br/>              role: true<br/>            }<br/>          }<br/>        }<br/>      },<br/>    },<br/><br/>  })<br/><br/>  return {<br/>    props: {<br/>      attendanceSheet: JSON.stringify(attendanceSheet),<br/>    }<br/>  }<br/><br/>}, sessionCookie())</span></pre><h1 id="d044" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">测试应用程序</h1><p id="a18f" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">首先，我们必须将用户添加到数据库中。我们将与Prisma工作室合作。要启动Prisma studio，请运行以下命令:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="9922" class="nh lr it nd b gy ni nj l nk nl">npx prisma studio</span></pre><p id="cb73" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Prisma索引页面如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/ddd4f2e76e8bdb78255a2b81078cf119.png" data-original-src="https://miro.medium.com/v2/0*XD6h2j1of-Gj3vUu"/></div></figure><p id="29a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要创建一个具有管理员角色的数据库用户和多个具有雇员角色的用户，请转到此页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/3ebbce4d423b90c5d3edc89ac20d52d8.png" data-original-src="https://miro.medium.com/v2/0*6OktGvxnFqfH9DCJ"/></div></figure><p id="13e1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">单击添加记录，然后填写必填字段:密码、姓名、电子邮件和角色。完成后，点击绿色的保存1更改按钮。注意，为了简单起见，我们没有散列密码。</p><p id="217b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用<code class="fe nm nn no nd b">yarn dev</code>启动服务器。这将启动服务器并在[localhost:3000](&lt;http://localhost:3000&gt;)上运行应用程序。登录页面如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/d6fcd9b7807c72d00f078893b2ff65bb.png" data-original-src="https://miro.medium.com/v2/0*67neZfqqLvbs2giL"/></div></figure><p id="b8e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用具有管理员角色的用户登录，因为只有管理用户可以创建考勤表。登录成功后，应用程序会将您重定向到您的控制面板。</p><p id="5346" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">点击创建考勤表按钮创建考勤表，然后等待请求完成，考勤表将会出现。用户仪表板如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/46375ad7048b3987cf2104b14db8acf9.png" data-original-src="https://miro.medium.com/v2/0*D6AL8p7AWThj2i1o"/></div></figure><p id="f571" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">考勤表如下所示，点击签到按钮进行签到。登录成功后，将显示登录时间，并显示注销按钮。单击“注销”按钮注销，并对不同的用户重复此过程多次。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/099cd8e4a12293ef833c0f107e20ec29.png" data-original-src="https://miro.medium.com/v2/0*lZ5tPPhZabMpiDw_"/></div></figure><p id="0d8b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，单击侧边栏中的出席链接，查看用户的出席情况。结果应该与下面显示的结果相匹配:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/03a67e6e8746013f1bc999e30ab839b6.png" data-original-src="https://miro.medium.com/v2/0*RHDUOSv-Hovipbha"/></div></figure><p id="923c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来点击侧边栏上的考勤表链接，查看所有用户的出勤情况。结果如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl np"><img src="../Images/7f8255457b40b86a6a047f3efe8dace3.png" data-original-src="https://miro.medium.com/v2/0*50B3ac0avcmd1dq4"/></div></figure><h1 id="824b" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">结论</h1><p id="4bc8" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">在本文中，您学习了如何在Next.js中使用定制的Fastify服务器，还学习了Prisma和Prisma studio。我已经向您介绍了如何将Prisma连接到Postgres数据库，以及如何使用Prisma客户端和Prisma studio创建、读取和更新数据库。</p><p id="a4a9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您还学习了如何使用iron-session对用户进行身份验证。在本教程中，我们使用Next.js、Prisma、Postgres和Fastify构建了一个管理员工出勤的全栈应用程序。请继续关注更多内容，直到下一次。</p></div></div>    
</body>
</html>