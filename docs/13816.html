<html>
<head>
<title>An Implementation of MVPEC (Model-View-Presenter-Equals-Clone) Pattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MVPEC(模型-视图-演示者-等于-克隆)模式的实现</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-mvpec-pattern-keeping-track-of-changes-in-the-gui-64ffc1926f6b?source=collection_archive---------11-----------------------#2022-09-29">https://betterprogramming.pub/the-mvpec-pattern-keeping-track-of-changes-in-the-gui-64ffc1926f6b?source=collection_archive---------11-----------------------#2022-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6e8a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">跟踪GUI中的变化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dce3f0392658120552aa89497727841d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jpagTmcQop4IOmXe"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><p id="b2d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">考虑以下简单的GUI:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/07fafccae1085ae6ab3dcb1accc87f72.png" data-original-src="https://miro.medium.com/v2/resize:fit:514/format:webp/1*gXf3iCiO640dTCtMacpe0Q.png"/></div></figure><ul class=""><li id="e918" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">您可以输入一个名称。</li><li id="24b4" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">你可以检查你是否喜欢咖啡。</li><li id="0094" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">你可以输入你的年龄。</li><li id="78b1" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">你可以点击保存按钮。</li></ul><p id="8b38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能会说这是一个微不足道的例子。但这是你在这个行业工作时会面临的一个常见问题。如果做得好，这样的工作可以启动你的职业生涯。</p><ul class=""><li id="c9c2" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">从数据库中载入一些数据。</li><li id="a1ee" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">在某种GUI中显示数据。</li><li id="6190" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">允许用户编辑该信息。</li><li id="b888" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">将更改保存回数据库。</li></ul><p id="e417" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向您展示一个针对此类任务的久经考验的解决方案，我在几十个应用程序中实现了该解决方案。我称之为MVPEC模式。</p><h1 id="4b05" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">m代表型号</h1><p id="c3d4" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">再看一下GUI。数据代表某种实体。我们需要将该实体提取到一个类中。</p><p id="f151" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们称包装GUI数据的类为模型。</p><p id="6416" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，你可能会得到这样一个类:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6be6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，该类包装了我们的GUI可以编辑的所有数据。这个班级是我们的榜样。</p><h1 id="9a29" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">v代表观点</h1><p id="09ca" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">下一步是定义我们的GUI实际能做什么。我们以界面的形式写下来。</p><p id="fb46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，让我们再看一眼GUI，并通过以下方式提取其用途:</p><ul class=""><li id="40a7" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">GUI应该能够显示我们的模型<code class="fe ng nh ni nj b">Person</code>的数据。</li><li id="43dd" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">GUI应该让我们知道用户是否点击了save按钮。</li></ul><p id="6dd7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仅此而已。我们不希望GUI做更多的事情。</p><p id="b656" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">GUI代码很难编写，也很难测试。让GUI尽可能的简单。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="971e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们称这个接口为视图，它本质上是我们的GUI所能做的事情的契约。</p><p id="6924" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这个例子，我用良好的旧Windows窗体实现了视图。但这只是实现细节——这个概念适用于您喜欢和使用的任何前端堆栈。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="d82b" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">p代表演示者</h1><p id="b052" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">现在我们有了一个模型和一个视图，但是他们彼此不了解。这就是第三类介入的地方。第三个类负责模型和视图之间的同步。我们称这个类为演示者。</p><p id="ef3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">演示者将包含使我们的GUI工作所需的所有逻辑。作为第一步，我们需要演示者简单地将模型转发给视图。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="019c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/how-i-explained-ioc-and-di-to-our-senior-software-engineer-1561d200b9a5">将</a>我们的视图作为<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/how-i-explained-ioc-and-di-to-our-senior-software-engineer-1561d200b9a5">依赖关系</a>注入到我们的演示者中。模型被提供给方法<code class="fe ng nh ni nj b">Present(...)</code>。这个方法所做的就是告诉视图使用哪个模型。</p><p id="68e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们将MVPEC魔法应用到这个演示者之前，让我们看看其他神秘的字母:</p><h1 id="8622" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">e代表平等</h1><p id="ab24" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">为了让这个模式工作，我们需要能够通过内容比较模型的多个实例。我们通过覆盖<code class="fe ng nh ni nj b">Equals(...)</code>方法来做到这一点。</p><blockquote class="nk nl nm"><p id="bdb6" class="kw kx nn ky b kz la jr lb lc ld ju le no lg lh li np lk ll lm nq lo lp lq lr ij bi translated">当所有属性都相等时，我们的模型是相等的。</p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="79c2" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">c代表克隆</h1><p id="a8cb" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我们需要采取的最后一步是在我们的模型中实现<code class="fe ng nh ni nj b">ICloneable</code>。我们的模型的克隆应该是一个新的实例，具有与原始模型相同的内容。</p><p id="8c6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们的MVPEC模型的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="4bfe" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">将这一切结合在一起</h1><p id="798e" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">准备工作的重点是。让我们回到我们的主持人。我们将为视图提供一个克隆，而不是直接为视图设置模型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="e173" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的演示者执行以下操作:</p><ul class=""><li id="be15" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">知道原始模型</li><li id="91a4" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">克隆模型</li><li id="254c" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">将克隆指定给视图</li></ul><p id="e496" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当用户在我们的视图中更改一些数据时，这些更改只在我们模型的克隆实例中生效。这是很大的好处！</p><p id="d6ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于我们的演示者也知道原始模型，他们能够比较两者并检查待定的更改。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="4080" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">了解模型的原始状态和当前状态的能力非常重要，因为它允许我们实现许多方便的特性，例如:</p><ul class=""><li id="e6d7" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">退出时警告用户挂起的更改</li><li id="9a69" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">允许用户重置他的更改</li><li id="8cbd" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">根据是否有待定的更改来启用/禁用保存按钮</li></ul><h1 id="4dd4" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">结论</h1><ul class=""><li id="9a38" class="lt lu iq ky b kz mz lc na lf nr lj ns ln nt lr ly lz ma mb bi translated">MVPEC-Pattern允许我们跟踪用户在GUI中所做的更改。</li><li id="532a" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">它这样做不需要复杂的同步逻辑。</li><li id="9925" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">它还允许我们实现一些重要的特性，比如在可能出现更改丢失之前警告用户。</li><li id="92be" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">它可以用任何类型的UI栈来实现。</li><li id="33e7" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">它让用户界面保持沉默和可测试。</li><li id="cb8d" class="lt lu iq ky b kz mc lc md lf me lj mf ln mg lr ly lz ma mb bi translated">以我的经验，值得打字！</li></ul><p id="0c56" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要害怕无聊的代码——下一个阅读你的代码的开发者会感谢你的！</p></div></div>    
</body>
</html>