<html>
<head>
<title>How To Use Flask-WTForms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Flask-WTForms</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-flask-wtforms-faab71d5a034?source=collection_archive---------2-----------------------#2020-01-07">https://betterprogramming.pub/how-to-use-flask-wtforms-faab71d5a034?source=collection_archive---------2-----------------------#2020-01-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a179" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让表单验证变得轻而易举</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/636183900d5e6a1a5c9e9585608b2f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rxKmbXL_KkBkq3Vs"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Alejandro Escamilla 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="f475" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">元信息</h1><h2 id="e565" class="ly lh it bd li lz ma dn lm mb mc dp lq md me mf ls mg mh mi lu mj mk ml lw mm bi translated">目标</h2><ul class=""><li id="d512" class="mn mo it mp b mq mr ms mt md mu mg mv mj mw mx my mz na nb bi translated">介绍如何使用<a class="ae ky" href="https://flask.palletsprojects.com/en/1.1.x/patterns/wtforms/" rel="noopener ugc nofollow" target="_blank"> Flask-WTForms </a>简化表单生成和验证</li><li id="aa3a" class="mn mo it mp b mq nc ms nd md ne mg nf mj ng mx my mz na nb bi translated">使用Flask-WTForms构建一个只有一个注册页面的功能性<a class="ae ky" href="http://flask.palletsprojects.com/" rel="noopener ugc nofollow" target="_blank"> Flask </a>应用程序。最终产品看起来像:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/9dfe76316160979027a125eaa961ece7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fas3zJ2l9jt5G3clZOgxnA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">自定义样式的注册表单</p></figure><h2 id="646f" class="ly lh it bd li lz ma dn lm mb mc dp lq md me mf ls mg mh mi lu mj mk ml lw mm bi translated">读者假设</h2><ul class=""><li id="a877" class="mn mo it mp b mq mr ms mt md mu mg mv mj mw mx my mz na nb bi translated">了解Python。</li><li id="7a7c" class="mn mo it mp b mq nc ms nd md ne mg nf mj ng mx my mz na nb bi translated">了解Flask的基础知识。</li></ul><h2 id="2735" class="ly lh it bd li lz ma dn lm mb mc dp lq md me mf ls mg mh mi lu mj mk ml lw mm bi translated"><strong class="ak">代码</strong></h2><ul class=""><li id="9216" class="mn mo it mp b mq mr ms mt md mu mg mv mj mw mx my mz na nb bi translated">本文的代码可以在<a class="ae ky" href="https://github.com/Neo-Hao/wtf-registration-form" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="f26c" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">什么是<strong class="ak">烧瓶-WTForms </strong></h1><p id="94a8" class="pw-post-body-paragraph ni nj it mp b mq mr ju nk ms mt jx nl md nm nn no mg np nq nr mj ns nt nu mx im bi translated">当你使用Flask构建一个交互式应用时，你不能避免表单。用于创建表单和处理表单数据(尤其是表单验证)的代码会很快变得难以阅读并且编写起来很乏味。</p><p id="77d8" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">Flask-WTForms是帮助表单验证的一个很好的工具(例如，避免<a class="ae ky" href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)" rel="noopener ugc nofollow" target="_blank">跨站点请求伪造</a> (CSRF))。Flask-WTForms可以帮助创建和使用带有简单Python模型的web表单，将单调乏味的表单验证变得轻而易举。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="289f" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">使用Flask-WTForms</h1><h2 id="da1f" class="ly lh it bd li lz ma dn lm mb mc dp lq md me mf ls mg mh mi lu mj mk ml lw mm bi translated">一个简单的Flask应用程序的基本代码</h2><p id="575a" class="pw-post-body-paragraph ni nj it mp b mq mr ju nk ms mt jx nl md nm nn no mg np nq nr mj ns nt nu mx im bi translated">为了展示Flask-WTForms的强大功能，我们将保持我们的代码库最小化。因此，我们将坚持使用单个Python文件和一个HTML模板。</p><p id="3b1d" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">为了从头开始，我们创建一个名为<code class="fe oa ob oc od b">wtf-registration-form</code>的文件夹，在文件夹中导航，创建并激活虚拟环境，然后安装Flask:</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="0969" class="ly lh it od b gy oi oj l ok ol">$ python3.7 -m venv env<br/>$ source env/bin/activate<br/>(env)$ pip install flask</span></pre><p id="d45d" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">我们的代码库<code class="fe oa ob oc od b">app.py</code>只有大约10行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="ed86" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">相应的HTML文件<code class="fe oa ob oc od b">registration.html</code>到目前为止完全是静态的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="2467" class="ly lh it bd li lz ma dn lm mb mc dp lq md me mf ls mg mh mi lu mj mk ml lw mm bi translated">快速表单生成和验证</h2><p id="dba9" class="pw-post-body-paragraph ni nj it mp b mq mr ju nk ms mt jx nl md nm nn no mg np nq nr mj ns nt nu mx im bi translated"><code class="fe oa ob oc od b">quick_form</code>是一个为完整的Flask-WTF表单输出引导标记的方法。</p><p id="3a48" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">正如你可能猜到的，它同时依赖Flask-Bootstrap和Flask-WTF。<code class="fe oa ob oc od b">quick_form</code>是Flask-WTForms如何使表单生成和验证变得容易的最佳演示之一。</p><p id="5432" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">要使用<code class="fe oa ob oc od b">quick_form</code>，我们需要安装Flask-Bootstrap和Flask-WTF:</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="307c" class="ly lh it od b gy oi oj l ok ol">(env)$ pip install flask_bootstrap<br/>(env)$ pip install Flask-WTF</span></pre><p id="9ff8" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">现在我们可以开始更新<code class="fe oa ob oc od b">app.py</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="22bc" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">有三件事需要解释。</p><ol class=""><li id="66df" class="mn mo it mp b mq nv ms nw md oo mg op mj oq mx or mz na nb bi translated">首先，我们使用Bootstrap并依赖它来设计我们的表单。要加载新安装的引导程序，你只需要在初始化<code class="fe oa ob oc od b">app</code>(一个Flask对象)时说<code class="fe oa ob oc od b">Bootstrap(app)</code>。</li></ol><p id="28a2" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">加载引导程序时，您的HTML模板文件将可以访问一组准备好的引导程序模板文件(包括HTML、CSS和JS文件)，它们位于您的<code class="fe oa ob oc od b">templates</code>文件夹中的<code class="fe oa ob oc od b">Bootstrap</code>文件夹下。</p><p id="3ad7" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">你实际上看不到这个<code class="fe oa ob oc od b">Bootstrap</code>文件夹，你最好参考<a class="ae ky" href="https://pythonhosted.org/Flask-Bootstrap/" rel="noopener ugc nofollow" target="_blank">它的手册</a>来了解如何使用它。</p><p id="611c" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">2.其次，我们创建一个表示表单的对象，并通过<code class="fe oa ob oc od b">render_template</code>方法将其传递给名为<code class="fe oa ob oc od b">registration.html</code>的模板文件。因此，我们可以使用这个表单对象在HTML模板文件中呈现表单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="87f5" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">将生成一个包含各种东西的表单，比如CSFR避免、表单验证和默认引导样式。在上面的模板代码中，它将通过<code class="fe oa ob oc od b">app.py</code>中的<code class="fe oa ob oc od b">render_template</code>方法传递的表单对象作为唯一的变量。</p><p id="6b24" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">3.第三，从<code class="fe oa ob oc od b">app.py</code>到<code class="fe oa ob oc od b">registration.html</code>通过<code class="fe oa ob oc od b">render_template</code>方法传递的form对象是从一个名为<code class="fe oa ob oc od b">RegForm</code>的类中强制转换的，这是我们自己做的。</p><p id="a1d4" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">这个只有15行代码的类将生成一个注册表单，在必要时自动验证每个字段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="9f59" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated"><code class="fe oa ob oc od b">flask_wtf</code>负责将<code class="fe oa ob oc od b">wtfform</code>系在砂箱框架上。我们的<code class="fe oa ob oc od b">RegForm</code>从<code class="fe oa ob oc od b">flask_wtf</code>继承了<code class="fe oa ob oc od b">Form</code>类。关于<code class="fe oa ob oc od b">flask_wtf</code>下的<code class="fe oa ob oc od b">Form</code>类的更多信息，请查看本文。</p><p id="68e5" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated"><code class="fe oa ob oc od b">wtfform</code>是一个不同于<code class="fe oa ob oc od b">flask_wtf</code>的类。当您想到处理表单生成和验证时，这些是<code class="fe oa ob oc od b">wtfform</code>的工作。<code class="fe oa ob oc od b">wtfform</code>定义了一组对应于各种<code class="fe oa ob oc od b">&lt;input&gt;</code>元素的字段。</p><p id="a8fe" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">例如，<code class="fe oa ob oc od b">StringField</code>对应于带有<code class="fe oa ob oc od b">type="text"</code>的<code class="fe oa ob oc od b">&lt;input&gt;</code>元素。<code class="fe oa ob oc od b">StringField</code>的第一个参数是标签，它代表了<code class="fe oa ob oc od b">&lt;input&gt;</code>元素的文本标签。<code class="fe oa ob oc od b">StringField</code>的第二个参数是验证器列表。</p><p id="2d93" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">更具体地说，让我们看看<code class="fe oa ob oc od b">model.py</code>中的这行代码:</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="450e" class="ly lh it od b gy oi oj l ok ol">name_first = StringField('First Name', [validators.DataRequired()])</span></pre><p id="d39c" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">当您启动应用程序时，这一行将生成以下HTML代码:</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="d187" class="ly lh it od b gy oi oj l ok ol">&lt;div class="form-group  required"&gt;<br/>&lt;label class="control-label" for="name_first"&gt;First Name&lt;/label&gt;<br/>&lt;input class="form-control" id="name_first" name="name_first" required="" type="text" value="" autocomplete="off"&gt;<br/>&lt;/div&gt;</span></pre><p id="e377" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">准备好这三个文件后，您可以继续，通过启动Flask应用程序来查看<code class="fe oa ob oc od b">quick_form</code>的实际效果:</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="e2c2" class="ly lh it od b gy oi oj l ok ol">(env)$ python3 app.py</span></pre><p id="cf26" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">你会看到这个:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/c03c34861f1ab5683fa6449bc977d69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQwLdoxSgdpL1n2rkS2PNA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">默认引导样式的注册表单</p></figure><p id="72dd" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">注意，上面的样式只是默认的引导样式。当你使用<code class="fe oa ob oc od b">quick_form</code>时，那是它能做的最好的。</p><h2 id="3c97" class="ly lh it bd li lz ma dn lm mb mc dp lq md me mf ls mg mh mi lu mj mk ml lw mm bi translated">自定义表单生成和验证</h2><p id="f3fe" class="pw-post-body-paragraph ni nj it mp b mq mr ju nk ms mt jx nl md nm nn no mg np nq nr mj ns nt nu mx im bi translated">当您需要定制您的注册表单的样式时(例如，在同一行中列出名字和姓氏的输入)，您必须放弃使用<code class="fe oa ob oc od b">quick_form</code>并手动编写您的HTML模板的样式。</p><p id="ce3a" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">Flask-Bootstrap和Flask-WTF支持另一个名为<code class="fe oa ob oc od b">from_field</code>的方法，该方法可以监听和解析从<code class="fe oa ob oc od b">app.py</code>发送到HTML模板的表单对象。</p><p id="18fe" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">例如，以下几行将名字和姓氏的输入字段放在同一行中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="37ab" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">请注意，<code class="fe oa ob oc od b">from_field</code>方法的第一个参数是对应于输入字段的实例。其余参数指定其他属性，如类、占位符等。</p><p id="16a0" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">此外，值得注意的是，我们需要在表单中包含以下行，以避免CSRF。</p><pre class="kj kk kl km gt oe od of og aw oh bi"><span id="f3d4" class="ly lh it od b gy oi oj l ok ol">{{ form.csrf_token() }}</span></pre><p id="443c" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">当我们使用<code class="fe oa ob oc od b">quick_form</code>时，这部分被自动处理。当我们制作自定义表单模板时，我们必须手动完成。总的来说，自定义模板如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="d678" class="pw-post-body-paragraph ni nj it mp b mq nv ju nk ms nw jx nl md nx nn no mg ny nq nr mj nz nt nu mx im bi translated">自定义模板呈现以下效果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/9dfe76316160979027a125eaa961ece7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fas3zJ2l9jt5G3clZOgxnA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">具有自定义样式的注册表单(同一行上的两个字段和一个蓝色按钮)</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="5ea6" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">相关故事</h1><p id="cd58" class="pw-post-body-paragraph ni nj it mp b mq mr ju nk ms mt jx nl md nm nn no mg np nq nr mj ns nt nu mx im bi translated"><a class="ae ky" href="https://blog.bitsrc.io/what-i-learned-from-developing-a-google-doc-add-on-in-two-weeks-5985675aff81?source=friends_link&amp;sk=f29b2358c8a7acd24abfaa2d544cdba4" rel="noopener ugc nofollow" target="_blank">两周内开发一个谷歌文档插件我学到了什么</a></p></div></div>    
</body>
</html>