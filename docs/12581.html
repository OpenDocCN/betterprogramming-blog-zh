<html>
<head>
<title>How to Make Mutations With Apollo iOS and GraphQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Apollo iOS和GraphQL做突变</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-mutations-with-apollo-ios-and-graphql-131ac77017fa?source=collection_archive---------20-----------------------#2022-06-14">https://betterprogramming.pub/how-to-make-mutations-with-apollo-ios-and-graphql-131ac77017fa?source=collection_archive---------20-----------------------#2022-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="26d0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">iOS中GraphQL与Apollo集成的第2部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/84f60a0655f9d682dcbd3712ea658ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DEVdNOQZozv8YZMr"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">布莱恩·麦高恩在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="e940" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一篇文章中，我解释了如何将GraphQL连接到iOS应用程序。我们连接了Apollo客户端，并通过编写第一个查询来获取数据(来自<code class="fe ls lt lu lv b">Fruits API</code>的水果列表)。</p><h1 id="ce45" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">什么是突变？</h1><p id="47d9" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">由于任何完整的数据平台都需要一种方法来修改服务器端数据，这就是突变的来源。例如，突变可以是用户的注册、登录/退出或编辑他们的昵称。</p><p id="6432" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，查询和突变之间的区别很简单:</p><p id="b0cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">查询是获取数据的一种方式，突变——改变。</p><blockquote class="mt mu mv"><p id="8d2f" class="kw kx mw ky b kz la jr lb lc ld ju le mx lg lh li my lk ll lm mz lo lp lq lr ij bi translated">提示:这两种变异都可以返回对象类型和查询。这可能有助于在突变后获得对象的新状态。</p></blockquote><h1 id="e327" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">第一步。在操场上创造突变</h1><p id="b853" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated"><em class="mw">我们将继续使用API客户端，它是我们在上一篇文章</em>  <em class="mw">中设置的。因此，您可以继续使用相同的代码或</em> <a class="ae kv" href="https://github.com/constzz/Apollo-Medium-Articles/tree/apollo-setup-and-first-query" rel="noopener ugc nofollow" target="_blank"> <em class="mw">克隆这个git repo </em> </a> <em class="mw">并切换到</em>的<em class="mw">pollo-setup-and-first-query分支。</em></p><p id="3a8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<a class="ae kv" href="https://fruits-api.netlify.app/graphql" rel="noopener ugc nofollow" target="_blank">水果API游乐场</a>的文档部分。在这里你可以看到API提供的突变列表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi na"><img src="../Images/6eeb53781c2e6cbb5bc7f88b26573796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*Rv4ajoacTcStO6sgfOj0yg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">水果API的突变</p></figure><p id="9afd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们要添加水果列表中没有提到的水果。为此我们可以使用<code class="fe ls lt lu lv b">addFruit</code>突变。</p><p id="f4d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在操场上打开一个新标签，用<code class="fe ls lt lu lv b">mutation</code>开始写，然后添加一个描述你变异的数据的名字(通常，用和API文档中相同的名字)。</p><blockquote class="mt mu mv"><p id="0f1e" class="kw kx mw ky b kz la jr lb lc ld ju le mx lg lh li my lk ll lm mz lo lp lq lr ij bi translated">提示:不要在查询名的末尾使用突变，因为Apollo会在生成您的<code class="fe ls lt lu lv b">API.swift</code>文件时自动添加。</p></blockquote><p id="6842" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">变异也返回一个<code class="fe ls lt lu lv b">Fruit</code>对象，所以让我们得到我们添加的水果的名字(如果<code class="fe ls lt lu lv b">mutation</code>返回一个对象，需要查询至少一个字段) :</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="dd6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们查询被删除的水果的名字。另外，我为<code class="fe ls lt lu lv b">mutation</code>的参数添加了一个<code class="fe ls lt lu lv b">id</code>，因为API应该知道应该删除哪个水果。“文档”选项卡中提到了突变所需的参数:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/76a21243121b342f4625fcc9e4fab2bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RoQMNrY9n5FOClPgXiswlw.png"/></div></div></figure><blockquote class="mt mu mv"><p id="ee98" class="kw kx mw ky b kz la jr lb lc ld ju le mx lg lh li my lk ll lm mz lo lp lq lr ij bi translated">提示:您可以按照我们在Swift中习惯的方式设置参数的默认值:</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/853595708a12af7e55da0ac96d0cfa38.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*pqGalmDR3MdfegolM-2Y1g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">GraphQL中的默认参数</p></figure><h1 id="a3a9" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">第二步。将创建的突变添加到Xcode</h1><p id="f18f" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">正如我们对查询所做的那样，您添加一个空文件，命名它(我建议您使用与突变相同的名称)，并添加。graphql扩展:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/d01a75bdfd75004360c350867b53cc60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nttNX-_MAfpzN-fV4cW_1w.png"/></div></div></figure><p id="b164" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">复制并粘贴操场上的变异，然后构建项目。</p><p id="d286" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">项目建成后，Apollo在<code class="fe ls lt lu lv b">API.swift</code>中生成<code class="fe ls lt lu lv b">AddFruitMutation</code>类:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/944751e3c874bbef0bb0983d3591adc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zhdr1di25BE9aMzkDdPH6w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">添加AddFruit突变并重建项目后的APi.swift</p></figure><h1 id="306f" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">第三步。执行变异并检查结果</h1><p id="cf0f" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">现在我们可以用<code class="fe ls lt lu lv b">addFruit()</code>函数更新我们的<code class="fe ls lt lu lv b">ViewController </code>,它将使用Apollo客户端执行<code class="fe ls lt lu lv b">AddFruit</code>变异并处理结果:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="f4d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">粘贴这段代码，用你喜欢的任何水果更新它，然后运行应用程序。您可以运行<code class="fe ls lt lu lv b">GetAllFruits</code>查询来检查您的水果是否被添加到数据库中。</p><div class="kg kh ki kj gt ab cb"><figure class="nh kk ni nj nk nl nm paragraph-image"><img src="../Images/0d002257059f907dcd24a4058c6ab6a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*Kul6gpiosJ_mQ6ShBC36gw.png"/></figure><figure class="nh kk nn nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/fc6a1cc197bb3d34ad274bb702d6f3d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*SwulM4Gpk4_kkzjJ5a300Q.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk no di np nq translated">Xcode控制台和水果GetAllFruits查询结果。增加了水果“苹果”</p></figure></div><p id="4be9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在它工作了！你可以在这里克隆最终代码<a class="ae kv" href="https://github.com/constzz/Apollo-Medium-Articles/tree/apollo-making-mutations" rel="noopener ugc nofollow" target="_blank">(切换到</a><a class="ae kv" href="https://github.com/constzz/Apollo-Medium-Articles/tree/apollo-making-mutations" rel="noopener ugc nofollow" target="_blank">Apollo-making-mutations</a>分支)。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="d931" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，Apollo很容易用于变异和查询。</p><p id="f127" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它将参数、突变和数据类型转换成随时可用的Swift代码。更改数据和处理结果非常简单。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="5aac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的下一篇文章中，我将展示如何使用Apollo向请求添加头(以及令牌)。这是您在集成后端时遇到的一个常见问题。</p><p id="c1a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的宝贵时间！</p></div></div>    
</body>
</html>