# 测量您的 Git 历史中提交的节奏

> 原文：<https://betterprogramming.pub/measuring-the-cadence-of-commits-in-git-history-ed58590a3b0e>

## 如何从 git 日志中挖掘数据以构建测试预言

![](img/65c8f8cd106fdde2eb47126ac3af9683.png)

由[迈克尔·纽西格](https://unsplash.com/@mn24?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)在 [Unsplash](https://unsplash.com/s/photos/patterns?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

# Git 日志是神谕的来源

为了正确地测试 Git 存储库中的源代码的任何抽象的“质量”定义，我们需要首先建立一些源代码本身的基线度量。在软件 QA 中，这些基线度量通常被称为**Oracle。**

在软件 QA 行话中，“**Oracle”**是我们用来评估一个测试或一组测试的正确性的方法的总称。当有人看着你的测试结果问“你对那些测试结果有多少信心？”无论你用什么来回答它们，都是一个**神谕。**根据软件测试理论，一个 **oracle** 是任何完整测试的必要组成部分。

在测试 Git 存储库中源代码的质量时，我们可以参考哪些神谕？一个是 Git 历史中提交的**节奏**:代码多久提交一次？了解了这一点，就有可能测试(例如)新代码投入生产的频率，或者现有代码被重构的频率。

# *构建一个 Oracle:“提交的步调*”

在这篇文章的剩余部分，我将从 Git 历史中最简单的计数提交用例开始，构建一个越来越细粒度的提交步调度量。我希望这将是实际有用的(这里显示的代码将与任何 Git repo 一起工作),并且它还将有助于显示如何从数据中构造 oracles。

```
git log --pretty=oneline | wc -l
```

上面的一行 shell 脚本打印出 Git 日志中的提交数量(针对当前分支)。计数是什么意思？这是一个神谕，所以它的确切含义是上下文相关的。

然而，回购中提交的原始数量是一个有用的数据点，表明代码库被其作者触及的频率。例如，长期回购中相对较少的提交将表明开发历史上是以大批量执行的，而不是随着时间的推移许多小提交的首选模式。

为了确定 Git 回购的期限，请使用以下一行 shell 脚本:

```
git log --date=relative --reverse --format="%ad" | head -n1
```

这将打印出回购的相对年龄，这将是一个类似于`36 months ago`的字符串，表明您的回购是在 36 个月前创建的。

为了对任何 Git repo 中的提交节奏有一个大致的了解，您现在可以编写一个三行的 shell 脚本，如下所示，它应该打印出类似于`360 commits since 36 months ago`的内容:

Git 日志中提交节奏的最高级视图。

一旦有了 Git 存储库的年龄，再加上历史上提交次数的计数，就可以得到一个由多个变量组成的度量——这在度量时非常罕见！

然而，上面的 shell 脚本并没有真正达到“cadence ”,因为我们不能使用它的输出来使关于代码如何随时间提交的假设无效。

# 一段时间内提交的频率

Git 日志包含带有时间戳的条目，但它不是一个时间序列。相反，`git log`命令是一个客户机，用于对存储在`.git`目录中的复杂数据结构运行查询。

从 Git 日志中的提交时间戳中构建时间序列的最直接的方法是提取所有提交的时间戳，然后计算在某个时间段内有多少次提交。

例如，在回购的整个生命周期中，每月提交多少次？事实证明，这个问题可以用相对较少的几行代码来回答:

一行 shell 脚本，从 Git repo 中提取每月的提交数量。

上面的脚本是公认的简洁和密集。它应该打印出这样的内容:

```
53    2017-09
82    2017-12
20    2018-01
66    2018-02
49    2018-09
11    2018-10
35    2018-11
41    2019-07
23    2020-01
```

输出是制表符分隔的，这意味着如果您将它重定向到一个文件并给该文件一个`.tsv`扩展名，您可以将它导入到 Excel 或 Google Sheets 中，并立即在您的存储库中可视化每月提交量。您还可以执行标准的数据分析任务，比如在您的 Git 存储库中查找每月提交的平均值、中值和标准差。

请注意，月份是根据您的当前时区*计算的。*如果您不在办公室所在的时区，您可以在脚本的开头更改`TZ`变量的值，以反映您大部分工作发生的时区——例如:`TZ=-0500`。或者，如果你的团队是全球分布的，你可以设置`TZ=UTC`。

# 提交的每周频率

尽管月度节奏是对 Git 回购进行时间序列测量的最直接的方式，但推导出活动的*周*节奏会更有用，因为对于大多数软件团队来说，计划是以周(块)为单位的。

可以使用`[dateutils](http://www.fresse.org/dateutils/)`包中的`dateround`计算提交的每周频率:

将 dateutils 命令添加到上面的配方中，可以按周而不是按月存储提交。

这将再次输出制表符分隔的值(TSV ),您可以将其直接保存到扩展名为`.tsv`的文件中，然后使用数据可视化工具进行可视化。

现在我将总结一下，因为已经深入到提交的每周节奏，我们已经达到了足够细粒度的 Git 度量，可以在讨论代码质量时使用。换句话说，我们得到了一个有用的神谕！