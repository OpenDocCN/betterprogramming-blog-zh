<html>
<head>
<title>Building an Asp.Net Core Windows Service Task Scheduler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建Asp.Net核心Windows服务任务计划程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/asp-net-core-windows-service-task-scheduler-daily-weekly-monthly-700a569d502a?source=collection_archive---------3-----------------------#2019-08-12">https://betterprogramming.pub/asp-net-core-windows-service-task-scheduler-daily-weekly-monthly-700a569d502a?source=collection_archive---------3-----------------------#2019-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="69bf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">每天、每周或每月使用Quartz和DI创建zip文件并上传到Azure blob存储</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/e603d9b7d284974a7ee970abc2daf3f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*FDxFG-t-ctp8cnBli0PRfQ.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Windows服务日志</p></figure><h1 id="d8fe" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">介绍</h1><p id="3e52" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">Windows服务是减少我们必须在系统中做的一些手工工作的好方法。在这篇文章中，我们将使用Asp.Net核心编写一个Windows服务。分配给此Windows服务的作业如下:</p><ol class=""><li id="24e8" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh mp mq mr ms bi translated">压缩文件夹并将文件保存到特定的目录</li><li id="b672" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">将压缩文件夹上传到Azure blob存储</li></ol><p id="0531" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">上述任务将每天、每周或每月运行。我们使用带有依赖注入的Quartz调度程序来完成这些令人惊奇的任务。我们使用Nlog来记录我们任务的细节。如果你对此感兴趣，那么你来对地方了。让我们制定一个完美的日程表。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="2cf3" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">源代码</h1><p id="06c7" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">这个项目的源代码已经上传到GitHub。请随意派生、开始、创建拉动请求等。这里可以找到<a class="ae nn" href="https://github.com/SibeeshVenu/Perfect-Scheduler" rel="noopener ugc nofollow" target="_blank"> <strong class="lo iu">的储存库</strong> </a>。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="d09a" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">创建我们完美的调度程序</h1><p id="8c94" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">正如我前面提到的，我们正在用Asp.Net核心创建一个Windows服务。从技术上讲，没有直接的方法可以做到这一点，因为Visual Studio中不提供带有Asp.Net核心模板的Windows服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/2e62de82c49dea0b41575e77d1fd0ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/0*BMBoBTGx7l0aCEP5.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">没有Windows服务项目模板</p></figure><p id="9cc0" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">因此，我们将创建一个Asp.Net控制台应用程序，然后安装一个作为Windows服务生成的可执行文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/68189fa8f1a6ee195dfa1e0246f8806a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/0*2p-cQjgIa2-oSTDr.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">。网络核心控制台应用程序</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="188a" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">创建Asp.Net控制台应用程序</h1><p id="1086" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">打开Visual Studio，搜索项目模板控制台应用程序(。Net Core)，并根据您的方便命名解决方案。我将这个项目命名为Perfect Scheduler，因为我认为我们可以通过创建许多pull请求来完善这个Windows服务。</p><p id="6619" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">一旦创建了应用程序，就安装我们所有的依赖项，这样我们就不需要担心它们了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/50f7536dc02c3b901b106fe40b14388f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*oFJT8yzcMjyRByJG.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Asp。Net核心Windows服务依赖项</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="6786" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">编写服务</h1><p id="73aa" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">因为我们已经安装了所有的依赖项，所以我们准备创建我们的服务。添加一个名为<code class="fe np nq nr ns b">BackupService</code>的新类，并从<code class="fe np nq nr ns b">IHostedService</code>继承相同的类，后者是微软的一部分。扩展。承载命名空间。</p><p id="40b3" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated"><code class="fe np nq nr ns b">IHostedService</code>有如下两个方法，所以我们应该在我们的服务类中实现它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">IHostedService</p></figure><h2 id="7b6f" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">开始异步</h2><p id="6b12" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">StartAsync方法可以按如下方式实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">开始异步</p></figure><p id="7b92" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">正如你在上面代码的第一行看到的，我们正在获取Quartz的调度程序。让我们创建一个方法并返回一个调度程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">GetScheduler</p></figure><p id="4e54" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">下一步是构建一个服务提供者，这样我们就可以使用构造函数依赖注入来注入我们的依赖。默认情况下，Quartz不会这样做，所以我们必须自己构建配置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">GetConfiguredServiceProvider</p></figure><p id="c643" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">如您所见，我们已经为<code class="fe np nq nr ns b">DailyJob</code>、<code class="fe np nq nr ns b">WeeklyJob</code>、<code class="fe np nq nr ns b">MonthlyJob</code>和<code class="fe np nq nr ns b">HelperService</code>配置了服务。我们将很快创建这些类和接口。</p><p id="2a6f" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">一旦我们获得了服务提供者，我们就可以将它传递给我们的定制作业工厂，我们将很快实现它。现在，我们可以启动调度程序并调度我们的作业，请确保您对触发器和作业使用不同的身份名称。样品如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">作业和触发器</p></figure><h2 id="eecd" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">停止异步</h2><p id="00cb" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><code class="fe np nq nr ns b">StopAsync</code>方法可以按如下方式实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">停止异步</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="9fad" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">创建作业生成器和触发器生成器</h1><p id="5b5a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在我们可以为每天、每周和每月的作业创建接口和类。为此，创建一个名为Helpers的新文件夹和另一个名为Interfaces inside的文件夹。下面是您需要创建的接口。</p><h2 id="cdf6" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">IDailyJob</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">IDailyJob</p></figure><h2 id="a5f6" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">我每周工作</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">我每周工作</p></figure><h2 id="6b2f" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">IMonthlyJob</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">IMonthlyJob</p></figure><h2 id="b8b0" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">IHelperService</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">IHelperService</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="443f" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">创建自定义作业工厂</h1><p id="5c8d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">为了实现依赖注入，我们需要创建自己的定制作业工厂。在Helper文件夹中创建一个类，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">定制工作工厂</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="c1fc" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">实施作业构建器接口</h1><p id="fea8" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在是时候实施我们的每日、每周和每月工作构建器了。</p><h2 id="23f7" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">日常工作</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">日常工作</p></figure><h2 id="ec88" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">每周工作</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">每周工作</p></figure><h2 id="34fa" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">每月工作</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">每月工作</p></figure><p id="6b3b" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">我们已经为每个作业配置了单独的类，并通过构造函数注入了依赖关系<code class="fe np nq nr ns b">IHelperService</code>。将来，我们应该能够为这里的每个作业编写自定义逻辑，因为它们在单独的类中。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="357f" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">实现HelperService</h1><p id="3e01" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在我们开始实现这个服务之前，让我们现在配置NLog，因为我们将从这个类中写入日志。</p><h2 id="59b9" class="nv kv it bd kw nw nx dn la ny nz dp le lv oa ob lg lz oc od li md oe of lk og bi translated">配置NLog</h2><p id="f105" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">要配置NLog，创建一个新的配置文件<code class="fe np nq nr ns b">NLog.config</code>并编辑内容，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">nllog . config</p></figure><p id="ce74" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">现在，创建一个方法<code class="fe np nq nr ns b">SetUpNLog()</code>并添加如下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">设置日志</p></figure><p id="2fee" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">请确保您已经添加了一个属性<code class="fe np nq nr ns b">ILogger _logger</code>。</p><p id="111d" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">我们可以用所有必要的私有和公共方法如下实现<code class="fe np nq nr ns b">HelperService</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">帮助者服务</p></figure><p id="308f" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">将为每个调度调用方法<code class="fe np nq nr ns b">PerformService</code>(字符串调度)，它将确保执行以下任务。</p><ol class=""><li id="e8e2" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh mp mq mr ms bi translated">压缩文件夹并将文件保存到特定的目录</li><li id="f079" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh mp mq mr ms bi translated">将压缩文件上传到Azure blob存储</li></ol><p id="db64" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">这里，变量和blob存储容器名称的值是相同的，或者是每天、每周或每月。如果你不确定如何将blob上传到Azure存储帐户，我强烈建议你在这里阅读我的文章<a class="ae nn" href="https://sibeeshpassion.com/timertrigger-azure-function-to-upload-to-azure-blob-daily/#azure-function-and-azure-blob" rel="noopener ugc nofollow" target="_blank"><strong class="lo iu"><em class="oh"/></strong></a>。</p><p id="e685" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">记得在<code class="fe np nq nr ns b">App.config</code>文件中设置<code class="fe np nq nr ns b">FolderToZipLocation</code>(文件应该保存的位置)、<code class="fe np nq nr ns b">FolderFromZipLocation</code>(文件应该从哪里取出)和<code class="fe np nq nr ns b">StorageConnectionString</code>的值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">App.config</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="d5cc" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">设置程序</h1><p id="bb27" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">如你所知，<code class="fe np nq nr ns b">Program</code>类是我们控制台应用程序的开始，现在是时候从<code class="fe np nq nr ns b">Program</code>类调用我们的<code class="fe np nq nr ns b">BackupService</code>了。让我们编辑如下所示的<code class="fe np nq nr ns b">Program</code>类的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">程序</p></figure><p id="4592" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">如果我们在本地运行应用程序/调试，我们调用扩展方法<code class="fe np nq nr ns b">RunConsoleAsync()</code>或者我们调用我们自己的定制扩展方法<code class="fe np nq nr ns b">RunTheServiceAsync()</code>。行<code class="fe np nq nr ns b">services.AddHostedService()</code>非常重要，因为这是我们注册<code class="fe np nq nr ns b">IHostedService</code>的地方，也就是<code class="fe np nq nr ns b">BackupService</code>。下面是我们扩展方法的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">ServiceBaseLifetimeExtension</p></figure><p id="9016" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">在<code class="fe np nq nr ns b">ServiceLifetime</code>类中，我们覆盖了<code class="fe np nq nr ns b">ServiceBase</code>类中的方法。实现如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">服务寿命</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="ad12" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">创建Windows服务</h1><p id="81a2" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">由于我们已经创建了Asp.Net核心控制台应用程序，现在是时候从它创建一个windows服务了。确保您已经在项目的属性中设置了<code class="fe np nq nr ns b">RuntimeIdentifier</code>到<code class="fe np nq nr ns b">win7-x64</code>和<code class="fe np nq nr ns b">SelfContained</code>到<code class="fe np nq nr ns b">true</code>，这将确保您的所有依赖项都被添加到您的可执行文件中，这样您就不需要担心手动处理您的依赖项了。你可以在这里 了解更多<a class="ae nn" href="https://docs.microsoft.com/en-us/dotnet/core/deploying/#self-contained-deployments-scd" rel="noopener ugc nofollow" target="_blank"> <strong class="lo iu">。为此，右键单击项目，然后单击编辑项目文件。最后，您的<code class="fe np nq nr ns b">csproj</code>文件应该类似于:</strong></a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">后援。Service.csproj</p></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="7007" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">创建发布配置</h1><p id="f7dd" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在尝试安装服务之前，您还应该使用发布配置运行<code class="fe np nq nr ns b">dotnet publish</code>命令，因为您需要这个可执行文件来安装服务。</p><p id="713b" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">使用管理员权限打开命令提示符，并使用<code class="fe np nq nr ns b">cd</code>命令转到项目根文件夹。运行命令<code class="fe np nq nr ns b">dotnet publish --configuration=release</code>。</p><p id="a147" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">这将产生你想要的一切。如果您正确运行该命令，您应该会看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/e0661956d44f61e516c67674ad785346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/0*txfexw1hpY09APno.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">Dotnet发布版本</p></figure><p id="45e0" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">现在转到<code class="fe np nq nr ns b">bin</code>文件夹，然后是<code class="fe np nq nr ns b">release</code>文件夹，你应该会看到一个名为<code class="fe np nq nr ns b">netcoreapp2.1</code>的文件夹。在这个文件夹里面，会有一个名为<code class="fe np nq nr ns b">win7-x64</code>的文件夹，这是你的。exe文件、日志文件和其他项目。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="80cf" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">安装服务</h1><p id="83b3" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">要将我们的Asp.Net控制台应用程序安装为Windows服务，您可以使用<code class="fe np nq nr ns b">sc</code>命令。以管理员权限打开命令提示符，并运行命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">延迟开始的SC创建</p></figure><p id="1111" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">然后您可以通过运行命令<code class="fe np nq nr ns b">sc start BackupService</code>来启动服务。这将启动您的服务。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="caca" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">授予文件夹权限</h1><p id="752b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">有时您可能会在服务中遇到权限问题，因为它没有足够的权限从c盘读取文件。为了克服这个问题，您应该给用户足够的权限。您可以通过编辑这些文件夹的安全属性来做到这一点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/df726b82ffe7eeb435524eb42f60f0ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/0*ZOEuwXW06NhvAtyP.png"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">为用户设置权限</p></figure><p id="adc7" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">对<code class="fe np nq nr ns b">BackupZip</code>文件夹也进行同样的操作。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="9976" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">输出</h1><p id="21ed" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">如果您正确运行服务，您应该在您的<code class="fe np nq nr ns b">win7-x64 folder</code>中看到一个名为<code class="fe np nq nr ns b">backupclientlogfile.txt</code>的日志文件。一旦服务运行，日志将按如下方式写入。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div><p class="kq kr gj gh gi ks kt bd b be z dk translated">完美的调度输出</p></figure><p id="5a64" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">您还可以检查您的Azure存储帐户，以检查文件是否已正确上传。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="b3de" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">结论</h1><p id="3a6b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">哇！我们了解到:</p><ul class=""><li id="486c" class="mi mj it lo b lp mk ls ml lv mm lz mn md mo mh oj mq mr ms bi translated">关于Windows服务和Asp.Net控制台应用程序</li><li id="4af3" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh oj mq mr ms bi translated">关于如何使用Asp.Net核心创建Windows服务</li><li id="7a59" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh oj mq mr ms bi translated">关于如何使用Quartz调度程序</li><li id="3f2a" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh oj mq mr ms bi translated">关于如何在Windows服务中使用NLog</li><li id="62ed" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh oj mq mr ms bi translated">关于如何配置Quartz调度程序使用依赖注入</li><li id="d9b7" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh oj mq mr ms bi translated">关于如何压缩文件夹并保存文件</li><li id="d452" class="mi mj it lo b lp mt ls mu lv mv lz mw md mx mh oj mq mr ms bi translated">关于如何将文件上传到Azure blob存储</li></ul></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="d71d" class="ku kv it bd kw kx ni kz la lb nj ld le jz nk ka lg kc nl kd li kf nm kg lk ll bi translated">轮到你了。你怎么想呢?</h1><p id="f997" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">非常感谢你的阅读。我错过了你认为这篇文章需要的东西吗？你觉得这篇文章有用吗？别忘了在评论里和我分享你的想法！</p><p id="9cab" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv my lx ly lz mz mb mc md na mf mg mh im bi translated">最亲切的问候<br/> Sibeesh Venu</p></div></div>    
</body>
</html>