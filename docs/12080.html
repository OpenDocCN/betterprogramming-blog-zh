<html>
<head>
<title>Refactoring for Scalable Python Code With Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Pandas重构可伸缩Python代码</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/refactoring-for-scalable-python-code-with-pandas-727d15f14852?source=collection_archive---------7-----------------------#2022-05-10">https://betterprogramming.pub/refactoring-for-scalable-python-code-with-pandas-727d15f14852?source=collection_archive---------7-----------------------#2022-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c7c2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用于编写可伸缩数据争论管道的Python设计模式</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5d2bde613d2fd650ce84ffa12d653620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7_n3P06JFY77Vsbq"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@siora18?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Siora摄影</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="f52b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Python的一些优点是它的灵活性和简单性。然而，这些能力是一把双刃剑。如果您没有在早期投入工作来设计可重用、可管理和可测试的代码，那么当您的代码库扩展时，您将会遇到进度问题。</p><p id="8a7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当使用Python的Pandas模块时，很容易脱离面向对象的编码风格。一个常见的陷阱是编写快速代码，这变得难以测试和难以扩展。</p><p id="7f6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章展示了在与熊猫争论数据时，可重用和低维护代码的设计模式。</p><h1 id="36ea" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">🪖员额目标</h1><ol class=""><li id="d53b" class="mk ml iq ky b kz mm lc mn lf mo lj mp ln mq lr mr ms mt mu bi translated">与熊猫一起建立度量管道</li></ol><p id="c440" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.重构管道，使其易于扩展和测试</p><p id="cda9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">🐍代码库在这里找到了<a class="ae kv" href="https://github.com/CharlieShelbourne/data-manipulation" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="6c72" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">🦄资料组</h1><p id="1e7a" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">我们将使用来自Kaggle的一个免费数据集，其中包含:<em class="my">“世界上</em> <strong class="ky ir"> <em class="my">独角兽公司</em> </strong> <em class="my">的完整列表。”</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/18f12c5357b47c6377da9dd032c771a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0ofKy_xZYHN-9hqURa69Q.png"/></div></div></figure><p id="3b75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">上下文</strong></p><blockquote class="na nb nc"><p id="4c5f" class="kw kx my ky b kz la jr lb lc ld ju le nd lg lh li ne lk ll lm nf lo lp lq lr ij bi translated">“独角兽公司，或独角兽创业公司，是估值超过10亿美元的私人公司。截至2022年3月，全球共有1000家独角兽。受欢迎的前独角兽包括Airbnb、脸书和谷歌。变体包括价值超过100亿美元的十粒玉米和价值超过1000亿美元的百粒玉米。</p></blockquote><p id="1929" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">📊Kaggle独角兽公司数据集在这里找到了<a class="ae kv" href="https://www.kaggle.com/datasets/deepcontractor/unicorn-companies-dataset" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="17e6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">🧱建立指标管道</h1><p id="e1fa" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">我们将使用熊猫构建3个独角兽统计表。</p><ol class=""><li id="48a7" class="mk ml iq ky b kz la lc ld lf ng lj nh ln ni lr mr ms mt mu bi translated">国家级指标</li><li id="40fa" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr mr ms mt mu bi translated">国家一级的时间序列指标</li><li id="5dfc" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr mr ms mt mu bi translated">投资者指标</li></ol><h2 id="ca18" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">🏆熊猫制胜组合方法</h2><p id="93e6" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">我们将使用Pandas方法的组合，轻松处理数据并保持我们的管道整洁。</p><ul class=""><li id="1883" class="mk ml iq ky b kz la lc ld lf ng lj nh ln ni lr oa ms mt mu bi translated"><code class="fe ob oc od oe b">pandas.DataFrame.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.explode.html" rel="noopener ugc nofollow" target="_blank">explode</a></code>或<code class="fe ob oc od oe b">pandas.DataFrame.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.explode.html" rel="noopener ugc nofollow" target="_blank">melt</a></code></li><li id="4190" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated"><code class="fe ob oc od oe b">pandas.DataFrame.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html" rel="noopener ugc nofollow" target="_blank">groupby</a></code></li><li id="0cb1" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated"><code class="fe ob oc od oe b">pandas.DataFrame.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.reset_index.html" rel="noopener ugc nofollow" target="_blank">reset_index</a></code></li><li id="0bf8" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated"><code class="fe ob oc od oe b">pandas.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html" rel="noopener ugc nofollow" target="_blank">merge</a></code></li></ul><h2 id="43b4" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">🌍国家级统计</h2><p id="73c9" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">首先，我们将计算每个国家的独角兽数量和每个国家的平均独角兽估值(以十亿计)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/9f5ad0f7c0ce36e923037a17f5916f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WMkp74NY17zveW8c88NJjA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输出</p></figure><p id="d419" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">📈使用<em class="my"> country_stats </em>输出表</strong>的示例图</p><p id="c09f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的图是用我们的<code class="fe ob oc od oe b">country_stats</code>表制作的图的一个例子。我们可以很快看到美国在独角兽公司总数上领先世界。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/d6f1cf1b5daab25b94892a934c035d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZN2SPGgGsgwR5gcI1eNvg.png"/></div></div></figure><h2 id="1b44" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">⏳国家一级时间序列</h2><p id="ca50" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">对于这些指标，我们按<em class="my">国家</em>和<em class="my">日期加入</em>列分组，以计算一段时间内独角兽的数量，并对估值求和。</p><p id="11ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">💡<em class="my">注意，我之前按照日期加入对数据帧进行了排序。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/81e5b23b7140e0a20256a6957eb3d89b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2egO-8Oa839eUKyupIqtNg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输出</p></figure><h2 id="665d" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">➕累积时间序列</h2><p id="f7f5" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">到目前为止，我们只生成了该时间点的时序指标。然而，查看一段时间内的累计总和更容易。</p><p id="8b2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些步骤采用生成的<code class="fe ob oc od oe b">time_series</code>表，并使用一个扩展窗口来计算累积和。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/272f1aede633abb1a854ca23567291e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssBIMyO9xsOXgMA-LyuQHA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输出</p></figure><p id="70f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">📈使用<em class="my">时间序列</em>输出表</strong>的示例图</p><p id="56ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的时间序列图是根据我们对每个国家独角兽数量的累积结果绘制的。我们可以看到，自2020-2021年以来，美国已经达到了一个生产独角兽的轨迹，这是中国无法比拟的。与此同时，印度和英国可能刚刚开始它们的增长阶段。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/b36aef34667f3e65b104869c88093155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ieXDjAAT29ulvpF9UhPCiA.png"/></div></div></figure><h2 id="42a2" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">🧑‍💼投资者统计</h2><p id="4cc2" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">生成投资者指标更加复杂。每家公司的投资者都存储为一个用逗号分隔的字符串。</p><p id="ffcf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">比如，《Avant》有<em class="my">select _ investors</em>“RRE创投、老虎环球、八月资本”。</p><p id="ffdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们希望重用相同的代码格式，就像国家级指标一样，以利用<code class="fe ob oc od oe b">pandas.DataFrame.groupby</code>方法。这将有助于我们以后的重构。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/12e12238129fbd2a83a357cd1c2d033d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YO1dSjfB6Pa-8QlgR151Mg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">示例输出</p></figure><h2 id="6ede" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">🏗非中枢投资者</h2><p id="eac1" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">Un-pivoting是这种设计模式的关键，因为我们希望对个人投资者使用<code class="fe ob oc od oe b">groupby</code>方法。</p><p id="7912" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe ob oc od oe b">pandas.DataFrame.explode</code>，我们为个人投资者生成一个额外的列。注意，现在我们的表中每个公司有多行。</p><p id="34e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">💡<em class="my">这里我使用了</em> <code class="fe ob oc od oe b"><a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.explode.html" rel="noopener ugc nofollow" target="_blank">explode</a></code> <em class="my">来取消透视。另外一种结账方法是</em> <code class="fe ob oc od oe b"><a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.melt.html" rel="noopener ugc nofollow" target="_blank">melt</a></code> <em class="my">。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/ceef917413889cb1790e06c34793a32b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YNTEdzvSX4DvIGutFwP3Fg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">输出</p></figure><p id="061a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是在每个投资者的投资组合中生成简单的投资者统计数据、公司数量和公司估值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="920e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">📈示例图使用<em class="my"> investors_stats </em>和</strong></p><p id="e877" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的柱状图显示了投资者投资组合中独角兽总数的分布情况。我们看到幂律型分布，其中大多数投资者只有一只独角兽，而很少有人投资了很多只。这种类型的分布也可以在人口、货币财富和社会网络中找到。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/c9b93bed2343624c33a9b7da6239e004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KFLxdTWaPMuMgtlJgMtaNQ.png"/></div></div></figure><h1 id="ff04" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">🔧迄今为止的管道</h1><p id="9915" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">到目前为止，我们有一个看起来相当整洁的指标管道，但是我们总共只生成了8个指标。如果我们将它扩展到20-30梅蒂克，我们的脚本将开始出现大量重复。</p><p id="4626" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，我们代码的格式是一个简单的python脚本。因此，我们的代码不能被隔离和单元测试。</p><p id="7b3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们唯一的测试选项是运行整个脚本，并在端到端的风格测试中评估输出。这不是很好，因为它可能需要很长时间来运行。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><h1 id="5661" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">🚧管道重构</h1><h2 id="79ff" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">🚪开闭原理</h2><blockquote class="na nb nc"><p id="4e73" class="kw kx my ky b kz la jr lb lc ld ju le nd lg lh li ne lk ll lm nf lo lp lq lr ij bi translated"><em class="iq">“</em>打开进行扩展，关闭进行修改。”</p></blockquote><p id="b5c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">重构我们的代码，尽可能遵循开闭原则。</p><ol class=""><li id="b092" class="mk ml iq ky b kz la lc ld lf ng lj nh ln ni lr mr ms mt mu bi translated">将度量函数移动到度量类中，并使用<code class="fe ob oc od oe b">pandas.DataFrame.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.apply.html" rel="noopener ugc nofollow" target="_blank">apply</a></code>方法。</li><li id="bb51" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr mr ms mt mu bi translated">使用Python内置的<code class="fe ob oc od oe b"><a class="ae kv" href="https://docs.python.org/3/library/functions.html#getattr" rel="noopener ugc nofollow" target="_blank">getattr</a></code>函数，用一个<code class="fe ob oc od oe b">generate_metrics</code>函数删除对<code class="fe ob oc od oe b">pandas.DataFrame.groupby</code>的重复调用。</li><li id="d792" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr mr ms mt mu bi translated">创建一个度量配置文件，该文件被传递给我们的<code class="fe ob oc od oe b">generate_metrics</code>函数，其中包含生成度量所需的元数据。</li></ol><p id="6a86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">💡<em class="my">查看立体设计原理</em> <a class="ae kv" href="https://www.digitalocean.com/community/conceptual_articles/s-o-l-i-d-the-first-five-principles-of-object-oriented-design" rel="noopener ugc nofollow" target="_blank"> <em class="my">此处</em> </a> <em class="my">。</em></p><h2 id="7c55" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">🧑‍🎓度量类别</h2><p id="1b6a" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">通过将我们的度量转移到一个类，我们可以隔离度量，并为每个度量构建单元测试。通过使用熊猫。DataFrame.apply方法，我们可以添加个性化的指标，并利用Pandas中不包含的其他python包。</p><p id="b735" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">遵循开闭原则，如果我们想要添加度量，我们将创建一个继承我们的类度量的新类。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><h2 id="bbfc" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">📂配置文件</h2><p id="fce9" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">配置文件为我们想要生成的每个表提供了一个指标列表。如果我们想添加或删除指标或更改命名等，我们只需更改配置文件。这样我们就不会编辑我们的代码库本身。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><h2 id="f195" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">⚙️生成度量函数</h2><p id="7f10" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">这个函数接收我们的Unicorn数据、我们的metrics类的一个实例和我们的metrics配置，并返回一个Metrics数据帧。</p><p id="4b31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">步骤:</p><ol class=""><li id="784f" class="mk ml iq ky b kz la lc ld lf ng lj nh ln ni lr mr ms mt mu bi translated">使用<code class="fe ob oc od oe b">getattr</code>创建一个<code class="fe ob oc od oe b">pandas.DataFrame.groupby.apply</code>对象</li><li id="1578" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr mr ms mt mu bi translated">使用<code class="fe ob oc od oe b">getattr</code>创建一个度量类方法对象(例如<code class="fe ob oc od oe b">Metrics.count</code></li><li id="75e2" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr mr ms mt mu bi translated">调用传递度量方法对象的<code class="fe ob oc od oe b">pandas.DataFrame.groupby.apply</code>对象</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><h2 id="ad9c" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">🪄重构的管道</h2><p id="a657" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">最后，我们到达重构的管道。通过定义新的度量类并将它们添加到我们的配置文件中，我们可以很容易地将度量添加到现有的表中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><h1 id="bd6f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">👀概述</h1><ul class=""><li id="28f8" class="mk ml iq ky b kz mm lc mn lf mo lj mp ln mq lr oa ms mt mu bi translated">标准化管道中的代码，使用<code class="fe ob oc od oe b">pandas.DataFrame.groupby.apply</code>，对我们的数据进行转换。</li><li id="5df2" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated">取消数据透视以给出唯一的行(与<code class="fe ob oc od oe b">pandas.DataFrame.groupby</code>一起使用)。</li><li id="6df4" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated">在一个类中托管我们希望生成的度量，并将它们传递给<code class="fe ob oc od oe b">pandas.DataFrame.groupby.apply</code>。</li><li id="ba4a" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated">使用Python的内置函数<code class="fe ob oc od oe b">getattr</code>和元数据字典，循环遍历我们的指标，而不是重复调用<code class="fe ob oc od oe b">pandas.DataFrame.groupby.apply</code>。</li></ul><h1 id="76fc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">✅ 🔀好处和权衡</h1><p id="c552" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated"><strong class="ky ir">好处</strong></p><ul class=""><li id="93c1" class="mk ml iq ky b kz la lc ld lf ng lj nh ln ni lr oa ms mt mu bi translated">代码是模块化的，并且更易于管理，以便按比例增加我们的度量。</li><li id="4689" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated">一个配置文件给了我们更多灵活性来添加和取出度量，而不需要接触代码。</li><li id="e678" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated">更容易测试我们的代码的功能，因为它已经被隔离。</li></ul><p id="93f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">权衡</strong></p><ul class=""><li id="0084" class="mk ml iq ky b kz la lc ld lf ng lj nh ln ni lr oa ms mt mu bi translated">小型管道需要维护更多代码。</li><li id="0aa6" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated">我们代码的可读性降低了。</li><li id="6b88" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated">对于小管道来说更难调试。</li></ul><h1 id="a3d1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">📚资源</h1><p id="4fa1" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">🐍代码库在这里找到了<a class="ae kv" href="https://github.com/CharlieShelbourne/data-manipulation" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="f257" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">📊Kaggle独角兽公司数据集在这里找到了<a class="ae kv" href="https://www.kaggle.com/datasets/deepcontractor/unicorn-companies-dataset" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="bf38" class="no lt iq bd lu np nq dn ly nr ns dp mc lf nt nu me lj nv nw mg ln nx ny mi nz bi translated">第三方库:</h2><ul class=""><li id="753d" class="mk ml iq ky b kz mm lc mn lf mo lj mp ln mq lr oa ms mt mu bi translated"><code class="fe ob oc od oe b">pandas.DataFrame.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.explode.html" rel="noopener ugc nofollow" target="_blank">explode</a></code></li><li id="5563" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated"><code class="fe ob oc od oe b">pandas.DataFrame.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html" rel="noopener ugc nofollow" target="_blank">groupby</a></code></li><li id="91f8" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated"><code class="fe ob oc od oe b">pandas.DataFrame.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.reset_index.html" rel="noopener ugc nofollow" target="_blank">reset_index</a></code></li><li id="82e7" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated"><code class="fe ob oc od oe b">pandas.<a class="ae kv" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html" rel="noopener ugc nofollow" target="_blank">merge</a></code></li><li id="b2e2" class="mk ml iq ky b kz nj lc nk lf nl lj nm ln nn lr oa ms mt mu bi translated">Python内置于<code class="fe ob oc od oe b"><a class="ae kv" href="https://docs.python.org/3/library/functions.html#getattr" rel="noopener ugc nofollow" target="_blank">getattr</a></code></li></ul><pre class="kg kh ki kj gt oj oe ok ol aw om bi"><span id="f736" class="no lt iq oe b gy on oo l op oq"><strong class="oe ir">Want to Connect?</strong></span><span id="99ac" class="no lt iq oe b gy or oo l op oq">I'm just starting out my blogging journey. Let's Connect on <a class="ae kv" href="https://twitter.com/charlieshelb" rel="noopener ugc nofollow" target="_blank">Twitter</a>!</span></pre></div></div>    
</body>
</html>