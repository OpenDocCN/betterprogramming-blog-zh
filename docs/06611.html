<html>
<head>
<title>A Simple Apache Kafka Cluster With Docker, Kafdrop, and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个简单的Apache Kafka集群，包含Docker、Kafdrop和Python</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-simple-apache-kafka-cluster-with-docker-kafdrop-and-python-cf45ab99e2b9?source=collection_archive---------0-----------------------#2020-10-19">https://betterprogramming.pub/a-simple-apache-kafka-cluster-with-docker-kafdrop-and-python-cf45ab99e2b9?source=collection_archive---------0-----------------------#2020-10-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7148" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在带有生产者和消费者的Docker上部署一个最小的Kafka集群</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/074e1e84aa3d51a9cbd55ebf51e7654a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WNW0Yu6wTmQ3JNKm"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">乔·斯塔布斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="f24a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本指南将演示如何在Docker上部署一个最小的Apache Kafka集群，并使用Python设置生产者和消费者。我们还将部署Kafdrop的一个实例，以便于集群监控。</p><blockquote class="ls lt lu"><p id="1e2c" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">“Apache Kafka是一个开源的分布式事件流平台，被数千家公司用于高性能数据管道、流分析、数据集成和任务关键型应用。”——<a class="ae kv" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank">阿帕奇卡夫卡</a></p></blockquote><h2 id="50dc" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">先决条件</h2><p id="0550" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">本教程希望您有一个安装了<a class="ae kv" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> Docker Compose </a>的Unix系统(Mac或Linux)。你可以通过遵循Docker <a class="ae kv" href="https://docs.docker.com/get-docker/]" rel="noopener ugc nofollow" target="_blank">官方文档</a>找到安装Docker和Docker Compose的说明。</p><p id="29a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本教程的完整代码可以在GitHub 上找到。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="c560" class="ne ma iq bd mb nf ng nh me ni nj nk mh jw nl jx mk jz nm ka mn kc nn kd mq no bi translated">阿帕奇卡夫卡建筑</h1><p id="9656" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">与RabbitMQ或ActiveMQ等其他消息代理相比，Apache Kafka的架构相对简单。</p><p id="dac1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kafka本质上是一个提交日志，具有非常简单的数据结构。它恰好是异常容错的、水平可伸缩的，并且能够处理巨大的吞吐量。这使得Kafka非常受许多大型企业组织的欢迎，其应用范围从发布-订阅消息到日志聚合。</p><p id="3bae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将部署一个简单的Kafka设置，由以下组件组成:</p><ul class=""><li id="5c70" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated"><strong class="ky ir"> Kafka集群:</strong>Kafka经纪人的分布式系统</li><li id="ffd5" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><strong class="ky ir"> Kafka broker: </strong>负责在生产者和消费者之间传递数据的消息代理。它们负责集群中的大量I/O操作和持久存储。</li><li id="8430" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><strong class="ky ir"> ZooKeeper: </strong>管理集群中的整体控制器状态。它充当配置存储库，维护集群元数据，还实现集群的实际机制。</li><li id="c975" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><strong class="ky ir"> Kafka生产者:</strong>负责将记录附加到Kafka主题的客户端应用程序</li><li id="eef7" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated"><strong class="ky ir"> Kafka消费者:</strong>从主题中读取的客户端应用程序</li></ul><p id="f4ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下图描述了我们将要部署的最小Apache Kafka集群的架构。最基本的设置只包含一个代理和一个ZooKeeper节点(蓝色)；但是，为了增加弹性，我们将在集群中部署两个额外的代理(绿色)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/529f870d15d4f21f002d3fcfea46467d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*udUE1kQJ8okh0ebgkBGQYA.png"/></div></div></figure></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="cbd6" class="ne ma iq bd mb nf ng nh me ni nj nk mh jw nl jx mk jz nm ka mn kc nn kd mq no bi translated">在Docker中运行ZooKeeper</h1><p id="4d3c" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">验证是否已成功安装Docker和Docker Compose:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="1e4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了，我们准备好开始了！让我们从部署ZooKeeper开始。首先，创建一个新的工作目录来存储我们将在教程中使用的文件和数据:</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="7c98" class="lz ma iq oh b gy ol om l on oo">mkdir kafka<br/>cd kafka</span></pre><p id="309e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，创建一个名为<code class="fe op oq or oh b">docker-compose.yml</code>的新文件。这包含使用Docker Compose进行部署的配置。</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="e2d4" class="lz ma iq oh b gy ol om l on oo">touch docker-compose.yml</span></pre><p id="d5a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在你最喜欢的文本编辑器中打开这个文件。我们准备添加配置来部署ZooKeeper。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="4121" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">逐行检查配置:</p><ul class=""><li id="6904" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated">第1行:<a class="ae kv" href="https://docs.docker.com/compose/compose-file/" rel="noopener ugc nofollow" target="_blank"> Docker编写文件</a>的版本号</li><li id="d42d" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第2行:开始<a class="ae kv" href="https://docs.docker.com/compose/compose-file/#service-configuration-reference" rel="noopener ugc nofollow" target="_blank">服务</a>定义</li><li id="7654" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第3行:启动ZooKeeper配置</li><li id="0402" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第4行:用于ZooKeeper的Docker图像，从<a class="ae kv" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>下载</li><li id="6235" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第5行:Docker容器将使用的主机名</li><li id="777b" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第6-7行:将端口2181暴露给主机。这是默认的ZooKeeper端口。</li><li id="b6da" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第9行:这个ZooKeeper实例的唯一ID</li><li id="1af3" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第10行:动物园管理员将继续运行</li><li id="8835" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第11行:ZooKeeper服务器列表。我们只部署了一个。</li><li id="edb6" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第12–14行:将主机上的目录映射到容器中的目录，以便持久存储数据</li></ul><p id="01bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以通过运行Docker Compose来启动ZooKeeper:</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="c421" class="lz ma iq oh b gy ol om l on oo">docker-compose up</span></pre><p id="e925" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将下载ZooKeeper Docker容器并启动一个ZooKeeper实例。您将看到以<code class="fe op oq or oh b">binding to port 0.0.0.0/0.0.0.0:2181</code>结尾的日志消息。这意味着ZooKeeper正在运行并绑定到港口<code class="fe op oq or oh b">2181</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/dd0acc49aee6dee22365c897f5e10dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_v8Eq5LtrFkX6wW8M4t6w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用Docker编写启动ZooKeeper的日志输出</p></figure></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="0cd3" class="ne ma iq bd mb nf ng nh me ni nj nk mh jw nl jx mk jz nm ka mn kc nn kd mq no bi translated">在Docker中运行卡夫卡</h1><p id="b65f" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">接下来，让我们加入阿帕奇卡夫卡。我们将把第一个<code class="fe op oq or oh b">kafka</code>服务添加到配置文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="67b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再次，逐行检查配置:</p><ul class=""><li id="e19a" class="np nq iq ky b kz la lc ld lf nr lj ns ln nt lr nu nv nw nx bi translated">第5行:Docker Hub中用于Kafka的图像</li><li id="688a" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第6行:容器的主机名</li><li id="b25a" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第7-8行:要公开的端口，设置为<code class="fe op oq or oh b">9091</code></li><li id="815b" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第十行:卡夫卡的广告听众。罗宾·莫法特有一篇关于这个的很棒的博文。</li><li id="9375" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第11行:每个监听器使用的安全协议</li><li id="94d6" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第12行:interbroker监听器名称(用于内部通信)</li><li id="bb87" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第13行:卡夫卡应该使用的动物园管理员节点列表</li><li id="0fd5" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第14行:这个Kafka经纪人的经纪人ID</li><li id="a105" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第15行:消费者补偿主题的复制因子</li><li id="02f7" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第16-17行:映射主机上的卷以存储Kafka数据</li><li id="724e" class="np nq iq ky b kz ny lc nz lf oa lj ob ln oc lr nu nv nw nx bi translated">第19-20行:确保动物园管理员在卡夫卡之前启动</li></ul><p id="e150" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要启动Kafka broker，您可以在工作目录中启动一个新的终端窗口并运行<code class="fe op oq or oh b">docker-compose up</code>。</p><p id="bb41" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果ZooKeeper仍然从上一步开始运行，你可以使用<code class="fe op oq or oh b">ctrl + c </code> / <code class="fe op oq or oh b">cmd + c</code>来停止它。Docker compose会在必要的时候同时启动ZooKeeper和Kafka。</p><p id="807d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">提示:</strong>使用<code class="fe op oq or oh b">docker-compose up -d</code>在终端窗口的后台启动容器</p><p id="b4ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">启动容器后，您应该看到Kafka和ZooKeeper正在运行。让我们通过创建一个新主题来验证一切都已成功启动:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="1ee9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不错！现在，我们在Docker的本地机器上部署并运行了一个最小的Kafka集群。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="5e6f" class="ne ma iq bd mb nf ng nh me ni nj nk mh jw nl jx mk jz nm ka mn kc nn kd mq no bi translated">部署多个Kafka代理</h1><p id="2529" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">接下来，我们将在集群中再添加两个Kafka代理。拥有多个代理使我们能够构建更具弹性的集群，因为我们可以从复制、容错和额外资源中受益。</p><p id="fe2d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们需要在我们的<code class="fe op oq or oh b">docker-compose.yml</code>中添加更多的<code class="fe op oq or oh b">kafka</code>服务。让我们再添加两个经纪人:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="9f73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要向集群添加额外的代理，我们只需要更新代理ID、主机名和数据量。这里我们添加了ID为<code class="fe op oq or oh b">2</code>和端口为<code class="fe op oq or oh b">9092</code>的代理2和ID为<code class="fe op oq or oh b">3</code>和端口为<code class="fe op oq or oh b">9093</code>的代理3。</p><p id="1365" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过创建另一个主题来验证这三个代理是否成功运行，这次使用的复制因子是<code class="fe op oq or oh b">3</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="614d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">成功！我们现在有一个由三个代理运行的Kafka集群！</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="af74" class="ne ma iq bd mb nf ng nh me ni nj nk mh jw nl jx mk jz nm ka mn kc nn kd mq no bi translated">部署Kafdrop</h1><p id="2dca" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">能够可视化您的部署的关键指标总是好的；然而，Kafka并没有提供开箱即用的监控接口。幸运的是，我们可以使用一个名为<a class="ae kv" href="https://github.com/obsidiandynamics/kafdrop" rel="noopener ugc nofollow" target="_blank"> Kafdrop </a>的免费开源产品。</p><blockquote class="ls lt lu"><p id="7b2c" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">“Kafdrop是一个用于查看Kafka主题和浏览消费群体的web UI。该工具显示信息，如经纪人，主题，分区，消费者，并让您查看消息。”—<a class="ae kv" href="https://github.com/obsidiandynamics/kafdrop" rel="noopener ugc nofollow" target="_blank">GitHub上的Kafdrop</a></p></blockquote><p id="8394" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们为Kafdrop实例添加另一个容器到我们的<code class="fe op oq or oh b">docker-compose.yml</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="ea3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后。使用<code class="fe op oq or oh b">docker-compose down</code>和<code class="fe op oq or oh b">docker-compose up -v</code>重新部署。一旦它完成预热，在你的浏览器中导航到<code class="fe op oq or oh b">localhost:9000</code>。您应该会看到Kafdrop登录屏幕。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/e1479d8d2f04be7e9f70bdc7fe52a589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X7BcPdPwHgnjwG8_BAFkaw.png"/></div></div></figure><p id="c684" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，我们现在可以看到关于Kafka集群的一些信息，包括我们已经作为本教程的一部分创建的两个主题。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="287d" class="ne ma iq bd mb nf ng nh me ni nj nk mh jw nl jx mk jz nm ka mn kc nn kd mq no bi translated">添加Python生成器</h1><p id="1b8f" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">是时候给卡夫卡发些消息了。我们将使用Python构建一个简单的生成器。首先安装Python的Kafka库:</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="1f9e" class="lz ma iq oh b gy ol om l on oo">pip install kafka</span></pre><p id="75aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，在您的工作目录中创建一个名为<code class="fe op oq or oh b">producer.py</code>的新Python文件。这里，我们需要定义Kafka服务器的列表和发布消息的主题名。我们已经创建了<code class="fe op oq or oh b">my-topic-three</code>，所以让我们使用它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="3dd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后给题目发消息，我们叫<code class="fe op oq or oh b">producer.send</code>。尝试在新的终端窗口中运行以下Python代码:</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="8b10" class="lz ma iq oh b gy ol om l on oo">python3 producer.py</span></pre><p id="dd18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果一切顺利，您应该能够看到消息出现在Kafdrop UI中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/12da6827ef2830c7520dc4a5e1a722fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJzPIZkf7zS0kPFdcsbbvQ.png"/></div></div></figure></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="b0df" class="ne ma iq bd mb nf ng nh me ni nj nk mh jw nl jx mk jz nm ka mn kc nn kd mq no bi translated">添加Python消费者</h1><p id="8922" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">拼图的最后一块是添加一个Python消费者来接收来自Kafka的消息。创建一个名为<code class="fe op oq or oh b">consumer.py</code>的文件，并添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="fa27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">导入<code class="fe op oq or oh b">KafkaConsumer</code>后，我们需要提供bootstrap服务器ID和主题名来建立与Kafka服务器的连接。</p><p id="cdb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在新的终端窗口中，运行<code class="fe op oq or oh b">python consumer.py</code>，然后再次触发您的producer脚本。消费者将从主题中读取消息，并将数据打印到控制台。您应该会看到这样的消息:</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="fa2f" class="lz ma iq oh b gy ol om l on oo">ConsumerRecord(topic='my-topic-three', partition=0, offset=0, timestamp=1602500127577, timestamp_type=0, key=None, value=b'Hello World!', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=12, serialized_header_size=-1)</span></pre></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="c342" class="ne ma iq bd mb nf ng nh me ni nj nk mh jw nl jx mk jz nm ka mn kc nn kd mq no bi translated">结论</h1><p id="93f1" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">不错！您已经使用Docker和Docker Compose成功启动了一个本地Kafka集群。数据保存在本地机器上的容器之外，这意味着您可以删除容器并重新启动它们，而不会丢失数据。</p><p id="84b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您还添加了一些主题，并使用Python Kafka库为这些主题设置了基本的生产者和消费者。此外，您已经部署了Kafdrop的一个实例，为监控您的集群提供了一个接口。</p><p id="84e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们只是触及了阿帕奇卡夫卡的可能性的表面。如果你刚刚开始，还有很多东西要学。你已经有了必要的基础和工具，网上也不缺少信息。毫无疑问，最好的学习方法是卷起袖子去做点什么。</p><p id="e00b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读，祝您编码愉快！</p></div></div>    
</body>
</html>