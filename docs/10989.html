<html>
<head>
<title>Exporting Data as PDF in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中将数据导出为PDF</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/exporting-data-as-pdf-in-android-ca6522e77b9b?source=collection_archive---------4-----------------------#2022-02-09">https://betterprogramming.pub/exporting-data-as-pdf-in-android-ca6522e77b9b?source=collection_archive---------4-----------------------#2022-02-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fb62" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用iText Android库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cfb0020b6d3366ad3157b790c00a9572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1PI5tra3vsF36bwC"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@curvd?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> CURVD </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="3b8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“我需要一份PDF格式的列表”——这是许多Android用户的普遍需求。</p><p id="0676" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在特殊情况下，用户可能希望将他们的数据打印成PDF文件。付款凭证、交易日志、历史报告等数据。这是一个简单的需求。不幸的是，许多android应用程序让这一功能远离了他们的用户。</p><p id="fe0d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用程序中没有PDF导出功能有一些原因。其中之一是其实现的复杂性——这是一个假设。拥有一个让用户将数据导出到PDF文件的功能并不像解决算术问题那么复杂。让我们看看如何在一个Android应用程序中实现它。</p><h1 id="72a4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">要求</strong></h1><p id="36f1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">开发人员易于实现的PDF库之一是<code class="fe mp mq mr ms b">iText</code>库。要开始使用这个库，我们需要在我们的应用程序Gradle中实现iText依赖项。</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="94e0" class="mx lt iq ms b gy my mz l na nb">implementation ("com.itextpdf:itextpdf:5.5.13.1")</span></pre><p id="43f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦它被同步到项目中，我们就可以进入下一步，设置我们的清单。这是为了让应用程序访问手机存储，因为我们要创建一个PDF文件，当然，保存在手机存储。</p><p id="6caf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将此代码添加到清单中。</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="7fdd" class="mx lt iq ms b gy my mz l na nb">&lt;manifest<br/>...<br/>&lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/&gt;<br/>&lt;uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/&gt;</span></pre><p id="1bce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">别忘了支持Android 11及更高版本的遗留请求。</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="619f" class="mx lt iq ms b gy my mz l na nb">android:requestLegacyExternalStorage="true"</span></pre><p id="ebe9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在已经完成了项目中的<code class="fe mp mq mr ms b">iText</code>库。容易吗？等等，这甚至不是我们PDF导出方法的开始。</p><h1 id="3288" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">导出PDF服务配置</h1><p id="631c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">首先，让我们创建一个PDF服务类，这样我们的UI类就不会受到PDF配置的影响。在这个类中，我们可以直接定义我们的字体样式。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PDF服务类别介绍</p></figure><p id="2ffe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们只需要通过调用<code class="fe mp mq mr ms b">Font</code>来设置字体样式。这就是我们如何设置下一个配置中要使用的字体样式。</p><p id="194d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还准备了我们的pdf writer，即<code class="fe mp mq mr ms b">pdf</code>，稍后我们将初始化它。现在让我们为我们的PDF文档准备文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PDF文件和文档初始化</p></figure><p id="4097" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">path</code>是将PDF文件导出到的手机存储目录。现在我们来看看<code class="fe mp mq mr ms b">file</code>的配置。<code class="fe mp mq mr ms b">if (!file.exists()) file.createNewFile()</code>行的功能是创建我们的PDF文件。</p><p id="38e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经准备好了存储目录和文件。但是，我们创建的文件仍然是一个空白文件。这一步跟它没关系。</p><p id="f837" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们更深入地研究文档初始化。要制作一个PDF文件，我们需要初始化<code class="fe mp mq mr ms b">iText</code>文档。这个初始化的变量将作为我们写数据的纸。<code class="fe mp mq mr ms b">document = Document()</code>是文档初始化。</p><p id="739c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">document.setMargins</code>和<code class="fe mp mq mr ms b">document.setPageSize</code>是我们设置边距和页面布局的方式。我们现在有一份空白的文件。</p><p id="bfb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">文档创建并没有就此结束。由于我们要制作一个PDF文件，我们必须通过<code class="fe mp mq mr ms b">pdf = PdfWriter.getInstance(document,FileOutputStream(file))</code>将文件设置为PDF文件，为了减少文件大小的内存消耗，我们也通过调用<code class="fe mp mq mr ms b">pdf.setFullCompression()</code>来压缩文件。</p><p id="2afa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简单。让我们来看看将数据写入文档的基本概念。</p><p id="c75a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，要开始处理文档，我们需要打开文档。上面的代码通过调用<code class="fe mp mq mr ms b">document.open()</code>直接打开了我们的文档。</p><h1 id="b260" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">基本的文档写作技巧</h1><p id="f10b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">编写文档实际上类似于在Microsoft Office中直接键入Doc文件。它的不同之处在于我们没有光标，我们需要通过编程来控制它。</p><p id="8aa6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">换句话说，我们需要确保添加到文档中的元素位于正确的位置。以下是关于如何以编程方式将数据写入文档的基本提示。</p><ul class=""><li id="ce19" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">要添加空行，我们可以添加一个带有空格字符串的段落。</li></ul><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="6e45" class="mx lt iq ms b gy my mz l na nb">document.add(Paragraph(" "))</span></pre><ul class=""><li id="73c9" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">要写一段话，我们只需要在<code class="fe mp mq mr ms b">Paragraph("YOUR_PARAGRAPH")</code>上方的段落括号里面写一段话的内容就可以了。然而，为了避免重复创建相同样式的段落，我们可以在一个函数中创建一个段落，以便在每次需要时调用。</li></ul><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="1ebf" class="mx lt iq ms b gy my mz l na nb">private fun createParagraph(content: String): Paragraph{<br/>        val paragraph = Paragraph(content, BODY_FONT)<br/>        paragraph.firstLineIndent = 25f<br/>        paragraph.alignment = Element.ALIGN_JUSTIFIED<br/>        return paragraph<br/>    }</span></pre><ul class=""><li id="0f66" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">然后，我们可以通过调用要添加到文档中的<code class="fe mp mq mr ms b">createParagraph</code>函数来轻松创建段落。下面是使用方法。</li></ul><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="7eb0" class="mx lt iq ms b gy my mz l na nb">document.add(createParagraph(“PARAGRAPH_CONTENT”))</span></pre><ul class=""><li id="5369" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">要添加新页面:</li></ul><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="2f6c" class="mx lt iq ms b gy my mz l na nb">document.newPage()</span></pre><ul class=""><li id="fb19" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">要制作表格，我们需要定义一个PDF表格。以下代码显示了如何制作表格:</li></ul><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="fcb5" class="mx lt iq ms b gy my mz l na nb">private fun createTable(column: Int, columnWidth: FloatArray): PdfPTable {<br/>        val table = PdfPTable(column)<br/>        table.widthPercentage = 100f<br/>        table.setWidths(columnWidth)<br/>        table.headerRows = 1<br/>        table.defaultCell.verticalAlignment = Element.ALIGN_CENTER<br/>        table.defaultCell.horizontalAlignment = Element.ALIGN_CENTER<br/>        return table<br/>    }</span></pre><p id="5d9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的代码中，我们有一个名为<code class="fe mp mq mr ms b">column:Int</code>的参数，它是列数。此外，我们还有一个<code class="fe mp mq mr ms b">columnWidth</code>是一个float数组。这个浮点数组是创建的表中每一列的列表。容易吗？是的，一切都是可以理解的。</p><p id="a7d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在一个表中，必须有行和列。其中的任何特定区域都称为一个单元。但是，这里没有定义行。它将由我们填充的单元格自动生成。现在让我们看看下一步的更多内容。</p><ul class=""><li id="396f" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">以下代码显示了如何在单元格内书写:</li></ul><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="b9bb" class="mx lt iq ms b gy my mz l na nb">private fun createCell(content: String): PdfPCell {<br/>        val cell = PdfPCell(Phrase(content))<br/>        cell.horizontalAlignment = Element.ALIGN_CENTER<br/>        cell.verticalAlignment = Element.ALIGN_MIDDLE<br/>        //setup padding<br/>        cell.setPadding(8f)<br/>        cell.isUseAscender = true<br/>        cell.paddingLeft = 4f<br/>        cell.paddingRight = 4f<br/>        cell.paddingTop = 8f<br/>        cell.paddingBottom = 8f<br/>        return cell<br/>    }</span></pre><p id="6f61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面代码的要点是，对于我们想要在任何特定单元格中写入的任何内容，我们需要定义一个PDF单元格。PDF单元格作为我们的光标位置播放。为了避免重复定义单元格，上面的函数要求单元格内容直接将内容放入单元格中。</p><blockquote class="nn no np"><p id="201e" class="kw kx nq ky b kz la jr lb lc ld ju le nr lg lh li ns lk ll lm nt lo lp lq lr ij bi translated">注意:如果一行中的所有列都已被单元格填充，当我们添加另一个单元格时，表格将自动生成新的一行。</p></blockquote><h1 id="51d0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">样本案例</h1><p id="5019" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将有一篇由两段组成的论文，我们的用户数据有四个变量(id、名字、中间名、姓氏)。</p><p id="9e4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用户数据类及其列表如下:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="bf4e" class="mx lt iq ms b gy my mz l na nb">data class User(<br/>   val id: Int,<br/>   val firstName: String,<br/>   val middleName: String,<br/>   val lastName: String<br/>)</span><span id="0602" class="mx lt iq ms b gy nu mz l na nb">val userData = listOf(<br/>        User(1, "Amir", "Tan", "Khan"),<br/>        User(2, "Michael", "Calvin", "Gonzalez"),<br/>        User(3, "Alim", "Bin", "Hasan"),<br/>        User(4, "John", "Carl", "Tean"),<br/>        User(5, "James", "Brown", "Cold"),<br/>        User(6, "Virats", "Kader", "Can"),<br/>        User(7, "Lim", "Lui", "Pao"),<br/>        User(8, "Endro", "Tava", "Pero"),<br/>        User(9, "Dani", "Pedro", "Leo"),<br/>        User(10, "Leonardo", "Chris", "Luiza")<br/>    )</span></pre><p id="73fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们创建一个函数来完成这些任务。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建PDF函数示例</p></figure><p id="0404" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成后，我们已经配置了将用户数据导出到PDF所需的所有功能。现在让我们从活动、片段或可组合上下文中调用这个函数。</p><p id="6fd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的示例显示了如何从activity调用函数:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在活动中调用创建PDF函数</p></figure><p id="d503" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一切就绪。我们已经在UI类中创建了PDF导出函数及其结果响应。然而，在不同的情况下，我们的反应会根据我们的需要而有所不同。</p><p id="3962" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个示例中，我们让应用程序在PDF创建后直接打开文件。下面是结果预览。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/b55ec29c9871b9d86d70772929092fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/1*HYkWFOuv2RdLN1PvJEPFmw.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">结果预览</p></figure><blockquote class="nn no np"><p id="b7ea" class="kw kx nq ky b kz la jr lb lc ld ju le nr lg lh li ns lk ll lm nt lo lp lq lr ij bi translated">注意:当打开我们创建的文件时，我们需要访问文件的真实路径。上面代码中使用的<code class="fe mp mq mr ms b">FileHandler</code>不是来自<code class="fe mp mq mr ms b">java.util.logging</code>类。参考<a class="ae kv" href="https://github.com/annasta13/Pdf-Export/blob/master/app/src/main/java/com/habileducation/pdfexport/pdfService/FileHandler.kt" rel="noopener ugc nofollow" target="_blank">此处</a>获取源代码。另一个重要注意事项是向用户请求读取文件权限。点击查看更多<a class="ae kv" href="https://github.com/annasta13/Pdf-Export/blob/3e29181c157d300a8be42c744c3872df0d177cb8/app/src/main/java/com/habileducation/pdfexport/MainActivity.kt" rel="noopener ugc nofollow" target="_blank">活动的完整源代码。</a></p></blockquote><p id="90c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是项目示例代码:</p><div class="nw nx gp gr ny nz"><a href="https://github.com/annasta13/Pdf-Export" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">GitHub-annasta 13/Pdf-Export:Pdf导出的示例项目</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on kp nz"/></div></div></a></div></div><div class="ab cl oo op hu oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="ij ik il im in"><h1 id="e0c5" class="ls lt iq bd lu lv ov lx ly lz ow mb mc jw ox jx me jz oy ka mg kc oz kd mi mj bi translated">结论</h1><p id="2b3f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">将数据导出到PDF是一个很酷的特性，只要我们知道iText文档如何添加元素的基本概念，这个特性实际上很容易实现。</p><p id="41b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总之，我们可以简单地利用这个库在我们的应用程序中提供一个PDF导出特性，而不必请求我们的后端服务器这样做。</p><p id="ff36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望这是值得学习的东西。编码快乐，干杯。</p></div></div>    
</body>
</html>