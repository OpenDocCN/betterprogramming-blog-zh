<html>
<head>
<title>Setup Nginx for Your NodeJS Server on EC2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在EC2上为NodeJS服务器设置Nginx</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/setup-nginx-for-your-nodejs-server-on-ec2-ae46a3d0cb1b?source=collection_archive---------6-----------------------#2022-07-04">https://betterprogramming.pub/setup-nginx-for-your-nodejs-server-on-ec2-ae46a3d0cb1b?source=collection_archive---------6-----------------------#2022-07-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6e60" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">公开我们的NodeJS服务器来接收HTTP请求</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/588871e7dcd0641ec3d7ab1404149d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v5SNaMVaK1yRoWgZ"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自Unsplash由<a class="ae kv" href="https://unsplash.com/@philberndt" rel="noopener ugc nofollow" target="_blank"> phil </a></p></figure><p id="200a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我在大学和NodeJS一起工作时，我在黑客马拉松、大学项目等活动中经常遇到的一个问题是在web上托管我的项目。我让一切都在本地工作，但是在考官的设备上演示的感觉给了我完全不同的感觉。</p><p id="9738" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在本文中，我们将讨论如何使用nginx反向代理，公开NodeJS服务器，以稳定可靠的方式通过互联网接收HTTP请求。</p><p id="6fcc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为本文的先决条件，您应该有一个运行在EC2实例上的NodeJS服务器。要设置这一点，你可以按照我以前的<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/deploying-a-basic-express-api-on-amazon-ec2-eea0b54a825">系列文章</a>。</p><h1 id="fdd1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么选择Nginx？</h1><p id="3098" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将使用Nginx作为反向代理，从外界抽象出我们的后端配置。发送到我们服务器的各种请求在到达服务器之前都必须通过这个反向代理。</p><p id="cbd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">拥有反向代理有几个好处，其中一些是</p><ul class=""><li id="dfc3" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><strong class="ky ir">安全性:</strong>反向代理在<a class="ae kv" href="https://www.computerweekly.com/opinion/Security-Think-Tank-Practical-steps-to-achieve-zero-trust" rel="noopener ugc nofollow" target="_blank">为组织构建零信任架构</a>中扮演着关键角色——保护敏感的业务数据和系统。通过反向代理，您可以将特定的端点列入白名单或黑名单，控制资源限制，只允许特定的HTTP方法，为所有请求添加公共头，等等。</li><li id="2ca0" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><strong class="ky ir">可扩展性</strong>:使用反向代理，服务器的数量可以根据流量的波动而增加或减少，使所有这些操作从客户端抽象出来。</li><li id="2c69" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><strong class="ky ir">配置:</strong>我们可以配置超时时间，在此之后服务器将显示503错误，用于指定服务将使用的HTTP协议。</li><li id="05e2" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><strong class="ky ir">缓存:</strong>提供大量静态内容(如图像和视频)的企业可以建立一个反向代理来缓存这些内容。</li><li id="d834" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><strong class="ky ir">日志记录:</strong> Nginx可用于记录所有传入请求的传入头、返回的状态代码等。</li></ul><p id="0560" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">反向代理还有很多其他的用例，但是这超出了本文的范围。</p><h1 id="2b22" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">安装Nginx的步骤</h1><p id="5e39" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">运行以下命令来安装Nginx</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="951a" class="ni lt iq ne b gy nj nk l nl nm">sudo apt update<br/>sudo apt install nginx</span></pre><p id="2448" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要验证安装是否成功，请键入</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="a6f2" class="ni lt iq ne b gy nj nk l nl nm">systemctl status nginx</span></pre><p id="e76a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您应该会看到以下输出</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/985ef1b0ceebaf182b5f0e63fcf0dd7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-OOxq34vIdT9OTFIpX4hHw.png"/></div></div></figure><p id="75ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如该输出所确认的，服务已经成功启动。然而，最好的测试方法是从Nginx实际请求一个页面。</p><p id="92f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过导航到服务器的IP地址来访问默认的Nginx登录页面，以确认软件运行正常。</p><p id="25ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您将看到以下页面，导航到</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="8c0f" class="ni lt iq ne b gy nj nk l nl nm"><a class="ae kv" href="http://44.201.157.45/" rel="noopener ugc nofollow" target="_blank">http://&lt;YOUR_SERVER_IP&gt;/</a></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/66cc4042db0f0a1756ec084bb712d996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*922YRvG_UnTmoL9mOIWR-A.png"/></div></div></figure><h1 id="aefa" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">配置到express服务器的流量重定向</h1><p id="5396" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当我们在浏览器中键入我们的IP时，我们看到Nginx默认页面，但是当我们查询服务器的IP时，我们希望访问我们的express API。</p><p id="f53c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们必须转移到下面的目录，所有Nginx配置都在这里。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="9b8a" class="ni lt iq ne b gy nj nk l nl nm">cd /etc/nginx</span></pre><p id="3434" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个目录中有一个名为<code class="fe np nq nr ne b">nginx.conf</code>的文件，整个Nginx配置都在这个文件中。</p><p id="8d77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个文件的<code class="fe np nq nr ne b">http</code>块中，有一行</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="5644" class="ni lt iq ne b gy nj nk l nl nm">include /etc/nginx/conf.d/*.conf;</span></pre><p id="038d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这一行的意思是，在<code class="fe np nq nr ne b">/etc/nginx/conf.d/</code>目录中，包含任何以<code class="fe np nq nr ne b">.conf</code>为扩展名的文件中写入的任何配置。所以这个目录是我们写配置的地方。</p><p id="53c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个名为<code class="fe np nq nr ne b">configuration.conf</code>的文件(文件可以以<code class="fe np nq nr ne b">.conf</code>结尾)。</p><p id="33af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">并将以下服务器块添加到文件中</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="1e06" class="ni lt iq ne b gy nj nk l nl nm">server {</span><span id="16f3" class="ni lt iq ne b gy ns nk l nl nm">server_name &lt;SERVER_IP&gt;;</span><span id="fba0" class="ni lt iq ne b gy ns nk l nl nm">location / {<br/>        proxy_pass <a class="ae kv" href="http://127.0.0.1:5000" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:3000</a>;<br/>      }</span><span id="a858" class="ni lt iq ne b gy ns nk l nl nm">}</span></pre><p id="1426" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>我们提到端口为3000是因为在之前的<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/deploying-a-basic-express-api-on-amazon-ec2-eea0b54a825">文章</a>中，我们配置了一个运行在端口3000上的NodeJS服务器，所以请确保将该端口作为运行服务器的post。</p><p id="fa27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，为了测试我们的Nginx配置在语法上是否正确，我们运行以下命令。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="4c2a" class="ni lt iq ne b gy nj nk l nl nm">sudo nginx -t</span></pre><p id="c78c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将为我们提供以下输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ca"><img src="../Images/b246c469a4664a8a8cc9989426b3ceb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkWVs5UwvnQJzY4ZYVRXFw.png"/></div></div></figure><p id="4c01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，由于我们的配置是有效的，我们可以重启Nginx反向代理来查看我们的配置。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="3847" class="ni lt iq ne b gy nj nk l nl nm">sudo service nginx restart</span></pre><p id="5e22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这之后，如果你进入浏览器并输入你的服务器IP，你会看到下面的输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/8cfdf5469c08d2a53d8c02d37aefe706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*f3RprAPIsGwQ-bsJelJrzQ.png"/></div></figure><p id="3cb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>如果您继续阅读上一篇文章，您将得到这个输出。如果您运行了其他Express服务器，您将会看到其默认路由的返回值。</p><h1 id="531b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated"><strong class="ak">结论</strong></h1><p id="71f0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">通过阅读本文，您的NodeJS服务器将被暴露给互联网，您将能够通过它接收HTTP请求。但是这仍然不是设置删除服务器的理想方式，因为HTTP不是一个安全的协议。</p><p id="9ce0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在本系列的下一篇文章中，我们将看到如何在ec2实例上设置Certbot，并为服务器的传入请求启用HTTPS。</p><h1 id="8972" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><div class="nu nv gp gr nw nx"><a href="https://www.loadbalancer.org/blog/why-should-businesses-use-reverse-proxy/#:~:text=Reverse%20proxies%20help%20increase%20performance,%2C%20caching%2C%20and%20intelligent%20compression" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">为什么要使用反向代理？</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">使用反向代理的原因是什么？它与负载均衡器有何不同？</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">www.loadbalancer.org</p></div></div><div class="og l"><div class="oh l oi oj ok og ol kp nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-20-04" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">如何在Ubuntu 20.04上安装Nginx | digital ocean</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">Nginx是世界上最流行的web服务器之一，负责托管一些最大的和…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">www.digitalocean.com</p></div></div><div class="og l"><div class="om l oi oj ok og ol kp nx"/></div></div></a></div></div></div>    
</body>
</html>