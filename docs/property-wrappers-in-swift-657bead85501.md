# Swift 中的属性包装器简介

> 原文：<https://betterprogramming.pub/property-wrappers-in-swift-657bead85501>

## 它们是什么，我们如何使用它们？

![](img/6055025da0f35505b38a3f338fc2f460.png)

图片来自 [Pixabay](https://pixabay.com/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2520855) 的[神秘艺术设计](https://pixabay.com/users/Mysticsartdesign-322497/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=2520855)

很久以前，在魔法和壮丽的世界里，矮人正在和兽人战斗。兽人比矮人强大得多，因此赢得这场战斗的唯一方法就是向黑暗精灵寻求帮助。

精灵有一种叫做`propertyWrapper`的秘密武器，可以让任何生物长生不老。

这个故事将告诉你永生的本质。

首先，理解属性包装器只是语法糖，编译器能够将其翻译成更详细的代码是有好处的。

现在让我们来定义永生:它是一种从致命攻击中恢复的能力。

考虑下面的代码片段。这是矮人的数据结构，他们有一个`health`属性和`attacked(by:)`方法。每当`health`变为零，这就意味着矮人被杀。按照以前对永生的定义，我们可以假设它意味着健康不应该小于或等于零。

凡人侏儒的例子

用这样的方法，矮人肯定会输掉这场战斗。

# 包装价值

矮人要求得到以坚不可摧而闻名的武器。因此，让我们用精灵给的超级武器来解决它。

包装值示例

检查最后一行——矮人现在好像刀枪不入。

让我们来整理一下:

*   **第 3 行:**我们正在定义我们的支持变量。这实际上是一个变量，当你与`Dwarf`结构交互时，你认为你正在处理这个变量。
*   第 5 行:我们正在定义一个初始化式。是的，属性包装可以有初始化器。这里棘手的部分是如何调用这个初始化器。基本上，当您通过`Dwarf(health: 10)`在默认成员方式初始化器中为`health`属性赋值时，这将转化为`Immortal(wrappedValue: 10)`。
*   **第 9–14 行:** `@propertyWrapper`结构要求你定义一个`wrappedValue`属性，它实际上是你用`health`变量操作时的一个入口点。熟悉 getter 中的特殊行为，我们不允许支持值小于 1。
*   **第 17–28 行:**我们已经用特殊的超级武器定义了一个`health`属性，也被称为注释`@Immortal`。它显示这个变量由一个名为`Immortal`的属性包装器支持。这就意味着，每当兽人攻击矮人时，`health`变量会将伤害分配给`wrappedValue`变量，让`health`变得刀枪不入。

# 预计价值

如果你认为这是故事的结尾，那么不。精灵们并不慷慨，他们对黄金真的很慎重。这就是为什么，在秘密武器交易中，他们隐藏了一个布尔标志，表明不朽是否被一个矮人使用过。数学非常简单——如果使用了武器，精灵将获得一定比例的战争战利品。

让我们看看他们是如何完成的。

预计值示例

让我们彻底分析一下添加的代码。

*   **第 4 行& 14:** 我们增加了`isUsed`变量，如果不死逻辑被触发，我们将其设置为`true`。
*   **第 22 行&第 40 行:**注意一个叫做`projectedValue`的特殊计算属性。这是属性包装器可以使用`$`语法投射的值。看一下第 40 行- `dwarf.$health`。这将打印一个使用`isUsed`属性投影的布尔值。

投影布尔值是一个简单的例子。你可以投射任何你想要的东西，甚至是`self`。

# 结论

总而言之，我们需要回顾一下今天所学的一切:

*   属性包装器是语法糖，没有任何魔力。
*   可以使用`struct`、`class`、`enum`来创建属性包装器。
*   您必须定义一个向外界表示值的`wrappedValue`属性。
*   你可以定义一个`projectedValue`属性，在美元语法`$`的帮助下，属性包装器将被打开更多。
*   查看 [Swift 文档](https://docs.swift.org/swift-book/LanguageGuide/Properties.html)以获取更多信息。

我最后的建议是使用这台新机器时要小心。如你所见，对于任何超能力，你都需要付费，就像精灵的战利品一样。过度使用注释可能会产生误导，并给代码增加不必要的复杂性。因此，在添加下一个属性包装之前要三思。