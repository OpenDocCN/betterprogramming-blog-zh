<html>
<head>
<title>Setting Up a MySQL Database in Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Docker中设置MySQL数据库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/setting-up-mysql-database-in-a-docker-d6c69a3e9afe?source=collection_archive---------0-----------------------#2019-08-08">https://betterprogramming.pub/setting-up-mysql-database-in-a-docker-d6c69a3e9afe?source=collection_archive---------0-----------------------#2019-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d14f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习为数据库设置和运行Docker容器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5fe4b99231c4caf6260257d0ef6ed9ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRcI2Y7WBKbSTsEuqVLPyg.jpeg"/></div></div></figure><p id="836d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>为部署和测试作为应用程序不可或缺的一部分的应用程序和数据库提供了许多优势，因此值得学习为数据库设置和运行Docker容器。</p><p id="0beb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将关注以下主题:</p><ol class=""><li id="1b72" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">为一个<a class="ae lq" href="https://www.mysql.com/" rel="noopener ugc nofollow" target="_blank"> MySQL </a> Docker容器创建一个Docker合成<a class="ae lq" href="https://yaml.org/" rel="noopener ugc nofollow" target="_blank"> YAML </a>文件。</li><li id="8ec1" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">使用各种方法连接到运行在容器上的MySQL数据库。</li><li id="c762" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">在Docker容器中创建和运行多个版本的MySQL。</li></ol><p id="959a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们一个一个地检查一下。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="24a3" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated"><strong class="ak"> 1。为MySQL Docker容器创建一个Docker Compose YAML文件</strong></h1><p id="7abf" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">让我们创建一个目录<code class="fe nj nk nl nm b">db-docker</code>，然后在该目录中创建一个<code class="fe nj nk nl nm b">docker-compose.yml</code>文件:</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="d88c" class="nr mn it nm b gy ns nt l nu nv">mkdir db-docker<br/>cd db-docker<br/>touch docker-compose.yml</span></pre><p id="cf54" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">基本上，在这里，我们将指定我们将要使用的服务，并设置与这些服务相关的环境变量。</p><p id="a298" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将多次修改这个文件。</p><p id="9bd7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们刚刚创建的<code class="fe nj nk nl nm b">docker-compose.yml</code>文件中添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ba84" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们指定MySQL容器的名称为<code class="fe nj nk nl nm b">mysql-development</code>，要使用的Docker图像为<code class="fe nj nk nl nm b">mysql:8.0.17</code>。如果不指定标签为<code class="fe nj nk nl nm b">8.0.17</code>，则取最新的标签。</p><p id="5b24" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来我们需要指定的是环境变量，即用户、密码和数据库。如果不指定用户，默认情况下会是<code class="fe nj nk nl nm b">root</code>。</p><p id="3340" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用<code class="fe nj nk nl nm b">helloworld</code>作为密码，使用<code class="fe nj nk nl nm b">testapp</code>作为数据库。</p><p id="9e9a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一件重要的事情是端口映射。<code class="fe nj nk nl nm b">3308:3306</code>意味着在端口<code class="fe nj nk nl nm b">3306</code>的容器中运行的MySQL被映射到端口<code class="fe nj nk nl nm b">3308</code>的主机的localhost。您也可以使用不同的端口。</p><p id="0064" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，创建了。yml文件，我们需要在。yml文件位于:</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="1d70" class="nr mn it nm b gy ns nt l nu nv">docker-compose up</span></pre><p id="b36c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将提取Docker镜像(如果镜像在本地不可用，它将从<a class="ae lq" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>提取)然后运行容器。</p><p id="646c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以通过以下方式检查状态:</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="add8" class="nr mn it nm b gy ns nt l nu nv">docker-compose ps</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/c74329841fcb649c5d136a3e622c25b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L24I2k1rUQkB_JfbucfIKA.png"/></div></div></figure><p id="e7bd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将显示容器的名称、命令和容器的状态，例如，显示容器正在运行。它还显示了端口映射。</p><p id="82f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下一步，我们将连接到这个MySQL容器并运行一些命令。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="2a51" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated"><strong class="ak"> 2。连接到运行在容器中的MySQL数据库</strong></h1><p id="0c63" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">我们将讨论在Docker容器中运行的MySQL上连接和运行SQL命令的两种方法。</p><p id="7c8a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一种方法是使用类似<a class="ae lq" href="https://www.mysql.com/products/workbench/" rel="noopener ugc nofollow" target="_blank"> MySQL Workbench </a>的工具(也可以使用<a class="ae lq" href="https://www.jetbrains.com/datagrip/" rel="noopener ugc nofollow" target="_blank"> DataGrip </a>)。</p><p id="7ec3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于我们现在有一个MySQL容器在本地机器的端口<code class="fe nj nk nl nm b">3308</code>上运行，我们可以使用以下配置参数进行连接:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/aecd55505a90c2e289baf00f549ec121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*na_JACaLn-0o-kjbSbzUAg.png"/></div></div></figure><p id="d6ee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于端口映射，通过本地机器端口<code class="fe nj nk nl nm b">3308</code>的连接是可能的。</p><p id="d888" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们想要连接到容器化的MySQL，而不映射端口，即从运行在同一Docker网络上的另一个应用程序，我们必须使用像<a class="ae lq" href="https://www.adminer.org/" rel="noopener ugc nofollow" target="_blank"> Adminer </a>这样的工具，这是我们的另一种方法。</p><p id="d481" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Adminer是一个基于PHP的web应用程序，用于访问数据库。</p><p id="f84b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们将在我们的<code class="fe nj nk nl nm b">docker-compose.yml</code>文件中添加另一个Adminer服务。但是，在我们在这里进行更改之前，我们需要停止运行容器，并使用以下命令删除它:</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="cd89" class="nr mn it nm b gy ns nt l nu nv">docker-compose down</span></pre><p id="4923" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们在<code class="fe nj nk nl nm b">docker-compose.yml</code>文件中添加以下内容:</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="6fbe" class="nr mn it nm b gy ns nt l nu nv">version: '3'<br/><br/>services:<br/><br/>  mysql-development:<br/>    image: mysql:8.0.17<br/>    environment:<br/>      MYSQL_ROOT_PASSWORD: helloworld<br/>      MYSQL_DATABASE: testapp<br/>    ports:<br/>      - "3308:3306"<br/>  <br/>  admin:    <br/>    image: adminer    <br/>    ports:      <br/>      - "8080:8080"</span></pre><p id="8e00" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们再次启动Docker容器:</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="5c05" class="nr mn it nm b gy ns nt l nu nv">docker-compose up</span></pre><p id="cf92" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在运行这个之后，Adminer的映像将被提取，MySQL和Adminer的容器将被启动。</p><p id="4b80" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以使用<code class="fe nj nk nl nm b">docker-compose ps</code>来检查这一点。</p><p id="f41f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们可以转到我们的浏览器，进入<code class="fe nj nk nl nm b">localhost:8080</code>进行管理。由于Adminer与MySQL运行在同一个Docker网络上，它可以通过端口<code class="fe nj nk nl nm b">3306</code>(或者简单地说，通过容器的名称)访问MySQL容器。</p><p id="2b89" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:我们不能通过Adminer中的端口<code class="fe nj nk nl nm b">3308</code>访问MySQL容器，因为这将试图访问Docker Compose网络的端口<code class="fe nj nk nl nm b">3308</code>，而不是我们本地机器的<code class="fe nj nk nl nm b">3308</code>端口。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/e65a2c3db052bfbf77dc79b53743b4b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OG9YFIQufLorGqG2XiQDnQ.png"/></div></div></figure><p id="3faf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还可以通过以下命令使用MySQL命令行界面:</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="75f8" class="nr mn it nm b gy ns nt l nu nv">docker-compose exec  mysql-development mysql -uroot -phelloworld testapp</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="5b6b" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">3.在Docker容器中创建和运行多个版本的MySQL</h1><p id="d01a" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">如果我们有一个使用其他MySQL版本的应用程序，我们也可以为它创建一个服务，并在同一个Docker网络中运行它。</p><p id="39ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，如果我们需要MySQL版本5.7.27，我们需要对<code class="fe nj nk nl nm b">docker-compose.yml</code>文件做如下修改，停止运行容器，然后重新开始。</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="2a3a" class="nr mn it nm b gy ns nt l nu nv">version: '3'<br/><br/>services:<br/><br/>  mysql-development:<br/>    image: mysql:8.0.17<br/>    environment:<br/>      MYSQL_ROOT_PASSWORD: helloworld<br/>      MYSQL_DATABASE: testapp<br/>    ports:<br/>      - "3308:3306"<br/>  <br/>  admin:    <br/>    image: adminer    <br/>    ports:      <br/>      - "8080:8080"</span><span id="949a" class="nr mn it nm b gy ob nt l nu nv">   mysql-old:<br/>    image: mysql:5.7.27<br/>    environment:<br/>      MYSQL_ROOT_PASSWORD: helloworld<br/>      MYSQL_DATABASE: coolapp<br/>    ports:<br/>      - "3309:3306"</span></pre><p id="f651" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想进一步了解如何使用数据和配置卷，以及如何检查mysql容器的日志，请查看我的文章:<a class="ae lq" href="https://medium.com/@ashutosh_34428/volumes-and-logs-in-mysql-docker-61122f8c1d84" rel="noopener">https://medium . com/@ ashutosh _ 34428/volumes-and-logs-in-MySQL-docker-61122 F8 c1d 84</a></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="0762" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们已经到了文章的结尾。我希望你已经学到了一些东西。感谢阅读！</p></div></div>    
</body>
</html>