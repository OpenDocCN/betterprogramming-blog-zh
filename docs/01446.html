<html>
<head>
<title>Understanding New Location Permission Changes in iOS 13</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解iOS 13中新的位置权限更改</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/understanding-new-location-permission-changes-in-ios-13-6c34dc5f54da?source=collection_archive---------1-----------------------#2019-09-11">https://betterprogramming.pub/understanding-new-location-permission-changes-in-ios-13-6c34dc5f54da?source=collection_archive---------1-----------------------#2019-09-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3509" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这些变化为最终用户提供了更多的透明度和控制力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c70fa8db3bae9fefc89d4c5858016ce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BU0QQz0EYhSn-2Lp7nPqrg.gif"/></div></div></figure><p id="d09e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">iOS 13在开发者如何使用用户位置方面引入了许多变化。它引入了四个主要变化:1 .“允许一次”选项，2。更改后台权限提示，3。改善了背景位置的透明度；4 .一个改变的“总是允许”选项。</p><p id="7b7b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以在这个WWDC视频中了解更多关于这些变化的信息。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="37e4" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">1."允许一次"</h1><p id="11c5" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">iOS 13之前有两个位置权限:<code class="fe ms mt mu mv b">When In Use</code>(前台)和<code class="fe ms mt mu mv b">Always</code>(后台)。iOS 13引入了第三个选项:<code class="fe ms mt mu mv b">Allow Once</code>。“允许一次”选项被视为临时授权，应用程序下次打开时会再次提示。该选项允许用户为单个会话授予<code class="fe ms mt mu mv b">When In Use</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/ee3e03ae57deb5c249c76be98c8185b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ox9LFWlcxa7Hb3AbkZKdLw.png"/></div></div></figure><p id="2158" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">会话结束后，您必须再次请求<code class="fe ms mt mu mv b">When In Use</code>。如果之前授权了<code class="fe ms mt mu mv b">When In Use</code>或<code class="fe ms mt mu mv b">Always</code>的用户升级到iOS 13，他们在升级后将被授予该授权状态。当您通过<code class="fe ms mt mu mv b">CLLocationManager</code>请求位置许可时，用户将看到这个弹出窗口，有三个选项:</p><ol class=""><li id="79a0" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated">与应用程序共享位置一次，然后再次询问</li><li id="f601" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">当应用程序正在使用时，与应用程序共享位置</li><li id="ede8" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">根本不要与应用程序共享位置</li></ol><p id="9c96" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果用户点击选项1:“允许一次”，你的应用程序将被通知<code class="fe ms mt mu mv b">CLAuthorizationStatus</code>更改为<code class="fe ms mt mu mv b">authorizedWhenInUse</code>。就像你习惯在旧的iOS版本中获得永久许可一样。现在允许您的应用程序开始请求位置，无需更改代码。</p><p id="91f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">用户可以跳出并回到他们的应用程序，而你仍然有定位权限。只有在一段(更长的)不活动时间后，iOS才会撤销许可，并将<code class="fe ms mt mu mv b">CLAuthorizationStatus</code>变回<code class="fe ms mt mu mv b">notDetermined</code>。当应用程序回到前台时，您的<code class="fe ms mt mu mv b">CLLocationManagerDelegate</code>将收到位置权限更改的通知，因此用户界面可以相应地更新。</p><p id="fcdc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这使得新的“允许一次”功能对用户来说是一个很好的隐私改善。它还降低了用户尝试应用程序中的位置功能并在稍后决定是否授予其更永久权限的门槛。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="13db" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">2.对后台权限提示的更改</h1><p id="3a6a" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">随着<code class="fe ms mt mu mv b">Allow Once</code>的引入，用户必须授权<code class="fe ms mt mu mv b">When In Use</code>之后才能提示<code class="fe ms mt mu mv b">Always</code>。</p><p id="6747" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您在用户授予<code class="fe ms mt mu mv b">When In Use</code>之前请求<code class="fe ms mt mu mv b">Always</code>，用户将只有机会授予<code class="fe ms mt mu mv b">When In Use</code>或<code class="fe ms mt mu mv b">Allow Once</code>。如果用户授予<code class="fe ms mt mu mv b">When In Use</code>，iOS将授予临时<code class="fe ms mt mu mv b">Always</code>，然后稍后自动提示用户非临时<code class="fe ms mt mu mv b">Always</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/624980561396c359791d90d35efee1b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QarRUFMGvUNlE8tnkqAy_A.png"/></div></div></figure><p id="b8bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">获得在后台扫描位置的许可变得有点困难，但作为交换，你的用户将享受到更多关于你在iOS 13中收到的位置的透明度。第一个值得注意的变化是，即使当你调用<code class="fe ms mt mu mv b">requestAlwaysAuthorization</code>时，用户也只能在权限对话框中获得‘刚才’和‘正在使用’选项。如果用户授予您“使用时”权限，并且您尝试在后台扫描位置，只有在这时才会向用户显示授予后台权限的对话框。</p><p id="61f7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这不同于我们在旧的iOS版本中所习惯的，在旧的版本中，用户被允许在请求时直接给予“<strong class="kt ir"> always </strong>”权限。在代码层面上，唯一的区别在于您获得许可的时间。如果您确保不将<code class="fe ms mt mu mv b">allowsBackgroundLocationUpdates</code>的值基于您是否拥有后台权限，则第二个权限对话框将永远不会改变。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="fa10" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">3.改进的背景位置透明度</h1><p id="945d" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">如果用户授予<code class="fe ms mt mu mv b">Always</code>授权，iOS会在几天后显示提醒，让用户有机会更改设置。iOS 13在这个提醒中增加了一个地图来提高透明度:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/eb4c42eb02681d2480b8c137bb373ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*WvMKPHf0pSbaiA0U6h5_6g.jpeg"/></div></figure><p id="4379" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当你的应用程序在后台跟踪用户的位置一段时间后，iOS会确保它仍然得到用户的同意。在新的iOS中，这个同意更新对话框将包括一个小报告，其中包含你的应用程序一直在跟踪的位置，如上图所示。这使得后台发生的事情对用户来说更加透明</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="3cdb" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">4."总是允许"</h1><p id="f456" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">用户不需要<em class="nm">手动干预来明确授予“总是允许”特权。按照设计，稍后会再次询问他们。因此，要求用户打开设置应用程序并强制授予“始终允许”权限是违反准则的。</em></p><ul class=""><li id="bdb7" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nn nd ne nf bi translated">作为一名开发人员，在您的代码中，您应该像平常一样请求“总是允许”。</li><li id="d960" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nn nd ne nf bi translated">用户将看到没有“始终允许”选项的新提示。</li><li id="b94c" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nn nd ne nf bi translated">如果他们授予“使用时允许”权限，你的应用将<em class="nm">实际上</em>被授予“总是允许”权限的<em class="nm">临时授权</em>。</li><li id="4c52" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nn nd ne nf bi translated">开发人员现在应该简单地继续做他们需要许可的事情:例如，设置一些地理围栏，开始监控通知，等等。</li><li id="1808" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nn nd ne nf bi translated">如果开发者已经根据指南编写了他们的应用程序，当基于位置的事件被触发时，<em class="nm">用户将再次被提示。</em>这一次，他们可以选择授予“始终允许”权限，此时临时授权将变为永久授权。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/0a1f1600834aa890daaa8e7b2a22cc3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1UkcTIEb3QnkEIYW_qtpw.png"/></div></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="bace" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">结论</h1><p id="2d5e" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">这些变化对最终用户来说是巨大的，给了他们更多的透明度和控制力。</p><p id="23bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是，如果您想要访问位置数据，您必须向最终用户提供价值，并且您必须是透明的。</p><p id="3da2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最佳位置权限提示是:</p><ul class=""><li id="bc50" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nn nd ne nf bi translated"><strong class="kt ir">透明</strong>:该提示解释了将从最终用户处收集哪些数据以及如何使用这些数据，并提供了一个指向您的隐私政策的链接。</li><li id="9dde" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nn nd ne nf bi translated"><strong class="kt ir">有价值的</strong>:提示解释了为什么用户应该授予位置权限，比如启用一个有价值的基于位置的特性。</li><li id="0aab" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nn nd ne nf bi translated"><strong class="kt ir">及时</strong>:当用户参与时，如在入职时，当访问基于位置的功能时，或在交易后，显示提示。后台权限提示显示在前台权限提示之后，并且是前台权限提示的增量。</li></ul><p id="a48a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">务必阅读并分享！！</p><p id="53b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢雷达研究人员的<a class="ae ln" href="https://radar.io/blog/understanding-new-location-permissions-in-android-q-and-ios-13" rel="noopener ugc nofollow" target="_blank">细节洞察</a>！</p></div></div>    
</body>
</html>