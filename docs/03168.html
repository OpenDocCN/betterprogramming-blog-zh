<html>
<head>
<title>A Basic Interview Question: Can You Explain What a Closure Is?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个基本的面试问题:你能解释一下什么是闭包吗？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/a-basic-interview-question-can-you-explain-what-a-closure-is-710b75384d48?source=collection_archive---------1-----------------------#2020-01-26">https://betterprogramming.pub/a-basic-interview-question-can-you-explain-what-a-closure-is-710b75384d48?source=collection_archive---------1-----------------------#2020-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b8d9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">答案没有你担心的那么复杂</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4f08c835c92233807936627284c37c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zR0bSmxZnJrmzEhyhixT3g.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">约翰·T在<a class="ae ky" href="https://unsplash.com/s/photos/maze?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="2c04" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">臭名昭著的面试问题</h1><p id="e6d7" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">这些天，我积极地申请和面试工作。也许你也是，亲爱的读者。</p><p id="a464" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">几天前，我参加了一个面试，工程团队让我解释什么是闭包。这当然不是我第一次被问到这个术语，但我不想撒谎，我有点惊慌失措。</p><p id="d5cf" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">闭包因为是一个极其困难的筛选问题而声名狼藉。</p><p id="9b38" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">面试结束后，我很沮丧这个话题仍然让我望而生畏。我决心全力以赴，一劳永逸地战胜封闭。这篇博客带你了解我的旅程。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6abb" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">匿名函数和生命不是闭包</h1><p id="9b36" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在这篇文章的开始，我想澄清一下我将要写的是什么。在ES6之前的时代，闭包的一个常见用例是用来模拟私有方法的匿名函数/life，这不是JavaScript固有的。</p><p id="1336" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">通过在ES6中引入<code class="fe na nb nc nd b">let</code>和<code class="fe na nb nc nd b">const</code>以及模块<strong class="ma iu">，导致这种和其他类似用例的<code class="fe na nb nc nd b">var</code>范围的限制在很大程度上得到了解决。也就是说，生活有结束，但是生活没有结束。</strong></p><p id="6cd5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">匿名函数也是<em class="mz">而不是</em>闭包。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="4165" class="ni lh it nd b gy nj nk l nl nm">anonymousFunc !== closure &amp;&amp; IIFE !== closure // true</span></pre><p id="e22a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">了解这些用例仍然是有价值的。如果你能理解closure在过去是如何使用的，你就会理解它在现在是如何使用的。</p><p id="8e38" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">更不用说还有大量的ES5遗留代码。然而，这不是我今天要讲的内容。既然我们已经澄清了，让我们开始吧。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="1d24" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">作为一个概念的终结</h1><p id="1a61" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在计算机科学中，闭包是一个函数，它有自己的环境，并且在该环境中至少有一个变量。MDN声明:</p><blockquote class="nn"><p id="62b1" class="no np it bd nq nr ns nt nu nv nw mt dk translated">"在JavaScript中，闭包是在每次创建函数时创建的."</p></blockquote><p id="72ec" class="pw-post-body-paragraph ly lz it ma b mb nx ju md me ny jx mg mh nz mj mk ml oa mn mo mp ob mr ms mt im bi translated">因此，函数和闭包是密切相关的。每次你创建一个函数，你都在构建一个闭包，这意味着你可能一直在创建它们，即使你没有意识到这一点！MDN接着说:</p><blockquote class="nn"><p id="cca4" class="no np it bd nq nr ns nt nu nv nw mt dk translated">“一个<strong class="ak">闭包</strong>是一个函数的组合，该函数与对其周围状态的引用捆绑在一起(封闭在一起)。”</p></blockquote><p id="1c9f" class="pw-post-body-paragraph ly lz it ma b mb nx ju md me ny jx mg mh nz mj mk ml oa mn mo mp ob mr ms mt im bi translated">这就把我们带到了<em class="mz">的范围</em>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="03b6" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">范围和这有什么关系</h1><p id="f3d2" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">让我们更深入地挖掘前面引用的术语<em class="mz">周围状态</em>。在JavaScript函数中，周围的状态被称为<em class="mz">范围</em>。</p><p id="80bc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">当你创建一个JS文件时，这个环境就是你的程序的<em class="mz">全局作用域</em>。当你创建一个函数时，它有自己的作用域。</p><p id="dd5e" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">你可能认为全球范围是一个国家。在一个国家内，有许多城市，每个城市都封闭在自己的边界内。类似地，在程序的特定部分，我们会发现用<em class="mz">局部作用域</em>包围的对象。</p><p id="e544" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">Javascript中有两个局部作用域:<em class="mz">函数作用域</em>和<em class="mz">块作用域</em>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="49e3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">函数存在于全局作用域中，并且可以访问全局作用域。在那个函数中声明的任何东西也可以访问全局作用域<em class="mz"> </em>，即使它存在于自己的<em class="mz">函数作用域</em>中。</p><p id="a9c0" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">类似地，如果你在代码中的任何地方用花括号将一个变量括起来，这个变量也将被截掉，它是<em class="mz">块范围的</em>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="dbbb" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">关闭和范围</strong></h1><p id="c3b4" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">把closure想象成封闭一个功能的有感觉或有自我意识的门可能会有帮助。例如，当我们创建一个新函数时，该函数的闭包会环顾四周并注意它的周围环境，它的<em class="mz">作用域</em>。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="530f" class="ni lh it nd b gy nj nk l nl nm">function highestBoxOffice() {<br/>   const context = “The highest grossing movie of all time is “;<br/>      return context + “Avengers: Endgame”;<br/>}</span></pre><p id="a97b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">即使这个函数没有子函数，它仍然有闭包。闭包不仅仅存在于嵌套函数中。这个函数的闭包环顾四周，看到变量存在于其中，在这个例子中，变量是<code class="fe na nb nc nd b">context</code>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="be94" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">嵌套函数中的闭包</h1><p id="414b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">如果我们创建一个嵌套函数，那么这个函数的闭包会看到它所在的父函数的壁。父函数的作用域是嵌套函数的<em class="mz">外部作用域</em>。这包括其父函数内部的变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="1c2f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这就是闭包真正派上用场的地方。我们的函数<code class="fe na nb nc nd b">genreTopGross()</code>有一个闭包。它的闭包向内看，看到自己的<em class="mz">内部作用域</em> <strong class="ma iu"> </strong>，里面围着<code class="fe na nb nc nd b">return Math.Max(…movies.genre.boxOffice)</code>。</p><p id="11fc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">它也向外看，看到它的<em class="mz">外部作用域</em>，表明它在函数<code class="fe na nb nc nd b">highestBoxOffice()</code>内部。它还可以看到并访问传递给其父函数的任何参数。现在让我们加入一个论点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="761a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">正如你所看到的，我们已经声明了一个新的变量，<code class="fe na nb nc nd b">topGrossing()</code>，并为其赋值<code class="fe na nb nc nd b">highestBoxOffice(domesticMoviesObj)</code>。目前，<code class="fe na nb nc nd b">topGrossing</code>还未定义，但现在我们开始下一步:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="9e16" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们调用<code class="fe na nb nc nd b">topGrossing()</code>并将<code class="fe na nb nc nd b">“Romantic Comedy”</code>作为参数传递。现在我们看到了行动的终结！</p><p id="ced5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我们的函数<code class="fe na nb nc nd b">genreTopGross()</code>的内部作用域需要一个<code class="fe na nb nc nd b">movies</code>参数，它位于实参<code class="fe na nb nc nd b">domesticMoviesObj</code>的外部作用域<strong class="ma iu"> </strong>中，它将通过闭包来访问。</p><p id="7841" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这允许代码成功执行，并返回给我们我们正在寻找的值。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="bcf5" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">闭包和范围链</h1><p id="782c" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在JavaScript中，每个变量在第一次创建时都属于一个特定的<a class="ae ky" href="https://github.com/getify/You-Dont-Know-JS/blob/2nd-ed/scope-closures/ch2.md" rel="noopener ugc nofollow" target="_blank">词法范围</a>。</p><p id="84f7" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在一个编写的程序中，每个变量的作用域通过所谓的<em class="mz">作用域链</em>联系在一起，全局作用域总是位于链的顶端。</p><p id="e3d5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">JavaScript编译器遍历这个链。然而，编译器就像一辆汽车，只能倒车，不能前进。</p><p id="355d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">当使用一个变量时，编译器沿着作用域链向上返回，直到找到该变量的一个条目。</p><p id="0eee" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">所以，当函数<code class="fe na nb nc nd b">genreTopGross()</code>使用变量<code class="fe na nb nc nd b">movies</code>时，JavaScript并没有在<code class="fe na nb nc nd b">genreTopGross()</code>的范围内找到<code class="fe na nb nc nd b">movies</code>。因此，JavaScript沿着作用域链向上移动，直到发现<code class="fe na nb nc nd b">movies</code>被传入<code class="fe na nb nc nd b">highestBoxOffice()</code>。</p><p id="4e3b" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这和结案有什么关系？</p><p id="7781" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">闭包只提供从内部到外部范围的访问，不提供从外部到内部范围的访问。</p><p id="55a6" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">因此，如果您在几个嵌套函数中声明并定义了一个变量，但在父函数的外部范围内使用它，编译器将返回一个未定义的错误。记住，汽车只能倒车行驶。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="e87c" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated"><strong class="ak">结论</strong></h1><p id="d85a" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">正如你所看到的，理解闭包需要对功能、作用域和作用域链有一个坚实的理解，这正是雇主在问这个问题时所寻求的。</p><p id="a8cc" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这篇博客涵盖了闭包是什么，但没有涉及它们的许多用例。如果您理解了这一点，您应该能够更深入地研究这些用例，而不会感到完全迷失。</p><p id="e45f" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果没有别的，我希望这提供了一个简单的基础或回顾，让您不要对闭包感到恐慌。</p><p id="cfd3" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">一如既往，感谢阅读。</p><p id="5a2c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在去面试吧！</p></div></div>    
</body>
</html>