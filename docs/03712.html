<html>
<head>
<title>Save Time in Daily Code Review Using Danger</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Danger节省日常代码审查的时间</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/save-time-in-daily-code-review-using-danger-336654fe0d24?source=collection_archive---------9-----------------------#2020-02-28">https://betterprogramming.pub/save-time-in-daily-code-review-using-danger-336654fe0d24?source=collection_archive---------9-----------------------#2020-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3723" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">自动代码审查可以节省团队的时间</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e3e3633d3f32744762f3818ddca81fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pYFGLq1iy6OFELJD.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">危险</p></figure><p id="51d6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码评审是必不可少的，但是你不应该一次评审代码太长时间。你可能会发现自己做出了同样的评论:</p><ul class=""><li id="dffd" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">你需要格式化代码。</li><li id="f77c" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">请为该更改添加一个单元测试。</li><li id="0d67" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">这个PR太长了。请缩短它。</li></ul><p id="37b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">诸如此类。</p><p id="e65a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae mi" href="https://danger.systems/js/" rel="noopener ugc nofollow" target="_blank">危险</a>可以解决这些问题。Danger允许我们通过在您的CI期间运行来自动化常见的代码审查杂务。在本文中，我将向您展示如何使用CI流程在您的应用程序中设置Danger。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e007" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">回购示例</h1><p id="b199" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">以下是完整代码库的链接，以供参考:</p><div class="nn no gp gr np nq"><a href="https://github.com/manakuro/danger-app-example" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd iu gy z fp nv fr fs nw fu fw is bi translated">manakuro/danger-app-示例</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">github.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe ks nq"/></div></div></a></div></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="dd38" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">概观</h1><p id="55ea" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">为了测试危险，我们将按照以下步骤设置React应用程序和CircleCI:</p><ol class=""><li id="deac" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt of ma mb mc bi translated">创建React应用程序。</li><li id="7865" class="lu lv it la b lb md le me lh mf ll mg lp mh lt of ma mb mc bi translated">设置CircleCI。</li><li id="d037" class="lu lv it la b lb md le me lh mf ll mg lp mh lt of ma mb mc bi translated">让危险在CircleCI蔓延。</li><li id="f741" class="lu lv it la b lb md le me lh mf ll mg lp mh lt of ma mb mc bi translated">添加危险规则。</li></ol></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="6a44" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">创建React应用</h1><p id="4558" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">为了快速开始，我们将使用<code class="fe og oh oi oj b"><a class="ae mi" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank">create-react-app</a></code>创建一个应用程序:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="4bbc" class="oo mr it oj b gy op oq l or os">npx create-react-app danger-app --template typescript</span></pre><p id="069c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安装后，您可以运行服务器:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="999d" class="oo mr it oj b gy op oq l or os">yarn dev</span></pre><p id="7138" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您将看到欢迎页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/5c5ddb2342828b80b01c9d7104aa7182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qmmqNpBbYMg1l-pBcVZgEw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">欢迎页面</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="da78" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">建立CircleCI</h1><p id="3f6c" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">接下来，我们将在CircleCI创建一个项目。转到<a class="ae mi" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank"> CircleCI控制台</a>并点击添加项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/00e263307abea4478fb58f5a593f859c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fqnL1WBRhDm9BfaHu9QP_g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CircleCI控制台页面</p></figure><p id="10ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在GitHub存储库中设置您的项目。在这一块，我们将设置<code class="fe og oh oi oj b">danger-app-example</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/b2e0a940246a22f11c71743a9a1c0ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsSsfQfa5J21FklabTI01g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置项目</p></figure><p id="4223" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">单击开始构建:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/755200210043e9d511f8a3a4fb541e3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1XjKRGV03yTXjXwNrBnWLQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">开始建造</p></figure><p id="3271" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来我们将添加<code class="fe og oh oi oj b">.circleci/config.yml</code>，所以点击手动添加按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/1d65b09fbe6712f2edb6dffc22fc4ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZLR0AFEwifZWUiSWhXlmUw.png"/></div></div></figure><p id="5fb4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">既然我们可以使用CircleCI，我们将设置配置文件。让我们创建一个<code class="fe og oh oi oj b">.circleci/config.yml</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="e682" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一项安装节点包依赖项并进行缓存的工作。</p><p id="3e4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您想检查配置是否有效，请在本地计算机上运行以下命令:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="9d45" class="oo mr it oj b gy op oq l or os">$ circleci config validate</span><span id="e268" class="oo mr it oj b gy oz oq l or os">Config file at .circleci/config.yml is valid.</span></pre><p id="165a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在提交和推送之后，您可以在CircleCI控制台中检查流程:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/f4b1da1831fb83b5364e266855d3a1d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ZAyWles2MuNWPM_-Pdpnw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">CircleCI控制台</p></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="754a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">让危险在CircleCI蔓延</h1><p id="64d8" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">Danger提供了一个也支持TypeScript的NPM模块。</p><p id="acf7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安装<code class="fe og oh oi oj b">danger</code>:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="875a" class="oo mr it oj b gy op oq l or os">yarn add -D danger</span></pre><p id="3561" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个<code class="fe og oh oi oj b">dangerfile.ts</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="559c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码将在PR中显示修改后的文件。</p><p id="d2b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将为Danger创建一个在GitHub中使用的令牌。为此，请访问GitHub页面并点击设置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/51acc1e1037208c58fbddfd18c80ed03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F_18YERl2s8DM18WTFA2lA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">开源代码库</p></figure><p id="cdad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">单击开发者设置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/4f259a00c36eee76f301d7f771778aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wQe8O70QtBlsbTcSkxR7Iw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">开发者设置</p></figure><p id="17ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后单击个人访问令牌:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/0def073ccd4fc212da7f3a048edaf4f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQft04zIP_sUlGvwuzwZvw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">个人访问令牌</p></figure><p id="4615" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">单击生成新令牌按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/3c7f79033301533b9abc71c5516e0118.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7ugts6jOiym4Osw64uTtg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">生成新令牌</p></figure><p id="f1a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以选择可以通过GitHub API访问您的信息的范围。对于危险，可以启用<code class="fe og oh oi oj b">repo</code>并生成:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/98cf01ab4981f561de524e96c72c280f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHOFMOjuW1_t0K1hUsCV_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新的个人访问令牌</p></figure><p id="a4c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">生成后，您可以获得列表中的令牌:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/149a98277d0215a2ce8496af640696d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YXJ3DGFUclzb3PLl1LPz0w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">个人访问令牌</p></figure><p id="a059" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">确保复制令牌并将其保存在您的笔记或其他内容中。</p><p id="dd5e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:如果你在组织的项目中，他们建议为Danger创建一个bot帐户，而不是你的帐户。</p><p id="83bf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，转到CircleCI控制台并单击环境变量:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/1fcfb709e63542c40a1d12e78f72bb3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SyQmLyMx9W7oKDW205aBpg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">环境变量</p></figure><p id="58b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">单击添加变量并将其设置为:</p><ul class=""><li id="fdaf" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">名称:<code class="fe og oh oi oj b">DANGER_GITHUB_API_TOKEN</code></li><li id="314e" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">价值:你在上面得到的代币</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/3dc5429fdd83a608a3a7061bcd4792ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lndHNp9P5kGHuLyIlY5VBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">添加环境变量</p></figure><p id="3746" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在Danger可以有权限访问GitHub API了。</p><p id="12f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，为了使危险运行，我们将在<code class="fe og oh oi oj b">.circleci/config.yml</code>中添加作业:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="0366" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并将<code class="fe og oh oi oj b">“danger:ci”: “danger ci”</code>添加到<code class="fe og oh oi oj b">package.json</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="f186" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们创建一些公关，看看它是如何工作的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/cb0574a26c8e4487b3fb695412e67c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*accAn1jt_t06ciKglArUgA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一对</p></figure><p id="5eae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在你的公关评论中看到危险信息。</p><p id="9bfc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:如果您想让Danger在您的本地机器上运行，请运行以下命令:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="6018" class="oo mr it oj b gy op oq l or os">$ DANGER_GITHUB_API_TOKEN={your personal access token} yarn danger pr {your PR url}</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3954" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">添加危险规则</h1><p id="7f5f" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">既然我们已经在CI流程中设置了Danger run，我们将添加一些在代码审查中有用的规则。</p><p id="5452" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这一块，我们将添加这些规则:</p><ul class=""><li id="d0a4" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">鼓励较小的PRs。</li><li id="48bf" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">鼓励更多的测试。</li><li id="7ff5" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">报告测试覆盖率。</li></ul><p id="2955" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们一步一步地创建它们。</p><h2 id="3ce3" class="oo mr it bd ms ph pi dn mw pj pk dp na lh pl pm nc ll pn po ne lp pp pq ng pr bi translated">鼓励较小的PRs</h2><p id="c04a" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">当PR太长(300阈值)时，危险会警告你。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="d5c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在<a class="ae mi" href="https://github.com/manakuro/danger-app-example/pull/2" rel="noopener ugc nofollow" target="_blank">本PR </a>中看到警告信息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/83c3f8b1d63c9eed235155efabeb69aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RL3kF6FVOMsq8nxtmetZuw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">报警信息</p></figure><h2 id="41c1" class="oo mr it bd ms ph pi dn mw pj pk dp na lh pl pm nc ll pn po ne lp pp pq ng pr bi translated">鼓励更多的测试</h2><p id="3144" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">当没有与修改或创建的文件相对应的测试文件时，危险将警告您。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="11e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们对<code class="fe og oh oi oj b">src/App.tsx</code>做一些修改:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/025917aedafd2c1166d731380f42a049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sIV-d7jCZr6UgYWc91IPcg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">鼓励更多的测试</p></figure><p id="db99" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你会在<a class="ae mi" href="https://github.com/manakuro/danger-app-example/pull/3" rel="noopener ugc nofollow" target="_blank">这个PR </a>看到警告:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/0d33c2534af724948df8890e5f296726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2M_vHlfEw7VAeMtm9k3hLA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">警告信息</p></figure><p id="4163" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">挺有用的。如果你修改了<code class="fe og oh oi oj b">src/App.test.tsx</code>，这种情况下危险不会警告你。</p><h2 id="c1d4" class="oo mr it bd ms ph pi dn mw pj pk dp na lh pl pm nc ll pn po ne lp pp pq ng pr bi translated">报告测试覆盖率</h2><p id="49af" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">为了进行危险报告测试覆盖，我们可以使用<a class="ae mi" href="https://github.com/darcy-rayner/danger-plugin-istanbul-coverage" rel="noopener ugc nofollow" target="_blank">危险插件伊斯坦布尔覆盖</a>。</p><p id="dfbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安装它:</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="115f" class="oo mr it oj b gy op oq l or os">$ yarn add -D danger-plugin-istanbul-coverage</span></pre><p id="67a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">启用<code class="fe og oh oi oj b">dangerfile.ts</code>中的插件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="3434" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了完成这项工作，我们需要在运行Danger之前创建覆盖文件，所以在<code class="fe og oh oi oj b">./circleci/config.yml</code>中添加<code class="fe og oh oi oj b">yarn test —ci —coverage —watchAll=false </code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="ccdd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认情况下，Istanbul内置于Jest中，因此您可以通过用<code class="fe og oh oi oj b">—coverage</code>标志触发<code class="fe og oh oi oj b">jest</code>来生成报告。</p><p id="8a29" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:需要禁用<code class="fe og oh oi oj b">watchAll</code>才能在<code class="fe og oh oi oj b">create-react-app</code>中生成覆盖率文件。</p><p id="0e1b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以在本PR 的<a class="ae mi" href="https://github.com/manakuro/danger-app-example/pull/4" rel="noopener ugc nofollow" target="_blank">中看到报告:</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/18876d4d38f6da036edddd07bb0fe2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7HBtaHl81beYaiIVY1rhhw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">报告测试覆盖率</p></figure><p id="3cf5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那是一份出色的报告！</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ee09" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="4d91" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">我们已经介绍了如何通过使用Danger来自动化代码审查中的常见任务。Danger的生态系统中有很多有用的插件，所以你可以根据自己的需要定制规则。</p><div class="nn no gp gr np nq"><a href="https://github.com/danger/awesome-danger" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd iu gy z fp nv fr fs nw fu fw is bi translated">危险/可怕-危险</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">在你的CI之后，一个关于所有危险的可怕列表，自动化你的团队围绕代码的约定…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">github.com</p></div></div><div class="nz l"><div class="pw l ob oc od nz oe ks nq"/></div></div></a></div><p id="b801" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望你能从这篇文章中找到一些灵感。</p><p id="b0b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是最终的代码库:</p><div class="nn no gp gr np nq"><a href="https://github.com/manakuro/danger-app-example" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd iu gy z fp nv fr fs nw fu fw is bi translated">manakuro/danger-app-示例</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">github.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe ks nq"/></div></div></a></div></div></div>    
</body>
</html>