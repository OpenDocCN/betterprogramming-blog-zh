<html>
<head>
<title>Build an HOA Ballot Smart Contract Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建HOA选票智能合同应用程序</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/diving-deep-into-smart-contracts-6e0dfcfa51f2?source=collection_archive---------4-----------------------#2022-08-07">https://betterprogramming.pub/diving-deep-into-smart-contracts-6e0dfcfa51f2?source=collection_archive---------4-----------------------#2022-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0d46" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过使用Solidity、OpenZeppelin、Truffle、MetaMask和React，达成更少争议的协议</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/882fbbfa77eee71d8bb7dcc07dec16a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s4WpdKp7znHI09_L"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">克雷格·怀特黑德在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="6b7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/moving-from-full-stack-developer-to-web3-pioneer-13bf8b415dc9">从全栈开发者到Web3先锋</a>”的故事提供了一个高层次的概述，让全栈开发者一瞥Web3开发的世界。如果您还没有机会阅读那篇文章，可以考虑看一看，因为它也提供了对Web3的很好的介绍。</p><p id="ea44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我最初文章的最终结果展示了一个业主协会(HOA)如何使用Web3技术来主持他们的选举投票。原始设计的问题是，基础智能合约只允许一个是或否的答案。这是为了简化智能合同，同时引入使用Web3技术创建HOA选票所需的其他概念。</p><p id="34cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文旨在更深入地研究智能合约，以构建一个应用程序，该应用程序不仅可以捕获HOA选票的实际需求和功能，还可以设计一个可以在一次选举到下一次选举之间重用的应用程序。</p><h1 id="c3d9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">关于智能合约</h1><p id="2a67" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在我们开始之前，让我们定义一个智能合同:</p><blockquote class="mp mq mr"><p id="dc06" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">“智能合同是在以太坊上的一个地址运行的程序。它们由可以在接收事务时执行的数据和函数组成。这是一份智能合同的概述。<br/>来源<a class="ae kv" href="https://ethereum.org/en/developers/docs/smart-contracts/anatomy/#top" rel="noopener ugc nofollow" target="_blank">ethereum.org</a></p></blockquote><h1 id="e105" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">口香糖贩卖机</h1><p id="0225" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">信不信由你，在一个简单的口香糖贩卖机中可以找到一个智能合同的简单例子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/ef1b4ab99e357c18ac4deadd02d45589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CM27ST5fqeqZV1C82ybeFQ.jpeg"/></div></div></figure><p id="1889" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">人们很容易理解从口香糖贩卖机购买的相关成本。正常情况下，这是一个(美国)季度。这里需要指出的是，顾客是匿名的，因为口香糖贩卖机在给顾客一块香喷喷的口香糖之前不需要知道顾客是谁。</p><p id="138a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">匿名消费者将货币放入口香糖贩卖机并旋转转盘以接受合同条款。这一步很重要，因为交易是透明的，是点对点的:在你和机器之间。交易也是安全的，因为您必须提供预期的货币才能使用口香糖机。</p><p id="a053" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦货币落入口香糖贩卖机，合同条款被接受，一个口香糖球滚向机器底部，允许顾客接收他们的购买。至此，合同完全执行完毕。</p><p id="03f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顾客必须接受所提供的东西，也就是说，他们不能退回口香糖或倒转拨号盘来取回他们的货币。同样，智能合同通常是不可撤销和不可修改的。</p><h1 id="580d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">智能合同用例</h1><p id="f460" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">除了财务驱动的例子之外，一些不可逆和不可修改的匿名的、不可信的、分散的和透明的交互可以被实现的场景如下:</p><ul class=""><li id="7e18" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">临床试验—独立测试的结果</li><li id="681f" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">选举——参与者投票</li><li id="1dba" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">身份—允许个人决定与谁共享身份</li><li id="7eca" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">保险单——个人保单和条款</li><li id="6cf0" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">产品和供应跟踪—生产和供应跟踪的状态跟踪</li><li id="3f04" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">房地产和土地-与房地产和土地相关的契约，可用于在任何时间点得出当前所有者</li><li id="bdb9" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">录音信息——官方记录和抄本(比如葛底斯堡演说)</li></ul><p id="db85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在每种情况下，智能合同的内容都可以尽可能经常地被调用和检查，而不能改变或修改结果。上面的每个用例都将智能合约作为底层信息的记录系统。</p><h1 id="3b36" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">多聪明的合同不是</h1><p id="892e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在这个时间点上，除了少数例外，智能合同不是具有法律约束力的协议。这意味着，如果你对智能合同的结果不满意，在某些法院系统中向法官提出你的问题是不可能的。</p><p id="c474" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也有一些例外，比如在亚利桑那州，智能合同被认为具有法律约束力。此外，如果您在加利福尼亚州，并且您的结婚证包含在智能合同中，则该协议也具有法律约束力。预计未来会有更多政府将智能合同视为具有法律约束力的协议。</p><h1 id="dd27" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">用例:创建一个真实的HOA选票</h1><p id="ab31" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">基于“从全栈开发人员到Web3先锋”出版物中的简单二元(是/否)智能契约，让我们向前迈进一步，假设对于只有一个职位需要填补的社区的HOA投票存在以下要求:</p><ul class=""><li id="9acc" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">选择HOA总统</li></ul><p id="5d80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">理想情况下，目标应该是每次HOA选举都使用单一的智能合同。那些竞选总统职位的人预计会在一次又一次的选举中发生变化。</p><p id="bdb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们开始制定一个智能合同来处理我们的需求。</p><h1 id="9f36" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">定义我们的新智能合同</h1><p id="4a37" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用Solidity，我与<a class="ae kv" href="https://twitter.com/paul_can_code" rel="noopener ugc nofollow" target="_blank">保罗·麦卡维尼</a>一起工作，他为HOA投票精心制作了我们的<a class="ae kv" href="https://github.com/paul-mcaviney/smart-contract-deep-dive" rel="noopener ugc nofollow" target="_blank">智能合同</a>，如下所示:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="0057" class="nq lt iq nm b gy nr ns l nt nu">// SPDX-License-Identifier: MIT<br/>pragma solidity ^0.8.13;<br/><br/><br/>/********************************************************/<br/>/* For learning purposes ONLY. Do not use in production */<br/>/********************************************************/<br/><br/><br/>// Download into project folder with `npm install @openzeppelin/contracts`<br/>import "@openzeppelin/contracts/access/Ownable.sol";<br/><br/>// Inherits the Ownable contract so we can use its functions and modifiers<br/>contract HOABallot is Ownable {<br/><br/>    // Custom type to describe a Presidential Candidate and hold votes<br/>    struct Candidate {<br/>        string name;<br/>        uint256 votes;<br/>    }<br/><br/>    // Array of Presidential Candidates<br/>    Candidate[] public candidates;<br/>    <br/><br/>    // Add a President Candidate - onlyOwner<br/>    function addCandidate(string memory _name) public onlyOwner {<br/>        require(bytes(_name).length &gt; 0, "addCandidate Error: Please enter a name");<br/>        candidates.push(Candidate({name: _name, votes: 0}));<br/>    }<br/><br/><br/>    // Remove a Candidate - onlyOwner<br/>    function removeCandidate(string memory _name) public onlyOwner {<br/>        require(bytes(_name).length &gt; 0, "removeCandidate Error: Please enter a name");<br/>        bool foundCandidate = false;<br/>        uint256 index;<br/>        bytes32 nameEncoded = keccak256(abi.encodePacked(_name));<br/><br/>        // Set index number for specific candidate<br/>        for (uint256 i = 0; i &lt; candidates.length; i++) {<br/>            if (keccak256(abi.encodePacked(candidates[i].name)) == nameEncoded) {<br/>                index = i;<br/>                foundCandidate = true;<br/>            }<br/>        }<br/><br/>        // Make sure a candidate was found<br/>        require(foundCandidate, "removeCandidate Error: Candidate not found");<br/><br/>        // shift candidate to be removed to the end of the array and the rest forward<br/>        for (uint256 i = index; i &lt; candidates.length - 1; i++) {<br/>            candidates[i] = candidates[i + 1];<br/>        }<br/><br/>        // remove last item from array<br/>        candidates.pop();<br/>    }<br/><br/><br/>    // Reset the President Vote Counts - onlyOwner<br/>    function resetVoteCount() public onlyOwner {<br/>        for (uint256 p = 0; p &lt; candidates.length; p++) {<br/>            candidates[p].votes = 0;<br/>        }<br/>    }<br/><br/><br/>    // Add a vote to a candidate by name<br/>    function addVoteByName(string memory _name) public {<br/>        require(bytes(_name).length &gt; 0, "addVoteByName Error: Please enter a name");<br/>        // Encode name so only need to do once<br/>        bytes32 nameEncoded = keccak256(abi.encodePacked(_name));<br/><br/>        for (uint256 i = 0; i &lt; candidates.length; i++) {<br/>            // solidity can't compare strings directly, need to compare hash<br/>            if (keccak256(abi.encodePacked(candidates[i].name)) == nameEncoded) {<br/>                candidates[i].votes += 1;<br/>            }<br/>        }<br/>    }<br/><br/><br/>    // Returns all the Presidential Candidates and their vote counts<br/>    function getCandidates() public view returns (Candidate[] memory) {<br/>        return candidates;<br/>    }<br/><br/><br/>    function getWinner() public view returns (Candidate memory winner) {<br/>        uint256 winningVoteCount = 0;<br/>        for (uint256 i = 0; i &lt; candidates.length; i++) {<br/>            if (candidates[i].votes &gt; winningVoteCount) {<br/>                winningVoteCount = candidates[i].votes;<br/>                winner = candidates[i];<br/>            }<br/>        }<br/><br/>        return winner;<br/>    }<br/>    <br/>}</span></pre><p id="36bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是与智能合同设计相关的一些关键项目:</p><ul class=""><li id="5ef3" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">默认情况下，选票上没有候选人。</li><li id="3ec5" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">可以使用<code class="fe nv nw nx nm b">addCandidate() </code>功能添加候选人(仅由智能合同所有者添加)。</li><li id="bc96" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">类似地，可以使用<code class="fe nv nw nx nm b">removeCandidate()</code>功能删除候选人(仅由智能合同所有者删除)。</li><li id="54f0" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">投票将利用<code class="fe nv nw nx nm b"> getCandidates()</code>函数，该函数可以在相应的Dapp中用来调用<code class="fe nv nw nx nm b">addVoteByName()</code>函数。</li><li id="0aa4" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">可以调用同样的<code class="fe nv nw nx nm b">getCandidates()</code>方法来确定当前的投票数。</li><li id="d63f" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">OpenZeppelin的Ownable契约启用了契约的所有权，以及将所有权转移到另一个地址的能力。</li></ul><p id="5437" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们准备好使用智能合约。</p><h1 id="311e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">准备使用智能合同</h1><p id="a226" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了能够使用我们的智能契约，我们将构建一个简单的Truffle项目，并将该契约部署到Ropsten testnet。为此，我们首先需要最新版本的块菌。随着<a class="ae kv" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank"> NPM安装</a>，运行命令:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="cd0b" class="nq lt iq nm b gy nr ns l nt nu">npm install -g truffle</span></pre><p id="e605" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装最新版本将使我们能够访问<a class="ae kv" href="https://trufflesuite.com/docs/truffle/getting-started/using-the-truffle-dashboard/" rel="noopener ugc nofollow" target="_blank"> Truffle Dashboard </a>，这将使部署我们的智能合同变得更加容易和安全，因为我们不必分享我们的私人钱包钥匙或助记短语。不过，我们稍后会谈到这一点。</p><p id="504c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，创建一个新目录并初始化一个新的Truffle项目。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="d2ce" class="nq lt iq nm b gy nr ns l nt nu">mkdir hoa-ballot-contract &amp;&amp; cd hoa-ballot-contract<br/>truffle init</span></pre><p id="dc8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将创建一个准系统智能合同项目，我们可以填写我们认为合适的。因此，在您最喜欢的代码编辑器中打开项目，让我们开始吧！</p><p id="a87a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了利用OpenZeppelin，还需要在项目文件夹中执行以下命令:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="7407" class="nq lt iq nm b gy nr ns l nt nu">npm install @openzeppelin/contracts</span></pre><p id="7fbc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<code class="fe nv nw nx nm b">truffle-config.js</code>文件，我们将在<code class="fe nv nw nx nm b">networks</code>对象中添加松露仪表板。除了所有被注释掉的样板文件，我们的对象现在应该是这样的:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="49bc" class="nq lt iq nm b gy nr ns l nt nu">networks: {<br/>  dashboard: {<br/>    port: 24012,<br/>  }<br/>}</span></pre><p id="2ec5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步，我们将创建一个新的智能合同文件。在<code class="fe nv nw nx nm b">contracts</code>文件夹中，创建一个新文件并命名为<code class="fe nv nw nx nm b">HOABallot.sol</code>。从这里开始，我们只需粘贴上面的智能合同。</p><p id="ea09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在部署这个契约之前，我们需要做的最后一件事是设置部署脚本。使用下面的内容，我们需要在<code class="fe nv nw nx nm b">migrations</code>文件夹中创建一个名为<code class="fe nv nw nx nm b">2_hoaballot_migration.js</code>的新文件。</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="5d56" class="nq lt iq nm b gy nr ns l nt nu">const HOABallot = artifacts.require("HOABallot");<br/><br/>Module.exports = function (deployer) {<br/>  deployer.deploy(HOABallot);<br/>}</span></pre><p id="7ce5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经准备好将我们的合同部署到Ropsten testnet。在新的终端窗口中，键入以下命令启动仪表板:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="990e" class="nq lt iq nm b gy nr ns l nt nu">truffle dashboard</span></pre><p id="4fda" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦它运行，我们的浏览器应该会弹出一个界面，要求我们连接我们的钱包。如果这没有为您弹出，请导航到<code class="fe nv nw nx nm b">localhost:24012</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/e7ca694d957cdf993c5c901612afb85d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lQ-2yaDldXEphkm6MNf_XA.png"/></div></div></figure><p id="faa7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单击“元掩码”按钮将通过浏览器插件启动元掩码。如果你没有安装钱包浏览器扩展，你可以在<a class="ae kv" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank"> metamask.io </a>获得一个。按照步骤创建帐户，然后返回到Truffle仪表板进行连接:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/758cf2b50bf3dec3c4e3dd540addf42b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u6Zxrw5fVRCdjbHq4ZObZQ.png"/></div></div></figure><p id="f7da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输入有效密码并使用“解锁”按钮后，Truffle仪表盘会确认要使用的网络:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/f5f9d36758267c60b82d1f4f239e4b8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WKEDtqQCM7A4LxAXWMwVjA.png"/></div></div></figure><p id="84b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击“确认”按钮后，Truffle仪表板现在正在监听请求:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/9a1e076aacb9051ebc6c6ddf55c8b5f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15IUnc4XQOCs0haGMvIIEw.png"/></div></div></figure><p id="718a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要Ropsten Eth来执行部署。如果你没有，你可以<a class="ae kv" href="https://faucet.egorfine.com/" rel="noopener ugc nofollow" target="_blank">在这个水龙头</a>要求一些。</p><p id="2c35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在要做的就是部署合同。在原来的终端窗口中，确保您位于项目文件夹中，并键入命令:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="5635" class="nq lt iq nm b gy nr ns l nt nu">truffle migrate --network dashboard</span></pre><p id="9767" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Truffle将自动编译我们的智能合同，然后通过仪表板发送请求。每个请求将遵循下面列出的相同流程。</p><p id="eebd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，Truffle仪表板要求确认处理请求:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/4438f7f09eaf6ced07f293591debca62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TKE4X2SxoDEYXbf3IZpHWg.png"/></div></div></figure><p id="be06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">按下“PROCESS”按钮后，MetaMask插件也会要求确认:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/4dc7cfe60dbd0f8913f7a3614c1f1a9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YRJG6ZghvgXHIfaDhtH7yg.png"/></div></div></figure><p id="7325" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“确认”按钮将允许从相关联的钱包中取出资金来处理每个请求。</p><p id="2472" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该过程完成后，用于发出truffle migrate命令的终端窗口中将出现以下信息:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="fd44" class="nq lt iq nm b gy nr ns l nt nu">2_hoaballot_migration.js<br/>========================<br/><br/>   Deploying 'HOABallot'<br/>   ---------------------<br/>   &gt; transaction hash:    0x5370b6f9ee1f69e92cc6289f9cb0880386f15bff389b54ab09a966c5d144f59esage.<br/>   &gt; Blocks: 0            Seconds: 32<br/>   &gt; contract address:    0x2981d347e288E2A4040a3C17c7e5985422e3cAf2<br/>   &gt; block number:        12479257<br/>   &gt; block timestamp:     1656386400<br/>   &gt; account:             0x7fC3EF335D16C0Fd4905d2C44f49b29BdC233C94<br/>   &gt; balance:             41.088173901232893417<br/>   &gt; gas used:            1639525 (0x190465)<br/>   &gt; gas price:           2.50000001 gwei<br/>   &gt; value sent:          0 ETH<br/>   &gt; total cost:          0.00409881251639525 ETH<br/><br/>   &gt; Saving migration to chain.<br/>   &gt; Saving artifacts<br/>   -------------------------------------<br/>   &gt; Total cost:     0.00409881251639525 ETH<br/><br/>Summary<br/>=======<br/>&gt; Total deployments:   1<br/>&gt; Final cost:          0.00409881251639525 ETH</span></pre><p id="fc06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，使用<code class="fe nv nw nx nm b">contract address</code>值，我们可以使用以下URL来验证智能合约:</p><p id="97d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nv nw nx nm b"><a class="ae kv" href="https://ropsten.etherscan.io/address/0x2981d347e288E2A4040a3C17c7e5985422e3cAf2" rel="noopener ugc nofollow" target="_blank">https://ropsten.etherscan.io/address/0x2981d347e288E2A4040a3C17c7e5985422e3cAf2</a></code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/c61e5da8fd096e13ef48f8e18a4cb402.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UC--Uy4afYSf06vINqjMJA.png"/></div></div></figure><p id="7393" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以切换并开始构建Dapp。</p><h1 id="9dad" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用React创建HOA选票Dapp</h1><p id="5ea1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我将使用React CLI创建一个名为<code class="fe nv nw nx nm b">hoa-ballot-client</code>的React应用程序:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="3c13" class="nq lt iq nm b gy nr ns l nt nu">npx create-react-app hoa-ballot-client</span></pre><p id="cf04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我将目录更改到新创建的文件夹中，并执行以下命令将web3和OpenZepplin依赖项安装到React应用程序中:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="4c52" class="nq lt iq nm b gy nr ns l nt nu">cd hoa-ballot-client<br/>npm install web3</span><span id="2baf" class="nq lt iq nm b gy od ns l nt nu">npm install @openzeppelin/contracts —save</span></pre><p id="2dfd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着核心React应用程序准备就绪，需要建立一个契约应用程序二进制接口(ABI ),以允许我们的Dapp与以太坊生态系统上的契约进行通信。</p><p id="2a85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基于<code class="fe nv nw nx nm b">HOABallot.sol</code>智能契约文件的内容，我导航到build/contracts文件夹并打开<code class="fe nv nw nx nm b">HOBallot.json</code>文件，然后使用<code class="fe nv nw nx nm b">abi.js</code>文件的<code class="fe nv nw nx nm b">hoaBallot</code>常量的“abi”属性值，如下所示:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="c702" class="nq lt iq nm b gy nr ns l nt nu">export const hoaBallot = [<br/>  {<br/>    "anonymous": false,<br/>    "inputs": [<br/>      {<br/>        "indexed": true,<br/>        "internalType": "address",<br/>        "name": "previousOwner",<br/>        "type": "address"<br/>      },<br/>      {<br/>        "indexed": true,<br/>        "internalType": "address",<br/>        "name": "newOwner",<br/>        "type": "address"<br/>      }<br/>    ],<br/>    "name": "OwnershipTransferred",<br/>    "type": "event"<br/>  },<br/>  {<br/>    "inputs": [<br/>      {<br/>        "internalType": "uint256",<br/>        "name": "",<br/>        "type": "uint256"<br/>      }<br/>    ],<br/>    "name": "candidates",<br/>    "outputs": [<br/>      {<br/>        "internalType": "string",<br/>        "name": "name",<br/>        "type": "string"<br/>      },<br/>      {<br/>        "internalType": "uint256",<br/>        "name": "votes",<br/>        "type": "uint256"<br/>      }<br/>    ],<br/>    "stateMutability": "view",<br/>    "type": "function",<br/>    "constant": true<br/>  },<br/>  {<br/>    "inputs": [],<br/>    "name": "owner",<br/>    "outputs": [<br/>      {<br/>        "internalType": "address",<br/>        "name": "",<br/>        "type": "address"<br/>      }<br/>    ],<br/>    "stateMutability": "view",<br/>    "type": "function",<br/>    "constant": true<br/>  },<br/>  {<br/>    "inputs": [],<br/>    "name": "renounceOwnership",<br/>    "outputs": [],<br/>    "stateMutability": "nonpayable",<br/>    "type": "function"<br/>  },<br/>  {<br/>    "inputs": [<br/>      {<br/>        "internalType": "address",<br/>        "name": "newOwner",<br/>        "type": "address"<br/>      }<br/>    ],<br/>    "name": "transferOwnership",<br/>    "outputs": [],<br/>    "stateMutability": "nonpayable",<br/>    "type": "function"<br/>  },<br/>  {<br/>    "inputs": [<br/>      {<br/>        "internalType": "string",<br/>        "name": "_name",<br/>        "type": "string"<br/>      }<br/>    ],<br/>    "name": "addCandidate",<br/>    "outputs": [],<br/>    "stateMutability": "nonpayable",<br/>    "type": "function"<br/>  },<br/>  {<br/>    "inputs": [<br/>      {<br/>        "internalType": "string",<br/>        "name": "_name",<br/>        "type": "string"<br/>      }<br/>    ],<br/>    "name": "removeCandidate",<br/>    "outputs": [],<br/>    "stateMutability": "nonpayable",<br/>    "type": "function"<br/>  },<br/>  {<br/>    "inputs": [],<br/>    "name": "resetVoteCount",<br/>    "outputs": [],<br/>    "stateMutability": "nonpayable",<br/>    "type": "function"<br/>  },<br/>  {<br/>    "inputs": [<br/>      {<br/>        "internalType": "string",<br/>        "name": "_name",<br/>        "type": "string"<br/>      }<br/>    ],<br/>    "name": "addVoteByName",<br/>    "outputs": [],<br/>    "stateMutability": "nonpayable",<br/>    "type": "function"<br/>  },<br/>  {<br/>    "inputs": [],<br/>    "name": "getCandidates",<br/>    "outputs": [<br/>      {<br/>        "components": [<br/>          {<br/>            "internalType": "string",<br/>            "name": "name",<br/>            "type": "string"<br/>          },<br/>          {<br/>            "internalType": "uint256",<br/>            "name": "votes",<br/>            "type": "uint256"<br/>          }<br/>        ],<br/>        "internalType": "struct HOABallot.Candidate[]",<br/>        "name": "",<br/>        "type": "tuple[]"<br/>      }<br/>    ],<br/>    "stateMutability": "view",<br/>    "type": "function",<br/>    "constant": true<br/>  },<br/>  {<br/>    "inputs": [],<br/>    "name": "getWinner",<br/>    "outputs": [<br/>      {<br/>        "components": [<br/>          {<br/>            "internalType": "string",<br/>            "name": "name",<br/>            "type": "string"<br/>          },<br/>          {<br/>            "internalType": "uint256",<br/>            "name": "votes",<br/>            "type": "uint256"<br/>          }<br/>        ],<br/>        "internalType": "struct HOABallot.Candidate",<br/>        "name": "winner",<br/>        "type": "tuple"<br/>      }<br/>    ],<br/>    "stateMutability": "view",<br/>    "type": "function",<br/>    "constant": true<br/>  }<br/>];</span></pre><p id="7503" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个文件被放到React应用程序的src文件夹中一个新创建的<code class="fe nv nw nx nm b">abi</code>文件夹中。</p><p id="08bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们需要更新React <code class="fe nv nw nx nm b">Apps.js</code>文件。让我们首先从文件的顶部开始，它需要如下所示进行配置:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="8ed1" class="nq lt iq nm b gy nr ns l nt nu">import React, { useState } from "react";<br/>import { hoaBallot } from "./abi/abi";<br/>import Web3 from "web3";<br/>import "./App.css";<br/><br/>const web3 = new Web3(Web3.givenProvider);<br/>const contractAddress = "0x2981d347e288E2A4040a3C17c7e5985422e3cAf2";<br/>const storageContract = new web3.eth.Contract(hoaBallot, contractAddress);</span></pre><p id="4c10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nv nw nx nm b">contractAddress</code>可以通过多种方式找到。在本例中，我使用了truffle — migrate CLI命令中的结果。另一个选择是使用Etherscan网站。</p><p id="4b1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，剩下的就是创建标准的React代码来完成以下事情:</p><ul class=""><li id="465b" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">增加一名HOA总统候选人</li><li id="8a8c" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">罢免HOA总统候选人</li><li id="0531" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">得到HOA总统候选人的名单</li><li id="47ef" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">投票给HOA总统候选人</li><li id="8cfc" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">确定HOA总统</li></ul><p id="6b1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的“从全栈开发人员转向Web3先锋”出版物中，我也添加了Nav组件，因此投票人的地址会显示出来以便于参考。</p><p id="e688" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更新后的React应用程序现在如下所示:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="0323" class="nq lt iq nm b gy nr ns l nt nu">const web3 = new Web3(Web3.givenProvider);<br/>const contractAddress = "0x2981d347e288E2A4040a3C17c7e5985422e3cAf2";<br/>const storageContract = new web3.eth.Contract(hoaBallot, contractAddress);<br/>const gasMultiplier = 1.5;<br/><br/>const useStyles = makeStyles((theme) =&gt; ({<br/>  root: {<br/>    "&amp; &gt; *": {<br/>      margin: theme.spacing(1),<br/>    },<br/>  },<br/>}));<br/><br/>const StyledTableCell = styled(TableCell)(({ theme }) =&gt; ({<br/>  [`&amp;.${tableCellClasses.head}`]: {<br/>    backgroundColor: theme.palette.common.black,<br/>    color: theme.palette.common.white,<br/>    fontSize: 14,<br/>    fontWeight: 'bold'<br/>  },<br/>  [`&amp;.${tableCellClasses.body}`]: {<br/>    fontSize: 14<br/>  },<br/>}));<br/><br/>function App() {<br/>  const classes = useStyles();<br/>  const [newCandidateName, setNewCandidateName] = useState("");<br/>  const [account, setAccount] = useState("");<br/>  const [owner, setOwner] = useState("");<br/>  const [candidates, updateCandidates] = useState([]);<br/>  const [winner, setWinner] = useState("unknown candidate");<br/>  const [waiting, setWaiting] = useState(false);<br/><br/>  const loadAccount = async(useSpinner) =&gt; {<br/>    if (useSpinner) {<br/>      setWaiting(true);<br/>    }<br/><br/>    const web3 = new Web3(Web3.givenProvider || "http://localhost:8080");<br/>    const accounts = await web3.eth.getAccounts();<br/>    setAccount(accounts[0]);<br/><br/>    if (useSpinner) {<br/>      setWaiting(false);<br/>    }<br/>  }<br/><br/>  const getOwner = async (useSpinner) =&gt; {<br/>    if (useSpinner) {<br/>      setWaiting(true);<br/>    }<br/><br/>    const owner = await storageContract.methods.owner().call();<br/>    setOwner(owner);<br/><br/>    if (useSpinner) {<br/>      setWaiting(false);<br/>    }<br/>  };<br/><br/>  const getCandidates = async (useSpinner) =&gt; {<br/>    if (useSpinner) {<br/>      setWaiting(true);<br/>    }<br/><br/>    const candidates = await storageContract.methods.getCandidates().call();<br/><br/>    updateCandidates(candidates);<br/><br/>    await determineWinner();<br/><br/>    if (useSpinner) {<br/>      setWaiting(false);<br/>    }<br/>  };<br/><br/>  const determineWinner = async () =&gt; {<br/>    const winner = await storageContract.methods.getWinner().call();<br/><br/>    if (winner &amp;&amp; winner.name) {<br/>      setWinner(winner.name);<br/>    } else {<br/>      setWinner("&lt;unknown candidate&gt;")<br/>    }<br/>  }<br/><br/>  const vote = async (candidate) =&gt; {<br/>    setWaiting(true);<br/><br/>    const gas = (await storageContract.methods.addVoteByName(candidate).estimateGas({<br/>      data: candidate,<br/>      from: account<br/>    })) * gasMultiplier;<br/><br/>    let gasAsInt = gas.toFixed(0);<br/><br/>    await storageContract.methods.addVoteByName(candidate).send({<br/>      from: account,<br/>      data: candidate,<br/>      gasAsInt,<br/>    });<br/><br/>    await getCandidates(false);<br/><br/>    setWaiting(false);<br/>  }<br/><br/>  const removeCandidate = async (candidate) =&gt; {<br/>    setWaiting(true);<br/><br/>    const gas = (await storageContract.methods.removeCandidate(candidate).estimateGas({<br/>      data: candidate,<br/>      from: account<br/>    })) * gasMultiplier;<br/><br/>    let gasAsInt = gas.toFixed(0);<br/><br/>    await storageContract.methods.removeCandidate(candidate).send({<br/>      from: account,<br/>      data: candidate,<br/>      gasAsInt,<br/>    });<br/><br/>    await getCandidates(false);<br/><br/>    setWaiting(false);<br/>  }<br/><br/>  const addCandidate = async () =&gt; {<br/>    setWaiting(true);<br/><br/>    const gas = (await storageContract.methods.addCandidate(newCandidateName).estimateGas({<br/>      data: newCandidateName,<br/>      from: account<br/>    })) * gasMultiplier;<br/><br/>    let gasAsInt = gas.toFixed(0);<br/><br/>    await storageContract.methods.addCandidate(newCandidateName).send({<br/>      from: account,<br/>      data: newCandidateName,<br/>      gasAsInt,<br/>    });<br/><br/>    await getCandidates(false);<br/><br/>    setWaiting(false);<br/>  }<br/><br/>  React.useEffect(() =&gt; {<br/>    setWaiting(true);<br/>    getOwner(false).then(r =&gt; {<br/>      loadAccount(false).then(r =&gt; {<br/>        getCandidates(false).then(r =&gt; {<br/>          setWaiting(false);<br/>        });<br/>      });<br/>    });<br/><br/>    // eslint-disable-next-line react-hooks/exhaustive-deps<br/>  },[]);<br/><br/>  return (<br/>      &lt;div className={classes.root}&gt;<br/>        &lt;Nav /&gt;<br/>        &lt;div className="main"&gt;<br/>          &lt;div className="card"&gt;<br/>            &lt;Typography variant="h3"&gt;<br/>              HOABallot<br/>            &lt;/Typography&gt;<br/><br/>            {(owner &amp;&amp; owner.length &gt; 0) &amp;&amp; (<br/>                &lt;div className="paddingBelow"&gt;<br/>                  &lt;Typography variant="caption" &gt;<br/>                    This ballot is owned by: {owner}<br/>                  &lt;/Typography&gt;<br/>                &lt;/div&gt;<br/>            )}<br/><br/>            {waiting &amp;&amp; (<br/>                &lt;div className="spinnerArea" &gt;<br/>                  &lt;CircularProgress /&gt;<br/>                  &lt;Typography gutterBottom&gt;<br/>                    Processing Request ... please wait<br/>                  &lt;/Typography&gt;<br/>                &lt;/div&gt;<br/>            )}<br/><br/>            {(owner &amp;&amp; owner.length &gt; 0 &amp;&amp; account &amp;&amp; account.length &gt; 0 &amp;&amp; owner === account) &amp;&amp; (<br/>                &lt;div className="ownerActions generalPadding"&gt;<br/>                  &lt;Grid container spacing={3}&gt;<br/>                    &lt;Grid item xs={12}&gt;<br/>                      &lt;Typography variant="h6" gutterBottom&gt;<br/>                        Ballot Owner Actions<br/>                      &lt;/Typography&gt;<br/>                    &lt;/Grid&gt;<br/>                    &lt;Grid item xs={6} sm={6}&gt;<br/>                      &lt;TextField id="newCandidateName"<br/>                                 value={newCandidateName}<br/>                                 label="Candidate Name"<br/>                                 variant="outlined"<br/>                                 onChange={event =&gt; {<br/>                                   const { value } = event.target;<br/>                                   setNewCandidateName(value);<br/>                                 }}<br/>                      /&gt;<br/>                    &lt;/Grid&gt;<br/>                    &lt;Grid item xs={6} sm={6}&gt;<br/>                      &lt;Button<br/>                          id="addCandidateButton"<br/>                          className="button"<br/>                          variant="contained"<br/>                          color="primary"<br/>                          type="button"<br/>                          size="large"<br/>                          onClick={addCandidate}&gt;Add New Candidate&lt;/Button&gt;<br/>                    &lt;/Grid&gt;<br/>                  &lt;/Grid&gt;<br/>                &lt;/div&gt;<br/>            )}<br/><br/>            &lt;Typography variant="h5" gutterBottom className="generalPadding"&gt;<br/>              Candidates<br/>            &lt;/Typography&gt;<br/><br/>            {(!candidates || candidates.length === 0) &amp;&amp; (<br/>                &lt;div&gt;<br/>                  &lt;div className="paddingBelow"&gt;<br/>                    &lt;Typography variant="normal"&gt;<br/>                      No candidates current exist.<br/>                    &lt;/Typography&gt;<br/>                  &lt;/div&gt;<br/>                  &lt;div&gt;<br/>                    &lt;Typography variant="normal" gutterBottom&gt;<br/>                      Ballot owner must use the &lt;strong&gt;ADD NEW CANDIDATE&lt;/strong&gt; button to add candidates.<br/>                    &lt;/Typography&gt;<br/>                  &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            )}<br/><br/>            {(candidates &amp;&amp; candidates.length &gt; 0) &amp;&amp; (<br/>                &lt;div&gt;<br/>                  &lt;TableContainer component={Paper}&gt;<br/>                    &lt;Table sx={{ minWidth: 650 }} aria-label="customized table"&gt;<br/>                      &lt;TableHead&gt;<br/>                        &lt;TableRow&gt;<br/>                          &lt;StyledTableCell&gt;Candidate Name&lt;/StyledTableCell&gt;<br/>                          &lt;StyledTableCell align="right"&gt;Votes&lt;/StyledTableCell&gt;<br/>                          &lt;StyledTableCell align="center"&gt;Actions&lt;/StyledTableCell&gt;<br/>                        &lt;/TableRow&gt;<br/>                      &lt;/TableHead&gt;<br/>                      &lt;TableBody&gt;<br/>                        {candidates.map((row) =&gt; (<br/>                            &lt;TableRow<br/>                                key={row.name}<br/>                                sx={{ '&amp;:last-child td, &amp;:last-child th': { border: 0 } }}<br/>                            &gt;<br/>                              &lt;TableCell component="th" scope="row"&gt;<br/>                                {row.name}<br/>                              &lt;/TableCell&gt;<br/>                              &lt;TableCell align="right"&gt;{row.votes}&lt;/TableCell&gt;<br/>                              &lt;TableCell align="center"&gt;<br/>                                &lt;Button<br/>                                    color="success"<br/>                                    variant="contained"<br/>                                    onClick={() =&gt; {<br/>                                      vote(row.name);<br/>                                    }}<br/>                                &gt;<br/>                                    Vote<br/>                                &lt;/Button&gt; &amp;nbsp;<br/>                                {(owner &amp;&amp; owner.length &gt; 0 &amp;&amp; account &amp;&amp; account.length &gt; 0 &amp;&amp; owner === account) &amp;&amp;<br/>                                  &lt;Button<br/>                                      color="error"<br/>                                      variant="contained"<br/>                                      onClick={() =&gt; {<br/>                                        removeCandidate(row.name);<br/>                                      }}<br/>                                  &gt;<br/>                                    Remove Candidate<br/>                                  &lt;/Button&gt;<br/>                                }<br/>                              &lt;/TableCell&gt;<br/>                            &lt;/TableRow&gt;<br/>                        ))}<br/>                      &lt;/TableBody&gt;<br/>                    &lt;/Table&gt;<br/>                  &lt;/TableContainer&gt;<br/>                  &lt;div className="generalPadding"&gt;<br/>                    &lt;Typography variant="normal" gutterBottom&gt;<br/>                      {winner} is winning the election.<br/>                    &lt;/Typography&gt;<br/>                  &lt;/div&gt;<br/><br/>                &lt;/div&gt;<br/>            )}<br/>          &lt;/div&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>  );<br/>}<br/><br/>export default App;</span></pre><p id="32f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要启动基于React的Dapp，可以使用Yarn CLI:</p><pre class="kg kh ki kj gt nl nm nn no aw np bi"><span id="72d9" class="nq lt iq nm b gy nr ns l nt nu">yarn start</span></pre><p id="60d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编译和验证后，应用程序将出现在屏幕上，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="fef7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在视频中:</p><ul class=""><li id="5d7c" class="mx my iq ky b kz la lc ld lf mz lj na ln nb lr nc nd ne nf bi translated">我验证了我是合同所有人，因为“您的关联地址”值与“此投票的所有者”值匹配，并且显示了“投票所有人操作”部分。</li><li id="22b6" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">作为合同所有者，我可以看到并使用“添加新候选人”按钮来建立选举候选人。在这个例子中，我使用了戴夫·布朗和史蒂夫·史密斯的名字。</li><li id="58b0" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">作为合同所有者，我也可以使用“删除候选人”按钮。</li><li id="f495" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">在创建了两个候选人之后，我使用与所需候选人相同行上的“投票”按钮为两个候选人中的一个投票。我投票给戴夫·布朗。</li><li id="dba8" class="mx my iq ky b kz ng lc nh lf ni lj nj ln nk lr nc nd ne nf bi translated">当前的选举获胜者显示在候选人表格的下方。在这种情况下，它是戴夫·布朗。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/a6b611b4bfd7891473aa4c5f1c245c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lwWCiNPDRPssV2yswKeb-g.png"/></div></div></figure><p id="346f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">自部署智能合同以来，任何人都可以在以下URL查看完整的历史记录:</p><p id="b616" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nv nw nx nm b"><a class="ae kv" href="https://ropsten.etherscan.io/address/0x2981d347e288E2A4040a3C17c7e5985422e3cAf2" rel="noopener ugc nofollow" target="_blank">https://ropsten.etherscan.io/address/0x2981d347e288E2A4040a3C17c7e5985422e3cAf2</a></code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/2b96f05fc8aa105cbb19a8f330d58c34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Of-rU71CMj6giSKyh1TAsg.png"/></div></div></figure><h1 id="a1e2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="05ee" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">自2021年以来，我一直试图按照以下使命宣言生活，我觉得这可以适用于任何技术专业人士:</p><blockquote class="mp mq mr"><p id="b817" class="kw kx ms ky b kz la jr lb lc ld ju le mt lg lh li mu lk ll lm mv lo lp lq lr ij bi translated">“将您的时间集中在提供扩展您知识产权价值的特性/功能上。将框架、产品和服务用于其他一切。”<em class="iq"> <br/> — J. Vester </em></p></blockquote><p id="c0a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">智能合同提供了允许双方达成协议的能力，其中合同的结果成为固定的交易正式记录。采用智能契约符合我的使命声明，因为当需要这样的契约时，底层框架避免了重新发明轮子。</p><p id="58fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同时，智能合约设计更进一步，从可重用性的角度满足了我的使命陈述。在本例中，可以使用相同的HOA智能合同，尽管当前选举中有不同的候选人。在这里，我们利用智能合约的功能来避免每次选举时都创建新的智能合约。</p><p id="b7c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当使用Etherscan查找使用Google的ETH to USD转换器的交易之一的转换值时，每笔交易的成本为0.0001348975 ETH的0.24 (USD)。具有讽刺意味的是，这是我小时候用口香糖贩卖机买一个普通口香糖球的价格。</p><p id="5684" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想了解更多关于智能合同的信息，ConsenSys 的团队已经提供了很好的资源来帮助你原型化你的想法，看看智能合同的采用是否是一个有效的用例。</p><p id="8443" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您对本文的源代码感兴趣，可以在以下URL找到它:</p><p id="3f5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/paul-mcaviney/smart-contract-deep-dive/blob/main/HOABallot.sol" rel="noopener ugc nofollow" target="_blank">https://github . com/Paul-mcaviney/smart-contract-deep-dive/blob/main/Hoa ballot . sol</a></p><p id="65c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">【https://gitlab.com/johnjvester/hoa-ballot-contract T4】</p><p id="6902" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://gitlab.com/johnjvester/hoa-ballot-client" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/johnjvester/hoa-ballot-client</a></p><p id="4aae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">祝你今天过得愉快！</p></div></div>    
</body>
</html>