<html>
<head>
<title>The Current State of Infrastructure From Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从代码看基础设施的当前状态</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-current-state-of-infrastructure-from-code-cbd3469ecdc5?source=collection_archive---------2-----------------------#2022-11-16">https://betterprogramming.pub/the-current-state-of-infrastructure-from-code-cbd3469ecdc5?source=collection_archive---------2-----------------------#2022-11-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="46b1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我测试了代码框架的三个基础设施，得到了截然不同的体验。这是我的发现。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2bcf1352aef8506cf76a7be03a42435e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_HAfERuAILCHejhqtoH9ZA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">免费视频上由<a class="ae ky" href="https://www.freepik.com/free-vector/business-performance-analysis-with-graphs_3425213.htm#query=investigate&amp;position=37&amp;from_view=search&amp;track=sph" rel="noopener ugc nofollow" target="_blank">rawpixel.com</a>拍摄的图片</p></figure><p id="bd4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章已经等了很久了。</p><p id="586d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到九月份，我取笑了一下<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/my-first-impressions-of-infrastructure-as-code-13c44bdc7743">我对Code (IfC) </a>基础设施的第一印象。大约在那时，我开始了一项实验。我想看看人们是如何从代码问题中接近<em class="lv">基础设施的。</em></p><p id="8a9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从代码构建基础设施是构建云架构的一种相对较新的方式。一个框架会把你的代码转化为云资源。这省略了无服务器开发(或一般的云开发)的声明性部分，这最终会让您进展得更快。专注于你的业务逻辑，而不是构建SAM模板或CDK构造，确实让你专注于真正解决你的业务问题。</p><p id="c8f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在云中构建时做出基础设施决策是一个有趣的想法，但不是每个人都会欣赏。有些人会竭尽全力来控制他们周围的环境。但是正如杰瑞米·戴利所说，控制是一种幻觉。控制基础设施的愿望实际上可以归结为优化(通常)的愿望。将来，<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/the-future-of-serverless-1c945a75f4be">那可能也会为我们处理</a>！</p><p id="5300" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">暂且把未来放在一边，我想谈谈现在可以得到的东西。让我们来看看您现在可以探索什么，开始让您的基础架构得到管理。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="b6d1" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">实验</h1><p id="978d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">作为实验，我构建了四次相同的API。一次是以我通常的方式作为控制——通过SAM模板，与三个不同的IfC供应商合作。我使用的供应商有:</p><ul class=""><li id="af7e" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><a class="ae ky" href="https://nitric.io/" rel="noopener ugc nofollow" target="_blank">硝酸</a></li><li id="d6fd" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://klo.dev/" rel="noopener ugc nofollow" target="_blank">克洛索</a></li><li id="97f9" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><a class="ae ky" href="https://www.serverless.com/cloud" rel="noopener ugc nofollow" target="_blank">无服务器云</a></li></ul><p id="a3d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个空间中还有其他我没有评估的，如<a class="ae ky" href="https://encore.dev/" rel="noopener ugc nofollow" target="_blank">安可</a>、<a class="ae ky" href="https://www.shuttle.rs/" rel="noopener ugc nofollow" target="_blank">穿梭</a>、<a class="ae ky" href="https://modal.com/" rel="noopener ugc nofollow" target="_blank">莫代尔</a>和<a class="ae ky" href="https://darklang.com/" rel="noopener ugc nofollow" target="_blank">黑暗</a>。由于时间关系，没有对这些进行评估。如果你对IfC感兴趣，我鼓励你看看其他的。</p><p id="82ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了比较这些框架，我在开发过程的生命周期中的几个方面对它们进行了评估。评估领域包括:</p><ul class=""><li id="0c2e" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><strong class="lb iu">构建时间</strong> —我能以多快的速度启动并运行一些东西</li><li id="4896" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">方法</strong> —用于从代码中抽象或推断基础设施的方法是什么</li><li id="ad09" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">部署</strong>——把我写的东西放到云中有多容易</li><li id="12b8" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">性能</strong>—API延迟是否在可接受的阈值内</li><li id="8b7f" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">可见性</strong> —我能在多大程度上看到、改变或管理生成的基础架构</li></ul><p id="650b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的意图不是宣布一个“赢家”，而是探索不同的方法和基础设施管理技术，以构建一个未来的想法。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="fa67" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">API</h1><p id="19f9" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">有趣的是，评估将为鸡肉拍卖构建一个API。它有添加、更新和查看鸡和拍卖的端点。当一只鸡被拍卖时，用户可以订阅对它的更新，然后他们可以在拍卖直播时对这只鸡出价。要查看SAM模板中构建的体系结构，请参考下图。你也可以<a class="ae ky" href="https://itchy-swan-43.redoc.ly/" rel="noopener ugc nofollow" target="_blank">在这里</a>查看API文档。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/01c0ec27c915000a0b836287792fe506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*JysV_wJQoLWx3bRs.png"/></div></figure><p id="5362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的目标是，当我尝试在Nitric、Klotho和无服务器云的每个框架中构建这个API时，看看它们会做些什么。这些实现中的每一个都将用JavaScript编写。</p><p id="cbc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里查看<a class="ae ky" href="https://github.com/allenheltondev/infrastructure-from-code-benchmark" rel="noopener ugc nofollow" target="_blank"> GitHub库。</a></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="09bd" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">评估</h1><h2 id="7c2d" class="np me it bd mf nq nr dn mj ns nt dp mn li nu nv mp lm nw nx mr lq ny nz mt oa bi translated">是时候建造了</h2><p id="20ba" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">建造时间就是我能从一无所有到在空中拍卖一只功能鸡的速度。这与文档、工具、快速启动以及是否有本地测试选项有关。我越快得到真实的东西，我就能越快开始迭代我的设计。</p><p id="7bbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">硝酸</strong>——在这个实验之前，我的机器上没有任何“通用部署”工具。我必须创建一个帐户并安装<a class="ae ky" href="https://www.pulumi.com/" rel="noopener ugc nofollow" target="_blank">普鲁米</a>，安装<a class="ae ky" href="https://scoop-docs.vercel.app/" rel="noopener ugc nofollow" target="_blank">勺</a>，下载并安装<a class="ae ky" href="https://nitric.io/docs/installation" rel="noopener ugc nofollow" target="_blank">硝酸CLI </a>，并确保我有Docker启动并运行。一旦安装了所有的先决条件，我就可以开始了——这是一个非常好的体验。当您运行<code class="fe ob oc od oe b">nitric new</code>命令时，Nitric会自动引导您的应用程序。它设置了脚手架，并且可以立即在本地使用Docker运行。</p><p id="b22f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，如何构建我的API并不是很直观。Nitric希望你将计算代码放在一个<em class="lv"> functions </em>文件夹中，但是我不清楚API是如何注册的，以及如何到达端点。<a class="ae ky" href="https://nitric.io/docs/getting-started" rel="noopener ugc nofollow" target="_blank">文档</a>把事情解释的很好，但是感觉有一些我不明白的魔法。开发者不喜欢魔术。总的来说，尽管在本地测试速度很快，但启动时感觉舒适还是有点困难。</p><p id="2d1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">Klotho</strong>——我立刻和Klotho撞上了减速带。我在Windows机器上运行(我知道，我知道)，很快发现Klotho对它有未经测试的支持。我下载了可执行文件，并试图运行它，但没有运气。所以我决定不使用可执行文件，按照他们网站上的<a class="ae ky" href="https://klo.dev/docs/tutorials/your_first_klotho_app" rel="noopener ugc nofollow" target="_blank">快速入门指南</a>进行操作。幸运的是，我已经安装了Pulumi，这是我在硝酸试验中安装的，节省了我的时间。</p><p id="37a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Klotho建议将你的应用构建成一个<a class="ae ky" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> express app </a>并在构建完成后快速插入框架。所以我采用了这种方法，在不到一个小时的时间里运行了一个express应用程序。我可以用一个简单的<code class="fe ob oc od oe b">node index.js</code>命令在本地运行这个应用程序，并随时进行测试。总的来说，非常容易构建，对于我这个JavaScript开发人员来说也很熟悉。</p><p id="1b0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">无服务器云</strong>——这对我来说是一次异想天开的经历。这是我构建的最后一个框架，也是最简单的。作为一名JavaScript开发人员，当我所要做的就是通过npm全局安装<em class="lv"> @serverless/cloud </em>并输入<code class="fe ob oc od oe b">npm init cloud</code>时，我有点头晕。他们的<a class="ae ky" href="https://www.serverless.com/cloud/docs/get-started#start-from-cli" rel="noopener ugc nofollow" target="_blank">云外壳</a>接管了我的终端，并指导我完成引导我的应用程序的所有步骤。</p><p id="b907" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模板完成后，我可以通过在我的终端上运行<code class="fe ob oc od oe b">cloud start</code>命令来测试它，并且实际上是在云中测试它！这个框架感觉就像我在构建一个express应用程序，这是很自然的，并且导致了更快的构建时间。总的来说，这是非常好的开发体验。</p><p id="d5e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总结:总的来说没有什么不好。这三家公司在入门文档方面做得非常好。工具是我的优势。我也喜欢Klotho的心态<em class="lv">先构建，后装备</em>。这对于想要迁移到云原生架构的现有应用程序来说非常好。在我完成部署工具的初始安装后，一切都运行得相当顺利。</p><h2 id="2e47" class="np me it bd mf nq nr dn mj ns nt dp mn li nu nv mp lm nw nx mr lq ny nz mt oa bi translated">方法</h2><p id="dee0" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这个类别识别并指出每个框架满足IfC问题领域的方法。解决问题的方法没有对错之分，但看到做出的决定和不同的思想流派是很有趣的。</p><p id="4337" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Nitric </strong> —该框架使用SDK和配置yaml文件进行设置。SDK抽象了云概念，如API、数据库、队列和事件，允许您使用它们的版本进行构建。这使他们能够跨云供应商部署您的代码。配置文件告诉Nitric使用哪个云供应商和地区，以及像函数处理程序这样的配置细节。</p><p id="b0c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不太喜欢的是他们的模板增加了一个<a class="ae ky" href="https://github.com/allenheltondev/infrastructure-from-code-benchmark/tree/main/nitric/functions" rel="noopener ugc nofollow" target="_blank">“功能”文件夹</a>。对我来说，这给了我一个心智模型，我正在编写Lambda函数，并以我将通过<a class="ae ky" href="https://github.com/allenheltondev/infrastructure-from-code-benchmark/tree/main/SAM" rel="noopener ugc nofollow" target="_blank"> SAM模板</a>的方式构建代码。这违背了国际金融公司的宗旨。应该被框架抽象出来。<em class="lv">注意——我后来知道这个文件夹的结构可以根据你的喜好来改变。我不必保留默认配置。</em></p><p id="b12f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">Klotho</strong>——这是一种非常独特的国际金融公司方式。这里的思路是创建一个web服务并<a class="ae ky" href="https://klo.dev/docs/api/concepts" rel="noopener ugc nofollow" target="_blank">注释基础设施的关键部分</a>，比如API、数据库和事件。注释告诉Klotho在生成Pulumi模板时如何处理存储库中的资源。对于现有的应用程序来说，这是一个很低的门槛，因为重构不是必需的。在关键基础设施上添加注释，您的资源将被自动创建。</p><p id="2a9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行Klotho后，结果是一个编译的Pulumi模板和一个可编辑的Klotho模板。Klotho模板是一个配置文件，告诉Klotho框架如何解释代码中的注释。对于新注释，它使用默认配置。对于现有的注释，它使用映射到代码的已定义资源。这个模板文件允许您覆盖框架做出的任何基础设施决策，这将更多的控制权交还给开发人员。这是好事吗？也许对某些人来说。</p><p id="0fb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">无服务器云</strong> —最简单的方法，这个框架使用无服务器SDK。没有模板或配置文件，只有抽象出数据库和API的SDK。SDK和Nitric有相似的感觉，但是更加抽象。</p><p id="8a77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以看出，这个框架的数据抽象已经考虑了很多。它为数据提供了单表设计的感觉，还提供了数据更改事件。它降低了开发过程的复杂性。</p><p id="9554" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">总结</strong> —这里有多种方法。Nitric和无服务器云提供了一个SDK来编写代码，这些代码提供了核心云概念的高级抽象。另一方面，Klotho提供了一种非侵入性的编码方式，允许您通过注释将现有的应用程序放入云中。这两种方法都很简单，大大降低了开发人员的复杂性。</p><p id="4c80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的一点是，Nitric和Klotho允许你构建尽可能多的不同资源。我能够清楚地创建一个<code class="fe ob oc od oe b">chickens</code>和一个<code class="fe ob oc od oe b">auctions</code> API。但是有了无服务器云提供的抽象，我不需要管理单独的资源，比如大量的API或数据库表。无服务器云的<em class="lv">全有或全无</em>方法决定了您的全部云资源，而其他云的<em class="lv">方法则是挑选</em>方法。这对于开发人员来说是一个显著的区别，他们对让一个框架来决定部署哪些资源感到不同程度的舒适。</p><h2 id="ec0d" class="np me it bd mf nq nr dn mj ns nt dp mn li nu nv mp lm nw nx mr lq ny nz mt oa bi translated">部署</h2><p id="39b3" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">完整解决方案的下一个检查项目是将您的代码放入云中有多容易。这包括沙盒测试和生产配置项部署。</p><p id="c042" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">Nitric</strong>——在我评估Nitric的时候，没有记录在案的方法将我的本地更改推送到沙盒帐户。我坚信你应该把你的开发环境带到云上，而不是相反，所以对我来说，这是对Nitric的一个巨大打击。然而，在与Nitric团队的工作会议之后，他们已经扩展了他们的CLI来将您的本地版本部署到云中。伟大的反馈循环和新的功能集。</p><p id="8c0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于CI，有几个不同的选项。Nitric为云部署提供了他们的<a class="ae ky" href="https://deploy.nitric.io/" rel="noopener ugc nofollow" target="_blank"> Nitric Deploy </a>解决方案。这将连接到您的GitHub repo，并自动部署到已配置的分支。这在理论上听起来不错，但是排除了测试和回滚的可能性。也就是说，他们还提供了一个带有GitHub Actions 的解决方案<a class="ae ky" href="https://nitric.io/docs/guides/github-actions" rel="noopener ugc nofollow" target="_blank">，使您能够在部署之前进行测试。所以现在，我会等待Nitric Deploy，直到功能嵌入其中。</a></p><p id="50d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Klotho——这里不做过多评价。Klotho不会尝试为您部署任何东西。它负责生成Pulumi代码，您可以自己进行部署。他们网站上的说明推荐直接使用<a class="ae ky" href="https://klo.dev/docs/tutorials/deploying" rel="noopener ugc nofollow" target="_blank">Pulumi</a>将应用程序放入云端。</p><p id="6f6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">无服务器云</strong> —正如我在<em class="lv">构建时间</em>部分提到的，无服务器云让我有点吃惊。当我第一次去本地测试时，我惊喜地发现我实际上已经部署到了云中的沙盒环境中！熟悉之后，我了解到从本地机器上安装并运行我的API是多么容易，以及它的部署速度有多快。当地发展的5颗金星！</p><p id="2e97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于CI部署，无服务器云建议<a class="ae ky" href="https://www.serverless.com/cloud/docs/workflows/cicd" rel="noopener ugc nofollow" target="_blank">使用GitHub Actions </a>通过CLI进行测试和部署。这只是几个命令，这与我使用Nitric或SAM模板是一样的。</p><p id="557b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">总结</strong> —从无尝试到全面支持，部署是一个需要重点关注的巨大领域。如果你提供一个试图从消费者那里抽象出基础设施的框架，<em class="lv">你的部署游戏就更好了</em>。</p><h2 id="7436" class="np me it bd mf nq nr dn mj ns nt dp mn li nu nv mp lm nw nx mr lq ny nz mt oa bi translated">表演</h2><p id="7007" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">每个无服务器开发人员首先想到的是部署资源的延迟。毕竟，无服务器是按使用付费的，所以你的应用运行得越快，你支付的费用就越少。</p><p id="a69e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">硝酸(Nitric)—第一次在我部署的硝酸API中碰到一个端点时，我被吓坏了。我的Lambda函数的冷启动时间超过了20秒！所以我和硝酸小组谈了谈，他们做了一些调查。在他们的研究之后，他们推出了一个优化更新，<a class="ae ky" href="https://nitric.io/blog/lambda-containers-coldstarts" rel="noopener ugc nofollow" target="_blank">发表了他们的发现</a>。这个问题与基于容器的Lambda函数冷启动的方式有关。现在冷启动运行3-6秒，热调用少于120毫秒！这又是一个伟大的反馈循环。</p><p id="a692" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">Klotho</strong>——与Nitric类似，Klotho创建了基于容器的Lambda函数，所以我有类似的期望。奇怪的是，我得到了相反的结果。冷启动时间明显更快，约为2秒，但热启动时间平均约为400毫秒。这一定是容器配置的结果，但是因为我不是一个真正的容器人，所以我的调查只停留在推测上。Klotho确实提供了配置Lambda函数内存大小的选项，因此这里可以选择微调性能。</p><p id="848a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">无服务器云</strong> —当我到达无服务器云时，我开始看到一种趋势。冷启动时间在2-3秒之间，而热启动时间通常在200毫秒左右。我注意到并不是所有的端点都有冷启动。我发现API中的一个端点将进行冷启动，而其他端点将立即开始响应，响应时间大约为200毫秒。这让我相信无服务器云也能实现基于容器的功能，考虑到代码是如何编写的，这是有意义的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/e0d354ce7af74fa626146ac3658490c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7Lghxil6kl33gU0p.png"/></div></div></figure><p id="b74c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">总结</strong> —这些框架产生的API的性能差异很小。冷启动是这三者的共同之处，平均延迟非常接近。Klotho允许您调优这些函数，但其他函数不允许。这让您想知道这是否应该由框架本身来管理。</p><h2 id="be95" class="np me it bd mf nq nr dn mj ns nt dp mn li nu nv mp lm nw nx mr lq ny nz mt oa bi translated">能见度</h2><p id="5c89" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">当我谈到关于IfC的可见性时，我在寻找一个简单的东西:<em class="lv">我知道我在云中部署了什么吗？我能支持它吗？</em></p><p id="5634" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Nitric </strong> —由于Nitric在幕后使用Pulumi，他们对部署到您的AWS帐户中的资源、它们之间的关系以及AWS控制台中每个资源的直接链接有了很好的了解。他们既有已部署基础设施的列表，也有图形表示。</p><p id="e8a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于长期支持你的应用，图形视图可能是你最好的选择。它显示了部署的资源之间的关系，每个节点都是控制台中直接指向它的链接。Nitric中没有基础设施的日志或聚合视图，因此您可以使用可观察性工具来扩展这些功能，或者直接访问您的云供应商控制台。</p><p id="b6f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Klotho  —使用Klotho的最大好处之一是，当它编译你的代码时，它会自动生成一个<a class="ae ky" href="https://github.com/allenheltondev/infrastructure-from-code-benchmark/blob/main/klotho/compiled/dev.png" rel="noopener ugc nofollow" target="_blank">架构图</a>。您可以一目了然地看到哪些资源将被部署到您的帐户，以及它们如何相互交互。同样，这里使用了Pulumi，因此如果您导航到Pulumi仪表板，您会看到类似于Nitric的资源视图。</p><p id="6a1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然这个图很好，但是依赖于框架的可支持性是一个很长的过程。由于Klotho并不试图管理您的基础架构或部署，因此除了酷炫的架构图之外，我不会给it评估加分。</p><p id="a634" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">无服务器云</strong>——这真让我大吃一惊。其他框架编译代码并将其部署到您的帐户中，但不包括无服务器云。它完全从你那里提取资源，并将其托管在他们自己的帐户中。您将看到一个显示日志和API端点的管理控制台。</p><p id="f14b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，从“我在运行什么基础架构”的角度来看，这是不可能的。但是它确实展现了重要的价值和度量标准。这种方法迫使你改变对IfC的看法。它让你专注于代码，而不是代码背后的基础设施。这是唯一一个认真对待基础设施管理即服务的框架。</p><p id="1e24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">总结</strong> —同样，我们在这里有三个非常不同的抽象层，每个抽象层对应一个舒适度。如果您想保持对基础设施的控制感，Klotho可能是一个不错的选择。如果你想弥合差距，硝酸是交出钥匙的好方法。如果您准备投入一项为您管理基础架构的服务，无服务器云是您的最佳选择。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ef48" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">总体思路</h1><p id="77de" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这不是一个一成不变的实验。这些框架彼此差异很大，很难说哪一个是“最好的”。下面是我们上面所讲内容的一个快速总结。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/a34088414698fbbe09b6dff65f480d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVjri_dVCo10INhavrC0jw.jpeg"/></div></div></figure><p id="bce1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个过程教会了我一些基于第一印象的有价值的见解。</p><ul class=""><li id="a330" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated"><strong class="lb iu">你需要改变心态</strong>——这是一个全新的抽象层次</li><li id="41b6" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu"> IfC是关于管理基础设施的</strong>——它不是简单地将代码编译成IaC并交还给你</li><li id="81f5" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">每个舒适级别都有一个工具</strong>——那些不准备放弃基础设施控制权的人仍然可以参与</li><li id="f40a" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">云约束不会消失</strong>——您仍然需要考虑<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/lets-stop-talking-about-serverless-cold-starts-38e4c1fda963">冷启动</a>、<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/solutions-architect-tips-how-to-design-around-serverless-service-limits-15e12b5c4235">服务限制</a>和<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/3-ways-to-retry-failures-in-your-serverless-application-84b5102f620">重试</a></li><li id="280c" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated"><strong class="lb iu">我们还有很长的路要走</strong> —我们已经有了一个很好的开始，但是在自我优化基础设施和普遍接受前提之前，我们还有很长的路要走</li></ul><p id="30f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就我个人而言，我对这个概念很感兴趣。我认为这是未来云开发的方式。我们仍处于整个概念的初级阶段，因此需要做出许多决策，与最终用户交流，进行抽象，构建框架。但是这个概念是可靠的，并且大有希望。</p><p id="40c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很明显，随着这一领域的发展，它的变化也很快。文档几乎每天都在变化，新特性以启动速度发布(这意味着超快)。我发现所有的团队都非常乐于回应和接受反馈。如果你有什么不太明白的地方，或者在文档中发现了缺失的部分，请联系我们——这可能是一个疏忽。</p><p id="a53c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你错过了，最近宣布无服务器云将脱离无服务器公司，并成为Ampt。这对于IfC领域来说是一个巨大的发展，允许无服务器云背后的优秀工程师在不与无服务器公司的其他优先事项竞争的情况下进行构建。</p><p id="0d41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">未来和现在都有机会改变我们在云中构建的方式。现在是时候参与进来，亲自尝试一下了。我测试的每一个框架都非常乐意与我合作，接受反馈，并快速做出改变。他们在那里帮助你建设。</p><p id="1979" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢和我一起做这个实验的团队！来自无服务器云/Ampt的杰瑞米·戴利和<a class="ae ky" href="https://twitter.com/emrahsamdan" rel="noopener ugc nofollow" target="_blank">艾姆拉·萨姆丹</a>、来自硝酸的<a class="ae ky" href="https://www.linkedin.com/in/jye-cusch" rel="noopener ugc nofollow" target="_blank">杰耶·库斯奇</a>和<a class="ae ky" href="https://www.linkedin.com/in/rak-siva-b9360816a" rel="noopener ugc nofollow" target="_blank">拉克·西瓦</a>以及来自Klotho的<a class="ae ky" href="https://twitter.com/AlaShiban" rel="noopener ugc nofollow" target="_blank">阿拉·史班</a>没有你们，我不可能做到这些！</p><p id="4439" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！</p></div></div>    
</body>
</html>