<html>
<head>
<title>How To Use APIs With React Functional Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将API与React功能组件一起使用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-apis-with-react-functional-components-f4d36bd0be1?source=collection_archive---------16-----------------------#2021-08-30">https://betterprogramming.pub/how-to-use-apis-with-react-functional-components-f4d36bd0be1?source=collection_archive---------16-----------------------#2021-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e44d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们看看在React功能组件中使用API的两个用例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c3d4314ceaca64e75095bcbf8f92cc40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fpoNn2vJ4udpYpN5"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@lastnameeaster?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> La-Rel Easter </a>拍摄的照片</p></figure><p id="0662" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在React项目中使用API是一个常见的用例。在本教程中，我们将看两个用例:</p><ul class=""><li id="df67" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">在后台加载API数据</li><li id="21b6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">点击按钮时加载API数据</li></ul><p id="400f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用功能组件和useEffect挂钩。有些熟悉是意料之中的。</p><h1 id="7dfe" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">在后台加载API数据</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/5332a2a5b33e6982b0f990089677ddbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HN6iLYcDjWne9EHw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者在后台显示API加载数据的GIF。显示姓名列表。</p></figure><p id="e9cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个用例中，数据只加载一次——每当用户查看应用程序或刷新页面时。最初，会显示“正在加载…”文本。这个文本稍后会用实际的API数据进行更新。下面是导致上述行为的组件的代码片段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="f06e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们分三部分来讨论代码:状态、useEffect挂钩和呈现逻辑。</p><h1 id="cddf" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">各州</h1><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="5407" class="nj mk it nf b gy nk nl l nm nn">const [isLoading, setIsLoading] = <br/>React.useState(true);</span></pre><p id="e950" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有两种状态。<strong class="lb iu"> isLoading </strong>状态是一个初始化为真的布尔变量。此状态用于跟踪数据是仍在加载还是已经加载。<strong class="lb iu"> setIsLoading </strong>函数用于切换该状态变量。在API返回数据之后，我们将使用这个函数来切换<strong class="lb iu"> isLoading </strong>的值:</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="edf3" class="nj mk it nf b gy nk nl l nm nn">const [data, setData] = React.useState([]);</span></pre><p id="23b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们有了<strong class="lb iu">数据</strong>状态。这个状态被初始化为一个空数组。它将用于存储API返回的数据。您也可以将状态初始化为一个空对象。然而，我在示例中使用的API返回一个列表，因此，空列表似乎是正确的选择。<strong class="lb iu"> setData </strong>函数用于在API返回数据后更新状态变量<strong class="lb iu"> data </strong>。</p><h1 id="0d30" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">使用效果挂钩</h1><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="f4d6" class="nj mk it nf b gy nk nl l nm nn">React.useEffect(() =&gt; {<br/>    const url = "https://randomuser.me/api/?results=15";<br/>    fetch(url)<br/>      .then((response) =&gt; response.json())<br/>      .then((json) =&gt; setData(json['results']))<br/>      .catch((error) =&gt; console.log(error));<br/>  }, []);</span></pre><p id="9ff3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的useEffect挂钩用于向API发出请求。'[]'参数告诉React只运行这个钩子一次。钩子在页面加载后运行。发出一个简单的获取请求，在承诺被解析后，我们使用<strong class="lb iu"> setData </strong>函数来更新状态变量<strong class="lb iu"> data </strong>。</p><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="1248" class="nj mk it nf b gy nk nl l nm nn">React.useEffect(() =&gt; {<br/>    if (data.length !== 0) {<br/>      setIsLoading(false);<br/>    }<br/>    console.log(data);<br/>  }, [data]);</span></pre><p id="1556" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每当状态变量<strong class="lb iu">数据</strong>更新时，下一个useEffect钩子运行。它做一个简单的检查:如果状态变量<strong class="lb iu">数据</strong>不为空，即API已经返回数据，它将状态变量<strong class="lb iu"> isLoading </strong>设置为False。</p><p id="1749" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>上面的案例假设了一个皆大欢喜的案例，即API总是会返回数据。然而，事实并非如此。因此，还应该添加错误处理。</p><h1 id="acac" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">渲染逻辑</h1><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="775b" class="nj mk it nf b gy nk nl l nm nn">return (<br/>    &lt;div&gt;<br/>      {isLoading ? (<br/>        &lt;h1&gt;Loading...&lt;/h1&gt;<br/>      ) : (<br/>        data.map((user) =&gt; (<br/>          &lt;h1&gt;<br/>            {user.name.first} {user.name.last}<br/>          &lt;/h1&gt;<br/>        ))<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="28e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">渲染逻辑非常简单。如果状态变量“isLoading”为真，我们将显示“Loading…”指示。如果为false，我们只需映射状态变量“data”并显示数组中的所有项目。</p><h1 id="3dd6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">点击按钮时加载API数据</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/5004367f46f3fe4d5a0cba6f7070b004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3tXrunbb4mY07JI5.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">按作者显示点击按钮时API加载数据的GIF</p></figure><p id="ebe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是完整的代码片段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="c022" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将分三部分讨论代码。</p><h1 id="8c2b" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">州</h1><pre class="kj kk kl km gt ne nf ng nh aw ni bi"><span id="c4a6" class="nj mk it nf b gy nk nl l nm nn">const [showData, setShowData] = <br/>React.useState(false);</span></pre><p id="ab57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前两个状态变量与上一节中的相同。我们将讨论第三个状态变量<strong class="lb iu"> showData </strong>。</p><p id="f482" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用户第一次查看页面时，我们不希望他们看到API数据或“正在加载……”文本。因此，我们添加了一个简单的检查来查看用户是否点击了按钮。用户单击按钮一次后，只有两个视图:</p><ul class=""><li id="6d0e" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">“装载…”文本</li><li id="f569" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">API数据</li></ul><p id="9833" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每当用户再次点击按钮时，我们就在上面提到的两个视图之间切换。</p><h1 id="5b99" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">手柄点击功能</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="ef57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这类似于第一个用例中的第一个useEffect钩子。唯一的区别是我们将状态变量<strong class="lb iu"> showData </strong>设置为True。</p><h1 id="4999" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">渲染逻辑</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="210e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们对showData进行检查，这是为了确保最初用户不会看到“正在加载…”文本或API数据。用户单击按钮后，showData被设置为True。在这之后，渲染逻辑类似于第一个用例。</p><h1 id="0da6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="f2cf" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">我希望这篇文章对你有所帮助。在<a class="ae ky" href="https://www.linkedin.com/in/rahulbanerjee2699/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae ky" href="https://twitter.com/rahulbanerjee99" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上加我。</p><h1 id="afca" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">资源</h1><p id="204b" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-write-better-functional-components-in-react-bc974f777145">Bikash Paneru</a>撰写的这篇文章很好地介绍了React中的功能组件。</p><p id="27e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://javascript.plainenglish.io/react-hooks-how-to-use-useeffect-ecea3e90d84f" rel="noopener ugc nofollow" target="_blank">Hossein Ahmadi</a><a class="nt nu ep" href="https://medium.com/u/ee208eb13e4d?source=post_page-----f4d36bd0be1--------------------------------" rel="noopener" target="_blank">的这篇文章</a>是React中关于使用效果挂钩的一篇好文章。</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><blockquote class="oc"><p id="e9ba" class="od oe it bd of og oh oi oj ok ol lu dk translated">最初发表于<a class="ae ky" href="https://www.realpythonproject.com/how-to-use-apis-with-react-functional-components/" rel="noopener ugc nofollow" target="_blank">realpythonproject.com</a></p></blockquote></div></div>    
</body>
</html>