<html>
<head>
<title>I wish you a merry JMas and a happy new JEP!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">祝你们JMas快乐，新JEP快乐！</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/i-wish-you-a-merry-jmas-and-a-happy-new-jep-5694a3d02e64?source=collection_archive---------6-----------------------#2022-12-02">https://betterprogramming.pub/i-wish-you-a-merry-jmas-and-a-happy-new-jep-5694a3d02e64?source=collection_archive---------6-----------------------#2022-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="be06" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">现代Java最需要什么？这是我的愿望清单</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/d2bfbc559b4a18343b2c0c8200f84048.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*JYSND4xHxa5ltyPWQAIiqA.jpeg"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">JSanta(取自<a class="ae kr" href="https://twitter.com/cjug" rel="noopener ugc nofollow" target="_blank">https://twitter.com/cjug</a></p></figure><p id="6dc0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">圣诞节快到了，所以许愿的时间也快到了。我热爱Java语言，我使用它已经超过16年了，我当然希望它能有所改进。</p><p id="6e4e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/why-java-is-perfectly-alive-e3f25a576f95"> Java好</a>，但任何生物总有进步的空间，Java也不排斥。随着project Loom preview在<a class="ae kr" href="https://openjdk.org/projects/jdk/19/" rel="noopener ugc nofollow" target="_blank"> JDK19 </a>中的发布，很明显，即使在完善的生态系统中，仍然有许多疯狂的事情可以做，这些事情可以填补空白，解决有时被认为无法解决的问题。如果你不知道为什么Loom被非正式地称为“异步的杀手”，只要看看这里的<a class="ae kr" href="https://www.infoq.com/articles/java-virtual-threads/" rel="noopener ugc nofollow" target="_blank">，这是一个伟大的事情</a>！</p><p id="dac6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在这篇文章中，除了已经走上正轨的jep之外，我还将分享我对Java语言的看法。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="bc6d" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">“十亿美元的错误”</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/7e63add6cb9954ea9447af8b45ffca41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7-2LiBPEdqyerDVwNG5fw.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">照片由<a class="ae kr" href="https://unsplash.com/photos/jNSJE8dMro0" rel="noopener ugc nofollow" target="_blank">瓦伦丁·拉科斯特</a>拍摄</p></figure><p id="98b6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我的第一个愿望与臭名昭著的可空性问题有关。</p><p id="f549" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这是Java和许多其他语言的老痛，即“<a class="ae kr" href="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare/" rel="noopener ugc nofollow" target="_blank">十亿美元错误</a>”。如您所知，在Java中，除了原语之外，所有变量和字段的值都可以是null或非null。</p><p id="064f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">对于现代来说，它有点过时了。今天，程序员希望对什么可以为空，什么不可以为空有更多的控制权。许多现代语言提供句法结构，例如Dart语言:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="1953" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在这个例子中，<code class="fe mu mv mw mx b">someNullableString</code>可以是null，也可以不是，这在Java世界中是很常见的。</p><p id="dced" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">但是<code class="fe mu mv mw mx b">someNonNullString</code>永远不会为空，编译器会保证这一点。不需要等待来自<code class="fe mu mv mw mx b">someNonNullString</code>的技巧，如果你能在你的代码中的某个地方访问它——它将永远不会是空的。非常方便。</p><p id="c3a4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然而，在Java中，您不能确定任何对象变量，并且必须进行明确而广泛的非空检查。这个问题有许多解决方案，有些是基于注释的，我现在不讨论它们，因为它们需要外部工具来工作(老实说，我不喜欢它们)。另一种方法是基于首次出现在JDK 8中的<code class="fe mu mv mw mx b">Optional</code>类的使用。</p><p id="687c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">乍一看，Optional做得很好——如果您将对象包装在Optional中，或者通过某种方法返回Optional，那么您就有了一个很好的处理潜在的可空情况的链接API。Optional有三个问题:</p><ol class=""><li id="ebf8" class="my mz iq ku b kv kw ky kz lb na lf nb lj nc ln nd ne nf ng bi translated"><strong class="ku ir">所有的Java对象变量都是可选的，</strong>不是<code class="fe mu mv mw mx b">Optional</code>。因此，每次想要使用<code class="fe mu mv mw mx b">Optional</code>的API时，都必须显式创建它的实例，这很麻烦，在某些情况下还会增加新对象分配和GC的压力。</li><li id="3816" class="my mz iq ku b kv nh ky ni lb nj lf nk lj nl ln nd ne nf ng bi translated"><strong class="ku ir">所有的Java对象变量都是可选的</strong>，所以如果你在处理非<code class="fe mu mv mw mx b">Optional</code>对象——你仍然不能确定它是否为空。</li><li id="4fca" class="my mz iq ku b kv nh ky ni lb nj lf nk lj nl ln nd ne nf ng bi translated"><strong class="ku ir">所有的Java对象变量都是可选的</strong>，而<code class="fe mu mv mw mx b">Optional</code>——只是另一个Java对象。所以即使你得到一个可选的，你也不能100%确定它本身不是空的！</li></ol><p id="2570" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">可选类在某些情况下为我们节省了时间，但是它没有完全解决可空性问题，因为它没有给你强有力的保证。</p><p id="2c8b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">那么解决办法是什么呢？</p><p id="c30d" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果我们看看其他现代语言，首先想到的是通过添加“？”来改进类型系统符号来标记可空类型，没有该符号的类型决不应该为空。显然，这对于Java世界来说是不可接受的，因为它会破坏向后兼容性。如果你这样做，所有的旧代码都会停止工作，需要重写，这是不可接受的。通常，人们会放弃这一步，说“好吧，我们将永远带着空指针问题生活”。</p><p id="da94" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然而，还有另一种选择，与其在类型上添加可空标记，为什么不标记非空的类型呢？考虑这个例子，如果我们假设非空的标记是“！”：</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="d013" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我相信你已经明白了。<code class="fe mu mv mw mx b">mainData</code>是<code class="fe mu mv mw mx b">nonNull</code>，<code class="fe mu mv mw mx b">additionalData</code>可能为空。返回值将是<code class="fe mu mv mw mx b">nonNull</code>，因为它是由非空值生成的。另外，作为一点语法上的好处，为经典的可空性提供良好的链接可能性，使其类似于可选的API(但不一定在这个过程中创建可选的对象)，这将会很酷。</p><p id="aed6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">添加非空标记是完全向后兼容的。没有遗留库和API处于危险之中。但是在新的代码中，你会有更方便的语法和更强的保证，我认为这很有意义。</p><p id="3ebb" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">所以我的第一个愿望是看到一个至少为新代码解决可空性问题的JEP。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="7bde" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">参数化地狱</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi nm"><img src="../Images/7c8c054a6bb2fedc6ffb038e08586b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDf7KZGnel3rLzkaU7r3uA.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">照片由<a class="ae kr" href="https://unsplash.com/photos/eiwVOa9zb10" rel="noopener ugc nofollow" target="_blank">ybraym esen ov</a>拍摄</p></figure><p id="036c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">Java使用相当保守的方式为方法声明参数。您可以逐个枚举所有参数，也可以添加<code class="fe mu mv mw mx b">varargs</code>以便将任意数量的参数收集到一个数组中。乍一看就够了，我们来看例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="c219" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们有一个带有一个方法的接口，它接受三个参数。很好。但是，如果我们希望一个参数是可选的，并且在它不存在的情况下，我们希望使用默认值，该怎么办呢？假设<code class="fe mu mv mw mx b">b</code>应该是可选的，如果没有设置，则使用默认值:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="1cd1" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">看起来很简单对吗？</p><p id="8cab" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在让我们假设这三个参数都是可选的，如果没有设置，应该有一些默认值。那么我们需要多少种方法来处理所有的组合呢？2 = 8.随着可选参数的增加，你将需要更多的方法组合来建模。哦，欢迎来到参数化地狱…</p><p id="9107" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在某些领域，参数化对你的打击最大。例如，当你使用UI时，通常有许多参数你可以改变视觉和行为:不同的填充/边距/间距、颜色、布局属性、字体、边框等。其中一些你可能想在特定的情况下改变，但大多数情况下，你可能会使用默认值。</p><p id="0805" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们来看一个很好的老例子Swing(你可能认为Swing有点过时了，这绝对是真的，但是最好的Java IDEs之一仍然在使用它<a class="ae kr" href="https://stackoverflow.com/a/12311981/3231055" rel="noopener ugc nofollow" target="_blank">。有一个班级<code class="fe mu mv mw mx b">JDialog</code>负责……很好的对话。当您试图创建该类的对象时，您必须选择一个构造函数:</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi nn"><img src="../Images/43f967c683906e7f2d727616ddb83e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ek6m1PlqNGzVgFD92qxL4A.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">javax.swing.JDialog类的一部分</p></figure><p id="3793" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">准确地说，你必须从16个构造者中选择一个。这个数字反映了一件简单的事情:在JDialog创建的上下文中，一些参数(如标题或模态)是可选的，试图遵守它会导致大量可用构造函数的组合爆炸。</p><p id="543e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在让我们考虑一下<a class="ae kr" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank">颤振</a>框架。Flutter是基于Dart语言的UI框架。它与Swing或任何其他UI框架有相同的问题:大量带有预定义默认值的可选参数。让我们看看Flutter <code class="fe mu mv mw mx b">MaterialApp</code>类的构造函数:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi no"><img src="../Images/aef652db9981d14939b1ca7fb1a87d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EraiRWnfFt_7LCKaUhunVQ.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Flutter MaterialApp类构造函数</p></figure><p id="c73d" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">构造函数有35个参数，每个参数都是可选的。在Dart中，<code class="fe mu mv mw mx b">{}</code>中的参数被认为是可选的，但是您也可以添加经典的强制参数，只需将它们放在<code class="fe mu mv mw mx b">{}</code>之外。</p><p id="443b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在不要关注<code class="fe mu mv mw mx b">this</code>关键字，这是一种自动为类的字段赋值的语法，这当然很酷，但是我们现在坚持可选参数主题。一些参数使用默认值，那些没有赋值的参数使用空值作为默认值。以下是如何使用此构造函数的示例:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/7431543ebcd37ec633713d2759405e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*Wvvk_hLvguFH0JNUV17IpQ.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">创建MaterialApp对象</p></figure><p id="2281" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">答对了。您只设置了几个需要的参数，而让其他参数使用默认值。为了获得这样的便利，你必须使用一种很好的组合方法在一个<code class="fe mu mv mw mx b">MaterialApp</code>类中创建2个⁵方法！请不要尝试，否则你很可能会错过圣诞晚餐。</p><p id="de30" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在Java中，我们如何避免这样的参数化地狱？使用最广泛的解决方案是<a class="ae kr" href="https://blogs.oracle.com/javamagazine/post/exploring-joshua-blochs-builder-design-pattern-in-java#:~:text=The%20Builder%20pattern%2C%20which%20is,using%20the%20same%20construction%20code." rel="noopener ugc nofollow" target="_blank"> Builder设计模式</a>，这意味着我们应该使用另一个对象，它的字段引用我们想要调用的方法的可选参数，通过链接builder setter方法来设置它的值，最后调用“build”方法来最终完成我们需要的工作。听起来有点繁琐。当对象的创建并不简单时，构建器在复杂的构建场景中会很方便，例如，如果创建过程被分成许多步骤，每个步骤中有不同的可用选项。然而，对于简单的情况，如果您有方便的可选参数语法，那么不再需要构建器模式。</p><p id="ebde" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">有一些好消息。如果立即将Dart样式的可选参数定义添加到Java语言中，那么即使是Dart样式的可选参数定义及其冒号用法也很可能不会破坏向后兼容性。当然，可能会有粗糙的角落，但原则上没有问题。除了Dart语法之外，可能还有许多替代方法可以做得更好。</p><p id="31c7" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">所以我的第二个愿望是在未来的jep中看到可选的方法参数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi nq"><img src="../Images/9d2eebda944ec6be7b6cff27ec65daf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mx44JoyJgpqyQI3OyVdyCQ.jpeg"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">乔纳斯·雅各布森的照片</p></figure><p id="f587" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">感谢阅读！你有什么关于Java的愿望要写进给圣诞老人的信里吗？让我知道。感谢阅读。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="8566" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在我的<a class="ae kr" href="https://t.me/java_lang_info" rel="noopener ugc nofollow" target="_blank">电报频道</a>订阅，我每周在那里放一两句关于Java生态系统的状态。</p></div></div>    
</body>
</html>