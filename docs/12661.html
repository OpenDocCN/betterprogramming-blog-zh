<html>
<head>
<title>Rebuilding Apple’s WWDC 2017 Demo App With SceneKit and SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用SceneKit和SwiftUI重建苹果WWDC 2017演示应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/rebuilding-apples-wwdc-2017-demo-app-with-scenekit-and-swiftui-77374c230e28?source=collection_archive---------17-----------------------#2022-06-20">https://betterprogramming.pub/rebuilding-apples-wwdc-2017-demo-app-with-scenekit-and-swiftui-77374c230e28?source=collection_archive---------17-----------------------#2022-06-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7170" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更新福克西2游戏代码的尝试</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ccae68154e047af189caa2759a7d1424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nekcL0YWIGeCA6K6tlI9ag.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">foxy2演示代码的截图</p></figure><p id="fe12" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">可悲的是，苹果上一次真正谈论SceneKit是在2017年，尽管它在2018年出现过一次。2017年，他们做了一场出色的演示，展示了一个看起来非常好的摇滚演示，foxy2。</p><p id="ed68" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">幸运的是，演示代码仍然可用，可以在这里下载<a class="ae lu" href="https://developer.apple.com/library/archive/samplecode/scenekit-2017/Introduction/Intro.html#//apple_ref/doc/uid/TP40017656" rel="noopener ugc nofollow" target="_blank"/>。一个仍然非常有效的演示！</p><p id="7a61" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有这些都让我想到，你知道，自2017年以来，Swift和iOS发生了一些变化，既然了解代码如何破坏和修复的最佳方式是破坏和修复代码，我想我会尝试将foxy 2代码更新到2022年，并记录我的旅程。</p><h2 id="527f" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">带SwiftUI的Foxy2</h2><p id="5c68" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我的计划是使用SwiftUI重新构建foxy2演示代码，以管理一个平视显示器，并在我使用它的时候做一些其他的升级。从长远来看，我有一个以foxy2为主角的衍生游戏的想法，但没问题——一步一步来。</p><h2 id="adde" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">基本构件</h2><p id="0b4f" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">Bon —我需要一个嵌入在SwiftUI中的SceneKit，并在SwiftUI界面上运行一个HUD(这是foxy2的一部分，我们需要做些不同的事情)。</p><p id="117b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将使用Combine框架中的这篇<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/16-useful-extensions-for-swiftui-88aae6ff8909">文章</a>中描述的订阅模式来链接SwiftUI HUD和我的SceneKit。理论上，我应该能够将旧项目中的大部分代码复制并粘贴到新项目中；我们会看到的。</p><h2 id="daae" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">编码</h2><p id="1d09" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">第一项任务是更新foxy2并运行它，我很高兴地说这是一件轻而易举的事情[除了Xcode的安全问题，你需要通过系统偏好设置中的隐私标签来解决]。浏览代码时，我注意到它有iOS、macOS甚至tvOS的版本。所有这些都很棒，尽管我计划只关注iOS。</p><h2 id="cc10" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">2022年的版本</h2><p id="d046" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我首先为我更新的foxy2创建一个模板，作为一个标准的基于SwiftUI的应用程序，其<code class="fe mt mu mv mw b">ContentView</code>如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="d44c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的关键行是对<code class="fe mt mu mv mw b">GameController</code>的引用。</p><p id="d1f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来我把下载的foxy2代码在iOS上复制过来，分享代码。我没有意义在这里列出它们，因为我将包括最终的项目供您下载。我也复制艺术、资产和音频。</p><p id="7b70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我做了一个重要的改变。我用一个<code class="fe mt mu mv mw b">makeView</code>函数替换了<code class="fe mt mu mv mw b">GameController</code>中的<code class="fe mt mu mv mw b">init</code>,并在方法的最后添加了该函数所需的返回。</p><p id="de29" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我整理了一下，看了看我得到的东西。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/caa66328355b6d476cd462015bdacd80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PrV7ptXpbVG45msf1ekkGg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">SwiftUI下SceneKit上的初始foxy2重建快照</p></figure><p id="0c53" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然我可以在场景中移动[因为我有了<code class="fe mt mu mv mw b">.allowsCameraControl</code>的设置，我还不能控制狐狸自己，尽管，考虑到我是从裤子的座位上飞起来的，这是一个好的开始。</p><p id="18fc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">继续搜索代码，我找到了对foxy的引用，遗憾的是，他似乎被称为“模型”,在这一点上没有印象分，还有一组在场景中使他动画的例程。</p><p id="d81a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了更好地理解它，我在SwiftUI界面中创建了一个HUD，并通过一个<code class="fe mt mu mv mw b">Combine</code>框架订阅来链接它。</p><p id="a94e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">SwiftUI这边看起来是这样的。</p><pre class="kj kk kl km gt mz mw na nb aw nc bi"><span id="de4e" class="lv lw it mw b gy nd ne l nf ng">Circle()<br/>  .fill(Color.white)<br/>  .opacity(0.1)<br/>  .frame(width: 64, height: 64, alignment: .center)<br/>  .onTapGesture(count: 2, perform: {<br/>    spinning.send(true)<br/>  })<br/>}</span></pre><p id="7c89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe mt mu mv mw b">Character</code>类中，我用相应的行动号召定义了订阅的另一面。</p><pre class="kj kk kl km gt mz mw na nb aw nc bi"><span id="aa36" class="lv lw it mw b gy nd ne l nf ng">spinner = spinning.sink(receiveValue: { [self] bool in<br/>  print("spinner")<br/>  if bool { attack() }<br/>})</span></pre><p id="cac0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用它和其他工具，我通过尝试不同的例程来拼凑代码是如何工作的。我发现行走动画，旋转动画和其他动画。我在这里概述了一些工作；有些只需要我设置一个变量，就像这个。</p><pre class="kj kk kl km gt mz mw na nb aw nc bi"><span id="25ca" class="lv lw it mw b gy nd ne l nf ng">burner = burning.sink(receiveValue: { [self] bool in<br/>  print("burning" )<br/>  if bool { isBurning = true }<br/>})</span></pre><p id="0c26" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让狐狸做不同事情的惯例…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/d179fc860abfb60887f76cb5ef793166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CszkzeLaexwWetKZUv7VQg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有一些狡猾动作的动画GIF</p></figure><p id="39c6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是等等——我最不想做的事情就是在这里重新发明轮子。我需要尽可能多地重用代码。</p><p id="5a71" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我决定将<code class="fe mt mu mv mw b">SCNSceneRendering</code>代码重新定位到一个单独的<code class="fe mt mu mv mw b">SceneDelegate</code>文件中，并删除了<code class="fe mt mu mv mw b">ExtraProtocols</code>类型别名下对它的引用，实际上是整个代码。与此同时，我将鼠标移到我在<code class="fe mt mu mv mw b">GameController</code>中找到的渲染函数上。[这是一个我事后才知道的错误]。</p><p id="623a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，我遇到了变量的隐私问题，并从<code class="fe mt mu mv mw b">GameController</code>中删除了隐私约束。是的，快速&amp;脏解；抱歉，也许我以后会再来。</p><p id="3fe3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了改变最少的代码，我替换了接触，并开始用我的订阅模式编码，从那里触发代理。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="f5c4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我用我的SwiftUI接口触发它——注意，我也在这里更新了协议。我用bool来区分会移动相机的<code class="fe mt mu mv mw b">dpad</code>和会移动foxy的dpad。同样，是的，枚举可能是更好的选择。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="6f78" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我需要修改<code class="fe mt mu mv mw b">GameController</code>代码来管理新的协议，修改如下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="014f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">回想起来，我本可以/应该以不同的方式来做这件事——也许完全绕过使用协议——这也许是foxy2代码第二次修订的主题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni my l"/></div></figure><p id="563d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看起来不错，但显然，事情的物理方面仍然没有工作——我返回来查看代码。我发现这一行引用了现在更新的渲染器，并将其更改为。</p><pre class="kj kk kl km gt mz mw na nb aw nc bi"><span id="977f" class="lv lw it mw b gy nd ne l nf ng">scene!.physicsWorld.contactDelegate = self</span></pre><p id="75fa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我又测试了一遍；这一次，我可以捡起宝石，虽然敌人仍然不承认我。我意识到我注释掉了太多的代码，需要在设置字符例程中将这些代码添加回去。</p><pre class="kj kk kl km gt mz mw na nb aw nc bi"><span id="a552" class="lv lw it mw b gy nd ne l nf ng">character!.physicsWorld = scene!.physicsWorld</span></pre><p id="bd65" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我喜欢说就是这样！我修复了一切——但事实并非如此，我也没有——我担心我可能遇到了一个<code class="fe mt mu mv mw b">GameKit</code>框架错误。这是最后一次跑步的视频。如你所见，这几乎是可行的。随意下载项目，证明我错了！告诉我我做错了什么。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni my l"/></div></figure><h2 id="1cd3" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">结论</h2><p id="9e29" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">GamePlayKit框架实现有问题<a class="ae lu" href="https://github.com/wizard1066/Foxy2Update" rel="noopener ugc nofollow" target="_blank">这里</a>？我不确定是什么；这是这个项目——非常欢迎你指出我做错了什么:)</p><h2 id="2f85" class="lv lw it bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">2022年6月21日更新</h2><p id="9665" class="pw-post-body-paragraph ky kz it la b lb mo ju ld le mp jx lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我需要去出版社，也确实去了——但是第二天当我遛狗的时候，我突然灵光一现；我将您在这里读到的几乎所有代码更改都复制到了一个新项目中；我所做的唯一主要改变是没有将<code class="fe mt mu mv mw b">sceneDelegate</code>放入一个单独的类中；<strong class="la iu">一切都变了</strong> …游戏套件现在可以正常工作了！</p><p id="a8a6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如他们所说的，看看这个空间，看看我是否能解决最后的挑战，使更新的版本和原来的一样好，甚至更好:)</p></div></div>    
</body>
</html>