<html>
<head>
<title>How To Set Up a Connection Over LAN in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SwiftUI中建立局域网连接</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/bonjour-over-a-network-framework-b533a714b8f5?source=collection_archive---------0-----------------------#2021-03-21">https://betterprogramming.pub/bonjour-over-a-network-framework-b533a714b8f5?source=collection_archive---------0-----------------------#2021-03-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ff8d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">iOS网络框架上的Bonjour</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bc455e6db2769fbb05dc75f38937d4b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nt8QpyC4WbItahU0"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@fwaheed17?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">费萨尔·瓦希德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="6d90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我相信你听说过这样一句话“成功的秘诀是人际关系网。”我怀疑这也是构建杀手级应用的秘密。让我们来了解一下可以用来连接应用程序的技术(也称为套接字)。</p><p id="a520" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，有两种口味:TCP和UDP。简而言之，TCP套接字保证传递，而UDP套接字不保证传递。当您需要确保您发送的消息到达时，TCP套接字非常有用。当你更关心速度时，UDP套接字是有用的。</p><p id="13dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那就说说代码吧。现在，和所有的对话一样，我们有人在说，有人在听。这种通信通过使用套接字的UDP连接进行。的确，你需要一双。你在一个设备上听，在另一个设备上说。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="68ad" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一个简单的监听插座</h1><p id="39ab" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们从一个简单的套接字应用程序开始，它监听端口1984，并将我们发送给它的内容打印到屏幕上(当然，假设我们发送了一个可打印的字符串):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="1c1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个我称之为<code class="fe nb nc nd ne b">connect</code>的类，在其中我定义了一个监听程序，当被调用时它会监视所提供的端口。当你通过这个端口发送数据时，它会打印出来。要使用上述代码，您只需在SwiftUI定义中调用它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="ae55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这只是听力部分。幸运的是，由于OS X是UNIX，我们可以使用命令行工具来测试它。这一行:</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="363f" class="nj md it ne b gy nk nl l nm nn">echo -n "ping" | nc -4u -w1 192.168.1.110 1984</span></pre><p id="83d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我在这里使用的IP地址是运行模拟器的计算机的IP地址(如果您在真实设备上运行它，它将是您的iPhone/iPad的IP地址)。此外，当您运行此代码时，您可能会看到一个如下所示的弹出窗口:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b35ce262e1106d49ccc1112916cb35e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*v_V5JHcsQwwkBj21MGKKJQ.png"/></div></figure><p id="4a40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个问题的答案是“允许”。</p><p id="5a57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以继续运行它，试试回声。您应该看到单词“ping”出现在调试屏幕上(当然，假设这是您发送给它的内容)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e893" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一个简单的通话插座</h1><p id="6cc0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">显然，你需要能够通过iOS与你的socket对话。这样做也相当容易。将这段代码添加到您的<code class="fe nb nc nd ne b">connect</code>类中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="7f45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并将这段代码添加到SwiftUI文件中，以完成这项工作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="fb9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当你点击“Hello World”标签时，就会发出单词“pong”。显然，我们硬编码到应用程序中的IP地址和端口(1984)也来自我们的模拟器/真实设备。</p><p id="5f28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你完成了…只是你没有，因为我们现在还处于原型模式。你可以用一个固定的端口号来传递信息。不过，固定的IP地址是不可能的。你肯定需要更多。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6f8f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用Bonjour协议联网</h1><p id="6b64" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对我们来说幸运的是，现在有一个已经运行了近20年的久经考验的解决方案:一个由苹果公司在2002年开发的协议(最初，它被称为rendezvous)。让我们修改我们的<code class="fe nb nc nd ne b">connect</code>类中的代码来利用它，并将那些硬编码的端口号/IP地址驱逐到进程中(嗯，差不多)。</p><p id="6604" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要重新设计监听方法来启动查询服务。显然，我们还需要重做连接方法，以使用新公布的服务:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="cd47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码注册了一个名为<code class="fe nb nc nd ne b">_whack</code>的bonjour服务，该服务将在UDP上运行。我们将IP地址和端口号问题留给bonjour服务。</p><p id="e34b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">修改完这些之后，我们还需要在SwiftUI代码中更改对它们的调用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="5eef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就创建了一个名为<code class="fe nb nc nd ne b">“whack”</code>的服务，它在我们启动应用程序时运行。这是一个服务，我们随后使用<code class="fe nb nc nd ne b">tap</code>手势进行查询，以建立套接字连接。</p><p id="6619" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，您可以在UNIX shell中运行以下命令来检查<code class="fe nb nc nd ne b">whack</code>服务是否正在运行(一个有用的调试技巧):</p><pre class="kj kk kl km gt nf ne ng nh aw ni bi"><span id="679c" class="nj md it ne b gy nk nl l nm nn">dns-sd -B _whack._udp</span></pre><p id="822b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就把我带到了这篇关于跨局域网建立连接的短文的结尾。</p><p id="a5d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保持冷静，继续编码。</p></div></div>    
</body>
</html>