<html>
<head>
<title>Convert a CSV to a JavaScript Array of Objects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将CSV转换为JavaScript对象数组</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/convert-a-csv-to-a-javascript-array-of-objects-3a0914a0bd8d?source=collection_archive---------7-----------------------#2022-09-16">https://betterprogramming.pub/convert-a-csv-to-a-javascript-array-of-objects-3a0914a0bd8d?source=collection_archive---------7-----------------------#2022-09-16</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="a26b" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">这比你想象的要简单</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/f4a75bc2e9a3a59d7ecffea69a9ff3d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HQwtVis6XGWzmwih"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="e1c8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">将CSV文件转换为JavaScript对象数组的最简单方法是使用JavaScript split、map、forEach、trim方法和spread运算符。我很乐意在本文中向您展示如何使用文件上传表单。</p><blockquote class="lw lx ly"><p id="2316" class="la lb lz lc b ld le jv lf lg lh jy li ma lk ll lm mb lo lp lq mc ls lt lu lv in bi translated">在本文中，我希望您了解一些JavaScript知识，因为这将使您更容易理解。如果没有，我会尽我所能给你尽可能多的信息。</p></blockquote><h2 id="f7f1" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="8541" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">如果您只需要将CSV值转换为JavaScript对象数组的代码，请复制并粘贴代码。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="1b15" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是如果你想理解代码中的一切？我建议您继续阅读或者向下滚动到第3步，在那里我会解释它的逻辑。</p><h1 id="2f2c" class="nd me iu bd mf ne nf ng mi nh ni nj ml ka nk kb mo kd nl ke mr kg nm kh mu nn bi translated">1.创建用于上传CSV文件的表单</h1><p id="7519" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">首先，我们需要一个HTML表单来上传文件。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="01a4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">由于我没有关注用户友好的表单，而是更多地关注将CSV转换为对象数组，所以我添加了最少的CSS。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="44c9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于结果，你可以检查<a class="ae kz" href="https://codesandbox.io/s/how-to-convert-csv-to-javascript-array-of-objects-e6e3nc" rel="noopener ugc nofollow" target="_blank"> CodeSandbox </a>。</p><h1 id="398f" class="nd me iu bd mf ne nf ng mi nh ni nj ml ka nk kb mo kd nl ke mr kg nm kh mu nn bi translated">2.从CSV文件中读取内容</h1><p id="fd1a" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">现在我们需要访问JavaScript中的三样东西。</p><ol class=""><li id="d886" class="no np iu lc b ld le lg lh lj nq ln nr lr ns lv nt nu nv nw bi translated">表单:用于访问文件阅读器</li><li id="6fc2" class="no np iu lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">输入:用于选择CSV文件</li><li id="96cc" class="no np iu lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated">Textarea:用于显示对象数组</li></ol><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="4d26" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当用户选择一个CSV文件并点击“提交”按钮时，我们想要读取它的内容，这样我们就可以将它转换成一个对象数组。</p><p id="cd07" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们从表单上的一个<code class="fe oc od oe of b">addEventlistener</code>开始，我们监听一个提交事件。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="bb00" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因为提交事件的自然行为是页面刷新，所以我们想取消这个行为。否则，我们将无法读取文件及其内容。我们用<code class="fe oc od oe of b">event.preventDefault()</code>来做这件事。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="fb0e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们想访问文件的内容。我们可以通过使用<code class="fe oc od oe of b">FileReader</code> API来实现(阅读关于FileReader AP  I的更多MDN Web文档)。这个API帮助我们访问用户选择的文件。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="34ea" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在上面的代码中，我们为第一个选择的文件创建了<code class="fe oc od oe of b">file</code>变量。然后我们通过调用<code class="fe oc od oe of b">new FileReader()</code>在<code class="fe oc od oe of b">reader</code>变量中创建一个新的FileReader实例。</p><p id="7d58" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">其次，我们跳到代码片段的底部。<code class="fe oc od oe of b">reader.readAsText(file)</code>将在读取过程完成后将blob转换为文本。</p><p id="0dad" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当这个过程完成后，我们有了<code class="fe oc od oe of b">reader.onload</code>事件，在这里我们可以访问文件的内容。这里我们使用<code class="fe oc od oe of b">e</code>来引用事件，因为我们在<code class="fe oc od oe of b">addEventListener("submit", {...})</code>中使用了<code class="fe oc od oe of b">event</code>，这样我们就防止了冲突的发生。</p><p id="8dd2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">控制台记录内容以测试是否一切正常。</p><h1 id="60c9" class="nd me iu bd mf ne nf ng mi nh ni nj ml ka nk kb mo kd nl ke mr kg nm kh mu nn bi translated">3.将CSV转换为对象数组</h1><p id="d176" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">现在我们开始研究将CSV内容转换成一组对象的基本方法。</p><p id="a38f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们知道CSV可以有多种形式和大小。我发现在前端处理大型CSV文件会很麻烦，所以不要在生产应用程序中这样做。</p><p id="6bc6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">较小的CSV文件没有问题。不过自己测试这个还是不错的。</p><p id="55c9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们如何将这个CSV内容转换成JavaScript对象数组？直截了当，循序渐进！</p><h2 id="81a1" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">3.1 CSV内容</h2><p id="9175" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">让我们将这个CSV内容添加到一个变量中，这样我们就可以用它来测试我们的功能。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="7243" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lz">我用来测试它的文件结合</em> <a class="ae kz" href="https://gist.github.com/devbyray/2fcd917bbe92ee660853a0eff9833bff" rel="noopener ugc nofollow" target="_blank"> <em class="lz">文件上传可以在我的gist上找到。</em> </a></p><h2 id="8f98" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">3.2创建功能</h2><p id="1bc1" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">我们想为内容添加一个参数，所以我们称之为<code class="fe oc od oe of b">stringValue</code>。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><h2 id="dab7" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">3.3清理您的内容</h2><p id="99ae" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">首先，我们需要用修剪空格来清理CSV的内容。我们用<code class="fe oc od oe of b">trim()</code>方法来做。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><h2 id="f2fc" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">3.4新行拆分</h2><p id="7e9b" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">我们希望CSV文件中的每一行都成为数组中的一个对象。所以我们需要把所有的内容分开。我们通过在<code class="fe oc od oe of b">trim()</code>方法之后链接<code class="fe oc od oe of b">split('\n')</code>方法来实现这一点。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="69dd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个函数将返回一个字符串数组。尝试放入上面的CSV内容并调用函数时，检查控制台的结果。</p><h2 id="c6cc" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">3.5将属性名称与值分开</h2><p id="5657" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">在示例中，我们看到CSV的属性名在第一行。下面几行是这些属性中的值。让我们使用destructuring和spread语法将这些键从值中分离出来(阅读MDN Web文档上关于<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" rel="noopener ugc nofollow" target="_blank"> destructuring </a>和<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax" rel="noopener ugc nofollow" target="_blank"> spread语法的更多信息)。</a></p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="e033" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">多亏了析构，我们现在有了一个带有<code class="fe oc od oe of b">keys</code>的变量和一个带有所有其余值的变量<code class="fe oc od oe of b">rest</code>。</p><h2 id="4b3a" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">3.6拆分属性值</h2><p id="34fb" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">接下来，我们需要将长串值拆分成不同的值，这样我们就可以在下一步中使用它们来创建对象。我们通过链接<code class="fe oc od oe of b">map()</code>方法并使用<code class="fe oc od oe of b">split(',')</code>方法创建一个值数组来实现。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><h2 id="047f" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">3.7创建一个对象数组</h2><p id="fb1e" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">现在我们已经准备好了数据，我们可以创建一个对象数组。我们对<code class="fe oc od oe of b">rest</code>变量使用了<code class="fe oc od oe of b">map()</code>方法，这样我们就可以遍历多维数组。</p><p id="948b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">对于每个值的数组，我们循环遍历这些键。所以每个键都有它的值，即使值是一个空字符串，也不会有问题，因为我们以键为基础。</p><p id="c48b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在<code class="fe oc od oe of b">map</code>中的每一次迭代都将创建一个对象并将其返回给数组。最终，函数将返回对象数组。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="e427" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我的RunKit示例中，您可以看到代码是有效的。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="og nc l"/></div></figure><h2 id="3628" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">3.8在表单中实现功能</h2><p id="d0fb" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">现在我们准备将函数实现到表单中。下面的代码是JavaScript的结果。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nb nc l"/></div></figure><p id="6f73" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当我们把HTML和JavaScript结合起来，你会得到这样一个结果。在我的例子中，我在<code class="fe oc od oe of b">&lt;textarea&gt;</code>元素中展示了JSON。用<code class="fe oc od oe of b">JSON.stringify(csvArray, null, 4)</code>我可以很好地格式化它。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oh nc l"/></div></figure><p id="5c39" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">好了，就这样吧！现在我们有了一个HTML表单，它用JavaScript将CSV文件转换成一个对象数组💪。干得好！</p><p id="ebf1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请分享如果你创造了一个不同的版本或它看起来更友好的用户。</p><h1 id="8703" class="nd me iu bd mf ne nf ng mi nh ni nj ml ka nk kb mo kd nl ke mr kg nm kh mu nn bi translated">谢谢！</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oi"><img src="../Images/34b6d4e88daa5f22c87d2b9b476f66e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VfkbsGbdeKbkzFjc"/></div></figure><p id="98fc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">读完这个故事后，我希望你学到了一些新的东西，或者受到启发去创造一些新的东西！🤗</p><p id="3abd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果我给你留下了问题或一些要说的话作为回应，向下滚动并给我键入一条消息。如果你想保密，请在Twitter @DevByRayRay 上给我发一条<a class="ae kz" href="https://twitter.com/@devbyrayray" rel="noopener ugc nofollow" target="_blank"> DM。我的DM永远是开放的😁</a></p></div><div class="ab cl oj ok hy ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="in io ip iq ir"><p id="5a7e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://byrayray.medium.com/subscribe" rel="noopener"> <strong class="lc iv">通过电子邮件获取我的文章点击这里</strong> </a> <strong class="lc iv"> | </strong> <a class="ae kz" href="https://byrayray.medium.com/membership" rel="noopener"> <strong class="lc iv">购买5美元中等会员</strong> </a></p></div><div class="ab cl oj ok hy ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="in io ip iq ir"><h2 id="6579" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">阅读更多</h2><div class="oq or gq gs os"><div role="button" tabindex="0" class="ab bv gw cb fq ot ou bn ov kt ex"><div class="ow l"><div class="ab q"><div class="l di"><img alt="RayRay" class="l de bw ox oy fe" src="../Images/992af170033696163d6cc0269218aedd.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*1fUwrIRcFq3paK71SLifMw.png"/><div class="fb bw l ox oy fc n aw fd"/></div><div class="hi l fp"><p class="bd b dl z fq fr fs ft fu fv fw fx dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://byrayray.medium.com/?source=post_page-----3a0914a0bd8d--------------------------------" rel="noopener follow" target="_top">雷雷</a></p></div></div><div class="pb pc gx l"><h2 class="bd iv ug no fq uh fs ft ui fv fx it bi translated">最新的JavaScript和TypeScript故事</h2></div><div class="ab q"><div class="l fp"><a class="bd b be z bi uj au uk ul um qw un an eh ei uo up uq el em eo de bk ep" href="https://byrayray.medium.com/list/latest-javascript-typescript-stories-0358ad941491?source=post_page-----3a0914a0bd8d--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ur l fp"><span class="bd b dl z dk">14 stories</span></div></div></div><div class="po dh pp fq ab pq fp di"><div class="di pg bv ph pi"><div class="dh l"><img alt="" class="dh" src="../Images/c93ca03b33796c40dcc47873de2697c2.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*UQtuHklwRW4uxOcO"/></div></div><div class="di pg bv pj pk pl"><div class="dh l"><img alt="" class="dh" src="../Images/86f37efa11855f6f0f0f62984c37f696.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*gHDsISflc1mS_IJIuGZMUQ.png"/></div></div><div class="di bv pm pn pl"><div class="dh l"><img alt="" class="dh" src="../Images/ddbaa6d0bea676316247e82043d60b63.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*KJ9azc_7b1b_8tKn"/></div></div></div></div></div></div></div>    
</body>
</html>