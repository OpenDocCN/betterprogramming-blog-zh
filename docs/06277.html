<html>
<head>
<title>How to Automate Nuxt.js Deployments With Heroku and CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Heroku和CircleCI自动化Nuxt.js部署</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-automate-nuxt-js-deployments-with-heroku-and-circleci-8eaf10aa7b17?source=collection_archive---------9-----------------------#2020-09-16">https://betterprogramming.pub/how-to-automate-nuxt-js-deployments-with-heroku-and-circleci-8eaf10aa7b17?source=collection_archive---------9-----------------------#2020-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="da72" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为您的Nuxt项目设置持续集成和部署</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5977552e5379c60f4955be6c470a2d51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D4rxtQOBIDtyXm_lvk-W7w.jpeg"/></div></div></figure><p id="df14" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当团队很小的时候，手工部署一个<a class="ae lq" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> Nuxt </a>项目是非常容易的。然而，随着项目和团队的成长，他们通常会在他们的DevOps中转向持续集成和部署(CI/CD ),以自动化他们的测试和部署。这时部署以及部署的设置会变得复杂。</p><p id="9be5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将看看如何使用<a class="ae lq" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>和<a class="ae lq" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank"> CircleCI </a>为一个Nuxt项目轻松建立一个自动化CI/CD系统。我们将介绍所有细节，从设置GitHub库到自动化测试，再到推动代码变更。然后，我们将看看一些建议的后续步骤。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="3d20" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">Nuxt.js是什么？</h1><p id="fc2c" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">首先，这里有一些关于<a class="ae lq" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> Nuxt </a>的背景知识，以及为什么开发人员会选择它作为他们堆栈的一部分。</p><p id="e734" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当<a class="ae lq" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue </a>刚发布的时候，开发者就爱上了。凭借其简单的模板语法和组件结构，Vue可以轻松创建漂亮的单页面应用程序(spa)。</p><p id="3050" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，开发者很快意识到SEO是一个问题。由于SPAs是作为shell部署的，并且直到运行时才插入内容，开发人员了解到搜索引擎很难准确地索引内容。因此，开发人员需要一个解决方案来处理他们的Vue应用程序的服务器端渲染(SSR)。</p><p id="aef6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">输入<a class="ae lq" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> Nuxt </a>。</p><p id="40c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Nuxt是一个开源框架，它结合了所有常用的Vue库，捆绑了<a class="ae lq" href="https://router.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue路由器</a>、<a class="ae lq" href="https://vuex.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vuex </a>和<a class="ae lq" href="https://ssr.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue服务器端渲染(SSR)、</a>，为Vue.js开发者提供了一个更流畅的开发体验的架构。有了Nuxt，开发人员可以在几分钟内启动并运行一个SEO友好的Vue应用程序(带SSR)。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="c983" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">我们的示例项目</h1><p id="ca9b" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">现在让我们看看我们的示例项目和部署设置。对于这个项目，我们将使用GitHub作为我们的存储库，Heroku作为我们的主机，CircleCI作为我们的CI/CD工具。</p><p id="0da2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Heroku是一个PaaS解决方案，可以轻松部署和管理应用程序。CircleCI提供基于云的CI/CD，项目代码一推送到GitHub，就在容器中运行自动化作业。这些作业执行测试，发送成功或失败通知，然后将构建的应用程序部署到云服务环境中。</p><p id="62ed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们希望我们的结果是:当我们将主分支推送到GitHub时，一个自动化的过程将运行我们所有的测试，然后(如果所有测试都通过)将应用程序部署到Heroku。</p><p id="5b77" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为此，我将带您完成以下步骤:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="16fe" class="na lz it mw b gy nb nc l nd ne">1. <a class="ae lq" href="#d0dc" rel="noopener ugc nofollow">Set up a GitHub repository</a><br/>2. <a class="ae lq" href="#22e4" rel="noopener ugc nofollow">Create a basic Nuxt application</a><br/>3. <a class="ae lq" href="#6db0" rel="noopener ugc nofollow">Create the tests for our Nuxt application</a><br/>4. <a class="ae lq" href="http://db0c" rel="noopener ugc nofollow" target="_blank">Manually deploy the Nuxt application to Heroku</a><br/>5. <a class="ae lq" href="#03b3" rel="noopener ugc nofollow">Set up automated testing with CircleCI</a><br/>6. <a class="ae lq" href="#7952" rel="noopener ugc nofollow">Set up atuomated deployment to Heroku</a></span></pre><p id="833a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">听起来很简单？会的。我们走吧！</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="d0dc" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">1.设置GitHub存储库</h1><p id="0a4a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">本教程需要一个GitHub帐户。一个基本的GitHub免费帐户就足够了。</p><p id="aee6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将建立一个GitHub存储库来存放我们的项目代码。稍后，我们将把GitHub帐户与CircleCI帐户连接起来。每当我们向GitHub推送代码时，这个动作都会触发一个webhook来通知CircleCI开始CI/CD自动化过程。</p><p id="77a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在GitHub的“你的存储库”页面，点击“新建”存储库按钮。</p><p id="3415" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为这个私有存储库选择您想要的任何名称。对于本教程，我们称我们的存储库为<code class="fe nf ng nh mw b">my-heroku-nuxt-app</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/41ea0124419adfb4fe016decb5b24d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hSRy5_2Z9YkaTmxy.png"/></div></div></figure><p id="b3f0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">单击“创建存储库”结束操作。然后，将存储库克隆到您的本地机器上。在下面的命令中，确保使用您自己的GitHub用户名。注意，我们正在将空的存储库克隆到一个名为<code class="fe nf ng nh mw b">app</code>的文件夹中。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="b67b" class="na lz it mw b gy nb nc l nd ne">~/$ git clone git@github.com:[GITHUB USERNAME]/my-heroku-nuxt-app.git app <br/>Cloning into 'my-heroku-nuxt-app'... <br/>warning: You appear to have cloned an empty repository.</span></pre><p id="f017" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">非常好。现在我们有了<code class="fe nf ng nh mw b">app</code>文件夹，让我们用一个闪亮的新的Nuxt应用程序填充它。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="22e4" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">2.创建Nuxt应用程序</h1><p id="629e" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">仅供参考，我们将在整个教程中使用Node v10.20.0。我们也将使用<a class="ae lq" href="https://yarnpkg.com/" rel="noopener ugc nofollow" target="_blank">纱</a>作为我们的包装经理。</p><p id="9a16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从您的<code class="fe nf ng nh mw b">app</code>文件夹中，运行以下命令来创建一个新的Nuxt应用程序:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="9b75" class="na lz it mw b gy nb nc l nd ne">~/app$ yarn create nuxt-app<br/>create-nuxt-app v3.0.0<br/>✨ Generating Nuxt.js project in .<br/>? Project name my-heroku-nuxt-app<br/>? Choose programming language JavaScript<br/>? Choose the package manager Yarn<br/>? Choose UI framework None<br/>? Choose Nuxt.js modules None<br/>? Choose linting tools None<br/>? Choose test framework Jest<br/>? Choose rendering mode Universal (SSR / Static)<br/>? Choose development tools None</span></pre><p id="3011" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">交互式提示将要求您选择一些选项。你可以选择任何你喜欢的“项目名称”，但是重要的是你要选择我上面展示的选项。</p><p id="14cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">顺便说一下，如果你想用npm代替Yarn，你可以用命令<code class="fe nf ng nh mw b">npx create-nuxt-app</code>代替上面的<code class="fe nf ng nh mw b">yarn create</code>命令。</p><p id="5b0b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过从命令行运行<code class="fe nf ng nh mw b">yarn dev</code>来验证您的应用程序是否工作。您的浏览器窗口应该如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/78518ed2e1d18b2729c7b980480d033a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l7QMsgxbXBbmIYhy.png"/></div></div></figure><p id="b4ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">太好了！现在我们的应用程序已经启动并运行，让我们编写一些测试。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="6db0" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">3.为我们的Nuxt应用程序创建测试</h1><p id="9909" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">我们将只为我们的<code class="fe nf ng nh mw b">index</code>页面编写测试。请记住，除了这个基本的模板Nuxt应用程序之外，我们不打算构建任何东西。我们的目标是学习如何对Heroku进行自动化测试和部署。</p><p id="fddf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于测试，我们将使用<a class="ae lq" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>，这是一个流行的JavaScript测试框架。它易于使用，速度快如闪电。当我们创建上面的Nuxt应用程序时，我们选择捆绑Jest。</p><p id="71ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe nf ng nh mw b">app/pages</code>文件夹中，创建一个名为<code class="fe nf ng nh mw b">index.test.js</code>的新测试文件。我们将编写三个测试来验证我们的<code class="fe nf ng nh mw b">index</code>页面是否包含某些内容。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="b84d" class="na lz it mw b gy nb nc l nd ne">// FILE: ~/app/pages/index.test.js</span><span id="3088" class="na lz it mw b gy nk nc l nd ne">import { mount } from '@vue/test-utils'<br/>import index from './index.vue'</span><span id="8c8d" class="na lz it mw b gy nk nc l nd ne">describe('index page', () =&gt; {   <br/>  const wrapper = mount(index)  <br/>  describe('app title', () =&gt; {    <br/>    const element = wrapper.find('.title')    <br/>    it('displays app title', () =&gt; {      <br/>      expect(element.text()).toEqual('my-heroku-nuxt-app')    <br/>    })  <br/>  })  <br/>  describe('links', () =&gt; {    <br/>    const links = wrapper.find('.links')    <br/>    describe('nuxtjs', () =&gt; {      <br/>      it('contains link with correct text', () =&gt; {        <br/>        const link = links.find('[href="https://nuxtjs.org/"]')        <br/>        expect(link.text()).toEqual('Documentation')      <br/>      })    <br/>    })    <br/>    describe('github', () =&gt; {      <br/>      it('contains link with correct text', () =&gt; {        <br/>        const link = links.find('[href="https://github.com/nuxt/nuxt.js"]')        <br/>        expect(link.text()).toEqual('GitHub')      <br/>      })    <br/>    })  <br/>  })<br/>})</span></pre><p id="e260" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们进行测试。我们不会关心测试覆盖率，所以让我们包括<code class="fe nf ng nh mw b">--coverage false</code>标志。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="9ff7" class="na lz it mw b gy nb nc l nd ne">~/app$ yarn test --coverage false<br/>  PASS pages/index.test.js<br/>    index page<br/>       app title<br/>         ✓ displays app title (3 ms)<br/>       links<br/>         nuxtjs<br/>          ✓ contains link with correct text (1 ms)<br/>         github<br/>          ✓ contains link with correct text (1 ms)Test Suites: 1 passed, 1 total</span><span id="b897" class="na lz it mw b gy nk nc l nd ne">Tests: 3 passed, 3 total<br/>Snapshots: 0 total<br/>Time: 1.405 s, estimated 2 s<br/>Ran all test suites.<br/>Done in 2.21s.</span></pre><p id="29bb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，测试正在进行，让我们签入代码:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="f793" class="na lz it mw b gy nb nc l nd ne">~/app$ git add .<br/>~/app$ git commit -m "Create nuxt app with tests."<br/>~/app$ git push origin</span></pre><p id="aa21" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">干得好。现在，我们有了一个经过一些测试的Nuxt应用程序(正在通过)，并且我们已经将我们的<code class="fe nf ng nh mw b">master</code>分支推到了GitHub。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="db0c" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">4.手动将我们的应用程序部署到Heroku</h1><p id="0963" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">在我们构建自动化之前，让我们完成一个基本的、手动的Heroku部署。当我们通过CircleCI自动化部署时，这将帮助我们理解我们以后在做什么。</p><p id="4b1c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您还没有帐户，<a class="ae lq" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">用Heroku </a>建立一个新帐户。<a class="ae lq" href="https://www.heroku.com/pricing" rel="noopener ugc nofollow" target="_blank">自由计划</a>在这个例子中可以很好地工作。然后，登录您的帐户。在控制面板中，单击“新建”，然后单击“创建新应用程序”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/f3cae93fe39cc7f4d5e9d1aca1fd9870.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/0*c7si_yoH9hDNkA4o.png"/></div></figure><p id="fc99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为您的应用程序选择一个名称。在本教程中，我们将使用到目前为止一直使用的名称。请注意，Heroku上的应用程序名称在整个系统中必须是唯一的。所以有可能<code class="fe nf ng nh mw b">my-heroku-nuxt-app</code>不可用。如果是这种情况，请选择另一个名称，并在我们学习本教程的过程中注意替换。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/4d956c26ed427979efa17ee71b5c8fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/0*EX7VRb584lXTp8wB.png"/></div></figure><p id="5cb4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建应用程序后，您将看到应用程序部署设置。我们将使用“Heroku Git(使用Heroku CLI)”方法进行部署。我们将在从本地机器命令行手动部署时使用它，然后我们也将配置CircleCI通过命令行进行部署。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/33964ebbf66149cbe0038c1827f49f8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QRGj9-Fnn52jcKzY.png"/></div></div></figure><p id="f5a6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Heroku的deployment-settings页面上，您会看到一个链接，其中包含在您的本地机器上安装Heroku CLI的说明。安装Heroku CLI后，从命令行登录Heroku:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="8312" class="na lz it mw b gy nb nc l nd ne">~/app$ heroku login<br/> heroku: Press any key to open up the browser to login or q to exit:<br/> Opening browser to https://cli-auth.heroku.com/auth/cli/browser/ ...<br/> Logging in... done<br/> Logged in...</span></pre><p id="8b74" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于这个项目的GitHub存储库已经存在，我们希望添加新的Heroku remote。如果<code class="fe nf ng nh mw b">my-heroku-nuxt-app</code>不可用，请确保使用您在上面选择的Heroku应用程序名称。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="0431" class="na lz it mw b gy nb nc l nd ne">~/app$ heroku git:remote -a my-heroku-nuxt-app</span></pre><p id="6b4a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们想要设置一些Heroku配置变量来运行我们的生产部署。这些说明来自关于部署到Heroku 的<a class="ae lq" href="https://nuxtjs.org/faq/heroku-deployment" rel="noopener ugc nofollow" target="_blank"> Nuxt文档。</a></p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="18c2" class="na lz it mw b gy nb nc l nd ne">~/app$ heroku config:set HOST=0.0.0.0<br/>~/app$ heroku config:set NODE_ENV=production</span></pre><p id="dfe1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们可以将Nuxt应用程序推送到Heroku进行部署。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="e501" class="na lz it mw b gy nb nc l nd ne">~/app$ git push heroku<br/> Enumerating objects: 17, done.<br/> Counting objects: 100% (17/17), done.<br/> Delta compression using up to 4 threads<br/> Compressing objects: 100% (14/14), done.<br/> Writing objects: 100% (17/17), 167.78 KiB | 5.99 MiB/s, done.<br/> Total 17 (delta 0), reused 0 (delta 0), pack-reused 0<br/> remote: Compressing source files... done.<br/> remote: Building source:<br/> remote: -----&gt; Node.js app detected<br/> remote: -----&gt; Creating runtime environment<br/> remote: -----&gt; Installing binaries<br/> remote: -----&gt; Installing dependencies<br/> remote: -----&gt; Build<br/> remote: -----&gt; Pruning devDependencies<br/> remote: -----&gt; Caching build<br/> remote: -----&gt; Build succeeded!<br/> remote: -----&gt; Discovering process types<br/> remote: -----&gt; Compressing...<br/> remote: -----&gt; Launching...<br/> remote: https://my-heroku-nuxt-app.herokuapp.com/ deployed to Heroku<br/> remote: Verifying deploy... done.</span></pre><p id="aa93" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的命令是所有魔法发生的地方。Heroku检测到这是一个节点应用程序，然后它创建适当的部署环境并安装所有依赖项。安装完依赖项后，Heroku还会运行在您的<code class="fe nf ng nh mw b">package.json</code>中找到的<code class="fe nf ng nh mw b">build</code>脚本命令——这会捆绑客户端和服务器所需的所有文件。</p><p id="a917" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当我们访问Heroku应用程序的URL时，我们看到我们的Nuxt应用程序已在网上运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/db1276407e0c4edd86bf1b1cab1674d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rwzBoDNOEj2wwc-z.png"/></div></div></figure><p id="7ade" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就这样…我们的Nuxt SSR应用程序已经被部署到Heroku并上线了。剩下要做的就是通过CircleCI构建自动化CI/CD。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="03b3" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">5.用CircleCI设置自动化测试</h1><p id="fad2" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">点击“使用GitHub登录”，在<a class="ae lq" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank"> CircleCI </a>创建一个新账户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/ef6fc050626707c3def8bdc1b329ad17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C1mPlSmR0wl70Qe7.png"/></div></div></figure><p id="96d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过使用GitHub登录，您授权CircleCI访问您的所有存储库。在CircleCI的仪表板中，您可以选择希望CircleCI监控哪些GitHub存储库。</p><p id="87bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在CircleCI项目仪表板上，您会看到名为<code class="fe nf ng nh mw b">my-heroku-nuxt-app</code>的GitHub库——点击它右边的“设置项目”按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/552ecf687ba46990a604d57891ddf45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/0*EGnPwiCOMoWfvys4.png"/></div></figure><p id="0bf9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">CircleCI将为您选择一个配置模板(默认情况下，它选择“Hello World”模板)。很快，我们将提供自己的CircleCI配置文件。现在，选择“Hello World”，然后点击“开始构建”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/6def7a1a9d61b79f3081fccef9a37611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/0*Zep4rEqy7O29de-9.png"/></div></figure><p id="6f8a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将弹出一个模态，说明CircleCI将创建一个新的分支，并将这个配置模板添加到该分支。但是我们不需要CircleCI为我们做这些，所以选择“手动添加”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/bf342e8ec3843bbfc9541182505285f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/0*73mx4EeIuul7GPB3.png"/></div></figure><p id="c450" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们被告知需要在我们的存储库根文件夹中创建一个<code class="fe nf ng nh mw b">.circleci</code>子文件夹，然后向该子文件夹添加一个<code class="fe nf ng nh mw b">config.yml</code>。这就是我们将要做的。我们不需要下载模板<code class="fe nf ng nh mw b">config.yml</code>文件，因为我们要自己编写。所以只要点击“开始建设。”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/3a1d88ecc238c0db1aac703bbca744e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/0*oL-YMnDE5Un_dNLs.png"/></div></figure><p id="415b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您将项目设置为由CircleCI监控时(因为CircleCI已被授权访问您的GitHub存储库)，CircleCI会在您的GitHub存储库设置中添加一个新的公钥。</p><p id="3575" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">CircleCI将立即执行该项目的工作流程。您会注意到第一次构建尝试失败了。这是因为CircleCI正在项目存储库的<code class="fe nf ng nh mw b">master</code>分支的<code class="fe nf ng nh mw b">.circleci</code>子文件夹中寻找<code class="fe nf ng nh mw b">config.yml</code>文件。该文件尚不存在，所以我们现在创建它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/3c554be4116e3b4d824f7225776b7a06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5FHwtuNPzs5gu1TD.png"/></div></div></figure><p id="0555" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在您的项目根文件夹中，创建一个名为<code class="fe nf ng nh mw b">.circleci</code>的新的子文件夹:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="9fe2" class="na lz it mw b gy nb nc l nd ne">~/app$ mkdir .circleci</span></pre><p id="4c44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在那个文件夹中，创建一个名为<code class="fe nf ng nh mw b">config.yml</code>的新文件。我们将把教程的这一部分分成两个独立的部分。首先，我们将配置CircleCI来运行我们的测试。然后，在我们启动并运行之后，我们将继续配置Heroku部署。</p><p id="17bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nf ng nh mw b">config.yml</code>的内容应该如下:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="bf44" class="na lz it mw b gy nb nc l nd ne">// FILE: ~/app/.circleci/config.yml</span><span id="39de" class="na lz it mw b gy nk nc l nd ne">version: 2.1<br/> jobs:<br/> run-test-suite:<br/> docker:<br/> - image: circleci/node:10.20.0<br/> working_directory: ~/project<br/> steps:<br/> - checkout<br/> - run:<br/> name: Fetch dependencies<br/>  command: yarn install --no-progress --non-interactive --silent --pure-lockfile<br/> - run:<br/> name: Run test suite<br/> command: yarn test_ci<br/> - persist_to_workspace:<br/> root: ~/project<br/> paths:<br/> - .<br/> workflows:<br/> test-and-deploy:<br/> jobs:<br/>    - run-test-suite</span></pre><p id="84ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看一下上面的配置有什么作用:</p><ol class=""><li id="f1ee" class="ns nt it kw b kx ky la lb ld nu lh nv ll nw lp nx ny nz oa bi translated">我们定义了一个名为<code class="fe nf ng nh mw b">run-test-suite</code>的新工作。</li><li id="3520" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">这项工作设置了一个支持我们想要的版本的节点的环境。</li><li id="6e49" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">然后，该作业执行四个步骤。它检查存储库代码，安装依赖项，通过运行<code class="fe nf ng nh mw b">yarn test_ci</code>运行测试套件，然后将当前工作区文件夹保存到机器上，这样其他作业仍然可以访问当前状态的内容。</li><li id="0a75" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">我们整体的工作流程叫做<code class="fe nf ng nh mw b">test-and-deploy</code>，里面只有一个作业:<code class="fe nf ng nh mw b">run-test-suite</code>。</li></ol><p id="7b13" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能已经注意到CircleCI将从我们的项目文件夹中调用<code class="fe nf ng nh mw b">yarn test_ci</code>来运行测试套件。但是我们还没有在我们的<code class="fe nf ng nh mw b">package.json</code>脚本命令中定义<code class="fe nf ng nh mw b">test_ci</code>。</p><p id="ef3c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将用一个额外的标志<a class="ae lq" href="https://jestjs.io/docs/en/cli" rel="noopener ugc nofollow" target="_blank">来定义这个命令，这个标志告诉Jest以持续集成模式</a>运行。这会影响Jest如何处理<a class="ae lq" href="https://jestjs.io/docs/en/snapshot-testing" rel="noopener ugc nofollow" target="_blank">快照测试</a>。虽然我们现在的项目中没有这些，但是您会希望记住这一点，以防将来为您的项目编写快照测试。</p><p id="92eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为我们正在更新我们的<code class="fe nf ng nh mw b">package.json</code>文件，所以让我们在运行Jest时也关闭代码=覆盖测试:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="aa8a" class="na lz it mw b gy nb nc l nd ne">// Excerpt from FILE: ~/app/package.json</span><span id="66ae" class="na lz it mw b gy nk nc l nd ne">...<br/>  "scripts": {<br/>  "dev": "nuxt",<br/>  "build": "nuxt build",<br/>  "start": "nuxt start",<br/>  "generate": "nuxt generate",<br/>  "test": "jest --coverage false",<br/>      "test_ci": "yarn test --ci"<br/>  },<br/> ...</span></pre><p id="a23b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，让我们将新的<code class="fe nf ng nh mw b">.circleci/config.yml</code>文件和更新的<code class="fe nf ng nh mw b">package.json</code>文件添加到git staging，然后提交它们。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="b354" class="na lz it mw b gy nb nc l nd ne">~/app$ git add .<br/>~/app$ git commit -m "Add CircleCI config for testing, update package.json"</span></pre><p id="e8ed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将我们的新提交推送到<code class="fe nf ng nh mw b">master</code>:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="22f1" class="na lz it mw b gy nb nc l nd ne">~/app$ git push origin</span></pre><p id="dc2a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">几秒钟后，您应该会在CircleCI仪表板上看到这个项目的一个新管道条目。您的项目在<code class="fe nf ng nh mw b">master</code>分支上的<code class="fe nf ng nh mw b">test-and-deploy</code>工作流将开始执行。它将执行第一个也是唯一一个任务，即<code class="fe nf ng nh mw b">run-test-suite</code>。我们的测试应该通过，一切都应该是绿色的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/12cafa0d2210f8e0f84d4084f9fb1f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/0*yOsC4YLyCRYjy8ng.png"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="7952" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">6.设置到Heroku的自动部署</h1><p id="0b72" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">最后一步，我们希望配置CircleCI，以便在测试通过后将代码部署到Heroku。</p><p id="b3c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为此，我们需要用CircleCI配置修改我们的<code class="fe nf ng nh mw b">config.yml</code>文件。我们将使用CircleCI的<a class="ae lq" href="https://circleci.com/orbs/registry/orb/circleci/heroku" rel="noopener ugc nofollow" target="_blank"> Heroku orb </a>。CircleCI orbs是用于简化配置的可重用包。CircleCI有一个巨大的预建orb注册表，它简化了与第三方技术(如Heroku)的集成。</p><p id="40e8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们更新后的<code class="fe nf ng nh mw b">config.yml</code>应该如下所示:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="8863" class="na lz it mw b gy nb nc l nd ne">// FILE: ~/app/.circleci/config.yml</span><span id="f2b8" class="na lz it mw b gy nk nc l nd ne">version: 2.1<br/>orbs:<br/>   heroku: circleci/heroku@1.0.0<br/>jobs:<br/>run-test-suite:<br/>docker:<br/>- image: circleci/node:10.20.0<br/>working_directory: ~/project<br/>steps:<br/>- checkout<br/>- run:<br/>name: Fetch dependencies<br/>command: yarn install --no-progress --non-interactive --silent --pure-lockfile<br/>- run:<br/>name: Run test suite<br/>command: yarn test_ci<br/>- persist_to_workspace:<br/>root: ~/project<br/>paths:<br/>- .<br/>  deploy-to-heroku:<br/>   docker:<br/>    - image: circleci/node:10.20.0<br/>   working_directory: ~/project<br/>   steps:<br/>     - attach_workspace:<br/>        at: ~/project<br/>    - heroku/deploy-via-git<br/>workflows:<br/>test-and-deploy:<br/>jobs:<br/>- run-test-suite<br/>   - deploy-to-heroku:<br/>       requires:<br/>         - run-test-suite<br/>       filters:<br/>         branches:<br/>          only: master</span></pre><p id="3c50" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是我们添加的内容:</p><ol class=""><li id="76c5" class="ns nt it kw b kx ky la lb ld nu lh nv ll nw lp nx ny nz oa bi translated">除了原来的<code class="fe nf ng nh mw b">run-test-suite</code>工作，我们现在还有一个<code class="fe nf ng nh mw b">deploy-to-heroku</code>工作。它也使用相同的节点版本和工作目录。</li><li id="0e4e" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated"><code class="fe nf ng nh mw b">deploy-to-heroku</code>作业有两个步骤:首先，它附加到我们在前一个作业中持久化的工作区。第二，它调用<code class="fe nf ng nh mw b">deploy-via-git</code>命令，该命令在CircleCI的Heroku orb中定义。本质上，它运行一个Heroku CLI命令，类似于我们在上面手动将应用程序部署到Heroku时所做的。</li><li id="4dc7" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">我们已经将这个新的<code class="fe nf ng nh mw b">deploy-to-heroku</code>作业添加到我们的<code class="fe nf ng nh mw b">test-and-deploy</code>工作流中，但是我们对这个作业施加了一些约束。首先，它只会在成功运行<code class="fe nf ng nh mw b">run-test-suite</code>作业后运行。此外，只有CircleCI响应GitHub库的<code class="fe nf ng nh mw b">master</code>分支的webhook时，它才会运行。这意味着<em class="oh">所有推送到GitHub的</em>分支将导致<code class="fe nf ng nh mw b">run-test-suite</code>作业的运行。但是<em class="oh">只有</em>分支<code class="fe nf ng nh mw b">master</code>会继续<code class="fe nf ng nh mw b">deploy-to-heroku</code>的工作。这是有意义的，因为我们当然只想将<code class="fe nf ng nh mw b">master</code>分支部署到生产中。</li></ol><p id="09b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，在这个新的CircleCI配置工作之前，我们需要用一些与Heroku应用程序部署相关的环境变量来更新我们的CircleCI项目设置。在你的CircleCI项目设置中，点击“环境变量”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/d81ebaadbdc8bc819d2216393064d915.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/0*cSJdzGj8cSrEbAbl.png"/></div></figure><p id="d914" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要添加两个环境变量。第一个是<code class="fe nf ng nh mw b">HEROKU_API_KEY</code>，可以在你的Heroku账号设置里找到。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/64ae240684b14e059142d09d52cf0a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DpBSZG5ei1Ji13Qx.png"/></div></div></figure><p id="e344" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">单击“Reveal”，然后在CircleCI中复制/粘贴该值作为环境变量<code class="fe nf ng nh mw b">HEROKU_API_KEY</code>的值。</p><p id="c3f6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">CircleCI中我们需要的第二个环境变量是<code class="fe nf ng nh mw b">HEROKU_APP_NAME</code>，这是您在创建应用程序时建立的Heroku应用程序的名称。(对于我们的教程，是<code class="fe nf ng nh mw b">my-heroku-nuxt-app</code>。)</p><p id="0567" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">添加这两个环境变量后，您的CircleCI项目设置应该类似于下图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/71e57efce33f20dce207f9aa5efbb3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pD7nTN3LYpuxqkcN.png"/></div></div></figure><p id="4e7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们都准备好了，我们可以将更新后的<code class="fe nf ng nh mw b">.circleci/config.yml</code>文件存放并提交到Git，然后推送到GitHub:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="3a86" class="na lz it mw b gy nb nc l nd ne">~/app$ git add .<br/>~/app$ git commit -m "Update CircleCI config for Heroku deployment"<br/>~/app$ git push origin</span></pre><p id="40e5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当我们向GitHub推送时，会发生以下情况:</p><ol class=""><li id="6434" class="ns nt it kw b kx ky la lb ld nu lh nv ll nw lp nx ny nz oa bi translated"><code class="fe nf ng nh mw b">master</code>分支上的新提交被推送到GitHub。</li><li id="a1fc" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">GitHub接收到一个新的push，向CircleCI发送一个webhook，指明刚刚获得新提交的分支的名称。</li><li id="a128" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">CircleCI开始为该项目启动<code class="fe nf ng nh mw b">test-and-deploy</code>工作流程。</li><li id="8779" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">工作流中的第一个作业是<code class="fe nf ng nh mw b">run-test-suite</code>。所有的测试都运行了，并且都通过了。</li><li id="5b56" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">由于<code class="fe nf ng nh mw b">run-test-suite</code>成功<em class="oh">和</em>刚刚获得新提交的分支是<code class="fe nf ng nh mw b">master</code>，因此<code class="fe nf ng nh mw b">deploy-to-heroku</code>作业接着运行。</li><li id="1eb8" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">配备了<code class="fe nf ng nh mw b">HEROKU_API_KEY</code>环境变量(它授权CircleCI访问您的Heroku应用程序)和<code class="fe nf ng nh mw b">HEROKU_APP_NAME</code>环境变量(它让CircleCI知道<em class="oh">要部署哪个</em> Heroku应用程序)，该作业将代码推送到Heroku。</li><li id="c99a" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">收到CircleCI推送的代码后，Heroku构建Nuxt应用程序，然后启动服务器。</li></ol></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="f9e2" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">回顾并总结</h1><p id="d8c1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">现在你知道了。您已经为您的Nuxt SSR应用程序设置了完整的CI/CD自动化。只需将您的项目推送到GitHub，您的项目测试就会运行，您的项目就会部署到Heroku。</p><p id="c3ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们快速回顾一下我们做了什么:</p><ol class=""><li id="ffe9" class="ns nt it kw b kx ky la lb ld nu lh nv ll nw lp nx ny nz oa bi translated">我们为项目建立了一个GitHub存储库。</li><li id="b103" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">我们使用<code class="fe nf ng nh mw b">yarn create nuxt-app</code>创建了一个新的Nuxt应用程序。</li><li id="e899" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">我们使用Jest为我们的Nuxt应用程序编写了测试。</li><li id="939e" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">我们使用Heroku CLI将我们的项目手动部署到Heroku。</li><li id="9ebb" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">我们设置了CircleCI，以便在我们将代码推送到GitHub时自动运行我们的测试套件。</li><li id="8990" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp nx ny nz oa bi translated">每当我们将<code class="fe nf ng nh mw b">master</code>分支推送到GitHub并且所有测试都通过时，我们设置CircleCI来自动部署到Heroku。</li></ol></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="0615" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">后续步骤</h1><p id="33cc" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">你现在已经有了更上一层楼的基础。从现在开始，你可以采取哪些后续步骤来发展这些新知识？</p><ul class=""><li id="9545" class="ns nt it kw b kx ky la lb ld nu lh nv ll nw lp ok ny nz oa bi translated">在这个基本的Nuxt应用程序上扩展，您可以通过全面的测试构建新的特性。既然您已经自动化了测试运行和到Heroku的部署，那么您需要担心的就是编写测试、编写代码和推送至GitHub。</li><li id="8d10" class="ns nt it kw b kx ob la oc ld od lh oe ll of lp ok ny nz oa bi translated">或者，如果您已经有了一个现有的NuxtJS应用程序，那么您可以将Heroku部署和CircleCI自动化步骤应用到您现有的项目中。在不到一个小时的时间内，您可以构建CI/CD。</li></ul><p id="1516" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为将Nuxt SSR应用程序部署到Heroku是如此的快速和简单，所以您减少了上线时遇到的摩擦。随着CI/CD融入到您的开发过程中，您将自己和您的团队从交付代码的另一个任务清单中解放出来。</p><p id="2862" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="oh">经同事</em><a class="ae lq" href="https://medium.com/@alvinslee" rel="noopener"><em class="oh"/></a><em class="oh">许可发表。</em></p></div></div>    
</body>
</html>