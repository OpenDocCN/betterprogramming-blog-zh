<html>
<head>
<title>Building an API With Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Firebase构建API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-an-api-with-firebase-109041721f77?source=collection_archive---------0-----------------------#2019-07-24">https://betterprogramming.pub/building-an-api-with-firebase-109041721f77?source=collection_archive---------0-----------------------#2019-07-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ddbe5f92ac467f43991a286c3b353bf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a0yi4etYe-FPA17X"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@lastnameeaster?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">洛杉矶复活节</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="7ecc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将用谷歌的Firebase构建一个API。我将用<a class="ae kf" href="https://firebase.google.com/docs/functions" rel="noopener ugc nofollow" target="_blank"> Firebase云函数</a>和<a class="ae kf" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a>构建后端。</p><p id="513b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在开始之前，我推荐以下设置:</p><ol class=""><li id="b5ae" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">安装在Windows、Linux或Mac (OSX)电脑上的终端</li><li id="9958" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">已安装节点10.10</li><li id="536c" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">NVM安装了<a class="ae kf" href="https://github.com/nvm-sh/nvm" rel="noopener ugc nofollow" target="_blank">和这里的说明</a></li><li id="0f14" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">一个谷歌账户</li><li id="7dfe" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a>已安装</li><li id="5597" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">安装了运行终端命令<code class="fe ls lt lu lv b">npm install -g firebase-tools</code>的Firebase CLI<a class="ae kf" href="https://firebase.google.com/docs/cli" rel="noopener ugc nofollow" target="_blank"/></li></ol><p id="aecb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将在这个GitHub repo 中引用可用的代码<a class="ae kf" href="https://github.com/andrewevans0102/how-to-build-a-firebase-api" rel="noopener ugc nofollow" target="_blank">。GitHub repo还包含一个邮递员集合；我建议导入它并使用它来测试您的项目。</a></p><p id="06f5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，URL路径中的<code class="fe ls lt lu lv b">app id</code>特定于我部署的项目。您需要更改<code class="fe ls lt lu lv b">app id</code>来匹配您在Firebase控制台中创建的项目。</p><p id="1d06" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您还不理解这一点，没关系——在初始项目建立之后，我将进一步讨论这一点。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="6eaf" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">基础知识</h1><p id="b9ca" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">首先，我想回顾一下什么是API以及这些技术如何工作的一些基本概念。这完全是介绍性的，所以如果您已经熟悉了，可以随意跳过这一部分。</p><p id="b89c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">API代表<em class="ng">应用编程接口</em>，指的是计算机系统用来相互通信的方法。</p><p id="316d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Google的字典将API定义为:</p><blockquote class="nh ni nj"><p id="95b5" class="kg kh ng ki b kj kk kl km kn ko kp kq nk ks kt ku nl kw kx ky nm la lb lc ld im bi translated">一组函数和过程，允许创建访问操作系统、应用程序或其他服务的功能或数据的应用程序</p></blockquote><p id="38e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您构建了一个API，这样您的系统就可以与您正在构建的任何东西进行通信。API可以包括网站的基本REST端点，甚至可以包括定义您构建的软件库的方法。</p><p id="44c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就引出了下一件重要的事情，RESTful服务。</p><p id="c2fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">RESTful服务引用<a class="ae kf" href="https://en.wikipedia.org/wiki/Representational_state_transfer" rel="noopener ugc nofollow" target="_blank"> <em class="ng">表述性状态转移</em> </a>并利用HTTP协议传递数据(通过API)。HTTP协议是我们每天在网站和互联网应用中使用的协议。</p><p id="7c1c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">RESTful服务使用不同的HTTP动词(或方法)在不同的系统之间传递数据。</p><p id="670c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">典型的HTTP动词包括:</p><ul class=""><li id="0667" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">GET</code> =检索数据</li><li id="3ace" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">POST</code> =创建或更新数据</li><li id="4b8b" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">PUT</code> =更新数据</li><li id="de25" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">DELETE</code> =删除数据</li></ul><p id="0e03" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">前面我也提到过<em class="ng">端点</em>；当我提到一个我需要点击的网站或服务时，这就是我要参考的。端点只是一种描述地址的奇特方式，我的系统将通过HTTP请求访问该地址。</p><p id="1da3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关于HTTP请求的更多细节，请参考维基百科页面。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4761" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">重火力点</h1><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/44a353f0d8d472ea5aad9827c0e6ca2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Wi6ojCvgbw8B--sf"/></div></figure><p id="d250" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我正在为这个项目使用谷歌的Firebase平台。Firebase是一个非常强大的平台，开发人员可以使用它快速构建应用程序。</p><p id="f579" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Firebase提供的常见服务包括:</p><ul class=""><li id="22e3" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nn lk ll lm bi translated"><a class="ae kf" href="https://firebase.google.com/docs/hosting" rel="noopener ugc nofollow" target="_blank">主持</a></li><li id="ed25" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><a class="ae kf" href="https://firebase.google.com/docs/database" rel="noopener ugc nofollow" target="_blank">实时数据库</a></li><li id="9458" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><a class="ae kf" href="https://firebase.google.com/docs/firestore" rel="noopener ugc nofollow" target="_blank"> NoSQL数据库</a></li><li id="7d47" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><a class="ae kf" href="https://firebase.google.com/docs/functions" rel="noopener ugc nofollow" target="_blank">功能(类似于AWS Lambda) </a></li><li id="90d0" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><a class="ae kf" href="https://firebase.google.com/docs/storage" rel="noopener ugc nofollow" target="_blank">文件存储</a></li><li id="7eca" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated">多得多！</li></ul><p id="1653" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用Firebase，你只需要一个谷歌账户。</p><p id="7861" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章的剩余部分，我将为一个用Firebase构建的API设置后端。如果你想更深入地了解Firebase，<a class="ae kf" href="https://rhythmandbinary.com/2018/04/08/firebase/" rel="noopener ugc nofollow" target="_blank">请在这里查阅我的帖子</a>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ff7c" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">初始设置</h1><p id="6605" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">首先，进入<a class="ae kf" href="https://console.firebase.google.com/u/0/" rel="noopener ugc nofollow" target="_blank">fire base控制台</a>。您应该会看到如下所示的内容:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/fec81b858e43383cd604efc46cce30cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TKGezr6auXIHzjOR"/></div></figure><p id="2016" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单击“添加项目”并为您的项目命名。</p><p id="54ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我建议接受这些分析，因为这对你和谷歌都有帮助。您可以稍后在控制台中参考分析信息(在您的项目被创建之后)。</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/e3bbd033106c25a763651e260eb48145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qch15oMvgngtJ1hB"/></div></figure><p id="0d3c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建项目后，在控制台中打开它，然后单击左侧导航栏上的“database”以查看以下内容:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/6c8b1b07b0cfffdcaee08e858aa0206a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bDn5RqCKMwkHWqFq"/></div></figure><p id="b980" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">点击“云<a class="ae kf" href="https://firebase.google.com/docs/firestore" rel="noopener ugc nofollow" target="_blank"> Firestore </a>下的“创建数据库”来创建您的初始数据库。</p><p id="aaa6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">选择“测试模式”以启用所有读取和写入。您可以设置规则来指定数据库的安全性，以便以后进一步锁定数据库。请参考这里的<a class="ae kf" href="https://firebase.google.com/docs/firestore/security/get-started" rel="noopener ugc nofollow" target="_blank"> Firebase文档，了解更多关于锁定数据库实例的信息</a>。</p><p id="4a67" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你还会被要求设置一个位置；默认应该没问题，但是您也可以尝试选择离您更近的数据中心。查看本页了解更多关于数据中心位置的信息。</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/5a5c14eb7416f4fe2c2e955fe3fbb046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8PxaIAHoi7Up_LIS"/></div></figure><p id="e02c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在控制台中设置好基本项目后，让我们切换到您的计算机来设置代码。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="06fe" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">编写代码</h1><p id="6656" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">在这一步中，我们假设您的计算机上已经安装了Firebase CLI。如果你还没有这样做，我建议你按照这里的<a class="ae kf" href="https://firebase.google.com/docs/cli" rel="noopener ugc nofollow" target="_blank">指示</a>来设置。</p><p id="ea93" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，转到您的终端，用<code class="fe ls lt lu lv b">mkdir my-project</code>为您的项目创建一个文件夹。</p><p id="ab38" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，<code class="fe ls lt lu lv b">cd</code>进入那个文件夹，运行<code class="fe ls lt lu lv b">firebase init</code>；您应该会看到如下所示的内容:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/5a15f78ccbc39bb30d3b6a2f38aa3da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cc_uG2sTXc3PSxkY"/></div></figure><p id="4736" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在选项菜单中选择“功能”。然后在下一个终端输出显示的列表中选择您之前创建的Firebase应用程序。</p><p id="7fb2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一组选项相当简单。</p><ul class=""><li id="f798" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nn lk ll lm bi translated">选择<code class="fe ls lt lu lv b">JavaScript</code></li><li id="6b11" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated">为林挺选择<code class="fe ls lt lu lv b">yes</code></li><li id="9d92" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated">选择<code class="fe ls lt lu lv b">yes</code>安装依赖项</li><li id="ee65" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated">你可以走了！</li></ul><p id="6e11" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，<code class="fe ls lt lu lv b">cd</code>进入创建的<code class="fe ls lt lu lv b">functions</code>文件夹。当您运行<code class="fe ls lt lu lv b">init</code>命令时，它会生成一个<code class="fe ls lt lu lv b">functions</code>文件夹供您使用。<code class="fe ls lt lu lv b">functions</code>文件夹应该包含以下文件:</p><ul class=""><li id="f255" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">index.js</code></li><li id="6f76" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">node_modules</code>文件夹</li><li id="caff" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">package-lock.json</code></li><li id="0d49" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">package.json</code></li></ul><p id="2e79" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在你选择的终端编辑器中继续(我强烈推荐<a class="ae kf" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>)，先看看<code class="fe ls lt lu lv b">index.js</code>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2ffd" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">无服务器API和您的第一个端点</h1><p id="2738" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">Firebase函数使您能够使用<a class="ae kf" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a>库来托管无服务器API。<em class="ng">无服务器</em>是指没有物理服务器运行的系统。</p><p id="5437" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这有点用词不当，因为从技术上讲，它确实运行在服务器上；然而，你让提供商处理托管。传统的API要求您在云中或本地设置一个服务器来托管您的应用程序。</p><p id="719c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着开发人员必须负责操作系统补丁和警报等。有了serverless，除了你的代码，你什么都不用担心。这是Firebase最酷的部分之一！</p><p id="d475" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，要在您的项目中使用Express.js，请删除<code class="fe ls lt lu lv b">index.js</code>文件，并在那里粘贴以下代码行:</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="4af5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<code class="fe ls lt lu lv b">require</code>的第一行引入依赖项。我们还没有<code class="fe ls lt lu lv b">express</code>或<code class="fe ls lt lu lv b">cors</code>，所以让我们用下面的命令在终端中安装它们:</p><pre class="np nq nr ns gt nv lv nw nx aw ny bi"><span id="2d2d" class="nz me it lv b gy oa ob l oc od">npm i express<br/>npm i cors</span></pre><p id="9b4d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">带有<code class="fe ls lt lu lv b">require</code>值的初始行导入我们将要使用的库。</p><p id="24e3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是更详细的库:</p><ul class=""><li id="e39c" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">firebase-functions</code>是一个<a class="ae kf" href="https://www.npmjs.com/package/firebase-functions" rel="noopener ugc nofollow" target="_blank"> npm模块</a>，使您能够创建功能。</li><li id="d178" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">firebase-admin</code>是<a class="ae kf" href="https://firebase.google.com/docs/admin/setup" rel="noopener ugc nofollow" target="_blank">Firebase admin SDK</a>，它使您的功能能够控制所有后端Firebase服务。</li><li id="1b82" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">express</code>是让您创建服务器实例的<a class="ae kf" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a>库。</li><li id="faeb" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">cors</code>是一个<a class="ae kf" href="https://www.npmjs.com/package/cors" rel="noopener ugc nofollow" target="_blank"> npm模块</a>，它允许你的函数在独立于你的客户端的地方运行。<code class="fe ls lt lu lv b">app.use</code>为您的Express服务器实例启用CORS。</li></ul><p id="b321" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">带有<code class="fe ls lt lu lv b">app.get</code>的代码部分创建了一个“hello world”端点。我们在这里使用的是<a class="ae kf" href="https://expressjs.com/en/guide/routing.html" rel="noopener ugc nofollow" target="_blank">快速路由</a>。有很多方法可以做到这一点。为了方便起见，我明确地定义了路线。</p><p id="94b3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在企业环境中，您可能会使用快速路由器，并且代码可能看起来不那么冗长。要更详细地了解快速路由，我<a class="ae kf" href="https://scotch.io/tutorials/learn-to-use-the-new-router-in-expressjs-4" rel="noopener ugc nofollow" target="_blank">推荐这里的教程</a>。</p><p id="a570" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出于我们的目的，<code class="fe ls lt lu lv b">app.get</code> is发出一个HTTP <code class="fe ls lt lu lv b">GET</code> <strong class="ki iu"> </strong>请求，并在<code class="fe ls lt lu lv b">req</code>中捕获请求，在<code class="fe ls lt lu lv b">res</code>中捕获响应。</p><p id="0400" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当端点被调用时，它将返回一个“Hello World！”HTTP状态代码为<code class="fe ls lt lu lv b">200</code>的字符串。HTTP中的状态代码用于确定响应。有很多，但是对于本教程来说，<code class="fe ls lt lu lv b">200</code>是<code class="fe ls lt lu lv b">success</code>，<code class="fe ls lt lu lv b">500</code>会返回<code class="fe ls lt lu lv b">error</code>。</p><p id="c393" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">带有<code class="fe ls lt lu lv b">exports.app = functions.https.onRequest(app);</code>的部分暴露了您的Express应用程序，因此可以访问它。如果没有<code class="fe ls lt lu lv b">exports</code>部分，您的应用程序将无法正确启动。</p><p id="ad4a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装好包和初始代码后，我们就可以用<code class="fe ls lt lu lv b">npm run serve</code>运行我们的项目了。这将在本地为您的功能服务，并且应该产生如下输出:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/de4aa89d31f3373546ffd111878356f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mhAVmOjZwVeIUrzP"/></div></figure><p id="82ed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你注意到了，我确实收到了一个关于我的<a class="ae kf" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank">节点</a>版本的警告。暂时忽略它；当我们开始访问数据库的时候，我会回来的。</p><p id="cca2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另外，请注意，终端会输出本地运行的API的本地主机地址。您将直接从Postman调用它，因为这是您的API的“地址”。</p><p id="167f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在localhost上运行时，您的应用程序的URL将如下所示:</p><pre class="np nq nr ns gt nv lv nw nx aw ny bi"><span id="e19c" class="nz me it lv b gy oa ob l oc od">[&lt;------domain----&gt;]/[&lt;-app id---&gt;]/[&lt;-zone--&gt;]/app/[&lt;-endpoint-&gt;]<br/>http://localhost:5000/fir-api-9a206/us-central1/app/create</span></pre><p id="0a88" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们进行部署时，URL中唯一的不同是<code class="fe ls lt lu lv b"><a class="ae kf" href="http://localhost:500" rel="noopener ugc nofollow" target="_blank">http://localhost:500</a></code>将被替换为<code class="fe ls lt lu lv b">zone + app id + cloudfunctions.net</code>，如下所示:</p><pre class="np nq nr ns gt nv lv nw nx aw ny bi"><span id="3f3b" class="nz me it lv b gy oa ob l oc od">[&lt;---zone + app id + cloudfunctions.net-----&gt;]/app/[&lt;--endpoint--&gt;]<br/>https://us-central1-fir-api-9a206.cloudfunctions.net/app/hello-world</span></pre><p id="b1b4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你需要使用你的应用ID值更新邮递员集合。要查看您的应用ID，请转到Firebase控制台并单击“项目设置”，如下图所示:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/e63b8fe09dbc357902625e892d99ffdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/0*lcBPbFhTWGWd8nwh"/></div></figure><p id="2da8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在那里，项目ID(和一些其他设置)将被列出。我在这张截图里圈出来了:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/486397ffa847cf08a81345d9e778e7b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C-7tbuvFkWd1X1ba"/></div></figure><p id="457d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">打开邮递员集合，编辑<code class="fe ls lt lu lv b">localhost</code>文件夹下的<code class="fe ls lt lu lv b">hello-world localhost</code>请求。</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/6cc8b670756c575625992c13e46f2499.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/0*2tgGbDHWdByrJpLP"/></div></figure><p id="a25b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(如果您仍然对Postman有疑问，请在此处查阅<a class="ae kf" href="https://learning.getpostman.com/docs/postman/collections/creating_collections/" rel="noopener ugc nofollow" target="_blank">说明</a>。)</p><p id="57dd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我提到的，更改ID值以匹配您的项目。当您运行<code class="fe ls lt lu lv b">npm run serve</code>时，终端中列出的地址应该也有这个信息。</p><p id="86fe" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成后，运行来自Postman的请求，您应该会看到以下内容:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/e5d26894322867c35c1636791faaf3a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iaeCKD-dAoUGyrLB"/></div></figure><p id="010c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经设置了初始端点，让我们继续添加数据库调用。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="87b0" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">数据库调用</h1><p id="4d75" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">对于我们正在构建的API，它只是对一系列项目的操作。我们将为这个项目列表设置<code class="fe ls lt lu lv b">Create</code>、<code class="fe ls lt lu lv b">Read</code>、<code class="fe ls lt lu lv b">Update</code>和<code class="fe ls lt lu lv b">Delete</code>(或<strong class="ki iu"> CRUD </strong>)函数。</p><p id="7ead" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Firebase中，您有两种数据库使用选择。可以使用传统数据库，也可以使用云Firestore。</p><p id="d4e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于本教程，我们将使用云Firestore，因为它更容易使用，功能也更丰富。Cloud Firestore是一个<a class="ae kf" href="https://en.wikipedia.org/wiki/NoSQL" rel="noopener ugc nofollow" target="_blank"> NoSQL数据库</a>，这意味着你的数据被存储为集合中的文档。</p><p id="fd8a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这与SQL数据库中数据存储在表的行中的方式类似。由于数据访问和存储的性质，NoSQL数据库通常性能更好，也更容易扩展。</p><p id="3692" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在设置部分，我们向项目添加了一个云Firestore实例。要在本地使用<a class="ae kf" href="https://firebase.google.com/docs/admin/setup" rel="noopener ugc nofollow" target="_blank"> admin SDK </a>与云Firestore交互，您需要通过服务帐户访问它。</p><p id="d99a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">服务帐户有他们使用的密钥；您可以通过下载密钥文件来运行这些权限。</p><p id="7eb6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，请转到Firebase控制台并打开您的应用程序。然后点击小齿轮箱和“用户和权限”,如下所示:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b7186c566b437f9f8d53c38c6a46c748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Si0Ukb_u30fUN_u-"/></div></figure><p id="78d3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后单击“服务帐户”选项卡，您应该会看到如下内容:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/69b1705e9bfa231588570e851140b5c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HH3zymNZYK8pJ3Bs"/></div></figure><p id="3459" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你注意到了，在屏幕的底部，他们为你提供了一些在你的项目中运行的代码。您唯一需要的是要引用的权限文件。</p><p id="6071" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">继续并点击“生成新的私钥”以便能够在您的项目中安装它。然后，将它存储在我们刚刚使用的<code class="fe ls lt lu lv b">functions</code>文件夹中的<code class="fe ls lt lu lv b">index.js</code>文件旁边。</p><p id="85e8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你想叫它什么都可以；我给我的取名<code class="fe ls lt lu lv b">permissions.json</code>。</p><p id="8273" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，将以下内容添加到您的<code class="fe ls lt lu lv b">index.js</code>文件的顶部:</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="11e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这几行代码(1)加载到您的权限文件中，然后(2)用它来初始化您的应用程序。我还创建了一个变量<code class="fe ls lt lu lv b">db</code>来表示我们的Firestore实例。这不是必需的，但可以使代码在以后变得更干净。</p><p id="88ac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">加载完这些值后，让我们为应用程序添加一个<code class="fe ls lt lu lv b">create</code>端点。在<code class="fe ls lt lu lv b">hello-world</code>端点下方，添加以下内容:</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="1ce4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这段代码创建了一个端点<code class="fe ls lt lu lv b">/api/create-item</code>，您可以对其进行<code class="fe ls lt lu lv b">POST</code>调用。当发出<code class="fe ls lt lu lv b">POST</code>调用时，它将主体中的<code class="fe ls lt lu lv b">item</code>添加到数据库中名为“<code class="fe ls lt lu lv b">items</code>的集合中，该集合具有您传入的值的ID，这里称为<code class="fe ls lt lu lv b">id</code>。</p><p id="78fb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">NoSQL数据库中的收藏只是文献的收集者。对于特定的文档，您可以轻松地做到这一点。在使用Firestore时，我倾向于喜欢收藏，因为它们容易理解。您也可以将集合想象成类似于SQL数据库中的表。</p><p id="6d9c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你也注意到了，我在端点前加了前缀<code class="fe ls lt lu lv b">/api</code>。这不是必需的，但是对于您创建的任何API来说通常都很方便。<em class="ng"> </em>我还用我的请求指定了ID值。Firebase将为您完成这项工作，但我认为如果我们在请求中明确定义这一点，会更容易理解。</p><p id="0076" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">添加了这段代码之后，让我们在终端中停止服务器(如果您还没有这样做的话)，然后用一个新的<code class="fe ls lt lu lv b">npm run serve</code>重新启动它。</p><p id="de6b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Postman集合中，拉起“create localhost”<code class="fe ls lt lu lv b">POST</code>请求。像之前一样修改<code class="fe ls lt lu lv b">app id</code>值，并尝试请求。</p><p id="c76a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行它时，您应该会看到以下错误:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/68898cc71420077c959f38b19c68ded4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F5pWuDMBBI77FJbb"/></div></figure><p id="e19a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Firebase admin SDK要求节点版本为8.13.0或10.10。这就是为什么我要求<a class="ae kf" href="https://github.com/nvm-sh/nvm" rel="noopener ugc nofollow" target="_blank">在第一节</a>安装nvm。这很容易解决。nvm使您能够在本地终端中快速切换节点版本。</p><p id="1a54" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在您的终端中，运行<code class="fe ls lt lu lv b">nvm use 10.10</code>，您应该看到以下内容:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/5f5d86ee712d4b0505ac9c836faf3cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yu_vqli-grOLiEON"/></div></figure><p id="3cc0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在用<code class="fe ls lt lu lv b">npm run serve</code>再次启动你的服务器，点击Postman上的端点。您应该会看到一个<code class="fe ls lt lu lv b">200</code>成功。在终端中，还可以看到API被本地命中。</p><p id="cbcf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您遇到关于<code class="fe ls lt lu lv b">onRequestWithOpts</code>或类似的错误，请执行<code class="fe ls lt lu lv b">npm i firebase-tools</code>。</p><p id="b3ed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">CLI最近出现了一个错误:7.1.0版修复了这个错误。在写这篇文章的时候，我发现我需要更新我的Firebase CLI版本来解决这个问题。查看本期<a class="ae kf" href="https://github.com/firebase/firebase-tools/issues/1480" rel="noopener ugc nofollow" target="_blank">了解更多</a>。</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/519be0807d342027f9bb0b5c59217073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TVG6ZCatWIkikLha"/></div></figure><p id="771b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个额外的酷功能是，你可以直接在云Firestore中看到你的数据。如果您跳转到Firebase控制台，单击左侧导航栏上的“database”链接，您应该会看到如下内容:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/a9a04302273fbd8ec95f03346755318b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TAeQbdYxPmDJyaSx"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ef39" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">构建数据库端点</h1><p id="9478" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">现在我们已经设置了<code class="fe ls lt lu lv b">create</code>端点，让我们添加其余的操作:</p><ul class=""><li id="3175" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">/read-item/:item_id</code> =读取特定项目(按ID)</li><li id="e195" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">/read-items</code> =阅读所有条目(全部收藏)</li><li id="1c64" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">/update-item/:item_id</code> =更新项目</li><li id="3895" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><code class="fe ls lt lu lv b">delete-item/:item_id</code> =删除一个项目</li></ul><p id="48b0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在很大程度上，所有的终点都是相似的。例外是当我传递带有<code class="fe ls lt lu lv b">item_id</code>值的查询参数时。这一切都遵循基本的路由，您可以在<a class="ae kf" href="https://expressjs.com/en/guide/routing.html" rel="noopener ugc nofollow" target="_blank"> Express.js文档</a>中看到。</p><p id="3f42" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，对于与Firebase Admin SDK的实际交互，我推荐这里的<a class="ae kf" href="https://googleapis.dev/nodejs/firestore/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Firestore API参考</a>。</p><p id="2b08" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要查看这些端点应该是什么样子(完成后)<a class="ae kf" href="https://github.com/andrewevans0102/how-to-build-a-firebase-api/blob/master/functions/index.js" rel="noopener ugc nofollow" target="_blank">请点击这里查看GitHub repo上的</a> <code class="fe ls lt lu lv b"><a class="ae kf" href="https://github.com/andrewevans0102/how-to-build-a-firebase-api/blob/master/functions/index.js" rel="noopener ugc nofollow" target="_blank">index.js</a></code> <a class="ae kf" href="https://github.com/andrewevans0102/how-to-build-a-firebase-api/blob/master/functions/index.js" rel="noopener ugc nofollow" target="_blank">文件。</a></p><p id="86f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是其余端点的代码:</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="03f5" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">部署</h1><p id="183e" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">所以现在我们有了一个全功能的CRUD API。我们准备好部署了！</p><p id="72ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您正在开发一个企业应用程序(或者您将要维护的应用程序)，通常会构建一个持续集成持续部署(CICD)管道。这是一组将应用程序交付到生产环境中的自动化步骤。</p><p id="854d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有许多关于CICD最佳实践的文档。我推荐我在<a class="ae kf" href="https://blog.angularindepth.com/deploying-an-angular-site-to-firebase-with-circleci-ed881cb6a2fa" rel="noopener ugc nofollow" target="_blank">发表的关于使用Firebase和CircleCI </a>部署应用程序的有角度的深度博文。</p><p id="bce2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于我们的API，我们对实际的部署步骤感兴趣。Firebase CLI会用一个<code class="fe ls lt lu lv b">firebase deploy</code>为您解决这个问题。</p><p id="10fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您运行<code class="fe ls lt lu lv b">firebase init</code>命令最初构建项目时，Firebase CLI已经将部署步骤设置为npm脚本。我们现在可以使用<code class="fe ls lt lu lv b">functions</code>文件夹中的<code class="fe ls lt lu lv b">npm run deploy</code>来部署创建的项目。</p><p id="2318" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">npm脚本非常强大。大多数现代JavaScript应用程序都以这样或那样的方式使用它们。我建议查看<a class="ae kf" href="https://docs.npmjs.com/misc/scripts" rel="noopener ugc nofollow" target="_blank"> npm文档以了解更多</a>。</p><p id="6ade" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当你从<code class="fe ls lt lu lv b">functions</code>文件夹中运行<code class="fe ls lt lu lv b">npm run deploy</code>时，你应该会看到如下输出:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/7740a075f6195cf94d1ce611c17d70e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SgouN8ObnBgXmhjO"/></div></figure><p id="7402" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">终端输出的行<code class="fe ls lt lu lv b">Function URL</code>提供了您部署的函数的端点。回到Postman集合，查看<code class="fe ls lt lu lv b">deployed</code>文件夹，找到一组请求来访问您部署的API。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8520" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">连接前端</h1><p id="1fff" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">现在我们已经构建了API，我想展示一下如果您在客户端应用程序中使用它会是什么样子。</p><p id="e377" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当讨论API时，通常会有生产者和消费者。生产者是API本身(或者至少是提供端点的东西)。消费者是使用这些端点的任何东西。通常，应用程序开发人员会使用JavaScript框架构建客户端应用程序，如<a class="ae kf" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>、<a class="ae kf" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>、<a class="ae kf" href="https://emberjs.com/" rel="noopener ugc nofollow" target="_blank"> Ember.js </a>、<a class="ae kf" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue.js </a>等。</p><p id="c9c5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">客户端应用程序在浏览器中运行，支持动态解释JavaScript代码。这特别有用，因为很多时候开发人员需要某个地方来静态托管他们的JavaScript包。</p><p id="ca90" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这利用了JavaScript语言以及当今浏览器的许多进步。</p><p id="67a8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你还记得第一部分，我们正在使用我放在这个GitHub repo上的代码。这个GitHub项目既有我们的后端API代码，也有我构建的用于与API交互的前端Angular应用程序。</p><p id="0aa7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">基本应用程序由一个主页组成，被认为是一个<em class="ng">单页应用程序</em> (SPA)。应用程序对列表项进行基本的CRUD操作。</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/00f63c0ea12c69c6280259f2392dd3ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2HUhXuwVfZZm2x2A"/></div></figure><p id="744f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行应用程序时，您还可以在浏览器的控制台中看到它的运行。如果您打开控制台(如果您使用Chrome，请右键单击“inspect”)，您应该会看到以下内容:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/d8dcb803e8c4452268217c53b8917177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IodAbz-Sfw0W3j8P"/></div></figure><p id="a24a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用我构建的客户端，首先<code class="fe ls lt lu lv b">cd</code>进入我的<a class="ae kf" href="https://github.com/andrewevans0102/how-to-build-a-firebase-api" rel="noopener ugc nofollow" target="_blank"> GitHub项目</a>的<code class="fe ls lt lu lv b">frontend</code>文件夹。</p><p id="7ca0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要让应用程序在您部署的API的端点上运行，您只需要打开<code class="fe ls lt lu lv b">/frontend/src/environments/environment.ts</code>文件。</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi og"><img src="../Images/5bc1959664e499015cd16874a8ed6e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/0*pGk8NiipJx1b2bg0"/></div></figure><p id="6b4d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个文件中，您将看到一组端点。要使用我构建的客户端，首先将<code class="fe ls lt lu lv b">cd</code>放入我的GitHub项目的<code class="fe ls lt lu lv b">frontend</code>文件夹。</p><p id="6f69" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使应用程序在您部署的API的端点上运行，您只需要更改这些值来匹配您项目中的URL。</p><p id="21fe" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您还记得，一旦您部署了API，Firebase CLI就会向终端输出一个域。托管端点术语非常直观，如下所示:</p><pre class="np nq nr ns gt nv lv nw nx aw ny bi"><span id="4180" class="nz me it lv b gy oa ob l oc od">[&lt;----zone + app id + cloudfunctions.net-----&gt;]/app/[&lt;--endpoint--&gt;]<br/>https://us-central1-fir-api-9a206.cloudfunctions.net/app/hello-world</span></pre><p id="a890" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">继续用您项目中的端点值替换这个<code class="fe ls lt lu lv b">environments</code>文件中的端点值。记住总是分别用相关路径如<code class="fe ls lt lu lv b">/api/create</code>或<code class="fe ls lt lu lv b">/api/read</code>结束每个端点。</p><p id="0f51" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦您替换了值，将<code class="fe ls lt lu lv b">cd</code>放入<code class="fe ls lt lu lv b">frontend</code>目录，并运行标准的<code class="fe ls lt lu lv b">npm install</code>来安装依赖项。依赖项安装完成后，使用Angular CLI命令通过<code class="fe ls lt lu lv b">ng serve</code>启动应用程序。</p><p id="c5c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您在使用CLI时遇到错误，请查阅<a class="ae kf" href="https://cli.angular.io/" rel="noopener ugc nofollow" target="_blank">Angular CLI文档。</a></p><p id="0f75" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行<code class="fe ls lt lu lv b">ng serve</code>后，您应该在终端中看到如下内容:</p><figure class="np nq nr ns gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b62592d680bc9e9f6ecddbf0457b176a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PMjCHHeuDI6fVnp9"/></div></figure><p id="d776" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此消息意味着CLI已经构建了应用程序(使用<a class="ae kf" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> webpack </a>),并且它当前正在端口4200上运行。如果您打开浏览器并转到<code class="fe ls lt lu lv b">localhost:4200</code>，您应该会看到应用程序正在运行。</p><p id="27f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您查看项目的app组件，您会看到这些动作只是从我们创建的API对端点进行JavaScript <code class="fe ls lt lu lv b">fetch</code>调用:</p><figure class="np nq nr ns gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="347d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为这篇文章的重点是创建API，所以我不会详细介绍这个Angular应用程序是如何工作的。我强烈推荐你查看一下<a class="ae kf" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank">角度文档</a>和可用的教程。</p><p id="40d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你在谷歌上搜索一下，你会发现很多关于角度基础的很棒的<em class="ng">入门</em>帖子。我也强烈推荐博客<a class="ae kf" href="https://blog.angularindepth.com/" rel="noopener ugc nofollow" target="_blank"> Angular In Depth </a>进行更深入的学习。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="e99a" class="md me it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">结束语</h1><figure class="np nq nr ns gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/cc57d1dd913c214967210f90a67f3ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y5HQOFeSS3tw6kCY"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="3a35" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">恭喜你！您刚刚使用Firebase部署了一个API。使用这个API，您还可以做很多其他的事情，但是这里只向您展示了基本的东西。</p><p id="4a3f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我展示的客户端应用程序让您开始了解使用API的方法。我强烈建议查看Express.js站点教程，以获得路由呼叫和使用中间件的更深入的方法。我还推荐我在Firebase上的其他博客帖子:</p><ul class=""><li id="6bbe" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nn lk ll lm bi translated"><a class="ae kf" href="https://rhythmandbinary.com/2018/04/08/firebase/" rel="noopener ugc nofollow" target="_blank">燃烧基地</a></li><li id="f847" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><a class="ae kf" href="https://blog.angularindepth.com/why-firebase-cloud-functions-are-awesome-f4faeab630f7" rel="noopener ugc nofollow" target="_blank">为什么Firebase云功能很棒</a></li><li id="b3fe" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><a class="ae kf" href="https://blog.angularindepth.com/how-the-angular-fire-library-makes-firebase-feel-like-magic-1fda375966bb" rel="noopener ugc nofollow" target="_blank">angular fire库如何让Firebase感觉像魔术一样</a></li><li id="1c7e" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nn lk ll lm bi translated"><a class="ae kf" href="https://blog.angularindepth.com/why-building-with-a-jamstack-is-awesome-49618fd21198" rel="noopener ugc nofollow" target="_blank">为什么用JAMstack构建很棒</a></li></ul><p id="2ade" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望我在这里的帖子已经帮助你开始用Firebase构建API。</p></div></div>    
</body>
</html>