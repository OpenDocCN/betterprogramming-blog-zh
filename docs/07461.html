<html>
<head>
<title>Micro Frontends Using Webpack 5 Module Federation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Webpack 5模块联合的微前端</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/micro-frontends-using-webpack-5-module-federation-3b97ffb22a0d?source=collection_archive---------1-----------------------#2021-01-18">https://betterprogramming.pub/micro-frontends-using-webpack-5-module-federation-3b97ffb22a0d?source=collection_archive---------1-----------------------#2021-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="354b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">针对微前端的Webpack 5模块联合的深入指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/37b919feb95d1415495e8d05023a61a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bkwV8Yf0OZAeqxPFCd05PQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><p id="f366" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Webpack是一个成熟的静态模块捆绑器，适用于现代JavaScript应用程序。它在GitHub上有超过57k颗星，每周从<a class="ae lu" href="https://medium.com/better-programming/the-step-by-step-guide-to-understanding-and-adopting-npm-7-914504f7090f" rel="noopener"> npm </a>注册表下载超过1300万次。它于2020年10月10日发布了第5版，带来了多项变化:</p><ul class=""><li id="147d" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">通过持久缓存提高构建性能。</li><li id="9ce1" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">通过更好的算法和默认值改进了长期缓存。</li><li id="529a" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">通过更好的树抖动和代码生成改进了包的大小。</li></ul><p id="a4f5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最重要的是，Webpack 5有一个新特性，<a class="ae lu" href="https://webpack.js.org/concepts/module-federation/" rel="noopener ugc nofollow" target="_blank">模块联合</a>，它允许多个Webpack构建一起工作。一个应用程序可以在客户机和服务器上动态运行来自另一个包或构建的代码。这是<a class="ae lu" href="https://medium.com/better-programming/10-decision-points-for-micro-frontends-approach-4ebb4b59f40" rel="noopener">微前端</a>的基础。</p><p id="4189" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每个webpack构建都可以是一个主机，主机是加载其他构建的容器。它也可以作为一个远程，这是一个微前端加载。每个应用程序都可以是一个远程主机，也可以是系统中任何其他联合模块的消费者。双向主机，甚至全向主机，都可以通过webpack配置轻松设置。</p><p id="c7e8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，模块联合不需要加载主入口点或另一个完整的应用程序。它只需要加载所需的代码，即几千字节的代码<strong class="la iu">。</strong>这种方法适用于任何JavaScript代码，无需共享实用程序和组件的冗余包。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="426e" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">模块联合示例</h1><p id="396f" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">Webpack以其复杂性和陡峭的学习曲线而闻名。这是<a class="ae lu" href="https://webpack.js.org/concepts/module-federation/" rel="noopener ugc nofollow" target="_blank">官网</a>在说模块联邦。</p><p id="1d1f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这一页并不长，但我们花了一些时间来理解这些概念。</p><p id="e0aa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">幸运的是，webpack还提供了很多例子，比如<a class="ae lu" href="https://github.com/module-federation/module-federation-examples" rel="noopener ugc nofollow" target="_blank">模块联合范例库</a>，它展示了如何使用模块联合。我们将仔细看看<a class="ae lu" href="https://github.com/module-federation/module-federation-examples/blob/master/basic-host-remote/README.md" rel="noopener ugc nofollow" target="_blank">基本单向示例</a>来理解概念和关键插件<code class="fe nn no np nq b">ModuleFederationPlugin</code>。Webpack应用插件来配置功能。</p><p id="2a8a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些示例可以通过以下命令安装:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="e9a7" class="nv mr it nq b gy nw nx l ny nz">git clone https://github.com/module-federation/module-federation-examples.git</span></pre><p id="3c9f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有20多个例子，涵盖了用React、Angular和Vue编写的应用程序。</p><p id="a685" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">基本单向示例位于<code class="fe nn no np nq b">module-federation-examples/basic-host-remote</code>。此示例显示了加载远程组件的基本宿主应用程序。</p><ul class=""><li id="e081" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><code class="fe nn no np nq b">app1</code>是一个主机应用程序，它从远程应用程序<code class="fe nn no np nq b">app2</code>加载<code class="fe nn no np nq b">Button</code>组件。</li><li id="7d55" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><code class="fe nn no np nq b">app2</code>是一个远程独立应用程序，它公开了<code class="fe nn no np nq b">Button</code>组件。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/6e66245c20cbd97fd6ce0c6fd5c1b5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*Ywykci5V46VwQxcHpKfoPw.png"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="21b4" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">模块文件夹</h1><p id="d169" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">局部模块是普通模块，是当前版本的一部分。远程模块是不属于当前构建的模块，它在运行时从所谓的容器中加载。</p><p id="7de7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个简单的例子中，<code class="fe nn no np nq b">app1</code>是一个普通模块，<code class="fe nn no np nq b">app2</code>是一个远程模块。以下是文件夹结构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/86396e6a058288794fa4459af339d278.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*o1XgonVFvhh4Ws8kLPaZzg.png"/></div></figure><p id="8482" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nn no np nq b">app1</code>和<code class="fe nn no np nq b">app2</code>几乎相同，除了<code class="fe nn no np nq b">app2</code>有<code class="fe nn no np nq b">src/Button.js</code>。该文件将在<code class="fe nn no np nq b">app2</code>中作为本地按钮使用，并在<code class="fe nn no np nq b">app1</code>中作为远程按钮加载。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="5220" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">模块代码</h1><p id="5c5c" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">我们将逐一检查<code class="fe nn no np nq b">app1</code>和<code class="fe nn no np nq b">app2</code>中的模块代码。</p><h2 id="8dd5" class="nv mr it bd ms oc od dn mw oe of dp na lh og oh nc ll oi oj ne lp ok ol ng om bi translated">src/App.js</h2><p id="6b7a" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated"><code class="fe nn no np nq b">src/App.js</code>是呈现两个标题和一个按钮的React代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/bf5dd63c148ac3a32ccc3c433225a267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rJa86z1Kr21TiGQtRSlENw.png"/></div></div></figure><p id="0f98" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">左侧(<code class="fe nn no np nq b">app1</code>)动态加载第3行的remote按钮，该按钮在第9–11行的<code class="fe nn no np nq b">&lt;Suspense&gt;</code>中包装。</p><p id="e13d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">右侧(<code class="fe nn no np nq b">app2</code>)静态加载第1行的本地按钮，放在第8行。</p><h2 id="bdfd" class="nv mr it bd ms oc od dn mw oe of dp na lh og oh nc ll oi oj ne lp ok ol ng om bi translated">src/boots . js</h2><p id="f760" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">这是<code class="fe nn no np nq b">src/bootstrap.js</code>，与<code class="fe nn no np nq b">app1</code>和<code class="fe nn no np nq b">app2</code>相同。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="e108" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第5行将<code class="fe nn no np nq b">App</code>呈现给id为<code class="fe nn no np nq b">root</code>的元素。</p><h2 id="2e85" class="nv mr it bd ms oc od dn mw oe of dp na lh og oh nc ll oi oj ne lp ok ol ng om bi translated">src/index.js</h2><p id="45b6" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">这是<code class="fe nn no np nq b">src/index.js</code>，它调用<code class="fe nn no np nq b">bootstrap</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/b7caa0d78a086d822da4919126b3d5f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Ntxd0ga9UXdzzkVY76-Ug.png"/></div></div></figure><p id="fcb2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">左侧(<code class="fe nn no np nq b">app1</code>)静态导入第1行的代码，并在第2行执行。</p><p id="565d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">右侧(<code class="fe nn no np nq b">app2</code>)动态导入<code class="fe nn no np nq b">bootstrap</code>代码。</p><p id="6118" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">两种方式的工作原理相似；它们<a class="ae lu" href="https://webpack.js.org/concepts/module-federation/#troubleshooting" rel="noopener ugc nofollow" target="_blank">异步加载初始块</a>中的共享模块。</p><p id="64dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe nn no np nq b">app2</code>中使用<a class="ae lu" href="https://medium.com/better-programming/dynamic-import-code-splitting-lazy-loading-and-error-boundaries-fff57e63f6c4" rel="noopener">动态导入</a>方式更容易。</p><p id="faf6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了使<code class="fe nn no np nq b">app1</code>中的方法起作用，它需要三个步骤:</p><ol class=""><li id="d361" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt or mb mc md bi translated">配置<code class="fe nn no np nq b">webpack.config.js</code>中的规则，以便在需要包时请求块。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="7a92" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.进行<code class="fe nn no np nq b">bootstrap()</code>调用，它将一直等到块可用。</p><h2 id="2822" class="nv mr it bd ms oc od dn mw oe of dp na lh og oh nc ll oi oj ne lp ok ol ng om bi translated">src/Button.js</h2><p id="f809" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated"><code class="fe nn no np nq b">src/Button.js</code>仅存在于<code class="fe nn no np nq b">app2</code>中，由<code class="fe nn no np nq b">app1</code>和<code class="fe nn no np nq b">app2</code>共同使用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="e8af" class="nv mr it bd ms oc od dn mw oe of dp na lh og oh nc ll oi oj ne lp ok ol ng om bi translated">public/index.html</h2><p id="5bf1" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">这是<code class="fe nn no np nq b">public/index.html</code>，对于<code class="fe nn no np nq b">app1</code>和<code class="fe nn no np nq b">app2</code>是一样的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="ab24" class="nv mr it bd ms oc od dn mw oe of dp na lh og oh nc ll oi oj ne lp ok ol ng om bi translated">src/package.json</h2><p id="74e2" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">这是<code class="fe nn no np nq b">src/package.json</code>，它为模块配置包。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/72560d665ee529bc5e97ca2018974def.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zr6WfcrhoLRGdwtriirGbA.png"/></div></div></figure><p id="eec5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">左侧(<code class="fe nn no np nq b">app1</code> ) <code class="fe nn no np nq b">devDependencies</code>包括第9行的<code class="fe nn no np nq b">bundle-loader</code>。</p><p id="97cb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">左侧(<code class="fe nn no np nq b">app1</code>)在端口3001运行生产构建(第19行)。</p><p id="addb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">右侧(<code class="fe nn no np nq b">app2</code>)在端口3002运行生产构建(第18行)。</p><p id="a55a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">双方都将React版本设置为<code class="fe nn no np nq b">^16.13.0</code>。</p><h2 id="e6eb" class="nv mr it bd ms oc od dn mw oe of dp na lh og oh nc ll oi oj ne lp ok ol ng om bi translated">src/webpack.config.js</h2><p id="8ced" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">这是<code class="fe nn no np nq b">src/webpack.config.js</code>，包含模块联合的关键配置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/de6e871c6339f2ad04f603a8441bcf45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDtZZwnGJDROrVCAeqTavw.png"/></div></div></figure><p id="e8b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">双方在第6行将<code class="fe nn no np nq b">entry</code>定义为<code class="fe nn no np nq b">./src/index</code>。</p><p id="bc70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">左侧(<code class="fe nn no np nq b">app1</code>)在端口3001启动dev服务器(第10行)。</p><p id="eae2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">右侧(<code class="fe nn no np nq b">app2</code>)在端口3002启动dev服务器(第10行)。</p><p id="524e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">左侧(<code class="fe nn no np nq b">app1</code>)为<code class="fe nn no np nq b">bootstrap.js </code>配置<code class="fe nn no np nq b">bundle-loader</code>规则(第17-23行)。<code class="fe nn no np nq b">app2</code>不需要这个。</p><p id="8bf4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">左侧(<code class="fe nn no np nq b">app1</code>)配置如何加载远程组件(第34–49行)。关键插件是<code class="fe nn no np nq b">ModuleFederationPlugin</code>，它将以下设置定义为主机app:</p><ul class=""><li id="4f9c" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><code class="fe nn no np nq b">name</code>:定义容器名<code class="fe nn no np nq b">app1</code>。</li><li id="6f11" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><code class="fe nn no np nq b">remotes</code>:定义<code class="fe nn no np nq b">app2@http://localhost:3002/remoteEntry.js</code>上的远程app<code class="fe nn no np nq b">app2</code>。</li><li id="a309" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><code class="fe nn no np nq b">shared</code>:定义模块在共享范围内如何共享。这里的模块是<code class="fe nn no np nq b">react</code>和<code class="fe nn no np nq b">react-dom</code>。仅允许共享模块的单一版本(<code class="fe nn no np nq b">{ singleton: false }</code>)。</li></ul><p id="38a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">右侧(<code class="fe nn no np nq b">app2</code>)配置如何暴露远程组件(第27–44行)。关键插件是<code class="fe nn no np nq b">ModuleFederationPlugin</code>，它将以下设置定义为远程应用:</p><ul class=""><li id="54b7" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><code class="fe nn no np nq b">name</code>:定义了容器名<code class="fe nn no np nq b">app2</code>。</li><li id="050f" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><code class="fe nn no np nq b">library.type</code>:定义库类型，<code class="fe nn no np nq b">var</code>。可用选项有<code class="fe nn no np nq b">var</code>、<code class="fe nn no np nq b">module</code>、<code class="fe nn no np nq b">assign</code>、<code class="fe nn no np nq b">this</code>、<code class="fe nn no np nq b">window</code>、<code class="fe nn no np nq b">self</code>、<code class="fe nn no np nq b">global</code>、<code class="fe nn no np nq b">commonjs</code>、<code class="fe nn no np nq b">commonjs2</code>、<code class="fe nn no np nq b">commonjs-module</code>、<code class="fe nn no np nq b">amd</code>、<code class="fe nn no np nq b">amd-require</code>、<code class="fe nn no np nq b">umd</code>、<code class="fe nn no np nq b">umd2</code>、<code class="fe nn no np nq b">jsonp</code>、<code class="fe nn no np nq b">system</code>。</li><li id="c000" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><code class="fe nn no np nq b">library.name</code>:定义了库名<code class="fe nn no np nq b">app2</code>。</li><li id="b828" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><code class="fe nn no np nq b">filename</code>:使用<code class="fe nn no np nq b">output.path</code>目录内的相对路径定义暴露的文件名<code class="fe nn no np nq b">remoteEntry.js</code>。</li><li id="04d7" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><code class="fe nn no np nq b">exposes</code>:定义要暴露的模块。<code class="fe nn no np nq b">app2</code>从<code class="fe nn no np nq b">./src/Button</code>曝光<code class="fe nn no np nq b">./Button</code>。</li><li id="6629" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><code class="fe nn no np nq b">shared</code>:定义模块在共享范围内如何共享。这里的模块是<code class="fe nn no np nq b">react</code>和<code class="fe nn no np nq b">react-dom</code>。只允许共享模块的单一版本(<code class="fe nn no np nq b">{ singleton: false }</code>)。</li></ul><p id="fd79" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是<code class="fe nn no np nq b">SharedConfig</code>的界面:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8ef8" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">运行基本单向示例</h1><p id="3d8f" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">我们已经检查了所有的文件。让我们运行它。</p><ul class=""><li id="b0c0" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">第一步:在<code class="fe nn no np nq b">module-federation-examples/basic-host-remote/app2</code>目录下，执行<code class="fe nn no np nq b">npm start</code>。在<code class="fe nn no np nq b">http://localhost:3002</code>处验证其是否开启。</li><li id="77b5" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">第二步:在<code class="fe nn no np nq b">module-federation-examples/basic-host-remote/app1</code>目录下，执行<code class="fe nn no np nq b">npm start</code>。在<code class="fe nn no np nq b">http://localhost:3001</code>处验证其是否开启。</li></ul><p id="5b33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能想知道为什么我们先开始<code class="fe nn no np nq b">app2</code>。是因为<code class="fe nn no np nq b">app1</code>依赖于<code class="fe nn no np nq b">app2</code>。</p><p id="19b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们先开始<code class="fe nn no np nq b">app1</code>呢？</p><p id="d00b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将在<code class="fe nn no np nq b">http://localhost:3001.</code>上看到以下错误</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="e31f" class="nv mr it nq b gy nw nx l ny nz">Uncaught (in promise) TypeError: react__WEBPACK_IMPORTED_MODULE_0___default(...).lazy is not a function<br/>    at eval (App.js:8)<br/>    at Module../src/App.js (node_modules_babel-loader_lib_index_js_ruleSet_1_rules_1_src_bootstrap_js.js:22)<br/>    at __webpack_require__ (main.js:514)<br/>    at eval (bootstrap.js?./node_modules/babel-loader/lib/index.js??ruleSet[1].rules[1]:6)<br/>    at Module../node_modules/babel-loader/lib/index.js??ruleSet[1].rules[1]!./src/bootstrap.js (node_modules_babel-loader_lib_index_js_ruleSet_1_rules_1_src_bootstrap_js.js:36)<br/>    at __webpack_require__ (main.js:514)<br/>    at eval (bootstrap.js:3)</span></pre><p id="4205" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗯，它还是可以修复的。在<code class="fe nn no np nq b">app2</code>开始后，我们需要刷新<code class="fe nn no np nq b">http://localhost:3001</code>。这是双向模块的工作方式:启动两个应用程序，然后访问网页。</p><p id="336c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如所料，基本单向示例显示了加载远程组件的基本宿主应用程序。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="f814" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">基本示例变化</h1><p id="d7cc" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">对于基本示例，<code class="fe nn no np nq b">app1</code>和<code class="fe nn no np nq b">app2</code>都使用React <code class="fe nn no np nq b">^16.13.0</code>。我们将<code class="fe nn no np nq b">app1</code>改为使用React <code class="fe nn no np nq b">16.5.0</code>，它不支持延迟加载。<code class="fe nn no np nq b">app2</code>改为反应<code class="fe nn no np nq b">17.0.1</code>。这些变化是在<code class="fe nn no np nq b">src/package.json</code>中做出的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/abea5a99973cc1ed584ad9620a78a079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asbqRbBFkEhEHzi-uAEE-A.png"/></div></div></figure><p id="5613" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">React <code class="fe nn no np nq b">16.5.0</code>也不支持钩子。为了更有趣，我们还在<code class="fe nn no np nq b">src/Button.js</code>中加了一个钩子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="b77c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然<code class="fe nn no np nq b">app1</code>的React <code class="fe nn no np nq b">16.5.0</code>不支持延迟加载和钩子，但它能正确显示<code class="fe nn no np nq b">app2</code>的钩子按钮。单击该按钮时，该值会增加。这两个应用程序独立工作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/743cdb690ee70402c28445310a96f7ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*WGYoNz2ARSrsdA2XLOAtZg.png"/></div></figure><p id="1905" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为<code class="fe nn no np nq b">app1</code>使用了来自<code class="fe nn no np nq b">app2</code>的编译代码，所以这个例子是可行的。但是，控制台上有一个警告:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="ae90" class="nv mr it nq b gy nw nx l ny nz">Unsatisfied version 17.0.1 of shared singleton module react-dom (required =16.5.0)</span></pre><p id="2e20" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们在<code class="fe nn no np nq b">src/webpack.config.js</code>中改变两个应用的<code class="fe nn no np nq b">shared</code>设置会怎么样？</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="a642" class="nv mr it nq b gy nw nx l ny nz">shared: {<br/>  react: { singleton: false },<br/>  "react-dom": { singleton: false },<br/>}</span></pre><p id="0520" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">重启两个应用程序，<code class="fe nn no np nq b">app1</code>在<code class="fe nn no np nq b">http://localhost:3001</code>崩溃:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="851d" class="nv mr it nq b gy nw nx l ny nz">Uncaught (in promise) TypeError: react__WEBPACK_IMPORTED_MODULE_0___default(...).lazy is not a function<br/>    at eval (App.js:8)<br/>    at Module../src/App.js (node_modules_babel-loader_lib_index_js_ruleSet_1_rules_1_src_bootstrap_js.js:22)<br/>    at __webpack_require__ (main.js:514)<br/>    at eval (bootstrap.js?./node_modules/babel-loader/lib/index.js??ruleSet[1].rules[1]:6)<br/>    at Module../node_modules/babel-loader/lib/index.js??ruleSet[1].rules[1]!./src/bootstrap.js (node_modules_babel-loader_lib_index_js_ruleSet_1_rules_1_src_bootstrap_js.js:36)<br/>    at __webpack_require__ (main.js:514)<br/>    at eval (bootstrap.js:3)</span></pre><p id="ca23" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们把<code class="fe nn no np nq b">app1</code>改成使用React <code class="fe nn no np nq b">16.6.0</code>，支持延迟加载，会怎么样？</p><p id="3c18" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">重启<code class="fe nn no np nq b">app1</code>，不抛出懒加载错误。相反，它在钩子调用时抛出一个错误:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="4a32" class="nv mr it nq b gy nw nx l ny nz">Uncaught Error: Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:<br/>1. You might have mismatching versions of React and the renderer (such as React DOM)<br/>2. You might be breaking the Rules of Hooks<br/>3. You might have more than one copy of React in the same app<br/>See <a class="ae lu" href="https://reactjs.org/link/invalid-hook-call" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/link/invalid-hook-call</a> for tips about how to debug and fix this problem.<br/>    at resolveDispatcher (react.development.js:1476)<br/>    at useState (react.development.js:1507)<br/>    at Button (Button.js:10)<br/>    at updateFunctionComponent (react-dom.development.js:13644)<br/>    at mountLazyComponent (react-dom.development.js:13903)<br/>    at beginWork (react-dom.development.js:14475)<br/>    at performUnitOfWork (react-dom.development.js:17014)<br/>    at workLoop (react-dom.development.js:17054)<br/>    at HTMLUnknownElement.callCallback (react-dom.development.js:149)<br/>    at Object.invokeGuardedCallbackDev (react-dom.development.js:199)</span></pre><p id="5b8b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们把<code class="fe nn no np nq b">app1</code>换成支持钩子的React <code class="fe nn no np nq b">16.8.0</code>会怎么样？</p><p id="3d7e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">重启<code class="fe nn no np nq b">app1</code>，抛出同样的错误。</p><p id="e19e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们把<code class="fe nn no np nq b">app1</code>改成使用React <code class="fe nn no np nq b">17.0.1</code>会怎么样？</p><p id="3e08" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">重启<code class="fe nn no np nq b">app1</code>，无错误无警告。</p><p id="5313" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当<code class="fe nn no np nq b">package.json</code>或<code class="fe nn no np nq b">webpack.config.js</code>被修改时，建议重启应用程序。保持两个应用程序设置同步也是一个好主意。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="51ce" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="a322" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">凭借Webpack 5的强大功能和便利性，模块联合为微前端提供了一种有前途的方法。</p><p id="e852" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们对Webpack 5的模块联盟感到兴奋。你呢？</p><p id="b4e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢阅读。我希望这有所帮助。你可以在这里看到我的其他媒体出版物<a class="ae lu" href="https://medium.com/@jenniferfubook/jennifer-fus-web-development-publications-1a887e4454af" rel="noopener"/>。</p></div></div>    
</body>
</html>