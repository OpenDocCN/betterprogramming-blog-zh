<html>
<head>
<title>How to Measure Execution Time in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中测量执行时间</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-measure-execution-time-in-python-21004748535e?source=collection_archive---------9-----------------------#2020-05-06">https://betterprogramming.pub/how-to-measure-execution-time-in-python-21004748535e?source=collection_archive---------9-----------------------#2020-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9fac" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用Python内置的timeit模块来检查代码的性能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c5a78898ebceece1fbb02d26ec0c22f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UY0Lb4hg_n9689Mgj_ulgA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@aronvisuals?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Aron视觉效果</a>在<a class="ae ky" href="https://unsplash.com/s/photos/time?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="23d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读本文，您将了解如何在Python中测量代码的性能和执行时间。根据<a class="ae ky" href="https://docs.python.org/3/library/timeit.html" rel="noopener ugc nofollow" target="_blank">官方文件</a>,<code class="fe lv lw lx ly b">timeit</code>模块:</p><blockquote class="lz ma mb"><p id="549e" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated">“…提供了一种简单的方法来为小部分Python代码计时。它既有命令行界面，也有可调用界面。它避免了许多测量执行时间的常见陷阱。”</p></blockquote><p id="b727" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们进入下一部分，开始测试timeit模块。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="707f" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">命令行界面</h1><p id="0945" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated"><code class="fe lv lw lx ly b">timeit</code>有自己的命令行界面，允许我们测试一些简单的代码片段。让我们试着测量一个列表理解的执行时间:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="2128" class="no mo it ly b gy np nq l nr ns">python -m timeit "'-'.join([str(i) for i in range(100)])"</span></pre><p id="6f2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该得到以下输出。执行时间和循环次数可能因机器而异:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="cf9c" class="no mo it ly b gy np nq l nr ns">20000 loops, best of 5: 19.6 usec per loop</span></pre><p id="f238" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以指定以下选项:</p><ul class=""><li id="0192" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">-n</code>——处决人数</li><li id="8188" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">-r</code> —计时器的重复次数。默认值为五。</li><li id="24f5" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">-s</code> —最初将执行一次的初始语句。</li><li id="5108" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">-p</code> —设置为测量过程时间，而不是挂钟时间。</li><li id="631b" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">-u</code> —输出的时间单位。您可以选择nsec、usec、msec或sec。</li><li id="888a" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">-v</code> —打印原始计时结果。</li></ul><p id="da5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们尝试在同一语句中添加一些选项:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="2eb9" class="no mo it ly b gy np nq l nr ns">python -m timeit -n 20000 -u sec -v "'-'.join([str(i) for i in range(100)])"</span></pre><p id="61c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该在命令提示符下得到<code class="fe lv lw lx ly b">raw times</code>输出。根据您的机器，时间会有所不同。有五次，因为<code class="fe lv lw lx ly b">repeat</code>参数被默认为五次。</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="6d64" class="no mo it ly b gy np nq l nr ns">raw times: 0.395 sec, 0.392 sec, 0.383 sec, 0.384 sec, 0.383 sec</span></pre><p id="110e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您测试简单的代码片段时，命令行界面非常方便。如果您正在处理无法用几行代码表达的代码，强烈建议使用Python接口。</p><p id="d45d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续下一节，开始写一些Python代码。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="a788" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">Python界面</h1><h2 id="03ff" class="no mo it bd mp oh oi dn mt oj ok dp mx li ol om mz lm on oo nb lq op oq nd or bi translated">导入</h2><p id="3107" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">在Python文件的顶部添加以下导入声明:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="fbe2" class="no mo it ly b gy np nq l nr ns">import timeit</span></pre><h2 id="0339" class="no mo it bd mp oh oi dn mt oj ok dp mx li ol om mz lm on oo nb lq op oq nd or bi translated">时间</h2><p id="5f90" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">我们将使用<code class="fe lv lw lx ly b">timeit</code>函数复制之前测试过的相同代码片段。它接受以下输入参数:</p><ul class=""><li id="b0eb" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">stmt</code> —包含测试用例代码片段的字符串。</li><li id="e444" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">setup</code> —将被执行一次的初始代码。</li><li id="8f2b" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">timer</code> —计时器实例。它默认为<code class="fe lv lw lx ly b"> time.perf_counter()</code>，返回一个浮点数。</li><li id="f729" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">number</code> —要执行的执行次数。默认值为1，000，000。</li><li id="c34f" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated"><code class="fe lv lw lx ly b">globals</code> —指定在其中执行代码的名称空间。</li></ul><p id="2171" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数时候，您将只使用<code class="fe lv lw lx ly b">stmt</code>、<code class="fe lv lw lx ly b">setup</code>和<code class="fe lv lw lx ly b">number</code>参数。在Python文件中追加以下代码:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="1cc8" class="no mo it ly b gy np nq l nr ns">result = timeit.timeit("'-'.join([str(i) for i in range(100)])", number=20000)</span></pre><p id="cf08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，打印出结果:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="170b" class="no mo it ly b gy np nq l nr ns">print(result)</span></pre><p id="9eff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行它时，您应该会看到以下结果。根据您机器的规格，时间可能会有所不同:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="c866" class="no mo it ly b gy np nq l nr ns">0.4323697</span></pre><h2 id="225c" class="no mo it bd mp oh oi dn mt oj ok dp mx li ol om mz lm on oo nb lq op oq nd or bi translated">重复</h2><p id="78af" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">如果需要多次重复相同的测试，您可以使用<code class="fe lv lw lx ly b">repeat</code>功能。它接受与<code class="fe lv lw lx ly b">timeit</code>相同的参数，外加一个<code class="fe lv lw lx ly b">repeat</code>参数。默认值为五:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="5d41" class="no mo it ly b gy np nq l nr ns">result = timeit.repeat("'-'.join([str(i) for i in range(100)])", number=20000)</span><span id="0ac7" class="no mo it ly b gy os nq l nr ns">print(result)</span></pre><p id="2e60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行Python文件时，您应该会在控制台上看到一个不同小数的浮点数列表。</p><h2 id="fdaa" class="no mo it bd mp oh oi dn mt oj ok dp mx li ol om mz lm on oo nb lq op oq nd or bi translated">功能</h2><p id="01b7" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">如果您正在测试包含在一个函数中的代码，您可以将该函数包装在一个多块字符串中，并将其作为一个<code class="fe lv lw lx ly b">stmt</code>输入参数传递。但是，更好的解决方案是将其作为设置参数导入。让我们在函数中定义相同的代码片段:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="4051" class="no mo it ly b gy np nq l nr ns">def test():<br/>    return '-'.join([str(i) for i in range(100)])</span></pre><p id="24e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是从<code class="fe lv lw lx ly b">main</code>定义中导入它:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="2265" class="no mo it ly b gy np nq l nr ns">if __name__ == '__main__':<br/>    result = timeit.timeit("test()", setup="from __main__ import test", number=20000)</span><span id="b224" class="no mo it ly b gy os nq l nr ns">    print(result)</span></pre><p id="3369" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行它时，您应该得到大致相同的执行时间。这种解决方案的一个大问题是，如果存在多个函数，您将很难编写import语句。</p><h2 id="daf4" class="no mo it bd mp oh oi dn mt oj ok dp mx li ol om mz lm on oo nb lq op oq nd or bi translated">全局</h2><p id="e890" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">另一个选项是设置<code class="fe lv lw lx ly b">globals</code>名称空间，这将导致代码在当前的全局名称空间中执行。这个解决方案要方便得多，并且不会影响任何底层代码:</p><pre class="kj kk kl km gt nk ly nl nm aw nn bi"><span id="330a" class="no mo it ly b gy np nq l nr ns">result = timeit.timeit("test()", number=20000, globals=globals())<br/>print(result)</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="f8a7" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">结论</h1><p id="de46" class="pw-post-body-paragraph kz la it lb b lc nf ju le lf ng jx lh li nh lk ll lm ni lo lp lq nj ls lt lu im bi translated">让我们回顾一下你今天所学的内容。</p><p id="8b2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先简要解释了timeit模块提供的命令行界面。我们在一个简单的列表理解代码片段上测试了它。</p><p id="166c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们尝试了Python接口，它带有两个强大的内置函数:<code class="fe lv lw lx ly b">timeit</code>和<code class="fe lv lw lx ly b">repeat</code>。我们还探索了如何通过<code class="fe lv lw lx ly b">setup</code>或<code class="fe lv lw lx ly b">global</code>参数导入要执行的功能。</p><p id="5e9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读这篇文章。希望下一部能再见到你！</p></div></div>    
</body>
</html>