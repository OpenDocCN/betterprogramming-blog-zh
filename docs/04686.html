<html>
<head>
<title>How to Handle UIKit Gestures With Apple’s Combine Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用苹果的Combine框架处理UIKit手势</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/handling-uikit-gestures-in-combine-framework-2ebe1c0572fd?source=collection_archive---------13-----------------------#2020-04-29">https://betterprogramming.pub/handling-uikit-gestures-in-combine-framework-2ebe1c0572fd?source=collection_archive---------13-----------------------#2020-04-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8643" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Swift中的Combine创建您自己的手势发布器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/31e41f5146172e3afc4549790709ccb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BHGyC8bClyF7FzGd4Zf2Ew.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@jealousweekends?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">嫉妒周末</a>在<a class="ae ky" href="https://unsplash.com/s/photos/apple-laptop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="c8d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然您在这里，我希望您对Combine框架有一个基本的了解，并且可能也在编写它。</p><p id="e0a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">框架本身有很好的内置扩展，比如给关键路径赋值，但是没有响应<code class="fe lv lw lx ly b">UIGesture</code>事件的功能。我们可能会在以后的更新中看到它。在此之前，让我们现在就创建自己的自定义发布程序来处理手势事件。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="6205" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">创建自定义发布者</h1><p id="eed2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">首先，让我们通过遵循发布者协议来创建一个定制的发布者。发布者协议由两种相关类型组成，<code class="fe lv lw lx ly b">Output</code>和<code class="fe lv lw lx ly b">Failure</code>。</p><p id="a97c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">Output</code>代表它将产生的值的类型，而<code class="fe lv lw lx ly b">Failure</code>是它可能抛出的错误的类型。</p><p id="8149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了处理手势类型，首先，我们需要用手势发布者将识别的值创建一个enum <code class="fe lv lw lx ly b">GestureType</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/faf820a18a9c3edcdef93e1c38a1444e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dXYiBe4hU_PBBkuQflV6Rw.png"/></div></div></figure><p id="c93a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们将创建我们的自定义发布者。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/955d76ba9c1182c2d868c00a476d9d37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7ymHIg3SqxUbxwjxaqrXw.png"/></div></div></figure><p id="2dab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于输出将是<code class="fe lv lw lx ly b">GestureType</code>情况之一，我们将<code class="fe lv lw lx ly b">Output</code>设置为<code class="fe lv lw lx ly b">GestureType</code> <strong class="lb iu"> </strong>并将<code class="fe lv lw lx ly b">Failure</code>设置为<code class="fe lv lw lx ly b">Never</code>，因为它永远不会抛出错误。</p><h2 id="b919" class="nf mh it bd mi ng nh dn mm ni nj dp mq li nk nl ms lm nm nn mu lq no np mw nq bi translated">接收(订户:)</h2><p id="269d" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">将指定的订阅服务器附加到该发布服务器。</p><p id="1b71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为<code class="fe lv lw lx ly b">GesturePublisher</code>结构符合发布者协议，所以<code class="fe lv lw lx ly b">receive(subscribe:)</code>需要被实现。它基本上将指定的订阅者附加到发布者。</p><p id="fdcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们尚未创建要附加到此处的订阅，因此让我们创建一个订阅。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d549" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">创建自定义订阅</h1><p id="1c26" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">让我们创建一个符合订阅协议的类<code class="fe lv lw lx ly b">GestureSubscription</code>。</p><p id="9e58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">订阅协议继承自可取消协议，该协议为我们提供了用于处理订阅取消的<code class="fe lv lw lx ly b">cancel()</code>方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/0c8564764d9ce3947766ff672700de97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FU7VwLSEj6xh3HwrAJayPg.png"/></div></div></figure><p id="4fd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">Input</code>表示订阅将收到的值的类型，而<code class="fe lv lw lx ly b">Failure</code>是它可能抛出的错误的类型。</p><p id="635a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于发布者将值发送给下游订阅者，因此它的<code class="fe lv lw lx ly b">Output</code>类型必须与订阅者的<code class="fe lv lw lx ly b">Input</code>类型相匹配，<code class="fe lv lw lx ly b">Failure</code>也是如此。我们将<code class="fe lv lw lx ly b">Failure</code>设置为<code class="fe lv lw lx ly b">Never</code>，因为它永远不会抛出错误。</p><p id="b7a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">GestureSubscription</code>类必须符合订阅协议，该协议有两个必需的方法<code class="fe lv lw lx ly b">cancel()</code>和<code class="fe lv lw lx ly b">request(_ demand: Subscribers.Demand)</code>。</p><p id="56a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用<code class="fe lv lw lx ly b">cancel()</code> <strong class="lb iu"> </strong>方法来取消订阅，并将<code class="fe lv lw lx ly b">Subscriber</code>属性设置为零。</p><p id="80bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，既然我们的订阅已经创建，让我们将其实现到我们的自定义发布器<code class="fe lv lw lx ly b">GesturePublisher</code>中的<code class="fe lv lw lx ly b">receive(subscriber:)</code> <strong class="lb iu"> </strong>中。全面实施将是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/40e06b1e847e588a27d2b2844a0f678e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uo5vEdpLDyhAty71gPFwJQ.png"/></div></div></figure><p id="ad12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你运行这个项目，你会发现什么也没发生。这是因为由于我们没有真正处理用户手势，我们的订户还不能接收任何值。让我们解决这个问题。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="95e7" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">一个UIView扩展，可以方便地访问我们的自定义发布者</h1><p id="4605" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">让我们将一个方法放入一个<code class="fe lv lw lx ly b">UIView</code>扩展中，该扩展将创建一个定制的发布者，并使用所提供的手势类型将其与视图相关联。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/96ad4ffb34855683f8b2cfded1b28f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0gP3VheBtfB4ciMMFZmH7w.png"/></div></div></figure><p id="5fc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。我们现在处理手势，并使用提供的识别器定义一个特定的动作。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="0102" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated"><strong class="ak">例题</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/1e35d257e058a763adaec2be1eec7bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-4uECY4vn_v9hHsqdD_WQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/581c68fd273974ea7e57e369ea6be5d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bNOcHMTrpzEtluQ0EmAwbA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/5d9a67edff64051bb84e9936ad6f5085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LMc57wrO9qF_R-dFmMt_sw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/53dc59b41ff48feadb2d031305a6e00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1CQdmzDG1IQJugCrmfDHw.png"/></div></div></figure><p id="79e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些例子展示了如何在Combine中使用手势来执行动作。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b2b6" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="e862" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">自定义发布者可以向UIKit元素扩展更多的功能。</p><p id="30c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是一个简单的例子，说明我们可以在Combine中使用自定义发布程序做什么。许多样板代码可以删除，实现也可以简化，所有这些都是以一种被动的方式进行的。</p></div></div>    
</body>
</html>