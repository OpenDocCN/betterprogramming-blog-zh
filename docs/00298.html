<html>
<head>
<title>From XHR to Fetch With Async/Await on the Finish Line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从XHR到终点的异步/等待取货</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/from-xhr-to-fetch-with-async-await-on-the-finish-line-b021de1d226b?source=collection_archive---------0-----------------------#2019-03-03">https://betterprogramming.pub/from-xhr-to-fetch-with-async-await-on-the-finish-line-b021de1d226b?source=collection_archive---------0-----------------------#2019-03-03</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="6dd0" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">看看JavaScript中请求的发展和历史</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/a1d760ef32188cc47246bd023b28766a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ch3ONOcE_qMChYiaZV3ZFw.jpeg"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@grakozy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">格雷格·拉科齐</a>在<a class="ae kz" href="https://unsplash.com/s/photos/javascript-error?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="78fa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">距离我的上一篇文章已经有一段时间了。我一直忙于探索与我的技术相关的其他技能。但是现在是时候分享一些关于我最喜欢的语言的激动人心的事情了:JavaScript！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="c845" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">XMLHttpRequest同步</h2><p id="352f" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">在异步JavaScript出现之前很久，我们使用<code class="fe nb nc nd ne b">XMLHttpRequest</code> (XHR)调用API来获取数据，而无需刷新页面。</p><p id="95c0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">XHR是基于事件的。因此，当我们使用AJAX调用时，调用下面的所有代码都必须等待，直到我们从服务器获得响应(又名同步)。我们的JavaScript阻塞了所有其他代码。</p><p id="89ee" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果我们得到的不是我们期望的响应，而是一个错误，那么JavaScript中的错误就变得很大:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="a485" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在下面的例子中，您可以看到这个<code class="fe nb nc nd ne b">XMLHttpRequest</code>正在阻塞它下面的所有东西，直到从API返回一个成功的消息。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nh ng l"/></div></figure></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="c953" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">XMLHttpRequest异步</h2><p id="b467" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated">我们不希望我们的代码暂停，直到我们的响应从服务器返回。—我们只想在从服务器收到结果后返回。</p><p id="7c2c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">幸运的是，有一种方法可以通过<code class="fe nb nc nd ne b">async</code>参数使<code class="fe nb nc nd ne b">XMLHttpRequest</code>异步。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ni"><img src="../Images/994cbaf797375b50191dd88a9fabfacb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5-5F3NjazHwt1KBLNnggA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">XMLHttpRequest open方法的可能性<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/open" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/API/XMLHttpRequest/open</a></p></figure><p id="b425" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们通过将<code class="fe nb nc nd ne b">xhr.open(“GET”, url, false);</code>改为<code class="fe nb nc nd ne b">xhr.open(“GET”, url);</code>来做到这一点，因为如果我们跳过open方法中的最新参数，那么异步参数的值将为真。</p><p id="bdd7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在下一个示例的控制台中，您可以看到DOM操作的控制台日志排在第一位，因为XHR现在是异步的。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="d75f" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">Fetch:基于异步AJAX请求做出承诺</h2><p id="a15e" class="pw-post-body-paragraph la lb iu lc b ld mw jv lf lg mx jy li lj my ll lm ln mz lp lq lr na lt lu lv in bi translated"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank"> Fetch API </a>是XHR的新的、更强大的替代品——完全异步和基于承诺的。</p><pre class="kk kl km kn gu nj ne nk nl aw nm bi"><span id="76a9" class="md me iu ne b gz nn no l np nq">fetch('<a class="ae kz" href="http://example.com/movies.json'" rel="noopener ugc nofollow" target="_blank">http://example.com/movies.json'</a>)<br/>  .then(function(response) {<br/>    return response.json();<br/>  })<br/>  .then(function(myJson) {<br/>    console.log(JSON.stringify(myJson));<br/>  });</span></pre><p id="e534" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你问我，你可以读取更有意义，因为你可以按顺序读它采取的步骤。如果你想更详细地了解如何使用Fetch API，Mozilla有一个很好的资源。</p><p id="8a46" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在下面的例子中，您可以看到Fetch API以异步方式工作。首先，来自DOM更改的console.logs在控制台中是可见的。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="b4b1" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">Async/Await:异步AJAX以同步可读的方式调用</h2><pre class="kk kl km kn gu nj ne nk nl aw nm bi"><span id="e3a6" class="md me iu ne b gz nn no l np nq">(async () =&gt; {<br/>   const resp = await fetch("<a class="ae kz" href="https://api.github.com/users/github" rel="noopener ugc nofollow" target="_blank">https://api.github.com/users/github</a>");<br/>   const jsonData = await resp.json();<br/>   console.log("jsonData: ", jsonData);<br/>})();</span></pre><p id="2eea" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">要将<code class="fe nb nc nd ne b">await</code>与<code class="fe nb nc nd ne b">Fetch</code>一起使用，我们必须将其包装在一个<code class="fe nb nc nd ne b">async</code>函数中。在这种情况下，我们将它包装在一个IIFE中(<em class="nr">立即调用函数表达式</em>)。</p><p id="3a70" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当fetch第一次返回一个<code class="fe nb nc nd ne b">Promise</code>时，结果被放入<code class="fe nb nc nd ne b">const resp</code>中，因此下一个变量会一直等到fetch得到响应。只有当<code class="fe nb nc nd ne b">jsonData</code>变量得到数据时，控制台才输出数据。</p><p id="bd3a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所有这些的好处在于，用JavaScript处理异步AJAX请求不再那么困难。但是对你和你的团队来说，使用哪种方法很重要。</p><p id="8e59" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe nb nc nd ne b"><a class="ae kz" href="https://caniuse.com/#search=XMLHttpRequest" rel="noopener ugc nofollow" target="_blank">XMLHttpRequest</a></code>多年来一直被广泛使用和支持。<code class="fe nb nc nd ne b"><a class="ae kz" href="https://caniuse.com/#feat=fetch" rel="noopener ugc nofollow" target="_blank">Fetch</a></code> <a class="ae kz" href="https://caniuse.com/#feat=fetch" rel="noopener ugc nofollow" target="_blank"> API </a>也得到广泛支持，但如果要支持IE11，则需要考虑使用<code class="fe nb nc nd ne b">Babel</code>。</p><p id="7c76" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在所有现代浏览器中，对<a class="ae kz" href="https://caniuse.com/#feat=async-functions" rel="noopener ugc nofollow" target="_blank"> Async/Await的支持都很棒，但是对于IE11，你仍然需要使用<code class="fe nb nc nd ne b">Babel</code>来使用它进行开发。</a></p><p id="7cab" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">尽情体验异步JavaScript吧！一如既往，如果您有任何问题或需要帮助，请告诉我！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="7597" class="ns me iu bd mf nt nu nv mi nw nx ny ml ka nz kb mo kd oa ke mr kg ob kh mu oc bi translated">谢谢！</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj od"><img src="../Images/788dd57432ef08bda37f970c71ad90b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qay6DRNLz9jUR0UQ"/></div></figure><p id="17bd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">读完这个故事后，我希望你学到了一些新的东西，或者受到启发去创造一些新的东西！🤗</p><p id="3c89" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果我给你留下了问题或一些要说的话作为回应，向下滚动并给我键入一条消息。如果你想保密，请在Twitter @DevByRayRay 上给我发一条<a class="ae kz" href="https://twitter.com/@devbyrayray" rel="noopener ugc nofollow" target="_blank"> DM。我的DM永远是开放的😁</a></p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h2 id="0f33" class="md me iu bd mf mg mh dn mi mj mk dp ml lj mm mn mo ln mp mq mr lr ms mt mu mv bi translated">通过电子邮件获取我的文章点击这里 | <a class="ae kz" href="https://byrayray.medium.com/subscribe" rel="noopener">购买5美元的中级会员资格</a></h2></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="b869" class="ns me iu bd mf nt nu nv mi nw nx ny ml ka nz kb mo kd oa ke mr kg ob kh mu oc bi translated">阅读更多</h1><div class="oe of gq gs og"><div role="button" tabindex="0" class="ab bv gw cb fq oh oi bn oj kt ex"><div class="ok l"><div class="ab q"><div class="l di"><img alt="RayRay" class="l de bw ol om fe" src="../Images/992af170033696163d6cc0269218aedd.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*1fUwrIRcFq3paK71SLifMw.png"/><div class="fb bw l ol om fc n aw fd"/></div><div class="hi l fp"><p class="bd b dl z fq fr fs ft fu fv fw fx dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://byrayray.medium.com/?source=post_page-----b021de1d226b--------------------------------" rel="noopener follow" target="_top">射线射线</a></p></div></div><div class="op oq gx l"><h2 class="bd iv tu tv fq tw fs ft tx fv fx it bi translated">荒诞的故事</h2></div><div class="ab q"><div class="l fp"><a class="bd b be z bi ty au tz ua ub qj uc an eh ei ud ue uf el em eo de bk ep" href="https://byrayray.medium.com/list/angular-stories-24674407532a?source=post_page-----b021de1d226b--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ug l fp"><span class="bd b dl z dk">6 stories</span></div></div></div><div class="pc dh pd fq ab pe fp di"><div class="di ou bv ov ow"><div class="dh l"><img alt="" class="dh" src="../Images/b94f2b7d2929c90566cd2dd6f657a751.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*O_EKcNrJVWS18ZG-bP1FtA.png"/></div></div><div class="di ou bv ox oy oz"><div class="dh l"><img alt="" class="dh" src="../Images/02b73423a62d73b113af9fdf9629c79f.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*HWY53D51pJqJuCKUXFf_9g.jpeg"/></div></div><div class="di bv pa pb oz"><div class="dh l"><img alt="Stacked books" class="dh" src="../Images/b02a2f57c0093e04ab1d11d3a55f35ea.png" width="194" height="194" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*QhXyFtl1Xx_ptTw5"/></div></div></div></div></div><div class="oe of gq gs og"><div role="button" tabindex="0" class="ab bv gw cb fq oh oi bn oj kt ex"><div class="ok l"><div class="ab q"><div class="l di"><img alt="RayRay" class="l de bw ol om fe" src="../Images/992af170033696163d6cc0269218aedd.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*1fUwrIRcFq3paK71SLifMw.png"/><div class="fb bw l ol om fc n aw fd"/></div><div class="hi l fp"><p class="bd b dl z fq fr fs ft fu fv fw fx dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://byrayray.medium.com/?source=post_page-----b021de1d226b--------------------------------" rel="noopener follow" target="_top">雷雷</a></p></div></div><div class="op oq gx l"><h2 class="bd iv tu tv fq tw fs ft tx fv fx it bi translated">最新的JavaScript和TypeScript故事</h2></div><div class="ab q"><div class="l fp"><a class="bd b be z bi ty au tz ua ub qj uc an eh ei ud ue uf el em eo de bk ep" href="https://byrayray.medium.com/list/latest-javascript-typescript-stories-0358ad941491?source=post_page-----b021de1d226b--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ug l fp"><span class="bd b dl z dk">14 stories</span></div></div></div><div class="pc dh pd fq ab pe fp di"><div class="di ou bv ov ow"><div class="dh l"><img alt="" class="dh" src="../Images/c93ca03b33796c40dcc47873de2697c2.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*UQtuHklwRW4uxOcO"/></div></div><div class="di ou bv ox oy oz"><div class="dh l"><img alt="" class="dh" src="../Images/86f37efa11855f6f0f0f62984c37f696.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*gHDsISflc1mS_IJIuGZMUQ.png"/></div></div><div class="di bv pa pb oz"><div class="dh l"><img alt="" class="dh" src="../Images/ddbaa6d0bea676316247e82043d60b63.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*KJ9azc_7b1b_8tKn"/></div></div></div></div></div></div></div>    
</body>
</html>