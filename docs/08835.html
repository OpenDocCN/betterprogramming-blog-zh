<html>
<head>
<title>How To Expel Files From an FTP Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从FTP服务器中驱逐文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-expel-files-from-an-ftp-server-45127966fb0b?source=collection_archive---------12-----------------------#2021-06-16">https://betterprogramming.pub/how-to-expel-files-from-an-ftp-server-45127966fb0b?source=collection_archive---------12-----------------------#2021-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7bc6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它会像我们最喜欢的巫师咒语一样神奇</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d2401b353283e000980b62bbcac5a89c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-s-DbaLQLK8bhXzf"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@louisesmithphotos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">路易丝·史密斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="f18e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于房间里所有的恐龙，我不会解释什么是文件传输协议(FTP)。但是对于不熟悉这个协议的人，我推荐先阅读<a class="ae ky" href="https://source.raysync.io/news/what-is-file-transfer-protocol" rel="noopener ugc nofollow" target="_blank">这篇文章</a>。</p><p id="a651" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们面对现实:FTP仍然被广泛使用，主要是因为它仍然是一种简单可靠的存储文件的方式。以下是一些使用案例:</p><ul class=""><li id="d457" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">存储图像并将它们的URL暴露给API。</li><li id="5ae3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">出于恢复目的存档文件。</li><li id="88a2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在任何客户端上安装可执行文件(例如Android APK文件)。</li></ul><p id="e496" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将重点关注上传部分。当然，我们中的大多数人会选择简单的方法，使用免费的GUI，如<a class="ae ky" href="https://source.raysync.io/news/what-is-file-transfer-protocol" rel="noopener ugc nofollow" target="_blank"> Cyberduck </a>。但在某些情况下，如果您需要定期上传相同的文件，这可能会变得繁琐和耗时。</p><p id="92be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我向您展示如何通过一个命令行神奇地实现这一点。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="9ab1" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">Shell脚本的魔力</h1><p id="6712" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">为了保持旧式技术，我们将构建一个shell脚本。它将负责:</p><ul class=""><li id="ae1f" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">连接到FTP服务器。</li><li id="80c8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">上传想要的文件到想要的路径。</li><li id="cfd1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在服务器内移动文件。</li></ul><p id="9653" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以举起你的魔杖，让魔法发生吧！</p><h2 id="c635" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated"><strong class="ak"> 1。连接到您的服务器</strong></h2><p id="ef77" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">要连接FTP服务器，您需要三个参数:</p><ol class=""><li id="2248" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nz mb mc md bi translated">FTP主机地址</li><li id="e525" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">用户名</li><li id="059f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">一个密码</li></ol><p id="8b26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们称这些参数为<code class="fe oa ob oc od b">FTP_HOST</code>、<code class="fe oa ob oc od b">FTP_USER</code>和<code class="fe oa ob oc od b">FTP_PWD</code>。</p><p id="da7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oe">注意:您可以在本地存储它们的值，但是我建议您在一个可信的持续集成平台下声明它们——尤其是当您与您的团队共享脚本时。</em></p><p id="07ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建一个shell脚本文件开始:</p><pre class="kj kk kl km gt of od og oh aw oi bi"><span id="c5fb" class="nn mr it od b gy oj ok l ol om"><strong class="od iu">$</strong> touch upload_to_ftp.sh</span></pre><p id="001a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后添加这几行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="41f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们分解这几行代码，我们会得到如下结果:</p><ol class=""><li id="3382" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nz mb mc md bi translated">首先，我们将连接命令重定向到一个文本文件。</li><li id="e450" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">我们用包含所需指令的文件执行<code class="fe oa ob oc od b">lftp</code>命令——当给定一个文件作为参数时,<code class="fe oa ob oc od b">-f</code>选项很重要。</li><li id="e618" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">我们清理不再需要的临时文件。</li></ol><p id="9b26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">试试吧！</p><pre class="kj kk kl km gt of od og oh aw oi bi"><span id="d4e2" class="nn mr it od b gy oj ok l ol om"><strong class="od iu">$</strong> ./upload_to_ftp.sh</span></pre><p id="0a1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切顺利，你应该会得到…什么都没有。提示将产生，意味着连接已成功建立并终止。否则，您将得到:</p><ul class=""><li id="1071" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe oa ob oc od b">lftp</code>未安装在您的机器上。</li></ul><pre class="kj kk kl km gt of od og oh aw oi bi"><span id="576a" class="nn mr it od b gy oj ok l ol om">./upload_to_ftp.sh: line 8: lftp: command not found</span></pre><ul class=""><li id="c33c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">主机地址错误。</li></ul><pre class="kj kk kl km gt of od og oh aw oi bi"><span id="f21e" class="nn mr it od b gy oj ok l ol om">open: FTP_HOST: nodename nor servname provided, or not known</span></pre><h2 id="813b" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated"><strong class="ak"> 2。上传文件到FTP </strong></h2><p id="98e0" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">到目前为止，我们已经构建了脚本的框架。建立连接后，就该上传文件到你的FTP服务器了。</p><p id="c3b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要两样东西:</p><ol class=""><li id="6695" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nz mb mc md bi translated">您要在FTP上上传文件的位置</li><li id="e254" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu nz mb mc md bi translated">文件的路径</li></ol><p id="83eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">姑且称之为<code class="fe oa ob oc od b">FTP_DIR</code>和<code class="fe oa ob oc od b">FTP_FILE</code>。</p><p id="f7c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oe">注意:这些位置可以是本地的，也可以是远程机器上的。这也意味着这些值必须是已知的和固定的。否则，您可以想象在执行脚本时提示他们。</em></p><p id="a864" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦你找到了这些路径，在调用<code class="fe oa ob oc od b">lftp</code>命令之前添加这一行:</p><pre class="kj kk kl km gt of od og oh aw oi bi"><span id="55e7" class="nn mr it od b gy oj ok l ol om">echo "put -O $<!-- -->FTP_DIR<!-- --> $<!-- -->FTP_FILE<!-- -->" &gt;&gt; ftp.txt</span></pre><p id="9a0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尝试再次执行您的脚本。如果您在FTP服务器上的期望位置看到了您的文件，那么您就成功了！如果没有，请确保您的路径是正确的。</p><h2 id="cbe3" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">3.在FTP中移动文件</h2><p id="9b84" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在某些情况下，您可能想要移动已经上传到FTP服务器上的一些文件(例如，出于存档目的)。</p><p id="54c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您在上传文件的同一层有一个<code class="fe oa ob oc od b">Archives</code>文件夹。然后你只需要指出目标文件夹和你想移动的文件。</p><pre class="kj kk kl km gt of od og oh aw oi bi"><span id="5d88" class="nn mr it od b gy oj ok l ol om">echo "mmv -O $<!-- -->FTP_DIR<!-- -->/Archives $<!-- -->FTP_DIR/<!-- -->$<!-- -->FTP_FILE"<!-- --> &gt;&gt; ftp.txt</span></pre><p id="d4c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个想法是在上传新文件之前，将当前上传的文件移动到<code class="fe oa ob oc od b">Archives</code>文件夹<em class="oe">中。所以一定要把这一行放在上传步骤之前。以下是完整的代码:</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="4ae9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oe">注意:</em> <code class="fe oa ob oc od b"><em class="oe">mmv</em></code> <em class="oe">最近增加了一个</em> <code class="fe oa ob oc od b"><em class="oe">lftp</em></code> <em class="oe">，如果你想移动几个匹配正则表达式的文件，它接受通配符(</em> <code class="fe oa ob oc od b"><em class="oe">*</em></code> <em class="oe">)。但是，请确保您至少拥有4.8.0版本，否则将无法兼容。</em></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="2fcf" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">通过多文件上传进一步自动化</h1><p id="5b97" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">如果能一次上传几个文件不是更好吗？我们只需要文件名，并用上面的脚本为每个文件重复上传命令。</p><p id="a1cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一个例子。我们有一套Android应用程序，我们想把它们分发到我们的FTP服务器上。我们的应用有三个版本:</p><ul class=""><li id="bc11" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">awesome_app_free.apk</li><li id="4fe5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">awesome_app_pro.apk</li><li id="36db" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">awesome_app_enterprise.apk</li></ul><p id="e99e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它们都位于同一条路径上。我们知道他们的文件名。</p><p id="6d82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想一次上传所有这些文件，下面是脚本的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="9f6f" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">结论</h1><p id="7b9f" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">如果你还和我在一起，那么你就拥有了启动自动化管道的所有钥匙。它们将节省您的时间和精力，更不用说您将减少手动错误(错误的文件上传，错误的位置等)。).</p><p id="3d0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保持安全，尽可能自动化！</p></div></div>    
</body>
</html>