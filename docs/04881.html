<html>
<head>
<title>Implement Continuous Speech Recognition on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android上实现连续语音识别</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implement-continuous-speech-recognition-on-android-1dd2f4b562fd?source=collection_archive---------2-----------------------#2020-05-19">https://betterprogramming.pub/implement-continuous-speech-recognition-on-android-1dd2f4b562fd?source=collection_archive---------2-----------------------#2020-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a7df" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">说出单词来触发应用程序中的语音识别</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/29a7949f7181b35bee0d803c92a77c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mCbjy9sq8luA4GL-"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">粘土堤</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="34d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">语音识别在过去几年里获得了很大的发展。当构建一个您认为语音识别会提升您的用户体验的应用程序时，您可以:</p><ul class=""><li id="4ab4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">集成<code class="fe me mf mg mh b"><a class="ae ky" href="https://developer.android.com/reference/android/speech/SpeechRecognizer" rel="noopener ugc nofollow" target="_blank">SpeechRecognizer</a></code> API。</li><li id="1d3e" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu ma mb mc md bi translated">利用谷歌助手。</li></ul><p id="ae91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的Android应用程序中实现<code class="fe me mf mg mh b">SpeechRecognizer</code>非常简单。我将在本文后面提供一个详细的实现。</p><p id="8425" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我们想要连续的语音识别。不幸的是，API没有提供使用关键字触发语音识别的机制。所有的语音识别系统都是基于这种模式，无论是谷歌助手的“Ok Google”，iOS的“Hey Siri”，还是亚马逊设备的“Alexa”。</p><p id="2f54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，第二种选择应该符合我们的需求。可悲的是，谷歌助手仍然是一个封闭的API，并没有提供许多可能性。它提供了<a class="ae ky" href="https://developers.google.com/assistant/app/overview" rel="noopener ugc nofollow" target="_blank"> App动作</a>，但是你不会用它实现连续语音识别。</p><p id="149e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我第一次看到<code class="fe me mf mg mh b"><a class="ae ky" href="https://developer.android.com/reference/android/service/voice/VoiceInteractionService" rel="noopener ugc nofollow" target="_blank">VoiceInteractionService</a></code>时，我很兴奋。它似乎做了我想要的<code class="fe me mf mg mh b"><a class="ae ky" href="https://developer.android.com/reference/android/service/voice/AlwaysOnHotwordDetector" rel="noopener ugc nofollow" target="_blank">AlwaysOnHotwordDetector</a></code>。不幸的是，它通过让你集成一个自定义助手而与谷歌助手紧密绑定。</p><p id="db4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，我们可以使用<code class="fe me mf mg mh b">SpeechRecognizer</code>,但我们仍然需要从用户交互中触发语音识别。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="0fa9" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">激活热门关键字的语音识别</h1><p id="f9fd" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们想将这个过程分成几个步骤:</p><ol class=""><li id="e405" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu nr mb mc md bi translated">激活语音识别。</li><li id="e345" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu nr mb mc md bi translated">倾听热门关键词。</li><li id="e60b" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu nr mb mc md bi translated">在检测到关键字时，听用户的声音。</li><li id="5dc4" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu nr mb mc md bi translated">抓住单词，产生结果。</li><li id="c225" class="lv lw it lb b lc mi lf mj li mk lm ml lq mm lu nr mb mc md bi translated">停用语音识别。</li></ol><p id="5a26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过将热门关键词检测与实际语音识别分离来利用<code class="fe me mf mg mh b">SpeechRecozigner</code>。</p><h2 id="e670" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">基本语音识别设置</h2><p id="e4cc" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果您的目标是SDK 23或更高版本，您必须请求在您的应用程序中录制音频的权限。</p><p id="c5a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AndroidManifest.xml内部:</p><pre class="kj kk kl km gt oe mh of og aw oh bi"><span id="0bef" class="ns mv it mh b gy oi oj l ok ol">&lt;uses-permission android:name="android.permission.RECORD_AUDIO" /&gt;</span></pre><p id="c01a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您将使用语音识别的活动中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="3b08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您需要创建一个语音识别器对象，并为其附加一个侦听器。您将能够响应来自这些回调的事件。确保语音识别在您的用户设备上可用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="2f34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建后，您可以启动识别器。您需要提供一个配置它的意图。这里有一个你可以使用的可能性，但是一定要检查<code class="fe me mf mg mh b">RecognizerIntent</code>标志。其中一些可能更适合您的用例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="d744" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">大声说时间！</h2><p id="4f29" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">你准备好开口了。因为您已经实现了<code class="fe me mf mg mh b"><a class="ae ky" href="https://developer.android.com/reference/android/speech/RecognitionListener" rel="noopener ugc nofollow" target="_blank">RecognitionListener</a></code>，所以仔细看看下面的回调:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="b882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API一理解单词就通知你，不管是部分识别还是完全识别。您只需要解析它们，就大功告成了！</p><p id="8ed4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成后，请记住停止侦听并销毁您的识别器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="4beb" class="ns mv it bd mw nt nu dn na nv nw dp ne li nx ny ng lm nz oa ni lq ob oc nk od bi translated">检测关键字</h2><p id="f5d4" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如果我们回顾我们的步骤，我们已经省略了第二步和第三步。有了基本的设置，你已经准备好了一切——我们只需要将聆听过程分成两个部分。</p><p id="65a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要添加一个标志来区分对关键字的监听和其他监听。姑且称之为<code class="fe me mf mg mh b">isActivated</code>。</p><p id="63b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开始监听，等待在<code class="fe me mf mg mh b">onResults</code>回调中捕捉你的关键词。一旦找到，它将返回匹配项:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="65d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这段代码，只要标志关闭，您就可以监听关键字。您必须重新启动识别，因为系统在找到匹配项时会将其关闭。</p><p id="ccb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当检测到关键字时，打开标志。下次你说话的时候，你会拿到火柴的。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="d176" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">有什么条件？</h1><p id="da07" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">你开始想知道它将如何影响你的申请了吗？会影响性能吗？穿线呢？</p><p id="1c7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之:它消耗大量电池，线程效率不高。</p><p id="22cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于电池，除了尽可能高效地听，没什么能做的。此外，确保在执行完任务后停止监听，并记住销毁识别器。</p><p id="c2d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我对线程处理有更高的期望。可悲的是，API迫使我们从主线程调用它的所有方法。所以，忘记在<code class="fe me mf mg mh b">Service</code>中提取这个吧。</p><blockquote class="oo"><p id="c619" class="op oq it bd or os ot ou ov ow ox lu dk translated">"这个类的方法只能从主应用程序线程中调用."</p></blockquote><p id="63a1" class="pw-post-body-paragraph kz la it lb b lc oy ju le lf oz jx lh li pa lk ll lm pb lo lp lq pc ls lt lu im bi translated">简而言之，你可以执行连续语音识别，只要你知道它将如何影响你的应用程序和你的用户。我强烈建议您在应用程序中隔离这种机制，以减轻其影响。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="fa82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想用这个特性来引导你的应用程序，我已经做了一个库，可以帮助你。</p><div class="pd pe gp gr pf pg"><a href="https://github.com/StephenVinouze/KontinuousSpeechRecognizer" rel="noopener  ugc nofollow" target="_blank"><div class="ph ab fo"><div class="pi ab pj cl cj pk"><h2 class="bd iu gy z fp pl fr fs pm fu fw is bi translated">Stephen winouze/kontinuus speech recognizer</h2><div class="pn l"><p class="bd b dl z fp pl fr fs pm fu fw dk translated">github.com</p></div></div><div class="po l"><div class="pp l pq pr ps po pt ks pg"/></div></div></a></div></div></div>    
</body>
</html>