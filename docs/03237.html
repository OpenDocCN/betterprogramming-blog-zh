<html>
<head>
<title>What Is a Target Fragment?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是目标碎片？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-is-target-fragment-da0e7c7f345c?source=collection_archive---------5-----------------------#2020-01-29">https://betterprogramming.pub/what-is-target-fragment-da0e7c7f345c?source=collection_archive---------5-----------------------#2020-01-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fd33" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在Android中有效地从ChildFragment传递到ParentFragment</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9fd719b9650f2c2d7ee96dc11e868331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JIr66I9UCNal_BBFrDNQzw.png"/></div></div></figure><p id="c73c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">片段是可以放在活动中的应用程序用户界面或行为的一部分。</p><p id="9793" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与片段的交互是通过FragmentManager完成的，可以通过<code class="fe lq lr ls lt b">Activity.getFragmentManager()</code>和<code class="fe lq lr ls lt b">Fragment.getFragmentManager()</code>获得。</p><p id="5e2d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">片段与其所在的活动密切相关，不能脱离活动单独使用。尽管一个片段定义了它自己的生命周期，但是这个生命周期依赖于它的活动。如果活动停止，它内部的任何片段都不能启动。当活动被销毁时，所有碎片都将被销毁。</p><p id="9c8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">片段之间有多种通信方式，如接口、共享<code class="fe lq lr ls lt b">ViewModel</code>等。</p><p id="d1fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是你知道吗，通过使用标准方法<code class="fe lq lr ls lt b">setTargetFragment()</code>和<code class="fe lq lr ls lt b">getTargetFragment()</code>，我们可以很容易地从子片段到父片段进行通信，并在父片段的<code class="fe lq lr ls lt b">onActivityResult()</code>中接收回调。</p><h2 id="ab51" class="lu lv it bd lw lx ly dn lz ma mb dp mc ld md me mf lh mg mh mi ll mj mk ml mm bi translated"><strong class="ak">用例</strong></h2><p id="a110" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated">当我们打开一个对话框片段时，用户需要从可用选项列表中选择一个选项，然后当他们单击OK按钮时，我们需要将所选选项返回到父片段。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="b5a8" class="mz lv it bd lw na nb nc lz nd ne nf mc jz ng ka mf kc nh kd mi kf ni kg ml nj bi translated">步伐</h1><ol class=""><li id="4197" class="nk nl it kw b kx mn la mo ld nm lh nn ll no lp np nq nr ns bi translated">如果我们想从一个片段与另一个片段通信，那么从<code class="fe lq lr ls lt b">ParentFragment</code>开始，我们必须使用<code class="fe lq lr ls lt b">setTargetFragment</code> <strong class="kw iu"> </strong> ( <code class="fe lq lr ls lt b">ParentFragment</code>实例，<code class="fe lq lr ls lt b">RequestCode</code>)。</li><li id="37c4" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">之后，我们调用对话框片段上的<code class="fe lq lr ls lt b">show()</code>方法来显示可用选项的列表。</li><li id="4b8d" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">然后用<code class="fe lq lr ls lt b">onActivityResult</code> ( <code class="fe lq lr ls lt b">RequestCode</code>，<code class="fe lq lr ls lt b">Activity.RESULT_OK</code>，意图)。因此，来自<code class="fe lq lr ls lt b">ChildFragment</code>的回调可以在<code class="fe lq lr ls lt b">ParentFragment</code>的覆盖方法<code class="fe lq lr ls lt b">onActivityResult</code>中接收。</li><li id="53b7" class="nk nl it kw b kx nt la nu ld nv lh nw ll nx lp np nq nr ns bi translated">从<code class="fe lq lr ls lt b">ChildFragment</code>开始，我们必须使用<code class="fe lq lr ls lt b">getTargetFragment()</code>，如果使用<code class="fe lq lr ls lt b">setTargetFragment()</code>设置了任何东西，它将返回<code class="fe lq lr ls lt b">ParentFragment</code>实例。</li></ol><p id="36bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们用一个例子来更好地理解它。</p><p id="8c53" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第1步:让我们调用父片段中的<code class="fe lq lr ls lt b">showOptionsDialog()</code>,它显示了一个带有选项列表的<code class="fe lq lr ls lt b">OptionsDialogFragment</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="5379" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二步:在<code class="fe lq lr ls lt b">ParentFragment</code>中实现<code class="fe lq lr ls lt b">onActivityResult()</code>，在这里我们接收来自<code class="fe lq lr ls lt b">ChildFragment</code>的回调，并根据结果执行一个动作。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="645d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第三步:当用户点击<code class="fe lq lr ls lt b">OptionsDialogFragment</code>中的一个选项时，调用<code class="fe lq lr ls lt b">onExit(selection: String)</code>，我们编写逻辑将回调返回到<code class="fe lq lr ls lt b">ParentFragment</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="1564" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">来自文档<code class="fe lq lr ls lt b">setTargetFragment()</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="b9c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">来自文档<code class="fe lq lr ls lt b">getTargetFragment()</code>。</p><pre class="kj kk kl km gt oa lt ob oc aw od bi"><span id="e336" class="lu lv it lt b gy oe of l og oh"><em class="oi">/**<br/> * Return the target fragment set by {#setTargetFragment}.<br/> */<br/></em>@Nullable<br/>final public Fragment getTargetFragment() {<br/>  ............<br/>}</span></pre><p id="6b76" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请让我知道你的建议和意见。</p><p id="0489" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！</p></div></div>    
</body>
</html>