<html>
<head>
<title>Build, Test, and Deploy a Flask Application: Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建、测试和部署Flask应用程序:第3部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-test-and-deploy-a-flask-application-part-3-3a2abfe4be21?source=collection_archive---------3-----------------------#2019-12-07">https://betterprogramming.pub/build-test-and-deploy-a-flask-application-part-3-3a2abfe4be21?source=collection_archive---------3-----------------------#2019-12-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a179" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用应用工厂和蓝图</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/67895a1c34a468af8f14dbd974e6e6ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DEMTs5jTm1Z0q2X6"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@szolkin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">谢尔盖·佐尔金</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="1025" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">关于本教程的元信息</h1><h2 id="2958" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated">学习目标</h2><ul class=""><li id="b4dd" class="mk ml iq mm b mn mo mp mq ma mr md ms mg mt mu mv mw mx my bi translated">将一个<a class="ae kv" href="https://www.palletsprojects.com/p/flask/" rel="noopener ugc nofollow" target="_blank"> Flask </a>项目从单个脚本应用程序重组为使用应用程序工厂和蓝图。</li></ul><p id="a24b" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">注:本教程是<a class="ae kv" href="https://medium.com/@neohao/learn-flask-in-a-scientific-way-baf4d8055f6e" rel="noopener"> <em class="no">系列</em> </a> <em class="no">科学学烧瓶的一部分。</em></p><h2 id="3b91" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated">源代码</h2><ul class=""><li id="48fd" class="mk ml iq mm b mn mo mp mq ma mr md ms mg mt mu mv mw mx my bi translated">本教程的源代码可以在<a class="ae kv" href="https://github.com/Neo-Hao/mean-review-collector" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获取。</li><li id="5f43" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated">该演示可在<a class="ae kv" href="https://pacific-fortress-91193.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://pacific-fortress-91193.herokuapp.com/</a>获得。</li><li id="3071" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated">单个脚本应用程序的版本可以在GitHub 上访问<a class="ae kv" href="https://github.com/Neo-Hao/mean-review-collector/tree/ecd52a0af58ab1b1165491d50afdd355dfb9988f" rel="noopener ugc nofollow" target="_blank">。</a></li></ul></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="1d80" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">应用工厂和蓝图—它们是什么，我们为什么需要它们？</h1><p id="4869" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">从上一个教程继续，我们已经有了一个测试注册功能的应用程序。</p><p id="3a12" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">然而，所有的东西都被编码在一个文件中，<code class="fe nx ny nz oa b">app.py</code>。这种方法很方便，但是扩展性不好。当复杂性增加时，单个文件应用程序可能会很成问题。</p><p id="a92a" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">尽管Flask没有对应用程序项目进行严格的组织，但是有几种推荐的方法。几乎所有这些都涉及应用工厂和蓝图的使用。</p><p id="b90e" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">应用程序工厂只是一个负责创建应用程序对象及其配置的函数。如果需要，它还可以创建多个应用程序对象。</p><p id="3d33" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">当所有东西都驻留在一个<code class="fe nx ny nz oa b">app.py</code>文件中时，一旦脚本被执行，应用程序对象将被创建。到那时，不可能应用进一步的配置更改。</p><p id="130b" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">相比之下，应用程序工厂会延迟应用程序对象的创建，因为没有初始化应用程序实例。因此，可以动态地应用配置更改，甚至创建多个应用程序对象。</p><p id="15e0" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">典型的应用程序工厂如下所示:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="47ae" class="lv le iq oa b gy of og l oh oi">#__init__.py</span><span id="1fd3" class="lv le iq oa b gy oj og l oh oi">from flask import Flask<br/># import more</span><span id="cc87" class="lv le iq oa b gy oj og l oh oi">def create_app(config_file=None):<br/>    # create and configure the app<br/>    app = Flask(__name__)</span><span id="cd31" class="lv le iq oa b gy oj og l oh oi">    # configuration<br/>    if (config_name is not None):<br/>       app.config.from_pyfile(config_file, silent=True)<br/>    else:<br/>       app.config.from_mapping(<br/>         SECRET_KEY='sdfigtertairasgkd8dty60546j4563l43563',<br/>         DATABASE=os.path.join(app.instance_path, 'app.sqlite'),<br/>    )</span><span id="f29a" class="lv le iq oa b gy oj og l oh oi">    # attach routes/views and database functions</span><span id="299c" class="lv le iq oa b gy oj og l oh oi">    return app</span></pre><p id="2cd1" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated"><code class="fe nx ny nz oa b">create_app()</code>函数是应用工厂，以配置文件为参数。配置文件默认为<code class="fe nx ny nz oa b">None</code>。当没有指定配置名时，将在<code class="fe nx ny nz oa b">else</code>分支下建立一个简单的配置。</p><p id="0f2a" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">一旦创建了应用程序对象，就可以进一步配置它，并且可以初始化其他功能(例如，数据库、视图)。最后，工厂函数将创建并返回一个应用程序实例。</p><p id="29e9" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">蓝图是一组<code class="fe nx ny nz oa b">.py</code>文件，用于组织相关路线和视图功能组。处理身份验证的函数应该与处理错误的函数组织在不同的文件中，这是很自然的。</p><p id="1958" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">除此之外，blueprints还解决了使用应用程序工厂带来的复杂性。在单个脚本应用程序中，首先创建应用程序对象，以允许<code class="fe nx ny nz oa b">app.route</code>装饰器工作。</p><p id="c925" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">当使用应用程序工厂时，应用程序对象是在运行时创建的，这使得routes和review函数以同样的方式工作为时已晚。</p><p id="1c48" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">为了解决这种复杂性，蓝图在休眠状态下将路由功能与自身关联起来，直到蓝图向应用程序注册。</p><p id="0504" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">典型的蓝图如下所示:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="a0b7" class="lv le iq oa b gy of og l oh oi">#auth.py<br/>from flask import Blueprint</span><span id="c898" class="lv le iq oa b gy oj og l oh oi">bp = Blueprint('auth', __name__)</span><span id="d0c9" class="lv le iq oa b gy oj og l oh oi"><a class="ae kv" href="http://twitter.com/bp" rel="noopener ugc nofollow" target="_blank">@bp</a>.route('/register', methods=('GET', 'POST'))<br/>def register():</span><span id="8e40" class="lv le iq oa b gy oj og l oh oi">   # register stuff</span><span id="5b12" class="lv le iq oa b gy oj og l oh oi">   return render_template('auth/register.html')</span></pre><p id="ee01" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">蓝图的注册如下所示:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="2f16" class="lv le iq oa b gy of og l oh oi">#__init__.py</span><span id="1744" class="lv le iq oa b gy oj og l oh oi">from flask import Flask<br/># import more</span><span id="7729" class="lv le iq oa b gy oj og l oh oi">def create_app(config_file=None):<br/>    # create and configure the app<br/>    app = Flask(__name__)</span><span id="3f55" class="lv le iq oa b gy oj og l oh oi">    # configuration stuff</span><span id="78b4" class="lv le iq oa b gy oj og l oh oi">    # attach routes/views and database functions<br/><strong class="oa ir">    from . import auth<br/>    app.register_blueprint(auth.bp)</strong></span><span id="1c2c" class="lv le iq oa b gy oj og l oh oi">    return app</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="4e19" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">整体重组</h1><p id="425c" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">为了利用应用程序工厂和蓝图，我们需要重新构建我们的应用程序，以便:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="1261" class="lv le iq oa b gy of og l oh oi">mean-review-collector<br/>---app<br/>  ---templates<br/>    ---base.html<br/>    ---etc.<br/>  ---__init__.py<br/>  ---errors.py<br/>  ---auth.py<br/>  ---review.py<br/>  ---db.py<br/>  ---schema.sql<br/>---tests<br/>---instance<br/>  ---app.sqlite<br/>---env</span></pre><p id="77de" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">应用程序包将位于<code class="fe nx ny nz oa b">app</code>文件夹中。测试用例将存在于<code class="fe nx ny nz oa b">test</code>文件夹中。数据库将位于<code class="fe nx ny nz oa b">instance</code>文件夹中。</p><p id="9da6" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">和以前一样，<code class="fe nx ny nz oa b">env</code>文件夹仍然保存虚拟环境配置。当我们以后需要让app应用程序可安装时，这个结构会很方便。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="95da" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">应用工厂</h1><p id="54a3" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">应用程序工厂位于<code class="fe nx ny nz oa b">__init__.py</code>中，在<code class="fe nx ny nz oa b">app</code>文件夹下:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="c2e6" class="lv le iq oa b gy of og l oh oi">#__init__.py</span><span id="9c5e" class="lv le iq oa b gy oj og l oh oi">import os<br/>from flask import Flask</span><span id="67d0" class="lv le iq oa b gy oj og l oh oi">def create_app(config_file=None):<br/>    # create and configure the app<br/>    app = Flask(__name__)</span><span id="2399" class="lv le iq oa b gy oj og l oh oi">    # configuration<br/>    if (config_name is not None):<br/>       app.config.from_pyfile(config_file, silent=True)<br/>    else:<br/>       app.config.from_mapping(<br/>         SECRET_KEY='sdfigtertairasgkd8dty60546j4563l43563',<br/>         DATABASE=os.path.join(app.instance_path, 'app.sqlite'),<br/>    )</span><span id="05e2" class="lv le iq oa b gy oj og l oh oi">    # attach routes/views and database functions</span><span id="a05d" class="lv le iq oa b gy oj og l oh oi">    return app</span></pre><p id="e109" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">值得注意的是，我们的应用工厂在当前状态下是不完整的。</p><p id="d0f8" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">当我们完成与数据库和蓝图相关的功能时，我们会将它们注册到应用程序工厂，并更新<code class="fe nx ny nz oa b">create_app()</code>功能。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="875f" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">数据库ˌ资料库</h1><p id="de4d" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">我们将把与数据库相关的所有功能分解到一个脚本中，<code class="fe nx ny nz oa b">db.py</code>。虽然大多数功能保持不变，但仍有一些明显的差异:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="fdb3" class="lv le iq oa b gy of og l oh oi">#db.py</span><span id="e442" class="lv le iq oa b gy oj og l oh oi">import sqlite3<br/>import click<br/>from flask import current_app, g</span><span id="503e" class="lv le iq oa b gy oj og l oh oi"># more functions</span><span id="176d" class="lv le iq oa b gy oj og l oh oi"># create the database<br/>def init_db():<br/>    db = get_db()<br/>    with current_app.open_resource('schema.sql') as f:<br/>        db.executescript(f.read().decode('utf8'))</span><span id="c3c3" class="lv le iq oa b gy oj og l oh oi">@click.command('init-db')<br/>@with_appcontext<br/>def init_db_command():<br/>    """Clear the existing data and create new tables."""<br/>    init_db()<br/>    click.echo('Initialized the database.')</span><span id="1bd5" class="lv le iq oa b gy oj og l oh oi"># more functions</span></pre><p id="53e3" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">首先，<code class="fe nx ny nz oa b">db.py</code>中的所有函数都是在没有应用对象被创建时创建的。因此，我们无法访问之前创建的对象<code class="fe nx ny nz oa b">app</code>。</p><p id="aa00" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">然而，有时候，我们确实需要参考对象。一种解决方法是使用<code class="fe nx ny nz oa b">current_app</code>。<code class="fe nx ny nz oa b">current_app</code>通常用作应用程序的代理，因此当您采用应用程序工厂和蓝图模式时，您可以处理所有请求。</p><p id="1a20" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">对<code class="fe nx ny nz oa b">init_db</code>方法的仔细比较可以更清楚地证明这一点:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="8e8f" class="lv le iq oa b gy of og l oh oi"># app.py<br/># create the database -- when you have access to app object<br/>def init_db():    <br/>  with app.app_context():        <br/>    db = get_db()        <br/>    with app.open_resource('schema.sql', mode='r') as f:<br/>      db.cursor().executescript(f.read())        <br/>      db.commit()</span><span id="1f32" class="lv le iq oa b gy oj og l oh oi"># db.py<br/># create the database -- when you adopt application factory<br/>def init_db():<br/>  db = get_db()<br/>  with <strong class="oa ir">current_app</strong>.open_resource('schema.sql', mode='r') as f:<br/>    db.cursor().executescript(f.read())        <br/>    db.commit()</span></pre><p id="b134" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">第二，我们需要创建一个函数<code class="fe nx ny nz oa b">init_db_command</code>，作为可以通过终端运行的命令。我们将不再能够访问创建的<code class="fe nx ny nz oa b">app</code>对象。</p><p id="37c7" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">因此，我们不能再像在第2部分中那样初始化数据库。我们需要将所有数据库功能关联到我们的应用程序工厂:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="462e" class="lv le iq oa b gy of og l oh oi">#__init__.py</span><span id="aaff" class="lv le iq oa b gy oj og l oh oi">import os<br/>from flask import Flask</span><span id="6f08" class="lv le iq oa b gy oj og l oh oi">def create_app(config_file=None):<br/>    # create and configure the app<br/>    app = Flask(__name__)</span><span id="e4e9" class="lv le iq oa b gy oj og l oh oi">    # configuration</span><span id="6bce" class="lv le iq oa b gy oj og l oh oi">    # attach routes/views and database functions<br/><strong class="oa ir">    from . import db<br/>    db.init_app(app)</strong></span><span id="a09e" class="lv le iq oa b gy oj og l oh oi">    return app</span></pre><p id="f0f1" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">之后，我们将能够通过在终端中键入以下命令来初始化数据库:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="e126" class="lv le iq oa b gy of og l oh oi">flask init-db</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="6e1d" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">蓝图和模板</h1><p id="3c66" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">为了使我们的模板更有条理，我们将重新构建模板文件夹，以便:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="62dd" class="lv le iq oa b gy of og l oh oi">templates<br/>  --base.html<br/>  auth<br/>    --login.html<br/>    --register.html<br/>  review<br/>    --home.html<br/>    --about.html<br/>    --error.html</span></pre><p id="20c4" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">我们将与路线和视图相关的所有功能分解到两个不同的蓝图文件中:</p><ul class=""><li id="9886" class="mk ml iq mm b mn nb mp nd ma ok md ol mg om mu mv mw mx my bi translated"><code class="fe nx ny nz oa b">auth.py</code>:认证相关功能。</li><li id="2b4b" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><code class="fe nx ny nz oa b">review.py</code>:与非认证页面相关的功能(例如，查看平均评论、添加平均评论、更新现有评论)。</li></ul><p id="0bb2" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">例如，<code class="fe nx ny nz oa b">auth.py</code>将包含:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="113c" class="lv le iq oa b gy of og l oh oi">#auth.py</span><span id="cd50" class="lv le iq oa b gy oj og l oh oi">from flask import Blueprint<br/># import more</span><span id="e1d9" class="lv le iq oa b gy oj og l oh oi">bp = Blueprint('auth', __name__)</span><span id="16d6" class="lv le iq oa b gy oj og l oh oi">@<strong class="oa ir">bp</strong>.route('/login')<br/>def login():<br/>    return render_template('auth/login.html')</span><span id="aa7d" class="lv le iq oa b gy oj og l oh oi">@<strong class="oa ir">bp</strong>.route('/register', methods=('GET', 'POST'))<br/>def register():<br/>  # many cases</span><span id="d7ed" class="lv le iq oa b gy oj og l oh oi">  if error is None:<br/>    db.execute(<br/>      'INSERT INTO user (username, password) VALUES (?, ?)',<br/>      (username, generate_password_hash(password))<br/>    )<br/>    db.commit()<br/>    return redirect(url_for('<strong class="oa ir">auth.login</strong>'))</span><span id="3cdb" class="lv le iq oa b gy oj og l oh oi">  flash(error)</span><span id="983b" class="lv le iq oa b gy oj og l oh oi">  return render_template('<strong class="oa ir">auth/register.html</strong>')</span></pre><p id="11a2" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">有两件事值得我们注意。</p><p id="5420" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">首先，所有路由都与蓝图相关联，蓝图处于休眠状态，直到它们向应用程序注册。注册是这样进行的:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="85cd" class="lv le iq oa b gy of og l oh oi">#__init__.py</span><span id="0d18" class="lv le iq oa b gy oj og l oh oi">import os<br/>from flask import Flask</span><span id="13ad" class="lv le iq oa b gy oj og l oh oi">def create_app(config_file=None):<br/>    # create and configure the app<br/>    app = Flask(__name__)</span><span id="cff7" class="lv le iq oa b gy oj og l oh oi">    # configuration</span><span id="dac5" class="lv le iq oa b gy oj og l oh oi">    # attach routes/views and database functions<br/>    from . import db<br/>    db.init_app(app)</span><span id="d2c5" class="lv le iq oa b gy oj og l oh oi"><strong class="oa ir">    from . import auth<br/>    app.register_blueprint(auth.bp)</strong></span><span id="2da5" class="lv le iq oa b gy oj og l oh oi">    return app</span></pre><p id="5b54" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">第二，视图函数的端点总是在前面加上蓝图名称。</p><p id="b674" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">例如，上面登录函数的端点是<code class="fe nx ny nz oa b">auth.login</code>，因为登录函数被添加到了auth蓝图中。因此，您还需要更新<code class="fe nx ny nz oa b">base.html</code>中的所有端点来反映这一点(基础模板包含导航栏):</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="6de7" class="lv le iq oa b gy of og l oh oi">&lt;li class="nav-item"&gt;<br/> &lt;a class="nav-link" href="{{ url_for('<strong class="oa ir">auth.register</strong>') }}"&gt;Register&lt;/a&gt;<br/>&lt;/li&gt;<br/>&lt;li class="nav-item"&gt;<br/> &lt;a class="nav-link" href="{{ url_for('<strong class="oa ir">auth.login</strong>') }}"&gt;Login&lt;/a&gt;<br/>&lt;/li&gt;</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="099e" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">运行重构的应用程序</h1><p id="83d4" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">在所有的更改之后，我们将准备好运行脚本。如果您使用的是Linux或Mac，请通过终端运行以下三行代码:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="5107" class="lv le iq oa b gy of og l oh oi">export FLASK_APP=app<br/>export FLASK_ENV=development<br/>flask run</span></pre><p id="2e97" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">如果您使用的是Windows，请通过CMD运行以下三行命令:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="e332" class="lv le iq oa b gy of og l oh oi">set FLASK_APP=app<br/>set FLASK_ENV=development<br/>flask run</span></pre><p id="13e7" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">您将能够看到与单个脚本应用程序完全相同的效果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/746e8688cc421015d0d5a5b87f67ea8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O3aLU7WySFdLLUJ_WGJbBQ.png"/></div></div></figure><p id="8aba" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">到目前为止，我们已经介绍了如何从单个脚本应用程序到使用应用程序工厂和蓝图来重构Flask项目。</p><p id="5263" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">然而，我们的重组也破坏了我们的测试。我们将在下一个教程中重新构建我们的测试。</p><p id="349e" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">完成这篇文章比预期多花了一周时间，我的学校采用的是四分之一制。随着季度末的临近，许多事情突然出现，让我无法写作。</p><p id="3f18" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">如果你还在上学，这可能是你最后一周或第二周，我希望你有一个美好的寒假。如果你正在工作，我希望你能很快过一个愉快的假期。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="13ba" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">教程列表</h1><ul class=""><li id="d8fc" class="mk ml iq mm b mn mo mp mq ma mr md ms mg mt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-mini-flask-application-1d9ca6c45115" rel="noopener">构建并测试迷你烧瓶应用程序</a></li><li id="e240" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/better-programming/build-test-and-deploy-an-interactive-flask-application-part-i-templates-53a7b0cbe760" rel="noopener">构建、测试和部署Flask应用程序:第1部分——模板</a></li><li id="ada3" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/better-programming/build-test-and-deploy-a-flask-application-part-2-53f2c8df3ebc" rel="noopener">构建、测试和部署Flask应用程序:第2部分——认证</a></li><li id="78c5" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-3-3a2abfe4be21" rel="noopener">构建、测试和部署Flask应用程序:第3部分——应用程序工厂和蓝图</a></li><li id="c985" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-4-5aa4f079fadb" rel="noopener">构建、测试和部署Flask应用程序:第4部分——重构测试</a></li><li id="0517" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-5-4a3c0bc36b8e" rel="noopener">构建、测试和部署Flask应用程序:第5部分—认证(续)</a></li><li id="0eca" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-6-952a1b29a02a" rel="noopener">构建、测试和部署Flask应用程序:第6部分——评审系统</a></li><li id="9c0b" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-7-60dde9080330" rel="noopener">构建、测试和部署Flask应用程序:第7部分——部署</a></li></ul></div></div>    
</body>
</html>