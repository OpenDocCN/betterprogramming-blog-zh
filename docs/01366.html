<html>
<head>
<title>Building Cross-Platform Voice Apps With VOXA — Part 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用VOXA构建跨平台的语音应用——第5部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-cross-platform-voice-apps-with-voxa-part-5-1f0aff32185?source=collection_archive---------17-----------------------#2019-09-03">https://betterprogramming.pub/building-cross-platform-voice-apps-with-voxa-part-5-1f0aff32185?source=collection_archive---------17-----------------------#2019-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e100" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何为Alexa和Google Assistant创建可视化显示</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/55594a9c73d1941028a81db2a426e3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pkLtuhjR8FVwg7W-N84gag.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自www.pl.wikipedia.org<a class="ae kv" href="https://pl.wikipedia.org" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="f206" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是关于如何使用<a class="ae kv" href="https://voxa.readthedocs.io/en/master/" rel="noopener ugc nofollow" target="_blank"> Voxa </a>创建跨平台语音应用的系列文章的第五部分，也是最后一部分【这里是部分<a class="ae kv" href="https://medium.com/p/547f50675fa6" rel="noopener"> 1 </a>、<a class="ae kv" href="https://medium.com/p/feb440ec5da0" rel="noopener"> 2 </a>、<a class="ae kv" href="https://medium.com/p/e738cd991fde" rel="noopener"> 3 </a>和<a class="ae kv" href="https://medium.com/p/f7de737b0cd5" rel="noopener"> 4 </a>的链接】。在<a class="ae kv" href="https://medium.com/better-programming/building-cross-platform-voice-apps-with-voxa-part-4-f7de737b0cd5" rel="noopener">上一篇文章</a>中，我们讨论了用户购买订阅的能力；Alexa的技术内采购，以及谷歌助理的数字商品订阅。在这篇文章中，我们将学习如何为带屏幕的设备显示游戏排行榜，以及如何在Voxa中进行单元测试。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="51d6" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Alexa表示语言</h1><p id="e119" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated"><a class="ae kv" href="https://developer.amazon.com/docs/alexa-presentation-language/apl-overview.html" rel="noopener ugc nofollow" target="_blank"> Alexa呈现语言</a> (APL)是一套可视化组件，你可以利用它为带屏幕的设备创造美妙的视觉体验。在APL之前，亚马逊有<a class="ae kv" href="https://developer.amazon.com/docs/custom-skills/display-template-reference.html" rel="noopener ugc nofollow" target="_blank">显示渲染模板</a>接口，但是没有APL灵活。使用APL，您可以更轻松地定制您的屏幕。在我们的源代码中，我们也支持RenderTemplate接口，因为仍然有一些设备的屏幕不支持APL。如果你试图发送一个APL指令到一个非APL设备，技能将崩溃。</p><p id="1f73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的快速数学Alexa技能中，我们将使用APL向用户显示排行榜。如果他们是前10名玩家，他们将能够看到他们的位置、姓名、城市和分数。如果他们不允许在任何一个平台上访问他们的地址，我们将只显示他们的地区；如果是en-US，我们就抢美国部分，如果是en-GB，我们就抢G.B。</p><p id="52d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">APL排行榜屏幕将如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/fecf26825ebfbe3a4aa862a93585d34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-O7dBMDZZ99QqivAHLkDUw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">第二代Echo Show中的排行榜</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/7122d1571a3b2bc14ac4446d7f89f73f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTLY0s7V1Ngv3ezAum5P4g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">回音区的排行榜</p></figure><p id="bc9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在回购的<a class="ae kv" href="https://github.com/omenocal/quick-maths-voice-app/tree/part5" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> part5 </strong> </a>分支中找到显示该头寸表的代码，具体在<code class="fe my mz na nb b">./src/app/model.js</code>文件中</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><code class="fe my mz na nb b">showWinnersDashboard</code>功能</p></figure><p id="a5db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于谷歌助手，我们使用的是<a class="ae kv" href="https://developers.google.com/actions/assistant/responses#table_cards" rel="noopener ugc nofollow" target="_blank">表卡</a>。这个网格将我们的排行榜分组以显示位置，类似于我们在Alexa中所做的，给两个应用程序相同的体验。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/229f8b1048d33f94756297cc59e5115b.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*lKHq8eQNCzZLuvt0wloilg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">谷歌助手(手机)中的排行榜视图</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/8e17a9e6ac191585c0162d9ed19a7ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iwUKjojJhlRFJg-2-9bLmw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Google Assistant中的排行榜视图(Smart Display)</p></figure><p id="b29c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe my mz na nb b">showWinnersDashboard</code>函数构建在两个平台上呈现模板所需的Voxa指令。对于Alexa，它验证设备是否支持APL，并返回一个<code class="fe my mz na nb b">alexaAPLTemplate</code> Voxa指令。否则，它将返回一个<code class="fe my mz na nb b">alexaRenderTemplate</code>指令。如果这是一个Google动作，它会构建<code class="fe my mz na nb b">dialogflowTable</code> Voxa指令。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="51f1" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">Alexa技能的单元测试</h1><p id="9df4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">你可以使用<code class="fe my mz na nb b"><a class="ae kv" href="https://npmjs.com/package/alexa-mime" rel="noopener ugc nofollow" target="_blank">alexa-mime</a></code>包为Alexa技能创建单元测试。这个包允许你创建带有YML结构的测试。它使用了<a class="ae kv" href="https://github.com/BrianMacIntosh/alexa-skill-test-framework" rel="noopener ugc nofollow" target="_blank"> Alexa技能测试框架</a>。在test文件夹中，您可以找到一个测试以下场景的示例:</p><ul class=""><li id="5663" class="ng nh iq ky b kz la lc ld lf ni lj nj ln nk lr nl nm nn no bi translated">用户第一次启动技能。</li><li id="f488" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated">用户听到首次用户消息并接受，开始游戏。</li><li id="6ade" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated">用户听到运算“5 + 5”，Alexa询问结果。</li><li id="d1f1" class="ng nh iq ky b kz np lc nq lf nr lj ns ln nt lr nl nm nn no bi translated">用户答对，得十分。Alexa询问用户是否想继续，但用户停止了游戏。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="fb42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个单元测试有点不同。用户回答错误，Alexa询问用户是否要再试一次。用户这次接受并正确回答。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="436f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">属性<code class="fe my mz na nb b">beforeEach</code>帮助你模拟任何函数、数据库或API操作。属性将帮助您重置或清除任何模拟操作。这些操作可以在这个文件中找到:<code class="fe my mz na nb b">./test/main.spec.js</code>。</p><p id="dee3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了模拟<a class="ae kv" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> DynamoDB </a>操作，我们使用了<code class="fe my mz na nb b"><a class="ae kv" href="http://npmjs.com/package/aws-sdk-mock" rel="noopener ugc nofollow" target="_blank">aws-sdk-mock</a></code>包。为了模拟对Alexa设置端点的API调用，我们使用了<code class="fe my mz na nb b"><a class="ae kv" href="https://www.npmjs.com/package/nock" rel="noopener ugc nofollow" target="_blank">nock</a></code>包。我们还使用<code class="fe my mz na nb b"><a class="ae kv" href="https://www.npmjs.com/package/simple-mock" rel="noopener ugc nofollow" target="_blank">simple-mock</a></code>包模仿<a class="ae kv" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank"> Lodash </a>包中的一些功能，帮助我们随机化应用程序的操作核心流程。</p><p id="71c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以创建任意多的<code class="fe my mz na nb b">.yml</code>文件，将您的用例分组到<code class="fe my mz na nb b">./test/use-cases/</code>文件夹中。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="db15" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">更多信息</h1><p id="8ae2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在这一点上，你应该可以发送你的快速数学竞赛Alexa技能和谷歌行动认证。您可以在我的存储库的<a class="ae kv" href="https://github.com/omenocal/quick-maths-voice-app/tree/part5" rel="noopener ugc nofollow" target="_blank"> part5 </a>分支中找到完整的项目:</p><div class="nu nv gp gr nw nx"><a href="https://github.com/omenocal/quick-maths-voice-app" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">omenocal/快速数学语音应用程序</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">这个应用程序是使用RAIN开发的voxa3框架编写的。</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol kp nx"/></div></div></a></div><p id="9a36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">控制VUI的电子表格，意味着Alexa技能的清单信息，以及两个平台的意图/话语已经在<code class="fe my mz na nb b">interaction.json</code>文件中了。您应该创建自己的电子表格来复制该文件中提供的信息。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9090" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结束了</h1><p id="b994" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这是一系列五篇文章的结尾，这些文章向您展示了如何使用多平台框架Voxa为当前两个主要的语音平台:Alexa和Google Assistant创建VoiceFirst游戏。我希望你觉得它有用，并期待听到你下一步的构建。感谢阅读！</p><p id="6d1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记住:不要把垃圾扔到海里！</p></div></div>    
</body>
</html>