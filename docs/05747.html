<html>
<head>
<title>Anomaly Detection in iOS — Compute Image Differences Using Core Image in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS中的异常检测—使用SwiftUI中的核心映像计算映像差异</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/image-difference-using-computer-vision-in-ios-14-7753b8d61e82?source=collection_archive---------9-----------------------#2020-08-03">https://betterprogramming.pub/image-difference-using-computer-vision-in-ios-14-7753b8d61e82?source=collection_archive---------9-----------------------#2020-08-03</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="d5ab" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">让我们利用新的核心图像过滤器来发现图像之间的差异和异常</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/c186f11496d045ae66c86800d56f0469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sWgu_IXyOnGZ1P59"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@franckinjapan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Franck V. </a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="4f66" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">人眼非常容易接受视觉表现。同样，计算机视觉使系统能够理解和处理图像。</p><p id="4e66" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">核心图像和视觉是iOS中计算机视觉的两大支柱。在2020年WWDC奥运会期间，苹果为他们两个都推了一个信封。</p><p id="ab97" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">iOS 14中的核心图像现在包括几个新的内置过滤器，用于图像处理。具体来说，我们有一个<code class="fe lw lx ly lz b">CIColorThreshold</code>过滤器，通过设置阈值将图像转换为黑白，还有另一个<code class="fe lw lx ly lz b">CIColorThresholdOtsu</code>，它从图像的直方图中确定适当的阈值。</p><p id="c4bd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">更重要的是，我们现在可以使用新的<code class="fe lw lx ly lz b">CIColorAbsoluteDifference</code>滤镜来比较两幅图像——这是本文的重点。</p><p id="0a71" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在接下来的部分中，我们将探索通过分析图像之间的差异可以实现的用例。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="1893" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">绝对图像差异</h1><p id="5524" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">这个图像处理任务包括计算两幅图像中每个像素的绝对差值，并将它们相加。</p><p id="e22a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这样做，我们得到一个新的变换图像，显示了两个图像之间的变化。</p><p id="ae5c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在新的核心图像过滤器中，如果两个图像完全相同，我们的输出图像将是黑色的。</p><p id="8c8b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过比较图像之间的色差，我们可以:</p><ul class=""><li id="0b25" class="ne nf iu lc b ld le lg lh lj ng ln nh lr ni lv nj nk nl nm bi translated">分析视频帧。例如，我们可以确定帧是否一致，或者任何帧中是否有阴影。</li><li id="491a" class="ne nf iu lc b ld nn lg no lj np ln nq lr nr lv nj nk nl nm bi translated">异常检测，用于发现肉眼可能忽略的异常值。这有助于发现图像之间的差异，例如信用卡或纸币是否缺少符号。</li></ul><p id="72bb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">接下来，我们将探索几个比较两幅图像的例子。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="f02f" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">核心图像过滤器:CIColorAbsoluteDifference</h1><p id="396a" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">让我们创建一个新的SwiftUI应用程序来执行图像处理。</p><p id="96d5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">核心映像需要将输入<code class="fe lw lx ly lz b">CIImage</code>(我们将从UIImage转换而来)设置到<code class="fe lw lx ly lz b">CIFilter</code>上。随后，我们可以设置阈值(如果有的话)，并从过滤器中检索<code class="fe lw lx ly lz b">outputImage</code>实例。这个<code class="fe lw lx ly lz b">outputImage</code>实例基本上是一个<code class="fe lw lx ly lz b">inputImage</code>的副本，然后传递给CIContext的函数<code class="fe lw lx ly lz b">createCGImage</code>来执行转换。</p><p id="3697" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">CIContext</code>是所有图像处理发生的地方。</p><h2 id="fb0a" class="ns mi iu bd mj nt nu dn mn nv nw dp mr lj nx ny mt ln nz oa mv lr ob oc mx od bi translated">发现SwiftUI中图像之间的差异</h2><p id="22eb" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">下面的例子展示了经典的“发现图像中的差异”谜题。但是有了计算机视觉。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oe"><img src="../Images/5ff6ec5acb1ee563c52892d0da717e14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BkGClDLFYB3Le8qWzKTIow.png"/></div></div></figure><p id="e685" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">创建了一个过滤器，我们在上面传递了两个图像。</p><p id="0e54" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在比较之前，我们还可以将两幅图像转换成灰度。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h2 id="f74a" class="ns mi iu bd mj nt nu dn mn nv nw dp mr lj nx ny mt ln nz oa mv lr ob oc mx od bi translated">水印检测/提取</h2><p id="916e" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">经常会遇到需要确保在图像上设置水印或徽标覆盖的任务。同样，使用<code class="fe lw lx ly lz b">CIColorAbsoluteDifference</code>我们可以确定如下所示:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj of"><img src="../Images/46e338dbadf92ae5d3010f39c50d0cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pi6QDr_J7EjqagB9fBJJDQ.png"/></div></div></figure></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h2 id="d9d0" class="ns mi iu bd mj nt nu dn mn nv nw dp mr lj nx ny mt ln nz oa mv lr ob oc mx od bi translated">信用卡异常检测</h2><p id="af03" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">在我们的移动应用程序中扫描信用卡并提取数字是一项相当常见的计算机视觉任务。</p><p id="897a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以进一步利用上述核心图像过滤器的能力来确定信用卡的图像是否没有被篡改。此外，我们可以保留空白的参考信用卡图像，并将其与扫描图像进行比较，以仅提取数字。</p><p id="928d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下示例显示了如何做到这两点:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj og"><img src="../Images/65339ba0e442327b97bc847e44260b11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DoSQ5xyYlMAeR9Vg3Xfkfg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者的屏幕截图</p></figure><p id="616f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在左侧图像中，为了使用计算机视觉全面检测是否存在异常值/异常，我们可以通过将输出图像与不透明的黑色图像进行比较来扩展上述示例。</p><p id="13b4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">以下是计算图像差异的完整代码:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oh oi l"/></div></figure><p id="0d98" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">上述SwiftUI + CoreImage应用程序的完整源代码可在这个<a class="ae kz" href="https://github.com/anupamchugh/CoreImageAbsoluteColorDiff" rel="noopener ugc nofollow" target="_blank"> Github资源库</a>中获得。</p></div><div class="ab cl ma mb hy mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="in io ip iq ir"><h1 id="132e" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">结论</h1><p id="69ce" class="pw-post-body-paragraph la lb iu lc b ld mz jv lf lg na jy li lj nb ll lm ln nc lp lq lr nd lt lu lv in bi translated">在准备数据集时，苹果的图像处理框架CoreImage可以方便地进行图像转换和增强。</p><p id="2a60" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们讨论了iOS 14中可用的新滤镜<code class="fe lw lx ly lz b">CIColorAbsoluteDifference</code>，它通过每个像素的颜色来比较两幅图像(不需要OpenCV)。</p><p id="53e7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这有助于发现图像中的瑕疵，从视频或数据集中确定和移除重复图像。</p><p id="30b0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这一次到此为止。感谢阅读。</p></div></div>    
</body>
</html>