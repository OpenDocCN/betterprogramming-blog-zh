<html>
<head>
<title>Flutter: How to Save Objects in SharedPreferences</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter:如何在SharedPreferences中保存对象</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/flutter-how-to-save-objects-in-sharedpreferences-b7880d0ee2e4?source=collection_archive---------0-----------------------#2019-09-07">https://betterprogramming.pub/flutter-how-to-save-objects-in-sharedpreferences-b7880d0ee2e4?source=collection_archive---------0-----------------------#2019-09-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="48b8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">少量数据的简单解决方案</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/69edb194dbc9d2fd1d86ec1cde800c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YfyRWEjZXMrzpYx1SbxQMQ.jpeg"/></div></div></figure><p id="b202" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">开发移动应用程序时，您可能希望保存自定义对象以备后用，例如，在应用程序关闭时保存用户信息，并在稍后打开应用程序时使用它。</p><p id="9660" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此，我们将把我们的对象编码成一个JSON字符串，并保存在<code class="fe ln lo lp lq b">SharedPreferences</code>空间中。当我们想要读取保存的数据时，我们只需要从JSON字符串解码回我们的对象。当您想要保存少量数据时，在<code class="fe ln lo lp lq b">SharedPreferences</code>中保存数据是一个简单的解决方案。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="cf6d" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">创建自定义对象</h1><p id="8731" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">对于我们的例子，我们将使用一个非常简单的对象来存储一些用户信息。</p><p id="10aa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的对象将有三个属性:姓名、年龄<strong class="kt ir">、</strong>和位置；每一个都由一个字符串表示。</p><p id="5e6d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们班真的很简单。在我们的例子中，它被初始化为一个具有空属性的对象，并且每一个属性都在后面被赋值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="6682" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">JSON:编码和解码</h1><p id="7256" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">为了将我们的用户对象编码到JSON中，我们必须在类中创建一个函数来完成这种转换。它将创建一个映射，其中每个属性(值)对应一个键:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="2271" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将把我们的用户对象转换成一个<code class="fe ln lo lp lq b">Map&lt;String, dynamic&gt;</code>。要将其转换成JSON字符串，我们稍后将不得不使用函数<code class="fe ln lo lp lq b">json.encode(Map&lt;String, dynamic&gt;)</code>。这将把我们的用户对象转换成JSON字符串，如下所示:</p><p id="4cce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ln lo lp lq b">{“name”:“Alfonso”,“age”:“21”,“location”:“Portugal”}</code></p><p id="6ab5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该字符串将保存在<code class="fe ln lo lp lq b">SharedPreferences</code>中。</p><p id="4487" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了将JSON字符串解码成用户对象，我们必须首先使用函数<code class="fe ln lo lp lq b">json.decode(JSON-String)</code>。这将返回一个<code class="fe ln lo lp lq b">Map&lt;String, dynamic&gt;</code> <strong class="kt ir"> <em class="mx"> </em> </strong>，然后我们可以将它转换成我们的用户对象:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="3a24" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，我们的用户类的最终代码将是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="962a" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">SharedPreferences:保存并阅读</h1><p id="b06a" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">首先，为了使用<code class="fe ln lo lp lq b">SharedPreferences</code>，我们必须为它使用<a class="ae my" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank"> Flutter </a>的<a class="ae my" href="https://pub.dev/packages/shared_preferences" rel="noopener ugc nofollow" target="_blank">插件</a>。为此，请确保您的<code class="fe ln lo lp lq b">pubspec.yaml</code> <strong class="kt ir"> <em class="mx"> </em> </strong>文件中的<code class="fe ln lo lp lq b">dependencies</code>看起来与此类似:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="d83a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了在<code class="fe ln lo lp lq b">SharedPreferences</code>中保存一些东西，我们必须提供一个我们想要保存的值和一个标识它的键。</p><p id="1b1d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们的例子中，值将是一个字符串—键总是一个字符串。</p><p id="eccc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们首先要做的是<code class="fe ln lo lp lq b">SharedPreferences</code>中的<code class="fe ln lo lp lq b">getInstance</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="cb26" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这里，代码<code class="fe ln lo lp lq b">await</code> <em class="mx"> </em>将暂停程序的执行，直到我们有了<code class="fe ln lo lp lq b">SharedPreferences </code>实例。如果你不是很了解<em class="mx">异步编程</em>，你可以在<a class="ae my" href="https://dart.dev/codelabs/async-await#execution-flow-with-async-and-await" rel="noopener ugc nofollow" target="_blank"> Dart </a>文档中了解更多。</p><p id="960e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有了<code class="fe ln lo lp lq b">SharedPreferences</code>实例后，我们将希望保存带有给定键的字符串值:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="71c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">记住，我们想要保存的值是一个定制对象，因此，我们需要将它编码成一个JSON字符串，如上所述。然后，代码变成:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="417f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的<code class="fe ln lo lp lq b">save</code>功能是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div><p class="mz na gj gh gi nb nc bd b be z dk translated">要特别注意这个函数是“异步”的。</p></figure><p id="26ed" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">读取(加载)功能类似于保存功能，其代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div><p class="mz na gj gh gi nb nc bd b be z dk translated">这里我们必须解码存储的字符串(JSON字符串)。</p></figure><p id="bc65" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之前，我们应该已经将用于管理<code class="fe ln lo lp lq b">SharedPreferences </code>的每个函数组织在一个名为<code class="fe ln lo lp lq b">sharedPref.</code> <strong class="kt ir"> <em class="mx"> </em> </strong>的类中，代码是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div><p class="mz na gj gh gi nb nc bd b be z dk translated">还增加了“删除”功能。</p></figure></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="5d9d" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">演示:在应用程序中使用它</h1><p id="cf01" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">我们必须首先初始化我们的<code class="fe ln lo lp lq b">sharedPref</code> <strong class="kt ir"> </strong>对象的一个实例，这个类将管理应用程序的<code class="fe ln lo lp lq b">SharedPreferences</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="c3b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此后，在任何时候，我们都可以非常简单地将用户对象保存到我们的<code class="fe ln lo lp lq b">SharedPreferences</code>中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="5428" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在实际应用中使用这种方法保存对象的棘手之处在于检索对象本身，而不是一个<code class="fe ln lo lp lq b"> Future&lt;Dynamic&gt;</code>。诀窍是在我们的应用程序中有一个同步函数,它将检索我们的对象，并在准备就绪时更新应用程序的<code class="fe ln lo lp lq b">state</code>。</p><p id="a862" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该函数将类似于:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="15e6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">和以前一样，<code class="fe ln lo lp lq b">await</code>将确保函数的执行处于暂停状态，直到我们从<code class="fe ln lo lp lq b">SharedPreferences.</code>中检索到与键“user”相对应的值。之后，我们从检索到的JSON字符串中创建一个用户对象，并更新应用程序的<code class="fe ln lo lp lq b">State</code>。</p><p id="27a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我创建了一个简单的演示应用程序来展示以上所有内容。下面是这款应用的gif图片:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/bdade47a61d7d6cd30d1c184aaa8f965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OEtb_hGy75G7If-n92t2kQ.gif"/></div></div></figure><p id="ea28" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="6345" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个项目的完整代码可以在这里找到:</p><div class="ne nf gp gr ng nh"><a href="https://github.com/Afonsocraposo/save-sharedpreferences" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">afonscoproso/save-shared preferences</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">github.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv kp nh"/></div></div></a></div></div></div>    
</body>
</html>