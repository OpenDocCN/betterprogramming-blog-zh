<html>
<head>
<title>How to Upload Files to AWS S3 From NextJS App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从NextJS应用程序上传文件到AWS S3</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-upload-files-to-amazon-s3-from-nextjs-app-b7ef1909976b?source=collection_archive---------0-----------------------#2022-04-20">https://betterprogramming.pub/how-to-upload-files-to-amazon-s3-from-nextjs-app-b7ef1909976b?source=collection_archive---------0-----------------------#2022-04-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="71be" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">没有与CORS政策的斗争。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/61157596032b236e4a1ef148e5fda213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_RHWgzILkYYUcF6Zc6EHg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">试图到达不同原点的请求</p></figure><p id="e028" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">NextJS是一个前端框架，由于<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors" rel="noopener ugc nofollow" target="_blank"> CORS </a>策略，前端不能访问不同的源，如果你以错误的方式实现它，实现起来会很乏味。当然，您可以在next.config.js文件中通过从API路由重定向来改变发出的请求，但是使用NextJS无服务器API会失去它的好处。在这篇“快速，切中要点”的文章中，我们将回顾使其工作所需的步骤。</p><p id="e588" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">顺便说一句，如果你喜欢使用现成的代码，你可以在这里找到:</p><div class="lv lw gp gr lx ly"><a href="https://github.com/kolberszymon/NextJS-AWSS3" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">GitHub-kolberszymon/NextJS-AWS S3</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="6b48" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">AWS S3</h1><p id="d970" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">如果你不知道AWS S3是什么，S3主张简单的存储服务，它正是如此。它允许你在亚马逊服务器上在线存储所有不同的文件，并快速安全地检索它们。一个额外的好处是“按规模付费”的商业模式，它让你可以尝试这项服务，如果你的需求不是很大，甚至可以在生产中免费使用。说了这么多，现在让我们来关注为了在我们的web应用程序中使用它，我们必须做些什么。</p><h2 id="5a5d" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 1。创建一个AWS账户</strong></h2><p id="3b9f" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">你可以在控制台<a class="ae lu" href="https://signin.aws.amazon.com/signin?redirect_uri=https%3A%2F%2Fus-east-1.console.aws.amazon.com%2Fconsole%2Fhome%3Ffromtb%3Dtrue%26hashArgs%3D%2523%26isauthcode%3Dtrue%26nc2%3Dh_ct%26region%3Dus-east-1%26skipRegion%3Dtrue%26src%3Dheader-signin%26state%3DhashArgsFromTB_us-east-1_03b40cbc55de739a&amp;client_id=arn%3Aaws%3Asignin%3A%3A%3Aconsole%2Fcanvas&amp;forceMobileApp=0&amp;code_challenge=8TAMgn_aIbyPEHRJdjifEzBL81i23mtVKH-MdAuWjqc&amp;code_challenge_method=SHA-256" rel="noopener ugc nofollow" target="_blank">那里</a>签到。根用户和IAM用户之间的区别在于，根用户的凭据是您注册时使用的凭据，提供了您的卡和帐单详细信息。IAM用户帐户是您为单个AWS服务创建的帐户。总而言之，您希望在那里创建一个root用户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/0e161a8ffedb194a0b4aeb309e4535be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dEVXDiW6TDZ5mPY322lKSQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Amazon登录到控制台页面</p></figure><h2 id="b3bf" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 2。导航到S3 / IAM服务</strong></h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/c8c76cdc798b0c0789c44de264502c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btb6ybC5vVUuqoDZram3VQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">登录后的AWS屏幕</p></figure><p id="b8e0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果是第一次使用AWS，不用担心，很直观。基本上，您可以从一个帐户访问所有服务，您可以从最近访问的服务部分或搜索栏中搜索它们。在本教程中，我们只需要两个服务——S3将为我们提供存储功能，而我将在这里创建访问策略。</p><h1 id="3cc2" class="mu mv it bd mw mx of mz na nb og nd ne jz oh ka ng kc oi kd ni kf oj kg nk nl bi translated"><strong class="ak"> S3又名简单存储服务</strong></h1><h2 id="a9a6" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 1。创建存储桶</strong></h2><p id="d763" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">我们首先要配置的是S3。正如你在下图中看到的，S3致力于“木桶”哲学。你创建一个存储文件的桶。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/af9a07fbf2fe4e75cee55fceb7e8b714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u2e6lXt3pmG2IxSsNQeChg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">桶页</p></figure><p id="9ec4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建bucket时，您可能希望几乎所有内容都保持原样，只有“阻止所有公共访问”选项除外。因为我们希望允许我们的用户公开上传，所以我们将让它空着。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/895e131315c8d6a5dd704eecd45995c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CFotLco_V5iCxwNtdZ-iug.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">将“阻止所有公共访问”选项留空</p></figure><h2 id="f0ae" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 2。桶属性配置</strong></h2><p id="54d0" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated"><strong class="la iu">存储桶策略</strong> —负责管理访问。为了简单起见，我们将它设置为public，这样我们就可以在以后访问资源，而不需要任何不必要的身份验证。配置相当标准。如果你是复制粘贴的话，记得在<code class="fe om on oo op b">YOUR_BUCKET_NAME_HERE</code>的位置插入你的bucket名称(当然你是，我们都是程序员)。</p><pre class="kj kk kl km gt oq op or os aw ot bi"><span id="1906" class="nr mv it op b gy ou ov l ow ox">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Sid": "PublicListGet",<br/>            "Effect": "Allow",<br/>            "Principal": "*",<br/>            "Action": [<br/>                "s3:List*",<br/>                "s3:Get*"<br/>            ],<br/>            "Resource": [<br/>                "arn:aws:s3:::YOUR_BUCKET_NAME_HERE",<br/>                "arn:aws:s3:::YOUR_BUCKET_NAME_HERE/*"<br/>            ]<br/>        }<br/>    ]<br/>}</span></pre><p id="1185" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> CORS — </strong> Cors属性也可以在“权限”选项卡中设置。请随意复制粘贴我的配置，正如您所见，这并不疯狂。我们基本上允许所有的原点访问我们的桶。</p><pre class="kj kk kl km gt oq op or os aw ot bi"><span id="8ac7" class="nr mv it op b gy ou ov l ow ox">[<br/>    {<br/>        "AllowedHeaders": [<br/>            "*"<br/>        ],<br/>        "AllowedMethods": [<br/>            "PUT",<br/>            "POST",<br/>            "GET"<br/>        ],<br/>        "AllowedOrigins": [<br/>            "*"<br/>        ],<br/>        "ExposeHeaders": [<br/>            "ETag"<br/>        ]<br/>    }<br/>]</span></pre><h2 id="b0e8" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated">IAM又名API密钥</h2><p id="8929" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">因为我们要连接亚马逊，我们需要某种认证。我们可以从IAM部分开始。如您所见，我已经创建了一个用户组</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/68b2a7383fc36381b5aaaff64844ed4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CIJEi3j7Rtg4SDTPtrAzYA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户组页面</p></figure><p id="190f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击创建群组，您将能够选择适当的权限。只需选择AmazonS3FullAccess。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/36f8bdfc5c77d99db5dbf23b8248b772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8lQFcceNcM5lxHm8YmyP5g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">设置组权限</p></figure><p id="e7d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">之后，您应该会在面板中看到刚刚创建的群组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/68e09c9d7ea070f93462be9341a9c1b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eRQa57Em0Kv7KSGyiSYTcA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建的组</p></figure><p id="c49e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，我们希望创建一个用户，并为其分配一个刚刚创建的访问组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/6436ec0b82c8ec348255f0007e7d1d4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wqxcm5JGmzjUM2vqNsuBrg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建IAM用户</p></figure><p id="2d80" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">选择编程访问，因为我们希望使用API提升AWS SDK，为此，我们需要API凭证。成功创建用户后，您将能够获取其访问密钥ID和秘密访问密钥。你想要抓住这些，我们将在下一个与下一个JS相关的章节中使用它们。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/050cd745df9a15c0a4cb01877201a934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_e4CvyyezHM1BL4Fdx8tA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用户凭据</p></figure><h1 id="74b6" class="mu mv it bd mw mx of mz na nb og nd ne jz oh ka ng kc oi kd ni kf oj kg nk nl bi translated">下一个JS /前端部分</h1><p id="fdbf" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">唷，我们做了最没意思的工作(对不起AWS管理员，这只是我个人的看法)。现在我们可以回答如何使用前端框架上传文件的问题了。</p><p id="a0f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先也是最重要的是，不要全部是前端。由于我们不能在前端真正拥有环境变量(因为它们都被编译成Javascript代码，并且最终都将在浏览器中可见)，我们将提升NextJS API路由。这基本上是一个简单直观的无服务器解决方案。</p><h1 id="b9dc" class="mu mv it bd mw mx of mz na nb og nd ne jz oh ka ng kc oi kd ni kf oj kg nk nl bi translated"><strong class="ak">工作流程</strong></h1><p id="5e0a" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">那么，我们将如何解决这个问题呢？我们将创建一个API route，它将为我们创建signedUrl，然后我们将向它发出一个PUT请求，传递文件；我们想作为一个主体上传。如果听起来很复杂，只要浏览一下代码，一会儿就会明白得多。</p><h2 id="2b1a" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 1。安装NextJS以及Tailwind CSS和Typescript </strong></h2><p id="bd82" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">我不知道你怎么想，但是我更喜欢用Typescript和Tailwind CSS来处理NextJS。Typescript给了我类型检查，而tailwind让我可以超快地编写CSS，就像服用了类固醇一样。为了省去设置它的麻烦，这里有一个预配置了Typescript和Tailwind的模板，您可以使用:</p><div class="lv lw gp gr lx ly"><a href="https://github.com/vuongddang/nextjs-tailwindcss-typescript-starter" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">GitHub-vuongddang/NextJS-tailwindcss-Typescript-starter:NextJS，TailwindCSS和Typescript…</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">这是一个Next.js 12.x，TailwindCSS 3.x，和TypeScript 4.x的入门模板更多细节请看我的博文。Nextjs…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="pc l mj mk ml mh mm ks ly"/></div></div></a></div><h2 id="0ac3" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 2。安装必要的库</strong></h2><p id="18be" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">为此，我们只需要两个库:</p><ul class=""><li id="c213" class="pd pe it la b lb lc le lf lh pf ll pg lp ph lt pi pj pk pl bi translated"><code class="fe om on oo op b">axios</code>:允许我们发出HTTP请求，</li><li id="4de1" class="pd pe it la b lb pm le pn lh po ll pp lp pq lt pi pj pk pl bi translated"><code class="fe om on oo op b">aws-sdk</code> <strong class="la iu"> : </strong>允许我们使用AWS服务</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pr"><img src="../Images/8b51d0f1e0b728b034babed03c83e1b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*uJus5ZXnhT7olE96EPjBXg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用yarn安装所需的库</p></figure><h2 id="96e6" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 3。创建文件输入</strong></h2><p id="2545" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">下面的代码创建了一个简单的file类型的输入，它允许我们获取一个已经输入的文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/00528e4936877668eca6f7dcf1e7d0a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ONL2xMMeg_LX9KrsbQs5DA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用于创建简单HTML输入的代码</p></figure><p id="9b67" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您是第一次这么做，这就是文件信息在javascript中的存储方式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/11c407eb619c89c2d900ac2b35642d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gvZkkVV5xfImMhaiohMcMw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">输入类型文件输出信息</p></figure><p id="255d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们把它存放在<code class="fe om on oo op b">useState</code>吧。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/43bd5ed35f235161125914878bd052de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*outWAHP44Kxf2veeCPyvCQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">文件使用状态挂钩</p></figure><h2 id="b548" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 4。将AWS中的API密钥存储在. env.local文件中</strong></h2><p id="1d5f" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">还记得我告诉过你，在前端并没有真正安全的存储环境变量吗？我是认真的。但是由于Next JS API是无服务器的，它是我们的后端，我们可以在这里安全地使用它们。任何没有前缀<code class="fe om on oo op b">NEXT_PUBLIC_</code>的环境变量都不会暴露给浏览器。在. env.local文件中创建<strong class="la iu">三个</strong>变量<code class="fe om on oo op b">ACCESS_KEY</code>、<code class="fe om on oo op b">SECRET_KEY</code>和桶名:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/608c0d7b72f2946ce8a195bdb3314cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YDSndeCu8u91fsB3iUPBkw.png"/></div></div></figure><h2 id="6bd4" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 5。设置S3实例和配置属性</strong></h2><p id="5e7d" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">重要的事情先来。您必须导入S3并创建它的一个新实例。如您所见，属性是不言自明的，您必须指定一个区域，传递一个访问密钥和秘密密钥，以及我们将设置为v4的签名版本。在NextJS中，如果你想指定任何不同于默认的主体解析属性，你可以在你必须导出的配置变量中这样做。我们将最大上传文件大小设置为8mb。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/71db5a8ba8b98b24dfb34a757d053bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eddf28eajXzI8u6nP5FAGw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建S3实例并导出配置</p></figure><h2 id="088f" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated">6。创建一个API路由逻辑</h2><p id="4eea" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">首先，我们排除除POST之外的任何其他HTTP方法，然后我们创建s3所需的文件参数来为我们生成一个signedUrl。如你所见，需要一些选项。在POST主体中，我们发送一个名称和我们想要上传的文件的类型。我们还将“expires”时间设置为600秒，并将ACL设置为“public-read ”,这将使该资产可以公开访问。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pw"><img src="../Images/452ad09a088411dd277406e588c300fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZrKRebb4_dprY70yLENPA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">API端点配置</p></figure><h2 id="63b7" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 7。上传文件到AWS S3桶</strong></h2><p id="6658" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated"><em class="px">提示:如果您已经添加了您的。env变量用yarn dev启动一个应用程序后，记得重启它，因为env变量是在应用程序启动时获取的。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi py"><img src="../Images/2ffc38a8bbc32034c6ae76eac3c24e14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IOLNNwltFUhPiKYmMDt6gA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">上传文件并使用先前创建的API端点</p></figure><p id="39bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们首先利用先前创建的<code class="fe om on oo op b">uploadFile</code>端点，向其发送所选文件的名称和类型。然后我们获取允许我们上传文件到AWS的URL。网址看起来像下面的截图。之后，我们向接收到的URL发送一个包含文件的PUT请求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pz"><img src="../Images/6224c89f064b198276651c87c5a4c92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWxZ0uX0UtCju-LtpVbEWw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们从API端点收到的已签名URL的示例</p></figure><p id="3a05" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在URL中的部分直到。com/"是您的存储桶URL。如果您想以后访问它，您可以复制它并将其存储在某个地方。</p><h2 id="eeb4" class="nr mv it bd mw ns nt dn na nu nv dp ne lh nw nx ng ll ny nz ni lp oa ob nk oc bi translated"><strong class="ak"> 8。在您的存储桶中查看上传的文件</strong></h2><p id="edb0" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">现在，您应该可以在桶中看到新添加的文件。我们到此为止。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi qa"><img src="../Images/d79eef5c079d27a64c4b7c12e295dc6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tzF4p0dH5F4Lv3-4NSo0iQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">已成功上传桶中的文件</p></figure><p id="83b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想在HTML中显示一个图像，你可以这样做</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pw"><img src="../Images/ca32a3012c5f6ff6d6a879101ac8545c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N6_o7MgDoR1xBFobpMpALg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">显示保存的图像</p></figure><h1 id="9c18" class="mu mv it bd mw mx of mz na nb og nd ne jz oh ka ng kc oi kd ni kf oj kg nk nl bi translated">摘要</h1><p id="c4d1" class="pw-post-body-paragraph ky kz it la b lb nm ju ld le nn jx lg lh no lj lk ll np ln lo lp nq lr ls lt im bi translated">在本文中，您了解了如何创建一个AWS帐户，以及如何与IAM用户一起创建一个S3 bucket。现在，您还可以创建NextJS应用程序，它将提供将文件上传到您的bucket并显示结果的功能。</p><p id="cc83" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您想获得一个代码，可以从以下网址获得:</p><div class="lv lw gp gr lx ly"><a href="https://github.com/kolberszymon/NextJS-AWSS3" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">GitHub-kolberszymon/NextJS-AWS S3</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">github.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div></div></div>    
</body>
</html>