# 点击删除不是重构

> 原文：<https://betterprogramming.pub/hitting-delete-is-not-refactoring-26739ad44a62>

## 我的战争故事和如何不成为删除迷的建议

![](img/f7f8e45794d8983590373fab68508e23.png)

开发者不会让开发者不必要地删除。

我们都经历过这样或那样的项目。我们的代码库已经变得难以控制，难以使用，难以阅读。不管是因为缺乏纪律、仓促的截止日期、过时/废弃的代码，还是仅仅因为时间的流逝，它都会发生。有时这甚至不是我们的烂摊子，而是我们被别人雇佣，而别人甚至不再问“你到底做了什么，你这个怪物？”。

的确，有不同程度的代码需要重构。也许我们只是需要一点春季大扫除。但是不管怎样，有一点应该很清楚:当我们重构代码时，我们最不想做的事情就是破坏、截断或摧毁我们的软件。

是的，我故意用了截肢和毁灭这两个词。那是因为在将近十年的编码生涯中…我看到了一些东西。就像，激烈的事情。有时我甚至看到了墙上的文字，但就像一个疯狂的人行道预言家一样，我被忽视了，直到为时已晚。

所以注意我的话！把我的恐怖故事记在心里！愿你在为时已晚之前看到光明！

# 目睹一个瘾君子

在我多年前参与的一个项目中，我的团队和几个顾问一起工作，他们(讽刺地)帮助我们重构代码。值得称赞的是，我们确实删除了很多无用的东西，发现了一些根深蒂固的错误，并做出了必要的决定，完全重写了某些超出重构范围的部分。

然而，我意识到我的顾问伙伴也有严重的毒瘾。首选药物: [JetBrains 的 AppCode](https://www.jetbrains.com/objc/) 分析工具。

长话短说，一些工具突出了代码缩减和重构的机会领域，这非常好。然而，其中一个工具突出显示了没有被项目中其他任何东西引用的代码，从而指出**可能是**死代码。它实际上是重构工具带上的一个很好的工具。但锤子也是一样，只要你敲的是钉子，而不是像我的搭档那样漫无目的地猛烈摆动。

也许是看着行数急剧下降的误导性成就感，或者是对不是 [Xcode](https://developer.apple.com/xcode/) 的工具的虚假信任感，因此更加值得信赖。不管怎样，似乎随着我们越走越远，他会越走越快。作为他的搭档，我很难跟上。

最后，我提到也许我们应该放慢速度，我已经有一段时间没有驾驶飞机了；也许我们应该换一下。但是，唉，他陷得太深，无法动摇。此外，他是这里的顾问；显然他更清楚。所以我只是继续观察，随着我的焦虑增加，我开始记下我们将轻松通过但我觉得我需要重新访问的领域。这一节，那一节，是关于“设置”的一瞥但这份名单长达数页，几乎无法重温。

至少我是这么认为的。稍后会有更多的介绍。

我向我的老板甚至老板的老板提出了我的担忧。具体来说，我预测当我们最终与供应商分道扬镳时，我们将花费数月时间来解决新问题。他们相信了我，并向供应商提及此事。然而，他们的 上司(注:查账员)会认为，他们是专家，如果我跟不上甚至**配合**他们的工作，他们就无能为力了。从本质上讲，我最终受到了批评，而不是那位收入比我高的顾问。

## 后果

我们留下了一个具有不完整功能的应用程序，一个我们设置 CI 忽略的单元测试套件，因为它有太多的失败，以及(在最后一天)一个甚至无法构建的项目。花了一周的时间来构建和运行，然后我们开始确定损害范围，以及我们需要做什么来恢复到可发布状态。

最初，我们会去修理某个东西，结果发现另一个东西坏了。有一次，有人发现整个“应用程序设置”功能不见了。这时，我拿出了我的笔记本和我发给上级的那封邮件的复印件。它们，连同一大堆积压的问题，证实了我的揭发和我们必须做的所有重新工作的预测。甚至有我的条目说“可能删除了一些，如果不是全部的话，应用程序设置。”

我被证明是正确的。我得到的回报是，我开始负责修复工作，这最终几乎和一开始的重构工作一样耗时。耶。

# 保持清洁

为了有效地重构，你需要理解什么是重构，目标是什么，以及最佳实践/方法。一个很好的起点是鲍伯·马丁叔叔的原则，他以“[干净代码](http://cleancoder.com/products)”系列闻名，也是[敏捷宣言](https://agilemanifesto.org/)的合著者。他遵循童子军规则“离开一个比你发现的更好的露营地”,并将其应用于编码:

> “总是在比你检查的时候更干净的地方检查一个模块”——鲍伯·马丁叔叔

尤其是在编程方面，没有什么是“免费的”对任何一种工具的依赖，即使它似乎可以检测到人眼可能忽略的东西，也不意味着我们应该盲目地服从它。我们需要接受我们在编码中引入了大量的人的因素，那就是理解上下文。人类编写代码，并能完全阅读/理解代码；机器还不能。

这就引出了我的最后一点建议。重构成功不是由行数和制表符来定义的。成功是任何编码者(不管是不是原作者)都能轻松阅读的代码，并且还能工作。

## 你并不孤单

如果你正在计划你的重构方法或进入一个*时间限制的*重构季节(可能由操作系统更新、停机或在你的回购中实现大规模混乱而触发)，知道你并不孤单。支持是存在的，他们爱你…嗯，他们爱编码，至少希望你的努力成功。

*   如果你在一个团队中，一起制定一个计划，并让每个人都对此负责。这可能意味着结对或者建立频繁的代码审查。
*   出于对一切美好事物的热爱，在一个单独的分支中做这件事。如果你需要的话，可以从那里分支无数次，但是请在你(希望)当前构建的代码和你将要投入的努力之间留一些空间。这也使得对每个参与的人来说，检查、测试和合并变更变得更加容易，并且可以更容易地发现可以一起解决的冲突。
*   读起来！一个完整的支持系统就在你的指尖。例如，在 Medium 上有大量关于重构的文章。此外，还有一些大师写的很棒的书和资源，比如我提到的鲍勃叔叔的书或者马丁·福勒的《[重构](https://martinfowler.com/books/refactoring.html)》。

并且记住，愿编译神永远照耀着你，祝福你。但请注意我的警告，否则你将迷失在通往被屠杀的回购地狱的道路上。