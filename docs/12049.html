<html>
<head>
<title>Visualising Photo Geolocation Data Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python可视化照片地理定位数据</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/visualising-photo-geolocation-data-using-python-73ac47059112?source=collection_archive---------4-----------------------#2022-05-08">https://betterprogramming.pub/visualising-photo-geolocation-data-using-python-73ac47059112?source=collection_archive---------4-----------------------#2022-05-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4d7c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们利用<code class="fe kf kg kh ki b">exif and folium</code> Python包</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/b8af19d69aeccb145ff648fd4d8d413f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d228CRERhS1dn2v1_IzikQ.png"/></div></div></figure><p id="8ec7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">大多数现代GPS相机和手机在拍照时会记录地理位置信息，这些信息会与所有其他元数据一起存储。</p><p id="bcd8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">还有很多通常基于网络的应用程序，允许你使用这些元数据创建各种可视化。但是，如果你像我一样，不信任数据安全级别未知的第三方服务，你的照片怎么办？幸运的是，使用Python复制大多数可视化相对简单。在本指南中，我将展示如何使用照片GPS数据创建旅行地图。</p><p id="83f7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于这个项目，您需要在Python环境中安装一些包。我们将使用两个主要的包:<code class="fe kf kg kh ki b"><a class="ae lr" href="https://pypi.org/project/exif/" rel="noopener ugc nofollow" target="_blank">exif</a></code> <strong class="kx ir"> </strong>将允许我们从照片中提取元数据，我们将使用<code class="fe kf kg kh ki b"><a class="ae lr" href="https://python-visualization.github.io/folium/modules.html" rel="noopener ugc nofollow" target="_blank">folium</a></code>创建一个地图并添加位置标记。最后，我们还将使用来自<code class="fe kf kg kh ki b">matplotlib</code> <strong class="kx ir">、</strong>和<code class="fe kf kg kh ki b">pandas</code> <strong class="kx ir"> </strong>和<code class="fe kf kg kh ki b">numpy</code>的彩色地图进行数据操作。<strong class="kx ir"> </strong>要安装所有必需的软件包，只需在您的终端中执行以下命令:</p><pre class="kk kl km kn gt ls ki lt lu aw lv bi"><span id="d587" class="lw lx iq ki b gy ly lz l ma mb">pip install exif folium pandas numpy matplotlib</span></pre><p id="b60a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将从导入所有必需的包开始。除了上面列出的，我们还将从<code class="fe kf kg kh ki b">pathlib </code>库中导入<code class="fe kf kg kh ki b">json</code>和<code class="fe kf kg kh ki b">Path</code>类，它们都是标准库的一部分。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><h2 id="85f8" class="lw lx iq bd me mf mg dn mh mi mj dp mk le ml mm mn li mo mp mq lm mr ms mt mu bi translated">提取和准备用于打印的元数据</h2><p id="04ed" class="pw-post-body-paragraph kv kw iq kx b ky mv jr la lb mw ju ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">用<code class="fe kf kg kh ki b">exif</code>读取元数据非常容易——我们只需打开一个二进制格式的文件，并从中创建一个<code class="fe kf kg kh ki b">Image</code>对象。让我们为此定义一个便利函数:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="f054" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据不同的设备，一张照片可以包含几十种类型的元数据信息。为了查看那些与地理位置特别相关的内容，我们可以加载一张照片并打印出所有以“<em class="na"> gps_ </em>”开头的元数据类别。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="5f16" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果照片嵌入了地理位置信息，您应该会看到以下输出:</p><pre class="kk kl km kn gt ls ki lt lu aw lv bi"><span id="3f99" class="lw lx iq ki b gy ly lz l ma mb">gps_latitude_ref <br/>gps_latitude <br/>gps_longitude_ref <br/>gps_longitude <br/>gps_altitude_ref <br/>gps_altitude <br/>gps_timestamp <br/>gps_processing_method <br/>gps_datestamp</span></pre><p id="9ba9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">其中有几类比较好理解:<em class="na"> gps_latitude </em>、<em class="na"> gps_longitude </em>和<em class="na"> gps_altitude </em>分别存储纬度、经度和海拔信息。海拔高度存储为海拔高度，通常以米为单位。纬度和经度存储为弧度的度、分和秒的元组。</p><p id="52b9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以<strong class="kx ir"><em class="na">"</em></strong><em class="na">_ ref</em><strong class="kx ir"><em class="na">"</em></strong><em class="na"/>结尾的类别包含有关如何解释数据的参考信息。在海拔高度的情况下，它简单地通知该值是海拔高度，但是对于纬度和经度，它们包含参考半球的信息，经度为"<strong class="kx ir"> E </strong>或"<strong class="kx ir"> W </strong>",纬度为"<strong class="kx ir"> N </strong>或"<strong class="kx ir"> S </strong>"。当将原始数据转换为十进制格式时，这些非常重要，因为标准符号将格林威治以西和赤道以南的坐标作为负数。</p><p id="6b8d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于<em class="na">叶子</em>包<em class="na">，</em>我们将用于绘图，<em class="na"> </em>不理解以度/分/秒为单位的坐标，我们需要将纬度和经度转换为十进制表示，由于我们也将多次这样做，我们可以通过定义一个函数来使生活更轻松，代码更简洁，该函数将接受一个坐标元组和一个参考值，并返回其二进制表示。为此，我们将分和秒分别除以60和3600，转换为度的分数。然后根据参考数据确定符号:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="b624" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个函数将纬度和经度转换成十进制格式，我们不需要对高度做任何事情。这样，我们可以定义另一个helper函数，它将接受一个<code class="fe kf kg kh ki b">exif.Image </code>对象，并返回一个格式为(纬度、经度、高度)的十进制坐标元组。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="73e4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们将添加另一个函数，该函数将递归遍历选定文件夹的所有子文件夹，从所有图像文件中读取空间信息，并返回文件名和坐标的字典。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="1342" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">至此，我们可以轻松地从图像文件夹中的所有文件读取位置数据:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="b849" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打印生成的字典应该会产生类似于我的输出:</p><pre class="kk kl km kn gt ls ki lt lu aw lv bi"><span id="82f1" class="lw lx iq ki b gy ly lz l ma mb">print(json.dumps(res, indent=4))</span><span id="82c1" class="lw lx iq ki b gy nb lz l ma mb"><strong class="ki ir">Out</strong>:</span><span id="9109" class="lw lx iq ki b gy nb lz l ma mb">{     <br/>    "/media/pav/Storage/Photo/Phone/IMAG0036.jpg": {<br/>        "latitude": -37.79912566666666,         <br/>        "longitude": 144.9850463611111,         <br/>        "altitude": 0.0,         <br/>        "timestamp": "2014:04:12 18:14:59"},  <br/>    "/media/pav/Storage/Photo/Phone/IMAG0037.jpg": { <br/>        "latitude": -37.79912566666666,         <br/>        "longitude": 144.9850463611111,         <br/>        "altitude": 0.0,         <br/>        "timestamp": "2014:04:12 18:15:36"},</span><span id="f06d" class="lw lx iq ki b gy nb lz l ma mb">    ...<br/>}</span></pre><h2 id="1df5" class="lw lx iq bd me mf mg dn mh mi mj dp mk le ml mm mn li mo mp mq lm mr ms mt mu bi translated">绘制数据</h2><p id="eb63" class="pw-post-body-paragraph kv kw iq kx b ky mv jr la lb mw ju ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">为了简化未来的操作，我们可以将生成的字典转换成一个<code class="fe kf kg kh ki b">pandas</code>数据帧。然后，我们还将时间戳列转换为<code class="fe kf kg kh ki b">datetime</code>格式，并按日期升序对值进行排序。</p><p id="a129" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了对我们的数据点进行颜色编码，我们可以获得作为<code class="fe kf kg kh ki b">matplotlib</code>包一部分的颜色图。除此之外，我们还需要创建一个<code class="fe kf kg kh ki b">Normalize</code>对象。这个对象将在0和1之间的<code class="fe kf kg kh ki b">colourmap</code>中给每个颜色分配数值，我们可以通过数值调用<code class="fe kf kg kh ki b">colourspace</code>中的任何颜色。为此，我们将使用<code class="fe kf kg kh ki b">numpy.linspace()</code>向我们的<code class="fe kf kg kh ki b">dataframe</code>添加一列。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="0bef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一个小问题是，我们的颜色将是RGBA格式，但它不能与<code class="fe kf kg kh ki b">folium</code>一起工作，所以我们还需要将颜色转换为十六进制表示，这很容易做到:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="bf70" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们终于到了可视化我们的数据的时候了！</p><p id="b6bf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe kf kg kh ki b">folium</code>包的主要部分是<code class="fe kf kg kh ki b">Map</code>对象，简单地通过<code class="fe kf kg kh ki b">folium.Map()</code>创建一个实例将会产生一张整个世界的地图。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nc"><img src="../Images/d7cae17fa67a787e920eb395ee48b370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShdQO_K1ud6Sceh4xhA7yg.png"/></div></div><p class="nd ne gj gh gi nf ng bd b be z dk translated">默认树叶地图。</p></figure><p id="0653" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这很好，但我更喜欢让地图自动缩放到可以看到所有标记的水平。我们可以使用结果对象的<code class="fe kf kg kh ki b">fit_bounds()</code>方法并提供地图范围的西南角和东北角的坐标来实现这一点。</p><p id="57f4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以通过从我们的数据中获取最大纬度和最小经度来计算西南角的坐标。同样，东北角坐标是最小纬度和最大经度。在下面的代码中，我还将边界框在每个方向上调整了3度，这样数据就可以整齐地放入窗口中。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="9a33" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，现在我们终于准备好创建一个地图，显示按拍摄日期进行颜色编码的照片的位置。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="ce1e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我的例子中，结果显示了澳大利亚维多利亚周围的一系列地点，紫色点代表早期照片，亮红色和黄色点代表较新的照片:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/b8af19d69aeccb145ff648fd4d8d413f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d228CRERhS1dn2v1_IzikQ.png"/></div></div></figure><h1 id="bb08" class="nh lx iq bd me ni nj nk mh nl nm nn mk jw no jx mn jz np ka mq kc nq kd mt nr bi translated">结论</h1><p id="dbfe" class="pw-post-body-paragraph kv kw iq kx b ky mv jr la lb mw ju ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">在这里，我们只触及了照片元数据提供的所有机会的一小部分。有了这些数据，你就可以创建自己的照片数据库，方便你对它们进行分类和管理。你也可以扩展地理定位数据的使用，以便能够在你的图像文件夹中按位置搜索照片，还有许多其他可用的东西。</p><p id="359c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个项目的完整代码可以从我的GitHub下载，位置如下:</p><div class="ns nt gp gr nu nv"><a href="https://github.com/pavelcherepan/photo_location" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd ir gy z fp oa fr fs ob fu fw ip bi translated">GitHub-pavelcherepan/photo _ location</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj kt nv"/></div></div></a></div></div></div>    
</body>
</html>