<html>
<head>
<title>How to set up a powerful API with GraphQL, Koa, and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用GraphQL、Koa和MongoDB建立一个强大的API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-setup-a-powerful-api-with-graphql-koa-and-mongodb-339cfae832a1?source=collection_archive---------1-----------------------#2019-01-27">https://betterprogramming.pub/how-to-setup-a-powerful-api-with-graphql-koa-and-mongodb-339cfae832a1?source=collection_archive---------1-----------------------#2019-01-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a4d5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建API很有趣！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eb3f47d114a2f76f9b81566eca8505cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KQneAcO1GBVPIkucIZe41g.png"/></div></div></figure><p id="d73f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">构建API很有趣！尤其是当您可以利用Koa、GraphQL和MongoDB等现代技术时。</p><p id="631f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://koajs.com/Koa" rel="noopener ugc nofollow" target="_blank"> Koa </a>是节点框架，就像Express是节点框架一样。我们将用Koa替换Express，因为Koa在回调中使用async/await语法。</p><p id="4a14" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lr">注；</em>如果你是API的新手，我推荐你通读一下这本书以便开始使用。Kindle版本<a class="ae lq" href="https://amzn.to/2lFHNMM" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h1 id="4466" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">入门指南</h1><p id="0042" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">构建我们的API的先决条件是:</p><ul class=""><li id="d3d4" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">安装的节点</li><li id="923e" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">文本编辑器(我使用Visual Studio代码)</li><li id="1e88" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">末端的</li><li id="c16a" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">浏览器</li></ul><p id="44a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你有你需要的一切，请继续-如果没有，请安装它们。</p><p id="aa12" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开终端并创建一个节点项目，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/5b249af415d08d65cb41fedbfe2eac86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nn7pHMTmNEMZgAI7AYkKqg.png"/></div></div></figure><p id="a24e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到目前为止，我们已经创建了项目文件夹，并初始化了一个新的节点项目。现在我们有了可用的NPM包，可以用来安装Koa、Mongo和GraphQL。</p><p id="bad5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们和NPM一起安装<code class="fe ne nf ng nh b">koa</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="7c1e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">启动新的Koa服务器很简单。我们只需要一个包含以下内容的<code class="fe ne nf ng nh b">server.js</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="0ca7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从节点开始项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/0c747b210438487f13c2ac982e874656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6EnkWrQyherPSgi-ORiXgg.png"/></div></div></figure><h1 id="7ec0" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">安装GraphQL</h1><p id="6547" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">我们需要两个包来用Koa设置graph QL:<code class="fe ne nf ng nh b">koa-mount</code>和<code class="fe ne nf ng nh b">koa-graphql</code></p><p id="7532" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ne nf ng nh b">npm i koa-mount koa-graphql</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/f56c759eba64570290484388108540a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QfUJ22W51T7cVp_QPQY0qg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/525c396499a10b7e31161a1ecf969933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Or8WzLEcgpFFZrfxen0ZRA.png"/></div></div></figure><p id="4478" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">GraphQL要求我们将初始模式传递给GraphQL服务器。让我们创建一个。</p><p id="9f19" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将graphQL模式放在<code class="fe ne nf ng nh b">graphql/schema.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="e83f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将初始的<code class="fe ne nf ng nh b">Query</code>传递给<code class="fe ne nf ng nh b">buildSchema</code>函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="853a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意</strong>:<code class="fe ne nf ng nh b">buildSchema</code>的参数是一个模板文字。如果你不熟悉这篇文章，我鼓励你看一看这篇文章。</p><p id="8df9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们可以将初始模式传递给我们的GraphQL服务器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1a23" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不要忘记导入<code class="fe ne nf ng nh b">koa-mount</code>、<code class="fe ne nf ng nh b">koa-graphql</code>，最后是<code class="fe ne nf ng nh b">schema.js</code></p><p id="aead" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，如果我们转向<code class="fe ne nf ng nh b">localhost:9000/graphql</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/75d607e9961b74ffd18bb6cb6f032f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Upmr4kMaSUBKSmB0srbfmA.png"/></div></div><p class="no np gj gh gi nq nr bd b be z dk translated">GraphQL——在前端查询graph QL的强大工具</p></figure><p id="685f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">瞧啊。初始设置完成。它还不是很有用——理想情况下，我们希望查询GraphQL将数据保存到我们的MongoDB并从那里读取。</p><h1 id="7836" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">设置MongoDB</h1><p id="bfe5" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">为了用GraphQL读写，我们需要一个读取的地方。这就是Mongo派上用场的地方。我们将从那里保存和读取我们的数据。</p><p id="6ce6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了简单起见，我们将为Mongo使用一个云实例。前往<a class="ae lq" href="http://mlab.com/" rel="noopener ugc nofollow" target="_blank">mlab.com</a>并创建一个用户和一个mongo数据库。</p><h1 id="36be" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">创建MongoDB数据库</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/c4c126717e496fef8e8810974cf634ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JW7B8GDjSWItNFIgN_Nktg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/ebc83efbfd4969d808dc1648c82ea122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mkFDmPh6K-hLSU1-nG0ZGw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/4f21f1f83b00ca222db0c2901201e694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DPFZ1EGrDlreRTnpGaiH7Q.png"/></div></div></figure><p id="f8dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦创建了数据库，您将需要一个数据库用户。</p><h1 id="8f5f" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">创建MongoDB用户</h1><p id="7764" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">点击用户选项卡，创建一个新的用户名和密码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/8a36fa0cca564d29f6edf5d2de5ee4c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_fmyduFZc7rq95MCIUH-0A.png"/></div></div></figure><p id="3dae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，您可以使用mongoDB搭配Mongoose。您的数据库的远程url如下所示:</p><p id="7a7f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ne nf ng nh b">mongodb://:@ds213615.mlab.com:13615/koa-graphql</code></p><h1 id="86bb" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">安装猫鼬</h1><pre class="kj kk kl km gt nw nh nx ny aw nz bi"><span id="1d2d" class="oa lt it nh b gy ob oc l od oe">npm i mongoose</span></pre><h1 id="72d2" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">正在创建<code class="fe ne nf ng nh b">database.js</code>文件</h1><p id="271a" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">我们为数据库连接创建一个专用文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="4185" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意</strong>:确保使用数据库的用户名和凭证。</p><p id="2213" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码将尝试连接到远程MongoDB。我们需要找个地方。</p><p id="3fce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开<code class="fe ne nf ng nh b">server.js</code>和<code class="fe ne nf ng nh b">require</code>，调用<code class="fe ne nf ng nh b">initDB</code>方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="f0a3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们做的一切都正确，我们的控制台应该会告诉我们连接成功。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/c7278e9200450acb483a68e6bc5253f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Br5BfGUtQGKI5pK2eOIMpw.png"/></div></div></figure><p id="e70e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">太棒了。</p><p id="2f23" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意到不断刷新服务器有多烦人了吗？让我们用一个叫做<code class="fe ne nf ng nh b">pm2</code>的包来解决这个问题。</p><p id="9175" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://github.com/Unitech/pm2" rel="noopener ugc nofollow" target="_blank"> PM2 </a>是Node.js应用程序的生产流程管理器，内置负载均衡器。它允许您永远保持应用程序的活力，在不停机的情况下重新加载它们，并简化常见的系统管理任务。</p><pre class="kj kk kl km gt nw nh nx ny aw nz bi"><span id="7da5" class="oa lt it nh b gy ob oc l od oe">npm install pm2 -g</span></pre><p id="fe44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将名为<code class="fe ne nf ng nh b">start</code>的脚本添加到我们的<code class="fe ne nf ng nh b">package.json</code>中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/1e1f8e5f6eef1e6f3f6c3535fba6a6d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o40NWntfhRFRH-kcXrYsnA.png"/></div></div></figure><p id="f857" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Pm2在后台运行，解放了我们的终端。如果你想停止这个过程，只需运行<code class="fe ne nf ng nh b">pm2 kill</code>。现在我们不必一直重启服务器，<code class="fe ne nf ng nh b">pm2</code>会自动重启。</p><p id="b0e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意</strong> : <code class="fe ne nf ng nh b">pm2 logs</code>向终端返回控制台日志语句。</p><h1 id="ba08" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">MongoDB模型</h1><p id="415a" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">如果您曾经使用过Mongo，您会意识到MongoDB允许我们为数据创建模型。对于我们来说，这是一个构建数据外观的好方法。</p><p id="d324" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在文件<code class="fe ne nf ng nh b">gadgets.js</code>中为MongoDB模型创建一个文件夹</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="3850" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注意</strong>:在我们的模式中没有ID字段。这是因为Mongoose将默认为所有模式分配一个ID。</p><p id="5bd4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很好，现在让我们添加一个集合和一些虚拟数据。集合名称必须以复数形式映射我们的小工具名称，在本例中为<code class="fe ne nf ng nh b">gadgets</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/f970d9e3926b0cd2a96cd95abac00ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQ4xGbIgW_Y1YEHkfKp0tw.png"/></div></div></figure><p id="50b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建集合后，以JSON格式插入文档，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/e842d86198870fab9d57599336ea8c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOYOtAf7wfy47G0qrnnmIw.png"/></div></div></figure><p id="9e33" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是Mongo的全部内容，现在让我们用GraphQL获取数据。</p><h1 id="f9bf" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">GraphQL查询</h1><p id="e7b2" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">GraphQL也要求我们创建类型——把它想象成计算机的指令。</p><p id="73c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe ne nf ng nh b">graphql/gadgetType.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1708" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意，我们创建了一个graphql类型。在字段内部，我们可以指定给定类型的属性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="e3aa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意我们从graphQL中解构的<code class="fe ne nf ng nh b">GraphQLObjectType</code>和<code class="fe ne nf ng nh b">GraphQLObjectType</code>类型。这些是graphQL的基本类型。</p><p id="b7ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建graphQL类型还允许类型提示，我们将在创建查询时使用它。</p><p id="b895" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要做的最后一件事是重构我们的<code class="fe ne nf ng nh b">schema.js</code>。我们想通过<code class="fe ne nf ng nh b">id</code>查询一个小工具。</p><p id="cd85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将<code class="fe ne nf ng nh b">Gadget</code>型号、<code class="fe ne nf ng nh b">gadgetGraphQLType</code> graphql类型和<code class="fe ne nf ng nh b">GraphQLSchema</code>、<code class="fe ne nf ng nh b">GraphQLObjectType</code>、<code class="fe ne nf ng nh b">GraphQLString</code>从graphql导入到<code class="fe ne nf ng nh b">schema.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="a696" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们需要一个根查询。每个GraphQL查询都以花括号<code class="fe ne nf ng nh b">{}</code>开始——这是根查询。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="dbe2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">瞧啊。在字段内部，我们可以指定<code class="fe ne nf ng nh b">gadget</code>查询。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="85bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意小工具查询中的三个属性:</p><ul class=""><li id="9940" class="mp mq it kw b kx ky la lb ld mr lh ms ll mt lp mu mv mw mx bi translated">type —这是查询的类型，在本例中为<code class="fe ne nf ng nh b">gadgetGraphQLType</code>。</li><li id="3156" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">args —我们可以为graphql查询提供参数，比如:<code class="fe ne nf ng nh b">gadgets(id: "1")</code></li><li id="9fb9" class="mp mq it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated">解析-我们希望如何解析查询？查询完成后会发生什么？这里我们通过id返回小工具<strong class="kw iu">型号</strong>。</li></ul><p id="efc7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，导出它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="31c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">文件<code class="fe ne nf ng nh b">schema.js</code>应该是这样的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="5c26" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在转到<a class="ae lq" href="http://localhost:9000/graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:9000/graph QL</a>进行查询。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="8501" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是我们最终应该得到的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/e7fe383b76d245fb4912a9fd200ed76c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j3Ari8rNjqADKY_FlSXfng.png"/></div></div></figure><p id="ae9b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！❤ <a class="ae lq" href="https://github.com/wesharehoodies/koa-graphql-mongodb/tree/part-1" rel="noopener ugc nofollow" target="_blank">源代码可以在这里找到。</a></p><p id="9e64" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://medium.com/free-code-camp/how-to-set-up-a-powerful-api-with-graphql-koa-and-mongodb-crud-4459fc0720d4?source=---------12------------------" rel="noopener">第二部分</a> —我们将发现突变，以及如何使用GraphQL创建、删除、更新和读取MongoDB中的记录。</p></div></div>    
</body>
</html>