# JavaScript 中的承诺介绍

> 原文：<https://betterprogramming.pub/an-introduction-to-promises-in-javascript-a29bfdad4643>

## 将您从 JavaScript 的异步问题中解救出来

![](img/e9b78143cd8b68c7ce56b1b2dfb17549.png)

由[凯文·Ku](https://unsplash.com/photos/aiyBwbrWWlo)在 [Unsplash](https://unsplash.com/) 上拍摄的照片

如果你对现代 JavaScript 稍有了解，你可能以前听说过承诺。不过，可能会出现你没有真正使用它们的情况。或者你不知道如何或何时使用它们。

承诺用于处理 JavaScript 中的异步操作。它们很容易实现，可以让您避免许多令人头疼的异步问题。当你有多个异步操作时，承诺也可以让你省去处理大量回调的麻烦。当你使用回调的时候，它们会创建一个回调地狱，导致不可管理的代码。幸运的是，承诺是一个很好的选择。

# 回调的问题是

虽然承诺在 JavaScript 中已经存在了几年，但是让我们回到承诺不存在的时代。这将使您更好地理解为什么承诺是处理异步操作的最佳方式。

在承诺出现之前，处理异步操作的一种方法是使用回调——在很长一段时间内，回调是处理异步操作的首选方法。但是回调有其缺点。

让我们看看下面的例子:

如您所见，`loadScript`函数被传递了一个回调参数，该参数在脚本加载时被执行。这很好。尽管这提出了一个大问题:当脚本由于某种原因无法加载时会发生什么？忽视加载脚本可能失败的事实是天真的。

那么我们该如何改进呢？这很简单。我们向回调函数添加了一个新参数，该参数告诉我们脚本是否已经正确加载。

但是，如果我们不依赖于加载一个图像，而是加载三个图像，会发生什么呢？或者更多？

我们将结束的是所谓的*回调地狱*。

# 承诺简介

在我们深入研究承诺以及它们是如何工作的之前，让我们先来看看 [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) 是如何描述承诺的。

> "`**Promise**`对象表示异步操作的最终完成(或失败)及其结果值."

正如 MDN 所提到的，承诺用于处理异步操作。事实上，承诺是以最简单的方式处理异步操作的方法。它们可以轻松处理多个异步操作，并提供比回调和事件更好的错误处理。最重要的是，承诺也增加了代码的可读性。

承诺可以有以下四种状态之一:

1.  **完成**:承诺相关动作成功
2.  **拒绝**:承诺相关动作失败
3.  **待定**:承诺仍待定(尚未履行或拒绝)
4.  **已解决**:承诺已经实现或被拒绝

# 代码中的承诺

如前所述，承诺通常用于更容易地处理异步操作，如 API 调用或文件操作。这些异步操作在`executor`函数内部启动。

如果异步操作成功，调用`resolve`函数返回预期结果。同样，如果在异步操作的执行过程中发生了一些意外错误，结果将由`reject`函数返回。

让我们先来看看如何用 JavaScript 创建一个承诺。

```
new Promise(*executor*);
new Promise(function(resolve, reject) { ... });
```

正如您在上面的例子中看到的，Promise 构造函数接受了一个名为`executor`的函数。这个`executor`函数有两个参数:`resolve` 和`reject`，都是函数。

既然我们知道了承诺是如何产生的，是时候创造一个简单的承诺来帮助我们理解了。

在上面的例子中，我们试图从一个 API 获取一些数据。如果 API 返回 HTTP 状态代码 200，则请求成功。否则，请求失败。

换句话说，如果 HTTP 状态代码是 200，则承诺得到解析。否则，承诺会被拒绝。

那么，我们如何利用我们刚刚创造的承诺呢？

当`resolve`或`reject`被调用时，承诺被确定。在这一点上，链的下一部分得到执行。这通常是一个`then`或`catch`或*。*只能由`executor`调用一次解决或拒绝。承诺的状态改变是最终的，并且`resolve`和`reject`的所有进一步调用都被忽略。

当承诺被解决时，触发`then`回调。也可以链接`then`方法回调。当承诺被拒绝时，执行`catch`回调。`finally` 回调无论成败都调用。

# 所有人和种族

我们还没有复习的最后两个函数是`all`和`race`函数。虽然它们可以派上用场，但你可能比其他 promise 函数用得少。

## 全部

使用`Promise.all`的最佳例子是一次发出多个 AJAX 请求。

## 人种

`Promise.race` 不是等待所有承诺都被解决或拒绝，而是只要数组中的任何承诺被解决或拒绝就触发。

控制台中的输出是“输出:秒！”

请注意，在上面的例子中,`request1`承诺从未得到解决！