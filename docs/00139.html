<html>
<head>
<title>Unit Test Java Architecture Characteristics With This Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用这个框架对Java架构特性进行单元测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/with-this-framework-you-can-unit-test-java-architecture-characterstics-c82b50154dd0?source=collection_archive---------0-----------------------#2018-05-31">https://betterprogramming.pub/with-this-framework-you-can-unit-test-java-architecture-characterstics-c82b50154dd0?source=collection_archive---------0-----------------------#2018-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="266a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">易于使用的架构适应性功能测试</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eea2ed07bf984a18a3d4c6fb498c5d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VNNeZVL_anR3JxQYZeDfoQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/photos/pMnw5BSZYsA?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Hitesh Choudhary </a>在<a class="ae ky" href="https://unsplash.com/search/photos/programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="f300" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名架构师，你不可能总是接近编码。你能看到代码的唯一时间是当你审查别人的代码的时候。</p><p id="9f3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于测试驱动开发、静态代码分析工具(如<a class="ae ky" href="https://pmd.github.io/" rel="noopener ugc nofollow" target="_blank"> PMD </a>和<a class="ae ky" href="https://checkstyle.sourceforge.io/" rel="noopener ugc nofollow" target="_blank"> Checkstyle </a>)和持续集成(CI)管道，您至少可以确保代码、代码质量和代码格式的任何突破性变化都将得到维护。</p><p id="842b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，由于代码覆盖工具，例如<a class="ae ky" href="https://cobertura.github.io/cobertura/" rel="noopener ugc nofollow" target="_blank"> Cobertura </a>，您知道真正经过单元测试的代码的百分比。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ecaa" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一般代码审查</h1><p id="e902" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">即使有了所有这些工具，当我进行代码评审时，我还是会寻找这样的东西:</p><ul class=""><li id="730f" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">任何类都不应该抛出泛型异常。</li><li id="9a25" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">不写入<code class="fe nn no np nq b">System.out</code>(而是使用日志记录)。</li><li id="9874" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">任何类都不应该使用Java util日志记录(<a class="ae ky" href="https://stackoverflow.com/questions/11359187/why-not-use-java-util-logging" rel="noopener ugc nofollow" target="_blank">阅读为什么</a>)。</li><li id="8f54" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">所以持家之道<em class="nr"> </em>类应该在道包中，<code class="fe nn no np nq b">Entities</code>应该驻留在<code class="fe nn no np nq b">Domain</code> <em class="nr"> </em>或<code class="fe nn no np nq b">Model</code> <em class="nr"> </em>包中。</li><li id="a5a4" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">接口不应该放在实现包中。</li><li id="52d3" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">接口类不应该以<em class="nr">接口</em>字开始或结束。</li><li id="2d3f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">分层依赖关系。例如，<code class="fe nn no np nq b">Services</code>不应访问<code class="fe nn no np nq b">Controller</code> <em class="nr"> </em>类，<code class="fe nn no np nq b">DAO/persistence</code> <em class="nr"> </em>类不应访问服务。</li><li id="6182" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">正确使用Java安全包。</li><li id="41cb" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">自觉使用第三方库。</li></ul><p id="d77f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以及其他类似的事情。</p><p id="56da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我并不总是有机会坐在一起检查清单并验证最佳实践。人类的错误是自然的。因此，我在寻找一些可以做这些检查的东西，作为我们CI构建的一部分。</p><p id="6251" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我寻找这种东西的探索在一个名为<a class="ae ky" href="https://www.archunit.org" rel="noopener ugc nofollow" target="_blank"> ArchUnit </a>的库中停止了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="baef" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是ArchUnit？</h1><p id="202d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如ArchUnit网站所述:</p><blockquote class="ns nt nu"><p id="56bd" class="kz la nr lb b lc ld ju le lf lg jx lh nv lj lk ll nw ln lo lp nx lr ls lt lu im bi translated">ArchUnit是一个免费的、简单的、可扩展的库，用于使用任何普通的Java单元测试框架来检查Java代码的架构。</p><p id="93f9" class="kz la nr lb b lc ld ju le lf lg jx lh nv lj lk ll nw ln lo lp nx lr ls lt lu im bi translated">也就是说，ArchUnit可以检查包和类、层和片之间的依赖关系，检查循环依赖关系，等等。它通过分析给定的Java字节码，将所有的类导入到Java代码结构中。</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="322d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何使用ArchUnit</h1><p id="1421" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以使用<a class="ae ky" href="https://maven.apache.org/" rel="noopener ugc nofollow" target="_blank"> Maven </a>在测试范围内添加依赖项，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="db33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果你用的是<a class="ae ky" href="https://gradle.org/" rel="noopener ugc nofollow" target="_blank"> Gradle </a>:</p><pre class="kj kk kl km gt oa nq ob oc aw od bi"><span id="3351" class="oe md it nq b gy of og l oh oi">dependencies {<br/>    testCompile 'com.tngtech.archunit:archunit:0.8.0'<br/>}</span></pre><p id="8bfa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦添加了依赖项，就可以开始为上面提到的规则编写单元测试用例了。</p><p id="9425" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以按原样使用内置的通用规则。这些规则可在以下软件包中找到:</p><pre class="kj kk kl km gt oa nq ob oc aw od bi"><span id="d308" class="oe md it nq b gy of og l oh oi">com.tngtech.archunit.library.GeneralCodingRules</span></pre><p id="dbb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">详情可以在<a class="ae ky" href="https://www.archunit.org/userguide/html/000_Index.html#_general_coding_rules" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d5b2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">编写自己的规则</h1><p id="b7f8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">是的，你可以写你自己的规则。</p><p id="d9f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个架构师或团队领导都可以有自己的规则。好消息是，ArchUnit的API具有足够的可扩展性，可以定义您自己的规则。</p><p id="2053" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阅读<a class="ae ky" href="https://www.archunit.org/userguide/html/000_Index.html#_composing_rules" rel="noopener ugc nofollow" target="_blank">这篇关于如何构建自己的规则的信息</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cea1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">例子</h1><p id="8243" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以查看下面的GitHub repo以了解详细示例:</p><div class="oj ok gp gr ol om"><a href="https://github.com/TNG/ArchUnit-Examples" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">TNG/建筑单位-示例</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">ArchUnit(一个Java架构测试库，用于指定和断言架构规则…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">github.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa ks om"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="af28" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">类似于JUnit</h1><p id="4ee9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这与我们在<a class="ae ky" href="https://junit.org/junit5/" rel="noopener ugc nofollow" target="_blank"> JUnit </a>中的工作非常相似。您可以使用注释来启用或禁用测试。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8b32" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">建筑单位测试</h1><p id="d5db" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">测试类似于在Maven中运行单元测试的方式:</p><pre class="kj kk kl km gt oa nq ob oc aw od bi"><span id="a926" class="oe md it nq b gy of og l oh oi">mvn test</span></pre><p id="cf16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果你用的是Gradle:</p><pre class="kj kk kl km gt oa nq ob oc aw od bi"><span id="248f" class="oe md it nq b gy of og l oh oi">gradle test</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="707b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="8405" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我认为这是实施精益架构的良好开端。</p><p id="cbb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近我写了关于<a class="ae ky" href="https://medium.com/@tanmay.avinash.deshpande/here-is-a-simple-yet-powerful-tool-to-record-your-architectural-decisions-5fb31367a7da" rel="noopener">轻量级架构决策记录</a> (LADRs)。它与ArchUnit密切相关。</p><div class="oj ok gp gr ol om"><a href="https://medium.com/@tanmay.avinash.deshpande/here-is-a-simple-yet-powerful-tool-to-record-your-architectural-decisions-5fb31367a7da" rel="noopener follow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">这里有一个简单而强大的工具来记录你的架构决策</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">自从我接手技术架构师的角色以来，我总是被这样的想法逗乐，为什么…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">medium.com</p></div></div><div class="ov l"><div class="pb l ox oy oz ov pa ks om"/></div></div></a></div><p id="cdf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你尝试这个，请让我知道你的经历。</p></div></div>    
</body>
</html>