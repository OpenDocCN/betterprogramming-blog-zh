<html>
<head>
<title>Increase Your Productivity With Automated Browser Tests Using Node and Playwright</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node和剧作家，通过自动化浏览器测试提高您的工作效率</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/increase-your-productivity-with-automated-browser-tests-using-node-and-playwright-e904962b83a0?source=collection_archive---------7-----------------------#2020-09-28">https://betterprogramming.pub/increase-your-productivity-with-automated-browser-tests-using-node-and-playwright-e904962b83a0?source=collection_archive---------7-----------------------#2020-09-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="66e9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">当用一个无头浏览器和Node.js测试你的应用程序时，什么、为什么和如何</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c54fb73f12b3326194ca6551407ba408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5M5QLBcUBUnNTIa6"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@richygreat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Richy Great </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="30cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无头浏览器擅长快速执行JavaScript代码，并在不同设备上模拟点击或悬停页面上的元素。在测试网络活动、模拟网络请求和测试不同的地理位置时，无头浏览器也非常有用。</p><p id="65fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你想做以上所有事情的原因是，在你把你的代码投入生产之前，要确保所有的事情都按照预期的那样工作。</p><p id="e371" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以编写UI测试并将其集成到您的构建过程中，而不是手动浏览每个页面并检查错误。</p><p id="5e15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您为交互编写代码，比如单击或悬停在页面上的元素上。无头浏览器在后台自动运行，并在整个过程的不同点生成截图。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="637d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">无头浏览器很快</h1><p id="f2f7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">无头浏览器通常比真正的浏览器更快。因为您没有启动浏览器GUI，所以您可以跳过真正的浏览器加载CSS和JavaScript以及呈现HTML的时间。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b3bd" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">何时不使用无头浏览器</h1><p id="4bb5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">以下是您可能不决定使用无头浏览器的几个原因。</p><ul class=""><li id="6f32" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">你需要模仿真实的用户。当你运行无头测试时，你并没有真正模仿真实的用户体验。你只需点击鼠标，确保代码按预期运行。</li><li id="ac41" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">您的最终用户或客户没有使用无头浏览器。你不会想关注那些只发生在无头模式下的错误。</li><li id="bf68" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">如果您需要进行大量的浏览器调试，那么无头模式对于调试来说是一个很大的挑战。</li></ul><p id="c2d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编写无头浏览器测试有多种解决方案。今天我们要去看看<a class="ae ky" href="https://github.com/microsoft/playwright" rel="noopener ugc nofollow" target="_blank">剧作家</a>图书馆。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f9e8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么要用剧作家？</h1><p id="5fc0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">剧作家是一个Node.js库，用一个API来自动化<a class="ae ky" href="https://www.chromium.org/Home" rel="noopener ugc nofollow" target="_blank"> Chromium </a>、<a class="ae ky" href="https://www.mozilla.org/en-US/firefox/new/" rel="noopener ugc nofollow" target="_blank"> Firefox </a>和<a class="ae ky" href="https://webkit.org/" rel="noopener ugc nofollow" target="_blank"> WebKit </a>。剧作家库是为了实现跨浏览器的web自动化而构建的，它经久不衰、功能强大、可靠且快速。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/2c1524258236819a7c6c1e1d643e7486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cDhRryISYdw96-XW3k16ZA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">剧作家是一个无头浏览器测试库—<a class="ae ky" href="https://github.com/microsoft/playwright" rel="noopener ugc nofollow" target="_blank">https://github.com/microsoft/playwright</a></p></figure><p id="a2ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剧作家让你自动化和测试单页应用程序和渐进式网络应用程序使用的广泛和不断增长的网络浏览器功能。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9ebc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">以下是剧作家库中包含的内容</h1><ul class=""><li id="ff08" class="mz na it lb b lc mu lf mv li no lm np lq nq lu ne nf ng nh bi translated">测试跨多个页面、域和iframes的场景</li><li id="c222" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">自动等待元素准备就绪后再执行操作(如单击、填充)</li><li id="381d" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">拦截网络活动以阻止和嘲弄网络请求</li><li id="816f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">模拟移动设备、地理位置、权限</li><li id="6590" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">通过阴影穿透选择器支持web组件</li><li id="76c0" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">鼠标和键盘的本机输入事件</li><li id="9f53" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">测试文件上传和下载按预期工作</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dee3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><p id="c872" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们假设您已经安装了节点。(如果没有也没关系，去<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">官方Node.js网站</a>下载安装。)</p><p id="1b86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们为项目创建一个文件夹，并在文件夹中初始化一个新的节点项目。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="815f" class="nw md it ns b gy nx ny l nz oa">mkdir playright-example &amp;&amp; cd playright-example &amp;&amp; npm init -y</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/41a4e598dab8b8c3892d33a596ef16d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TWlJFUhFRecPNDyPMBhrjA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建新的节点项目</p></figure><p id="3a60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们建立了节点项目，让我们开始编写无头浏览器测试。为了做到这一点，我们需要安装剧作家库并创建一个名为<code class="fe oc od oe ns b">index.js</code>的文件，我们在其中编写测试代码。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="195c" class="nw md it ns b gy nx ny l nz oa">touch index.js &amp;&amp; npm i -D playwright</span></pre><p id="3b8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将为Chromium、Firefox和WebKit安装剧作家和浏览器二进制文件。安装后，您可以导入剧作家库。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c13e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">编写无头浏览器测试</h1><p id="a435" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了简单起见，对于我们的第一个无头浏览器测试，我们转向<code class="fe oc od oe ns b">whatsmyuseragent.org</code>并截取页面截图。</p><p id="0228" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oc od oe ns b">whatsmyuseragent.org</code>是一个显示你的用户代理版本和数据，以及你的IP地址的网站。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/e522d099190c0d228f67b5c886b3e8f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NyciWJg16GNV_1H12XmNYA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="http://whatsmyuseragent.org/#page-top" rel="noopener ugc nofollow" target="_blank"> <strong class="bd og">我的用户代理是什么？</strong>T9】</a></p></figure><p id="d86e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个代码示例，展示了我们如何自动化访问网站和制作屏幕截图的过程。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="a2c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oc od oe ns b"><a class="ae ky" href="https://playwright.dev/#version=v1.4.1&amp;path=docs%2Fapi.md&amp;q=class-browser" rel="noopener ugc nofollow" target="_blank">Browser</a></code>指的是Chromium、Firefox或WebKit的一个实例。剧作家脚本通常以启动浏览器实例开始，以关闭浏览器结束。</p><p id="2c55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">浏览器实例可以在headless(没有GUI)或headful模式下启动。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="9cad" class="nw md it ns b gy nx ny l nz oa">const { chromium } = require('playwright');  // Or 'firefox' or 'webkit'.</span></pre><p id="2c1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意我们如何使用所有三个主要的浏览器引擎:WebKit、Firefox和Chromium。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2b1b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">运行无头浏览器测试</h1><p id="4bd3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了执行测试，我们需要做的就是用Node执行文件。在终端中运行以下代码。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="c0e5" class="nw md it ns b gy nx ny l nz oa">node index.js</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/ab287ef65fb8811284eb43fb9b776d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*soO05m8yApXw0ipRsisMtg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Node.js运行无头浏览器测试</p></figure><p id="f0a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您运行测试，您应该看到三个浏览器弹出，然后，不久，关闭。如果是这样的话，测试运行成功。</p><p id="59ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意三个新文件是如何出现在项目中的。这三个文件是每次浏览器测试的截图:<code class="fe oc od oe ns b">example-chromium.png</code>、<code class="fe oc od oe ns b">example-webkit.png</code>和<code class="fe oc od oe ns b">example-safari.png</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/55f650368dbdc5dade6be53b397312b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rg-GO-3fl19vnx_w2xnT_A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">运行测试时，制作了三个屏幕截图</p></figure><p id="10c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果测试运行成功，我们应该会看到如下截图。</p><div class="kj kk kl km gt ab cb"><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/ebefc7f07499bcfc6f9b764bfd812513.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*nu5mypl4L7TogL0K7GEVaA.png"/></div></figure><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/553433c335ae53eac1ec3def84c50d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*2TYcWBLM7Ujpxzls9qbkSQ.png"/></div></figure><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/321344a8ef3f8fe5a049f2f3e4cb0032.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*H1dxkQEdOsH4GvnpsAZ2-Q.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk or di os ot translated">每个浏览器引擎及其用户代理的屏幕截图</p></figure></div><p id="e839" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个浏览器引擎在呈现HTML和在屏幕上绘制CSS方面都有自己的特点。想象一下，当我们想要确保应用程序布局在所有设备和不同浏览器上都能工作时，自动化浏览器测试会有多有用。</p><p id="6ab2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你好奇的话，<a class="ae ky" href="https://github.com/indreklasn/playwright-example" rel="noopener ugc nofollow" target="_blank">这里是示例的源代码</a>。</p></div></div>    
</body>
</html>