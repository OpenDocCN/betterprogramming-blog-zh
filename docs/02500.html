<html>
<head>
<title>Simplified Docker Image Builds for Java Microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向Java微服务的简化Docker映像构建</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/simplified-docker-image-builds-for-java-microservices-316648e0de81?source=collection_archive---------8-----------------------#2019-12-04">https://betterprogramming.pub/simplified-docker-image-builds-for-java-microservices-316648e0de81?source=collection_archive---------8-----------------------#2019-12-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="770f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Jib——来自Google的开源Java容器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f7070099fea35bb3bf978b1b32bccc65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8e-LAbw1P2WUIj7IT2GhiQ.png"/></div></div></figure><p id="3233" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到目前为止，我们中的许多人已经在使用<a class="ae lq" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>来部署Java应用程序/微服务。为什么不呢？如今，它已经成为应用程序部署的事实标准。</p><p id="5e59" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，人们需要正确地学习和理解Docker来实现最佳实践。我们中的许多人迷失在Dockerfile文件的复杂性中。</p><p id="d61c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这篇文章中，我将谈论一个非常酷的开源项目，它允许我们使用简单的<a class="ae lq" href="https://maven.apache.org/" rel="noopener ugc nofollow" target="_blank"> Maven </a> / <a class="ae lq" href="https://gradle.org/" rel="noopener ugc nofollow" target="_blank"> Gradle </a>构建来构建和部署dockerized Java应用程序。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="50b3" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">典型的Java应用程序停靠化过程</h1><p id="bcf4" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">如果您是一名Java开发人员，并且想要将您的应用程序dockerize，您倾向于遵循以下步骤:</p><ol class=""><li id="f81e" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">使用Maven/Gradle build构建一个胖罐子。</li><li id="674a" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">写一个Dockerfile文件。</li><li id="1d2d" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">从Docker文件构建一个映像。</li><li id="45ab" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">将图像推送到容器注册表。</li></ol><p id="72d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为一名Java开发人员，第一步非常简单，但是到了下一步，我们大多数人都依赖于互联网上的内容。典型的docker文件可能如下所示:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="9a0c" class="no lz it nk b gy np nq l nr ns">FROM open-jdk:8-jdk-alpine <br/>COPY target/myapp-*.jar /app.jar<br/>ENTRYPOINT java -jar /app.jar</span></pre><p id="c6cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我使用这个Docker文件，我将能够构建并使用我的应用程序的Docker映像，但是这可能不是我能够构建的最有效的映像。</p><p id="ff61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我在互联网上搜索得更多，我也许可以通过遵循<a class="ae lq" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices" rel="noopener ugc nofollow" target="_blank"> Dockerfile最佳实践</a>来改进Dockerfile。</p><p id="7dd1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上述Dockerfile文件存在各种问题。</p><ol class=""><li id="452b" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">这是使用JDK基础映像而不是JRE。运行应用程序时，JRE是必需的，而不是JDK。如果我们改变这一点，那么我们将能够大大减少图像的大小。JRE映像大约是55 MB，而JDK映像是192 MB。</li><li id="8030" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">该应用程序是使用fat jar构建的，这意味着在Docker映像中将只为该应用程序创建一个层。如果我们做了任何更改，那么每次我们推送app的整个层时，都需要重新构建。我们可以通过将依赖项和应用程序代码分离到不同的层来改进这一点。您可以使用下面的maven命令来分离依赖项:<code class="fe nt nu nv nk b">mvn dependency:copy-dependencies -DoutputDirector=target/dependencies</code>。</li></ol><p id="995d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，经过改进后，docker文件将如下所示:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="6356" class="no lz it nk b gy np nq l nr ns">FROM open-jdk:8-jre-alpine <br/>COPY target/dependencies /app/dependencies<br/>COPY target/resources /app/resources<br/>COPY target/classes /app/classes<br/>ENTRYPOINT java -cp /app/dependencies/*:/app/resources/:/app/classes hello.Application</span></pre></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="c28b" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">Jib简介</h1><p id="7966" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">Jib是来自Google的开源Java容器，它允许开发者从Maven/Gradle构建中构建他们的Java应用程序的Docker映像。</p><p id="1011" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如上所述，如果您不熟悉最佳实践，Docker映像构建是一个复杂的过程。Jib试图解决这个问题，但是提供了一个Maven和Gradle构建插件。</p><p id="da08" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，如果您必须构建一个Java应用程序的Docker映像，您只需要做两件事。</p><ol class=""><li id="f58f" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">在<code class="fe nt nu nv nk b">pom.xml</code>中添加Maven依赖项。</li></ol><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="5ee3" class="no lz it nk b gy np nq l nr ns">&lt;plugin&gt;</span><span id="bde9" class="no lz it nk b gy nw nq l nr ns"> &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;</span><span id="c810" class="no lz it nk b gy nw nq l nr ns"> &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;</span><span id="af69" class="no lz it nk b gy nw nq l nr ns"> &lt;version&gt;1.8.0&lt;/version&gt;</span><span id="9cc3" class="no lz it nk b gy nw nq l nr ns">   &lt;configuration&gt;</span><span id="897c" class="no lz it nk b gy nw nq l nr ns">   &lt;to&gt;</span><span id="a98a" class="no lz it nk b gy nw nq l nr ns">   &lt;image&gt;&lt;path-to-container-registry&gt;/hello-jib&lt;/image&gt;</span><span id="ef02" class="no lz it nk b gy nw nq l nr ns">   &lt;/to&gt;</span><span id="f3a1" class="no lz it nk b gy nw nq l nr ns">  &lt;/configuration&gt;</span><span id="c167" class="no lz it nk b gy nw nq l nr ns">&lt;/plugin&gt;</span></pre><p id="cdeb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">2.运行以下命令:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="61d4" class="no lz it nk b gy np nq l nr ns">mvn compile jib:build</span></pre><p id="4fb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将在内部应用Docker最佳实践，将您的应用程序分成多个层，构建映像，并推送到容器存储库。</p><h2 id="0533" class="no lz it bd ma nx ny dn me nz oa dp mi ld ob oc mk lh od oe mm ll of og mo oh bi translated">起重臂的好处</h2><p id="57b2" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">使用Jib有各种好处。</p><ul class=""><li id="a67c" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp oi nb nc nd bi translated">作为一名Java开发人员，我需要做的就是专注于Java，不要为Docker的复杂性而烦恼。</li><li id="1e4e" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp oi nb nc nd bi translated">因为这是Maven/Gradle构建的一部分，所以实现和部署很快。</li><li id="a82b" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp oi nb nc nd bi translated">因为Jib使用Docker最佳实践，所以构建的图像是轻量级的、标准的和分层的。</li><li id="0ba4" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp oi nb nc nd bi translated">您不需要Docker守护进程来创建和推送Docker映像。</li></ul><h2 id="cfd9" class="no lz it bd ma nx ny dn me nz oa dp mi ld ob oc mk lh od oe mm ll of og mo oh bi translated">码头工人与起重臂</h2><p id="e75a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">下面是两种方法直接比较的一些结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/fd7fbd6a322f8e6a6e4a5dc5ae2f76ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D05mV97WSp6v3g6adiLCXg.png"/></div></div><p class="ok ol gj gh gi om on bd b be z dk translated"><a class="ae lq" href="https://speakerdeck.com/coollog/build-containers-faster-with-jib-a-google-image-build-tool-for-java-applications?slide=51" rel="noopener ugc nofollow" target="_blank">https://speaker deck . com/cool log/build-containers-faster-with jib-a-Google-image-build-tool-for-Java-applications？slide=51 </a></p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/1df0156f7831939dd604f311c7f1ef13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u2tsgERJxtNIsSFQJuXcBg.png"/></div></div><p class="ok ol gj gh gi om on bd b be z dk translated"><a class="ae lq" href="https://speakerdeck.com/coollog/build-containers-faster-with-jib-a-google-image-build-tool-for-java-applications?slide=52" rel="noopener ugc nofollow" target="_blank">https://speaker deck . com/cool log/build-containers-faster-with jib-a-Google-image-build-tool-for-Java-applications？slide=52 </a></p></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="31bd" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">参考</h1><ol class=""><li id="5ee6" class="mv mw it kw b kx mq la mr ld op lh oq ll or lp na nb nc nd bi translated"><a class="ae lq" href="https://speakerdeck.com/coollog/build-containers-faster-with-jib-a-google-image-build-tool-for-java-applications" rel="noopener ugc nofollow" target="_blank">https://speaker deck . com/cool log/build-containers-faster-with-jib-a-Google-image-build-tool-for-Java-applications</a></li><li id="76da" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated"><a class="ae lq" href="https://github.com/GoogleContainerTools/jib" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleContainerTools/jib</a></li></ol></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="2640" class="no lz it nk b gy np nq l nr ns">Hey, if you enjoyed this story, check out <a class="ae lq" href="https://deshpandetanmay.medium.com/membership" rel="noopener">Medium Membership</a>! Just $5/month!</span><span id="f0ce" class="no lz it nk b gy nw nq l nr ns"><em class="os">Your membership fee directly supports me and other writers you read. You’ll also get full access to every story on Medium.</em></span></pre></div></div>    
</body>
</html>