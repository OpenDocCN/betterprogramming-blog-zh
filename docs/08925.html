<html>
<head>
<title>Automate Manual Commit Tasks With Git Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Git挂钩自动化手动提交任务</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/automate-manual-commit-tasks-with-git-hooks-7642ecf05ffa?source=collection_archive---------11-----------------------#2021-06-25">https://betterprogramming.pub/automate-manual-commit-tasks-with-git-hooks-7642ecf05ffa?source=collection_archive---------11-----------------------#2021-06-25</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="9463" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">一个有用的Git预提交钩子集合</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/98e1992dc81d34a7f1c5657cb1c9e710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xvTQ1EVhEAc9lp-O"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@brookanderson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布鲁克·安德森</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</p></figure><p id="9ea7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://git-scm.com/docs/githooks" rel="noopener ugc nofollow" target="_blank"> Git挂钩</a>在将代码变更提交到代码库之前，在识别简单问题方面发挥着重要作用。此外，将相关信息添加到提交消息中以确保更容易跟踪问题也是一个很好的做法。</p><p id="0936" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">手动添加分支名称等详细信息并验证不存在尾随空格是重复的手动任务。Git挂钩提供了一种自动化流程的便捷方式。您可以配置钩子来自动添加必要的信息，并检查您的代码是否符合项目的标准。</p><p id="45fb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在本文中，我将向您展示几个有用的提交挂钩，您可以轻松地将它们添加到您的存储库中。这样，您就可以节省时间来专注于您的开发工作。</p><p id="061a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">本文假设您已经理解了什么是Git挂钩。如果你是初学者，想了解更多，请查看上面链接的文档。</p><p id="3387" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们开始吧！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="8424" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">预提交</h1><p id="83ad" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">如果你已经熟悉Git钩子，你会知道当你创建一个新的存储库时，你必须将所有钩子复制到新项目的<code class="fe na nb nc nd b">.git/hook</code>文件夹中。您还必须手动更改挂钩，以确保它们适用于不同的项目结构。用Python编写的库<code class="fe na nb nc nd b"><a class="ae kz" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">pre-commit</a></code>为这个问题提供了一个方便的解决方案。</p><p id="8032" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以在一个配置文件中指定一个挂钩列表。您可以将它用于各种语言来解决不同的任务，例如检测AWS凭证、大文件、尾随空白、验证JSON、XML语法等等。</p><p id="9d03" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它自动处理任何钩子的安装和执行。</p><p id="e7e3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">运行以下命令进行安装:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="6d79" class="ni me iu nd b gz nj nk l nl nm">pip install pre-commit</span></pre><p id="4bb2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在项目的根目录下创建一个名为<code class="fe na nb nc nd b">.pre-commit-config.yaml</code>的文件。在这里，您可以包含所有您想要的挂钩。</p><p id="657c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">示例配置:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="ee81" class="ni me iu nd b gz nj nk l nl nm">repos:<br/>-   repo: <a class="ae kz" href="https://github.com/pre-commit/pre-commit-hooks" rel="noopener ugc nofollow" target="_blank">https://github.com/pre-commit/pre-commit-hooks</a><br/>    rev: v3.2.0<br/>    hooks:<br/>    -   id: check-executables-have-shebangs<br/>    -   id: trailing-whitespace<br/>    -   id: mixed-line-ending<br/>    -   id: check-xml</span></pre><p id="e928" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">查看<a class="ae kz" href="https://github.com/pre-commit/pre-commit-hooks" rel="noopener ugc nofollow" target="_blank">文档</a>，看看有哪些钩子可供选择。对于各种语言有许多方便的挂钩。</p><p id="b4db" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在您的存储库文件夹中运行以下命令来安装挂钩:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="214f" class="ni me iu nd b gz nj nk l nl nm">pre-commit install</span></pre><p id="62d0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您应该会看到以下输出:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="7141" class="ni me iu nd b gz nj nk l nl nm">pre-commit installed at .git/hooks/pre-commit</span></pre><p id="51a7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您想在所有文件上快速测试它，请运行以下命令:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="43f0" class="ni me iu nd b gz nj nk l nl nm">pre-commit run --all-files</span></pre><p id="d127" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我为这个演示创建了一个无效的<code class="fe na nb nc nd b">xml</code>和<code class="fe na nb nc nd b">sh</code>文件，所以让我们看看钩子是否能检测到问题:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nn"><img src="../Images/cf971e8e06544fd73d3603755cb1cf72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aI4YL8zspFaHRtLx0kX-aw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">提交前挂钩演示</p></figure><p id="d8af" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">完美！钩子确定了所有的问题。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="3883" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">智能提交</h1><p id="897c" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated"><a class="ae kz" href="https://awesomeopensource.com/project/sbimochan/smart-commit" rel="noopener ugc nofollow" target="_blank">智能提交</a>用当前分支名称为每个提交添加前缀。</p><p id="b364" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在根存储库中运行以下命令来安装挂钩:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="a548" class="ni me iu nd b gz nj nk l nl nm">sudo curl https://raw.githubusercontent.com/sbimochan/smart-commit/master/commit -o /usr/local/bin/commit &amp;&amp; sudo chmod +x /usr/local/bin/commit</span></pre><p id="f769" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们来看看它的实际应用:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj gk"><img src="../Images/f628ccb7e019a5a2cc7f56c5a3256033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*odgH7dWboPtbp89bchdqyA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">智能提交演示</p></figure><p id="4b30" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以看到，我已经创建了一个名为“DEMO-123”的分支，并编辑了一个文件。<code class="fe na nb nc nd b">commit</code>命令自动将分支名称插入提交消息中。</p><p id="6ca0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您需要将分支名称附加到每个提交中，这个钩子将会很有帮助。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="7a96" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">Git确认</h1><p id="9a51" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated"><a class="ae kz" href="https://awesomeopensource.com/project/pimterry/git-confirm" rel="noopener ugc nofollow" target="_blank"> Git Confirm </a>检查你是否有任何占位符或者临时修改，比如修改后的文件中的“TODO”注释。这可以防止你无意中犯下尚未准备好的事情。</p><p id="9686" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在项目的根存储库中运行以下命令来安装挂钩:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="1b67" class="ni me iu nd b gz nj nk l nl nm">curl https://cdn.rawgit.com/pimterry/git-confirm/v0.2.2/hook.sh &gt; .git/hooks/pre-commit &amp;&amp; chmod +x .git/hooks/pre-commit</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nn"><img src="../Images/afa4ac082977ecbb9333578ef766deed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dZKrt0AU6kQxnz5CjgDdg.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Git确认挂钩演示</p></figure><p id="6489" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你可以从上面的截图中看到，这个钩子让我们决定是否要包含这个文件。</p><p id="cb11" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">默认模式是“TODO”您可以定制配置以包含更多的模式，例如“FIXME”等。</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="fda8" class="ni me iu nd b gz nj nk l nl nm">git config --add hooks.confirm.match "FIXME"</span></pre><p id="3398" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，所有模式都区分大小写。</p><p id="3049" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">提示:如果您想跳过本地安装的钩子，运行带有<code class="fe na nb nc nd b">no-verify</code>标志的commit命令:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="42f8" class="ni me iu nd b gz nj nk l nl nm">git commit -m 'commit message' — no-verify</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="9a74" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">自定义提交消息检查器</h1><p id="05e5" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">我们现在要创造我们自己的钩子了。</p><p id="0476" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在许多情况下，在提交消息中包含票证编号是有意义的。</p><p id="f5cc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以通过使用以下代码轻松实现这一点:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="6b13" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">示例regex模式检查以“PROJ-”开头的票据编号是否出现在提交的开始行中。</p><p id="32a3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">将这段代码粘贴到位于您的存储库的<code class="fe na nb nc nd b">.git/hooks</code>路径下的<code class="fe na nb nc nd b">commit-msg</code>文件中。如果你从未使用过<code class="fe na nb nc nd b">commit-msg</code>钩子，从文件中移除<code class="fe na nb nc nd b">.sample</code>扩展名来激活它。</p><p id="a8fa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们尝试提交一条不符合要求的消息:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nq"><img src="../Images/7efa90c2866b048638c5e368347caff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kARCJgnWYUvHbMO6jSQjew.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">票号检查钩</p></figure><p id="7cf1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，您可以确保每个提交都包含一个票号。这使得将来搜索Git历史更加容易。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="8e35" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">Git良好的提交</h1><p id="1a8c" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">如果您想要更复杂的东西，请查看一下<a class="ae kz" href="https://awesomeopensource.com/project/tommarshall/git-good-commit" rel="noopener ugc nofollow" target="_blank"> Git Good Commit </a>钩子。它会验证您的提交消息是否满足某些要求，比如将标题大写，避免单个单词的提交，将主题行限制在50个字符以内，等等。</p><p id="e451" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">安装命令:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="dd78" class="ni me iu nd b gz nj nk l nl nm">curl https://cdn.rawgit.com/tommarshall/git-good-commit/v0.6.1/hook.sh &gt; .git/hooks/commit-msg &amp;&amp; chmod +x .git/hooks/commit-msg</span></pre><p id="7635" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这可能有点严格，但是如果您希望所有的提交消息都遵循一个单一的标准并且更加一致，这是很方便的。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nr"><img src="../Images/6415c22a8fa50622bfbd1e8b89491b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pdOZxslfXKHTT3Zo418hsw.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">Git良好提交演示</p></figure><p id="e7d3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">正如您所看到的，钩子使您能够以内联方式编辑提交消息，继续进行更改，或者中止提交。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="1e11" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="df46" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在本文中，您看到了一系列强大的Git挂钩，它们自动化了一些最常见的提交任务。</p><p id="1a62" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有时候，鼓励团队中的每个人使用Git挂钩是很有挑战性的。这些工具应该可以减轻开发人员的工作，所以值得一试，直到您找到与您的项目最相关的挂钩。</p><p id="0ba3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你想知道如何与其他队友分享你的Git钩子，<a class="ns nt ep" href="https://medium.com/u/50792fd0a988?source=post_page-----7642ecf05ffa--------------------------------" rel="noopener" target="_blank">查米卡·卡森</a>写了<a class="ae kz" href="https://chamikakasun.medium.com/how-to-share-git-hooks-with-the-team-37424603dd91" rel="noopener">一篇关于这个话题的简短而全面的文章</a>。如果你有Git<a class="ae kz" href="https://raw.githubusercontent.com/git/git/master/Documentation/RelNotes/2.9.0.txt" rel="noopener ugc nofollow" target="_blank">2.9</a>或更高版本，他描述了如何将<code class="fe na nb nc nd b">core.hooksPath</code>配置变量设置到你的托管钩子目录。</p><p id="e84c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您对更多Git主题感兴趣，您可能会喜欢我的相关文章:</p><div class="nu nv gq gs nw nx"><a rel="noopener  ugc nofollow" target="_blank" href="/10-handy-git-stash-commands-to-manage-your-code-efficiently-39ddc3d6f324"><div class="ny ab fp"><div class="nz ab oa cl cj ob"><h2 class="bd iv gz z fq oc fs ft od fv fx it bi translated">10个方便的Git-Stash命令来有效地管理您的代码</h2><div class="oe l"><h3 class="bd b gz z fq oc fs ft od fv fx dk translated">从基础到高级git-stash用例</h3></div><div class="of l"><p class="bd b dl z fq oc fs ft od fv fx dk translated">better编程. pub</p></div></div><div class="og l"><div class="oh l oi oj ok og ol kt nx"/></div></div></a></div><p id="08d0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">感谢您的阅读，下次再见！</p></div></div>    
</body>
</html>