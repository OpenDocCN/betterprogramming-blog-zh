<html>
<head>
<title>Data Engineering 101: Writing Your First Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据工程101:编写你的第一个管道</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/data-engineering-101-writing-your-first-pipeline-f19436ba614c?source=collection_archive---------3-----------------------#2020-03-18">https://betterprogramming.pub/data-engineering-101-writing-your-first-pipeline-f19436ba614c?source=collection_archive---------3-----------------------#2020-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="20a9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在气流和路易吉</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/19bd84578e15f57f580f6941e6eefde5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hlOqhm400ccL07EUbRG7w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">迈克·本纳在<a class="ae ky" href="https://unsplash.com/s/photos/pipeline?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b735" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据工程师的主要角色之一可以概括为从A点到b点获取数据。</p><p id="31ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们经常需要将数据从一个系统中取出并插入到另一个系统中。这可以用于各种目的。这包括分析、集成和机器学习。</p><p id="84ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是为了让数据移动，我们需要使用ETLs数据管道。</p><p id="0aff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是将数据从一个数据系统传输到另一个数据系统的过程。</p><p id="f118" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为数据工程师，我们需要回答的一个问题是，我们需要多久更新一次这些数据。这就是关于批处理和流的问题发挥作用的地方。这是现有的两种主要类型的ETL/ELT。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d9bb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">批处理与流</h1><p id="4bc7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">很长一段时间以来，几乎每个数据管道都是我们所认为的批处理管道。这意味着管道通常每天、每小时、每周等运行一次。有一些特定的时间间隔，但数据不是实时的。</p><p id="5635" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">批处理作业指的是以块或批的形式加载数据，而不是立即加载。因此，术语“批处理作业”指的是成批加载数据。</p><p id="eb6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与流数据相比，新的一行一旦被添加到应用程序数据库中，它就被传递到分析系统中。</p><p id="ea42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这通常使用各种形式的发布/订阅或事件总线类型的模型来完成。所有这些系统都允许交易数据在交易一发生就被传递。</p><p id="f06f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有些人可能会问，为什么我们不把流媒体用于所有事情。一直有活数据不是更好吗？</p><p id="7c62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在某些方面，这是真的。但通常创建流媒体系统在技术上更具挑战性，维护起来也很困难。</p><p id="f31e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管以正常间隔运行的批处理作业可能会失败，但它们不需要立即修复，因为它们在再次运行之前通常有几个小时或几天的时间。</p><p id="bcea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相比之下，流媒体系统是实时的。故障和错误需要尽快修复。</p><p id="0295" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将专注于开发传统上更多的批处理作业。</p><p id="0424" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了为您的ETL选择总体范例，您还需要决定您的ETL工具。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8745" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ETL工具选项</h1><p id="e812" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您只想进入编码部分，请随意跳到下面的部分。</p><p id="30b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果不参考您的数据团队必须使用的一些选项，我们就不能在开发数据管道方面走得太远。</p><p id="3b78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有大量的数据管道和工作流自动化工具。</p><p id="4046" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把它们分成两个具体的选项。</p><p id="b020" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拖放与框架。</p><p id="ff80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拖放选项让你几乎对代码一无所知——就像SSIS和Informatica一样。</p><p id="43c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于几乎不需要实现定制代码的人来说，这是非常好的。</p><p id="34c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管这些工具中的许多都提供了自定义代码，但这有点违背了初衷。</p><p id="4a16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的团队能够编写代码，我们发现使用框架编写管道更有益，因为它们通常允许更好的调优。尽管Informatica非常强大，并且只要您能支付费用，它就能做很多繁重的工作。</p><p id="c6cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即便如此，许多人的ETL还是依赖于基于代码的框架(一些公司如Airbnb和Spotify已经开发了自己的框架)。</p><p id="3756" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些框架通常用Python实现，被称为<a class="ae ky" href="https://www.theseattledataguy.com/airbnbs-airflow-versus-spotifys-luigi/" rel="noopener ugc nofollow" target="_blank">气流和Luigi </a>。这两个框架都可以用作工作流，并提供各种好处。</p><p id="d4df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是现在，让我们看看在Airflow和Luigi中构建一个基本的管道是什么样子的。</p><p id="cab2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在后面的帖子中，我们将更多地讨论设计。但是现在，我们只是演示如何编写ETL管道。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2236" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">气流中的管道</h1><p id="89e7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了在气流中制作管道，需要设置几个特定的配置。</p><p id="6991" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一组您想要设置的参数，然后您还需要调用您使用这些默认参数创建的实际DAG。</p><p id="c1ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请参见下面的配置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="fa14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这只是你的匕首的底部。</p><p id="1c87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以设置运行实际数据管道的频率，例如，如果您想每天运行您的计划，那么可以使用以下代码参数。比如可以用<code class="fe nb nc nd ne b">schedule_interval=’@daily’</code>。或者可以用cron代替，像这样:<code class="fe nb nc nd ne b">schedule_interval=’0 0 * * *’</code>。</p><p id="8bef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您设置了您的基线配置，那么您就可以开始组合气流的操作符了。</p><p id="5328" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">操作员本质上是你想要完成的孤立的任务。这可能是提取数据、移动文件、运行一些数据转换等。</p><p id="c5ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果你看下面，我们正在使用几个操作符。其中包括PythonOperator和BashOperator。</p><p id="f583" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这允许您在Python或bash中运行命令，并在所述任务之间创建依赖关系。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="be23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在气流管道上做得更深入一些。但这是它的主旨。</p><p id="a689" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以继续创建更多的任务或开发抽象来帮助管理管道的复杂性。但是气流操作符的上述用法是一个很好的介绍。</p><p id="e00c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在轮到路易吉了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bb69" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">路易吉的管道</h1><p id="a111" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Luigi是另一个可以用来开发管道的工作流框架。在某些方面，我们发现它更简单，而在其他方面，它可以很快变得更复杂。</p><p id="c0ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们个人认为Luigi更简单的原因是因为它将主要任务分成了三个主要步骤。</p><p id="54d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些可以在Luigi定义的“任务”中看到。</p><h2 id="0957" class="nf md it bd me ng nh dn mi ni nj dp mm li nk nl mo lm nm nn mq lq no np ms nq bi translated">工作</h2><p id="20c4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在Luigi任务中，最常用的三类函数是requires()、run()和output()。</p><p id="47ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Luigi中的这些函数分别做什么？</p><p id="74b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">requires()类似于气流中的依赖关系。</p><p id="e8c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您实际上是在引用以前的任务类、文件输出或其他输出。</p><p id="f85e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="c366" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，requires函数正在等待一个文件到达。</p><p id="6f3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是它也可以等待任务完成或其他输出。</p><p id="3bc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不是每个任务都需要requires函数。但是它可以用来引用需要完成才能开始当前任务的前一个任务。</p><p id="e9b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是任务确实需要run()函数。run()函数本质上是实际的任务本身。你想做什么？</p><p id="e823" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="51ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任务的输出是一个目标，它可以是本地文件系统上的一个文件，Amazon S3上的一个文件，数据库中的一些数据，等等。</p><p id="2d74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到这两个管道框架之间的细微差别。气流被包在一个特定的运营商，而Luigi是作为一个更大的类开发的。</p><p id="13d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终，这种微小的差异会导致您的管道中出现大量的设计变更。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6cc2" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">那你选哪个？</h1><p id="41ec" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">就个人而言，由于社区更大，我们喜欢气流。然而，在很多方面，Luigi可以有一个稍微低一点的门槛，只要它能解决问题。没有很多不同的运算符可以使用。相反，你决定每个任务真正做什么。</p><p id="91d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可以为设计和开发提供更多的自由和更多的思考。</p><p id="ced8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以最终，你将不得不选择你想要处理的事情。不管你选择什么样的框架，你的代码中总会有bug。</p><p id="b7eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">祝你好运，感谢你的阅读！</p></div></div>    
</body>
</html>