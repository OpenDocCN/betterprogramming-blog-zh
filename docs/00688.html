<html>
<head>
<title>AWS Lambda Python Development Package on Ubuntu 18.04</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ubuntu 18.04上的AWS Lambda Python开发包</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/aws-lambda-python-development-package-on-ubuntu-18-04-ef393255aff7?source=collection_archive---------5-----------------------#2019-06-30">https://betterprogramming.pub/aws-lambda-python-development-package-on-ubuntu-18-04-ef393255aff7?source=collection_archive---------5-----------------------#2019-06-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="70bf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习使用外部包部署Python Lambda函数</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/baef3d1646b00ee357f4ee2a104dfa82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sa1KcnK8Y65wT7fMsLIXYg.png"/></div></div></figure><p id="3626" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://aws.amazon.com/lambda/features/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>是一种运行和部署简单功能的便捷方式。然而，对于<a class="ae lq" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>来说，导入外部包可能是一件痛苦的事情。有几种方法可以解决这个问题，也许最实用的方法是使用<a class="ae lq" href="https://github.com/lambci/docker-lambda" rel="noopener ugc nofollow" target="_blank"> Docker </a>。然而，在本教程中，我将演示从远程Ubuntu服务器使用<a class="ae lq" href="https://www.numpy.org/" rel="noopener ugc nofollow" target="_blank"> numpy </a>部署一个简单的函数。</p><h2 id="df6b" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">远程服务器</h2><p id="d4f0" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">第一步是获得VPS。对于这个例子，我选择使用<a class="ae lq" href="https://www.digitalocean.com/" rel="noopener ugc nofollow" target="_blank"> DigitalOcean </a>。您可以使用以下链接获得一笔<a class="ae lq" href="https://try.digitalocean.com/virtual-private-servers/?_campaign=DO_Dev_Signup_G_Search_NB_VPS&amp;_adgroup=VPS_VPS&amp;_keyword=vps&amp;_device=c&amp;_copytype=&amp;_adposition=1t3&amp;_medium=nb_sem&amp;_source=google&amp;_dkitrig=&amp;_2dkitrig=&amp;gclid=CjwKCAjwmNzoBRBOEiwAr2V27Sm4udly1_1dfLWTqYV9GpqDRNvUz-fopVA0mL8uBl6QFbblySsNphoCLdYQAvD_BwE" rel="noopener ugc nofollow" target="_blank">50美元的信用点数</a>。其他要考虑的服务有<a class="ae lq" href="https://www.linode.com/" rel="noopener ugc nofollow" target="_blank"> Linode </a>、<a class="ae lq" href="https://www.vultr.com/" rel="noopener ugc nofollow" target="_blank"> Vultr </a>、<a class="ae lq" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> AWS EC2 </a>和<a class="ae lq" href="https://cloud.google.com/compute/" rel="noopener ugc nofollow" target="_blank"> Google计算引擎</a>。</p><h2 id="1913" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">基础</h2><p id="5b74" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">启动并登录到远程服务器后，创建以下脚本:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="b5ec" class="lr ls it mq b gy mu mv l mw mx">$ touch install.sh</span></pre><p id="32e6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将以下命令复制到脚本中。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="86ce" class="lr ls it mq b gy mu mv l mw mx">#!/usr/bin/env bash</span><span id="74c6" class="lr ls it mq b gy my mv l mw mx">sudo apt update<br/>sudo apt full-upgrade --yes<br/>sudo apt autoremove --yes</span><span id="98db" class="lr ls it mq b gy my mv l mw mx">sudo apt install zip --yes<br/>sudo apt install python3-pip --yes</span></pre><p id="33ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使脚本可执行。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="679c" class="lr ls it mq b gy mu mv l mw mx">$ chmod +x install.sh</span></pre><p id="d3f0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行脚本。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="e19b" class="lr ls it mq b gy mu mv l mw mx">$ ./install.sh</span></pre><h2 id="aca5" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">AWS CLI</h2><p id="676a" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">安装<a class="ae lq" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank">亚马逊命令行接口</a>，方便与AWS服务交互。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="2d80" class="lr ls it mq b gy mu mv l mw mx">$ pip3 install awscli</span></pre><p id="683d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了配置<code class="fe mz na nb mq b">awscli</code>，您需要拥有或者创建一个<a class="ae lq" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html" rel="noopener ugc nofollow" target="_blank"> IAM用户</a>。您可以按照本指南生成一个访问密钥。</p><p id="242e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您的凭据应该类似于下图:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="adae" class="lr ls it mq b gy mu mv l mw mx">Access Key ID: AKIAIOSFODNN7EXAMPLE<br/>Secret Access Key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</span></pre><p id="38ad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行<code class="fe mz na nb mq b">aws configure</code>并输入您的凭证。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="58e5" class="lr ls it mq b gy mu mv l mw mx">$ aws configure<br/><em class="nc"># AWS Access Key ID [None]:<br/># AWS Secret Access Key [None]:<br/># Default region name [None]:<br/># Default output format [None]:</em></span></pre><h2 id="7edc" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">测试功能</h2><p id="0c24" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">创建目录<code class="fe mz na nb mq b">numpy_tester</code>并将<code class="fe mz na nb mq b">cd</code>放入其中。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="84c9" class="lr ls it mq b gy mu mv l mw mx">$ mkdir numpy_tester</span><span id="77dc" class="lr ls it mq b gy my mv l mw mx">$ cd numpy_tester</span></pre><p id="2028" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建lambda函数<code class="fe mz na nb mq b">numpy_tester.py</code>并添加以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="c15d" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">Numpy</h2><p id="065b" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">为了在我们的函数中访问<code class="fe mz na nb mq b">numpy</code>，我们需要直接安装包。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="867d" class="lr ls it mq b gy mu mv l mw mx">$ pip3 install numpy -t .</span></pre><p id="0cd8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以通过运行以下命令在本地测试该函数:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="349d" class="lr ls it mq b gy mu mv l mw mx">$ python3 numpy_tester.py<br/><em class="nc"># Your numpy array:<br/># [[ 0  1  2  3  4]<br/>#  [ 5  6  7  8  9]<br/>#  [10 11 12 13 14]]</em></span></pre><h2 id="11ae" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">部署</h2><p id="7e0c" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">为了创建部署包，我们需要压缩函数中包含的所有文件。<code class="fe mz na nb mq b">-r9</code>标志将包含隐藏文件。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="7800" class="lr ls it mq b gy mu mv l mw mx">$ zip -r9 numpy_tester.zip .</span></pre><p id="705b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了部署，我们必须指定一个<code class="fe mz na nb mq b">role-arn</code>。最简单的方法是通过AWS控制台。</p><ul class=""><li id="e6d4" class="nf ng it kw b kx ky la lb ld nh lh ni ll nj lp nk nl nm nn bi translated">导航到<strong class="kw iu">我的安全凭证</strong>，然后选择<strong class="kw iu">角色</strong></li><li id="bf25" class="nf ng it kw b kx no la np ld nq lh nr ll ns lp nk nl nm nn bi translated">选择<strong class="kw iu">创建角色</strong>并选择<strong class="kw iu">λ</strong></li><li id="6f98" class="nf ng it kw b kx no la np ld nq lh nr ll ns lp nk nl nm nn bi translated">选择策略名称:<strong class="kw iu">管理员访问权限</strong>(仅针对本例)</li><li id="15aa" class="nf ng it kw b kx no la np ld nq lh nr ll ns lp nk nl nm nn bi translated">命名角色和<strong class="kw iu">创建角色</strong></li><li id="eaf1" class="nf ng it kw b kx no la np ld nq lh nr ll ns lp nk nl nm nn bi translated">选择新角色并复制<strong class="kw iu">角色ARN </strong></li></ul><p id="59e9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，创建一个S3桶并上传zip文件。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="f0f8" class="lr ls it mq b gy mu mv l mw mx">$ aws s3 mb s3://numpy-tester</span><span id="ad1f" class="lr ls it mq b gy my mv l mw mx">$ aws s3 cp numpy_tester.zip s3://numpy-tester/</span></pre><p id="de23" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，检查Python 3的版本。列出的值是我们将用于下面的<code class="fe mz na nb mq b">runtime</code>参数。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="8fec" class="lr ls it mq b gy mu mv l mw mx">$ python3 --version<br/><em class="nc"># Python 3.6.8</em></span></pre><p id="89c0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用<code class="fe mz na nb mq b">awscli</code>命令<code class="fe mz na nb mq b">create-function</code>创建Lambda。您需要为<code class="fe mz na nb mq b">region</code>和<code class="fe mz na nb mq b">role-arn</code>参数指定一个值。其他一切都可以保持原样。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="d3e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">导航到AWS控制台。您应该看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/eb55f6428f47ae6290772a9f273ed1b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dPAWQEIXDttS5pka.png"/></div></div></figure><p id="0030" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后的检查是测试功能。选择界面右上角的<code class="fe mz na nb mq b">Test</code>按钮。如果运行成功，您应该会看到以下输出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/f4085ab24809f0be68acf626e71e388d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4fMBkRaW2ZycADi1.png"/></div></div></figure><p id="b29e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">剩下唯一要做的就是摧毁原来的服务器。</p><p id="2968" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样。如果您想在某个时候更新代码，您可以参考<code class="fe mz na nb mq b">awscli</code>命令<a class="ae lq" href="https://docs.aws.amazon.com/cli/latest/reference/lambda/update-function-code.html" rel="noopener ugc nofollow" target="_blank">更新功能代码</a>。</p></div></div>    
</body>
</html>