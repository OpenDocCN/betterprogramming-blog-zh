<html>
<head>
<title>Building Cross-Platform Voice Apps With VOXA — Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用VOXA构建跨平台的语音应用——第4部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-cross-platform-voice-apps-with-voxa-part-4-f7de737b0cd5?source=collection_archive---------15-----------------------#2019-09-03">https://betterprogramming.pub/building-cross-platform-voice-apps-with-voxa-part-4-f7de737b0cd5?source=collection_archive---------15-----------------------#2019-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a07e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Voxa中创建跨平台语音应用系列的第四部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/28ca050b4631a532d6f75f38a04de12c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dhO6hpvL_KgVpteN.jpg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">图片来自www.pixabay.com<a class="ae kv" href="https://pixabay.com/illustrations/money-transfer-mobile-banking-3588301/" rel="noopener ugc nofollow" target="_blank"/></p></figure><p id="ffac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是用<a class="ae kv" href="http://voxa.ai/" rel="noopener ugc nofollow" target="_blank"> Voxa </a>创建跨平台语音应用系列文章的第四部分。</p><p id="4ceb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://medium.com/better-programming/building-cross-platform-voice-apps-with-voxa-part-3-e738cd991fde" rel="noopener">之前的文章</a>中，我们创建了我们游戏的逻辑，积分将如何计算，如何随机创建一个操作让用户计算结果，我们将我们的语音应用程序连接到<a class="ae kv" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> DynamoDB </a>以持久化用户在游戏中的进度。</p><p id="abc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这让我们可以向Alexa和Google Assistant商店发布一款语音游戏，但我想更进一步。</p><p id="fb0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将添加Alexa的ISP和Google Assistant的数字商品，以销售游戏中某个竞赛的月订阅。让我们看看如何做到这一点！</p><p id="80ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Alexa和Google Assistant这两个语音平台中，有三种方法可以让你的语音应用赚钱:</p><ul class=""><li id="7d53" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">权利:一次性购买，终身购买。</li><li id="0f75" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">订阅:支付月费或年费以获得高级功能。</li><li id="eac6" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">消耗品:反复购买应用程序的功能/产品，就像生活在游戏中一样。</li></ul><p id="97b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将通过订阅为我们的快速数学应用程序举办月度竞赛。</p><p id="33af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用户将能够玩正常的游戏，但如果他们想参加比赛，他们必须每月支付0.99美元。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="fd99" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">Alexa的ISP</h1><p id="e28b" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">让我们从添加一个Alexa ISP订阅开始。确保您已经安装了<a class="ae kv" href="https://www.npmjs.com/package/ask-cli" rel="noopener ugc nofollow" target="_blank"> ASK CLI </a>。转到项目的根文件夹，键入:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/60986630f0245952478b16edad175b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLJjNfLC9AP7ZZdsJtw1vQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将ISP添加到你的Alexa技能中</p></figure><p id="dee4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择<em class="nl">订阅</em>，命名为:<code class="fe nm nn no np b">competition</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/417754494e2edccaa580637ff98eab43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EkH1UOuLVpe5EMURv_0TwQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd nr">竞赛</strong> ISP创建</p></figure><p id="0db2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JSON文件将创建在根文件夹中，路径为:<code class="fe nm nn no np b">./isps/subscription/competition.json</code>。</p><p id="7fe6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要部署您的ISP订阅，您可以使用命令:</p><pre class="kg kh ki kj gt ns np nt nu aw nv bi"><span id="ddc2" class="nw mo iq np b gy nx ny l nz oa">ask deploy -t isp</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/1ec9d9b37a841b56a251f8003e0ff856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5jUrZXJr372cIwj4VxKHow.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用ASK CLI部署您的ISP</p></figure><p id="18f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这只会从<code class="fe nm nn no np b">isps</code>文件夹中推送变更，而不是交互模型或<code class="fe nm nn no np b">skill.json</code>文件内容。</p><p id="34a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在分支<a class="ae kv" href="https://github.com/omenocal/quick-maths-voice-app/tree/part4" rel="noopener ugc nofollow" target="_blank"> part4 </a>下载项目的最新版本。在<a class="ae kv" href="https://developer.amazon.com/es/blogs/alexa/post/6704c2d4-eac1-4a97-b631-57d2a43a1cd3/developers-in-the-uk-and-germany-can-now-monetize-alexa-skills-with-in-skill-purchasing-isp" rel="noopener ugc nofollow" target="_blank">6月3日</a>，亚马逊宣布ISP已经扩展到英国和德国，所以我们不仅要在美国销售我们的订阅，还要在英国销售</p><p id="ee4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Google Assistant确实从一开始就支持这个地区。在英国的价格是0.99英镑。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="a564" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">谷歌助手的数字商品</h1><p id="7a3e" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">为Google Assistant设置数字商品稍微难一点。</p><p id="13fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">嗯，你的第一个障碍是你需要购买一个域名来链接你的行动。就我而言，我以前不需要域名，所以我买了一个新的谷歌域名。</p><p id="e002" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你有了你的域，进入你的动作设置，<em class="nl">部署</em>标签，然后<em class="nl">品牌验证</em>菜单，点击<em class="nl">连接站点</em>按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/34f2c2caed41da71e31cf7941a1a6487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hoC4bG92SwFW4mqwdykfRg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将您的领域与您的行动联系起来</p></figure><p id="ad65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输入您域名的网址，点击<em class="nl">连接</em>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/1886d901adc1e5d7ad25814e88bcc031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BcyZoYqQGFAuYhxYV-57Bw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">品牌验证请求已完成</p></figure><p id="afcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您应该等待48小时，以获得您的域验证。因为我的域名是用谷歌域名创建的，所以验证的时间不到六个小时。</p><p id="2c4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，是时候创建应用内购买订阅了。Alexa在他们自己的开发者门户网站上管理ISP。</p><p id="ce9c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于Google Assistant，您需要在您的<a class="ae kv" href="https://play.google.com/apps/publish" rel="noopener ugc nofollow" target="_blank">开发者游戏控制台</a>帐户中创建一个应用内产品。而且，这是你的行动需要的下一笔付款，在本文发表时，创建一个Play console帐户需要25美元。</p><p id="4479" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你进入Google Play控制台时，主视图是这样的。就我而言，我已经有了应用内购买。点击<em class="nl">创建应用</em>按钮创建新的订阅。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/af7e346ad24380622e94fa8196f73535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nd2iAH_tcMwc16RicAG-zg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Play Store应用程序的主屏幕</p></figure><p id="be98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择语言(默认为美国英语)并写下标题，然后点击<code class="fe nm nn no np b">CREATE</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/1f7a3de6be673b819dffaf68e9995058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g2t7FHhHat38pUtV1t-szQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">命名您的应用内订阅</p></figure><p id="1f65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，你需要像在谷歌助手里一样填写一些字段；描述、图片，更重要的是，有<em class="nl">计费</em>权限的空APK。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/f99d8792eb6e8263477a4ba0402f6466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vFdVKhQhEtaEg99oR5xFjw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">为你的应用内购买项目存储列表信息</p></figure><p id="d6fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，进入<em class="nl">应用发布</em>菜单，上传安卓应用的APK。</p><p id="13ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据文件，你不需要在商店里有一个公共应用程序，你只需要在其中一个渠道创建你的应用内购买。在这种情况下，我将在公测频道发布APK。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/9ce1a3f737a28a09125bfa025ae48c4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*drJld_nNUuZ4GriDKZUDIg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">发布新版本的空Android应用程序</p></figure><p id="b15f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您需要将您的网站链接到您的应用内订阅，以便Google Actions控制台可以将您的产品链接到您的操作。</p><p id="3768" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">进入<em class="nl">服务&amp;API</em>菜单链接你的网站。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/c1b506cb5c73527e5ec69027f80515fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7AWqAWqSp6nbKnVLfrv0Jg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">将您的网站链接到您的应用内订阅</p></figure><p id="266e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<em class="nl">内容分级</em>菜单中，为您的应用申请分级。若要对你的应用进行评级，你需要先上传你的APK。最后，我们将返回应用发布菜单，提交应用进行认证。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/76663c09ee339aa3bb6d5b020c8f56c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hBynTK229K0xO7vESEdgcw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">为你的应用内订阅评分</p></figure><p id="d0e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<em class="nl"> Price &amp; distribution </em>菜单中，选择您希望订阅可用的国家/地区，默认情况下会选择145个国家/地区，其中四个因谷歌政策而被禁止。</p><p id="7930" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您甚至可以修改每个国家的套餐价格。默认选择的数量是最小值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/6d743b5aba1ae98f2f96a07dd283c8dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X3s-kEOtYONTUQeJeVEdcQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">您希望将应用分发到的国家和价格</p></figure><p id="1c23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，在<em class="nl">应用内容</em>菜单中，为你的应用选择目标受众。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/9954e54fab5975e48d4f134a157c0def.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*amOVJKeTrXzTFYb1_zsl1w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">目标受众</p></figure><p id="54fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查所有绿色标记后，这意味着您已准备好提交您的应用程序进行认证。</p><p id="1a57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">进入<em class="nl">应用发布</em>菜单。然后，你必须等待几天，让你的应用内产品出现在谷歌控制台的操作中，对我来说，这需要从周六到周二(三天)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/66307b054d5229de281f35b26d3ddf0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkqLHV9ZVv0dOvXEwT1gLA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">与您的行动相关的应用内产品</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="62dd" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">谷歌云控制台配置</h1><p id="ccd7" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">既然您已经设置了Google Play控制台配置，我们应该获得一个JSON键，以便能够在Google Play中查询订阅。</p><p id="c2b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Google Cloud中查看项目配置的最简单方法是在<em class="nl">测试</em>菜单中，然后转到右上角并单击<em class="nl">设置</em>菜单，然后单击<em class="nl">管理用户访问</em>标签。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/6465b760ac32330d13a282197e1feec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OEXIj8RHSvk8XD0RMCxl5A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">访问项目的谷歌云配置</p></figure><p id="9c9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将把你带到Google Cloud中的<em class="nl"> IAM </em>菜单，在这里你可以邀请其他人来测试你的应用程序。要获取密钥，请进入<em class="nl">服务账户</em>菜单。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/0e08100dacdddae79bd44308c038e0ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mOpn30D3joyTF135qoxTCA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">谷歌云控制台视图</p></figure><p id="09ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击<em class="nl"> CREATE SERVICE ACCOUNT </em>标签，为您的密匙命名和描述，并为您的项目下载JSON密匙。确保将该文件放入项目的路径:<code class="fe nm nn no np b">./src/client_secret.json</code>。</p><p id="42d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，转到API仪表板，单击<em class="nl">启用API和服务</em> <strong class="ky ir"> </strong>并查找操作API以启用它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/69a573c78db4db5012820b8b8ee4765f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8RGNz-GbL0zH2artgquQZQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">API和服务</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/5d51c51af6eae8fcd7ce3a91ecc71119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J6co0ZMbAdmTOU_3ChGcxw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">项目的操作API</p></figure></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="bca6" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">你需要检查的东西</h1><p id="88ad" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">这一节写于9月1日，也就是我开始写这篇文章的两个月后。</p><p id="41dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我一直在努力寻找为什么我会得到一个奇怪的没有记录的<code class="fe nm nn no np b">INVALID_ARGUMENTS</code>错误。我甚至联系了谷歌团队，但他们不知道到底发生了什么。</p><p id="6816" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">过了这么久，我发现了错误。但这不仅仅是一个错误，更像是一个应该在文档中澄清的技术问题。</p><p id="665a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试你的动作的用户不应该因为任何原因点击标签<code class="fe nm nn no np b">Stop &lt;actionName&gt; from remembering me</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/f3f4b0abc8e81d163965933d6c81df2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*raHJNPdYG4dQdnNqpiobyA.jpeg"/></div></div></figure><p id="20c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果他们点击此选项，他们将被自动视为您应用程序中的<em class="nl">客人</em>，该用户不能购买您的订阅或任何其他数字商品。</p><p id="e185" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果用户是来宾，JSON有效负载中的<code class="fe nm nn no np b">conversationId</code>值是一个编号字符串，如<code class="fe nm nn no np b">153982789723948</code>，而不是一个长字符串，如:</p><pre class="kg kh ki kj gt ns np nt nu aw nv bi"><span id="252f" class="nw mo iq np b gy nx ny l nz oa">ABwppHEqSttOVOPiYZE8SJ35bO4qzHGxE7dhEi3W3s4P7kOA_34Lu0607awo9S2fgK1rAxIu8PxcHclUZsVQU</span></pre><p id="9191" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你创建你的谷歌行动时，确保在你的账户中检查这一点，并且在你可能有麻烦的其他账户中检查这一点。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="3b96" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">竞争逻辑</h1><p id="95a9" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">正如您在第2部分中注意到的，我们打算处理销售订阅的操作，例如当用户要求参加比赛或要求退款时，他们可以购买什么，他们购买了什么，要求他们的分数，以及比赛的剩余天数。</p><p id="148a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有这些意图都在一个名为<code class="fe nm nn no np b">competition.states.js</code>的新控制器文件中处理。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/c0617b84cd502ebdb2d63b43fb164be4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*8cryGBxYpxyWCskZMBO81g.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">competition.states.js文件</p></figure><p id="72eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个文件包含销售数字商品和ISP的所有处理程序和验证。我想强调的一个州是<code class="fe nm nn no np b">competition</code>州:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="4421" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦用户要求参加比赛，我们会检查用户是否已经订阅，让他们知道没有必要再次订阅。</p><p id="ffe7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们检查他们是否没有关联帐户。知道用户的姓名和电子邮件地址很重要。之后，我们分开验证，并检查Alexa和谷歌助理的验证不同。</p><p id="1668" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于Alexa，我们检查他们是否允许访问他们的位置，这是为了在排行榜上显示他们来自哪里。Voxa有一个很好的处理程序，可以通过简单的操作获得用户的地址:</p><pre class="kg kh ki kj gt ns np nt nu aw nv bi"><span id="71e6" class="nw mo iq np b gy nx ny l nz oa">const info = await voxaEvent.alexa.deviceAddress.getAddress();</span></pre><p id="03b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于Google Assistant，我们需要访问用户的位置，所以我们发送一个<code class="fe nm nn no np b">dialogflowPermission</code>指令来请求<code class="fe nm nn no np b">DEVICE_PRECISE_LOCATION</code>和<code class="fe nm nn no np b">DEVICE_COARSE_LOCATION</code>。</p><p id="bb44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当用户接受或拒绝这个请求时，<code class="fe nm nn no np b">actions_intent_PERMISSION</code> <strong class="ky ir"> </strong>状态将处理这个请求，我们验证他们是否授予了权限或不前进。</p><p id="2b0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果到目前为止一切正常，我们会向Alexa发送一个<code class="fe nm nn no np b">alexaConnectionsSendRequest</code> <em class="nl"> </em>指令:</p><pre class="kg kh ki kj gt ns np nt nu aw nv bi"><span id="292c" class="nw mo iq np b gy nx ny l nz oa">const buyDirective = await voxaEvent.alexa.isp.buyByReferenceName(<br/> config.alexa.subscriptionId,<br/> token,<br/> );</span><span id="8560" class="nw mo iq np b gy ot ny l nz oa">return {<br/> alexaConnectionsSendRequest: buyDirective,<br/>};</span></pre><p id="25a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于Google Assistant，我们将使用的指令是<code class="fe nm nn no np b">googleCompletePurchase</code>。你可以在他们的<a class="ae kv" href="https://developers.google.com/actions/transactions/digital/dev-guide-digital" rel="noopener ugc nofollow" target="_blank">数码商品指南</a>中了解更多完整的流程。</p><p id="80b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当在Google Assistant中触发购买流程时，它会在您的手机上显示这样一个屏幕:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/48e0a309c1d9f7db87eb74d050ef92eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*ueav3BQXOona_BrZqYTeGA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">使用谷歌助手购买数字商品时的收据</p></figure><p id="d679" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当购买过程完成时，我们的Voxa应用程序将处理处于<code class="fe nm nn no np b">Connections.Response</code> <strong class="ky ir"> </strong>状态的Alexa结果和处于<code class="fe nm nn no np b">CompletePurchaseIntent</code> <strong class="ky ir"> </strong>状态的Google结果。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="697f" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">最后的</h1><p id="8014" class="pw-post-body-paragraph kw kx iq ky b kz nf jr lb lc ng ju le lf nh lh li lj ni ll lm ln nj lp lq lr ij bi translated">另一个有趣的代码是我们如何在设备屏幕上显示排行榜，我相信你会非常关注。</p><p id="d600" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://medium.com/better-programming/building-cross-platform-voice-apps-with-voxa-part-5-1f0aff32185" rel="noopener">下一篇也是最后一篇文章</a>中，你将看到我们如何为Alexa添加APL模板，为Google Assistant添加表格卡，显示我们游戏的排行榜。</p><p id="0a17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>