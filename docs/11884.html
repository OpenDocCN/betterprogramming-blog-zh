<html>
<head>
<title>Create and Upgrade a Multisig-Owned UUPS-Upgradeable ERC721 NFT Contract Using OpenZeppelin Defender and Hardhat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenZeppelin Defender和Hardhat创建和升级Multisig拥有的可升级UUPS的ERC721 NFT合同</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/create-and-upgrade-a-multisig-owned-uups-upgradeable-erc721-nft-contract-using-openzeppelin-73a07937a449?source=collection_archive---------1-----------------------#2022-04-25">https://betterprogramming.pub/create-and-upgrade-a-multisig-owned-uups-upgradeable-erc721-nft-contract-using-openzeppelin-73a07937a449?source=collection_archive---------1-----------------------#2022-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="59f2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">端到端实践教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7fb519212f76e2d5e0a68eb74c0084d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u0m6BArUAstZ0eF7"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@theshubhamdhage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">舒巴姆·达奇</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="47d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不变性——不能被更改或删除的特征——是智能合约的关键特征之一。它是Web3安全性的主要部分。但是每个开发人员都知道，有时一个协议需要升级或新特性。</p><p id="fa79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，在极少数情况下，开发人员可能会犯错误。在这种情况下，能够执行升级会很方便。本教程解释了如何根据<a class="ae kv" href="https://eips.ethereum.org/EIPS/eip-1967" rel="noopener ugc nofollow" target="_blank">EIP-1967-标准代理存储插槽通用可升级代理标准(UUPS) </a>创建可升级NFT合同。</p><h1 id="6b98" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">可升级智能合同的类型</h1><p id="7f49" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">智能契约可以通过将给定的智能契约分成两个基本组件来升级:代理和实现。下图象征着从合同<strong class="ky ir"> ERC20 </strong>到合同<strong class="ky ir"> ERC20v2 </strong>的升级。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/a8e505c8e0d9792ae37b4277146b2f9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1gvEeQdJqlRs1kGC"/></div></div></figure><p id="b0a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">OpenZeppelin契约为基于代理的契约升级提供了两种选择:透明代理和通用升级代理。这些将在下面简要讨论。关于智能合同升级能力的深入探讨，请参见Santiago Palladino的这篇博客文章。</p><h1 id="470a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">透明的</h1><p id="7e08" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">一种智能合约升级遵循所谓的透明模式。这种模式将状态和升级能力都放在代理契约中。代理指向保存逻辑的给定实现契约。当任何非管理地址调用协定时，调用被委托给实现协定。当管理员调用契约时，代理揭示了<code class="fe mq mr ms mt b">upgradeTo</code>函数，使管理员能够指向新的实现契约，从而进行升级。</p><p id="5136" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种代理模式的一个缺点是与它交互会耗费大量的时间，因为这样做需要两次存储访问来检查调用者的地址是否是admin。</p><h1 id="26e4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">UUPS</h1><p id="51e1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">另一方面，UUPS可升级性模式更有效。该模式将升级功能放在了<em class="mu">实现</em>契约中。代理合同是最低限度的；它使用<code class="fe mq mr ms mt b">delegatecall</code>来指导实现契约执行事务。</p><p id="2d4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用这种代理模式，确保升级功能在每次升级时都正常运行是至关重要的。否则将永远失去升级能力。</p><p id="8077" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本教程将遵循UUPS模式。</p><h1 id="c928" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">可升级的合同部署</h1><p id="431c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">本指南向您展示了如何部署准系统UUPS可升级ERC721合同，以制造高能效NFT。所有权将被转移到Gnosis Safe multisig账户，合同管理将使用<a class="ae kv" href="https://openzeppelin.com/defender/" rel="noopener ugc nofollow" target="_blank"> OpenZeppelin Defender </a>进行管理。</p><h1 id="f270" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">开发环境设置</h1><p id="69ab" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">对于本教程，您将使用<a class="ae kv" href="http://hardhat.org" rel="noopener ugc nofollow" target="_blank"> Hardhat </a>作为使用<a class="ae kv" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank">节点</a>包管理器的本地开发环境。要开始，请运行以下命令:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="9dbc" class="mz lt iq mt b gy na nb l nc nd">mkdir uupsNFT</span><span id="2302" class="mz lt iq mt b gy ne nb l nc nd">npm init -y</span><span id="2de7" class="mz lt iq mt b gy ne nb l nc nd">npm i dotenv</span><span id="cb43" class="mz lt iq mt b gy ne nb l nc nd">npm i — save-dev hardhat @nomiclabs/hardhat-etherscan</span><span id="8138" class="mz lt iq mt b gy ne nb l nc nd">npx hardhat</span></pre><p id="63a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择<strong class="ky ir">创建一个基本的样本项目</strong>并接受默认参数。</p><p id="62d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将需要安装OpenZeppelin <a class="ae kv" href="https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable" rel="noopener ugc nofollow" target="_blank">可升级合同</a>库以及<a class="ae kv" href="https://www.npmjs.com/package/@openzeppelin/hardhat-defender" rel="noopener ugc nofollow" target="_blank"> Hardhat Defender </a> npm包，以便与OpenZeppelin Defender集成升级。</p><p id="a7cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可升级合同包复制了主OpenZeppelin合同的结构，但是为每个文件和合同添加了可升级后缀。</p><p id="6fd5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b">nft.storage</code>包允许轻松部署IPFS托管的NFT元数据。</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="8c4d" class="mz lt iq mt b gy na nb l nc nd">npm i — save-dev @openzeppelin/contracts-upgradeable @openzeppelin/hardhat-defender @openzeppelin/hardhat-upgrades nft.storage</span></pre><p id="543f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例项目创建了几个可以安全删除的示例文件:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="8cf2" class="mz lt iq mt b gy na nb l nc nd">rm scripts/sample-script.js test/sample-test.js contracts/Greeter.sol</span></pre><p id="7d15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b">dotenv</code>包允许您访问存储在本地文件中的环境变量，但是该文件需要创建:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="f134" class="mz lt iq mt b gy na nb l nc nd">touch .env</span></pre><h1 id="0af4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">其他设置</h1><p id="501a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您将需要获得一些重要的密钥来存储在您的。环境文件。(仔细检查该文件是否列在您的。gitignore使您的私钥保持私密。)</p><p id="b9bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://www.alchemy.com/" rel="noopener ugc nofollow" target="_blank">炼金术</a>中，在Rinkeby上创建一个app，复制HTTP key。将其添加到您的<code class="fe mq mr ms mt b">.env</code>文件中。</p><p id="79fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Metamask中，点击<strong class="ky ir">账户详情</strong>-&gt;-<strong class="ky ir">导出私钥</strong>，复制您将用于部署合同的私钥。</p><p id="edcd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">重要安全提示:</strong>使用完全不同的浏览器和元掩码帐户，而不是您可能用于其他目的的帐户。这样，如果您不小心泄露了您的私钥，您的个人资金安全将不会受到影响。</p><p id="a2d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从<code class="fe mq mr ms mt b"><a class="ae kv" href="https://nft.storage/" rel="noopener ugc nofollow" target="_blank">nft.storage</a></code>获取API密钥并将其添加到您的。环境文件。</p><p id="1e7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该合同最初将部署一架EOA。初次升级后，所有权将转移到Gnosis Safe multisig。</p><p id="3703" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要在OpenZeppelin Defender中创建新的Gnosis Safe，导航到<strong class="ky ir">管理</strong>，选择<strong class="ky ir">契约</strong> → <strong class="ky ir">创建Gnosis Safe </strong>。提供三个所有者的地址，并将multisig的阈值设置为2。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/508e617f4530c2a2c39bd3630df01b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y2gwgcwzlIEme1s8"/></div></div></figure><p id="59da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在Defender中创建新的API密钥和密码，方法是导航到右上角的汉堡菜单，然后选择团队API密钥。您可以为每个默认选项选择是，并点击<strong class="ky ir">保存</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/71fa1de9b7f480e8af87b304b6204613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5HwpD_mvg5hIHsk0"/></div></div></figure><p id="9ca0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你的。env看起来会像这样:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="c347" class="mz lt iq mt b gy na nb l nc nd">PRIVATE_KEY=<br/>ALCHEMY_URL=<br/>ETHERSCAN_API=<br/>DEFENDER_KEY=<br/>DEFENDER_SECRET=<br/>NFT_API=</span></pre><p id="988a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用以下内容替换您的hardhat.config.js:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="7886" class="mz lt iq mt b gy na nb l nc nd">require(“@openzeppelin/hardhat-upgrades”);</span><span id="6696" class="mz lt iq mt b gy ne nb l nc nd">require(‘@openzeppelin/hardhat-defender’);</span><span id="bfb7" class="mz lt iq mt b gy ne nb l nc nd">require(“@nomiclabs/hardhat-etherscan”);</span><span id="1484" class="mz lt iq mt b gy ne nb l nc nd">require(‘@nomiclabs/hardhat-waffle’);</span><span id="6e4d" class="mz lt iq mt b gy ne nb l nc nd">require(‘dotenv’).config();</span><span id="a1aa" class="mz lt iq mt b gy ne nb l nc nd">module.exports = {</span><span id="824f" class="mz lt iq mt b gy ne nb l nc nd">solidity: “0.8.4”,</span><span id="263f" class="mz lt iq mt b gy ne nb l nc nd">networks: {</span><span id="65dd" class="mz lt iq mt b gy ne nb l nc nd">rinkeby: {</span><span id="a406" class="mz lt iq mt b gy ne nb l nc nd">url: `${process.env.ALCHEMY_URL}`,</span><span id="9caa" class="mz lt iq mt b gy ne nb l nc nd">accounts: [`0x${process.env.PRIVATE_KEY}`],</span><span id="91a3" class="mz lt iq mt b gy ne nb l nc nd">}</span><span id="834c" class="mz lt iq mt b gy ne nb l nc nd">},</span><span id="d1c4" class="mz lt iq mt b gy ne nb l nc nd">etherscan: {</span><span id="d1a6" class="mz lt iq mt b gy ne nb l nc nd">apiKey: process.env.ETHERSCAN_API</span><span id="f5a5" class="mz lt iq mt b gy ne nb l nc nd">},</span><span id="1ce0" class="mz lt iq mt b gy ne nb l nc nd">defender:</span><span id="8da2" class="mz lt iq mt b gy ne nb l nc nd">{</span><span id="4113" class="mz lt iq mt b gy ne nb l nc nd">“apiKey”: process.env.DEFENDER_KEY,</span><span id="348c" class="mz lt iq mt b gy ne nb l nc nd">“apiSecret”: process.env.DEFENDER_SECRET</span><span id="e158" class="mz lt iq mt b gy ne nb l nc nd">}</span><span id="a249" class="mz lt iq mt b gy ne nb l nc nd">};</span></pre><h1 id="638f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">上传NFT元数据</h1><p id="2683" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这个NFT令牌将由一个图像组成。npm包为开发人员提供了一种简单的上传。json元数据以及图像资产。</p><p id="37d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从基本项目目录中，创建一个文件夹来存储图像资源:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="0ce8" class="mz lt iq mt b gy na nb l nc nd">mkdir assets</span><span id="b509" class="mz lt iq mt b gy ne nb l nc nd">touch scripts/uploadNFTData.mjs</span></pre><p id="4dc6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在此文件中包含以下代码，根据需要更新代码以使用您的图像资源、名称和描述:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="dbf4" class="mz lt iq mt b gy na nb l nc nd">import { NFTStorage, File } from “nft.storage”<br/>import fs from ‘fs’</span><span id="f315" class="mz lt iq mt b gy ne nb l nc nd">import dotenv from ‘dotenv’</span><span id="9dff" class="mz lt iq mt b gy ne nb l nc nd">dotenv.config()</span><span id="f8c0" class="mz lt iq mt b gy ne nb l nc nd">async function storeAsset() {</span><span id="fc12" class="mz lt iq mt b gy ne nb l nc nd">const client = new NFTStorage({ token: process.env.NFT_KEY })</span><span id="fce9" class="mz lt iq mt b gy ne nb l nc nd">const metadata = await client.store({</span><span id="f624" class="mz lt iq mt b gy ne nb l nc nd">name: ‘MyToken’,</span><span id="7b5b" class="mz lt iq mt b gy ne nb l nc nd">description: ‘This is a two-dimensional representation of a four-dimensional cube’,</span><span id="21f8" class="mz lt iq mt b gy ne nb l nc nd">image: new File(</span><span id="c855" class="mz lt iq mt b gy ne nb l nc nd">[await fs.promises.readFile(‘assets/cube.gif’)],</span><span id="e8aa" class="mz lt iq mt b gy ne nb l nc nd">‘cube.gif’,</span><span id="241b" class="mz lt iq mt b gy ne nb l nc nd">{ type: ‘image/gif’ }</span><span id="b0f6" class="mz lt iq mt b gy ne nb l nc nd">),</span><span id="48f3" class="mz lt iq mt b gy ne nb l nc nd">})</span><span id="c07d" class="mz lt iq mt b gy ne nb l nc nd">console.log(“Metadata stored on Filecoin and IPFS with URL:”, metadata.url)</span><span id="3343" class="mz lt iq mt b gy ne nb l nc nd">}</span><span id="ef77" class="mz lt iq mt b gy ne nb l nc nd">storeAsset()</span><span id="0af0" class="mz lt iq mt b gy ne nb l nc nd">.then(() =&gt; process.exit(0))</span><span id="7f1c" class="mz lt iq mt b gy ne nb l nc nd">.catch((error) =&gt; {</span><span id="68f5" class="mz lt iq mt b gy ne nb l nc nd">console.error(error);</span><span id="8b40" class="mz lt iq mt b gy ne nb l nc nd">process.exit(1);</span><span id="cfda" class="mz lt iq mt b gy ne nb l nc nd">});</span></pre><p id="fb34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行脚本:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="5ea0" class="mz lt iq mt b gy na nb l nc nd">node scripts/uploadNFTData.mjs</span><span id="f54d" class="mz lt iq mt b gy ne nb l nc nd">Metadata stored on Filecoin and IPFS with URL: ipfs://bafyreidb6v2ilmlhg2sznfb4cxdd5urdmxhks3bu4yqqmvbzdkatopr3nq/metadata.json</span></pre><p id="78d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">成功！现在，您的图像和元数据已准备好链接到您的NFT合同。</p><h1 id="4c12" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建智能合同</h1><p id="05df" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">转到<a class="ae kv" href="http://wizard.openzeppelin.com" rel="noopener ugc nofollow" target="_blank">wizard.openzeppelin.com</a>并选择ERC721。</p><p id="3250" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">给你的令牌任何你喜欢的功能。确保勾选<strong class="ky ir">可升级性</strong>的复选框，并选择<strong class="ky ir"> UUPS </strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/ff7760cc80366da47741e487cfb8b4c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sbQ5rBgNpLcHvMnl"/></div></div></figure><p id="67b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择<strong class="ky ir">下载</strong> → <strong class="ky ir">为单个文件</strong>。将它保存在项目的/contracts文件夹中。</p><p id="18d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意合同中的Solidity版本，并编辑hardhat.config.js以匹配此版本或更新版本。</p><h1 id="8e7e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">初始部署</h1><p id="7d7e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">创建一个文件并提供以下代码，根据您的合同和令牌名称进行必要的调整:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="123c" class="mz lt iq mt b gy na nb l nc nd">touch scripts/deploy.js<br/>const { ethers, upgrades } = require(“hardhat”);<br/>async function main() {</span><span id="7f1f" class="mz lt iq mt b gy ne nb l nc nd">const CubeToken = await ethers.getContractFactory(“CubeToken”);</span><span id="112f" class="mz lt iq mt b gy ne nb l nc nd">const cubeToken = await upgrades.deployProxy(CubeToken);</span><span id="a9ed" class="mz lt iq mt b gy ne nb l nc nd">await cubeToken.deployed();</span><span id="44a6" class="mz lt iq mt b gy ne nb l nc nd">console.log(“Token address:”, cubeToken.address);</span><span id="1bf0" class="mz lt iq mt b gy ne nb l nc nd">}</span><span id="03d9" class="mz lt iq mt b gy ne nb l nc nd">main()</span><span id="dfb4" class="mz lt iq mt b gy ne nb l nc nd">.then(() =&gt; process.exit(0))</span><span id="013d" class="mz lt iq mt b gy ne nb l nc nd">.catch((error) =&gt; {</span><span id="740d" class="mz lt iq mt b gy ne nb l nc nd">console.error(error);</span><span id="4af9" class="mz lt iq mt b gy ne nb l nc nd">process.exit(1);</span><span id="d028" class="mz lt iq mt b gy ne nb l nc nd">});</span></pre><p id="6053" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行脚本:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="6810" class="mz lt iq mt b gy na nb l nc nd">npx hardhat run scripts/deploy.js — network rinkeby</span><span id="a672" class="mz lt iq mt b gy ne nb l nc nd">Token address: 0x12a9ba92b3B2746f41AcC45Af36c44ac00E107b0</span></pre><h1 id="8daa" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">薄荷NFT</h1><p id="cb86" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">既然契约已经部署好了，您可以调用<code class="fe mq mr ms mt b">safeMint</code>函数，使用之前上传到IFPS的数据来铸造NFT。</p><p id="9112" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个新文件以包含以下命令，替换相关部分中的代理契约地址和元数据URL。</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="4981" class="mz lt iq mt b gy na nb l nc nd">touch scripts/mintToken.mjs</span><span id="9f66" class="mz lt iq mt b gy ne nb l nc nd">const CONTRACT_ADDRESS = “0x12a9ba92b3B2746f41AcC45Af36c44ac00E107b0”</span><span id="d527" class="mz lt iq mt b gy ne nb l nc nd">const META_DATA_URL = “ipfs://bafyreidb6v2ilmlhg2sznfb4cxdd5urdmxhks3bu4yqqmvbzdkatopr3nq/metadata.json”</span><span id="d6ed" class="mz lt iq mt b gy ne nb l nc nd">async function mintNFT(contractAddress, metaDataURL) {</span><span id="189d" class="mz lt iq mt b gy ne nb l nc nd">const ExampleNFT = await ethers.getContractFactory(“CubeToken”)</span><span id="4510" class="mz lt iq mt b gy ne nb l nc nd">const [owner] = await ethers.getSigners()</span><span id="dde8" class="mz lt iq mt b gy ne nb l nc nd">await ExampleNFT.attach(contractAddress).safeMint(owner.address, metaDataURL)</span><span id="bafa" class="mz lt iq mt b gy ne nb l nc nd">console.log(“NFT minted to: “, owner.address)</span><span id="4fe4" class="mz lt iq mt b gy ne nb l nc nd">}</span><span id="f4e6" class="mz lt iq mt b gy ne nb l nc nd">mintNFT(CONTRACT_ADDRESS, META_DATA_URL)</span><span id="0b55" class="mz lt iq mt b gy ne nb l nc nd">.then(() =&gt; process.exit(0))</span><span id="a63f" class="mz lt iq mt b gy ne nb l nc nd">.catch((error) =&gt; {</span><span id="ba1c" class="mz lt iq mt b gy ne nb l nc nd">console.error(error);</span><span id="3fb9" class="mz lt iq mt b gy ne nb l nc nd">process.exit(1);</span><span id="8c84" class="mz lt iq mt b gy ne nb l nc nd">});</span></pre><p id="ad7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行脚本:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="9ab4" class="mz lt iq mt b gy na nb l nc nd">npx hardhat run scripts/mintToken.mjs</span><span id="3197" class="mz lt iq mt b gy ne nb l nc nd">NFT minted to: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266</span></pre><h1 id="375a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">核实合同</h1><p id="9b30" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">到目前为止，我们已经能够在部署的契约上运行功能，因为我们有应用程序二进制接口(ABI)。验证源代码可以公开完整的合同代码和ABI。这是一个很好的实践，也使得与契约的交互更加容易。</p><p id="4642" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到以太网扫描中的合同地址，选择<strong class="ky ir">读取为代理</strong>:</p><p id="da23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://rinkeby.etherscan.io/address/%7BPROXY_ADDRESS" rel="noopener ugc nofollow" target="_blank">https://rinkeby.etherscan.io/address/{PROXY_ADDRESS</a></p><p id="68c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击<strong class="ky ir">确认。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/b5b26d67b31307ae90afbda3f78b5b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z_ZP9qLypn5bXgx-"/></div></div></figure><p id="84bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">复制实现地址。</p><p id="67cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从命令行使用此地址来验证实现的智能合约。</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="746b" class="mz lt iq mt b gy na nb l nc nd">npx hardhat verify — network rinkeby 0xf92d88cbfac9e20ab3cf05f6064d213a3468cf77</span><span id="8244" class="mz lt iq mt b gy ne nb l nc nd">Nothing to compile<br/>Successfully submitted source code for contract contracts/MyToken.sol:MyToken at 0xf92d88cbfac9e20ab3cf05f6064d213a3468cf77 for verification on the block explorer. Waiting for verification result…</span><span id="59b5" class="mz lt iq mt b gy ne nb l nc nd">Successfully verified contract MyToken on Etherscan.</span><span id="7975" class="mz lt iq mt b gy ne nb l nc nd"><a class="ae kv" href="https://rinkeby.etherscan.io/address/0xf92d88cbfac9e20ab3cf05f6064d213a3468cf77#code" rel="noopener ugc nofollow" target="_blank">https://rinkeby.etherscan.io/address/0xf92d88cbfac9e20ab3cf05f6064d213a3468cf77#code</a></span></pre><h1 id="c0ad" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">辩护人合同管理</h1><p id="7de9" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Defender的管理功能使管理合同管理和调用合同功能变得容易。为此，需要将合同导入Defender。导入合同不会以任何方式影响合同所有权，并且对于您没有部署的合同，它可以像对于您已经部署的合同一样容易地完成。举个简单的例子，你可以把艺术块NFT合同添加到你的管理仪表板上，轻松地监控合同状态，还可以做一些更有趣的事情，比如每次铸造新的NFT时发出一个哨兵通知。</p><p id="1b47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Defender中，导航到<strong class="ky ir">管理</strong> → <strong class="ky ir">添加合同</strong> → <strong class="ky ir">导入合同。</strong></p><p id="8ba0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">给它一个名字，选择<strong class="ky ir"> Rinkeby </strong>，从Etherscan粘贴你的合同代理地址。</p><p id="b2bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">防守方会发现合同是可升级的和可暂停的。</p><p id="90dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选择<strong class="ky ir">添加。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/67660f378f9260c961621cc9d91ee1b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L6jdLUQw6cA86hT1"/></div></div></figure><h1 id="d6a0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用Hardhat部署版本2</h1><p id="06d3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">编辑智能合约的代码，在文件的最后添加以下内容:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="e616" class="mz lt iq mt b gy na nb l nc nd">contract MyTokenUpgraded is MyToken {</span><span id="c873" class="mz lt iq mt b gy ne nb l nc nd">function version() pure public returns(uint){<br/>  return 2;</span><span id="e761" class="mz lt iq mt b gy ne nb l nc nd">  }</span><span id="2474" class="mz lt iq mt b gy ne nb l nc nd">}</span></pre><p id="4573" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为这个契约继承了以前部署的契约，所以它包含了现有的功能以及刚刚添加的这个功能。</p><p id="6341" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，创建一个脚本来部署新的实现契约:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="311e" class="mz lt iq mt b gy na nb l nc nd">touch scripts/upgrade.js</span></pre><p id="6b6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加以下内容，替换代理地址:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="e8e7" class="mz lt iq mt b gy na nb l nc nd">const { ethers, upgrades } = require(“hardhat”);</span><span id="fdf9" class="mz lt iq mt b gy ne nb l nc nd">async function main() {<br/>const CubeTokenUpg = await ethers.getContractFactory(“CubeTokenUpgraded”);</span><span id="1db2" class="mz lt iq mt b gy ne nb l nc nd">const cubeTokenUpg = await upgrades.prepareUpgrade(“{{YOUR_PROXY_ADDRESS}}”, CubeTokenUpg);</span><span id="63f7" class="mz lt iq mt b gy ne nb l nc nd">console.log(“Upgrade Implementation address:”, cubeTokenUpg);</span><span id="4d75" class="mz lt iq mt b gy ne nb l nc nd">}</span><span id="c9a4" class="mz lt iq mt b gy ne nb l nc nd">main()</span><span id="8474" class="mz lt iq mt b gy ne nb l nc nd">.then(() =&gt; process.exit(0))</span><span id="967b" class="mz lt iq mt b gy ne nb l nc nd">.catch((error) =&gt; {</span><span id="e5a1" class="mz lt iq mt b gy ne nb l nc nd">console.error(error);</span><span id="b0f4" class="mz lt iq mt b gy ne nb l nc nd">process.exit(1);</span><span id="8399" class="mz lt iq mt b gy ne nb l nc nd">});</span></pre><p id="7a1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b"><a class="ae kv" href="https://docs.openzeppelin.com/upgrades-plugins/1.x/api-hardhat-upgrades#prepare-upgrade" rel="noopener ugc nofollow" target="_blank">prepareUpgrade</a></code>函数验证和部署实现契约。</p><p id="0cd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行脚本以部署升级的合同:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="3193" class="mz lt iq mt b gy na nb l nc nd">npx hardhat run scripts/upgrade.js — network rinkeby 0xB463054DDa7a0BD059f1Ba59Fa07Ebd7f531E9d7</span></pre><h1 id="0401" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">通过Defender升级代理</h1><p id="82b0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">已经部署了升级的实现，但是代理当前仍然指向初始版本。</p><p id="2798" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过选择<strong class="ky ir">新提议</strong> → <strong class="ky ir">升级</strong>来使用Defender升级合同。</p><p id="892a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">粘贴您刚刚获得的新实现的地址。由于合同仍然属于您的元掩码帐户，并且该帐户连接到Defender，因此您将保留管理合同和管理地址为空。</p><p id="1ed2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">给升级起一个友好的名字和(可选的)描述，然后选择<strong class="ky ir">创建升级建议</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/a3279bc7096207d243db8413426021a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zey4jBWC0ccJiziP"/></div></div></figure><p id="7742" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下一个屏幕上，查看详细信息并执行升级。</p><p id="9f85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，在合同的管理控制面板下，您会看到列出了升级。从控制面板中选择它会将您带回该交易的帐户详细信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/baf52714058f8553cee2d6732dd8c2b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QZfIVFY133RwBAme"/></div></div></figure><h1 id="b428" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">将所有权转让给Multisig</h1><p id="85d4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">智能合约的所有者成为Metamask中的单一帐户并不十分安全。下一步，将所有权转让给之前创建的multisig。</p><p id="9f15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<strong class="ky ir">管理</strong>下，选择<strong class="ky ir">新提案</strong> → <strong class="ky ir">管理动作</strong>。</p><p id="16b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Ownable契约的一个功能是<code class="fe mq mr ms mt b">transferOwnership</code>，它完成了您所期望的功能。要通过Defender Admin执行它，只需从<strong class="ky ir">功能</strong>下拉菜单中选择它。该函数接受新所有者地址的参数。为此，选择您之前创建的Gnosis Safe Multisig的名称。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/33ed86fa55890c8a189405678847de2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hFTTi77RJav5e6c-"/></div></div></figure><p id="2971" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于该功能，<strong class="ky ir">执行策略</strong>仍然是<strong class="ky ir"> EOA </strong>。为管理操作提议命名，选择<strong class="ky ir">创建管理操作</strong>，然后使用您连接的元掩码帐户执行事务。</p><p id="0c35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成此步骤后，合同的新所有者是multisig，因此未来的交易将需要两次批准。</p><h1 id="2c3f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用Hardhat提议新的升级</h1><p id="80a8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">智能合约的可升级性之所以有益，有许多可能的原因。如果你的审计员(或者恶意的黑客或机器人)在你的合同中发现了一个漏洞，该怎么办？一个不可升级的合同将没有一个优雅的解决方案。另一个例子是迭代开发中更常见的——契约可升级性给了契约所有者根据需要添加、修改或删除功能的选项。关于升级合同，还有其他<a class="ae kv" href="https://docs.openzeppelin.com/upgrades-plugins/1.x/writing-upgradeable#modifying-your-contracts" rel="noopener ugc nofollow" target="_blank">注意事项</a>。现有的存储变量不能更改，您声明的任何新变量都必须添加到现有变量之后。关于功能，你有更多的灵活性。在新的升级中，可以添加、修改或删除功能。要特别注意不要意外妨碍了合同的升级功能，否则合同将永远失去升级能力。</p><p id="38b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用hardhat-defender，你可以<a class="ae kv" href="https://docs.openzeppelin.com/upgrades-plugins/1.x/api-hardhat-upgrades#defender-propose-upgrade" rel="noopener ugc nofollow" target="_blank">提议升级</a>另一个账户拥有的合同。这将创建一个在Defender中进行审查的提案。</p><p id="78ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将需要创建一个类似于之前的脚本。</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="04bb" class="mz lt iq mt b gy na nb l nc nd">touch propose-upgrade.js</span><span id="6600" class="mz lt iq mt b gy ne nb l nc nd">const { defender } = require(“hardhat”);</span><span id="ba03" class="mz lt iq mt b gy ne nb l nc nd">async function main() {</span><span id="6986" class="mz lt iq mt b gy ne nb l nc nd">const proxyAddress = ‘{{INSERT_YOUR_PROXY_ADDRESS}}’;</span><span id="419c" class="mz lt iq mt b gy ne nb l nc nd">const CubeTokenV3 = await ethers.getContractFactory(“CubeTokenV3”);</span><span id="9725" class="mz lt iq mt b gy ne nb l nc nd">console.log(“Preparing proposal…”);</span><span id="7b67" class="mz lt iq mt b gy ne nb l nc nd">const proposal = await defender.proposeUpgrade(proxyAddress, CubeTokenV3, {title: ‘Propose Upgrade to V3’, multisig: ‘{{YOUR MULTISIG ADDRESS}}’ });</span><span id="8179" class="mz lt iq mt b gy ne nb l nc nd">console.log(“Upgrade proposal created at:”, proposal.url);</span><span id="61ad" class="mz lt iq mt b gy ne nb l nc nd">}</span><span id="58f3" class="mz lt iq mt b gy ne nb l nc nd">main()</span><span id="045e" class="mz lt iq mt b gy ne nb l nc nd">.then(() =&gt; process.exit(0))</span><span id="0799" class="mz lt iq mt b gy ne nb l nc nd">.catch(error =&gt; {</span><span id="aa26" class="mz lt iq mt b gy ne nb l nc nd">console.error(error);</span><span id="e06b" class="mz lt iq mt b gy ne nb l nc nd">process.exit(1);</span><span id="3f56" class="mz lt iq mt b gy ne nb l nc nd">})</span></pre><p id="08aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，运行建议:</p><pre class="kg kh ki kj gt mv mt mw mx aw my bi"><span id="77f6" class="mz lt iq mt b gy na nb l nc nd">npx hardhat run scripts/propose-upgrade.js — network rinkeby</span><span id="9573" class="mz lt iq mt b gy ne nb l nc nd">Compiled 1 Solidity file successfully<br/>Preparing proposal…<br/>Upgrade proposal created at: <a class="ae kv" href="https://defender.openzeppelin.com/#/admin/contracts/rinkeby-0x98A28EdD77Ba4249D85cbe9C902c92b037C6b977/proposals/2a577119-ab7b-4ab8-837d-b81acccc2684" rel="noopener ugc nofollow" target="_blank">https://defender.openzeppelin.com/#/admin/contracts/rinkeby-0x98A28EdD77Ba4249D85cbe9C902c92b037C6b977/proposals/2a577119-ab7b-4ab8-837d-b81acccc2684</a></span></pre><p id="7bb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击该链接将带您进入Defender中的提案审查页面，如果需要，您可以选择<strong class="ky ir">批准并执行</strong>。</p><h1 id="ce8c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">看看NFT</h1><p id="943c" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">你在之前铸造了一枚NFT代币。现在，它应该可以在OpenSea的浏览器中查看了。进入<a class="ae kv" href="https://testnets.opensea.io" rel="noopener ugc nofollow" target="_blank"> testnets.opensea.io </a>，选择下拉菜单，输入代理合同地址。除了按enter键之外，还需要单击下拉列表中代理合同地址的链接。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/0c28b84b0859b3aef3a34ec19554e4d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tujpBWI7yfWLmGFa"/></div></div></figure><p id="8aa7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜你！您已经成功使用OpenZeppelin Defender和Hardhat部署了一个UUPS可升级的ERC721 NFT合约，将所有权转移给了一个Gnosis Safe Multisig，并部署了一个升级的实施合约。</p><h1 id="3279" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">资源</h1><ul class=""><li id="41f3" class="nl nm iq ky b kz mk lc ml lf nn lj no ln np lr nq nr ns nt bi translated">OpenZeppelin <a class="ae kv" href="https://docs.openzeppelin.com/defender/" rel="noopener ugc nofollow" target="_blank">防御者</a></li><li id="ae11" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">OpenZeppelin <a class="ae kv" href="https://docs.openzeppelin.com/contracts/4.x/" rel="noopener ugc nofollow" target="_blank">合同</a></li><li id="ce8f" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated"><a class="ae kv" href="https://www.npmjs.com/package/@openzeppelin/hardhat-upgrades" rel="noopener ugc nofollow" target="_blank">安全帽升级</a> NPM套装</li><li id="8081" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">安全帽后卫 NPM包</li><li id="67ee" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated"><a class="ae kv" href="https://www.npmjs.com/package/nft.storage" rel="noopener ugc nofollow" target="_blank"> nft.storage </a> NPM包</li></ul></div></div>    
</body>
</html>