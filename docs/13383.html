<html>
<head>
<title>R and C++ Together: An Introduction to Rcpp</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">r和C++一起:Rcpp简介</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/r-and-c-together-an-introduction-to-rcpp-b995b01cdfb6?source=collection_archive---------15-----------------------#2022-08-22">https://betterprogramming.pub/r-and-c-together-an-introduction-to-rcpp-b995b01cdfb6?source=collection_archive---------15-----------------------#2022-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0996" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在研发中实现高绩效</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5d554980d845fe03efc07cccde5f4b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0kSppJSHyNSTmPHM"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="04d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">r是一种漂亮的编程语言，它有很多优点。</p><p id="4e93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不幸的是，性能不是其中之一。R虽然可读性强，功能多，但并不以性能见长。作为一种动态类型和解释的语言，R容易出现属于这些类别的语言的所有不足之处。编程语言的性能由许多因素决定。但两个事实是，我们每次运行R脚本，都会有一个叫“解释器”的信使来传达和翻译代码。而且每次我们运行R脚本时，在翻译过程中指定的每个变量的类型，称为“运行时”，足以使R成为一种缓慢的编程语言。</p><p id="fd33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好消息是有很多解药可以克服慢的困难。使用一套合适的工具，我们可以获得显著的性能提升。最合法的方法是从低级编程语言中获得帮助。本文旨在让您开始用C++重写代码的瓶颈。</p><h1 id="9402" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是C++，为什么它很重要？</h1><p id="169f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">C++是世界上最强大的编程语言之一，它无处不在。我们每天使用的成千上万的设备都运行在C++上。它是另一种著名的编程语言c的继承者。</p><p id="68a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">举一点历史的例子，C语言是由丹尼斯·里奇在1972年创造的。当时，C语言在计算世界引起了一场革命，但是随着时间的推移，它的用户意识到它缺乏其他语言所拥有的一些最好的特性。其中之一是面向对象编程。由于这种认识，丹麦计算机科学家比雅尼·斯特劳斯特鲁普于1985年创造了C++。C++扩展了C的功能，增加了面向对象的范例。事实上，C++只是意味着“有类的C”</p><p id="3034" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">几十年来，C++在编程世界中扮演着重要的角色，几乎影响了编程世界的每一个部分。幸运的是，对于我们R程序员来说，C++与R有着非常密切的联系，因此我们可以从这种联系中受益，并增强我们R项目的能力。当您经历R之旅时，您会惊讶于少量C++代码在R项目中的作用。</p><h1 id="fa2b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">扩展R的老方法</h1><p id="3dfd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">传统上，R提供了几个内置工具来与另外两种语言C和Fortran接口。随着Fortran的过时，C已经成为R的首选语言。为此，标准R提供了两个函数来连接R和C: <code class="fe mp mq mr ms b">.C()</code>和<code class="fe mp mq mr ms b">.Call()</code>。然而，这种传统的方式是如此的过时和痛苦。因此，我们将着眼于一种更加现代和用户友好的方式，在本文中不提及这两个功能。</p><h1 id="788a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Rcpp</h1><p id="9119" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">帮助我们用C++美化R项目的那片天，是一个叫Rcpp的包。Rcpp是由另一位来自加拿大的计量经济学家Dirk Eddelbuettel领导的团队开发的。Rcpp提供了一个R和C++之间的接口，这个包非常强大，以至于Springer出版了一整本书“用Rcpp无缝集成R和C++”。</p><p id="3982" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过运行以下代码开始:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="b281" class="mx lt iq ms b gy my mz l na nb">library(Rcpp)</span></pre><h1 id="ab6d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在脚本中将C++转换成R</h1><p id="8b1f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">提高R脚本性能的最简单快捷的方法是修改脚本中有问题的部分，并用C++重写。<code class="fe mp mq mr ms b">Rcpp::cppFunction()</code>功能正是你需要的东西。既整洁又方便。<code class="fe mp mq mr ms b">cppFunction()</code>取一个C++函数，转换成R函数。你所要做的就是把你的C++函数作为一个字符串来传递，它会做剩下的事情。</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="daaa" class="mx lt iq ms b gy my mz l na nb">Rcpp::cppFunction()</span></pre><p id="0047" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了简单起见，我们将编写两个额外的函数:一个用R编写，另一个用C++编写。这些将说明<code class="fe mp mq mr ms b">cppFunction()</code>的用法。</p><p id="f045" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面你可以找到用R写的附加函数:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="6362" class="mx lt iq ms b gy my mz l na nb">addition_r &lt;- function(a , b) {<br/>  a + b<br/>}</span><span id="c24d" class="mx lt iq ms b gy nc mz l na nb">addition_r(5 , 10)</span><span id="b961" class="mx lt iq ms b gy nc mz l na nb">## [1] 15</span></pre><p id="48bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们用C++写同样的函数，并像用r写一样使用它。</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="ea4f" class="mx lt iq ms b gy my mz l na nb">addition_cpp &lt;- cppFunction('int additioncpp(int a, int b) {<br/>  int sum = a + b ;<br/>  return sum;<br/>}')</span><span id="6df3" class="mx lt iq ms b gy nc mz l na nb">addition_cpp(5 , 10)</span><span id="1f25" class="mx lt iq ms b gy nc mz l na nb">## [1] 15</span></pre><p id="c9a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这非常简单，可以节省你大量的时间。</p><p id="eb90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管对于几百行的脚本来说，使用上面这样快速而肮脏的方法很有诱惑力，但这并不是构建整个项目最理想的方式。大多数R项目不是一个脚本，而是由数十个脚本组成。在这种情况下，我们可能希望将整个C++文件导入到我们的R会话中。这是下一个话题的主题。</p><h1 id="ea35" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">在R项目中使用单独的C++文件</h1><p id="57e6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">为了使用一个单独的C++文件的各个部分，我们受益于<code class="fe mp mq mr ms b">Rcpp::sourceCpp()</code>函数。</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="b701" class="mx lt iq ms b gy my mz l na nb">Rcpp::sourceCpp()</span></pre><p id="545b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而窍门就是，对于每一个你想从C++文件导入的函数，你都必须加上这个指示符:<code class="fe mp mq mr ms b">// [[Rcpp::export]]</code>。</p><p id="a9bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面，你可以看到一个准备好导入的C++文件的例子。保存为<code class="fe mp mq mr ms b">arithmetic.cpp</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="4810" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，下面的代码导入了预先指定的<code class="fe mp mq mr ms b">arithmetic.cpp</code>内容。</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="bb89" class="mx lt iq ms b gy my mz l na nb">sourceCpp("C:/Users/ugurc/Desktop/Medium Blog/High Performance in R/arithmetic.cpp")</span><span id="646c" class="mx lt iq ms b gy nc mz l na nb">subtractioncpp(a = 10 , b = 5)</span><span id="805c" class="mx lt iq ms b gy nc mz l na nb">## [1] 5</span><span id="c9c4" class="mx lt iq ms b gy nc mz l na nb">multiplicationcpp(a = 10 , b = 5)</span><span id="dc68" class="mx lt iq ms b gy nc mz l na nb">## [1] 50</span></pre><h1 id="82f8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="95db" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">每天，在世界各地，R开发人员创造了成千上万的精彩项目，成千上万的应用程序运行R代码，数百万美元的行业使用R。每当这种美丽的语言短缺时，我们就部署各种解决方案。</p><p id="b0f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应用低级语言是解决这些缺点的最有效的方法。现在，根据本文中的信息，您可以通过用C++重写R应用程序的瓶颈来重新创建R应用程序。</p></div></div>    
</body>
</html>