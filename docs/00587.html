<html>
<head>
<title>How To Use Swift for iOS to WatchConnectivity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Swift for iOS来观察连通性</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/watchconnectivity-swift-1f8cffb7c7a9?source=collection_archive---------2-----------------------#2019-06-15">https://betterprogramming.pub/watchconnectivity-swift-1f8cffb7c7a9?source=collection_archive---------2-----------------------#2019-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1999" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Swift和Xcode在iOS和watchOS之间共享数据的教程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://github.com/ewalk40/WatchConnectivityDemo"><div class="gh gi kf"><img src="../Images/0833141e053ddf5ee57d13f5d1f010eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/1*rU5qL34sKH0VVZVmr1iHhA.gif"/></div></a><p class="kn ko gj gh gi kp kq bd b be z dk translated">手表连接演示</p></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="cce5" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">介绍</h1><p id="7d77" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">我一直在互联网上搜索一个关于<a class="ae mm" href="https://developer.apple.com/documentation/watchconnectivity" rel="noopener ugc nofollow" target="_blank"> WatchConnectivity </a>的很好的例子(在<a class="ae mm" href="https://developer.apple.com/swift/" rel="noopener ugc nofollow" target="_blank"> Swift </a>)。</p><p id="339d" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">搜索了一段时间后，我无法真正找到我想要的，所以我决定通过苹果文档和其他一些来源来了解这个主题。</p><p id="ce74" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">我希望把这个话题做成一个系列，如果我找不到好的教程，我会使用苹果文档和其他资源来学习这个话题。然后，我将创建一个演示应用程序，并在这里写一个故事，来展示我所学到的一切。</p><p id="6a92" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">我还会将本教程的项目文件放在本文底部它们自己的部分，这样你就可以下载它们并跟随本教程。</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="c8a9" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated"><strong class="ak">它是什么，有什么用？</strong></h1><p id="d260" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">从根本上说，WatchConnectivity是一种在iOS应用程序和watchOS应用程序之间共享数据的简单方法，反之亦然。</p><p id="2445" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">我在App Store上创建了一些应用程序，这些应用程序将受益于这一功能。如果能够“同步”(因为没有更好的词)你手机上的乐谱和你手表上的乐谱就好了，反之亦然。</p><p id="cf51" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">现在我已经学会了如何使用WatchConnectivity，我肯定会在我的游戏中实现它。</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="9ec1" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">要求</h1><ul class=""><li id="986f" class="ms mt iq ls b lt lu lw lx lz mu md mv mh mw ml mx my mz na bi translated">Xcode 10</li><li id="53ae" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">Swift 4(及更高版本)</li></ul><p id="8534" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">我假设您已经安装并设置了<a class="ae mm" href="https://developer.apple.com/xcode/" rel="noopener ugc nofollow" target="_blank"> Xcode </a>，并且准备好开始了，因为这是一个稍微高级一点的教程，不仅仅是向您展示您可以在Xcode中打印变量。</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="a706" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">入门指南</h1><p id="65a7" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">第一件事是打开Xcode并选择<code class="fe ng nh ni nj b">iOS App with WatchKit App</code>。这样我们就不用再去找目标了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nl nm di nn bf no"><div class="gh gi nk"><img src="../Images/f9c26e8e595f77f829ddfbfcc334be28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0-7yT_mDNwTgfmqFgqAgag.png"/></div></div></figure><p id="b798" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">在下一个屏幕中，选择一个<code class="fe ng nh ni nj b">Product Name</code>并填写剩余的必要字段。你可以不选<code class="fe ng nh ni nj b">Include Notification Scene</code>，因为在Xcode 10.2.1中它是默认选中的，我们在本教程中不需要它。</p><p id="39ef" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">现在您有了一个空白的Xcode项目。</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="4ce8" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated"><strong class="ak">界面</strong></h1><p id="77d1" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">我总是喜欢先构建界面，因为我喜欢看到我所做的事情取得进展，构建UI总是让我觉得我已经完成了一些事情。</p><p id="76c4" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">首先，进入<code class="fe ng nh ni nj b">Main.storyboard</code>，将一个<code class="fe ng nh ni nj b">Text Field</code> <strong class="ls ir"> </strong>和一个<strong class="ls ir"> </strong> <code class="fe ng nh ni nj b">Button</code>拖到iOS故事板上。</p><p id="e06a" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">根据您的要求配置<code class="fe ng nh ni nj b">Text Field</code>和<code class="fe ng nh ni nj b">Button</code>。按住<code class="fe ng nh ni nj b">Command-Alt-Enter</code>进入助理编辑，在<code class="fe ng nh ni nj b">ViewController.swift</code>做<code class="fe ng nh ni nj b">IBOutlets</code>。</p><p id="853b" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">这是我的界面加了一个<code class="fe ng nh ni nj b">Text Field</code>和一个<code class="fe ng nh ni nj b">Button</code>后的样子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/ccaf96b336d500b4725986abd05dbe5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*_sIhup1JH816ssXecPduuQ.png"/></div></figure><p id="00f9" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">现在打开你的<code class="fe ng nh ni nj b">Interface.storyboard</code>，我们就可以开始配置Apple Watch应用的外观了。一个警告强硬；用户界面看起来不会很好，因为我想尽可能做最简单的教程，不想被外观所困扰。</p><p id="b18c" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">对于手表应用程序，您需要的只是屏幕顶部的一个<code class="fe ng nh ni nj b">label</code> <strong class="ls ir"> </strong>，让它做与iOS应用程序相同的事情，并将标签连接到<code class="fe ng nh ni nj b">InterfaceController.swift</code>中的一个<code class="fe ng nh ni nj b">IBOutlet</code> <strong class="ls ir"> </strong>。</p><p id="fcca" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">当我完成时，我的Apple Watch UI看起来是这样的(标签中的破折号只是我喜欢在这些情况下使用的占位符的一个例子)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/efc9c50ae2e95a95726c45f88ea32b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*xD8Z_kwUHZoW0FFIBxhYfQ.png"/></div></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="3c9f" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated"><strong class="ak">代码</strong></h1><p id="9329" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">我们已经创建了一个最低限度的用户界面，但是现在是你来这里的时候了——让一切工作的代码。</p><p id="2c7e" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">先从iOS <strong class="ls ir"> </strong>这边的事情说起。</p><p id="69a1" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">下面是我的<code class="fe ng nh ni nj b">ViewController.swift</code>完全完成版。我想让你看看这实际上有多难。</p><p id="1e20" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">在代码下面是对文件中所有内容的解释。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><ul class=""><li id="fcf4" class="ms mt iq ls b lt mn lw mo lz nt md nu mh nv ml mx my mz na bi translated">第三行。为了让你的手表和手机相互通话，我们需要引入一个框架来实现这一点，所以我们引入了WatchConnectivity。</li><li id="3c01" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第五行。在减速<code class="fe ng nh ni nj b"> Class ViewController: UIViewController</code>之后，我们必须允许iOS应用程序使用上面的导入语句，因此我们为应用程序添加了<code class="fe ng nh ni nj b">WCSessionDelegate</code>以利用WatchConnectivity框架。</li><li id="091c" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第九行。这只是<code class="fe ng nh ni nj b">Main.storyboard</code>上<code class="fe ng nh ni nj b">Text Field</code>的出口。</li><li id="14a0" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第13行。为了使访问<code class="fe ng nh ni nj b">WCSession</code>类更容易一点，我将它存储在一个变量中。</li><li id="776f" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第20–22行。将上述变量设置为默认会话，并将<code class="fe ng nh ni nj b">WCSession</code>委托设置为<code class="fe ng nh ni nj b">ViewController</code>，最后激活<strong class="ls ir"> </strong>会话<code class="fe ng nh ni nj b">WCSession</code>。</li><li id="8c93" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第28行。这是<code class="fe ng nh ni nj b">Main.storyboard</code>上<code class="fe ng nh ni nj b">Button</code>的动作。</li><li id="ed5c" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第30行。这将变量<code class="fe ng nh ni nj b">txt</code> <strong class="ls ir"> </strong>设置为<code class="fe ng nh ni nj b">Text Field</code>，该变量当前在字段本身中</li><li id="f7ab" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第31行。为了能够向手表发送任何数据，我们必须用我们想要发送的数据创建一个字典<strong class="ls ir"> </strong>。对于本教程，我只是在键<code class="fe ng nh ni nj b">message</code>下发送一个字符串<strong class="ls ir"> </strong> ( <code class="fe ng nh ni nj b">txt</code>)给手表。</li><li id="3d7e" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第33–37行。这是实际向手表发送数据的方法。我在处理<code class="fe ng nh ni nj b">print(error.localizedDescription)</code>的时候也犯了一些错误，但是你不必这么做。只要将变量<code class="fe ng nh ni nj b">message</code> <strong class="ls ir"> </strong>传递给方法<code class="fe ng nh ni nj b">wcSession.sendMessage()</code>就可以了。</li><li id="c3fb" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第42–58行。这些只是委托<code class="fe ng nh ni nj b">WCSessionDelegate</code>附带的默认方法，但是在本教程中我们不需要它们。</li></ul><p id="560e" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">所以一旦你完成了这些，你的iOS应用程序就应该准备好了。</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="cbf4" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">事物的观察面</h1><p id="d60d" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">现在，让我们开始观察事物的另一面。你会在下面找到我的<code class="fe ng nh ni nj b">InterfaceController.swift</code>的完整版本，但我还是会相对详细地浏览一遍。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><ul class=""><li id="35b0" class="ms mt iq ls b lt mn lw mo lz nt md nu mh nv ml mx my mz na bi translated">四号线。就像在<code class="fe ng nh ni nj b">ViewController.swift</code>中一样，我们需要导入WatchConnectivity <strong class="ls ir"> </strong>，这样我们就可以使用那个框架。</li><li id="0085" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第六行。我们需要将<code class="fe ng nh ni nj b">WCSessionDelegate</code>添加到<code class="fe ng nh ni nj b">InterfaceController</code>(这将再次使用我们在本教程中不会使用的默认方法)。</li><li id="e42d" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">10号线。<code class="fe ng nh ni nj b">Interface.storyboard</code>的标签出口。</li><li id="379b" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第14行。<code class="fe ng nh ni nj b">WCSession</code>变量同上。</li><li id="3b27" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第26–28行。来自<code class="fe ng nh ni nj b">ViewController.swift</code>的相同代码，基本上只是确保<code class="fe ng nh ni nj b">WCSession</code> <strong class="ls ir"> </strong>会话在<code class="fe ng nh ni nj b">ViewController</code>和<code class="fe ng nh ni nj b">InterfaceController</code>启动后立即启动。</li><li id="9505" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第37行。来自<code class="fe ng nh ni nj b">WCSessionDelegate</code>的方法，允许手表在收到来自iOS应用程序的消息时运行代码。</li><li id="a34a" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第39行。将变量<code class="fe ng nh ni nj b">text</code>设置为iOS应用程序发送的消息。<code class="fe ng nh ni nj b">didRecieveMessage</code> <strong class="ls ir"> </strong>方法传递数据字典。这个字典和iOS应用程序发送的字典是一样的，所以方括号<em class="nw">内的字符串</em>必须和<code class="fe ng nh ni nj b">ViewController.swift</code>中的字典中的键相同。</li><li id="af13" class="ms mt iq ls b lt nb lw nc lz nd md ne mh nf ml mx my mz na bi translated">第41行。这会将标签<code class="fe ng nh ni nj b">text</code>设置为字典中传递给<code class="fe ng nh ni nj b">didRecieveMessage</code> <strong class="ls ir"> </strong>方法的值。</li></ul><p id="fd22" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">这就是watchOS代码！</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="b0fa" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated"><strong class="ak">运行应用程序</strong></h1><p id="0f85" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">现在你所要做的就是运行将应用程序部署到Apple Watch的方案。Apple Watch应用程序加载后(第一次可能需要几分钟)，在iPhone主屏幕上点按该应用程序。现在你应该有两个应用程序在运行。</p><p id="f95e" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">剩下要做的就是在文本栏中键入一条信息，然后点击按钮——点击按钮后几秒钟内就可以看到Apple Watch上的标签更新。这方面的演示可以显示在页面的顶部。</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="d033" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated"><strong class="ak">结论</strong></h1><p id="06bb" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">我喜欢用介质写这篇文章。我是教程写作的新手，所以请在下面留下任何评论或反馈。</p><p id="4a0f" class="pw-post-body-paragraph lq lr iq ls b lt mn jr lv lw mo ju ly lz mp mb mc md mq mf mg mh mr mj mk ml ij bi translated">我认为这是写作和尝试一些好东西的良好开端！感谢阅读。</p></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="2c65" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">项目文件</h1><p id="db59" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">这是本教程的GitHub项目的链接。</p><div class="nx ny gp gr nz oa"><a href="https://github.com/ewalk40/WatchConnectivityDemo" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">ewalk40/WatchConnectivityDemo</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">WatchOS 5 WatchConnectivity演示应用。在…上创建帐户，为ewalk40/WatchConnectivityDemo开发做出贡献</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kl oa"/></div></div></a></div></div></div>    
</body>
</html>