<html>
<head>
<title>Build a 3D Bar Chart in SceneKit With SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI在SceneKit中构建3D条形图</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-3d-bar-chart-in-scenekit-with-swiftui-789a2631ef6f?source=collection_archive---------15-----------------------#2022-06-14">https://betterprogramming.pub/build-a-3d-bar-chart-in-scenekit-with-swiftui-789a2631ef6f?source=collection_archive---------15-----------------------#2022-06-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="83eb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建新Apple图表库的缺失组件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a6146d06e139943e52e6fc286d1ac171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xygBL7pZWPKc7AKyo6IhJg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">您将使用本文构建的图表的动画GIF</p></figure><p id="ab42" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在WWDC 2022之前开始这篇文章，这是一个由苹果宣布的性感新框架，名为<a class="ae lu" href="https://developer.apple.com/documentation/Charts" rel="noopener ugc nofollow" target="_blank">图表</a>。当我在最新的SwiftUI演讲中听到宣布我可能已经被打败后，我曾短暂地担心过，但当我意识到苹果图表框架只做2D图表时，我感觉好多了。</p><p id="7780" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">也就是说，我确实在去年写了几篇关于构建2D饼状图的文章，这些文章现在都已经不存在了——但是这篇文章还活着。请和我一起使用我在过去一个月左右的时间里一直在谈论的SceneKit框架，不是为了构建一个游戏，而是一些更普通的东西，一个3D条形图。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="075f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">技术栈</h1><p id="835b" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">好的——我们将需要一个运行在SwiftUI中的<code class="fe mz na nb nc b">SCNScene</code>,以及一个链接两者的联合发布者。在场景中，我想画一行盒子&amp;标签，我打算用<code class="fe mz na nb nc b">SCNMorph</code>来改变盒子的大小。我将使用一种结构来运行它，这种结构很像在Apple关于新图表框架的演讲中描述的结构。</p><h2 id="11dd" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated">三维图表</h2><p id="cf7e" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">bon——我首先将这些线条添加到我的场景中。它们不加载任何数据；他们只是凭空生成一些数字，然后用线条创建一个超级简单的3D条形图。这里的第一个挑战是形状从它们的中心开始生长，这种状态似乎几乎不可能改变。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="b805" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码有效地为我们构建了一个漂亮简单的4D图表，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/6fdb280180a292c9930cec34fe6d25d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*XG4EXTsjOmhaLFaL_w7caA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">3D条形图的快照[包括一个楼层，如下所述]</p></figure><h2 id="9433" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated">动画技术</h2><p id="9126" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">画完并排列好条形后，我决定添加一个<code class="fe mz na nb nc b">SCNFloor</code>让它看起来更时髦一点，并在一个<code class="fe mz na nb nc b">SCNMorph</code>周围添加了<code class="fe mz na nb nc b">SCNTransation</code>来使用动画改变条形的大小。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b08eeb18c409a1f12121cae66ddfef37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*XcgKNXlK5-xIB06tnP9Wuw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由事务管理的三维图表的大小调整</p></figure><h2 id="b41e" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated">配置</h2><p id="7874" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我通过Combine框架将它链接到SwiftUI接口，使用了我在本文<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/16-useful-extensions-for-swiftui-88aae6ff8909">中概述的订阅技术，并使用了一个带有SceneDelegate的singleton类。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="c6f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的代码包含在<code class="fe mz na nb nc b">GameScene.swift</code>文件中，基于Combine的关联主题通过SwiftUI界面中的一个简单的文本对象触发。</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="3a09" class="nd md it nc b gy nw nx l ny nz"><strong class="nc iu">Text("_5yawC")<br/>  .onTapGesture {<br/>    relocating.send(._5yawClockwise)<br/>}</strong></span></pre><p id="34d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码将让我定位我的三维条形图在屏幕上的最佳观看。</p><h2 id="8786" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated">相机视图</h2><p id="2854" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">正如我在<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/managing-the-camera-in-scenekit-under-swiftui-6608e7a0de52">这篇文章</a>中指出的，仅仅移动对象是不够的，我实现了一个单独的机制来移动场景使用的相机以查看3D条形图。这次我在<code class="fe mz na nb nc b">SceneDelegate.swift</code>内完成了工作</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="00a0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe mz na nb nc b">Common.shared</code>只是对SwiftUI接口和SceneKitDelegate代码之间的共享结构的引用。</p><p id="20f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">改变<code class="fe mz na nb nc b">superSIMDValue.xV</code>的值会导致不连续的移动，改变<code class="fe mz na nb nc b">share.superSIMDValue.RX</code>的值会导致每隔<code class="fe mz na nb nc b">spawnTime</code>秒执行一次的连续移动。</p><h2 id="fa24" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated">调色板</h2><p id="a3c5" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">当然，条形图需要颜色，这个主题比你想象的要复杂得多。我在这里写了所有关于颜色的<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/colour-hue-saturation-and-brightness-24661bb809a3">。切入正题，我决定现在添加一个固定的12色调色板。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/0e24baa5e2010a6ee356233c659e0f30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*sNADu_T-f0uUY92zGZJowg.png"/></div></figure><h2 id="1e82" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated">文本标签</h2><p id="4863" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">因为<a class="ae lu" href="https://developer.apple.com/videos/play/wwdc2022/10136/" rel="noopener ugc nofollow" target="_blank"> WWDC 2022关于这个主题的演讲</a>会告诉你没有标签的图表不是很有用，所以我也添加了一些。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3373c27e5cbf82abc23f61e9c3aaeb0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aWk6UoOHIWWtbF5Mg2--GA.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">带有显示不同值的标签的三维条形图</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="ecee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意，在将文本添加到所示的栏之前，我使用这段代码倾斜了文本，以确保它是可读的。</p><pre class="kj kk kl km gt ns nc nt nu aw nv bi"><span id="1120" class="nd md it nc b gy nw nx l ny nz">let quaternion = simd_quatf(angle: GLKMathDegreesToRadians(-45), axis: simd_float3(1,0,0))<br/>textNodes[k].simdOrientation = quaternion * textNodes[k].simdOrientation<br/>sourceNodes[k].addChildNode(textNodes[k])</span></pre><h2 id="0dd2" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated">整理</h2><p id="2383" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">这个项目带来的一个我没有意识到的事情是，3D条形图只有在描述一个随着时间推移而变大的数据集，一个排序集时才看起来好。我在视觉上做了这个；因为这当然是乐趣的一半。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8da6c4fb7fc21ef64a38ef87e89207f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ciADoViTFwuPT2EomZOrVw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个三维条形图排序本身。</p></figure><h2 id="c784" class="nd md it bd me ne nf dn mi ng nh dp mm lh ni nj mo ll nk nl mq lp nm nn ms no bi translated">神话；传奇</h2><p id="cde6" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">最后，我在<code class="fe mz na nb nc b">SceneKit</code>视图上添加了一个SwiftUI图例，最终结果如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/6136b3c0fe44d6f0cd093df2016f7f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*8PTEFPRXlCUu3ibZoQ7XSQ.png"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="a13b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我觉得一个3D条形图还是挺合理的；你觉得呢。我也应该在这里对这篇关于颜色的<a class="ae lu" href="https://www.heavy.ai/blog/12-color-palettes-for-telling-better-stories-with-your-data" rel="noopener ugc nofollow" target="_blank">文章</a>快速点头。我在这里使用了其中描述的调色板。</p><h1 id="a798" class="mc md it bd me mf oc mh mi mj od ml mm jz oe ka mo kc of kd mq kf og kg ms mt bi translated">将来的</h1><p id="debb" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">我认为你可以做一些事情来改善这种情况。</p><ul class=""><li id="3c40" class="oh oi it la b lb lc le lf lh oj ll ok lp ol lt om on oo op bi translated">排序本身可以更加动态，在您更改条形的值时发生。</li><li id="4201" class="oh oi it la b lb oq le or lh os ll ot lp ou lt om on oo op bi translated">我认为将标签放置在条形顶部可能会更好——一些微调。</li><li id="9ecf" class="oh oi it la b lb oq le or lh os ll ot lp ou lt om on oo op bi translated">数据可以/应该动态加载，所以可以是JSON或XML源。</li><li id="f319" class="oh oi it la b lb oq le or lh os ll ot lp ou lt om on oo op bi translated">你可以用相机做更多的事情，使用一些预先设定的路线，比如绕着图表转或者飞过图表。</li></ul><p id="9f93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有这些让我想到了这篇文章的结尾，我希望你能像我写这篇文章一样喜欢阅读它。你可以在这个<a class="ae lu" href="https://bitbucket.org/wizard1066/bars/src/master/" rel="noopener ugc nofollow" target="_blank">链接</a>上找到一个包含所有代码的位桶。</p></div></div>    
</body>
</html>