<html>
<head>
<title>How To Use Go With MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在MongoDB中使用Go</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-golang-with-mongodb-26f043d31d23?source=collection_archive---------7-----------------------#2022-04-08">https://betterprogramming.pub/how-to-use-golang-with-mongodb-26f043d31d23?source=collection_archive---------7-----------------------#2022-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="75a1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">连接到MongoDB服务器，用Go语言(Golang)执行基本的CRUD操作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ebb1deda122016ea02f989dcf71e33da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jtCEVc7u4gfdR6db"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@writecodenow?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">博伊图梅洛·菲特拉</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="9512" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您介绍如何在MongoDB中使用Golang。首先，我将向您展示如何安装MongoDB和重要的Golang包。</p><p id="bf58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们将连接到一个MongoDB服务器，ping它，并列出现有的数据库。之后，我将查看一个示例，其中我使用各种函数来执行CRUD操作。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9d3a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">安装MongoDB和Golang包</h1><p id="54a1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为您的平台安装MongoDB非常简单。你可以从<a class="ae ky" href="https://www.mongodb.com/try/download/community" rel="noopener ugc nofollow" target="_blank">这里</a>获得社区版。</p><p id="cf3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">鉴于我在windows上工作，我可以选择将MongoDB作为服务安装。我选择不这样做，因为我使用MongoDB作为测试服务器。但是，结果是我需要手动启动MongoDB。</p><h2 id="da7f" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">在windows上手动启动MongoDB</h2><p id="b054" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要手动启动MongoDB服务器，可以执行以下操作:</p><ul class=""><li id="f06d" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">首先，确保在运行命令的路径中有一个数据目录——在下面的例子中，它是<code class="fe nu nv nw nx b">./data</code>。</li><li id="6fd3" class="nl nm it lb b lc ny lf nz li oa lm ob lq oc lu nq nr ns nt bi translated">然后在您的终端中运行<code class="fe nu nv nw nx b">"C:\Program Files\MongoDB\Server\5.0\bin\mongod" — dbpath ./data</code>。你的道路可能略有不同。在这种情况下，您可以搜索<code class="fe nu nv nw nx b">mongod</code>,看看您的系统上的路径可能是什么。</li></ul><h2 id="41f8" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">MongoDB指南针桌面应用程序</h2><p id="2f66" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">也可以安装MongoDB Compass。在这里得到它<a class="ae ky" href="https://www.mongodb.com/try/download/compass" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="6d8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个桌面应用可以帮助你管理和审计你输入到MongoDB服务器的数据。</p><p id="02d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这对于测试来说非常方便，因为这个应用程序可以让你看到哪些数据库、集合和文档已经被创建。</p><h2 id="0eb0" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">服务器地址和密码</h2><p id="cf1d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文的其余部分，我的MongoDB数据库服务器将运行在地址<code class="fe nu nv nw nx b">mongodb://localhost:27017</code>上。</p><p id="45eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于数据库只是为了探索和测试Golang中的想法，我没有在数据库服务器上设置用户名和密码。</p><p id="b4e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您将它用于生产代码，您将需要保护您的MongoDB服务器。</p><p id="ef1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，当使用MongoDB服务器进行生产时，地址看起来会有所不同，包括用户名和密码。请参见此处的文档<a class="ae ky" href="https://www.mongodb.com/docs/manual/reference/connection-string/" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="e18e" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">为MongoDB安装Golang包</h2><p id="68cb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要在Golang中使用MongoDB，您可能需要在终端中运行以下命令:</p><pre class="kj kk kl km gt od nx oe of aw og bi"><span id="4c4e" class="mz md it nx b gy oh oi l oj ok">go mod init<br/>go get go.mongodb.org/mongo-driver/mongo<br/>go get go.mongodb.org/mongo-driver/bson</span></pre><h2 id="819f" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">BSON用于数据的序列化</h2><p id="d1db" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在上面的命令中，你可以看到我们也安装了BSON。BSON是一种类似于JSON的序列化格式。</p><p id="2af3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据BSON规范:</p><blockquote class="ol om on"><p id="e86c" class="kz la oo lb b lc ld ju le lf lg jx lh op lj lk ll oq ln lo lp or lr ls lt lu im bi translated">BSON [bee sahn]，是Bin ary JSON的缩写，是类似JSON的文档的二进制编码序列。像JSON一样，BSON支持文档和ar数组与其他文档和ar数组的嵌套。BSON还包含一些扩展，允许表示不属于JSON规范的数据类型。</p></blockquote><p id="5014" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其余规格可在此处阅读<a class="ae ky" href="https://bsonspec.org./" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="fedc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在MongoDB中使用它，用于保存文档数据和在查询中处理文档时创建过滤器等。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7101" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">MongoDB服务器连接和断开</h1><p id="916e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们从连接到MongoDB服务器开始。</p><p id="71ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以创造许多不同形式的语境。对于这个例子，我将创建尽可能简单的上下文，即<code class="fe nu nv nw nx b">context.TODO()</code>。你可以在这里阅读更多关于上下文<a class="ae ky" href="https://docs.mongodb.com/drivers/go/current/fundamentals/context/" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="be69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所述，我的数据库服务器位于:<code class="fe nu nv nw nx b">mongodb://localhost:27017</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="0206" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们在第17行推迟了断开客户机与数据库的连接。这意味着disconnect将发生在它所在的函数中的最后一条语句之后——在本例中，它是<code class="fe nu nv nw nx b">main()</code>。</p><p id="4391" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在一个语句之后发生任何错误，Go仍然会执行延迟的<code class="fe nu nv nw nx b">Disconnect()</code>函数调用。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ee48" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ping MongoDB服务器</h1><p id="fd60" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果我将MongoDB的端口更改为不正确的端口号，例如<code class="fe nu nv nw nx b">20000</code>，那么MongoDB客户端将不会给出错误。</p><p id="6dd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，为了确保我们有一个正确的连接，我们还可以<code class="fe nu nv nw nx b">Ping()</code>数据库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="0cc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码会给出一个错误，因为我的MongoDB服务器不是运行在端口<code class="fe nu nv nw nx b">20000</code>上，而是运行在端口<code class="fe nu nv nw nx b">27017</code>上。</p><p id="7320" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我将端口更改为正确的端口号，<code class="fe nu nv nw nx b">Ping()</code>语句将不会给出错误，程序将成功完成。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d2b5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">列出MongoDB服务器上的当前数据库</h1><p id="9a65" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">可以列出MongoDB服务器上的数据库。如果您刚刚安装了服务器，可能只有几个“管理”数据库。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="9e02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦添加了更多的数据库，您就会在第25行的语句打印的清单中看到它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a57e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建数据库集合</h1><blockquote class="ol om on"><p id="5977" class="kz la oo lb b lc ld ju le lf lg jx lh op lj lk ll oq ln lo lp or lr ls lt lu im bi translated">这里有一个提示:在其他数据库服务器中，集合通常被称为数据库表。</p></blockquote><p id="4cc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先在MongoDB服务器上创建一个名为<code class="fe nu nv nw nx b">test</code>的数据库，然后我们将向这个名为<code class="fe nu nv nw nx b">example</code>的数据库添加一个集合。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="4500" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于这只是一个示例，并且我们不想在程序运行后保留数据库，我们还将丢弃(删除)该集合。所以在第25行，我们将推迟<code class="fe nu nv nw nx b">Drop()</code>函数调用，这样它将在<code class="fe nu nv nw nx b">main()</code>函数中所有其他语句之后执行。</p><p id="f996" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，如果您希望在程序运行后保留数据库集合，您应该删除<code class="fe nu nv nw nx b">Drop()</code>语句(即删除第25行)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fd81" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将文档添加到集合</h1><p id="0054" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这里，我们将文档添加到刚刚创建的集合中。</p><p id="49f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们插入的每个文档包含三个字段:<code class="fe nu nv nw nx b">someString</code>、<code class="fe nu nv nw nx b">someInteger</code>和<code class="fe nu nv nw nx b">someStringSlice</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="e3a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第1–5行，我们创建了一个包含三个字段的文档，如上所述。</p><p id="6f59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第6行，让我们首先使用<code class="fe nu nv nw nx b">InsertOne()</code>函数插入这个项目。</p><p id="4b20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第10行，我们可以打印出集合中商品的ID。为此，我们可以使用由<code class="fe nu nv nw nx b">InsertOne()</code>函数返回的结果的<code class="fe nu nv nw nx b">InsertedID</code>属性。</p><p id="5c63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第11–22行，创建了另外两个文档。</p><p id="8206" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在第23行和第27行，我们将使用<code class="fe nu nv nw nx b">InsertMany()</code>插入这两个文档，并用<code class="fe nu nv nw nx b">InsertedIDs</code>属性列出这些id。</p><p id="3a14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第29行，我们还将包含<code class="fe nu nv nw nx b">time.Sleep()</code>语句，这样我们就可以使用MongoDB Compass来检查在集合被删除之前，条目是否已经被正确地插入到集合中。如果您决定在程序结束后保留集合，则没有必要保留sleep语句。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="94b4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">查询收款单据</h1><p id="e27c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们可以查询集合，因为我们已经在MongoDB集合中插入了文档。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="68b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第1行，我们将使用<code class="fe nu nv nw nx b">FindOne()</code>在集合中查找一个文档。对于这个例子，这个文档的ID将与我们插入到集合中的第一个文档的ID相匹配。</p><p id="9fff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第2行，我们创建了一个名为<code class="fe nu nv nw nx b">exampleResult</code>的BSON映射，用于保存查询的解码结果。这个解码结果是一个文档。通过使用BSON地图，很容易获得字段的值。</p><p id="a00a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第3行，使用<code class="fe nu nv nw nx b">Decode()</code>将查询结果解码为<code class="fe nu nv nw nx b">exampleResult</code>。</p><p id="6401" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第5–8行，我们打印出ID和文档的三个字段。</p><p id="5f2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在第10行，创建一个过滤器，根据文档的<code class="fe nu nv nw nx b">someInteger</code>字段过滤文档。该字段应大于60。</p><p id="0b9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第11行，我们将找到几个带有这个过滤器的文档。</p><p id="51f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第15行，创建了一片名为<code class="fe nu nv nw nx b">examplesResult</code>的BSON地图来保存结果文档。</p><p id="3027" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第16行，使用函数<code class="fe nu nv nw nx b">All()</code>而不是<code class="fe nu nv nw nx b">Decode()</code>将文档提取到<code class="fe nu nv nw nx b">examplesResult</code>。</p><p id="b9b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随后，在第20-25行，包含在<code class="fe nu nv nw nx b">examplesResult</code>中的文档字段将被打印出来。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="20ba" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更新收款凭证</h1><p id="c3b9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这里，我介绍了三种更新文档的方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="d24d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第1–7行，我们更新了一个ID为<code class="fe nu nv nw nx b">r.InsertedID</code>的文档(这是我们插入到集合中的第一个文档的ID)。在本文件中，<code class="fe nu nv nw nx b">someInteger</code>字段被设置为<code class="fe nu nv nw nx b">201</code>。为了通过ID更新文档，我们使用了名为<code class="fe nu nv nw nx b">UpdateByID()</code>的函数。</p><p id="41de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第11行，我们打印已经更新了多少个文档。更新文档的数量包含在结果中，并使用<code class="fe nu nv nw nx b">ModifiedCount</code>提取。这种情况下应该是<code class="fe nu nv nw nx b">1</code>。</p><p id="3301" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第14–20行，我们更新了一个文档。为了更新一个文档，我们使用名为<code class="fe nu nv nw nx b">UpdateOne()</code>的函数。同样，该文档的ID为<code class="fe nu nv nw nx b">r.InsertedID</code>，但其地址与之前不同。这一次，<code class="fe nu nv nw nx b">someString</code>域被设置为<code class="fe nu nv nw nx b">"The Updated String"</code>。</p><p id="a154" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，除了使用文档ID，您还可以使用不同的方法来查找要更新的文档。它可以是满足特定属性的文档。例如，这可能是<code class="fe nu nv nw nx b">someInteger</code>等于<code class="fe nu nv nw nx b">201</code>的文档。</p><p id="44f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第27–33行，我们可以看到这个想法。在这里，我们更新满足特定属性的所有文档。该属性需要<code class="fe nu nv nw nx b">someInteger</code>在<code class="fe nu nv nw nx b">60</code>之上。满足这一条件的所有文档都被更新，其<code class="fe nu nv nw nx b">someInteger</code>字段被设置为<code class="fe nu nv nw nx b">60</code>。</p><p id="b851" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在上面的例子中看到的，当更新时，您通常只更新文档的一个或几个字段。</p><p id="ee9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，如果您希望更新一个完整的文档，使用<code class="fe nu nv nw nx b">ReplaceOne()</code>函数可能会更好。你可以在这里阅读更多关于函数<a class="ae ky" href="https://pkg.go.dev/go.mongodb.org/mongo-driver@v1.8.0/mongo#Collection.ReplaceOne" rel="noopener ugc nofollow" target="_blank">的内容。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1d73" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">删除收款单据</h1><p id="2f75" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后但同样重要的是，这里有一个删除文档的方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="dd13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第1行，我们将删除使用<code class="fe nu nv nw nx b">DeleteOne()</code>函数插入到集合中的第一个文档。</p><p id="26b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第6行，我们将打印出删除了多少文档。使用<code class="fe nu nv nw nx b">DeletedCount</code>从<code class="fe nu nv nw nx b">DeleteOne()</code>的结果中提取该值。这类似于更新文档时的<code class="fe nu nv nw nx b">ModifiedCount</code>属性。</p><p id="e57b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">MongoDB包还包含一个名为<code class="fe nu nv nw nx b">DeleteMany()</code>的函数，用于一次删除多个文档。你可以在这里阅读更多相关信息<a class="ae ky" href="https://pkg.go.dev/go.mongodb.org/mongo-driver@v1.8.0/mongo#Collection.DeleteMany" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0205" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">完整的代码…</h1><p id="f732" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">下面你可以找到这篇文章的全部代码。上面所有的代码片段都包括在内。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="os ot l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e93c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">进一步阅读</h1><div class="ou ov gp gr ow ox"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-use-golang-structs-with-mongodb-f1772e4a1da3"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd iu gy z fp pc fr fs pd fu fw is bi translated">如何在MongoDB中使用Golang结构</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">在这个简短的例子中，我将向您展示如何在Go语言中创建用于MongoDB的结构</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">better编程. pub</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl ks ox"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="33a1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><p id="561a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://blog.logrocket.com/how-to-use-mongodb-with-go/" rel="noopener ugc nofollow" target="_blank">“如何在Go中使用MongoDB”作者Solomon Esenyi </a></p><p id="934c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://treehouse.github.io/installation-guides/windows/mongo-windows.html" rel="noopener ugc nofollow" target="_blank">tree house的“在Windows上安装MongoDB”</a></p><p id="aec2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://bsonspec.org./" rel="noopener ugc nofollow" target="_blank"> BSON规范</a></p><p id="2377" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://youtu.be/D3jhplPWqnA" rel="noopener ugc nofollow" target="_blank">“只有真正的围棋忍者才会使用MongoDB”，作者唐纳德·弗瑞</a></p></div></div>    
</body>
</html>