<html>
<head>
<title>How To Implement a Rich Text Editor in Your React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React应用中实现富文本编辑器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-implement-a-rich-text-editor-in-your-react-app-5c64d56ddec7?source=collection_archive---------1-----------------------#2021-10-08">https://betterprogramming.pub/how-to-implement-a-rich-text-editor-in-your-react-app-5c64d56ddec7?source=collection_archive---------1-----------------------#2021-10-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2921" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">定制您自己的编辑器的外观</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e2cc43ea92627171e64b672604e389c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AmdLZqIaoYMaW2_3"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由特雷弗·瓦诺伊在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="7a81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们想要完成的:为你的React应用程序提供一个漂亮可靠的文本编辑器。它将使用户能够像在Medium、Google Docs或任何其他支持块(普通文本、H1、H2等)和内联(粗体、下划线、斜体等)格式的编辑器上一样编写文章/故事，并插入链接和图像，甚至是有序和无序的项目列表。我们还将看到如何访问用户插入的文本，以及应用的格式——以HTML的形式。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="6349" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用一个由脸书开发的封装了DraftJS框架的库。简单地说——正如他们的文档中所说——draft js是一个“React的富文本编辑器框架”就是这样。我已经开始通过直接使用框架来实现编辑器。这当然是可行的，但感觉非常耗时。幸运的是，我发现了一个非常方便的包装器库:<a class="ae ky" href="https://github.com/jpuri/react-draft-wysiwyg" rel="noopener ugc nofollow" target="_blank"> react-draft-wysiwyg </a>。</p><p id="95b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Wysiwyg代表<code class="fe mc md me mf b">What you see is what you get</code>，这是对这种编辑器的完美描述:用户将应用某些格式，这正是他们的文章/故事之后的样子，比如说当它发布在网站上时。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="4096" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，您需要添加所需的依赖项:</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="b3da" class="mk ml it mf b gy mm mn l mo mp">$ npm install --save react-draft-wysiwyg draft-js</span></pre><p id="b5e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于这个库包装了前面提到的框架，我们需要将它们作为依赖项添加到我们的项目中。</p><p id="1358" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很容易开始并将编辑器组件添加到您的项目中:</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="757b" class="mk ml it mf b gy mm mn l mo mp">import { Editor } from "react-draft-wysiwyg";<br/>import "react-draft-wysiwyg/dist/react-draft-wysiwyg.css";</span><span id="cef2" class="mk ml it mf b gy mq mn l mo mp">...<br/>&lt;Editor<br/>  editorState={editorState}<br/>  onEditorStateChange={this.onEditorStateChange}<br/>/&gt;;<br/>...</span></pre><p id="6656" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要省略CSS导入；否则，您将没有应用默认样式，并且您将花费15分钟试图理解为什么所有东西看起来都坏了。</p><p id="4c51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码片段中，我们传递了两个强制属性，这样编辑器就可以使用了。<code class="fe mc md me mf b">editorState</code>对象是一个<code class="fe mc md me mf b"><a class="ae ky" href="https://draftjs.org/docs/api-reference-editor-state/" rel="noopener ugc nofollow" target="_blank">EditorState</a></code>，它包含(如文档中所述):</p><ul class=""><li id="ce3d" class="mr ms it lb b lc ld lf lg li mt lm mu lq mv lu mw mx my mz bi translated">当前文本内容状态</li><li id="a591" class="mr ms it lb b lc na lf nb li nc lm nd lq ne lu mw mx my mz bi translated">当前选择状态</li><li id="c3e1" class="mr ms it lb b lc na lf nb li nc lm nd lq ne lu mw mx my mz bi translated">内容的完全修饰表示</li><li id="6c8e" class="mr ms it lb b lc na lf nb li nc lm nd lq ne lu mw mx my mz bi translated">撤消/重做堆栈</li><li id="7563" class="mr ms it lb b lc na lf nb li nc lm nd lq ne lu mw mx my mz bi translated">对内容所做的最新类型的更改</li></ul><p id="1249" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要一个不同的库来将编辑器的内部状态转换成HTML，但是我们很快就会实现。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="5675" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你当然是在开发一个漂亮的、现代的web应用程序。而且说实话，编辑器的默认UI并不是最棒的。不要担心，我们将通过所需的步骤来提升你的编辑器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/fdd47a72030c27d24f94f6db915fb68b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bY3tSPDGOFgWyvowl4jw9Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编辑器的默认外观</p></figure><p id="0e87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的任务是完全定制编辑器工具栏的外观，使用定制图标，区分桌面用户和移动设备用户看到的选项，并设计下拉菜单和弹出窗口的样式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/bec18012eff3945ea867c1650880d268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-zD7H16ID5myYS89KC7x2g.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">编辑器在样式化后的最终效果。</p></figure><p id="896a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面截图中的输入将转化为以下内容:</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="ee36" class="mk ml it mf b gy mm mn l mo mp">&lt;h1&gt;This is a heading&lt;/h1&gt;&lt;p&gt;Hello everyone! Let’s edit some text.&lt;/p&gt;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="2789" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们看看如何定制我们的选项。</p><p id="f87e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要将<code class="fe mc md me mf b">toolbar</code>属性添加到您的编辑器组件中。以下代码会有所帮助:</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="48b0" class="mk ml it mf b gy mm mn l mo mp">&lt;Editor<br/>  toolbar={{<br/>    // we'll add our config here<br/>  }}<br/>  ...<br/>/&gt;;</span></pre><p id="1c23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件<a class="ae ky" href="https://jpuri.github.io/react-draft-wysiwyg/#/docs?" rel="noopener ugc nofollow" target="_blank">写得很好，但是在我看来，还是有一些不足之处。我对它们进行了大量的研究，并通过反复试验和研究GitHub上的源代码，发现了如何配置这个库，但是我想为您节省一些时间，并提供一些具体的提示，告诉您如何实现关于这个编辑器的目标。</a></p><p id="fa67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们看看如何配置编辑器的内联样式(哪些样式可以应用于文本),以及如何在UI上定制这些选项的外观。</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="9e37" class="mk ml it mf b gy mm mn l mo mp">inline: {<br/>   inDropdown: false,<br/>   options: ['bold', 'underline', 'italic'],<br/>   bold: { icon: FormatBoldIcon },<br/>   italic: { icon: FormatItalicIcon }, <br/>   underline: { icon: FormatUnderlineIcon },<br/>},</span></pre><ul class=""><li id="cf16" class="mr ms it lb b lc ld lf lg li mt lm mu lq mv lu mw mx my mz bi translated">除了粗体、斜体、下划线，你还可以使用“删除线”、“等宽线”上标'或'下标'</li><li id="2fba" class="mr ms it lb b lc na lf nb li nc lm nd lq ne lu mw mx my mz bi translated">您可以在下拉列表中显示您的选项，也可以在工具栏中展开它们。</li><li id="1673" class="mr ms it lb b lc na lf nb li nc lm nd lq ne lu mw mx my mz bi translated">对于每个行内编辑选项，您还可以提供自定义的SVG图标。</li><li id="ee01" class="mr ms it lb b lc na lf nb li nc lm nd lq ne lu mw mx my mz bi translated">您的图标将按如下方式导入:</li></ul><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="ba75" class="mk ml it mf b gy mm mn l mo mp">import FormatBoldIcon from './format_bold_icon.svg';</span></pre><p id="b94b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以配置的工具栏对象的其他字段包括:</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="ec47" class="mk ml it mf b gy mm mn l mo mp">blockType: { // text, H1, H2, etc<br/>  ...<br/>},<br/>list: { // ordered or unordered lists<br/>  ...<br/>},<br/>link: { // adding an URL with a custom text<br/>  ...<br/>},<br/>image: { // for inserting an image in the editor<br/>  ...<br/>}</span></pre><p id="e9c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://jpuri.github.io/react-draft-wysiwyg/#/docs?" rel="noopener ugc nofollow" target="_blank">文档</a>中，你会找到这些选项以及解释，所以我不会再赘述。配置它们类似于配置<code class="fe mc md me mf b">inline</code>选项。</p><p id="a87f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，让我们来看一个更棘手的问题(我见过一些人在插入图像的问题上挣扎)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="ccb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe mc md me mf b">previewImage</code>选项设置为真非常重要。否则，您选择图像的弹出窗口将显示URL，而不是图像本身。我认为其他选项很容易理解。但是<code class="fe mc md me mf b">uploadCallback</code>呢？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="7d8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最重要的部分是返回一个承诺，其<code class="fe mc md me mf b">resolve</code>回调将解析返回到在<code class="fe mc md me mf b">link</code>字段中提供的图像的URL。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="13cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于本教程的最后一部分(因为我想保持事物的整洁和粒度)，让我们获得输入状态的等效HTML。</p><p id="99c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要为此添加一个不同的库。有一些选项——我不能说哪一个是最好的，但我已经使用了<a class="ae ky" href="https://www.npmjs.com/package/draft-convert" rel="noopener ugc nofollow" target="_blank"> draft-convert </a>。方法<code class="fe mc md me mf b">convertToHtml</code>将返回编辑器输入的HTML。</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="cbd5" class="mk ml it mf b gy mm mn l mo mp">useEffect(() =&gt; {<br/>  const html = convertToHTML(editorState.getCurrentContent());<br/>  props.setContentHtml(html);<br/>}, [editorState]);</span></pre><p id="7d1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<code class="fe mc md me mf b">editorState</code>被这样实例化:</p><pre class="kj kk kl km gt mg mf mh mi aw mj bi"><span id="812d" class="mk ml it mf b gy mm mn l mo mp">const [editorState, setEditorState] = useState&lt;EditorState&gt;(<br/>  EditorState.createEmpty()<br/>);</span></pre><p id="0797" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以用下面的代码定制<code class="fe mc md me mf b">convertToHtml</code>方法的HTML输出:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="6827" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我需要上面的覆盖，因为该库插入图像的输出是<code class="fe mc md me mf b">&lt;figure&gt; &lt;/figure&gt;</code>，没有其他内容！现在输出是正确的— <code class="fe mc md me mf b">&lt;img src="..."&gt;&lt;/img&gt;</code>。</p><p id="d6fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在另一个教程中，我们还将介绍编辑器的高级样式，例如链接/图像弹出窗口的完全定制、编辑器的形状、工具栏图标之间的间距等。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="de3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是实现富文本编辑器的基本步骤。我真的希望这对你有帮助。不要犹豫开始一段对话，非常感谢你的阅读！</p></div></div>    
</body>
</html>