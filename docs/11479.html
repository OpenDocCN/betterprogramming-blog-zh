<html>
<head>
<title>How I Scrapped the Entire Michelin Guide Using Golang Colly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何用Golang Colly废弃整个米其林指南的</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-i-scrapped-the-entire-michelin-guide-using-golang-colly-6034e01c8043?source=collection_archive---------11-----------------------#2022-03-23">https://betterprogramming.pub/how-i-scrapped-the-entire-michelin-guide-using-golang-colly-6034e01c8043?source=collection_archive---------11-----------------------#2022-03-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8e92" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我刮了米其林指南。以下是方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/43c71c27648267498386241acf28d763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MEMAnokCLWGKi203"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@delightindee?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">在</a><a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="2807" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在汽车时代的初期，<a class="ae ky" href="https://www.michelin.com/" rel="noopener ugc nofollow" target="_blank">米其林</a>，一家轮胎公司，创造了一本旅游指南，包括一本餐馆指南。多年来，米其林星级由于其高标准和非常严格的匿名测试员而变得非常有声望。米其林星级令人难以置信地垂涎。获得一个就能改变厨师的一生；然而，失去一个也能改变它。</p><p id="b50b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">受<a class="ae ky" href="https://www.reddit.com/r/singapore/comments/pqnjd2/singapore_michelin_guide_2021_map/" rel="noopener ugc nofollow" target="_blank">这篇Reddit帖子</a>的启发，我最初的意图是从官方<a class="ae ky" href="https://guide.michelin.com/en/restaurants" rel="noopener ugc nofollow" target="_blank">米其林指南</a>(CSV文件格式)中收集餐厅数据，以便任何人都可以在<a class="ae ky" href="https://mymaps.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌我的地图</a>上绘制世界各地米其林指南餐厅的地图(参见<a class="ae ky" href="https://www.google.com/maps/d/edit?mid=1wSXxkPcNY50R78_T83tUZdZuYRk2L6jY" rel="noopener ugc nofollow" target="_blank">示例</a>)。</p><p id="11a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是我如何使用Go with <a class="ae ky" href="http://go-colly.org/" rel="noopener ugc nofollow" target="_blank"> Colly </a>框架从《米其林指南》中收集所有餐厅细节的思考过程。最终数据集可在此免费下载<a class="ae ky" href="https://github.com/ngshiheng/michelin-my-maps/blob/main/generated/michelin_my_maps.csv" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="3c79" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">概观</h2><ul class=""><li id="ff02" class="mo mp it lb b lc mq lf mr li ms lm mt lq mu lu mv mw mx my bi translated">项目目标和规划</li><li id="0550" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">如何不损害网站</li><li id="a1d8" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">刮刀和<a class="ae ky" href="https://github.com/ngshiheng/michelin-my-maps" rel="noopener ugc nofollow" target="_blank">代码</a>预排</li></ul><p id="98d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始之前，我只想指出，这不是一个关于如何使用Colly的完整教程。Colly是难以置信的优雅，但易于使用，我强烈推荐你通过<a class="ae ky" href="http://go-colly.org/docs/introduction/start/" rel="noopener ugc nofollow" target="_blank">官方文档开始</a>。</p><p id="cbd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然已经解决了，我们开始吧！</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="14c6" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">项目目标</h1><p id="8248" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">这里有两个主要目标—</p><ol class=""><li id="fc32" class="mo mp it lb b lc ld lf lg li nz lm oa lq ob lu oc mw mx my bi translated">直接从官方米其林指南网站收集“高质量”数据</li><li id="9fe4" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu oc mw mx my bi translated">给网站留下尽可能小的足迹</li></ol><p id="90a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，“高质量”是什么意思呢？我希望任何人都能够直接使用数据，而不必执行任何形式的数据管理。因此，收集的数据必须是一致的、准确的和正确解析的。</p><h2 id="2509" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">我们在收集什么</h2><p id="c8f5" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在开始这个web抓取项目之前，我确保没有现有的API提供这些数据；至少在我写这篇文章的时候。</p><p id="8ffd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在浏览了主页面和几个餐馆的详细页面后，我最终满足于以下内容(即我的列标题):</p><ul class=""><li id="fe14" class="mo mp it lb b lc ld lf lg li nz lm oa lq ob lu mv mw mx my bi translated"><code class="fe od oe of og b">Name</code></li><li id="77e5" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">Address</code></li><li id="4bbb" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">Location</code></li><li id="6d17" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">MinPrice</code></li><li id="fd45" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">MaxPrice</code></li><li id="ed5a" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">Currency</code></li><li id="8d11" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">Longitude</code></li><li id="adb7" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">Latitude</code></li><li id="08b5" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">PhoneNumber</code></li><li id="7e1f" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">Url</code>(guide.michelin.com<a class="ae ky" href="https://guide.michelin.com/" rel="noopener ugc nofollow" target="_blank">上餐厅的链接</a>)</li><li id="becc" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">WebsiteUrl</code>(餐厅的网站)</li><li id="91e8" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated"><code class="fe od oe of og b">Award</code> (1至3颗米其林星和Bib Gourmand)</li></ul><p id="27da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个场景中，我省略了餐馆描述(<a class="ae ky" href="https://guide.michelin.com/jp/en/osaka-region/osaka/restaurant/ajikitcho-horieten" rel="noopener ugc nofollow" target="_blank">见“米其林指南观点”</a>)，因为我觉得它们不是特别有用。话虽如此，如果你有兴趣，请随时提交一份简历！我非常乐意和你一起工作。</p><p id="c8a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，在地图上标出餐馆的地址、经度和纬度尤其有用。</p><p id="522e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们餐馆模式的一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/ngshiheng/michelin-my-maps/blob/main/model/model.go" rel="noopener ugc nofollow" target="_blank"> model/model.go </a></p></figure><h2 id="b56d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">我们刮了多少页</h2><p id="6462" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">让我们快速估算一下铲运机。首先，预计在我们的数据集中出现的餐馆总数是多少？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/440947686cafe5975fe1a92ef88968af.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/0*ucDssH9yKE9ljWbQ.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们感兴趣的不同的米其林奖</p></figure><p id="8410" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看网站的数据，总共应该有6502家餐厅(排)。</p><p id="c765" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每页包含20家餐馆，我们的刮刀将访问大约325页；每个类别的最后一页可能不包含20家餐馆。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="f0b7" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">合适的工具，适合合适的工作</h1><p id="0b53" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">今天，有一些工具、框架和库可以用于web抓取或数据提取。见鬼，市场上甚至有大量不需要任何代码的网络抓取SaaS(例如Octoparse)。</p><p id="313b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于灵活性的原因，我更喜欢建造我的铲运机。最重要的是，使用SaaS通常伴随着第二个成本(通常不言而喻)——学习曲线！</p><h2 id="bd43" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">开发者工具(DevTool)</h2><p id="7a67" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">为web抓取选择正确的库或框架的过程的一部分是在页面上执行开发工具。</p><p id="d605" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<a class="ae ky" href="https://developer.chrome.com/docs/devtools/open/" rel="noopener ugc nofollow" target="_blank"> DevTool </a>后，我通常采取的第一步是立即禁用JavaScript并快速刷新页面。这有助于我快速识别网站上的内容是如何呈现的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/891aa23079c4119d2f1d7d0eeeb04cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/0*lxGc62Db8iMIG_om.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">打开Chrome dev tool→Cmd/Ctrl+Shift+P→禁用JavaScript</p></figure><p id="d9c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，网站内容的生成/呈现方式有两个主要区别:</p><ol class=""><li id="7f18" class="mo mp it lb b lc ld lf lg li nz lm oa lq ob lu oc mw mx my bi translated">服务器端渲染</li><li id="7f81" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu oc mw mx my bi translated">JavaScript渲染(即动态加载的内容)</li></ol><p id="ebe2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对我们来说很容易，米其林指南网站内容是使用服务器端渲染加载的。</p><h2 id="745c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">如果使用JavaScript呈现站点会怎样</h2><p id="6414" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">暂时岔开话题——如果使用JavaScript呈现站点内容会怎么样？然后，我们将无法直接抓取所需的数据。相反，我们需要检查“Network”选项卡，看看它是否正在进行任何HTTP API调用来检索内容数据。</p><p id="3511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">否则，我们将需要使用JavaScript渲染(无头)浏览器，如<a class="ae ky" href="https://github.com/scrapinghub/splash" rel="noopener ugc nofollow" target="_blank"> Splash </a>或<a class="ae ky" href="https://www.selenium.dev/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>来抓取内容。</p><h2 id="9100" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">去Colly vs. Scrapy vs .硒</h2><p id="bc4a" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我最初的想法是使用<a class="ae ky" href="https://scrapy.org/" rel="noopener ugc nofollow" target="_blank">Scrapy</a>——一个使用Python的功能丰富且可扩展的web抓取框架。然而，在这种情况下使用Scrapy对我来说似乎有些矫枉过正。目标相当简单，不需要任何复杂的特性，比如使用JavaScript渲染、中间件、数据管道等。</p><p id="9a28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到这一点，我决定使用<a class="ae ky" href="https://github.com/gocolly/colly" rel="noopener ugc nofollow" target="_blank"> Colly </a>，这是一个用于Golang的快速而优雅的web抓取框架，因为它简单并且提供了出色的开发人员体验。</p><p id="b217" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我不喜欢Selenium或<a class="ae ky" href="https://github.com/puppeteer/puppeteer" rel="noopener ugc nofollow" target="_blank">puppet er</a>这样的网络抓取工具，因为它们相对“笨重”且速度快。但是，当您需要抓取不通过HTTP API获取数据的JavaScript渲染的网站时，它们是救命稻草。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="2cc7" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">最小化占地面积</h1><p id="ea22" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">网络抓取的第一条规则是不要损害网站。强烈推荐你<a class="ae ky" href="http://go-colly.org/articles/scraping_tips/" rel="noopener ugc nofollow" target="_blank">阅读Colly提供的这些刮痧小技巧</a>。本质上，这些技巧与工具无关。</p><h2 id="0d4c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">总是缓存您的回答</h2><p id="1cc9" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在开发过程中，重试请求通常是不可避免的。Colly为我们提供了轻松缓存响应的能力。借助缓存，我们可以:</p><ul class=""><li id="192e" class="mo mp it lb b lc ld lf lg li nz lm oa lq ob lu mv mw mx my bi translated">大大减轻网站的负荷</li><li id="c62f" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu mv mw mx my bi translated">拥有更好的开发体验，因为使用缓存重试速度更快</li></ul><pre class="kj kk kl km gt ol og om on aw oo bi"><span id="a610" class="lv lw it og b gy op oq l or os">// app/app.go</span><span id="1f5d" class="lv lw it og b gy ot oq l or os">// ...</span><span id="4ba8" class="lv lw it og b gy ot oq l or os">cacheDir := filepath.Join(cachePath)</span><span id="d278" class="lv lw it og b gy ot oq l or os">c := colly.NewCollector(<br/> colly.CacheDir(cacheDir),<br/> colly.AllowedDomains(allowedDomain),<br/>)</span></pre><h2 id="d376" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">在请求之间添加延迟</h2><p id="7445" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">当遍历多个页面时(在我们的例子中大约325页)，在请求之间增加延迟总是一个好主意。这使得网站能够处理我们的请求，而不会超载；我们希望避免对网站造成任何形式的破坏。</p><p id="97e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">增加延迟也有助于减轻反刮擦措施，如知识产权禁止。</p><pre class="kj kk kl km gt ol og om on aw oo bi"><span id="773f" class="lv lw it og b gy op oq l or os">// app/app.go</span><span id="fbfc" class="lv lw it og b gy ot oq l or os">// ...</span><span id="39d3" class="lv lw it og b gy ot oq l or os">c.Limit(&amp;colly.LimitRule{<br/> Delay:       2 * time.Second,<br/> RandomDelay: 2 * time.Second,<br/>})</span></pre></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="707e" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">刮刀</h1><p id="4b87" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在这一节中，我将只介绍scraper代码的重要部分(和考虑事项)。</p><h2 id="6348" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">选择器</h2><p id="b8d1" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我更喜欢使用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/XPath" rel="noopener ugc nofollow" target="_blank"> XPath </a>来查询HTML页面的元素以提取数据。如果你对网页抓取感兴趣，我强烈推荐你<a class="ae ky" href="https://www.scrapingbee.com/blog/practical-xpath-for-web-scraping/" rel="noopener ugc nofollow" target="_blank">学习XPath</a>；这会让你的生活轻松很多。这里是我最喜欢的使用XPath 的<a class="ae ky" href="https://devhints.io/xpath" rel="noopener ugc nofollow" target="_blank">备忘单。</a></p><p id="08f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了避免主应用程序代码中冗长难看的XPath的混乱，我通常喜欢将它们放在一个单独的文件中。你当然可以使用CSS选择器来代替。</p><h2 id="84e6" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">入口点</h2><p id="a13a" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">要开始构建我们的scraper应用程序，我们首先要确定我们的入口点，即起始URL。在我们的例子中，我选择了all-restaurants主页”(根据奖励/荣誉类型过滤)作为起始URL。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/ngshiheng/michelin-my-maps/blob/main/app/const.go" rel="noopener ugc nofollow" target="_blank"> app/const.go </a></p></figure><p id="ddaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么不干脆从guide.michelin.com/en/restaurants开始呢？</p><p id="1788" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过有意声明我的基于米其林奖类型的起始URL，我就不需要从HTML中提取餐馆的米其林奖。相反，我可以直接根据我的起始网址填写奖励栏；少了一个需要维护的XPath(<a class="ae ky" href="https://i.kym-cdn.com/entries/icons/mobile/000/034/772/Untitled-1.jpg" rel="noopener ugc nofollow" target="_blank">耶</a>)！</p><h2 id="f307" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">收集者</h2><p id="6e8f" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我们的刮刀应用程序由两个收集器组成—</p><ol class=""><li id="533d" class="mo mp it lb b lc ld lf lg li nz lm oa lq ob lu oc mw mx my bi translated">一个(<code class="fe od oe of og b">collector</code>)从主(起始)页面解析位置、经度和纬度等信息</li><li id="af5d" class="mo mp it lb b lc mz lf na li nb lm nc lq nd lu oc mw mx my bi translated">另一个(<code class="fe od oe of og b">detailCollector</code>)收集详细信息，如地址、价格、电话号码等。从每个餐馆。还将行中的数据写入我们的输出CSV文件。</li></ol><h2 id="9a5a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">如何在Colly收集器之间传递上下文</h2><p id="8b1a" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">因为我们只在<code class="fe od oe of og b">detailCollector</code>级别写入CSV文件，所以我们需要将提取的数据从<code class="fe od oe of og b">collector</code>传递到<code class="fe od oe of og b">detailCollector</code>。我是这样做的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">如何在不同的Colly收集器之间传递上下文的代码示例</p></figure><p id="f3fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，位置、经度和纬度信息就可以通过上下文(<a class="ae ky" href="https://github.com/gocolly/colly/issues/287" rel="noopener ugc nofollow" target="_blank">引用</a>)传递给我们的<code class="fe od oe of og b">detailCollector</code>。</p><h2 id="60b2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">分析器</h2><p id="fe75" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我已经编写了几个<a class="ae ky" href="https://github.com/ngshiheng/michelin-my-maps/blob/main/util/parser/parser.go" rel="noopener ugc nofollow" target="_blank">实用解析器</a>来从提取的原始字符串中提取特定的信息。由于它们相当简单，我就不一一赘述了。</p><p id="558a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们的整个scraper应用程序如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oh oi l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/ngshiheng/michelin-my-maps/blob/main/app/app.go" rel="noopener ugc nofollow" target="_blank"> app/app.go </a></p></figure><p id="6a4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请随意查看完整的源代码<a class="ae ky" href="https://github.com/ngshiheng/michelin-my-maps" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="0ea1" class="nl lw it bd lx nm nn no ma np nq nr md jz ns ka mg kc nt kd mj kf nu kg mm nv bi translated">结束语</h1><p id="3612" class="pw-post-body-paragraph kz la it lb b lc mq ju le lf mr jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">最初，我想通过API在Google My Maps上标出每一家米其林获奖餐厅。不幸的是，<a class="ae ky" href="https://support.google.com/maps/thread/22025555?hl=en&amp;msgid=22027032" rel="noopener ugc nofollow" target="_blank">我的地图不仅没有任何API </a>，而且<a class="ae ky" href="https://support.google.com/maps/thread/11556127?hl=en&amp;msgid=11556505" rel="noopener ugc nofollow" target="_blank">最多只允许2000个数据点</a>。要构建一个没有API的地图，你必须<a class="ae ky" href="https://support.google.com/mymaps/answer/3024836" rel="noopener ugc nofollow" target="_blank">手动导入我的地图上的CSV </a>。</p><p id="bf63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个美食家，这个项目非常有趣。对我来说，更大的收获是看到人们充分利用Kaggle 上的数据集。</p><p id="d535" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你碰巧画出了餐馆的地图，或者用数据集进行了任何形式的数据分析工作，请随时与我分享！在我们结束之前，如果您有任何问题，请随时联系我们。</p><p id="d06a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天到此为止，感谢您的阅读！</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt ol og om on aw oo bi"><span id="f107" class="lv lw it og b gy op oq l or os"><strong class="og iu">Want to Connect?</strong></span><span id="6ca9" class="lv lw it og b gy ot oq l or os">This article was originally published at <a class="ae ky" href="https://jerrynsh.com/how-i-scraped-michelin-guide-using-golang/" rel="noopener ugc nofollow" target="_blank">jerrynsh.com</a></span></pre></div></div>    
</body>
</html>