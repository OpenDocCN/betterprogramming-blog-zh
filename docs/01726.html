<html>
<head>
<title>iOS 13 Context Menus and SF Symbols</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 13上下文菜单和SF符号</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/ios-context-menu-collection-view-a03b032fe330?source=collection_archive---------9-----------------------#2019-10-08">https://betterprogramming.pub/ios-context-menu-collection-view-a03b032fe330?source=collection_archive---------9-----------------------#2019-10-08</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="087e" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">3D Touch的替代品将会长期存在</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/371adc0111b8ae827c20db736035381a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RJuTP54_uHtRZ7JHkuIyCA.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">本教程结束时我们的最终结果</p></figure><p id="b115" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">上下文菜单是今年iOS 13 WWDC 2019的重要发展之一。作为3D touch的替代产品，它将一直存在！</p><p id="6d64" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">本文的目标是实现上下文菜单和SF符号。所以让我们开始吧。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="04d5" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">行动（或活动、袭击）计划</h1><ul class=""><li id="466c" class="mu mv iu lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">我们将讨论使用集合视图实现上下文菜单。</li><li id="4fcd" class="mu mv iu lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">我们将使用SF符号，它提供了大量的系统映像名称。</li></ul></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="e261" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">上下文菜单与查看和弹出</h1><p id="a9a4" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li nk lk ll lm nl lo lp lq nm ls lt lu in bi translated">iOS 13引入的上下文菜单与3D Touch Peek和Pop手势不一样。</p><p id="1153" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">以下是主要区别:</p><ul class=""><li id="9b04" class="mu mv iu lb b lc ld lf lg li nn lm no lq np lu nb nc nd ne bi translated">Peek和Pop适用于支持3D Touch的设备，而上下文菜单适用于所有设备。</li><li id="6a5c" class="mu mv iu lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">上下文菜单在长按或强制触摸时显示(如果设备支持)，而查看和弹出菜单仅在强制触摸时显示。</li><li id="5df5" class="mu mv iu lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">Peek和Pop菜单需要你向上滑动才能看到菜单，而上下文菜单就在你长按的地方。</li></ul><p id="3abe" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">要在视图上设置ContextMenu，我们需要在它上面设置<code class="fe nq nr ns nt b">UIContextMenuIteraction </code>。同样，我们需要符合<code class="fe nq nr ns nt b">UIContextMenuInteractionDelegate</code></p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="17b5" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">视图上上下文菜单的基本设置</h1><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nu nv l"/></div></figure><p id="2814" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">让我们看一下<code class="fe nq nr ns nt b">UIContextMenuInteractionDelegate</code>协议中重要的委托方法:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nu nv l"/></div></figure></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="8629" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">上下文菜单的初始化</h1><p id="b03c" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li nk lk ll lm nl lo lp lq nm ls lt lu in bi translated">要初始化上下文菜单，我们需要设置三个参数(都是可选的):</p><ul class=""><li id="928f" class="mu mv iu lb b lc ld lf lg li nn lm no lq np lu nb nc nd ne bi translated"><code class="fe nq nr ns nt b">identifier</code> -您可以在此设置字符串id。</li><li id="daca" class="mu mv iu lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe nq nr ns nt b">previewProvider</code> -下一个视图控制器的预览</li><li id="536d" class="mu mv iu lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated"><code class="fe nq nr ns nt b">actionProvider</code> -我们在这里创建菜单按钮和动作。</li></ul><p id="8d03" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">SFSymbols 是一个新推出的Mac应用程序，本质上是一个系统图标名称的百科全书。我们可以在iOS 13引入的<code class="fe nq nr ns nt b">UIImage(systemName:)</code>初始化器中传递这些名字。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="b3e4" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">定制系统图标</h1><p id="a282" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li nk lk ll lm nl lo lp lq nm ls lt lu in bi translated">我们可以通过传递如下所示的配置参数来自定义系统图标的大小/样式:</p><pre class="kk kl km kn gu nx nt ny nz aw oa bi"><span id="9199" class="ob md iu nt b gz oc od l oe of">let config = UIImage.SymbolConfiguration(textStyle: .largeTitle)</span><span id="7b2d" class="ob md iu nt b gz og od l oe of">UIImage(systemName: "paperplane", withConfiguration : config)</span></pre></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="f347" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">运行中的上下文菜单和集合视图</h1><p id="abef" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li nk lk ll lm nl lo lp lq nm ls lt lu in bi translated">在接下来的部分中，我们将在<code class="fe nq nr ns nt b">UICollectionView</code>上实现<code class="fe nq nr ns nt b">ContextMenu</code>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oh"><img src="../Images/06958a050fb8087639353b0e5afcfc30.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*T8-zdxJibbmBBQaKtdOaug.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">来自苹果文档</p></figure><p id="f605" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">iOS 13为上下文菜单引入了一些新的<code class="fe nq nr ns nt b">UICollectionViewDelegate</code>方法。为了在用户长按<code class="fe nq nr ns nt b">CollectionView</code>单元格时显示<code class="fe nq nr ns nt b">ContextMenu</code>，使用了以下函数:</p><pre class="kk kl km kn gu nx nt ny nz aw oa bi"><span id="9308" class="ob md iu nt b gz oc od l oe of">func collectionView(_ collectionView: UICollectionView, contextMenuConfigurationForItemAt indexPath: IndexPath, point: CGPoint) -&gt; UIContextMenuConfiguration? {<br/>        <br/>        let configuration = UIContextMenuConfiguration(identifier: nil, previewProvider: nil){ action in<br/>            let viewMenu = UIAction(title: "View", image: UIImage(systemName: "eye.fill"), identifier: UIAction.Identifier(rawValue: "view")) {_ in<br/>                print("button clicked..")<br/>            }</span><span id="48c3" class="ob md iu nt b gz og od l oe of">            let rotate = UIAction(title: "Rotate", image: UIImage(systemName: "arrow.counterclockwise"), identifier: nil, state: .on, handler: {action in<br/>                print("rotate clicked.")<br/>            })</span><span id="8df3" class="ob md iu nt b gz og od l oe of">            let delete = UIAction(title: "Delete", image: UIImage(systemName: "trash.fill"), identifier: nil, discoverabilityTitle: nil, attributes: .destructive, state: .on, handler: {action in<br/>                <br/>                print("delete clicked.")<br/>            })<br/>            let editMenu = UIMenu(title: "Edit...", children: [rotate, delete])<br/>            <br/>            <br/>            return UIMenu(title: "Options", image: nil, identifier: nil, children: [viewMenu, editMenu])<br/>        }<br/>        <br/>        return configuration<br/>}</span></pre><p id="2845" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们已经创建了一个<code class="fe nq nr ns nt b">UIMenu</code>，它也包含一个子菜单。下面简单介绍一下<code class="fe nq nr ns nt b">ContextMenu</code>和<code class="fe nq nr ns nt b">CollectionView</code>的工作情况:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oi"><img src="../Images/064d862ba7eff933294ca17302e3ce2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/0*3mbolPXMctVwgfvF.gif"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">最终结局Gif。尝试旋转设备以获得不同的外观。</p></figure></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><h1 id="2c94" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">上下文菜单和预览提供者</h1><p id="2dd5" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li nk lk ll lm nl lo lp lq nm ls lt lu in bi translated">在这一节中，我们将在预览中显示目标视图控制器以及按下单元格时的<code class="fe nq nr ns nt b">ContextMenu</code>。</p><p id="7d1f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">为了显示菜单，我们需要在<code class="fe nq nr ns nt b">PreviewProvider</code>中设置目标视图控制器，如下所示:</p><pre class="kk kl km kn gu nx nt ny nz aw oa bi"><span id="5ce8" class="ob md iu nt b gz oc od l oe of">func collectionView(_ collectionView: UICollectionView, contextMenuConfigurationForItemAt indexPath: IndexPath, point: CGPoint) -&gt; UIContextMenuConfiguration? {</span><span id="ebe6" class="ob md iu nt b gz og od l oe of">let configuration = UIContextMenuConfiguration(identifier: "\(indexPath.row)" as NSCopying, previewProvider: {<br/>            return SecondViewController(index: indexPath.row)<br/>        }){ action in</span><span id="88d9" class="ob md iu nt b gz og od l oe of">//add your uimenu as earlier<br/>}<br/>}</span></pre><p id="51a7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">为了在预览点击上打开视图控制器，我们需要实现下面这个在<code class="fe nq nr ns nt b">UICollectionViewDelegate</code>协议中新加入的方法。</p><pre class="kk kl km kn gu nx nt ny nz aw oa bi"><span id="f61f" class="ob md iu nt b gz oc od l oe of">func collectionView(_ collectionView: UICollectionView, willPerformPreviewActionForMenuWith configuration: UIContextMenuConfiguration, animator: UIContextMenuInteractionCommitAnimating) {<br/>        <br/>        let id = configuration.identifier as! String<br/>        <br/>        animator.addCompletion {<br/>            self.show(SecondViewController(index: Int(id)), sender: self)<br/>        }<br/>}</span></pre><p id="57fb" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">使用<code class="fe nq nr ns nt b">configuration.identifier</code>检索之前设置的<code class="fe nq nr ns nt b">identifier</code>。</p><p id="0eba" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在我们的<code class="fe nq nr ns nt b">SecondViewController</code>中，我们为<code class="fe nq nr ns nt b">UIImageView</code>中显示的每个图像设置了不同的<code class="fe nq nr ns nt b">CIFilter</code>。</p><p id="e6f3" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">下面给出了实际应用程序的输出:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oj"><img src="../Images/8bbdc4c300a3eac179b5f6aee3679131.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/0*3MOMAZqJZPw3kERH.gif"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">上下文菜单和集合视图。</p></figure><p id="4e96" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">你注意到了吗？显示的视图控制器可以向下滑动以关闭。这是iOS 13开始默认的视图控制器样式。</p></div><div class="ab cl lv lw hy lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="in io ip iq ir"><p id="f9d2" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">总结了iOS 13的这个特点。上下文菜单和系统图标一起看起来最好。完整的源代码可以在<a class="ae nw" href="https://github.com/anupamchugh/iowncode/tree/master/iOS13ContextMenu" rel="noopener ugc nofollow" target="_blank">这个GitHub库</a>中找到。</p><p id="1ed4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">更多iOS 13功能，参考我的文章“<a class="ae nw" href="https://medium.com/better-programming/ios-13-checklist-for-developers-ef47e413aad2" rel="noopener"> iOS 13开发者清单</a>”</p></div></div>    
</body>
</html>