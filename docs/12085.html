<html>
<head>
<title>GPU CI Tests Using Kaggle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Kaggle的GPU CI测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/gpu-ci-tests-using-kaggle-90e4f88a43b3?source=collection_archive---------12-----------------------#2022-05-10">https://betterprogramming.pub/gpu-ci-tests-using-kaggle-90e4f88a43b3?source=collection_archive---------12-----------------------#2022-05-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8f13" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何确保你的代码能在GPU环境下工作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e134dcec15f020709b827e2c776ca60b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*poVqhn3nbvTSeNlajRO8yw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源于<a class="ae ky" href="https://unsplash.com/photos/wX2L8L-fGeA" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的<a class="ae ky" href="https://unsplash.com/@synkevych" rel="noopener ugc nofollow" target="_blank"> Roman Synkevych </a>。</p></figure><blockquote class="kz la lb"><p id="3e60" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf iu"> TLDR: </strong>你可以在你的工作流程中使用<a class="ae ky" href="https://github.com/marketplace/actions/kaggle-gpu-test" rel="noopener ugc nofollow" target="_blank"> action-kaggle-gpu-test </a>。这是一个早期访问发布版本。要关注变化，请观看<a class="ae ky" href="https://github.com/namiyousef/action-kaggle-gpu-test" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上的回购。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="8f2e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">如果您对GPU的唯一访问是通过Kaggle和Colab，那么很可能您永远不会编写使用GPU环境的单元测试。这是因为a)很难将整个代码库迁移到Kaggle/Colab，b)更难实现自动化。</p><p id="a577" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">在本文中，我介绍了一个使用GitHub actions和Kaggle自动进行GPU集成测试的简单解决方案。文章以问题陈述的简要描述开始，接着是建议的解决方案，最后是一些结论性的评论。单元测试和GitHub行为的知识将贯穿始终。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="72e9" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">问题陈述</h1><p id="c63c" class="pw-post-body-paragraph lc ld it lf b lg nd ju li lj ne jx ll mb nf lo lp mc ng ls lt md nh lw lx ly im bi translated">在没有本地GPU设备的情况下，我一般只在训练的最后一步使用Colab/Kaggle。这意味着在开发时，我无法验证训练循环是否能在GPU运行时上工作。即使我经历了通过Colab/Kaggle调试的麻烦，我对离线代码库所做的任何进一步的更改都需要再次测试。在团队中工作会增加所有这些问题。在这个阶段，在GPU运行时上进行自动化测试变得非常方便。</p><p id="982f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">理想情况下，应该有一个CI/CD服务，允许你连接到一个免费的GPU运行时。然而，在撰写本文时，还没有这样的服务。最接近的一个是<a class="ae ky" href="https://gradient.run" rel="noopener ugc nofollow" target="_blank"> Gradient </a>，据称它允许您连接到一个<a class="ae ky" href="https://gradient.run/free-gpu" rel="noopener ugc nofollow" target="_blank">免费的M4000社区GPU </a>，但是文档并不清楚免费GPU是否也可用于他们的<a class="ae ky" href="https://docs.paperspace.com/gradient/workflows/" rel="noopener ugc nofollow" target="_blank">工作流</a>服务。当我尝试这种方法时，需要一张信用卡，所以我决定用其他方法。</p><p id="0d38" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">这给我留下了一个直接与Colab/Kaggle接口的解决方案。两者都有独特的挑战:</p><ul class=""><li id="7b69" class="ni nj it lf b lg lh lj lk mb nk mc nl md nm ly nn no np nq bi translated"><strong class="lf iu"> Colab: </strong>您可以通过ssh进入Colab并使用可用的GPU，但是这不能自动完成，因为您不能以编程方式启动Colab运行时。您必须通过浏览器手动完成此操作。</li><li id="075a" class="ni nj it lf b lg nr lj ns mb nt mc nu md nv ly nn no np nq bi translated"><strong class="lf iu"> Kaggle: </strong>你也可以ssh到Kaggle VM，但是你将看不到GPU。这是因为在使用GPU之前，Kaggle上的运行按钮会初始化某些命令。我不知道如何通过编程来做到这一点。</li></ul><p id="4162" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">我选定的最终解决方案是启动一个支持GPU的Kaggle脚本来运行集成测试。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="83cd" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">拟议解决方案</h1><p id="aa7a" class="pw-post-body-paragraph lc ld it lf b lg nd ju li lj ne jx ll mb nf lo lp mc ng ls lt md nh lw lx ly im bi translated">解决方案是在GitHub Actions运行时中执行以下操作:</p><ul class=""><li id="b816" class="ni nj it lf b lg lh lj lk mb nk mc nl md nm ly nn no np nq bi translated"><strong class="lf iu">认证Kaggle CLI: </strong>使用Kaggle API令牌来设置Kaggle CLI。这将允许您直接与Kaggle接口，使用GPU运行时运行脚本/笔记本</li><li id="6b7f" class="ni nj it lf b lg nr lj ns mb nt mc nu md nv ly nn no np nq bi translated"><strong class="lf iu">创建并发送测试:</strong>创建将在Kaggle GPU运行时上运行的Python脚本。这个Python脚本将克隆您想要测试的存储库，设置虚拟环境并运行<code class="fe nw nx ny nz b">pytest</code>。然后，Kaggle CLI用于发送一个脚本，其中包含您正在测试的存储库的名称和标题。这是使用<code class="fe nw nx ny nz b">kaggle kernels push $REPO_NAME</code>完成的</li><li id="1a35" class="ni nj it lf b lg nr lj ns mb nt mc nu md nv ly nn no np nq bi translated"><strong class="lf iu">检查卡格尔状态:</strong>使用<code class="fe nw nx ny nz b">kaggle kernels status $REPO_NAME</code>检查测试状态。如果状态有错误，这意味着测试失败，日志被返回(使用<code class="fe nw nx ny nz b">kaggle kernels output $REPO_NAME</code>)。如果测试已经通过，则返回成功消息。否则，将定期检查状态。</li></ul><p id="b3b7" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">下图显示了该解决方案的端到端工作方式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/6b25c227902bb8e1942c4498c2fc9bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OToIYU9bc6kSY4X1_Dq_Ug.png"/></div></div></figure><p id="4b68" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">所有这些都是作为一个独立的项目存在的单独的<code class="fe nw nx ny nz b">action.yml</code>。我把它叫做<code class="fe nw nx ny nz b">action-kaggle-gpu-test</code>。然后，您可以在任何 repository GitHub工作流文件中使用它，以便使用GPU运行时进行测试。这是按如下方式完成的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="57a2" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">动作文件本身如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="87dd" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">结束语</h1><ul class=""><li id="f5b7" class="ni nj it lf b lg nd lj ne mb ob mc oc md od ly nn no np nq bi translated">GPU测试是必要的，以确保您的模型将正确利用资源。</li><li id="9c99" class="ni nj it lf b lg nr lj ns mb nt mc nu md nv ly nn no np nq bi translated">鉴于缺乏CI/CD GPU集群，很难免费实现自动化</li><li id="f9d8" class="ni nj it lf b lg nr lj ns mb nt mc nu md nv ly nn no np nq bi translated">可以使用Kaggle API实现GPU测试，从而使用GPU运行时以编程方式创建笔记本/脚本</li><li id="ae2b" class="ni nj it lf b lg nr lj ns mb nt mc nu md nv ly nn no np nq bi translated">这种方法不是特别高效或优雅，但它达到了目的。</li></ul><p id="7330" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">可以在GitHub marketplace中找到该操作:</p><div class="oe of gp gr og oh"><a href="https://github.com/marketplace/actions/kaggle-gpu-test" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">Kaggle GPU测试- GitHub市场</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">GitHub动作GitHub动作文件，用于针对Kaggle GPU测试贡献者Kaggle GPU测试执行集成测试…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div><p id="b9e0" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">要查看使用此动作进行GPU测试的项目，请访问以下资源库:</p><div class="oe of gp gr og oh"><a href="https://github.com/namiyousef/colab-utils/blob/develop/.github/workflows/python-package.yml" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">开发namiyousef/colab-utils上的colab-utils/python-package.yml</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov ks oh"/></div></div></a></div><p id="a992" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated">如果您对此操作的更新感兴趣，请查看资源库:</p><div class="oe of gp gr og oh"><a href="https://github.com/namiyousef/action-kaggle-gpu-test" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">GitHub-namiyousef/action-ka ggle-GPU-test:用于执行集成测试的GitHub操作文件…</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="ox l os ot ou oq ov ks oh"/></div></div></a></div></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="9711" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mb ln lo lp mc lr ls lt md lv lw lx ly im bi translated"><em class="le">所有图片均由作者提供，除非另有说明。</em></p></div></div>    
</body>
</html>