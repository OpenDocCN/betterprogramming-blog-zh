<html>
<head>
<title>Testing React Components Explained for Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为初学者解释的测试React组件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/testing-react-components-explained-for-beginners-4c61029e752e?source=collection_archive---------12-----------------------#2022-05-05">https://betterprogramming.pub/testing-react-components-explained-for-beginners-4c61029e752e?source=collection_archive---------12-----------------------#2022-05-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="39fb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如果你不知道代码是如何工作的，测试代码可能会令人生畏。我们将从基础开始</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/79260c1ceddf2c4474653551973f42d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PuRB6-8m7_NPtzyCmwPyIQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://www.pexels.com/photo/colorful-toothed-wheels-171198/" rel="noopener ugc nofollow" target="_blank">像素</a>上的<a class="ae ky" href="https://www.pexels.com/@digitalbuggu/" rel="noopener ugc nofollow" target="_blank">数码Buggu </a>拍摄。</p></figure><h2 id="db3f" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h2><p id="5766" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">见见詹姆斯。James是一个大型开发团队的成员。他专门创建令人敬畏的React组件，并与许多同事一起构建了一个大型前端。</p><p id="57d5" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">现在，他正在制作一个全新的按钮。</p><p id="64c8" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这个按钮有一个重要的功能需求:在用户点击它之后，它需要被禁用。创建它没有问题，James将他的代码放入存储库，这样当其他开发人员引入最新的更改时，它就可供他们使用了。</p><p id="4bf3" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">但是等等。那是相当可怕的，不是吗？如果团队中的另一个开发人员更改了代码怎么办？如果用户点击后按钮不再被禁用会怎样？</p><p id="545d" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这就是测试发挥作用的地方。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/a254db10ecf309d2946aedd4d9739f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*V40Eixu-EhYa2CuMJHtQzA.png"/></div></figure><p id="6429" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">James可以为他的新按钮组件添加一个测试，该测试断言按钮在被点击后被禁用(我们将在下面进一步描述测试实际上是如何做到这一点的)。每当有人修改了按钮组件的代码，并且(不管是不是有意的)以某种方式修改了它，使得用户点击后按钮不再被禁用，测试就会失败。</p><p id="fa7f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">红色大警报。系统和管道会停止，断裂，尖叫和哭泣。电子邮件会自动发送，声明用户点击后该按钮不再被禁用！</p><p id="dd82" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这当然是一个有点幼稚的例子。但希望它解释了测试的概念。事实上，这正是大型项目确保不出任何问题的方法</p><p id="7d8f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">自己看吧:测试的例子可以在<a class="ae ky" href="https://github.com/facebook/react/tree/main/packages/react/src/__tests__" rel="noopener ugc nofollow" target="_blank"> React </a>、<a class="ae ky" href="https://github.com/lodash/lodash/tree/master/test" rel="noopener ugc nofollow" target="_blank"> lodash </a>、<a class="ae ky" href="https://github.com/date-fns/date-fns/tree/master/test" rel="noopener ugc nofollow" target="_blank"> date-fns </a>以及几乎所有其他尊重自己的项目中找到。这是多少开发人员可以在一个项目中一起工作，并确保他们不会破坏彼此的代码和功能。</p><p id="9c79" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">让我们更深入地研究一下测试！</p><p id="3ce8" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们会一路上解释所有的细节。上面的抽象例子用一个简单的问题解释了，但是还有几个问题需要回答。</p><h2 id="6348" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">非常基础的测试</h2><p id="a50d" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在我们看如何运行测试之前，让我们看一个非常简单的代码示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="6440" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">按钮组件是一个非常简单的React组件。它在呈现时向DOM添加一个HTML按钮元素。</p><p id="4803" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">但是让我们来看看测试本身。首先，我们从<a class="ae ky" href="https://github.com/testing-library/react-testing-library" rel="noopener ugc nofollow" target="_blank"> React测试库</a>和按钮组件(第7-8行)导入一个<code class="fe mw mx my mz b">render</code>函数。</p><p id="b86f" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">然后我们调用一个名为<code class="fe mw mx my mz b">it</code>的函数(这是一个名为“test”的函数的别名，它是Jest 中的一个全局函数<a class="ae ky" href="https://jestjs.io/docs/api#testname-fn-timeout" rel="noopener ugc nofollow" target="_blank">)。我们描述我们正在测试的东西(这个小测试的<code class="fe mw mx my mz b">name</code>，并且我们传入一个包含测试逻辑的箭头函数。</a></p><p id="68c9" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">逻辑可以在第11–13行找到。在第11行，我们呈现了我们的<code class="fe mw mx my mz b">Button</code>组件。请注意，render函数返回了一个容器。容器是一个HTML元素，包含render函数返回的元素。它是我们执行测试的文档的根(参见下面关于这个容器的注释)。</p><p id="9ee8" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">按钮在容器中呈现后(第11行)，我们在容器中查询按钮元素(第12行)。最后，在第13行，我们做出第一个断言:</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="02e6" class="kz la it mz b gy ne nf l ng nh">expect(button).not.toBeNull();</span></pre><p id="e8f1" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">阅读这一行本身就说明了Jest的可读语法。在我们的测试中，我们期望变量<code class="fe mw mx my mz b">button</code>的值不为空。并且当测试运行时(更多关于如何很快运行测试)，它成功了，每个人都很高兴！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/dfcbf7d9cd466a5d311d11413aca849b.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*VV-6QrWK9IwM8FzD7PrVJg.png"/></div></figure><blockquote class="nj nk nl"><p id="c84a" class="lv lw nm lx b ly mo ju ma mb mp jx md nn mq mf mg no mr mi mj np ms ml mm mn im bi translated"><strong class="lx iu">注意</strong>:正常情况下，你不必使用渲染函数的容器引用。我们将很快看到几个使用起来更方便的助手函数。当您使用与本机节点相关的函数(如querySelector)时，CRA (Create React App)中的默认ESLint配置甚至会抱怨。但是我们想说明一个非常简单的例子，大多数开发人员一看就明白。</p></blockquote><p id="86cd" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">但是现在，如果一个初级开发人员将我们的按钮组件的代码更改为以下代码会怎么样呢？假设他们用按钮组件中的div元素替换了HTML按钮元素(第2行):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="6238" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">当测试再次运行时，现在它将失败。因为它没有找到HTML按钮元素，所以<code class="fe mw mx my mz b">button</code>变量的值将为空:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/cc6e715b60d16a7d0778f6c3b7af398c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*E9oF5RvjwvpmNSes1grukw.png"/></div></figure><p id="27a0" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">有希望的是，初级开发人员现在开始与失败测试的作者对话，他们将一起找到该做什么。他们要么必须更改测试，要么同意不会将button元素更改为div元素。</p><p id="222e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">如果这个测试不存在，没有人会注意到<code class="fe mw mx my mz b">button</code>元素被改成了div。这又是一个过于简单的例子。但是希望你慢慢开始理解对我们的组件和代码的好的测试如何能让我们的生活变得更好，尤其是当我们与其他人合作的时候。</p><blockquote class="nj nk nl"><p id="a4d4" class="lv lw nm lx b ly mo ju ma mb mp jx md nn mq mf mg no mr mi mj np ms ml mm mn im bi translated"><strong class="lx iu">注意</strong>:测试不仅在你与其他人一起工作时有用。即使你有自己的私人项目，编写好的测试(至少对你代码的关键部分)也可以防止你在将来遇到一些头疼的事情，当你忘记了你为什么要以那种方式编写某些逻辑的时候。我们可以说，测试保护着你的代码。没有它们，你很容易在不知不觉中引入bug！</p></blockquote><h2 id="2ff1" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">笑话世界</h2><p id="ee63" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">在我们研究如何运行测试之前，值得一提的是，当我们编写测试时，我们会经常使用DOM中的元素。testing-library项目包含一个名为<a class="ae ky" href="https://github.com/testing-library/jest-dom" rel="noopener ugc nofollow" target="_blank"> jest-dom </a>的很棒的包，它提供了一组助手函数，用于生成与dom相关的断言。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="9328" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">您可以在jest-dom <a class="ae ky" href="https://github.com/testing-library/jest-dom#table-of-contents" rel="noopener ugc nofollow" target="_blank">自述文件</a>中查看所有匹配器(如它们所称)。</p><p id="823b" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">当你用CRA ( <a class="ae ky" href="https://create-react-app.dev" rel="noopener ugc nofollow" target="_blank"> Create React App </a>)创建一个新的应用程序时，Jest-dom是默认包含的。</p><h2 id="7f0b" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">使用CRA运行测试(创建React应用程序)</h2><p id="cbd5" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">使用CRA创建新应用程序:</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="55a9" class="kz la it mz b gy ne nf l ng nh">$ npx create-react-app MyTestApplication</span></pre><p id="dfd9" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">安装完成后，进入目录并运行该项目的测试:</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="afed" class="kz la it mz b gy ne nf l ng nh">$ cd MyTestApplication<br/>$ yarn run test --watchAll</span></pre><blockquote class="nj nk nl"><p id="50b7" class="lv lw nm lx b ly mo ju ma mb mp jx md nn mq mf mg no mr mi mj np ms ml mm mn im bi translated"><strong class="lx iu">注意</strong>:我们如何使用<code class="fe mw mx my mz b">watchAll</code>标志来确保所有的测试都被执行。如果我们不提供这个标志，那么只有您更改的测试才会运行。</p></blockquote><p id="5e3c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">有一次试验(<code class="fe mw mx my mz b">src/App.test.js</code>)，成功了！让我们看看该文件的内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="dc4e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在我们讨论了所有这些之后，这个测试现在应该有意义了。除了一件事。</p><p id="2699" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我们不再使用容器引用。相反，我们可以利用在第1行导入的屏幕引用。这个屏幕实例有几个助手函数(比如<code class="fe mw mx my mz b">getByText</code>)，我们可以用它们在我们的虚拟“屏幕”(比如DOM)上寻找元素。在这种情况下，我们查询任何包含文本“learn react”的HTML元素。</p><p id="aa16" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">最后，我们希望该元素在文档(DOM)中。</p><p id="0c2c" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">这就是我们在任何CRA项目中手工运行测试的方式。这是第一次接触Jest的好方法，因为您不必安装和配置Jest。</p><p id="caa2" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">如果你有兴趣，你可以在这里阅读更多关于安装和配置Jest <a class="ae ky" href="https://jestjs.io/docs/getting-started" rel="noopener ugc nofollow" target="_blank">的信息。没那么复杂。</a></p><p id="4c72" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">最后一件事值得一提。Jest为CRA项目配置的方式是，它将执行以下测试:</p><ul class=""><li id="93b4" class="nr ns it lx b ly mo mb mp li nt lm nu lq nv mn nw nx ny nz bi translated"><code class="fe mw mx my mz b">__tests__</code>目录中带有<code class="fe mw mx my mz b">.js</code>后缀的文件</li><li id="89a2" class="nr ns it lx b ly oa mb ob li oc lm od lq oe mn nw nx ny nz bi translated">带有<code class="fe mw mx my mz b">.test.js</code>或<code class="fe mw mx my mz b">.spec.js</code>后缀的文件</li></ul><p id="ae84" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">你可以在这里阅读更多关于设置<a class="ae ky" href="https://create-react-app.dev/docs/running-tests" rel="noopener ugc nofollow" target="_blank">的信息。当然，也可以定制。</a></p><h1 id="6eaa" class="of la it bd lb og oh oi le oj ok ol lh jz om ka ll kc on kd lp kf oo kg lt op bi translated">最后的话</h1><p id="56d9" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">可以说，向您的存储库中添加测试可以保护您的代码。它可以断言并检查您的代码正在做您期望它做的事情。如果没有，测试就会失败。</p><p id="061e" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在本文中，我们手动执行测试。但是如果您有一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Continuous_integration" rel="noopener ugc nofollow" target="_blank">持续集成</a>设置，它们可以(并且应该)被添加到您的管道中，以防止任何测试失败时代码被部署。</p><p id="c684" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">我记得许多个月前，当我第一次了解到测试时，我对它非常怀疑。但是慢慢地，我明白了它有多强大。让他们“看着你的代码”是多么好啊</p><p id="b141" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">在这篇文章中，我们只是触及了表面，所以我可能很快会深入到一些更高级的主题。</p><p id="0ebf" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">感谢您的宝贵时间！</p><p id="0464" class="pw-post-body-paragraph lv lw it lx b ly mo ju ma mb mp jx md li mq mf mg lm mr mi mj lq ms ml mm mn im bi translated">杰勒德</p></div></div>    
</body>
</html>