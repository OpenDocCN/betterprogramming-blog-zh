<html>
<head>
<title>How To Create A Simple Web Login Using Gin For Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Gin For Golang创建一个简单的Web登录</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-simple-web-login-using-gin-for-golang-9ac46a5b0f89?source=collection_archive---------0-----------------------#2022-05-06">https://betterprogramming.pub/how-to-create-a-simple-web-login-using-gin-for-golang-9ac46a5b0f89?source=collection_archive---------0-----------------------#2022-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="487c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在这个例子中，我将向您展示如何使用Gin HTTP web Framework for Golang为Web应用程序构建一个简单的登录系统。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/da15559dd1954c6d5b854d802b36f666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9GVx6eoDLK1EcdrT"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ruyan75?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">汝嫣·艾登</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="1f9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我展示了一个带有登录系统和会话管理的简单概念验证web应用程序的示例。它是用Go语言(Golang)编写的，并且利用了Gin HTTP Web框架。这里提供的例子很容易扩展。</p><p id="2de4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我构建代码的方式受到了Akhil Sharma构建“餐馆管理后端”示例代码的启发。此外，一些身份验证、登录和注销代码改编自Depado的身份验证示例。剩下的都是基于我之前的文章。参见文章末尾的参考资料，获取这些内容的链接。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1a1c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">先决条件</h1><p id="d8b0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">调试时，确保HTTP缓存被禁用。这也要求在调试时打开检查器或DevTools。</p><ul class=""><li id="61a5" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">如果您使用Firefox Inspector，请转到设置，找到高级设置，然后选中“<em class="ni">禁用HTTP缓存(当工具箱打开时)</em>。”</li><li id="67a3" class="mz na it lb b lc nj lf nk li nl lm nm lq nn lu ne nf ng nh bi translated">对于Chrome DevTools，进入首选项，找到网络设置，并选中“<em class="ni">禁用缓存(当DevTools打开时)</em>。”</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7360" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">目录结构</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/14a7227416a12bed8b6c0791dcd89b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*dbU8YSOuRutg8RJ0htgCDQ.png"/></div></figure><p id="5247" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的截图中，可以看到项目的文件和目录布局。您在这里看到的目录依次是名为<code class="fe np nq nr ns b">/gin_session_auth</code>的目录的子目录。这一点很重要，因为这也是项目的名称。</p><p id="9fdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当处理包时，我们总是从项目的名称开始，然后添加包的名称。例如，如果你想处理<code class="fe np nq nr ns b">controllers</code>包，你应该写<code class="fe np nq nr ns b">"gin_session_auth/controllers"</code>。您将在下面列出的文件的导入中看到这一点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="461b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">全局/全局. go</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="35b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们定义几个全局变量。我们在这里定义的用于会话管理。</p><p id="fd9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以添加许多其他信息，例如服务器的地址和端口。或者，我们也可以编写代码从JSON或YAML文件中导入全局变量，而不是像我们在这里所做的那样硬编码它们。</p><p id="0e1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记让变量以大写字母开头，这样它们可以被导出到其他包中。在整个项目中注意这一点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b905" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">main.go</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="1aa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是运行整个项目的主要函数。参见我的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-render-html-pages-with-gin-for-golang-9cb9c8d7e7b6">上一篇文章</a>关于用Gin加载HTML模板的基础知识。在这里，我将讨论那篇文章中没有提到的一些额外的概念。</p><p id="2924" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第4行和第5行，我们为Gin导入了会话中间件。在这种情况下，我们将使用Cookie后端保存会话数据。这个中间件还提供了其他后端，如Redis、MongoDB、memstore等。点击查看会话中间件<a class="ae ky" href="https://github.com/gin-contrib/sessions" rel="noopener ugc nofollow" target="_blank">的Github页面。</a></p><p id="1ffa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第10–12行，我们导入了一些我们在这个项目的其他地方定义的包(见下面标题下的讨论)。</p><p id="51bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第21行，我们告诉Gin路由器使用会话中间件和安全cookie后端。<code class="fe np nq nr ns b">globals.Secret</code>变量包含安全cookie的认证密钥。</p><p id="80a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第23和24行，我们为公共路由创建了一个路由器组。</p><p id="daf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第26–28行，我们为私有路由创建了一个路由器组。此外，我们告诉这个组使用认证中间件。这个中间件将在实际的处理程序运行之前运行。因此，在允许用户查看私人网页之前，我们可以检查用户是否已经过身份验证。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2590" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">路线/路线. go</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="17d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们从<code class="fe np nq nr ns b">controllers</code>包中调用处理程序。对于每个允许的路由，我们定义一个HTTP处理函数。</p><p id="a16a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录和访问web应用程序的索引页面不需要身份验证；因此，这些路线在<code class="fe np nq nr ns b">PublicRoutes()</code>功能中定义。</p><p id="c158" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，访问仪表板需要用户登录。此外，如果用户还没有被认证，那么注销也没有多大意义。这些路线在<code class="fe np nq nr ns b">PrivateRoutes()</code>功能中定义。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4dea" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">控制器/处理器. go</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="8c8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个文件中，我们定义了HTTP路由的所有处理程序。</p><p id="6c07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第14–31行，我们处理HTTP GET <code class="fe np nq nr ns b">/login</code>路由的动作。如果用户仍处于登录状态，系统会要求他在登录之前先注销。在任何情况下，名为<code class="fe np nq nr ns b">login.html</code>的HTML模板都会被呈现，然后由Gin使用<code class="fe np nq nr ns b">HTML()</code>函数作为响应返回。</p><p id="ae85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">响应包含一个要求输入用户名和密码的表单。当用户提供这些并点击提交按钮时，一个HTTP POST请求被发送到我们的web应用程序。</p><p id="9421" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第33–63行，处理程序处理<code class="fe np nq nr ns b">/login</code>路线的POST请求。如果用户已经登录，系统会要求他先注销。</p><p id="dba7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果用户没有提供用户名或密码，系统会要求他这样做。名为<code class="fe np nq nr ns b">EmptyUserPass()</code>的助手函数为我们检查这一点。然后，如果用户提供的用户名或密码组合不存在，他会被告知这些不正确。</p><p id="e9af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">密码检查由名为<code class="fe np nq nr ns b">CheckUserPass()</code>的助手函数完成。最后，如果无法保存会话，则会通知用户此情况。</p><p id="6840" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当一切顺利时，用户使用Gin框架中的<code class="fe np nq nr ns b">Redirect()</code>功能被重定向到他的仪表板。</p><p id="fa3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在一个更现实的设置中，用户名和密码不仅会被检查是否为空，还会根据其他标准来检查，比如它们包含的字符的长度和类型。这将需要更复杂的验证功能。</p><p id="a0e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第65-82行，我们实现了<code class="fe np nq nr ns b">/logout</code>路线的注销功能。首先，检索当前会话。如果此会话不存在，则会记录一条错误消息，并且不会再发生任何事情。否则，将删除并保存当前会话。如果无法保存新的空会话，则会记录一条错误消息。最后，用户被重定向到位于<code class="fe np nq nr ns b">/</code>的索引页面。</p><p id="6a0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第84-93行和第95-104行，分别实现了索引页和仪表板的处理程序。这些处理程序或多或少都是这样做的。他们检索当前会话并提取用户，然后为索引或仪表板返回一个呈现的HTML模板。模板中使用用户名。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5ac3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">中间件/身份验证必需. go</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="4b68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个文件中实现了用于检查用户是否已经过身份验证的中间件。它只是检查会话是否存在。如果会话为零，则用户被重定向到<code class="fe np nq nr ns b">/login</code>路由。否则，Gin框架会被告知进入下一步。</p><p id="a1b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，下一步将是处理私有路由的处理程序之一。另一方面，如果已经安装了其他中间件功能，那么下一步可能就是这些功能之一。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8d2a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">助手/助手。走</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="8385" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一些助手函数。</p><p id="e6a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第8-25行，我们实现了一个检查用户名和密码的功能。在这里，我们保持简单，并定义了两种可能的用户名和密码组合；你好+我和约翰+多伊。</p><p id="2c5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，在(更)实际的设置中，这些用户名和密码不会被硬编码。相反，它们会从某种数据库中检索出来。该数据库将允许我们更改现有密码，并添加新的用户名和密码组合。</p><p id="a100" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第27-29行，检查用户名和密码以确保它们都不为空。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="09bb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">超文本标记语言模板</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="76a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到上面这个项目中使用的所有HTML模板。这里有几件事需要注意:</p><ul class=""><li id="703b" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">在第10行，<a class="ae ky" href="https://bulma.io/documentation/" rel="noopener ugc nofollow" target="_blank">布尔玛CSS框架</a>被加载。</li><li id="c800" class="mz na it lb b lc nj lf nk li nl lm nm lq nn lu ne nf ng nh bi translated">在第22–48行，添加了一些Javascript来为布尔玛提供一些功能。更具体地说，这个脚本将允许用户点击一个“汉堡包”来显示导航条菜单。点击这里了解更多关于这个<a class="ae ky" href="https://bulma.io/documentation/components/navbar/" rel="noopener ugc nofollow" target="_blank">的信息。</a></li></ul><p id="c435" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看下面的参考资料，了解更多关于HTML模板、Gin和Golang的信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7541" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><p id="5335" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://bulma.io/documentation/" rel="noopener ugc nofollow" target="_blank">布尔玛CSS框架文档</a></p><p id="8622" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/gin-contrib/sessions" rel="noopener ugc nofollow" target="_blank">【会话】Github上的Gin</a></p><p id="9d5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/Depado/gin-auth-example" rel="noopener ugc nofollow" target="_blank">“gin-auth-example”由Depado在Github上发布</a></p><p id="32c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/AkhilSharma90/golang-restaurant-management-backend" rel="noopener ugc nofollow" target="_blank">Github上AkhilSharma90的《golang-餐厅-管理-后端》</a></p><p id="6061" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-templates-in-golang-46194c677c7d">“如何在Golang中使用模板”，作者Jes Fink-Jensen </a></p><p id="3c66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-generate-html-with-golang-templates-5fad0d91252">“如何使用Golang模板生成HTML”，作者Jes Fink-Jensen </a></p><p id="6fea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-render-html-pages-with-gin-for-golang-9cb9c8d7e7b6">“如何使用Gin为Golang呈现HTML页面”，作者Jes Fink-Jensen </a></p></div></div>    
</body>
</html>