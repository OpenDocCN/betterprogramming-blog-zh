# 5 个高级 Python 函数概念，并举例说明

> 原文：<https://betterprogramming.pub/5-advanced-python-function-concepts-explained-with-examples-dcf10389ac9a>

## 兰姆达斯，装饰，partials，等等

![](img/23ef6496799f2811be2818b0a61d7fde.png)

照片由 [Aurelien Romain](https://unsplash.com/@aurelien_romain?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄。

如果你的程序是一个工厂，函数就是操纵机器使你的程序运行的工人。在一个典型的工厂里，有不同类型的工人负责不同的工作。相应地，你的程序在功能上应该是通用的。为了编写健壮的函数，你的编码库应该包括必要的工具，让你用最好的工人来装备你的程序。

在本文中，我将解释 Python 中与函数相关的五个高级概念。在我们开始讨论之前，让我们假设我们理解了 Python 函数的基本形式，如下面的代码片段中所注释的:

Python 函数的基本形式

# 1.未确定的参数(*args 和**kwargs)

当我们定义函数时，我们可以有位置参数和关键字参数。位置参数通过它们的位置来解析，而关键字参数通过它们的参数名(即关键字或标识符)来解析。我们来看看内置`print`函数的签名:

```
**print**(**objects*, *sep=' '*, *end='\n'*, *file=sys.stdout*, *flush=False*)
```

`objects`参数是位置性的(我们很快会谈到星号)。所有其他参数都有它们唯一的标识符(例如，`sep`，`end`)，因此它们是关键字参数。顺便提一下，当传递关键字参数时，我们可以有不同的顺序，因为它们是由它们的标识符解析的。但是，位置参数严格按照位置进行解析。下面是一些例子:

传递参数

你可能已经注意到，我为`objects`参数传递了两个字符串。这是可能的，因为在`objects`参数前面有一个星号，它表示位置参数的数量不确定。当您看到这种函数签名时，您可以传递任意数量的适用位置参数。

除了位置参数，关键字参数也可以有一个可变的数字，通常用`**kwargs`表示。例如，您可能见过字典的构造函数签名，如下所示:

```
*class* dict(***kwarg*)
```

这意味着我们可以将任何关键字参数传递给`dict()`构造函数来创建新的 dictionary 对象。下面是一些简单的例子:

不同数量的关键字参数

*   前五行代码向您展示了我们如何通过指定任意数量的关键字参数来使用`dict()`构造函数来创建新的`dict`对象。
*   在自定义函数中(第 7-9 行)，当我们调用函数时，传递的关键字参数被打包到一个名为`kwargs`的字典中。为了在函数体中访问这些参数，我们可以迭代字典中的条目(第 8 行)。

虽然我们之前没有提到，但是使用不同数量的位置参数传递给函数的位置参数被打包到一个元组对象中。要了解关于打包和解包这些参数的更多信息，请参考以前的[媒体文章](https://medium.com/swlh/how-to-pack-and-unpack-data-in-python-tuples-and-dictionaries-55d218c65674)。

# 2.匿名函数

Lambda 函数是 Python 中的匿名函数。它们通常被用作一个内嵌函数来执行一个小任务。例如，在内置的`sorted()`函数中，如果我们想要应用一些高级的排序规范，我们可以设置`key`参数。下面是一个简单的例子:

λ排序函数

*   默认情况下，`sorted()`函数根据数值对这些数字进行排序。
*   但是，我们希望按照除以 3 后的余数对数字进行排序。在这种情况下，我们可以为`key`参数指定一个 lambda 函数(`lambda x:x % 3`)。
*   lambda 函数的一般格式为`lambda params: expr`。lambda 关键字表示 lambda 函数的声明，后跟一个参数列表和一个带有单个表达式的冒号。在我们的例子中，表达式是为每个数字计算`3`的模。

在数据科学中，我们经常使用熊猫图书馆进行数据处理。Lambda 函数对于从现有数据列中提取信息也很有用。下面的代码向您展示了一个简单的示例，它使用 lambda 函数将数据映射到 pandas `Series`数据对象:

串联映射中的λ函数

# 3.部分功能

部分函数是通过应用部分参数来利用现有函数的函数。这个定义听起来不太直白。通过一个简单的例子可以更好地理解这一点:

部分功能

*   `greeting`函数接受两个参数。我们通过设置这两个参数来使用这个函数。
*   在特定的用例中，我们总是使用相同的问候词。在这种情况下，我们可以通过将固定的问候词应用于`greeting`函数来创建一个部分函数。
*   `functools`模块有`partial`方法，可以方便地创建部分函数。如下例所示，部分函数被称为`say_hi`，它的调用相当于通过对`word`参数应用“Hi”来调用问候函数。

```
>>> say_hi
functools.partial(<function greeting at 0x1177c9040>, 'Hi')
```

# 4.关闭

Python 不是唯一有闭包概念的语言。许多其他主流语言(例如 Swift)都有闭包的特性。本质上，闭包是内部函数，它捕获外部函数中定义的非局部变量。让我们来看看下面的代码示例:

关闭示例

*   `make_incrementer`是外部功能，而`incrementer`是内部功能。
*   内部函数使用`counter`变量，该变量定义在外部函数的范围内，因此被视为非局部变量。
*   外部函数返回内部函数作为返回值。
*   我们可以通过调用这个`make_incrementer`函数来创建一个闭包。值得注意的是，创建的闭包将捕获非局部变量，如下所示:

捕获非局部变量

*   闭包捕获了两个非局部变量(`counter`和`step`)。
*   要访问非局部变量，我们可以使用`__closure__`和`cell_contents`来检索值。在本例中，您可以看到`counter`变量正在按照预期的方式递增。

# 5.装修工

在上一节中，我们讨论了闭包。我们应该理解闭包只是一种通用的技术实现方法，可以用于不同的目的。一个特别的目的是用 Python 创建装饰器。顾名思义，装饰器是应用附加功能(即装饰)而不改变原始功能预期工作的高阶功能。在解释它们是什么之前，让我们先看看下面的代码片段:

装饰示例

*   上面的代码片段实现了一个计时装饰器。我们可以看到调用`calculate_sum`函数大约需要 0.00018 秒。
*   如果我们仔细观察，我们会注意到`logging_time`函数是外层函数，如前一节所述。
*   要使用这个装饰器，我们只需在外部函数名前使用`@`符号，并将其放在要装饰的函数上方。请注意，修饰函数是`logging_time`函数的内部函数，如下图所示:

当然，这一节并不打算让您全面了解 Python 中的 decorators。相反，它只是给你一个概念证明，向你展示 decorators 可以帮助我们删除一些样板代码。在上面的例子中，我们可以对任何想要评估性能速度的函数使用这个计时装饰器。如果想学习更高级的 decorators 用例，请参考[我之前的文章](https://medium.com/better-programming/python-decorators-5-advanced-features-to-know-17dd9be7517b)。

# `Conclusion`

在本文中，我们回顾了与 Python 函数相关的五个高级概念。这里有一个快速回顾:

*   在 Python 中，`*args`和`**kwargs`表示不确定数量的位置和关键字参数。当我们调用函数时，我们需要学习如何使用它们，当我们自己声明函数时，我们可能也想包含它们。
*   Lambda 函数作为内嵌函数来执行小型任务非常有用，通常在几个内置函数中设置为`key`参数(例如`sorted`、`min`和`max`)。
*   部分函数是通过部分应用特定参数从现有函数创建的函数对象。如果我们需要为某些参数调用具有固定值的特定函数，这种技术可以节省我们一些时间。
*   闭包是一种可以用来创建捕获额外信息的函数的技术。在 Python 中，闭包可以通过返回在外部函数范围内定义的内部函数来创建。
*   装饰器是返回要被装饰的内部函数的高阶函数。通过装饰，被装饰的函数将具有装饰函数定义的额外行为，同时保持其自己的预期功能。