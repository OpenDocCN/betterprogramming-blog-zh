<html>
<head>
<title>How To Detect The Location of Your Website’s Visitors Using JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用JavaScript检测网站访问者的位置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-detect-the-location-of-your-websites-visitor-using-javascript-92f9e91c095f?source=collection_archive---------2-----------------------#2018-01-17">https://betterprogramming.pub/how-to-detect-the-location-of-your-websites-visitor-using-javascript-92f9e91c095f?source=collection_archive---------2-----------------------#2018-01-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/cd96edd4ff65d40a27f345c40dee3554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O8s-GnxQPCyWNVc2WJyB5g.jpeg"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">戈兰·艾沃斯在<a class="ae kf" href="https://unsplash.com/search/photos/javascript?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="7614" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出于多种原因，检测网站用户的位置非常有用。</p><p id="fa95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，您可能希望为来自不同国家的人显示不同的内容(可能使用不同的语言),或者向来自不同位置的访问者显示有针对性的信息。</p><p id="3e95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不管你的理由是什么，你有两个选择:</p><ol class=""><li id="5f87" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated"><a class="ae kf" href="https://developers.google.com/maps/documentation/geolocation/intro" rel="noopener ugc nofollow" target="_blank">地理定位API </a>和</li><li id="c6d7" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">IP地址查找</li></ol><h1 id="395a" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">地理定位API</h1><p id="4bfe" class="pw-post-body-paragraph kg kh it ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">地理位置API是HTML5的一个新特性，它允许网页的访问者与你共享他们的位置，如果他们愿意的话。</p><p id="0b54" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您尝试使用这个API检索位置时，会向用户显示一个提示，询问他们是否愿意与您的站点共享他们的位置。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/afd5a747361027a5fd61ac0d4eb3d7bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GuWK06WblU1s-upUb6F59Q.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">向用户显示的提示类型的示例</p></figure><p id="1501" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">显然，这意味着如果用户决定不与您共享他们的位置，您将无法获得位置。</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7055" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">缺点:它只能在安全服务器(https)上工作。它在Internet Explorer 10和更低版本上不受支持，OperaMini也不受支持。</p><p id="1f72" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">代码的输出只给了我们坐标。如果您需要实际位置，或者用文字获取地址，该怎么办？我们将在讨论完IP查找后讨论这个问题。</p><h1 id="35ae" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">IP地址查找</h1><p id="9459" class="pw-post-body-paragraph kg kh it ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">IP地址查找是获取访问者位置的另一种方式。对于这个选项，我们通常使用公共IP查找服务/API。其中有些是付费服务，有些是免费的。</p><p id="8a4d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例子包括<a class="ae kf" href="http://ip-api.com/" rel="noopener ugc nofollow" target="_blank"> IP地理定位API </a>、<a class="ae kf" href="https://ipinfo.io/" rel="noopener ugc nofollow" target="_blank"> IPinfo </a>和<a class="ae kf" href="http://geoip-db.com/" rel="noopener ugc nofollow" target="_blank"> GEOIP DB </a>。他们还提供各种格式的数据，比如JSON、XML和CSV。为了更好地理解如何使用这些服务，请阅读它们的文档。</p><p id="11e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我的例子中，我将使用IP地理定位API。我可以使用普通的JavaScript，但是我不会。使用像<a class="ae kf" href="http://jquery.com" rel="noopener ugc nofollow" target="_blank"> jQuery </a>这样的库更容易。</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="91e5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我的控制台上的输出:</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/13e59cdbbbc965980e6bfcba4db0a687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NJ26wSGREojLhOAttAUNhg.png"/></div></div></figure><p id="8108" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">缺点:虽然大多数IP查找服务给出的国家几乎总是准确的，但坐标并不总是准确的。此外，如果你要进行大量的请求，这些服务中的一些需要你获得一个API密钥，你可能需要为服务付费。</p><p id="4c86" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于不支持地理定位的浏览器中的地理定位API，您可以使用IP查找作为替代或备份，或者在发生错误时通知您，如下所示:</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="dda0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经以某种方式获得了我们的位置，我们将使用<a class="ae kf" href="https://developers.google.com/maps/documentation/geocoding/intro" rel="noopener ugc nofollow" target="_blank"> Google Maps反向地理编码API将检索到的纬度和经度转换为更全面的地址。</a></p><p id="fd18" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据谷歌的说法，<em class="nd"/>反向地理编码是将地理坐标转换成人类可读地址的过程。我们只需要一个api密钥。按照步骤在这里得到一个<a class="ae kf" href="https://developers.google.com/maps/documentation/geocoding/get-api-key" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="6755" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我得到的:</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/536392f6539cf600e71fb11ddce127d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i_vl2VlHMoKTS5dNsDXQ4A.png"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">反向地理编码API的输出示例</p></figure><p id="9081" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以随意摆弄该对象，以您最喜欢的格式获得所需的地址。</p><p id="2775" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">把这些放在一起，我们有下面的代码。(注意<code class="fe nf ng nh ni b">ipLookUp</code>功能被修改。)</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="545e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">至此，我们知道了如何在任何情况下检索用户的位置，现在您可以根据自己独特的项目定制代码。</p><p id="bbef" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望你有所收获，感谢阅读！</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="6ac4" class="ls lt it bd lu lv nq lx ly lz nr mb mc md ns mf mg mh nt mj mk ml nu mn mo mp bi translated">源代码</h1><p id="d09e" class="pw-post-body-paragraph kg kh it ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">您可以在<a class="ae kf" href="https://github.com/AdeyinkaAdegbenro/Detect_Location/blob/master/detect_location.js" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到本文的代码。</p><div class="nv nw gp gr nx ny"><a href="https://github.com/AdeyinkaAdegbenro/Detect_Location/blob/master/detect_location.js" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">AdeyinkaAdegbenro/Detect _ Location</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">通过在GitHub上创建一个帐户，为AdeyinkaAdegbenro/Detect _ Location开发做出贡献。</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div></div></a></div></div></div>    
</body>
</html>