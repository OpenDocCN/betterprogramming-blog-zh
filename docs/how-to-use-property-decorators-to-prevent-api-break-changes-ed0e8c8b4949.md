# 如何使用属性装饰器来防止 API 中断更改

> 原文：<https://betterprogramming.pub/how-to-use-property-decorators-to-prevent-api-break-changes-ed0e8c8b4949>

## 让您的 API 保持一致

![](img/506be0d0b41bd8d142843045666219e2.png)

照片由[阿齐兹·阿查基](https://unsplash.com/@acharki95?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

# 介绍

一些 Python 程序员为其他人开发包和框架。在这种情况下，他们的代码包括其他开发人员可以使用的公共 API。当我们设计软件包时，并不总是能够预见到技术世界发展过程中可能出现的所有潜在问题——我们也不能预见到每一个相关的业务需求。通常，我们必须不断更新我们的软件包，这是当你看到你可能使用的不同版本的软件包时。

由于 Python 的开源特性，大多数 Python 程序，包括许多包本身，都依赖于其他 Python 包。可能发生的一个常见情况是，某一天您的代码工作正常，但在您更新了程序的一些依赖项后，第二天它就停止工作了。当然，这也是为什么人们使用 Docker 这样的容器来解决这些依赖相关的问题。但是从包开发人员的角度来看，我们应该不惜一切代价努力防止 API-break 更改。

# 属性

作为一种面向对象的编程语言，Python 主要通过创建各种对象来实现其功能。正如其他 OOP 语言一样，Python 对象的一个特性是拥有适用的属性。

假设我们正在构建一个客户端管理程序。数据模型用于管理每个客户端的信息。为此，在程序的初始版本中，我们有以下代码。

客户端类别 V0

如您所见，我们有`Client`类，每个实例都有`first_name`、`last_name`、`middle_initial`和`initials`属性。

# 问题是

**在我们继续之前，先做一个简短的声明:**这个问题可以通过首先采用适当的设计来避免。此处的插图主要用于演示目的。

假设我们的程序很受欢迎，很多公司都用我们的程序。然而，一个新的功能需求出现了——一些公司希望能够改变客户的姓氏，因为在美国，女性结婚后改变姓氏并不罕见。

随着某人姓氏的改变，他们的姓名首字母也随之改变。然而，在创建客户端实例时，我们已经硬编码了某人的姓名首字母。为了解决这个问题，我们实际上可以将获取`initials`作为一个函数，如下所示。

客户类别 V1

然而，这种实现会给其他一些公司带来问题，因为`initials`属性是实例对象的属性，作为`client.initials`被访问。经过这次修改，我们将不得不通过调用函数`client.initials()`来获取某人的姓名首字母。

突破 API 的变化

如上所示，本质上，我们引入了一个 break 变更(即，一个 API 变更使得现有代码停止工作)。没有程序员喜欢看到他们的代码因为依赖包的改变而停止工作。

# 房地产装修工

为了防止这种 API 中断变化，我们可以利用`property`装饰器。在我们解释它是什么之前，让我们看看下面代码片段中的`Client`类的更新版本。

客户类别 V2

要使用`property`装饰器，我们只需将`@property`放在我们在`Client`类的`V1`中声明的函数`initials()`之上。有了这个`property`装饰器，它允许我们使用点符号而不是调用函数来访问属性，如下所示。

物业装饰

代码向您展示了我们可以使用相同的点符号来访问`initials`属性(或`Client`类`V2`的属性)。本质上，我们通过实现属性装饰器来防止 API 中断更改。

# 属性装饰器的其他好处

前一节向您展示了我们如何使用`property` decorator 通过允许我们使用点符号访问属性来保持 API 的一致性，就像访问属性一样。然而，`property`装饰器有额外的好处。

*   它允许我们更好地控制如何为特定属性设置值——或者某些内容是否可以设置。对于常规属性，我们不能直接控制当前的代码。例如，对于`initials`的情况，我们不希望它被手动设置。使用`property`装饰器，如果我们没有为`property`实现 setter，它是不可设置的，如下所示。

设定器控制

*   因为在引擎盖下，属性是作为函数实现的，这给了我们在函数内添加额外操作的可能性。例如，假设我们希望在有人试图访问首字母时得到通知(尽管我认为这在现实中并不重要)。这个功能可以通过`property`装饰器实现，如下所示。

数据监控

# 结论

在本文中，我们主要回顾了如何使用`property`装饰器来防止可能的 API 中断更改。此外，我们还谈到了在你的项目中使用`property`装饰者的其他好处。

感谢你阅读这篇文章。