<html>
<head>
<title>Set Android BDD Style with Kotlin Spek 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Kotlin Spek 2设置Android BDD样式</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/set-android-bdd-style-with-kotlin-spek-2-14176f235d17?source=collection_archive---------6-----------------------#2019-10-18">https://betterprogramming.pub/set-android-bdd-style-with-kotlin-spek-2-14176f235d17?source=collection_archive---------6-----------------------#2019-10-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="41e1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">给出你项目的时间概念</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eefdc908daf0a1a091b6a74ec879ca2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMzYqa_yqF8Vg6YKwRPQDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">科特林·斯佩克框架</p></figure><p id="4fbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Spek是为Kotlin设计的强大的行为驱动测试框架。有了<a class="ae lu" href="http://spekframework.org/" rel="noopener ugc nofollow" target="_blank"> Spek </a>，我们可以快速实现一个BDD(行为驱动开发)环境，允许你以一种清晰、可理解和人类可读的方式轻松定义你的测试。</p><p id="0b20" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此时，我们可以学习如何使用<a class="ae lu" href="http://spekframework.org/" rel="noopener ugc nofollow" target="_blank"> Spek </a>创建一个<a class="ae lu" href="https://www.android.com" rel="noopener ugc nofollow" target="_blank"> Android </a>单元测试。希望这能帮助那些不习惯测试的开发人员。</p><p id="297e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是在我们开始之前，我们有一个问题。<a class="ae lu" href="http://spekframework.org/" rel="noopener ugc nofollow" target="_blank"> Spek </a>在JUnit5上运行良好<a class="ae lu" href="https://www.android.com" rel="noopener ugc nofollow" target="_blank"> Android </a>在JUnit4上卡死。我们需要另一个图书馆。</p><p id="b4bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我们要用的:</p><ul class=""><li id="66a8" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><a class="ae lu" href="https://github.com/mannodermaus/android-junit5" rel="noopener ugc nofollow" target="_blank">安卓JUnit 5 </a></li><li id="f9e0" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">Spek框架第二版</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="552a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">步骤1 —设置JUnit5</h1><p id="e404" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">首先，打开<code class="fe nn no np nq b">build.gradle</code>(项目级)来添加存储库和依赖项:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="9b45" class="nv mr it nq b gy nw nx l ny nz">repositories {<br/>    maven { url "http://dl.bintray.com/jetbrains/spek" }<br/>}<br/>dependencies {<br/>    classpath "de.mannodermaus.gradle.plugins:android-junit5:<strong class="nq iu">1.5.1.0</strong>"<br/>}</span></pre><p id="005b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后打开<code class="fe nn no np nq b">build.gradle</code>(应用级)并应用:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="a705" class="nv mr it nq b gy nw nx l ny nz">apply plugin: "de.mannodermaus.android-junit5"</span></pre><p id="d1d1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，对于依赖关系:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="7972" class="nv mr it nq b gy nw nx l ny nz">testImplementation "org.junit.jupiter:junit-jupiter-api:<strong class="nq iu">5.5.1</strong>"<br/>testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:<strong class="nq iu">5.5.1</strong>"</span></pre><p id="a0d3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意:你应该注意Junit 5版本和库版本的mannodermaus是不同的</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="3f37" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">步骤2 —设置Spek2</h1><p id="8420" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">在<code class="fe nn no np nq b">build.gradle</code>(应用级)中仍然需要一个小的补充。在<code class="fe nn no np nq b">testOptions</code>上添加<code class="fe nn no np nq b">junitPlatform</code>:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="6ee2" class="nv mr it nq b gy nw nx l ny nz">android {<br/>    testOptions {<br/>        junitPlatform {<br/>            filters {<br/>                engines {<br/>                    include 'spek2'<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="433b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，添加<code class="fe nn no np nq b">spek2</code>依赖项:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="ee34" class="nv mr it nq b gy nw nx l ny nz">testImplementation "org.spekframework.spek2:spek-dsl-jvm:<strong class="nq iu">2.0.7</strong>"<br/>testImplementation "org.spekframework.spek2:spek-runner-junit5:<strong class="nq iu">2.0.7</strong>"</span></pre></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8793" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">步骤3 —开始测试</h1><p id="5853" class="pw-post-body-paragraph ky kz it la b lb ni ju ld le nj jx lg lh nk lj lk ll nl ln lo lp nm lr ls lt im bi translated">创建一个纯类和一些函数:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="a182" class="nv mr it nq b gy nw nx l ny nz">class Math {<br/>    fun multiplication(x: Int, y: Int) = x.times(y)<br/>    fun division(x: Int, y: Int) = x.div(y)<br/>}</span></pre><p id="5a30" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后做一个测试用例:</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="bf2f" class="nv mr it nq b gy nw nx l ny nz">package com.project.myapplication<br/><br/>import org.junit.jupiter.api.Assertions.assertEquals<br/>import org.spekframework.spek2.Spek<br/>import org.spekframework.spek2.style.gherkin.Feature<br/><br/>object MathTest : Spek({<br/>    <strong class="nq iu">Feature</strong>("math") {<br/>        val math = Math()<br/><br/>        <strong class="nq iu">Scenario</strong>("do multiplication") {<br/>            var a = 0<br/>            var b = 0<br/>            var multiple = 0<br/>            val result = 21<br/><br/>            <strong class="nq iu">Given</strong>("initial a and b") {<br/>                a = 3<br/>                b = 7<br/>            }<br/><br/>            <strong class="nq iu">When</strong>("multiple a with b") {<br/>                multiple = math.multiplication(a, b)<br/>            }<br/><br/>            <strong class="nq iu">Then</strong>("it should return multiplication between a and b") {<br/>                assertEquals(result, multiple)<br/>            }<br/>        }<br/><br/>        <strong class="nq iu">Scenario</strong>("do division") {<br/>            var a = 0<br/>            var b = 0<br/>            var division = 0<br/>            val result = 3<br/><br/>            <strong class="nq iu">Given</strong>("initial a and b") {<br/>                a = 21<br/>                b = 7<br/>            }<br/><br/>            <strong class="nq iu">When</strong>("division a with b") {<br/>                division = math.division(a, b)<br/>            }<br/><br/>            <strong class="nq iu">Then</strong>("it should return division between a and b") {<br/>                assertEquals(result, division)<br/>            }<br/>        }<br/>    }<br/>})</span></pre><p id="51f8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，右键单击文件夹test来运行它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/d8b7798c58b0ad1babf7dab6bafd36fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3REmYLY73uKPp4DLUUI6DQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">spek运行测试</p></figure><h1 id="8d1c" class="mq mr it bd ms mt ob mv mw mx oc mz na jz od ka nc kc oe kd ne kf of kg ng nh bi translated">试验结果</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/255f190d8e0a621f0571052e187c0dba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6cb5vuA8palE-dqecKl9eA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">spek情景测试</p></figure><p id="e5d1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">GWT是一种将场景或测试用例分解成三个部分的方法:</p><ul class=""><li id="7ad0" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><strong class="la iu">给定</strong>是在这个场景中执行行为之前的初始状态。你可以说这是测试的先决条件。</li><li id="38c3" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><strong class="la iu">什么时候</strong>是我们将要采取的行为或行动</li><li id="eff4" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><strong class="la iu">然后</strong>描述你预期的因指定行为而产生的变化。</li></ul><p id="cb6e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在你的测试结果更容易阅读和理解，因为BDD环境已经在你的Android项目中实现了！</p></div></div>    
</body>
</html>