<html>
<head>
<title>Use Howler.js to Control Audio Playback in Your AI-Powered Assistant</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Howler.js来控制你的人工智能助手的音频播放</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/control-audio-playback-with-your-ai-powered-assistant-967dce72a582?source=collection_archive---------14-----------------------#2022-09-05">https://betterprogramming.pub/control-audio-playback-with-your-ai-powered-assistant-967dce72a582?source=collection_archive---------14-----------------------#2022-09-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b34e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用Houndify API按下“暂停”</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f946a773ed20a2f8d3e794d207b4b05d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zGD0GgjMH90inPpuqx1NyQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="2922" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">欢迎回到本系列的第三部分！首先，我们设置我们的初始应用程序。接下来，在上一篇文章中，我们让客户端播放音乐。</p><p id="b8be" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">过了今天，我们就可以要求助理“暂停音乐”或“播放最后一首歌”</p><p id="89cf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是我们将构建的演示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lr ls l"/></div></figure><h1 id="8472" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">安装</h1><p id="a342" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">如果您没有阅读本系列的最后一篇文章，我建议您先阅读那篇文章。</p><div class="mq mr gp gr ms mt"><a rel="noopener  ugc nofollow" target="_blank" href="/make-your-ai-powered-personal-assistant-play-music-featuring-web3-a1e7eec68f4a"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">让你的人工智能个人助理播放音乐！(以Web3为特色)</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">整合Houndify API，做一个类似Alexa或者Siri的个人助理</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">better编程. pub</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh kp mt"/></div></div></a></div><p id="18e8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是如果你喜欢直接跳过，你可以在这里找到启动代码<a class="ae ni" href="https://hashnode.com/build-your-own-ai-powered-virtual-assistant-on-the-web-part2" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="1c76" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了实现这个特性，我们需要另一个域。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/ab81fffcf645cd934708235940a2deae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1vkK0iYDsrj9cLaI7Vplyw.jpeg"/></div></div></figure><p id="753c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">启用并单击右上角的保存更改。该域将启用回放控制命令。</p><h1 id="76ca" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">处理音乐播放器命令</h1><p id="7b93" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">首先，在<code class="fe nk nl nm nn b">src/handlers</code>文件夹中创建一个新文件。命名为<code class="fe nk nl nm nn b">MusicPlayerCommand.ts</code>。这个文件将包含一个接收命令数据的函数。</p><p id="9917" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将以下代码添加到文件的顶部:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no ls l"/></div></figure><p id="2cdc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nk nl nm nn b">SUCCESS_RESULT</code>和<code class="fe nk nl nm nn b">FAILED_RESULT</code>为包含适当跟进响应的新结果定义位置。</p><p id="24e2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nk nl nm nn b">VOLUME_DELTA</code>是我们需要时调高或调低的音量百分比。</p><p id="c031" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在在<code class="fe nk nl nm nn b">handlePlayerCommand</code>函数中，我们使用来自<code class="fe nk nl nm nn b"><a class="ae ni" href="https://github.com/goldfire/howler.js#methods" rel="noopener ugc nofollow" target="_blank">Howler.js</a></code>的一个对象来控制音乐。但是首先，我们需要检查结果数据中的<code class="fe nk nl nm nn b">CommandType</code>。</p><p id="6977" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">随意复制粘贴这个。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no ls l"/></div></figure><p id="3310" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不要忘记将我们的新文件添加到<code class="fe nk nl nm nn b">index.ts</code>中的handlers数组中。</p><pre class="kg kh ki kj gt np nn nq nr aw ns bi"><span id="0f82" class="nt lu iq nn b gy nu nv l nw nx">const COMMANDS = ["MusicCommand", "MusicPlayerCommand"];</span></pre><h1 id="57bb" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">跟踪播放的歌曲</h1><p id="83d7" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">如果您阅读了上一篇文章，您应该知道在<code class="fe nk nl nm nn b">playSound.ts</code>中没有名为<code class="fe nk nl nm nn b">music</code>的导出。应该是对播放音频时创建的<code class="fe nk nl nm nn b">Howl</code>对象的引用。</p><p id="0889" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另外，我们应该只在播放的音频是歌曲时更新它，而不是任何反馈声音。</p><p id="ddd8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打开该文件，并用以下代码替换其内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no ls l"/></div></figure><p id="92f8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是，当我们用play sound播放一首歌曲时，我们需要将类型设置为“music”</p><p id="e69b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还需要存储当前歌曲的URL，以防用户想要再次播放它。为此，我们可以使用<code class="fe nk nl nm nn b">localStorage</code>。</p><p id="5d28" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">打开<code class="fe nk nl nm nn b">MusicCommand.ts</code>,将我们播放歌曲的那一行替换为:</p><pre class="kg kh ki kj gt np nn nq nr aw ns bi"><span id="53c2" class="nt lu iq nn b gy nu nv l nw nx">playSound(audioURL, { format: "webm" }, "music");<br/>localStorage.setItem("lastSong", audioURL);</span></pre><h1 id="981a" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="1cd9" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">这就是一切！我们用<code class="fe nk nl nm nn b">Howler.js</code>来控制音乐，用<code class="fe nk nl nm nn b">localStorage</code>来存储最后播放的歌曲。像以前一样，如果你愿意，你可以在这里找到这篇文章的源代码<a class="ae ni" href="https://hashnode.com/build-your-own-ai-powered-virtual-assistant-on-the-web-part3" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c06c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这个系列的下一次，我们将执行音乐识别，这样我们就可以问，“那是什么歌？”。尽情享受吧！</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="f8a9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="of">原发布于</em><a class="ae ni" href="https://cs310.hashnode.dev/build-your-own-ai-powered-virtual-assistant-on-the-web-part3" rel="noopener ugc nofollow" target="_blank"><em class="of">https://cs 310 . hash node . dev</em></a><em class="of">。</em></p></div></div>    
</body>
</html>