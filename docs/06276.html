<html>
<head>
<title>You Built Your Node App, But Are You Logging?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你构建了你的节点应用程序，但是你在登录吗？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/you-built-your-node-app-but-are-you-logging-665c7b2bb06b?source=collection_archive---------8-----------------------#2020-09-16">https://betterprogramming.pub/you-built-your-node-app-but-are-you-logging-665c7b2bb06b?source=collection_archive---------8-----------------------#2020-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fcca" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">日志记录是一种最佳实践。以下是正确的做法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/41abada5a0357d9f9cb993f572104923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7Wb8mKt3iHZMq5Xfy_w2w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@m15ky?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">麦克·提尼翁</a>在<a class="ae ky" href="https://unsplash.com/s/photos/paper?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="71fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日志记录是开发应用程序的重要部分。当应用程序处于生产阶段时，如果出现问题，日志对于识别问题是必要的。因此，如果你是一名开发人员，你应该问自己这个问题:“我的登录方式正确吗？”</p><p id="2059" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将提供这个问题的答案。我们将讨论开发人员——尤其是<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>开发人员——在记录他们的应用程序事件时应该遵循的最佳实践。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7358" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么日志很重要？</h1><p id="21ba" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">无论我们在开发一个应用程序时有多小心，要让它100%安全和没有错误都是一件困难的事情。我们试图通过测试和调试来发现和解决开发过程中的大多数问题。尽管如此，我们还是不能抓住所有的人。</p><p id="65cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于这些遗留的错误，在生产环境中运行的应用程序在某些情况下可能会以意想不到的方式运行。有时候，他们真的很挑剔。他们甚至可能使应用程序完全崩溃。在这种情况下，我们能运行一个调试器来找出我们的应用程序出了什么问题吗？不，这不是最实际的想法。</p><p id="6a79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，我们使用应用程序日志来理解应用程序行为不同的方式和原因。为此，我们必须设置应用程序来记录有关其事件和错误的信息。这就是我们所说的记录。日志记录帮助我们识别生产中运行的应用程序的问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="867c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">记录最佳实践</h1><p id="e19c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">由于日志非常重要，我们需要遵循日志实践，这将有助于我们轻松识别问题及其原因。</p><h2 id="2350" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">1.不要使用console.log</h2><p id="7b24" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">开发人员倾向于依赖Node的<code class="fe nl nm nn no b">console.log</code>函数来记录应用程序事件，因为它易于访问，不需要额外的设置，并且易于使用。但是如果你想认真对待日志记录——你应该这样做——这不是实现它的方法。</p><p id="0ddb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nl nm nn no b">console.log</code>将其输出打印到<code class="fe nl nm nn no b">stdout</code>。其他控制台功能，如<code class="fe nl nm nn no b">console.err</code>和<code class="fe nl nm nn no b">console.warn</code>，打印输出到<code class="fe nl nm nn no b">stderr</code>。您不能配置<code class="fe nl nm nn no b">console.log</code>将日志传输到文件或数据库。当应用程序处于生产状态时，您不能打开和关闭日志记录，也不能在不同的日志记录级别之间切换(我们将在后面讨论)。</p><p id="b1b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单地说，<code class="fe nl nm nn no b">console.log</code>没有提供足够的特性或配置选项来成为一个合适的日志工具。相反，您应该使用专用的日志库来正确完成工作。</p><h2 id="ca27" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">2.使用专用的日志库</h2><p id="cc74" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">与<code class="fe nl nm nn no b">console.log</code>不同，专用的日志库提供了一组创建日志的特性，让我们可以轻松地识别问题，并提供足够的配置来充分利用我们的日志。</p><ul class=""><li id="d901" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">大多数日志库支持几种日志级别，如info、debug、warning和error。这些级别有助于根据我们的需要过滤日志。</li><li id="9bb2" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">使用日志库的最大优势是即使应用程序在生产中，也能够在日志级别之间切换。</li><li id="452d" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">它们还支持为不同级别的日志设置不同颜色的格式。一些库也支持不同数据类型的格式化，比如JSON。</li></ul><p id="497e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.npmjs.com/package/winston" rel="noopener ugc nofollow" target="_blank"> Winston </a>和<a class="ae ky" href="https://www.npmjs.com/package/bunyan" rel="noopener ugc nofollow" target="_blank"> Bunyan </a>是两个最受节点开发者欢迎的日志库。</p><p id="fde0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将在代码示例中使用Winston。</p><h2 id="5435" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">3.源、时间戳、上下文——日志中最重要的部分</h2><p id="aa1b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">应用程序记录的每个日志都应该由这三部分组成。</p><ul class=""><li id="aaa8" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">来源:如果我们使用日志调试我们的应用程序，了解每个事件发生的位置是很重要的。源可以是主机、方法、区域的名称，或者在微服务架构中是服务的名称。</li><li id="f643" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">时间戳:记录所发生事件的时间戳对于日志记录也很重要。我们可能需要过滤某个时间段内记录的日志，或者按照日志发生的时间对日志进行排序。因此，时间戳是应用程序日志的重要部分。</li><li id="c96d" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">上下文和级别:当我们调试应用程序时，特定日志的上下文很重要。例如，如果应用程序正在注册一个新用户，那么这个操作有几种可能会失败。用户可能提供了无效数据，或者已经在系统中注册。这些失败之所以没有发生，是因为我们的应用程序运行不正常。但是如果这个操作因为应用程序无法连接到数据库而失败，那就意味着出现了问题。因此，为每个日志提供事件的上下文对于充分利用日志记录至关重要。此外，记录级别对于根据应用程序的不同问题的重要程度来筛选和识别它们也很重要。</li></ul><h2 id="1638" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">4.正确使用日志级别</h2><p id="975a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们使用日志记录级别按紧急程度对它们进行排序，这样我们就可以相应地对它们进行筛选。</p><p id="ffa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Syslog标准提供了根据严重性声明的特定级别，我们可以在记录时使用这些级别。</p><ul class=""><li id="6db9" class="np nq it lb b lc ld lf lg li nr lm ns lq nt lu nu nv nw nx bi translated">紧急:系统无法使用。</li><li id="3894" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">警告:必须立即采取行动。</li><li id="9a9a" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">危急:危急情况。</li><li id="747d" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">错误:错误条件。</li><li id="d1f3" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">警告:警告条件。</li><li id="5b0d" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">注意:正常但重要的情况。</li><li id="a868" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">信息性:信息性消息。</li><li id="afcb" class="np nq it lb b lc ny lf nz li oa lm ob lq oc lu nu nv nw nx bi translated">调试:调试级别的消息。</li></ul><p id="9aeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以更改标准级别，以创建更适合您的应用的级别列表。但是，必须给每个日志指定一个级别，以便能够根据需要过滤它们。</p><h2 id="8fe5" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">5.记录时不要做什么</h2><p id="b511" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">日志记录本身不应该产生任何错误。</p><p id="7702" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们试图用日志来发现应用程序中的错误。我们不需要日志在此基础上添加自己的错误。因此，要确保日志操作的编写方式不会产生错误。</p><p id="5024" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，以下代码可能会在记录时引发错误。您应该避免这样的情况:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="bd73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日志操作也应该是无状态的。</p><p id="cd93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日志记录操作不应该在应用程序中生成任何状态更改，比如更改数据库。您应该避免这样的情况:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><h2 id="4f9e" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">6.在生产中使用适当的日志记录级别</h2><p id="1f9b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当我们的应用程序处于生产阶段时，能够记录每个级别的记录将是理想的。但这并不总是可行的。如果您的应用程序有大量的用户流量，记录每一级代码将会导致巨大的性能下降。</p><p id="6550" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要采取积极主动的方法来避免这种情况，并以最佳方式记录日志。在生产级别的应用程序中，大多数日志属于调试和信息级别。因此，在正常运行时，如果我们关闭调试和信息日志，只记录较低级别的日志，就可以避免频繁记录带来的性能问题。</p><p id="8545" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在生产中的应用程序中，我们打开警告、错误和其他较低级别的日志来识别它是否处于危急状态。只有在检测到错误时，我们才能打开调试和信息级别的日志。</p><p id="6ac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用日志框架的好处之一是能够在生产过程中轻松地更改日志级别。</p><h2 id="c5dc" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">7.将当前日志记录级别存储为环境变量</h2><p id="8960" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了确保我们可以在需要时轻松地在级别之间切换，您应该将应用程序的当前日志记录级别存储为一个环境变量。这使我们能够在应用程序仍处于生产状态时，通过简单地更改变量值来更改级别。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="315b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="809a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您正在构建一个准备投入生产的应用程序，日志记录是它应该具有的一个重要特性。在本文中，我们讨论了在创建日志系统时应该使用的最佳实践。有了这些知识，您现在就可以开始为您的应用程序构建一个优秀的日志记录系统。</p><p id="824f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>