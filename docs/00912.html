<html>
<head>
<title>How To Write Smart Contracts for Blockchain Using Python — Part Two</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python编写区块链智能合约——第二部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-write-smart-contracts-for-blockchain-using-python-part-2-99fc0cd43c37?source=collection_archive---------3-----------------------#2019-07-27">https://betterprogramming.pub/how-to-write-smart-contracts-for-blockchain-using-python-part-2-99fc0cd43c37?source=collection_archive---------3-----------------------#2019-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9e41" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">入门分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f4a9850e3980c83fde02acab74f77a4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PBC-Wqe4zKmClVK8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@hiteshchoudhary?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Hitesh Choudhary </a>拍摄的照片</p></figure><p id="9376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一系列教程中，我们将使用智能链领域的<a class="ae ky" href="https://smartpy.io/" rel="noopener ugc nofollow" target="_blank"> SmartPy </a>语言。SmartPy提供了一个完整的集成开发环境来在线编写智能合同、测试它们、调试它们并在区块链中部署它们。</p><p id="9999" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要求</p><ul class=""><li id="bd03" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">计算机编程经验</li><li id="abce" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">基本的Python编程知识</li><li id="77c7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">区块链技术熟人</li><li id="9ab3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">网络浏览器</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="a205" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">欢迎来到SmartPy！</h1><p id="591a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">SmartPy基于Python 3语言，需要Python代码语法。Python开发人员在开始用SmartPy编写智能契约时会感觉很自在。</p><p id="8ed3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，请注意，虽然可以通过import指令导入Python库，但是有些特性只能在开发环境中工作。例如，当部署到区块链时，就有这方面的具体情况。</p><h2 id="249b" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated"><strong class="ak">首先要做的事情</strong></h2><p id="de60" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">对于那些不太了解Python的人来说，记住缩进是很重要的。它影响代码的正确性。</p><p id="a848" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于智能合约编程的新手来说，注意智能合约总是有一个<em class="nz">入口点</em>，通过这个入口点，它将通过一个事务从外部世界被调用。</p><p id="d342" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">智能合同发布后，驻留在区块链中，分散并分布在计算机节点网络上。每个节点上都有智能合约的副本。</p><h2 id="0078" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated">第一课</h2><p id="a278" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">让我们先来认识一下<a class="ae ky" href="https://smartpy.io/demo" rel="noopener ugc nofollow" target="_blank">开发环境</a>。您将被授予访问SmartPy IDE的权限:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/b1765f0d7d1bd954c2dc368fa1791284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SR8D407d-VrMilr9P9ZlA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">智能IDE一览</p></figure><p id="5b3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再简单不过了。屏幕左侧是编辑器，您可以在其中键入智能合约源代码。右边是输出面板；它将显示您编程的结果输出。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8e72" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated"><strong class="ak">你好世界！</strong></h1><p id="660f" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">古希腊有句谚语说，如果你用一种新语言编写的第一个程序不是“Hello World！”那你以后编程会有很多麻烦。所以…</p><h2 id="b093" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated"><strong class="ak">我们的第一次SmartPy体验</strong></h2><p id="950a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">单击屏幕的编辑器部分，并键入:</p><pre class="kj kk kl km gt ob oc od oe aw of bi"><span id="d4fe" class="nn mr it oc b gy og oh l oi oj">alert("Hello World!")</span></pre><p id="d103" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，只需点击<em class="nz">评估脚本&amp;运行测试</em>(输出面板上的按钮)。瞧啊。出现一个显示“Hello World！”在屏幕上。这是一个公平的开始，只是为了打破僵局。</p><h2 id="129b" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated"><strong class="ak">再往前一点</strong></h2><p id="12eb" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">好的，很高兴看到屏幕上的提示信息。但是，让我们稍微修改一下我们的代码，通过向我们的智能契约脚本添加一个测试来改变消息的显示方式。</p><p id="736d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需将下面的代码复制并粘贴到编辑器中。注意缩进，因为它很重要:</p><pre class="kj kk kl km gt ob oc od oe aw of bi"><span id="7e55" class="nn mr it oc b gy og oh l oi oj"><a class="ae ky" href="http://twitter.com/addTest" rel="noopener ugc nofollow" target="_blank">@addTest</a>(name = "testHelloWorld")<br/>def myTest():<br/>   setOutput("Hello World!")</span></pre><p id="5da0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，再次点击按钮<em class="nz">评估脚本&amp;运行测试</em>。您将在输出面板上看到结果，您还会注意到一个名为<em class="nz"> testHelloWorld </em>的新按钮出现在它的上方:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/2f42bf365dcd4c5e59281ee23ee563e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5v7CbiOdzcfRkdgzd4MLOw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">新脚本的输出结果</p></figure><p id="8712" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该测试非常重要，因为我们需要在将智能合约发布到区块链之前模拟它的行为。</p><p id="fa89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，一切顺利。尽管如此，目前还没有太多与智能合约相关的东西。</p><h2 id="efb0" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated"><strong class="ak">创建我们的首个智能合同</strong></h2><p id="f773" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">所以，让我们认真起来。我们现在将创建我们的第一个智能合同。首先，我们将<code class="fe ol om on oc b">import</code>这个<code class="fe ol om on oc b">smartpy</code>库。清除编辑器并将下面的代码粘贴到其中:</p><pre class="kj kk kl km gt ob oc od oe aw of bi"><span id="b8bb" class="nn mr it oc b gy og oh l oi oj">import smartpy as sp</span></pre><p id="a339" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经导入了库，我们将能够基于继承的契约定义一个类。将此添加到您的代码中:</p><pre class="kj kk kl km gt ob oc od oe aw of bi"><span id="30e2" class="nn mr it oc b gy og oh l oi oj">class MyClass(sp.Contract):<br/>    def __init__(self):<br/>        self.init(result = 0)</span></pre><p id="77ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在这里做的是定义一个新类并声明它的构造器方法(init)。这就是这个类的新实例(对象)将被初始化的方式。</p><h2 id="b759" class="nn mr it bd ms no np dn mw nq nr dp na li ns nt nc lm nu nv ne lq nw nx ng ny bi translated"><strong class="ak">定义智能合同入口点</strong></h2><p id="a162" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">智能合约至少有一个<em class="nz">入口点</em>。那么，让我们为我们的契约声明入口点。将以下文本添加到您的代码中:</p><pre class="kj kk kl km gt ob oc od oe aw of bi"><span id="a9a7" class="nn mr it oc b gy og oh l oi oj">    @sp.entryPoint<br/>    def myEntryPoint(self, params):<br/>        self.data.result = params.op1 + params.op2</span></pre><p id="9f34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您现在尝试通过点击<em class="nz">评估脚本&amp;运行测试</em>按钮来运行代码，什么也不会发生。这是因为我们需要在代码中添加一个测试。</p><p id="65d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，我们开始吧。复制下面的文本并粘贴到您的代码中:</p><pre class="kj kk kl km gt ob oc od oe aw of bi"><span id="afd6" class="nn mr it oc b gy og oh l oi oj">@addTest(name = "myFirstSmartContractTest")<br/>def mySmartContractTest():<br/>   html = ""<br/>   mySmartContract = MyClass()<br/>   html += mySmartContract.myEntryPoint(op1 = 1, op2 = 2).html()<br/>   setOutput(html)</span></pre><p id="7f0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们分解一下我们添加的测试。这里正在做什么？</p><p id="52d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们正在定义一个名为<code class="fe ol om on oc b">html</code>的字符串，我们将使用它在屏幕上呈现我们的输出。然后我们创建一个类<code class="fe ol om on oc b">MyClass</code>的对象<code class="fe ol om on oc b">mySmartContract</code>实例，它是<code class="fe ol om on oc b">sp.Contract</code>类型的派生。这就是我们如何在Tezos smart契约中有效地转变该类别。这个派生构造，以及构造函数和初始化，都是纯标准的Python语法。</p><p id="5920" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，上面的<code class="fe ol om on oc b">@</code>方法/函数声明是Python <em class="nz">装饰器</em>，用于指导编译器执行某些操作。它们就是所谓的<em class="nz">语法糖</em>，它提供了一种方便的方式来给函数定义添加一点魔力。你可以把它想象成一个把你写的Python函数转换成另一个Python函数的函数。</p><p id="dd95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，<code class="fe ol om on oc b">sp.entryPoint</code>是一个函数，它接受一个Python函数，并将其转换成一个将成为实际的迈克尔逊入口点的函数。</p><p id="594e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，尝试再次运行代码，看看会发生什么。您应该会得到如下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/949df3cd696c9062af00c609e4d08540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RexwM_DM8GnkuBbLtxClIw.png"/></div></div></figure><p id="91e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有错误，首先检查你的代码是否有不正确的缩进。通常，你必须用四个空格或制表符来缩进代码。此外，检查逻辑缩进，即哪个定义属于每个父声明。</p><p id="2e53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个例子是一个智能契约，它将通过参数传递给类<code class="fe ol om on oc b">myClass</code>的方法<code class="fe ol om on oc b">myEntryPoint</code>的两个数字相加，并将结果放在契约的存储器<code class="fe ol om on oc b">result</code>中。</p><p id="efec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了便于理解和测试，下面是完整的注释代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="ada7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是与SmartPy环境的一次非常简短的初次接触，目的是让您熟悉它。随着我们在未来作品中的进展，我们将致力于更多真实世界的用例。</p><p id="4fd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三部见！别忘了阅读<a class="ae ky" href="https://medium.com/@lmilfont/how-to-write-smart-contracts-for-blockchain-using-python-8f645d485bf7" rel="noopener">第一部</a>！</p></div></div>    
</body>
</html>