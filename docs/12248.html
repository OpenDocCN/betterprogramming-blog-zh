<html>
<head>
<title>Integrate Google Maps With a Rails App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将谷歌地图与Rails应用集成</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/integrate-google-maps-with-a-rails-app-5e5012e8cf16?source=collection_archive---------1-----------------------#2022-05-22">https://betterprogramming.pub/integrate-google-maps-with-a-rails-app-5e5012e8cf16?source=collection_archive---------1-----------------------#2022-05-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="094c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">操作指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cb53dc4292f28d3d3fd4e71b76b84022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DP-AE6GYM3SZsY6Z"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@geojango_maps?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> GeoJango Maps </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="aba2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我最近在我的一个Rails项目中添加了一个特性，允许用户输入一个位置，然后用一个交互式地图返回一个啤酒厂列表。Google Maps API显然是一个受欢迎的选择，但是我惊讶地发现网上并没有很多资源可以将它整合到Rails应用中。为了解决这个问题，让我们来看看如何使用这个指南来制作自定义地图。</p><h2 id="dd4e" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">设置</h2><p id="801f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">首先，让我们设置地图将要去的空间。在视图中，文件为地图创建一个部分。给它一个类似“地图”的简单id。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="1d81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注册<a class="ae kv" href="https://developers.google.com/maps/documentation/javascript" rel="noopener ugc nofollow" target="_blank">谷歌地图JavaScript API </a>。一旦你有了API密匙，就把它放在<code class="fe ms mt mu mv b">.env</code>文件中。确保这个文件是在<code class="fe ms mt mu mv b">.gitignore</code>中声明的，这样你就不会把你的密钥推给Github了！</p><p id="2a6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您需要将每个位置的纬度和经度输入到Google Maps API中。为此我推荐使用<a class="ae kv" href="https://github.com/alexreisner/geocoder" rel="noopener ugc nofollow" target="_blank">地理编码器</a>宝石。</p><p id="075e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它可以将街道地址转换成坐标，然后保存到您的模型中。安装的最后一部分是创建一个JavaScript文件。</p><p id="5827" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果使用轨道6，它应该进入<code class="fe ms mt mu mv b">app/javascript/packs</code>。对于Rails 7，它应该进入的目录是<code class="fe ms mt mu mv b">app/javascript</code>。将文件命名为<code class="fe ms mt mu mv b">map.js</code>。</p><h2 id="b1cc" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">传递坐标</h2><p id="e12a" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">纬度和经度数据需要从我们的Rails页面传递到JavaScript文件，以便在其中创建地图和标记。因为我们正在创建一个根据用户输入而变化的地图，所以我们必须想办法将位置数据发送到我们的JavaScript代码，然后将这些数据发送到Google Maps API来生成地图。为此，在视图页面上显示搜索结果，并为每个带有坐标的项目添加数据标签。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="cb27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">列表中显示的每个啤酒厂在它们的<code class="fe ms mt mu mv b">&lt;li&gt;</code>标签内都有坐标，分别为<code class="fe ms mt mu mv b">data-latitude</code>和<code class="fe ms mt mu mv b">data-longitude</code>。啤酒厂所在城市的坐标在<code class="fe ms mt mu mv b">&lt;div&gt;</code>中，id为“breweries”。</p><p id="6f0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，信息就是DOM的一部分，可以被我们的JavaScript代码访问。</p><h2 id="56a6" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">JavaScript代码</h2><p id="c61f" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在<code class="fe ms mt mu mv b">map.js</code>文件中，我们将有一个创建地图的函数，从页面中获取坐标，并用这些坐标向地图添加标记。地图中心的位置(在这种情况下是一个城市)应该被指定，并由您决定如何获取这些坐标(同样，<a class="ae kv" href="https://github.com/alexreisner/geocoder" rel="noopener ugc nofollow" target="_blank">地理编码器</a>对此很有用)。</p><p id="04c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了简洁起见，我们假设您已经有了这些信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="6e3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该函数将获取城市的坐标，并在创建地图时将其用作中心位置。然后，它将获取每个啤酒厂列表项，并对它们进行迭代，检索它们的坐标，并创建标记放置在地图上，以指定每个啤酒厂的位置。有了这些，我们现在可以在视图中调用Google Maps API了！</p><h2 id="636f" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">创建地图</h2><p id="1dd8" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">现在唯一要做的就是设置我们的视图，以便调用Google Maps API并使用我们的JavaScript代码来构建地图。我们的<code class="fe ms mt mu mv b">map.js</code>文件可以通过Rails助手获得。这取决于您使用的是Rails 6还是Rails 7。</p><p id="4e1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Rails 6: <code class="fe ms mt mu mv b">javascript_pack_tag 'map'</code></p><p id="3a2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">轨道7: <code class="fe ms mt mu mv b">javascript_import_module_tag 'map'</code></p><p id="edf2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将把它放在视图中。对谷歌地图API的调用是使用一个<code class="fe ms mt mu mv b">&lt;script&gt;</code>标签完成的。这也有一个Rails助手:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="6441" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了这两个助手，您的视图应该看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="3dde" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Google Maps API被调用，并将JavaScript函数<code class="fe ms mt mu mv b">initMap</code>作为回调函数，为其提供创建地图和标记所需的信息。注意我们正在使用<code class="fe ms mt mu mv b">defer</code>属性。</p><p id="5275" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我们依赖页面上的数据集来获取坐标，所以我们必须确保在调用函数之前加载DOM内容。在调用API和使用<code class="fe ms mt mu mv b">initMap</code>函数之前，<code class="fe ms mt mu mv b">defer</code>属性会一直等到HTML被组装好。现在地图将被构建并放置在<code class="fe ms mt mu mv b">&lt;div id="map"&gt;</code>中。</p><p id="bc9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，Rails应用程序上有了一个完全动态的地图。希望本指南对您有所帮助。在外面保持安全和健康！</p></div></div>    
</body>
</html>