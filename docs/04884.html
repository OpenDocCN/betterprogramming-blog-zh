<html>
<head>
<title>How to Check the User’s Internet Connection in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中检查用户的互联网连接</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-check-the-users-internet-connection-in-python-224e32d870c8?source=collection_archive---------5-----------------------#2020-05-19">https://betterprogramming.pub/how-to-check-the-users-internet-connection-in-python-224e32d870c8?source=collection_archive---------5-----------------------#2020-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="66a5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">检查互联网连接的4种不同方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bdc8fcf9656764cbfdfc7d2727ba6cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t1AWNj9FsVFoaQYmr5jYnw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">莱昂·塞伯特在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="8922" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读本文，您将学会用Python定义自己的函数来检查互联网连接。如果您正在处理依赖互联网连接的昂贵操作，强烈建议您事先检查互联网连接。</p><p id="44f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们进入下一节，开始编写一些Python代码。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8547" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">履行</h1><p id="f9ac" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这篇文章中，我将提供四种不同的方法来检查互联网连接。它们中的每一个都使用不同的模块，并且有各自的优点和缺点。</p><h2 id="f050" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">' httplib '</h2><p id="a350" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">基于<a class="ae ky" href="https://docs.python.org/2/library/httplib.html" rel="noopener ugc nofollow" target="_blank">官方文件</a> , <code class="fe nl nm nn no b">httplib</code>定义:</p><blockquote class="np nq nr"><p id="3535" class="kz la ns lb b lc ld ju le lf lg jx lh nt lj lk ll nu ln lo lp nv lr ls lt lu im bi translated">“…实现HTTP和HTTPS协议客户端的类。它通常不被直接使用——模块<code class="fe nl nm nn no b">urllib</code>用它来处理使用HTTP和HTTPS的URL。”</p></blockquote><p id="d924" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加以下进口声明。</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="d825" class="mz md it no b gy oa ob l oc od">try:<br/>    import httplib<br/>except:<br/>    import http.client as httplib</span></pre><p id="c03f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义一个接受两个输入参数的函数。为其他方法定义的所有函数都遵循相同的输入参数，只是略有不同。我将使用<code class="fe nl nm nn no b">www.google.com</code>作为默认值。如果您遇到问题，请根据您的偏好将其更改为任何URL。</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="da77" class="mz md it no b gy oa ob l oc od">def checkInternetHttplib(url="www.google.com", timeout=3):</span></pre><p id="27ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于输入参数创建一个<code class="fe nl nm nn no b">HTTPConnection</code>。</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="b95c" class="mz md it no b gy oa ob l oc od">conn = httplib.HTTPConnection(url, timeout=timeout)</span></pre><p id="e869" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请求只获取标题。理论上，与获取所有响应数据的方法相比，它应该快得多。如果成功，返回<code class="fe nl nm nn no b">True</code>；否则返回<code class="fe nl nm nn no b">False</code>。</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="9716" class="mz md it no b gy oa ob l oc od">try:<br/>    conn.request("HEAD", "/")<br/>    conn.close()<br/>    return True<br/>except Exception as e:<br/>    print(e)<br/>    return False</span></pre><p id="75a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="b2e2" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">'插座'</h2><p id="76e7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">基于<a class="ae ky" href="https://docs.python.org/3.8/library/socket.html" rel="noopener ugc nofollow" target="_blank">官方文件</a>,<code class="fe nl nm nn no b">socket</code>模块:</p><blockquote class="np nq nr"><p id="840d" class="kz la ns lb b lc ld ju le lf lg jx lh nt lj lk ll nu ln lo lp nv lr ls lt lu im bi translated">“…提供对BSD <em class="it">插座</em>接口的访问。它可以在所有现代的Unix系统、Windows、MacOS以及其他平台上使用。”</p></blockquote><p id="72de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加以下进口申报:</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="a629" class="mz md it no b gy oa ob l oc od">import socket</span></pre><p id="ff1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用下列输入参数定义一个函数。请注意，我使用了<code class="fe nl nm nn no b">host</code>而不是URL作为第一个参数的名称。还有一个额外的参数叫做<code class="fe nl nm nn no b">port</code>。<code class="fe nl nm nn no b">8.8.8.8</code>是Google ( <code class="fe nl nm nn no b">google-public-dns-a.google.com</code>)的公共DNS，可以通过TCP使用端口<code class="fe nl nm nn no b">53</code>访问。</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="b467" class="mz md it no b gy oa ob l oc od">def checkInternetSocket(host="8.8.8.8", port=53, timeout=3):</span></pre><p id="559a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置默认超时，并使用以下代码建立套接字连接:</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="bfae" class="mz md it no b gy oa ob l oc od">try:<br/>    socket.setdefaulttimeout(timeout)<br/>    socket.socket(socket.AF_INET, socket.SOCK_STREAM).connect((host, port))<br/>    return True<br/>except socket.error as ex:<br/>    print(ex)<br/>    return False</span></pre><p id="3f31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在下面的要点找到完整的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="3ada" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">'请求'</h2><p id="66c7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">基于<a class="ae ky" href="https://2.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">官方文件</a>,<code class="fe nl nm nn no b">requests</code>模块:</p><blockquote class="np nq nr"><p id="67f3" class="kz la ns lb b lc ld ju le lf lg jx lh nt lj lk ll nu ln lo lp nv lr ls lt lu im bi translated">“…是一个优雅而简单的Python HTTP库，为人类而建。它允许您非常容易地发送HTTP/1.1请求。不需要手动添加查询字符串到你的网址，也不需要对你的文章数据进行格式编码。”</p></blockquote><p id="fec0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加以下进口申报:</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="8ee4" class="mz md it no b gy oa ob l oc od">import requests</span></pre><p id="d918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用下列输入参数定义一个函数。</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="6369" class="mz md it no b gy oa ob l oc od">def checkInternetRequests(url='http://www.google.com/', timeout=3):</span></pre><p id="46d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在函数中实现以下代码。为了加快推断时间，我们将使用<code class="fe nl nm nn no b">head</code>而不是通常的<code class="fe nl nm nn no b">get</code>。</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="2891" class="mz md it no b gy oa ob l oc od">try:<br/>    r = requests.head(url, timeout=timeout)<br/>    return True<br/>except requests.ConnectionError as ex:<br/>    print(ex)<br/>    return False</span></pre><p id="7ebd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查以下要点以获得完整的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="4ad8" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">' urllib.request '</h2><p id="5304" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">基于<a class="ae ky" href="https://docs.python.org/3.8/library/urllib.request.html#module-urllib.request" rel="noopener ugc nofollow" target="_blank">官方文件</a>,<code class="fe nl nm nn no b">urllib.request</code>模块:</p><blockquote class="np nq nr"><p id="94ad" class="kz la ns lb b lc ld ju le lf lg jx lh nt lj lk ll nu ln lo lp nv lr ls lt lu im bi translated">“…定义有助于在复杂世界中打开URL(主要是HTTP)的函数和类，包括基本和摘要式身份验证、重定向、cookies等。”</p></blockquote><p id="f20a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">添加以下进口声明。</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="ad92" class="mz md it no b gy oa ob l oc od">import urllib.request</span></pre><p id="12da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义一个接受以下输入参数的函数。</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="d3e8" class="mz md it no b gy oa ob l oc od">def checkInternetUrllib(url='http://google.com', timeout=3):</span></pre><p id="70b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在函数中实现以下代码:</p><pre class="kj kk kl km gt nw no nx ny aw nz bi"><span id="9617" class="mz md it no b gy oa ob l oc od">try:<br/>    urllib.request.urlopen(url, timeout=timeout)<br/>    return True<br/>except Exception as e:<br/>    print(e)<br/>    return False</span></pre><p id="670e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下要点包含完整的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f672" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="edfc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们回顾一下今天所学的内容。</p><p id="8598" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从使用<code class="fe nl nm nn no b">httplib</code>模块检查互联网连接开始。我们只做了一个简单的请求来获取标题，因为这样效率更高。</p><p id="4d75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们尝试使用<code class="fe nl nm nn no b">socket</code>模块实现另一个功能。我们使用Google的公共DNS和端口<code class="fe nl nm nn no b">53</code>作为请求的主机。一般情况下，这个方法在执行时间上应该是最快的。</p><p id="9cc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还测试了名为<code class="fe nl nm nn no b">requests</code>的高级库来发送HTTP1.1请求。如果您使用的是<code class="fe nl nm nn no b">get</code>方法，返回的响应包含所有数据，与<code class="fe nl nm nn no b">httplib</code>相比会慢很多。建议使用<code class="fe nl nm nn no b">head</code>方法来加快推断时间。</p><p id="4595" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们使用<code class="fe nl nm nn no b">urllib.request</code>模块向同一个URL发出一个简单的请求。<code class="fe nl nm nn no b">urrlib.request</code>从属于<code class="fe nl nm nn no b">requests</code>模块。</p><p id="1306" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢你阅读这篇文章。希望在下一篇文章中再见到你！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0055" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><ul class=""><li id="2f28" class="og oh it lb b lc mu lf mv li oi lm oj lq ok lu ol om on oo bi translated"><code class="fe nl nm nn no b"><a class="ae ky" href="https://docs.python.org/3.8/library/urllib.request.html#module-urllib.request" rel="noopener ugc nofollow" target="_blank">urllib.request</a></code> <a class="ae ky" href="https://docs.python.org/3.8/library/urllib.request.html#module-urllib.request" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="fca9" class="og oh it lb b lc op lf oq li or lm os lq ot lu ol om on oo bi translated"><code class="fe nl nm nn no b"><a class="ae ky" href="https://docs.python.org/3.8/library/socket.html" rel="noopener ugc nofollow" target="_blank">socket</a></code> <a class="ae ky" href="https://docs.python.org/3.8/library/socket.html" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="98fe" class="og oh it lb b lc op lf oq li or lm os lq ot lu ol om on oo bi translated"><code class="fe nl nm nn no b"><a class="ae ky" href="https://docs.python.org/2/library/httplib.html" rel="noopener ugc nofollow" target="_blank">httplib</a></code> <a class="ae ky" href="https://docs.python.org/2/library/httplib.html" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="6dc0" class="og oh it lb b lc op lf oq li or lm os lq ot lu ol om on oo bi translated"><code class="fe nl nm nn no b"><a class="ae ky" href="https://2.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">requests</a></code> <a class="ae ky" href="https://2.python-requests.org/en/master/" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="a2ec" class="og oh it lb b lc op lf oq li or lm os lq ot lu ol om on oo bi translated"><a class="ae ky" href="https://stackoverflow.com/questions/3764291/checking-network-connection" rel="noopener ugc nofollow" target="_blank">堆栈溢出的示例代码</a></li></ul></div></div>    
</body>
</html>