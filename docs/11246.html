<html>
<head>
<title>2 Ways to Upload Files to Amazon S3 In Your Spring Boot Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在你的Spring Boot项目中上传文件到亚马逊S3的两种方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/2-ways-to-upload-files-to-amazon-s3-in-your-spring-boot-project-65620411622d?source=collection_archive---------1-----------------------#2022-03-02">https://betterprogramming.pub/2-ways-to-upload-files-to-amazon-s3-in-your-spring-boot-project-65620411622d?source=collection_archive---------1-----------------------#2022-03-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ec0c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Rest APIs和使用预签名的URL</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/26682794fa72ce1308a06e03641fd7e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_MQKEODUfexknweyvrHomA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@numericcitizen?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">JF·马丁</a>在<a class="ae kv" href="https://unsplash.com/s/photos/file?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ae6f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您的项目必须处理文件，那么您将需要存储这些文件的存储空间。我想到的最佳解决方案是s3。<strong class="ky ir">亚马逊S3 </strong>是AWS提供的一项服务。在存储文件方面，S3是一个高度可扩展和可靠的解决方案。</p><p id="cc79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向您展示如何在您的项目中将文件上传到s3。我假设您的spring boot项目是一个微服务，它已经向您的前端公开了API。</p><p id="a091" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们想要上传文件时，有两种方法可以做到:</p><ul class=""><li id="5be2" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">第一种方式是前端通过REST API将文件传递给你的服务器，然后你调用s3 SDK上传文件并将结果返回给前端。</li><li id="5cb3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">第二种方式是所谓的<em class="mg">预签名URL。</em>预签名<em class="mg"/>URL是具有<em class="mg">有限权限和到期</em>的URL。任何客户端都可以使用该URL将文件直接放入s3，而无需担心AWS访问密钥和密码。</li></ul><p id="99be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您看到，在第一个选项中，文件将转到您的服务器，然后再次从您的服务器转到s3。这将增加延迟，因为文件的数据传输会发生两次，因此不建议使用第一个选项。第二个选项是我们上传文件的最佳选择。</p><p id="915b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看我们能做些什么。</p><ul class=""><li id="68b3" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">首先，我们将创建一个REST API，我们的前端将调用它，我们将创建一个具有有限权限的预签名URL，并返回到前端。</li><li id="7b9d" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">前端会直接把文件上传到s3。</li></ul><p id="1169" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们将SDK依赖添加到我们的<code class="fe mh mi mj mk b">pom.xml</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="34d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个新的配置类<code class="fe mh mi mj mk b">awsS3Config.java</code>，我们将在其中为s3创建一个bean。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="b5f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保您已经将<code class="fe mh mi mj mk b">access-key and secret-key</code>添加到您的<code class="fe mh mi mj mk b">application.yml</code>文件中</p><p id="77ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们创建一个服务，它将为s3操作与AWS通信。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="bd02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的类中，我们有<code class="fe mh mi mj mk b">generatePreSignedUrl</code>，它接受下面的参数。</p><p id="9276" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mh mi mj mk b">filePath</code>:这是您想要上传文件的s3的对象键。</p><p id="30a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mh mi mj mk b">bucketName</code>:这是s3存储桶的名称。</p><p id="805a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mh mi mj mk b">httpMethod</code>:这是您的预签名URL允许的HTTP方法。这里我们想要上传文件，所以我们将在这里传递<code class="fe mh mi mj mk b">HttpMethod.PUT</code>。</p><p id="49bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们在控制器中创建一个REST API端点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="13a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个API将返回一个预先签名的URL，有效期为10分钟，并且只接受<code class="fe mh mi mj mk b">PUT</code>方法直接从前端上传文件。</p><blockquote class="mn mo mp"><p id="3fa2" class="kw kx mg ky b kz la jr lb lc ld ju le mq lg lh li mr lk ll lm ms lo lp lq lr ij bi translated">跟着我上<a class="ae kv" href="https://www.instagram.com/manoj_ahi/" rel="noopener ugc nofollow" target="_blank"> Meta </a></p></blockquote></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="45b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">干杯！！</p></div></div>    
</body>
</html>