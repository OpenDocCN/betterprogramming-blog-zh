<html>
<head>
<title>An Introduction to Cross-Origin Resource Sharing (CORS)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跨来源资源共享介绍(CORS)</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/introduction-to-cross-origin-resource-sharing-cors-b5dc1d7de47a?source=collection_archive---------7-----------------------#2020-10-20">https://betterprogramming.pub/introduction-to-cross-origin-resource-sharing-cors-b5dc1d7de47a?source=collection_archive---------7-----------------------#2020-10-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="111b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">CORS为初学者解释道</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/54224e8d547e6bf2a7e2c0f4f7084f8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I0QD8Q9zJVjQtZHvLOGHaw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片来自<a class="ae ky" href="http://haproxy.com/" rel="noopener ugc nofollow" target="_blank">haproxy.com</a>。</p></figure><p id="201d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在web开发中，web应用程序将其前端服务与后端服务分离是很常见的。因此，从后端访问资源需要掌握跨源资源共享(CORS)。这是开发人员理解web基础设施的重要部分。</p><p id="63e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将讨论CORS，为什么我们需要它，以及我们如何实现它。我们还将看看相关的概念，如同源策略。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eed9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">首先，一个实验</h1><p id="4bab" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果你在一个网站上(例如Google ),然后在你的浏览器检查器上，试着像这样发送一个请求给一个API:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c235" class="ne md it na b gy nf ng l nh ni">const response = await fetch("https://tea-api-vic-lo.herokuapp.com/tea);</span></pre><p id="2598" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你认为会发生什么？</p><p id="221b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">控制台将返回以下错误消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/d26c9db395fb13e5d3b1c5407a9b3ae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/0*3a5HBiB4mdKXaiux"/></div></figure><p id="cf13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么会这样呢？答案是因为同源政策。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7f75" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">同源政策</h1><p id="e56c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">浏览器遵循一个安全策略。它被称为同源策略，基本上是说只有来自相同域、主机和端口的资源才能相互交互。</p><p id="8485" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，<code class="fe nk nl nm na b">example.com</code>可以从位于<a class="ae ky" href="http://example.com/" rel="noopener ugc nofollow" target="_blank">example.com</a>的服务器中检索数据，因为它们共享同一个域。它的任何子域也将是可访问的(即<code class="fe nk nl nm na b">example.com/page1</code>或<code class="fe nk nl nm na b">example.com/page1/page2</code>)。</p><p id="cf4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，由于这个安全策略，<code class="fe nk nl nm na b">example.com</code>将无法访问来自<code class="fe nk nl nm na b">api.example.com</code>或<code class="fe nk nl nm na b">google.ca</code>等域的资源。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/adbc345833309a8cd81ac845af75b4e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f5-h5Yz41XCWYL1g"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片来自<a class="ae ky" href="http://haproxy.com/" rel="noopener ugc nofollow" target="_blank">haproxy.com</a>。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="98e7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">同源政策的重要性</h1><p id="86fe" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可能已经猜到，这个策略是出于安全目的而制定的。想象一下，如果没有这种限制。恶意站点可以简单地从任何站点获取任何数据，从而导致跨站点请求伪造(CSRF)攻击。</p><p id="eb35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，这个策略可能过于严格，因为一些web应用程序可能需要从几个不同的服务器获取资源。这就是CORS的用武之地。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="33c5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">CORS是什么？</h1><p id="8f9c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">顾名思义，它使网站能够从不共享其域、主机或端口的服务器访问资源。白名单网站通常在<code class="fe nk nl nm na b">Access-Control-Allow-Origin</code>请求头中传递，这将告诉服务器可以向该网站发送和共享其数据。</p><p id="f813" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我们将<code class="fe nk nl nm na b">Access-Control-Allow-Origin</code>设置为<code class="fe nk nl nm na b">example.com</code>，就意味着这个网站现在可以访问<code class="fe nk nl nm na b">api.example.com</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/13c9a0f25e2f3927fe79dcfe3e132ebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s2dYYy1jCIJP_W27"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片来自<a class="ae ky" href="http://haproxy.com/" rel="noopener ugc nofollow" target="_blank">haproxy.com</a>。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4a59" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">一个例子</h1><p id="8b87" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我的<a class="ae ky" href="https://victoria-lo.github.io/Hashtag-TEA/" rel="noopener ugc nofollow" target="_blank"> Tea应用</a>，它从我的<a class="ae ky" href="https://tea-api-vic-lo.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> Tea API </a>中获取数据，需要加入白名单，以便允许应用访问API的数据。让我们实现一个CORS中间件来实现这一点。</p><h2 id="8d7d" class="ne md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">步骤1:安装cors</h2><p id="f4e1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们首先安装名为<a class="ae ky" href="https://www.npmjs.com/package/cors" rel="noopener ugc nofollow" target="_blank"> cors </a>的npm包:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a0cd" class="ne md it na b gy nf ng l nh ni">npm install cors</span></pre><h2 id="dd96" class="ne md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">第二步:导入</h2><p id="0037" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在<code class="fe nk nl nm na b">server.js</code>文件中，我们导入<code class="fe nk nl nm na b">cors</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ccbf" class="ne md it na b gy nf ng l nh ni">const cors = require("cors");</span></pre><h2 id="79ba" class="ne md it bd me no np dn mi nq nr dp mm li ns nt mo lm nu nv mq lq nw nx ms ny bi translated">第三步:白名单</h2><p id="78fa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">然后在app初始化的<code class="fe nk nl nm na b">const app = express()</code>行下面，添加:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="878f" class="ne md it na b gy nf ng l nh ni">app.use(cors({ origin: /(.*\.)?victoria-lo.github\.io.*/ }));</span></pre><p id="a160" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一行基本上告诉API，任何带有<code class="fe nk nl nm na b">victoria-lo.github.io</code>的域都被列入了同源策略的白名单。因此，我托管在<code class="fe nk nl nm na b">victoria-lo.github.io/Hashtag-TEA</code>的应用程序被允许从我的API获取和加载数据，这是在一个完全不同的域(<code class="fe nk nl nm na b">tea-api-vic-lo.herokuapp.com/</code>)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="675f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="5547" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这就是CORS的精髓所在！感谢阅读。请在下面的评论中留下你的赞并分享你的想法。我希望这是一个有益的阅读。在下一节中，您可以随意阅读我们今天讨论的更多内容。</p><p id="0ecf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">干杯！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="53ce" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">请参见</h1><ul class=""><li id="11fe" class="nz oa it lb b lc mu lf mv li ob lm oc lq od lu oe of og oh bi translated"><a class="ae ky" href="https://owasp.org/www-community/attacks/csrf" rel="noopener ugc nofollow" target="_blank">关于跨站请求伪造</a></li><li id="17ef" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://www.npmjs.com/package/cors" rel="noopener ugc nofollow" target="_blank"> npm cors文件</a></li><li id="1ad8" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank">MDN文档中关于CORS的更多信息</a></li></ul></div></div>    
</body>
</html>