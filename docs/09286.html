<html>
<head>
<title>Why the New Firebase Web v9 Modular SDK is a Game-Changer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么新的Firebase Web v9模块化SDK是游戏规则的改变者</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/working-with-the-new-firebase-web-v9-modular-sdk-aad1c641640e?source=collection_archive---------2-----------------------#2021-08-06">https://betterprogramming.pub/working-with-the-new-firebase-web-v9-modular-sdk-aad1c641640e?source=collection_archive---------2-----------------------#2021-08-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="3d9f" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">Firebase的未来就在这里</h2><div class=""/><div class=""><h2 id="c40c" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">减少基于Firebase的web应用程序不必要的膨胀</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/29d55cb79883b926163e6870b3d7c61a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4lS_m1cH7m5r2ufOvY2FZA.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者的形象设计；根据<a class="ae le" href="https://firebase.google.com/brand-guidelines" rel="noopener ugc nofollow" target="_blank"> Firebase品牌指南</a>使用Firebase标志</p></figure><p id="7e2f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Firebase是现代技术堆栈中最受欢迎的后端即服务选项之一。除了提供名为Firestore的NoSQL数据库解决方案，Firebase平台还提供身份验证、文件存储、托管和分析解决方案。Firebase SDK可用于许多平台，包括mobile、Unity、Java、C++和web。</p><p id="0abc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然而，Firebase在网络上的一个主要缺点是其庞大的规模。</p><p id="2800" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">根据<a class="ae le" href="https://bundlephobia.com/" rel="noopener ugc nofollow" target="_blank"> BundlePhobia </a>，一个用于确定NPM包大小的工具，firebase Web Javascript包<a class="ae le" href="https://bundlephobia.com/package/firebase@8.9.0" rel="noopener ugc nofollow" target="_blank">在缩小&amp; g-zipped </a>后重达235.5kB。</p><p id="08e2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">对于一些网络连接较慢的用户来说，这可能会导致额外的0.59秒的加载时间。作为比较，<code class="fe mb mc md me b">lodash</code>是另一个众所周知的沉重的NPM包，然而当缩小后&amp; g-zipped 它只有<a class="ae le" href="https://bundlephobia.com/package/lodash@4.17.21" rel="noopener ugc nofollow" target="_blank">24.5 kb重:是Firebase的十分之一。</a></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mf"><img src="../Images/2fe06db534f0ca1a90315e9bfdf159e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8pEl4vbdjzQgbjZfAt50Og.png"/></div></div><p class="la lb gj gh gi lc ld bd b be z dk translated">作者截屏</p></figure><p id="8f33" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这是Firebase Web Javascript SDK的一个已知问题，已经让许多开发人员远离该产品。特别是对于为可能无法访问快速互联网连接的最终用户构建产品的开发人员来说，加载像Firebase这样大的软件包根本不是他们的选择。</p><p id="45c0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">令人欣慰的是，Firebase团队一直在努力工作，从头开始重新创建Firebase Web SDK。2021年7月27日，Firebase官方博客账号<a class="ae le" href="https://firebase.googleblog.com/2021/07/introducing-the-new-firebase-js-sdk.html" rel="noopener ugc nofollow" target="_blank">宣布了一个新的模块化Javascript SDK </a>的预发布，它可以“缩小80%！”</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="d808" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Firebase Web v9将彻底改变Web开发人员使用Firebase的方式。随着全面改进的模块化函数式编程风格的引入，以及Firestore“lite”库的加入，Firebase web v9支持的Web应用程序将运行得更快、加载速度更快，并显著增强用户和开发人员的体验。</p><p id="ec83" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">说了这么多，让我们看看这个新的模块化Firebase Web SDK中引入的一些根本变化。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="dc9c" class="mp mq iq bd mr ms mt mu mv mw mx my mz kf na kg nb ki nc kj nd kl ne km nf ng bi translated"><strong class="ak">无副作用进口</strong></h1><p id="8922" class="pw-post-body-paragraph lf lg iq lh b li nh ka lk ll ni kd ln lo nj lq lr ls nk lu lv lw nl ly lz ma ij bi translated">之前，Firebase Javascript SDK整合了所谓的<em class="nm">副作用导入</em>。简而言之，当一个函数在其提供的范围之外修改状态时，就会产生副作用。</p><p id="2edf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">例如，如果函数<code class="fe mb mc md me b">a</code>要修改一个全局变量<code class="fe mb mc md me b">x</code>，那么函数<code class="fe mb mc md me b">a</code>就会产生副作用。</p><p id="72fb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">副作用<em class="nm">导入</em>影响程序的状态、逻辑或功能，而不调用任何方法或引用任何从包中导出的变量。仅仅是程序中存在的包(通过import语句或require调用)就可以影响程序的功能。</p><p id="812a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">旧的Firebase Web SDK严重依赖于副作用导入。对于您希望包含在应用中的每个附加Firebase功能(身份验证、Firestore、云存储、分析等)。)，您必须像这样导入一个额外的包:</p><pre class="kp kq kr ks gt nn me no np aw nq bi"><span id="f2b1" class="nr mq iq me b gy ns nt l nu nv">// main firebase app import<br/>import app from "firebase/app";</span><span id="e954" class="nr mq iq me b gy nw nt l nu nv">// SIDE EFFECT PACKAGES<br/>import "firebase/auth";<br/>import "firebase/firestore";<br/>import "firebase/storage";</span></pre><p id="0aaa" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果您有使用旧的Firebase Web SDK的经验，您可能已经为导入Firebase包引入了延迟加载。</p><p id="b3c3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这种解决方案可以减少web应用程序的初始加载大小和时间，但是用户仍然不得不等待所有这些包的加载，然后应用程序才能完全发挥作用。</p><p id="cf16" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Firebase Web v9改变了这一切。副作用包的概念在新的Firebase Web SDK中是不存在的，所有的包都是完全可动摇的。</p><p id="1d4d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这意味着只有你的应用程序需要的Firebase部分会被导入到客户端。这极大地减少了你的应用程序的最终包的大小，并将导致更快的加载时间。</p><h1 id="e6fb" class="mp mq iq bd mr ms nx mu mv mw ny my mz kf nz kg nb ki oa kj nd kl ob km nf ng bi translated"><strong class="ak">原生Javascript ES模块</strong></h1><p id="ef2c" class="pw-post-body-paragraph lf lg iq lh b li nh ka lk ll ni kd ln lo nj lq lr ls nk lu lv lw nl ly lz ma ij bi translated">在新的Firebase Web SDK中，由于模块化包的引入，您的应用程序所需的Firebase的每个独立功能都是单独导入的。</p><p id="f604" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">因为新的SDK内置于本地Javascript ES模块中，所以您可以直接只导入您的程序需要的特性:不多也不少。例如，假设您想要初始化Firebase应用程序，然后观察验证更改:</p><pre class="kp kq kr ks gt nn me no np aw nq bi"><span id="62e3" class="nr mq iq me b gy ns nt l nu nv">// imports with ES modules<br/>import { initializeApp } from “firebase/app”;<br/>import { getAuth, onAuthStateChanged } from “firebase/auth”;</span><span id="0098" class="nr mq iq me b gy nw nt l nu nv">// initialize firebase app<br/>initializeApp(firebaseConfig);</span><span id="b642" class="nr mq iq me b gy nw nt l nu nv">// watch for auth changes<br/>const auth = getAuth();<br/>onAuthStateChanged(auth, (user) =&gt; {<br/>  // deal with authentication changes<br/>});</span></pre><p id="e91b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在使用Firebase Web SDK时，模块化包的引入反过来又导致了更具功能性的编程风格的引入。</p><h1 id="1c46" class="mp mq iq bd mr ms nx mu mv mw ny my mz kf nz kg nb ki oa kj nd kl ob km nf ng bi translated"><strong class="ak">函数式编程风格</strong></h1><p id="1a96" class="pw-post-body-paragraph lf lg iq lh b li nh ka lk ll ni kd ln lo nj lq lr ls nk lu lv lw nl ly lz ma ij bi translated">如果您曾经使用过函数式编程语言或库，那么作为开发人员，您会对函数式编程的优势非常熟悉。</p><p id="4b3e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">遵循函数式编程风格的程序通常具有非常直观和非常易于测试的优点。虽然旧的Firebase Web SDK很难理解，但新的Firebase Web SDK同样直观或对初学者友好。</p><p id="c452" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了演示新的模块化Firebase包引入的函数式编程风格，让我们看一个在Firestore中更新文档的例子:</p><pre class="kp kq kr ks gt nn me no np aw nq bi"><span id="8b67" class="nr mq iq me b gy ns nt l nu nv">import { getStorage, ref, uploadBytes } from “firebase/storage”;</span><span id="13cc" class="nr mq iq me b gy nw nt l nu nv">// first, get a reference to the storage bucket for our app<br/>const storage = getStorage();</span><span id="0020" class="nr mq iq me b gy nw nt l nu nv">// then, make a reference to the file<br/>const usersCollection = ref(storage, “files/example.png”);</span><span id="cfab" class="nr mq iq me b gy nw nt l nu nv">// finally, upload the file to the reference<br/>uploadBytes(usersCollection, file);</span></pre><p id="b196" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">正如您所看到的，在这个代码示例中有许多函数嵌套——一个函数的结果作为参数传递给另一个函数的<em class="nm">,后者的结果传递给另一个</em>函数的<em class="nm">参数，依此类推。这与旧的Firebase Web SDK使用的方法链接方法形成了鲜明的对比。</em></p><p id="2b88" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">总而言之，新的Firebase SDK函数式语言(如F#或Scala(或函数式库，如Ramda和RxJS))使用的代码，而旧的Firebase Web SDK使用的代码类似于Java或C++。</p><h1 id="6445" class="mp mq iq bd mr ms nx mu mv mw ny my mz kf nz kg nb ki oa kj nd kl ob km nf ng bi translated"><strong class="ak"> Firestore Lite </strong></h1><p id="cfc7" class="pw-post-body-paragraph lf lg iq lh b li nh ka lk ll ni kd ln lo nj lq lr ls nk lu lv lw nl ly lz ma ij bi translated">Firestore是一个非常强大和有用的数据库服务。它提供了许多功能，其中许多功能实际上并没有被所有使用Firestore的网络应用程序所利用。</p><p id="331e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">许多开发人员只是将Firestore作为一个易于实现的NoSQL数据库，它可以处理在客户端和服务器端操作数据库的许多复杂问题。</p><p id="d50c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这种程度上，许多web应用程序不需要Firestore的实时更新功能，他们只需要访问一次性的文档和集合查询。</p><p id="4203" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Firebase团队认识到了这个有效的用例，并通过引入新的库Firestore Lite解决了这个问题。</p><p id="c3a8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Firestore Lite库比旧的Firestore v8库轻80%。除了实时更新之外，Firestore Lite库中还提供了您喜爱并充分利用的所有Firestore功能。</p><p id="bbf1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这对于Firebase Web社区来说是一个巨大的胜利，因为您的应用程序现在可以更高的性能和更少的无用代码！</p><h1 id="79d6" class="mp mq iq bd mr ms nx mu mv mw ny my mz kf nz kg nb ki oa kj nd kl ob km nf ng bi translated"><strong class="ak">兼容性</strong></h1><p id="6410" class="pw-post-body-paragraph lf lg iq lh b li nh ka lk ll ni kd ln lo nj lq lr ls nk lu lv lw nl ly lz ma ij bi translated">新的Firebase Web v9 SDK使得从v8 SDK逐步升级变得容易。firebase包提供了一个<code class="fe mb mc md me b">compat</code>库，使得从v8到v9的迁移变得简单和渐进。对于您的代码库中所有不准备完全切换到Firebase Web v9的地方，您可以利用<code class="fe mb mc md me b">compat</code>库并逐步升级部分代码库，直到您不再需要使用<code class="fe mb mc md me b">compat</code>库功能。</p><p id="9f64" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这样做的主要缺点是，在使用<code class="fe mb mc md me b">compat</code>库时，您不会体验到新的v9 SDK的所有膨胀和减少加载时间的特性。<code class="fe mb mc md me b">compat</code>库仍然依赖于副作用导入，所以你必须像处理Firebase Web v8 SDK一样处理这些副作用。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="1e49" class="mp mq iq bd mr ms mt mu mv mw mx my mz kf na kg nb ki nc kj nd kl ne km nf ng bi translated"><strong class="ak">结论</strong></h1><p id="db5c" class="pw-post-body-paragraph lf lg iq lh b li nh ka lk ll ni kd ln lo nj lq lr ls nk lu lv lw nl ly lz ma ij bi translated">如果你曾经在网络上使用过Firebase，Firebase的未来应该会让你兴奋不已。</p><p id="7da1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这个新的模块化Firebase Web v9 SDK的引入改变了在Web上使用Firebase开发的一切。</p><p id="6b3e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从使您的应用程序不那么臃肿到改善开发人员和最终用户的体验，新的Firebase Web v9模块化SDK消除了使用Firebase的最大缺点之一，并将彻底改变基于Firebase的Web应用程序的未来。</p><p id="1edb" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>