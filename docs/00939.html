<html>
<head>
<title>I Wrote a Script That Finally Got Rid of My Duplicate Last.fm Scrobbles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我写了一个脚本，最终摆脱了我的重复Last.fm Scrobbles</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/i-wrote-a-web-script-that-finally-got-rid-of-my-duplicate-last-fm-scrobbles-b505d858fcd4?source=collection_archive---------4-----------------------#2019-07-30">https://betterprogramming.pub/i-wrote-a-web-script-that-finally-got-rid-of-my-duplicate-last-fm-scrobbles-b505d858fcd4?source=collection_archive---------4-----------------------#2019-07-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="efd6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">清除我青少年时期的一些不良数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2960cde25ec870410e6a068c43173aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vqs5gio1RI3s4-iZC_CnAw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="https://unsplash.com/search/photos/pop-music?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="e5d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从2008年6月开始，我就是Last.fm的忠实用户，大约有11年了。Last.fm是一个跟踪或“搜索”你听的任何歌曲的网站，并制作你的活动的可视化图表。你可以看到你有史以来最常听的歌曲是什么，一天中什么时候你最常听音乐，以及许多其他关于你听音乐习惯的信息。</p><p id="d433" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大约从2013年开始，到2014年结束，我注意到每当我把iPod插入电脑时，Last.fm应用程序都会多次搜索同一首带有相同时间戳的歌曲。我指的不仅仅是一两个副本——有时会多达五十个副本。</p><p id="270f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我经常scrobbble，它似乎不值得回去手动删除每一个重复的，所以我只是离开它，偷偷地享受我每天得到的数百个额外的scrobbble。</p><p id="1772" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直到今天，我已经不再是17岁了，不知何故，拉娜·德尔·雷仍然是我一直以来最喜欢的艺术家。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/3891509858e8b4a028023f3d3baa9165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aDDEkpPvfoOvKGwSjDNFXQ.png"/></div></div></figure><p id="e38f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经花了几年时间不听拉娜·德尔·雷的音乐，不知何故，她对其他任何艺术家的优势都是如此之大，以至于再过几年她就会被挤下，而我真正喜欢的艺术家都会进入前五名。</p><p id="26f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在看了我每首歌的剧本后，我发现有很多我最初认为的复制品，每首歌可能有数百个。我开始手动删除所有的重复项，直到我的同学问我为什么不写一些代码来自动删除重复项。</p><p id="8cbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，在过去的三天里，我一直在努力做到这一点！</p><p id="d148" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经花了很多时间手动删除一些重复的scrobbles并测试我的代码，但一周前我为拉娜·德尔·雷写的剧本数量约为5500部。以下是一些重复的例子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/7020255e928cd674b63b60e37dfbd597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfjo1ukBaspzood5GKcaMA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不知道Last.fm怎么没有自动过滤掉这些！</p></figure><p id="302b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为网站上有如此多的元素，我花了很长时间才弄清楚我必须选择哪些元素来检索我想要的信息。</p><p id="2638" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它的大部分被嵌套和隐藏在大量的HTML中，但是一旦我弄清楚我需要点击什么，这只是一个如何比较时间戳的问题，然后当时间戳不再重复时，重置我正在比较的时间戳。这导致了许多令人费解的代码和一个不幸的事件，我不小心删除了<em class="lx">页面上所有的</em>滚动条，无论是否重复:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/2076bd05188dd87166fbf94faf7178d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QWm4GphE2Z6dTAojAGWEoA.gif"/></div></div></figure><p id="58a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题源于我使用了<code class="fe lz ma mb mc b">forEach</code>而不是<code class="fe lz ma mb mc b">for</code>循环。<code class="fe lz ma mb mc b">for</code>循环将允许我使用一个我已经访问过的变量来比较索引，而不是试图想出一些复杂的方法来保存当前的变量并进行搜索。</p><p id="dfab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我找到了一次比较两个scrobble的最简单方法，我就通过打印true或false来查看我的比较是否有效，如果scrobble是重复的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi md"><img src="../Images/97bb1c598eb8b538a2601f355cf85d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZGd7pLRIDMlq0s0S_T47w.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">那只是一页！</p></figure><p id="e073" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要删除一个scrobble，你实际上必须点击两次——一次是打开歌曲名称旁边的下拉菜单，另一次是实际删除。这意味着我必须让我的脚本模拟两次点击，并将dropdown元素和delete button元素保存到两个变量中。</p><p id="74b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我的最终代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi me"><img src="../Images/e48f931ceca3ffdd6665e6b35a96e258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ZfRo1fJCtyQEa98tBCD7g.png"/></div></div></figure><p id="887f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是它的实际应用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/07ed70aa9573cf871ea74a4cf0ae11f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1wq9aM21q5MG0ZyucToFew.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">已删除的将变灰。</p></figure><p id="d739" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我在模拟delete button元素上的单击事件，所以如果您刷新页面，您将看到重复项实际上已被删除:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/56fd3ab4c89af2b2dbd29179a34153f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vTbeUHRTaaSDl4uX5gfa1Q.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">不错！</p></figure><p id="e866" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我又这样做了大约三次，这个数字下降到67个金币。</p><p id="73ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我对所有我知道有重复滚动条的歌曲都这样做了，虽然我每次都必须刷新页面，手动点击导航到一首新歌，但这为我节省了大量的时间。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/4716004fdc9907ea0a41437123634219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GNmLY6zXp-6FOM-2FtL9Rg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我发现保留console.log很有用，因为我喜欢看到一个页面上有多少副本。</p></figure><p id="a020" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">辨别哪些歌曲有重复的最简单方法之一是查看Last.fm根据您的歌曲历史生成的图表。每首歌都有自己的图表，详细记录你听这首歌的频率。这是我删除重复项之前的一个图表的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mf"><img src="../Images/d57ff79d00eb2aa0302cab1f05d8f510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dQP28fgrEkXPFHAP6rkOw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">非常极端。</p></figure><p id="e008" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，这首歌的播放量在2013年增加了两倍，然后在2014年大幅下降。下面是我删除重复项后的图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mg"><img src="../Images/3556a7be83f376f8c56b6e11a550610f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mIkAZMcMgWPQmPt8eTn3JQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">更有道理！</p></figure><p id="82f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于一首歌来说，这似乎是一个更合乎逻辑的发展——当它对你来说是新的时候，你听得最多，然后它会随着时间的推移而逐渐减少。</p><p id="89d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我也很惊讶这能如此迅速地改变我主页上的统计数据。在检查了大多数拉娜·德尔·雷歌曲的重复版本后，她排名第七。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mh"><img src="../Images/c8f30066720c59a140c1b811ab664566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f64pdxqVS0Jsbcg1BpHkrA.png"/></div></div></figure><p id="f1be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，我不得不删除我在2013年和2014年听过的几乎所有艺术家的重复作品，这意味着我的许多艺术家将被淘汰。截至目前，我的前五名是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/3c75d32ccddd4cf582fbc98cfe418e58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p9A4xik3T37sOsw20g54OA.png"/></div></div></figure><p id="03ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拉娜·德尔·雷再次出现在我的前五名中，这是公平的，因为我实际上<em class="lx">的确</em>听了她很多。劳拉·马林、玛丽娜和钻石乐队的唱片销量下降了很多，这很合理，因为我已经很多年没听过他们的歌了。仍然有一堆艺术家我需要修复，但我很高兴我不再需要全部手工完成！</p><p id="7f99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有人想在他们的浏览器控制台中试用我的代码，这里是我的代码:</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="2632" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">const</strong>LanaDelArray<strong class="lb iu">=</strong>document . query select all(<em class="lx">)。图表列表-行"</em>)</p><p id="d503" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">为</strong>(I<strong class="lb iu">=</strong>0；I<strong class="lb iu">&lt;</strong>lanadelarray . length；i <strong class="lb iu"> ++ </strong> ) {</p><p id="f14b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">let</strong>menu button<strong class="lb iu">=</strong>LanaDelArray[I<strong class="lb iu">+</strong>1】。querySelector( <em class="lx">)。图表列表-更多-按钮"</em>)</p><p id="5dd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">let</strong>delete button<strong class="lb iu">=</strong>LanaDelArray[I<strong class="lb iu">+</strong>1]。querySelector( <em class="lx">)。更多项目—删除“</em>)</p><p id="5219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">让</strong>当前<strong class="lb iu"> = </strong> LanaDelArray[i]。querySelector( <em class="lx">)。图表列表-时间戳"</em>)。内部文本</p><p id="6004" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">让</strong>下一个<strong class="lb iu">=</strong>LanaDelArray[I<strong class="lb iu">+</strong>1]。querySelector( <em class="lx">)。图表列表-时间戳"</em>)。内部文本</p><p id="ab32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">如果</strong>(当前<strong class="lb iu"> === </strong>下一个){</p><p id="9795" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">console.log( <em class="lx">“真”</em>)</p><p id="45dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">menu button . click()；</p><p id="293f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">deleteButton.click()</p><p id="a680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">}</p><p id="2c6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">其他</strong> {</p><p id="8821" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">console.log( <em class="lx"> "false" </em>)</p><p id="ba34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">}</p><p id="8c76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">}</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="1ee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保每次运行代码时都刷新页面(导航到下一页不算)！</p><p id="05ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，我发现这一点很有趣，所以我很高兴在我开始学习编码之前没有删除所有重复的内容！我期待着在未来使用更多的web脚本，以解决可能出现的任何其他无关紧要的问题。</p></div></div>    
</body>
</html>