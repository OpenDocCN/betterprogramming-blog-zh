<html>
<head>
<title>5 Ways To Run a Shell Script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">运行Shell脚本的5种方法</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-ways-to-run-a-shell-script-7829fc80b49c?source=collection_archive---------9-----------------------#2021-06-23">https://betterprogramming.pub/5-ways-to-run-a-shell-script-7829fc80b49c?source=collection_archive---------9-----------------------#2021-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b811" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你用了多少？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/20ba2a3caa7285ec07ba460f90c0fa6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TWn3xkk5ukQX56Q_roAdQw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@cbben?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Troy陈</a>在<a class="ae ky" href="/s/photos/keyboard?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="b939" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编写有效的shell脚本的能力是任何程序员工具箱中的必备工具，因为它使一切变得更加容易。</p><p id="a806" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也是蛮上瘾的。一旦你掌握了窍门，你就开始让你生活中越来越多的部分自动化，直到你成为这个人。</p><p id="4d07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在本文中，我们不会编写shell脚本。相反，我们将看看五种最常见的执行方式。我说的最常用是指我或我认识的人最常使用的。如果你知道任何其他巧妙的方法或技巧，一定要写在评论里。我的默认shell是<a class="ae ky" href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)" rel="noopener ugc nofollow" target="_blank"> bash </a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1208" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.从文件运行</h1><p id="9ded" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是执行脚本最简单也是最常见的方式。您只需编写脚本，然后通过在命令行中键入其名称来运行它。</p><p id="c2d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了能够做到这一点，存储脚本的文件夹必须能够被系统发现，因此您必须将它添加到<code class="fe mz na nb nc b"><a class="ae ky" href="https://en.wikipedia.org/wiki/PATH_(variable)" rel="noopener ugc nofollow" target="_blank">$PATH</a></code>变量中。按照惯例，这个文件夹叫做<code class="fe mz na nb nc b">bin</code>。你可以这样把它添加到<code class="fe mz na nb nc b">$PATH</code>:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="f83b" class="nh md it nc b gy ni nj l nk nl">export PATH="$HOME/bin:$PATH"</span></pre><p id="aca2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您想将脚本存储在其他文件夹中，该怎么办呢？没必要担心。您可以轻松地在脚本和bin文件夹之间创建一个符号链接，这样无论它存储在哪里都可以被发现。假设你在一个不是<code class="fe mz na nb nc b">bin</code>的文件夹中，你想把你的脚本<code class="fe mz na nb nc b">cool_script</code>保存在那里。您可以使用以下命令:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="30f2" class="nh md it nc b gy ni nj l nk nl">ln -s cool_script ~/bin/cool_script</span></pre><p id="7da1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一件重要的事情是使用以下命令向脚本添加可执行权限:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="ef3d" class="nh md it nc b gy ni nj l nk nl">chmod u+x cool_script</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="377d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.用指定的解释器运行</h1><p id="b833" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这种方法非常简单。这甚至不需要您在脚本开始时设置一个shebang。或者，如果您设置了shebang并指定了其他解释器，它将与shebang无关地运行。</p><p id="1c03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的根目录中有一个名为<code class="fe mz na nb nc b">simple.sh</code>的脚本，您可以通过以下方式用bash运行它:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="765e" class="nh md it nc b gy ni nj l nk nl">bash ~/simple.sh</span></pre><p id="0ad0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者如果你喜欢<code class="fe mz na nb nc b">zsh</code>:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="791f" class="nh md it nc b gy ni nj l nk nl">zsh ~/simple.sh</span></pre><p id="e86e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我更喜欢第一种方法，但是在某些情况下你也需要这样做。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0a69" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.在后台运行nohup命令</h1><p id="28a1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设您<code class="fe mz na nb nc b">ssh</code>进入一个远程服务器做一些工作，并启动一些长时间运行的进程。如果您现在中止连接，作业将被终止，工作将永远无法完成。这就是<code class="fe mz na nb nc b">nohup</code>命令非常有用的地方。</p><p id="78f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当与远程终端的连接挂断时，操作系统向所有从该终端启动的程序发送<code class="fe mz na nb nc b">SIGHUP</code>消息。然后，程序要么立即停止执行，要么被构建来捕获<code class="fe mz na nb nc b">SIGHUP</code>消息并继续运行，或者在退出之前做一些清理工作。</p><p id="9d53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在后台运行某些东西的第一个选项是使用<code class="fe mz na nb nc b">$</code>标志。这将进程放入后台作业列表中(可以用<code class="fe mz na nb nc b">jobs -l</code>列出)。但是，当shell关闭时，它仍然会接收到<code class="fe mz na nb nc b">SIGHUP</code>消息。</p><p id="afcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个选项是使用<code class="fe mz na nb nc b">disown</code>命令。这将从shell的作业列表中删除该作业。其中一个含义是它不会接收到<code class="fe mz na nb nc b">SIGHUP</code>命令。我们越来越接近了，但是如果我们终止<code class="fe mz na nb nc b">ssh</code>连接，例如，我们的程序在试图从<code class="fe mz na nb nc b">stdin</code>读取或向<code class="fe mz na nb nc b">stdout</code>写入时就会失败。</p><p id="3d9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三个也是最理想的选择是使用<code class="fe mz na nb nc b">nohup</code>命令。这个宝贝做了三件重要的事情，基本上将过程与外壳分开:</p><ul class=""><li id="500d" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">关闭<code class="fe mz na nb nc b">stdin</code>。</li><li id="9b3b" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">将<code class="fe mz na nb nc b">stdout</code>和<code class="fe mz na nb nc b">stderr</code>重定向到名为<code class="fe mz na nb nc b">nohup.out</code>的文件。</li><li id="784d" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">使进程不接收<code class="fe mz na nb nc b">SIGHUP</code>。</li></ul><p id="d440" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们必须将它与<code class="fe mz na nb nc b">$</code>配对，让它在后台运行，这不是默认模式。例如，如果我们想这样运行<code class="fe mz na nb nc b">cool_script</code>:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="490b" class="nh md it nc b gy ni nj l nk nl">nohup cool_script $</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2d40" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.exec命令</h1><p id="c631" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当您以常规方式运行脚本时，shell会生成一个新的子进程。这叫分叉。<code class="fe mz na nb nc b">exec</code>命令用于防止这种情况。它允许你用跟随<code class="fe mz na nb nc b">exec</code>的命令完全替换当前的外壳。当前进程被破坏，没有子shell被分支。例如:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="22da" class="nh md it nc b gy ni nj l nk nl">exec cool_script</span></pre><p id="15a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，我们为什么要用这个呢？我不会在我写的每个脚本中都使用<code class="fe mz na nb nc b">exec</code>，但它有时会很有用。</p><p id="6fa9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您在Mac上，默认shell是<code class="fe mz na nb nc b">zsh</code>，但是您想在<code class="fe mz na nb nc b">bash</code>中做一些工作。您可以简单地运行<code class="fe mz na nb nc b">exec bash</code>将默认的内存shell改为bash。</p><p id="bb57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一件有用的事情是将默认的bash shell替换为受限的shell，因为您可能想要控制用户在您的系统上可以做什么。然后简单运行<code class="fe mz na nb nc b">exec rbash</code>就大功告成了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b656" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.安排脚本在特定时间运行</h1><p id="f621" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">稍后运行脚本的最简单和最容易的方法是使用<code class="fe mz na nb nc b">at</code>命令。假设您想在今天下午4点运行<code class="fe mz na nb nc b">cool_script</code>。只需这样做(假设脚本位于根目录):</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="aed9" class="nh md it nc b gy ni nj l nk nl">at -f ~/cool_script teatime</span></pre><p id="139a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了喝茶时间，你可以指定任何你想要的，比如<code class="fe mz na nb nc b">now + 2 minutes</code>、<code class="fe mz na nb nc b">tomorrow</code>或<code class="fe mz na nb nc b">15:08</code>。</p><p id="756f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二种选择是使用<code class="fe mz na nb nc b">crontab</code>工具。如果您想在每天下午4点运行<code class="fe mz na nb nc b">cool_script</code>，那么您可以使用<code class="fe mz na nb nc b">crontab -e</code>来编辑您的crontab文件，或者创建一个不存在的文件。然后像这样编写cron作业:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="3317" class="nh md it nc b gy ni nj l nk nl">0 16 * * * /path/to/cool_script</span></pre><p id="a863" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三个选择是利用<code class="fe mz na nb nc b">launchd</code>，这是一个自动化脚本的非常好的工具，只有在Mac上才适用。</p><p id="736c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从在<code class="fe mz na nb nc b">~/Library/LaunchAgents</code>创建一个<code class="fe mz na nb nc b">.plist</code>文件开始:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="25bc" class="nh md it nc b gy ni nj l nk nl">touch ~/Library/LaunchAgents/com.schedule-test.daemon.plist</span></pre><p id="e360" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在用您选择的编辑器打开该文件，并向其中添加以下字段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="73a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这为每60秒运行我们的脚本创建了一个配置，如<code class="fe mz na nb nc b">StartInterval</code>中所定义的。<code class="fe mz na nb nc b">RunAtLoad</code>表示加载作业定义后将立即运行任务。</p><p id="0967" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要启动作业运行，请执行以下操作:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="9c60" class="nh md it nc b gy ni nj l nk nl">launchctl load ~/Library/LaunchAgents/com.schedule-test.daemon.plist</span></pre><p id="a9dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了阻止它:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="cec0" class="nh md it nc b gy ni nj l nk nl">launchctl unload ~/Library/LaunchAgents/com.schedule-test.daemon.plist</span></pre><p id="6b0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想安排您的作业在特定日期运行，您可以将类似这样的内容插入到您的<code class="fe mz na nb nc b">.plist</code>文件中:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="34fc" class="nh md it nc b gy ni nj l nk nl">&lt;key&gt;StartCalendarInterval&lt;/key&gt;<br/>&lt;dict&gt;<br/> &lt;key&gt;Minute&lt;/key&gt;<br/> &lt;integer&gt;42&lt;/integer&gt;<br/> &lt;key&gt;Hour&lt;/key&gt;<br/> &lt;integer&gt;13&lt;/integer&gt;<br/> &lt;key&gt;Weekday&lt;/key&gt;<br/> &lt;integer&gt;2&lt;/integer&gt;<br/>&lt;/dict&gt;</span></pre><p id="9bcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在每周二下午1:42运行您的脚本。很酷，不是吗？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="88a3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="35aa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，我们研究了我认为执行shell脚本的五种最常见的方式。感谢您花时间阅读本文。我希望你从中获得一些新的见解或价值。</p></div></div>    
</body>
</html>