<html>
<head>
<title>Setting Up CI/CD for a Django Project Using Github Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Github操作为Django项目设置CI/CD</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-github-actions-802838a09f4d?source=collection_archive---------5-----------------------#2022-08-17">https://betterprogramming.pub/getting-started-with-github-actions-802838a09f4d?source=collection_archive---------5-----------------------#2022-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c1d4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Github动作触发Django项目的测试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/230cb1faf2d3a513376312e89c1330d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*YqEXIEvHIP9Tn2_glLjVCw.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Github操作</p></figure><h1 id="0edb" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">议程</h1><p id="84e4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在这篇文章中，我们的目标是学习和设置Github动作。</p><p id="81cb" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们将使用Django应用程序，并将设置Github Actions工作流来运行该应用程序的测试。测试将在每次推送Github时执行。</p><p id="d7ff" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在<a class="ae mk" href="https://medium.com/@raaj.akshar/continuous-deployment-using-github-actions-37a7f5d7cb26" rel="noopener">的后续文章</a>中，我们将增强工作流，在每次合并到branch master时将代码部署到EC2实例。</p><h1 id="cbdf" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">设置</h1><p id="507f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们使用Django polls应用程序。我们在<a class="ae mk" href="https://github.com/akshar-raaj/polls" rel="noopener ugc nofollow" target="_blank">这里</a>构建了这个应用程序。</p><p id="eefa" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们还为此应用设置了<strong class="ll ir"> <em class="ml"> pytest </em> </strong>。<strong class="ll ir"> <em class="ml"> pytest </em> </strong>是运行该应用程序测试的测试框架。</p><p id="d76c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">克隆此应用程序并安装需求。作为最佳实践，你应该使用虚拟环境。</p><p id="1237" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到临时目录。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="b661" class="mr ks iq mn b gy ms mt l mu mv">$ cd /tmp</span></pre><p id="8e9c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">激活相关的Python版本，这里假设你使用的是<strong class="ll ir"> <em class="ml"> pyenv </em> </strong>。随意使用<strong class="ll ir"> <em class="ml"> virtualenv </em> </strong>或<strong class="ll ir"> <em class="ml"> virtualenv-wrapper。</em>T24】</strong></p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="6693" class="mr ks iq mn b gy ms mt l mu mv">$ pyenv shell 3.10.4</span></pre><p id="6c0f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">创建虚拟环境</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="e1b3" class="mr ks iq mn b gy ms mt l mu mv">$ pyenv virtualenv learn-gh-actions</span></pre><p id="6c65" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">激活创建的虚拟环境</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="df1e" class="mr ks iq mn b gy ms mt l mu mv">$ pyenv activate learn-gh-actions</span></pre><p id="ba09" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">克隆<strong class="ll ir"> <em class="ml">投票</em> </strong>应用程序。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="6610" class="mr ks iq mn b gy ms mt l mu mv">$ git clone <a class="ae mk" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:akshar-raaj/polls.git</span></pre><p id="ca53" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到项目文件夹</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="e3a5" class="mr ks iq mn b gy ms mt l mu mv">$ cd polls</span></pre><p id="1341" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">结帐到相关的标签。我们在这个项目中创建了一个标签<strong class="ll ir"> <em class="ml"> v1.0 </em> </strong>。签出此标签。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="8068" class="mr ks iq mn b gy ms mt l mu mv">$ git checkout v1.0</span><span id="78c3" class="mr ks iq mn b gy mw mt l mu mv">$ pip install -r requirements.txt</span></pre><p id="9aaf" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">一旦安装了需求，尝试使用命令<strong class="ll ir"> <em class="ml"> pytest </em> </strong>调用测试。</p><p id="09c7" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">你会看到一个抱怨<strong class="ll ir"><em class="ml">DJANGO _ SETTINGS _ MODULE</em></strong>的错误。该错误类似于:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="aee7" class="mr ks iq mn b gy ms mt l mu mv">django.core.exceptions.ImproperlyConfigured: Requested setting INSTALLED_APPS, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.</span></pre><p id="0268" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导出django设置模块</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="2e16" class="mr ks iq mn b gy ms mt l mu mv">$ export DJANGO_SETTINGS_MODULE=mysite.settings</span></pre><p id="e523" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">通过发出<strong class="ll ir"> <em class="ml"> pytest </em> </strong>命令再次调用测试。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="3011" class="mr ks iq mn b gy ms mt l mu mv">$ pytest</span></pre><p id="08e8" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">测试应该已经运行，并且所有测试都应该已经通过。您应该会看到类似于以下内容的输出:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="1ffa" class="mr ks iq mn b gy ms mt l mu mv">============================================================= test session starts =============================================================<br/>    platform darwin -- Python 3.10.4, pytest-7.1.2, pluggy-1.0.0<br/>    django: settings: mysite.settings (from env)<br/>    rootdir: /private/tmp/polls, configfile: pytest.ini<br/>    plugins: django-4.5.2<br/>    collected 7 items</span><span id="8dc0" class="mr ks iq mn b gy mw mt l mu mv">polls/test_models.py ..                                                                                                                 [ 28%]<br/>    polls/test_views.py ..                                                                                                                 [ 100%]</span><span id="f09e" class="mr ks iq mn b gy mw mt l mu mv">======================================================== 7 passed, 4 warnings in 0.40s ========================================================</span></pre><h1 id="1984" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">Github操作</h1><p id="2883" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">Github动作允许我们在项目中做一些很酷的事情。它可以用作CI/CD。</p><p id="0cff" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">Github Actions的一个主要优点是，您可以将CI/CD包含在Github中。因此，您的CI/CD设置就在您的代码旁边。<br/><strong class="ll ir"><em class="ml">构建&gt;测试&gt;部署</em> </strong>循环包含在Github中。不需要单独的CircleCI设置或Jenkins设置。</p><p id="7669" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">使用Github术语中的<strong class="ll ir"> <em class="ml">工作流</em> </strong>来管理Github动作。在<strong class="ll ir"> <em class="ml">事件</em> </strong>上触发一个工作流。<strong class="ll ir"> <em class="ml"> git推送</em> </strong>到Github可以认为是一个事件。类似地，拉请求的合并可以被认为是一个事件。</p><p id="7515" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">一个<strong class="ll ir"> <em class="ml">工作流</em> </strong>由多个<strong class="ll ir"> <em class="ml">作业</em> </strong>组成。每个<strong class="ll ir"> <em class="ml">作业</em> </strong>由一个或多个<strong class="ll ir"> <em class="ml">步骤</em> </strong>组成。</p><p id="2c7d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">一个**步* *本质上是一个命令。在我们的Github工作流程中，一个步骤是**pytest**。类似地，一个步骤可以简单到调用**ls**或**curl**。</p><p id="531f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">一个<strong class="ll ir"> <em class="ml">步骤</em> </strong>也可以调用一个Github动作。Github动作可以被认为是一些复杂的脚本，可以完成一项重要的任务。如果我们需要获取一些依赖来构建我们的项目，这不能用ls或curl这样简单的命令来完成，因此简单的步骤是不够的。对于这种情况，可以编写一些脚本来实现这一点。这些脚本被称为Github操作。我们将很快看到aGithub的行动；)</p><h2 id="0175" class="mr ks iq bd kt mx my dn kx mz na dp lb ls nb nc ld lw nd ne lf ma nf ng lh nh bi translated">设置Github存储库</h2><p id="391c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们将在您克隆的存储库上添加一个GH操作工作流。</p><p id="73f7" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">为了说明它的工作，我们需要将这些代码推送到您自己的存储库中。因此，我们将把这个克隆的存储库设置为您拥有的新存储库。</p><p id="20d9" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">拆下<strong class="ll ir">和<em class="ml">。git </em> </strong>文件夹。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="14d9" class="mr ks iq mn b gy ms mt l mu mv">$ rm -rf .git</span></pre><p id="ba07" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">验证它现在没有作为Git存储库被跟踪。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="202c" class="mr ks iq mn b gy ms mt l mu mv">$ git status</span></pre><p id="95a0" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">您会注意到以下输出:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="e85e" class="mr ks iq mn b gy ms mt l mu mv">fatal: not a git repository (or any of the parent directories): .git</span></pre><p id="02cc" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">将此项目初始化为git存储库。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="d66c" class="mr ks iq mn b gy ms mt l mu mv">$ git init</span></pre><p id="af5c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">您应该会看到以下输出</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="6452" class="mr ks iq mn b gy ms mt l mu mv">Initialized empty Git repository in /private/tmp/polls/.git</span></pre><p id="435f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">您需要在Github上创建一个新的存储库，在这里您可以推送您的本地更改并配置Github操作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/91129f6f0c959e4f3a48da3b6e63b98b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDCFnl39NFZby-Y1zo6yNA.png"/></div></div></figure><p id="94ea" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">一旦创建了这个新的存储库，您可以将它添加为这个项目的<strong class="ll ir"> <em class="ml"> origin </em> </strong>，并将本地更改推送到这个GH存储库。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="8590" class="mr ks iq mn b gy ms mt l mu mv">$ git remote add origin <a class="ae mk" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:akshar-raaj/polls-2.git<br/>$ git add *<br/>$ git commit -m "Polls application"<br/>$ git push --set-upstream origin master</span></pre><p id="c0b6" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果您的GH用户名是<em class="ml">约翰</em>，并且您已经将您的存储库命名为<em class="ml"> django-polls </em>，那么远程url将看起来像<a class="ae mk" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank"><em class="ml">git@github.com</em></a><em class="ml">:约翰/django-polls.git </em></p><p id="f69a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">刷新GH上的存储库页面。你应该在GH上看到你的代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nn"><img src="../Images/182ca91fc253721352351e527b3a0d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QpCs27EHF3L58zQdhV72dQ.png"/></div></div></figure><p id="a6c2" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到<strong class="ll ir"> <em class="ml">动作</em> </strong>选项卡。它应该在顶部可见，就在<strong class="ll ir"> <em class="ml">拉动请求</em> </strong>的旁边。</p><p id="96b3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">页面上会说<strong class="ll ir"><em class="ml">GitHub操作入门</em> </strong>。这是因为你还没有为项目定义任何GH工作流。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi no"><img src="../Images/ba4fce28a4c619187eb8a7f99a55117a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FlXbhzwFJdkVmSsvL4mRxQ.png"/></div></div></figure><p id="2cd9" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">接下来让我们定义一个工作流。</p><h2 id="f2ad" class="mr ks iq bd kt mx my dn kx mz na dp lb ls nb nc ld lw nd ne lf ma nf ng lh nh bi translated">添加工作流</h2><p id="c4ac" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">工作流在中定义。github/workflows目录。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="e3cd" class="mr ks iq mn b gy ms mt l mu mv">$ mkdir -p .github/workflows</span></pre><p id="4323" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">工作流是在yaml文件中定义的。为相同的创建一个. yml文件。姑且称之为<em class="ml"> run-tests.yml. </em></p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="cf9b" class="mr ks iq mn b gy ms mt l mu mv">$ touch .github/workflows/run-tests.yml</span></pre><p id="0ba3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">一个工作流需要以下三个关键点:</p><ul class=""><li id="6772" class="np nq iq ll b lm mf lp mg ls nr lw ns ma nt me nu nv nw nx bi translated">名字</li><li id="d95a" class="np nq iq ll b lm ny lp nz ls oa lw ob ma oc me nu nv nw nx bi translated">在</li><li id="eabe" class="np nq iq ll b lm ny lp nz ls oa lw ob ma oc me nu nv nw nx bi translated">工作</li></ul><p id="9798" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> <em class="ml">名称</em> </strong>用于为工作流指定一个名称。 上的<br/> <strong class="ll ir"> <em class="ml">用于指定该工作流应该触发的动作。</em></strong></p><p id="e622" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我们将以下内容添加到<em class="ml"> run-tests.yml </em>中。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="6c77" class="mr ks iq mn b gy ms mt l mu mv">name: Run tests<br/>on: push</span></pre><p id="0446" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我们添加并提交此更改。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="bede" class="mr ks iq mn b gy ms mt l mu mv">$ git add .github/</span><span id="c510" class="mr ks iq mn b gy mw mt l mu mv">$ git commit -m "Basic workflow, without any job."</span></pre><p id="bef5" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">将更改推送到Github</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="a693" class="mr ks iq mn b gy ms mt l mu mv">$ git push</span></pre><p id="9273" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们已经定义了我们的第一个工作流程。我们还将代码推送到GH，因为工作流描述工作流应该在  <strong class="ll ir">推</strong>时<strong class="ll ir"> <em class="ml">触发，因此工作流应该已经被触发。</em></strong></p><p id="e8cb" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到<em class="ml">动作</em>，您会注意到工作流的一次运行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi od"><img src="../Images/f68a9e1b7300ae8a571f37c6ec61da3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JaZZHv4KmnOT9r5H6lPd9g.png"/></div></div></figure><p id="aca3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到本次<em class="ml">运行</em>的详细页面。您会注意到<em class="ml">状态</em>为<em class="ml">故障</em>。您应该会注意到类似这样的内容:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="924a" class="mr ks iq mn b gy ms mt l mu mv">Error: .github#L1<br/>No jobs defined in `jobs`</span></pre><h2 id="6263" class="mr ks iq bd kt mx my dn kx mz na dp lb ls nb nc ld lw nd ne lf ma nf ng lh nh bi translated">添加作业</h2><p id="b761" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">因此，GH抱怨存在错误，因为没有定义作业。这表明<em class="ml">作业</em>是工作流中的必需键。</p><p id="44b2" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我们修改工作流yaml文件来添加一个作业。以下内容应添加到<em class="ml"> run-tests.yml </em>中。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="548d" class="mr ks iq mn b gy ms mt l mu mv">jobs:<br/>  execute_tests:<br/>    name: Install requirements and execute tests<br/>    runs-on: ubuntu-latest</span></pre><p id="526b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">因此，我们添加了一个<em class="ml"> jobs </em>键。我们提供了一个job_id，即<em class="ml"> execute_tests </em>。这不是一个关键字，所以你可以给它起其他名字，比如说<em class="ml"> trigger_tests </em>。job_id的值是作业配置的映射。</p><p id="9883" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这张地图有以下两个键:<br/> -名称<br/> -运行</p><p id="6935" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><em class="ml">名称</em>用于提供作业的描述性名称。<em class="ml">run-on</em>用于指定转轮。runner是指应该在其中执行该作业的安装。</p><p id="b8d9" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们希望我们的工作在ubuntu机器上执行。因此，我们将<em class="ml">的运行值</em>指定为<em class="ml"> ubuntu-latest </em>。</p><p id="92ff" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我们提交代码并推送到GH。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="9cde" class="mr ks iq mn b gy ms mt l mu mv">$ git add .github/workflows/run-tests.yml<br/>$ git commit -m "Added a job. The job has a 'name' and a 'runs-on'"<br/>$ git push</span></pre><p id="00a0" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到Github操作页面。您将会注意到，工作流将会再运行一次。这也会失败。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oe"><img src="../Images/708549f2f109c95c470cacd96c601fd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LLXaAqfiC86USNm1tIFN7g.png"/></div></div></figure><p id="c8d8" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到本次跑步的详细信息页面。您会注意到<em class="ml">状态</em>为<em class="ml">故障</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi of"><img src="../Images/41a5ff99b15eaf7586f3d95086c97830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0YeZ9DexV_fzsL4URWqpoQ.png"/></div></div></figure><p id="222d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如该错误所示，我们需要为添加的作业添加一个<em class="ml">步骤</em>。</p><h2 id="24cd" class="mr ks iq bd kt mx my dn kx mz na dp lb ls nb nc ld lw nd ne lf ma nf ng lh nh bi translated">添加步骤</h2><p id="2370" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们增加以下内容:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="a729" class="mr ks iq mn b gy ms mt l mu mv">steps:<br/>  - name: Update<br/>    run: sudo apt update</span></pre><p id="d3d3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">此时<em class="ml"> run-tests.yml </em>应该如下所示:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="a601" class="mr ks iq mn b gy ms mt l mu mv">name: Run tests<br/>on: push<br/>jobs:<br/>  execute_tests:<br/>    name: Install requirements and execute tests<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - name: Update<br/>        run: sudo apt update</span></pre><p id="c54c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我们承诺并推动GH。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="dcbe" class="mr ks iq mn b gy ms mt l mu mv">$ git add .github/workflows/run-tests.yml<br/>$ git commit -m "Added a job. The job has a 'name' and a 'runs-on'"<br/>$ git push</span></pre><p id="bb1a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到Github操作页面。您会注意到工作流的另一次运行已经被触发。这一切都会过去的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi og"><img src="../Images/e580891ff617fc95ced2ae11f8d53db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KRSqEiOMlHAiXEpCU0wsPg.png"/></div></div></figure><h2 id="c1d9" class="mr ks iq bd kt mx my dn kx mz na dp lb ls nb nc ld lw nd ne lf ma nf ng lh nh bi translated">执行测试的步骤</h2><p id="b666" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们成功添加了一个有效的工作流，该工作流已成功执行。我们看到了作业和步骤在工作流文件中是如何强制的，并且熟悉了作业和步骤下的不同键。</p><p id="5338" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">是时候添加一个可以执行测试的步骤了。</p><p id="3424" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">工作流作业总是在转轮上运行。流道由<em class="ml">run-on</em>指定。在我们的例子中，我们的作业运行在ubuntu安装上。每一个任务运行都提供一个全新的安装，因此这个运行者或机器对我们的代码库没有任何概念。<br/>因此，我们需要将我们的代码库放在runner上，这样就可以对它采取进一步的措施。</p><p id="a10e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">提取代码库将涉及多个命令。一些命令是:<br/> -在机器上安装git。<br/>——创建一个公钥-私钥对，并将密钥添加到github上。<br/> -从该机器执行“git克隆”。</p><p id="caa9" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这个过程涉及多个命令。这就是Github actions发挥作用的地方。动作是由脚本文件组成的一组命令。我们不必在工作流文件中单独指定所有这些命令，我们只需使用一个GH动作就可以完成想要的事情。</p><p id="ad6e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">Github提供的动作可以在<a class="ae mk" href="https://github.com/actions/" rel="noopener ugc nofollow" target="_blank">https://github.com/actions/</a>查看。</p><p id="e525" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们对一个动作特别感兴趣，这个动作可以在runner机器上提取和检验我们的代码。相关动作在<a class="ae mk" href="https://github.com/actions/checkout" rel="noopener ugc nofollow" target="_blank">https://github.com/actions/checkout</a>进行。</p><p id="53e2" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我们添加一个步骤，在runner机器上提取并检查我们的代码。它看起来会像</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="fa61" class="mr ks iq mn b gy ms mt l mu mv">- name: Check out repository code<br/>  uses: actions/checkout@v3</span></pre><p id="6be5" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">你会注意到在这一步我们没有使用<em class="ml">运行</em>，而是使用了<em class="ml">使用</em>。如果我们想在一个步骤中使用GH动作，那么必须使用键<em class="ml">使用</em>。如果我们想在一个步骤中运行一个命令，那么应该使用键<em class="ml"> run </em>。</p><p id="4580" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">现在我们应该在<em class="ml"> run-tests.yml </em>中有两个步骤。完整的文件应该如下所示:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="3ad3" class="mr ks iq mn b gy ms mt l mu mv">name: Run tests<br/>on: push<br/>jobs:<br/>  execute_tests:<br/>    name: Install requirements and execute tests<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - name: Update<br/>        run: sudo apt update<br/>      - name: Check out repository code<br/>        uses: actions/checkout@v3</span></pre><p id="9944" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我们承诺和推动。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="be39" class="mr ks iq mn b gy ms mt l mu mv">$ git add .github/workflows/run-tests.yml<br/>$ git commit -m "Added a step which uses a Github action using key 'uses' instead of 'run'. This action will pull and checkout the code on runner."<br/>$ git push</span></pre><p id="7b41" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到Github操作页面。您会注意到，工作流将会再运行一次。这一切都会过去的。</p><p id="6d18" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">一旦代码被签出，我们需要安装需求并运行测试。我们来补充一下相关步骤。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="7056" class="mr ks iq mn b gy ms mt l mu mv">- name: Install pip<br/>  run: sudo apt install python3-pip<br/>- name: Install requirements<br/>  run: pip install -r requirements.txt<br/>- name: Execute tests<br/>  env:<br/>    DJANGO_SETTINGS_MODULE: mysite.settings<br/>  run: pytest</span></pre><p id="444a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们添加了以下三个步骤。<br/> -在转轮机上安装pip的步骤。<br/> -使用pip安装需求。<br/> -使用<strong class="ll ir"> pytest </strong>执行测试。</p><p id="8221" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">Key <em class="ml"> env </em>允许我们为任何特定的步骤设置环境变量。在执行<em class="ml"> pytest </em>之前，我们需要环境变量<em class="ml"> DJANGO_SETTINGS_MODULE </em>。我们能够使用键<em class="ml"> env </em>来设置它。</p><p id="b66b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">让我们承诺和推动。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="7102" class="mr ks iq mn b gy ms mt l mu mv">$ git add .github/workflows/run-tests.yml<br/>$ git commit -m " Added three steps corresponding to installing pip, installing requirements and executing tests"<br/>$ git push</span></pre><p id="a609" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到Github操作页面。您会注意到，工作流将会再运行一次。这一切都会过去的。</p><p id="a320" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">导航到本次运行的详细信息页面，您会注意到所有步骤都已执行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oh"><img src="../Images/7ff6a61afadec101c05778ffee29c254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkZCNbTVa_D0OrR0vJIuUA.png"/></div></div></figure><p id="f5e9" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在详细页面上展开步骤<em class="ml">执行测试</em>。您会注意到<em class="ml"> pytest </em>已经被调用，所有的测试都已经被执行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oi"><img src="../Images/66c0c9c8e01067ea0265987a1df721af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3S1TC8qQ4YuXVK3p8EMlA.png"/></div></div></figure><p id="c48a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">因此，我们能够设置一个Github动作工作流，它在每次推送Github时被触发。</p><p id="d634" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">完整的项目可以在这里看到<a class="ae mk" href="https://github.com/akshar-raaj/polls-2" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>