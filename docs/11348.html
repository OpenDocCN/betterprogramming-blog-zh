<html>
<head>
<title>How to Generate HTML With Golang Templates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Golang模板生成HTML</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-generate-html-with-golang-templates-5fad0d91252?source=collection_archive---------0-----------------------#2022-03-11">https://betterprogramming.pub/how-to-generate-html-with-golang-templates-5fad0d91252?source=collection_archive---------0-----------------------#2022-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="29d0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用Go模板生成HTML页面的示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/28959af6441a17e3d50f9a7197868cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JsqShcz4G2YbIvEV"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pankaj Patel </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="c974" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我提供了另一个例子，它是我上一篇文章<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-templates-in-golang-46194c677c7d">“如何在Golang中使用模板”</a>的后续。我将使用那篇文章中关于使用Golang (Go语言)模板的一些基本技术。除了这个项目，我还决定<em class="lv">使用嵌套模板</em>和<em class="lv">编写自己的简单函数在模板</em>中使用。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="30b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于这是一个使用Golang模板而不是网页设计的练习，我决定寻找一个现有的页面设计。因此，所有的图片、CSS和JS都一字不差地来自于<a class="ae ky" href="https://www.youtube.com/watch?v=OAPRagDr4pU" rel="noopener ugc nofollow" target="_blank">网页设计师先生的视频教程</a>(代码可以免费使用)。<em class="lv">另一方面，教程中的HTML显然已经被改编成模板。</em></p><p id="0658" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，您可以看到我们将根据产品数据生成的网页:</p><div class="kj kk kl km gt ab cb"><figure class="md kn me mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/8ea0ae6e20ae7da80d07aae29d6ed09a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*cU6ZNjC6tAXnMbAxr2VgUg.png"/></div></figure><figure class="md kn me mf mg mh mi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/4eca11dae964f38bffc31f04afec1af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*NV8I22ruoEGynvbYvpmzrA.png"/></div></figure></div><p id="301d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">网页是有反应的，所以它适应不同的屏幕宽度，当你点击其中一个“产品”时，你会得到一个带有描述和一些按钮的弹出窗口。</p><p id="9d4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Web Designer先生的原始示例中，产品及其描述被硬编码在HTML文件中。使用模板并用(不同的)数据呈现它们可以避免对产品及其描述进行硬编码。</p><p id="5afb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在接下来的内容中，我将首先向您展示解析和呈现模板的实际程序，然后输出生成的HTML文件。之后，我会向你展示不同的模板是什么样子，并讨论我在其中使用的一些技术。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="fdb1" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">真正的Golang计划</h1><p id="1287" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">下面是将完成所有工作的Golang程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="d70d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第3–8行，我们导入必要的包。输出HTML文件需要<code class="fe ni nj nk nl b">bufio</code>、<code class="fe ni nj nk nl b">bytes</code>和<code class="fe ni nj nk nl b">os</code>包。包<code class="fe ni nj nk nl b">html/template</code>用于处理模板。</p><p id="0866" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第10–17行，我们定义了<code class="fe ni nj nk nl b">product</code>，它是一个用于保存产品数据的<code class="fe ni nj nk nl b">struct</code>。确保所有属性都用大写字母书写，即它们是可导出的。在Golang模板中使用struct时，这是必需的。</p><p id="4e5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，请注意，星的数量是一个介于0和5之间的浮点数。我们对这个数字使用一种类型的<code class="fe ni nj nk nl b">float64</code>的原因是模板对所有浮点数都使用<code class="fe ni nj nk nl b">float64</code>。</p><p id="1738" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第19–25行，我创建了两个函数，因为我对<code class="fe ni nj nk nl b">sprig</code>包提供的函数不满意。第一个名为<code class="fe ni nj nk nl b">subtr()</code>的函数是一个简单的浮点数减法函数，第二个名为<code class="fe ni nj nk nl b">list()</code>的函数用于创建浮点数列表。</p><p id="3eeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第29–36行，我们定义了要在模板中呈现的数据。在这个例子中，数据是硬编码的。在更现实的环境中，这些数据可能会存储在某种数据库中。注意，数据遵循<code class="fe ni nj nk nl b">product</code>结构的定义。</p><p id="c28c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第38行，我们将所有模板的文件名添加到一个切片中。</p><p id="00bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第40–43行，目录名<code class="fe ni nj nk nl b">/templates/</code>被添加到所有文件名中。</p><p id="e88e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第45行，我们用<code class="fe ni nj nk nl b">ParseFiles()</code>解析模板，确保用<code class="fe ni nj nk nl b">template.FuncMap{}</code>添加两个函数<code class="fe ni nj nk nl b">subtr</code>和<code class="fe ni nj nk nl b">list</code>，并用<code class="fe ni nj nk nl b">template.Must()</code>检查模板的正确性。</p><p id="7da8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第47–48行，我们将模板渲染到一个字节缓冲区。为了确保渲染器从<code class="fe ni nj nk nl b">page</code>模板开始，我们使用<code class="fe ni nj nk nl b">ExecuteTemplates()</code>和<code class="fe ni nj nk nl b">"page"</code>作为参数。这里，我们还向渲染器提供我们定义的数据。</p><p id="92ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第50–54行，渲染的字节缓冲区被输出到一个名为<code class="fe ni nj nk nl b">./static</code>目录中<code class="fe ni nj nk nl b">index.html</code>的HTML文件。</p><h1 id="d0f5" class="mj mk it bd ml mm nm mo mp mq nn ms mt jz no ka mv kc np kd mx kf nq kg mz na bi translated">用于生成HTML的模板</h1><p id="d194" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在这里，我讨论了这个项目使用的所有模板。</p><h2 id="0086" class="nr mk it bd ml ns nt dn mp nu nv dp mt li nw nx mv lm ny nz mx lq oa ob mz oc bi translated">“页面”模板</h2><p id="c4c8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这是定义完整网页的模板。它调用另外三个模板；<code class="fe ni nj nk nl b">header</code>、<code class="fe ni nj nk nl b">content</code>和<code class="fe ni nj nk nl b">footer</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="faef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第1行中，必须在这个模板中定义<code class="fe ni nj nk nl b">page</code>，否则<code class="fe ni nj nk nl b">ExecuteTemplates()</code>将找不到它。</p><p id="b4c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第3行，注意当调用<code class="fe ni nj nk nl b">content</code>模板时添加了一个点。这向模板呈现器发出信号，表明所提供的数据将被发送到<code class="fe ni nj nk nl b">content</code>模板。这与向函数提供参数是一样的。假设<code class="fe ni nj nk nl b">header</code>和<code class="fe ni nj nk nl b">footer</code>模板不需要数据；也没有必要添加点。</p><h2 id="b2b0" class="nr mk it bd ml ns nt dn mp nu nv dp mt li nw nx mv lm ny nz mx lq oa ob mz oc bi translated">“标题”模板</h2><p id="5131" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">该模板用于呈现加载字体、样式和JavaScript代码的典型HTML标题。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="2bbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们使用<code class="fe ni nj nk nl b">define</code>和<code class="fe ni nj nk nl b">end</code>关键字将模板定义为<code class="fe ni nj nk nl b">header</code>模板。</p><p id="4217" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，请注意双结束括号前的“-”号。这个符号告诉渲染器删除空白和换行符。根据我的经验，你需要试验一下这些“-”的位置。</p><p id="91e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了获得想要的输出，你有时需要把“-”放在开始的双括号之后，有时在双结束括号之前，有时在两个地方。</p><h2 id="80b6" class="nr mk it bd ml ns nt dn mp nu nv dp mt li nw nx mv lm ny nz mx lq oa ob mz oc bi translated">“内容”模板</h2><p id="7ad7" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这是呈现HTML文件主体的模板。</p><p id="2f66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将内容与页眉和页脚分开定义的原因是，我们可以快速创建具有不同内容但具有相同页眉和页脚的其他页面——例如，加载相同的CSS、JS、字体等。</p><p id="26b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，我创建了自己版本的<a class="ae ky" href="http://masterminds.github.io/sprig/" rel="noopener ugc nofollow" target="_blank">Sprig</a>T7】和<code class="fe ni nj nk nl b">subf</code>函数，因为我对那个包中的不满意。这是因为我有一些无法摆脱的错误。我还决定调用我的减法函数<code class="fe ni nj nk nl b">subtr</code>而不是<code class="fe ni nj nk nl b">subf</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="2e79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第5–12行，我们遍历了数据中的所有产品。对于每个产品，我们创建内部模板变量<code class="fe ni nj nk nl b">$index</code>和<code class="fe ni nj nk nl b">$item</code>。我们使用<code class="fe ni nj nk nl b">$index</code>作为<code class="fe ni nj nk nl b">data-name</code>属性。从<code class="fe ni nj nk nl b">$item</code>中，我们提取了用于HTML的<code class="fe ni nj nk nl b">Img</code>、<code class="fe ni nj nk nl b">Name</code>和<code class="fe ni nj nk nl b">Price</code>属性。</p><p id="b4b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在第16–42行，我们做的和上面一样，但是我们也从<code class="fe ni nj nk nl b">$item</code>中提取了<code class="fe ni nj nk nl b">$Stars $Description</code>和<code class="fe ni nj nk nl b">$Reviews</code>属性。</p><p id="2582" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，在第22行，我们创建了一个名为<code class="fe ni nj nk nl b">$stars</code>的列表。这个列表包含从1.0到5.0的浮点数。我们需要这些来展示星星。这些数字代表显示每颗星的阈值。</p><p id="8119" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在第23–32行，我们创建了一个循环来显示星星。本质上，我们有三种类型的星星可以展示:满星星、半星星和空星星。</p><p id="c9f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用条件句，我们确定一个条目的星数(<code class="fe ni nj nk nl b">$item.Stars</code>)是否小于来自<code class="fe ni nj nk nl b">$stars</code>列表的星数减0.5，或者小于星数，或者更高。在第一种情况下，我们显示一个空的星星。在第二种情况下，我们显示一个半星形。最后，在最后一种情况下，我们显示一个完整的星号。</p><h2 id="9de3" class="nr mk it bd ml ns nt dn mp nu nv dp mt li nw nx mv lm ny nz mx lq oa ob mz oc bi translated">“页脚”模板</h2><p id="d697" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">除了将模板定义为<code class="fe ni nj nk nl b">footer</code>之外，这里没有什么特别的事情发生。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7ef8" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">运行HTML生成器并查看结果</h1><p id="9565" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">确保<code class="fe ni nj nk nl b">main.go</code>文件位于包含两个子目录<code class="fe ni nj nk nl b">templates</code>和<code class="fe ni nj nk nl b">static</code>的目录中。以上模板都需要在<code class="fe ni nj nk nl b">templates</code>目录下。原始代码中的CSS、JS和图像需要放在<code class="fe ni nj nk nl b">static</code>目录中它们各自的子目录中。</p><p id="c10e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需在终端的正确目录中键入<code class="fe ni nj nk nl b">go run main.go</code>来运行生成器。随后，将生成HTML文件，并作为<code class="fe ni nj nk nl b">index.html</code>写出到<code class="fe ni nj nk nl b">static</code>目录中。</p><p id="b507" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您可以在浏览器中打开<code class="fe ni nj nk nl b">index.html</code>文件，您应该会得到本文开头所示的结果。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f859" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">参考</h1><p id="961b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated"><a class="ae ky" href="https://www.youtube.com/watch?v=OAPRagDr4pU" rel="noopener ugc nofollow" target="_blank">“具有快速查看产品预览弹出效果的响应式产品卡”，网页设计师先生</a></p></div></div>    
</body>
</html>