<html>
<head>
<title>Build, Test, and Deploy a Flask Application: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建、测试和部署Flask应用程序:第2部分</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-test-and-deploy-a-flask-application-part-2-53f2c8df3ebc?source=collection_archive---------1-----------------------#2019-11-23">https://betterprogramming.pub/build-test-and-deploy-a-flask-application-part-2-53f2c8df3ebc?source=collection_archive---------1-----------------------#2019-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a179" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用户验证-注册</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/eee0f2494c2c7b27908aea547fc4b14b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nz8xTggl2AtQB3xl"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@bernardhermant?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伯纳德·赫曼特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="d7f9" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">关于本教程的元信息</h1><h2 id="92e0" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated">学习目标</h2><ul class=""><li id="fedd" class="mk ml iq mm b mn mo mp mq ma mr md ms mg mt mu mv mw mx my bi translated">用户验证—注册</li></ul><p id="a24b" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">注:本教程是<a class="ae kv" href="https://medium.com/@neohao/learn-flask-in-a-scientific-way-baf4d8055f6e" rel="noopener"> <em class="no">科学学烧瓶</em> </a> <em class="no">系列的一部分。</em></p><h2 id="ce59" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated">源代码</h2><ul class=""><li id="3c60" class="mk ml iq mm b mn mo mp mq ma mr md ms mg mt mu mv mw mx my bi translated">本教程的源代码可以在<a class="ae kv" href="https://github.com/Neo-Hao/mean-review-collector" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获取。</li><li id="5f43" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated">该演示可在<a class="ae kv" href="https://pacific-fortress-91193.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://pacific-fortress-91193.herokuapp.com/</a>获得。</li><li id="3071" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated">仅涵盖本教程的版本可在此处访问<a class="ae kv" href="https://github.com/Neo-Hao/mean-review-collector/tree/ecd52a0af58ab1b1165491d50afdd355dfb9988f" rel="noopener ugc nofollow" target="_blank">。</a></li></ul></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="2eed" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">规划和设计</h1><p id="b3d8" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">我们的目标是在应用程序中设置用户注册。为此，我们需要一个存储用户信息的数据库表。该表至少包含三列:</p><ol class=""><li id="02d0" class="mk ml iq mm b mn nb mp nd ma nx md ny mg nz mu oa mw mx my bi translated">身份证明</li><li id="28ca" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu oa mw mx my bi translated">用户名</li><li id="1220" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu oa mw mx my bi translated">密码</li></ol><p id="f8d4" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">每个用户的用户名必须是唯一的。路线/视图功能必须考虑到这一点。注册和登录的模板都需要更新，以便向数据库发送数据。</p><p id="6ada" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">此外，用户登录时的模板页面需要扩展我们在上一个教程中准备的基本模板。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="ca38" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">数据库设置</h1><p id="479b" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">我们将使用一个<a class="ae kv" href="https://www.sqlite.org/" rel="noopener ugc nofollow" target="_blank"> SQLite </a>数据库来存储用户信息。Python在<a class="ae kv" href="https://docs.python.org/3.4/library/sqlite3.html" rel="noopener ugc nofollow" target="_blank"> sqlite3 </a>模块中内置了对SQLite的支持。</p><p id="58ab" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">要设置数据库，我们需要在应用程序的根级别准备一个SQL文件，因此我们的应用程序结构将如下所示:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="34eb" class="lv le iq oc b gy og oh l oi oj">--- app.py<br/>--- app.test.py<br/>--- templates<br/>       --- html files<br/><strong class="oc ir">--- schema.sql</strong></span></pre><p id="6263" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">这个SQL文件(<code class="fe ok ol om oc b">schema.sql</code>)包含SQL命令，这些命令按照我们的计划创建一个包含三个字段的空表:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="0818" class="lv le iq oc b gy og oh l oi oj">DROP TABLE IF EXISTS user;</span><span id="632e" class="lv le iq oc b gy on oh l oi oj">CREATE TABLE user (<br/>  id INTEGER PRIMARY KEY AUTOINCREMENT,<br/>  username TEXT UNIQUE NOT NULL,<br/>  password TEXT NOT NULL<br/>);</span></pre><p id="a95e" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">ID是该表中的主键，设置为自动递增。主键唯一地标识表中的每条记录，也可以作为在表之间建立关系的工具。</p><p id="4550" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">此外，我们明确表示用户名必须是<code class="fe ok ol om oc b">UNIQUE</code>。</p><p id="29e0" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">虽然schema中的SQL命令已经设置好了，但是我们仍然需要Python代码来执行它。更新您的<code class="fe ok ol om oc b">app.py</code>,增加更多配置和四个数据库功能:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="2911" class="lv le iq oc b gy og oh l oi oj"># imports<br/>from flask import Flask, request, g, redirect, url_for, \<br/>                  render_template, flash, make_response<br/>from werkzeug.security import check_password_hash, generate_password_hash<br/>import sqlite3</span><span id="36cf" class="lv le iq oc b gy on oh l oi oj"># configuration<br/>app = Flask(__name__)<br/>app.config["SECRET_KEY"] = <!-- -->"rajsiosorqwnejrq39834tergm4"<br/>app.config['DATABASE'] = 'flaskr.db'<br/>app.config['DEBUG'] = True</span><span id="edbd" class="lv le iq oc b gy on oh l oi oj"># connect to database<br/>def connect_db():<br/>    rv = sqlite3.connect(app.config['DATABASE'])<br/>    rv.row_factory = sqlite3.Row<br/>    return rv</span><span id="ac6e" class="lv le iq oc b gy on oh l oi oj"># create the database<br/>def init_db():<br/>    with app.app_context():<br/>        db = get_db()<br/>        with app.open_resource('schema.sql', mode='r') as f:<br/>            db.cursor().executescript(f.read())<br/>        db.commit()</span><span id="5ae3" class="lv le iq oc b gy on oh l oi oj"># open database connection<br/>def get_db():<br/>    if not hasattr(g, 'sqlite_db'):<br/>        g.sqlite_db = connect_db()<br/>    return g.sqlite_db</span><span id="e1f5" class="lv le iq oc b gy on oh l oi oj"># close database connection<br/>@app.teardown_appcontext<br/>def close_db(error):<br/>    if hasattr(g, 'sqlite_db'):<br/>        g.sqlite_db.close()</span><span id="b2a9" class="lv le iq oc b gy on oh l oi oj">// ...</span></pre><p id="153a" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">有两件事需要解释:</p><h2 id="059c" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated"><strong class="ak"> app.config </strong></h2><p id="6e4b" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">每个Flask应用程序都有一个名为<code class="fe ok ol om oc b">app.config</code>的全局配置对象。这个配置对象可以像Python字典一样处理，通过它可以访问、分配和修改配置变量的值。</p><p id="ef87" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">值得注意的是，我们通过<code class="fe ok ol om oc b">app.config</code>直接更新这些变量。这种方法只适用于像我们这样的小型应用程序。</p><h2 id="ecbc" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated"><strong class="ak"> g </strong></h2><p id="4547" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated"><code class="fe ok ol om oc b">g</code>对象使事物全球化。</p><p id="15a9" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">Flask应用程序通常运行在几个。py文件。<code class="fe ok ol om oc b">g</code>对象允许你在你的应用程序中对文件进行全局操作。</p><p id="bbe2" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">到目前为止，我们既没有利用工厂也没有利用蓝图，并且仍然只使用其中一个。py文件，所以我们还没有机会体验它是如何被使用的。然而，了解一下<code class="fe ok ol om oc b">g</code>对象是做什么的仍然是值得的。</p><p id="7b9c" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">现在，让我们通过Python shell初始化一个数据库:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="7aa1" class="lv le iq oc b gy og oh l oi oj">python3<br/>&gt;&gt;&gt; from app import init_db<br/>&gt;&gt;&gt; init_db()</span></pre><p id="3025" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">如果运行时没有错误，您将看到数据库文件将出现在相同的目录中:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="b4b7" class="lv le iq oc b gy og oh l oi oj">--- app.py<br/>--- app.test.py<br/>--- templates<br/>       --- html files<br/>--- schema.sql<br/><strong class="oc ir">--- flaskr.db</strong></span></pre><h2 id="1e21" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated"><strong class="ak">数据库测试</strong></h2><p id="f178" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">为了测试数据库是否成功创建，我们可以在<code class="fe ok ol om oc b">BasicTestCase</code>类下用另一个单元测试方法进一步扩展我们的<code class="fe ok ol om oc b">app.test.py</code>:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="9c05" class="lv le iq oc b gy og oh l oi oj">def test_database(self):<br/>    tester = os.path.exists("flaskr.db")<br/>    self.assertTrue(tester)</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="5480" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">登记</h1><p id="b11a" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">随着数据库的建立，我们可以更新应用程序的注册组件了。</p><p id="bf3e" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">在我们开始之前，我们需要确保您理解<code class="fe ok ol om oc b">POST</code>和<code class="fe ok ol om oc b">GET</code>请求之间的区别。</p><p id="474f" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">如果这是你第一次听说这样的术语，请先参考<a class="ae kv" href="https://www.diffen.com/difference/GET-vs-POST-HTTP-Requests" rel="noopener ugc nofollow" target="_blank">本教程</a>对<code class="fe ok ol om oc b">POST</code>和<code class="fe ok ol om oc b">GET</code>请求有一个概念性的了解。</p><p id="7632" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">注册组件有三个部分需要更新:</p><ol class=""><li id="889c" class="mk ml iq mm b mn nb mp nd ma nx md ny mg nz mu oa mw mx my bi translated">路由功能</li><li id="3799" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu oa mw mx my bi translated">查看功能</li><li id="fa99" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu oa mw mx my bi translated">模板</li></ol><p id="69b7" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">我们将按照这个顺序把它们全部更新:<code class="fe ok ol om oc b">register.html</code>(模板)——&gt;路由和查看功能——&gt;——<code class="fe ok ol om oc b">base.html</code>(模板)。</p><h2 id="c78c" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated"><strong class="ak">模板(register.html)</strong></h2><p id="d0ee" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">如果您还记得我们在上一个教程中所做的事情，我们成功地设计了注册模板的样式，但是注册表单无法运行，因为我们的表单没有方法属性，输入字段也没有名称属性:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="7468" class="lv le iq oc b gy og oh l oi oj">&lt;form&gt;<br/> ...      <br/>&lt;input type="email" class="form-control" id="email" aria-describedby="emailHelp" placeholder="Enter email"&gt;<br/>...<br/>&lt;input type="password" class="form-control" id="user-password" placeholder="Password"&gt;<br/>...<br/>&lt;/form&gt;</span></pre><p id="d0e1" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">为了成功发送和处理post请求，我们将通过添加以下属性来更新模板:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="b633" class="lv le iq oc b gy og oh l oi oj">&lt;form <strong class="oc ir">method="post"</strong>&gt;<br/> ...      <br/>&lt;input type="email" class="form-control" id="email" aria-describedby="emailHelp" placeholder="Enter email" <strong class="oc ir">name="username"</strong>&gt;<br/>...<br/>&lt;input type="password" class="form-control" id="user-password" placeholder="Password" <strong class="oc ir">name="password"</strong>&gt;<br/>...<br/>&lt;/form&gt;</span></pre><p id="d585" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">值得注意的是，表单输入元素的ID与元素中包含的数据无关。</p><p id="d3dc" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">但是，name属性在浏览器发送给服务器的HTTP请求中用作变量名(与value属性中包含的数据相关联)。</p><h2 id="2471" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated"><strong class="ak">路线和查看功能</strong></h2><p id="8d4a" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">需要更新路由以考虑不同类型的HTTP请求，包括<code class="fe ok ol om oc b">GET</code>和<code class="fe ok ol om oc b">POST</code>。更新后的路线应该如下所示:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="13af" class="lv le iq oc b gy og oh l oi oj">@app.route('/register', methods=('GET', 'POST'))</span></pre><p id="28e9" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">视图功能需要考虑不同类型的HTTP请求，处理不同的用户交互场景，并为这些场景呈现可能不同的视图。</p><p id="f707" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">这种情况包括:</p><ul class=""><li id="89ae" class="mk ml iq mm b mn nb mp nd ma nx md ny mg nz mu mv mw mx my bi translated">注册成功-&gt;重定向用户到登录页面。</li><li id="1b99" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated">没有用户名(当用户仍然点击提交按钮时)。</li><li id="44f0" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated">无密码(当用户仍然点击提交按钮时)。</li><li id="e3ac" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated">已经注册了相同的用户名。</li></ul><p id="a72b" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">对于第一个场景，我们需要将注册信息提交到数据库，并将用户重定向到不同的页面(例如登录页面)。</p><p id="15b3" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">对于最后三种情况，我们需要通知用户这样的错误，并让他们保持在同一页面上。</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="75bf" class="lv le iq oc b gy og oh l oi oj"><a class="ae kv" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/register', methods=('GET', 'POST'))<br/>def register():<br/>    if request.method == 'POST':<br/>        username = request.form['username']<br/>        password = request.form['password']<br/>        db = get_db()<br/>        error = None</span><span id="0109" class="lv le iq oc b gy on oh l oi oj">        if not username:<br/>            error = 'Username is required.'<br/>        elif not password:<br/>            error = 'Password is required.'<br/>        elif db.execute(<br/>            'SELECT id FROM user WHERE username = ?', (username,)<br/>        ).fetchone() is not None:<br/>            error = 'User {} is already \<br/>                   registered.'.format(username)</span><span id="fb97" class="lv le iq oc b gy on oh l oi oj">        if error is None:<br/>            db.execute(<br/>                'INSERT INTO user (username, password) VALUES \<br/>               (?, ?)', (username, <strong class="oc ir">generate_password_hash</strong>(password))<br/>            )<br/>            db.commit()<br/>            return redirect(url_for('login'))</span><span id="6318" class="lv le iq oc b gy on oh l oi oj">        <strong class="oc ir">flash</strong>(error)</span><span id="9db3" class="lv le iq oc b gy on oh l oi oj">   return render_template('register.html')</span></pre><p id="ca11" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">到目前为止，我们显示了最后三个场景的各种错误，但是这些错误无处可去。如果你现在启动你的应用程序，当你试图在没有密码的情况下注册时，你不会看到任何错误。</p><h2 id="d306" class="lv le iq bd lf lw lx dn lj ly lz dp ln ma mb mc lp md me mf lr mg mh mi lt mj bi translated"><strong class="ak">模板(base.html)</strong></h2><p id="0dd1" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">为了在必要时向用户显示闪现的错误，我们需要对模板进行进一步的更新。我们只能对<code class="fe ok ol om oc b">register.html</code>进行更新，但在处理登录视图功能时可能会遇到类似的场景。</p><p id="741a" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">更好的解决方案是更新基本模板，它由<code class="fe ok ol om oc b">register.html</code>和<code class="fe ok ol om oc b">login.html</code>扩展。以下是我将在<code class="fe ok ol om oc b">base.html</code>中包含的错误块:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="e67f" class="lv le iq oc b gy og oh l oi oj">{% for message in get_flashed_messages() %}<br/>    &lt;div class="container alert alert-danger"&gt;<br/>      &lt;span&gt;Error: {{ message }}&lt;/span&gt;<br/>    &lt;/div&gt;<br/>{% endfor %}</span></pre><p id="796f" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">和以前一样，我参考了Bootstrap 的<a class="ae kv" href="https://getbootstrap.com/docs/3.4/components/#glyphicons-examples" rel="noopener ugc nofollow" target="_blank">文档，了解如何设置错误信息的样式。它会呈现这样的效果:</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/fb32c89dacdafb57d99b7936a9f66470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dv7LuOCczjtk08oIKTa6cQ.png"/></div></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="8d54" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">测试</h1><p id="4fb1" class="pw-post-body-paragraph mz na iq mm b mn mo jr nc mp mq ju ne ma nu ng nh md nv nj nk mg nw nm nn mu ij bi translated">为了测试我们的注册组件，让我们添加另一个类并修改我们的<code class="fe ok ol om oc b">app.test.py</code>:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="7fb0" class="lv le iq oc b gy og oh l oi oj">import os<br/>import unittest<br/>import tempfile</span><span id="adb3" class="lv le iq oc b gy on oh l oi oj">import app</span><span id="891d" class="lv le iq oc b gy on oh l oi oj">// ... </span><span id="6489" class="lv le iq oc b gy on oh l oi oj">class FlaskrTestCase(unittest.TestCase):<br/>  # set up a new temp database for per test<br/>  def setUp(self):<br/>    self.db_fd, app.app.config['DATABASE'] = tempfile.mkstemp()<br/>    app.app.config['TESTING'] = True<br/>    self.app = app.app.test_client()<br/>    app.init_db()</span><span id="905c" class="lv le iq oc b gy on oh l oi oj">  # destroy the temp database for per test<br/>  def tearDown(self):<br/>    os.close(self.db_fd)<br/>    os.unlink(app.app.config['DATABASE'])</span><span id="c9b2" class="lv le iq oc b gy on oh l oi oj">  def register(self, username, password):<br/>    return self.app.post('/register', data=dict(<br/>      username=username,<br/>      password=password<br/>    ), follow_redirects=True)</span><span id="460d" class="lv le iq oc b gy on oh l oi oj">  # test messages<br/>  def test_register_messages(self):<br/>    """Test register messages using helper functions."""<br/>    rv = self.register(<br/>            "<a class="ae kv" href="mailto:cat@123.com" rel="noopener ugc nofollow" target="_blank">cat@123.com</a>",<br/>            ""<br/>    )<br/>    assert b'Password is required' in rv.data</span><span id="721e" class="lv le iq oc b gy on oh l oi oj">    rv = self.register(<br/>            "",<br/>            "123"<br/>    )<br/>    assert b'Username is required' in rv.data</span></pre><p id="aee7" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">注册的一切都准备好了，别忘了把你的代码推给GitHub。</p><p id="989a" class="pw-post-body-paragraph mz na iq mm b mn nb jr nc mp nd ju ne ma nf ng nh md ni nj nk mg nl nm nn mu ij bi translated">随着我们的<code class="fe ok ol om oc b">app.py</code>变得越来越臃肿，我们将重构它的代码。py文件，并使用下一篇教程中开发Flask应用程序、工厂或蓝图的推荐实践以及登录组件开始探索。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="fb02" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">教程列表</h1><ul class=""><li id="d8fc" class="mk ml iq mm b mn mo mp mq ma mr md ms mg mt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-mini-flask-application-1d9ca6c45115" rel="noopener">构建并测试迷你烧瓶应用程序</a></li><li id="e240" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/better-programming/build-test-and-deploy-an-interactive-flask-application-part-i-templates-53a7b0cbe760" rel="noopener">构建、测试和部署Flask应用程序:第1部分——模板</a></li><li id="ada3" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/better-programming/build-test-and-deploy-a-flask-application-part-2-53f2c8df3ebc" rel="noopener">构建、测试和部署Flask应用程序:第2部分——认证</a></li><li id="78c5" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-3-3a2abfe4be21" rel="noopener">构建、测试和部署Flask应用程序:第3部分——应用程序工厂和蓝图</a></li><li id="c985" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-4-5aa4f079fadb" rel="noopener">构建、测试和部署Flask应用程序:第4部分——重构测试</a></li><li id="0517" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-5-4a3c0bc36b8e" rel="noopener">构建、测试和部署Flask应用程序:第5部分—认证(续)</a></li><li id="0eca" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-6-952a1b29a02a" rel="noopener">构建、测试和部署Flask应用程序:第6部分——评审系统</a></li><li id="d322" class="mk ml iq mm b mn np mp nq ma nr md ns mg nt mu mv mw mx my bi translated"><a class="ae kv" href="https://medium.com/@neohao/build-test-and-deploy-a-flask-application-part-7-60dde9080330" rel="noopener">构建、测试和部署Flask应用程序:第7部分——部署</a></li></ul></div></div>    
</body>
</html>