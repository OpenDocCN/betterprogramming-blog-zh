<html>
<head>
<title>How You Can Prevent Committing Secrets and Credentials Into Git Repositories</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何防止将秘密和凭证提交到Git存储库中</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-you-can-prevent-committing-secrets-and-credentials-into-git-repositories-adffc25c2ea2?source=collection_archive---------2-----------------------#2019-10-16">https://betterprogramming.pub/how-you-can-prevent-committing-secrets-and-credentials-into-git-repositories-adffc25c2ea2?source=collection_archive---------2-----------------------#2019-10-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a4e2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">您的系统的安全性取决于其最薄弱的环节</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9b8fb819670b06cca468c48b05e39698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uySD4f731_s_z3e1GLO7WQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@arget?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿吉特</a>在<a class="ae ky" href="https://unsplash.com/s/photos/hacker?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="d23d" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">问题陈述</h1><p id="c2f2" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在软件开发生命周期中，我们需要一直处理凭证、密码和秘密。</p><p id="b9fd" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">早先我们在做应用开发的时候，数据库密码管理是我们唯一要考虑的事情。但是现在，随着云的使用越来越多，我们需要处理各种密钥、服务帐户、服务主体等。也是。</p><p id="9b02" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我经常看到，如果开发人员缺乏经验或不够成熟，无法理解安全方面，那么他们最终可能会提交密码、服务帐户或源代码库中的任何其他秘密。</p><p id="1e78" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果您使用的是公共或公开托管的回购，甚至是整个组织都可以访问的私有回购，这可能是灾难性的。</p><p id="05a5" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">请记住，无论您的技术政策有多强，您的系统的安全性取决于其最薄弱的环节。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="13fa" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">现有解决方案</h1><p id="2e5b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">目前，有像<a class="ae ky" href="https://www.sonarqube.org/" rel="noopener ugc nofollow" target="_blank"> SonarQube </a>和<a class="ae ky" href="https://www.sonarlint.org/" rel="noopener ugc nofollow" target="_blank"> SonarLint </a>静态代码分析工具这样的解决方案，它们可以检测代码中是否存在任何密码或密码短语。</p><p id="36d1" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">因此，这些对于检测这些东西是否已经被签入到源代码库中是很有用的。但是大多数时候，当代码已经签入时，这些分析是在服务器端运行的。</p><p id="1618" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在SonarLint的例子中，开发人员甚至可以在签入代码之前在本地运行分析。但是SonarLint无法检测是否有来自<a class="ae ky" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS </a>、<a class="ae ky" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> GCP </a>等的服务账户或密钥。</p><p id="477a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">此外，SonarLint的本地验证主要是一个手动过程，不会阻止某人提交凭证，即使是在本地。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="c8f5" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">解决方案</h1><p id="8629" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">为了克服这个挑战，我试图寻找一些开源项目，并找到了AWS实验室的一个项目，名为<a class="ae ky" href="https://github.com/awslabs/git-secrets" rel="noopener ugc nofollow" target="_blank"> git-secrets </a>。</p><p id="93db" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">该项目可以很好地防止您将秘密和凭证提交到特定于AWS的Git存储库中。</p><p id="a480" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">我在寻找一种解决方案，可以扩展到谷歌云平台(GCP)的凭据。因此，我扩展了这个项目以增加对GCP的支持。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="cedb" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">我如何使用它？</h1><p id="3eba" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">首先，您需要将git-secrets repo克隆到本地机器上。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9bec" class="ne lh it na b gy nf ng l nh ni">git clone <a class="ae ky" href="https://github.com/deshpandetanmay/git-secrets.git" rel="noopener ugc nofollow" target="_blank">https://github.com/deshpandetanmay/git-secrets.git</a><br/>cd git-secrets/</span></pre><p id="23a9" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">如果您在Unix计算机上，则运行以下命令来安装该实用程序:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="995b" class="ne lh it na b gy nf ng l nh ni">sudo make install</span></pre><p id="2f23" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">你可以看看在Windows或macOS上安装这个的说明<a class="ae ky" href="https://github.com/deshpandetanmay/git-secrets#installing-git-secrets" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="595a" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">安装完成后，您需要转到Git repo，在那里您需要使用这个实用程序。为了演示，我将从我的GitHub克隆另一个repo。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c2f9" class="ne lh it na b gy nf ng l nh ni">git clone <a class="ae ky" href="https://github.com/deshpandetanmay/cdr-data-generator.git" rel="noopener ugc nofollow" target="_blank">https://github.com/deshpandetanmay/cdr-data-generator.git</a></span><span id="e1a2" class="ne lh it na b gy nj ng l nh ni">cd cdr-data-generator/</span></pre><p id="7b31" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在，要为这个repo安装<code class="fe nk nl nm na b">git secrets</code>,您可以运行以下命令:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fa82" class="ne lh it na b gy nf ng l nh ni">git secrets --install<br/>✓ Installed commit-msg hook to .git/hooks/commit-msg<br/>✓ Installed pre-commit hook to .git/hooks/pre-commit<br/>✓ Installed prepare-commit-msg hook to .git/hooks/prepare-commit-msg</span></pre><p id="0755" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这将安装可执行文件的秘密扫描，它也将安装三个钩子的回购。</p><p id="e2f8" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">要安装AWS和GCP特定检查:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="aa79" class="ne lh it na b gy nf ng l nh ni">$ git secrets --register-aws<br/>$ git secrets --register-gcp</span></pre><p id="483c" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在你都准备好了。为了测试一切是否如预期的那样工作，我在GCP创建了一个服务JSON账户，并将其复制到我的repo中。</p><p id="3d22" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">现在，当我运行<code class="fe nk nl nm na b">git commit</code>命令时，我看到:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="2608" class="ne lh it na b gy nf ng l nh ni">git commit -m "Updated config"<br/>test.json:4:  "private_key_id": "d30b0f8858589d3d1294aee5b",<br/>test.json:5:  "private_key": "-----BEGIN PRIVATE KEY-----&lt;Actual Private Key&gt;a\n-----END PRIVATE KEY-----\n",</span><span id="456e" class="ne lh it na b gy nj ng l nh ni">[ERROR] Matched one or more prohibited patterns</span><span id="5ada" class="ne lh it na b gy nj ng l nh ni">Possible mitigations:<br/>- Mark false positives as allowed using: git config --add secrets.allowed ...<br/>- Mark false positives as allowed by adding regular expressions to .gitallowed at repository's root directory<br/>- List your configured patterns: git config --get-all secrets.patterns<br/>- List your configured allowed patterns: git config --get-all secrets.allowed<br/>- List your configured allowed patterns in .gitallowed at repository's root directory<br/>- Use --no-verify if this is a one-time false positive</span></pre><p id="eb47" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">它向我显示有一个名为<code class="fe nk nl nm na b">test.json</code>的文件，其中包含一个被禁止的模式，它阻止我提交GCP服务帐户。</p><p id="7f0d" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">在<code class="fe nk nl nm na b">git secrets</code>检测到误报的情况下，您运行下面的命令来忽略检查并继续提交。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="76c6" class="ne lh it na b gy nf ng l nh ni">git commit -m "Updated config" --no-verify</span></pre><p id="cc67" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">这不仅检测源代码文件中的秘密，还检测提交消息中的秘密，并阻止开发人员在提交消息中提交秘密信息。</p><p id="ba75" class="pw-post-body-paragraph ly lz it ma b mb mu ju md me mv jx mg mh mw mj mk ml mx mn mo mp my mr ms mt im bi translated">到目前为止，目前的实现只支持AWS和GCP，我正计划将其扩展到Azure。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="f679" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="0e7e" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">总之，您可以使用上述技术来防止开发人员将凭证提交到源代码存储库中，并帮助保护您的应用程序的安全。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="6544" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">进一步阅读</h1><ol class=""><li id="ed82" class="nn no it ma b mb mc me mf mh np ml nq mp nr mt ns nt nu nv bi translated"><a class="ae ky" href="https://github.com/deshpandetanmay/git-secrets" rel="noopener ugc nofollow" target="_blank">https://github.com/deshpandetanmay/git-secrets</a></li><li id="07d5" class="nn no it ma b mb nw me nx mh ny ml nz mp oa mt ns nt nu nv bi translated"><a class="ae ky" href="https://www.atlassian.com/git/tutorials/git-hooks" rel="noopener ugc nofollow" target="_blank">https://www.atlassian.com/git/tutorials/git-hooks</a></li></ol></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="694c" class="ne lh it na b gy nf ng l nh ni">Hey, if you enjoyed this story, check out <a class="ae ky" href="https://deshpandetanmay.medium.com/membership" rel="noopener">Medium Membership</a>! Just $5/month!</span><span id="f0ce" class="ne lh it na b gy nj ng l nh ni"><em class="ob">Your membership fee directly supports me and other writers you read. You’ll also get full access to every story on Medium.</em></span></pre></div></div>    
</body>
</html>