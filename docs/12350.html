<html>
<head>
<title>Saving Time Using Bitrise Workflows in Your Android Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android项目中使用Bitrise工作流节省时间</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/saving-time-using-bitrise-workflows-in-android-projects-77f1d535d902?source=collection_archive---------14-----------------------#2022-05-30">https://betterprogramming.pub/saving-time-using-bitrise-workflows-in-android-projects-77f1d535d902?source=collection_archive---------14-----------------------#2022-05-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="53ca" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用此CI/CD工具更快地发布应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/beb3589364e4dc18862d8d1208409f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*njrZ-1lDaK5wXp_M"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">照片由<a class="ae kr" href="https://unsplash.com/@loic" rel="noopener ugc nofollow" target="_blank">Djim Loic</a>——<a class="ae kr" href="https://unsplash.com/photos/ft0-Xu4nTvA" rel="noopener ugc nofollow" target="_blank">Unsplash</a>拍摄</p></figure><p id="5613" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在⌛️.软件开发中，时间是非常宝贵的资源重复性任务，如运行单元测试🧪，生成构建📦，或向某些用户发布🏁当开发人员手动创建它们时，可能会成为瓶颈。</p><p id="e976" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">本文的主要思想是展示如何在Android项目中使用Bitrise来节省时间的概述。</p><h1 id="0687" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">出发点</h1><p id="0eeb" class="pw-post-body-paragraph ks kt iq ku b kv mg jr kx ky mh ju la lb mi ld le lf mj lh li lj mk ll lm ln ij bi translated">没有蛋糕食谱，但我认为回答以下问题是一个很好的起点:</p><ul class=""><li id="cbcf" class="ml mm iq ku b kv kw ky kz lb mn lf mo lj mp ln mq mr ms mt bi translated">我的项目中使用的版本系统是什么？</li><li id="58f9" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">我的工作流程中有拉动式请求(PRs)吗？有人在审查我的代码吗？</li><li id="6756" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">有基地分支吗？</li><li id="2666" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">谁需要访问发布来进行测试？</li><li id="7082" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">app发布了吗？</li><li id="0920" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">有没有任务板或者工单系统，我需要在那里更新任务或者bug的进度？</li><li id="02ae" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">我有单元测试要运行吗？我需要运行这些测试的频率是多少？</li><li id="1378" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">我是否有证书文件，例如运行应用程序所需的密钥或令牌？</li></ul><h1 id="38a1" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">在Bitrise上创建工作流</h1><p id="4c3c" class="pw-post-body-paragraph ks kt iq ku b kv mg jr kx ky mh ju la lb mi ld le lf mj lh li lj mk ll lm ln ij bi translated">Bitrise是一个移动CI/CD(持续集成和持续交付)平台，在这里可以创建自动化的工作流。因此，如果您有前面问题的答案，现在是时候创建Bitrise工作流来满足您的需求了。</p><p id="910c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我将展示一个个人项目的两个手动过程，我将其转换为Bitrise工作流。</p><h2 id="8a8d" class="mz lp iq bd lq na nb dn lu nc nd dp ly lb ne nf ma lf ng nh mc lj ni nj me nk bi translated"><strong class="ak">开公关</strong></h2><p id="1fe6" class="pw-post-body-paragraph ks kt iq ku b kv mg jr kx ky mh ju la lb mi ld le lf mj lh li lj mk ll lm ln ij bi translated">从打开一个PR开始，如果它被批准，我需要运行所有的单元测试。之后，我向Firebase应用程序发行版发送一个构建，特定用户将在合并之前测试修改。下图显示了手动流程的工作方式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nl"><img src="../Images/34acffc843873a0566c65a8cd081ff9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Et4YPzwxamOoPz5YQLoIjw.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">手动流程1 —打开采购申请</p></figure><p id="1b3b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在这个手动过程中，检查工具是一个很好的学习案例:</p><ul class=""><li id="562b" class="ml mm iq ku b kv kw ky kz lb mn lf mo lj mp ln mq mr ms mt bi translated">GitLab :存储库所在的位置；</li><li id="b5cd" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated"><strong class="ku ir"> Firebase应用分发</strong>:发布构建的地方。</li></ul><p id="659f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">完全自动化这一手动过程的主要任务是“教会”Bitrise如何:</p><ul class=""><li id="0e07" class="ml mm iq ku b kv kw ky kz lb mn lf mo lj mp ln mq mr ms mt bi translated">克隆存储库；</li><li id="7c07" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">每当开发人员打开一个PR时，监视存储库；</li><li id="d9fb" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">生成构建工件；</li><li id="53f7" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">在Firebase应用程序发行版中分发构建工件。</li></ul><p id="ee59" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要在Bitrise中创建项目，您需要指定指向您的存储库的Git URL。你必须将你的项目定义为一个Android项目。之后，你可能就有了一个工作流模板。</p><p id="9a34" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在工作流模板中，您需要定义一个触发器。什么是工作流应该开始的时间。为此，Bitrise使用Webhooks在Gitlab服务器(或GitHub、Bitbucket，它们都以类似的方式工作)中运行一个额外的逻辑。我有一个图像，显示了为从任何分支(特性分支)到基本分支(主分支)的每个PR定义的触发器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nq"><img src="../Images/c15b346a306e158cd8d983ccfd22ffa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YTvgA_kjQ8o1_Xu8.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">定义触发器—工作流PR</p></figure><p id="ada8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">每次打开PR时，工作流程都应该在Bitrise服务器中运行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nr"><img src="../Images/ad0fa3db73520462a20ae0476bf4f178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xBXktkWhpAMgXjZdaZ8niA.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">工作流程公关</p></figure><p id="8868" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">每次工作流启动时，Bitrise都必须访问存储库。您需要为此设置一个SSH密钥。放心吧！你需要做一次。</p><p id="d19c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">另一个很好的工具是测试报告。执行测试后，Bitrise会生成一份报告:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi ns"><img src="../Images/dea1edcef3ad3bbc2eeb90b7c152bfe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0SM14FYi948Ri4Kf.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">测试报告— Bitrise示例。</p></figure><p id="baaa" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">要使用Firebase应用程序分发来分发您的应用程序，您需要在工作流程中添加一个新步骤。Bitrise提供了一个步骤库。在那里，您可以根据自己的需求找到改进工作流程的步骤。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/fd75b1da3f9f3d04171c38d3c0436a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/0*uu7aepf_H2WkIbaz.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">为Firebase增加一个新步骤。</p></figure><p id="ac16" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">例如，如果您必须更新一张JIRA的机票，您可以寻找一个步骤来处理它。有时你有不止一个选择:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/33648bcc25158b29d8d4f421b8d17709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/0*jOrzcAyrsTe7GHru.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">另一个步骤示例—更新JIRA机票</p></figure><p id="fd80" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">工作流PR帮助我在每次打开PR时运行所有的单元测试。我还定义了一个触发器，当一个新的提交发生在已经打开的PR上时。</p><h2 id="d6fd" class="mz lp iq bd lq na nb dn lu nc nd dp ly lb ne nf ma lf ng nh mc lj ni nj me nk bi translated"><strong class="ak">发布版本</strong></h2><p id="a477" class="pw-post-body-paragraph ks kt iq ku b kv mg jr kx ky mh ju la lb mi ld le lf mj lh li lj mk ll lm ln ij bi translated">手动流程发布版本和手动流程打开请购单之间的区别在于任务:</p><ul class=""><li id="bcfc" class="ml mm iq ku b kv kw ky kz lb mn lf mo lj mp ln mq mr ms mt bi translated">递增版本；</li><li id="d560" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">不要运行单元测试；</li><li id="1235" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">将版本发送到Google Play的测试频道。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nv"><img src="../Images/a848017c920f4ba1f3ab1a2c89d4b4f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fGj1YFFo8XlD6HuXjfDzLw.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">手动流程2 —发布版本</p></figure><p id="35cf" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">首先，我们需要定义触发器。每次我在主分支中提交一个变更(关闭一个PR)都是一个好的选择。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nq"><img src="../Images/4512aa721cbc83dc4b67a36c0a2f84b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y9NEeUyl9sDrQJmm.png"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">定义触发器-主要工作流</p></figure><p id="d6a4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们可以使用以下步骤增加版本:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/725d364003b45b141b076e5ffc13aee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/0*nBqJXZBbgaoh8_jn.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">更改版本代码和版本名称的步骤。</p></figure><p id="5ad7" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这一步有两个输出变量:<code class="fe nx ny nz oa b">ANDROID_VERSION_NAME</code>和<code class="fe nx ny nz oa b">ANDROID_VERSION_CODE</code>。您可以在Bitrise的构建期间修改<code class="fe nx ny nz oa b">build.gradle</code>来捕捉这些值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">使用Step提供的环境变量的代码示例。</p></figure><p id="522c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">Bitrise有一个将构建发送到Google Play的步骤:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/ae4994c49848589b1496287446bf546b.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/0*DfE-VfSyA5k-NVJO.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">Google Play部署</p></figure><p id="72f2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在此步骤中，还可以定义应用程序可用的曲目。在我的情况下，我使它在“测试”轨道可用。在这一步中，您必须在Google Cloud上创建一个服务帐户。之后，您将拥有一个JSON文件，允许Bitrise使用该帐户向Google Play发送构建。</p><h1 id="1aa3" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">最后但同样重要的是…</h1><p id="e01a" class="pw-post-body-paragraph ks kt iq ku b kv mg jr kx ky mh ju la lb mi ld le lf mj lh li lj mk ll lm ln ij bi translated">您可以在Bitrise中创建环境变量和秘密变量:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/db67a73b84eed5c0f2d7059b84eff465.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/0*F5hw0FxuF2eugrDh.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">秘密变量示例。</p></figure><p id="5f21" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这些变量很敏感，所以最好在本地环境(Git会忽略)和Bitrise中定义它们。因此，您可以根据生成您的构建的环境来使用这两种方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="dd49" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">您也可以将变量作为资源提供:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="70fd" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结论</h1><p id="3243" class="pw-post-body-paragraph ks kt iq ku b kv mg jr kx ky mh ju la lb mi ld le lf mj lh li lj mk ll lm ln ij bi translated">自动化耗时的任务在开始时可能是一个挑战，但是在配置工作流的最初努力之后，您将看到在开始时花费的时间将很快恢复。</p><p id="444b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">这篇文章的想法只是给出一个概述。如果您对某个具体步骤感兴趣，请随时发表评论。我很乐意提供链接和参考资料。</p><p id="14eb" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">谢谢！</p></div></div>    
</body>
</html>