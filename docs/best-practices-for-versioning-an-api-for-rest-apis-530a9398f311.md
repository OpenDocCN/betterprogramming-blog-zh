# 版本化 REST APIs 的最佳实践

> 原文：<https://betterprogramming.pub/best-practices-for-versioning-an-api-for-rest-apis-530a9398f311>

## 版本控制通常是事后才想到的，但不应该这样

![](img/5270657dbeea9c238afd62f5977c8e41.png)

由 [SpaceX](https://unsplash.com/@spacex) 提供

# 介绍

API 版本控制通常是开发过程中的事后想法，事实上，为了用户使用和易用性，它应该是设计 API 的最重要的部分。

作为一名 API 爱好者，我想写一篇简短的文章，描述目前可用的各种类型的 API 版本，以改善最终用户的 API 体验。

我马上想到了几个选择:

1.  内嵌路由版本(我的最爱)。
2.  查询字符串(草率)。
3.  接受标题(在我看来，这是事后的想法)。

基本原则是这样的——为了管理你的 API 中的复杂性和突破性的变化，总是对你的 API 进行版本化。简而言之，API 版本控制使您能够在发现重大变更时更快地迭代。

# 何时版本化

如果您不想对 API 进行版本化，或者担心它会在构建过程中增加复杂性，我建议您考虑以下几点:

*   如果用户在 API 发布后遇到输出问题，您最终会更改响应数据以适应这些请求，还是保持原样并忽略用户反馈？
*   如果因为不再需要某个端点而不得不将其从 API 中完全删除，该怎么办？如果没有正确的版本控制，用户可能仍然会到达这个端点，却发现他们收到了一个 404。像 404 这样的状态代码对于开发人员来说并不好玩，不管您是否更新了您的文档——这是开发人员需要采取的额外步骤。
*   您的 API 现在需要一个额外的 POST 方法键。在你原来的 API 上，你不需要它；但是，在您的下一次迭代中，如果没有传递新的键，API 将会中断。
*   由于语义和最佳实践，API 的路由结构正在发生变化。这是最好的；然而，如果你不更新你的 API，你将会给用户留下一个旧的 API 结构，甚至更糟，坏掉。

我可以一直这样下去，但它的要点是，你应该始终版本化你的 API，以确保开发人员有一个清晰和简洁的方式与不断变化和最新的 API 进行交流。

# 如何版本化

在我的世界里，有三种可能的方法来正确地对 API 进行版本控制。按照我最喜欢的到最不喜欢的顺序，这些包括:

1.  URL，也称为路由版本化(如`/v1/:foo/:bar/:baz`)。
2.  通过自定义标题进行版本控制(例如`Accept-Version: v2`)。
3.  查询字符串参数(如`/:foo/:bar/:baz?version=v2`)。

# 利弊

URL 或路由版本是我个人的最爱。对于用户来说，他们正在使用哪个 API 是清楚而简明的，并且允许用户参考正确的文档。

许多框架支持路由定义的版本控制，当它不支持时，您可以简单地构建您的 API，以便它支持路由版本控制。正因为如此，它非常容易实现；然而，它确实增加了 REST API 路径的长度，这是不利的一面。

在我的列表中，自定义头是下一个，因为它们做了它们应该做的事情——它们指定 API 的版本，服务器可以用正确的响应数据做出适当的响应，并动态解析传入的有效负载。

这听起来像是一个简单的解决方案；然而，考虑一下那些只想通过您的开源 API 提取数据而不提供自定义头的开发人员。

特别是，这造成了一个问题，因为用户不应该被迫发送自定义头来简单地指定 API 的版本。此外，在响应之前进行解析需要服务器开销，这可能会增加延迟。

最后但同样重要的是，还有查询字符串版本控制。这被许多开发人员称为不良实践；经常在制作中看到，让我畏缩。

它强调 API 开发，更重要的是，必需的参数和模式是事后才想到的。不惜一切代价远离这个。

# 最后的想法

如有疑问，尽可能使用 URL/路由版本控制。我保证它会简化你的开发过程，让使用你的 API 的开发者开心。

在以后的文章中，我将概述如何使用 REST API 和 Express 通过路由定义手工构建版本控制。同时，请在下面的评论中留下任何问题或想法。

下次见。编码快乐！