<html>
<head>
<title>Integrating Recurring Payments to Your Rails API With Stripe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Stripe将经常性支付集成到Rails API中</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/integrating-recurring-payments-to-your-rails-api-with-stripe-9a16cb539690?source=collection_archive---------6-----------------------#2022-01-31">https://betterprogramming.pub/integrating-recurring-payments-to-your-rails-api-with-stripe-9a16cb539690?source=collection_archive---------6-----------------------#2022-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8c54" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在本文中，我将使用Stripe API it来完成Rails API中的订阅集成。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a2c7e18e5a50bd5bc41a71a789f5d784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IEmPTxktKK9mRq_A_JZHUw.png"/></div></div></figure><p id="a298" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于这个应用程序，我会认为你已经在你的应用程序中有一个用户的模型。万一你还没有，不用担心！我已经发表了一篇关于这个的文章，你可以<a class="ae ln" href="https://hey-feres.medium.com/jwt-auth-in-a-rails-api-561f046cc866" rel="noopener">在这里</a>阅读。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="8291" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">入门指南</h1><p id="73bf" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">如果您按照我的另一篇文章的步骤来创建您的<code class="fe ms mt mu mv b">User</code>模型，或者简单地从GitHub克隆它，您将需要更改Gemfile上的Ruby版本。对于本文，我将使用Ruby 3.0.0，因此您的Gemfile必须如下所示:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="3668" class="na lw iq mv b gy nb nc l nd ne">source '<a class="ae ln" href="https://rubygems.org'" rel="noopener ugc nofollow" target="_blank">https://rubygems.org'</a><br/>git_source(:github) { |repo| "<a class="ae ln" href="https://github.com/#{repo}.git" rel="noopener ugc nofollow" target="_blank">https://github.com/#{repo}.git</a>" }</span><span id="5a44" class="na lw iq mv b gy nf nc l nd ne">ruby '3.0.0'</span><span id="6225" class="na lw iq mv b gy nf nc l nd ne">...</span></pre><p id="07b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，添加条纹宝石到您的宝石档案。</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="71aa" class="na lw iq mv b gy nb nc l nd ne">gem 'stripe'</span></pre><blockquote class="ng nh ni"><p id="d8c9" class="kr ks nj kt b ku kv jr kw kx ky ju kz nk lb lc ld nl lf lg lh nm lj lk ll lm ij bi translated">之后，不要忘记在您的终端中运行<code class="fe ms mt mu mv b"><em class="iq">bundle install</em></code>。</p></blockquote><p id="720f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在你需要在你的应用程序中创建一个stripe初始化文件。为此，在您的终端中运行以下命令:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="0862" class="na lw iq mv b gy nb nc l nd ne">touch config/initializers/stripe.rb</span></pre><p id="7125" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，打开<code class="fe ms mt mu mv b">stripe.rb</code>文件，写下下面的内容:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="3fbe" class="na lw iq mv b gy nb nc l nd ne">Stripe.api_key = Rails.application.credentials.stripe_secret_key</span></pre><p id="8cf8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们没有在凭据文件中添加条带的密钥，所以让我们这样做。</p><p id="b5ce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要打开您的凭证文件，请在您的终端中运行:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="9c8e" class="na lw iq mv b gy nb nc l nd ne">EDITOR=nano rails credentials:edit</span></pre><p id="cf84" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://dashboard.stripe.com/test/apikeys" rel="noopener ugc nofollow" target="_blank">在此获取您的条纹密钥。</a></p><p id="c613" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您的凭据文件必须如下所示:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="dfe6" class="na lw iq mv b gy nb nc l nd ne"># aws:<br/>#   access_key_id: 123<br/>#   secret_access_key: 345<br/># Used as the base secret for all MessageVerifiers in Rails, including the one protecting cookies.</span><span id="4606" class="na lw iq mv b gy nf nc l nd ne">secret_key_base: [YOUR SECRET KEY BASE]<br/>stripe_secret_key: [YOUR SECRET KEY HERE]</span></pre><blockquote class="ng nh ni"><p id="1e4d" class="kr ks nj kt b ku kv jr kw kx ky ju kz nk lb lc ld nl lf lg lh nm lj lk ll lm ij bi translated">注意<code class="fe ms mt mu mv b"><em class="iq">secret_key_base</em></code>是自动生成的，不需要编辑。</p></blockquote></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="5651" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">用户模型</h1><p id="2921" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">首先，我们需要我们的用户有一个Stripe客户ID。我们需要将该ID存储在数据库中，因此运行下面的命令来创建迁移:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="e37c" class="na lw iq mv b gy nb nc l nd ne">rails g migration AddStripeIdToUsers stripe_id<br/>rails db:create db:migrate</span></pre><p id="6fd4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还将为我们的用户添加一个新的验证，以确保条带ID将始终存在。添加到您的用户模型:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="908a" class="na lw iq mv b gy nb nc l nd ne">validates :stripe_id, presence: true, uniqueness: true</span></pre><p id="29bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了在Stripe API上创建我们用户的引用，让我们添加一个对<code class="fe ms mt mu mv b">User</code>模型的回调。</p><p id="87f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将以下代码添加到用户模型中。</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="5626" class="na lw iq mv b gy nb nc l nd ne">...</span><span id="dd8d" class="na lw iq mv b gy nf nc l nd ne">  before_validation :create_stripe_reference, on: :create</span><span id="bc7e" class="na lw iq mv b gy nf nc l nd ne">  def create_stripe_reference<br/>    response = Stripe::Customer.create(email: email)<br/>    self.stripe_id = response.id<br/>  end<br/>end</span></pre><p id="c644" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们需要的话，有一种方法来检索关于客户的条带信息将是非常有趣的。幸运的是，Stripe SDK提供了这个方法，我们也将把它添加到我们的用户模型中。</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="b723" class="na lw iq mv b gy nb nc l nd ne">...</span><span id="0aec" class="na lw iq mv b gy nf nc l nd ne">  def retrieve_stripe_reference<br/>    Stripe::Customer.retrieve(stripe_id)<br/>  end<br/>end</span></pre><p id="98ef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，你的<code class="fe ms mt mu mv b">User</code>模型应该是这样的:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="fb9c" class="na lw iq mv b gy nb nc l nd ne">class User &lt; ApplicationRecord<br/>  has_secure_password</span><span id="3ad2" class="na lw iq mv b gy nf nc l nd ne">  validates :email, uniqueness: { case_sensitive: false }<br/>  validates :stripe_id, presence: true, uniqueness: true</span><span id="1d6e" class="na lw iq mv b gy nf nc l nd ne">  before_validation :create_stripe_reference, on: :create</span><span id="ac7c" class="na lw iq mv b gy nf nc l nd ne">  def create_stripe_reference<br/>    response = Stripe::Customer.create(email: email)<br/>    self.stripe_id = response.id<br/>  end</span><span id="379a" class="na lw iq mv b gy nf nc l nd ne">  def retrieve_stripe_reference<br/>    Stripe::Customer.retrieve(stripe_id)<br/>  end<br/>end</span></pre><p id="6d51" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">厉害！！让我们在控制台上尝试我们的代码，在您的终端上运行:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="31ed" class="na lw iq mv b gy nb nc l nd ne">rails c</span></pre><p id="2d35" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在可以创建一个<code class="fe ms mt mu mv b">User</code>，代码会自动联系Stripe API并创建引用。</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="f644" class="na lw iq mv b gy nb nc l nd ne">User.create(email: "user@test.com", password: "123456")</span></pre><p id="2377" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以使用下面的命令检查该用户的条带ID。</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="850a" class="na lw iq mv b gy nb nc l nd ne">user = User.first<br/>user.stripe_id</span></pre><p id="2ff8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要检索该用户的所有条带信息，请运行:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="b190" class="na lw iq mv b gy nb nc l nd ne">user.retrieve_stripe_reference</span></pre><p id="c530" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">看起来棒极了。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="45ff" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">计划模型</h1><p id="f48a" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">计划模型将负责表示和处理我们将提供的订阅选项的业务规则。</p><p id="a01c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在您的终端上运行:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="685d" class="na lw iq mv b gy nb nc l nd ne">rails g model Plan name description interval:integer price_cents:integer stripe_price_id<br/>rails db:migrate</span></pre><p id="89e8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">仔细看看<code class="fe ms mt mu mv b">Plan</code>的属性:</p><ul class=""><li id="0dad" class="nn no iq kt b ku kv kx ky la np le nq li nr lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">Name</code>将是一个字符串，代表计划的名称；</li><li id="39c4" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">Description</code>将是一个字符串，代表简短的文本，描述计划提供的内容；</li><li id="aeef" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">Interval</code>将是一个整数，代表向用户收费的时间间隔；</li><li id="117a" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">price_cents</code> <strong class="kt ir"> </strong>将是一个整数，表示订阅的值，它需要是美分，因为Stripe使用美分值，这样更容易处理值。</li><li id="f398" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">stripe_price_id</code>将是一个字符串，代表Stripe API中对我们计划的引用。</li></ul><p id="752f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是<code class="fe ms mt mu mv b">Plan</code>车型的外观:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="ddba" class="na lw iq mv b gy nb nc l nd ne">class Plan &lt; ApplicationRecord<br/>  validates :name,<br/>       :stripe_price_id,<br/>       :price_cents, presence: true<br/>  validates :name,<br/>       :stripe_price_id, uniqueness: true</span><span id="0f55" class="na lw iq mv b gy nf nc l nd ne">  enum interval: %i[month year]</span><span id="dfb8" class="na lw iq mv b gy nf nc l nd ne">  before_validation :create_stripe_reference, on: :create</span><span id="16de" class="na lw iq mv b gy nf nc l nd ne">  def create_stripe_reference<br/>    response = Stripe::Price.create({<br/>      unit_amount: price_cents,<br/>      currency: 'usd',<br/>      recurring: { interval: interval },<br/>      product_data: { name: name }<br/>    })</span><span id="5f57" class="na lw iq mv b gy nf nc l nd ne">    self.stripe_price_id = response.id<br/>  end</span><span id="8193" class="na lw iq mv b gy nf nc l nd ne">  def retrieve_stripe_reference<br/>    Stripe::Price.retrieve(stripe_price_id)<br/>  end<br/>end</span></pre><p id="db64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">仔细看看<code class="fe ms mt mu mv b">Plan</code>型号:</p><ul class=""><li id="e160" class="nn no iq kt b ku kv kx ky la np le nq li nr lm ns nt nu nv bi translated">首先，我们定义了一些验证，以确保<code class="fe ms mt mu mv b">name</code>、<code class="fe ms mt mu mv b">stripe_price_id</code>和<code class="fe ms mt mu mv b">price_cents</code>总是存在。我们还定义了一个验证来确保<code class="fe ms mt mu mv b">name</code>和<code class="fe ms mt mu mv b">stripe_price_id</code>是唯一的。</li><li id="0819" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated">之后，我们定义了区间枚举，rails将处理这些选项，所以当我们为区间传递值“月”时，框架将在数据库中存储0，当我们传递值“年”时，它将存储1。</li><li id="e44a" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated">然后我们定义了一个回调来创建对Stripe API上的<code class="fe ms mt mu mv b">Plan</code>的引用。</li><li id="4c7b" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">create_stripe_reference</code>方法将负责回调时触发的所有逻辑。</li><li id="7a5b" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">retrieve_stripe_reference</code>基本上会返回我们<code class="fe ms mt mu mv b">Plan</code>的条带引用。</li></ul><p id="b6be" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们在控制台上试试我们的新模型。在您的终端中运行:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="6094" class="na lw iq mv b gy nb nc l nd ne">rails c</span></pre><p id="00d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您现在可以创建一个<code class="fe ms mt mu mv b">Plan</code>，代码将自动联系Stripe API并创建引用:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="c666" class="na lw iq mv b gy nb nc l nd ne"># Month Subscription<br/>Plan.create(<br/>  name: 'Month Subscription',<br/>  description: 'This subscription will be charged every month',<br/>  interval: 'month',<br/>  price_cents: 500<br/>)</span><span id="cc6f" class="na lw iq mv b gy nf nc l nd ne"># Year Subscription<br/>Plan.create(<br/>  name: 'Year Subscription',<br/>  description: 'This subscription will be charged every year. Save $10 with this subscription.',<br/>  interval: 'year',<br/>  price_cents: 5000<br/>)</span></pre><p id="9b54" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要检索某些计划的所有条带信息，请运行:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="cd57" class="na lw iq mv b gy nb nc l nd ne"># The 1 represents the ID of the record.<br/>Plan.find(1).retrieve_stripe_reference</span></pre><p id="da6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://stripe.com/docs/api/prices/object" rel="noopener ugc nofollow" target="_blank">条纹价格单据</a>。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="4598" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">订阅模式</h1><p id="d5eb" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">订阅模型将负责表示和处理用户订阅的业务规则。</p><p id="b9a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在您的终端上运行以下命令:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="b225" class="na lw iq mv b gy nb nc l nd ne">rails g model Subscription plan:references user:references active:boolean stripe_id<br/>rails db:migrate</span></pre><p id="3ef0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">进一步了解订阅属性:</p><ul class=""><li id="277a" class="nn no iq kt b ku kv kx ky la np le nq li nr lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">plan</code>将是对正在购买的计划的引用；</li><li id="9e3e" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">user</code>将是购买计划的用户的参考；</li><li id="0da6" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">active</code>将是一个布尔值，表示订阅是否仍然有效。</li><li id="47b2" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">stripe_id</code> <strong class="kt ir"> </strong>将是一个字符串，表示对Stripe API中订阅的引用。</li></ul><p id="9a75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开迁移create_subscriptions，并确保定义活动属性的默认值:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="1283" class="na lw iq mv b gy nb nc l nd ne">...<br/>t.boolean :active, default: true<br/>...</span></pre><p id="ae08" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，我们来编写<code class="fe ms mt mu mv b">Subscription</code>模型。它应该是这样的:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="0711" class="na lw iq mv b gy nb nc l nd ne">class Subscription &lt; ApplicationRecord<br/>  attr_accessor :card_number, :exp_month, :exp_year, :cvc</span><span id="ced1" class="na lw iq mv b gy nf nc l nd ne">  belongs_to :plan<br/>  belongs_to :user</span><span id="6737" class="na lw iq mv b gy nf nc l nd ne">  validates :stripe_id, presence: true, uniqueness: true</span><span id="29a3" class="na lw iq mv b gy nf nc l nd ne">  before_validation :create_stripe_reference, on: :create</span><span id="0566" class="na lw iq mv b gy nf nc l nd ne">  def create_stripe_reference<br/>    Stripe::Customer.create_source(<br/>      user.stripe_id,<br/>      { source: generate_card_token }<br/>    )</span><span id="31b4" class="na lw iq mv b gy nf nc l nd ne">    response = Stripe::Subscription.create({<br/>      customer: user.stripe_id,<br/>      items: [<br/>        { price: plan.stripe_price_id }<br/>      ]<br/>    })</span><span id="f5f2" class="na lw iq mv b gy nf nc l nd ne">    self.stripe_id = response.id<br/>  end</span><span id="54f7" class="na lw iq mv b gy nf nc l nd ne">  def generate_card_token<br/>    Stripe::Token.create({<br/>      card: {<br/>        number: card_number,<br/>        exp_month: exp_month,<br/>        exp_year: exp_year,<br/>        cvc: cvc<br/>      }<br/>    }).id<br/>  end<br/>end</span></pre><p id="c87d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">仔细看看<code class="fe ms mt mu mv b">Subscription</code>型号:</p><ul class=""><li id="c8cf" class="nn no iq kt b ku kv kx ky la np le nq li nr lm ns nt nu nv bi translated">首先，我们定义了一些虚拟属性。我们不会存储这些数据，因为它们很敏感。所以Stripe会帮我们处理。</li><li id="8131" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated">然后，我们定义了模型的关系，a属于计划和用户。</li><li id="7661" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated">我们将验证的唯一属性是<code class="fe ms mt mu mv b">stripe_id</code>，它必须存在并且是唯一的。</li><li id="4b07" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated">我们还有一个回调函数，它将在记录创建验证之前被触发。</li><li id="922c" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">create_stripe_reference</code>将负责在Stripe API上创建我们订阅的引用。请注意，在Stripe API上创建订阅之前，我们为客户创建了一个来源，这将是付款方式。</li><li id="c22f" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe ms mt mu mv b">generate_card_token</code>将负责将卡数据传递给Stripe API并返回一个令牌。传递令牌比传递卡数据更安全，这就是Stripe以这种方式处理支付源的原因。</li></ul><p id="c410" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们在控制台上试试我们的新模型。在您的终端中运行:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="b18d" class="na lw iq mv b gy nb nc l nd ne">rails c</span></pre><p id="5544" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在可以创建一个<code class="fe ms mt mu mv b">Subscription</code>，代码会自动联系Stripe API并创建引用。</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="5d90" class="na lw iq mv b gy nb nc l nd ne">Subscription.create(<br/>  card_number: '5555555555554444',<br/>  exp_month: 06,<br/>  exp_year: 2029,<br/>  cvc: '123',<br/>  user_id: User.first.id,<br/>  plan_id: Plan.first.id,<br/>  active: true<br/>)</span></pre><blockquote class="ng nh ni"><p id="c70e" class="kr ks nj kt b ku kv jr kw kx ky ju kz nk lb lc ld nl lf lg lh nm lj lk ll lm ij bi translated">请注意，条带具有预定义的允许测试卡号。可以在这里查看:<a class="ae ln" href="https://stripe.com/docs/testing" rel="noopener ugc nofollow" target="_blank">条纹测试卡</a>。</p></blockquote><p id="02a0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">太棒了。！我们的订阅已经开始运行，您可以在<a class="ae ln" href="https://dashboard.stripe.com/test/subscriptions" rel="noopener ugc nofollow" target="_blank"> Stripe仪表盘</a>上看到。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/fabe349f1f872e0ee54fe1b2bc95efdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KxNxCJo68FTJuFeJzSL-Aw.png"/></div></div><p class="oc od gj gh gi oe of bd b be z dk translated">条纹仪表板</p></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="17ee" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">取消订阅</h1><p id="dc76" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">有时，我们需要省钱，一些订阅必须取消，让我们的程序允许取消。</p><p id="34b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们要做的基本上是在active为false时更新Stripe API上的记录和引用。我们来编码吧。</p><p id="c704" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">添加一个回调以取消对Stripe API的订阅，并带有活动条件。</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="f72a" class="na lw iq mv b gy nb nc l nd ne">...</span><span id="84d1" class="na lw iq mv b gy nf nc l nd ne">before_update :cancel_stripe_subscription, if: :subscription_inactive?</span><span id="9346" class="na lw iq mv b gy nf nc l nd ne">...</span></pre><p id="7c75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们还需要添加回调调用的方法和定义条件的方法。</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="2e1c" class="na lw iq mv b gy nb nc l nd ne">...</span><span id="9233" class="na lw iq mv b gy nf nc l nd ne">  def cancel_stripe_subscription<br/>    Stripe::Subscription.delete(stripe_id)<br/>  end</span><span id="ed93" class="na lw iq mv b gy nf nc l nd ne">  def subscription_inactive?<br/>    !active<br/>  end<br/>end</span></pre><p id="6fd2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要测试它是否工作，请转到您的rails控制台并运行以下命令:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="78d1" class="na lw iq mv b gy nb nc l nd ne">Subscription.first.update(active: false)</span></pre><p id="bf43" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在订阅被取消了，你可以在你的<a class="ae ln" href="https://dashboard.stripe.com/test/subscriptions?status=canceled" rel="noopener ugc nofollow" target="_blank"> Stripe仪表盘</a>上查看。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/78e12b60a0a633474e1ea8c062cb13b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xMQKIfg11-53Coj2pEr6w.png"/></div></div><p class="oc od gj gh gi oe of bd b be z dk translated">条纹仪表板</p></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="f4a9" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">控制器呢？</h1><p id="1ba7" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">在这篇文章中，我们将只使用控制器来显示、创建和更新订阅。一旦Plans CRUD更多的是一个管理性的东西，我现在就不会为它创建一个控制器。</p><h2 id="725c" class="na lw iq bd lx og oh dn mb oi oj dp mf la ok ol mh le om on mj li oo op ml oq bi translated">订阅控制器</h2><p id="757f" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">要创建订阅控制器，请在终端中运行以下命令:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="496b" class="na lw iq mv b gy nb nc l nd ne">rails g controller subscriptions show create update</span></pre><p id="2cbe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面的命令会将一些路由添加到我们的routes文件中，但是一旦我们需要名称空间<code class="fe ms mt mu mv b">api/v1</code>中的路由，我们就需要修改它。</p><p id="8c55" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以你的路线可能看起来像这样:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="b702" class="na lw iq mv b gy nb nc l nd ne">Rails.application.routes.draw do<br/>  namespace :api do<br/>    namespace :v1 do<br/>      post '/signup', to: 'users#signup'<br/>      post '/signin', to: 'users#signin'<br/>      get  '/signedin', to: 'users#signedin'</span><span id="da7b" class="na lw iq mv b gy nf nc l nd ne">      resources :subscriptions, only: %i[show create update]<br/>    end<br/>  end<br/>end</span></pre><p id="3e08" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">生成控制器之后，我们来写。因为这是一个非常通用的rails控制器，所以我不会在本文中解释它的代码。</p><p id="68a6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您的控制器应该是这样的:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="df8e" class="na lw iq mv b gy nb nc l nd ne">module Api<br/>  module V1<br/>    class SubscriptionsController &lt; ApplicationController<br/>      before_action :set_subscription, except: %i[create]</span><span id="6cc1" class="na lw iq mv b gy nf nc l nd ne">      def show<br/>        render json: <a class="ae ln" href="http://twitter.com/subscription" rel="noopener ugc nofollow" target="_blank">@subscription</a><br/>      end</span><span id="81cf" class="na lw iq mv b gy nf nc l nd ne">      def create<br/>        <a class="ae ln" href="http://twitter.com/subscription" rel="noopener ugc nofollow" target="_blank">@subscription</a> = Subscription.new(subscription_params)</span><span id="56d4" class="na lw iq mv b gy nf nc l nd ne">        if <a class="ae ln" href="http://twitter.com/subscription" rel="noopener ugc nofollow" target="_blank">@subscription</a>.save<br/>          render json: <a class="ae ln" href="http://twitter.com/subscription" rel="noopener ugc nofollow" target="_blank">@subscription</a>, status: :created<br/>        else<br/>          render json: <a class="ae ln" href="http://twitter.com/subscription" rel="noopener ugc nofollow" target="_blank">@subscription</a>.errors, status: :unprocessable_entity<br/>        end<br/>      end</span><span id="31d0" class="na lw iq mv b gy nf nc l nd ne">      def update<br/>        if <a class="ae ln" href="http://twitter.com/subscription" rel="noopener ugc nofollow" target="_blank">@subscription</a>.update(subscription_params)<br/>          render json: <a class="ae ln" href="http://twitter.com/subscription" rel="noopener ugc nofollow" target="_blank">@subscription</a><br/>        else<br/>          render json: <a class="ae ln" href="http://twitter.com/subscription" rel="noopener ugc nofollow" target="_blank">@subscription</a>.errors, status: :unprocessable_entity<br/>        end<br/>      end</span><span id="48f4" class="na lw iq mv b gy nf nc l nd ne">      private</span><span id="c13d" class="na lw iq mv b gy nf nc l nd ne">      def set_subscription<br/>        <a class="ae ln" href="http://twitter.com/subscription" rel="noopener ugc nofollow" target="_blank">@subscription</a> = Subscription.find(params[:id])<br/>      end</span><span id="fcfd" class="na lw iq mv b gy nf nc l nd ne">      def subscription_params<br/>        params.require(:data).permit(:card_number, :exp_month, :exp_year, :cvc, :user_id, :plan_id, :active)<br/>      end<br/>    end<br/>  end<br/>end</span></pre></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="3eec" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">测试控制器—请求</h1><p id="b88c" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">我将使用<a class="ae ln" href="https://paw.cloud" rel="noopener ugc nofollow" target="_blank"> Paw </a>来运行请求并测试控制器，但是您将使用任何HTTP客户端获得相同的结果，比如Postman或失眠症。</p><p id="02f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用以下命令启动本地服务器:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="b1bd" class="na lw iq mv b gy nb nc l nd ne">rails s</span></pre><h2 id="b679" class="na lw iq bd lx og oh dn mb oi oj dp mf la ok ol mh le om on mj li oo op ml oq bi translated">创建请求</h2><p id="0131" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">该请求将触发订阅创建。</p><p id="b6fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">动作:<code class="fe ms mt mu mv b">POST</code></p><p id="6072" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">端点:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="ffa9" class="na lw iq mv b gy nb nc l nd ne"><a class="ae ln" href="http://localhost:3001/api/v1/subscriptions" rel="noopener ugc nofollow" target="_blank">http://localhost:3000<strong class="mv ir">/api/v1/subscriptions</strong></a></span></pre><p id="0c17" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">标题:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="bde2" class="na lw iq mv b gy nb nc l nd ne">Content-Type: application/json</span></pre><p id="2209" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正文:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="de03" class="na lw iq mv b gy nb nc l nd ne">{<br/>  "data": {<br/>    "card_number": "5555555555554444",<br/>    "exp_month": "09",<br/>    "exp_year": "2029",<br/>    "cvc": "123",<br/>    "user_id": "1",<br/>    "plan_id": "1"<br/>  }<br/>}</span></pre><p id="bb78" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对此请求的响应应符合以下格式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/dd97d6a22b17c9d869039841dc13007e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*syu2Qlbmt8ZXJl-78CRelA.png"/></div></div><p class="oc od gj gh gi oe of bd b be z dk translated">创建响应</p></figure><h2 id="9dfc" class="na lw iq bd lx og oh dn mb oi oj dp mf la ok ol mh le om on mj li oo op ml oq bi translated">更新请求</h2><p id="5b78" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">此请求将取消订阅。</p><p id="6b03" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">动作:<code class="fe ms mt mu mv b">PUT</code>或<code class="fe ms mt mu mv b">PATCH</code></p><p id="9ae7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">端点:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="57ce" class="na lw iq mv b gy nb nc l nd ne"><a class="ae ln" href="http://localhost:3001/api/v1/subscriptions" rel="noopener ugc nofollow" target="_blank">http://localhost:3000<strong class="mv ir">/api/v1/subscriptions</strong></a><strong class="mv ir">/3</strong></span></pre><blockquote class="ng nh ni"><p id="4e75" class="kr ks nj kt b ku kv jr kw kx ky ju kz nk lb lc ld nl lf lg lh nm lj lk ll lm ij bi translated">上面端点上的数字3表示我们要更新的记录的ID，您可以根据您的订阅ID来更改它。</p></blockquote><p id="9944" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">标题:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="7929" class="na lw iq mv b gy nb nc l nd ne">Content-Type: application/json</span></pre><p id="45a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正文:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="ef96" class="na lw iq mv b gy nb nc l nd ne">{<br/>  "data": {<br/>    "active": false<br/>  }<br/>}</span></pre><p id="23c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此请求的响应应符合以下格式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/21977d9919c4fcbd3636d7bbd47c51e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*idZzVSOxXszM3JKVP-k25A.png"/></div></div><p class="oc od gj gh gi oe of bd b be z dk translated">更新响应</p></figure><h2 id="06ab" class="na lw iq bd lx og oh dn mb oi oj dp mf la ok ol mh le om on mj li oo op ml oq bi translated">演出请求</h2><p id="b4e6" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">该请求将检索订阅。</p><p id="8294" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">动作:<strong class="kt ir">获取</strong></p><p id="f45d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">端点:</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="be89" class="na lw iq mv b gy nb nc l nd ne"><a class="ae ln" href="http://localhost:3001/api/v1/subscriptions" rel="noopener ugc nofollow" target="_blank">http://localhost:3000<strong class="mv ir">/api/v1/subscriptions</strong></a><strong class="mv ir">/3</strong></span></pre><blockquote class="ng nh ni"><p id="bd86" class="kr ks nj kt b ku kv jr kw kx ky ju kz nk lb lc ld nl lf lg lh nm lj lk ll lm ij bi translated">上面端点上的数字3表示我们要更新的记录的ID，您可以根据您的订阅ID来更改它。</p></blockquote><p id="685e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此请求的响应应符合以下格式:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/a547f2f047de40d033ed1f4e1e77ea69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mc97zNjy9EWV5cNmFatUSw.png"/></div></div><p class="oc od gj gh gi oe of bd b be z dk translated">显示响应</p></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="bea5" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">结论</h1><p id="7754" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">Stripe使支付系统集成变得非常简单和容易。</p><p id="62cf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有许多关于Stripe API的资源没有在本文中探讨。我打算在未来发布另一个，关于支付意向和webhooks，用于接收更新订阅状态的意向。</p><p id="1572" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以在这里查看完整的Stripe文档。</p><pre class="kg kh ki kj gt mw mv mx my aw mz bi"><span id="aac1" class="na lw iq mv b gy nb nc l nd ne"><strong class="mv ir">Want to Connect?</strong></span><span id="8439" class="na lw iq mv b gy nf nc l nd ne"><a class="ae ln" href="https://twitter.com/BrunoFeres4" rel="noopener ugc nofollow" target="_blank">Connect on Twitter</a>.</span></pre></div></div>    
</body>
</html>