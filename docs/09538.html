<html>
<head>
<title>How to Create Your Own Sublime Text Plugin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建自己的Sublime文本插件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-your-own-sublime-text-plugin-2731e75f52d5?source=collection_archive---------2-----------------------#2021-09-07">https://betterprogramming.pub/how-to-create-your-own-sublime-text-plugin-2731e75f52d5?source=collection_archive---------2-----------------------#2021-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="80a7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python为Sublime文本构建自定义日志格式化程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b711774b7a454c1081880ff4c124500f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i7ME9Ufxpb59MY1C"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@glencarrie?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">格伦·凯莉</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="d470" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Sublime Text是一个干净、快速、轻量级的文本编辑器。它对插件的丰富支持也使它具有可扩展性和强大的功能。在今天的教程中，我们将研究如何创建我们自己的插件。</p><h1 id="68b3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">插件思想——一个定制的日志格式化程序</h1><p id="c036" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">假设我们有一个记录所有API请求和响应的日志记录器。下面是一个请求示例:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="6ecc" class="mx lw it mt b gy my mz l na nb">PurchaseRequest(itemId: 375, name: "Spook", price: Amount(value: 100, currency: 'USD'), insurancePolicies=[20931, 12035])</span></pre><p id="00f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它告诉我们，我们正在用<code class="fe nc nd ne mt b">100$</code>购买一个<code class="fe nc nd ne mt b">Spook</code>。物品的<code class="fe nc nd ne mt b">id</code>为<code class="fe nc nd ne mt b">375</code>，另外还附有两份保险，保单号为<code class="fe nc nd ne mt b">20931</code>和<code class="fe nc nd ne mt b">12035</code>。</p><p id="0510" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际内容并不重要，但有趣的是日志数据的结构。它记录类名，比如<code class="fe nc nd ne mt b">PurchaseRequest</code>和<code class="fe nc nd ne mt b">Amount</code>。它还包含不同类型的括号，<code class="fe nc nd ne mt b">()</code>表示类中的属性，<code class="fe nc nd ne mt b">[]</code>表示数组。</p><p id="65cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在都在一行，很难读懂。我们希望将其重新格式化为:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="c865" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据类似于JSON，但不完全是JSON。由于它是非标准的，很难找到一个现有的插件来满足我们的需求。所以，让我们来建造一个。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="5f44" class="lv lw it bd lx ly no ma mb mc np me mf jz nq ka mh kc nr kd mj kf ns kg ml mm bi translated">入门指南</h1><p id="0124" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">通过工具&gt;开发者&gt;新建插件创建一个新插件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/aea850c277f91b625420c902955d3028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*fUvsyr8Msl9LshZ9nXr8gw.png"/></div></figure><p id="7f73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将创建一个包含以下内容的新文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8430" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个插件的名字叫做<code class="fe nc nd ne mt b">Example</code>。它所做的只是插入字符串“Hello World！”在文件的最开始。</p><p id="7615" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在控制台上测试它。点击查看&gt;显示控制台(或通过macOS上的键盘快捷键<code class="fe nc nd ne mt b">ctrl + `</code>)。在弹出窗口中，键入以下内容:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="8a22" class="mx lw it mt b gy my mz l na nb">view.run_command("example")</span></pre><p id="79c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将调用插件并打印调试日志(如果有的话)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/6ca7a76f8e7f49da89137b7a5f53902d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ktq02v-UenMpkznOa41ddg.png"/></div></div></figure><p id="16ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行示例插件，我们现在应该在文档的开头添加了<code class="fe nc nd ne mt b">Hello World!</code>。</p><p id="4b6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续建造一些真实的东西。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="4922" class="lv lw it bd lx ly no ma mb mc np me mf jz nq ka mh kc nr kd mj kf ns kg ml mm bi translated">一个<code class="fe nc nd ne mt b">Format</code>功能</h1><p id="a68d" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这就像一个小小的采访编码练习。</p><p id="8b82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要在每个括号<code class="fe nc nd ne mt b">(</code>、<code class="fe nc nd ne mt b">{</code>和<code class="fe nc nd ne mt b">[</code>后插入一个换行符。我们还需要在每一个结束括号<code class="fe nc nd ne mt b">)</code>、<code class="fe nc nd ne mt b">}</code>、<code class="fe nc nd ne mt b">]</code>和逗号本身之前加一个。我们应该忽略任何现存的空格和换行。最后，我们跟踪一个计数器，以了解每行需要多少缩进。</p><p id="f62b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是片段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h1 id="4a31" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">最终确定插件</h1><p id="9709" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">将插件重命名为<code class="fe nc nd ne mt b">BracketFormatter</code>，并使用上面的格式函数将实现替换为以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="3964" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，将其保存为文件夹下的<code class="fe nc nd ne mt b">BracketFormatter.py</code>:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="29a1" class="mx lw it mt b gy my mz l na nb">/Users/&lt;your_username&gt;/Library/Application Support/Sublime Text/Packages/User</span></pre><p id="ef9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">别忘了用你的用户名替换<code class="fe nc nd ne mt b">&lt;your_username&gt;</code>。</p><p id="eaea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至此，我们的插件已经完成，我们可以随时从控制台调用它。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="cf63" class="mx lw it mt b gy my mz l na nb">view.run_command("bracket_formatter")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/cab2b39f0140f3090de53f3c96d18f0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0Uu9FXrODSOZwF9upO4HQ.png"/></div></div></figure><p id="9b6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更容易运行，我们还可以创建一个<code class="fe nc nd ne mt b">sublime-commands</code>。在同一个文件夹下，创建一个文件<code class="fe nc nd ne mt b">BracketFormatter.sublime-commands</code>并输入以下内容:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="cf16" class="mx lw it mt b gy my mz l na nb">[<br/>    {<br/>        "caption": "BracketFormatter: format my request log",<br/>        "command": "bracket_formatter"<br/>    }<br/>]</span></pre><p id="6cdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们现在就可以像平常一样从命令面板<strong class="lb iu"/>(MAC OS上的键盘快捷键是<code class="fe nc nd ne mt b">cmd</code> + <code class="fe nc nd ne mt b">shift</code> + <code class="fe nc nd ne mt b">P</code>)中运行命令了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/a03a399c3e4ea77f7308439b1f463623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U__gLSYEKi-HzIVGQ_TnAA.png"/></div></div></figure></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="16ad" class="lv lw it bd lx ly no ma mb mc np me mf jz nq ka mh kc nr kd mj kf ns kg ml mm bi translated">结论</h1><p id="a0d4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">今天到此为止。这不是一个非常复杂的插件。但希望它可以作为一个切入点，或者启发你去创造一些更有趣的东西！</p><p id="0900" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记查看官方文档<a class="ae ky" href="https://www.sublimetext.com/docs/api_reference.html" rel="noopener ugc nofollow" target="_blank">中所有可用插件API的列表。</a></p><p id="8204" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像往常一样，代码片段可以在GitHub上找到。</p></div></div>    
</body>
</html>