<html>
<head>
<title>How to Do Pipeline Forensics, DFIR, or Just Find Files Quickly With Recon</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何进行管道取证，DFIR，或者只是用Recon快速找到文件</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/using-recon-for-pipeline-forensics-dfir-or-just-finding-files-3a220a71efe6?source=collection_archive---------6-----------------------#2022-11-19">https://betterprogramming.pub/using-recon-for-pipeline-forensics-dfir-or-just-finding-files-3a220a71efe6?source=collection_archive---------6-----------------------#2022-11-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c281" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">开源工具的快速介绍</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/3f5dbd4a65a7977fd38ef395c027d5d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*Jcw4BdzGabsHPNhzGp50RA.png"/></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="874a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Recon是一个内置于Rust的开源工具🦀，具有查找文件的出色性能和人体工程学设计。</p><p id="e714" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可能想要:</p><ul class=""><li id="802d" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">在管道中运行一些验证或检查——例如，在构建Javascript时不生成二进制文件，</li><li id="577c" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">或者，您可能希望在特定主机上运行数字取证任务，以查找特定的恶意软件。</li><li id="7e5e" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">或者，您可能想要一把瑞士军刀来使用SQL查找文件。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mc"><img src="../Images/a8667da77c6c1aea9b6ae90bd18665e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DVDn7aXyR4kjYE8TrSNHyQ.gif"/></div></div><p class="kn ko gj gh gi kp kq bd b be z dk translated">作者图片</p></figure><p id="0745" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看这里的Github回购。</p><h1 id="1793" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">关键特征</h1><ul class=""><li id="5477" class="lo lp iq kt b ku mz kx na la nb le nc li nd lm lt lu lv lw bi translated"><strong class="kt ir">使用SQL查询文件</strong> —使用SQL查询的全部功能查找文件</li><li id="0987" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><strong class="kt ir">使用摘要查找内容</strong> —使用SHA256/512、md5、crc32查找副本，使用其他匹配器查找重要匹配，以定位主机上的工件</li><li id="8cee" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><strong class="kt ir">使用YARA查找恶意软件或二进制文件</strong> —使用YARA规则高效匹配二进制文件</li><li id="8149" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><strong class="kt ir">微调您的搜索运行时间</strong> —您可以只选择您需要的处理，以便快速覆盖更多文件</li><li id="b4f5" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><strong class="kt ir">构建你自己的脚本</strong>——用<code class="fe ne nf ng nh b">--xargs</code>将<code class="fe ne nf ng nh b">recon</code>结果传输到你自己的脚本</li><li id="adc7" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated"><strong class="kt ir">导出</strong> —使用<code class="fe ne nf ng nh b">--csv</code>或<code class="fe ne nf ng nh b">--json</code>，或将<code class="fe ne nf ng nh b">recon.db</code>上传到自己的服务器进行分析</li></ul><h1 id="ac29" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">正在侦察</h1><p id="3533" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">Recon是免费和开源的。对于macOS:</p><pre class="kg kh ki kj gt nl nh nm bn nn no bi"><span id="2d16" class="np mi iq nh b be nq nr l ns nt">$ brew tap rusty-ferris-club/tap &amp;&amp; brew install recon</span></pre><p id="b6bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">否则，从<a class="ae ln" href="https://github.com/rusty-ferris-club/recon/releases" rel="noopener ugc nofollow" target="_blank">释放</a>中抓取一个释放并运行<code class="fe ne nf ng nh b">recon --help</code>:</p><pre class="kg kh ki kj gt nl nh nm bn nn no bi"><span id="4a25" class="np mi iq nh b be nq nr l ns nt">$ recon --help<br/>SQL over files with security processing and tests<br/><br/>Usage: recon [OPTIONS]<br/><br/>Options:<br/>  -c, --config &lt;CONFIG_FILE&gt;  Point to a configuration<br/>  -r, --root &lt;ROOT&gt;           Target folder to scan<br/>  -q, --query &lt;SQL&gt;           Query with SQL<br/>  -f, --file &lt;DB_FILE&gt;        Use a specific DB file (file or :memory: for in memory) [default: recon.db]<br/>  -d, --delete                Clear data: delete existing cache database before running<br/>  -u, --update                Always walk files and update DB before query. Leave off to run query on existing recon.db.<br/>  -a, --all                   Walk all files (dont consider .gitignore)<br/>      --no-progress           Don't display progress bars<br/>  -m, --inmem                 Don't cache index to disk, run in-memory only<br/>      --xargs                 Output as xargs formatted list<br/>      --json                  Output as JSON<br/>      --csv                   Output as CSV<br/>      --no-style              Output as a table with no styles<br/>      --fail-some             Exit code failure if *some* files are found<br/>      --fail-none             Exit code failure if *no* files are found<br/>      --verbose               Show logs<br/>  -h, --help                  Print help information<br/>  -V, --version               Print version information</span></pre><h1 id="2a74" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">更好的“发现”</h1><p id="7481" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">你还记得<code class="fe ne nf ng nh b">find</code>的所有论点吗？我也没有。Recon通过让您使用SQL简化了文件查找:</p><pre class="kg kh ki kj gt nl nh nm bn nn no bi"><span id="3e50" class="np mi iq nh b be nq nr l ns nt">$ recon -q "select path,mode,uid from files where ext='rs'"<br/>┌────────────────────────────┬────────────┬─────┐<br/>│ path                       │ mode       │ uid │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./xtask/src/main.rs        │ -rw-rw-r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/tests/cli_tests.rs │ -rw-r--r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/src/os.rs          │ -rw-r--r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/src/out.rs         │ -rw-r--r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/src/bin/recon.rs   │ -rw-r--r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/src/config.rs      │ -rw-r--r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/src/lib.rs         │ -rw-r--r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/src/data.rs        │ -rw-r--r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/src/processing.rs  │ -rw-r--r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/src/workflow.rs    │ -rw-r--r-- │ 501 │<br/>├────────────────────────────┼────────────┼─────┤<br/>│ ./recon/src/matching.rs    │ -rw-r--r-- │ 501 │<br/>└────────────────────────────┴────────────┴─────┘<br/>11 of 233 files in 5.565875ms</span></pre><p id="82ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">用通常的<code class="fe ne nf ng nh b">xargs</code>组合对结果做些什么怎么样？</p><pre class="kg kh ki kj gt nl nh nm bn nn no bi"><span id="f4de" class="np mi iq nh b be nq nr l ns nt">$ recon -q "select path from files where ext='rs'" --xargs | xargs echo<br/>./xtask/src/main.rs ./recon/tests/cli_tests.rs ./recon/src/os.rs ./recon/src/out.rs ./recon/src/bin/recon.rs ./recon/src/config.rs ./recon/src/lib.rs ./recon/src/data.rs ./recon/src/processing.rs ./recon/src/workflow.rs ./recon/src/matching.rs</span></pre><h1 id="01a1" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">强大的取证工具</h1><p id="263b" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">对于试图定位易受攻击的二进制文件或恶意软件以及手头的任何其他DFIR任务的安全专家来说，Recon也很有用。</p><p id="4d40" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以<strong class="kt ir">配置处理器和匹配器</strong>，以防您需要一些计算密集型数据用于查询或匹配，例如:</p><ul class=""><li id="f98c" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">摘要或校验和(md5、SHAxxx、crc32)</li><li id="eec7" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">路径，内容匹配</li><li id="ab8f" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">YARA规则</li><li id="84ef" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">更多信息，请参见<a class="ae ln" href="https://github.com/rusty-ferris-club/recon/tree/master/examples" rel="noopener ugc nofollow" target="_blank">https://github . com/rusty-ferris-club/recon/tree/master/examples</a></li></ul><p id="c60e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">让我们添加二进制检测。</strong>创建一个名为<code class="fe ne nf ng nh b">config.yaml</code>的配置文件:</p><pre class="kg kh ki kj gt nl nh nm bn nn no bi"><span id="6870" class="np mi iq nh b be nq nr l ns nt">source:<br/>  computed_fields:<br/>    is_binary: true</span></pre><blockquote class="nu nv nw"><p id="218c" class="kr ks nx kt b ku kv jr kw kx ky ju kz ny lb lc ld nz lf lg lh oa lj lk ll lm ij bi translated"><em class="iq">你知道吗？检测文件是否为二进制文件的常用方法是从中读取一块数据(通常为1k字节)并在其中搜索任何非文本字节。很大程度上:没有内置的操作系统元数据“标志”来指示文件是否是二进制文件。</em></p></blockquote><p id="8aca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以使用<code class="fe ne nf ng nh b">-m</code>来避免将任何缓存保存到磁盘。</p><pre class="kg kh ki kj gt nl nh nm bn nn no bi"><span id="0b8c" class="np mi iq nh b be nq nr l ns nt">$ recon -m -c config.yaml -q 'select path,is_binary,mode from files limit 6'<br/>┌───────────────┬───────────┬────────────┐<br/>│ path          │ is_binary │ mode       │<br/>├───────────────┼───────────┼────────────┤<br/>│ ./os.rs       │ 0         │ -rw-r--r-- │<br/>├───────────────┼───────────┼────────────┤<br/>│ ./out.rs      │ 0         │ -rw-r--r-- │<br/>├───────────────┼───────────┼────────────┤<br/>│ ./bin/main.rs │ 0         │ -rw-r--r-- │<br/>├───────────────┼───────────┼────────────┤<br/>│ ./config.rs   │ 0         │ -rw-r--r-- │<br/>├───────────────┼───────────┼────────────┤<br/>│ ./lib.rs      │ 0         │ -rw-r--r-- │<br/>├───────────────┼───────────┼────────────┤<br/>│ ./recon.db    │ 1         │ -rw-r--r-- │<br/>└───────────────┴───────────┴────────────┘<br/>6 files in 145.81675ms</span></pre><h1 id="2931" class="mh mi iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">探索更多</h1><p id="8a20" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la ni lc ld le nj lg lh li nk lk ll lm ij bi translated">我们有充分配置的例子来探索，并开始从(<a class="ae ln" href="https://github.com/rusty-ferris-club/recon/pulls" rel="noopener ugc nofollow" target="_blank">打开一个公关</a>添加您自己的！):</p><p id="6191" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/rusty-ferris-club/recon/blob/master/examples/all-processors.yaml" rel="noopener ugc nofollow" target="_blank"> all-processors.yaml </a> —默认情况下打开所有处理器</p><p id="7889" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/rusty-ferris-club/recon/blob/master/examples/custom-walking.yaml" rel="noopener ugc nofollow" target="_blank"> custom-walking.yaml </a> —仅计算部分已遍历目录树的字段</p><p id="9de3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/rusty-ferris-club/recon/blob/master/examples/file-classes.yaml" rel="noopener ugc nofollow" target="_blank"> file-classes.yaml </a> —配置并分类您自己的文件类</p><p id="c13d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/rusty-ferris-club/recon/blob/master/examples/find-log4shell.yaml" rel="noopener ugc nofollow" target="_blank"> find-log4shell.yaml </a> —使用已知摘要查找log4shell漏洞的示例</p><p id="16eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/rusty-ferris-club/recon/blob/master/examples/using-yara.yaml" rel="noopener ugc nofollow" target="_blank">使用-yara.yaml </a> —使用简单的yara规则集进行匹配</p><p id="986d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有用例吗？想做点贡献吗？<a class="ae ln" href="https://github.com/rusty-ferris-club/recon" rel="noopener ugc nofollow" target="_blank">随意开一个PR </a></p></div></div>    
</body>
</html>