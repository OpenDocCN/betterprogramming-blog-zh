<html>
<head>
<title>Compose NSAttributedStrings Easily with Gaudi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用高迪轻松创作无属性字符串</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/compose-nsattributedstrings-easily-with-gaudi-da57a596c9c0?source=collection_archive---------17-----------------------#2020-01-16">https://betterprogramming.pub/compose-nsattributedstrings-easily-with-gaudi-da57a596c9c0?source=collection_archive---------17-----------------------#2020-01-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1aee" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Gaudi框架的NSAttributedString字符串声明性DSL</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a4801ef2832b81b32effbfa26d15703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Slx4oMJD2MQ7BVtZofTWnw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://unsplash.com/photos/0aFg0U2uPJY" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></p></figure><p id="8380" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe lv lw lx ly b">NSAttributedString</code>的最大挑战之一是保持代码的整洁和可读性。让我们分析一个简单的案例来准确理解我的意思:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/e375e81e070a105c52bb7a47deb1913d.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*_qzuttnUwboUu9Cwh4KVCA.png"/></div></figure><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="a635" class="me mf it ly b gy mg mh l mi mj">let hello = NSAttributedString(string: "Hello, ", <br/>                           attributes: [<br/>                               .foregroundColor: UIColor.red<br/>                           ])<br/>let swift = NSAttributedString(string: "Swift", <br/>                           attributes: [<br/>                               .foregroundColor: UIColor.orange,<br/>                               .font: UIFont.systemFont(ofSize: 18)<br/>                           ])<br/>let final = NSMutableAttributedString(attributedString: hello)<br/>final.append(swift)</span></pre><p id="2891" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是实现我们在图像中看到的“Hello Swift”属性字符串所需的最少代码量。这有什么不好？</p><ul class=""><li id="4f2b" class="mk ml it lb b lc ld lf lg li mm lm mn lq mo lu mp mq mr ms bi translated">IDE不帮助编写属性的<code class="fe lv lw lx ly b">NSAttributedString.Key</code>键。不幸的是，由于某些原因，IDE不提供自动完成功能。</li><li id="8bfd" class="mk ml it lb b lc mt lf mu li mv lm mw lq mx lu mp mq mr ms bi translated">值的零类型安全:属性值的类型是<code class="fe lv lw lx ly b">Any</code>。</li><li id="bb5c" class="mk ml it lb b lc mt lf mu li mv lm mw lq mx lu mp mq mr ms bi translated">冗长而重复的代码:我们需要为字符串的每个部分创建一个具有不同属性的属性字符串，然后我们需要使用一个<code class="fe lv lw lx ly b">NSMutableAttributedString</code>来组合这两个属性字符串。</li></ul><p id="e6fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经看到了高迪在多个应用<a class="ae ky" href="https://medium.com/better-programming/gaud%C3%AD-for-ios-theming-and-dark-mode-86fe8fe60aeb" rel="noopener">主题和黑暗模式</a>方面的强大，这一次我们将分析其使用<code class="fe lv lw lx ly b">NSAttributedString</code>轻松格式化字符串的解决方案。</p><p id="0c48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">高迪很好地利用了Swift 5.1的特性<a class="ae ky" href="https://www.swiftbysundell.com/articles/the-swift-51-features-that-power-swiftuis-api/#function-builders" rel="noopener ugc nofollow" target="_blank">函数构建器</a>，并将其与声明颜色和字体样式的声明方式相结合。</p><p id="fe91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个框架，关于<code class="fe lv lw lx ly b">NSAttributedString</code>，承诺提供一个简单和类型安全的方法来定义不同的颜色、字体和样式。使用Gaudi DSL的前一个示例如下所示:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="c153" class="me mf it ly b gy mg mh l mi mj">let final = NSAttributedString {<br/>    "Hello, ".foreground(color: .red)<br/>    "Swift".foreground(color: .orange)<br/>        .font(.systemFont(ofSize: 18))<br/>}</span></pre><p id="b986" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了...Gaudi允许一种非常简洁的、类型安全的、非冗长的方式从简单的<code class="fe lv lw lx ly b">String</code>类型开始组合<code class="fe lv lw lx ly b">NSAttributedString</code>。显然，<a class="ae ky" href="https://medium.com/better-programming/gaud%C3%AD-for-ios-theming-and-dark-mode-86fe8fe60aeb" rel="noopener">语义颜色和字体样式</a>在DSL中也是受支持的，可以这样使用:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="c162" class="me mf it ly b gy mg mh l mi mj">let final = NSAttributedString {<br/>    "Hello, ".foreground(semanticColor: .label(.primary))<br/>    "Swift".foreground(semanticColor: .label(.secondary))<br/>        .font(forStyle: .title(attribute: .regular))<br/>}</span></pre><p id="3350" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">DSL还支持if和if-else语句:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="9878" class="me mf it ly b gy mg mh l mi mj">let final = NSAttributedString {<br/>    "Hello, ".foreground(semanticColor: .label(.primary))<br/>    if swiftGreeting {<br/>       "Swift".foreground(semanticColor: .label(.secondary))<br/>           .font(forStyle: .title(attribute: .regular))<br/>    } else {<br/>       "World".foreground(semanticColor: .label(.tertiary))<br/>           .font(forStyle: .subhead(attribute: .bold))<br/>    }<br/>}</span></pre><p id="f16b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现有的<code class="fe lv lw lx ly b">NSAttriutedString</code>实例也可以使用这种方法进行组合和修改:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="d726" class="me mf it ly b gy mg mh l mi mj">let hello = NSAttributedString(string: "Hello, ", <br/>                           attributes: [<br/>                               .foregroundColor: UIColor.red<br/>                           ])</span><span id="c011" class="me mf it ly b gy my mh l mi mj">let final = NSAttributedString {<br/>    hello.foreground(semanticColor: .label(.primary)) // replace color for "Hello, "<br/>    "Swift".foreground(semanticColor: .label(.secondary))<br/>        .font(forStyle: .title(attribute: .regular))<br/>}</span></pre><p id="5235" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您所需要的只是稍后应用于<code class="fe lv lw lx ly b">NSAttributedString</code>实例的<code class="fe lv lw lx ly b">NSAttributedString</code>属性，那么Gaudi也提供了相同的声明性API。例如，这个属性</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="3e75" class="me mf it ly b gy mg mh l mi mj">let attributes = [<br/>    NSAttributedString.Key.foregroundColor: UIColor.green,<br/>    .backgroundColor: UIColor.red<br/>]</span></pre><p id="1a74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">高迪变成了这样:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="6895" class="me mf it ly b gy mg mh l mi mj">let attributes = StringAttributes {<br/>    foregroundAttribute(withColor: .green)<br/>    backgroundAttribute(withColor: .red)<br/>}.attributes // will be of type [NSAttributedString.Key : Any]</span></pre><p id="25da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，<code class="fe lv lw lx ly b">StringAttributes</code> DSL支持if和if-else语句。</p><p id="8bea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些API显然也可以在没有DSL的情况下使用，例如:</p><pre class="kj kk kl km gt ma ly mb mc aw md bi"><span id="f066" class="me mf it ly b gy mg mh l mi mj">let hello = "Hello, Swift"<br/>    .foreground(semanticColor: .label(.primary))<br/>    .font(forStyle: .title(attribute: .regular))</span><span id="018f" class="me mf it ly b gy my mh l mi mj">// Hello is of type NSAttributedString</span></pre><p id="3b3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我提醒你，Gaudi是完全开源的，所以如果你对实现这些结果的实现细节感兴趣，请随意访问<a class="ae ky" href="https://github.com/gringoireDM/Gaudi" rel="noopener ugc nofollow" target="_blank">项目的GitHub库</a>。特别是，我鼓励阅读大量的单元测试来发现这个框架的所有功能。可以用swiftPM和CocoaPods采用高迪。</p></div></div>    
</body>
</html>