<html>
<head>
<title>Let’s Talk About Smart Contract Unit Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们来谈谈智能合同单元测试</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/lets-talk-about-smart-contract-unit-testing-1317a2d2365a?source=collection_archive---------11-----------------------#2020-12-08">https://betterprogramming.pub/lets-talk-about-smart-contract-unit-testing-1317a2d2365a?source=collection_archive---------11-----------------------#2020-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9c84" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用几行代码向您的智能合约添加一个完整的测试套件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/619092b0a5f1ae72bb4306a91cce1d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w5qE1au0LkRxhwvr"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NASA </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="c218" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">欢迎来到区块链无处不在系列的另一部分。如果你错过了，看看<a class="ae ky" href="https://medium.com/better-programming/how-to-integrate-the-curve-fi-protocol-into-your-defi-protocol-e1d4c43f716d" rel="noopener">之前的部分</a>。上次，我们谈到了大DeFi协议集成。我们可以从中得出的一个主要结论是，这样一大块工作应该由完整的单元测试覆盖来支持，以验证形式逻辑。</p><p id="2fdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是今天文章的主题。让我们谈一谈智能合约的单元测试。</p><p id="36f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单元测试是任何基于智能合约的协议中最重要的部分之一。它们由社区检查，它们应该在每次提交时运行，单元测试覆盖率由审计员强制检查。所有用于可靠性单元测试的通用技术都是众所周知的，并且已经描述过了。关于<a class="ae ky" href="https://www.chaijs.com" rel="noopener ugc nofollow" target="_blank">柴框架</a>、<a class="ae ky" href="https://www.npmjs.com/package/truffle-test-helpers" rel="noopener ugc nofollow" target="_blank">松露测试助手</a>甚至现代<a class="ae ky" href="https://docs.openzeppelin.com/test-helpers/0.5/" rel="noopener ugc nofollow" target="_blank"> OpenZeppelin测试助手</a>的文章很多。所以我们换个角度来看一下。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="04c7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">我们在谈论什么</h1><p id="1712" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设您有一个ERC20兼容的令牌和一些额外的方法。你知道它的基本功能是有效的，你的社区也知道它是有效的。你可能从<a class="ae ky" href="https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable/tree/master/contracts/token/ERC20" rel="noopener ugc nofollow" target="_blank"> OpenZeppelin库</a>复制了部分代码(或者全部代码)。但是你不能足够肯定你实现之后没有破坏原有的令牌功能(比如具体的转移方法)。这种情况需要特定的工具，因为您可能不会用标准的单元测试来覆盖ERC20令牌。</p><p id="8ac1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这样的工具是存在的。有一个<code class="fe mz na nb nc b">token-test-suite</code>包，它包含了ERC20兼容功能的所有必要测试，包括<code class="fe mz na nb nc b">Mintable</code>令牌。可以在GitHub 上找到原库<a class="ae ky" href="https://github.com/mancze/token-test-suite" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="47a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了与包一起开始开发，您可以在<code class="fe mz na nb nc b">packages</code>文件中向您的开发依赖项添加一行代码:</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="c09b" class="nh md it nc b gy ni nj l nk nl">“token-test-suite”: “0.1.1”</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="25cf" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">从令牌开始</h1><p id="6953" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，我们需要令牌本身，这样我们就有东西可以测试了。当然，你可以自己写完整的代码，但是我们来缩短路径。多亏了OpenZeppelin，我们可以用五行代码创建一个ERC20令牌:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d215" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，让我们再添加几行代码，使我们的令牌可铸造:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="a116" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们宝贵的令牌已经准备好了，所以我们现在可以专注于测试(或者如何避免整个单元测试集的创建)。</p><p id="4452" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，我将再次提醒您，ERC20的OZ实现可以完美地工作，但这并不意味着您不需要测试。该测试套件面向自定义令牌或具有附加功能的令牌。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9692" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置测试套件</h1><p id="5aab" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，您可以在原始存储库中找到所有必要的指令<a class="ae ky" href="https://github.com/mancze/token-test-suite" rel="noopener ugc nofollow" target="_blank">，尽管我将跟随您完成主要阶段:</a></p><ul class=""><li id="4bf7" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">从<code class="fe mz na nb nc b">regenerator-runtime</code>包中导入再生器:</li></ul><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="7990" class="nh md it nc b gy ni nj l nk nl">require(“regenerator-runtime/runtime”);</span></pre><ul class=""><li id="cfec" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">复制软件包自述文件中推荐的初始代码。只需检查是否导入了正确的工件，以及是否正确设置了所有令牌的参数。</li><li id="b8e3" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">在<code class="fe mz na nb nc b">create</code>参数中设置正确的创建:</li></ul><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="d4c8" class="nh md it nc b gy ni nj l nk nl">create: async function () {<br/>    return await UniqueToken.new(accounts[0], “10000000000000000000000”);<br/>},</span></pre><ul class=""><li id="745b" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">根据令牌的性质(不可铸造或可铸造)设置转移或铸造参数:</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><ul class=""><li id="ac9c" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">设置供应(根据您的创建功能)和初始余额。请记住，使用了五个帐户，第一个帐户被视为所有者/minter。</li></ul><p id="c9f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并且该过程结束。在我的GitHub 上查看完整的测试示例(每个令牌少于50行)<a class="ae ky" href="https://github.com/Midvel/medium_blockchain_notes/tree/main/erc20_test_suit" rel="noopener ugc nofollow" target="_blank">，让我们开始测试。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="42c7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">没有测试的测试</h1><p id="bbc3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在我们设置好测试套件之后，我们现在可以调用<code class="fe mz na nb nc b">truffle test</code>命令:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/9d7b33b5f89787609939d488d283f5af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*neLcCCyi15PVlXkPaXP7mg.png"/></div></div></figure><p id="6dbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将观察到许多与初始供应、转移、铸造、津贴和平衡相关的测试案例——所有的核心内容。这个套件真正的好处是它完美地覆盖了一个令牌。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/7691f5b12dd153815c88700e35eb6a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XkKDwfUAgBUC4Q1jJ5vAhA.png"/></div></div></figure><p id="214b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">来自<code class="fe mz na nb nc b">solidity-coverage</code> <a class="ae ky" href="https://www.npmjs.com/package/solidity-coverage" rel="noopener ugc nofollow" target="_blank">工具</a>的输出就是最好的证明。</p><p id="d098" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以在标准化的事情上节省大量时间，并专注于您独特的功能。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e604" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="b30a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我发现区块链世界非常迷人和令人兴奋。每天，我都在这个领域里寻找更多有趣的东西。如果你和我一样对区块链发展感兴趣，就等着看区块链的下一期吧。</p><p id="f3d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和往常一样，您可以在我的GitHub上找到一个完整的工作示例:</p><div class="oe of gp gr og oh"><a href="https://github.com/Midvel/medium_blockchain_notes/tree/main/erc20_test_suit" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">中级/中等_区块链_笔记</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">出于开发目的，您将需要Node.js和包管理器- npm。对于开发，以下…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div><p id="4993" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保你没有错过我的区块链无处不在系列的前一部分:</p><div class="oe of gp gr og oh"><a href="https://medium.com/better-programming/how-to-integrate-the-curve-fi-protocol-into-your-defi-protocol-e1d4c43f716d" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">如何整合曲线？Fi协议转换成DeFi协议</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">使用曲线适配器为DeFi应用供电。金融机构流动性池</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">medium.com</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov ks oh"/></div></div></a></div></div></div>    
</body>
</html>