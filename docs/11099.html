<html>
<head>
<title>How To Use DTO For Validation in NestJS (2022)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在NestJS (2022)中使用DTO进行验证</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-use-data-transfer-objects-dto-for-validation-in-nest-js-7ff95309f650?source=collection_archive---------0-----------------------#2022-02-18">https://betterprogramming.pub/how-to-use-data-transfer-objects-dto-for-validation-in-nest-js-7ff95309f650?source=collection_archive---------0-----------------------#2022-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bb49" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">知道DTO在NestJS是如何工作的吗</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2ec440228e292ad3872e030dbbd68bbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9LueMHO5f-3UU-wS"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@_ferh97?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">费尔南多·埃尔南德斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="2308" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天我将讨论NestJS中的<strong class="lb iu">数据传输对象</strong> (DTO)以及如何使用它们来验证你的传入请求。</p><h1 id="b7c7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是DTO？</h1><p id="942b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">DTO本身更多的是为开发者和那些使用API的人提供指导，让他们知道请求体期望是什么样的形状，它实际上并不自己运行任何验证<strong class="lb iu"/>。</p><p id="7ff4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，使用TypeScript，您可以使用内置的<a class="ae ky" href="https://docs.nestjs.com/techniques/validation" rel="noopener ugc nofollow" target="_blank">验证管道</a>从<a class="ae ky" href="https://github.com/typestack/class-validator" rel="noopener ugc nofollow" target="_blank">类验证器</a>库中添加decorators，并对传入的请求运行验证，以便只有预期的请求体可以进来。</p><h1 id="c869" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">先决条件</h1><p id="f1f3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">需要对Node.js和TypeScript有基本的了解。我会选择<a class="ae ky" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>作为我的代码编辑器。你可以用你喜欢的任何东西。</p><h1 id="b664" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">我们开始吧</h1><p id="a293" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，我们将安装NestJS CLI，因此打开您选择的终端并键入:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e4bc" class="mx lw it mt b gy my mz l na nb">$ npm i -g @nestjs/cli</span></pre><p id="89bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们用它的CLI初始化一个新的NestJS项目。这可能需要一分钟。CLI脚本将询问您想要使用哪个软件包管理器。对于这个例子，我选择NPM。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="dede" class="mx lw it mt b gy my mz l na nb">$ nest new nest-dto-validation</span></pre><p id="653a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成该命令后，您可以在代码编辑器中打开您的项目。由于我使用Visual Studio代码，我将通过键入以下命令打开项目:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="a330" class="mx lw it mt b gy my mz l na nb">$ cd nest-dto-validation<br/>$ code .</span></pre><p id="4ae9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的项目在VSC是这样的(Visual Studio代码):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/a3521d8c68570502f660f75d94d25647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yvRDaa_24U2C2HF-RS7mdA.png"/></div></div></figure><p id="910e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们安装一些依赖项。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="0660" class="mx lw it mt b gy my mz l na nb">$ npm i class-validator class-transformer</span></pre><p id="b71b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们开始编码。首先，我们添加ValidationPipe作为全局管道。以下是对其属性的解释:</p><ul class=""><li id="000b" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated"><strong class="lb iu">白名单</strong>:删除不在DTO中的请求主体的所有属性</li><li id="89e5" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated"><strong class="lb iu">转换</strong>:这个属性允许我们转换属性，例如，将一个整数转换成一个字符串。我们今天不讨论这个。</li></ul><p id="6129" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请将<code class="fe nr ns nt mt b">src/main.ts</code>从</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/main.ts</p></figure><p id="8b20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/main.ts</p></figure><p id="dfc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在修改了main.ts之后，我们需要在<code class="fe nr ns nt mt b">src/</code>目录中创建一个名为<code class="fe nr ns nt mt b">app.dts.ts</code>的新文件。您可以通过以下命令添加它(Mac、Linux):</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="0160" class="mx lw it mt b gy my mz l na nb">$ touch src/app.dto.ts</span></pre><p id="6ac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将把这些内容添加到<code class="fe nr ns nt mt b">src/app.dts.ts</code>中。这个文件将负责验证。我在文件中添加了一些注释。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/app.dto.ts</p></figure><p id="a3c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后但同样重要的是，我们需要修改我们的<code class="fe nr ns nt mt b">src/app.controller.ts</code>文件。我们为一个<code class="fe nr ns nt mt b">POST</code>请求添加了一个新的路由处理程序。如您所见，我们添加了在上一步中刚刚创建的<code class="fe nr ns nt mt b">FormDTO</code>类作为表单类型。</p><p id="a7ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把<code class="fe nr ns nt mt b">src/app.controller.ts</code>从</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/app .控制器. ts</p></figure><p id="b95e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">src/app .控制器. ts</p></figure><p id="4805" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！现在让我们测试我们的新邮政路线。你可以使用软件如<a class="ae ky" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮差</a>或简单地通过你的终端中的CURL命令。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e552" class="mx lw it mt b gy my mz l na nb">$ <em class="nw">curl -X POST http://localhost:3000 -H "Content-Type: application/json" -d '{"age": 1, "name": "Elon Musk", "acceptedTOS": true, "nums": [2]}'</em></span><span id="2bfd" class="mx lw it mt b gy nx mz l na nb"><strong class="mt iu">Server Response:</strong></span><span id="b203" class="mx lw it mt b gy nx mz l na nb">{"age":1,"name":"Elon Musk","acceptedTOS":true,"nums":[2]}</span></pre><p id="7d4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，有用。现在让我们发送相同的请求，但是让我们稍微改变一下主体。如您所知，我们需要一个整数作为<strong class="lb iu">年龄</strong>属性。所以这次我们将把年龄作为一个字符串发送:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="44cc" class="mx lw it mt b gy my mz l na nb">$ <em class="nw">curl -X POST http://localhost:3000 -H "Content-Type: application/json" -d '{"age": "1", "name": "Elon Musk", "acceptedTOS": true, "nums": [2]}'</em></span><span id="0315" class="mx lw it mt b gy nx mz l na nb"><strong class="mt iu">Server Response:</strong></span><span id="5562" class="mx lw it mt b gy nx mz l na nb">{"statusCode":400,"message":["age must be a number conforming to the specified constraints"],"error":"Bad Request"}</span></pre><p id="c85b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">任务完成！我们得到了预期的400错误响应。</p><p id="e0fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您阅读我关于NestJS中验证的文章。我希望，你明白dto现在是如何工作的。</p><p id="dc8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">干杯！</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="0134" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你喜欢读这篇文章。如果你愿意支持我成为一名作家，可以考虑注册<a class="ae ky" href="https://medium.com/@hellokevinvogel/membership" rel="noopener">成为</a>的媒体成员。每月只需5美元，你就可以无限制地使用Medium。</p><p id="4cc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想支持我？给我买杯咖啡。</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="90cd" class="lv lw it bd lx ly of ma mb mc og me mf jz oh ka mh kc oi kd mj kf oj kg ml mm bi translated">了解更多关于NestJS的信息</h1><div class="ok ol gp gr om on"><a rel="noopener  ugc nofollow" target="_blank" href="/nest-js-project-with-typeorm-and-postgres-ce6b5afac3be"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">用TypeORM和Postgres构建一个NestJS应用程序(2022)</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">使用Nest.js &amp; TypeORM创建可扩展的应用程序</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">better编程. pub</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb ks on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://blog.bitsrc.io/how-to-enable-cors-in-nest-js-90c1b6316289" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">如何在NestJS (2022)中启用CORS</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">关于如何在NestJS中启用CORS的简要指南</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">blog.bitsrc.io</p></div></div><div class="ow l"><div class="pc l oy oz pa ow pb ks on"/></div></div></a></div><div class="ok ol gp gr om on"><a href="https://blog.bitsrc.io/how-to-update-nest-js-ecd0e9466165" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd iu gy z fp os fr fs ot fu fw is bi translated">如何更新NestJS (2022)</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">如何用您需要安装的两个包更新NestJS？</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">blog.bitsrc.io</p></div></div><div class="ow l"><div class="pd l oy oz pa ow pb ks on"/></div></div></a></div></div></div>    
</body>
</html>