<html>
<head>
<title>Is BigJS a Solution to JavaScript’s Numbers Problems?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigJS是JavaScript数字问题的解决方案吗？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/bigjs-a-solution-to-javascript-numbers-problems-fe082138d1cf?source=collection_archive---------16-----------------------#2020-10-08">https://betterprogramming.pub/bigjs-a-solution-to-javascript-numbers-problems-fe082138d1cf?source=collection_archive---------16-----------------------#2020-10-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c535" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们能最终解决客户端的数学问题吗？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9409bbfb4163a00cc70603864ef3ce5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iXE5khfhaitDWnVvwKCKTg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@roman_lazygeek?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">罗马法师</a>在<a class="ae ky" href="https://unsplash.com/s/photos/blackboard?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="e2f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">众所周知，JavaScript不擅长处理数字，涉及小数精度的计算可能会让您大吃一惊。幸运的是，有一个轻量级的库为我们提供了一系列工具来处理这个问题:<a class="ae ky" href="https://www.npmjs.com/package/big-js" rel="noopener ugc nofollow" target="_blank"> BigJS </a>。</p><p id="212f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看我们能从中得到什么。</p><p id="3043" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">著名的<code class="fe lv lw lx ly b">0.2 + 0.1 === 0.3</code>返回<code class="fe lv lw lx ly b">false</code>的例子通常会让编码学徒有点头疼。事实上，这不仅是一个典型的JavaScript问题，而且在许多其他编程语言中也存在(在本文中有关于那个<a class="ae ky" href="https://medium.com/better-programming/why-is-0-1-0-2-not-equal-to-0-3-in-most-programming-languages-99432310d476" rel="noopener">的更多细节)。</a></p><p id="017c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">幸运的是，有一些简单的方法可以处理这个问题，而不会浪费太多时间。其中一个是名为BigJS的库。顾名思义，它最初是通过使用JavaScript类来处理大数字的。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="9859" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">和大班一起做</h1><p id="eaee" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">BigJS引入了一个名为<code class="fe lv lw lx ly b">Big</code>的类，包含一组可以被调用来对数字进行计算的方法。第一步是创建一个将数字(或一个字符串或另一个<code class="fe lv lw lx ly b">Big</code>)作为参数传递的<code class="fe lv lw lx ly b">Big</code>实例:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="c0ed" class="nh mh it ly b gy ni nj l nk nl">const two = new Big(2)</span></pre><p id="851c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">new</code>甚至是可选的。这个类有一些特性，比如默认为20的十进制精度<code class="fe lv lw lx ly b">Big.DP</code>(这是一个很大的值),可以由用户定义为100万。)，这为所有疯狂的用法留下了很好的回旋余地。</p><p id="7fdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一套用于评估的方法，如<code class="fe lv lw lx ly b">gt(), gte(), eq()</code>以及用于计算的方法(<code class="fe lv lw lx ly b">plus(), minus(), times(), sqrt()</code>)。它们可以链接在一起形成一个相当优雅的语法:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="5919" class="nh mh it ly b gy ni nj l nk nl">const result = Big(2).times(5).minus(2) // 8</span></pre><p id="6073" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该库解决了小数字的十进制精度问题:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="2ecb" class="nh mh it ly b gy ni nj l nk nl">const result = Big(0.2).plus(0.1).eq(0.3) // true</span></pre><p id="6dbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以及“大”的:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="6067" class="nh mh it ly b gy ni nj l nk nl">const result = Big(2e-12).plus(1e-12).eq(3e-12) // true</span></pre><p id="0504" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">官方<a class="ae ky" href="https://mikemcl.github.io/big.js/" rel="noopener ugc nofollow" target="_blank">文档</a>很好地概述了简短示例的可能性。这组方法相当有限，部分遵循JS的<code class="fe lv lw lx ly b">Math</code>对象模式，显然不是为复杂的数学设计的，而是为了提高精度，同时保持库的简单和小巧。</p><p id="929b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">目前只有好消息？嗯，让我想想…</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="3f7b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">一些缺点</h1><p id="9371" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">局限性并不总是显而易见的，但还是有的。例如，虽然<code class="fe lv lw lx ly b">pow()</code>方法允许计算指数，但它只接受整数，所以为了计算<code class="fe lv lw lx ly b">2^3.5</code>，您必须回到传统的JavaScript。</p><p id="a790" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大方法的返回值是一个<code class="fe lv lw lx ly b">Big</code>对象，所以通常情况下，使用<code class="fe lv lw lx ly b">toString()</code>或<code class="fe lv lw lx ly b">toFixed(...)</code>进行字符串转换是最简单的方法，然后整个过程必须包装在<code class="fe lv lw lx ly b">Number()</code>中，这使得语法更加复杂。</p><p id="e108" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不包括对空字符串等虚假值的处理，这可能会导致崩溃——这是使用严格类型的又一个原因。</p><p id="cf33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，给<code class="fe lv lw lx ly b">Big</code>输入不需要的类型会导致错误。因此，在调用库之前，必须严格检查和处理打字。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="3af0" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">性能呢？</h1><p id="ceff" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">检查计算的一个重要方面是它们的运行速度。当然，没有人期望<code class="fe lv lw lx ly b">BigJS</code>能像普通JavaScript一样快，但是让我们看看要付出的代价是什么。我们将比较下面包含基本运算的两个程序块:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/263064b820042e69c0a48ebcd3cea773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PN_QwAS3mKMw4FMpn-F7kg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">对<a class="ae ky" href="https://jsben.ch/" rel="noopener ugc nofollow" target="_blank"> JSBEN进行测试的结果。CH </a>。</p></figure><p id="89e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果很明显:使用这个库比用普通JavaScript运行计算要慢300倍。这可能看起来很可怕，但必须从需要处理的数据量的角度来看。后端中的单个计算或记录的前端处理将不会受到这种计算能力需求的影响。</p><p id="9374" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，对于大型数据库操作，这可能值得考虑。</p><p id="cc4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了深入理解为什么会发生这种情况，您可能想要检查库的源代码。它有很好的注释，大部分逻辑都在一个文件中。然而，单个字母的变量名往往会使代码变得晦涩难懂，这可能需要时间来破译逻辑。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="e4f8" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="36a2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在计算精度和小数安全性方面，BigJS绝对是一个不错的选择。它使用起来非常简单，可以压缩到3 kb以下，并且在速度和安全性之间取得了很好的平衡。这就是为什么它是大数最常用的库之一。</p><p id="279c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是请记住这些注意事项:</p><ol class=""><li id="f40c" class="nq nr it lb b lc ld lf lg li ns lm nt lq nu lu nv nw nx ny bi translated">问问自己性能是否至关重要。</li><li id="d534" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated">当心类型！</li></ol></div></div>    
</body>
</html>