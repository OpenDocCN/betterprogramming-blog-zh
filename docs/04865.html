<html>
<head>
<title>How to Store Documents Larger Than 16 MB in MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在MongoDB中存储大于16 MB的文档</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-store-documents-larger-than-16-mb-in-mongodb-aecc957bbe6c?source=collection_archive---------4-----------------------#2020-05-18">https://betterprogramming.pub/how-to-store-documents-larger-than-16-mb-in-mongodb-aecc957bbe6c?source=collection_archive---------4-----------------------#2020-05-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f7d4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一种不使用GridFS的简单方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a264e63ed142cb93084235fd1c30350a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AZd0V3kX1TEKu1jAW_52pg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@ruchindra?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Ruchindra Gunasekara </a>在<a class="ae ky" href="https://unsplash.com/s/photos/storage?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="1c3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我曾经开发过一个应用程序，用于查看巨大的数据表(25万行x 120列)。主要要求是所有的数据都可以在客户的应用程序中获得。数据是不可变的——它保存一次，然后在客户端应用程序的表视图中使用。</p><p id="f393" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所知，MongoDB将数据存储在一个文档中。一个文档的限制是16Mb。您还可以使用GridFS来存储超过16Mb的大文件。它会将它们存储在多个块中。</p><p id="1592" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我决定将每一列作为单个文档存储在MongoDB中，其中<code class="fe lv lw lx ly b">_id</code>是该列数据的散列。在本文中，我将分享一种在大于16Mb的MongoDB列中存储文档的方法。</p><p id="3b8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的应用程序中有四种类型的数据——字符串、数字、日期(用Unix ms表示)和布尔值。由于其16Mb的限制，MongoDB文档可以轻松地存储大约200万个64位数字值(还有日期和布尔值)。但是字符串是一个特例。每个UTF-8字符占用一个字节。</p><p id="a68e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">带字符串的列的界面如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="118c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在某个时候，我们的用户开始上传包含25万个值的表，这些表的列包含40个字符的散列。简单的数学计算表明，250，000 x 40个字符x 2个字节= 20Mb。此时，我们的应用程序无法将这样的列保存到MongoDB。</p><p id="952e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我必须找到解决办法。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="7db8" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">用字符串减小列大小的方法</h1><h2 id="0bbe" class="na mj it bd mk nb nc dn mo nd ne dp ms li nf ng mu lm nh ni mw lq nj nk my nl bi translated">1.值的Stringify和zip字符串</h2><p id="6d2e" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">最简单的方法仍然可以处理一些重复的文本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><h2 id="41c1" class="na mj it bd mk nb nc dn mo nd ne dp ms li nf ng mu lm nh ni mw lq nj nk my nl bi translated">2.将Excel方法与字典结合使用</h2><p id="aeb2" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">创建一个字典，将唯一的字符串放入字典，并用索引替换字符串。如果一列中有许多重复的字符串，此方法很有用。如果有人想保存一列散列，这并没有帮助。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="7930" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，如果有人想保存一列哈希值，前面的两种方法都无济于事。所以，这是第三种方法:像GridFS对文件那样做。</p><h2 id="4188" class="na mj it bd mk nb nc dn mo nd ne dp ms li nf ng mu lm nh ni mw lq nj nk my nl bi translated">3.为单个列创建多个文档</h2><p id="2d3f" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我们总是为用户提供一个完整的列，以便我们创建一个文档的链接列表。如果我们的列适合16Mb，我们按原样存储它。否则，我们将该列分割成块，并将这些块保存在链接到主文档的其他文档中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="2622" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的列的<code class="fe lv lw lx ly b">get</code>函数将如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="c67a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们的用户可以保存大量数据，而不会使我们的应用程序崩溃。我们将在多个文档中存储一个列。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="6906" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="1255" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">在上面的代码中，我使用了一种简单的方法来计算MongoDB文档的大小。在下一篇文章中，我将讲述如何更好地计算文档大小。</p></div></div>    
</body>
</html>