<html>
<head>
<title>How to Create Your Own Operating System</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建自己的操作系统</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-your-own-operating-system-bfd2545d2e6d?source=collection_archive---------4-----------------------#2022-06-22">https://betterprogramming.pub/how-to-create-your-own-operating-system-bfd2545d2e6d?source=collection_archive---------4-----------------------#2022-06-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fdc0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从编程中最具挑战性的尝试中学习</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/be15479d8e8dda745ffa7a5645f7387a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QPlD9hlkCNG1KKDfA5OCSw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从构建低级程序中学习。</p></figure><p id="86ff" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如今，普通的最终用户很少考虑他们使用的操作系统。在移动设备市场，根据<a class="ae lu" href="https://gs.statcounter.com/vendor-market-share/mobile" rel="noopener ugc nofollow" target="_blank"> GlobalStats </a>网站的报道，Android保护伞以累计73%的市场份额占据主导地位，而苹果的生态系统占据其余份额——同时，如果你看看个人电脑，情况大致相同，微软系统占据了所有正在使用的系统的最大份额。</p><p id="6471" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就我个人而言，我不太喜欢Windows，除了我写这篇文章的Mac系统之外，最接近的可行替代系统是Linux，它在日常可用性方面甚至还没有接近。人们普遍认为，要推翻目前个人电脑市场的垄断是不可能的——这是一种我既厌恶又赞同的情绪——我也不打算做不可能的事。</p><p id="a671" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，我确实希望通过这一系列文章来说明，对于任何级别的程序员来说，创建一个非常简单的低级程序都是一次奇妙的学习经历。</p><p id="06d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们开始之前，我想说的是，本文将假设您对计算机科学和编程中的一些基本和高级概念有一定程度的熟悉，例如:</p><ul class=""><li id="6cdb" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">十六进制和二进制记数法；</li><li id="dba5" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">数据结构及其创建和操作；</li><li id="34f0" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">算法；</li><li id="2d1e" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">组装；</li><li id="3fa8" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">以及一些更抽象的编程概念。</li></ul><h1 id="7771" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">入门指南</h1><p id="b793" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们将从建立一个交叉编译器开始。有一些参考资料会告诉你如何为GCC做这件事，尽管我将使用LLVM和Clang作为基础来编写这个系列，因为我们稍后将作为题外话深入到其他一些编程语言中。</p><p id="9904" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该已经安装了Git和CMake，因为它们在本系列中被大量使用。如果您需要下载它们，可以在以下位置下载:</p><ul class=""><li id="9404" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><a class="ae lu" href="https://git-scm.com/" rel="noopener ugc nofollow" target="_blank">饭桶</a></li><li id="8b09" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><a class="ae lu" href="https://cmake.org" rel="noopener ugc nofollow" target="_blank"> CMake </a></li></ul><p id="23fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这同样适用于LLVM和Clang，您可以通过在终端中运行以下命令来获取它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">安装LLVM和Clang。</p></figure><p id="5652" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您还没有Make，那么您可以使用<code class="fe ni nj nk nl b">-GNinja</code>为不同的生成器运行CMake，比如<a class="ae lu" href="https://ninja-build.org/" rel="noopener ugc nofollow" target="_blank"> Ninja </a>，尽管Make是默认的，并且是大多数基于Unix的系统附带的。</p><p id="2b26" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你在Windows上阅读这个系列，你有一些选择——你可以安装<a class="ae lu" href="https://www.mingw-w64.org/" rel="noopener ugc nofollow" target="_blank"> MinGW </a>，一个GNU工具如make附带的最小环境，或者你可以使用<a class="ae lu" href="https://docs.microsoft.com/en-us/windows/wsl/install" rel="noopener ugc nofollow" target="_blank"> WSL安装</a>。顾名思义，Windows Subsystem for Linux是一个内置于Windows安装中的完整的Linux系统。</p><p id="71f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我们清除了这些要素，我们就准备好进入这个故事中更令人兴奋的部分:代码！</p><h1 id="dc44" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">初始样板文件</h1><p id="d32e" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">我们要做的第一件事是写一些汇编代码。我们不想花太多时间在汇编语言上，所以我们要创建最少的样板文件，以便让我们进入C环境。</p><p id="8aa4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将首先为多重引导头声明一些常量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们的引导程序常量。</p></figure><p id="9f20" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些常量是一些“神奇”的值，在多引导标准<a class="ae lu" href="https://www.gnu.org/software/grub/manual/multiboot/multiboot.html#OS-image-format" rel="noopener ugc nofollow" target="_blank">中有完整的记录。</a></p><p id="97d3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将定义一些部分。我们需要确保程序识别为内核，所以我们将从多重引导头开始，然后是BSS，最后是文本部分，在这里我们定义了进入主函数的入口。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">从ASM到我们的C代码。</p></figure><p id="c6ff" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这段代码使我们能够开始用我们选择的高级语言编写，在这个例子中是C。你可以先编译它，以确保它能使用Clang的<code class="fe ni nj nk nl b">as</code>运行。</p><p id="d13c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们需要写出一些效用函数。我们需要确保我们可以写入屏幕——我们稍后将使用像素缓冲区实现——使用缓冲区和VGA颜色代码的组合。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">我们外壳的VGA颜色代码。</p></figure><p id="1237" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们可以创建一个非常基本的外壳:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">一个非常基本的shell实现。</p></figure><p id="2c48" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们终于可以写点什么了！</p><p id="4513" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以编写前面提到的main函数，并使用我们的<code class="fe ni nj nk nl b">writeString</code>函数在屏幕上打印一些东西！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">你好世界！</p></figure><p id="60ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我们需要将所有东西连接在一起:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">用这个链接器脚本链接我们的工作！</p></figure><p id="a637" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要构建我们的简单操作系统，首先要编译汇编代码。你可以通过运行<code class="fe ni nj nk nl b">clang bootloader.s -o bootloader.o</code>来实现。</p><p id="6f74" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将C代码合并成一个文件，用<code class="fe ni nj nk nl b">clang kernel.c -o kernel.o</code>编译。这将生成链接它所需的最后一部分。</p><p id="9657" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你现在可以通过运行<code class="fe ni nj nk nl b">clang -T osLinker.ld -o myos.bin -ffreestanding -O2 -nostdlib bootloader.o kernel.o</code>将你的内核连接在一起。</p><p id="1383" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在编译了一个非常基本的内核，你可以把它闪存到一个u盘上并运行它，或者你可以在一个虚拟机上运行它，比如QEMU或者VirtualBox。</p><h1 id="4d61" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">资源</h1><p id="ef29" class="pw-post-body-paragraph ky kz it la b lb nb ju ld le nc jx lg lh nd lj lk ll ne ln lo lp nf lr ls lt im bi translated">作为免责声明，有些代码是从几个不同的来源借来的:</p><ul class=""><li id="2bc1" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated"><a class="ae lu" href="https://wiki.osdev.org/Main_Page" rel="noopener ugc nofollow" target="_blank"> OSDev Wiki </a></li><li id="c05a" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated"><a class="ae lu" href="https://redox-os.org/docs/" rel="noopener ugc nofollow" target="_blank"> RedoxOS文档</a></li></ul><p id="335a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在我的<a class="ae lu" href="https://github.com/jwfufa/sys3" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中关注这个系列的发展。</p></div></div>    
</body>
</html>