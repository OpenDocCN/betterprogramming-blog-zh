<html>
<head>
<title>The Top 5 Security Practices for Ruby on Rails Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ruby on Rails应用程序的5大安全实践</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/the-top-5-security-practices-for-ruby-on-rails-applications-d07f405f044c?source=collection_archive---------8-----------------------#2020-06-26">https://betterprogramming.pub/the-top-5-security-practices-for-ruby-on-rails-applications-d07f405f044c?source=collection_archive---------8-----------------------#2020-06-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="27b3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">您的Ruby on Rails安全备忘单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e7d5193078062c7d2e3d2b28a8808559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Vvpm_VKxCsCZVJhW"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@mikofilm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈克·科诺诺夫</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="4a67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">老实说:当我第一次开始开发<a class="ae ky" href="https://rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"> RoR </a>应用程序的时候，我从来没有把安全性放在心上。Rails是一种快速构建MVP原型的方法，具有所有的快捷方式和约定——如此之多，以至于我从来没有考虑过一旦应用程序实际上线后我需要采取的措施。虽然Rails不像WordPress那样漏洞百出，WordPress因容易被黑客攻击而臭名昭著，但因为它经常被新手开发者使用，它可能会在应用程序中留下很多安全漏洞。</p><p id="e004" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想用这篇文章来解决我在整个开发生涯中看到的前五个问题，但这绝对不是一个完整的列表。我没有考虑常见的攻击，如XSS脚本和伪造的SQL注入。有整篇文章都是关于编写良好的代码来防止SQL/js注入的。我也不解决服务器安全问题。无论您使用的是AWS、Digital Ocean、Linux还是Heroku，都必须遵循基本步骤——使用防火墙、备份数据库以及强制使用私有/公共密钥对进行登录。</p><p id="1f2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，我将重点介绍应用程序级的步骤，您可以采取这些步骤来使应用程序为生产做好准备，为最终用户创建一个安全的环境，防止暴力攻击，并保证API密钥的安全。</p><p id="bf83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开始吧！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0a41" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.强制使用强密码</h1><p id="2d11" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在2020年，开发团队不会从头开始编写Rails认证，这几乎是必然的。像<code class="fe mz na nb nc b">Devise</code>或<code class="fe mz na nb nc b">OmniAuth</code>这样的宝石是为网络创建安全用户的现代标准。然而，默认情况下，<code class="fe mz na nb nc b">Devise</code>用户可以用任意六个字符的密码创建一个账户。像“123456”或“password”这样的密码将通过<code class="fe mz na nb nc b">Devise</code>验证。很明显，这是不好的。</p><p id="4db5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用户帐户更加安全，请在创建帐户时强制创建强密码。是的，这对用户来说可能更烦人，但是安全的web密码已经成为标准，所以它应该不会显著影响用户激活。使用<a class="ae ky" href="https://github.com/heartcombo/devise/wiki/How-To:-Set-up-simple-password-complexity-requirements" rel="noopener ugc nofollow" target="_blank">装置</a>可以直接实施密码长度和复杂性。</p><p id="e435" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，这些宝石可以增强用户安全性:</p><ul class=""><li id="1327" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">【https://github.com/bdmac/strong_password T4】</li><li id="28e9" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated"><a class="ae ky" href="https://github.com/ValiMail/devise-secure_password" rel="noopener ugc nofollow" target="_blank">https://github.com/ValiMail/devise-secure_password</a></li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="177a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">2.保护用户数据</h1><p id="699e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">新的Rails开发人员养成了使用ID显示数据的习惯。当年轻的RoR开发人员第一次学习使用CRUD动作生成RESTful控制器时，这是他们学到的<code class="fe mz na nb nc b">ActiveRecord</code>方法的一部分。</p><p id="d862" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，您可能有一个在应用程序中显示餐馆的URL，类似于<a class="ae ky" href="http://localhost:3000/restaurants/1" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/restaurants/1</a>2，以及类似于以下的控制器代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="43b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，这段代码不执行任何授权检查。应用程序中的每个用户都可以通过更改URL ID来查看每条记录。为了恰当地管理角色和权限，Rails拥有授权宝石，如<a class="ae ky" href="https://github.com/varvet/pundit" rel="noopener ugc nofollow" target="_blank">权威人士</a>或<a class="ae ky" href="https://github.com/CanCanCommunity/cancancan" rel="noopener ugc nofollow" target="_blank">坎坎坎</a>。然而，确保用户不能访问其他人的数据的最简单的方法是只对属于他们的对象执行查询(这也减少了查询的负载以加速应用程序)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="24e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果餐馆不属于用户，第二个查询将返回<code class="fe mz na nb nc b">nil</code>而不是返回记录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/eaed4f28edce8cda4d4ee7031d3f4639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3qK_3znFkViv714y"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@mojamsanii?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Moja Msanii </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="95e1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">3.强制SSL</h1><p id="966c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于存储用户数据或金融交易的应用程序来说，这是理所当然的。所有请求都应该通过HTTPS而不是HTTP安全地发送。</p><p id="65c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像Heroku这样的托管服务提供SSL证书作为域设置的一部分。其他服务，如自动气象站、数字海洋等。，<a class="ae ky" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">让我们加密</a>是设置免费SSL的绝佳选择。最后，确保在生产环境中强制执行SSL连接，并将任何不安全的请求重定向到HTTPS。</p><p id="4916" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将这一行添加到生产配置中，以强制在生产环境中通过SSL对应用程序进行所有访问:</p><pre class="kj kk kl km gt nu nc nv nw aw nx bi"><span id="5cff" class="ny md it nc b gy nz oa l ob oc">#config/environments/production.rb </span><span id="acc3" class="ny md it nc b gy od oa l ob oc">config.force_ssl = true</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="505d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">4.用环境变量保护API键</h1><p id="9f36" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">加密凭证最初是在Rails 5.1中引入的。在此之前，可以选择使用像Figaro或dotenv-rails这样的宝石。Rails 6通过引入特定于环境的凭证文件使这变得更加简单。</p><p id="f733" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">什么样的数据应该加密？连接到Stripe、AWS或Google等第三方服务的任何API密钥。经验法则是git不应该跟踪这些文件——即使是私有存储库——以避免意外共享。</p><p id="2d04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要编辑凭证，请在终端中运行<code class="fe mz na nb nc b">credentials</code>命令。指定环境(开发、测试或生产):</p><pre class="kj kk kl km gt nu nc nv nw aw nx bi"><span id="da40" class="ny md it nc b gy nz oa l ob oc">rails credentials:edit --environment development</span></pre><p id="8f2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在<code class="fe mz na nb nc b">config/credentials/development.key</code>中用新的加密密钥创建一个<code class="fe mz na nb nc b">config/credentials/development.yml.enc</code>文件。</p><p id="ed1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将密钥添加到YAML文件中:</p><pre class="kj kk kl km gt nu nc nv nw aw nx bi"><span id="d3ae" class="ny md it nc b gy nz oa l ob oc">stripe:<br/>  publishable_key: XXXXXXXXX123</span></pre><p id="dcf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要访问应用程序中的值，请使用<code class="fe mz na nb nc b">Rails.application.credentials</code>:</p><pre class="kj kk kl km gt nu nc nv nw aw nx bi"><span id="8b20" class="ny md it nc b gy nz oa l ob oc">Rails.application.credentials.stripe[:publishable_key]<br/>=&gt; XXXXXXXXX123</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="84fe" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">5.防止暴力攻击</h1><p id="1c86" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于大多数应用程序来说，注册垃圾邮件是一个严重的问题，当一个新推出的应用程序在一夜之间获得100个用户，但其中98个都是机器人时，会感到非常沮丧。<code class="fe mz na nb nc b"><a class="ae ky" href="https://github.com/kickstarter/rack-attack" rel="noopener ugc nofollow" target="_blank">rack-attack</a></code> gem是用于阻止和抑制滥用请求的机架中间件。它有助于减少堵塞数据库和限制应用程序带宽的垃圾邮件帐户的数量。</p><p id="d143" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">gem提供了将IP地址列入白名单或黑名单、添加限速标题以及防止来自同一电子邮件地址的注册垃圾邮件的功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="32d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于这一点，防止注册垃圾邮件的另一种方法是为<code class="fe mz na nb nc b">Devise</code>启用注册确认，它会发送一封电子邮件来确认用于注册帐户的电子邮件地址是有效的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c872" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更多资源</h1><p id="b617" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">关于这个主题的更多信息，请查看创建安全应用程序的ThoughtBot指南以及由Bruno Facca创建的令人难以置信的全面安全清单。</p><div class="oe of gp gr og oh"><a href="https://thoughtbot.com/blog/building_secure_web_applications_with_ruby_on_rails" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">用Ruby on Rails构建安全的web应用程序</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">使用像Ruby on Rails这样的成熟框架来构建web应用程序的优势在于，它相当…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">thoughtbot.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://github.com/brunofacca/zen-rails-security-checklist" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">布鲁诺法卡/Zen-rails-安全-清单</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">本文档提供了在开发应用程序时要实施的安全措施的不一定全面的列表</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov ks oh"/></div></div></a></div><p id="1f53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码快乐！请告诉我接下来应该讨论哪个Ruby on Rails主题！</p></div></div>    
</body>
</html>