<html>
<head>
<title>Implement UIKit Automatic Keyboard Avoidance in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS中实现UIKit自动键盘回避</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/implement-uikit-automatic-keyboard-avoidance-in-ios-562e2d4ce436?source=collection_archive---------9-----------------------#2021-05-18">https://betterprogramming.pub/implement-uikit-automatic-keyboard-avoidance-in-ios-562e2d4ce436?source=collection_archive---------9-----------------------#2021-05-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="76b2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不需要第三方Swift库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b73734ecdd2b0db6b79c26145e3db64e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JSLtbYf_uYYidgeZ"/></div></div></figure><p id="31ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在iOS 14中，苹果通过赋予SwiftUI自动键盘回避功能来显示他们对swift ui的喜爱。默认情况下它是打开的，这意味着一旦你为iOS 14构建了你的应用程序，你所有的SwiftUI视图都可以自动获得这一令人敬畏的功能。</p><p id="ee62" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不幸的是，不管出于什么原因，苹果并没有为UIKit提供这一功能，尽管这是全世界开发者最需要的功能之一。</p><p id="1551" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我将向您展示如何使用我最近发现的技巧在视图控制器中启用自动键盘回避。最棒的是，这个简单的技巧不需要任何第三方库。</p><p id="1a4e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事不宜迟，让我们开始吧！</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="8073" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">示例应用程序</h1><p id="00c5" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">出于演示的目的，我创建了一个名为<code class="fe mu mv mw mx b">TextFieldViewController</code>的视图控制器，它由一个堆栈视图填充。在堆栈视图中，一个黄色视图占据了视图控制器的上半部分，另一个蓝色视图占据了视图控制器的下半部分。在底部的蓝色视图中，我添加了一个<code class="fe mu mv mw mx b">UITextField</code>来触发键盘。</p><p id="056c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是<code class="fe mu mv mw mx b">TextFieldViewController</code>的完整实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="e5d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在UIKit中，当我们选择文本字段时，键盘会阻止文本字段。这是一个非常糟糕的用户体验，因为用户在键入时无法看到文本字段内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/291f788cb5ee466aa4a34a87646dfc1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*drZ8xfcoNlR3PVEQ"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">UIKit中没有自动键盘回避</p></figure><p id="4d98" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">相反，我们希望系统自动将文本字段上移，这样键盘就不会挡住文本字段。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/060658ce79d27a8cc211c987f8ad020b.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*Ow53dhS32RHvMhKF"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">UIKit中启用了自动键盘回避</p></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="ddd9" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">这个概念</h1><p id="107b" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">最近，我发现自动键盘回避并不仅限于SwiftUI视图，也适用于符合<code class="fe mu mv mw mx b"><a class="ae nf" href="https://developer.apple.com/documentation/swiftui/uiviewcontrollerrepresentable" rel="noopener ugc nofollow" target="_blank">UIViewControllerRepresentable</a></code>协议的结构。我猜这是因为，在系统上下文中，<code class="fe mu mv mw mx b">UIViewControllerRepresentable</code>实例也被视为SwiftUI视图。</p><p id="e568" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果是这样的话，让UIKit可以使用自动键盘回避就非常简单了。我们需要做的就是将<code class="fe mu mv mw mx b">UIViewControllerRepresentable</code>实例包装在<code class="fe mu mv mw mx b"><a class="ae nf" href="https://developer.apple.com/documentation/swiftui/uihostingcontroller" rel="noopener ugc nofollow" target="_blank">UIHostingController</a></code>中并呈现出来。</p><p id="c05c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记住这一点，让我们深入研究代码。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="b54e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">实施</h1><p id="c3a9" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">首先，我们需要实现一个符合<code class="fe mu mv mw mx b">UIViewControllerRepresentable</code>协议的结构。这个结构基本上将我们之前创建的<code class="fe mu mv mw mx b">TextFieldViewController</code>转换成一个SwiftUI视图。让我们把它命名为<code class="fe mu mv mw mx b">TextFieldView</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="1eb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了这些，我们现在可以将<code class="fe mu mv mw mx b">TextFieldView</code>包装在<code class="fe mu mv mw mx b">UIHostingController</code>中，并像我们通常呈现视图控制器一样呈现它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="a926" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面的动画GIF展示了我们实施的最终结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/5b3fc3b2e1fa949c9451f60f0ed877e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*KprKXPC9WCIWepBd"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">UIKit中默认的自动键盘回避行为</p></figure><p id="53b1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样！我们已经在<code class="fe mu mv mw mx b">TextFieldViewController</code>中成功启用了自动键盘回避。我们现在可以感受一下它是如何在UIKit上工作的。</p><p id="ee28" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看起来它的工作方式与SwiftUI类似:键盘现在会向上推动底部安全区域布局指南，降低容器视图的高度，从而压缩黄色和蓝色视图，而不是与视图控制器的容器视图重叠。</p><p id="cf33" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们的示例应用程序中(只有两个子视图和一个文本字段)，这种行为可能看起来没问题。但是假设您有一个包含多个文本字段和按钮的复杂视图。以这样的尺度降低它的高度，肯定会打破它的整个UI。</p><p id="12a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我们要寻找的行为是:当显示键盘时，向上移动文本视图，使其不被键盘阻挡，同时保持容器视图的维度。</p><p id="80dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">幸运的是，这种行为可以通过使用滚动视图轻松实现。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="3797" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">滚动查看救援</h1><p id="a9d9" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">这里的技巧是将视图控制器的容器视图中的所有内容包装在一个滚动视图中。这样，当显示键盘时，滚动视图框架高度将被压缩，而滚动视图内容高度将保持不变。</p><p id="4ff3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于我们的<code class="fe mu mv mw mx b">TextFieldViewController</code>，需要做的是用滚动视图填充容器视图，并将堆栈视图移动到滚动视图中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="ed3b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从上面的代码中，请注意，我们必须显式设置堆栈视图的高度，以便滚动视图可以在运行时确定其内容高度。</p><p id="5609" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是更改后我们得到的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/a1017f22749e459d913caf581ed80f0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*vd_6NLlQaw7Pw9yH"/></div><p class="nb nc gj gh gi nd ne bd b be z dk translated">使用滚动视图的自动键盘回避</p></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="da5d" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">禁用自动键盘回避</h1><p id="b0e9" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">尽管自动键盘回避是一个非常好的特性，但仍有一些情况下我们可能需要手动处理它。如果是这种情况，我们可以利用<code class="fe mu mv mw mx b"><a class="ae nf" href="https://developer.apple.com/documentation/swiftui/text/ignoressafearea(_:edges:)" rel="noopener ugc nofollow" target="_blank">ignoresSafeArea(_:edges:)</a></code>视图修改器将其关闭，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="b1f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意<code class="fe mu mv mw mx b">ignoresSafeArea(_:edges:)</code>是一个SwiftUI视图修改器，因此，它不能在视图控制器上工作。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="eba2" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">包扎</h1><p id="9b3e" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">我发现这个启用自动键盘回避的技巧非常有用，我非常喜欢它。另一方面，对我来说，这确实有点不舒服。你怎么想呢?如果你发现了这个技巧的任何不可预见的问题，请在评论中告诉我。</p><p id="5a54" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我希望你喜欢阅读这篇文章。</p><p id="5c44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="ba82" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">参考</h1><ul class=""><li id="98e0" class="ng nh it kw b kx mp la mq ld ni lh nj ll nk lp nl nm nn no bi translated"><a class="ae nf" href="https://www.fivestars.blog/articles/swiftui-keyboard/" rel="noopener ugc nofollow" target="_blank"> SwiftUI键盘回避</a></li><li id="30b6" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><a class="ae nf" href="https://sarunw.com/posts/swiftui-in-uikit/" rel="noopener ugc nofollow" target="_blank">如何在UIKit中使用swift ui</a></li><li id="0bf1" class="ng nh it kw b kx np la nq ld nr lh ns ll nt lp nl nm nn no bi translated"><a class="ae nf" href="https://fluffy.es/scrollview-storyboard-xcode-11/" rel="noopener ugc nofollow" target="_blank">如何在故事板中使用滚动视图</a></li></ul></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="5204" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nu">本文原载于2021年5月18日</em><a class="ae nf" href="https://swiftsenpai.com/development/uikit-keyboard-avoidance/" rel="noopener ugc nofollow" target="_blank"><em class="nu">https://swiftsenpai.com</em></a><em class="nu">。</em></p></div></div>    
</body>
</html>