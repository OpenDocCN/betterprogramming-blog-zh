<html>
<head>
<title>An iOS Developer’s Handbook for Code Reviewing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS开发人员代码审查手册</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/swift-the-art-of-code-reviewing-e4785da7e0c6?source=collection_archive---------3-----------------------#2021-12-08">https://betterprogramming.pub/swift-the-art-of-code-reviewing-e4785da7e0c6?source=collection_archive---------3-----------------------#2021-12-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7fb6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Swift中审查代码的5个主要方面——超过25个实用技巧</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/db8ff9c8c8c14a5d7b6bf0756116bc51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YE6s467_JUuL9sHJRTDxrg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">作者图片</p></figure><p id="845c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当你在团队中工作时，与所有同事建立共同语言是个好主意。</p><p id="433d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是非常非常重要的，以确保每个人都可以对你所开发的功能进行改进。很多时候，开发人员从一个团队来来去去。因此，新开发人员最终会修改您的代码、修复bug、添加特性或记录所有工作。应该考虑一种共同的“语言”,以确保您的所有队友都瞄准同一个目标，并且任何人都能理解该产品如何工作，思维敏捷。</p><p id="8943" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">代码审查过程是(或者至少应该是)任何公司拥有的最重要的文化技能之一。这是一个持续的反馈系统，有助于提高代码质量。如你所知，软件产品是一种社会契约。所有团队成员都必须了解它的方方面面，它是如何工作的，它是如何发展的，甚至更重要的是:它将走向何方？</p><p id="6b08" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你应该审查代码，不仅是为了尊重架构模式，也是为了提高应用程序的性能，降低复杂性，并确保一个小的代码变化不会破坏一个正常工作的软件。</p><p id="caab" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文将涵盖代码审查的所有方面，在检查其他人的代码时应该考虑什么，以及如何保持您的项目的可伸缩性——通过Swift中的示例。</p><h1 id="bad7" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">体系结构</h1><p id="5bd6" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">几乎每一家技术公司都根据移动世界社区已经记录的知识建立了自己的架构和主要设计模式。</p><p id="6937" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">可能是清洁，毒蛇，MVVM，MVP等。但是你必须记住的第一件事是，每个软件团队都有自己的偏好和构建代码的方式。没有最正确的代码模式。所有架构都有自己的优点和缺点，当你被雇用时，你就签署了一份抽象的合同，牺牲自己来适应组织的工作方式。</p><p id="101b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当审查某人的代码时，需要仔细观察以确保没有任何东西破坏架构。例如:假设在一个架构中有3层:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/b4e77cab5aa1839e3cd985016d42cbd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hc0U6q3uHhvbgixZZsWdrg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">任何场景中的流程都必须是A -&gt; B -&gt; C</p></figure><p id="f888" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">基本上，<code class="fe mp mq mr ms b">A</code>实例有一个<code class="fe mp mq mr ms b">B</code>类型的引用<code class="fe mp mq mr ms b">b</code>，它有一个<code class="fe mp mq mr ms b">C</code>类型的引用<code class="fe mp mq mr ms b">c</code>。那个<code class="fe mp mq mr ms b">c</code>参考对<code class="fe mp mq mr ms b">A</code>也有弱参考。任何破坏数据流的东西都必须经过代码所有者的审查。<code class="fe mp mq mr ms b">B</code>无法向<code class="fe mp mq mr ms b">A</code>返回任何信息，因为<code class="fe mp mq mr ms b">C</code>无法与<code class="fe mp mq mr ms b">B</code>通信。这个项目中的所有模块必须同意这个协议。</p><p id="52bd" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">说到毒蛇，<code class="fe mp mq mr ms b">View</code>必须和<code class="fe mp mq mr ms b">Presenter</code>交流，而且只能和<code class="fe mp mq mr ms b">Presenter</code>交流，只要<code class="fe mp mq mr ms b">Interactor</code>不能和<code class="fe mp mq mr ms b">Router</code>或者<code class="fe mp mq mr ms b">View</code>交流。</p><p id="2721" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">说到干净的雨燕，<code class="fe mp mq mr ms b">Present</code>不知道<code class="fe mp mq mr ms b">Interactor</code>就像<code class="fe mp mq mr ms b">Interactor</code>不跟<code class="fe mp mq mr ms b">ViewController</code>说话一样，等等。如果你的任何队友违反了这个架构契约，你就不能将这个代码合并到一个epic或者开发分支中。您必须请求更改来修复架构。</p><h1 id="20e4" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">坚实的原则</h1><p id="0130" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">这与架构和设计解决方案有关，但考虑到它包含了最佳实践，这是一个更严格的规则。基本上，SOLID告诉我们所有的职责必须在它的所有层中分离:UI元素必须只有视图/视图模型层知道，业务逻辑必须保存在业务层中，API元素应该包含在服务层中。</p><p id="7ff7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上述任务不应该放在同一个类中——因为这会导致单元测试中的许多问题，使代码混乱，并为项目中的过度工程打开大门。为了避免这种情况，请检查:</p><ul class=""><li id="8d14" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">是否有任何业务逻辑或模型与UI一起被注入？</li><li id="3c9b" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">除了呈现和更新小部件，你的视图层还做什么工作吗？</li><li id="e42e" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">你的业务层知道Apple UIKit吗？</li><li id="e5fd" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">您是否正在创建API调用并在业务逻辑所在的地方处理后端错误？</li></ul><p id="6265" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果以上任何一个问题的答案是肯定的，那么代码很有可能违反了坚实的原则。要求您的同事检查这些更改。</p><h1 id="0cee" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">优化代码</h1><p id="a8f5" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">正如我提到的，代码必须总是易于维护，对于其他队友来说，更重要的是对于团队中的新人来说。为了强调这一点，这里有一些技巧可以让你的代码简单易懂，并让一些任务变得更简单:</p><ul class=""><li id="0cb8" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">你的类变量是否代表了你注入的属性中的一些数据？如果是，将其转换为计算变量，如下所示:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/e50d4159312ecff2d6136a85e0ca4d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NuM8XxkNnHargk6eE8CCcA.jpeg"/></div></div></figure><ul class=""><li id="c779" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">您是否正在创建一个由另一个方法或类同样完成的任务，这种方式浪费了一些代码行？不要浪费这个方法，直接调用它。</li><li id="2433" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">如果您在代码中转换一些数据，并且有一些错误处理，使用<code class="fe mp mq mr ms b">guard let</code>而不是<code class="fe mp mq mr ms b">if let</code>来简化您的数据流:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/96d1c653ee005ecb40b594d03ac76bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZR-MsO_3LOKnSVcI2GgAoQ.jpeg"/></div></div></figure><ul class=""><li id="4d08" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">你是否在代码中多次编写一些复杂的任务？将其转换为注入其参数的方法。</li><li id="31e7" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">你有没有一个<code class="fe mp mq mr ms b">enum</code>案例可以处理多种类型的值？将定制数据转换为enum的一些内部变量，如下所示:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/224dff5f1cb9e34a44a75fe7926ac21f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TZhocEVCli9sihn0NYcl9A.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">基于枚举事例定义的所有这些属性必须是内在的</p></figure><ul class=""><li id="5e31" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">你有一个类代表的模型吗？把它转换成一个结构。</li><li id="5f4c" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">你强制解开任何数据吗？宁可使用一个守卫let语句来处理它为空的情况。或者可能是带有默认值的合并运算符。</li><li id="9def" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">您是否只检查if-else语句中的一个布尔值？请改用三元运算符:</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/38189654199c4a40f8c93210e58c0a22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RscAlnhzAzSykHW24Mxbhg.jpeg"/></div></div></figure><ul class=""><li id="ecce" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">你是否在你的应用程序中多次重复一些文本字符串？将它们集中在一个空间中，就像私有枚举一样。</li><li id="96de" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">你是不是只在类的某个部分初始化一些数据？以不浪费内存的方式使用惰性变量而不是默认变量</li><li id="d325" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">一个类的所有不能在外部访问的属性都被声明为私有。</li><li id="2adc" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">你在仔细检查一些可选的吗？比如“guarding let”一个对象和它的一些属性在同一个代码块里？</li></ul><p id="db0e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所有这些提示都是人们对代码的简单性、性能和易读性不够小心的一些最常见的原因。避免成为他们。</p><h1 id="9d07" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">易测性</h1><p id="c10f" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">当然，您的公司关心其代码的单元测试部分，以避免围绕特性传播错误和bug，并且单元测试是至关重要的。要保持类的所有特性都是可测试的，请遵循以下提示:</p><ul class=""><li id="08b2" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">确保你的类有一个协议，它的所有接口都指向它被调用的地方。这样，它的行为必须为多种类型的实例实现。</li><li id="1d37" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">该类有任何依赖关系吗？确保这些依赖项有一个接口，可以在不干扰测试的情况下被模拟。</li><li id="793a" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">将你的类单元任务分成不同的方法，以便所有的方法和它们不同的上下文都可以被测试。</li></ul><h1 id="942c" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">用户界面</h1><p id="59a5" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">当然，您没有时间运行您正在审查的所有代码，所以您必须小心任何必须破坏正在创建的接口的事情:</p><ul class=""><li id="03a7" class="mt mu iq kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">这段代码对它的所有组件都设置了约束吗？</li><li id="0960" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">如果一个视图控制器有一些自定义的主视图类，它是否在<code class="fe mp mq mr ms b">loadView</code>方法中被赋值？</li><li id="42c5" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">所有的UI操作都是在主线程中完成的吗？检查你是如何处理GCD的。</li><li id="3aae" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">检查同事是否在拉动式请求描述中填写了一些照片。确保界面以正确的方式工作是很重要的。</li><li id="9ce5" class="mt mu iq kx b ky nc lb nd le ne li nf lm ng lq my mz na nb bi translated">如果某个设计系统组件正在被实例化，该类中任何已经设置的属性是否会被覆盖？</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/96d1c653ee005ecb40b594d03ac76bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZR-MsO_3LOKnSVcI2GgAoQ.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">这破坏了自定义标签的身份</p></figure><h1 id="06e4" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">特色突破与遗产</h1><p id="2da2" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">如果你在一家非常大的公司工作，多年来已经开发了很多软件，那么你肯定要处理的一件事就是遗留代码。</p><p id="13e7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">遗留代码只不过是应用程序的旧结构，仍然用于支持应用程序中的一些功能。通常，这些功能遵循非常旧的代码风格，如旧的架构，甚至一些不再使用的Swift资源。在某些情况下，你可能会经常面对一些Objective-C文件。</p><p id="3ba3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">审查在遗留系统上开发的新代码需要你更多的关注，因为，你知道，这就像一个巨大的建筑，任何一个小的基础部件被交换都可能导致整个结构倒塌。如果你改变了应用程序核心部分的一些代码行，你可能会禁用一些基本功能，比如互联网检查或者一些安全机制。</p><p id="0fa7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">考虑到这一点，当您审查某个核心类或模块被修改的pull请求时(不考虑新的属性或方法)，请检查分支并运行您自己的代码，看看是否有任何东西被破坏。另一个建议是向你的同事伸出援手，理解为什么需要改变。或者你可以建议另一种不需要编辑遗留代码的方法。如果真的有必要接触那部分代码，咨询创建核心代码的团队，并与那个人一起决定哪种方式是最好的。</p><p id="c15d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">它不一定是遗留代码，如果有人正在修改一个已经在生产中的类，应该注意这种改进可能给你的应用带来的后果。</p><h1 id="3902" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">结论</h1><p id="8e67" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">在本文中，我介绍了在审查某人的代码时要考虑的几个方面。正如我告诉你的，每个公司都有自己的解决方案来维护软件的可伸缩性、可测试性，并随着时间的推移而改进。没有最佳解决方案，每个环境都需要自己的资源。</p><p id="3ea7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在创建代码模式时，有一些“规则”是必须遵守的。都是为了避免任何app经常出现的问题，树立软件工程的良好做法的模式。</p><p id="0684" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我希望你现在是一个更好的代码审查者，并找到自己的方法来提高软件质量。</p></div></div>    
</body>
</html>