<html>
<head>
<title>How To Check Your JavaScript Bundles for Browser Support</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何检查您的JavaScript包是否支持浏览器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/check-your-javascript-bundles-for-browser-support-d769c1fca4c?source=collection_archive---------6-----------------------#2020-09-03">https://betterprogramming.pub/check-your-javascript-bundles-for-browser-support-d769c1fca4c?source=collection_archive---------6-----------------------#2020-09-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a395" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不要向使用旧浏览器的用户发送损坏的代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/44db45c6831a3c073b05be7726859dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dUHVLQ4ZVLP7Dh0f"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">费伦茨·阿尔马西在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="11ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Internet Explorer即将消失，每个人都欢欣鼓舞。自动浏览器和操作系统更新让用户保持最新状态。然而，总会有用户使用不支持某些功能的浏览器访问您的网站。这取决于你的用户群。如果你的一些客户是企业公司，可能会有很多用户因为某些原因不得不使用IE11或者一个非常老的Mozilla Firefox。</p><p id="8f6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">甚至一些相对现代的浏览器也不支持所有最新的JavaScript特性。虽然谷歌Chrome通常是新JavaScript功能的早期采用者，但Mozilla Firefox和苹果Safari并不总是跟上谷歌Chrome的步伐。</p><p id="2e96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管如此，支持IE11通常比支持其他流行的浏览器更困难。看看这篇文章，当你的Angular应用程序在IE11中不工作时，如何修复它:</p><div class="lv lw gp gr lx ly"><a href="https://medium.com/better-programming/how-to-fix-your-angular-app-when-its-not-working-in-ie11-eb24cb6d9920" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">如何在IE11中修复不工作的Angular应用程序</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">使用聚合填充支持新功能</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">medium.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="5812" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要点:如果你想支持广泛的浏览器，包括IE11这样的老歌，那么你需要在你的应用程序中包含polyfills，并确保浏览器支持你提供给用户的JavaScript文件。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="80ea" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">IE11事件</h1><p id="e201" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">最近，我们偶然发现了一个问题，我们的应用程序根本不能在IE11中启动。问题很快就被发现了:一些代码没有像预期的那样传输，所以用户会下载包含箭头函数的JavaScript代码，IE11根本不支持。然而，检查你的网站旧浏览器的兼容性是一件麻烦的事情。如果你没有Windows电脑，那么你最好使用BrowserStack或LambdaTest这样的服务。然而，这通常非常缓慢和麻烦。</p><p id="1309" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将代码部署到生产环境之前发现这些问题的解决方案是在部署之前运行自动化的端到端测试。端到端测试模拟真实的用户场景，这允许您快速发现错误。有一些流行的测试框架，比如<a class="ae ky" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank"> Cypress </a>。然而，这些测试的执行可能会花费一些时间，并且与单元测试相比，这些测试可能会更加复杂和难以维护。尽管如此，至少进行一些端到端的测试会给应用程序作为一个整体工作带来一些信心。</p><p id="989e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自动化浏览器测试的问题是，尽管许多框架和测试运行者支持最新版本的Chrome和Firefox，但IE11等旧浏览器通常得不到很好的支持(例如，量角器)或根本不支持(例如，Cypress)。这意味着在所有常用的浏览器上运行自动化测试通常是不可行的。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="739e" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">让我们验证一下我们的包在旧浏览器中也能工作</h1><p id="8d4f" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">一位同事有一个好主意，那就是采用另一种方法，这种方法实现起来更快，并且至少提供了一些安全性，即应用程序代码也可以在较旧的浏览器中工作。想法是在我们的持续集成管道中放置另一个检查，在产品构建之后检查生成的包。这将在代码部署到生产环境之前发现类似上面提到的arrow函数问题。</p><p id="867a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这种简单的检查不能提供与手工或自动化测试相同的有效性。尽管如此，这个简单的检查可以防止开发人员在没有自己检查的情况下发布完全损坏的代码。</p><p id="8620" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CI/CD管道的基本步骤如下所示:</p><ol class=""><li id="3821" class="nr ns it lb b lc ld lf lg li nt lm nu lq nv lu nw nx ny nz bi translated">运行构建(例如，对于Angular，您可以使用<code class="fe oa ob oc od b">ng build --prod</code>)。</li><li id="3f1c" class="nr ns it lb b lc oe lf of li og lm oh lq oi lu nw nx ny nz bi translated">检查生成的包是否有问题。如果存在错误，则CI作业应标记为失败，并且不能继续执行后续步骤，如部署。</li><li id="9989" class="nr ns it lb b lc oe lf of li og lm oh lq oi lu nw nx ny nz bi translated">继续接下来的步骤(例如，部署)。</li></ol><p id="61d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们找到了一个名为<a class="ae ky" href="https://github.com/yowainwright/es-check" rel="noopener ugc nofollow" target="_blank"> ES Check </a>的便利库。它可以作为开发专用的依赖项与npm一起安装，但也可以使用<a class="ae ky" href="https://github.com/npm/npx" rel="noopener ugc nofollow" target="_blank"> npx </a>直接调用。您只需要将它指向您的包的目录，并告诉它您想要支持哪个版本的ECMAScript(读:JavaScript)(例如，ES5)。这个过程不会超过几秒钟。以下是直接摘自项目文档的解释性摘录:</p><blockquote class="oj ok ol"><p id="60f3" class="kz la om lb b lc ld ju le lf lg jx lh on lj lk ll oo ln lo lp op lr ls lt lu im bi translated">“在现代JavaScript版本中，文件被捆绑在一起，因此它们可以在浏览器中以优化的方式提供。开发人员认为，未来的JavaScript——像ES8一样——将由Babel这样的工具适当地转换(从未来的JavaScript变为当前的JavaScript)。有时会出现文件无法传输的问题。到目前为止，还没有有效的方法来测试未传输的文件。ES Check就是干这个的。”— <a class="ae ky" href="https://github.com/dollarshaveclub/es-check" rel="noopener ugc nofollow" target="_blank"> ES检查</a></p></blockquote></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="359c" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">如何用ES Check检查生成的JavaScript包</h1><p id="b715" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">现在我们已经了解了问题，让我们看看如何将ES检查纳入CI渠道。</p><p id="3b01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个简化的GitLab CI管道:</p><pre class="kj kk kl km gt oq od or os aw ot bi"><span id="363f" class="ou mv it od b gy ov ow l ox oy"># Run a full build<br/>aot build:<br/>  image: node:12.18.3<br/>  script:<br/>    # install dependencies<br/>    - npm ci<br/>    # run a full, production-ready build (this is a npm script)<br/>    - npm run build:production<br/>    # check es5 bundles for older browsers compatibility<br/>    - <strong class="od iu">npx es-check es5 ./your-dist-folder/*.js --verbose</strong></span></pre><p id="277d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功运行ES Check的输出如下所示:</p><pre class="kj kk kl km gt oq od or os aw ot bi"><span id="0c89" class="ou mv it od b gy ov ow l ox oy">ES-Check: Going to check files using version 5</span><span id="f022" class="ou mv it od b gy oz ow l ox oy">ES-Check: checking ./dist/common-es5.036d8a8f1d8ed1b18e05.js</span><span id="7442" class="ou mv it od b gy oz ow l ox oy">ES-Check: checking ./dist/main-es5.9c2c8a661140187e4316.js</span><span id="bb3d" class="ou mv it od b gy oz ow l ox oy">ES-Check: checking ./dist/modules-login-login-module-ngfactory-es5.91da0ff09285192d7330.js</span><span id="5eb6" class="ou mv it od b gy oz ow l ox oy">ES-Check: checking ./dist/modules-user-profile-user-profile-module-ngfactory-es5.68f5a6161704cb750f93.js</span><span id="eee6" class="ou mv it od b gy oz ow l ox oy">ES-Check: checking ./dist/polyfills-es5.e3f8b2d4d82eeaed59a0.js</span><span id="c577" class="ou mv it od b gy oz ow l ox oy">ES-Check: checking ./dist/runtime-es5.934c3283cc8c6d77c916.js</span><span id="6cc3" class="ou mv it od b gy oz ow l ox oy">ES-Check: there were no ES version matching errors!  🎉</span></pre><p id="4b5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有问题，ES Check将导致您的CI作业失败，这将阻止您发布在旧浏览器中根本不工作的代码。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="3b8f" class="ou mv it bd mw pa pb dn na pc pd dp ne li pe pf ng lm pg ph ni lq pi pj nk pk bi translated">更新:为GitHub项目引入es-check-action</h2><p id="89b8" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">最近，我创建了<code class="fe oa ob oc od b"><a class="ae ky" href="https://github.com/marketplace/actions/es-check-action" rel="noopener ugc nofollow" target="_blank">es-check-action</a></code>，一个简单且可配置的GitHub动作来自动化这个过程。操作是单独的任务，您可以组合这些任务来创建作业和自定义您的工作流。您可以创建自己的操作，或者使用和定制GitHub社区共享的操作。这个GitHub动作根据es的指定版本检查JavaScript文件。如果指定文件的ES版本与ES版本参数不匹配，此操作将引发错误。</p><p id="7448" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我计划发布一个通用的GitHub动作教程，我将用这个动作作为例子。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="bbfd" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">结论</h1><p id="6608" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">感谢您阅读这篇关于如何检查浏览器支持的JavaScript包的短文。如您所见，很容易将这种快速捆绑检查作为CI管道的一部分。然而，这并没有消除对一些适当的自动或手动测试的需要。你如何检查你的网络应用程序的浏览器兼容性？请在评论中告诉我。</p></div></div>    
</body>
</html>