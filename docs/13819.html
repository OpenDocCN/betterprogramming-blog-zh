<html>
<head>
<title>Why I Prefer Regular Merge Commits Over Squash Commits</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我更喜欢常规的合并提交而不是挤压提交</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/why-i-prefer-regular-merge-commits-over-squash-commits-cadd22cff02c?source=collection_archive---------0-----------------------#2022-09-30">https://betterprogramming.pub/why-i-prefer-regular-merge-commits-over-squash-commits-cadd22cff02c?source=collection_archive---------0-----------------------#2022-09-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a625" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我曾经认为壁球提交是<em class="ki">太酷了</em>，然后我不得不每天一整天都使用它们。这就是为什么你应该避免壁球</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/46109fa2a59f5496ea124df9bb5d0bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ei5Qo9EduVteZ-AF"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">我其实对南瓜不过敏，只是对南瓜过敏。(照片由<a class="ae kz" href="https://unsplash.com/@vivirishe?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">维维安娜·里舍</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</p></figure><p id="ff00" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">“哇，太酷了！”</p><p id="272f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我将永远记得看到我第一次壁球提交。</p><p id="e139" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当我第一次加入一个拥有200多名成员的大型工程组织时，squash提交是我注意到的第一件事。</p><p id="d7e7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对我来说，整个公司一致使用壁球提交体现了“专业精神”和“我们知道我们在做什么！”</p><p id="cdba" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我花了大约一个月的时间才意识到我真的<em class="lw">真的</em>不喜欢挤压提交，我开始渴望好的、老式的合并提交。</p><h1 id="01a8" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">挤压与合并Git提交的比较</h1><p id="ca7c" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">回顾一下,“挤压提交”和“合并提交”之间的区别在于，常规的“合并”包括目标分支历史中的所有Git提交，而“挤压”将它们展平为一个提交。</p><p id="df6f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">令人困惑的是，“壁球”并不是它自己的命令。相反，当您分别运行<code class="fe mu mv mw mx b">git merge</code>或<code class="fe mu mv mw mx b">git rebase</code>命令时，您可以选择“挤压并合并”或“挤压并重设基础”作为选项。</p><p id="ac81" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">默认情况下，一个拉请求(PR)将是一个合并提交，因此在PR被合并之后，工作分支的整个历史将被合并，加上一个额外的提交(“来自分支的合并拉请求# 21……”)。</p><p id="3c7a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">另一方面，您可以将您的存储库默认设置为“压缩并合并”，这意味着合并的PRs将只产生一个提交，而不是从工作分支带来所有的提交。</p><h1 id="7e3d" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">为什么有人会使用挤压提交？</h1><p id="8c60" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">挤压提交的好处是您保留了一个“干净的”Git提交历史。因为我们开发人员是出了名的…让我们说“精确”吧…那么一个整洁的提交历史听起来绝对不可思议。不是的。</p><p id="2a47" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你可以看到为什么我对这种专业精神印象深刻——整个工程组织如此专注于拥有一个干净的提交历史，以至于他们已经强制将“挤压和合并”作为默认设置！</p><p id="294e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">不幸的是，拥有干净的提交历史的好处也就到此为止了——历史可能是干净的，但是我的日常工作需要比压缩提交所能提供的更多的<a class="ae kz" href="https://www.urbandictionary.com/define.php?term=context" rel="noopener ugc nofollow" target="_blank">上下文</a>。</p><p id="ef98" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">根据定义，挤压提交会丢失信息。我喜欢把它想象成一个黑洞，在那里信息被转化成“<a class="ae kz" href="https://en.wikipedia.org/wiki/Hawking_radiation" rel="noopener ugc nofollow" target="_blank">霍金辐射</a>”，在这个特殊的例子中，它是以开发者沮丧的单位来衡量的。</p><h1 id="4f5f" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">壁球提交的压倒性弱点</h1><p id="099d" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">我很快对squash提交失望了，原因很简单，我的工作90%是修复旧代码中的错误。当我使用<a class="ae kz" href="https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens" rel="noopener ugc nofollow" target="_blank"> Git Lens </a>运行<code class="fe mu mv mw mx b"><a class="ae kz" href="https://www.git-scm.com/docs/git-blame" rel="noopener ugc nofollow" target="_blank">git blame</a></code>来检查一行时，我永远也学不会所有的东西。</p><p id="a26e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">几乎公司的每一个<code class="fe mu mv mw mx b">git blame </code>都写着“由{我的老板或同事}提出的合并拉动请求#237”，没有其他信息。如果不手动查找，我甚至找不到公关的主题！多么令人沮丧！</p><p id="df35" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我会尽职尽责地调出原始的PR和ticket，试图了解为什么这一行代码会发生变化，但我不知道。你知道PR经常一次修改几百行代码吗？是啊…</p><p id="3da6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我用一个手指就能数出我需要一次恢复一个被压扁的提交的次数，这是一次公关的戏剧性回滚，将我们的整个路线图推迟了整整一个月。</p><p id="ae06" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">其余的时间，我会做我正常的工作，试图在“你能在今天结束前把这个交给QA吗？”的期限内修复bug。当我检查一行代码时，我不知道它为什么会改变，因为有挤压提交。</p><h1 id="4c6d" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">为什么我不喜欢压缩我的合并提交</h1><p id="b8d4" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">听着，我也想有一个干净的提交历史，但是不利的一面是日常工作的瘫痪。虽然很高兴知道“在修复另一个bug时出现了这个问题”，但是squash commit并没有给我足够的信息。</p><p id="0cff" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">假设我知道我的老板在18个月前用<code class="fe mu mv mw mx b">git blame</code>检查了某一行代码。在这一点上，他肯定不知道他为什么改变它，即使他能找到时间为我调查它。</p><p id="eb59" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用squash提交，留给我的信息更少:我只能找到导致行被更改的bugfix或特性，而不是行被更改的实际原因，这不足以继续。</p><p id="15e6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">虽然如果每一行都有一两个代码注释会很好，但我们都知道大多数开发人员不是这样工作的——当我查看新的React代码库时，我通常看到不到1%的代码实际上有任何注释。</p><p id="2792" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我不知道为什么代码改变的原因很简单；我的老板当时写下了原因(在提交消息中)，但后来我们决定毫无理由地“压制”它。<a class="ae kz" href="https://knowyourmeme.com/memes/does-it-spark-joy" rel="noopener ugc nofollow" target="_blank">那确实<em class="lw">而不是</em>激起欢乐</a>。</p><h1 id="2c6c" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">解决方案是合并提交，而不是挤压提交</h1><p id="7c17" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">这里有一个超级简单的解决方案，它实际上是默认的——只是不要挤压。我想知道的并不多，但这很重要:</p><ul class=""><li id="5561" class="my mz it lc b ld le lg lh lj na ln nb lr nc lv nd ne nf ng bi translated">重构:我的老板是否“重构”了这段代码，以提高可读性或可维护性，希望不会影响实际的功能？</li><li id="c147" class="my mz it lc b ld nh lg ni lj nj ln nk lr nl lv nd ne nf ng bi translated">杂务:我的老板是否在做一些不应该影响产品代码的清理“杂务”，比如添加代码注释或测试？</li><li id="0fbd" class="my mz it lc b ld nh lg ni lj nj ln nk lr nl lv nd ne nf ng bi translated">修复:我的老板是否“修复”了一个已识别的问题，如果是，这段代码破坏的具体问题是什么？</li><li id="6142" class="my mz it lc b ld nh lg ni lj nj ln nk lr nl lv nd ne nf ng bi translated">专长:我的老板是否在实现一个新的特性，比如创建一个具有面向用户功能的全新组件？</li></ul><p id="c186" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你是否意识到这些是<a class="ae kz" href="https://www.conventionalcommits.org/en/v1.0.0/" rel="noopener ugc nofollow" target="_blank">常规提交</a>(也称为<a class="ae kz" href="https://gist.github.com/joshbuchea/6f47e86d2510bce28f8e7f42ae84c716" rel="noopener ugc nofollow" target="_blank">语义提交</a>)，最好与<a class="ae kz" href="https://www.freshconsulting.com/insights/blog/atomic-commits/" rel="noopener ugc nofollow" target="_blank">原子提交</a>配对？</p><p id="0055" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我对该公司如此失望的原因是，围绕承诺信息有一种很好的文化，但围绕公关却很糟糕。</p><p id="66bb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">因为我们有超长的JIRA票，所以没有很好的理由在公关中写太多，但后来我们通过挤压扔掉了所有的上下文。</p><p id="4d00" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">结果是我们会花上几个小时试图修复错误，因为没有人记得任何给定的代码片段应该做什么。</p><p id="58ca" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">所以，在我现在的公司，我一天要做几十个提交，当我合并我的pr时，我会把它们都留在历史中。这可能有点乱，但对我的理智有好处，对<a class="ae kz" href="https://github.com/doctorderek" rel="noopener ugc nofollow" target="_blank">我的GitHub贡献图</a>也有好处。</p><p id="7a07" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">编码快乐！</p><p id="5bee" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">另外，如果你喜欢这个关于Git最佳实践的热门话题，那么你会喜欢我试图说服你写200个字符的提交消息，对吗？读读这个:</p><div class="nm nn gp gr no np"><a rel="noopener  ugc nofollow" target="_blank" href="/an-advice-for-developers-great-git-commit-messages-are-not-shorter-than-50-characters-2becf8fd481a"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd iu gy z fp nu fr fs nv fu fw is bi translated">给开发者的一个建议:“伟大的Git提交消息不要短于50个字符”</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">这个神话来自于80列x 25行的文本终端时代。这就是为什么你应该写长的提交消息</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">better编程. pub</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od kt np"/></div></div></a></div></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="5af6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">德里克·奥斯汀博士是《职业编程:如何在6个月内成为一名成功的6位数程序员 》一书的作者，该书现已在亚马逊上架。</p></div></div>    
</body>
</html>