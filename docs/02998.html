<html>
<head>
<title>Prototype Locally With Flutter and Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有颤振和燃烧基础的局部原型</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/prototype-locally-with-flutter-and-firebase-db8907222bea?source=collection_archive---------7-----------------------#2020-01-14">https://betterprogramming.pub/prototype-locally-with-flutter-and-firebase-db8907222bea?source=collection_archive---------7-----------------------#2020-01-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1211" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">永远不要再搞乱你的在线数据库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/62fbf9bf655becae80a801063e53f599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A1yYXNcGQ03-NPu9jqcZJg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@bamagal?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"/>在<a class="ae ky" href="https://unsplash.com/s/photos/teamwork?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的“我的镜头人生”</p></figure><p id="bb2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://flutter.dev/" rel="noopener ugc nofollow" target="_blank"> Flutter </a>是跨平台的app前端框架<a class="ae ky" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase </a>是app后端平台。它们经常一起使用。</p><p id="4406" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于Flutter和Firebase使用不同的语言(<a class="ae ky" href="https://dart.dev/" rel="noopener ugc nofollow" target="_blank"> Dart </a>和Node.js)，在一个包含的本地环境中同时测试/原型化这两者是一个不小的问题。</p><p id="460c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:在线测试并不可取，因为它会破坏数据库，并且需要复杂的设置(部署和版本匹配)。</p><p id="a212" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以用模拟的Firebase服务<a class="ae ky" href="https://firebase.google.com/docs/emulator-suite" rel="noopener ugc nofollow" target="_blank"> Firebase模拟器套件</a>实现本地测试。</p><p id="329d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了Flutter应用程序如何与Firebase仿真器套件进行交互:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/2f5398db19983275337e941ac12cb26b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQpQZgJuWa20gJ6YjH28mA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">信用:<a class="ae ky" href="https://firebase.google.com/docs/emulator-suite" rel="noopener ugc nofollow" target="_blank"> Firebase文档</a></p></figure><p id="48b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们一步一步地了解如何在Firebase模拟器套件中使用Flutter。</p><p id="33bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注:本文中用来说明的代码来自于<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">我的副业</a>。虽然我们主要关注Firebase的颤振，但经过一些修改，它也适用于X + Firebase，其中X可以是本地反应，等等。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="7fae" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">步骤1:安装Firebase模拟器套件</h1><p id="932e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">Firebase模拟器套件附带Firebase CLI，可以使用以下命令安装:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="9e01" class="nf me it nb b gy ng nh l ni nj">npm install -g firebase-tools</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="425d" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">步骤2:绕过仿真中的身份验证步骤</h1><p id="f440" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如上图所示，Firebase身份验证不是Firebase模拟器套件的一部分。因此，数据认证/授权不能在本地工作，所以它们必须被模仿。</p><p id="91a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多方法可以模拟身份验证。我使用Firebase模拟器套件设置的环境变量来模拟:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/8d04ff9f8d907a3fda62804a35012227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QHcZ3FJHMC_CehOP37evJA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的模拟认证实现示例</p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="17fc" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">步骤3:将Flutter应用程序连接到Firebase模拟器套件</h1><p id="d807" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们希望将Firebase云函数调用连接到本地主机:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/46c516f6cba928f37746a0a0b70ef2b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmZHrOyB3s2Ny8LETIUhyQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/tianhaoz95/iwfp/blob/master/iwfpapp/lib/services/data_store.dart#L38" rel="noopener ugc nofollow" target="_blank">从<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>将Firebase云函数调用连接到Firebase仿真器套件</a>的示例</p></figure><p id="8543" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:我们希望使用顶级环境来控制本地和云。有许多方法可以实现这一点。例如，设置环境变量或使用不同的入口点。</p><p id="7e95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个使用不同入口点的示例:</p><div class="nm nn gp gr no np"><a href="https://flutter-academy.com/build-flavors-environment-specific-configuration/" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd iu gy z fp nu fr fs nv fu fw is bi translated">构建风味和环境特定的配置| Flutter Academy</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">在构建移动应用程序时，通常会使用多种环境。例如，开发环境用于…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">flutter-academy.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od ks np"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="375e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">步骤4:启用HTTP(无“S”)连接(仅限iOS)</h1><p id="62dd" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">默认情况下，iOS不允许任何HTTP请求。</p><p id="ad36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要仅允许HTTP连接到本地主机，请将以下代码片段添加到<code class="fe oe of og nb b">[flutter_project_root]/ios/Runner/info.plist</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/f6efa49189ed084008103c0068e9bee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t7Irqi-ioKd2wyaklohNow.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://github.com/tianhaoz95/iwfp/blob/master/iwfpapp/ios/Runner/Info.plist" rel="noopener ugc nofollow" target="_blank"> iOS配置</a>来自<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>灵感来自<a class="ae ky" href="https://github.com/flutter/flutter/issues/38452" rel="noopener ugc nofollow" target="_blank">本期GitHub</a></p></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="75d2" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">步骤5:在本地开始测试</h1><p id="565e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在Firebase项目目录中运行以下命令将启动测试:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="a553" class="nf me it nb b gy ng nh l ni nj">npm run build &amp;&amp;<br/>firebase emulators:exec --only functions,firestore \"cd ../../flutter_app &amp;&amp; flutter drive --target=test_driver/emulator.dart\""</span></pre><p id="a316" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:</p><ul class=""><li id="b857" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated"><code class="fe oe of og nb b">firebase emulator:exec</code>接受第二个参数作为在启动模拟器时执行的命令。在我们的例子中，那是<code class="fe oe of og nb b">cd ../../flutter_app &amp;&amp; flutter drive --target=test_driver/emulator.dart</code>，意味着我们想首先导航到Flutter并开始我们的集成测试。</li><li id="9d2b" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated"><code class="fe oe of og nb b">npm run build</code>在这里很重要，因为模拟器只接受编译过的代码。</li><li id="24eb" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">将脚本作为<code class="fe oe of og nb b">npm run hermetic-device-test</code>添加到您的<code class="fe oe of og nb b">package.json</code>中也是一个好主意，这样您就不必记住这么长的命令。</li><li id="24d7" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">或者，您可以单独运行仿真器和Flutter应用程序，以便在一个终端中使用<code class="fe oe of og nb b">firebase emulators:exec --only functions,firestore</code>而在另一个终端中使用<code class="fe oe of og nb b">flutter run</code>进行交互式调试/开发。</li></ul></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2b1a" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">第六步:喝杯咖啡</h1><p id="dad0" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">测试将如下所示(参考每个执行阶段的图像标题):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/145c3b73208108eb60eca0d4c2e198b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7oqA-5au_3Hm_pCJfWVZA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Firebase仿真器套件从<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>启动</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/da6fb5ba379a103bac8784c679061560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YR8ZPBrtgz8sebK7-d4Afg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">天昊95/iwfp 的Firebase仿真器套件API部署</p></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/169d90f8a21eb6308c460cc26a492098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YTZafKx6rJpuUJ6TuDrw3A.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://github.com/tianhaoz95/iwfp" rel="noopener ugc nofollow" target="_blank">天昊95/iwfp </a>的Firebase仿真器套件中运行的颤振综合测试结果</p></figure><p id="1c2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您再也不用担心开发中的应用程序会再次搞乱数据库。快乐黑客与颤振和Firebase。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h2 id="a2b2" class="nf me it bd mf oz pa dn mj pb pc dp mn li pd pe mp lm pf pg mr lq ph pi mt pj bi translated">更新:</h2><p id="a2b8" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">这是我用Flutter + Firebase emulator做的一个现场编码会话，它可以直观地演示在原型制作中使用Firebase emulator的感觉:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pk pl l"/></div></figure></div></div>    
</body>
</html>