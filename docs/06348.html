<html>
<head>
<title>Organize Your Application Configuration Efficiently With Etcd</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Etcd高效组织您的应用配置</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/organize-your-application-configuration-efficiently-with-etcd-89dad3fa3dcf?source=collection_archive---------7-----------------------#2020-09-23">https://betterprogramming.pub/organize-your-application-configuration-efficiently-with-etcd-89dad3fa3dcf?source=collection_archive---------7-----------------------#2020-09-23</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="16c9" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">洞察最强大的etcd功能</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/c47a85a6a68697ea75a52cd875ac61bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qtdSZjLHVn6C15y7"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">由<a class="ae kz" href="https://unsplash.com/@euwars?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">法尔扎德·纳兹菲</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure><p id="4e00" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有时，我们的应用程序需要来自不同来源的配置数据，比如数据库连接属性、用户名和密码。维护和监控关键数据的变化变得非常困难。</p><p id="df61" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://etcd.io/" rel="noopener ugc nofollow" target="_blank"> etcd </a>为复杂和简单的应用程序提供了强大的解决方案。<a class="ae kz" href="https://www.ibm.com/cloud/learn/etcd" rel="noopener ugc nofollow" target="_blank">根据IBM </a>的说法，它是“一个开源的分布式键值存储，用于保存和管理分布式系统保持运行所需的关键信息。”您可以将您的应用程序配置存储在一个地方，它可以被分布式系统或机器集群访问。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="306d" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">为什么选择etcd？</h1><ul class=""><li id="35a4" class="mv mw iu lc b ld mx lg my lj mz ln na lr nb lv nc nd ne nf bi translated">它使用起来很简单:您可以使用标准的HTTP/JSON工具，比如curl，向etcd读取或写入数据。</li><li id="8c94" class="mv mw iu lc b ld ng lg nh lj ni ln nj lr nk lv nc nd ne nf bi translated">它是可靠的:它可以处理硬件和网络故障。如果您有一个群集，每个节点都是复制的，并且具有完全的数据访问权限。</li><li id="ccbd" class="mv mw iu lc b ld ng lg nh lj ni ln nj lr nk lv nc nd ne nf bi translated">它有强大的功能:您可以观察键值对或目录的修改，并对更改做出反应。</li></ul></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="0e9f" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">功能概述</h1><p id="8862" class="pw-post-body-paragraph la lb iu lc b ld mx jv lf lg my jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">让我们来看看一些最重要的功能。我们将使用<a class="ae kz" href="https://github.com/IBM/etcd-java" rel="noopener ugc nofollow" target="_blank"> etcd-java客户端</a>用Kotlin编写代码。</p><h2 id="06a2" class="no me iu bd mf np nq dn mj nr ns dp mn lj nt nu mp ln nv nw mr lr nx ny mt nz bi translated">入门指南</h2><p id="1b9e" class="pw-post-body-paragraph la lb iu lc b ld mx jv lf lg my jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">最快的入门方式是使用Docker映像。</p><ol class=""><li id="b775" class="mv mw iu lc b ld le lg lh lj oa ln ob lr oc lv od nd ne nf bi translated">创建一个<code class="fe oe of og oh b">docker-compose.yml</code>文件，并放入以下配置:</li></ol><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="b73d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意gRPC网关端点。etcd v3.4使用<code class="fe oe of og oh b">[CLIENT-URL]/v3/*</code>同时保留<code class="fe oe of og oh b">[CLIENT-URL]/v3beta/*</code>。有关入门的更多信息，请查看<a class="ae kz" href="https://github.com/etcd-io/etcd/blob/master/Documentation/dev-guide/api_grpc_gateway.md" rel="noopener ugc nofollow" target="_blank">开发指南</a>。</p><p id="8821" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">2.通过执行以下命令启动etcd:</p><pre class="kk kl km kn gu ok oh ol om aw on bi"><span id="3c0d" class="no me iu oh b gz oo op l oq or">docker-compose up -d</span></pre><p id="62d5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">3.现在，让我们通过检查etcd版本来测试连接:</p><pre class="kk kl km kn gu ok oh ol om aw on bi"><span id="d183" class="no me iu oh b gz oo op l oq or">curl -L http://127.0.0.1:2379/version</span></pre><p id="923d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您应该会看到这样的响应:</p><pre class="kk kl km kn gu ok oh ol om aw on bi"><span id="3039" class="no me iu oh b gz oo op l oq or">{"etcdserver":"3.4.13","etcdcluster":"3.4.0"}</span></pre><h2 id="ce3b" class="no me iu bd mf np nq dn mj nr ns dp mn lj nt nu mp ln nv nw mr lr nx ny mt nz bi translated">放和拿钥匙</h2><p id="9156" class="pw-post-body-paragraph la lb iu lc b ld mx jv lf lg my jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">您可以使用curl将键值对移植到etcd，但是在本教程中，我们将使用Kotlin来演示这些特性。</p><ol class=""><li id="3262" class="mv mw iu lc b ld le lg lh lj oa ln ob lr oc lv od nd ne nf bi translated">打开IDE，用Kotlin库创建一个新的Gradle项目。</li><li id="65fa" class="mv mw iu lc b ld ng lg nh lj ni ln nj lr nk lv od nd ne nf bi translated">将以下内容粘贴到您的<code class="fe oe of og oh b">build.gradle</code>文件中:</li></ol><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="62c9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，我们使用的是com.ibm.etcd客户端库。IBM的实现是健壮的，特别是在租约和观察抽象方面。</p><p id="88bb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">3.创建一个名为<code class="fe oe of og oh b">Main.kt</code>的类。</p><p id="ad77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">4.让我们在<code class="fe oe of og oh b">main</code>函数中创建etcd连接，并输入一些值:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="81c1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">5.运行应用程序来测试是否插入了键值对。</p><p id="4748" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你的控制台中的结果应该是<code class="fe oe of og oh b">value</code>。</p><p id="8649" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，etcd使用Base64编码。如果使用curl输入键值，就需要编写编码字符串。在这个例子中，键值对是<code class="fe oe of og oh b">foo-bar</code>:</p><pre class="kk kl km kn gu ok oh ol om aw on bi"><span id="b590" class="no me iu oh b gz oo op l oq or">curl -L http://localhost:2379/v3/kv/put \<br/>  -X POST -d '{"key": "Zm9v", "value": "YmFy"}'</span></pre><h2 id="9856" class="no me iu bd mf np nq dn mj nr ns dp mn lj nt nu mp ln nv nw mr lr nx ny mt nz bi translated">手表钥匙</h2><p id="a141" class="pw-post-body-paragraph la lb iu lc b ld mx jv lf lg my jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">如果您想对键值修改做出反应，Watch特性会很方便。</p><p id="4a1e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如，假设您有一个有状态的服务，并希望在运行时将日志级别从<code class="fe oe of og oh b">debug</code>更新到<code class="fe oe of og oh b">info</code>，而无需重启应用程序。</p><ol class=""><li id="4b48" class="mv mw iu lc b ld le lg lh lj oa ln ob lr oc lv od nd ne nf bi translated">创建一个观察器来检查<code class="fe oe of og oh b">watch</code>事件:</li></ol><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="e44c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">2.像我们之前做的那样放置一个键-值对:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="e5c3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">3.我们将模拟一些工作。为了简单起见，触发一个<code class="fe oe of og oh b">Thread.sleep</code>方法几秒钟。</p><p id="b2ce" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">4.最后，关闭手表。</p><p id="f0ed" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您可以观察您的所有键或特定键。我们只想观察<code class="fe oe of og oh b">loglevel</code> <strong class="lc iv"> </strong>键。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="oi oj l"/></div></figure><p id="8ff1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">5.启动应用程序，当它等待时，执行curl POST请求来更新<code class="fe oe of og oh b">loglevel</code> <strong class="lc iv"> </strong>键的值。在这个例子中，我将把<code class="fe oe of og oh b">debug</code> <strong class="lc iv"> </strong>更新为<code class="fe oe of og oh b">info</code>。我已经使用Base64算法对字符串进行了编码。</p><pre class="kk kl km kn gu ok oh ol om aw on bi"><span id="0f41" class="no me iu oh b gz oo op l oq or">curl -L http:<em class="os">//localhost:2379/v3/kv/put \<br/></em>-X POST -d '{"key": "bG9nbGV2ZWw=", "value": "aW5mbw=="}'</span></pre><p id="b03b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您应该会在IDE控制台中看到一个更新事件:</p><pre class="kk kl km kn gu ok oh ol om aw on bi"><span id="3038" class="no me iu oh b gz oo op l oq or">watch event: WatchUpdate[rev=1129,events=[Event[type=PUT,key=loglevel,modRev=1129,prevKey=]]]</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="46c1" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">结论</h1><p id="7e2d" class="pw-post-body-paragraph la lb iu lc b ld mx jv lf lg my jy li lj nl ll lm ln nm lp lq lr nn lt lu lv in bi translated">我们已经探索了一些最强大的etcd功能。我希望你能把这些知识应用到你的项目中。</p><p id="755b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">感谢您的阅读和快乐编码！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="64d7" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">参考</h1><ol class=""><li id="b0ac" class="mv mw iu lc b ld mx lg my lj mz ln na lr nb lv od nd ne nf bi translated"><a class="ae kz" href="https://github.com/etcd-io/etcd/blob/master/Documentation/dev-guide/api_grpc_gateway.md" rel="noopener ugc nofollow" target="_blank">https://github . com/etcd-io/etcd/blob/master/Documentation/dev-guide/API _ grpc _ gateway . MD</a></li><li id="e20f" class="mv mw iu lc b ld ng lg nh lj ni ln nj lr nk lv od nd ne nf bi translated"><a class="ae kz" href="https://etcd.io/" rel="noopener ugc nofollow" target="_blank">https://etcd.io/</a></li><li id="3fcf" class="mv mw iu lc b ld ng lg nh lj ni ln nj lr nk lv od nd ne nf bi translated"><a class="ae kz" href="https://github.com/IBM/etcd-java" rel="noopener ugc nofollow" target="_blank">https://github.com/IBM/etcd-java</a></li></ol></div></div>    
</body>
</html>