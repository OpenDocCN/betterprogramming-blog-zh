<html>
<head>
<title>Build a Discord Bot With AWS Lambda + API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用AWS Lambda + API网关构建一个Discord Bot</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-a-discord-bot-with-aws-lambda-api-gateway-cc1cff750292?source=collection_archive---------0-----------------------#2022-04-11">https://betterprogramming.pub/build-a-discord-bot-with-aws-lambda-api-gateway-cc1cff750292?source=collection_archive---------0-----------------------#2022-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e923" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">赶上无服务器时代</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/17c9b6a24497247894e786476c84d892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xh-w3XNYOYz2GdGe"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">亚历山大·科瓦奇在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="912b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="d045" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">最近，Discord引入了<strong class="lq ir">交互</strong>和<strong class="lq ir">斜线命令</strong>来缓解用户对机器人的体验。部分原因是为了保护用户的隐私——机器人现在稍微被迫放弃在不和谐服务器中读取消息的标志——这是以前关于机器人开发者非法数据处理的一个关注点。</p><p id="2a3f" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这些是最广为人知的特性，但是除此之外，更新还增加了通过交互端点URL与提到的交互进行交互的可能性。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/f8f44b780c6df126580fbfd8798b3424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*mP0QaUrF61fbRa7AtrMPkQ.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">开发人员仪表板的交互端点URL字段。</p></figure><p id="087e" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">这使得我们可以从服务器上托管的传统<strong class="lq ir">监听器</strong>应用程序转移到<strong class="lq ir">无服务器</strong>应用程序<em class="mk">* plateau *</em>，在每次交互调用时运行Lambda函数。</p><h1 id="fa26" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">将AWS Lambda连接到Discord</h1><p id="9637" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在编码过程中，我们会在“AWS”、“Code”和“Discord Developer Portal”之间跳转。</p><h2 id="3a79" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">自动警报系统</h2><p id="b07e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们将使用AWS API网关和AWS Lambda来完成我们的任务。它是AWS上无服务器架构的基础工具集。函数将在Node.js中编写。</p><ol class=""><li id="0910" class="nd ne iq lq b lr ml lu mm lx nf mb ng mf nh mj ni nj nk nl bi translated">在<a class="ae kv" href="https://aws.amazon.com" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com</a>创建账户并登录</li><li id="14b7" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">使用顶部导航栏转到API Lambda服务</li><li id="e7ff" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">选取边栏中的“功能”部分(如果尚未选取)</li><li id="33aa" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">点击“创建功能”</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/be247b6cb710d922c2de7a34c13ba7f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*M4CbXa7CvggUbOuxmmHEoA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AWS Lambda主页。</p></figure><p id="7477" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">如果你足够勇敢，插上信用卡马上点击它——你可能以前用过AWS或AWS Lambda。</p><p id="7ff2" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">如果你犹豫不决，现在是让你冷静下来的时候了:AWS Lambda免费层包括每月100万个免费请求和每月400，000 GB秒的计算时间。远远超过你在本教程中所需要的，或许以后也是如此(尽管我希望你能超越极限！).</p><p id="cb54" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">5.选择您的函数名，选择Node.js 14.x并单击“创建函数”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/bf50481704811caa79062f337741b149.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*ql-RuFOYlwWWUFmR-2fiww.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建功能面板。</p></figure><p id="a5a4" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">创建后，您应该会看到下面的仪表板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/25e0a144817a98b641e21aaf8f0a47d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OhaFBjCATpjgK5vanPnk4w.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">初始Lambda仪表板。是的，我们会像那样点击。现在不是实施IaC的时候。</p></figure><p id="f4d8" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">太好了！我们有一个带有样板代码的lambda。现在添加一个API触发器——我们需要一些URI传递给Discord门户，对吗？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/685a4242ed6b03ee39ee6e4b0912dc13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uwM9APjwMOeYlcHuSznPvQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">触发配置。</p></figure><p id="2a0f" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">让CORS允许不和的主机来源。在未来的某一天，你可能希望改变API端点和CORS允许的域的开放性，这样你就不会收到僵尸垃圾邮件(虽然这在AWS资源中并不常见)。</p><p id="1a1b" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">结果是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/b6cba37243c35a6f6524aa7b6ffb56e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5O_f9uc7GeS0N63DsiVOYg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">触发器已创建。</p></figure><p id="f862" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">点击API端点的URL:您应该看到“Hello from Lambda！”</p><h2 id="bf14" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">密码</h2><p id="4ae2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">创建项目目录<code class="fe nw nx ny nz b">serverless_discord/</code>。在里面，创建一个子目录<code class="fe nw nx ny nz b">lambda_bot/</code>和<code class="fe nw nx ny nz b">index.js</code>。使用以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="c10c" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在上面的代码中，我们遵循你已经可以在AWS Lambda样板代码中看到的结构(<code class="fe nw nx ny nz b">exports.handler</code>函数)。</p><p id="80f8" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">接下来，我们满足由<a class="ae kv" href="https://discord.com/developers/docs/interactions/receiving-and-responding#receiving-an-interaction" rel="noopener ugc nofollow" target="_blank">文档</a>中的Discord设置的端点需求(有效负载验证和ping应答)。验证是用<code class="fe nw nx ny nz b">tweetnacl</code>包完成的，那个我们还没有。我们来装吧！</p><p id="3774" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">最好的情况是如果你的<code class="fe nw nx ny nz b">node --version</code>接近Lambda运行时的版本(我们选择了<code class="fe nw nx ny nz b">14.x</code>)——理想情况下，如果它是相同的。如果它和<code class="fe nw nx ny nz b">npm</code>相隔太远，打包的模块可能无法在Lambda中工作。</p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="2792" class="mr kx iq nz b gy og oh l oi oj">npm i tweetnacl</span></pre><p id="58e0" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">很好。现在，让我们(用<code class="fe nw nx ny nz b">node_modules</code>)把所有这些都关掉吧！)并放回我们的Lambda中。在您的目录中，键入:</p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="1d47" class="mr kx iq nz b gy og oh l oi oj">zip -r ../lambda_bot.zip *</span></pre><h2 id="9110" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">自动警报系统</h2><p id="5efe" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">上传Lambda dashboard中的zip文件——“代码”部分。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/ae1c220f77d66c97eab4200faa9269b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*Hclo_j_rESrt0K5gsPAbqA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Lambda仪表盘。</p></figure><p id="d190" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><strong class="lq ir">或</strong>通过CLI，如果您安装并配置了AWS CLI:</p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="28a5" class="mr kx iq nz b gy og oh l oi oj">aws lambda update-function-code \<br/>    --function-name discord \<br/>    --zip-file fileb://../lambda_bot.zip</span></pre><p id="d311" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">一切看起来都很棒。快速创建不和谐的应用程序，三，二，一，开始！</p><h2 id="76fe" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">Discord开发者门户</h2><p id="1996" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">转到<a class="ae kv" href="https://discord.com/developers/applications" rel="noopener ugc nofollow" target="_blank"> Discord开发者门户</a>，选择新应用并选择一个名称。将以前创建的API端点复制到下面bot配置中的交互端点URL字段。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/f67737228a36fb619371af3495e20664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*JCVj73hTk3UWfEVMe536Eg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我真正的AWS API网关URL。</p></figure><p id="0db5" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">然后点击保存！</p><p id="5398" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">Saving对它们的需求执行不一致端检查——它们向您的端点发送一组POST请求。</p><p id="d5cb" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">滚动到页面顶部的通知，你有它！巨大的绿色成功栏-您的机器人是活的！你成功了！</p><p id="4ec4" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">啊？什么？你弄错了吗？嗯，错误信息是什么？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/11933e7974658ee9163b708f9113e7b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*n_uhdALyP1eUEuBdM4QtYA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">你给我发了这个没用的截图。</p></figure><p id="f179" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">当我只知道“某些东西”是错误的时候，我如何修复端点？我们最多可以假设，他们的两个要求中有一个没有满足。</p><h2 id="307a" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">自动警报系统</h2><p id="3643" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">要从AWS端调试它，您可以制作一些测试片段，并针对您的代码运行它们。不幸的是，不容易从Discord中找到一个确切的调用示例来模拟这一点。</p><p id="037f" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">您也可以通过在自己的计算机上运行代码来快速调试它(只需从处理函数中剥离<code class="fe nw nx ny nz b">index.js</code>中的代码)，但是您需要外部域重定向到您的本地ip，这有其自身的风险。</p><p id="a680" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">让我们添加控制台日志来了解一下，请求是否到来，以及我们是否正确地解释了它。</p><p id="6dce" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在<code class="fe nw nx ny nz b">index.js</code>的第一行添加日志记录</p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="86b2" class="mr kx iq nz b gy og oh l oi oj">const nacl = require('tweetnacl');</span><span id="4fda" class="mr kx iq nz b gy on oh l oi oj">exports.handler = async (event) =&gt; {<br/>  console.log(event)<br/>  // Checking signature (requirement 1.)<br/>  ...</span></pre><p id="c394" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">并单击“部署”。</p><p id="0011" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在Discord开发者门户中，“保存”Discord应用程序设置(提醒一下，它将重新运行Discord的POST请求到我们的Lambda)。随着事件(希望)被记录，在CloudWatch中检查它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/346a3eafffd0242c911c7e44187d5cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*1IvvA_s-QfRqaU1vTYB_Qg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Lambda仪表盘—导航至CloudWatch。</p></figure><p id="4ed6" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我发现了这条错误消息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/7419b83092c71313ee786d6cabd1609f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3OCSQblTphONVyGVAYKTQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">错误消息。</p></figure><p id="8568" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><em class="mk">(事件本身被记录在一个更高的字段中，这可能有所帮助)</em></p><p id="914c" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">错误指向<code class="fe nw nx ny nz b">index.js</code>中的第15行，该行指出:</p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="d49a" class="mr kx iq nz b gy og oh l oi oj">Buffer.from(PUBLIC_KEY, 'hex')</span></pre><p id="a981" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">理所当然的。我们没有传递<code class="fe nw nx ny nz b">PUBLIC_KEY</code>环境变量，该变量事先被赋给了变量<code class="fe nw nx ny nz b">PUBLIC_KEY</code>。</p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="4b23" class="mr kx iq nz b gy og oh l oi oj">const PUBLIC_KEY = process.env.PUBLIC_KEY;</span></pre><p id="a151" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">从<a class="ae kv" href="https://discord.com/developers/applications" rel="noopener ugc nofollow" target="_blank"> Discord Developer Portal </a>获取应用的公钥，并插入AWS Lambda:配置→环境变量→编辑… →添加… <em class="mk">(不要对环境变量使用引号)</em></p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="6aba" class="mr kx iq nz b gy og oh l oi oj">Key: PUBLIC_KEY, Value: 55ff1c234...</span></pre><p id="7c2e" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">立即运行“保存更改”!</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/44a73f4b39b61a17cf22d467ed0ab4dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*6kGp6rTB0Rbbs-gMqOejwg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">你所有的编辑都被仔细记录了下来。</p></figure><h1 id="85e8" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">注册和创建斜杠命令</h1><p id="d7d2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在<code class="fe nw nx ny nz b">index.js</code>的末尾，为一个命令添加处理程序，这样我们很快就会注册。</p><p id="1b3a" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我想要一个回复“bar”的斜杠命令<code class="fe nw nx ny nz b">/foo</code>(好吧，不要太令人瞠目结舌)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="b7ce" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">将更新后的代码复制粘贴到AWS Lambda代码编辑器或者压缩后像上次一样上传。单击“部署”。</p><h2 id="463d" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">正在注册/foo命令</h2><p id="e2a2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在<code class="fe nw nx ny nz b">serverless_discord/</code>中创建第二个子目录，名为<code class="fe nw nx ny nz b">register_commands/</code>，并导航到其中。</p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="5c11" class="mr kx iq nz b gy og oh l oi oj"><strong class="nz ir">➜  serverless_discord</strong> mkdir register_commands &amp;&amp; cd register_commands</span></pre><p id="dffb" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">用以下内容创建一个新文件<code class="fe nw nx ny nz b">register.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="b543" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">要添加缺少的模块，请运行:</p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="620e" class="mr kx iq nz b gy og oh l oi oj">npm i axios dotenv</span></pre><p id="bd6b" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">但是，为什么我们现在有两个不同的包(文件夹)？</p><p id="dd4f" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">实际上，这个不会在AWS Lambda上，也不需要在任何遥远的地方。理想情况下，注册命令应该在CI/CD管道期间发生，此时命令会发生变化。如果没有CI/CD，在开发新的东西之后，完全可以在本地PC上手动运行脚本。</p><p id="1702" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">创建<code class="fe nw nx ny nz b">.env</code>文件并将值更改为您的值:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="9353" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">对于<code class="fe nw nx ny nz b">GUILD_ID</code>，进入<a class="ae kv" href="https://discord.com/channels/@me" rel="noopener ugc nofollow" target="_blank">不和谐App </a>，创建不和谐公会(俗称不和谐服务器)。在您的用户设置→高级→开发者模式中打开。回到主界面，右键点击你的公会，然后点击复制ID。</p><p id="666b" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">然后，进入<a class="ae kv" href="https://discord.com/developers/applications" rel="noopener ugc nofollow" target="_blank"> Discord开发者门户</a>，选择你的app → Bot →添加Bot →重置令牌→复制——就是你的<code class="fe nw nx ny nz b">BOT_TOKEN</code>。</p><p id="ef38" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在一般信息部分找到<code class="fe nw nx ny nz b">APP_ID</code>。</p><p id="3895" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">转到OAuth2部分→ URL生成器。选择范围:<code class="fe nw nx ny nz b">bot</code>，<code class="fe nw nx ny nz b">application.commands</code>。Bot权限:<code class="fe nw nx ny nz b">Use Slash Commands</code>。</p><p id="4253" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">复制下面生成的URL并访问它——选择您刚刚创建的公会。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/79483c58bb97b444541dbd01ae59c37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*8I8lQpa4CgYCVAozmnW9iA.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">生成的URL。</p></figure><p id="bf0c" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">你说得对，我们把范围限制在一个公会(你的)。斜线命令不会出现在你邀请机器人加入的其他公会中。当创建具有公会范围的Slash命令时，它会立即应用更改——这就是为什么它总是在开发过程中使用，直到bot非常就绪。创建或更改全局命令将在0-60分钟内为每个公会推出。</p><p id="375a" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">稍后将范围更改为Global，使用<a class="ae kv" href="https://discord.com/developers/docs/interactions/application-commands#making-a-global-command" rel="noopener ugc nofollow" target="_blank">官方文档</a>大约需要5分钟。</p><p id="3729" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">说够了，让我们部署命令吧！</p><pre class="kg kh ki kj gt oc nz od oe aw of bi"><span id="18fd" class="mr kx iq nz b gy og oh l oi oj"><strong class="nz ir">➜  register_commands</strong> node register.js</span><span id="59a1" class="mr kx iq nz b gy on oh l oi oj"><strong class="nz ir">➜  register_commands</strong></span></pre><p id="72c7" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">没有错误就意味着成功！快速进入你的不和谐公会聊天室，开始输入<code class="fe nw nx ny nz b">/foo</code>并按回车键。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/f5c5c6871b568b5d0090f01cd80f1586.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*hAu_r-ntUnFdDy7AKB0esg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">鼓声…</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/5b2d58c58727bec6d54a2d0ff317c1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*zlNiCsOW6we5gQD-jhaKWw.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">吧！</p></figure><p id="9cb9" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">恭喜你！<a class="ae kv" href="https://emojipedia.org/trophy/" rel="noopener ugc nofollow" target="_blank">🏆</a></p><p id="22af" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">你的无服务器机器人正在u̶p̶ ̶a̶n̶d̶ ̶r̶u̶n̶n̶i̶n̶g̶等待事件:)</p><h1 id="2465" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">摘要</h1><h2 id="454a" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">优势:</h2><ol class=""><li id="0055" class="nd ne iq lq b lr ls lu lv lx ou mb ov mf ow mj ni nj nk nl bi translated">低成本</li><li id="21ca" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">易于实施</li><li id="b595" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">非常好的可扩展性—不需要分片(只有线性成本增加！)</li></ol><h2 id="96a9" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">缺点:</h2><ol class=""><li id="b95b" class="nd ne iq lq b lr ls lu lv lx ou mb ov mf ow mj ni nj nk nl bi translated">锁定到AWS(供应商锁定)(此特定解决方案)</li><li id="78ff" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">可能比“服务器”选项更需要CI/CD实施—否则，改变AWS资源可能会很繁琐</li><li id="9a9f" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">这种体系结构需要在客户端和服务器端正确地记录日志和调试消息，才能有效。</li></ol><h2 id="8e69" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">在本文中，您已经了解到:</h2><ol class=""><li id="798f" class="nd ne iq lq b lr ls lu lv lx ou mb ov mf ow mj ni nj nk nl bi translated">AWS上的基本无服务器工具包</li><li id="c2f6" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">不和谐机器人编程的现状</li><li id="1a5f" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">AWS Lambda面临的挑战—开发、部署、调试</li><li id="5d36" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ni nj nk nl bi translated">使用<code class="fe nw nx ny nz b">nacl</code>验证有效载荷，并使用<code class="fe nw nx ny nz b">axios</code>发出请求</li></ol><h2 id="d9c7" class="mr kx iq bd ky ms mt dn lc mu mv dp lg lx mw mx li mb my mz lk mf na nb lm nc bi translated">其他来源:</h2><ul class=""><li id="eaf5" class="nd ne iq lq b lr ls lu lv lx ou mb ov mf ow mj ox nj nk nl bi translated">代码与完整的解决方案可在我的回购:<a class="ae kv" href="https://github.com/jakjus/discord-aws-lambda-article" rel="noopener ugc nofollow" target="_blank">https://github.com/jakjus/discord-aws-lambda-article</a></li><li id="2b3e" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ox nj nk nl bi translated">另一口井制作了关于该主题的教程，但差别不大(即使用Python更为详尽):<a class="ae kv" href="https://oozio.medium.com/serverless-discord-bot-55f95f26f743" rel="noopener">https://oo zio . medium . com/server less-discord-bot-55f 95 f 26 f 743</a></li><li id="6480" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ox nj nk nl bi translated">Discord开发者文档<a class="ae kv" href="https://discord.com/developers/docs/interactions/application-commands" rel="noopener ugc nofollow" target="_blank">https://discord . com/developers/Docs/interactions/application-commands</a>(另请查看“接收和响应”部分)</li><li id="4997" class="nd ne iq lq b lr nm lu nn lx no mb np mf nq mj ox nj nk nl bi translated">宇宙X是我的不和谐银河RPG机器人！https://cosmosx.fun/<a class="ae kv" href="https://cosmosx.fun/" rel="noopener ugc nofollow" target="_blank"/></li></ul><p id="8c7c" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在我的下一篇文章中爬得更高:</p><div class="oy oz gp gr pa pb"><a rel="noopener  ugc nofollow" target="_blank" href="/aws-sam-setting-local-serverless-development-with-lambda-and-dynamodb-5b4c7375f813"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ir gy z fp pg fr fs ph fu fw ip bi translated">AWS SAM-使用Lambda和DynamoDB设置本地无服务器开发</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">AWS SAM及其流程概述</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">better编程. pub</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp kp pb"/></div></div></a></div><p id="4957" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">正如你新制作的函数所说，是时候在<em class="mk">酒吧</em>庆祝了！</p><p id="cec0" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><em class="mk">(现在文章介绍图片感觉没那么古怪了吧？)</em></p></div></div>    
</body>
</html>