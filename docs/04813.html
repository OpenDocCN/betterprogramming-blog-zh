<html>
<head>
<title>Stop Importing Whole JavaScript Packages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止导入整个JavaScript包</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/stop-importing-whole-javascript-packages-39a5f3d4c8?source=collection_archive---------2-----------------------#2020-05-12">https://betterprogramming.pub/stop-importing-whole-javascript-packages-39a5f3d4c8?source=collection_archive---------2-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="65d9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过只导入包中您需要的部分来减小包的大小</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/752f9f1f09d2f24ca7a2e2f6a725891c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E19ZuHPlS2CizL-g"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pankaj Patel </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="ea75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有多少次您导入了一个完整的包，但只需要其中很少的功能？可能，很多。</p><p id="9031" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种场景最常见的例子<a class="ae ky" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank"> Lodash </a>。对于那些没有听说过它的人，您应该查看一下文档。</p><blockquote class="lv lw lx"><p id="b4f8" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">“Lodash通过消除处理数组、数字、对象、字符串等的麻烦，使JavaScript变得更加简单。”—Lodash.com</p></blockquote><p id="576c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它有200多个功能，这意味着它真的解决了所有的麻烦。然而，你可能最终在你的项目中只使用了4-5个，这让我想知道<em class="ly">当我只使用了包的2-3%时，我真的应该导入整个包吗？</em></p><p id="1713" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最喜欢的函数之一是<code class="fe mc md me mf b">get</code>，它可以让你安全地访问嵌套的对象，并提供默认值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="1039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这使你的代码更加整洁，避免了错误，因为当你期望一个空数组时，它不会返回null。不会在空数组上误调用<code class="fe mc md me mf b">map</code>之类的。</p><p id="ef5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看当我只使用<code class="fe mc md me mf b">get</code>函数时，包的大小增加了多少。我将在一个React项目中使用它，并分析前后的包大小。</p><h2 id="5a11" class="mi mj it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">以前</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/e41348a7109d8ae3243be160e0a2715f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWo80yDO2FFXGiBN1nx3vg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用Lodash之前的文件大小</p></figure><h2 id="9861" class="mi mj it bd mk ml mm dn mn mo mp dp mq li mr ms mt lm mu mv mw lq mx my mz na bi translated">在...之后</h2><ol class=""><li id="3388" class="nc nd it lb b lc ne lf nf li ng lm nh lq ni lu nj nk nl nm bi translated">以传统方式导入:</li></ol><p id="0429" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mc md me mf b">import _ from ‘lodash’;</code>或<code class="fe mc md me mf b">const _ = require('lodash');</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/6e08a8949b6d5b9bc969f88241894ada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DyhARPupbP7hsoBnf6jPfw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">导入完整包时的文件大小</p></figure><p id="43e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.ES6导入方式:</p><p id="3e2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mc md me mf b">import { get} from 'lodash';</code>或<code class="fe mc md me mf b">const { get } = require('lodash');</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/ee79067cf16cd463c664f7657f0cfb80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7wbsdPBOpUz3NqCo6-hVog.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">使用ES6解构器导入“get”时的文件大小</p></figure><p id="1907" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您会看到这两种方法都增加了23 KB的大小，这相当大——特别是当我们只使用一个函数来访问对象属性时。该函数是Lodash提供的200多个函数中的一个，然而我们的包大小增加了，就好像我们使用了所有200多个函数一样。</p><p id="037e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">就捆绑包大小而言，您付出的价格是否值得？</strong>否</p><p id="52d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有没有更好的做事方式？是的。</p><p id="8165" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们分析Lodash包文件夹。</p><p id="03bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直接去<code class="fe mc md me mf b">node_modules/lodash</code>。您会看到每个实用函数都有很多文件。你可以很容易地找到<code class="fe mc md me mf b">get.js</code>。所以不要导入整个包，只导入这个文件。</p><p id="d07f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.仅进口<code class="fe mc md me mf b">get.js</code>:</p><p id="a6f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mc md me mf b">import get from 'lodash/get';</code>或<code class="fe mc md me mf b">const get = require('lodash/get');</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/e2ccf27b0ed2b5410219d36861f36467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wm5ILeI9hLKSpQnzkoC8bQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">仅导入get.js时的文件大小</p></figure><p id="afac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅仅通过改变导入包的方式，您就将包的大小减少了20 KB以上。这只是一个包——想象一下，对如何导入包保持谨慎并跟踪包的大小会对你的网站或服务器产生多大的影响。</p><p id="e17c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然你已经看到了它的重要性，你可能会有一些疑问。</p><p id="6ba8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">所有的包都支持这种选择性导入吗？</strong></p><p id="706c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不，这完全取决于一个包的结构。但是，幸运的是，大多数足够大且常用的包都是以这样一种方式构造的，只需一些努力就可以让它工作。</p><p id="f8d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">如何对其他库进行同样的操作？</strong></p><p id="17fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">移除未使用代码的过程被称为<em class="ly">树抖动。</em>如果你想实现这个，比方说蚂蚁设计，在你的浏览器里搜索<em class="ly">蚂蚁树摇</em>就可以了。你可能会在GitHub上找到一个讨论或问题——浏览一下，可能已经有人提供了解决方案。</p><p id="246c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一种方法需要更多的努力。前往<code class="fe mc md me mf b">node_modules</code>中的包文件夹，开始分析代码。检查代码是否被分解成可以独立导入的小模块。</p><p id="dedc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">其他可以实现摇树的例子</strong></p><p id="d067" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">树在晃动<code class="fe mc md me mf b">antd</code>:</p><pre class="kj kk kl km gt nq mf nr ns aw nt bi"><span id="6721" class="mi mj it mf b gy nu nv l nw nx">//Before<br/>import { Menu} from 'antd';<br/>// After<!-- --> <br/>import Menu from 'antd/es/menu';<br/>import 'antd/es/menu/style/css';</span></pre><p id="f30c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">树在晃动<code class="fe mc md me mf b">material ui</code>:</p><pre class="kj kk kl km gt nq mf nr ns aw nt bi"><span id="ebc4" class="mi mj it mf b gy nu nv l nw nx">//Before<br/>import { Button } from '@material-ui/core';<br/>//After<br/>import Button from '<!-- -->@material-ui/core/Button';</span></pre><p id="5c30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">树在晃动<code class="fe mc md me mf b">Moment.js</code>:</p><p id="bed6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这会变得有点复杂，所以我只发布一个GitHub问题的链接。如果需要可以参考<a class="ae ky" href="https://github.com/moment/moment/issues/2373" rel="noopener ugc nofollow" target="_blank">这个</a>。</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="74c6" class="of mj it bd mk og oh oi mn oj ok ol mq jz om ka mt kc on kd mw kf oo kg mz op bi translated">结论</h1><p id="7f63" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li oq lk ll lm or lo lp lq os ls lt lu im bi translated">您已经看到了有多少未使用的代码被不必要地添加到您的代码中。您可以通过一些努力来消除这种情况，并使您的网站加载速度更快。因此，采取一种方法，始终关注包的大小。</p></div></div>    
</body>
</html>