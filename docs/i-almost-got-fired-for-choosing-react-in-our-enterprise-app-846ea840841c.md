# 我差点因为在我们的企业应用中选择 React 而被解雇

> 原文：<https://betterprogramming.pub/i-almost-got-fired-for-choosing-react-in-our-enterprise-app-846ea840841c>

## React 本应简化我们的开发。相反，它制造了路障

![](img/cac1efa31ad35490e719af8c2b62adfc.png)

塞缪尔·伯克在 [Unsplash](https://unsplash.com/s/photos/sad-man-at-desk?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片。

现在是 2018 年夏天。我的老板阿德里安让我和他一起用 Skype 与加拿大一家大公司的首席技术官詹姆斯通话。

在相互了解的过程中，我发现詹姆斯是一个有远大抱负的聪明人。他的愿景是将一个巨大的桌面 WPF 应用程序迁移到云中的网络上。

我喜欢他友好的态度，我能看出他渴望与我们合作。他在印度已经有了一个开发合作伙伴，但是他们缺乏构建 web 应用程序的经验。

阿德里安和我遵循这种情况下的标准方法。我们还有几个电话，然后我们开始发现阶段，在这个阶段，我们试图掌握全局并找到非功能性需求。这些是我们应该关注的要点:

1.  一个大型应用程序——超过 220 页，其中大部分是维护屏幕，大约 20%是高度定制的。
2.  显示大量数据，尤其是在具有各种功能的网格中:分组、列冻结、行扩展、自定义列，应有尽有。
3.  模块化架构允许多个团队同时参与项目。
4.  多年项目。随着时间的推移，将会添加新的功能。
5.  不需要离线支持。
6.  新团队成员快速入职，尤其是。NET 开发人员在旧的桌面应用程序上工作。

作为一名架构师，我的角色是创建一份技术建议书，其中包含架构细节、方法、路线图、指导原则，最重要的是将使用的技术堆栈。

詹姆斯多次提到他想要一种面向未来的技术，他不赞成 Angular，因为在 AngularJS 被弃用后，它的名声不好。

我已经使用 Angular 和 React 成功地实现了几个中小型项目，所以我对它们并不感兴趣。我觉得两者都可以胜任这项工作。

对于这个项目，我选择了 React with Redux…两年后我会后悔的。

我们指派了一个由三名开发人员组成的团队来进行概念验证，两个月后，我们成功了。超灵敏的用户界面、极快的构建时间和高开发速度。大家都很开心。

# 1 号路障:。NET 开发人员加入团队

在概念验证之后，是时候让客户外包团队的开发人员加入进来了。我们还没有开始知识分享会议，首席技术官给我发了一封电子邮件说，“嘿，勒兹万。我们明天真的要和我的外包团队见面。”

我们开了会，技术负责人向我提出了问题和解决方案:

*   “依赖注射在哪里？你说‘不需要’是什么意思？这里有一个:InversifyJS！"
*   “功能组件？不不不我们不喜欢他们。还是用类组件吧！”
*   “为什么这些函数只是挂在那里，为什么不把它们封装在服务类中，使它们成为静态的？”
*   “API 的重试策略在哪里？让我们使用 PollyJS 实现一个。
*   "为什么文件名是破折号，而类名是大写字母？它应该反映了类名，所以从现在开始，我们将它们命名为`SomePageComponent.tsx`。”
*   而且，最让我恼火的一个问题是:“我如何使用 Visual Studio 而不是 Visual Studio 代码来运行它？”

我很清楚。他们想用。NET 指南和 React 中的设计模式。这种情况我见过很多次——开发人员很难适应新技术的做事方式。所以我不害怕讨论为什么这些是不寻常的反应模式。

但在这种情况下，CTO 在背后支持他的团队，这很正常。他认识我才两个月，而他已经和他的团队一起工作了很多年。我不得不做出妥协，同意他们的提议。

我才意识到 React 不是 Java 或者。NET 开发人员友好的。由于设计模式相似，在这种情况下 Angular 会是更好的选择。

# 路障# 2:永远不只有反应

React 是一个未独立化的库，这意味着它对如何实现横切关注点没有自己的看法。因此，你和你的团队有责任就如何做，尤其是你想使用的其他库，提出自己的看法。当然，你会使用第三方库，因为你不想重新发明轮子。React 中的所有内容都有很多选项。

对于概念验证，我已经有了一个关于我们应该如何处理大多数横切关注点的意见。现在，新的团队成员必须对它们进行重新验证。这是要讨论的主题的最小列表:

*   应该使用哪个路由器？
*   除了 Redux，我们还应该用什么来实现异步操作呢？后备箱？佐贺？
*   我们应该使用 Axios 还是`fetch`浏览器 API？
*   Redux-Forms，Formiq，还是 Final-Form？
*   Styled-Components、makeStyle、SASS 还是普通 CSS？
*   国际化库？

所以我们又花了三个星期来做这些决定。我能感觉到你对我尖叫，“来吧，伙计！不可能花三个星期去挑那些图书馆！”

嗯……欢迎来到企业项目。有很多决定。对于每一个，您必须创建决策标准，进行研究，通过创建概念证明来验证发现，展示发现，在决策日志中记录一切，并使库保持最新。这需要大量的时间，而且一点也不好玩。

我甚至没有考虑每个开发人员花在学习所有这些第三方库上的时间。我从未见过两个 React 项目具有相同的依赖项、项目结构和指导方针。这意味着知识不能像 Angular 或 Vue 那样从一个项目转移到另一个项目。

在实现功能性用户故事的三周没有取得任何进展之后，CTO 开始担心了。

# 路障#3:反应钩子变得流行

九个月后，我们已经创建了 50 多个页面。开发人员注意到功能组件和类组件一样好，并开始使用它们。所以，现在项目不再遵循最初的编码指南。更像是每个开发者的个人选择。对我来说，这很好。

React Hooks 发布并开始流行。这个团队有着复杂的感情。有人认为[类混淆了人和机器](https://reactjs.org/docs/hooks-intro.html#classes-confuse-both-people-and-machines)，一些开发人员对此感到不快，而其他人则对新的编码模式充满热情。

我们使用的所有第三方库都增加了对钩子的支持，看起来整个 React 世界都在朝着这个方向发展。那么我们该怎么办呢？我们是否应该背离最初的编码准则，增加第三种实现组件的方式？没有办法返回并将现有的页面和组件迁移到钩子上！

团队支持使用 Redux 挂钩，因为不需要使用 Redux `connect()`并将转储组件从容器中分离出来。这是有意义的，我们同意从现在开始，新的页面和组件将使用钩子。我们将让旧的保持原样。

这就是为什么我们有三种做事方式。再也没有一致性了。

更糟糕的是，一些开发人员开始推动不再使用 Redux 而是使用`useState`的想法。这意味着我们将打破单一全球国家的想法。

`Suspense`仍然是一个实验性的功能。我担心它发布后会发生什么。

# 路障#4:开发正在放缓

当我们为持续集成进行设置时，构建花费了大约三分钟，包括`npm install`。但是现在，一年后，只需要 15 分钟。

我们还必须配置 Node.js 将 RAM 扩展到 4GB，因为 2GB 已经不够了。这不是一个大问题。令人担忧的是，开发人员已经开始抱怨构建花费太多时间，热重装在开发 45-60 分钟后停止工作，重新启动需要超过 5 分钟——特别是对于 Windows 机器(Linux 系统显然比 Node.js 快得多)。有时，他们不得不完全删除`node_modules`并再次下载依赖项，因为否则它根本无法工作。

当总大小为 600MB 的`node_modules`中有 1200 多个依赖项时，您会期望什么？

对于企业应用程序来说，一切都与成本有关。假设一个开发人员一天要重启六次，每小时 40 美元。六次/天 x 五分钟 x 240 天/年 x 40 美元/小时 x 八个开发人员= 38，400 美元/年。对于一个企业来说，这不是一个大数目，但对于项目发起人来说，这是一笔不错的年度奖金。毕竟等于一辆全新的特斯拉 Model 3。

# 路障 5: Redux-Saga 正在慢慢死去

大多数开发人员不同意我的观点，但是我觉得业务逻辑的很大一部分在 Redux async actions 内部。大多数时候，这是您可以进行验证、API 调用、错误处理、触发 redux 突变或触发通知烤面包机的唯一地方。如果这些都不被认为是前端应用程序的业务逻辑，那么什么是呢？

我们使用 Redux-Saga，这是一个糟糕的决定，因为它增加了不必要的复杂性。Thunk 已经足够好了。

在企业应用程序中，您必须偶尔升级和重新验证依赖关系。这是一个很好的实践，因为您需要安全更新、性能改进和小的增量 API 更改，同时希望没有突破性的更改。看起来 Redux-Saga 被落下了。最近一次更新是在一年多以前，GitHub 问题的数量仍在增加，没有人修复它们。

开发人员喜欢 React 有三个原因:简单、灵活和生态系统。React 的团队喜欢尝试新想法，但这正在扼杀生态系统！他们应该勇敢的承担责任！

事实上，React 基本上是向后兼容的，但 React 周围的生态系统却不是。开发人员和第三方库将总是使用最新的特性和架构模式，而旧的实验将被留下等死。这对于中小型项目来说应该不是问题，因为您可以更容易地适应。但是对于大型的多年项目来说，这些实验可能会成为交易的破坏者。

现在已经是 2020 年 9 月，我决定将 React-Saga 纳入技术指导委员会的风险评估结果中。

因为 30%的业务逻辑在传奇中，所以我将其标记为高风险。就在那时，CTO 大发脾气，指责我在我们开始项目时做出了糟糕的决策。

这正是产品经理需要的灵感。他以此为契机，开始问这样的问题:

*   "为什么我们要花这么多时间升级图书馆？"
*   “为什么发展速度变慢了？”
*   "为什么应用程序变得错误和不稳定？"

事情升级到管理层。我花了很多时间寻找证据来证明我们当时做出了最好的决定——这不是我想要的周末方式。

几次回顾会议后，我们再次航行在平静的水域。毕竟项目快完成了。已经接近进入维护模式了。

# 结论

我喜欢反应。我把它用于我所有的个人项目，并乐意推荐给新的工作计划。然而，在我有过不愉快的经历之后，我不会鼓励将它用于企业应用程序。又来了。

顺便说一句，[在这个](https://www.digitalprimates.net/blog/using-react-in-enterprise-contexts-codeitlive/)里我不是一个人。