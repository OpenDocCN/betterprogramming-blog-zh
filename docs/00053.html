<html>
<head>
<title>How To Decide If MongoDB Is Right For You</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何决定MongoDB是否适合你</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/mongodb-insights-20e36c8f2fcd?source=collection_archive---------6-----------------------#2017-08-29">https://betterprogramming.pub/mongodb-insights-20e36c8f2fcd?source=collection_archive---------6-----------------------#2017-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d846" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">选择数据库不应该是一个轻率的决定</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7d9c8bf389d570cbdb158aa279132205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JkS75JaEP1Zk1aVJIMkdBQ.png"/></div></div></figure><p id="edeb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在过去的几年里，我围绕着<a class="ae lq" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>构建了web应用程序。在这篇短文中，我想回答一些大多数开发人员在评估它时经常遇到的问题或误解:</p><ul class=""><li id="cd1d" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">什么是许可？</li><li id="11da" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">MongoDB是一个NoSQL数据库意味着什么？</li><li id="b1ea" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">MongoDB性能怎么样？</li></ul></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="4265" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">批准</h1><p id="e63c" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">MongoDB在2018年10月16日之前在自由软件基金会的<strong class="kw iu"> </strong> <a class="ae lq" href="https://www.mongodb.com/community/licensing" rel="noopener ugc nofollow" target="_blank"> GNU AGPL v3.0 </a>下授权。现在在MongoDB <a class="ae lq" href="https://www.mongodb.com/licensing/server-side-public-license" rel="noopener ugc nofollow" target="_blank">服务器端公共许可证</a>下授权。实际上，这两种方法都意味着你对MongoDB所做的改进必须发布给社区。任何衍生作品的源代码也必须分发。</p><p id="4d00" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能想知道您的应用程序是否是衍生作品。我必须承认，我从未找到这样一个术语的简单定义。然而，在MongoDB的特定情况下，他们只是简单地<a class="ae lq" href="https://www.mongodb.com/blog/post/the-agpl" rel="noopener ugc nofollow" target="_blank">认识到使用他们数据库的应用程序是一项独立的工作</a>。</p><p id="b975" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，他们支持的驱动程序是根据Apache License v2.0 发布的。这是一个<a class="ae lq" href="https://en.wikipedia.org/wiki/Permissive_software_licence" rel="noopener ugc nofollow" target="_blank">许可许可证</a>。它不需要你发布你的源代码，你的应用程序通常只用一个驱动和MongoDB对话。</p><p id="e163" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，您不需要关心MongoDB的许可来围绕它构建您的应用程序。如果有问题，他们甚至会向法律部门发送署名信件，表明他们的承诺。如果签名信还不够，他们还提供商业许可证。</p><p id="5698" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">注:</strong>虽然大量的经验让我相信这个分析，但我不是律师。这里提出的观点是我个人的理解，不是官方的。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="4b32" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">NoSQL</h1><p id="47e4" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">是的，MongoDB是一个NoSQL数据库。这个词很容易让人混淆。我将尝试分析最常见的想法，重点是如何应用于MongoDB。</p><h2 id="facb" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">面向文档</h2><p id="f81f" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">在传统的SQL数据库中，数据以表和行的形式排列。每行有固定数量的列，只能存储特定类型的数据(例如，整数、文本、日期时间)。这定义了数据的模式。</p><p id="daae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在MongoDB中，数据以组织成集合<em class="nv">的<a class="ae lq" href="http://bsonspec.org/" rel="noopener ugc nofollow" target="_blank"> BSON对象</a>的形式存储。</em>数据是<em class="nv"> </em>通常以<a class="ae lq" href="http://www.json.org/" rel="noopener ugc nofollow" target="_blank"> JSON对象</a>的形式处理。这使得将对象映射到数据库成为一项简单的任务，通常消除了任何类似于<a class="ae lq" href="https://en.wikipedia.org/wiki/Object-relational_mapping" rel="noopener ugc nofollow" target="_blank">对象关系映射</a>的事情。</p><h2 id="12c8" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">事务性的</h2><p id="028c" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">在v4之前，MongoDB只提供文档范围的事务。写入从未部分应用于插入或更新的文档。该操作是原子性的，即要么失败，要么成功。对于整个文档来说，据说是文档级别的<a class="ae lq" href="https://en.wikipedia.org/wiki/ACID_(computer_science)" rel="noopener ugc nofollow" target="_blank"> ACID </a>。</p><p id="a1ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，不可能出现跨越多个文档的原子变化。您必须模拟所需的数据库事务(例如，使用<a class="ae lq" href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" rel="noopener ugc nofollow" target="_blank">两阶段提交</a>)。</p><p id="f402" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从v4开始，MongoDB支持多文档ACID事务，这使它成为唯一一个将文档模型与ACID保证相结合的开源数据库。</p><h2 id="7c0a" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">Schemaless(真的？)</h2><p id="e671" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">这意味着在能够管理数据之前，您不必告诉数据库您的数据的结构和要使用的基本类型。</p><p id="faaa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这也意味着您可以在同一个数据集合中混合具有不同结构的文档。</p><p id="7dd1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最大的好处之一是模式迁移变得更加容易(对数据库的大部分调整都是透明和自动的)。回滚不太可能导致问题。另一个优点是在运行时用自定义属性动态扩展现有数据模型非常简单。</p><p id="1aeb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是<em class="nv"> </em>这一切并不意味着你根本没有任何图式。如果它没有被显式声明，它会从您的应用程序逻辑中隐含地显现出来。它可能以其他方式声明，以处理表单/数据验证。无论如何，您仍然必须明确地告诉数据库如何创建索引，以确保良好的性能。</p><p id="fe81" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事实上，模式设计是制作优秀数据库的基石，不管是不是SQL。如果你不了解你的数据以及硬件和软件的限制，你就不能有效地设计一个模式。</p><h2 id="ecf6" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">非关系(真的？)</h2><p id="47ff" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">这意味着您不必总是在两个文档之间创建关系来处理聚合数据结构。</p><p id="bc3d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事实上，在关系数据库中，SQL <code class="fe nw nx ny nz b">JOIN</code>子句允许您使用两个或更多表之间的公共字段来组合它们的行。面向文档的数据库，比如MongoDB，被设计用来存储非规范化的<strong class="kw iu"> </strong>数据。理想情况下，集合之间应该没有关系:如果两个或更多文档中需要相同的数据，则必须重复。最大的好处之一是只需要一次读操作就可以获得所有数据。</p><p id="76df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，如果您愿意或有需要，您仍然可以创建关系并引用另一个文档:</p><ul class=""><li id="a637" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">通过ID，然后您可以使用第二个查询或者使用<a class="ae lq" href="https://docs.mongodb.com/manual/reference/database-references/#dbrefs" rel="noopener ugc nofollow" target="_blank"> DBRefs </a>手工填充它</li><li id="bce5" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">通过任何其他字段，那么你可以使用<code class="fe nw nx ny nz b"><a class="ae lq" href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/" rel="noopener ugc nofollow" target="_blank">$lookup</a></code> <a class="ae lq" href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/" rel="noopener ugc nofollow" target="_blank">操作符</a></li></ul><p id="131d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这使得MongoDB非常灵活，允许您根据具体情况选择如何处理对象之间的关系。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="0f4c" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">表演</h1><h2 id="7ec3" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">读/写</h2><p id="b952" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">是的，MongoDB和其他真正的数据库一样，是为处理海量数据而设计的。简而言之，处理数百或数千个对象对于一个数据库来说不算什么，所以如果您有这样的数量，就不必担心。</p><p id="3e62" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在周围找到很多基准。这里有一个简单的给你一些粗略的数量级。存储的文档非常简单，通常代表带时间戳的测量:</p><pre class="kj kk kl km gt oa nz ob oc aw od bi"><span id="0fe9" class="nj mn it nz b gy oe of l og oh">{<br/>    value: random(0,100),<br/>    timestamp: date<br/>}</span></pre><p id="99db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于MongoDB将内存管理委托给操作系统的方式，拥有更复杂的文档(通常包含数十个属性)不会对结果产生显著影响。</p><p id="0e29" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这两个属性都已被索引。MongoDB自动添加并索引文档惟一ID。我测试了三个请求:</p><ul class=""><li id="3dac" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">使用<a class="ae lq" href="https://docs.mongodb.com/manual/aggregation/" rel="noopener ugc nofollow" target="_blank">聚合框架</a>找到集合的最大值</li><li id="591c" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">找出大于99.9的100个最大值</li><li id="43c8" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">通过ID获取单个文档</li></ul><p id="45ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于聚合，最大请求不能从索引中受益，而大于和按ID请求可以使用它。您将看到这对性能有多么重要。</p><p id="dc35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">测试配置为MongoDB 3.4.1 64位—OS Windows 7 Pro SP1—CPU Core i7–4712 HQ 2.3 GHz—16Go RAM—SSD HD，测试结果如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="1594" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，如果您构建了正确的索引来查询10亿个文档，对于单个服务器上的大多数应用程序来说，它仍然具有足够的性能。如果需要，您可以使用<a class="ae lq" href="https://docs.mongodb.com/manual/sharding/" rel="noopener ugc nofollow" target="_blank">分片</a>来提高性能。</p><p id="e481" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是用于创建/查询该测试数据库的脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="f133" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">和运行命令:</p><pre class="kj kk kl km gt oa nz ob oc aw od bi"><span id="2062" class="nj mn it nz b gy oe of l og oh">// Launch server<br/>./mongod --dbpath "C:\Program Files\MongoDB\Server\3.4\data" --port 27018<br/>// Insertion exemple for 10e7<br/>./mongo --port 27018 --eval "var arg1=10000000" create_collection.js<br/>// Requests<br/>./mongo --port 27018 --eval "" query_collection.js</span></pre><h2 id="f32c" class="nj mn it bd mo nk nl dn ms nm nn dp mw ld no np my lh nq nr na ll ns nt nc nu bi translated">记忆</h2><p id="5f80" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">是的，MongoDB通常看起来使用了所有可用的RAM。它实际上依赖于不同的存储引擎。<a class="ae lq" href="https://docs.mongodb.com/manual/core/wiredtiger/" rel="noopener ugc nofollow" target="_blank"> WiredTiger </a>是MongoDB 3.2开始的默认，<a class="ae lq" href="https://docs.mongodb.com/manual/core/mmapv1/" rel="noopener ugc nofollow" target="_blank"> MMAPv1 </a>是MongoDB 3.2之前版本的默认。然而，它们的工作原理非常相似。通过文件系统缓存，它们自动使用所有未被引擎缓存或其他进程使用的空闲内存。如果你想有最大的表现，这是一致的。</p><p id="4dd4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以系统资源监视器经常显示MongoDB使用大量内存，但是它的使用是动态的。如果另一个进程突然需要一半的服务器内存，MongoDB会将缓存内存让给另一个进程。</p><p id="97f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，可以优化内存使用的唯一参数就是引擎缓存大小。例如，在默认情况下，WiredTiger引擎使用50%的RAM减去1 GB，这对于具有大量内存的服务器来说是相当大的。如果你使用有限内存的容器，这甚至会引起一些麻烦，所以简单地找出适合你的用例的平衡。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="48a9" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">结论</h1><p id="1972" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">如果MongoDB适合您的需要，我希望您现在对它提供的好处有一个更精确的概念。</p><p id="4d6b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最近，MongoDB启动了一个名为<a class="ae lq" href="https://www.mongodb.com/cloud/atlas" rel="noopener ugc nofollow" target="_blank"> MongoDB Atlas </a>的数据库即服务产品，可能对您的测试有用。</p></div></div>    
</body>
</html>