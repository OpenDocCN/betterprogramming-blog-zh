<html>
<head>
<title>All About IDOR Attacks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于IDOR攻击的所有信息</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/all-about-idor-attacks-64c4203b518e?source=collection_archive---------4-----------------------#2020-11-30">https://betterprogramming.pub/all-about-idor-attacks-64c4203b518e?source=collection_archive---------4-----------------------#2020-11-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4a65" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">攻击者如何使用不安全的直接对象引用非法访问数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/28c8b58c1f4e49a7ee585cc82f077765.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PWMmJSSH092ew9O8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">亚历山大·辛恩在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</p></figure><p id="db7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您是否想过数据泄露是如何发生的？</p><p id="a63f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，似乎每五分钟就有一家新公司被攻破。但是这些漏洞到底是如何发生的呢？黑客是如何获取敏感数据的？在本文中，我们将讨论一个简单但非常有影响力的漏洞，攻击者经常使用它来获得对机密数据的访问:IDOR。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="473c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">IDOR是什么？</h1><p id="d637" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">IDOR代表“不安全的直接对象引用”尽管IDOR的名字又长又吓人，但它实际上是一个容易理解的漏洞。本质上，IDOR缺少访问控制。</p><p id="fad1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设example.com<em class="mz">是一个允许你和其他用户聊天的社交媒体网站。而且你注册的时候注意到你在网站上的用户ID是<em class="mz"> 1234 </em>。该网站有一个页面，允许您查看您与朋友之间的所有消息。当您点击主页上的“查看您的消息”按钮时，您会被重定向到此URL，在此您可以在网站上看到您与朋友的所有聊天消息:</em></p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="2b09" class="nf md it nb b gy ng nh l ni nj">https://example.com/messages?user_id=1234</span></pre><p id="50e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果你把地址栏里的网址改成这个呢？</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="dc88" class="nf md it nb b gy ng nh l ni nj">https://example.com/messages?user_id=<strong class="nb iu">1233</strong></span></pre><p id="7f5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您注意到现在可以看到另一个用户1233和他们所有朋友之间的所有私人消息。刚刚发生了什么？此时，您已经发现了一个IDOR漏洞。</p><p id="dd3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您能够看到用户1233的消息，因为在服务器返回用户的私人信息之前没有进行身份检查。服务器没有验证你是否是用户1233，或者你是否是一个冒名顶替者。它只是按照您的要求返回信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/d5e371403a2a5133da8cc0b81db2834e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sxNEchc0zIBkufs5.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片。</p></figure><p id="8827" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当访问控制没有正确实现，并且对数据对象(如文件或数据库条目)的引用是可预测的时，就会发生IDORs。在这种情况下，很容易推断出您可以通过访问这些URL来检索用户1232和用户1231的消息:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="f403" class="nf md it nb b gy ng nh l ni nj">https://example.com/messages?user_id=1232<br/>https://example.com/messages?user_id=1231</span></pre><p id="80e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果网站为每个用户使用一个唯一的、不可预测的密钥，网站将不会易受攻击，因为攻击者将无法猜测<em class="mz"> user_key </em>的值:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="53e2" class="nf md it nb b gy ng nh l ni nj">https://example.com/messages?user_key=6MT9EalV9F7r9pns0mK1eDAEW</span></pre><p id="6c95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，社交媒体网站实现了不安全的直接对象引用。这些可预测的“直接对象引用”将隐藏在它们背后的数据暴露给互联网，允许任何人获取被引用的信息。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="687b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">IDOR的含义</h1><p id="6c02" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">正如您可能想象的那样，IDORs对企业来说可能是灾难性的。在这种情况下，想想当example.com的用户发现任何人都有可能阅读他们的私人信息时，他们将面临的糟糕公关！</p><p id="ccdd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个漏洞可以被更激进地利用:攻击者可以编写一个脚本来查询所有用户id，并自动抓取所有数据！如果此漏洞发生在在线购物网站上，攻击者可能会获得数百万个银行帐户、信用卡号和地址！</p><p id="66ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">IDORs也不仅仅局限于阅读其他用户的信息。它们还可以用来代表其他用户编辑数据。假设您可以通过以下网址在<em class="mz">example.com</em>上更改自己的密码:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="2714" class="nf md it nb b gy ng nh l ni nj">https://example.com/change_password?user_id=1234</span></pre><p id="8b61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此页面上有一个IDOR，如果您访问此URL，您可以更改用户编号1233的密码:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="fef3" class="nf md it nb b gy ng nh l ni nj">https://example.com/change_password?user_id=1233</span></pre><p id="d92d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着你可以不经用户同意，通过更改他们的密码来接管平台上任何用户的账户！密码重置、密码更改和帐户恢复等关键功能上的IDORs是危及整个web应用程序的关键漏洞。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2c01" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">预防IDORs</h1><p id="904f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">idor很常见，因为它们很难检测，所以防止idor的最好方法是在开发过程中实现保护。</p><p id="145a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要利用IDOR漏洞，必须有对数据对象的直接对象引用，并且缺少访问控制。因此，为了防止IDORs，您可以:</p><ol class=""><li id="d06e" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">避免直接对象引用。</li><li id="718d" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">对每个应用程序资源实施详细的访问控制。</li></ol><p id="8b26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，您可以使用间接对象引用来引用资源。例如，应用程序可以根据用户的会话将用户提供的ID映射到后端的另一个对象ID。例如，假设您的网站有文件上传功能，用户应该只访问他们自己的上传。如果像这样在URL中使用直接引用:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="aaa6" class="nf md it nb b gy ng nh l ni nj">example.com/uploads?id=username-uploads-3</span></pre><p id="bf2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">攻击者可以通过像这样操纵文件ID参数来读取其他人的文件。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="da28" class="nf md it nb b gy ng nh l ni nj">example.com/uploads?id=username2-uploads-3</span></pre><p id="0795" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，如果您让用户指定文件索引:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="9964" class="nf md it nb b gy ng nh l ni nj">example.com/uploads?id=3</span></pre><p id="8e1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后在后端映射到真实的文件ID，用户无法控制整个文件ID，也无法操纵URL参数访问别人的文件。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="b404" class="nf md it nb b gy ng nh l ni nj">Real file ID: username-uploads-3 </span></pre><p id="fb1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也可以使用不可预测的散列或随机字符串来引用对象，而不是使用简单的数字ID。这使得枚举真实数据id和获取敏感数据变得更加困难，甚至是不可能的。</p><p id="f129" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是IDOR漏洞的根本原因是缺少访问控制。如果您可以在返回敏感资源之前检查用户的权限，那么直接对象引用根本就不是问题。因此，为了防止IDORs，您应该做的第二件事是实现健壮的访问控制。对于每个应该受到限制的应用程序资源，您应该验证用户确实被授权访问它。</p><p id="6f30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有没有办法找到已经在你的应用程序中存在的IDOR漏洞？自动漏洞扫描器在寻找IDORs方面相当糟糕，因为它们无法识别哪些资源需要哪种保护。因此，发现现有IDORs的最佳方式是通过审查源代码，查看是否所有直接或间接的对象引用都受到适当的访问控制的保护。</p><p id="9384" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，手动测试也是测试IDOR的有效方法。在手动测试时，您应该创建两个不同的帐户，看看是否可以使用第二个帐户访问第一个帐户的信息。请记住，IDORs可以出现在URL参数、表单字段参数、文件路径、头、cookies等等中。因此，您可以通过捕获和检查每个应该被限制的请求来检查IDORs，更改这些引用资源的字段，并尝试从另一个帐户侵入您的帐户。</p><p id="6291" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">IDORs是一个危险的漏洞，会威胁到用户的隐私和应用程序的完整性。但是可以通过实现间接对象引用和健壮的访问控制来可靠地防止它们。</p><p id="4a86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天的安全课到此结束。感谢阅读！</p></div></div>    
</body>
</html>