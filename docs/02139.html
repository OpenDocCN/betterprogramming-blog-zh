<html>
<head>
<title>Follow-Up: How To Handle Async Providers in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跟进:如何在Angular中处理异步提供者</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/follow-up-how-to-handle-async-providers-in-angular-54957c7349c4?source=collection_archive---------13-----------------------#2019-11-08">https://betterprogramming.pub/follow-up-how-to-handle-async-providers-in-angular-54957c7349c4?source=collection_archive---------13-----------------------#2019-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5637" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在接下来的文章中，我会看到一个更优雅的解决方案</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d8dde1eaac149dc394dc04e721cdc5db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eoJQLToesg1zWPGjeIfSdA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@kehfam?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Olu Famule </a>在<a class="ae kv" href="https://unsplash.com/s/photos/web-development?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="7100" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">几周前，我在Angular 上发表了一篇关于异步提供者的<a class="ae kv" href="https://medium.com/better-programming/how-to-handle-async-providers-in-angular-51884647366" rel="noopener">文章。</a></p><p id="7894" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我们将看看кошеверов向我提出的另一个解决方案。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="d9a6" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">我们上次做了什么？</h1><p id="2987" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在我之前的解决方案中，我们使用<code class="fe my mz na nb b">APP_INITIALIZER</code>来加载配置，同时Angular引导我们的应用程序。此外，我们使用一个<code class="fe my mz na nb b">InjectionToken</code>来提供值。这个解决方案有几个问题，是我在工作中将它添加到项目中时发现的——其中之一是初始化顺序。例如，当另一个模块也在使用<code class="fe my mz na nb b">APP_INITIALIZER</code>时，它经常在我们的模块之前被调用，导致值未定义。所以准备好迎接更好的版本吧。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="754e" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">platformBrowserDynamic可以做得更多！</h1><p id="8da3" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在实现之前的解决方案时，我忽略了一点——我想我应该通读文档——函数platformBrowserDynamic()将一组提供者作为参数(<a class="ae kv" href="https://angular.io/api/platform-browser-dynamic/platformBrowserDynamic" rel="noopener ugc nofollow" target="_blank">查看文档</a>)。完美！</p><p id="8458" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们可以执行以下操作:</p><ol class=""><li id="4a2a" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">使用本地的<code class="fe my mz na nb b">fetch</code> -API在<code class="fe my mz na nb b">main.ts</code>中加载我们的配置。</li><li id="857b" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">在我们的应用程序被引导之前提供该值，从而确保配置总是可用的(假设源代码也是可用的)。</li></ol><p id="8a4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为这个解决方案更简单，我们只需要编辑<code class="fe my mz na nb b">main.ts</code>文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><ol class=""><li id="efc7" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">我们将一切都包装在一个<code class="fe my mz na nb b">async function</code>中，以利用async/await。</li><li id="dc88" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">我们使用JavaScript native<code class="fe my mz na nb b">fetch</code>-API(L12+L13)加载任意配置。</li><li id="11b0" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">将提供者数组传递给<code class="fe my mz na nb b">platformBrowserDynamic()</code> (L17)。</li></ol><p id="f786" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样。你可以在GitHub 上查看完整和更新的示例<a class="ae kv" href="https://github.com/beyerleinf/angular-async-module-providers" rel="noopener ugc nofollow" target="_blank"> repo。</a></p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="fbdf" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">结论</h1><p id="0022" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">总是阅读文件。</p><p id="a37e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>