<html>
<head>
<title>WatchTabView Inside NavigationView in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI中NavigationView内的WatchTabView</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/watchtabview-that-can-work-inside-navigationview-in-swiftui-f7b7f4b3fe40?source=collection_archive---------8-----------------------#2022-01-16">https://betterprogramming.pub/watchtabview-that-can-work-inside-navigationview-in-swiftui-f7b7f4b3fe40?source=collection_archive---------8-----------------------#2022-01-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4773" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为watchOS创建优雅的标签</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8452e5625d5a4222983bca1ce4ebaa61.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*H5CEwNyHYx_fwLVMk_KY6Q.png"/></div></div></figure><p id="0030" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">SwiftUI中的官方<a class="ae lq" href="https://developer.apple.com/documentation/swiftui/tabview" rel="noopener ugc nofollow" target="_blank"> TabView </a>看起来简洁优雅。但不幸的是，如果你把它放在iOS和WatchOS的NavigationView中，它仍然无法正常工作。</p><p id="56c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在iOS上，如果在<code class="fe lr ls lt lu b">NavigationView</code>中嵌入了一个<code class="fe lr ls lt lu b">TabView</code>，它会重置导航状态，并不时地将<code class="fe lr ls lt lu b">NavigationView</code>弹出回root，尤其是当应用程序进入后台或恢复时。我向苹果的开发者技术支持确认了我看到了一个bug。</p><p id="2fbf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在watchOS上，更糟糕的是，如果<code class="fe lr ls lt lu b">TabView</code>嵌入在<code class="fe lr ls lt lu b">NavigationView</code>中，滑动就根本无法工作。</p><p id="0062" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">经过几次尝试，我发现避免这些错误的一个方法是将<code class="fe lr ls lt lu b">NavigationView</code>放在<code class="fe lr ls lt lu b">TabView</code>中。但这意味着我必须为每个标签放置一个<code class="fe lr ls lt lu b">NavigationView</code>，不仅代码变得混乱和多余，而且标签栏显示在每个视图中——这在某些情况下可能是不希望的行为，并且多个<code class="fe lr ls lt lu b">NavigationView</code>还会破坏应用程序内的整个导航流程控制。</p><h1 id="4d66" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">iOS解决方案</h1><p id="8af0" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated">幸运的是，在iOS中实现类似于<code class="fe lr ls lt lu b">TabView</code>的视图很简单。只有一个<code class="fe lr ls lt lu b">HStack</code>和一个<code class="fe lr ls lt lu b">@State</code>来控制显示哪个视图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="f7fa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它看起来和真实的TabView一模一样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/a86a40aa04424c2014bd11f077115a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpFhis9U0L38ia_POMy5iQ.png"/></div></div></figure><h1 id="e893" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">WatchOS解决方案</h1><p id="0006" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated">当我在做我的副业项目:<a class="ae lq" href="https://apps.apple.com/app/id1498633177" rel="noopener ugc nofollow" target="_blank"> Wordbook </a>时，TabView变得更加复杂，因为它涉及到处理滑动手势、分页器、动画和焦点切换。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="fa36" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我在顶层使用带有圆点的<code class="fe lr ls lt lu b">ZStack</code>来模拟分页指示器。这里的技巧部分是我必须使用<code class="fe lr ls lt lu b">.edgesIgnoringSafeArea(.bottom)</code>将分页指示器定位在正确的位置——靠近底部边缘。</p><p id="0966" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二个棘手的部分是处理<code class="fe lr ls lt lu b">DragGesture</code>并计算手指释放时的动画，以使滑动动作看起来平滑。</p><p id="4ee5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后就是焦点状态了。因为我们使用<code class="fe lr ls lt lu b">ZStack</code>和<code class="fe lr ls lt lu b">offset</code>来决定显示哪个选项卡，这意味着视图仍然在那里，即使它们没有显示在屏幕上也可能保持焦点。</p><p id="639b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">尤其是在有列表的情况下，如果我们不将焦点设置到刚刚移动到中心舞台的选项卡上，您会发现滚动数字表冠不起作用。</p><p id="b8d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">多亏了从watchOS 8.0开始才提供的<code class="fe lr ls lt lu b">@FocusState</code>，我们可以在添加了<code class="fe lr ls lt lu b">onTabChanged</code>事件回调函数后简单地控制焦点。只要确保你使用了<code class="fe lr ls lt lu b">focusable(_:)</code>修改器使视图如<code class="fe lr ls lt lu b">VStack</code>、<code class="fe lr ls lt lu b">Text</code>成为可聚焦的，默认情况下是不可聚焦的。</p><h1 id="538e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">决赛成绩</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mt l"/></div></figure></div></div>    
</body>
</html>