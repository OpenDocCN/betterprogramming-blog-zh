<html>
<head>
<title>Movie Similarity Recommendations Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python的电影相似性推荐</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/movie-similarity-recommendation-using-python-b98a2670a2ad?source=collection_archive---------11-----------------------#2021-04-08">https://betterprogramming.pub/movie-similarity-recommendation-using-python-b98a2670a2ad?source=collection_archive---------11-----------------------#2021-04-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e631" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Python中推荐系统的学习和实现指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a70e19ada59d7d758387e7db5516572c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*guqcnan-ERFlHpDM"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@alinsurdu3?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿林·苏尔杜</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄。</p></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="6a36" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">什么是推荐系统？</h1><p id="4433" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">推荐系统预测用户未来的选择/偏好，并推荐他们可能感兴趣的产品/项目。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="39da" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">推荐系统有哪些类型？</h1><p id="0b90" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">两种最常见的类型是:</p><ol class=""><li id="9971" class="mr ms iq lx b ly mt mb mu me mv mi mw mm mx mq my mz na nb bi translated">基于内容的推荐系统</li><li id="68cd" class="mr ms iq lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">协同过滤</li></ol></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="5734" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">什么是基于内容的推荐系统？</h1><p id="da61" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">这种系统根据用户对产品的态度给出推荐。它的工作逻辑是，如果用户在过去同意了某件事，那么他们在将来也会同意。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="aa58" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">什么是协同过滤？</h1><p id="2f27" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">这种系统查看项目的属性，并基于它们之间的相似性给出推荐。它的工作原理是推荐与用户过去喜欢的产品相似的产品。它进一步分为两种类型:</p><ol class=""><li id="3785" class="mr ms iq lx b ly mt mb mu me mv mi mw mm mx mq my mz na nb bi translated">基于内存的CF</li><li id="7622" class="mr ms iq lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">基于模型的CF</li></ol></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="ed1c" class="ld le iq bd lf lg lh li lj lk ll lm ln jw lo jx lp jz lq ka lr kc ls kd lt lu bi translated">如何使用Python实现基于项目的CF</h1><p id="40d1" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">用于本演示的数据集是<a class="ae kv" href="https://grouplens.org/datasets/movielens/" rel="noopener ugc nofollow" target="_blank"> MovieLens </a>数据集的子集。将建立一个基本的推荐系统，该系统将推荐与特定电影最相似的电影。</p><h2 id="54c3" class="nh le iq bd lf ni nj dn lj nk nl dp ln me nm nn lp mi no np lr mm nq nr lt ns bi translated"><strong class="ak">导入库</strong></h2><p id="3fa1" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">处理数据的基本包，像NumPy和pandas，都是进口的。与此同时，可视化库matplotlib和seaborn也被导入。</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="cd35" class="nh le iq nu b gy ny nz l oa ob"><strong class="nu ir">&gt;&gt;&gt; import</strong> numpy <strong class="nu ir">as</strong> np<br/><strong class="nu ir">&gt;&gt;&gt; import</strong> pandas <strong class="nu ir">as</strong> pd<br/><strong class="nu ir">&gt;&gt;&gt; import</strong> matplotlib.pyplot <strong class="nu ir">as</strong> plt<br/><strong class="nu ir">&gt;&gt;&gt; import</strong> seaborn <strong class="nu ir">as</strong> sns<br/>&gt;&gt;&gt; sns.set_style('white')<br/><strong class="nu ir">&gt;&gt;&gt; %</strong>matplotlib inline</span></pre><h2 id="e360" class="nh le iq bd lf ni nj dn lj nk nl dp ln me nm nn lp mi no np lr mm nq nr lt ns bi translated"><strong class="ak">读取数据</strong></h2><p id="4aab" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">分配列名并读取数据:</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="4217" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; column_names <strong class="nu ir">=</strong> ['user_id', 'item_id', 'rating', 'timestamp']<br/>&gt;&gt;&gt; df <strong class="nu ir">=</strong> pd.read_csv('dataset/df.data', sep<strong class="nu ir">=</strong>'\t', names<strong class="nu ir">=</strong>column_names)<br/>&gt;&gt;&gt; df.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/4ad7b62eec25319deea16f003f191037.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*K5OdSeSR9sRXSWCuGKF58w.png"/></div></figure><p id="a29c" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">现在电影标题被附加到<code class="fe og oh oi nu b">DataFrame</code>上。</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="e6f5" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; titles <strong class="nu ir">=</strong> pd.read_csv("dataset/movie_title")<br/>&gt;&gt;&gt; titles.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/9cbc30fe4729449333e33d7ad7e80cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*TOviN3o7qOXxPJ5eozi7ag.png"/></div></figure><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="84c1" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; df <strong class="nu ir">=</strong> pd.merge(df,titles,on<strong class="nu ir">=</strong>'item_id')<br/>&gt;&gt;&gt; df.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/832a5787d45c5daeb94eeebcdee8b99c.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*zsRKoS1w3o9eD3XE93AGWQ.png"/></div></figure><h2 id="6acc" class="nh le iq bd lf ni nj dn lj nk nl dp ln me nm nn lp mi no np lr mm nq nr lt ns bi translated"><strong class="ak">可视化</strong></h2><p id="61a6" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">评级的<code class="fe og oh oi nu b">DataFrame</code>根据其总数和平均值创建。通过调用<code class="fe og oh oi nu b">mean()</code>函数计算平均值:</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="7850" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; ratings <strong class="nu ir">=</strong> pd.DataFrame(df.groupby('title')['rating'].mean())<br/>&gt;&gt;&gt; ratings.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/08cb0a2678de319b476b1918c2a0df26.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*GNlQArMpys62djwEoxePFw.png"/></div></figure><p id="150e" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">通过调用<code class="fe og oh oi nu b">count()</code>函数来计算总数:</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="30ca" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; ratings['total_ratings'] <strong class="nu ir">=</strong> pd.DataFrame(df.groupby('title')['rating'].count())<br/>&gt;&gt;&gt; ratings.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/63f0a04b2bf014382dca2921124f5072.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*s6-DBemZ8qQI0pg3c7huSA.png"/></div></figure><p id="b83f" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">现在，用户给出的平均评级和总评级的直方图可以可视化:</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="39e5" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; ratings['rating'].hist(bins<strong class="nu ir">=</strong>50)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/d9d001e2cbbde2454338c622aec86277.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*2mCxhy-uN-_SXL0GDfdAZw.png"/></div></figure><p id="ef3e" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">因此，平均等级在1到5的范围内，并且可以在平均值位于等级3.5附近的地方看到它们的分布。</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="11c4" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; ratings['total_ratings'].hist(bins<strong class="nu ir">=</strong>50)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/5f18f9f9b3d45d2667188e0f7ab3f66b.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*J2UzGhEOiY0u-fcMzrqJXg.png"/></div></figure><p id="812a" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">从这个情节可以推断，只有最著名的电影被用户评级很多，如果电影不太著名，则评级降低。</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="ada2" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; sns.jointplot(x<strong class="nu ir">=</strong>'rating',y<strong class="nu ir">=</strong>'total_ratings',data<strong class="nu ir">=</strong>ratings,alpha<strong class="nu ir">=</strong>0.5)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/fa633e58420bed8a3fad6e46e1274db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*YEaHmh1SJTcX6bWbqIqHdQ.png"/></div></figure><p id="ee40" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">该图显示了平均评分和总评分之间的关系。</p><h2 id="db6d" class="nh le iq bd lf ni nj dn lj nk nl dp ln me nm nn lp mi no np lr mm nq nr lt ns bi translated"><strong class="ak">构建系统</strong></h2><p id="718e" class="pw-post-body-paragraph lv lw iq lx b ly lz jr ma mb mc ju md me mf mg mh mi mj mk ml mm mn mo mp mq ij bi translated">提取用户ID和电影标题，并分别放入索引和列中。这样，可以呈现每个用户对每部电影的评级。</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="fca9" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; final_df <strong class="nu ir">=</strong> df.pivot_table(index<strong class="nu ir">=</strong>'user_id',columns<strong class="nu ir">=</strong>'title',values<strong class="nu ir">=</strong>'rating')<br/>&gt;&gt;&gt; final_df.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/af47164d07981411e9dd277dc7297e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N853iwIg2YkD5hbgv5nvyg.png"/></div></div></figure><p id="4c02" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">现在有一部电影(<em class="or">《玩具总动员》</em>)被选中并归入奇幻类。获得用户评级:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="os ot l"/></div></figure><p id="13c1" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">现在使用<code class="fe og oh oi nu b">corrwith()</code>方法找出其他电影和<em class="or">玩具总动员</em>之间的相关性:</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="73f7" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; similar_to_toy <strong class="nu ir">=</strong> final_df.corrwith(toy_ratings)</span></pre><p id="1ad1" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">这些相关性以<code class="fe og oh oi nu b">DataFrame</code>的形式呈现，空值被删除。</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="6c32" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; corr_toy <strong class="nu ir">=</strong> pd.DataFrame(similar_to_toy,columns<strong class="nu ir">=</strong>['Correlation'])<br/>&gt;&gt;&gt; corr_toy.dropna(inplace<strong class="nu ir">=True</strong>)<br/>&gt;&gt;&gt; corr_toy.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/ee03050acaa5857653a5aaef31d451ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*-qtRQLsA70QLI_PHhlc-Bg.png"/></div></figure><p id="f295" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">如果这些相关性按降序排序，那么我们得到与<em class="or">玩具总动员</em>相关的电影:</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="0185" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; corr_toy.sort_values('Correlation',ascending<strong class="nu ir">=False</strong>).head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/4642e85f54a4fad0d36df7b67fa6633f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*v8f7QIx6dlidxSxk5Oah4A.png"/></div></figure><p id="78f5" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">但是顶部的一些电影可能只有一个给出最高评级的用户观看过。因此，这可能会产生误导。所以我们会提取评论超过100条的电影:</p><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="627a" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; corr_toy <strong class="nu ir">=</strong> corr_toy.join(ratings['total_ratings'])<br/>&gt;&gt;&gt; corr_toy.head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/48826f1c9e7bb91c5796040554cd0c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*DVWIBxcZ3LSmi0VXga6ZFA.png"/></div></figure><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="c9d8" class="nh le iq nu b gy ny nz l oa ob">&gt;&gt;&gt; corr_toy[corr_toy['total_ratings']<strong class="nu ir">&gt;</strong>100].sort_values('Correlation',ascending<strong class="nu ir">=False</strong>).head()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/a4713f90e7748b12e2762671106c4984.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*NSafm2RUveWdQLvfdKtf_A.png"/></div></figure><p id="11dd" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated">所以这些都是类似<em class="or">玩具总动员</em>的电影。所有这些电影也属于幻想类。</p><p id="0b65" class="pw-post-body-paragraph lv lw iq lx b ly mt jr ma mb mu ju md me od mg mh mi oe mk ml mm of mo mp mq ij bi translated"><em class="or">参考GitHub </em>  <em class="or">上的数据集和笔记本</em> <a class="ae kv" href="https://github.com/jayashree8/Python_recommender_systems" rel="noopener ugc nofollow" target="_blank"> <em class="or">。</em></a></p></div></div>    
</body>
</html>