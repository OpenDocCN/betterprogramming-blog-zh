<html>
<head>
<title>Infinite Scroll With Ionic and React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无限卷轴与离子起反应</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/infinite-scroll-with-ionic-react-dc3e5e63b56e?source=collection_archive---------12-----------------------#2019-12-02">https://betterprogramming.pub/infinite-scroll-with-ionic-react-dc3e5e63b56e?source=collection_archive---------12-----------------------#2019-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="04ff" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何用Ionic和React实现无限滚动，用钩子实现滤镜</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c0bc7b1b8c984ba8e32f6fbf57aa6fd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-O7m3prsNzcC8oaiI5k-w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@robin_rednine?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">罗宾·沃拉尔</a>在<a class="ae ky" href="https://unsplash.com/s/photos/scroll?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="b967" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今年早些时候推出了<a class="ae ky" href="https://ionicframework.com/blog/announcing-ionic-react/" rel="noopener ugc nofollow" target="_blank">Ionic React</a>，本周四我将在我们当地的<a class="ae ky" href="https://www.meetup.com/fr-FR/Ionic-Zurich/events/265767496/" rel="noopener ugc nofollow" target="_blank"> Meetup </a>上介绍它的一些特性。其中之一是一个无限滚动器的实现，我将在下面的帖子中与你分享。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b337" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">开始之前</h1><p id="fd66" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">要实现该解决方案，我们需要一个Ionic + React应用程序。</p><p id="5439" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您还没有，或者您只是想创建一个示例来遵循本教程，请查看文档齐全且易于遵循的官方<a class="ae ky" href="https://ionicframework.com/docs/react" rel="noopener ugc nofollow" target="_blank">文档</a>，或者使用以下命令启动一个示例:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b195" class="ne md it na b gy nf ng l nh ni">$ ionic start infiniteScroll tabs --type react</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9462" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><p id="cfbf" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Ionic用来创建新应用程序的入门套件包含三个选项卡，三个页面，它们本身就是React功能组件。出于方便的原因，我们将在第一个选项卡中实现我们的解决方案，分别在文件<code class="fe nj nk nl na b">./src/pages/Tab1.tsx</code>中。</p><p id="cd7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们要实现无限滚动，因此要显示一个列表，我们要做的第一件事是添加一个应该包含我们的项目的有状态值。</p><p id="760c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们使用了<code class="fe nj nk nl na b"><a class="ae ky" href="https://reactjs.org/docs/hooks-reference.html#usestate" rel="noopener ugc nofollow" target="_blank">useState</a></code> React钩子。此外，我们使用卡片来呈现它们，并添加了另一个状态，这将帮助我们在没有什么可迭代的时候停止滚动。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="0a0d" class="ne md it na b gy nf ng l nh ni">import {<br/>  IonContent, IonHeader, IonPage,<br/>  IonTitle, IonCard, IonToolbar} from '@ionic/react';<br/>import React, {useState} from 'react';</span><span id="62fe" class="ne md it na b gy nm ng l nh ni">const Tab1: React.FC = () =&gt; {</span><span id="1ae6" class="ne md it na b gy nm ng l nh ni">  const [items, setItems] = useState&lt;string[]&gt;([]);</span><span id="b48a" class="ne md it na b gy nm ng l nh ni">  const [disableInfiniteScroll, setDisableInfiniteScroll] = <br/>        useState&lt;boolean&gt;(false);</span><span id="383e" class="ne md it na b gy nm ng l nh ni">  return (<br/>    &lt;IonPage&gt;<br/>      &lt;IonHeader&gt;<br/>        &lt;IonToolbar&gt;<br/>          &lt;IonTitle&gt;Tab One&lt;/IonTitle&gt;<br/>        &lt;/IonToolbar&gt;<br/>      &lt;/IonHeader&gt;<br/>      &lt;IonContent&gt;<br/>        {items.map((item: string, i: number) =&gt; {<br/>           return &lt;IonCard key={`${i}`}&gt;&lt;img src={item}/&gt;<br/>                  &lt;/IonCard&gt;<br/>        })}<br/>      &lt;/IonContent&gt;<br/>    &lt;/IonPage&gt;<br/>  );</span><span id="50f8" class="ne md it na b gy nm ng l nh ni">};</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bc18" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">获取API</h1><p id="e7e4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">项目列表也意味着数据列表。在我们的特定示例中，我们将使用<a class="ae ky" href="https://dog.ceo/dog-api/" rel="noopener ugc nofollow" target="_blank"> Dog API </a>来获取信息，它已经成为我在教程中最喜欢的API。</p><p id="ab0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个API是免费的、开源的，不需要任何令牌，并且支持CORS请求。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="33b2" class="ne md it na b gy nf ng l nh ni">async function fetchData() {<br/>  const url: string = 'https://dog.ceo/api/breeds/image/random/10';<br/><br/>  const res: Response = await fetch(url);<br/>  res<br/>      .json()<br/>      .then(async (res) =&gt; {<br/>        if (res &amp;&amp; res.message &amp;&amp; res.message.length &gt; 0) {<br/>          setItems([...items, ...res.message]);</span><span id="0713" class="ne md it na b gy nm ng l nh ni">          setDisableInfiniteScroll(res.message.length &lt; 10);<br/>        } else {<br/>          setDisableInfiniteScroll(true);<br/>        }<br/>      })<br/>      .catch(err =&gt; console.error(err));<br/>}</span></pre><p id="3a3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，这个例子不包含任何分页，而您真正的解决方案会包含分页。它会随机取出10只狗。当然，由于这个原因，我们的列表中可能会有重复项。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8a25" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">加载初始数据</h1><p id="0781" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Ionic提供了我们可以在应用中使用的多个生命周期事件。我非常欣赏的一点是，他们不仅为标准组件提供这样的事件，也为功能组件提供这样的事件。</p><p id="d305" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在页面显示时获取数据，我们可以挂接在<code class="fe nj nk nl na b">ionViewWillEnter</code>上，当组件路由将要以动画形式出现在视图中时，会触发该事件。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ec0d" class="ne md it na b gy nf ng l nh ni">import {useIonViewWillEnter} from '@ionic/react';</span><span id="dadb" class="ne md it na b gy nm ng l nh ni">const Tab1: React.FC = () =&gt; {</span><span id="103b" class="ne md it na b gy nm ng l nh ni"><strong class="na iu"><em class="nn">  </em></strong>useIonViewWillEnter(async () =&gt; {<br/>    await fetchData();<br/>  });</span><span id="f7e7" class="ne md it na b gy nm ng l nh ni">};</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cf24" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">无限卷轴</h1><p id="f399" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们切入正题，我们现在要添加我们的无限滚动条。首先，我们添加了一个新的函数，它将帮助我们获取新的数据，并停止告诉scroller操作已经完成。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7248" class="ne md it na b gy nf ng l nh ni">async function searchNext($event: CustomEvent&lt;void&gt;) {<br/>    await fetchData();</span><span id="27dd" class="ne md it na b gy nm ng l nh ni">    ($event.target as HTMLIonInfiniteScrollElement).complete();<br/>}</span></pre><p id="53af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们导入离子无限卷轴组件。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ff8f" class="ne md it na b gy nf ng l nh ni">import {IonInfiniteScroll, IonInfiniteScrollContent}<br/>       from '@ionic/react';</span></pre><p id="c420" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的内容中呈现如下:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="aa6e" class="ne md it na b gy nf ng l nh ni">&lt;IonInfiniteScroll threshold="100px"<br/>    disabled={disableInfiniteScroll}<br/>    onIonInfinite={(e: CustomEvent&lt;void&gt;) =&gt; searchNext(e)}&gt;<br/>    &lt;IonInfiniteScrollContent<br/>        loadingText="Loading more good doggos..."&gt;<br/>    &lt;/IonInfiniteScrollContent&gt;<br/>&lt;/IonInfiniteScroll&gt;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ae12" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">全代码</h1><p id="bcaa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我将上述步骤中的代码进行了拆分，以使实现更容易理解(我希望如此)，但是完整的代码放在一起，你可以在<a class="ae ky" href="https://github.com/peterpeterparker/infiniteScroll/blob/master/src/pages/Tab1.tsx" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="63a7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">试验</h1><p id="4baf" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果一切按计划进行，一旦您用命令行<code class="fe nj nk nl na b">ionic serve</code>运行我们的应用程序，您应该能够用您最喜欢的浏览器浏览无限的狗列表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/a786fcb1821e25d8fb0deacf04bb766d.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*zOAnHKLkcqo0M7NMtVioQQ.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这么多狗</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eeec" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">过滤</h1><p id="f2b3" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">显示经过过滤的项目列表可能和无限滚动条一样常见。</p><p id="54da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，让我们以新状态的形式向我们的实现中添加一个过滤器，并修改<code class="fe nj nk nl na b">fetch</code>函数，以便在应用过滤器的情况下重置项目并只查询指定的品种。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ff57" class="ne md it na b gy nf ng l nh ni">const [filter, setFilter] = useState&lt;string | undefined&gt;(undefined);</span><span id="40dd" class="ne md it na b gy nm ng l nh ni">async function fetchData(reset?: boolean) {<br/>  const <strong class="na iu">dogs</strong>: string[] = reset ? [] : items;<br/>  const url: string = filter ?<br/>        `https://dog.ceo/api/breed/${filter}/images/random/10` : <br/>        'https://dog.ceo/api/breeds/image/random/10';<br/><br/>  const res: Response = await fetch(url);<br/>  res<br/>      .json()<br/>      .then(async (res) =&gt; {<br/>        if (res &amp;&amp; res.message &amp;&amp; res.message.length &gt; 0) {<br/>          setItems([...<strong class="na iu">dogs</strong>, ...res.message]);<br/>  <br/>          setDisableInfiniteScroll(res.message.length &lt; 10);<br/>        } else {<br/>          setDisableInfiniteScroll(true);<br/>        }<br/>      })<br/>      .catch(err =&gt; console.error(err));<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c6b4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用React钩子获取和刷新数据</h1><p id="165e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了观察应用于过滤器的变化并刷新数据，我们现在要用一个<code class="fe nj nk nl na b">useEffect</code> React钩子替换之前使用的<code class="fe nj nk nl na b">useIonViewWillEnter</code>生命周期。</p><p id="b424" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做，当我们进入页面时，数据仍然会被加载，而且在状态更新时也会被获取。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9983" class="ne md it na b gy nf ng l nh ni">import React, {useState, useEffect} from 'react';</span><span id="1532" class="ne md it na b gy nm ng l nh ni">const Tab1: React.FC = () =&gt; {</span><span id="9d79" class="ne md it na b gy nm ng l nh ni">  useEffect( () =&gt; {<br/>      fetchData(true);<br/>  }, [filter]);</span><span id="6afb" class="ne md it na b gy nm ng l nh ni">};</span></pre><p id="6acf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们进口离子按钮和标签。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="6b5a" class="ne md it na b gy nf ng l nh ni">import {IonButton, IonLabel} from '@ionic/react';</span></pre><p id="9504" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并且最终使用这些组件来触发只有腊肠狗的狗列表的过滤。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="02ae" class="ne md it na b gy nf ng l nh ni">&lt;IonButton onClick={() =&gt; setFilter('dachshund')}&gt;<br/>    &lt;IonLabel&gt;Filter&lt;/IonLabel&gt;<br/>&lt;/IonButton&gt;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cb2a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">演示解决方案</h1><p id="2351" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我已经在我上传到<a class="ae ky" href="https://github.com/peterpeterparker/infiniteScroll/blob/master/src/pages/Tab2.tsx" rel="noopener ugc nofollow" target="_blank"> GitHub </a>的演示解决方案的第二个选项卡中实现了这个过滤器示例。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b7de" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">试验</h1><p id="3d58" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您再次运行该应用程序，您现在应该能够过滤列表中只有腊肠犬。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/1e1e80ed57b1fb73f79679dd11fc5ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*dCTUxVxI8yfkxGsqtV0baA.gif"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">这么多腊肠狗</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8d59" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">蛋糕上的樱桃</h1><p id="4ebf" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">无限滚动只是Ionic + React的精彩特性之一，也是我在Meetup实现的原型中使用的特性之一。</p><p id="f6f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我构建的小应用程序是免费和开源的，在<a class="ae ky" href="https://wooof.ch" rel="noopener ugc nofollow" target="_blank"> Wooof </a>上试试吧。</p><p id="b0d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到无限和更远的地方，</p><p id="6af3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大卫</p></div></div>    
</body>
</html>