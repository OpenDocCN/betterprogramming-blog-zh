# 选择合适的 Kubernetes 托管解决方案

> 原文：<https://betterprogramming.pub/choose-the-right-kubernetes-hosting-solution-a842878fc594>

## 选择 Kubernetes 平台时需要考虑的事项

![](img/2211fb29fec3727861d7dba06d6f2b89.png)

汉斯-彼得·高斯特在 Unsplash[拍摄的照片](https://unsplash.com/s/photos/confusion?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

容器战争已经结束，Kubernetes 是明显的赢家！当它是关于运行您的容器，明确的选择是 Kubernetes，没有第二个想法。但人们不知道的是，Kubernetes 是一种复杂的野兽，需要驯服。

因此，在您决定自己安装、运行和管理 Kubernetes 之前，请三思。安装 Kubernetes 用于游戏或作为您的开发环境是一回事，但是当涉及到在生产中运行它时，您需要考虑 Kubernetes 的许多方面，这些方面可能会带来比解决方案更多的复杂性。

不要误解我。我并不是说 Kubernetes 不是正确的解决方案，它确实简化了容器的管理。它的确是革命性的，改变了我们看待 It 基础设施和应用的方式。但是，由于它的灵活性，您不希望自己对其进行微调，因为您的环境可能需要也可能不需要许多功能。

最佳实践只是指导原则，事情会根据您的具体使用情况而变化。尽管如此，我还是要说，更加从头开始的安装，包括使用像`kubeadm`这样的工具，比仅仅运行几个命令需要更多的配置。

问题在于人们向典型公司的领导层推销 Kubernetes 的方式。看起来我们可以在几个小时内运行一个集群，大多数管理层都认为管理起来很容易，但事实并非如此。

让我们看看，如果您运行一个自托管的 Kubernetes 解决方案，您需要注意哪些方面:

*   **高可用性** —单个控制平面 Kubernetes 集群似乎很容易启动，但当您必须确保高可用性时，事情就变得复杂了。等等，Kubernetes 不是默认高度可用吗？嗯，是也不是。是的，因为如果您有多个工作节点分布在数据中心，您可以确保您的容器的高可用性。不会，因为您还需要在多个数据中心运行冗余的控制平面节点，以防您失去托管控制平面节点的 DC。同样，您还需要确保 etcd 集群的高可用性。
*   **安全性**—Kubernetes 托管最容易被忽视和脆弱的方面是安全性。默认安装是一个更通用的设置，如果您想在生产中使用 Kubernetes 集群，您将需要进一步强化它。尽管市场上有一些工具可以在您的集群上运行一致性测试，但是如果您缺少有经验的 Kubernetes 管理员，并不是所有的建议都很容易实现。
*   **管理** —仅仅设置和强化集群是不够的。您必须定期备份集群、修补集群并进行升级。你必须确保按时安装所有的安全补丁。不仅如此，您还必须查看与集群管理相关的日常 BAU 活动。如果你不把这些自动化，你会把自己置于一个重大的风险境地。
*   **与核心服务的集成** —您需要使用 Kubernetes 控制器将您的定制安装与您的云和虚拟机 API 集成，这些控制器与这些提供商进行交互，以便为您的容器应用程序(如负载平衡器和持久卷)提供基础架构。这意味着您将配置和细节(比如 API 密钥和秘密)存储在 Kubernetes 控制平面节点中，因此需要确保适当的安全性以防止误用。

最后，你需要在使用 Kubernetes 的花费和节省之间取得平衡。成本对你来说可能不是一个因素，但如果你花了很多预算支付昂贵的 Kubernetes 专业人员，你可能要考虑一些可行的选择，将你从所有这些头痛。

# Kubernetes 解决方案

所以，现在明显的问题是，我应该选择什么解决方案？这取决于您的情况和您的定位，但让我们试着了解一些场景，这将有助于选择适合您的平台。

# 你已经在云端运行了吗？

如果答案是肯定的，那么您应该考虑一个托管解决方案来满足您的需求。它不仅可以快速创建集群并在其上部署容器，还可以为您管理集群。这意味着云提供商会为您处理大部分管理活动，例如确保高可用性、某种程度的安全性、升级以及为您的集群安装操作系统补丁，而您甚至不会注意到这一切。

最好在云上使用托管解决方案，而不是运行自己的基于 IaaS 的解决方案，即使后者会给你同样的结果。你不仅会从财务角度受益，还会省去自己管理一切的大麻烦。

一些最受欢迎的托管云 Kubernetes 解决方案如下:

*   [**谷歌 Kubernetes 引擎**](https://cloud.google.com/kubernetes-engine) —谷歌的这款产品是市场上最健壮的托管 Kubernetes 集群之一。您需要支付工作节点和 0.10 美元/集群/小时的管理费。最棒的是，有了谷歌 Anthos，你还可以在内部运行 GKE。我稍后会谈到这一点。
*   [**Azure Kubernetes 服务**](https://azure.microsoft.com/en-gb/services/kubernetes-service/)——对于那些已经使用 Azure 的人来说，你完全可以选择 AKS 作为你的 Kubernetes 解决方案。AKS 最好的部分是微软对运行你的集群不收取集群管理费。您只需为您使用的工作节点和网络资源付费。从长远来看，如果你想使用承诺使用折扣或已经是微软的合作伙伴，它们也很便宜。
*   [**亚马逊弹性 Kubernetes 服务**](https://aws.amazon.com/eks/) — AWS 的弹性容器服务已经有一段时间了，但他们现在把赌注压在了 Kubernetes 上，EKS 正在发生很大的变化。它的定价极具竞争力，收取 0.10 美元/集群/小时的管理费，外加工作节点和其他基础设施成本，类似于 Google。

不要被管理费压得喘不过气来，因为这比雇佣一个专业的 Kubernetes 管理员来为你管理集群要便宜。

不同的云中还有其他可用的 Kubernetes 解决方案，但我不会一一介绍，因为我们需要研究其他场景。

# 您是否在内部运行？

内部 infra 是 Kubernetes 景观中的二等公民。这并不是说 Kubernetes 不在本地运行，而是它不提供开箱即用的特性，而这些特性通常是在云上运行时才允许的。例如，它不能为您旋转负载平衡器服务，也不能在默认设置中要求动态、持久的卷。如果您有一个虚拟化的内部基础架构，则有适用于 VMware 和 VSphere 的控制器可以帮助您实现这一功能。然而，由于它们没有被广泛使用，它们需要熟练的资源来维护。

尽管我会建议尽可能迁移到云，但如果法规或安全原因限制了您，那么有许多现成的解决方案可供内部部署市场使用:

*   [**Anthos 上的谷歌 Kubernetes 引擎**](https://cloud.google.com/anthos/gke) — Anthos 是谷歌提供的一个应用管理平台，你可以将其安装在你的内部基础设施上，将其转换成与云一致的环境。一旦你安装了 Anthos，你就可以在上面运行 GKE，就像在云上运行一样。
*   [**OpenShift**](https://www.openshift.com/)—Red Hat 的 open shift 是市场上最受欢迎的本地 Kubernetes 安装之一，它允许您保护开箱即用的容器化应用程序。OpenShift 是为企业构建的，他们非常重视安全性，但却牺牲了灵活性。它们有点贵，主要面向企业。
*   [**Rancher**](https://rancher.com/docs/rancher/v2.x/en/cluster-provisioning/)—Rancher 是一款基于 Kubernetes 的管理解决方案，可帮助您通过单一控制平面管理内部和云中的 Kubernetes 应用。虽然您可以使用 Rancher 来管理您的云设置，但在内部站点中，您可以使用 Rancher 的 Kubernetes 引擎(RKE)。这是一个由牧场主管理的 Kubernetes 集群，它是通过牧场主 UI 而不是通过更复杂的方法创建的。您可以挑选标准功能，只需点击一个按钮就可以打开和关闭它们。

# 结论

如果你仍然选择 DIY，确保你使用的工具如`kubeadm`、`kops`或 Kubespray。它们确保您运行标准设置。您还应该查看确保生产就绪的各个方面，并为您的集群运行[一致性](https://medium.com/better-programming/how-to-validate-your-kubernetes-cluster-with-sonobuoy-c91b282908fe)和[安全性测试](https://medium.com/better-programming/how-to-harden-your-kubernetes-cluster-with-kube-bench-fae71eb24d8)，因为大多数问题都将包含在其中。

感谢阅读！我希望你喜欢这篇文章。