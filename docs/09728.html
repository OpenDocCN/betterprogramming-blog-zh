<html>
<head>
<title>Animating SwiftUI Canvas in iOS 15</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS 15中制作SwiftUI画布动画</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/animating-swiftui-canvas-in-ios-15-8d8ba940fcc9?source=collection_archive---------5-----------------------#2021-10-04">https://betterprogramming.pub/animating-swiftui-canvas-in-ios-15-8d8ba940fcc9?source=collection_archive---------5-----------------------#2021-10-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1e5c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用画布视图看转换</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3e52723ee5726d873fe905f523d6690d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ytMHEQlqqOXY8UHv2fkxmA.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@soulsana?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> SOULSANA </a>在<a class="ae ky" href="https://unsplash.com/s/photos/transformation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</p></figure><p id="0619" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Combine框架和SwiftUI one同时出现并不是巧合，它们是天生的一对。虽然在不同的尺度上，<code class="fe lv lw lx ly b">TimelineView</code>和<code class="fe lv lw lx ly b">Canvas</code>同时发布也不是巧合，它们也是为彼此而生的。继续读下去，我会解释的。</p><p id="db65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上个月，我发表了第一篇关于Canvas视图的文章，这篇文章讲述了如何使用Canvas视图构建一个时钟。今天我想用一个不同版本的<code class="fe lv lw lx ly b">TimelineView</code>。我怀疑这是一个专门用于<code class="fe lv lw lx ly b">Canvas</code>视图的版本。</p><h1 id="4c7a" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">案情摘要</h1><p id="110a" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">我对仿射变换很感兴趣，不久前发表了一篇关于仿射变换的文章。我想在这篇论文中做同样的事情。我想建立一个工具来帮助读者和我自己理解这些动物是如何工作的。现在要明确的是，我这次谈论的是3D仿射变换。</p><p id="7560" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我还打算使用动画版的<code class="fe lv lw lx ly b">TimelineView</code>，以及一个<code class="fe lv lw lx ly b">Canvas</code>视图。计划是创建一个界面，当我对管理我的3D仿射动画的参数进行更改时，它会实时显示。</p><p id="3dd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编码——这是我们将要构建的接口。我选择头骨是因为它是一个很好的形状，因为你可以很容易地理解你在看什么，就翻转和转动而言。</p><p id="f053" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就代码而言，你看到的是红色方块中的<code class="fe lv lw lx ly b">Canvas</code>视图，它的动画是由<code class="fe lv lw lx ly b">TimelineView</code>维护的。所有可以更改的变量都保存在一个专用的类中，这样就可以在不打乱动画循环的情况下进行更改。</p><p id="e5f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一点很关键，你不能使用<code class="fe lv lw lx ly b">@State</code>变量在<code class="fe lv lw lx ly b">Canvas</code>视图中进行修改，否则会遇到SwiftUI中的紫色运行时警告。我确实用Combine框架组装了一个版本，但是这个解决方案更简单，也一样好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/94bae83e4735bfecf14b1c7aa73941f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fy34r3I6WtadGwf0MgmDdg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自名词项目的弗拉基米尔·别洛奇金的《头骨》</p></figure><h1 id="294f" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">它是如何工作的？</h1><p id="59cb" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">当您单击方向提示时，它会改变颜色编码。当头骨从左向右旋转时，绿色背景的参数可以改变。当头骨前后旋转时，红色背景的参数可以改变。当然，没有什么能阻止你在绿灯时换红灯，你只是看不到任何不同。</p><p id="be15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">左边的数字是度数，你可以看到它在两个方向旋转了360度。如果你愿意，你也可以修改它。</p><p id="55fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">右侧的滑块控制旋转的锚点，滑块下方的文本也是如此。它们如何影响你将在代码本身中看到的大画面。</p><p id="4466" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">右下角的文本也代表锚点。代码比我希望展示的要多一点，但是额外的代码只是为了布局。去上课吧。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="8898" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里需要注意的最重要的部分是返回下一个角度的函数。需要它们来促进发生在一个闭环内的动画制作，即<code class="fe lv lw lx ly b">TimelineView</code>。现在，到原则视图——这显示了嵌入在<code class="fe lv lw lx ly b">TimelineView</code>中的<code class="fe lv lw lx ly b">Canvas</code>视图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="857d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一段代码是<code class="fe lv lw lx ly b">CanvasView3</code>本身。这里需要注意的两个最重要的细节是函数<code class="fe lv lw lx ly b">returnNextAngleX</code>和<code class="fe lv lw lx ly b">returnNextAngleY</code>，它们在每次画布循环刷新时返回下一个数字。</p><p id="e1a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们是动画背后的驱动力——这也是我在<code class="fe lv lw lx ly b">Canvas</code>视图的一层中绘制它的事实。这样做说明了如何将类似<code class="fe lv lw lx ly b">projectionTransforms</code>的效果应用到同一个<code class="fe lv lw lx ly b">Canvas</code>视图的不同部分。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="8a0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提到的所有其他方法都是简单的UI元素，您可以在控制屏幕上看到，用于修改正在发生的事情。</p><p id="667d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，虽然我加快了GIF的速度以保持它的小——当我点击不同的锚点时，你可以看到这对变换的效果有很大的影响。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/0515c2008b7357b178ab524d93f1563c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5lg1RI74EguiWQcvNvS0uw.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">来自名词项目的弗拉基米尔·别洛奇金的《头骨》</p></figure><p id="f384" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我不会包括第三个GIF，但改变X轴或Y轴也有同样的效果。您可以通过下载并亲自尝试代码来体验这种效果。</p><p id="f1f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，这里是我之前发布的<code class="fe lv lw lx ly b">Canvas</code>视图中引用的方法。这里没有火箭科学，您可能以前没有遇到过的唯一细节是文本字段的默认值设置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="80de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些都让我想到了这篇文章的结尾。有几样东西留给你去尝试:</p><ul class=""><li id="43ea" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">我没有为Z轴添加任何控件，它们将与X轴或Y轴的控件相同…自己试试吧。Z轴控制旋转。</li><li id="ca29" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我将显示器设置为显示X平面或Y平面上的旋转，现在当然可以在两个平面上旋转图像。改变代码试试吧，如果你愿意，你可以使用3个平面。</li><li id="40a8" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我确实提到了<code class="fe lv lw lx ly b">transform3d.m34 = 1/512</code>的设置，它控制图像滚动时的视角。尝试更改这个数字，看看它如何影响结果。试试1024和2048——只是为了好玩。</li><li id="889e" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">我也没有展示暂停按钮的实际操作，它停止了角度的更新，但没有停止动画循环——所以您仍然可以对锚点进行更改并查看结果。</li></ul><p id="0116" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div></div>    
</body>
</html>