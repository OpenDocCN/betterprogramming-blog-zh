<html>
<head>
<title>Explore Hilt: A Dependency Injection Library for Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Hilt:Android的依赖注入库</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/hilt-dependency-injection-library-for-android-2aebf04e8147?source=collection_archive---------10-----------------------#2020-06-26">https://betterprogramming.pub/hilt-dependency-injection-library-for-android-2aebf04e8147?source=collection_archive---------10-----------------------#2020-06-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="567c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Jetpack推荐的依赖注入库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ef60afb75853a14d0be6169883be2610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WH1qbEWjpri3p5HkBzboiQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:作者</p></figure><h1 id="1c6c" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">什么是依赖注入？</h1><p id="4690" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">长期以来，依赖注入(DI)在程序设计中被广泛使用。DI是一种技术，通过这种技术，类接收它所依赖的其他对象，而不是自己创建它们。实现依赖注入为您提供了以下优势:</p><ul class=""><li id="a231" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated">代码的可重用性</li><li id="bc9c" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">易于重构</li><li id="5e28" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">易于测试</li></ul></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="0b5c" class="ky kz it bd la lb nj ld le lf nk lh li jz nl ka lk kc nm kd lm kf nn kg lo lp bi translated">依赖注入的基础</h1><p id="fb5c" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">开发应用程序时，一个类可能需要引用其他类。例如，<code class="fe no np nq nr b">Car</code>类可能需要一个<code class="fe no np nq nr b">Engine</code>类的引用。这些必需的类被称为依赖项，在这个例子中，<code class="fe no np nq nr b">Car</code>类依赖于运行<code class="fe no np nq nr b">Engine</code>类的一个实例。我们可以通过三种不同的方式提供这些必需的依赖关系:</p><ol class=""><li id="39c8" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml ns mu mv mw bi translated">依赖类<strong class="ls iu">在其内部创建依赖的实例或对象</strong>。在我们的例子中，在<code class="fe no np nq nr b">Car</code>类中创建了<code class="fe no np nq nr b">Engine</code>类的对象。</li><li id="9c21" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml ns mu mv mw bi translated">使用其他地方的物品。我们使用<code class="fe no np nq nr b">Context</code>和<code class="fe no np nq nr b">getSystemService()</code>吸气剂的方式。</li><li id="cf97" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml ns mu mv mw bi translated">将依赖关系作为<strong class="ls iu">参数</strong>提供给依赖类。在我们的例子中，通过构造函数或setter函数将<code class="fe no np nq nr b">Engine</code>对象作为参数传递给<code class="fe no np nq nr b">Car</code>类。</li></ol><p id="175c" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">DI非常适合Android开发。如果你曾经使用过<strong class="ls iu"> Dagger，</strong>官方的DI框架，或者任何其他Android的DI库，你会知道手动创建所有需要的依赖项需要多少努力和样板代码。对我来说，在使用匕首的起点，理解和执行事情就像一场噩梦。理解事情需要很多天，而有效地实现它们需要更多的时间。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="08dd" class="ky kz it bd la lb nj ld le lf nk lh li jz nl ka lk kc nm kd lm kf nn kg lo lp bi translated">匕首之柄简介</h1><p id="951e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">由于当前DI库中样板代码的数量和实现的难度，Android团队提出了Hilt。通过为我们项目中的每个Android类提供容器并自动管理它们的生命周期，Hilt提供了一种在Android应用程序中实现DI的标准方法。Hilt构建在Dagger之上，以减少项目中手工DI的工作量，并从编译时正确性、运行时性能、可伸缩性等方面获益。</p><blockquote class="nw"><p id="4123" class="nx ny it bd nz oa ob oc od oe of ml dk translated">Hilt是Android应用程序中用于DI的Dagger的简化形式，有更多的好处。</p></blockquote><p id="4df8" class="pw-post-body-paragraph lq lr it ls b lt og ju lv lw oh jx ly lz oi mb mc md oj mf mg mh ok mj mk ml im bi translated">由于我们中的大多数人现在已经习惯了Jetpack的组件，因此，Hilt现在是Jetpack的<strong class="ls iu">推荐的</strong>库，用于Android中的依赖注入。Hilt是为Android开发的，目的是为开发者节省时间。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="cc6f" class="ky kz it bd la lb nj ld le lf nk lh li jz nl ka lk kc nm kd lm kf nn kg lo lp bi translated">为什么是希尔特？</h1><p id="a27a" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Hilt的主要目标是简化Android应用程序的Dagger相关基础设施。Hilt的好处是:</p><ul class=""><li id="623b" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated">简化样板文件</li><li id="c3f2" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">分离的构建依赖项</li><li id="e808" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">简化配置</li><li id="08aa" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated">改进的测试</li></ul></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="1fdc" class="ky kz it bd la lb nj ld le lf nk lh li jz nl ka lk kc nm kd lm kf nn kg lo lp bi translated">刀柄基础</h1><p id="047f" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在讨论实现之前，我们先来看看与Hilt相关的术语。与Dagger类似，Hilt是一个完全基于注释的框架。我们经常使用的一些注释是:</p><h2 id="cad9" class="ol kz it bd la om on dn le oo op dp li lz oq or lk md os ot lm mh ou ov lo ow bi translated"><code class="fe no np nq nr b"><strong class="ak">@HiltAndroidApp</strong></code></h2><p id="763e" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这个注释需要应用到应用程序类，这样就可以生成组件。比起匕首那不是很容易吗？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><h2 id="9ba8" class="ol kz it bd la om on dn le oo op dp li lz oq or lk md os ot lm mh ou ov lo ow bi translated"><code class="fe no np nq nr b">@AndroidEntryPoint</code></h2><p id="c2b1" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这个注释需要应用于Android组件，如片段、活动等。注入依赖关系。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="b884" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">Hilt目前支持以下Android类:</p><ul class=""><li id="da7e" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated"><code class="fe no np nq nr b">Activity</code></li><li id="3214" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><code class="fe no np nq nr b">Fragment</code></li><li id="e33c" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><code class="fe no np nq nr b">View</code></li><li id="8d6e" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><code class="fe no np nq nr b">Service</code></li><li id="7a56" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><code class="fe no np nq nr b">BroadcastReceiver</code></li></ul><h2 id="2d78" class="ol kz it bd la om on dn le oo op dp li lz oq or lk md os ot lm mh ou ov lo ow bi translated"><code class="fe no np nq nr b">@Inject</code></h2><p id="14d2" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">该注释用于执行注入。它用于将依赖项注入到依赖类中。依赖项可以通过构造函数、字段或方法注入。这类似于匕首。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">现场注射</p></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">构造函数注入</p></figure><p id="52fb" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated"><em class="oz">由Hilt注入的字段不能是私有的。</em></p><h2 id="c3e9" class="ol kz it bd la om on dn le oo op dp li lz oq or lk md os ot lm mh ou ov lo ow bi translated"><code class="fe no np nq nr b">@Module</code></h2><p id="aad1" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这个注释用在我们提供依赖关系的类上面，也就是我们创建对象的地方。这类似于匕首。</p><h2 id="ab29" class="ol kz it bd la om on dn le oo op dp li lz oq or lk md os ot lm mh ou ov lo ow bi translated">@InstallIn</h2><p id="9086" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Hilt模块用<code class="fe no np nq nr b"><strong class="ls iu">@InstallIn</strong>(<strong class="ls iu">ActivityComponent::class</strong>)</code>进行了注释，因为我们希望Hilt将依赖注入到<code class="fe no np nq nr b"><strong class="ls iu">Activity</strong></code>类中。这个注释意味着这个<code class="fe no np nq nr b"><strong class="ls iu">Module</strong></code>中的所有依赖项在应用程序的所有活动中都可用。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><h2 id="8d21" class="ol kz it bd la om on dn le oo op dp li lz oq or lk md os ot lm mh ou ov lo ow bi translated">@提供</h2><p id="1465" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">注释用在模块中和方法之上，我们在其中创建对象以将它们作为依赖项传递。这个注释类似于Dagger中的注释。它主要用于提供第三方库实例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="fc0b" class="ky kz it bd la lb nj ld le lf nk lh li jz nl ka lk kc nm kd lm kf nn kg lo lp bi translated">刀柄设置</h1><p id="6eaa" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">首先，将<code class="fe no np nq nr b">hilt-android-gradle-plugin</code>插件添加到项目的根级<code class="fe no np nq nr b">build.gradle</code>文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="1c04" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">接下来，在<code class="fe no np nq nr b">app/build.gradle</code>文件中应用Gradle插件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="85e6" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">最后，在<code class="fe no np nq nr b">app/build.gradle</code>文件中添加以下依赖关系:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="758b" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">开始使用Hilt的环境设置已经完成。一旦我们构建并同步了项目，我们就可以使用它们了。开始用刀柄吧！</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="1f32" class="ky kz it bd la lb nj ld le lf nk lh li jz nl ka lk kc nm kd lm kf nn kg lo lp bi translated">剑柄在行动</h1><p id="a0a2" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">让我们看看如何将一个简单的类注入到应用程序类中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="2a3c" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">为了告诉Hilt如何提供一个类型的实例，在你想要被注入的类的构造函数中添加<strong class="ls iu"> @Inject </strong>注释。Hilt拥有的关于如何提供不同类型实例的信息也被称为<strong class="ls iu">绑定</strong>。</p><p id="477b" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">一旦我们在<code class="fe no np nq nr b">Application</code>中启用了成员注入，我们就可以开始使用<code class="fe no np nq nr b">@AndroidEntryPoint</code>注释在其他Android类中启用成员注入。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="0a4f" class="ky kz it bd la lb nj ld le lf nk lh li jz nl ka lk kc nm kd lm kf nn kg lo lp bi translated">刀柄附带喷气背包支持</h1><p id="0498" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">随着我们大多数人开始使用Jetpack库，支持Jetpack的Hilt需要一些额外的依赖。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="1188" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">Hilt目前支持以下Jetpack组件:</p><ul class=""><li id="d2c5" class="mm mn it ls b lt mo lw mp lz mq md mr mh ms ml mt mu mv mw bi translated"><code class="fe no np nq nr b">ViewModel</code></li><li id="0307" class="mm mn it ls b lt mx lw my lz mz md na mh nb ml mt mu mv mw bi translated"><code class="fe no np nq nr b">WorkManager</code></li></ul><p id="f099" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">让我们看看如何创建简单的ViewModel并将其注入到活动中。<code class="fe no np nq nr b"><strong class="ls iu">@ViewModelInject</strong></code>在ViewModel对象的构造函数中使用注释来提供一个ViewModel实例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="5c63" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">将这个视图模型注入到活动中要简单得多，只需一行代码:</p><pre class="kj kk kl km gt pa nr pb pc aw pd bi"><span id="7258" class="ol kz it nr b gy pe pf l pg ph">private val sampleViewModel: SampleViewModel by <strong class="nr iu">viewModels</strong>()</span></pre><p id="36a6" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated"><code class="fe no np nq nr b"><strong class="ls iu">viewModels()</strong></code> <strong class="ls iu"> </strong>是一个委托函数，可以用来注入<code class="fe no np nq nr b">ViewModel</code>。这里不需要使用@Inject注释。如果我们想使用<code class="fe no np nq nr b">Activity</code>级别<code class="fe no np nq nr b">ViewModel</code>，我们需要应用<code class="fe no np nq nr b"><strong class="ls iu">activityViewModels</strong>()</code>委托函数，而不是<code class="fe no np nq nr b"><strong class="ls iu">viewModels</strong>()</code>。</p><p id="e879" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">整个活动可能看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ox oy l"/></div></figure><p id="9eb0" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">在<a class="ae pi" href="https://developer.android.com/training/dependency-injection/hilt-jetpack" rel="noopener ugc nofollow" target="_blank">文档</a>中了解更多关于Jetpack支持的信息。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="5322" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">用最简单的方法注入组件不是很有趣吗？开始使用Dagger初始版本的人会理解与Dagger相比，使用Hilt是多么容易。然而，这是一个匕首覆盖层，知道基本知识总是一件重要的事情。开始用刀柄。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="2bdd" class="ky kz it bd la lb nj ld le lf nk lh li jz nl ka lk kc nm kd lm kf nn kg lo lp bi translated">参考</h1><p id="ad18" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated"><a class="ae pi" href="https://developer.android.com/training/dependency-injection/hilt-android#setup" rel="noopener ugc nofollow" target="_blank">带句柄的依赖注入</a></p><p id="8ac6" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated"><a class="ae pi" href="https://dagger.dev/hilt/" rel="noopener ugc nofollow" target="_blank">刀柄文档</a></p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="1064" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">请让我知道你的建议和意见。</p><p id="0489" class="pw-post-body-paragraph lq lr it ls b lt mo ju lv lw mp jx ly lz nt mb mc md nu mf mg mh nv mj mk ml im bi translated">感谢阅读！</p></div></div>    
</body>
</html>