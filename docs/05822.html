<html>
<head>
<title>How to Make Discord Bot Commands in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python制作不和谐的Bot命令</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-make-discord-bot-commands-in-python-2cae39cbfd55?source=collection_archive---------0-----------------------#2020-08-10">https://betterprogramming.pub/how-to-make-discord-bot-commands-in-python-2cae39cbfd55?source=collection_archive---------0-----------------------#2020-08-10</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="2882" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">将你的不和谐带入生活</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/e9fd7d5c7f70af7d5a32274dab5b93b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pgOjBS0d_mc10JJG8yKGvQ.png"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">作者照片。</p></figure><p id="872e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><em class="lv">注意:如果你以前从未建造过不和谐机器人，请查看我最近关于该主题的文章</em><a class="ae lw" href="https://medium.com/better-programming/coding-a-discord-bot-with-python-64da9d6cade7" rel="noopener"><em class="lv"/></a><em class="lv">。</em></p><p id="129e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果你想知道如何让你的机器人更上一层楼，首先想到的应该是为你的机器人准备一些命令，对吗？你的直觉反应会是使用<code class="fe lx ly lz ma b">on_message()</code>事件监听器并用<code class="fe lx ly lz ma b">switch</code>案例甚至<code class="fe lx ly lz ma b">if</code>语句填充它。然而，这并不理想，因为这不是<code class="fe lx ly lz ma b">on_message()</code>函数的预期目的。这是为了监听来自通道的消息，而不是发出命令。</p><p id="50ae" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">幸运的是，有一个框架允许我们为可爱的机器人创建特定的命令，同时保持我们的代码超级干净，因为该框架迫使我们将每个命令分成一个函数。</p><p id="7831" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">假设你使用的是<code class="fe lx ly lz ma b">discord.py</code>，我们可以利用它提供的命令API。</p><p id="75c8" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在本文中，我们将讨论如何为你的机器人创建一个前缀，因为你可能接触过的大多数机器人都有某种形式的前缀(例如<code class="fe lx ly lz ma b">$</code>或<code class="fe lx ly lz ma b">!</code>)。之后，我们将讨论如何创建新的命令。最后，我们将检查内置的帮助命令，以获得您的机器人拥有的命令列表，这样您就不必创建自己的命令了。</p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="e4b5" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">1.创建你的机器人的前缀</h1><p id="32c0" class="pw-post-body-paragraph kz la iu lb b lc na jv le lf nb jy lh li nc lk ll lm nd lo lp lq ne ls lt lu in bi translated">我们将从头开始构建一个机器人，但如果你有一个现有的机器人，你非常欢迎使用该文件。</p><p id="dc27" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">因此，让我们继续添加启动和运行这个机器人所需的项目:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="afd7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这个代码段让我们有了一个可以启动，可以打Discord的API的bot。我们使用了<code class="fe lx ly lz ma b">load_dotenv()</code>模块，这样我们就没有明文形式的bot令牌。</p><p id="7e5d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这是我们最想关注的部分:</p><pre class="kk kl km kn gu nh ma ni nj aw nk bi"><span id="c6c6" class="nl mj iu ma b gz nm nn l no np">bot = commands.Bot(command_prefix="$")</span></pre><p id="d626" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果您只使用了<code class="fe lx ly lz ma b">Client</code>，请注意这一行与之前有什么不同:</p><pre class="kk kl km kn gu nh ma ni nj aw nk bi"><span id="4d02" class="nl mj iu ma b gz nm nn l no np">bot = discord.Client()</span></pre><p id="1296" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">对于第一个代码框，我们正在创建一个<code class="fe lx ly lz ma b">Bot</code>对象，而不是一个<code class="fe lx ly lz ma b">Client</code>对象。<code class="fe lx ly lz ma b">Bot</code>对象为我们提供了<code class="fe lx ly lz ma b">Client</code>所没有的功能。</p><p id="ca51" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">现在我们有了新的行，我们都准备好开始创建一些命令了！</p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="b45d" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">2.定义你的机器人的命令</h1><p id="1b49" class="pw-post-body-paragraph kz la iu lb b lc na jv le lf nb jy lh li nc lk ll lm nd lo lp lq ne ls lt lu in bi translated">现在我们有了新的<code class="fe lx ly lz ma b">Bot</code>对象，我们可以开始定义命令了。Discord bot中命令的美妙之处在于，它们只是简单的函数，上面有装饰器，因此我们可以轻松地抽象我们的代码。</p><p id="a9e7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">让我们构建一个简单的<code class="fe lx ly lz ma b">ping</code>命令，我们的机器人将使用命令框架识别它。它看起来会像这样:</p><pre class="kk kl km kn gu nh ma ni nj aw nk bi"><span id="46b5" class="nl mj iu ma b gz nm nn l no np">@bot.command()<br/>async def ping(ctx):<br/>	await ctx.channel.send("pong")</span></pre><p id="65af" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">一些事情正在发生。首先，注意我们如何在函数的顶部添加了一个装饰器(<code class="fe lx ly lz ma b">@bot.command()</code>)。<code class="fe lx ly lz ma b">bot</code>是我们在脚本的前面部分定义的机器人的名字，<code class="fe lx ly lz ma b">.command()</code>让机器人知道这是一个特别的命令。</p><p id="f481" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们需要覆盖的下一部分是名称。无论你给你的函数起什么名字，那都是不和谐端的命令的名字。因此，要调用我们的机器人的命令，它将在Discord上“$ping ”,正如您在这里看到的:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nq"><img src="../Images/b65c9d30b22afc5ab564c4e901108243.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*slj1zktbau0I1qufFXCl4w.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">乒乓球</p></figure><p id="d7f0" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果你想给你的函数取别的名字，你完全可以。您唯一需要做的事情就是在装饰器中添加<code class="fe lx ly lz ma b">name</code>属性，如下所示:</p><pre class="kk kl km kn gu nh ma ni nj aw nk bi"><span id="331a" class="nl mj iu ma b gz nm nn l no np">@bot.command(name="ping")<br/>async def some_crazy_function_name(ctx):<br/>	await ctx.channel.send("pong")</span></pre><p id="ac98" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这将产生与原始代码块相同的结果，所以你可以选择你想做的。</p><p id="b828" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">最后需要说的是<code class="fe lx ly lz ma b">ctx</code>对象。这就是所谓的<code class="fe lx ly lz ma b">Context</code>对象。基本上，这个对象表示调用命令的服务器的所有信息。比如消息、频道、公会、发送消息的用户等等。如果你对里面的内容感到好奇，我的建议是要么在运行脚本时打开一个调试器，这样你就可以看到里面的内容，要么参考文档<a class="ae lw" href="https://discordpy.readthedocs.io/en/latest/ext/commands/api.html#context" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="94d4" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">3.允许你的机器人接受参数</h1><p id="5006" class="pw-post-body-paragraph kz la iu lb b lc na jv le lf nb jy lh li nc lk ll lm nd lo lp lq ne ls lt lu in bi translated">现在我们有了机器人的基本命令，如果我们想创建一个允许调用机器人的用户包含一些参数的命令呢？例如，如果我想标记服务器上的某个人，该怎么办？从编码的角度来看，我该怎么做呢？嗯，这很简单。我们可以将一些参数添加到我们的命令/函数的参数列表中，它们将对我们可用。让我给你看一段代码:</p><pre class="kk kl km kn gu nh ma ni nj aw nk bi"><span id="8c4d" class="nl mj iu ma b gz nm nn l no np">@bot.command()<br/>async def print(ctx, arg):<br/>	await ctx.channel.send(arg)</span></pre><p id="baf8" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这里，我们创建了一个名为<code class="fe lx ly lz ma b">print</code>的新命令，允许机器人打印我们发送给它的东西。当我们调用这个命令时，它看起来像这样:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nr"><img src="../Images/bffccae6533a6cb438d591848bf90476.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*UePRY0lokiBQy910xqZnbw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">一天一个苹果，医生远离我。</p></figure><p id="c535" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如您所见，命令/函数接受一个参数，我们可以简单地将其打印回通道。或者如果你想用它做一些更复杂的事情(例如，抓住一个被标记的用户)，那么你可以。</p><p id="7a69" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">现在，下一个问题是“多重参数怎么办？”嗯，就是这么简单。如果你想有多个参数，你可以在参数列表中添加任意数量的参数，如果你正在寻找一个特定的数字。如果你也想酷，可以在你的参数表中使用<code class="fe lx ly lz ma b">*</code>，这是一个参数的变量列表。这里有一个<code class="fe lx ly lz ma b">*</code>的例子:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="ce46" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">很酷吧。这在命令行程序中很常见。正如你在代码块中看到的，我们在参数列表中使用了<code class="fe lx ly lz ma b">*args</code>，这是用户输入的参数列表。然后我们简单地遍历参数列表，并将其添加到一个<code class="fe lx ly lz ma b">response</code>字符串中。这允许我们的机器人打印这个可爱的信息:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ns"><img src="../Images/0fc85a3945ef34e904d58f527433e990.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*4x2QmVnCBxXPLaHHbahuiw.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">苹果派的确是美味的甜点。</p></figure><p id="bd8a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">使用对您的用例更有意义的方法，但是要知道这两种方法都是可用的。</p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="7399" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">4.使用内置的帮助命令</h1><p id="00f6" class="pw-post-body-paragraph kz la iu lb b lc na jv le lf nb jy lh li nc lk ll lm nd lo lp lq ne ls lt lu in bi translated">我们已经基本上涵盖了你开始为你的机器人开发命令所需要的一切。但是，还有一件事我想提一下，那就是我们的命令的预建帮助消息。让我快速演示一下我在说什么:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nt"><img src="../Images/c1106509843a31dab19ad8f07641c506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*mYVP0EzaR467XGS5gbeTdA.png"/></div><p class="kv kw gk gi gj kx ky bd b be z dk translated">一个非常有用的命令。</p></figure><p id="d6f3" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我把<code class="fe lx ly lz ma b">$help</code>打成了不和谐，这就是我得到的结果。如果你看看代码，我们从来没有实现过这样的事情。然而，<code class="fe lx ly lz ma b">discord.py</code>中的命令框架已经内置了这一点。这个命令自动提取所有向你的机器人注册的命令！</p><p id="a2a5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">对此您可以做的另一件事是深入研究特定命令以获得更多信息:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nu"><img src="../Images/a400855d4f02260d27e7fcbee0a821a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*6MzawqLUh_gq5EOpzeDdgA.png"/></div></figure><p id="f766" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">但是正如您所看到的，除了命令名之外，它并没有显示任何有用的信息。我们有一个地方来放置命令的描述，这个地方很方便地位于每个函数的装饰器内部:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="6ef4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">正如您在上面看到的，我只是将属性添加到了装饰器中。<code class="fe lx ly lz ma b">help</code>消息用于深入描述，因此当您键入<code class="fe lx ly lz ma b">$help print</code>时，在调用<code class="fe lx ly lz ma b">$help</code>时，<code class="fe lx ly lz ma b">brief</code>用作快速摘要。下面是代码运行时的样子:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nv"><img src="../Images/ba12824abf9ead162c394055f12f76e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2jVNlpOcZhUXhOSrcPU2Mg.png"/></div></div></figure><p id="7493" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">另一个我没有提到的很酷的事情是，它在特定的帮助消息中显示了参数列表。如果您将参数命名得足够好，使用户能够理解它们的含义，这将对您的用户很有帮助。</p></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="6cf9" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">5.将on_message()与命令一起使用</h1><p id="b9ff" class="pw-post-body-paragraph kz la iu lb b lc na jv le lf nb jy lh li nc lk ll lm nd lo lp lq ne ls lt lu in bi translated">现在您已经了解了如何使用命令，您将很快发现在组合<code class="fe lx ly lz ma b">on_message()</code>和您的新命令时存在一个问题。如果加上:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="50b4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">当您运行这个命令时，您的命令将不再工作，但是您的<code class="fe lx ly lz ma b">on_message()</code>可以工作。那么，这不就违背了这篇文章的全部目的吗？从技术上来说，是的，但是如果您既想拥有消息侦听器又想拥有命令，有一种方法可以将两者结合起来。为此，您需要将这一行添加到您的<code class="fe lx ly lz ma b">on_message()</code>:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="46f5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">有了函数底部的新行，我们的命令现在将被注册！没有这一行，任何命令都不会被触发，所以如果您想合并侦听器和命令，请确保在底部添加这一行。</p><p id="7a26" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">总结一下，下面是最终文件的样子:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure></div><div class="ab cl mb mc hy md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="in io ip iq ir"><h1 id="71d1" class="mi mj iu bd mk ml mm mn mo mp mq mr ms ka mt kb mu kd mv ke mw kg mx kh my mz bi translated">结论</h1><p id="0769" class="pw-post-body-paragraph kz la iu lb b lc na jv le lf nb jy lh li nc lk ll lm nd lo lp lq ne ls lt lu in bi translated">恭喜你。你现在知道如何为你的不和谐机器人发出合法的命令了。谈到这一点，我们只是触及了表面。谈到Commands框架，还有很多事情可以讨论。如果你有兴趣，可以查看一下<a class="ae lw" href="https://discordpy.readthedocs.io/en/latest/ext/commands/commands.html" rel="noopener ugc nofollow" target="_blank">的官方文档</a>。</p><p id="d458" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">和往常一样，源代码是GitHub 上的<a class="ae lw" href="https://github.com/ericjaychi/sample-discord-bot-commands" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="d56c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">下一集再见！</p></div></div>    
</body>
</html>