<html>
<head>
<title>Linking Animations Using AnimatableModifier in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SwiftUI中使用AnimatableModifier链接动画</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/linking-animations-using-animatablemodifier-in-swiftui-30269f99bef0?source=collection_archive---------6-----------------------#2021-09-08">https://betterprogramming.pub/linking-animations-using-animatablemodifier-in-swiftui-30269f99bef0?source=collection_archive---------6-----------------------#2021-09-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="77de" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用带有SwiftUI动画修改器的组合框架</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cfe548a8fb3354523c4f7db3fc2ed4b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMQ7jyacFtBIMQbNGvXGTQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@mr_vero?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">欧文·史密斯</a>在<a class="ae ky" href="https://unsplash.com/s/photos/animation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="8ff9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">动画毫无疑问是iOS的命脉。在SwiftUI中很容易大部分实现。这当然是假设你不想把你的动画链接在一起，遗憾的是，苹果似乎还没有把这一选项加入到大计划中。但是并没有失去一切，因为通过一点横向思考，我们可以找到克服这个缺点的方法。和我一起踏上旅程，看看如何做到这一点。</p><p id="64d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一想法——当然，如果有关的计时是有规律的，你可以使用我在本文<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/using-timers-and-delays-in-swiftui-2-1362f664f013">中提到的计时器。他们将在很大程度上发挥作用，尽管挑战不在于常规，而在于非常规。</a></p><p id="b2c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，有一个比使用定时器更好的SwiftUI解决方案。一个SwiftUI解决方案，使用原生的AnimatableModifier来跟踪和报告它已经完成了多少动画值。</p><p id="1c58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，您需要定制想要链接在一起的动画，但除此之外，它工作得很好。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="7d2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个例子中，给例程的<code class="fe lx ly lz ma b">animNumber</code> I是物体绕一个圆移动的度数。我使用rounded来确保我不会被舍入错误所困扰，我比较单个值，因为我希望它触发一次，而且只触发一次。</p><p id="9a25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同时使用该例程的SwiftUI代码如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="bfd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码使用了我在另一篇文章中定义的延迟方法，看起来像这样。</p><pre class="kj kk kl km gt mb ma mc md aw me bi"><span id="a411" class="mf mg it ma b gy mh mi l mj mk">func delay(_ delay:Double, closure:@escaping ()-&gt;()) {<br/>  <br/>DispatchQueue.main.asyncAfter(deadline: DispatchTime.now() + Double(Int64(delay * Double(NSEC_PER_SEC))) / Double(NSEC_PER_SEC), execute: closure)</span><span id="42e2" class="mf mg it ma b gy ml mi l mj mk">}</span></pre><p id="e4e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2秒钟后，它更新我想在屏幕上显示的文本对象，然后开始旋转它。当<code class="fe lx ly lz ma b">chainEffect</code>修改器检测到你达到了大约360度时，它会触发<code class="fe lx ly lz ma b">releaseMessage</code>,该文本会显示单词数组中的下一个单词。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/723b0c8be78f5ed3d8000b5754f41ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Ow9LoPrhFLRBD8OGZ9uweg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">动画单词链</p></figure><p id="285b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里看到的下一个结果是上面旋转文本的动画GIF。就这么简单。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="0af1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是我刚刚展示的代码有一个小问题。我应用的动画是针对整个对象，而不是单个对象。想象一下，你想让单词一个接一个地出现，每个单词都淡入。</p><p id="590b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，首先我定义了我想要显示的文本单词的视图:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="3533" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个函数像上一个函数一样调用修饰符，有两个参数，第一个是文本内容，第二个是它的索引。我需要索引，因为所有的<code class="fe lx ly lz ma b">TextWord</code>视图将同时接收到<code class="fe lx ly lz ma b">rMessage</code> <code class="fe lx ly lz ma b">passThroughSubject</code>，我想选择一个特定的视图。</p><p id="86f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来是修饰符<code class="fe lx ly lz ma b">ChainEffectV</code>的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="19d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码几乎与另一个<code class="fe lx ly lz ma b">ChainEffect</code>方法相同，除了我改变了完成条件。</p><p id="7351" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后下面是新的<code class="fe lx ly lz ma b">ContentView.swift</code>，它在一个循环中多次调用<code class="fe lx ly lz ma b">TextView</code>。与上一个解决方案不同的是，这个解决方案的效率要高得多，因为它在我们尝试制作动画之前就布局了整个显示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="58a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/453a1956a105d7085eaff88f0bfb13bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0BQ8YoyWd-KcaQZpg1p_1w.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">第二个动画单词链</p></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="d675" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些都让我想到这篇短文的结尾。感谢阅读。</p></div></div>    
</body>
</html>