<html>
<head>
<title>Is Jetpack Compose Ready for You?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jetpack Compose准备好了吗？</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/is-jetpack-compose-ready-for-you-eae6c93ad3f8?source=collection_archive---------4-----------------------#2022-08-09">https://betterprogramming.pub/is-jetpack-compose-ready-for-you-eae6c93ad3f8?source=collection_archive---------4-----------------------#2022-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3195" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">探索发布一年后的更新</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/766f46668c8ee07c7f99bab18124d870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1rvS1iMvzOKp8vJv"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">迈克·范·登博斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="c4e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Android的Jetpack Compose版本1.0是在将近一年前的7月28日<a class="ae kv" href="https://android-developers.googleblog.com/2021/07/jetpack-compose-announcement.html" rel="noopener ugc nofollow" target="_blank">发布的</a>。它承诺了一种在我们的Android应用程序中构建UI的新方法，受到了极大的欢迎。此后一直定期更新维护，最近一次发布发生在6月底(29日)。虽然它的发布仅仅过去了一年，但一年是一个足够好的时间框架来从更好的角度审视事物。</p><p id="92c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我敢肯定，你们中的许多人已经考虑过，现在是否是加入Jetpack Compose潮流的好时机。总有一种不可否认的渴望，那就是尝试和拥抱新技术，看看我们能用它做什么。但在我们的内心深处，我们都有一个小小的声音告诉我们，这可能太快了。有点像想咬一口刚出炉的披萨。</p><p id="b357" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有时候，我们必须等到我们能吃第一口的时候。</p><h1 id="0411" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">引擎发热</h1><p id="f500" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Jetpack Compose是Android用于原生构建UI的最新工具包。如果您过去开发过应用程序，那么在创建布局时，您可能会熟悉这两个选项:</p><ul class=""><li id="eb0d" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">创建XML文件</li><li id="e9c6" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">通过代码在类中构建用户界面</li></ul><p id="5a3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些构建UI的方式已经伴随Android开发者很长时间了，所以它们是屡试不爽的。现在，我们已经习惯了它们，但这并不意味着它们没有缺点。</p><p id="4d20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开发人员知道我们在通过XML创建布局时面临的麻烦。确保一切都正确对齐，需要添加id和各种其他属性，需要将XML中的UI与活动/片段中的逻辑连接起来，设计视图与文本编辑器。</p><p id="884b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这会变得很麻烦。</p><p id="f739" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">会变得很乱。</p><p id="f8f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它会变得重复。</p><p id="0a7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可能会令人沮丧。</p><p id="07a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，在不需要构建和运行应用程序的情况下，查看您的UI是如何堆叠起来的总是很好的。属性本身是不言自明的，UI元素的种类也很多。</p><p id="cfe0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nd">那么，为什么还要考虑迁移到Jetpack Compose呢？</em></p><p id="7f3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Jetpack Compose的主要吸引力在于用Kotlin编写定义UI的代码的简单性。不再为选择相对布局而非线性布局而烦恼。约束布局中不再有定义约束。只是一个简单的系统来展示你的设计，并使它成为现实。</p><p id="072a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在花费大量时间使用Jetpack Compose并将我的一个应用程序转换为完全基于它的布局后，这是一场艰苦的战斗，但最终，我对结果感到满意。</p><p id="09be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这不是一个将尝试和解雇Jetpack组成的一块。它旨在展示撰写本文时Jetpack Compose的状态。因为最好睁大眼睛去做某事。</p><h1 id="9e5d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">我的喷气背包在哪里？</h1><p id="9a15" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Jetpack Compose提供了一系列简单的组件来构建您的布局。但是，即使该产品看起来简单且易于操作，也有一些明显的缺陷。</p><p id="5fd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们都很熟悉<code class="fe ne nf ng nh b">GridLayout</code>，Jetpack Compose也有它的一些实现是有道理的。确实如此。它被命名为<code class="fe ne nf ng nh b">LazyVerticalGrid</code>(或<code class="fe ne nf ng nh b">LazyHorizontalGrid</code>)。但是，如果您有一个网格布局的应用程序，并希望切换到Jetpack Compose，您需要知道这个组件目前仍处于试验阶段。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">LazyGrid.kt</p></figure><p id="ad87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如您在上面看到的，该类用<a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/ExperimentalFoundationApi" rel="noopener ugc nofollow" target="_blank">@ experimentalfoundationapi</a>进行了注释，内容如下:</p><blockquote class="nk nl nm"><p id="c8e9" class="kw kx nd ky b kz la jr lb lc ld ju le nn lg lh li no lk ll lm np lo lp lq lr ij bi translated">这个基础API是实验性的，将来可能会更改或删除。</p></blockquote><p id="1910" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">类声明上面的注释声明:</p><blockquote class="nk nl nm"><p id="fedb" class="kw kx nd ky b kz la jr lb lc ld ju le nn lg lh li no lk ll lm np lo lp lq lr ij bi translated">惰性网格布局的DSL实现。它只包含网格中可见的行。此API不稳定，请考虑使用LazyColumn和Row等稳定组件来实现相同的结果。</p></blockquote><p id="b146" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着您最好使用列和行来创建网格布局，而不是使用这个类。当你使用一个实验性的API时，你可能会遇到奇怪的错误或崩溃，你不知道如何修复，也可能没有解决方案(<a class="ae kv" href="https://issuetracker.google.com/issues/230514914" rel="noopener ugc nofollow" target="_blank">链接</a>到一个相关的问题):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni nj l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">在Jetpack Compose中使用网格时的异常示例</p></figure><p id="341f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ne nf ng nh b">@ExperimentalFoundationApi</code>可以在其他相当常见的用例中找到:</p><ul class=""><li id="7af2" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">允许项目被点击和长时间点击(<code class="fe ne nf ng nh b"><a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/foundation/package-summary#(androidx.compose.ui.Modifier).combinedClickable(kotlin.Boolean,kotlin.String,androidx.compose.ui.semantics.Role,kotlin.String,kotlin.Function0,kotlin.Function0,kotlin.Function0)" rel="noopener ugc nofollow" target="_blank">combinedClickable</a></code>)，</li><li id="a231" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">使一个元素<a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/material/package-summary#(androidx.compose.ui.Modifier).swipeable(androidx.compose.material.SwipeableState,kotlin.collections.Map,androidx.compose.foundation.gestures.Orientation,kotlin.Boolean,kotlin.Boolean,androidx.compose.foundation.interaction.MutableInteractionSource,kotlin.Function2,androidx.compose.material.ResistanceConfig,androidx.compose.ui.unit.Dp)" rel="noopener ugc nofollow" target="_blank">可滑动</a></li><li id="b68d" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">在惰性列表中创建项目 (Jetpack Compose的RecyclerView)</li></ul><p id="d1c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了Grid，一些UI元素在Jetpack Compose中还不可用。为了绕过这个问题，建议的解决方案是使用可组合的<a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/viewinterop/package-summary#AndroidView(kotlin.Function1,androidx.compose.ui.Modifier,kotlin.Function1)" rel="noopener ugc nofollow" target="_blank">Android view</a>。可以把它想象成视图对象的包装器。你可能会认为这种解决方案适合处理复杂视图的边缘情况，但实际上，谷歌承认Jetpack Composes的缺点，称:</p><blockquote class="nk nl nm"><p id="9f86" class="kw kx nd ky b kz la jr lb lc ld ju le nn lg lh li no lk ll lm np lo lp lq lr ij bi translated"><code class="fe ne nf ng nh b"><a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/viewinterop/package-summary#AndroidView(kotlin.Function1,androidx.compose.ui.Modifier,kotlin.Function1)" rel="noopener ugc nofollow" target="_blank">AndroidView</a></code>通常用于使用在组合中不可重新实现的视图，并且没有相应的组合API。目前常见的例子有<code class="fe ne nf ng nh b">WebView</code>、<code class="fe ne nf ng nh b">SurfaceView</code>、<code class="fe ne nf ng nh b">AdView</code>等。</p></blockquote><p id="203d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，了解这个组件以及您(很可能)需要使用它是很重要的。</p><h1 id="3911" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">飞行前检查清单</h1><p id="fe41" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Jetpack Compose提供了很多功能。毫无疑问。但是，一旦你开始使用它，你就会意识到，即使从整体上看，它可能看起来是一个完整的包，但还是缺少一些东西。那些东西不一定是特别的东西。比如工具提示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/0c2db461b3733b2f5889e6a6ce2d456e.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/1*hcF7ICWPzOeKC86zeI-2uQ.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">工具提示的示例</p></figure><p id="836f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">截至Jetpack Compose的最新版本，没有对工具提示的内置支持。是的，有一个<a class="ae kv" href="https://gist.github.com/amal/aad53791308e6edb055f3cf61f881451" rel="noopener ugc nofollow" target="_blank">变通办法</a>有人起草了，你可以申请。但这不是Jetpack Compose的官方部分，因此您必须始终确保该解决方案有效。在我看来，如果Jetpack Compose支持网格，它肯定会支持工具提示。</p><p id="78ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能会认为我夸大了这一点，但实际上，有一个<a class="ae kv" href="https://issuetracker.google.com/issues/187098109" rel="noopener ugc nofollow" target="_blank">问题</a>需要添加工具提示，所以社区对此有需求。</p><h1 id="791f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">测试… 3 2 1</h1><p id="851d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">Jetpack Compose只允许您进行插装测试，这意味着您将需要一个设备或模拟器来运行它们。此外，作为创建测试的一部分，您需要创建一个测试规则。这允许您在测试中测试和控制组件和应用程序。有两种测试规则:</p><ul class=""><li id="df4d" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/junit4/ComposeTestRule" rel="noopener ugc nofollow" target="_blank">作曲测试规则</a></li><li id="6170" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/junit4/package-summary#createAndroidComposeRule()" rel="noopener ugc nofollow" target="_blank"> AndroidComposeTestRule </a></li></ul><p id="73c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">两者的区别在于，后者用于访问系统相关的组件和逻辑(即活动、资源)。</p><p id="4f4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然提供的API是不言自明的，但是当您不得不做一些看起来非常简单的事情时，您可能会感到困惑。</p><p id="57e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，如果您想要执行一个点击图像的测试，有一个使用<a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/package-summary#(androidx.compose.ui.test.SemanticsNodeInteractionsProvider).onNodeWithContentDescription(kotlin.String,kotlin.Boolean,kotlin.Boolean,kotlin.Boolean)" rel="noopener ugc nofollow" target="_blank">onNodeWithContentDescription</a>的选项。但这并不像试图用<a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/package-summary#(androidx.compose.ui.test.SemanticsNodeInteractionsProvider).onNodeWithText(kotlin.String,kotlin.Boolean,kotlin.Boolean,kotlin.Boolean)" rel="noopener ugc nofollow" target="_blank"> onNodeWithText </a>定位按钮那样容易理解。它还假设您向图像元素添加了内容描述。</p><p id="db84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有时，您会发现没有可用的API方法能够满足您的需求，并且您可能最终会使用<code class="fe ne nf ng nh b"><a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/platform/package-summary#(androidx.compose.ui.Modifier).testTag(kotlin.String)" rel="noopener ugc nofollow" target="_blank">testTag</a></code> <a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/platform/package-summary#(androidx.compose.ui.Modifier).testTag(kotlin.String)" rel="noopener ugc nofollow" target="_blank">向您的元素添加测试标记。</a>然后你可以使用<code class="fe ne nf ng nh b"><a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/package-summary#(androidx.compose.ui.test.SemanticsNodeInteractionsProvider).onNodeWithTag(kotlin.String,kotlin.Boolean)" rel="noopener ugc nofollow" target="_blank">onNodeWithTag</a></code> <a class="ae kv" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/package-summary#(androidx.compose.ui.test.SemanticsNodeInteractionsProvider).onNodeWithTag(kotlin.String,kotlin.Boolean)" rel="noopener ugc nofollow" target="_blank"> </a>这样你就可以正确定位你的UI。这可能会让你的代码不那么不吸引人，因为在你的布局中会有<code class="fe ne nf ng nh b">.tesTag</code>线条。</p><p id="63e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在混合应用程序(混合视图和<code class="fe ne nf ng nh b">Compose</code> <code class="fe ne nf ng nh b">composables</code>的应用程序)中，您需要使用带有Jetpack Compose测试模块的Espresso。这是因为，虽然Espresso可以通过文本搜索来定位视图(例如)，但它无法访问Composables的语义。虽然这本身并不是一件坏事，但这只是您需要管理和处理的另一个依赖项和框架。</p><h1 id="3652" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">接地的</h1><p id="7bce" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">本文的目的不是劝阻您使用Jetpack Compose，也不是将它描绘成您应该完全避免的东西。就其本身而言，Jetpack Compose提供了许多新功能，并且仅处于起步阶段。</p><p id="a0e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没有什么是完美的，随着时间的推移和谷歌的持续努力，我相信Jetpack Compose将成为我们构建UI的方式。</p><p id="dc2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你甚至可以回顾自其发布以来的一年，看看这一年的进展如何。了解您将使用的技术的能力总是一个好主意。这样，您就可以评估它是否是适合您使用的工具。</p><p id="2826" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如本文开头提到的，我最近加入了Jetpack Compose潮流，并转换了我的一个应用程序来使用它。</p><pre class="kg kh ki kj gt nr nh ns nt aw nu bi"><span id="8307" class="nv lt iq nh b gy nw nx l ny nz">You can see my application on <a class="ae kv" href="https://play.google.com/store/apps/details?id=com.tomerpacific.laundry" rel="noopener ugc nofollow" target="_blank">Google Play Store</a> with accompanying source code <a class="ae kv" href="https://github.com/TomerPacific/LaundrySymbols" rel="noopener ugc nofollow" target="_blank">here</a>.</span></pre></div></div>    
</body>
</html>