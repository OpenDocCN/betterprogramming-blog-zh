<html>
<head>
<title>Setting Up an AWS Batch Job to Process Daily Tasks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置AWS批处理作业以处理日常任务</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/setting-up-an-aws-batch-job-to-process-daily-tasks-4d31d6bac257?source=collection_archive---------3-----------------------#2022-01-31">https://betterprogramming.pub/setting-up-an-aws-batch-job-to-process-daily-tasks-4d31d6bac257?source=collection_archive---------3-----------------------#2022-01-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4fb9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何为您的工作创建Docker映像和存储库</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/be41adbad5c94206293d722c5e10743f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NYOtm2W1D8oxjp5p"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">特里斯坦·加塞特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</p></figure><p id="8fb4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文描述了如何设置AWS批处理作业，使其在每天的cron触发器上运行。</p><p id="dbde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将有助于任何人谁是建立他们的第一批工作或有人谁是试图找出如何触发一个重复的基础上的工作。本教程还描述了如何创建更复杂的需要权限来调用其他AWS服务的作业，因为这在AWS文档中是相当模糊的。</p><p id="e1df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在介绍如何为您的工作创建Docker映像和存储库之前，我将简要地向您介绍AWS批处理的核心概念。然后，在结束之前，我将通过解释如何设置触发作业的AWS Eventbridge规则，一步步地解释如何设置AWS批处理基础设施。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c91a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">概念</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/459271474cad3768403acf89394ca948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLAse1zSwY3ZvVjjP0aC6A.png"/></div></div></figure><ul class=""><li id="8c0a" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated"><strong class="lb iu">作业</strong>:实际的计算单位。作业指定它们从哪个作业定义继承，并被推入作业队列。</li><li id="df5c" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated"><strong class="lb iu">作业定义</strong>:描述作业的模板。在这里，您定义了表示将要运行的容器的映像、传递给该容器的角色、计算类型(EC2或Fargate)和任何环境变量(以及更多可选的配置)。</li><li id="f67e" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated"><strong class="lb iu">作业队列</strong>:保存准备由下一个可用计算资源处理的作业。队列指定他们希望作业在什么计算环境中运行(可以是多个，按某种顺序)。</li><li id="42f4" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated"><strong class="lb iu">计算环境</strong>:表示作业可以运行的实际计算资源。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="84b9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">批处理作业代码</h1><p id="379e" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">首先，您需要定义在触发作业时实际运行的代码。</p><p id="a95b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于本例，您将希望将作业作为Docker容器运行。您可以选择任何您喜欢的语言，但是关键的要求是容器的一些入口点。这是作业启动时将运行的命令。</p><p id="1756" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python作业的简单<code class="fe no np nq nr b">Dockerfile</code>如下所示:</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="5b51" class="nw md it nr b gy nx ny l nz oa">FROM python:3.10.0</span><span id="84b6" class="nw md it nr b gy ob ny l nz oa">WORKDIR /app</span><span id="0750" class="nw md it nr b gy ob ny l nz oa">COPY requirements.txt requirements.txt<br/>RUN pip install -r requirements.txt </span><span id="0e67" class="nw md it nr b gy ob ny l nz oa">COPY src src/ </span><span id="9132" class="nw md it nr b gy ob ny l nz oa">ENTRYPOINT ["python3", "-m", "src.main"]</span></pre><p id="a4ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个<code class="fe no np nq nr b">Dockerfile</code>中，您将依赖项需求文件复制到Docker映像中，安装依赖项，然后复制src目录的内容。最后，您指定容器应该通过运行src目录中的<code class="fe no np nq nr b">main.py</code>脚本来启动。</p><p id="0a94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在此处查看并派生一个简单的AWS批处理作业报告<a class="ae ky" href="https://github.com/camin-mccluskey/example-aws-batch-python" rel="noopener ugc nofollow" target="_blank">示例。</a></p><h2 id="2c11" class="nw md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">为映像创建一个ECR存储库</h2><p id="633c" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在您已经有了作业代码和创建Docker映像的能力，您需要某种方法使这个映像可用于您稍后将创建的作业定义。</p><p id="84b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将使用AWS弹性容器注册中心(ECR)来托管您的映像。转到AWS控制台中的ECR，然后单击create repository。您很可能想要一个私有存储库，并且您可能希望按照以下约定来命名它:<code class="fe no np nq nr b">&lt;batch-job-name&gt;-repo</code></p><p id="1109" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他设置很可能会保留为默认设置。但是，您可能希望禁止Docker图像标签被覆盖。</p><p id="31a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个例子，您将总是使用<code class="fe no np nq nr b">:latest</code>标签，因此要求标签是可变的。</p><h2 id="8eba" class="nw md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">将您的图像推送到ECR</h2><p id="a0e9" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">您现在需要将Docker映像推送到ECR存储库。您可以从终端手动完成这项工作，或者使用类似Github的动作在代码推送时自动将新版本的图像推送到存储库中。</p><p id="f75f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">手动<br/> </strong>运行以下4个命令，将AWS区域替换为您的ECR repo所在的区域、带有已命名的AWS概要文件名称的概要文件(仅当您有多个概要文件时需要)以及AWS帐号。您需要在您的机器上安装<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener ugc nofollow" target="_blank"> aws-cli </a>。</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="7520" class="nw md it nr b gy nx ny l nz oa">$ aws ecr get-login-password --region &lt;aws-region&gt; --profile &lt;named-profile-with-ecr-access&gt; | docker login --username AWS --password-stdin &lt;aws-account-number&gt;.dkr.ecr.&lt;aws-region&gt;.amazonaws.com</span><span id="0456" class="nw md it nr b gy ob ny l nz oa">$ docker build -t &lt;your-image-name&gt; .</span><span id="6928" class="nw md it nr b gy ob ny l nz oa">$ docker tag &lt;your-image-name&gt;:latest &lt;aws-account-number&gt;.dkr.ecr.&lt;aws-region&gt;.amazonaws.com/&lt;ecr-repo-name&gt;:latest</span><span id="f8d4" class="nw md it nr b gy ob ny l nz oa">$ docker push &lt;aws-account-number&gt;.dkr.ecr.&lt;aws-region&gt;.amazonaws.com/&lt;ecr-repo-name&gt;:latest</span></pre><p id="17a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，上述内容仅适用于aws-cli版本&gt; 2。我在旧版本中遇到了一些问题，ECR身份验证无声地失败了。如果这一步有问题，请检查您的版本。</p><p id="dd83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用Github动作<br/></strong>Github market place有一个<a class="ae ky" href="https://github.com/marketplace/actions/push-to-amazon-ecr" rel="noopener ugc nofollow" target="_blank"> Push to ECR动作</a>，您可以将它安装在您的存储库中。这是对职务代码进行更改的首选方法，但是您可能希望先使用手动方法来完成本教程。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d5a1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">AWS批处理基础设施</h1><p id="3059" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">您可以按照AWS批处理<a class="ae ky" href="https://console.aws.amazon.com/batch/home#/wizard" rel="noopener ugc nofollow" target="_blank">向导</a>进行操作，但是请记住，如果不触发作业的第一次运行，则<em class="on">似乎无法完成向导。如果您想在所需的一切就绪之前设置作业，这可能会带来问题。以下步骤与向导完全相同，但允许您设置作业而无需运行它。</em></p><h2 id="12a6" class="nw md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">设置计算环境</h2><p id="1f35" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">首先转到AWS Batch，在AWS控制台中单击“计算环境”。单击create，您将看到计算环境创建页面。</p><p id="8066" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您很可能想要一个托管计算环境，但是您需要决定您需要哪种类型的计算。对于批量工作负载，您几乎肯定需要Fargate计算。如果您的作业<strong class="lb iu">在执行过程中会被中断，那么最好运行Fargate Spot实例。查看<a class="ae ky" href="https://containersonaws.com/introduction/ec2-or-aws-fargate/" rel="noopener ugc nofollow" target="_blank">此处</a>了解EC2与Fargate的更多细节，查看<a class="ae ky" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html" rel="noopener ugc nofollow" target="_blank">此处</a>了解spot实例的更多信息。</strong></p><p id="dcd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里用默认的<code class="fe no np nq nr b">Batch service-linked-role</code>就可以了。如果这是您的第一个AWS批处理作业，则会为您创建该角色。除非您有特定的网络要求，否则所有其他设置很可能会保留为默认设置。单击“创建计算环境”完成。您的环境在被视为“有效”之前将处于“正在创建”状态，此时您可以创建作业队列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/bc6b02c301afbafe4f12fceaa9c86d3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*09V0DoCCz_1-Ml6SI1QtgQ.png"/></div></div></figure><h2 id="0f26" class="nw md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">设置作业队列</h2><p id="a57e" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在，您可以创建队列，作业在被计算环境处理之前将位于该队列中。从批处理控制台转到“作业队列”,然后单击创建。为您的队列命名，并将“优先级”保留为1(这意味着该队列中的作业在释放计算资源时首先获得计算资源)。最后，连接上面创建的计算环境。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/53fa44af18937792ca13fbddfc874cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LmRSocxVkktuzsAb_6-0fw.png"/></div></div></figure><h2 id="7652" class="nw md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">设置作业定义</h2><p id="8fb9" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">这是这项任务的真正要点。作业定义描述了每个作业的“形状”——可以把它想象成一个模板。这也是您将告诉AWS Batch实际要运行什么图像的地方。转到批处理控制台中的“作业定义”，单击“创建”并选择“单节点”。大多数字段都是不言自明的，但我想指出几个您可能需要编辑的字段:</p><ul class=""><li id="752b" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">您可能想要编辑<strong class="lb iu">超时</strong>值来终止长时间运行的作业</li><li id="289f" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">如果您为您的计算环境选择了该选项，您将需要选择<strong class="lb iu"> Fargate </strong></li><li id="1269" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">如果您的工作需要进行出站网络调用(例如，调用外部API)，您需要启用<strong class="lb iu">分配公共IP </strong>选项。</li><li id="cb40" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">如果您的AWS ECS代理需要访问AWS APIs，您可能需要一个定制的<strong class="lb iu">执行角色</strong>。如果需要自定义角色，请参见下面的“创建自定义执行角色”一节。如果您不需要自定义角色，那么将为您提供角色<code class="fe no np nq nr b">ecsTaskExecutionRole</code>。请注意，这比您的<strong class="lb iu">容器</strong>需要访问AWS APIs的可能性要小，这也将在下面解释(参见“创建自定义作业角色”)。</li><li id="7fe6" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">您的图像值将是您之前创建的ECR <strong class="lb iu">图像</strong>的<strong class="lb iu"> URI </strong>。您可以通过返回到存储库并复制推送到存储库的最新映像的URI来获取它。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/937c27bf0f3ed91b2961b1ee9fbe5f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XY1Fum41Y42d7Q8ADJurSA.png"/></div></div></figure><ul class=""><li id="3edf" class="mv mw it lb b lc ld lf lg li mx lm my lq mz lu na nb nc nd bi translated">如果您的工作需要访问其他AWS资源，您可能需要为您的工作<strong class="lb iu">容器</strong>定制一个<strong class="lb iu">工作角色</strong>。如果是这种情况，请参见下面的“创建自定义工作角色”一节。</li><li id="a2fc" class="mv mw it lb b lc ne lf nf li ng lm nh lq ni lu na nb nc nd bi translated">你可能想记录你的工作是什么。您可以选择记录到特定的Cloudwatch日志组，或者留空以获取每次运行的预配日志组。</li></ul><h2 id="49a7" class="nw md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">创建自定义执行角色(可选)</h2><p id="615c" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated"><em class="on">仅当您的</em> <strong class="lb iu"> <em class="on"> ECS代理</em> </strong> <em class="on">需要访问其他AWS服务时，才需要此步骤。</em></p><p id="568b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果是这种情况，您需要跳转到AWS IAM查看这一部分。</p><p id="538d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到角色&gt;创建新角色&gt;弹性容器服务&gt;(滚动到底部)弹性容器服务任务。现在点击“下一步”并搜索<code class="fe no np nq nr b">AmazonECSTaskExecutionRolePolicy</code> —该角色允许对ECR(对于您刚刚推送的可爱的新图像)的读访问和对Cloudwatch日志的写访问。单击策略名称左侧的小框以附加到角色。</p><p id="ceb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以创建一个自定义策略来允许您的ECS代理访问其他AWS服务。要做到这一点，点击“创建策略”，这将打开一个新的标签与政策编辑器准备就绪。如果您愿意，可以使用可视化编辑器，或者粘贴到json策略中。点击标签，除非您的组织使用它们，然后为您的新策略命名和(可选)描述。单击“Create policy ”(创建策略),然后返回到上一个选项卡，在这里我们会将您的新策略附加到角色。</p><p id="bfa5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击“创建策略”最右侧的刷新按钮。这将重新加载策略列表。现在搜索您的新策略的名称—再次单击小框进行附加。点击标签，并为您的角色命名和(可选)描述。您应该看到附加了两个策略AWS托管策略和您的自定义策略。点击“创建角色”，您现在可以完成设置您的工作定义。</p><h2 id="e0e0" class="nw md it bd me oc od dn mi oe of dp mm li og oh mo lm oi oj mq lq ok ol ms om bi translated">创建自定义工作角色(可选)</h2><p id="2120" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated"><em class="on">仅当您的</em> <strong class="lb iu"> <em class="on">工作</em> </strong> <em class="on">需要访问其他AWS服务时，才需要此步骤。</em></p><p id="2af0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些步骤大致反映了上面的步骤，只有一个例外。你不需要在你的工作岗位上管理AWS<code class="fe no np nq nr b">AmazonECSTaskExecutionRolePolicy</code>。</p><p id="47d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转至IAM &gt;角色&gt;创建新角色&gt;弹性容器服务&gt;(滚动到底部)弹性容器服务任务。</p><p id="0a48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您需要创建一个自定义策略来附加到您的角色。根据您的工作需要访问哪些服务，您的策略会有所不同。查看<a class="ae ky" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_examples.html" rel="noopener ugc nofollow" target="_blank"> AWS IAM示例策略</a>或者使用可视化编辑器为您的用例构建所需的策略通常是个好主意。</p><p id="fd73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建完策略后，返回角色创建选项卡并搜索新策略。单击左侧的小框以附加到自定义工作角色。点击标签，并为您的角色命名和(可选)描述。点击“创建角色”，您现在可以完成设置您的工作定义。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e8b8" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Eventbridge触发器</h1><p id="624a" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">最后一步是创建一个触发器，它将按照一些预先确定的时间表运行作业。为此，您将创建一个AWS Eventbridge规则，方法是在控制台中选择该服务，转到“规则”并点击“创建规则”。</p><p id="2560" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选择一个规则名称，然后选择“计划”。您可以在固定速率(例如每小时1个事件)或cron表达式之间进行选择。在我们的例子中，我们选择“cron expression ”,因为我们希望我们的作业在每天的同一时间运行。请注意，AWS使用的cron表达式不同于您可能在网上看到的一些生成器。可以阅读AWS <a class="ae ky" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多(Tl；dr:表达式的形式是— <code class="fe no np nq nr b">MM HH DD MM DOW YY</code>。当您输入一个有效的cron表达式时，您将看到接下来的10个事件弹出。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/ff7bccfce26fb66435a6c562962ef219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_ElhyDDu7-SsbOD6KyzmQ.png"/></div></div></figure><p id="6047" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向下滚动，我们想要使用“AWS默认事件总线”——因为我们不依赖外部合作伙伴来提供事件。最后我们选择目标。这应该是“批处理作业队列”。用上面的信息填写所需的详细信息—除非您想重试失败的作业，否则可以省略选项。将角色保留为默认角色，然后点击“创建”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/137b87db5e0bb27c0bc0f52bd9ea56e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsTqPiXgrefJYuOLdWpvng.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ac30" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="8713" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">就是这样！当期望的时间到来时，将触发您的事件，创建一个从您的作业定义继承的新作业。然后，该作业将被放入您的作业队列中，由您的计算环境进行处理。您可以从AWS批处理作业控制台监视整个过程，如果您配置了日志记录，您还可以观察流入的Cloudwatch日志。</p><p id="613f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这简化了为您创建AWS批处理作业的过程。请随意使用示例<a class="ae ky" href="https://github.com/camin-mccluskey/example-aws-batch-python" rel="noopener ugc nofollow" target="_blank"> repo </a>并保存文章顶部的图形作为快速参考。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="c104" class="nw md it nr b gy nx ny l nz oa"><strong class="nr iu">Want to Connect?</strong></span><span id="c593" class="nw md it nr b gy ob ny l nz oa">I am the Co-Founder and CTO of <a class="ae ky" href="https://gotelescope.ai/" rel="noopener ugc nofollow" target="_blank">Telescope</a> — a platform that revolutionizes life science sales, based in London. You can read more of my thoughts on <a class="ae ky" href="https://twitter.com/camin_mccluskey" rel="noopener ugc nofollow" target="_blank">Twitter</a> where I tweet about technology and entrepreneurship (mostly).</span></pre></div></div>    
</body>
</html>