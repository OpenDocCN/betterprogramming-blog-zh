<html>
<head>
<title>How to Access the Coinbase API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何访问比特币基地API</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/accessing-the-coinbase-api-b62a38469066?source=collection_archive---------7-----------------------#2022-01-23">https://betterprogramming.pub/accessing-the-coinbase-api-b62a38469066?source=collection_archive---------7-----------------------#2022-01-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9ca4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用OAuth2</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9ba2811b9c9a01363a9cdd48a8fc7e57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4hLRljz70m8X0DoL"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Pierre Borthiry 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="a98e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比特币基地是一个加密货币交易所，你可以在那里购买比特币和以太坊等流行的货币。</p><p id="a5c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一系列文章中，我将向您展示如何利用比特币基地API来查看您持有的密码列表以及特定加密硬币的所有交易。</p><p id="f91c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将创建一个Node.js应用程序来访问比特币基地API。</p><h1 id="8b56" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">比特币基地API选项</h1><p id="5646" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">你可以在这里访问比特币基地API <a class="ae ky" href="https://developers.coinbase.com/" rel="noopener ugc nofollow" target="_blank">。比特币基地有两种API</a></p><p id="a77b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API密钥用于访问您在比特币基地的账户。OAuth2 API用于对任何用户进行coinbase认证，然后访问所有API功能。</p><p id="10c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个演示，我想让每个人都可以使用它，而不仅仅是我自己，所以我们将使用OAuth2 API。</p><h1 id="4aed" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建开发者帐户</h1><p id="1cb1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要使用比特币基地API，你需要创建一个免费的开发者账户。我不会带您完成创建帐户的步骤。</p><p id="537c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建好账户后，点击右上角的<code class="fe ms mt mu mv b">My Apps</code>按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/5c8afc5c208fbb58c0dacc855477b871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ef3u3WOb1XjRsalg"/></div></div></figure><p id="2f43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<code class="fe ms mt mu mv b">New OAuth2 Application button</code>。你会得到这张表格来完成你的申请。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/5e0233232699986b196e150a7939f00b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8GrHj7m6krvp01IL"/></div></div></figure><p id="9978" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe ms mt mu mv b">Application Name</code>，我放“API Demo”。</p><p id="ab6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe ms mt mu mv b">Description</code>，我放了“比特币基地API演示”。</p><p id="8415" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe ms mt mu mv b">Permitted Redirect URIs</code>，我放<a class="ae ky" href="http://localhost:3000/callback" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/callback</a>。注意:如果你在某个地方托管你的网站，那么你需要用你的主机的URI替换上面的URI。</p><p id="a4ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">表单底部是一系列单选按钮。我为所有人选择了<strong class="lb iu">否</strong>。</p><p id="8e25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">选中复选框以接受面向开发者的比特币基地条款。</p><p id="71ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成表格后，点击<code class="fe ms mt mu mv b">Create Application</code>按钮。</p><p id="655a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在比特币基地创建您的应用程序后，您将看到您的<code class="fe ms mt mu mv b">Client ID</code>和<code class="fe ms mt mu mv b">Client Secret</code>。保存这些，因为我们将在我们的应用程序中使用它。</p><h1 id="e40e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建节点应用程序</h1><p id="76b7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我使用express-generator来搭建Node.js应用程序。在终端中，使用以下命令创建节点应用程序:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="bc35" class="nc lw it mv b gy nd ne l nf ng">npx express-generator -e --view=ejs coinbase-demo</span></pre><p id="c199" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将使用EJS作为我的视图和模板引擎，所以我已经包括了它的选项。我的申请是<code class="fe ms mt mu mv b">coinbase-demo</code>。</p><p id="fef8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用以下命令切换到包含应用程序的目录:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="e917" class="nc lw it mv b gy nd ne l nf ng">cd coinbase-demo</span></pre><p id="e9f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来安装所有依赖项:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="5073" class="nc lw it mv b gy nd ne l nf ng">npm install</span></pre><p id="6595" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们开始编辑之前，我想安装3个额外的软件包，我们将使用。您可以使用以下命令安装它们:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="a4ef" class="nc lw it mv b gy nd ne l nf ng">npm install axios nodemon qs</span></pre><p id="a794" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在编辑器中打开应用程序。</p><h1 id="a9c2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">配置启动脚本</h1><p id="cdea" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">express-generator应用程序会在启动时验证您给它的端口值。这在文件<code class="fe ms mt mu mv b">bin/www</code>中完成。我不喜欢这样做，所以我要完全绕过它。</p><p id="05e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开<code class="fe ms mt mu mv b">package.json</code>文件。更新启动脚本，使其看起来像这样:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="0422" class="nc lw it mv b gy nd ne l nf ng">"start": "nodemon app.js"</span></pre><p id="4fd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，打开<code class="fe ms mt mu mv b">app.js</code>文件。在记录器行之后添加以下两行:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="2dfe" class="nc lw it mv b gy nd ne l nf ng">const axios = require('axios'); <br/>const port = process.env.PORT || 3000;</span></pre><p id="0723" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:端口必须与您在比特币基地应用程序中用于重定向URI的值相匹配。</p><p id="9b2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们将把我们所有的路线放在一个文件中，所以你可以删除<code class="fe ms mt mu mv b">usersRouter</code>行和在应用程序使用部分设置的行。您也可以删除routes目录中的<code class="fe ms mt mu mv b">users.js</code>文件。</p><p id="ddd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将不再导出app.js文件，因此删除导出它的最后一行。将其替换为以下内容:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="6a66" class="nc lw it mv b gy nd ne l nf ng">app.listen(port, '0.0.0.0', function () { <br/>  console.log("Server starting on localhost:" + port); <br/>});</span></pre><p id="541e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在可以删除<code class="fe ms mt mu mv b">bin</code>目录和其中包含的文件<code class="fe ms mt mu mv b">www</code>。</p><p id="ce2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过在终端中输入以下命令来启动服务器:</p><p id="cc30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开你的浏览器，输入URI <code class="fe ms mt mu mv b">localhost:3000</code>。您应该看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/c7d53b09855dfdd16c7f66f0fc8fd1a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/0*ObArEhhly8nJ4UJR"/></div></figure><h1 id="857a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">向比特币基地认证2</h1><p id="5e43" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们将使用比特币基地OAuth2来验证任何想要使用我们的应用程序的用户。你可以在这里找到<a class="ae ky" href="https://developers.coinbase.com/docs/wallet/coinbase-connect/reference" rel="noopener ugc nofollow" target="_blank">细节</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/8dad3ef767ed4c63a6af89d114d362a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vtRpFrF6RWsfL8V4"/></div></div></figure><p id="0d64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们应用程序的主页上，我们需要添加一个按钮来调用比特币基地端点，并传入我们想要添加的任何参数。</p><p id="c834" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开视图文件夹中的<code class="fe ms mt mu mv b">index.js</code>文件。在带有欢迎行的段落下方添加以下按钮:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="d851" class="nc lw it mv b gy nd ne l nf ng">&lt;a href="https://www.coinbase.com/oauth/authorize?response_type=code&amp;client_id=2240e80398486d147c6a3e2e48e63b3d9a562497ad85bcd3300b7dda67eae42d&amp;redirect_uri=http://localhost:3000/callback&amp;state=MY_SECRET_KEY&amp;scope=wallet:user:read,wallet:user:email,wallet:accounts:read,wallet:transactions:read&amp;account=all" class="btn"&gt; Connect with Coinbase &lt;/a&gt;</span></pre><p id="ef1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能会注意到这是一个非常非常长的<code class="fe ms mt mu mv b">a</code>标签。</p><p id="19b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它的正上方是欢迎消息，显示一个传递到文件中的<code class="fe ms mt mu mv b">title</code>。让我们通过传入适当的值来简化我们的按钮。</p><p id="f0ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开routes文件夹中的<code class="fe ms mt mu mv b">index.ejs</code>文件。在router变量后添加以下行。确保输入您的<code class="fe ms mt mu mv b">client_id</code>并从您的比特币基地OAuth2应用程序中回拨URI:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="1f31" class="nc lw it mv b gy nd ne l nf ng">const SECRET = "MY_SECRET_KEY"; <br/>const REDIRECT_URI = "http://localhost:3000/callback"; <br/>const CLIENT_ID = "2240e80398486d147c6a3e2e48e63b3d9a562497ad85bcd3300b7dda67eae42d"; const SCOPE = "wallet:user:read,wallet:user:email,wallet:accounts:read,wallet:transactions:read";</span></pre><p id="6225" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe ms mt mu mv b">router.get</code>中，它传入一个对象，该对象当前有一个值给<code class="fe ms mt mu mv b">title</code>。添加以下内容，以便它们被传入:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="144f" class="nc lw it mv b gy nd ne l nf ng">router.get('/', function(req, res, next) { <br/>  res.render('index', { <br/>    title: 'Express', <br/>    CLIENT_ID: CLIENT_ID, <br/>    REDIRECT_URI: REDIRECT_URI, <br/>    SECRET: SECRET, SCOPE: SCOPE, <br/>  }); <br/>});</span></pre><p id="43a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以更新按钮，使用按钮中的值。返回并打开views文件夹中的<code class="fe ms mt mu mv b">index.ejs</code>文件。将您的按钮更新为:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="ff16" class="nc lw it mv b gy nd ne l nf ng">&lt;a href="https://www.coinbase.com/oauth/authorize?response_type=code&amp;client_id=&lt;%= CLIENT_ID %&gt;&amp;redirect_uri=&lt;%= REDIRECT_URI %&gt;&amp;state=&lt;%= SECRET %&gt;&amp;scope=&lt;%= SCOPE %&gt;&amp;account=all" &gt; Connect with Coinbase &lt;/a&gt;</span></pre><p id="5aa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当您在浏览器中查看应用程序时，您应该会看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/fbd8e8cc561187d6a282a323540a9e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/0*v_hWDiECGESLFNo4"/></div></figure><p id="ec1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不太喜欢这个按钮的外观。给按钮添加一个<code class="fe ms mt mu mv b">class="btn"</code>。打开public/stylesheets目录中的文件<code class="fe ms mt mu mv b">style.css</code>。添加以下CSS:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="bac3" class="nc lw it mv b gy nd ne l nf ng">.btn { <br/>  width: 100%; <br/>  background: #2364d2; <br/>  border: none; <br/>  border-radius: 5px; <br/>  font-size: 16px; <br/>  font-weight: 500; <br/>  padding: 8px 15px; <br/>  font-family: "Source Sans Pro", sans-serif; <br/>  color: #fff; <br/>  cursor: pointer; <br/>  text-decoration: none; <br/>}</span></pre><p id="45c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们的按钮看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/0fc59772cb4ce42fc78dc6b5325eb3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/0*ETVbk64O5Bi7CPMJ"/></div></figure><p id="1d1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在点击按钮。你应该会看到一个登录你的比特币基地账户的屏幕</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/17380c7284d7d35498e0459355c36299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/0*novXk9TasY2Yr3ay"/></div></div></figure><p id="23fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输入您的比特币基地<code class="fe ms mt mu mv b">userid</code>和<code class="fe ms mt mu mv b">password</code>登录您的账户。登录后，您将看到一个选项，授权我们的应用程序访问您的帐户:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/eb6a46231d2c8c6f4705e7bfcb1efc94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/0*FLTF77a57gswRGWb"/></div></figure><p id="64f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您授权应用程序后，您将得到一个404错误页面。这是因为比特币基地重定向回重定向URI是<code class="fe ms mt mu mv b">http://localhost:3000/callback</code>。这就是你看到错误信息的原因。</p><h1 id="f1af" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">处理回拨路由</h1><p id="d431" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们回到比特币基地API文档。在授权您的应用程序之后，它要求您必须调用令牌端点来为用户获取新令牌。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/56d82421e130ea6688557fc5d3e4c0f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*noI_Ye40e0flsBXd"/></div></div></figure><p id="5824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当比特币基地调用我们的重定向URI时，我们将调用令牌端点。</p><p id="9340" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开routes目录中的<code class="fe ms mt mu mv b">index.js</code>文件。添加以下代码来处理回调路由:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="e5da" class="nc lw it mv b gy nd ne l nf ng">// User gets redirected to this endpoint on successful login router.get("/callback", async (req, res) =&gt; { <br/>  const { code, state } = req.query; <br/>  if (state === SECRET) { <br/>    const data = qs.stringify({ <br/>      'grant_type': 'authorization_code', <br/>      'code': code, <br/>      'client_id': CLIENT_ID, <br/>      'client_secret': CLIENT_SECRET, <br/>      'redirect_uri': REDIRECT_URI <br/>    }); <br/>    const config = { <br/>      method: 'post', <br/>      url: 'https://api.coinbase.com/oauth/token', <br/>      headers: { <br/>        'Content-Type': 'application/x-www-form-urlencoded' <br/>      }, <br/>      data <br/>    }; <br/>    try { <br/>      const response = await axios(config); <br/>      res.send({ response: response?.data }); <br/>    } catch (e) { <br/>      console.log("Could not trade code for tokens", e) <br/>    } <br/>  } <br/>});</span></pre><p id="703b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们浏览一下这段代码。</p><p id="d8db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的应用程序被授权后，比特币基地调用我们的重定向URI并传递给它两个查询参数——code和secret。我们把它们分解成变量。</p><p id="ec43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们最初调用比特币基地时，我们传递了一个返回给我们的秘密短语。这证明电话来自比特币基地。我们检查以确保返回的值是我们最初发送给比特币基地的值。</p><p id="4a05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将对发送到比特币基地的数据进行字符串化，以获取用户的令牌。我们将使用创建应用程序时安装的<code class="fe ms mt mu mv b">qs</code>包。在文件顶部添加以下行以导入它:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="cf6f" class="nc lw it mv b gy nd ne l nf ng">const qs = require('qs');</span></pre><p id="f55d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将字符串化的对象具有以下值:</p><ol class=""><li id="fcab" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated"><code class="fe ms mt mu mv b">grant_type</code>必须有值<code class="fe ms mt mu mv b">authorization_code</code>。</li><li id="ad29" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><code class="fe ms mt mu mv b">code</code>具有从查询参数中析构的代码值。</li><li id="bd33" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><code class="fe ms mt mu mv b">client_id</code>具有来自<code class="fe ms mt mu mv b">CLIENT_ID</code>变量的值。</li><li id="5879" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><code class="fe ms mt mu mv b">client_secret</code>具有来自<code class="fe ms mt mu mv b">CLIENT_SECRET</code>变量的值。该变量不存在，因此在变量中为其添加一个条目，并将其值设置为比特币基地应用程序中的<code class="fe ms mt mu mv b">CLIENT_SECRET</code>。</li><li id="35ff" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated"><code class="fe ms mt mu mv b">redirect_uri</code>具有来自<code class="fe ms mt mu mv b">REDIRECT_URI</code>变量的值。</li></ol><p id="af38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们创建一个将被传入axios的<code class="fe ms mt mu mv b">config</code>对象。我们将使用axios向比特币基地发出<code class="fe ms mt mu mv b">POST</code>呼叫，以获取令牌。我们还没有定义Axios，所以将其导入添加到文件顶部:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="c749" class="nc lw it mv b gy nd ne l nf ng">let axios = require('axios');</span></pre><p id="7a25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们将在浏览器中显示从比特币基地返回的内容，代码如下:</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="245d" class="nc lw it mv b gy nd ne l nf ng">res.send({ response: response?.data });</span></pre><p id="adab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们测试一切。打开浏览器，导航至URI <code class="fe ms mt mu mv b"><a class="ae ky" href="http://localhost:3000." rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code> <a class="ae ky" href="http://localhost:3000." rel="noopener ugc nofollow" target="_blank">。</a></p><p id="1dae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击按钮连接到比特币基地。如果需要，请登录。授权您的应用程序。您应该会在浏览器中看到一个与此类似的对象:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/951270e63bc5d8b4f17119da7e8b0cdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FWDXh6QaIVsPNM1l"/></div></div></figure><p id="4e21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有了一个访问令牌，可以在访问比特币基地API时使用它来获取这个帐户的信息。</p><h1 id="5e08" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">下一步是什么</h1><p id="46a8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在下一篇文章中，我们将详述我们迄今为止已经创建的内容。我们将探索比特币基地API来显示用户在其比特币基地帐户中拥有的所有加密令牌的列表。然后，我们将显示每个加密令牌的所有事务。点击这里查看下一篇文章。</p></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="1b85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ok">最初发表于</em><a class="ae ky" href="https://www.jenniferbland.com/access-coinbase-api-using-oauth2/" rel="noopener ugc nofollow" target="_blank"><em class="ok">https://www.jenniferbland.com</em></a></p></div></div>    
</body>
</html>