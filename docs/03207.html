<html>
<head>
<title>Electron Apps Are Getting Safer to Use</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电子应用使用起来越来越安全</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/2020-005-electron-apps-are-getting-faster-and-safer-3c045c39f61f?source=collection_archive---------8-----------------------#2020-01-28">https://betterprogramming.pub/2020-005-electron-apps-are-getting-faster-and-safer-3c045c39f61f?source=collection_archive---------8-----------------------#2020-01-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="55da" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">电子企业蓄势待发</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/33bec4e2b7f443cd47e58246282df1b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CkwYUkevWbjThZRrjN9Inw.png"/></div></div></figure><p id="f2ca" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><a class="ae lr" href="https://www.electronjs.org/" rel="noopener ugc nofollow" target="_blank">电子报</a>桌面应用程序是使用数百万软件开发人员所熟悉的技术创建的。这使得进入门槛很低，也是它的吸引力所在。</p><p id="c651" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">开始很容易。任何熟悉Node.js的人都可以自举一个<em class="ls"> Hello World！</em>简单易用的桌面应用。</p><p id="ad2e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当然还有另一个大的好处:相同的代码库可以同时用于Windows、Mac和Linux。所有这些加起来就是一个令人信服的案例，需要更仔细地研究。</p><p id="52ed" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">但是创建一个真正的电子应用程序并不适合胆小的人。改造那个最初的<em class="ls"> Hello World！快速安全地做某事需要努力。值得庆幸的是，安全性是2020年电子行业的大新闻。</em></p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="a714" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">2019年-转折的一年</h1><p id="52a3" class="pw-post-body-paragraph kv kw it kx b ky ms ju la lb mt jx ld le mu lg lh li mv lk ll lm mw lo lp lq im bi translated">过去一年发生了几件大事，使项目出现了拐点。去年的旅程经过了以下几个重要里程碑:</p><ul class=""><li id="042e" class="mx my it kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated">随着4.0版本开始迎接新的一年，5.0版本将于4月发布，6.0版本将于7月发布，7.0版本将于10月发布。</li><li id="90ec" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">今年3月，Electron采用了一种治理结构，正式制定了道路规则，并帮助更容易地取得进展。</li><li id="ee16" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">11月，Charles Kerr和他的团队公布了一个全新的<a class="ae lr" href="https://github.com/electron/build-tools" rel="noopener ugc nofollow" target="_blank">构建过程</a>，这大大缩短了当其依赖关系(Node.js、<a class="ae lr" href="https://v8.dev/" rel="noopener ugc nofollow" target="_blank"> V8 </a>和<a class="ae lr" href="https://www.npmjs.com/package/chromium" rel="noopener ugc nofollow" target="_blank"> Chromium </a>)发生变化时重建Electron所需的时间。</li><li id="ab18" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">12月，Electron作为一个孵化项目被加入到OpenJS Foundation中，向整个JavaScript社区表明这个项目将会继续存在。</li></ul><p id="21f8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">人们开始觉得，2014年的欢乐之旅已经变成了一段更有节奏的漫长旅程。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="0e4c" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">安全改进</h1><p id="599f" class="pw-post-body-paragraph kv kw it kx b ky ms ju la lb mt jx ld le mu lg lh li mv lk ll lm mw lo lp lq im bi translated">有些人知道，最近发布的勇敢浏览器开始作为一个实验性的电子项目。</p><p id="df33" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在认真尝试之后，勇敢的团队最终意识到，再多的锁定代码也无法让他们安全地访问可能包含恶意代码的任意URL。</p><p id="6fa6" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">对于electronic社区的其他人来说，教训很明显:使用electronic的嵌入式Chromium浏览器窗口只显示本地托管的页面。</p><p id="4e51" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">对于那些无法抵制访问远程URL诱惑的开发人员，建议有点复杂:确保网页有HTTP <a class="ae lr" href="https://rwserve.readwritetools.com/content-security-policy.blue?utm_term=NewsFrom2020CovalenceConf" rel="noopener ugc nofollow" target="_blank">内容安全策略</a>，限制通过不安全的渠道获取JavaScript。</p><p id="f9c8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">内容安全策略并不是每个开发人员技能的一部分，所以任何想要正确做到这一点的人都需要提前学习。</p><p id="706f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">最可怕的是，Electron的嵌入式Node.js库允许开发者完全访问桌面的文件系统和网络堆栈。这就是电子桌面应用程序与简单的浏览器应用程序的区别。</p><p id="2f34" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">因此，为了降低恶意代码横行的风险，开发人员可以为任何不需要Node.js的浏览器窗口启用<code class="fe nl nm nn no b">sandbox</code>选项。沙盒在主机操作系统级别上工作。这是锁定的大锤方法。</p><p id="2540" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">需要Node.js并决定关闭<code class="fe nl nm nn no b">sandbox</code>选项的开发人员仍然可以通过正确设置<code class="fe nl nm nn no b">nodeIntegration</code>选项来谨慎行事。</p><ul class=""><li id="32b6" class="mx my it kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated">当创建一个浏览器窗口来访问只使用本地托管资源(脚本、样式表、图像或字体)的本地托管文档时，可以安全地将<code class="fe nl nm nn no b">nodeIntegration</code>设置为<code class="fe nl nm nn no b">true</code>，允许Node.js库调用。</li><li id="6b29" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">另一方面，当创建可能访问任意远程URL的浏览器窗口时，<code class="fe nl nm nn no b">nodeIntegration</code>必须始终设置为<code class="fe nl nm nn no b">false</code>，阻塞Node.js库调用。</li></ul><p id="d689" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当在关闭<code class="fe nl nm nn no b">nodeIntegration</code>的浏览器窗口中仍然需要对Node.js的选择访问时，开发人员可以使用<code class="fe nl nm nn no b">preload script</code>。使用这种类型的架构，在创建浏览器窗口之前会执行一个单独的JavaScript模块。</p><p id="b125" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">该模块可以在浏览器窗口的整个生命周期内访问Node.js，并可以充当自定义的代理API。只要代理只传递简单的值，而不是Node.js对象，<code class="fe nl nm nn no b">preload script</code>就可以代表浏览器窗口安全地获取和设置文件系统和操作系统的值。</p><p id="22c9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为了在访问远程内容时更加安全，可以将<code class="fe nl nm nn no b">contextIsolation </code>选项设置为<code class="fe nl nm nn no b">true</code>。该选项将强制为每个浏览器窗口创建一个单独的JavaScript世界。</p><p id="3ee7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">上下文隔离可以防止坏人在不受信任的浏览器窗口中摆弄JavaScript的原型链，以便在同级浏览器窗口中偷偷获取对受信任代码的控制。</p><p id="c0b8" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">刚刚开始使用Electron的开发人员可能没有充分认识到这些选项的重要性，并且可能在匆忙获得工作原型时不经意地做出了糟糕的选择。</p><p id="5c92" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为了帮助解决这个问题，Doyensec的Luca Carettoni创造了一个开源工具，它有一个充满双关语的名字——“T5”电负性。可以把它想象成一个安全审计工具。它通过扫描项目的HTML DOM和JavaScript AST来寻找潜在的漏洞。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="aa9a" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">反对“远程”的奇怪提议</h1><p id="137c" class="pw-post-body-paragraph kv kw it kx b ky ms ju la lb mt jx ld le mu lg lh li mv lk ll lm mw lo lp lq im bi translated">electronic是一个开源项目，与许多类似的项目不同，它没有大的企业赞助。工作是由分散在全球各地的开发人员执行的，他们从事的项目有着非常不同的目标。因此，贡献者关注不同的需求也就不足为奇了。</p><p id="331c" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">谢天谢地，其中一个需求是更好的性能。为此，在最近的2020年共价会议上，宣布在电子版本9.0中将弃用常用的<code class="fe nl nm nn no b">remote</code>模块，并在版本10.0中完全删除。</p><p id="61d7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这是一个惊喜。不知何故，我没有看到杰里米·阿普索普以前发表的文章<a class="ae lr" href="https://medium.com/@nornagon/electrons-remote-module-considered-harmful-70d69500f31" rel="noopener">电子公司的“远程”模块被认为是有害的</a>。</p><p id="d814" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为了理解这一点的含义，新来者需要理解电子应用具有分裂的个性。</p><p id="52a5" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">一边是应用程序的主进程，它负责启动一切。另一边是应用程序的<em class="ls">呈现器</em>进程。两者使用进程间通信(IPC)进行通信。</p><p id="bc3f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">掌握电子发展的关键是懂得如何利用<code class="fe nl nm nn no b">ipcMain</code>和<code class="fe nl nm nn no b">ipcRenderer</code>来协调一切。这就是远程模块派上用场的地方。它使得从渲染器进程到主进程的IPC调用变得超级简单，允许普通人完成更多工作。</p><p id="3766" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在我参与的所有电子应用程序中，<code class="fe nl nm nn no b">remote.getGlobal()</code>被战略性地有效使用。每次都像预期的那样起作用。</p><p id="2ce9" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">诽谤<code class="fe nl nm nn no b">remote</code>背后的原因，以及我自己的反驳观点是:</p><ul class=""><li id="07c5" class="mx my it kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated"><em class="ls">论据:</em>每次IPC调用需要0.1ms。<em class="ls">对位:</em>这是花生。在一眨眼的时间里(以每屏幕刷新16毫秒的帧速率)，可以进行160次IPC调用。</li><li id="9cd5" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><em class="ls">论据:</em>使用不当会导致竞态条件。<em class="ls"> Counterpoint: </em>在执行之前设置回调监听器消除了这类问题。</li><li id="399d" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><em class="ls">论点:</em>远程对象被代理，失去了它们的原型链。<em class="ls"> Counterpoint: </em>适当的反序列化和向正确对象类型的转换允许结果被使用而不会出现意外。</li><li id="35ce" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated"><em class="ls">论点:</em>这是一个等待发生的安全漏洞。这不是一个密切相关的论点。来自主进程的PNG图像可能已经部署了它们的恶意负载，而不管任何IPC调用。</li></ul><p id="13fb" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我个人认为这是对性能的过分追求，我希望不要执行弃用<code class="fe nl nm nn no b">remote</code>模块的计划。尽管如此，我还是很欣赏对细节的关注。很高兴知道电子性能调整已经达到0.1毫秒被视为重要的水平。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="7244" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">为企业做好准备</h1><p id="1af5" class="pw-post-body-paragraph kv kw it kx b ky ms ju la lb mt jx ld le mu lg lh li mv lk ll lm mw lo lp lq im bi translated">在今年的会议上，我注意到一个趋势，那就是在企业桌面应用程序中使用电子，尤其是那些针对Windows用户的应用程序。</p><p id="a561" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在围绕电子公司跨平台能力的所有喧嚣中，人们忽略了一点，那就是<em class="ls">你不必把三者都作为目标。</em></p><p id="b206" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我在会议上与许多人交谈过，他们明确地限制他们的开发工作来为Windows用户进行优化。ChartIQ的Terry Thorsen很好地展示了这个案例。</p><p id="e240" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">C++程序员越来越稀缺，这已经不是秘密了。JavaScript优先开发者的崛起同样显而易见。因此，毫不奇怪，电子公司准备给微软一个机会。</p><p id="67da" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">寻找具有华丽风格的新面孔的老MFC应用程序是用电子重写的特别好的候选者。我打赌C#和Visual Basic也会受到冲击。</p><p id="6589" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">但是要真正实现这一点，电子社区需要开始直接向企业用户征求反馈，并把他们的需求放在路线图上。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="d3dc" class="ma mb it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">2020年的路线图</h1><p id="1d32" class="pw-post-body-paragraph kv kw it kx b ky ms ju la lb mt jx ld le mu lg lh li mv lk ll lm mw lo lp lq im bi translated">我还没有看到2020年及以后的路线图，但如果保持去年的发布节奏，我们可以期待在未来12个月内看到8、9、10和11版本。</p><p id="6dd2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我的个人愿望清单包括:</p><ul class=""><li id="8266" class="mx my it kx b ky kz lb lc le mz li na lm nb lq nc nd ne nf bi translated">对进程间通信(IPC)更好的应用层支持。由于我们不能使用事件或回调来跨越主/呈现器的界限，每个电子应用程序的很大一部分都在处理传递数据的脚手架。目前每个人都有自己的卷。</li><li id="fd9f" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">更好地支持应用程序级变量。因为渲染器需要获取和设置应用程序状态，所以拥有一些主进程和独立渲染器都可以访问的专用状态对象是有意义的。目前这都是用<code class="fe nl nm nn no b">remote.getGlobal()</code>完成的。它很简单，但能完成工作，但我会投票给更复杂的东西。</li><li id="8101" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">摇树。电子应用程序充斥着永远不会被调用的代码。最终的<code class="fe nl nm nn no b">asar</code>构建过程中一个受欢迎的附加步骤是分析哪些文件可以丢弃。我意识到这可能是一个耗时的过程，但就我而言，我会毫无怨言地使用它。</li><li id="4165" class="mx my it kx b ky ng lb nh le ni li nj lm nk lq nc nd ne nf bi translated">电子线头工具。随着项目的发展，会发现更好的做事方法，旧的方法会被淘汰。拥有一个工具来扫描我们的应用程序，并使用这些新功能提出改进方法，将使每个人的应用程序更快、更安全。</li></ul></div></div>    
</body>
</html>