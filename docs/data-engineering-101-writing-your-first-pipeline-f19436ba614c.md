# 数据工程 101:编写你的第一个管道

> 原文：<https://betterprogramming.pub/data-engineering-101-writing-your-first-pipeline-f19436ba614c>

## 在气流和路易吉

![](img/19bd84578e15f57f580f6941e6eefde5.png)

迈克·本纳在 [Unsplash](https://unsplash.com/s/photos/pipeline?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

数据工程师的主要角色之一可以概括为从 A 点到 b 点获取数据。

我们经常需要将数据从一个系统中取出并插入到另一个系统中。这可以用于各种目的。这包括分析、集成和机器学习。

但是为了让数据移动，我们需要使用 ETLs 数据管道。

这些是将数据从一个数据系统传输到另一个数据系统的过程。

作为数据工程师，我们需要回答的一个问题是，我们需要多久更新一次这些数据。这就是关于批处理和流的问题发挥作用的地方。这是现有的两种主要类型的 ETL/ELT。

# 批处理与流

很长一段时间以来，几乎每个数据管道都是我们所认为的批处理管道。这意味着管道通常每天、每小时、每周等运行一次。有一些特定的时间间隔，但数据不是实时的。

批处理作业指的是以块或批的形式加载数据，而不是立即加载。因此，术语“批处理作业”指的是成批加载数据。

与流数据相比，新的一行一旦被添加到应用程序数据库中，它就被传递到分析系统中。

这通常使用各种形式的发布/订阅或事件总线类型的模型来完成。所有这些系统都允许交易数据在交易一发生就被传递。

有些人可能会问，为什么我们不把流媒体用于所有事情。一直有活数据不是更好吗？

在某些方面，这是真的。但通常创建流媒体系统在技术上更具挑战性，维护起来也很困难。

尽管以正常间隔运行的批处理作业可能会失败，但它们不需要立即修复，因为它们在再次运行之前通常有几个小时或几天的时间。

相比之下，流媒体系统是实时的。故障和错误需要尽快修复。

现在，我们将专注于开发传统上更多的批处理作业。

除了为您的 ETL 选择总体范例，您还需要决定您的 ETL 工具。

# ETL 工具选项

如果您只想进入编码部分，请随意跳到下面的部分。

但是，如果不参考您的数据团队必须使用的一些选项，我们就不能在开发数据管道方面走得太远。

有大量的数据管道和工作流自动化工具。

让我们把它们分成两个具体的选项。

拖放与框架。

拖放选项让你几乎对代码一无所知——就像 SSIS 和 Informatica 一样。

对于几乎不需要实现定制代码的人来说，这是非常好的。

尽管这些工具中的许多都提供了自定义代码，但这有点违背了初衷。

如果您的团队能够编写代码，我们发现使用框架编写管道更有益，因为它们通常允许更好的调优。尽管 Informatica 非常强大，并且只要您能支付费用，它就能做很多繁重的工作。

即便如此，许多人的 ETL 还是依赖于基于代码的框架(一些公司如 Airbnb 和 Spotify 已经开发了自己的框架)。

这些框架通常用 Python 实现，被称为[气流和 Luigi](https://www.theseattledataguy.com/airbnbs-airflow-versus-spotifys-luigi/) 。这两个框架都可以用作工作流，并提供各种好处。

但是现在，让我们看看在 Airflow 和 Luigi 中构建一个基本的管道是什么样子的。

在后面的帖子中，我们将更多地讨论设计。但是现在，我们只是演示如何编写 ETL 管道。

# 气流中的管道

为了在气流中制作管道，需要设置几个特定的配置。

有一组您想要设置的参数，然后您还需要调用您使用这些默认参数创建的实际 DAG。

请参见下面的配置。

这只是你的匕首的底部。

您可以设置运行实际数据管道的频率，例如，如果您想每天运行您的计划，那么可以使用以下代码参数。比如可以用`schedule_interval=’@daily’`。或者可以用 cron 代替，像这样:`schedule_interval=’0 0 * * *’`。

一旦您设置了您的基线配置，那么您就可以开始组合气流的操作符了。

操作员本质上是你想要完成的孤立的任务。这可能是提取数据、移动文件、运行一些数据转换等。

例如，如果你看下面，我们正在使用几个操作符。其中包括 PythonOperator 和 BashOperator。

这允许您在 Python 或 bash 中运行命令，并在所述任务之间创建依赖关系。

我们在气流管道上做得更深入一些。但这是它的主旨。

您可以继续创建更多的任务或开发抽象来帮助管理管道的复杂性。但是气流操作符的上述用法是一个很好的介绍。

现在轮到路易吉了。

# 路易吉的管道

Luigi 是另一个可以用来开发管道的工作流框架。在某些方面，我们发现它更简单，而在其他方面，它可以很快变得更复杂。

我们个人认为 Luigi 更简单的原因是因为它将主要任务分成了三个主要步骤。

这些可以在 Luigi 定义的“任务”中看到。

## 工作

在 Luigi 任务中，最常用的三类函数是 requires()、run()和 output()。

Luigi 中的这些函数分别做什么？

requires()类似于气流中的依赖关系。

您实际上是在引用以前的任务类、文件输出或其他输出。

例如:

在这种情况下，requires 函数正在等待一个文件到达。

但是它也可以等待任务完成或其他输出。

不是每个任务都需要 requires 函数。但是它可以用来引用需要完成才能开始当前任务的前一个任务。

但是任务确实需要 run()函数。run()函数本质上是实际的任务本身。你想做什么？

例如:

任务的输出是一个目标，它可以是本地文件系统上的一个文件，Amazon S3 上的一个文件，数据库中的一些数据，等等。

您可以看到这两个管道框架之间的细微差别。气流被包在一个特定的运营商，而 Luigi 是作为一个更大的类开发的。

最终，这种微小的差异会导致您的管道中出现大量的设计变更。

# 那你选哪个？

就个人而言，由于社区更大，我们喜欢气流。然而，在很多方面，Luigi 可以有一个稍微低一点的门槛，只要它能解决问题。没有很多不同的运算符可以使用。相反，你决定每个任务真正做什么。

这可以为设计和开发提供更多的自由和更多的思考。

所以最终，你将不得不选择你想要处理的事情。不管你选择什么样的框架，你的代码中总会有 bug。

祝你好运，感谢你的阅读！