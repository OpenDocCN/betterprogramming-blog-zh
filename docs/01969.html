<html>
<head>
<title>How To Add a Health Check to Your Node.js App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何向Node.js应用程序添加运行状况检查</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-add-a-health-check-to-your-node-js-app-5154d13b969e?source=collection_archive---------0-----------------------#2019-10-28">https://betterprogramming.pub/how-to-add-a-health-check-to-your-node-js-app-5154d13b969e?source=collection_archive---------0-----------------------#2019-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="49dc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">无需深入研究代码，即可查看您的应用是否正在运行</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/24899f897e5b5629ddc60d5820379b47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ruQwlYBMeaG_e-oN"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@anikolleshi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ani Kolleshi </a>拍照</p></figure><p id="c068" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着越来越多的用户使用你的软件，对软件可用性的责任也越来越大。让我们看看为什么我们需要软件的高可用性。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ca76" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么我们需要软件的高可用性</h1><ul class=""><li id="945d" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">在SLA中，您通常指定您应该保持的有保证的可用性(例如99.9%)。</li><li id="c81b" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">对于B2C应用程序(例如网上商店)，<a class="ae ky" href="https://venturebeat.com/2013/08/16/3-minute-outage-costs-google-545000-in-revenue/" rel="noopener ugc nofollow" target="_blank">宕机可能意味着高额的财务损失</a>。</li><li id="7b5b" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">除了财务影响，意外停机还会损害您的声誉。</li></ul><p id="cf7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们已经理解了为什么我们需要高可用性，我们就来看看可能导致高可用性的常见问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="4a47" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">可用性如何受到负面影响</h1><ul class=""><li id="a3a7" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">软件中妨碍应用程序正常工作的关键问题(例如，与数据库的连接失败)。</li><li id="405b" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">第三方基础设施问题(例如，您的云提供商意外停机)。</li></ul><p id="68b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">显然，我们应该对确保我们的应用程序可用和健康非常感兴趣。</p><p id="e764" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题是:“您的应用程序何时真正健康？”因为健康的定义对你来说意味着什么，这可能很难说出口，也很难实现。这是你需要自己定义的东西。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2cbc" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何定义应用程序的健康状况</h1><ul class=""><li id="96eb" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">服务器可以响应请求。</li><li id="abbb" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">服务器可以响应请求并连接到数据库。</li><li id="03d9" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">服务器可以响应请求，可以连接到数据库，可以连接到其他第三方系统和集成。</li></ul><p id="f68c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">API测试可用于调用您的健康检查端点。然而，有专门的服务，如<a class="ae ky" href="https://www.pingdom.com/" rel="noopener ugc nofollow" target="_blank"> Pingdom </a>、<a class="ae ky" href="https://newrelic.com/" rel="noopener ugc nofollow" target="_blank"> New Relic </a>和<a class="ae ky" href="https://www.freshworks.com/website-monitoring/" rel="noopener ugc nofollow" target="_blank"> Freshping </a>可以持续监控网站和服务器的可用性。</p><p id="d162" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些工具提供的常见数据和功能:</p><ul class=""><li id="8d21" class="mu mv it lb b lc ld lf lg li nk lm nl lq nm lu nb nc nd ne bi translated">可用性。</li><li id="725c" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">停工期。</li><li id="6ffc" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">事故数量。</li><li id="a956" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">平均响应时间(通常以毫秒为单位)。</li><li id="a6f8" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">过去事件的总结。</li><li id="12b6" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">选择显示相关数据的时间范围。</li><li id="3bea" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">与其他流行软件工具的集成:Slack、<a class="ae ky" href="https://www.atlassian.com/software/jira" rel="noopener ugc nofollow" target="_blank">吉拉</a>、<a class="ae ky" href="https://www.pagerduty.com/" rel="noopener ugc nofollow" target="_blank">page duty</a>等。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6189" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么在软件项目中使用健康检查？</h1><ul class=""><li id="5548" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nb nc nd ne bi translated">健康检查很容易实施。如上所述，你必须定义健康对你意味着什么。</li><li id="1c4a" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">无停机部署。例如，<a class="ae ky" href="https://render.com/docs/zero-downtime-deploys" rel="noopener ugc nofollow" target="_blank">渲染</a>平台会在部署应用程序时自动调用健康检查路径。</li><li id="7a4b" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">一旦发生停机，立即检测出来。有很多免费和付费的工具提供连续的正常运行时间监控:Pingdom、New Relic和Freshping。</li><li id="c84b" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">健康检查在出现问题时提供健全性检查。如果您有<a class="ae ky" href="https://www.pagerduty.com/resources/learn/call-rotations-schedules/" rel="noopener ugc nofollow" target="_blank">随叫随到的职责</a>并且出现了问题(例如，一个实例出现故障)，检查服务的健康状况是第一件也是最容易的事情，无需深入实际代码。因此，即使是最基本的健康检查也提供了一些价值。</li></ul><p id="9af0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将使用Node.js的流行框架<a class="ae ky" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>，但是，如果您使用其他框架或其他编程语言，如C#、Java或Python，步骤是相似的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="fc17" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何向Node.js应用程序添加健康检查</h1><ol class=""><li id="effa" class="mu mv it lb b lc mw lf mx li my lm mz lq na lu nn nc nd ne bi translated">创建新路线(例如<code class="fe no np nq nr b">healthcheck.routes.js</code>)。</li><li id="d1fd" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nn nc nd ne bi translated">在<code class="fe no np nq nr b">app.js</code>中注册您的路线。我建议给这条路线命名为<code class="fe no np nq nr b">healthcheck</code>。</li><li id="2617" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nn nc nd ne bi translated">在您的<code class="fe no np nq nr b">healthcheck</code>路线中，如果一切正常，您需要发送一个成功响应，如果您的应用程序不健康，您需要发送一个错误响应。</li><li id="39f9" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nn nc nd ne bi translated">如果您有多个微服务，您应该为每个微服务添加运行状况检查。</li><li id="6873" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nn nc nd ne bi translated">可选:添加验证以限制对您的健康检查路线的访问(例如，使用<a class="ae ky" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"> JWT </a>)。</li><li id="116b" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nn nc nd ne bi translated">可选:添加调用此新路由的API测试。</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="44fb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">工具如何使用健康检查，以及它们如何支持我们</h1><p id="4f0d" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">在本教程中，我将使用刷新来监控托管API的健康状况。下面的报告显示了2019年10月的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/0f0b5dc1789752408f86efb97fcc01af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LzQwLSvv8n21-Ov5Cx_CjQ.png"/></div></div></figure><p id="5ba4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们更详细地看看这份报告:</p><ul class=""><li id="7f53" class="mu mv it lb b lc ld lf lg li nk lm nl lq nm lu nb nc nd ne bi translated">在选定的时间段内，可用性为96.58%。通常，您的目标应该是至少99%的可用性。许多软件供应商承诺至少99.90%的可用性，尤其是对企业客户而言。</li><li id="70f7" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">乍一看，96.58%的可用性听起来相当不错，但是您必须注意停机时间:几乎19个小时的连续停机时间对您的业务非常不利。因此，在事故发生时尽早得到通知非常重要，这样您就可以快速解决问题。</li><li id="ba91" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">在选定的时间段内发生了一起事故。当然，你应该尽可能地保持这个数字。万一发生事故，应尽快解决，以最大限度地减少影响。</li><li id="2ee2" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">平均响应时间为539毫秒，相当一致。这种一致性是一个好迹象，因为它意味着我们的运行状况检查工作可靠。</li><li id="1caa" class="mu mv it lb b lc nf lf ng li nh lm ni lq nj lu nb nc nd ne bi translated">虽然平均响应时间还不错，但也不是很快，因为您应该尽可能缩短响应时间。这可能表明确定应用程序的健康状态涉及太多的步骤。另一方面，这可能只是基础设施的问题(例如，服务器离客户端太远，或者硬件不够强大)。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7bae" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="b60d" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">感谢阅读这篇文章。如您所见，向Node.js应用程序添加健康检查很容易。</p><p id="cee4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，如果您使用其他编程语言编写服务器端代码，您也可以(并且应该)添加健康检查。像Pingdom或Freshping这样的工具可以定期检查我们的应用程序的健康状况，并帮助我们尽早发现问题。</p><p id="718c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您如何实施健康检查，使用什么工具？</p></div></div>    
</body>
</html>