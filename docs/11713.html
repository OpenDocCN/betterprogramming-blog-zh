<html>
<head>
<title>How to Format All Possible Errors From API Calls in Android With Clean Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用干净的架构格式化Android中所有API调用可能出现的错误</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-format-all-possible-errors-from-api-call-in-android-with-clean-architecture-b435fbd00b0a?source=collection_archive---------6-----------------------#2022-04-11">https://betterprogramming.pub/how-to-format-all-possible-errors-from-api-call-in-android-with-clean-architecture-b435fbd00b0a?source=collection_archive---------6-----------------------#2022-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5076" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">最大限度减少应用崩溃</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/38d5bb655e4105739a184baa43e25811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TUitcmPxOPrxAMOrIK_mZQ.jpeg"/></div></div></figure><p id="8cdc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在Android中执行API调用不仅仅是检查互联网连接。虽然有几个流行的开源库可用，如several和凌空，这有助于简化这些操作和错误处理。但是重要的是，您能够格式化库在这些API调用失败时抛出的所有可能的错误。</p><p id="90f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文将向您展示如何处理在进行API调用时可能抛出的所有错误类型，以防止您的应用程序崩溃。在本次演示中，我将使用以下工具:</p><ol class=""><li id="3049" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><a class="ae lw" href="https://developer.android.com/kotlin/flow" rel="noopener ugc nofollow" target="_blank">协程流程</a></li><li id="a886" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://developer.android.com/training/dependency-injection/hilt-android" rel="noopener ugc nofollow" target="_blank">带句柄的依赖注入</a></li><li id="054d" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://developer.android.com/training/data-storage/room" rel="noopener ugc nofollow" target="_blank">房间</a>和</li><li id="44d2" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm ls lt lu lv bi translated"><a class="ae lw" href="https://github.com/skydoves/sandwich" rel="noopener ugc nofollow" target="_blank">天鸽</a></li></ol><p id="63c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">依赖集成:</strong></p><p id="7d64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将以下依赖项添加到您的<code class="fe mc md me mf b">build.gradle</code>文件(应用程序模块):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="b1ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在插件中配置你的手柄来使用<code class="fe mc md me mf b">kapt</code>和你的<code class="fe mc md me mf b">build.gradle</code>(项目模块)。你可以使用我上面贴的链接做到这一点。请不要忘记添加改造的依赖项和您可能在项目中使用的其他库。</p><p id="e0b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">创建数据类:</strong></p><p id="8169" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于这个示例，我将使用天气响应数据，只是为了显示不同位置的天气状况列表。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="7bdc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">创建一个接口</strong></p><p id="0dce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">复制并粘贴下面的代码，向天气API发出请求。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="7c67" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:我使用<code class="fe mc md me mf b">ApiResponse</code>作为<code class="fe mc md me mf b">weatherRemoteEntity</code>数据类的包装器，而不是改造中的普通调用，这将使您能够格式化调用该API可能产生的所有可能的响应。</p><p id="8349" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">配置改装生成器:</strong></p><p id="95ec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了从改造服务中获取数据源，我们将向改造构建器添加一个<code class="fe mc md me mf b">CallAdapterFactory</code>。因此，将下面的代码添加到您的改造建设者。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="e2df" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">创建数据状态:</strong></p><p id="dc25" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建一个数据状态密封类，用于处理不同的状态和响应发出。(可选)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="8b87" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">创建存储库类:</strong></p><p id="53f7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是我们将要做的所有错误格式化和发送数据到<code class="fe mc md me mf b">ViewModel</code>的地方，以便在活动中显示。下面是我们的存储库的样子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="f244" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Sandwich使您能够从改进的网络响应中构建标准化接口，这允许您处理主体数据、错误和异常情况，显然是在多层架构中使用有用的运算符。</p><p id="e2a8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mc md me mf b">ApiResponse</code>有三种主要类型；<code class="fe mc md me mf b">Success</code>、<code class="fe mc md me mf b">Failure.Error</code>和<code class="fe mc md me mf b">Failure.Exception</code>。</p><ul class=""><li id="1000" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm mi lt lu lv bi translated"><code class="fe mc md me mf b">ApiResponse</code>。成功—这表示网络请求已经成功。您可以从<code class="fe mc md me mf b"><strong class="kt ir">ApiResponse.Success</strong></code>中获得响应的主体数据，以及其他信息，如<code class="fe mc md me mf b"><strong class="kt ir">StatusCode</strong></code>、<code class="fe mc md me mf b"><strong class="kt ir">Headers</strong></code>等。</li><li id="054b" class="ln lo iq kt b ku lx kx ly la lz le ma li mb lm mi lt lu lv bi translated"><code class="fe mc md me mf b">ApiResponse.Failure.Error </code> —这表示网络请求因错误请求或内部服务器错误而失败。您可以从<code class="fe mc md me mf b">ApiResponse.Failure.Error</code>获得一条错误消息和附加信息，如<code class="fe mc md me mf b">StatusCode</code>、<code class="fe mc md me mf b">Headers</code>等。这几乎涵盖了所有可能抛出的服务器响应。这样您就可以检查错误响应并适当地格式化它们。下面是他们的列表。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><ul class=""><li id="9399" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm mi lt lu lv bi translated"><code class="fe mc md me mf b">ApiResponse.Failure.Exception</code> —表示创建请求或处理客户端响应时出现意外异常，如网络连接失败，网络请求失败。您可以从<code class="fe mc md me mf b"><strong class="kt ir">ApiResponse.Failure.Exception</strong></code> <strong class="kt ir"> </strong>中获得一条异常消息，并适当格式化以避免应用程序崩溃并显示合适的消息。</li></ul><p id="d7cd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，除了我上面演示的格式之外，还可以用其他不同的方式使用skydoves库来实现API响应的平滑错误格式化和处理。你可以看看下面的链接。</p><div class="mj mk gp gr ml mm"><a href="https://github.com/skydoves/sandwich" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd ir gy z fp mr fr fs ms fu fw ip bi translated">GitHub-sky doves/三明治:🥪一个轻量级的密封API库，用于建模改造响应和…</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">发明三明治是为了从改造网络响应中构造标准化接口。三明治让你…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">github.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na kp mm"/></div></div></a></div><p id="8ec7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面也是天气app完整实现的附件，可以随意克隆看看。</p><div class="mj mk gp gr ml mm"><a href="https://github.com/sunday58/TopupMama" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd ir gy z fp mr fr fs ms fu fw ip bi translated">GitHub - sunday58/TopupMama:一个用Kotlin构建的带有最喜欢的位置选择的天气应用程序</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">github.com</p></div></div><div class="mv l"><div class="nb l mx my mz mv na kp mm"/></div></div></a></div><p id="1d00" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢阅读，编码快乐。</p></div></div>    
</body>
</html>