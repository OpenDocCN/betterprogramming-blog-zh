<html>
<head>
<title>What Not to Do When Writing E2E Tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写E2E测试时不要做什么</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/what-not-to-do-when-writing-e2e-tests-ef7b9d09cc81?source=collection_archive---------9-----------------------#2019-08-12">https://betterprogramming.pub/what-not-to-do-when-writing-e2e-tests-ef7b9d09cc81?source=collection_archive---------9-----------------------#2019-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cffd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">避免这些陷阱将帮助您有效地应用端到端测试</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cf19cda74414cbf057aadd5d08c225bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*grWC2pjKHdQJgmw0uz6gZQ.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">弗雷德里克·图比尔蒙特在<a class="ae ky" href="https://unsplash.com/search/photos/end?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="21b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近合作为<a class="ae ky" href="https://www.esri.com/en-us/arcgis/products/arcgis-hub/overview" rel="noopener ugc nofollow" target="_blank"> ArcGIS Hub </a>编写了一个新的端到端(E2E)测试套件。</p><p id="8452" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我来定义一下我在说什么。E2E测试通常采用在实时系统上运行的自动化GUI测试的形式。</p><p id="122b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在web环境中，端到端的测试运行人员经常远程自动化浏览器。这意味着经典的单元测试工具——模仿、存根、访问内部状态等。—通常不可用。</p><p id="8112" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这使得端到端测试非常高保真，但也引入了潜在的陷阱。这是我的建议。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="58f1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">没有明确原因就不要写</strong></h1><p id="3f03" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你为什么要写这些测试？在本文<a class="ae ky" href="https://prism.ucalgary.ca/bitstream/handle/1880/49989/2014-1057-08.pdf?sequence=1&amp;isAllowed=y" rel="noopener ugc nofollow" target="_blank">中，研究人员确定了开发人员编写这些和其他GUI测试的两个主要原因:</a></p><ol class=""><li id="f85b" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">自动化验收测试(客户期望的封装)。</li><li id="df53" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">自动化回归测试(防止回归错误)。</li></ol><p id="7f01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哪一个适合你？还是完全是另一个原因？</p><p id="9f2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">阐明你的目标，并确保你的团队在这一点上意见一致。这确保了每个人都确切地理解这些测试的目的和价值。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3f64" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">不要重复覆盖</strong></h1><p id="b63f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设您已经创建了一个新的UI组件。如果你能在一个单元测试中涵盖功能(或者你的特定框架称之为什么)，就在那里做吧！</p><p id="c3a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的CI管道中运行单元测试通常更容易维护，不那么古怪，也不那么昂贵。</p><p id="7340" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">E2E测试应该只覆盖他们能覆盖的区域。通常，这些是跨越许多组件和视图的大图用户故事。我们谈论的是大的、高价值的流动，比如:</p><ul class=""><li id="cff2" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu nn nf ng nh bi translated">报名。</li><li id="dbb9" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">登录和退出。</li><li id="4bab" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">创建新的<whatever users="" create="" in="" your="" app="">并共享它。</whatever></li><li id="5073" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">更新用户的配置文件信息。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="026c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">不要使用单层架构</strong></h1><p id="21f9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在web环境中，单层E2E测试架构应该是这样的(所以这是应该避免的):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/ff49f3daa56a12f12cbe5ae0bbadf14d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oYt6pK8yqbwecjFGcRYOAw.png"/></div></div></figure><p id="1260" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您为您的E2E测试套件使用单层架构，您将会陷入痛苦的世界。</p><p id="93fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，你(和其他人)会发现:</p><ul class=""><li id="3422" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu nn nf ng nh bi translated">测试难以理解，因此难以调试。混合高层次和低层次的逻辑会在测试中引入太多的细节。</li><li id="07c0" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">相对不重要的UI更改会破坏大量测试。这是因为逻辑和HTML选择器将被大量复制，产生多个故障点<em class="np">。</em></li><li id="2e5f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">当UI改变时，测试套件的大部分需要更新。<strong class="lb iu"> </strong>这与前一点相吻合。</li><li id="f0cf" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">您将无法重用部分测试逻辑。这将产生额外的努力和麻烦。</li><li id="4de8" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu nn nf ng nh bi translated">我的声音可能会突然出现在你的脑海里…嘲笑你的痛苦。</li></ul><p id="35c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，使用多层架构，允许测试本身成为用户故事的可理解的表达。隐藏中介层中特定于区域的逻辑和选择器。</p><p id="0bd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，我推荐使用页面对象模型。参见马丁·福勒的文章<a class="ae ky" href="https://martinfowler.com/bliki/PageObject.html" rel="noopener ugc nofollow" target="_blank">了解更多信息。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="47c1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">不要使用易碎的选择器</h1><p id="a988" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这一节专门针对我的专业，web开发，但是使用健壮的方法来获得正确的UI元素的原则总是适用的。</p><p id="b0bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在web环境中，有几种方法可以找到特定的元素，并且它们都不会受到UI变化的影响。</p><p id="d357" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我按照断裂能力的顺序来评价它们。</p><ol class=""><li id="baa4" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">CSS选择器(例如<code class="fe nq nr ns nt b">.sign-in-btn</code>)。类很容易改变，所以它们很容易被打破。</li><li id="4acb" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nq nr ns nt b">:nth-child()</code>选择器。在同一层次级别的元素的排序似乎服从于重新排序。此外，这些选择器通常是非描述性的，使得来自测试运行程序的错误消息更难理解。</li><li id="b180" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">范围选择器(例如<code class="fe nq nr ns nt b">.img-view .container .img-wrapper img</code>)。与前两个相比，这一个似乎不太可能改变，因为元素层次结构更加不可变。然而，这一个也通常与CSS选择器混合。</li><li id="5f55" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">ID选择器(例如<code class="fe nq nr ns nt b">#thumbnail</code>)。似乎id几乎从不改变，但它们可以。也可能有其他原因避免将它们添加到元素中，例如如果您使用的UI框架在内部插入并依赖它们。</li><li id="7f7b" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><code class="fe nq nr ns nt b">data-test=”some-unique-slug”</code>属性。这是添加到目标元素的一个属性，只是为了给测试一个句柄。它可以是你想要的描述性的，只要值是唯一的，测试就能找到它。它完全不受布局、ID、样式甚至元素类型变化的影响。此外，大多数开发商/UX人知道不要惹它。这个是银弹。</li></ol><p id="5b23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不打算宣扬反对CSS选择器的地狱火。选择信任哪个选择器取决于你自己。</p><p id="19b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果由我决定，我每次都会选择<code class="fe nq nr ns nt b">data-test</code>属性。当我的E2E测试失败时，我不希望是因为风格的改变。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c6d5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated"><strong class="ak">不要指望你的套房是免维护的</strong></h1><p id="4238" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当你创建一个E2E测试套件时，它会成为你的应用程序用户界面的反映。</p><p id="c966" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在接下来的一年中，用户界面多久会改变一次？没错。一直都是。因此，反射必须随之发展。您和您的团队需要接受端到端测试的事实。</p><p id="a251" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">否则，您可能会发现自己与测试套件处于对立的关系中。这将导致他们变得古怪、讨厌和被忽视。如果你允许那种情况发生，你将会浪费你的努力！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f483" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">不要忽视不可靠的测试</h1><p id="b5a5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一般来说，开发人员倾向于首先责怪测试，然后责怪他们的更改。</p><p id="87da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我注意到这在端到端测试的环境中更加明显。此外，由于E2E测试依赖于实时的外部系统，因此需要额外的努力来确保它们不会因为网络条件、外部服务的当前负载等不确定因素而随机失败。</p><p id="c8cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">努力是值得的。如果测试过于古怪，开发人员就不会信任它们。他们就是不会。这些测试将变得令人讨厌，而不是有益的。</p><p id="b07d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个薄片测试是不同的。测试可能需要等待更长时间来加载一个视图，或者它可能需要其他东西。不管怎样，我的建议是要么支持它，要么移除它。不要把它留在那里玷污套房的声誉。</p><p id="2d08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向仪表板界面自动报告基本遥测数据，如运行长度和失败/成功，有助于识别测试问题。我们用橡皮筋的<a class="ae ky" href="https://www.elastic.co/products/kibana" rel="noopener ugc nofollow" target="_blank">基巴纳</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="46cf" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="0f27" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">端对端测试作为用户期望的表达和对回归的防范可能是强大的。我认为它们绝对应该在开发人员的工具包中占有一席之地。</p><p id="f7f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">避免这些陷阱将帮助您尽可能有效地应用这个有用的工具。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="eea1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">参考</h1><p id="170f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">[1]有些框架如<a class="ae ky" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank">柏树</a>T6】do提供XHR请求和DOM嘲讽。这可能非常有用，但是请记住，虽然这些特性可以减少剥落，但是每当您模仿外部系统时，您就降低了测试的保真度。</p><p id="4599" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2]赫尔曼、T. D .、莫阿曾、e .、夏尔马、a .、阿克巴、z .、西利托、j .、&amp;毛雷尔、F. (2014年)。自动化GUI测试的探索性研究:目标、问题和最佳实践。(<a class="ae ky" href="https://prism.ucalgary.ca/bitstream/handle/1880/49989/2014-1057-08.pdf?sequence=1&amp;isAllowed=y" rel="noopener ugc nofollow" target="_blank">外部链接</a>)</p><p id="0d9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3]m .福勒(2013年)。PageObject。从<a class="ae ky" href="https://martinfowler.com/bliki/PageObject.html" rel="noopener ugc nofollow" target="_blank">https://martinfowler.com/bliki/PageObject.html</a>取回。</p></div></div>    
</body>
</html>