<html>
<head>
<title>4 Principles of Refactoring I Learned From Martin Fowler’s Book</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我从马丁·福勒的书中学到了重构的4个原则</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/my-top-takeaways-from-refactoring-part-2-55efe6c547b8?source=collection_archive---------1-----------------------#2022-01-29">https://betterprogramming.pub/my-top-takeaways-from-refactoring-part-2-55efe6c547b8?source=collection_archive---------1-----------------------#2022-01-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="27fc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们来谈谈《重构:改进现有代码的设计》这本书的第二章</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/613a1d041a89942e558df37f744c6efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yiFo2t7uHPMKxoUsYH1wHw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·温克勒在<a class="ae kv" href="https://unsplash.com/s/photos/building-blocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p></figure><p id="b379" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个系列中，我分享了我从肯特·贝克和马丁·福勒所著的《重构T4》一书中获得的一些经验。我强烈推荐任何对学习重构感兴趣的人阅读这本书。</p><p id="51c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本系列的第1部分中，我们从更普遍的意义上看了一下重构。在第2部分中，我们将探讨何时以及为何进行重构，以及如何进行重构的更多指导。</p><h1 id="82ad" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">第2章——重构的原则</h1><p id="f488" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在第二章中，马丁·福勒分享了重构的定义:</p><p id="b6c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对软件内部结构的一种改变，使其更容易理解，修改起来更便宜，而不破坏其可观察的行为。</p><p id="39f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">术语“可观察的行为”指的是软件的公共接口。这方面的一个例子是一个类的公共方法，其他类调用它来与之交互。定义再次明确了重构的目的。这是为了让软件更容易理解，并以一种更容易做出改变的方式进行重组。</p><p id="f375" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将带我们到我们的第一个外卖。</p><h1 id="b290" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">1.重构应该是经济的</h1><p id="667b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我喜欢清理/重组一段代码！回顾这些变化，我有种莫名其妙的自豪感。这就是为什么对我来说这是一个很好的认识，我们重构是出于经济原因。我们应该重构，不仅是为了结果的美观，也是为了我们长期获得的经济利益。</p><p id="565e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Martin Fowler提到我们是专业人员，有责任完成工作。重构是一个神奇的工具，可以帮助我们尽可能高效地实现这个目标。</p><h1 id="0392" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">2.重构是一个判断问题</h1><p id="70b6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果我们列出这些:</p><ul class=""><li id="5585" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">改进软件的设计，</li><li id="6cb9" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">让软件更容易理解，</li><li id="3a66" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">发现软件中的错误，</li><li id="f6f9" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">提高开发速度…</li></ul><p id="8149" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面列表中的最后一个对一些人来说可能听起来矛盾。因为他们认为重构是“更多的工作”。这可能只适用于实际变化很小的情况。但是重要的是要记住，从长远来看，重构是有回报的。</p><p id="44ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们通常需要做出“重构还是不重构”的判断。随着我们在职业生涯中遇到越来越多的正确判断，做出正确判断的能力会随着时间的推移而提高。作为做出这些决定的起点，这本书提到了唐·罗伯茨的“三法则”:</p><p id="6a5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“当你第一次做某事时，你就去做。当你第二次做类似的事情时，你会因为重复而退缩，但你还是做了重复的事情。第三次你做类似的事情，你重构”。</p><h1 id="612b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">3.识别重构的机会</h1><p id="7615" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们如何找到重构的正确时间？我们需要学会识别那些非常适合重构的特定场合。</p><ol class=""><li id="163d" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr nd mv mw mx bi translated">当添加新功能或修复错误时。为什么？在结构良好的代码库上做任何修改都更容易。</li><li id="9dbd" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nd mv mw mx bi translated">当试图理解一段代码时。为什么？更名为更好的，解开依赖给我们一个清晰的画面。</li><li id="62f2" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nd mv mw mx bi translated">当我们发现一段代码可以做得更好的时候。为什么？嗯，因为“永远要让露营地比你发现它的时候更干净。”。</li><li id="895a" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nd mv mw mx bi translated">做代码评审的时候。为什么？这是一个与你的同事分享一些观点的好机会。这可能不适合“拉-请求”类型的代码评审，因为这个过程需要更长的时间。这在结对编程时更合适，你们可以讨论这些建议。</li><li id="adfc" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr nd mv mw mx bi translated">有计划的重构时间。为什么？在某些情况下——通常是涉及遗留代码库的情况——重构可能不是一件容易的事情。在这种情况下，提前计划偿还以前开发决策的债务是一个明智的选择。</li></ol><h1 id="8c67" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">4.两顶帽子的比喻——任何时候都只戴一顶帽子</h1><p id="efb0" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这本书提到了一个很好的隐喻“两顶帽子”(作者Kent Beck)来描述Martin Fowler进行重构的方式。</p><p id="f784" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它表示将使用重构时的开发时间一分为二。一顶帽子用于添加新功能，另一顶用于重构。</p><p id="1c55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们戴上第一顶帽子时，我们应该只关注添加新的功能(以及它的测试)。我们不应该对现有的代码进行任何更改。当我们戴上第二顶帽子时，我们应该专注于重构现有的代码并保持测试通过。我们不应该添加任何新的功能(甚至不应该添加新的测试)。</p><p id="9f2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在开发过程中，我们可能会不断换帽子。但是记住当前戴的是哪顶帽子是很重要的。</p><p id="cf78" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">肯特·贝克分享了关于这两顶帽子的笔记:</p><p id="a614" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“一旦戴上重构的帽子，记下你认为代码中不正确的地方，但是抵制住现在改变它的诱惑，在你完成重构后，代码应该做完全相同的事情。然后，您可以换下帽子，回去修复实现。”</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="11d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这本书提到了处理重构常见问题的好主意。这些问题包括:</p><ul class=""><li id="6723" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">我们如何不让它减缓发展，</li><li id="a863" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">我们应该如何为重构的合适环境安排我们的代码所有权，</li><li id="b61e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">我们如何处理遗留代码库，</li><li id="b406" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">如何利用版本控制系统中的分支，</li><li id="6a21" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">如何应对涉及重构的数据库？</li></ul><p id="d1d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我不会深入讨论这些想法的细节。当我们面临这些问题时，最好将它们作为参考，并参考那些章节。</p><p id="c7a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="cd1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nl">最初发表于</em>【https://recepinanc.com】<em class="nl"/></p></div></div>    
</body>
</html>