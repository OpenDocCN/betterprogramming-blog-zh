<html>
<head>
<title>How To Create a GET Request in FastAPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在FastAPI中创建GET请求</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-create-a-get-request-in-fastapi-ecdc794b0cf?source=collection_archive---------10-----------------------#2021-07-22">https://betterprogramming.pub/how-to-create-a-get-request-in-fastapi-ecdc794b0cf?source=collection_archive---------10-----------------------#2021-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2db5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">构建API应该很有趣</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d0b9e4a4a652ebc2dcdb020f86a8edb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8pQYR-1s3pz7SGZe"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@pineapple?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">菠萝供应公司</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片。</p></figure><p id="b73d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今市场上有如此多的新框架。在Python的版图中，我是<a class="ae ky" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>的忠实粉丝。如果你还不知道FastAPI，你可能会想，“它对我有什么好处？”</p><p id="7caa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我简单回答一下。使用FastAPI，您可以非常快速地构建一个不错的API。</p><p id="012f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将向您展示用GET请求构建控制器是多么容易。此外，我还将向您展示测试有多容易。我们将涵盖单元和集成测试。</p><p id="c042" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以请喝一杯，几分钟后，您就可以开始使用FastAPI了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5995" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创建我们的第一个Get请求</h1><p id="6e6b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您需要做的第一件事是设置您的Python环境。对于本文，您需要一些库:FastAPI、uvicorn、pydantic和requests。你可以随意用任何你喜欢的工具来安装它们。</p><p id="045a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">注意:我更喜欢使用虚拟环境来安装Python中的库。它们不会弄乱你的系统，并且很容易与Docker这样的工具结合。</em></p><p id="7d8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将创建一个GET请求来检索图书。在这里，您可以看到我们将要使用的简单数据类型:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="db1e" class="nf md it nb b gy ng nh l ni nj">class Book:<br/>    <strong class="nb iu">isbn</strong>: int<br/>    <strong class="nb iu">title</strong>: str</span></pre><p id="1b9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在发出第一个GET请求之前，最好提供一些虚拟数据。在实际的应用程序中，我们会提供一个数据库，但现在这不是必需的。这是一个实现细节。相反，您可以先提供一个图书列表:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="d4e3" class="nf md it nb b gy ng nh l ni nj">books: list[Book] = [<br/>    Book(isbn=1234, title="What is love?"),<br/>    Book(isbn=4567, title="Baby don't hurt me"),<br/>    Book(isbn=6789, title="Don't hurt me"),<br/>]</span></pre><p id="1997" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的第一个GET请求是根据ISBN检索一本书。我们有一个预定的书单。如果清单里有这本书，你可以把它还回去。如果该书不在列表中，我们会产生一条“未找到”的错误消息。</p><p id="1381" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在FastAPI中，该功能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="fcf7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我给出一些背景和解释。可以看到一个路径参数或者路径变量，<code class="fe nm nn no nb b">ISBN</code>，<strong class="lb iu">，</strong>被传递到方法上。</p><p id="5439" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还将遍历列表，寻找与ISBN匹配的书。如果我们能找到它，我们就归还它。否则，我们给出一个明确的错误信息。FastAPI的好处在于JSON映射是自动发生的。</p><p id="c6b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">注意:你可能认为列表不是快速搜索的最佳数据类型。一个很好的练习是使用map作为数据类型来实现这个函数。</em></p><p id="1d29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">随着应用程序的增长，您可能还想将上面的代码移动到图书服务中，并从存储库中检索图书。但是这将使事情变得更加复杂，所以我决定在本文中保持简单。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="55ea" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何编写单元测试</h1><p id="8df5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们从代码示例开始，因为本文主要是关于FastAPI的。但是实际上，你应该从单元测试开始。到目前为止，我们已经看到了两条路径:一条快乐路径和一条例外路径。</p><p id="9d9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">注意:我建议你朝着你的解决方案迭代工作，并尝试用测试驱动开发找到上面的解决方案。我将向您展示如何为上面的代码编写测试。</em></p><p id="2a33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面我来描述一下我是怎么考上的。</p><p id="5111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我没有从上面的列表中返回一本书，而是返回了一本虚拟的书。这很容易测试。</p><p id="35a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其次，我编写了一个不同的测试来检索第二本书。拥有两本虚拟的书不会有什么成效，所以我从预定义的列表中返回了这些书。</p><p id="e401" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我修改了一个测试，期待一本书不在列表中。这给了我们两个测试。</p><p id="363a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从第一个测试开始。为了可读性，我选择在函数名中使用<code class="fe nm nn no nb b">given-when-then</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7fcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个测试很简单。如果我们在调用这个函数时指定了一个有效的ISBN，那么我们期望得到正确的图书。</p><p id="e298" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们进行第二项测试:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="ac62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">注意:如果您不熟悉unittest库，这种编写测试的方式可能需要一段时间来适应。但这并不像你现在想的那么复杂。在你养成了写测试的习惯之后，你就会掌握它的窍门了。</em></p><p id="3f36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们说，如果我们用一个无效的ISBN调用函数，我们会得到一个错误消息。最后，您澄清您需要一个带有正确错误信息的“404未找到”。</p><p id="68e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">注意:这些单元测试是必要的，以确保如果将来发生变化，现有的功能将得到保证。所以总是试着写单元测试。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="aba5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何编写集成测试</h1><p id="41c7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">单元测试不足以涵盖一切。为了确保一切都很好地协同工作，您应该编写集成测试。</p><p id="8b4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">FastAPI为我们提供了一个使用请求库的TestClient <strong class="lb iu"> </strong>。这使得编写集成测试非常方便。在这种类型的测试中，我们可以检查给出的注释是否正确。</p><p id="7865" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以用Postman或者用<code class="fe nm nn no nb b">curl</code>做一个手动测试来对比。用代码做这件事的好处是自动化。</p><p id="cba6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">假设Dave明天来到办公室，决定对您的API进行重大修改。单元测试和集成测试的结合将防止您已经编写的功能受到影响。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="701b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我喜欢这种测试。它们和Swagger提供的文档是记录如何使用API的最佳方式。</p><p id="7396" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">注意:虽然您也可以用集成测试来测试异常路径，但这并不是一个好主意。单元测试非常快，并且更适合于确保一切按预期运行。你的计算机会在一瞬间处理成千上万的单元测试。</em></p><p id="3693" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你写成千上万的集成测试，你的测试套件会变得非常慢。在某种程度上，它会变得难以维护，并且会占用大量资源和时间。</p><p id="24e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mz">端到端测试也是如此，甚至比集成测试还要慢。马丁·福勒写了一篇关于这个东西的优秀文章，我们称之为</em> <a class="ae ky" href="https://martinfowler.com/articles/practical-test-pyramid.html" rel="noopener ugc nofollow" target="_blank"> <em class="mz">测试金字塔</em> </a> <em class="mz">。去看看。</em></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ac0f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="d39f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">FastAPI让创建API成为一种有趣的体验。因为代码易于测试，所以它允许您快速构建一个可靠的API。</p><p id="7e6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们处理了一个GET请求。它是每个API的基础。如果您熟悉Flask或其他API构建工具，您将很快熟悉FastAPI。</p><p id="c645" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您阅读这篇文章。希望你试试FastAPI。而且，你可以用它来专业地构建一个API。</p></div></div>    
</body>
</html>