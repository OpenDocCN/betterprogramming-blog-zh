<html>
<head>
<title>Mastering Blockchain Development: Hardhat Implementation on Testing Smart Contract With TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握区块链开发:使用TypeScript测试智能合约的Hardhat实现</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/mastering-blockchain-development-hardhat-implementation-on-testing-smart-contract-with-typescript-3048b4a36052?source=collection_archive---------21-----------------------#2022-01-24">https://betterprogramming.pub/mastering-blockchain-development-hardhat-implementation-on-testing-smart-contract-with-typescript-3048b4a36052?source=collection_archive---------21-----------------------#2022-01-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="91ca" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">掌握web 3第2部分—智能合约测试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5a032e61dba1524b33b0c34440ff6690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*coO6WZIkTFpwF4BJ89NNVA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">来自@pch.vector的Freepik图片</p></figure><p id="12f3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们从这<a class="ae lr" href="https://aindrajaya.medium.com/mastering-blockchain-development-first-step-to-implement-ethereum-hardhat-and-typescript-74807c691129" rel="noopener">第1部分</a>继续我们的教程系列，我们已经完成了我们的第一个智能hello契约，并且已经成功编译。下一步，我们应该测试我们的代码，以确保我们在Solidity文件上写的东西是我们所期望的。</p><p id="e8c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在Hardhat中，我们需要再次添加一些库，并且不要忘记让它留在我们的开发环境中。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="0b9c" class="lx ly iq lt b gy lz ma l mb mc">$ yarn add -D <a class="ae lr" href="http://twitter.com/nomiclabs/hardhat-ethers" rel="noopener ugc nofollow" target="_blank">@nomiclabs/hardhat-ethers</a> ethers <a class="ae lr" href="http://twitter.com/nomiclabs/hardhat-waffle" rel="noopener ugc nofollow" target="_blank">@nomiclabs/hardhat-waffle</a> ethereum-waffle chai</span></pre><p id="151e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，您还可以添加typescript配置，如下所示:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="943d" class="lx ly iq lt b gy lz ma l mb mc">$ yarn add --save-dev ts-node typescript</span></pre><p id="e1ea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在最后一种情况下，您应该添加测试类型，大多数智能合约开发人员将使用<code class="fe md me mf lt b">chai</code>作为主要测试库(在这种情况下，我们还需要为chai配置typescript)。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="6654" class="lx ly iq lt b gy lz ma l mb mc">$ yarn add --save-dev chai <a class="ae lr" href="http://twitter.com/types/node" rel="noopener ugc nofollow" target="_blank">@types/node</a> <a class="ae lr" href="http://twitter.com/types/mocha" rel="noopener ugc nofollow" target="_blank">@types/mocha</a> <a class="ae lr" href="http://twitter.com/types/chai" rel="noopener ugc nofollow" target="_blank">@types/chai</a></span></pre><p id="fd94" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因为我们已经安装并将实现一些typescript，所以不要忘记将<code class="fe md me mf lt b">hardhat.config.js</code>文件改为<code class="fe md me mf lt b">hardhat.config.ts</code>。它会自动将我们的文件转换成基于typescript的文件。之后，在文件<code class="fe md me mf lt b">hardhat.config.ts</code>的第一行添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="77a3" class="mp ly iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">测试合同</h1><p id="ebaa" class="pw-post-body-paragraph kv kw iq kx b ky ng jr la lb nh ju ld le ni lg lh li nj lk ll lm nk lo lp lq ij bi translated">现在，让我们写一些测试。记住，根据我们之前关于项目结构的解释，我们应该在创建测试文件之前创建一个<code class="fe md me mf lt b">test</code>文件夹。然后您可以随意命名测试文件(别忘了我们使用的是基于类型脚本的文件)。</p><p id="c325" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">导入Nomiclabs hardhat(你可以看到它<a class="ae lr" href="https://www.npmjs.com/package/@nomiclabs/hardhat-ethers" rel="noopener ugc nofollow" target="_blank">这里</a>获得更多解释)，但它的简化，它是一个插件，允许我们以一种简单的方式与以太坊区块链互动(如果你有使用松露的经验，它将需要在运行所有松露服务之前运行本地区块链)，所以这就是为什么hardhat对我个人来说有一点容易，并且当我在我们的本地计算机上开发区块链时安全我的内存使用，更多关于Hardhat你可以看到(<a class="ae lr" href="https://hardhat.org/getting-started/" rel="noopener ugc nofollow" target="_blank">这里</a>)，怎么样</p><p id="49f9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的测试文件中运行的流，将与保存在<code class="fe md me mf lt b">artifacts/contracts</code>文件夹中的我们编译的契约(ABI)进行通信。</p><p id="6edc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后二进制代码将与以太坊节点进行交互。<br/>所以，这里是我们将用来测试我们的智能合约的代码测试，然后调用我们的<code class="fe md me mf lt b">hello()</code>函数。代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="b917" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后运行:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="c1e8" class="lx ly iq lt b gy lz ma l mb mc">$ npx hardhat test</span></pre><p id="25ec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，您会看到一个错误，就像这样(我希望它会得到解决)，然后您只需针对该错误再次运行建议命令，或者您可以按照下面的步骤，了解应该在我们的命令行中写些什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/00d77b7a30468d9fa832b56bc91b5c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCjY7orL3TF5xLD6uHbOtQ.png"/></div></div></figure><p id="48c2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要解决此错误，您可以添加以下命令:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="91fa" class="lx ly iq lt b gy lz ma l mb mc">$ yarn add -D ts-node</span><span id="b9eb" class="lx ly iq lt b gy nl ma l mb mc">...<br/>//After done, run test again</span><span id="e569" class="lx ly iq lt b gy nl ma l mb mc">$ npx hardhat test</span></pre><p id="0b86" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">结果应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/db10af50462e1c2c05ebe141a3f8176e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bKgB-2dnv1HxSDjjwXHCsA.png"/></div></div></figure><h1 id="4d1a" class="mp ly iq bd mq mr nn mt mu mv no mx my jw np jx na jz nq ka nc kc nr kd ne nf bi translated">结论</h1><p id="ee7a" class="pw-post-body-paragraph kv kw iq kx b ky ng jr la lb nh ju ld le ni lg lh li nj lk ll lm nk lo lp lq ij bi translated">那么，刚刚发生了什么？首先，简单的解释是，我们之前在我们的智能合约中测试了我们的函数，那个函数叫做<code class="fe md me mf lt b">hello()</code>，所以函数<code class="fe md me mf lt b">hello()</code>将被运行并提供字符串<code class="fe md me mf lt b">Hello, World from Web3</code>，如果我们用另一个字符串改变我们的测试，它将导致错误并且测试失败。</p><p id="dd30" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于更多的解释，我们可以在哪里与我们的智能合同进行交互？我没有看到我们项目之外有任何东西在运行。是的，确实如此。安全帽有能力根据我们的目的立即运行以太坊区块链。</p><p id="777d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，如果你在我们调用<code class="fe md me mf lt b">hello()</code>函数的最后一行代码中看到，这是hardhat的力量，它可以使以太坊网络在我们的项目中虚拟运行，调用<code class="fe md me mf lt b">hello()</code>函数来显示要测试的“<code class="fe md me mf lt b">Hello, World from Web3</code>”字符串。</p></div></div>    
</body>
</html>