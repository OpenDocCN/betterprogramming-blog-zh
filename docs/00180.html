<html>
<head>
<title>Rails Console Magic Tricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rails控制台魔术</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/rails-console-magic-tricks-da1fdd657d32?source=collection_archive---------0-----------------------#2018-08-26">https://betterprogramming.pub/rails-console-magic-tricks-da1fdd657d32?source=collection_archive---------0-----------------------#2018-08-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ce3a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">提高开发人员在Rails控制台会话中的体验的7种技术</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c100a13f46ee42947a17179b3de3025c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JNrtss-oJXLAkGyz"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Sergi Viladesau 在<a class="ae kv" href="https://unsplash.com/s/photos/cards?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="472b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，其中一些将来自于Ruby本身，因此不一定局限于控制台。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c873" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">1.会话结束后回滚</h1><p id="0587" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">可以在名为<code class="fe mw mx my mz b">sandbox</code>的模式下运行控制台。在这种模式下，当会话终止时，对数据库所做的每个更改都将自动回滚:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="a0be" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">$</strong> rails console <strong class="mz ir">--</strong>sandbox</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b0f4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">2.检索以前的执行值</h1><p id="7df4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">可以检索前一次控制台执行的结果，并如示例所示，通过调用<code class="fe mw mx my mz b">_</code>将结果赋给一个局部变量:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="6550" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> Game.all.map(&amp;:name)<br/><strong class="mz ir">=&gt;</strong> ["zelda", "mario", "gta"]</span><span id="e935" class="ne ma iq mz b gy nj ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> names <strong class="mz ir">=</strong> _<br/><strong class="mz ir">=&gt;</strong> ["zelda", "mario", "gta"]</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="2f3a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">3.使用grep搜索方法</h1><p id="98d8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">有可能找出只有一部分的方法的完整名称。通过从<code class="fe mw mx my mz b">Array</code>调用<code class="fe mw mx my mz b">grep</code>，可以对给定对象的方法执行便捷的搜索:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="d0d2" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> <!-- -->Game.first.methods.grep(/lumn/)</span><span id="75a9" class="ne ma iq mz b gy nj ng l nh ni">Game Load (0.8ms)  SELECT  "games".* FROM "games" ORDER BY "games"."id" ASC LIMIT $1  [["LIMIT", 1]]</span><span id="b3d9" class="ne ma iq mz b gy nj ng l nh ni">=&gt; [:column_for_attribute, :update_column, :update_columns]</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e524" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">4.找出方法的位置</h1><p id="a4e2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">来自<code class="fe mw mx my mz b">Object</code>类的<code class="fe mw mx my mz b">source_location</code>方法返回方法文件定义的完整路径，包括定义它的那一行。在探索第三方库时，它尤其有用:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="1401" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> <!-- -->'Luis Vasconcellos'.method(:inquiry).source_location</span><span id="967f" class="ne ma iq mz b gy nj ng l nh ni">=&gt; ["/usr/local/bundle/gems/activesupport-5.2.1/lib/active_support/core_ext/string/inquiry.rb", 12]</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="fb0b" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">5.返回方法的源代码</h1><p id="440b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">虽然知道一个方法的确切位置很有趣，但是在某些情况下，将它的源代码直接输出到控制台可能会更好。这可以通过从<code class="fe mw mx my mz b">Object</code>调用<code class="fe mw mx my mz b">source</code>来实现:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="fa91" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> <!-- -->'Luis Vasconcellos'.method(:inquiry).source.display</span><span id="177f" class="ne ma iq mz b gy nj ng l nh ni">def inquiry<br/>    ActiveSupport::StringInquirer.new(self)<br/>  end<br/>=&gt; nil</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="2b54" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">6.辅助对象</h1><p id="1363" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">控制台提供了一个名为<code class="fe mw mx my mz b">helper</code>的对象，可用于从Rails应用程序直接访问任何视图助手:</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="85a9" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> helper.truncate('Luis Vasconcellos', length: 9)</span><span id="d810" class="ne ma iq mz b gy nj ng l nh ni">=&gt; "Luis V..."</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="35c8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">7.应用程序对象</h1><p id="21d6" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">控制台还提供了一个名为<code class="fe mw mx my mz b">app</code>的有趣对象，它基本上是应用程序的一个实例。有了这个对象，就有可能像HTTP客户端一样与应用程序进行交互，还有其他有趣的事情。</p><ul class=""><li id="17b2" class="nk nl iq ky b kz la lc ld lf nm lj nn ln no lr np nq nr ns bi translated">对<code class="fe mw mx my mz b">GET</code>端点的访问:</li></ul><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="f57f" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> app.get('/')</span><span id="3cd2" class="ne ma iq mz b gy nj ng l nh ni">Started GET "/" for 127.0.0.1 at 2018-08-25 22:46:52 +0000<br/>   (0.5ms)  SELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC<br/>Processing by HomeController#show as HTML<br/>  Rendering home/show.html.erb within layouts/application<br/>  Rendered home/show.html.erb within layouts/application (11417.2ms)<br/>  Rendered shared/_menu.html.erb (3.6ms)<br/>  Rendered shared/header/_autocomplete.html.erb (292.2ms)<br/>  Rendered shared/_header.html.erb (312.9ms)<br/>  Rendered shared/_footer.html.erb (3.7ms)<br/>Completed 200 OK in 11957ms (Views: 11945.5ms | ActiveRecord: 0.0ms)</span><span id="a3a5" class="ne ma iq mz b gy nj ng l nh ni">=&gt; 200</span></pre><ul class=""><li id="d9ec" class="nk nl iq ky b kz la lc ld lf nm lj nn ln no lr np nq nr ns bi translated">对<code class="fe mw mx my mz b">POST</code>端点的访问:</li></ul><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="fecc" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> app.post('/games/zelda/wishlist_placements.js')</span><span id="dadc" class="ne ma iq mz b gy nj ng l nh ni">Started POST "/games/zelda/wishlist_placements.js" for 127.0.0.1 at 2018-08-25 23:03:21 +0000<br/>Processing by OwnlistPlacementsController#create as JS<br/>  Parameters: {"game_slug"=&gt;"zelda"}<br/>  Game Load (0.6ms)  SELECT  "games".* FROM "games" WHERE "games"."slug" = $1 LIMIT $2  [["slug", "zelda"], ["LIMIT", 1]]<br/>  Rendering wishlist_placements/create.js.erb<br/>  Rendered wishlist_placements/create.js.erb (194.8ms)<br/>Completed 200 OK in 261ms (Views: 252.9ms | ActiveRecord: 0.6ms)</span><span id="b8c7" class="ne ma iq mz b gy nj ng l nh ni">=&gt; 200</span></pre><ul class=""><li id="c64b" class="nk nl iq ky b kz la lc ld lf nm lj nn ln no lr np nq nr ns bi translated">从<code class="fe mw mx my mz b">Game</code>路线中搜索<code class="fe mw mx my mz b">_path</code>帮助者:</li></ul><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="cd56" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> app.methods.grep(/_path/).grep(/game/)</span><span id="108a" class="ne ma iq mz b gy nj ng l nh ni">=&gt; [:search_games_path, :game_ownlist_placements_path, :game_ownlist_placement_path, :game_wishlist_placements_path, :game_wishlist_placement_path, :game_path]</span></pre><ul class=""><li id="fc63" class="nk nl iq ky b kz la lc ld lf nm lj nn ln no lr np nq nr ns bi translated">以更有效的方式结合前面的技巧:</li></ul><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="7bae" class="ne ma iq mz b gy nf ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> app.get(app.root_path)</span><span id="aabd" class="ne ma iq mz b gy nj ng l nh ni">Started GET "/" for 127.0.0.1 at 2018-08-26 02:27:40 +0000<br/>Processing by HomeController#show as HTML<br/>  Rendering home/show.html.erb within layouts/application<br/>  Rendered home/show.html.erb within layouts/application (12550.2ms)<br/>  Rendered shared/_menu.html.erb (3.8ms)<br/>  Rendered shared/header/_autocomplete.html.erb (1.2ms)<br/>  Rendered shared/_header.html.erb (28.0ms)<br/>  Rendered shared/_footer.html.erb (3.8ms)<br/>Completed 200 OK in 12835ms (Views: 12810.0ms | ActiveRecord: 0.0ms)</span><span id="14e6" class="ne ma iq mz b gy nj ng l nh ni">=&gt; 200<br/></span><span id="a3ce" class="ne ma iq mz b gy nj ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> app.body.response</span><span id="d528" class="ne ma iq mz b gy nj ng l nh ni">=&gt; "\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt; ...<br/></span><span id="7b07" class="ne ma iq mz b gy nj ng l nh ni"><strong class="mz ir">&gt;&gt;</strong> app.cookies</span><span id="2a41" class="ne ma iq mz b gy nj ng l nh ni">=&gt; #&lt;Rack::Test::CookieJar:0x0000556ee95c33e0 <a class="ae kv" href="http://twitter.com/default_host" rel="noopener ugc nofollow" target="_blank">@default_host</a>="<a class="ae kv" href="http://www.example.com" rel="noopener ugc nofollow" target="_blank">www.example.com</a>", <a class="ae kv" href="http://twitter.com/cookies" rel="noopener ugc nofollow" target="_blank">@cookies</a>=[#&lt;Rack::Test::Cookie:0x0000556eeb72b2d0 <a class="ae kv" href="http://twitter.com/default_host" rel="noopener ugc nofollow" target="_blank">@default_host</a>="<a class="ae kv" href="http://www.example.com" rel="noopener ugc nofollow" target="_blank">www.example.com</a>", ...</span></pre><p id="3471" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你有自己的小窍门想和大家分享吗？留下评论吧，我很想听听。</p></div></div>    
</body>
</html>