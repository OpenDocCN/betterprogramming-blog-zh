<html>
<head>
<title>Build Custom Interactive Remote Push Notifications in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS中构建自定义交互式远程推送通知</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/building-custom-interactive-remote-push-notification-in-ios-4ffdba0b5281?source=collection_archive---------6-----------------------#2020-02-17">https://betterprogramming.pub/building-custom-interactive-remote-push-notification-in-ios-4ffdba0b5281?source=collection_archive---------6-----------------------#2020-02-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e49a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建一个交互式自定义推送通知用户界面，以显示带有添加和收藏按钮的视频预览</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8eaa795a800abbd3c83b16eb68bca497.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7N0rZe-gttuqxoT11540w.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">iOS中的自定义交互式推送通知</p></figure><p id="5d39" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从iOS 10开始，苹果已经随着新框架<code class="fe lu lv lw lx b">UserNotifications</code>和<code class="fe lu lv lw lx b">UserNotificationsUI</code>的引入，为推送通知提供了丰富的通知支持。</p><p id="f0b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用这些框架，我们可以使用以下功能定制我们的推送通知:</p><ol class=""><li id="18db" class="ly lz it la b lb lc le lf lh ma ll mb lp mc lt md me mf mg bi translated">自定义推送通知的类型和<code class="fe lu lv lw lx b">content/UI</code>。</li></ol><p id="65c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.为每种类型的通知提供自定义操作和响应。</p><p id="ac7e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.在将收到的推送通知发送给用户之前，对其内容进行变更。</p><p id="c8a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.定制推送通知的自定义触发器，例如在特定的时间间隔或地理区域。</p><p id="9187" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">除了所有这些丰富的通知支持，苹果还在iOS 13中添加了新的交互式自定义UI支持。以前，我们只能在像iPhone UI这样的动作表中定制供用户选择的动作。</p><p id="64a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过交互式通知，我们可以在推送通知中提供任何我们想要的用户界面和交互。</p><p id="8165" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这一新增功能是推送通知的真正变革者。例如，我们可以提供像文本字段、开关、滑块、步进器这样的控件，以及我们想要的任何自定义控件。</p><p id="addd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们可以自由定制我们想要的推送通知预览。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="354f" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">我们将建造什么</h1><p id="f666" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">在本文中，我们将构建一个交互式自定义推送通知UI，以显示一个带有按钮的预告片的视频预览，供用户添加和喜爱它们。</p><p id="32c0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用户还可以使用星号提供评级，并使用文本字段进行评论。下面是要做的任务列表:</p><ul class=""><li id="0543" class="ly lz it la b lb lc le lf lh ma ll mb lp mc lt nl me mf mg bi translated">设置项目和依赖项。</li><li id="bdbb" class="ly lz it la b lb nm le nn lh no ll np lp nq lt nl me mf mg bi translated">注册推送通知权限、类型和类别。</li><li id="74c4" class="ly lz it la b lb nm le nn lh no ll np lp nq lt nl me mf mg bi translated">模拟远程推送通知进行测试。</li><li id="399e" class="ly lz it la b lb nm le nn lh no ll np lp nq lt nl me mf mg bi translated">设置通知扩展目标信息列表。</li><li id="4eed" class="ly lz it la b lb nm le nn lh no ll np lp nq lt nl me mf mg bi translated">为通知内容设置用户界面。</li><li id="5ae4" class="ly lz it la b lb nm le nn lh no ll np lp nq lt nl me mf mg bi translated">在代码中处理接收通知和UI交互。</li></ul><p id="e0c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要在模拟器中模拟远程推送通知，您需要从Apple开发者网站下载并安装Xcode 11.4 beta。</p><div class="nr ns gp gr nt nu"><a href="https://developer.apple.com" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">苹果开发者</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">现在是开发苹果平台的最佳时机。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">developer.apple.com</p></div></div><div class="od l"><div class="oe l of og oh od oi ks nu"/></div></div></a></div><p id="f59a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以从下面的GitHub资源库下载完整的项目。</p><div class="nr ns gp gr nt nu"><a href="https://github.com/alfianlosari/iOSCustomInteractivePushNotification" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">alfianlosari/iocustominteractivepushnotification</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">一个简单的演示展示了交互式自定义推送通知用户界面，有几个自定义用户界面…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">github.com</p></div></div><div class="od l"><div class="oj l of og oh od oi ks nu"/></div></div></a></div></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="2ae7" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">设置项目和相关性</h1><p id="9cfc" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">首先，使用您唯一的包标识符创建一个新的Xcode项目。</p><p id="68ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，导航到项目的<em class="ok">签名和功能</em>选项卡。点击<code class="fe lu lv lw lx b">+ Capabilities</code>按钮，从列表中选择推送通知。目的是将推送通知与项目的App ID关联起来。</p><p id="f17f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将为自定义内容通知UI添加新的应用程序扩展目标。在菜单栏中，点击<code class="fe lu lv lw lx b">File &gt; New &gt; Target</code>。在过滤器文本字段中，键入<em class="ok">通知</em>。</p><p id="3125" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，从列表中选择<em class="ok">通知内容扩展</em>。输入名称，点击<em class="ok">完成</em>。之后，您可以在警告对话框中激活该方案。关闭项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/ebdd4d06c979de41f61e8e70e9859452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CkjgNVGW-0_A_8U_VzFuZQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">创建通知扩展</p></figure><p id="3771" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们将为项目初始化<a class="ae om" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>并声明依赖项。</p><p id="4ede" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用终端，导航到项目文件夹，并键入<code class="fe lu lv lw lx b">pod init</code>。之后，使用文本编辑器打开<code class="fe lu lv lw lx b">Podfile</code>,并将依赖项添加到应用程序的目标中。要添加两个依赖项:</p><p id="b26f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1.<a class="ae om" href="https://github.com/0xced/XCDYouTubeKit" rel="noopener ugc nofollow" target="_blank"> XCDYoutubeKit </a> —使用<code class="fe lu lv lw lx b">AVPlayer</code>播放YouTube视频的库。(警告:YouTube的政策只允许应用程序使用<code class="fe lu lv lw lx b">WebView</code>和<code class="fe lu lv lw lx b">iFrame</code>来播放应用程序内的视频)。</p><p id="7163" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.<a class="ae om" href="https://github.com/evgenyneu/Cosmos" rel="noopener ugc nofollow" target="_blank">Cosmos</a>——我们可以在应用程序中使用的星级控制。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Podfile</p></figure><p id="c77d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运行<code class="fe lu lv lw lx b">pod install</code>将所有依赖项安装到所有目标上。打开Xcode中的<code class="fe lu lv lw lx b">project.xcworkspace</code>开始。尝试使用<code class="fe lu lv lw lx b">Command + B</code>进行构建，以确保一切顺利进行。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="4d70" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">注册推送通知的权限、类型和类别</h1><p id="125f" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">接下来，我们需要使用<code class="fe lu lv lw lx b">UNUserNotificationCenter</code>在我们的应用程序中注册允许推送通知的权限。</p><p id="4cc2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们在<code class="fe lu lv lw lx b">(_:didFinishLaunchingWithOptions:)</code>内的<code class="fe lu lv lw lx b">AppDelegate</code>中添加代码来完成这项工作。确保在源文件的顶部导入<code class="fe lu lv lw lx b">UserNotifications</code>框架。</p><p id="ddf4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是这样做的步骤:</p><p id="aa0f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1.首先，我们调用<code class="fe lu lv lw lx b">requestAuthorization</code>，传递授权选项数组。在这种情况下，我们需要<code class="fe lu lv lw lx b">alert</code>、<code class="fe lu lv lw lx b">badge</code>和<code class="fe lu lv lw lx b">sound</code>。</p><p id="69d8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.其次，我们初始化<code class="fe lu lv lw lx b">UNNotificationCategory</code>，传递唯一的类别字符串标识符。在这种情况下，我们不想有自定义动作，所以我们传递一个空数组。</p><p id="6e56" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.最后，我们调用<code class="fe lu lv lw lx b">setNotificationCategories</code>，在数组内部传递我们的自定义通知类别类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="2c56" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">模拟远程推送通知进行测试</h1><p id="948a" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">Xcode 11.4终于引入了一个新功能，在本地模拟远程推送通知。</p><p id="973d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">开始很简单。我们需要创建包含有效负载的<code class="fe lu lv lw lx b">apns json</code>文件。我们还需要在<code class="fe lu lv lw lx b">aps</code>旁边添加一个额外的键，就是包含我们应用的应用ID的<code class="fe lu lv lw lx b">Simulator Target Bundle</code>。</p><p id="68e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">文件的扩展名必须使用<code class="fe lu lv lw lx b">.apns</code>而不是<code class="fe lu lv lw lx b">.json</code>。你可以看看下面的样本文件<code class="fe lu lv lw lx b">apns</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="54e6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，我们还为<code class="fe lu lv lw lx b">videoId</code>和<code class="fe lu lv lw lx b">description</code>提供了额外的键，因此我们可以检索<code class="fe lu lv lw lx b">YouTube</code>视频URL并在自定义UI中显示自定义描述。</p><p id="187c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要测试通知，请运行应用程序并接受通知权限。然后，把app放到后台，把<code class="fe lu lv lw lx b">apns</code>文件拖放到模拟器里。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/83d1a8109093a2bd7900dc09cb1f2672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XtFBdiYTg-I3RIIcv1B7TA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">拖放。apns文件</p></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="1c76" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">设置通知扩展目标信息列表</h1><p id="7ebf" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">我们需要向<code class="fe lu lv lw lx b">notification content</code>应用程序扩展<code class="fe lu lv lw lx b">info.plist</code>添加额外的键。在<code class="fe lu lv lw lx b">NSExtension &gt; NSExtensionAttributes</code>字典下，确保添加了所有这些键和值:</p><p id="3527" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1.<code class="fe lu lv lw lx b">UNNotificationExtensionDefaultContentHidden</code>。本设定键决定是否隐藏默认的推送通知标题和正文标签。在我们的例子中，我们想要隐藏它，所以我们将值设置为<code class="fe lu lv lw lx b">NO</code>。</p><p id="373b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.<code class="fe lu lv lw lx b">UNNotificationExtensionUserInteractionEnabled</code>。这个键决定是否使用户界面交互。我们将此设置为<code class="fe lu lv lw lx b">YES</code>。</p><p id="809d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.<code class="fe lu lv lw lx b">UNNotificationExtensionCategory</code>。我们需要使用我们在<code class="fe lu lv lw lx b">AppDelegate</code>注册的通知类型类别标识符来设置这个值，它是<code class="fe lu lv lw lx b">testNotificationCategory</code>。</p><p id="ecd5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.<code class="fe lu lv lw lx b">UNNotificationExtensionInitialContentSizeRatio</code>。预览第一次出现时的初始内容大小比例。我们将此设置为默认值，<code class="fe lu lv lw lx b">1</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/12a679054ba2301300a661f6a6fd07e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8LnxNTgg7RlUoUzj_nzLKg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">通知扩展信息列表</p></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="7f67" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">设置通知内容预览的用户界面</h1><p id="ca44" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">让我们转到通知内容预览界面。打开通知扩展目标中的<code class="fe lu lv lw lx b">MainInterface.storyboard</code>。以下是要遵循的步骤:</p><p id="0912" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1.将视图拖到视图控制器画布上。添加这些约束:<code class="fe lu lv lw lx b">Align top, leading, and trailing to Safe Area</code>。将<code class="fe lu lv lw lx b">height constraints</code>设置为<code class="fe lu lv lw lx b">240</code>。将此视图重命名为<code class="fe lu lv lw lx b">Player View</code>。这是嵌入了<code class="fe lu lv lw lx b">AVPlayer</code>视图的视频播放器视图。</p><p id="3d21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.拖动一个<code class="fe lu lv lw lx b">Stack View</code>到<code class="fe lu lv lw lx b">Player View</code>下面的视图控制器。添加这些约束:<code class="fe lu lv lw lx b">Top Space to Player View with 16</code>。<code class="fe lu lv lw lx b">Align leading, trailing, bottom to Safe Area</code>。将<code class="fe lu lv lw lx b">axis</code>设置为<code class="fe lu lv lw lx b">vertical</code>，将<code class="fe lu lv lw lx b">alignment and distribution</code>设置为<code class="fe lu lv lw lx b">fill</code>，将<code class="fe lu lv lw lx b">spacing</code>设置为<code class="fe lu lv lw lx b">16</code>。将其重命名为<code class="fe lu lv lw lx b">Outer Stack View</code>。</p><p id="c0b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.拖动堆栈视图作为外部堆栈视图的子视图。在这个堆栈视图中添加两个标签，视频标题标签和视频描述标签。将<code class="fe lu lv lw lx b">axis</code>设置为<code class="fe lu lv lw lx b">vertical</code>，将<code class="fe lu lv lw lx b">alignment and distribution</code>设置为<code class="fe lu lv lw lx b">fill</code>，将<code class="fe lu lv lw lx b">spacing</code>设置为<code class="fe lu lv lw lx b">4</code>。将视频标题标签行限制设置为<code class="fe lu lv lw lx b">2</code>。</p><p id="1330" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.拖动堆栈视图作为外部堆栈视图的子视图。在这个堆栈视图中添加两个按钮，一个订阅按钮和一个收藏按钮。将<code class="fe lu lv lw lx b">axis</code>设置为<code class="fe lu lv lw lx b">horizontal</code>，将<code class="fe lu lv lw lx b">alignment</code>设置为<code class="fe lu lv lw lx b">fill</code>，将<code class="fe lu lv lw lx b">distribution</code>设置为<code class="fe lu lv lw lx b">fill equally</code>，将<code class="fe lu lv lw lx b">spacing</code>设置为<code class="fe lu lv lw lx b">4</code>。</p><p id="c3e1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.拖动一个<code class="fe lu lv lw lx b">Button</code>作为外部堆栈视图的子视图，将其重命名为<code class="fe lu lv lw lx b">Review Button</code>。将<code class="fe lu lv lw lx b">text</code>设置为<code class="fe lu lv lw lx b">Review</code>。</p><p id="ee8e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">6.拖动一个<code class="fe lu lv lw lx b">Label</code>作为外部堆栈视图的子视图，将其重命名为<code class="fe lu lv lw lx b">Submit Label</code>。将文本设置为<em class="ok">您的审核已提交</em>！</p><p id="7293" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.拖动堆栈视图作为外部堆栈视图的子视图。将<code class="fe lu lv lw lx b">axis</code>设置为<code class="fe lu lv lw lx b">vertical</code>，<code class="fe lu lv lw lx b">alignment and distribution</code>设置为<code class="fe lu lv lw lx b">fill</code>，将<code class="fe lu lv lw lx b">spacing</code>设置为<code class="fe lu lv lw lx b">24</code>。将此重命名为<code class="fe lu lv lw lx b">Review Stack View</code>。</p><p id="5167" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">6.拖动视图作为查看堆栈视图的子视图。将类别设置为<code class="fe lu lv lw lx b">CosmosView</code>。在属性检查器中，将起始边距设置为<code class="fe lu lv lw lx b">16</code>，将星形大小设置为<code class="fe lu lv lw lx b">50</code>。将高度限制设置为<code class="fe lu lv lw lx b">59</code>。</p><p id="d607" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">7.拖动堆栈视图作为查看堆栈视图的子视图，位于宇宙视图下方。在这个堆栈视图中添加一个标签，注释标签，<code class="fe lu lv lw lx b">TextView</code>和<code class="fe lu lv lw lx b">Button</code>。将<code class="fe lu lv lw lx b">axis</code>设置为<code class="fe lu lv lw lx b">vertical</code>，将<code class="fe lu lv lw lx b">alignment and distribution</code>设置为<code class="fe lu lv lw lx b">fill</code>，将<code class="fe lu lv lw lx b">spacing</code>设置为<code class="fe lu lv lw lx b">8</code>。将高度限制设置为<code class="fe lu lv lw lx b">100</code>。确保将注释标签文本设置为<code class="fe lu lv lw lx b">comment</code>。</p><p id="5564" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">8.拖动<code class="fe lu lv lw lx b">Button</code>作为底部查看堆栈视图的子视图。将文本设置为<code class="fe lu lv lw lx b">Submit</code>，并将高度约束为<code class="fe lu lv lw lx b">40</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/b1e27f7150a4ca0e7c9242775fc1567e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDhIq3PRLvVXt-RTxlHTbA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">在故事板中设置通知用户界面</p></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="53be" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">在代码中处理接收通知和UI交互</h1><p id="200d" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">打开<code class="fe lu lv lw lx b">NotificationViewController.swift</code>文件。有一个<code class="fe lu lv lw lx b">NotificationViewController</code>类继承了<code class="fe lu lv lw lx b">UIViewController</code>并实现了<code class="fe lu lv lw lx b">UNNotificationContentExtension</code>。</p><p id="ebe6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当推送通知到达时，调用<code class="fe lu lv lw lx b">didReceive(_:)</code>方法，传递有效负载。以下是对视图、属性设置、<code class="fe lu lv lw lx b">didReceive</code>和交互处理器的代码处理的简要概述:</p><p id="f3f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1.在源文件的顶部导入所有需要的框架，<code class="fe lu lv lw lx b">AVKit</code>、<code class="fe lu lv lw lx b">UserNotifications</code>、<code class="fe lu lv lw lx b">UserNotificationsUI</code>、<code class="fe lu lv lw lx b">XCYoutubeKit</code>和<code class="fe lu lv lw lx b">Cosmos</code>。</p><p id="cf70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.您还需要声明标签、按钮、视图和文本视图的所有属性。</p><p id="e0d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.当用户点击相应的按钮时，声明所有的<code class="fe lu lv lw lx b">@IBAction</code>方法处理。在这种情况下，订阅、收藏、审阅和提交处理程序。</p><p id="299f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.用属性观察器声明用于存储<code class="fe lu lv lw lx b">isSubscribed</code>和<code class="fe lu lv lw lx b">isFavorited</code>状态的属性。在这种情况下，按钮的文字和颜色根据<code class="fe lu lv lw lx b">boolean</code>状态而变化。</p><p id="a9be" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.声明用于存储视图高度的常数。对于这个例子，我已经计算了视图展开或折叠时可能的高度。</p><p id="6c56" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">6.在<code class="fe lu lv lw lx b">viewDidLoad</code>中，设置按钮和堆栈视图的初始视图状态。<code class="fe lu lv lw lx b">Review Stack View</code>和<code class="fe lu lv lw lx b">Submit Label</code>隐藏；第一次出现时间视图。</p><p id="7358" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">7.在<code class="fe lu lv lw lx b">didReceive</code>中，我们检索内容并为标题和描述设置标签的文本。此外，我们获取<code class="fe lu lv lw lx b">videoID</code>并使用<code class="fe lu lv lw lx b">XCDYouTubeClient</code>来获取传递标识符的视频URL。</p><p id="4a56" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">8.在我们成功检索到<code class="fe lu lv lw lx b">URL</code>之后，用URL初始化<code class="fe lu lv lw lx b">AVPlayerViewController</code>，将视图嵌入到“Player View”容器视图中，并播放内容。</p><p id="bd0d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">9.当用户点击查看按钮时，取消隐藏查看堆栈视图。当他们点击提交按钮时，隐藏查看堆栈视图并显示提交标签。对于订阅和收藏，切换属性以更新按钮的文本和颜色。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="2f44" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在构建和运行它之前，确保将故事板中的所有<code class="fe lu lv lw lx b">@IBOutlets</code>和<code class="fe lu lv lw lx b">@IBActions</code>连接到代码。</p><p id="a578" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要进行测试，只需将<code class="fe lu lv lw lx b">apns</code>文件拖放到模拟器中，确保使用正确的应用ID。你可以尝试使用你的视频标识符来播放文件的<code class="fe lu lv lw lx b">videoId</code>值。</p><p id="148e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以从浏览器地址栏中的YouTube视频的URL参数中检索到这一点。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="fddc" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">结论</h1><p id="7c7d" class="pw-post-body-paragraph ky kz it la b lb ng ju ld le nh jx lg lh ni lj lk ll nj ln lo lp nk lr ls lt im bi translated">就是这样！祝贺你在构建自定义交互式推送通知UI方面取得的成就。使用这项新功能，您可以探索许多可能性和用例。</p><p id="9c38" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了处理主应用程序和扩展目标之间的数据共享，您需要创建一个<code class="fe lu lv lw lx b">app group id</code>。然后，您可以初始化共享的<code class="fe lu lv lw lx b">UserDefaults</code>来存储和检索本地数据。</p><p id="8896" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以在苹果文档中探索更多关于<code class="fe lu lv lw lx b">UserNotifications</code>框架的内容。</p><div class="nr ns gp gr nt nu"><a href="https://developer.apple.com/documentation/usernotifications" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">用户通知</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">面向用户的通知向您的应用程序用户传达重要信息，无论您的应用程序是否…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">developer.apple.com</p></div></div></div></a></div><p id="6c9d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们坚持终生学习吧！</p></div></div>    
</body>
</html>