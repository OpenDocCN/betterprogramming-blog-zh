<html>
<head>
<title>5 Reasons Why Poetry Beats Pip Python Setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">诗歌击败Pip Python设置的5个原因</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/5-reasons-why-poetry-beats-pip-python-setup-6f6bd3488a04?source=collection_archive---------1-----------------------#2022-02-23">https://betterprogramming.pub/5-reasons-why-poetry-beats-pip-python-setup-6f6bd3488a04?source=collection_archive---------1-----------------------#2022-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bdab" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">通过切换到诗歌的依赖性和虚拟环境管理，使你的python开发过程现代化</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/1207cd7e9d2c6288dbce61a0cbea0f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ab-Pv_PA7NrX5jSKzszd3w.jpeg"/></div></div><p class="kv kw gj gh gi kx ky bd b be z dk translated">克里斯·阿布尼摄于Unsplash</p></figure><p id="c6af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我对python项目最长时间的设置如下:</p><ul class=""><li id="f862" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">用于管理python版本的pyenv 。</li><li id="aac6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">用于管理虚拟环境的venv (包含在python3中)。</li><li id="c73d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> pip </strong>用于依赖性处理和发布。</li></ul><p id="9281" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为我的常用堆栈的一部分，我也用Javascript或Java开发了很多，我总是羡慕我的堆栈中每天使用的其他包管理器和构建工具的大量特性，如<em class="mj"> npm、yarn </em>或<em class="mj"> gradle </em>与pip相比。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><blockquote class="mr ms mt"><p id="3a9d" class="kz la mj lb b lc ld ju le lf lg jx lh mu lj lk ll mv ln lo lp mw lr ls lt lu im bi translated">进入<a class="ae mx" href="https://python-poetry.org/" rel="noopener ugc nofollow" target="_blank">poem</a>，poem是python中的一个依赖管理和打包工具，它在幕后使用pip，但是它在上面烘焙了大量的功能。所以这个标题有点误导，因为我们仍然间接使用pip。</p></blockquote><p id="af33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们通过<em class="mj">自制软件</em>或<em class="mj">卷曲软件</em>安装诗歌，一旦完成，我们就可以使用命令行工具。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi my"><img src="../Images/da92a6d816bc4b15f923d43b8030e941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YWcRQR2G_V9Vo7GsoxwvVg.png"/></div></div></figure><p id="cdce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了更好地理解诗歌是如何工作的，以及你能做什么，你可以查看文档，因为它真的很全面。我会给你最好的功能，在我的情况下说服我放弃使用画中画直接。</p><h1 id="c8e4" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">更好地了解您的项目依赖关系</h1><p id="f2e4" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">poems使用一个<code class="fe nw nx ny nz b">pyproject.toml</code>文件来指定项目的配置。还会自动生成一个<code class="fe nw nx ny nz b">lockfile</code>。配置文件如下所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/3d0b427d16543d2fe91958bee92d7ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*46MvHtXxTKfX9_EN-nO4-w.png"/></div></figure><p id="8558" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">听起来很熟悉？看起来像一个npm package.json配置文件。这是因为它包含了许多相同的功能。例如:</p><p id="7f42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">开发依赖:</strong>您可以在您的本地环境中安装所有带有<code class="fe nw nx ny nz b">poetry add --dev pendulum</code>的测试和开发库</p><p id="f807" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还希望使用命令<code class="fe nw nx ny nz b">poetry install --no-dev</code>将它们排除在生产环境之外</p><p id="5a34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> Python版本:</strong>您可以指定想要使用的Python版本，默认情况下，这将在初始化项目时指定，并且取决于您当前激活的虚拟环境</p><p id="0c1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">项目版本:</strong>项目的当前版本也在toml文件中指定，这有助于在发布您的包时进行标记。</p><p id="0406" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">仅显示主要依赖项:</strong>仅显示您安装的软件包。解析你的包的依赖关系时安装的二次打包将在<code class="fe nw nx ny nz b">lockfile</code>中指定，但默认情况下不在项目文件中。我发现这种方式比导出requirements.txt文件中的所有内容更简洁。</p><p id="d217" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">外部存储库:</strong>您的企业托管的包的辅助存储库可以在项目文件中指定。当然，这可以用pip来完成，但是用git来跟踪这部分配置非常方便。尤其是对于新入职的开发人员。</p><h1 id="623d" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">集成虚拟环境</h1><p id="4e9e" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">当我第一次开始用python开发时，在python 3切换到<code class="fe nw nx ny nz b">venv</code> <em class="mj"> </em>之后，我用<code class="fe nw nx ny nz b">virtualenv</code>管理虚拟环境。管理环境是python的基础，因为这关系到如何完全脱离全局python安装进行工作。</p><p id="cf48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我还使用诗歌来管理虚拟环境，这些虚拟环境隔离了项目中的依赖关系。</p><blockquote class="mr ms mt"><p id="6b62" class="kz la mj lb b lc ld ju le lf lg jx lh mu lj lk ll mv ln lo lp mw lr ls lt lu im bi translated"><strong class="lb iu">推荐</strong>我总是喜欢把我的环境文件夹放在我项目的根目录下。这是venv默认的工作方式，但不是诗歌。要对此进行配置，您需要设置参数<code class="fe nw nx ny nz b">poetry config virtualenvs.in-project true</code></p></blockquote><p id="1717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要初始化一个新的虚拟环境，运行:<code class="fe nw nx ny nz b">poetry init</code></p><p id="5b30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，您需要用<a class="ae mx" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank"> pyenv </a>设置您需要的python的特定版本。诗歌将获得当前活动版本的python来创建和激活虚拟环境。</p><p id="0be7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">在docker容器中安装依赖项的附注:</strong></p><p id="6520" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于容器中通常不需要虚拟环境，所以我通常使用以下配置在docker中安装项目的依赖项。</p><pre class="kk kl km kn gt ob nz oc od aw oe bi"><span id="6ccb" class="of na it nz b gy og oh l oi oj">RUN poetry config virtualenvs.create false<br/>RUN poetry install --no-root --no-dev --no-interaction --no-ansi</span></pre><h1 id="ad65" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">更容易构建和发布</h1><p id="0206" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">使用诗歌发布到Pypi真的很容易，该工具集成了构建源代码和wheel档案的构建步骤。</p><pre class="kk kl km kn gt ob nz oc od aw oe bi"><span id="c6b9" class="of na it nz b gy og oh l oi oj">poetry build</span></pre><p id="0ee2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您已经用build命令创建了一个可交付的包，只需运行下面的命令来发布到Pypi，就大功告成了，去喝杯咖啡吧。</p><pre class="kk kl km kn gt ob nz oc od aw oe bi"><span id="6c35" class="of na it nz b gy og oh l oi oj">poetry publish [--build] [--username &lt;username&gt;] [--password &lt;password&gt;]</span></pre><p id="9f64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">发布到私有存储库</strong></p><p id="3593" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要发布到私有存储库，首先需要添加URL:</p><pre class="kk kl km kn gt ob nz oc od aw oe bi"><span id="018f" class="of na it nz b gy og oh l oi oj">poetry config respositories.test <a class="ae mx" href="https://myprivaterepository" rel="noopener ugc nofollow" target="_blank">https://myprivaterepository</a></span></pre><p id="34a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后发布到您刚刚添加的存储库:</p><pre class="kk kl km kn gt ob nz oc od aw oe bi"><span id="3824" class="of na it nz b gy og oh l oi oj">poetry publish -r test</span></pre><h1 id="96c9" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">轻松在解释器版本之间切换</h1><p id="52be" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">有时，您需要验证您编写的代码在不同的python版本中都能很好地工作，例如python 3.2和3.7。</p><p id="c790" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">诗歌使这变得容易，因为可以为此目的创建多个虚拟环境，并且彼此相邻。</p><p id="b996" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使用不同的python版本，我们必须首先:</p><ol class=""><li id="6e2b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ok mb mc md bi translated">如果它不在我们的系统中，请安装它。为此我通常使用<em class="mj"> pyenv: </em> <code class="fe nw nx ny nz b"><em class="mj">pyenv install &lt;different python version&gt;</em></code></li><li id="9f19" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ok mb mc md bi translated">在终端会话中设置所需版本为全局或本地:<code class="fe nw nx ny nz b">pyenv global &lt;different python version&gt;</code></li><li id="58d6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ok mb mc md bi translated">让poems安装所需版本的依赖项(并生成一个新的虚拟env):<code class="fe nw nx ny nz b">poetry install</code></li></ol><p id="ac12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果某些依赖项不符合新python版本的要求，就会出现错误。</p><h1 id="240d" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">表演</h1><p id="fdd3" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">诗歌对贮藏物有一种真正的表演用途。所以安装一个包平均来说效率更高。</p><p id="b68d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您习惯于并行处理不同的项目，并且经常使用像Django、flask或numpy这样的通用包时，这种情况就很常见。</p><h1 id="4a3b" class="mz na it bd nb nc nd ne nf ng nh ni nj jz nk ka nl kc nm kd nn kf no kg np nq bi translated">结论</h1><p id="85a6" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">如果您从未测试过诗歌，您应该尝试一下，此外，如果您喜欢这种体验，迁移现有的python项目轻而易举。</p><p id="7041" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我发现主要卖点是<code class="fe nw nx ny nz b">pyproject.toml</code>文件为您提供的集中配置和包含的虚拟环境管理解决方案。</p><p id="d793" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管诗歌正在大力开发中，我还是希望未来能包含运行脚本的功能，让我们拭目以待吧。</p></div></div>    
</body>
</html>