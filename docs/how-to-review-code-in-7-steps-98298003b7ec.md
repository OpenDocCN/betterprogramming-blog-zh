# 如何用 7 个步骤评审代码

> 原文：<https://betterprogramming.pub/how-to-review-code-in-7-steps-98298003b7ec>

## 理想的代码评审过程是什么样子的

![](img/587b9727c199973a9ac61653f05969f2.png)

查尔斯·德鲁维奥在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

在 web 开发中，代码评审或同行评审是质量过程中最重要的步骤之一。代码评审中的许多问题不会让你感到惊讶。你见过有人对你发火吗？你曾经得到很多评论吗？那让你有什么感觉？如果你关心软件开发和你的工作，请阅读这篇文章，并用它来立即采取行动。

如果你这样做，你会成为一名更好的工程师，我保证！你将提高软件开发的门槛。

# 糟糕的代码评审带来的问题

在我作为软件顾问的职业生涯中，我见过许多组织盲目信任他们的工程师。想象一下我是这里的大公司之一。

我付给我的工程师足够的钱来期望他们知道他们在做什么，对吗？他们已经在这个行业工作多年了。我很确定他们能识别坏代码，对吗？—

嗯，好吧…

事实上，这通常是**而不是**的情况，这导致了真正的问题:

**有些人不参与点评。他们把它们分发给特定领域的专家。他们不利用优势去学习，因为他们不知道去寻找什么。相反的情况也存在。我们都知道那种总是想发表意见的人！别忘了包括他们，否则他们会生气的！有时我们甚至称他们为组织的建筑师。他们参与每一个该死的代码审查，你没听错。每一个都是。**

这可能会让某些人不高兴，但我还是要说:每个人都有平等的发言权。我们都是敏捷团队中的开发人员。我们对产生的代码负有同等的责任。

代码评审没有等级之分。经验不足的人和经验丰富的人有同等的投票权。我根本不在乎你有多少年的经验。我们都在做自己的工作，犯错是人类的主要特征之一。

您团队中的每个开发人员都有平等的批准投票。

人们总是给出相同的评论。这可能有多种原因，但这确实是一件坏事。

一方面，这是错过自动化机会的迹象。如果你一遍又一遍地给出同样的备注，难道系统不能检测到这种警告吗？

另一方面，你可能缺乏好的评价:你的同事一次又一次地犯同样的错误！这意味着他们已经停止学习，不关心你的产品质量。信不信由你，这就是严酷的事实。否则，他们早就采取措施了！

这两种情况都是潜在的风险。这些代码中的一些已经并将会被忽略，最终，以某种方式，一些将会通过。

在我们目前的团队中，我们仍然记得那些通过评审的时候。如果是因为一个搞笑的评论，那是可以接受的事情。这让我坐在这里微笑。但是如果这是你已经说了几百遍的话，你们最终会对对方失望。

**轻松审批。**我们都知道，一个后端开发人员看到前端代码的合并请求后会说，我想这没问题，所以我们就批准吧，对吗？

如果你不是某个领域的专家，与一些知识渊博的人合作，获得他们的帮助，并一起列出你可以在代码评审中寻找的东西。互相学习。

不要盲目批准！相信我，我见过有经验的工程师这样做。工程师能够在他们的代码编辑器中做最精彩的事情。其他工程师只能梦想的东西。然而，他们是领域专家，在工作的某些方面表现出色。在他们工作的其他部分(例如审查前端代码)，他们只是表现不佳。

如果你不明白你在读什么，寻求帮助。

**你的代码审查过程花费了太多时间。**你认识到以下情况了吗？你的团队正在开发他们自己的故事，我们不认为代码审查是紧急的。我们经常忘记的是，团队应该最大化故事的吞吐量。缺少一个过程，会浪费很多时间。

在有人开始审查在这种状态下没有交付任何价值的代码之前，可能需要几个小时。
意见已经给出，需要时间处理。有时，人们甚至开始做一些不同的事情，而不去碰评论。你不能责怪自己这样做——毕竟，没有人喜欢无事可做。

如果你不得不经历多次等待和处理评论的过程，许多时间就被扔出窗外了。

你认识这个吗？我见过，所以我打赌至少你们中的一些人见过。如果你这样做，停止这个噩梦。现在就停止，今天就停止！继续读下去，找到解决这个问题的办法。

你的故事在代码审查中“未被触及”的每一个小时，对客户来说都是价值损失的一个小时。

你能回顾一下这个吗？你可能会意识到这样一种情况，你，开发人员，觉得有必要开始调查其他人的评论。你想完成你的工作。当然，这很自然。但是人们不应该要求别人审查他们的代码。

这个“几乎可合并”的故事、bug 或重构，事实上，只要符合要求，就是每个人的头等大事。您与团队沟通，您已经准备好接受评审，应该尽快进行评审。实际上，情况往往并非如此。

我们可能会进行所谓的“短跑”，但在马拉松比赛中，我们需要团队中的每个人都保持良好的速度。我们常常觉得自己在比赛的最后一段独自奔跑，这也是最重要的一段。

在自我管理的团队中，每个人都参与交付价值。

# 我们来定义一下流程！

为了防止类似上面列出的问题和许多其他问题，我们需要一个清晰的审核流程。我将要给你七个步骤来定义一个好的过程。但是工作并没有到此为止。拿起它们，使用它们，塑造它们，并呈现给你的团队。收益会以难以置信的速度接踵而至。老实说，我认为在一个理想的过程中，没有以下几个步骤是不行的。

## 第一步:给你的团队一个演示

![](img/8c436fadcf6dfc22d55e764735b8f0c9.png)

由 [You X Ventures](https://unsplash.com/@youxventures?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

审查的第一步是验证所有列出的需求都在工作。开发人员应该为当前在场的团队进行演示(理想情况下，至少应该有两三个团队成员在场，这取决于您需要多少批准)。一起检查需求，并提出您的任务解决方案。这种应用知识共享为所有团队成员带来了直接价值。

如果你的故事中列出的需求没有被满足，代码评审过程就到此为止。这个故事还没有准备好，当然也没有准备好进行广泛的审查。一个故事的全部意义在于传递一个有效的增量，所以回顾一下你的需求，当你准备好了的时候给出一个新的演示。如果你被什么东西卡住了，寻求帮助并配对通过。

大多数情况下，如果一个故事没有按预期进行，你会在过程中得到评论。写下每一条演示评论。最初你可能认为你能记住所有的评论。但是在长时间的讨论后，你可能会忘记细节，或者一条评论变成两条、三条、四条……只要停止讨论一会儿，花点时间写下来。

假设你的团队中有一个叫乔的同事。乔给了你一个评价。"该按钮被禁用，但缺少工具提示。我们的用户不会知道它为什么被禁用。”你错过了需求的一个微妙的细节，也许它没有被指定。假设你告诉他下面的话:*“嗨，乔，我会写下你的评论，因为这对我们的客户很重要。我不希望他们陷入不理解为什么那个按钮被禁用的境地。”*

你会看起来像一个真正的专业软件工程师，你也会赢得乔的尊重。他知道你在乎他的意见，他会认为他为一个成功的产品增加了一些东西——毕竟，他确实给出了很好的评论。

**重要提示:**您可以在向团队演示时录制您的演示(即使您选择了现场演示)。这允许异步通信发生。这在远程团队中也非常有用。注释也可以异步给出。你可以在一天结束时录制你的演示，早起的鸟儿会在你早上到达时给你反馈。

请记住以下几点。人们经常因为开会、上厕所、写代码休息或者其他原因而缺席。不要让任何事情阻止你完成这个故事。优化流程。方便他人。明天进行演示，因为没人在场，这不是你能想出的最好的借口。你还有时间吗？录制那个演示——不要开始优先级较低的东西。

不要误解我。像许多其他人一样，我也看到了现场演示的许多优点，当然也包括困难的用户故事。在现场演示期间，你们可以彼此进行更深入的讨论，并讨论潜在的缺失需求。不管什么能让你开心。我不会因此而反对你。

## 第二步:拿起评论

![](img/899d8ae6a4d68ef1264b01595fc59af3.png)

由[罗伯特·库兰尼](https://unsplash.com/@fujicanon?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

当一个故事、错误修复或任务的每一个需求都被满足时，我们就为下一步做好了准备。假设演示成功了。从统计学的角度来看，唯一正确的分配评审工作的方式是随机的。这样，知识被平均分配，每个人都有机会不时地审查代码。我可以理解人们会根据自己的需要来调整这一点，我也没有资格告诉你该怎么做。然而，这似乎是一种公平合理的分工方式。如果有必要的话，请根据您的组织的具体需求进行调整。

每个参与评估的人都应该把这看作是他们的头等大事。演示结束后，你不会再回到你一直在做的事情上。不，你去看看这个故事，因为它很重要。现在已经准备好的附加价值应该尽快交付，并以对客户来说最好的方式交付。每个参与这部分流程的人都应该把它作为自己的优先事项。

作为开发人员，我们渴望得到反馈。创建代码只是一部分。第二个也是最好的部分是，当你的创作变得有活力时，你的钱才真正物有所值。就我个人而言，反馈给了我很多能量。我们渴望从同事和客户那里获得反馈，这是很自然的。只有通过代码评审的其余部分直接跟随演示，我们才能确保我们的客户快速获得他们承诺的价值。

实际上，**拾取**步骤完全不同。我们，开发人员，都有过这样的经历，我们编写了一个故事，并把它放在了评审中。通常，每个人都专注于他们现在正在做的事情。有时候要花很长时间才会有人拿起代码评审。在最糟糕的情况下，你会收到很多评论，你会花大量的时间去修改它们，通常是独自一人。与此同时，客户或团队领导已经听说(例如，在站立会议期间)故事差不多准备好了，并开始提问。为什么要花这么长时间？用不了多久，指手画脚的游戏就开始了…

## 第三步:单独开始回顾

![](img/4bd208a23de5b19d9e3d093fb8a0c011.png)

由[艾莉·史密斯](https://unsplash.com/@creativegangsters?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

好吧——你是被选中的人。你已经为自己赢得了先看到给定问题的解决方案的权利。您已经获得了进行代码审查的特权。你的同事已经为这个故事工作了几个小时，也许几天，并且为她的代码感到非常自豪(至少我希望她是这样)。让自己做好看到大量新代码的准备，转移到一个可以集中注意力的地方。你有责任把质量提高两个层次，而不是一个层次。把她惊人的成绩从 8 分提高到 9 分，甚至 10 分。

最初，我发现自己检查代码是最理想的。为要寻找的东西列一个清单。重温你能想到的所有事情。

如果你缺乏该领域的专业知识，请其他人介入，看他给出额外的评论。记笔记，学习。这是一个人提高他/她的软技能的理想时刻，你可以成为一名导师或者你可以学习和观察。用眼睛偷。在软件开发过程中，这是一个很大的学习机会。拥抱它。

但是你从哪里开始呢？有这么多东西要找？我会给你列一张我做过的事情的清单。添加你的东西，塑造它。微调它，更新它。这也是一个终生学习的旅程。这是 rockstar 开发人员和编码人员的区别之一。所以事不宜迟，在这里我会列出我自己系统检查的东西。

# 基本原则

## 停止意外的改变！

问问你自己你正在检查的代码是否达到了它的目的。你已经知道它的工作原理了，因为你已经看过演示了。但是对于给定的任务/特性/bug，你看到的所有变化都是需要的吗？它做得太多了吗？是否有任何新的编译时或运行时依赖项，它们对于这个合并请求是必要的吗？

提示:保持小的拉请求，并创建单独的任务来执行大的重构，以帮助新的开发。审查较小的代码更改更容易。具有 1，000 个或更多变更行的代码审查会花费很多时间，并且审查者可能会在审查期间失去注意力。

## 你不会需要它的(YAGNI)

未使用的代码是大型代码库中的一个问题。这使得找到其他代码变得更加困难，并且留下了本来可以删除的导入。把它扔掉。不管怎样，它可能一直存在于 Git 中，所以它从未真正丢失过。有一个非常简单的原则叫做 YAGNI:如果你不需要它，就扔掉它。

在现实生活中，你也不会把空包装留在房间里。如果你这样做了，你的室友可能不会因此而感激你。应用童子军规则，并在使用时清理代码。

## 保持事情简单，愚蠢(吻)

我总是告诉我的同事，代码应该读起来像一本好书。如果没有，我会提问。我不喜欢一本坏书；这让我想停止阅读。但是我不能停止阅读，因为审查代码是我工作的一部分。所以你作为评论者唯一能做的就是提问。

完善代码，提升自己的阅读体验。不要活在否认中；随着时间的推移，代码不会变得更容易阅读。总有一天，会有人加入你的公司，有同样的奋斗。为了团队，今天就采取行动。

如果可以的话，让事情简单化。确保你的代码做了它需要做的事情。请确保您的测试测试了正确的案例，并且易于阅读。如果系统是简单的，而不是比它们应该的更复杂，那么它们工作得最好。

## 不要重复自己(干)

有一个简单的规则:你应该避免重复自己。如果你这样做一次、两次或三次，这不是问题。但是不要让事情失控。提取重复的功能，尽可能避免重复。

不要重新发明轮子。如果你想做的事情已经在一个流行的图书馆里做过了，请至少尝试使用那个图书馆。无论如何，它可能会更有效地完成工作。

## 名称又能代表什么呢

好的命名非常重要。这对可读性很重要。使用简单明了的名字。一个好名字不是太抽象，而是相当精确。

比起注释，更喜欢好的命名。反正没人维护评论；不要让别人说服你。评论经常被遗忘。

没有人喜欢一直看错别字——它会让你恼火。因此，如果你发现了一个错别字，你当然可以添加一条备注。如果有人称你为语法纳粹，告诉他们你宁愿做一个语法纳粹也不愿无知！

提示:编码时想不出好名字？让它长得可笑，你的代码审查员可能会注意到它。一起想个好名字。如果它通过了，你的代码审查过程是有缺陷的。

## 阅读测试

每次测试应该只测试一件事。目标是每个测试只使用一个断言，但是如果需要的话，你可以满足于一个概念。测试必须做它们应该做的事情，因为它们是文档的主要来源。它们必须小而清晰。

把测试金字塔放在你的脑后。比起集成测试，更喜欢单元测试。比起端到端测试，更喜欢集成测试。如果你能测试一些低层次的东西，这比在它上面加几层花里胡哨的东西要快得多。

测试应该总是有相同的模式。你可以决定你认为最符合逻辑的。我很喜欢下面两个:“给定，何时，然后”或“安排，行动，断言”。如果你的单元测试没有遵循这个结构，那就要担心了。

## 检查是否被遗忘

我们必须交付但不是成功演示所必需的东西经常被遗忘。如果有人添加了突破性的改变或者新的特性，确保他把这些添加到了变更日志中。

如果某些事情发生了巨大的变化，也许您甚至需要在自述文件中添加一些内容。

我能想到的最后一件经常被遗忘的事情是待办事项和日志记录语句。它们可以出现在代码的任何地方。一定要留下备注；你的队友会感激你的。

## 检查快捷方式

我们往往一开始就走捷径，因为本质更好玩，对吧？我们经常会忘记那些小细节，那些边缘情况，比如之后的特定输入验证。确保你发现走捷径。防御性编程比你旁边一个愤怒的客户不得不做一个修补程序要好。

如果有人没有按照新的风格重写代码，或者没有清理任何东西，请给出评论。如果他们没有使用新的语言特性，这将大大提高可读性，告诉他们！我们的工作就是让事情变得更好。

## 运行测试

有很多工具可以对代码进行统计分析，检查路径覆盖率、行覆盖率等等。所以我强烈建议使用它们。但是有时候我们不知道具体的测试是做什么的。

在代码审查中，您有机会运行它并验证它是否增加了一些东西。你不必只在代码审查时阅读；那是一个神话。如果您恢复实现，测试会中断吗？

## 赞美美好的事物

经常忘记的一件事是在复习中表扬你学到的东西。告诉他们，如果他们做得好，因为他们值得。他们只是教了你一些东西，所以这是你最起码应该做的。建设性的反馈在你的组织中创造奇迹。

# 软件设计

你听说过固体吗？

*   **单一责任原则**:一个类或一个方法应该只做一件事，并且做好。
*   **开闭原则**:应该建立在代码上，开放扩展。代码不应该彻底改变，并关闭修改。
*   **利斯科夫替代原则**:降低耦合性，便于代码重用。
*   **界面隔离原则**:你不应该依赖你不用的东西。
*   **依赖倒置原则**:高层模块不应该依赖低层模块。两者都应该依赖于抽象。抽象不应该依赖于细节。细节应该依赖于抽象。

你知道一些设计模式吗？

*   **创建模式**:对象创建机制(如工厂、构建器、单例)。
*   **结构模式**:类/对象的组合(如装饰器、模块、适配器)。
*   **行为模式**:算法和对象之间的责任分配(如命令、策略、观察者)。
*   特定领域模式:我们如何在特定的框架中做事？这里保持一致是关键。处理一些错误但一致的事情，比许多不同的平庸方法更容易。

# 编码指南和代码风格

创建一个文档，列出您在代码库中做的常见事情。这是非常特定于应用程序或语言的事情，但是要确保每个人都意识到这一点。如果可能，在编辑器中添加一个。如果可能，自动检查代码样式。关键是要始终如一，不是吗？我不可能在这里列出所有的编码指南。那就太多了。

# 你说了很多话。你讨厌我吗？

在代码评审中得到很多代码评审评论或问题并不一定意味着他/她做得不好。然而，对于我们中的许多人来说，收到大量的评论可能会令人沮丧。得到很多评论，或者我更喜欢说，“反馈”可以有很多不同的原因。只要你保持建设性，你是好的。

也许你正在处理一段旧的代码，它需要适应一种新的工作方式，一种你根本没有意识到的方式。也许你寻求的解决方案与你在团队中的行事方式不一致。也许这只是一段难懂的代码。没事的。我们不玩指责游戏。我们，开发团队，终究会走到一起。但是我们的工作就是递送。因此，一旦我们处于这种准备状态，我们必须合作。

最后一个提示:如果你不得不一遍又一遍地给出相同的评论。请告诉他们在整个审核过程中都这样做，并在下一轮审核中验证他们是否这样做了！这最后一部分至关重要。不要相信任何人——这是开发团队的责任。请与您的同事讨论此事，因为这是一个问题。

# 步骤 4:一起处理评论

在第三步中，我们有机会深入研究代码，因为我们单独在一起，所以我们能够专注于手头的代码。那太好了，现在你可能至少已经给出了一些评论。但是，为了确保它们以省时的方式得到解决，请将它们放在一起处理。

解释你为什么给出评论，听听评论者怎么说。除非他们认为你是对的，否则他们可能不想改变他们的代码，所以要确保你已经提前准备好了你的论点。对每个评论都这样做。一旦你同意或同意不同意，你就准备好进入下一步了。

# 第五步:一起解决评论

对你们中的一些人来说，这可能听起来很疯狂，但是如果你已经给出了评论，你就知道你到底想要什么。不要逃避，而是成对解决。一起检查每一个评论改进，并立即应用它们。对每一句话都这样做。

当所有的备注都解决后，再检查一遍。如果你认为它是令人满意的，给你批准。就这样，你完了。你可以离开被审查者了。当你离开时，你也知道你的任务完成了。

# 步骤 6:自动化重复出现的评论

您可能已经与您的同事一起解决了某些代码评审注释。你可能已经注意到，你一遍又一遍地听到同样的话。也许你在之前的评论中听到过这句话，或者在同一篇文章中多次听到。那没关系。

如果你能自动注释，请做。也许你可以在你的编辑器中添加一个拼写检查器，或者一个 git 钩子，或者你可以在你的管道中添加类似 sonar 的东西。也许您可以在配置文件中添加一条规则。有太多可能的事情会再次发生，所以我把它留给你。但是如果你一次又一次地看到一些事情，做点什么吧。

# 第七步:验证你的故事

您的故事已经过审核，并获得了必要的批准。真好。尽管你之前已经演示过了，但还是有可能出了问题。即使你认为不是这样，也是非常非常有可能的。因此，确保构建是绿色的，并让某个人来验证它。这个验证步骤非常重要。

例如，与团队中的客户或客户代理一起验证这个故事，并再次检查需求。确保您已经正确地设置了您的环境，并且已经正确地检查了每个分支，您正在使用最新的数据等等。

这将是最后的演示，你的工作将在之后上线。你已经完成了你的工作，你的团队也帮助了你。你可以非常确定，如果你每一步都做对了，你就做得非常好。所以恭喜你。你已经完成了所有七个步骤！

# 额外收获:好的代码评审过程有什么好处？

代码审查也是故事合并并部署到产品中之前的最后一步。你可以把它看作是在它可能几天、几周甚至几年前更新代码的最后机会。

做好代码审查有很多好处:

代码审查将帮助您:

*   **及早发现 bugs】。为了防止 bug 或逃脱的缺陷，一个好的评审可以创造奇迹。在过去，我们作为一个团队通过进行代码审查来防止的错误数量是惊人的。**
*   **建立编码标准**。查看代码评审的一个好方法是将代码质量提升一两个级别的机会。完美的代码是不存在的，如果你认为你写了完美的代码，你就生活在否认中。只要拿起你一两年前的代码片段，你就会发现我是对的！我们正处在一个终生学习的旅程中。通过在这个过程中改进我们的代码，最终，随着时间的推移，代码会变得更好。最终，经过数月或数年精心打造的代码将近乎完美。即使我们几年内都不用碰它，也许它对于手头的任务来说一直都是完美的？它是完美的，直到它必须因外部刺激而改变(例如，改变请求、法律改变、性能问题)。
*   **分享知识。代码评审是一个学习和传递知识的机会。每个人都可以参加这个旅程，但至少有些人应该参加。在公司里，与同事分享知识是件好事，尤其是与内部人员。我们共同拥有这个代码库，我们都有责任！将你的代码库视为组织的重要组成部分。正是洞察力推动了创新！人来人往，知识亦然。确保它在你的组织中传播，否则你以后会有真正的问题。记住，为公司构建软件是一种协作，而不是独角戏。**
*   增加你代码库的一致性。要在代码库中看到清晰的模式，做出设计决策并与它们保持一致是极其重要的。你的系统会变得更容易理解，重复会变得更清晰。一致的代码更容易自动化、重构和测试。这不是观点，而是事实！不要害怕多次犯同样的错误，追踪这些问题会更容易。
*   **提高代码质量**。我以前说过，现在还要再说一遍——完美的代码是不存在的。拥有一定的标准将确保代码库会随着时间的推移而改进。代码审查是发现反模式、漏洞和愚蠢错误的最后手段。他们可以让你的团队免于受到指责，他们可以成为新的或更好的解决方案的灵感或想法的来源。

因此，请改进您组织中的代码审查过程。这会帮你的客户省钱，也会让你的同事开心。你将成为贵公司渴望的改变。你能做到的。只需要七个简单的步骤。一步一步，你将改进你的代码审查过程。