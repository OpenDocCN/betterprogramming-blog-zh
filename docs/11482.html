<html>
<head>
<title>How to Setup SonarQube With Flutter Using Docker on Apple Silicon Mac in 8 Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Apple Silicon Mac上使用Docker通过8个步骤设置SonarQube和Flutter</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/flutter-and-sonarqube-for-static-code-analysis-51368a85c51c?source=collection_archive---------1-----------------------#2022-03-24">https://betterprogramming.pub/flutter-and-sonarqube-for-static-code-analysis-51368a85c51c?source=collection_archive---------1-----------------------#2022-03-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cbd0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">静态代码分析用的颤振和声纳立方体</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c381a33bcec6adf9a28437c5f020915c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qXq5FMLITCFasSNQ"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">Alex Kotliarskyi 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="4dff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，如果你正在阅读这篇文章，你可能对<code class="fe lv lw lx ly b">Flutter</code>应用程序开发感兴趣，所以我们可以跳过那里的介绍。</p><p id="bfbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那<code class="fe lv lw lx ly b">SonarQube</code>呢？这是任何开发人员都应该知道的工具之一:<em class="lz">高代码质量的守护者</em>。</p><p id="9092" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有什么是<code class="fe lv lw lx ly b">Docker</code>？这是一个开源的容器化平台。想象一下，拥有一个更轻的虚拟机，已经预配置了您需要的一切，只需轻轻一点就可以部署。</p><p id="4a6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">话题上有文章和<code class="fe lv lw lx ly b">YouTube</code>视频的语气，本帖就不细说了。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="a0e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以让我们开始吧:</p><h1 id="e68f" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">1.下载并安装Docker</h1><p id="9fcb" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">前往<a class="ae ky" href="https://docs.docker.com/engine/install/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/engine/install/</a>为你的操作系统安装<code class="fe lv lw lx ly b">Docker Desktop</code>版本。</p><p id="9091" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它支持苹果硅，所以在这方面很大的荣誉。</p><p id="4c71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下载并首次运行后，前往<a class="ae ky" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com</a><em class="lz"/>创建一个帐户。我们可以假设现在我们需要的只是一个免费账户。</p><p id="6337" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你搞不清楚<code class="fe lv lw lx ly b">Docker Id</code>是什么:那是你的用户名。</p><h1 id="4444" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">2.下载SonarQube映像并创建您的容器</h1><p id="a1c7" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">假设您想从免费的<code class="fe lv lw lx ly b">Community version</code>开始，您可以从您的终端运行:</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="1efe" class="ni mi it ly b gy nj nk l nl nm">docker pull sonarqube:9.3-community</span></pre><p id="3f9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您最终可能会看到如下错误:</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="2b7d" class="ni mi it ly b gy nj nk l nl nm">no matching manifest for linux/arm64/v8 in the manifest list entries</span></pre><p id="db6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在撰写本文时，还没有官方的苹果芯片支持，所以如果你想要9+版本的<code class="fe lv lw lx ly b">SonarQube</code>你可以尝试一下，但我不建议这样做，因为它的工作速度非常慢，如果一些任务在苹果芯片上的加载时间超过30秒，至少在第一年，那就不值得了。</p><p id="f3b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的命令将迫使我们为我们的架构下载Docker镜像，但它将作为仿真运行，这意味着超级慢，因此我的评论。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="ed00" class="ni mi it ly b gy nj nk l nl nm">docker pull sonarqube:9.3-community --platform linux/amd64</span></pre><h1 id="922b" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">3.扔掉第二点，我们再试一次！</h1><p id="1346" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">因此，让我们忘记这一点，并找到一个非官方的Docker图像，可以为我们的硅芯片工作(如果你想知道，这不是一些随机的图像，这是很多开发人员正在使用的东西):</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="415d" class="ni mi it ly b gy nj nk l nl nm">docker pull mwizner/sonarqube:8.9.5-community</span></pre><p id="d418" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是创建我们的容器/应用程序，但是首先，我们将检查我们刚刚下载的图像。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="bbe4" class="ni mi it ly b gy nj nk l nl nm">docker images<br/></span><span id="0fe7" class="ni mi it ly b gy nn nk l nl nm"><em class="lz">REPOSITORY           TAG               IMAGE ID       </em></span><span id="7962" class="ni mi it ly b gy nn nk l nl nm"><em class="lz">mwizner/sonarqube    8.9.5-community   f5e2e7d2d122   </em></span></pre><p id="5cb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们给我们的容器命名为<code class="fe lv lw lx ly b">sonarqubeapp</code>,并使用上面的图像ID:</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="1ae3" class="ni mi it ly b gy nj nk l nl nm">docker create --name sonarqubeapp -p 9000:9000 f5e2e7d2d122</span></pre><p id="24c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们开始我们的容器:</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="16df" class="ni mi it ly b gy nj nk l nl nm">docker start sonarqubeapp</span></pre><p id="2f32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">加载<em class="lz">15-20秒后，</em>你就可以去<a class="ae ky" href="http://localhost:9000" rel="noopener ugc nofollow" target="_blank"> http://localhost:9000 </a>拥有一个正在运行的网站了。开始时，使用<em class="lz"> admin/admin </em>作为用户名和密码。</p><h1 id="5906" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">4.获得一个分析飞镖和颤振的插件</h1><p id="df0a" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">在撰写本文的时候，还没有来自<code class="fe lv lw lx ly b">SonarQube</code>的对<code class="fe lv lw lx ly b">Dart</code>和<code class="fe lv lw lx ly b">Flutter</code>的官方支持，但是<code class="fe lv lw lx ly b">GitHub</code>和社区万岁。</p><p id="001e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">已经有一个插件/扩展可以在<a class="ae ky" href="https://github.com/insideapp-oss/sonar-flutter" rel="noopener ugc nofollow" target="_blank">https://github.com/insideapp-oss/sonar-flutter</a>下载。</p><p id="9bf8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">去<code class="fe lv lw lx ly b">Releases</code>拿最新的。在我们的例子中，它意味着<a class="ae ky" href="https://github.com/insideapp-oss/sonar-flutter/releases/download/0.4.0/sonar-flutter-plugin-0.4.0.jar" rel="noopener ugc nofollow" target="_blank">声纳-颤振-插件-0.4.0.jar </a></p><h1 id="2ad9" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">5.复制。容器的jar插件</h1><p id="aaaa" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">前往<code class="fe lv lw lx ly b">Downloads</code>文件夹或下载插件的地方，运行这个命令</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="42b4" class="ni mi it ly b gy nj nk l nl nm">docker cp sonar-flutter-plugin-0.4.0.jar sonarqubeapp:/opt/sonarqube/extensions/plugins</span></pre><p id="6dc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们正在使用<code class="fe lv lw lx ly b">docker cp</code>进行文件复制，因为从外部来看容器的文件系统是不可见的。如果你愿意，类似于iOS上的沙盒。</p><p id="38c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">sonarqubeapp</code>是容器的名称，在<code class="fe lv lw lx ly b">:</code>之后是容器内插件文件夹的路径。</p><p id="061e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们需要重启容器来刷新插件。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="70ce" class="ni mi it ly b gy nj nk l nl nm">docker restart sonarqubeapp</span></pre><p id="c79a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果到目前为止所有步骤都是成功的，那么在门户内部，我们应该能够看到类似的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/5ee9a8cb417d062c419beba545b3ac4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XZcmUEfGA2MNkridnwywNA.jpeg"/></div></div></figure><h1 id="c668" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">6.下载声纳扫描仪</h1><p id="5ee3" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">扫描仪将使我们能够上传本地结果到门户网站来显示数据。</p><p id="57cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它可以从Docker映像运行并访问源代码库，但是我们现在将关注本地安装。</p><p id="dd39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前往<a class="ae ky" href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/" rel="noopener ugc nofollow" target="_blank">https://docs . sonar qube . org/latest/analysis/scan/sonar scanner/</a>下载归档文件并将其解压缩到您的主文件夹中。</p><p id="7ef8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保将路径添加到您的<code class="fe lv lw lx ly b">.bash_profile</code>或<code class="fe lv lw lx ly b">.zshrc</code>或您系统上可能有的任何shell配置中，以便在任何地方都可以看到该命令，然后重新启动您的终端。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="0746" class="ni mi it ly b gy nj nk l nl nm">export PATH="$HOME/sonar-scanner-4.7.0.2747-macosx/bin:$PATH"</span></pre><h1 id="1316" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">7.创建配置文件</h1><p id="3466" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">最后一步，我们需要在<code class="fe lv lw lx ly b">Flutter</code>项目的根目录下有一个配置文件，它将在源代码和<code class="fe lv lw lx ly b">SonarQube</code>门户之间交换一些信息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="10e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">第2–4行:</strong>在门户中创建新项目后，您将获得它们。</p><h1 id="40ee" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">8.试一试！</h1><p id="3a47" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">在最后一步，让我们把它们放在一起，转到<code class="fe lv lw lx ly b">Flutter</code>项目的根目录，运行下面的代码:</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="6f31" class="ni mi it ly b gy nj nk l nl nm">flutter pub get # just in case<br/>flutter test --machine --coverage &gt; tests.output<br/>sonar-scanner</span></pre><p id="420c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它会将我们的测试结果和关于代码库的详细信息上传到门户网站供我们分析。如果一切顺利的话，它应该看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/fb747d3840958ff3dd2031a9d4516cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLdR6FOCJE84CQj6LA-VcA.jpeg"/></div></div></figure><h1 id="4282" class="mh mi it bd mj mk ml mm mn mo mp mq mr jz ms ka mt kc mu kd mv kf mw kg mx my bi translated">加分</h1><p id="1c6c" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">还记得第三点吗？我们从某处获得了初始图像，然后对其进行配置以适应我们的特殊情况。</p><p id="cdde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们想保存整个设置的图像，以便在另一台Mac上使用，或者甚至向全世界发布，我们可以将我们的容器/应用程序发布为私有或公共存储库。</p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="fb72" class="ni mi it ly b gy nj nk l nl nm"># First head to your Docker Hub account and create a new repository (either private or public)</span><span id="6dac" class="ni mi it ly b gy nn nk l nl nm">docker commit sonarqubeapp</span><span id="13ca" class="ni mi it ly b gy nn nk l nl nm">docker images # get the newly created empty image id</span><span id="4f0f" class="ni mi it ly b gy nn nk l nl nm">docker tag [Empty Image Id] [Docker Id]/[Repository Name]:[Version]</span><span id="6e97" class="ni mi it ly b gy nn nk l nl nm">docker push [Docker Id]/[Image Name]:[Version]</span></pre><p id="2dcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lz">举例:</em></p><pre class="kj kk kl km gt ne ly nf ng aw nh bi"><span id="0d53" class="ni mi it ly b gy nj nk l nl nm">docker commit sonarqubeapp<br/>docker images <br/>docker tag b0dcc123456 myaccount/project-image:1.0<br/>docker push myaccount/project-image:1.0</span></pre><p id="0fe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一次，因为我们已经配置好了一切，我们可以跳过步骤2-5。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h1 id="60b5" class="mh mi it bd mj mk ns mm mn mo nt mq mr jz nu ka mt kc nv kd mv kf nw kg mx my bi translated">最后的想法</h1><p id="5979" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated"><code class="fe lv lw lx ly b">SonarQube</code>是一个优秀的工具，它可以利用代码气味、代码覆盖率、重复行、圈复杂度等统计数据来提高团队的速度和代码质量。</p><p id="2d0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它还可以与CI/CD环境集成，打开一个新的可能性世界，比如装饰您的pull请求或建立您自己团队的质量防护栏(比如，所有推送的代码应该没有代码气味或测试覆盖率超过75%)，这个列表还可以继续下去。</p><p id="87f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而这只是一小部分功能。</p><p id="bcc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">走吧<code class="fe lv lw lx ly b">#data-driven</code>！！！</p></div></div>    
</body>
</html>