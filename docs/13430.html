<html>
<head>
<title>How To Optimize Cloud Cost With Block Storage and Snapshots</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用数据块存储和快照优化云成本</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-optimize-cloud-cost-with-block-storage-and-snapshots-acab43d6699f?source=collection_archive---------10-----------------------#2022-08-25">https://betterprogramming.pub/how-to-optimize-cloud-cost-with-block-storage-and-snapshots-acab43d6699f?source=collection_archive---------10-----------------------#2022-08-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8156" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">各种选择，让您在没有高成本的情况下保持高质量的服务</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8a25070466996db59d47d59c965dbdc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbtzbtV5Ee5JpjGY5XZ02Q.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由Freepik上的vectorjuice设计</p></figure><p id="43d2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">刚接触云的公司通常会过度调配资源以确保性能，从而导致不必要的额外成本。幸运的是，一些实践可以帮助您降低云存储成本，例如块存储和快照。</p><h1 id="3602" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">块存储器</h1><blockquote class="mj mk ml"><p id="2832" class="kv kw mm kx b ky kz jr la lb lc ju ld mn lf lg lh mo lj lk ll mp ln lo lp lq ij bi translated">块存储有时也称为块级存储，是一种用于在存储区域网络(San)或基于云的存储环境中存储数据文件的技术。— <a class="ae mq" href="https://www.ibm.com/cloud/learn/block-storage" rel="noopener ugc nofollow" target="_blank"> IBM </a></p></blockquote><p id="44c0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">像AWS和Digitalocean这样的云提供商提供有本地硬盘的EC2实例和droplets。但是，当实例关闭时，存储在磁盘上的所有数据都会丢失。</p><p id="3239" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">块存储解决方案提供可附加到AWS EC2实例或Digitalocean droplets的持久存储卷。这些卷允许您在特定实例的生存期之后存储数据。</p><p id="229f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">AWS块存储产品称为弹性块存储(EBS ),它将数据存储在块卷中。EBS卷可以用作EC2实例的根分区。由于该卷在删除实例后仍然存在，因此可以用作备份。EBS卷也是可扩展的，可以自动复制。</p><h2 id="dee3" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated">优化EBS批量成本</h2><p id="ac18" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">通过优化EBS的使用，您可以在不影响应用程序性能的情况下降低其成本。您可以使用以下步骤来优化EBS批量成本。</p><h2 id="ea2e" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated"><strong class="ak">选择正确的EBS卷种类</strong></h2><p id="4414" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">AWS提供了四种类型的EBS卷，您可以根据您的预算和应用程序的性能特征进行选择。它们包括<a class="ae mq" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/general-purpose.html" rel="noopener ugc nofollow" target="_blank">通用SSD卷</a>、<a class="ae mq" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/provisioned-iops.html" rel="noopener ugc nofollow" target="_blank">配置IOPS SSD卷</a>、<a class="ae mq" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/hdd-vols.html" rel="noopener ugc nofollow" target="_blank">吞吐量优化HDD和冷HDD卷</a>，以及<a class="ae mq" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes_standard.html" rel="noopener ugc nofollow" target="_blank">上一代磁卷</a>。</p><p id="e4f6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">应用程序架构师应该调配通用SSD (gp2)卷，而不是调配IOPS SSD (io1)卷，除非运行的应用程序是任务关键型的，并且每个卷需要超过10000 IOPS或160 MiB/s的吞吐量。管理员应定期监控所调配卷的读写操作。</p><p id="6daf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果吞吐量低，他们应该降低产量以降低成本。通过使用Kubernetes配置卷，可以使用垂直自动扩展来自动执行此操作。</p><h2 id="1fde" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated"><strong class="ak">选择正确的EBS卷大小</strong></h2><p id="9be6" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">在确定EBS卷的正确大小之前，需要考虑的因素包括应用程序的IOPS、容量和吞吐量要求。</p><h2 id="ba0a" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated"><strong class="ak">利用EBS快照</strong></h2><p id="fcf6" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">EBS快照是EBS卷中数据的时间点“拷贝”。EBS快照的计费费率低于活动EBS卷。当EBS块的访问容量较低时，您可以在将存储在其中的信息复制到EBS快照后删除它。</p><h2 id="2e92" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated"><strong class="ak">删除未连接的EBS卷</strong></h2><p id="0e68" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">删除未使用的EC2实例的管理员可能会忘记删除附加的EBS卷。即使这些卷没有连接到任何实例，它们仍然会被AWS收费。因此，定期检查是否所有EBS卷都在使用，并删除未使用的卷可以降低AWS每月的账单。</p><h2 id="178f" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated"><strong class="ak">删除旧快照</strong></h2><p id="73b8" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">在发生数据丢失或灾难时，快照可用于恢复。然而，没有实际价值的过时快照可能仍然存在于EBS快照中。恢复过程可能只需要备份的几个快照中的最新快照。当许多人被配置时，这样的EBS快照成本可能会滚雪球。</p><p id="005e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当应用程序架构师配置设置以自动备份快照时，他们还应该配置设置以定期删除较旧的快照。管理员必须为每个卷保留多少快照设置策略。</p><h1 id="53cb" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">快照</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/ba2c5dd0b085a7219902bab42e8e775a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NQBGQ4jWCz0xr6_6_05W8g.png"/></div></div></figure><p id="fba9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">快照是备份和恢复块存储卷上数据的一种方式。您可以生成卷快照，为存储在卷上的数据创建时间点备份。</p><p id="b919" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">EBS快照有时也称为AWS快照，是一种备份和恢复EBS卷上数据的方法。发生灾难时，用户可以从最新的快照中恢复数据。EBS快照仅保存上次快照的更改，起到增量备份的作用。</p><p id="9c99" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">快照子系统仅备份已更改的数据块，并创建与恢复整个卷所需的以前快照中的数据块的逻辑链接。稍后，如果删除了这些最后的快照，则仅会清除未链接到任何后续快照的数据块。</p><p id="39ea" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这提供了更快快照的优势，并且能够清除旧快照，而不必担心依赖于以前备份的后续备份。但是，这限制了您使用AWS S3存储桶，因为快照不像普通S3对象那样保存。</p><h2 id="7ec9" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated">EBS快照优点</h2><ol class=""><li id="5cbe" class="nj nk iq kx b ky nd lb ne le nl li nm lm nn lq no np nq nr bi translated">简单灵活的备份和恢复:卷可以恢复到任何快照。</li><li id="3882" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">性价比高。快照比EBS卷占用更少的存储空间，定价也更低。使用EBS快照使用户能够只保存最新版本，从而减少冗余。</li></ol><h2 id="3b36" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated">EBS快照缺点</h2><ol class=""><li id="75fc" class="nj nk iq kx b ky nd lb ne le nl li nm lm nn lq no np nq nr bi translated">您不能在AWS之外复制数据。EBS快照只能存储在AWS S3中；因此，您不能在AWS之外备份数据。</li><li id="c84e" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">快照是特定于区域的。保存EBS快照时，需要指定要保存的区域，并且不能从其他区域访问它。您必须将其复制到这些区域，以便在其他区域可用。这限制了扩展，并导致额外的数据传输成本。它还要求您为拷贝到的每个区域的快照的持久存储付费。</li><li id="3f07" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">累积快照最终会占用太多存储空间，从而增加成本。</li><li id="2794" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">恢复较慢。与其他存储选项相比，恢复需要更长的时间，因为系统向后工作，还原到您选择的时间点。</li></ol><h1 id="349d" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">快照成本</h1><p id="52d2" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">AWS EBS快照有两个价格组成部分:亚马逊S3上的数据传输费和存储成本，这与标准的S3定价不同。</p><h2 id="56f4" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated"><strong class="ak">亚马逊快照:数据传输成本</strong></h2><p id="0433" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">每当创建EBS卷的快照时，AWS都会将打算保存在快照中的数据从Amazon EC2传输到您选择的AWS区域中的S3存储桶。</p><p id="bad1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是当前的AWS转移成本，请记住AWS价格经常变化。请咨询AWS官方定价页面，了解最新定价和其他详细信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AWS S3转移成本</p></figure><p id="6104" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">亚马逊快照:存储成本</strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AWS标准存储成本</p></figure><p id="4fa1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">EBS快照标准版的固定存储成本为0.05美元/GB月。这比S3标准存储层要贵得多，后者每GB月的成本在0.021美元到0.023美元之间(在美国东部地区)。</p><h2 id="184f" class="mr ls iq bd lt ms mt dn lx mu mv dp mb le mw mx md li my mz mf lm na nb mh nc bi translated">如何削减快照成本</h2><p id="dfa3" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">从上面的分析中可以清楚地看到，在S3保存EBS卷快照的方法可以从每月的AWS账单中减少大量费用。您可以通过在Kubernetes集群中运行您的云基础设施来实现这一点。</p><blockquote class="mj mk ml"><p id="08ac" class="kv kw mm kx b ky kz jr la lb lc ju ld mn lf lg lh mo lj lk ll mp ln lo lp lq ij bi translated">Kubernetes是一个可移植、可扩展的开源平台，用于管理容器化的工作负载和服务，有助于声明式配置和自动化。— <a class="ae mq" href="https://kubernetes.io/docs/concepts/overview/" rel="noopener ugc nofollow" target="_blank"> kubernetes.io </a></p></blockquote><h1 id="745f" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated"><strong class="ak"> <em class="nz">藏匿点</em> </strong></h1><p id="ecb5" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">在本文中，我将向您介绍一个名为“Stash”的Kubernetes原生工具。Stash是一款用于备份磁盘和帮助制定重要恢复计划的工具。它是一个Restic操作员，可以加速备份和恢复您的Kubernetes基础设施的任务。</p><p id="75b7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用Stash，您可以备份装载在以下工作负载类型中的Kubernetes卷:</p><ul class=""><li id="fbd6" class="nj nk iq kx b ky kz lb lc le oa li ob lm oc lq od np nq nr bi translated"><code class="fe oe of og oh b">StatefulSet</code></li><li id="8656" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq od np nq nr bi translated"><code class="fe oe of og oh b">ReplicaSet</code></li><li id="0f75" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq od np nq nr bi translated"><code class="fe oe of og oh b">ReplicationController</code></li><li id="f64f" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq od np nq nr bi translated"><code class="fe oe of og oh b">Deployment</code></li><li id="84cb" class="nj nk iq kx b ky ns lb nt le nu li nv lm nw lq od np nq nr bi translated"><code class="fe oe of og oh b">DaemonSet</code></li></ul><blockquote class="mj mk ml"><p id="95e9" class="kv kw mm kx b ky kz jr la lb lc ju ld mn lf lg lh mo lj lk ll mp ln lo lp lq ij bi translated">Stash支持存储数据快照的各种后端，如GCS bucket、AWS S3、Azure Blob Storage等。或者像<a class="ae mq" href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath" rel="noopener ugc nofollow" target="_blank"> HostPath </a>、<a class="ae mq" href="https://kubernetes.io/docs/concepts/storage/volumes/#persistentvolumeclaim" rel="noopener ugc nofollow" target="_blank"> PersistentVolumeClaim </a>、<a class="ae mq" href="https://kubernetes.io/docs/concepts/storage/volumes/#nfs" rel="noopener ugc nofollow" target="_blank"> NFS </a>等Kubernetes持久卷<em class="iq"> — </em> <a class="ae mq" href="https://stash.run/docs/v2021.01.21/guides/latest/backends/overview/" rel="noopener ugc nofollow" target="_blank"> <em class="iq">藏匿</em> </a> <em class="iq">。</em></p></blockquote><p id="26b0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Stash支持S3兼容的存储服务，如AWS S3、<a class="ae mq" href="https://tebi.io/" rel="noopener ugc nofollow" target="_blank"> tebi.io </a>、<a class="ae mq" href="https://min.io/" rel="noopener ugc nofollow" target="_blank"> Minio servers </a>、<a class="ae mq" href="https://rook.io/" rel="noopener ugc nofollow" target="_blank"> Rook Object Store </a>和用于后端的<a class="ae mq" href="https://www.digitalocean.com/products/spaces" rel="noopener ugc nofollow" target="_blank"> DigitalOceans Space </a>。</p><p id="f930" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用stash，我们可以创建K8S (Kubernetes)集群中提供的EBS卷的快照，并将它们作为常规S3对象存储在AWS S3中。我们也可以将它们保存在任何其他S3对象存储提供商处。您可以从任何AWS区域访问此类存储，而无需将快照存储在该区域中。这也有助于提高应用程序的可伸缩性。</p><p id="1a48" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据你的项目类型，你甚至可以免费使用像<a class="ae mq" href="https://rook.io/" rel="noopener ugc nofollow" target="_blank"> rook.io </a>这样的开源S3提供者。像<a class="ae mq" href="https://tebi.io" rel="noopener ugc nofollow" target="_blank"> tebi.io </a>这样的提供商提供永久免费层(25GB存储)和按月付费模式(每额外GB 0.02美元)。</p><p id="2658" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可以利用上述选项来帮助有效削减云存储成本，而不会影响应用程序的性能。</p><p id="d663" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢阅读。我希望这有所帮助。如果你有任何问题，请随时回复。</p></div></div>    
</body>
</html>