<html>
<head>
<title>An Interviewer’s Favorite Question: “How Are Python Strings Stored in Internal Memory”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面试官最喜欢的问题:“Python字符串是如何存储在内存中的？”</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/an-interviewers-favorite-question-how-are-python-strings-stored-in-internal-memory-ac0eaef9d9c2?source=collection_archive---------2-----------------------#2021-08-11">https://betterprogramming.pub/an-interviewers-favorite-question-how-are-python-strings-stored-in-internal-memory-ac0eaef9d9c2?source=collection_archive---------2-----------------------#2021-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fe2d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">理解Python字符串的内部实现</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7cbba2972fe804d3139824550c153c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A8jBK_cxH1u25JO8"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@accrualbowtie?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">瑞恩·华莱士</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</p></figure><blockquote class="kz la lb"><p id="28cf" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">本文与<a class="ae ky" href="https://medium.com/u/2d93514313d?source=post_page-----f7b2578c44af--------------------------------" rel="noopener"> <em class="it">穆罕默德·阿布塔希尔</em> </a> <em class="it">合著，你可以在</em><a class="ae ky" href="https://www.linkedin.com/in/abu-tahir-bb05741a2/" rel="noopener ugc nofollow" target="_blank"><em class="it">LinkedIn</em></a><em class="it">和</em><a class="ae ky" href="https://www.instagram.com/learn_ai_stack_/" rel="noopener ugc nofollow" target="_blank"><em class="it">insta gram</em></a><em class="it">上找到他。</em></p></blockquote><p id="cae8" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">弦乐！所有编程面试官最喜欢的话题之一，无论选择什么编程语言，都受到每个开始编程的人的喜爱。玩字符串极其有趣，但是你知道Python是如何在内部存储字符串的吗？</p><p id="09fc" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">如果我问你一个类似“字符串中允许重复吗？”。你们大多数人会说是！举个例子，比如“妈妈”我们在这里可以看到字符“m”在重复，但事实真的是这样吗？</p><p id="e068" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在本文中，我将向您清晰地展示字符串是如何存储在内存中的，我保证您对字符串的看法将会完全改变。</p><p id="2d0a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我想给读者的一个重要建议是，从记忆的角度理解编程语言是学习编程语言最有效的方法！我敢打赌，一旦你尝试过，你将很难忘记编程的核心概念。</p><p id="4596" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">说了这么多，让我们进入正题。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="27b8" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">Python中的字符串只是用引号括起来的Unicode字符序列。请记住，在Python中可以有单引号、双引号，甚至三个单引号或三个双引号。</p><p id="d480" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">就Python而言，字符串在内存开销方面效率极高。所以我们来了解一下原因！</p><p id="89ce" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">如果你深入挖掘，结果是字符串使用'互联网字典'<strong class="lf iu"> </strong>这是一个简单的字典，将字符存储为键，地址存储为值。让我们借助一个例子来理解这一点:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="746d" class="mo mp it mk b gy mq mr l ms mt">s = “Hello world”</span></pre><p id="9b92" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在上面的行中，我创建了一个字符串<code class="fe mu mv mw mk b">Hello world</code>，并将其存储在一个名为<code class="fe mu mv mw mk b">s</code>的变量中。抽象地说，我们可以想象它在内存中的表现，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/db139de8119f1dea912492235035f445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vt1QNGyVgbvZcpq7k4SaFg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者'<a class="ae ky" href="https://www.linkedin.com/in/abu-tahir-bb05741a2/" rel="noopener ugc nofollow" target="_blank"><strong class="bd my">Muhammad Abutahir</strong></a>'创建的图像:内存中对象的表示</p></figure><p id="272c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">现在让我们看看内部实际发生了什么，以及一本内部词典是如何工作的。让我通过创建一个字符串<code class="fe mu mv mw mk b">s1</code>并将其赋给一个新变量<code class="fe mu mv mw mk b">s2</code>来给你一个例子。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="22c2" class="mo mp it mk b gy mq mr l ms mt">s1 = ‘A’ #Single character string<br/>s2 = s1<br/>print(s1)# A<br/>print(s2)# A<br/>print(id(s1))#12345<br/>print(id(s2))#12345</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/daea3adfd6bbc0bcfaff5103dfd1b17f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*di3KAgIBpZT7pKt7JQkR5Q.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者<strong class="bd my">'</strong><a class="ae ky" href="https://www.linkedin.com/in/abu-tahir-bb05741a2/" rel="noopener ugc nofollow" target="_blank"><strong class="bd my">Muhammad Abutahir</strong></a>'创建的图像:显示字符串实习</p></figure><p id="9905" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">好吧！让我们来分解一下上面的图像:当我们创建第一个字符串<code class="fe mu mv mw mk b">s1</code>时，在内存中创建了一个字符串对象，之后开始了字符串实习的过程。如果字符“A”存在，Python将首先在内部字典中查找，因为它最初是空的。创建一个新的键-值对，字符“A”被设置为<code class="fe mu mv mw mk b">key</code>，它所在的对象的<code class="fe mu mv mw mk b">location</code>被设置为值<code class="fe mu mv mw mk b">123</code>。</p><p id="7917" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">注意:<code class="fe mu mv mw mk b">123</code>只是一个假设的id。</p><p id="3bb6" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在下一步中，当我们将字符串<code class="fe mu mv mw mk b">s1</code>分配给<code class="fe mu mv mw mk b">s2</code>时，<code class="fe mu mv mw mk b">s1</code>中的地址被发送给<code class="fe mu mv mw mk b">s2</code>并且<code class="fe mu mv mw mk b">s2</code>开始指向同一个对象！我们称之为引用型赋值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/42f114ee6d12f382fed60f9137a35fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_FuhZn8HNZhv0VwsonUHOg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者'<a class="ae ky" href="https://www.linkedin.com/in/abu-tahir-bb05741a2/" rel="noopener ugc nofollow" target="_blank"><strong class="bd my">Muhammad Abutahir</strong></a>'创建的图像:引用类型赋值和字符串实习</p></figure><p id="2b2e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">好了，现在清楚了！但是为什么我告诉你字符串是非常高效的内存呢？原因如下。</p><h1 id="ff06" class="mz mp it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">为什么字符串的内存效率极高</h1><p id="3e76" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll lz ns lo lp ma nt ls lt mb nu lw lx ly im bi translated">正如我们前面看到的，字符串使用内部字典，它与普通字典非常相似。我们知道字典不允许重复的键，所以一个键应该是唯一的！那么这个概念在字符串中是如何应用的呢？</p><p id="778e" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">让我们借助“多字符”字符串来清楚地理解它，如下所示:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="7d2e" class="mo mp it mk b gy mq mr l ms mt">s1 = ‘Hello’ #Multi character string<br/>s2 = ‘World’<br/>print(s1)#Hello<br/>print(s2)#World<br/>print(id(s1))#123123<br/>print(id(s2))#454545</span></pre><p id="8b68" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">上面的概念非常清楚，但是如果我将同时出现在两个字符串中的字符的<code class="fe mu mv mw mk b">ids</code>打印为common，会发生什么呢？</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="050f" class="mo mp it mk b gy mq mr l ms mt"># Printing the ids of character ‘o’<br/>print(id(s1[4]))#1004<br/>print(id(s2[1]))#1004</span></pre><p id="a369" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">哇！很不寻常，对吧？具有唯一地址的不同对象中的一个字符如何具有相同的id？！让我们借助下图来理解它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/0ebf031948d2a104345b8f0b09cb9ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eQNi74qAjAD7Rg9fzCEnCg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">由作者'<a class="ae ky" href="https://www.linkedin.com/in/abu-tahir-bb05741a2/" rel="noopener ugc nofollow" target="_blank"><strong class="bd my">Muhammad Abutahir</strong></a>'创建的图像:完整的字符串实习过程</p></figure><p id="490f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">所以，我从创建一个字符串<code class="fe mu mv mw mk b">s1</code>开始，重要的是要理解字符串的实习过程是在创建对象的同时开始的。一个多字符的字符串是一个完整的对象，但是从上图中你可以注意到，单个的字符也是对象，它们有自己唯一的id。</p><p id="50fa" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在字符串存储的过程中，单个字符在内存中被创建。Python将查看interned dictionary以查看这些字符是否已经存在，如果不存在，则创建一个对象，并将地址和字符一起作为<code class="fe mu mv mw mk b">key</code>存储在interned dictionary中。</p><p id="d344" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在上图中，我们的字符串从<code class="fe mu mv mw mk b">H</code>开始，所以Python查看容器。因为它是空的，所以它将<code class="fe mu mv mw mk b">H</code>存储为<code class="fe mu mv mw mk b">key</code>，并将它的地址存储为其中的<code class="fe mu mv mw mk b">value</code>。接下来，对以下两个字母<code class="fe mu mv mw mk b">E</code>和<code class="fe mu mv mw mk b">L</code>重复同样的事情。下一个字母又是<code class="fe mu mv mw mk b">L</code>，于是Python查字典。由于它已经存在，Python不会创建新的对象，而是将前一个<code class="fe mu mv mw mk b">L</code>的地址返回到索引位置，这个过程继续。</p><p id="e73c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">最有趣的部分是，这不仅仅是存储在不同变量中的单个字符串的情况！整个Python程序本身只有一个通用的内部字典。因此，即使字符串出现在不同的变量中，它们都将共享相同的地址，用于出现在内部字典中的唯一字符！这将使它非常节省内存！<strong class="lf iu"> </strong>还有，<strong class="lf iu"> </strong>关于重复，从记忆的角度考虑，是不允许的。</p><h1 id="ca81" class="mz mp it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">摘要</h1><p id="3694" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll lz ns lo lp ma nt ls lt mb nu lw lx ly im bi translated">在本文中，我讨论了字符串的内部实现和Python中字符串实习的过程。正如我之前提到的，从内存角度理解编程语言是掌握该语言基本概念的秘诀。</p><p id="555d" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">字符串实习是一个过程，确保只为一个唯一的字符分配一个单独的内存位置，在将来，如果出现相同的字符，那么它将返回以前存储的地址。</p></div></div>    
</body>
</html>