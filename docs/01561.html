<html>
<head>
<title>Context Managers in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的上下文管理器</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/context-managers-in-python-dbfaf568092?source=collection_archive---------8-----------------------#2019-09-24">https://betterprogramming.pub/context-managers-in-python-dbfaf568092?source=collection_archive---------8-----------------------#2019-09-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7f8366b4983a584bdd39f5141d0b59d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3cKkIJtT0akMf64p"/></div></div><p class="kb kc gj gh gi kd ke bd b be z dk translated">泰勒·达维在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="17dd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我们将深入研究Python中的上下文管理器。我会长话短说——少说话，多做事！我希望你喜欢它。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="ee2e" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">为什么是上下文管理器？</h1><p id="0f03" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">上下文管理器用于归还资源。我的意思是:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="4999" class="mx lm it mt b gy my mz l na nb">f = open('file.txt', 'w')<br/>f.write('Something to write')</span></pre><p id="5803" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们打开了一个名为<code class="fe nc nd ne mt b">file.txt</code>的文件，并编写了它。等等——我们没有关闭这个文件，所以我们仍然可以使用<code class="fe nc nd ne mt b">f</code>实例:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="9596" class="mx lm it mt b gy my mz l na nb">f = open('file.txt', 'w')<br/>f.write('Something to write')<br/>print('another work')<br/>f.write('I can still write to file.txt')</span></pre><p id="2f6d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个问题——资源不是无限的，所以我们用完后必须归还。我们是这样做的:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="19b4" class="mx lm it mt b gy my mz l na nb">f = open('file.txt', 'w')<br/>f.write('Something to write')<br/>f.close()</span></pre><p id="091f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了<code class="fe nc nd ne mt b">f.close()</code>，我们关闭了<code class="fe nc nd ne mt b">file.txt</code>，所以不能再使用这个<code class="fe nc nd ne mt b">f</code>:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="9937" class="mx lm it mt b gy my mz l na nb">f = open('file.txt', 'w')<br/>f.write('Something to write')<br/>f.close()<br/>print(f.closed) # returns True</span></pre><p id="858d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nc nd ne mt b">print(f.closed)</code>会打印<code class="fe nc nd ne mt b">True</code>因为<code class="fe nc nd ne mt b">f</code>关闭，感谢<code class="fe nc nd ne mt b">f.close()</code>。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="07ee" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">我们如何使用上下文管理器？</h1><p id="2d48" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">用一个<code class="fe nc nd ne mt b">with</code>语句。让我给你举个例子:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="f757" class="mx lm it mt b gy my mz l na nb">with open('file.txt', 'w') as f:<br/>    f.write('Something to write')</span></pre><p id="9904" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是等等——哪里有<code class="fe nc nd ne mt b">f.close()</code>？不要担心，<code class="fe nc nd ne mt b">with</code>语句会处理这个问题并关闭文件:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="0af6" class="mx lm it mt b gy my mz l na nb">with open('file.txt', 'w') as f:<br/>    f.write('Something to write')<br/>print(f.closed)</span></pre><p id="8632" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看——我告诉过你<code class="fe nc nd ne mt b">print(f.closed)</code>会打印<code class="fe nc nd ne mt b">True</code>！</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="9ff3" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">太好了！那么，我该怎么写我的呢？</h1><p id="cdb5" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">让我来帮你创造你自己的。有两种方法可以做到这一点——我更喜欢用<code class="fe nc nd ne mt b">class</code>来做，但我会向你展示这两种方法。</p><h2 id="7de3" class="mx lm it bd ln nf ng dn lr nh ni dp lv kr nj nk lz kv nl nm md kz nn no mh np bi translated">方法一</h2><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="1648" class="mx lm it mt b gy my mz l na nb">class OpenFile:<br/>    def __init__(self, file, mode):<br/>        self.file = file<br/>        self.mode = mode<br/><br/>    def __enter__(self):<br/>        self.f = open(self.file, self.mode)<br/>        return self.f<br/><br/>    def __exit__(self, exc_type, exc_val, exc_tb):<br/>        self.f.close()</span></pre><h2 id="04a1" class="mx lm it bd ln nf ng dn lr nh ni dp lv kr nj nk lz kv nl nm md kz nn no mh np bi translated"><strong class="ak">方法二</strong></h2><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="2942" class="mx lm it mt b gy my mz l na nb">from contextlib import contextmanager<br/><br/><br/>@contextmanager<br/>def OpenFile(file, mode):<br/>    f = open(file, mode)<br/>    yield f<br/>    f.close()</span></pre><h2 id="3f05" class="mx lm it bd ln nf ng dn lr nh ni dp lv kr nj nk lz kv nl nm md kz nn no mh np bi translated"><strong class="ak">试试看！</strong></h2><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="ec47" class="mx lm it mt b gy my mz l na nb">with OpenFile('file.txt', 'w') as f:<br/>    f.write('Something to write to mine')<br/>print(f.closed)</span></pre></div></div>    
</body>
</html>