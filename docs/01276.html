<html>
<head>
<title>Getting Started With Serverless Angular Universal on AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda无服务器Angular Universal入门</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/getting-started-with-serverless-angular-universal-on-aws-lambda-8754bcc4dc19?source=collection_archive---------10-----------------------#2019-08-28">https://betterprogramming.pub/getting-started-with-serverless-angular-universal-on-aws-lambda-8754bcc4dc19?source=collection_archive---------10-----------------------#2019-08-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7cfd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建一个SEO友好的Angular应用程序，并将其部署在无服务器框架上</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d641fee86e4c4486ebf47e40eb521516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RPymkR0luUtgcUmz.png"/></div></div></figure><p id="c5f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以使用<a class="ae lq" href="https://angular.io/guide/universal" rel="noopener ugc nofollow" target="_blank"> Angular Universal </a>构建搜索引擎优化(SEO)友好的单页应用程序(SPA ),这是一种在服务器上运行Angular应用程序的技术。此外，您可以使用作为亚马逊网络服务(AWS)的一部分提供的事件驱动的无服务器计算平台<a class="ae lq" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>来降低运行这些应用程序的成本。这篇文章将向您展示如何使用<a class="ae lq" href="https://serverless.com/framework/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>在AWS Lambda上构建和部署Angular Universal项目，这是一个用于构建和部署无服务器应用程序的开源命令行界面。</p><p id="912d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这篇文章中，我们将:</p><ul class=""><li id="73d3" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">创建一个包含两条路线并调用外部API的Angular应用程序</li><li id="7120" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">添加用于SEO目的的服务器端渲染</li><li id="9382" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">设置一个<a class="ae lq" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>框架配置</li><li id="43d4" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">在AWS Lambda上部署应用程序</li></ul><p id="e09a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要完成这些任务，您需要<a class="ae lq" href="http://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">创建一个AWS帐户</a>并安装以下内容:</p><ul class=""><li id="689a" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><a class="ae lq" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js和npm</a>(node . js安装也会安装NPM。)</li><li id="d721" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated"><a class="ae lq" href="https://cli.angular.io/" rel="noopener ugc nofollow" target="_blank">角度CLI </a></li><li id="fae4" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated"><a class="ae lq" href="http://docs.aws.amazon.com/cli/latest/userguide/installing.html" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a></li></ul><p id="382d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要配置AWS CLI，您需要从您的AWS帐户获得以下信息:</p><ul class=""><li id="f45a" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">访问密钥ID</li><li id="f11e" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">秘密钥匙</li><li id="7b33" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">默认区域</li></ul><p id="31ed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您的根用户将拥有将Angular应用程序作为Lambda函数进行部署和运行所需的所有权限。通过在身份和访问管理(IAM)控制台中生成新的访问密钥ID和密钥对，您可以获得root用户的访问密钥ID和密钥。</p><p id="da80" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你不想在这个项目中使用你的根用户ID，你可以<a class="ae lq" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/integrating-api-with-aws-services-lambda.html#api-as-lambda-proxy-setup-iam-role-policies" rel="noopener ugc nofollow" target="_blank">为一个API设置一个IAM角色和策略来调用Lambda函数</a>。这个过程有许多步骤，如果您不熟悉AWS，不建议您这样做。</p><p id="141a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在继续之前，请确保您已成功完成所有这些任务。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="006f" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">成立Angular项目，运营Hello World！</h1><p id="d447" class="pw-post-body-paragraph ku kv it kw b kx nm ju kz la nn jx lc ld no lf lg lh np lj lk ll nq ln lo lp im bi translated">在每个Angular项目中，我们必须采取的第一步是软件包的初始化和安装:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="ef91" class="nw mn it ns b gy nx ny l nz oa">ng new angularSeo --style css --routing false<br/>cd angularSeo</span></pre><p id="4376" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们对生成的项目做一些小的修改。首先，让我们给<code class="fe ob oc od ns b">src/index.html</code>文件中的<code class="fe ob oc od ns b">&lt;app-root&gt;</code>添加一些样式。用以下代码替换现有代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="8832" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，将现有的<code class="fe ob oc od ns b">src/app/app.component.html</code>内容替换为:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="b08f" class="nw mn it ns b gy nx ny l nz oa">&lt;h1&gt;Hello World!&lt;/h1&gt;</span></pre><p id="1396" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，将以下内容添加到<code class="fe ob oc od ns b">src/styles.css</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="9efd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意，在上面，我们使用了我最喜欢的花哨背景:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/bc774d192d79cd16eb645013b6341b30.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/0*VfgdYTJKDRZMq9Ak.png"/></div></figure><p id="f8c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下载它，并把它放在<code class="fe ob oc od ns b">src/assets/img</code>目录中。</p><p id="c1d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们通过键入以下命令来运行应用程序:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="7c7d" class="nw mn it ns b gy nx ny l nz oa">ng serve</span></pre><p id="5d6f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开后，您应该会在浏览器中看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/daf575deb527a2c74ceb66214da33228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*euVXxZ60eGtXKwyY.png"/></div></figure><p id="9a74" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以在可以克隆的GitHub存储库中找到到目前为止的所有代码:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="daee" class="nw mn it ns b gy nx ny l nz oa">git clone -b tutorial1_step1 https://github.com/maciejtreder/angular-seo.git angularSeo<br/>cd angularSeo/<br/>npm install<br/>ng serve</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="4e85" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">组件、工艺路线和服务</h1><p id="644c" class="pw-post-body-paragraph ku kv it kw b kx nm ju kz la nn jx lc ld no lf lg lh np lj lk ll nq ln lo lp im bi translated">到目前为止，我们的应用程序并不复杂。让我们向它添加一些路由、组件和服务:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="0505" class="nw mn it ns b gy nx ny l nz oa">ng g c first<br/>ng g c second<br/>ng g c menu<br/>ng g s echo</span></pre><p id="0594" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好的，我们有很多文件。我们就从<code class="fe ob oc od ns b">src/app/first/first.component.ts</code>开始；这真的很简单。用以下内容替换默认内容:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="f588" class="nw mn it ns b gy nx ny l nz oa">import { Component } from '@angular/core';</span><span id="7ea6" class="nw mn it ns b gy oi ny l nz oa">@Component({<br/>   template: '&lt;h1&gt;Hello World!&lt;/h1&gt;'<br/>})<br/>export class FirstComponent {}</span></pre><p id="dcc3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">编辑第二个组件<code class="fe ob oc od ns b">src/app/second/second.component.ts</code>，它稍微复杂一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="34ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="oj">注意:你的开发环境或者linter可能会调出</em> <code class="fe ob oc od ns b">makeCall()</code> <em class="oj">。不要担心这个问题:我们将在创建服务时解决这个问题。</em></p><p id="69f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在这里介绍了一些机制。首先是使用外部模板和外部样式(<code class="fe ob oc od ns b">templateUrl</code>和<code class="fe ob oc od ns b">stylesUrls</code>)。Angular让我们能够在组件类之外创建HTML模板和CSS样式表。</p><p id="05fa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二个组件<code class="fe ob oc od ns b">src/app/second/second.component.html</code>的模板应该是这样的:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="5a40" class="nw mn it ns b gy nx ny l nz oa">&lt;h1&gt;Second component&lt;/h1&gt;<br/>&lt;h2&gt;This component injects EchoService&lt;/h2&gt;<br/>Response is: &lt;span&gt;{{response | async | json}}&lt;/span&gt;</span></pre><p id="f63d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">样式表<code class="fe ob oc od ns b">src/app/second/second.component.css</code>应该是这样的:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="c586" class="nw mn it ns b gy nx ny l nz oa">span {<br/>   color: purple;<br/>   display: block;<br/>   background: #ccc;<br/>   padding: 5px;<br/>}</span></pre><p id="37ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在这个组件中引入的另一个机制是<em class="oj">依赖注入</em>。如果您仔细查看<code class="fe ob oc od ns b">second.component.ts</code>中的构造函数，您会看到一个类型为<code class="fe ob oc od ns b">EchoService</code>的参数。Angular将尝试初始化一个<code class="fe ob oc od ns b">EchoService</code>类型的对象，并在初始化时将它传递给我们的<code class="fe ob oc od ns b">SecondComponent</code>类。依赖注入是一种用于实现被称为<em class="oj">控制反转</em> (IoC)的架构范例的技术。</p><p id="e736" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还在模板中引入了一个<code class="fe ob oc od ns b">Observable</code>类型和一个<code class="fe ob oc od ns b">async</code>管道。你熟悉<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">承诺</a>吗？可观测性更进了一步。这种异步类型发出由其他函数推送给它的值。您可以根据需要多次重用它，订阅多个侦听器，等等(映射、过滤、传递到另一个可观察对象，等等)。).你可以在<a class="ae lq" href="https://github.com/ReactiveX/rxjs" rel="noopener ugc nofollow" target="_blank"> RxJS GitHub页面</a>了解更多信息。</p><p id="9871" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe ob oc od ns b">second.component.html</code>模板中的“异步”管道是一个特殊的角度机制，只有当我们的变量被求值时才在视图模板中显示它。换句话说，运行时推送到HTML的值是由<code class="fe ob oc od ns b">EchoService</code> observable发送的。</p><p id="94f1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，但同样重要的是，我们实现了<code class="fe ob oc od ns b">OnInit</code>接口和<code class="fe ob oc od ns b">ngOnInit</code>生命周期挂钩。TypeScript中的接口与其他语言中的接口工作方式相同；如果实现它，就必须实现其中声明的所有方法。在这个特殊的例子中，我们需要实现<code class="fe ob oc od ns b">ngOnInit()</code>方法。该方法是“角度生命周期挂钩”之一，由角度引擎在视图初始化、销毁和其他事件的不同阶段自动调用。根据角度文件:</p><blockquote class="ok ol om"><p id="0779" class="ku kv oj kw b kx ky ju kz la lb jx lc on le lf lg oo li lj lk op lm ln lo lp im bi translated">ngOnInit在Angular首先显示数据绑定属性并设置指令/组件的输入属性后初始化指令/组件。调用一次，先<code class="fe ob oc od ns b">ngOnChanges()</code>后。</p></blockquote><p id="e559" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在第二个组件中注入了一个服务。现在我们可以创建它了。用以下内容替换<code class="fe ob oc od ns b">src/app/echo.service.ts</code>的默认内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="ad32" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个服务只包含一个方法，它向<code class="fe ob oc od ns b">https://jsonplaceholder.typicode.com/posts/1</code> <strong class="kw iu"> </strong> URL发出GET请求。</p><p id="3d55" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好的。这个魔术看起来很棒，但是你可能会问“Angular怎么知道注入什么，在哪里注入，以及所有这些类在哪里初始化？”。这些都是很好的问题！答案是:<code class="fe ob oc od ns b">NgModule</code>，我们app的入口。是时候看看它内部发生了什么，并再导入一个模块，这是<code class="fe ob oc od ns b">EchoService</code> : <code class="fe ob oc od ns b">HttpClientModule</code> ( <code class="fe ob oc od ns b">src/app/app.module.ts</code>)所必需的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="f74c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们这里有什么..？</p><ul class=""><li id="d8ab" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">进口—链接到其他<code class="fe ob oc od ns b">NgModules</code></li><li id="b9af" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">声明—应用程序中使用的组件列表</li><li id="7f1d" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">bootstrap——我们希望作为“主”组件加载的组件的名称</li><li id="7fb1" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">提供者—应用程序中使用的服务列表</li></ul><p id="62ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好了，现在该声明路由了。首先创建一个路由模块:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="4f29" class="nw mn it ns b gy nx ny l nz oa">ng generate module app-routing --flat --module=app</span></pre><p id="5132" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在可以将我们的路由添加到<code class="fe ob oc od ns b">src/app/app-routing.module.ts</code>，从中导出<code class="fe ob oc od ns b">RouterModule</code>，并删除冗余代码(<code class="fe ob oc od ns b">declarations</code>数组和<code class="fe ob oc od ns b">CommonModule</code>导入):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="3761" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以在<code class="fe ob oc od ns b">MenuComponent</code>文件中添加一些链接，<code class="fe ob oc od ns b">src/app/menu/menu.component.ts</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="d970" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您是否看到了<code class="fe ob oc od ns b">routerLink</code>和AppModule中声明的路由之间的联系？太好了！这就是我们如何在Angular中链接东西:<code class="fe ob oc od ns b">routerLink</code>是一个Angular内置指令，它将<code class="fe ob oc od ns b">path</code>作为一个参数，并将其与在<code class="fe ob oc od ns b">RouterModule.forRoot()</code>中声明的<code class="fe ob oc od ns b">path</code>相匹配。当有匹配时，它将给定的组件加载到一个<code class="fe ob oc od ns b">&lt;router-outlet&gt;</code>组件中，我们现在要把它添加到<code class="fe ob oc od ns b">src/app/app.component.html</code>中。将此文件中的代码替换为:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="4144" class="nw mn it ns b gy nx ny l nz oa">&lt;app-menu&gt;&lt;/app-menu&gt;&lt;router-outlet&gt;&lt;/router-outlet&gt;</span></pre><p id="544e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的应用已经准备好了。是时候启动了:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="0f5d" class="nw mn it ns b gy nx ny l nz oa">ng serve -o</span></pre><p id="4af7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是您应该在浏览器中看到的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/61bcc892757804bea4a6f2a781f34099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*uBcIOYtxTsPDFWBV.png"/></div></figure><p id="9d11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您单击“第二个组件”按钮时，如果一切正常，您将看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/c3066a23ae7cee00eb11178fd17fdfad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*tmz-9iWW27Qx6Vgt.png"/></div></figure><p id="61ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到目前为止的所有代码都在这个GitHub库中，您可以克隆它:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="7c10" class="nw mn it ns b gy nx ny l nz oa">git clone -b tutorial1_step2 https://github.com/maciejtreder/angular-seo.git angularSeo<br/>cd angularSeo/<br/>npm install<br/>ng serve -o</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="fc8e" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">搜索引擎优化</h1><p id="c378" class="pw-post-body-paragraph ku kv it kw b kx nm ju kz la nn jx lc ld no lf lg lh np lj lk ll nq ln lo lp im bi translated">我们的应用看起来可以部署了。但是如果我们像网络爬虫一样“思考”,就会出现一些问题。</p><p id="7a9d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行我们的应用:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="ffbc" class="nw mn it ns b gy nx ny l nz oa">ng serve</span></pre><p id="74fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">看看我们的网站。您可以通过检查页面源代码或运行下面的<code class="fe ob oc od ns b">curl</code>命令来实现这一点(如果您安装了cURL):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="4759" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里有什么问题？单页应用程序是如何工作的？事实上，它们是纯HTML，附带了大量的JavaScript并在用户的浏览器中执行。</p><p id="d1a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">爬虫能做同样的事情吗？GoogleBot可以呈现JavaScript，但其他爬虫(如脸书、LinkedIn、Twitter、Bing)不能。此外，网站“看起来”像静态的，并且不期望爬虫程序需要额外的资源来读取它们，因为它们的性能更好，所以在搜索引擎排名中的位置更高。</p><p id="5a44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们如何解决这个问题？超级简单！在命令行中键入以下内容:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="51d2" class="nw mn it ns b gy nx ny l nz oa">ng add @ng-toolkit/universal</span></pre><p id="6e37" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">刚刚发生了什么？@ng-toolkit用<a class="ae lq" href="https://angular.io/guide/universal" rel="noopener ugc nofollow" target="_blank"> Angular Universal </a>功能更新了我们的项目，这是在服务器上运行Angular应用程序的技术。我们创建了几个新文件。</p><p id="8ee3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对<code class="fe ob oc od ns b">src/app/app.module.ts</code>文件进行了修改，这是我们应用程序的入口点。@ng-toolkit所做的是从<code class="fe ob oc od ns b">@NgModule</code>注释中移除<code class="fe ob oc od ns b">bootstrap</code>属性，移除<code class="fe ob oc od ns b">BrowserModule</code>并将<code class="fe ob oc od ns b">NgtUniversalModule</code>和<code class="fe ob oc od ns b">CommonModule</code>添加到导入数组中。</p><p id="aac7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的app现在在哪里自举？其实看情况。如果您正在寻找浏览器使用的引导程序，我们应该导航到<code class="fe ob oc od ns b">src/app/app.browser.module.ts</code>，这是它所在的位置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="8149" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">@ng-toolkit还完成了<code class="fe ob oc od ns b">src/app/app.server.module.ts</code>的创建。这是将在服务器端执行的代码的入口点。</p><p id="93dd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们可以看看项目配置文件，<code class="fe ob oc od ns b">angular.json</code>。我们会发现我们的项目中增加了一个新的建设者。</p><p id="f2e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(代码块中的省略号(“<code class="fe ob oc od ns b">...</code>”)表示为简洁起见而修订的部分。)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="fbc9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，这个构建的入口文件是<code class="fe ob oc od ns b">src/main.server.ts</code>，它也被添加到我们的项目中。通过查看这个文件，我们可以确定Angular编译器用来创建服务器端版本的入口点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="3cd8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里是:<code class="fe ob oc od ns b">src/app/app.server.module.ts</code>，它是服务器端渲染，相当于<code class="fe ob oc od ns b">src/app/app.browser.module.ts</code>，启动应用程序进行浏览器渲染的模块。</p><p id="b32a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能已经注意到，<code class="fe ob oc od ns b">@ng-toolkit</code>也对<code class="fe ob oc od ns b">package.json</code>文件进行了修改。我们有几个新的脚本:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="9747" class="nw mn it ns b gy nx ny l nz oa">...<br/>"build:server:prod": "ng run angularSeo:server &amp;&amp; webpack --config webpack.server.config.js --progress --colors",<br/>"build:browser:prod": "ng build --prod",<br/>"build:prod": "npm run build:server:prod &amp;&amp; npm run build:browser:prod", <br/>"server": "node local.js"<br/>...</span></pre><p id="d097" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最重要的两个在列表的末尾:</p><ul class=""><li id="d185" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><code class="fe ob oc od ns b">build:prod</code>，针对浏览器和服务器构建运行Angular编译器，然后使用@ng-toolkit添加的Webpack配置创建一个<code class="fe ob oc od ns b">server.js</code>文件。</li><li id="1b74" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated"><code class="fe ob oc od ns b">server</code>，用于用编译后的应用程序启动Node.js。</li></ul><p id="f441" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">给他们一个机会:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="6c9d" class="nw mn it ns b gy nx ny l nz oa">npm run build:prod<br/>npm run server</span></pre><p id="5ba5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以尝试像网络爬虫一样行动:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="c873" class="nw mn it ns b gy nx ny l nz oa">curl localhost:8080</span></pre><p id="8361" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">嘣！如果我们检查页面源代码，我们可以看到服务器端生成了什么。查找为按钮生成的链接，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="9788" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您没有看到预期的结果或遇到错误，您可以在这个GitHub存储库中找到到目前为止的所有代码，您可以克隆它:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="26ad" class="nw mn it ns b gy nx ny l nz oa">git clone -b tutorial1_step3 https://github.com/maciejtreder/angular-seo.git angularSeo<br/>cd angularSeo/<br/>npm install<br/>npm run build:prod<br/>npm run server</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="732f" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">部署！</h1><p id="6f02" class="pw-post-body-paragraph ku kv it kw b kx nm ju kz la nn jx lc ld no lf lg lh np lj lk ll nq ln lo lp im bi translated">厉害！我们的应用程序是完全开发和搜索引擎友好。我们已经为部署做好了95%的准备。</p><p id="925c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">剩下的5%我们来讨论一下。</p><p id="ce04" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通常，我们会构建自己的应用程序，并将<code class="fe ob oc od ns b">dist</code>文件夹下的所有内容发布到某个托管服务(例如，亚马逊S3)。“问题”是我们引入了服务器端渲染机制，需要Node.js运行在后端机器上。我们需要每天24小时运行的高成本EC2实例吗？</p><p id="ad41" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">没有。我们将使用AWS Lambda，一个功能即服务(FaaS)环境以及<a class="ae lq" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>。通过再次使用@ng-toolkit，我们将为无服务器框架设置一个基本配置。</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="dea7" class="nw mn it ns b gy nx ny l nz oa">ng add @ng-toolkit/serverless</span></pre><p id="dde4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个命令创建了为无服务器框架提供配置的<code class="fe ob oc od ns b">serverless.yml</code>文件和为AWS Lambda函数提供入口点的<code class="fe ob oc od ns b">lambda.js</code>文件。它还对框架做了一些小的改动。</p><p id="04f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要配置项目在您的默认AWS区域中运行，编辑<code class="fe ob oc od ns b">serverless.yml</code>文件并用您的默认AWS区域的名称替换<code class="fe ob oc od ns b">region:</code>的值。比如把<code class="fe ob oc od ns b">eu-central-1</code>换成<code class="fe ob oc od ns b">us-east-2</code>。</p><p id="26e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在<code class="fe ob oc od ns b">package.json</code>中也有新的脚本。利用其中的一个:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="267f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您应该能够在部署命令输出中找到的URL处导航到您的应用程序，如上所示。如果您更改了<code class="fe ob oc od ns b">serverless.yml</code>中的值，URL将包含您的默认区域。</p><p id="5aeb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您点击“第二组件<strong class="kw iu">”</strong>按钮时，输出应如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/8faa0f59c9fcac1b3901194e0ceff139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*IS7l1m_oYIn_72eE.png"/></div></figure><p id="f8ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，使用curl命令或通过检查页面源代码来检查URL:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="1394" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完美。我们的应用程序在网上直播。</p><p id="95c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以在可以克隆的GitHub存储库中找到到目前为止的所有代码:</p><pre class="kj kk kl km gt nr ns nt nu aw nv bi"><span id="1f4a" class="nw mn it ns b gy nx ny l nz oa">git clone -b tutorial1_step4 https://github.com/maciejtreder/angular-seo.git angularSeo<br/>cd angularSeo/<br/>npm install<br/>npm run build:serverless:deploy</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="e551" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">摘要</h1><p id="a301" class="pw-post-body-paragraph ku kv it kw b kx nm ju kz la nn jx lc ld no lf lg lh np lj lk ll nq ln lo lp im bi translated">今天，我们已经成功地在AWS Lambda上开发和部署了一个Angular应用程序。您已经学习了如何在Angular中引入路由、模块和服务，所有这些都是出于SEO优化目的的服务器端呈现。这些技术使您能够以搜索引擎可访问的方式在web上部署Angular应用程序，同时最小化您的运营成本。有了AWS Lambda，你只需为服务访问者请求所需的计算时间付费，而不是为服务器在线的每分钟付费。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="0bd3" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">资源</h1><p id="b8fb" class="pw-post-body-paragraph ku kv it kw b kx nm ju kz la nn jx lc ld no lf lg lh np lj lk ll nq ln lo lp im bi translated">GitHub资源库:<a class="ae lq" href="https://github.com/maciejtreder/angular-seo/tree/tutorial1_step4" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/maciejtreder/angular-SEO/tree/tutorial 1 _ step 4</a></p><p id="3a1f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另外，查看:<a class="ae lq" href="https://github.com/maciejtreder/ng-toolkit" rel="noopener ugc nofollow" target="_blank">https://github.com/maciejtreder/ng-toolkit</a>了解更多Angular和Angular +无服务器框架特性</p><p id="853b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="oj">也可以联系我:contact@maciejtreder.com或@ maciejtreder on</em><a class="ae lq" href="https://github.com/maciejtreder" rel="noopener ugc nofollow" target="_blank"><em class="oj">GitHub</em></a><em class="oj">，</em><a class="ae lq" href="https://twitter.com/MaciejTreder" rel="noopener ugc nofollow" target="_blank"><em class="oj">Twitter</em></a><em class="oj">，</em><a class="ae lq" href="https://stackoverflow.com/users/2849613/maciej-treder" rel="noopener ugc nofollow" target="_blank"><em class="oj">stack overflow</em></a><em class="oj">，</em><a class="ae lq" href="https://www.linkedin.com/in/maciej-treder/" rel="noopener ugc nofollow" target="_blank"><em class="oj">LinkedIn</em></a><em class="oj">。</em></p></div></div>    
</body>
</html>