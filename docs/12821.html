<html>
<head>
<title>Introducing Jetpack Compose’s New Layout: “LookaheadLayout”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍Jetpack Compose的新布局:“LookaheadLayout”</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/introducing-jetpack-composes-new-layout-lookaheadlayout-eb30406f715?source=collection_archive---------0-----------------------#2022-07-05">https://betterprogramming.pub/introducing-jetpack-composes-new-layout-lookaheadlayout-eb30406f715?source=collection_archive---------0-----------------------#2022-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5b68" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建最佳动画的布局</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d6f96cf4570e0ec523d10a430211c697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t3XHE1KeFjwgyo1m"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">罗伯特·卡茨基在<a class="ae kv" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><p id="187e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">6月29日，随着Jetpack Compose<a class="ae kv" href="https://developer.android.com/jetpack/androidx/releases/compose-animation#1.3.0-alpha01" rel="noopener ugc nofollow" target="_blank">1 . 3 . 0-alpha 01</a>的发布，一个新的布局<code class="fe ls lt lu lv b">LookaheadLayout</code>被引入。为了理解<code class="fe ls lt lu lv b">LookaheadLayout</code>的概念，让我们想象我们有一个如下的<code class="fe ls lt lu lv b">ExpandableFab</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="bb1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与我们想象的相反，它并不漂亮，因为没有动画。让我们添加动画。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="2133" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们想象中的<code class="fe ls lt lu lv b">ExpandableFab</code>完成了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ly"><img src="../Images/e7b1fff160a223256651835367e5b2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4r2aBktW2t-vl9ALM9Y1Q.png"/></div></div></figure><p id="3658" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">动画，包括上面的<code class="fe ls lt lu lv b">ExpandableFab</code>，按照起始帧(初始状态)、动画进行中的动画帧、结束帧(最终状态)进行绘制。</p><p id="d7ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，要在Compose中实现这样的动画，看起来像是按照上面绘制动画的原理跟踪动画帧，并绘制一个适合每个帧的新的composable。</p><p id="935a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是，在1.2.0版本之前，没有任何布局可以跟踪这些动画帧。为克服这一点而出现的一种布局叫做<code class="fe ls lt lu lv b">LookaheadLayout</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lz"><img src="../Images/6d774ec0d020f256e80cd3ce6ddbf305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vUSeAzLKjITiH7AHp9B25g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">应用Toss团队提供的<a class="ae kv" href="https://toss.im/tossface" rel="noopener ugc nofollow" target="_blank"> Tossface </a>(表情字体)</p></figure><p id="2c72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">LookaheadLayout</code>预览要在开始-结束帧之间绘制的帧，并根据预计要在该帧上绘制的信息(尺寸、位置)帮助在开始-结束帧之间绘制新的布局。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ly"><img src="../Images/e7f9e9918a0f613e95956b45a7ed51e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzfYNBzUjTEw-eksBwBo2A.png"/></div></div></figure><p id="c6c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">跟踪在开始-结束帧之间绘制的帧的步骤被称为前瞻步骤，并且根据在前瞻步骤中以这种方式计算绘制的信息在开始-结束之间放置的布局被称为中间布局。</p><p id="e097" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">前瞻阶段计算的信息可以用<code class="fe ls lt lu lv b">Modifier.onPlaced</code>接收，中间布局可以通过<code class="fe ls lt lu lv b">Modifier.intermediateLayout</code>实际布局。</p><p id="593a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到目前为止，我们已经了解了<code class="fe ls lt lu lv b">LookaheadLayout</code>的概念。现在让我们实际使用它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="b052" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">LookaheadLayout</code>是处于实验阶段的composable，它接收<code class="fe ls lt lu lv b">LookaheadLayoutScope</code>作为内容的范围。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="5e11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">LookaheadLayoutScope</code>实现<code class="fe ls lt lu lv b">Modifier.onPlaced</code>和<code class="fe ls lt lu lv b">Modifier.intermediateLayout</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="8f8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在前瞻步骤中计算放置中间布局的信息时，使用计算值作为参数调用<code class="fe ls lt lu lv b">Modifier.onPlaced</code>。参数是<code class="fe ls lt lu lv b">LookaheadLayout</code>使用的<code class="fe ls lt lu lv b">LookaheadLayoutCoordinates</code>，这个修改器是可组合的。</p><p id="b1e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">调用<code class="fe ls lt lu lv b">Modifier.onPlaced</code>的过程是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ly"><img src="../Images/55bd7622332b2a27f4900a7154ccfc40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zKbWXw1iJm1vfeyfmyYIA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">其中用粉色填充的部分表示放置的内容</p></figure><p id="4475" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">LookaheadLayoutCoordinates</code>作为参数接收的是一个接口，它保存了前瞻阶段之前和之后的两个布局的<code class="fe ls lt lu lv b">LayoutCoordinates</code>。这样，可以获得中间布局的计算偏移量和当前布局内容的偏移量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="22ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">LookaheadLayoutCoordinates.localLookaheadPositionOf</code>和<code class="fe ls lt lu lv b">LookaheadLayoutCoordinates.localPositionOf</code>都用于获得相对于特定坐标的转换后的偏移。唯一不同的是，与<code class="fe ls lt lu lv b">localPositionOf</code>不同，<code class="fe ls lt lu lv b">localLookaheadPositionOf</code>使用前瞻位置进行坐标计算。</p><p id="d53e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们来看看其余的<code class="fe ls lt lu lv b">Modifier.intermediateLayout</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="d81a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可使用<code class="fe ls lt lu lv b">Modifier.intermediateLayout</code>根据前瞻步骤中计算的信息放置一个中间布局。</p><p id="6407" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">Modifier.onPlaced</code>和<code class="fe ls lt lu lv b">Modifier.intermediateLayout</code>是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ly"><img src="../Images/f7c109d30452a53d13c789928f9f2cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7zjzHRUS6Sc3PBP9mzGvVA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">其中用粉色填充的部分表示放置的内容</p></figure><p id="8fa5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们回到本文开头看到的<code class="fe ls lt lu lv b">ExpandableFab</code>的帧过程来实际使用<code class="fe ls lt lu lv b">LookaheadLayout</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ly"><img src="../Images/d8a3b5a1dc1ec9b93aed6b020244f463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-sJ04inu0SC1IzNC1ySJfg.png"/></div></div></figure><p id="7a2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在可以通过<code class="fe ls lt lu lv b">LookaheadLayout</code>跟踪动画帧过程，并且该动画帧内的大小和偏移是变化的。我们可以使用<code class="fe ls lt lu lv b">Modifier.onPlaced</code>和<code class="fe ls lt lu lv b">Modifier.intermediateLayout</code>来实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="7534" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要调整大小，通过measure参数变形中间布局，measure参数是一个lambda，它用<code class="fe ls lt lu lv b">Modifier.imtermediateLayout</code>提供中间布局的大小。要调整偏移量，请根据使用<code class="fe ls lt lu lv b">Modifier.onPlaced</code>计算的中间布局的偏移量来调整内容位置。</p><p id="3dea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们先创建一个<code class="fe ls lt lu lv b">Modifier.movement</code>来调整偏移量。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="f0d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，创建了用于调整大小的<code class="fe ls lt lu lv b">Modifier.transformation</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="056e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，为了应用以这种方式制作的修改器，现有的Fab用<code class="fe ls lt lu lv b">LookaheadLayout</code>包裹，修改器连接。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="f4bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="cb0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是它并没有像我们希望的那样活跃起来。是因为只是放置了一个中间布局，却没有应用任何动画。所以结束的很快，看不出和之前有什么区别。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ly"><img src="../Images/d4c5901c2d3c9284c7616a68e415b9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_93psFafGFlQgtrP-7jhvQ.png"/></div></div></figure><p id="10ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">Animatable</code>可用于动画处理。让我们制作大小和偏移变化的动画。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ma lx l"/></div></figure><p id="9047" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，它看起来是我们想要的样子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><h1 id="3310" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">结束了！</h1><p id="919d" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">本文介绍<code class="fe ls lt lu lv b">LookaheadLayout</code>。通过使用<code class="fe ls lt lu lv b">LookaheadLayout</code>，你可以很容易地实现很多动画，比如共享元素过渡。</p><p id="a16c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文示例中使用的<code class="fe ls lt lu lv b">ExpandableFab</code>的完整代码可以在下面的链接中找到。</p><ul class=""><li id="3fa6" class="my mz iq ky b kz la lc ld lf na lj nb ln nc lr nd ne nf ng bi translated"><a class="ae kv" href="https://gist.github.com/jisungbin/78c2eb9a183211d37243175dbdceb2b4" rel="noopener ugc nofollow" target="_blank">可扩展标签</a></li><li id="da14" class="my mz iq ky b kz nh lc ni lf nj lj nk ln nl lr nd ne nf ng bi translated"><a class="ae kv" href="https://gist.github.com/jisungbin/f451771329b7d96117c93516abd0759a" rel="noopener ugc nofollow" target="_blank">修改器</a></li></ul><p id="7919" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，随着这个1.3.0-alpha01的发布，Compose开始向独立版本化系统转变。到目前为止，只有编译器是分离的，如果将Compose编译器版本设置为1.3.0-alpha01，那么可以使用Kotlin 1.7.0版本。</p><p id="afb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p><pre class="kg kh ki kj gt nm lv nn no aw np bi"><span id="e844" class="nq mc iq lv b gy nr ns l nt nu"><a class="ae kv" href="https://sungbin.land/jetpack-compose-%EC%9D%98-%EC%83%88%EB%A1%9C%EC%9A%B4-%EB%A0%88%EC%9D%B4%EC%95%84%EC%9B%83-lookaheadlayout-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0-d4a98aac588e" rel="noopener ugc nofollow" target="_blank">[View in Korean]</a></span></pre></div></div>    
</body>
</html>