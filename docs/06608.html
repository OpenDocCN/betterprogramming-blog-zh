<html>
<head>
<title>Build Mobile Serverless Apps Using Amazon Aurora, Amplify, and SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Amazon Aurora、Amplify和SwiftUI构建移动无服务器应用</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/build-mobile-serverless-apps-using-amazon-aurora-amplify-and-swiftui-7562ecb7df9a?source=collection_archive---------2-----------------------#2020-10-17">https://betterprogramming.pub/build-mobile-serverless-apps-using-amazon-aurora-amplify-and-swiftui-7562ecb7df9a?source=collection_archive---------2-----------------------#2020-10-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1ebf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在AWS上使用关系数据创建无服务器iOS应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/827f0a9d4274323040701177ab00af3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_ZjVG2p5s-1-OWAc"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@tvick?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">泰勒维克</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></figure><h1 id="e9ce" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">为什么使用Aurora Serverless？</h1><p id="c157" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果你刚刚得到，或者更喜欢使用NoSQL数据库，AWS Amplify有<a class="ae kv" href="https://docs.amplify.aws/start/q/integration/ios" rel="noopener ugc nofollow" target="_blank">指南</a>和一些<a class="ae kv" href="https://github.com/aws-samples/aws-amplify-swiftui-demo" rel="noopener ugc nofollow" target="_blank">示例应用</a>使用他们的NoSQL数据库DynamoDB。</p><p id="35ad" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但是，根据您的工作对象，您可能需要使用关系数据库。旧的方法是使用您的后端首选语言创建一个服务器，该服务器将使用AWS RDS连接到关系数据库，但使用Amplify，您可以使用Aurora Serverless和Amplify缩短时间，消除创建和维护服务器的工作。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="5706" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">创建Amazon Aurora实例</h1><p id="0921" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果您没有AWS帐户，您需要创建一个。首先，进入<a class="ae kv" href="https://console.aws.amazon.com/rds" rel="noopener ugc nofollow" target="_blank"> RDS控制台</a>。在您的仪表板上，选择“创建数据库”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/a8b10b38d051b4178a382d9a1da97c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Uuw40-pc2Ky6ersm6EJXw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AWS RDS控制台</p></figure><p id="5561" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这里，您应该默认选择Amazon Aurora:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/a864a9e2a35449e89e2134a65fa6d946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xrcpmorSrHjm4SnsEkn0pQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建数据库</p></figure><p id="9861" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在“数据库功能”下，选择“无服务器”:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/1023617026aa41df336415224b60ea23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exsI8411TlIoS5I497KvMQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">选择数据库功能</p></figure><p id="a803" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在“设置和数据库集群标识符”下，您可以根据需要更改默认的数据库集群标识符。您还应该让RDS自动生成密码或自己输入密码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/953067e5ebb0e140f6b7100b0286caba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1JgJGw9ofR9pYF7Hz51nQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">更改数据库集群标识符</p></figure><p id="c437" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在容量设置下，你可以将最大Aurora容量单位设置为<code class="fe nf ng nh ni b">1</code>，这样你就不会不小心在这个项目上花了太多钱。出于同样的原因，在“附加扩展配置”下，选择“连续几分钟不活动后暂停计算容量”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/dd4795a5f3844ed6f2aff738dd3a346e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sWoa8u8FWOWwdf3bnbHPdg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">暂停计算容量</p></figure><p id="760d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在你可以点击“创建数据库”</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="126a" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">允许数据库中有特殊字符</h1><p id="f074" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果您计划在DB上使用特殊字符，比如带有中文字符的名称，您可能需要修改数据库默认字符集。如果您目前不关心特殊字符，可以跳过这一步，进入下一节，创建表。</p><p id="1bb2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为此，点击左侧的“参数组”。在这里，点击“创建参数组”。在参数组系列下选择<code class="fe nf ng nh ni b">aurora5.6</code>，在类型下选择“DB Cluster Parameter Group”，给出名称和描述，然后单击“Create”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/c1ca0d26c793ebbfd513a12ebcbc57c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcDMKKvfkYWMwtLExLNnWw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建参数组</p></figure><p id="cdb1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在点击新创建的参数组。在搜索栏上，输入<code class="fe nf ng nh ni b">character_set_server</code>，选择它，并点击“编辑参数”在数值上，选择<code class="fe nf ng nh ni b">utf8mb4</code>，然后点击“保存更改”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/75ae33d93800e7dab1af311ea72a4c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_ZnHdVVVN-dk-XaMHSwaQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">编辑字符集</p></figure><p id="1008" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，请在列表中单击您新创建的数据库，并单击“修改”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/bfd31bfe66512632072e45c29fd858e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mFWGGVHRfCaKDEK2o8lY0A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">新创建的数据库</p></figure><p id="f5b6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在“网络和安全”下，单击“数据API”，在“附加配置和数据库集群参数组”下，选择您刚刚创建的组。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/11dedbcac412020313de07896a954b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDhCUJMYIggZK0JXGiVUlA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">启用数据API并选择数据库集群参数组</p></figure><p id="1448" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">按“继续”然后在“修改计划”下，选择“立即应用”，然后按“修改群集”</p><p id="d989" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在我们已经创建了数据库，我们可以继续创建我们将要使用的表。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="996b" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">创建表</h1><p id="c03f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于这个项目，让我们创建一个简单的应用程序，用户可以在其中创建个人资料，然后创建博客，博客可以有几篇文章。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/dd5fd468f82eb7a5a8a71d95b418a826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*r6rlW0OOszp60CYABGF_Zg.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">我们应用程序的图表</p></figure><p id="eef9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在我们需要连接数据库来创建表。在你的数据库仪表板上，按下<code class="fe nf ng nh ni b">Actions</code>，然后选择<code class="fe nf ng nh ni b">Query</code>。这里会要求您输入之前输入的密码，以便连接到数据库。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/7b22c8119d6b2cb237675d9f2f857666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g0i9gFnBR6gFBt49tDJ1dg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">连接到数据库</p></figure><p id="173d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">连接后，您应该会看到下面的查询编辑器:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/73d1bb8a0b1a8596691e195a687c1718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WuCxMe3p-N_NDVRqOl7vQg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">查询编辑器</p></figure><p id="9aab" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要为我们的项目创建数据库，请运行以下命令:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="d6d5" class="nv kx iq ni b gy nw nx l ny nz">CREATE DATABASE BLOGDB;</span></pre><p id="d387" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">之后，点击“更改数据库”在“输入数据库或模式的名称”下，输入<code class="fe nf ng nh ni b">BLOGDB</code>或您刚刚输入的名称，然后点击“连接到数据库”</p><p id="9cdb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在，要创建表，运行以下命令:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1bdf" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">请注意，<code class="fe nf ng nh ni b">createdAt</code>字段是作为<code class="fe nf ng nh ni b">varchar</code>创建的，因此我们可以使用Unix时间戳。</p><p id="e680" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在为了测试一切是否正常，您可以在查询编辑器上创建一个新的<code class="fe nf ng nh ni b">User</code>:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="b6d5" class="nv kx iq ni b gy nw nx l ny nz">INSERT INTO User (userId, name, email, picture, createdAt) VALUES ("fake_uuid_specialchars","名字😄", "email_special@fakemail.com", "picture.png", "1588269238");</span></pre><p id="0bf7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">或者，如果您没有启用特殊字符，您可以创建一个带有简单字符名称的<code class="fe nf ng nh ni b">User</code>:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="0670" class="nv kx iq ni b gy nw nx l ny nz">INSERT INTO User (userId, name, email, picture, createdAt) VALUES ("fake_uuid_john","John Doe", "johndoe@fakemail.com", "picture.png", "1588269239");</span></pre><p id="cb29" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要查看用户列表，请运行以下命令:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="6a7a" class="nv kx iq ni b gy nw nx l ny nz">Select * from User;</span></pre><p id="aa15" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您应该看到新创建的用户使用了特殊字符:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/08e958f30c2ca441d29dfd79b1343a62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m-SEAZWknrbOkH7mqEF63A.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">含特殊字符的查询结果</p></figure><p id="720a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在我们已经看到我们的数据库正在工作，我们可以继续配置我们的Xcode项目。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="5b9b" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">配置您的项目</h1><p id="bb38" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">开始之前，如果您不熟悉AWS Amplify CLI，您需要遵循<a class="ae kv" href="https://aws-amplify.github.io/docs/" rel="noopener ugc nofollow" target="_blank">入门指南</a>。这些步骤基本上是注册一个AWS帐户，安装它，并配置CLI。</p><p id="4f3a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们首先转到Xcode并创建一个新项目。选择“单视图应用程序”在语言中选择<code class="fe nf ng nh ni b">Swift</code>，在用户界面中选择<code class="fe nf ng nh ni b">SwiftUI</code>。给它您想要的产品名称和组织名称。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/1c5bba5da9007a7266e668b69a80806e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fa4yDUffhe8jJ8yv_cLJhw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">创建我们的项目</p></figure><p id="3eab" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在您的计算机上配置Amplify并创建Xcode项目之后，我们需要为之前创建的Aurora数据库生成一个GraphQL API。转到终端上的Xcode项目文件夹，运行以下命令添加API:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="5cc2" class="nv kx iq ni b gy nw nx l ny nz">$ amplify add api</span></pre><p id="a937" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">选择<code class="fe nf ng nh ni b">GraphQL</code>，并保留默认选项。当询问您是否有带注释的GraphQL模式时，输入<code class="fe nf ng nh ni b">No</code>，并输入<code class="fe nf ng nh ni b">No</code>进行引导模式创建。终端将打印生成的<code class="fe nf ng nh ni b">schema.graphql</code>的路径。它还将创建一个自定义类型<code class="fe nf ng nh ni b">MyType</code>。暂时不要删除它，因为如果<code class="fe nf ng nh ni b">.graphql</code>文件是空的，您可能会在下一步遇到问题。</p><p id="88ae" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">添加API后，我们可以添加Aurora数据库作为数据源:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="9cba" class="nv kx iq ni b gy nw nx l ny nz">$ amplify api add-graphql-datasource</span></pre><p id="ee1e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">选择您的数据库所在的区域，然后选择我们刚刚创建的数据库(<code class="fe nf ng nh ni b">BLOGDB</code>，或者您给它取的任何名称)。</p><p id="cd48" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在您可以删除<code class="fe nf ng nh ni b">.graphql</code>文件上自动生成的类型<code class="fe nf ng nh ni b">MyType</code>并保存该文件。之后，您可以推送更改:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="8f8d" class="nv kx iq ni b gy nw nx l ny nz">$ amplify push</span></pre><p id="b8f8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您将被询问是否想要为您的新API生成代码。选择“是”，保留默认选项。</p><p id="03e1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们需要添加<a class="ae kv" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>，因此在我们的项目文件夹中，运行以下命令:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="4a49" class="nv kx iq ni b gy nw nx l ny nz">$ pod init</span></pre><p id="d723" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">将以下窗格添加到文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="9eeb" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在终端上运行<code class="fe nf ng nh ni b">pod install</code>之后，我们完成了配置，所以现在我们可以打开Xcode了。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="5d0d" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">将AWS配置文件复制到Xcode中</h1><p id="5ca3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在能够使用已安装的pod之前，我们需要将一些文件复制到Xcode: <code class="fe nf ng nh ni b">awsconfiguration.json</code>、<code class="fe nf ng nh ni b">amplifyconfiguration.json</code>和<code class="fe nf ng nh ni b">API.swift</code>。您可以将它们放在根文件夹中，或者创建一个文件夹来更好地组织您的项目。</p><p id="3e72" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们可能需要更新Amplify配置，所以为了只保留对原始文件的引用，在将文件拖到项目中时，取消选中“如果需要，拷贝项目”。</p><p id="b478" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您的项目应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/639c91069ba0b651cb8930604d9be07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:514/format:webp/1*O_faj-EnvDLm6xGVHeKd8A.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">放大所需文件</p></figure></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="3d08" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">正在初始化AWS移动客户端</h1><p id="caee" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><code class="fe nf ng nh ni b">AppDelegate</code>文件应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="0ee9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我将讲述一些细节。首先我们需要导入<code class="fe nf ng nh ni b">AWSAppSync</code>。然后，我们声明一个变量，<code class="fe nf ng nh ni b">AWSAppSyncClient</code>。我们还将创建一个<code class="fe nf ng nh ni b">initializeAWSAppSync</code>函数来初始化<code class="fe nf ng nh ni b">AWSAppSyncClient</code>。</p><p id="4f2a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">注意我们调用<code class="fe nf ng nh ni b">AWSAppSyncCacheConfiguration</code>的那几行——我们需要这样做，以便在没有互联网连接时存储数据库操作，这样当连接恢复时就可以执行这些操作。</p><p id="09b8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，不要忘记在<code class="fe nf ng nh ni b">didFinishLaunchingWithOptions</code>内部调用<code class="fe nf ng nh ni b">initializeAWSAppSync</code>。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="a2b8" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">创建我们的模型</h1><p id="38c4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当生成API代码时，Amplify还生成不同的结构来表示我们的用户、博客和帖子。</p><p id="38d2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">每个操作中有不同的结构代表一个用户:<code class="fe nf ng nh ni b">ListUser</code>、<code class="fe nf ng nh ni b">CreateUser</code>、<code class="fe nf ng nh ni b">UpdateUser</code>和<code class="fe nf ng nh ni b">DeleteUser</code>。博客和帖子也是如此。为了保持一致性，并在整个应用程序中只使用一个模型，我们将创建自己的<code class="fe nf ng nh ni b">User</code>模型，需要时我们会将其转换为<code class="fe nf ng nh ni b">ListUser</code>或<code class="fe nf ng nh ni b">CreateUser</code>。</p><p id="8a7d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">创建一个名为<code class="fe nf ng nh ni b">ThisUser.swift</code>的文件，并添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="611c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们需要为博客做同样的事情，所以让我们创建一个名为<code class="fe nf ng nh ni b">ThisBlog.swift</code>的文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="bee5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，对于帖子，让我们创建一个名为<code class="fe nf ng nh ni b">ThisPosts.swift</code>的文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="0561" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">创建我们的数据存储类</h1><p id="c240" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于数据库的操作，我们将创建一个类，它包含用户、博客和帖子的数组，并从<code class="fe nf ng nh ni b">ObservableObject</code>继承，这样我们可以在这些数组中发布更改。我们还将创建从数据库获取用户、博客和帖子的方法，并创建新的方法。</p><p id="bd82" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">创建一个名为<code class="fe nf ng nh ni b">AWSAppSyncDataStore.swift</code>的新文件，并添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">AWS AppSync数据存储类</p></figure></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="89d1" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">将数据存储作为环境变量传递</h1><p id="eeaa" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了使用我们的数据存储，我们需要将它传递给我们的<code class="fe nf ng nh ni b">ContentView</code>。在<code class="fe nf ng nh ni b">SceneDelegate.swift</code>中，添加以下一行:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="94d5" class="nv kx iq ni b gy nw nx l ny nz"><strong class="ni ir">let</strong> dataStore = AWSAppSyncDataStore()</span></pre><p id="96f9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果您想要测试新的数据存储，可以添加以下行:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="e585" class="nv kx iq ni b gy nw nx l ny nz">dataStore.addUser(create: thisUser(name: "Tony Stark", email: "<a class="ae kv" href="mailto:stark@gmail.com" rel="noopener ugc nofollow" target="_blank">stark@gmail.com</a>", picture: "no_picture", createdAt: "1588606785", lastLoginAt: "1588606785"))<br/>        <br/>print("datastore.users ", dataStore.users)</span></pre><p id="953c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">测试之后，删除这些行，并修改创建我们的<code class="fe nf ng nh ni b">ContentView</code>的行，这样我们就可以将数据存储作为环境对象传递。</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="d33b" class="nv kx iq ni b gy nw nx l ny nz"><strong class="ni ir">let</strong> contentView = ContentView().environmentObject(dataStore)</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="5c2c" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">列出用户</h1><p id="4463" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在让我们写一些代码来获取用户并显示他们。首先，我们需要在顶部的<code class="fe nf ng nh ni b">ContentView</code>中添加<code class="fe nf ng nh ni b">EnvironmentObject</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">列出用户的内容视图</p></figure><p id="5587" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">添加了<code class="fe nf ng nh ni b">EnvironmentObject</code>之后，让我们创建一个<code class="fe nf ng nh ni b">List</code>和一个<code class="fe nf ng nh ni b">ForEach</code>，其中包含数据存储用户。</p><p id="a9f3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果我们运行这个应用程序，我们应该会看到一个用户列表，这些用户是我们在AWS控制台上创建的，或者是我们之前在<code class="fe nf ng nh ni b">SceneDelegate</code>中测试的一部分。该列表应类似于下图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/cd7eba8033161c22a145ea237c3dcc68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YKU0Kt7uFciqnD3s6Yw1_g.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">列出数据库中的现有用户</p></figure><p id="6e72" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在让我们进入下一步，创建一个新用户。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="0549" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">创建用户</h1><p id="76f9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了创建一个新的<code class="fe nf ng nh ni b">User</code>，我们将在<code class="fe nf ng nh ni b">Sheet</code>中使用一个<code class="fe nf ng nh ni b">Form</code>。首先，我们需要创建一个新文件<code class="fe nf ng nh ni b">CreateUserView.swift</code>并添加以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">用于创建新用户的表单</p></figure><p id="457a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如您所见，我们创建了一个带有三个<code class="fe nf ng nh ni b">TextField</code>的<code class="fe nf ng nh ni b">Form</code>来输入<code class="fe nf ng nh ni b">User</code>属性:一个用于<code class="fe nf ng nh ni b">name</code>，一个用于<code class="fe nf ng nh ni b">email</code>，一个用于<code class="fe nf ng nh ni b">pictureURL</code>。</p><p id="0dbe" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了显示这个<code class="fe nf ng nh ni b">Form</code>，我们需要在<code class="fe nf ng nh ni b">ContentView</code>中添加下面的<code class="fe nf ng nh ni b">State</code>:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="0eec" class="nv kx iq ni b gy nw nx l ny nz"><a class="ae kv" href="http://twitter.com/State" rel="noopener ugc nofollow" target="_blank">@</a>State var presentingSheet = false</span></pre><p id="d1f1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">同样在<code class="fe nf ng nh ni b">ContentView</code>中，在<code class="fe nf ng nh ni b">NavigationBarItem</code>中，在<code class="fe nf ng nh ni b">print("Create User")</code>语句之后，我们需要将<code class="fe nf ng nh ni b">presentingSheet</code>设置为<code class="fe nf ng nh ni b">true</code>:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="498e" class="nv kx iq ni b gy nw nx l ny nz">self.presentingSheet = true</span></pre><p id="cc40" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们需要在<code class="fe nf ng nh ni b">ContentView</code>中的<code class="fe nf ng nh ni b">List</code>上附加一个<code class="fe nf ng nh ni b">sheet</code>:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="bbb2" class="nv kx iq ni b gy nw nx l ny nz">.sheet(isPresented: $presentingSheet, content: {<br/>     CreateUserView()<br/> })</span></pre><p id="c654" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果我们再次运行我们的应用程序，当按下导航栏上的<code class="fe nf ng nh ni b">+</code>按钮时，我们应该会看到我们新创建的表单:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/86d7eb2e70928f5498ac815a415a9b0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KE4ytP4ASNfh5cVkKZEsOw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示新创建的表单的表单</p></figure><p id="8dd3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们必须至少填充<code class="fe nf ng nh ni b">name</code>和<code class="fe nf ng nh ni b">email</code>来启用保存按钮。之后，如果我们按save，表单应该会消失，我们应该会在列表中看到新创建的用户:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/2d12758e3e16e51c973c582a48f7aa11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1z-S2mrhpABUvT5fKlfqQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">显示我们新用户的列表</p></figure><p id="e9b2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果您想要仔细检查，您可以转到AWS控制台，在您的数据库上运行一个<code class="fe nf ng nh ni b">Select</code>查询:</p><pre class="kg kh ki kj gt nr ni ns nt aw nu bi"><span id="3ede" class="nv kx iq ni b gy nw nx l ny nz">Select * from User;</span></pre><p id="9564" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您刚刚使用SwiftUI应用程序添加的用户应该在那里。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h1 id="0097" class="kw kx iq bd ky kz mw lb lc ld mx lf lg jw my jx li jz mz ka lk kc na kd lm ln bi translated">结论</h1><p id="8ce4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">如果你想看看整个项目，请查看<a class="ae kv" href="https://github.com/rolisanchez/swiftui-aurora-amplify-tutorial" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</p><p id="0fb0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你有兴趣使用AWS Amplify为你的SwiftUI应用添加认证，你可以阅读我的教程，了解如何<a class="ae kv" href="https://medium.com/better-programming/sign-in-with-aws-amplify-and-swiftui-978b01a5cf10" rel="noopener">登录谷歌、</a><a class="ae kv" href="https://medium.com/better-programming/how-to-implement-sign-in-with-swiftui-and-aws-amplify-part-2-4a7b20bfe8cc" rel="noopener"/>、<a class="ae kv" href="https://medium.com/better-programming/how-to-implement-sign-in-with-swiftui-and-aws-amplify-part-3-de994e218ed7" rel="noopener">苹果、</a>或<a class="ae kv" href="https://medium.com/better-programming/how-to-implement-sign-in-with-swiftui-and-aws-amplify-part-4-a59144107147" rel="noopener">电子邮件</a>。</p></div></div>    
</body>
</html>