<html>
<head>
<title>How To Write a Smart Contract For Staking Tokens</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为标记令牌编写智能合同</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/how-to-write-a-smart-contract-for-stake-the-token-a46fdb9221b6?source=collection_archive---------0-----------------------#2022-07-03">https://betterprogramming.pub/how-to-write-a-smart-contract-for-stake-the-token-a46fdb9221b6?source=collection_archive---------0-----------------------#2022-07-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9b7b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解标记的工作原理以及如何为令牌标记创建智能合同。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/75cb646dd634ec529c64c85692e90f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OPvKbUslmAEtSPpj"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@theshubhamdhage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Shubham Dhage </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</p></figure><p id="4242" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">今天，我们在区块链领域听到了许多新词，staking就是其中之一。人们通常将赌注概念用于订婚。今天，我们将了解以下关于打桩的要点。</p><ol class=""><li id="6be1" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">什么是赌注？</li><li id="552b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">如何编写令牌标桩的智能合约？</li><li id="4e3a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">打桩过程是如何工作的？</li><li id="f30c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">Rinkeby Testnet上的部署。</li></ol><h1 id="ef53" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">什么是赌注？</h1><ul class=""><li id="e068" class="ls lt iq ky b kz my lc mz lf na lj nb ln nc lr nd ly lz ma bi translated">赌注是一种通过定期或动态存放加密货币的利息赚取额外被动收入的方式。</li><li id="da39" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">如今，一些公司用“库存”这个词来表示订婚。</li><li id="53ba" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">在这个游戏中，你把你的令牌或NFT押在赌注上，作为回报，你会得到一份奖励(这取决于你押的时间)。</li></ul></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="d511" class="mg mh iq bd mi mj nl ml mm mn nm mp mq jw nn jx ms jz no ka mu kc np kd mw mx bi translated">如何编写令牌标桩的智能合约？</h1><p id="b54d" class="pw-post-body-paragraph kw kx iq ky b kz my jr lb lc mz ju le lf nq lh li lj nr ll lm ln ns lp lq lr ij bi translated">请注意以下步骤:</p><ul class=""><li id="a8e8" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nd ly lz ma bi translated">我们创建了样本ERC-20苹果(APL)令牌。</li><li id="2072" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">我们将提供3个月的令牌(你可以按你喜欢的方式保存它)。</li><li id="6ee9" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">3个月后，你将获得32%的奖励。例如:如果你在赌注上放100个代币，那么3个月后你将得到132个代币。</li></ul><p id="78ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">打桩合同流程:</strong></p><ul class=""><li id="186f" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nd ly lz ma bi translated">首先，我们将一些APL令牌转移到标桩合同地址。</li><li id="9971" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">我们用两个参数调用ERC20契约中的<code class="fe nt nu nv nw b">approve</code>方法。第一个标桩合同地址，第二个是金额(这里我们给出总供应量的50%)。</li><li id="90f3" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">我们用amount参数(您想要下注的金额)调用Staking契约中的<code class="fe nt nu nv nw b">stakeToken</code>方法。</li><li id="ccbb" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">赌注期结束后，您可以调用赌注合同中的<code class="fe nt nu nv nw b">claimReward</code>方法，您将获得您的金额和利息。</li></ul><p id="c01d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是在区块链世界实现这一目标的步骤。</p><ul class=""><li id="680c" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nd ly lz ma bi translated">创建ERC-20苹果(APL)令牌</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><ul class=""><li id="fab1" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nd ly lz ma bi translated">我们将用这两个重要的方法创建一个StakeAPL契约</li></ul><ol class=""><li id="a10d" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">赌注法</li><li id="1735" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">索赔奖励方法</li></ol><ul class=""><li id="9da9" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nd ly lz ma bi translated"><code class="fe nt nu nv nw b">StakeToken</code> <strong class="ky ir"> </strong>方法:用户将金额传入一个参数中(为魏格式)。该方法检查所有有效条件，然后将赌注金额转移到合同中，并将该条目存储到结构中，并发出Staked事件。</li></ul><pre class="kg kh ki kj gt nz nw oa ob aw oc bi"><span id="6317" class="od mh iq nw b gy oe of l og oh">require(stakeAmount &gt;0, “Stake amount should be correct”); </span><span id="8856" class="od mh iq nw b gy oi of l og oh">require(block.timestamp &lt; planExpired , “Plan Expired”); </span><span id="5160" class="od mh iq nw b gy oi of l og oh">require(addressStaked[_msgSender()] == false, “You already participated”); </span><span id="ff02" class="od mh iq nw b gy oi of l og oh">require(aplToken.balanceOf(_msgSender()) &gt;= stakeAmount, “Insufficient Balance”);</span><span id="ae0d" class="od mh iq nw b gy oi of l og oh">aplToken.transferFrom(_msgSender(), address(<em class="oj">this</em>), stakeAmount);</span><span id="3724" class="od mh iq nw b gy oi of l og oh">stakeInfos[_msgSender()] = StakeInfo({<br/>            startTS: block.timestamp, <br/>            endTS: block.timestamp + planDuration,<br/>            amount: stakeAmount,<br/>            claimed: 0 });</span><span id="2910" class="od mh iq nw b gy oi of l og oh">emit Staked(_msgSender(), stakeAmount);</span></pre><ul class=""><li id="c732" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr nd ly lz ma bi translated"><code class="fe nt nu nv nw b"><strong class="ky ir">claimReward</strong></code> <strong class="ky ir"> </strong>方法:用户在下注时长完成后获得奖励。首先，我们获得用户下注的金额，然后计算利息百分比并相加。将该数量传输到用户地址并发出<code class="fe nt nu nv nw b">Claimed</code>事件。</li></ul><pre class="kg kh ki kj gt nz nw oa ob aw oc bi"><span id="8f87" class="od mh iq nw b gy oe of l og oh">uint256 stakeAmount = stakeInfos[_msgSender()].amount; </span><span id="5bfd" class="od mh iq nw b gy oi of l og oh">uint256 totalTokens = stakeAmount + (stakeAmount * interestRate / 100); </span><span id="b0df" class="od mh iq nw b gy oi of l og oh">stakeInfos[_msgSender()].claimed = totalTokens; </span><span id="50e6" class="od mh iq nw b gy oi of l og oh">aplToken.transfer(_msgSender(), totalTokens); </span><span id="c11d" class="od mh iq nw b gy oi of l og oh">emit Claimed(_msgSender(), totalTokens);</span></pre></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="abfd" class="mg mh iq bd mi mj nl ml mm mn nm mp mq jw nn jx ms jz no ka mu kc np kd mw mx bi translated"><strong class="ak">打桩流程是如何工作的？</strong></h1><ul class=""><li id="9ef2" class="ls lt iq ky b kz my lc mz lf na lj nb ln nc lr nd ly lz ma bi translated">我们已经有了一个ERC-20合同(APL令牌),这个合同地址会传递到StakeAPL构造器部署时间中。</li><li id="f956" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">转让一些APL代币给<code class="fe nt nu nv nw b">StakeAPL</code>合同。</li><li id="3669" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">第二个用户(拥有APL令牌)调用APL令牌<code class="fe nt nu nv nw b">approve</code>方法，并批准使用标桩金额来标桩合同地址。</li><li id="81cf" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nd ly lz ma bi translated">调用<code class="fe nt nu nv nw b">stakeToken</code>方法，用金额作为参数来标记契约，就这样。在锁定时间到期后，您可以调用<code class="fe nt nu nv nw b">claimReward</code>方法。你会连本带利得到这笔钱。</li></ul></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="a7fd" class="mg mh iq bd mi mj nl ml mm mn nm mp mq jw nn jx ms jz no ka mu kc np kd mw mx bi translated"><strong class="ak">rinke by Testnet上的部署</strong></h1><ul class=""><li id="54f6" class="ls lt iq ky b kz my lc mz lf na lj nb ln nc lr nd ly lz ma bi translated">你可以复制下面的代码并使用remix进行部署。你可以跟随<a class="ae kv" href="https://guptaarnish-it.medium.com/how-to-verify-smart-contract-in-etherscan-polygon-and-binance-4ef4e2698fb0" rel="noopener">这篇文章来重新理解</a>。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><div class="kg kh ki kj gt ok"><a href="https://guptaarnish-it.medium.com/how-does-the-bitcoin-seed-phrase-work-b4de10bc275b" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">比特币种子短语是如何工作的？</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">种子短语是比特币钱包的关键。</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">guptaarnish-it.medium.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy kp ok"/></div></div></a></div><p id="75d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>