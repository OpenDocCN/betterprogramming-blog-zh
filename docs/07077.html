<html>
<head>
<title>Lesser-Known but Powerful Unix Commands to Polish Your Tech Skills</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">鲜为人知但功能强大的Unix命令来提高您的技术技能</h1>
<blockquote>原文：<a href="https://betterprogramming.pub/lesser-known-but-powerful-unix-commands-to-polish-your-tech-skills-b2ceec3e078a?source=collection_archive---------4-----------------------#2020-12-04">https://betterprogramming.pub/lesser-known-but-powerful-unix-commands-to-polish-your-tech-skills-b2ceec3e078a?source=collection_archive---------4-----------------------#2020-12-04</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ec3c" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">带有简单示例的简便bash命令</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/5f94b30fb485dcdc5919ec660ae2f5db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hS9QYCg8c7ei01aM"/></div></div><p class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae kz" href="https://unsplash.com/@ray027?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阳光</a>照在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">的Unsplash </a>上。</p></figure><p id="0f7f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在我们的软件工程旅程中，我们已经看到bash命令是多么强大。在这个快速教程中，我将向您展示一些可能会派上用场的有用命令。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="77a7" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">否认命令</h1><p id="ba78" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">在进入<code class="fe na nb nc nd b"><a class="ae kz" href="https://en.wikipedia.org/wiki/Disown_(Unix)" rel="noopener ugc nofollow" target="_blank">disown</a></code>命令之前，让我们了解一下它与<code class="fe na nb nc nd b"><a class="ae kz" href="https://linux.die.net/man/1/nohup" rel="noopener ugc nofollow" target="_blank">nohup</a></code>的关系。</p><p id="2755" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我想你们大多数人已经熟悉了<code class="fe na nb nc nd b">nohup</code>命令。对于那些不是的人来说，它代表“不挂电话”它阻止正在运行的进程接收<code class="fe na nb nc nd b"><a class="ae kz" href="https://en.wikipedia.org/wiki/SIGHUP" rel="noopener ugc nofollow" target="_blank">SIGHUP</a> </code>信号。这样，即使您关闭终端会话，您的脚本仍将运行。</p><p id="8811" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe na nb nc nd b">nohup</code>的一个常见用法:想象你需要在远程服务器上执行一个长时间运行的脚本。如果您失去了与服务器的连接，您的脚本将会停止。这可能非常令人沮丧！为了避免这个潜在的问题，您可以利用<code class="fe na nb nc nd b">nohup</code>命令。</p><p id="1a5c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">例如:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="3d9b" class="ni me iu nd b gz nj nk l nl nm">$ nohup ./your-script.sh &amp; </span></pre><p id="dc28" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意<code class="fe na nb nc nd b">nohup</code>没有把进程放在后台。您可以在最后提供<code class="fe na nb nc nd b">ampersand (&amp;)</code>命令来实现这个结果。</p><p id="e4c7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe na nb nc nd b">disown</code>和<code class="fe na nb nc nd b">nohup</code>有什么关系？</p><p id="12d2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">假设您已经在没有<code class="fe na nb nc nd b">nohup</code>的情况下启动了远程服务器上的脚本。然后你意识到用<code class="fe na nb nc nd b">nohup</code>运行它会更明智，因为执行会花费很长时间。</p><p id="c974" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这里是<code class="fe na nb nc nd b">disown</code>命令来救援的时候。它是一个<a class="ae kz" href="https://en.wikipedia.org/wiki/Shell_builtin" rel="noopener ugc nofollow" target="_blank">内置的</a> bash命令，帮助您将一个已经运行的进程放在<strong class="lc iv"> </strong> <code class="fe na nb nc nd b">nohup</code>下。您可以从活动任务表中删除任务或标记任务，以保护它们不受<code class="fe na nb nc nd b">SIGHUP</code>信号的影响。</p><p id="0eb9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">它接受三个参数:</p><ul class=""><li id="a141" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated"><code class="fe na nb nc nd b">-a</code> —如果没有传递作业ID，则删除所有作业。</li><li id="3254" class="nn no iu lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe na nb nc nd b">-h</code> —标记每个作业ID，以便在shell接收到<code class="fe na nb nc nd b">SIGHUP</code>信号时，<code class="fe na nb nc nd b">SIGHUP</code>不会被发送到作业。</li><li id="5503" class="nn no iu lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe na nb nc nd b">-r </code> —删除处于“正在运行”状态的作业。</li></ul><h2 id="3b4b" class="ni me iu bd mf ob oc dn mj od oe dp mn lj of og mp ln oh oi mr lr oj ok mt ol bi translated">使用演示</h2><p id="2105" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">为了演示该命令的用法，创建一个名为<code class="fe na nb nc nd b">show-time.sh</code>的测试文件，并粘贴以下内容:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="3a8d" class="ni me iu nd b gz nj nk l nl nm"><em class="om">#!/bin/bash<br/></em>while true; do<br/>sleep 5<br/>date +"Hi, the current time is %F %T"<br/>done</span></pre><p id="0171" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">通过运行以下命令使脚本可执行:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="1927" class="ni me iu nd b gz nj nk l nl nm">$ chmod +x show-time.sh</span></pre><p id="f3a1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">启动它以查看输出:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="7bf7" class="ni me iu nd b gz nj nk l nl nm">$ ./show-time.sh</span></pre><p id="5f28" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在最初的五秒钟延迟后，你会每五秒钟看到当前的日期和时间。</p><p id="4ee1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们看看如何否认该流程，使其在<code class="fe na nb nc nd b">nohup</code>下运行:</p><ul class=""><li id="ff28" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">通过按键盘上的<code class="fe na nb nc nd b">Ctrl + Z</code>暂停正在运行的脚本:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="dc56" class="ni me iu nd b gz nj nk l nl nm">$ ./show-time.sh<br/>Hi, the current time is 2020–11–30 22:07:03<br/>[1]+  Stopped                 ./show-time.sh</span></pre><ul class=""><li id="0af4" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">键入<code class="fe na nb nc nd b">bg</code>，一个<a class="ae kz" href="https://en.wikipedia.org/wiki/Job_control_(Unix)#Commands" rel="noopener ugc nofollow" target="_blank">作业控制</a>命令，将进程带到后台:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="efda" class="ni me iu nd b gz nj nk l nl nm">$ bg</span></pre><ul class=""><li id="8ea5" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">使用<code class="fe na nb nc nd b">jobs</code>命令列出活动作业，包括进程ID:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="46a9" class="ni me iu nd b gz nj nk l nl nm">$ jobs -l<br/>[1]+ 15791 Stopped                 ./show-time.sh</span></pre><ul class=""><li id="6d14" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">如果是第一个作业，执行<code class="fe na nb nc nd b">disown -h {jobid}</code>或<code class="fe na nb nc nd b">disown -h %1</code>:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="386d" class="ni me iu nd b gz nj nk l nl nm">$ disown -h 15791</span></pre><ul class=""><li id="aacf" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">您可以验证作业是否已不在作业表中:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="4fa8" class="ni me iu nd b gz nj nk l nl nm">$ jobs -l</span></pre><p id="2809" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">该命令不会给你任何结果。</p><ul class=""><li id="142d" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">关闭终端窗口并打开一个新窗口。检查作业是否仍在运行:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="33a3" class="ni me iu nd b gz nj nk l nl nm">$ ps -e | grep 'show'<br/>15791 ?        00:00:00 show-time.sh</span></pre><p id="967f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如您所见，即使我们终止了终端，该进程仍在运行！</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="b63e" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">at命令</h1><p id="b30e" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">有时，我们希望定期运行作业。为此，我们将使用<code class="fe na nb nc nd b"><a class="ae kz" href="https://en.wikipedia.org/wiki/Cron" rel="noopener ugc nofollow" target="_blank">crontab</a></code>。但是，如果我们只需要在指定的时间执行一次作业呢？<code class="fe na nb nc nd b"><a class="ae kz" href="https://en.wikipedia.org/wiki/At_(command)" rel="noopener ugc nofollow" target="_blank">at</a></code>命令提供了一个简单的解决方案。</p><p id="1676" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果您的系统上没有安装，您可以从终端安装。</p><ul class=""><li id="5a7f" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">对于Ubuntu/Debian发行版:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="5386" class="ni me iu nd b gz nj nk l nl nm">sudo apt install at</span></pre><ul class=""><li id="3e59" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">对于CentOS/Fedora发行版:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="fb3a" class="ni me iu nd b gz nj nk l nl nm">sudo yum install at</span></pre><h2 id="521c" class="ni me iu bd mf ob oc dn mj od oe dp mn lj of og mp ln oh oi mr lr oj ok mt ol bi translated">使用演示</h2><ul class=""><li id="1aea" class="nn no iu lc b ld mv lg mw lj on ln oo lr op lv ns nt nu nv bi translated">让我们从现在开始安排两分钟的<code class="fe na nb nc nd b">show-time.sh</code>脚本:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="eb88" class="ni me iu nd b gz nj nk l nl nm">$ at now + 2 minutes -f show-time.sh<br/>job 10 at Mon Nov 30 22:44:00 2020</span></pre><p id="d76e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，您也可以使用<code class="fe na nb nc nd b">pipe</code>命令来获得相同的结果:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="0111" class="ni me iu nd b gz nj nk l nl nm">$ ./show-time.sh | at now + 2 minutes</span></pre><p id="d564" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您也可以安排命令而不是脚本:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="614a" class="ni me iu nd b gz nj nk l nl nm">$ echo “hello world” &gt; at.txt | at now + 3 minutes</span></pre><p id="b53d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">三分钟后，这个命令应该会创建一个名为<code class="fe na nb nc nd b">at.txt</code>的新文件，并将“hello world”写入该文件。</p><p id="11fe" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">检查输出:</p><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="3e4b" class="ni me iu nd b gz nj nk l nl nm">$ cat at.txt<br/>hello world</span></pre></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="30c4" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">批处理命令</h1><p id="5ba9" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">如果您想在系统负载足够低(通常低于1.5)时调度和运行一个任务，那么<code class="fe na nb nc nd b"><a class="ae kz" href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/batch.html" rel="noopener ugc nofollow" target="_blank">batch</a></code>命令非常有用。您可以通过调用<code class="fe na nb nc nd b">atd</code>守护进程来修改默认的负载值。</p><h2 id="4881" class="ni me iu bd mf ob oc dn mj od oe dp mn lj of og mp ln oh oi mr lr oj ok mt ol bi translated">使用演示</h2><p id="8760" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">让我们用另一个例子来看看<code class="fe na nb nc nd b">batch</code>是如何工作的。</p><ul class=""><li id="8c9c" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">执行<code class="fe na nb nc nd b">top</code>命令检查系统负载:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="c9d1" class="ni me iu nd b gz nj nk l nl nm">$ batch<br/>top — 23:11:26 up 4:22, 1 user, <strong class="nd iv">load average: 0,31</strong>, 0,42, 0,46</span></pre><p id="755c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我建议为<code class="fe na nb nc nd b">batch</code>命令使用一个单独的终端标签。这样可以观察系统负载，做实验。</p><ul class=""><li id="0417" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">执行<code class="fe na nb nc nd b">batch</code>命令。系统会提示您提供操作。您可以在这里指定多个命令。为了简单起见，让我们将“hello world”打印到一个名为<code class="fe na nb nc nd b">hello.txt</code>的新文本文件中，然后创建一个空的<code class="fe na nb nc nd b">tst.txt</code>文件:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="34d9" class="ni me iu nd b gz nj nk l nl nm">$ batch<br/>at&gt; echo "hello world" &gt; hello.txt<br/>at&gt; touch tst.txt<br/>at&gt; &lt;EOT&gt;<br/>job 14 at Mon Nov 30 23:07:00 2020</span></pre><p id="f095" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">请注意，当您准备退出命令提示符时，您必须按<code class="fe na nb nc nd b">Ctrl + D</code>。</p><ul class=""><li id="f143" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated">让我们检查文件是否已经创建:</li></ul><pre class="kk kl km kn gu ne nd nf ng aw nh bi"><span id="566d" class="ni me iu nd b gz nj nk l nl nm">$ ls<br/>hello.txt tst.txt</span></pre><p id="bd45" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">系统负载足够低，所以文件创建时没有任何问题。</p></div><div class="ab cl lw lx hy ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="in io ip iq ir"><h1 id="cbe7" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">摘要</h1><p id="2b32" class="pw-post-body-paragraph la lb iu lc b ld mv jv lf lg mw jy li lj mx ll lm ln my lp lq lr mz lt lu lv in bi translated">我们已经看到了为什么<code class="fe na nb nc nd b">disown</code>、<code class="fe na nb nc nd b">at</code>和<code class="fe na nb nc nd b">batch</code>命令很方便以及如何使用它们。</p><p id="0620" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">关键要点:</p><ul class=""><li id="74f1" class="nn no iu lc b ld le lg lh lj np ln nq lr nr lv ns nt nu nv bi translated"><code class="fe na nb nc nd b">disown</code>从作业表中删除作业，这样即使当前shell终止，您的进程也是活动的。</li><li id="f4b9" class="nn no iu lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe na nb nc nd b">at</code>计划在特定时间只运行一次的作业。</li><li id="ae55" class="nn no iu lc b ld nw lg nx lj ny ln nz lr oa lv ns nt nu nv bi translated"><code class="fe na nb nc nd b">batch</code>当系统资源不足时执行作业。</li></ul><p id="307b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我建议浏览文档，了解更多关于这些命令的特性。</p><p id="7dc6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我希望你喜欢这个教程，并能把你的新知识应用到实践中。感谢您的阅读和快乐编码！</p></div></div>    
</body>
</html>